#!/usr/bin/perl

use warnings;
use strict;

use Data::Dumper;
use Math::BigFloat;
use Test::More qw/no_plan/;
use YAML::XS ();
use YAML ();

my $f = Math::BigFloat->new (3.14159265);

my %loaders = (
    pp => sub { YAML::Load (@_) },
    xs => sub { YAML::XS::Load (@_) },
);

my %dumps = (
    pp => YAML::Dump ($f),
    xs => YAML::XS::Dump ($f),
);

warn Dumper \%dumps;

for my $dump (keys %dumps) {
    for my $loader (keys %loaders)  {
        my $f2;
        eval { $f2  = $loaders{$loader}->($dumps{$dump}) };
        diag "Exception during processing of a $dump dump with the $loader loader:\n\n$@" if $@;
        is_deeply ($f, $f2, "Round trip with a $dump dump and a $loader loader");
    }
}
