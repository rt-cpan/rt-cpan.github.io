#! /usr/bin/perl

use Mail::MboxParser;
use Data::Dumper;

my $fname = "testmail";

my $mbox = Mail::MboxParser->new($fname,
				 decode => 'ALL',
				 oldparser => 0,
				 uudecode => 1);

my $mail = $mbox->next_message();

my $rname = $mail->from->{name};
my $email = $mail->from->{email};
my $subject = $mail->header->{subject};

if ($email =~ /\s/) {
    print "Need to convert the mail address\n";
    if ($email =~ /(\S+@\S+)\s+\((.*)\)/) {
	$email = $1;
	$rname = $2;
    } else {
	$email = (split(/\s+/, $email))[0];
    }
}
$email = lc($email);

printf "rname: %s\n", $rname;
printf "email: %s\n", $email;
printf "subject: %s\n", $subject;

printf "%s\n", Dumper $mail->from;
