#!/usr/bin/env perl

use Archive::Tar;

die( "usage: <input tar file name> <output tar file name>\n" )
  unless @ARGV == 2;

my $tar = Archive::Tar->new( $ARGV[0] )
  or die( "error opening $ARGV[0]" );


for my $file ( $tar->list_files( [ 'name' ] ) ) {

    my $mode = $file =~ m{/$} ? '0755' : '0644';
    $tar->chmod( $file, $mode )

}

$tar->write( $ARGV[1], COMPRESS_GZIP );
