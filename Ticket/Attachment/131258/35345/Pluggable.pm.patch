--- Pluggable.pm.orig	Fri Mar 18 09:33:56 2005
+++ Pluggable.pm	Sat May 28 14:22:28 2005
@@ -287,7 +287,6 @@
                 # if it doesn't exist or it's not a dir then skip it
                 next unless ( -e $sp && -d _ ); # Use the cached stat the second time
 
-
                 # find all the .pm files in it
                 # this isn't perfect and won't find multiple plugins per file
                 #my $cwd = Cwd::getcwd;
@@ -303,7 +302,10 @@
 
                 # foreach one we've found 
                 foreach my $file (@files) {
-                    next unless $file =~ m!\.pm$!;
+                    # untaint file accepting .pm only
+                    if ($file =~ /(.*\.pm)/) {
+                        $file = $1;
+                    } else {next};
                     # parse the file to get the name
                     my ($name, $directory) = fileparse($file, qr{\.pm});
                     $directory = abs2rel($directory, $sp);
@@ -431,6 +433,5 @@
             }
             return @packs;
 }
-
 
 1;
