#!/usr/bin/perl

use warnings;
use strict;

use XML::LibXML;

use utf8;
sub is_utf8($) { warn +(utf8::is_utf8($_[0]) ? 'is' : 'not')." utf8\n"}

no utf8;

my $utf   = XML::LibXML::Document->new('1.0', 'UTF-8');
my $latin = XML::LibXML::Document->new('1.0', 'ISO-8859-1');

my $one   = 'C0815-4711-öäü';
is_utf8($one);

my $two   = 'ëę';
is_utf8($two);

warn "1 utf element, no warning";
my $node = $utf->createElement($one);
my $x = $node->toString;
is_utf8($x);
print STDERR $x, "\n";

warn "2 utf text, no warning";
my $text = $utf->createTextNode($two);
$x =  $text->toString;
is_utf8($x);
print STDERR $x, "\n";

warn "3 utf element/text, warning";
$node->addChild($text);
$x = $node->toString;
is_utf8($x);
print STDERR $x, "\n";

warn "4 latin1 element, bad name";
$node = $latin->createElement($one);
$x = $node->toString;
is_utf8($x);
print STDERR $x, "\n";

warn "6 latin1 text";
my $text = $latin->createTextNode($two);
$x =  $text->toString;
is_utf8($x);
print STDERR $x, "\n";

warn "6 latin1 element/text";
$node->addChild($text);
$x = $node->toString;
is_utf8($x);
print STDERR $x, "\n";
