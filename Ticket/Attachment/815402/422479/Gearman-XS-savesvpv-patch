--- XS.xs.orig	2010-04-06 08:29:32.000000000 +0000
+++ XS.xs	2010-08-10 14:57:36.000000000 +0000
@@ -9,6 +9,28 @@
 
 #include "gearman_xs.h"
 
+#if (PERL_REVISION <= 5) && (PERL_VERSION < 9 || (PERL_VERSION == 9 && PERL_SUBVERSION < 3))
+/*
+=for apidoc savesvpv
+
+A version of C<savepv()>/C<savepvn() which gets the string to duplicate from
+the passed in SV using C<SvPV()>
+
+=cut
+*/
+
+char *
+savesvpv(pTHX_ SV *sv)
+{
+    STRLEN len;
+    const char *pv = SvPV(sv, len);
+    register char *newaddr;
+
+    New(903,newaddr,++len,char);
+    return CopyD(pv,newaddr,len,char);
+}
+#endif
+
 static void
 call_XS ( pTHX_ void (*subaddr) (pTHX_ CV *), CV * cv, SV ** mark )
 {
