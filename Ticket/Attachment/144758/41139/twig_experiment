#!/usr/bin/perl

use strict;
use warnings;

use XML::Twig;

my $twig = XML::Twig->new(
    twig_handlers => {
        'entries'     => \&entries_twig,
    }
);
$twig->parse(\*DATA);
$twig->print;

sub entries_twig {
    my $tree    = shift;
    my $entries = shift;

    $entries->wrap_children(
        "<entry type='$_'>*",
        type        => {
            name        => $_,
        },
    ) foreach qw(this that);
}


__DATA__
<entries>
  <entry id="1" type="this"/>
  <entry id="2" type="this"/>
  <entry id="3" type="t&amp;hat"/>
</entries>
