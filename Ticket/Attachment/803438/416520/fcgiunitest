#!/usr/bin/perl

use FCGI;
use strict;
use Encode qw(encode_utf8);

my %env;
my $req = FCGI::Request(\*STDIN, \*STDOUT, \*STDERR, \%env);
my $count = 0;

#to run this as a CGI or on the command line, uncomment this binmode thing
#binmode(STDOUT,":encoding(utf8)");

while($req->Accept() >= 0) {
    print("Content-type: text/html; charset=UTF-8\r\n\r\n",
          "<h1>Unicode Test</h1>\n",
          "Request number ", ++$count, "<p>\n");
    print "Happy face should go here: ";
    $req->Flush();
    
    #this smiley will show up, because we call encode_utf8() on the string
    my $foobar = "\x{263A}";
    print encode_utf8($foobar);
    print "<br>Smiley face should be on the previous line and then again on the next line.<br>";
    print "Another smiley here: ";
    $req->Flush();
    
    #the next line will not work in FCGI
    print "\x{263A}";
    $req->Finish();
}
