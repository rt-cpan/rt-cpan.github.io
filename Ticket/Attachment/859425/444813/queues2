#!/usr/bin/perl

use warnings;
use strict;
use Data::Dumper;

sub collect {
	my $q = shift;
	for ( my $i = 0; $i < 10; $i++) {
		$q -> enqueue(time);
		sleep 1;
	}
}

sub send {
	my $q = shift;
	while ( my $item = $q -> dequeue ) {
		print STDERR "$item\n";
	}
}

eval "
	use forks;
	use Thread::Queue;
";
die $@ if $@;
my $Q = Thread::Queue -> new;

my $C = threads -> create (\&collect, $Q);
my $S = threads -> create (\&send, $Q);
$C -> join();
$S -> detach();

