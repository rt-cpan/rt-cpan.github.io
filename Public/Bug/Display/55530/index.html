<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #55530 for DBD-InterBase: [patch] Makefile.PL accepts remote/aliased DBs</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #55530 for DBD-InterBase: [patch] Makefile.PL accepts remote/aliased DBs</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-InterBase">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-InterBase">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-InterBase">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-InterBase">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-InterBase">DBD-InterBase CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">55530</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-InterBase">DBD-InterBase</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mjp [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10136-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.48    </td>
  </tr>
  <tr id="CF-10137-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dbd-interbase-0_48-Makefile_db_exist.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/747403/386508/dbd-interbase-0_48-Makefile_db_exist.patch">
Sat Mar 13 16:31:42 2010 (5.6k) by mjp [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=55530">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-747403" href="/Public/Bug/Display.html?id=55530#txn-747403">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;13&nbsp;16:31:42&nbsp;2010</span>
    <span class="description">mjp [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [patch] Makefile.PL accepts remote/aliased DBs</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/747403/386507/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/386507">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 719b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Issue:
Makefile.PL expects a locally, directly accessible InterBase/Firebird
test database specification, using the &#34;-f&#34; filetest operator to
determine if the db exists and &#34;gstat&#34; to determine db dialect.

This means that DBD-InterBase must be built on a machine hosting the
database file itself, and that the building UID must have direct
filesystem access to the database.  In particular, specifying remote dbs
or aliased dbs breaks the build, which refuses to continue.

Expectation:
I expect that any db specification one could pass to a DBI-&gt;connect&#40;&#41;
call &#40;&#34;dbname=...&#34;&#41; should work for Makefile.PL.

Patch:
The attached patch uses &#34;isql&#34; to test for the database&#39;s existence and
to pull out dialect information.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dbd-interbase-0_48-Makefile_db_exist.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/747403/386508/dbd-interbase-0_48-Makefile_db_exist.patch">Download dbd-interbase-0_48-Makefile_db_exist.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/Makefile.PL b/Makefile.PL
index b4f1246..70c783b 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -33,6 +33,7 @@ my $ib_dir_prefix;
 # init stuff
 my $IB_Bin_path = &#39;&#39;;
 my $isql_name;
+my $isql_path;
 my @ib_bin_dirs;
 my @ib_inc_dirs;
 my $ib_lib_dir = &#39;&#39;;
@@ -93,6 +94,33 @@ sub locate_dbi_arch_dir {
     return $xst[0];
 }
 
+sub ISQL_EXE
+{
+    # try to find isql
+    return $isql_path if $isql_path;
+
+    for &#40;$IB_Bin_path, split /:/ =&gt; $ENV{PATH}&#41; {
+        s!/ +$ !!xg;
+        next unless $_;
+        if &#40;-x &#34;$_/$isql_name&#34;&#41; {
+            $isql_path = &#34;$_/$isql_name&#34;;
+            return $isql_path;
+        }
+    }
+
+    EXEC:
+    {
+        for &#40;1..3&#41;
+        {
+            $isql_path = prompt&#40;&#34;Enter full path to isql: &#34;, $isql_path&#41;;
+            last EXEC if &#40;-x $isql_path&#41;;
+        }
+        die &#34;Unable to execute isql. Aborting..&#34;;
+    }
+
+    $isql_path;
+}
+
 ################################################################################
 # sub test_files - checks if at least one of the files in the list exists
 # Paramters:
@@ -160,69 +188,48 @@ sub make_test_conf
     # ask for database path
     DBPATH: {
         for &#40;1..3&#41; {
-            last if $path = prompt&#40;&#34;\nFull path to your test database: &#34;, $path&#41;;
+            last if $path = prompt&#40;&#34;\nFull path to test database to create or use: &#34;, $path&#41;;
         }
         die &#34;Must specify a test database&#34; unless $path;
 
         &#40;$db, $host&#41; = reverse split /:/, $path;
-
-        # no longer necessary
-        #PFW - isql on windows doesn&#39;t seem to work without the localhost in the db path
-        #my $hostpath = $path;
-        #if &#40;$path =~ /^localhost:&#40;.+&#41;/&#41; {
-        #    $hostpath = $1;
-        #}
-
-        # if DB doesn&#39;t exist ask for creation
-        if &#40;&#40;!$host || $host =~ /localhost/&#41; &#38;&#38; !-f $db or
-            $host &#38;&#38; $host !~ /localhost/&#41;
-        {
-            print &lt;&lt;&#34;EOM&#34;;
-$path does not exist.
-Trying to create the test database..
-Please enter a username with CREATE DATABASE permission.
-EOM
-            $user = prompt&#40;&#34;Username :&#34;, $user&#41;;
-            $pass = prompt&#40;&#34;Password :&#34;, $pass&#41;;
-            create_test_db&#40;$path, $user, $pass&#41;;
-            last DBPATH;
-        }
-        else
-        {
-            print &lt;&lt;&#34;EOM&#34;;
-$db exists.
-Trying to use an existing database..
-Please enter a username to connect.
-EOM
-            $user = prompt&#40;&#34;Username :&#34;, $user&#41;;
-            $pass = prompt&#40;&#34;Password :&#34;, $pass&#41;;
-
-            # check dialect
-            my $dialect;
-            my $gstat = $IB_Bin_path . &#34;/&#34; . test_files&#40;$IB_Bin_path, [qw&#40;gstat gstat.exe&#41;]&#41;;
-            local *GSTAT;
-            open GSTAT, &#34;$gstat -user $user -password $pass -h $path |&#34; or die &#34;Can&#39;t execute $gstat: $!&#34;;
-            while &#40;&lt;GSTAT&gt;&#41; { &#40;$dialect&#41; = $_ =~ /dialect\s+&#40;\d&#41;/i and last }
-
-            unless &#40;defined $dialect&#41; {
-                print &lt;&lt;&#34;EOM&#34;;
+        $user = prompt&#40;&#34;Username :&#34;, $user&#41;;
+        $pass = prompt&#40;&#34;Password :&#34;, $pass&#41;;
+
+        my $isql = ISQL_EXE;
+		my $dialect = undef;
+
+        if &#40;open&#40;*ISQL, &#34;\Q$isql\E -u \Q$user\E -p \Q$pass\E -x \Q$path\E |&#34;&#41;&#41; {
+			while &#40;&lt;ISQL&gt;&#41; {
+				if &#40;/DIALECT &#40;\d&#41;/i&#41; {
+					$dialect = $1;
+					last;
+				}
+			}
+			close&#40;ISQL&#41;;
+		} else {
+			# Assume target db did not exist
+			create_test_db&#40;$path, $user, $pass&#41;;
+		}
+
+		unless &#40;defined $dialect&#41; {
+			print &lt;&lt;&#34;EOM&#34;;
 
 Dialect of $path is UNKNOWN.
 This test requires a database of dialect 3. You may specify a non-existent database to create a new one.
 EOM
-                my $is_proceed = prompt&#40;&#34;Proceed anyway or create a NEW test database &#40;P/N&#41;?&#34;, &#34;P&#34;&#41;;
-                last DBPATH if $is_proceed =~ /P/i;
-                $path = undef, goto DBPATH;
-            }
-            unless &#40;$dialect == 3&#41; {
-                print &lt;&lt;&#34;EOM&#34;;
+			my $is_proceed = prompt&#40;&#34;Proceed anyway or create a NEW test database &#40;P/N&#41;?&#34;, &#34;P&#34;&#41;;
+			last DBPATH if $is_proceed =~ /P/i;
+			$path = undef, goto DBPATH;
+		}
+		unless &#40;$dialect == 3&#41; {
+			print &lt;&lt;&#34;EOM&#34;;
 The dialect of $path is: $dialect !!.
 This test requires a database of dialect 3. Please specify a non-existent database to create a new one.
 EOM
-                $path = undef, goto DBPATH;
-            }
-        }
-    }
+			$path = undef, goto DBPATH;
+		}
+	}
 
     # save test config to file
     open F, &#34;&gt;$test_conf&#34; or die &#34;Can&#39;t write $test_conf: $!&#34;;
@@ -253,47 +260,10 @@ sub create_test_db
     }
     close T;
 
-    # try to find isql
-    my $isql;
-    if &#40;-x &#34;$IB_Bin_path/$isql_name&#34;&#41; { 
-        $isql = &#34;$IB_Bin_path/$isql_name&#34;; 
-    } else {
-        for &#40;split /:/, $ENV{PATH}&#41;
-        {
-            s#/+$##g;
-            if &#40;-x &#34;$_/$isql_name&#34;&#41; {
-                $isql = &#34;$_/$isql_name&#34;; last; 
-            }
-        }
-    }
-
-    EXEC:
-    {
-        for &#40;1..3&#41;
-        {
-            $isql = prompt&#40;&#34;Enter full path to isql: &#34;, $isql&#41;;
-            last EXEC if &#40;-x $isql&#41;;
-        }
-        die &#34;Unable to execute isql. Aborting..&#34;;
-    }
-
-    #PFW - isql on windows doesn&#39;t seem to work without the localhost in the db path
-    my $hostpath = $path;
-    if &#40;$path =~ /^localhost:&#40;.+&#41;/&#41; {
-        $hostpath = $1;
-    }
-    # if test db directory doesn&#39;t exist -&gt; try to create
-    my $dir = dirname $hostpath;
-    unless &#40;-d $dir&#41;
-    {
-        print &#34;Can&#39;t find $dir. Trying to mkdir..\n&#34;;
-        system&#40;&#39;mkdir&#39;, &#39;-p&#39;, $dir&#41; == 0
-        or die &#34;Can&#39;t mkdir -p $dir&#34;;
-    }
-
     # try to execute isql and create the test database
+	my $isql = ISQL_EXE;
     system&#40;$isql, &#39;-sql_dialect&#39;, 3, &#39;-i&#39;, &#39;./t/create.sql&#39;&#41; == 0
-    or die &#34;Fail calling $isql -i t/create/sql: $?&#34;;
+        or die &#34;Fail calling $isql -i t/create/sql: $?&#34;;
 }
 
 ################################################################################
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.255689</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
