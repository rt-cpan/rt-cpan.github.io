<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17503 for Template-Toolkit: Template toolkit FOREACH problem if UNIVERSAL::can is used</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17503 for Template-Toolkit: Template toolkit FOREACH problem if UNIVERSAL::can is used</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Template-Toolkit/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Template-Toolkit/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Template-Toolkit/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Template-Toolkit/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Template-Toolkit">Template-Toolkit CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17503</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Template-Toolkit/Active/">Template-Toolkit</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
BADGERSRC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-31100-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.14    </td>
  </tr>
  <tr id="CF-31101-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;06&nbsp;07:27:14&nbsp;2006</span>
    <span class="description">BADGERSRC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Template toolkit FOREACH problem if UNIVERSAL::can is used</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Template toolkit fails on processing FOREACH without setting an error if
UNIVERSAL::can has been used. In effect, truncated output is returned.

use strict;
use warnings;

use Template;
use UNIVERSAL::can;

print &#34;\$UNIVERSAL::can::VERSION: $UNIVERSAL::can::VERSION\n&#34;;
print &#34;\$Template::VERSION: $Template::VERSION\n&#34;;

my $templateText = qq&#40;
start
size = [% numbers.size %]
[% FOREACH number IN numbers %] [% number %]
[% END %]
end
&#41;;

my $params = {
numbers =&gt; [1,2,3]
};

my $template = Template-&gt;new&#40; {DEBUG =&gt; 1 }&#41;;
$template-&gt;process&#40; \$templateText, $params &#41; or die $template-&gt;error;


output:

$UNIVERSAL::can::VERSION: 1.03
$Template::VERSION: 2.14

start
size = 3


comment out &#34;use UNIVERSAL::can&#34; and output is:

$UNIVERSAL::can::VERSION:
$Template::VERSION: 2.14

start
size = 3
1
2
3

end


perl is 5.8.7 on debian sarge. My windows box did not demonstrate this
problem until UNIVERSAL::can was upgraded from 1.00 to 1.03. 

The attached patch &#40;against Template::Iterator&#41; seems to clear up the issue.

regards,

Mark
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> template_iterator.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/lib/perl5/Template/Iterator.pm	2004-10-04 12:27:39.000000000 +0200
+++ /home/perl/lib/perl/5.8.7/Template/Iterator.pm	2006-02-06 13:16:37.000000000 +0100
@@ -54,6 +54,8 @@
 use Template::Constants;
 use Template::Exception;
 
+use Scalar::Util qw&#40;blessed&#41;;
+
 $VERSION = sprintf&#40;&#34;%d.%02d&#34;, q$Revision: 2.65 $ =~ /&#40;\d+&#41;\.&#40;\d+&#41;/&#41;;
 $DEBUG   = 0 unless defined $DEBUG;
 
@@ -81,7 +83,7 @@
 	$data = [ map { { key =&gt; $_, value =&gt; $data-&gt;{ $_ } } }
 		  sort keys %$data ];
     }
-    elsif &#40;UNIVERSAL::can&#40;$data, &#39;as_list&#39;&#41;&#41; {
+    elsif &#40;blessed $data &#38;&#38; $data-&gt;can&#40;&#39;as_list&#39;&#41;&#41; {
 	$data = $data-&gt;as_list&#40;&#41;;
     }
     elsif &#40;ref $data ne &#39;ARRAY&#39;&#41; {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;03:47:52&nbsp;2006</span>
    <span class="description">BADGERSRC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 06 07:27:14 2006, BADGERSRC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Template toolkit fails on processing FOREACH without setting an error if
&gt; UNIVERSAL::can has been used. In effect, truncated output is returned.
&gt; 
</div>In fact, this seems to be a problem wherever Template toolkit calls
UNIVERSAL::can.

mark:~/work/migration$ cat template.t
use strict;
use warnings;

use Template;
use UNIVERSAL::can;

use constant TEMPLATEFILE =&gt; q&#40;template.tt&#41;;
my $template = Template-&gt;new&#40;&#41;;

$template-&gt;process&#40; TEMPLATEFILE , {} &#41; or die $template-&gt;error;

mark:~/work/migration$ perl template.t
mark:~/work/migration$ cat template.tt
this is output
mark:~/work/migration$

Comment out &#34;use UNIVERSAL::can&#34; and:

mark:~/work/migration$ perl template.t
this is output

This time the fix is in Template::Provider &#40;attached&#41;.

It is unfortunate that this problem gives silent failure.

Mark
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /home/perl/lib/perl/5.8.7//Template/Provider.pm.dist	2006-02-07 09:34:36.000000000 +0100
+++ /home/perl/lib/perl/5.8.7//Template/Provider.pm	2006-02-07 09:44:59.000000000 +0100
@@ -43,6 +43,7 @@
 use Template::Document;
 use File::Basename;
 use File::Spec;
+use Scalar::Util qw&#40;blessed&#41;;
 
 $VERSION  = sprintf&#40;&#34;%d.%02d&#34;, q$Revision: 2.81 $ =~ /&#40;\d+&#41;\.&#40;\d+&#41;/&#41;;
 
@@ -281,7 +282,7 @@
             unshift&#40;@ipaths, @$dpaths&#41;;
             next;
         }
-        elsif &#40;UNIVERSAL::can&#40;$dir, &#39;paths&#39;&#41;&#41; {
+        elsif &#40;blessed $dir &#38;&#38; $dir-&gt;can&#40; &#39;paths&#39;&#41;&#41; {
             $dpaths = $dir-&gt;paths&#40;&#41; 
                 || return $self-&gt;error&#40;$dir-&gt;error&#40;&#41;&#41;;
             unshift&#40;@ipaths, @$dpaths&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;03:47:55&nbsp;2006</span>
    <span class="description">BADGERSRC [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;03:52:19&nbsp;2006</span>
    <span class="description">abw [...] wardley.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17503] Template toolkit FOREACH problem if UNIVERSAL::can is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Feb 2006 08:50:52 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> via RT &lt;bug-Template-Toolkit [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andy Wardley &lt;abw [...] wardley.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl is 5.8.7 on debian sarge. My windows box did not demonstrate this
&gt; problem until UNIVERSAL::can was upgraded from 1.00 to 1.03. 
</div>
Perhaps then the problem is in UNIVERSAL::can?

A
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;04:16:54&nbsp;2006</span>
    <span class="description">markdclements [...] yahoo.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17503] Template toolkit FOREACH problem if UNIVERSAL::can is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Feb 2006 09:13:29 +0000 &#40;GMT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Template-Toolkit [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Clements &lt;markdclements [...] yahoo.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
--- Andy Wardley via RT &lt;bug-Template-Toolkit@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; via RT wrote:
<div class="message-stanza open">&gt; &gt; perl is 5.8.7 on debian sarge. My windows box did not demonstrate this
&gt; &gt; problem until UNIVERSAL::can was upgraded from 1.00 to 1.03. 
</div>&gt; 
&gt; Perhaps then the problem is in UNIVERSAL::can?
</div> 
Sure, but then perhaps it isn&#39;t. I started off by posting the bug against the UNIVERSAL-can
queue, but then a bit of experimentation seemed to indicate that the problem lay with TT. I
don&#39;t pretend to be an expert with either package so I&#39;ve posted the bug in the hope that
those who know better can take a look at it. UNIVERSAL::can is used by Test::MockObject,
which is why I have encountered the problem, although I am not mocking objects being passed
to TT or TT objects themselves.

regards,

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;05:18:55&nbsp;2006</span>
    <span class="description">abw [...] wardley.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17503] Template toolkit FOREACH problem if UNIVERSAL::can is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Feb 2006 10:17:37 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;markdclements [...] yahoo.co.uk via RT&#34; &lt;bug-Template-Toolkit [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andy Wardley &lt;abw [...] wardley.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">markdclements@yahoo.co.uk via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; but then a bit of experimentation seemed to indicate that the problem 
&gt; lay with TT. 
</div>
Hi Mark,

Looking at the docs for UNIVERSAL::can, it advertises itself as:

&#34;Hack around people calling UNIVERSAL::can&#40;&#41; as a function&#34;

In other words, it deliberately breaks an advertised and totally 
standard usage of the core Perl UNIVERSAL::can subroutine.  :-&#40;

While I agree with some of the reasoning behind it &#40;as expressed in 
the UNIVERSAL::can docs&#41; it doesn&#39;t change the fact that it breaks 
a core Perl function, and deliberately too.

The UNIVERSAL::can&#40;&#41; call is used in many places in TT and in some of 
those places it absolutely has to work as advertised in the Perl core
and not in any other way.  TT often has to work at the lower levels of 
Perl in order to grok things about your variables, etc., in order to 
&#34;Do The Right Thing&#34; for dotop magic.  In these cases, having an external 
CPAN module second-guessing what it thinks we should have written is just 
plain wrong and breaks TT in ways that can&#39;t be fixed by simply using 
Scalar::Utils and the blessed method.

For example, in Template::Stash we have to code explicitly for the CGI
module which doesn&#39;t Do The Right Thing in terms of implementing can&#40;&#41;.
We could tell Lincoln to go fix his module &#40;and get all the people using
CGI to upgrade&#41;, or we could no longer support the CGI module in TT &#40;and
get all the people using it to find something else&#41;, but both of these
are going to make us many enemies :-&#41;

So in summary, I&#39;m fairly certain that TT absolutely depends upon the
original and unmodified behaviour of UNIVERSAL::can in order to work 
with the modules that are really out there, and not some idealised 
OO vision about how modules should be written &#40;which I generally agree 
with all the same&#41;.  

However, I am glad you brought it to my attention because there are 
places in TT where those function calls really should be method calls.
I&#39;m in the &#40;ongoing&#41; process of writing version 3 of TT and I&#39;ll consider
these matters more carefully now that I&#39;m aware of them.

So thanks for taking the time to investigate the issue and file the bug
report, but I&#39;m afraid the only way I can resolve this one for TT2 is to 
say &#34;Don&#39;t use UNIVERSAL::can&#34;.

Cheers
Andy
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;05:44:45&nbsp;2006</span>
    <span class="description">markdclements [...] yahoo.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17503] Template toolkit FOREACH problem if UNIVERSAL::can is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Feb 2006 10:43:53 +0000 &#40;GMT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Template-Toolkit [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Clements &lt;markdclements [...] yahoo.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
--- Andy Wardley via RT &lt;bug-Template-Toolkit@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So thanks for taking the time to investigate the issue and file the bug
&gt; report, but I&#39;m afraid the only way I can resolve this one for TT2 is to 
&gt; say &#34;Don&#39;t use UNIVERSAL::can&#34;.
</div>
OK - thanks for taking the time to explain this. I understand your reasoning. Unfortunately
the net result for the time being is that Test::MockObject won&#39;t play nice with TT. There
are other mockers, but TT and Test::MockObject are both mainstream modules and in an ideal
world would work together. I may reopen the bug in UNIVERSAL-can or possibly create a new
one in Test::MockObject.

thanks again,

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;08&nbsp;03:31:17&nbsp;2006</span>
    <span class="description">cpan [...] wardley.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;08&nbsp;14:42:48&nbsp;2006</span>
    <span class="description">chromatic [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 07 05:18:55 2006, abw@wardley.org wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Looking at the docs for UNIVERSAL::can, it advertises itself as:
&gt; 
&gt; &#34;Hack around people calling UNIVERSAL::can&#40;&#41; as a function&#34;
&gt; 
&gt; In other words, it deliberately breaks an advertised and totally 
&gt; standard usage of the core Perl UNIVERSAL::can subroutine.  :-&#40;
</div>
This is incorrect.  Please see the documentation for UNIVERSAL in Perl
5.8.8.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For example, in Template::Stash we have to code explicitly for the CGI
&gt; module which doesn&#39;t Do The Right Thing in terms of implementing can&#40;&#41;.
&gt; We could tell Lincoln to go fix his module &#40;and get all the people using
&gt; CGI to upgrade&#41;, or we could no longer support the CGI module in TT &#40;and
&gt; get all the people using it to find something else&#41;, but both of these
&gt; are going to make us many enemies :-&#41;
</div>
Lincoln&#39;s code has a bug.  Trying to work around that bug by using
UNIVERSAL::can as a function *breaks* &#40;Test::MockObject&#41;.

Mark has provided me a test case and I&#39;ll do my best to make
UNIVERSAL::can do the right thing, but I prefer to fix bugs, not patch
over them.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;08&nbsp;14:42:49&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;30&nbsp;06:20:55&nbsp;2006</span>
    <span class="description">cpan [...] wardley.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 08 14:42:48 2006, CHROMATIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; In other words, it deliberately breaks an advertised and totally 
&gt; &gt; standard usage of the core Perl UNIVERSAL::can subroutine.  :-&#40;
</div>&gt; 
&gt; This is incorrect.  Please see the documentation for UNIVERSAL in Perl
&gt; 5.8.8.
</div>
Not sure why RT has been opened this again...

The documentation states:

  &#34;can&#34; can be called as a class &#40;static&#41; method, an object 
  method, or a function.

I&#39;m calling it as a function.  Unless I&#39;m missing something, that&#39;s a
documented and standard use of UNIVERSAL::can.  I can understand why you
might want to change UNIVERSAL::can, but then it becomes something
different from what Perl normally does and I&#39;m relying on that behaviour.

So as I see it, using the UNIVERSAL::can module breaks TT &#40;rather than
the other way round&#41; because U::C is changing the documentated behaviour
of a core Perl module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;30&nbsp;06:20:56&nbsp;2006</span>
    <span class="description">cpan [...] wardley.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
