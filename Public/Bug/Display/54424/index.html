<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #54424 for Regexp-Grammars: Regexp::Grammars is very slow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #54424 for Regexp-Grammars: Regexp::Grammars is very slow</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Regexp-Grammars">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Regexp-Grammars">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Regexp-Grammars">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Regexp-Grammars">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Regexp-Grammars">Regexp-Grammars CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">54424</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Regexp-Grammars">Regexp-Grammars</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
alexeiz [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-228600-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.002    </td>
  </tr>
  <tr id="CF-228601-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=54424">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-730912" href="/Public/Bug/Display.html?id=54424#txn-730912">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;08&nbsp;18:36:23&nbsp;2010</span>
    <span class="description">alexeiz [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Regexp::Grammars is very slow</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/730912/377557/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/377557">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m trying to parse &#34;{}&#34; blocks in a C++ header file &#40;10K of size&#41; using 
the following regular expression:

        qr{
            &lt;curly_block&gt;

            &lt;rule: curly_block&gt;
                \{ &#40;?: &lt;curly_block&gt; | [^{}] &#41;* \}
        }xms;

Unfortunately it takes way to long.  Here&#39;s the breakdown with dprofpp:

Total Elapsed Time = 25.65577 Seconds
  User+System Time = 25.38577 Seconds
Exclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 98.6   25.05 25.151      3   8.3505 8.3837  Converter::__ANON__
 0.32   0.082  0.082   6142   0.0000 0.0000  Regexp::Grammars::_open_log
 0.16   0.040  0.049     10   0.0040 0.0049  Converter::BEGIN
 0.12   0.030  0.039      6   0.0050 0.0065  FindBin::BEGIN
 0.08   0.020  0.030      5   0.0040 0.0060  Scalar::Util::PP::BEGIN
 0.08   0.020  0.079      5   0.0040 0.0158  Error::BEGIN
 0.08   0.020  0.255     11   0.0018 0.0232  main::BEGIN
 0.07   0.019  0.019      2   0.0097 0.0093  
Regexp::Grammars::_translate_subru
                                             le_calls
 0.04   0.010  0.010      1   0.0100 0.0100  B::bootstrap
 0.04   0.010  0.010      1   0.0100 0.0100  File::Spec::Unix::path
 0.04   0.010  0.010      1   0.0100 0.0100  main::find_comp_files
 0.04   0.010  0.010      3   0.0033 0.0033  vars::BEGIN
 0.04   0.010  0.010      3   0.0033 0.0033  Config::BEGIN
 0.04   0.010  0.020      2   0.0050 0.0100  lib::BEGIN
 0.04   0.010  0.010      6   0.0017 0.0017  Exporter::as_heavy

The equivalent plain vanilla 5.10 regexp is shown below and it produces 
the result much faster.

        qr{
            &#40;?&lt;text&gt; &#40;?&#38;curly_block&#41;&#41;

            &#40;?&#40;DEFINE&#41;
                &#40;?&lt;curly_block&gt;
                    \{ &#40;?: &#40;?&#38;curly_block&#41; | [^{}] &#41;* \} &#41;
            &#41;
        }xms;


Total Elapsed Time = 0.493133 Seconds
  User+System Time = 0.243133 Seconds
Exclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 16.4   0.040  0.049     11   0.0036 0.0045  Converter::BEGIN
 16.4   0.040  0.079      5   0.0080 0.0158  Error::BEGIN
 16.4   0.040  0.255     11   0.0036 0.0232  main::BEGIN
 8.23   0.020  0.039      6   0.0033 0.0065  FindBin::BEGIN
 8.23   0.020  0.029     28   0.0007 0.0010  Fatal::BEGIN
 4.11   0.010  0.010      5   0.0020 0.0020  DynaLoader::dl_load_file
 4.11   0.010  0.010      3   0.0033 0.0033  vars::BEGIN
 4.11   0.010  0.010      4   0.0025 0.0025  Data::Dumper::BEGIN
 4.11   0.010  0.010      3   0.0033 0.0033  Config::BEGIN
 4.11   0.010  0.018      3   0.0033 0.0062  Converter::__ANON__
 4.11   0.010  0.010      2   0.0050 0.0050  
Regexp::Grammars::_translate_subru
                                             le_call
 4.11   0.010  0.010      9   0.0011 0.0011  Tie::RefHash::BEGIN
 4.11   0.010  0.030      4   0.0025 0.0074  XSLoader::load
 4.11   0.010  0.019      1   0.0099 0.0192  FindBin::init
 4.11   0.010  0.010     66   0.0001 0.0001  File::Spec::Unix::canonpath


25 seconds with Regexp::Grammar vs 0.5 seconds with stock perl regex.  
And this is on a pretty simple regular expression.  Anything more 
complex than this and Regexp::Grammars doesn&#39;t even terminate.  This is 
a showstopper for me.

perl -V:

Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
  Platform:
    osname=solaris, osvers=2.9, archname=sun4-solaris-64int
    uname=&#39;sunos sundev32 5.9 generic_118558-18 sun4u sparc sunw,sun-
fire &#39;
    config_args=&#39;&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=undef, usemultiplicity=undef
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=undef, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;/opt/SUNWspro/bin/cc&#39;, ccflags =&#39;-I/bbs/opt/include -
I/opt/swt/include -I/usr/local/include -D_LARGEFILE_SOURCE -
D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64&#39;,
    optimize=&#39;-O&#39;,
    cppflags=&#39;-I/bbs/opt/include -I/opt/swt/include -I/usr/local/include 
-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64&#39;
    ccversion=&#39;Sun C 5.5 Patch 112760-09 2004/03/31&#39;, gccversion=&#39;&#39;, 
gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=87654321
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, 
Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;/opt/SUNWspro/bin/cc&#39;, ldflags =&#39;-L/bbs/opt/lib -L/opt/swt/lib -
L/usr/lib -L/usr/ccs/lib -L/bb/util/common/studio8-v3/SUNWspro/prod/lib 
-L/usr/local/lib &#39;
    libpth=/bbs/opt/lib /opt/swt/lib /usr/lib /usr/ccs/lib 
/bb/util/common/studio8-v3/SUNWspro/prod/lib /usr/local/lib
    libs=-lsocket -lnsl -lgdbm -ldl -lm -lc
    perllibs=-lsocket -lnsl -ldl -lm -lc
    libc=/lib/libc.so, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39;-KPIC&#39;, lddlflags=&#39;-G -L/bbs/opt/lib -L/opt/swt/lib -
L/usr/lib -L/usr/ccs/lib -L/bb/util/common/studio8-v3/SUNWspro/prod/lib 
-L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: PERL_DONT_CREATE_GVSV PERL_MALLOC_WRAP
                        PERL_USE_SAFE_PUTENV USE_64_BIT_INT 
USE_LARGE_FILES
                        USE_PERLIO
  Built under solaris
  Compiled at Jun 17 2008 17:56:25
  %ENV:
    PERL5LIB=&#34;/bb/util/common/perlmod/lib/site_perl&#34;
  @INC:
    /bb/util/common/perlmod/lib/site_perl
    /bbs/opt/perl-5.10.0/lib/5.10.0/sun4-solaris-64int
    /bbs/opt/perl-5.10.0/lib/5.10.0
    /bbs/opt/perl-5.10.0/lib/site_perl/5.10.0/sun4-solaris-64int
    /bbs/opt/perl-5.10.0/lib/site_perl/5.10.0
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-730926" href="/Public/Bug/Display.html?id=54424#txn-730926">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;08&nbsp;19:14:13&nbsp;2010</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #54424] Regexp::Grammars is very slow</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 9 Feb 2010 11:12:32 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Regexp-Grammars [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/730926/377566/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/377566">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 836b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m trying to parse &#34;{}&#34; blocks in a C++ header file &#40;10K of size&#41; using
&gt; the following regular expression:
&gt;
&gt;        qr{
&gt;            &lt;curly_block&gt;
&gt;
&gt;            &lt;rule: curly_block&gt;
&gt;                \{ &#40;?: &lt;curly_block&gt; | [^{}] &#41;* \}
&gt;        }xms;
&gt;
&gt; Unfortunately it takes way to long.
</div>
The performance might be improved by writing the curly_block rule more
efficiently:

    &lt;token: curly_block&gt;
               \{ &#40;?: [^{}]++ | &lt;.curly_block&gt; &#41;* \}

BTW, the vanilla regex you compared it with is not equivalent to the
regex grammar you used. The equivalent regex would be:

       qr{
           &#40;?&lt;text&gt; &#40;?&#38;curly_block&#41;&#41;

           &#40;?&#40;DEFINE&#41;
               &#40;?&lt;curly_block&gt;
                  \s* \{ \s* &#40;?: &#40;?&#38;curly_block&#41; | [^{}] &#41;* \s* \} &#41;
           &#41;
       }xms;

Hope this helps,

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-730929" href="/Public/Bug/Display.html?id=54424#txn-730929">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;08&nbsp;19:14:14&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-731086" href="/Public/Bug/Display.html?id=54424#txn-731086">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;09&nbsp;01:36:28&nbsp;2010</span>
    <span class="description">alexeiz [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #54424] Regexp::Grammars is very slow</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 9 Feb 2010 01:35:11 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Regexp-Grammars [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alexei Zakharov &lt;alexeiz [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/731086/377660/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/377660">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Damian,

Thanks for you quick reply.  I tried your suggested improvement.  But it
didn&#39;t make any difference in performance.  The dprofpp profile stayed
essentially the same as well with Converter::__ANON__ consuming 98% of the
execution time.

The equivalent plain regex that you provided is indeed a little slower than
the original one.  But not to the point of Regexp::Grammar slowness.  Now
the plain regex is only 20 times faster than Regexp::Grammar.

I&#39;m open to more suggestions.  I can also probably provide you with a repro
scenario.  Although, I believe it should be pretty easy to repro.  The key
is a large input file &#40;10K in my case&#41;.

Thanks,
Alexei

On Mon, Feb 8, 2010 at 7:14 PM, damian@conway.org via RT &lt;
bug-Regexp-Grammars@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=54424">http://rt.cpan.org/Ticket/Display.html?id=54424</a></span> &gt;
&gt;
<div class="message-stanza open">&gt; &gt; I&#39;m trying to parse &#34;{}&#34; blocks in a C++ header file &#40;10K of size&#41; using
&gt; &gt; the following regular expression:
&gt; &gt;
&gt; &gt;        qr{
&gt; &gt;            &lt;curly_block&gt;
&gt; &gt;
&gt; &gt;            &lt;rule: curly_block&gt;
&gt; &gt;                \{ &#40;?: &lt;curly_block&gt; | [^{}] &#41;* \}
&gt; &gt;        }xms;
&gt; &gt;
&gt; &gt; Unfortunately it takes way to long.
</div>&gt;
&gt; The performance might be improved by writing the curly_block rule more
&gt; efficiently:
&gt;
&gt;    &lt;token: curly_block&gt;
&gt;               \{ &#40;?: [^{}]++ | &lt;.curly_block&gt; &#41;* \}
&gt;
&gt; BTW, the vanilla regex you compared it with is not equivalent to the
&gt; regex grammar you used. The equivalent regex would be:
&gt;
&gt;       qr{
&gt;           &#40;?&lt;text&gt; &#40;?&#38;curly_block&#41;&#41;
&gt;
&gt;           &#40;?&#40;DEFINE&#41;
&gt;               &#40;?&lt;curly_block&gt;
&gt;                  \s* \{ \s* &#40;?: &#40;?&#38;curly_block&#41; | [^{}] &#41;* \s* \} &#41;
&gt;           &#41;
&gt;       }xms;
&gt;
&gt; Hope this helps,
&gt;
&gt; Damian
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/731086/377661/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/377661">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-731179" href="/Public/Bug/Display.html?id=54424#txn-731179">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;09&nbsp;07:45:52&nbsp;2010</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #54424] Regexp::Grammars is very slow</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 9 Feb 2010 21:15:15 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Regexp-Grammars [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/731179/377707/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/377707">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 958b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Alexei,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for you quick reply.  I tried your suggested improvement.  But it
&gt; didn&#39;t make any difference in performance.
&gt;
&gt; I&#39;m open to more suggestions.  I can also probably provide you with a repro
&gt; scenario.  Although, I believe it should be pretty easy to repro.  The key
&gt; is a large input file &#40;10K in my case&#41;.
</div>
So is there a reason why you need Regexp::Grammars &#40;rather than just
using vanilla 5.10 named rules&#41;? After all, your example wasn&#39;t actually
capturing the individual nested curly blocks it was parsing. Could you
just use the 20x faster vanilla regex?

Otherwise, if you really do need to build the full data structure
quicker, there may not be anything you can do &#40;except trying Parse::Yapp
or Marpa instead&#41;.

Regexp::Grammars is never going to compete with the pure regex
engine, because its internals are implemented in Perl, whilst the regex
engine&#39;s are implemented in C.

Sorry I couldn&#39;t be of more help.

Damian
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.379246</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
