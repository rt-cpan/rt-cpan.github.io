<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #100259 for Sys-Statistics-Linux: new features to Sys::Statistics::Linux::SysInfo</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #100259 for Sys-Statistics-Linux: new features to Sys::Statistics::Linux::SysInfo</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Sys-Statistics-Linux/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Sys-Statistics-Linux/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Sys-Statistics-Linux/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Sys-Statistics-Linux/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sys-Statistics-Linux">Sys-Statistics-Linux CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">100259</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Sys-Statistics-Linux/Active/">Sys-Statistics-Linux</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
arfreitas [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41782-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.66    </td>
  </tr>
  <tr id="CF-41783-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;10&nbsp;21:31:09&nbsp;2014</span>
    <span class="description">arfreitas [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> new features to Sys::Statistics::Linux::SysInfo</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings John,

I have some suggestions &#40;patch included&#41; to new features as new methods to Sys::Statistics::Linux::SysInfo:

- get_proc_arch

Not exactly a statistic, but this is a information about the CPU anyway.

This method will return an integer as the architecture of the CPUs: 32 or 64 bits, depending on the flags retrieved for one CPU.

It is assumed that all CPUs will have the same flags, so this method will consider only the flags returned by the CPU with &#34;core id&#34; equal to 0 &#40;in other words, the first CPU found&#41;.

- get_cpu_flags

Returns an array reference with all flags retrieve from C&lt;/proc/cpuinfo&gt; using the same logic described in C&lt;get_proc_arch&gt; documentation.

These should small changes but I believe that they might be useful.

If you think they can be added to your distribution I might send new unit tests too.

Best regards,

Alceu
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- old/SysInfo.pm	2014-11-11 00:09:37.356387100 -0200
+++ new/SysInfo.pm	2014-11-11 00:10:23.192207500 -0200
@@ -15,7 +15,7 @@
 
 For more information read the documentation of the front-end module L&lt;Sys::Statistics::Linux&gt;.
 
-=head1 SYSTEM INFOMATIONS
+=head1 SYSTEM INFORMATIONS
 
 Generated by F&lt;/proc/sys/kernel/{hostname,domainname,ostype,osrelease,version}&gt;
 and F&lt;/proc/cpuinfo&gt;, F&lt;/proc/meminfo&gt;, F&lt;/proc/uptime&gt;, F&lt;/proc/net/dev&gt;.
@@ -62,6 +62,21 @@
 
     my $info = $lxs-&gt;get;
 
+=head2 get_proc_arch
+
+Not exactly a statistic, but this is a information about the CPU anyway.
+
+This method will return an integer as the architecture of the CPUs: 32 or 64 bits, depending on the flags
+retrieve for one CPU.
+
+It is assumed that all CPUs will have the same flags, so this method will consider only the flags returned
+by the CPU with &#34;core id&#34; equal to 0 &#40;in other words, the first CPU found&#41;.
+
+=head2 get_cpu_flags
+
+Returns an array reference with all flags retrieve from C&lt;/proc/cpuinfo&gt; using the same logic described in
+C&lt;get_proc_arch&gt; documentation.
+
 =head1 EXPORTS
 
 No exports.
@@ -92,7 +107,7 @@
 use warnings;
 use Carp qw&#40;croak&#41;;
 
-our $VERSION = &#39;0.13&#39;;
+our $VERSION = &#39;0.14&#39;;
 our $RAWTIME = 0;
 
 sub new {
@@ -129,7 +144,22 @@
     return bless \%self, $class;
 }
 
+sub get_proc_arch {
+
+    my $self = shift;
+    return $self-&gt;{proc_arch};
+
+}
+
+sub get_cpu_flags {
+
+    my $self = shift;
+    return $self-&gt;{cpu_flags};
+
+}
+
 sub get {
+
     my $self  = shift;
     my $class = ref $self;
     my $file  = $self-&gt;{files};
@@ -137,6 +167,9 @@
 
     $self-&gt;{stats} = $stats;
 
+    $self-&gt;{proc_arch} = undef;
+    $self-&gt;{cpu_flags} = undef;
+
     $self-&gt;_get_common;
     $self-&gt;_get_meminfo;
     $self-&gt;_get_uptime;
@@ -204,18 +237,60 @@
     open my $fh, &#39;&lt;&#39;, $filename or croak &#34;$class: unable to open $filename &#40;$!&#41;&#34;;
 
     while &#40;my $line = &lt;$fh&gt;&#41; {
-        if &#40;$line =~ /^physical\s+id\s*:\s*&#40;\d+&#41;/&#41; {
-            $phyid = $1;
-            $cpu{$phyid}{count}++;
-        } elsif &#40;$line =~ /^core\s+id\s*:\s*&#40;\d+&#41;/&#41; {
-            $cpu{$phyid}{cores}{$1}++;
-        } elsif &#40;$line =~ /^processor\s*:\s*\d+/&#41; {       # x86
-            $stats-&gt;{countcpus}++;
-        } elsif &#40;$line =~ /^# processors\s*:\s*&#40;\d+&#41;/&#41; {  # s390
-            $stats-&gt;{countcpus} = $1;
-            last;
-        }
-    }
+
+        chomp&#40;$line&#41;;
+
+        CASE: {
+
+            if &#40;$line =~ /^physical\s+id\s*:\s*&#40;\d+&#41;/&#41; {
+                $phyid = $1;
+                $cpu{$phyid}{count}++;
+                last CASE;
+            }
+
+            if &#40;$line =~ /^core\s+id\s*:\s*&#40;\d+&#41;/&#41; {
+                $cpu{$phyid}{cores}{$1}++;
+                last CASE;
+            }
+        
+            if &#40;$line =~ /^processor\s*:\s*\d+/&#41; {       # x86
+                $stats-&gt;{countcpus}++;
+                last CASE;
+            } 
+
+            if &#40;$line =~ /^# processors\s*:\s*&#40;\d+&#41;/&#41; {  # s390
+                $stats-&gt;{countcpus} = $1;
+                last CASE;
+            }
+
+            if &#40;$line =~ /^flags\s+\:/&#41; {
+
+                last CASE if &#40;$self-&gt;get_cpu_flags&#41;; # no use to repeat this
+
+                my &#40; $attribute, $value &#41; = split&#40;/\s+:\s/, $line&#41;;
+                my @flags = split&#40;/\s/, $value&#41;;
+                
+                $self-&gt;{cpu_flags} = \@flags;
+                
+                #long mode
+                if &#40;$value =~ /\slm\s/&#41; {
+
+                    $self-&gt;{proc_arch} = 64;
+
+                } else {
+
+                    $self-&gt;{proc_arch} = 32;
+
+                }
+
+                last CASE;
+
+            }
+    
+      }
+
+}
+
 
     close&#40;$fh&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;19&nbsp;18:29:36&nbsp;2014</span>
    <span class="description">jschulz.cpan [...] bloonix.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Alceu,

I push the code of S:S:L to Github:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/js-bloonix/p5-Sys-Statistics-Linux">https://github.com/js-bloonix/p5-Sys-Statistics-Linux</a></span>

Can you publish your code there? :-&#41;

Cheers,
Jonny
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;19&nbsp;18:29:36&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;30&nbsp;19:25:13&nbsp;2014</span>
    <span class="description">glasswalk3r [...] yahoo.com.br -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #100259] new features to Sys::Statistics::Linux::SysInfo</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 30 Nov 2014 16:22:19 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Sys-Statistics-Linux [...] rt.cpan.org&#34; &lt;bug-Sys-Statistics-Linux [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Alceu R. de Freitas Jr.&#34; &lt;glasswalk3r [...] yahoo.com.br&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Done!

Sent from Yahoo Mail on Android
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
