<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #109706 for SOAP-Lite: Possible issue with SOAP::Serializer</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #109706 for SOAP-Lite: Possible issue with SOAP::Serializer</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SOAP-Lite/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SOAP-Lite">SOAP-Lite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">109706</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SOAP-Lite/Active/">SOAP-Lite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KAMELKEV [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29122-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29123-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;26&nbsp;02:56:33&nbsp;2015</span>
    <span class="description">KAMELKEV [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Possible issue with SOAP::Serializer</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I was carefully reading over the Serializer POD docs, and I stumbled onto the &#34;REGISTERING A NEW DATA TYPE&#34; section, it&#39;s located here:
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~phred/SOAP-Lite-1.19/lib/SOAP/Serializer.pod#REGISTERING_A_NEW_DATA_TYPE">http://search.cpan.org/~phred/SOAP-Lite-1.19/lib/SOAP/Serializer.pod#REGISTERING_A_NEW_DATA_TYPE</a></span>

I think either the docs here overstate the abilities of the code, or there is a bug.

Specifically, following the directions here *will* create a new type callback, however it will never be invoked, as the existence of a callback &#40;even with proper precedence&#41; is not sufficient to push that callback into the type handler chain. In order to do that there is an additional step, which is to create an entry within the _typelookup_order array.

Basically the method encode_scalar&#40;&#41; iterates over the _typelookup_order array, which is purportedly populated via the very first call to the method typelookup, but not via direct manipulation of the type callback registry hash. In order for your new callback to be invoked you must actually add an entry to this array, otherwise it&#39;s existence is not considered.

There are probably a few ways to fix this, but my initial thought is that ditching the typeorder array is the way to go - probably replacing it with some type of lazyloader that generates a cached array which can autoupdate if it&#39;s invalidated. It&#39;s not clear to me what direction you&#39;d want to go though, but I&#39;m willing to help here with patches after discussion.

While here I also noticed that the documentation did not specify the collation of the precedence value associated with the registration of a type callback. I personally assumed that higher was better, which actually ended up not being the case. The lower the precedence value, the sooner your callback will be within the chain. I find it incredibly unlikely that anyone is using this feature, but it&#39;s possibly worth adding to the docs for completeness purposes.

The reason I was even looking at this is probably of interest. XMLRPC::Lite inherits these methods, which I use as part of an API I maintain. I&#39;ve noticed the UTF8 handling within XMLRPC::Lite leaves much to be desired. Basically any utf8 characters are base64 encoded, which is a pretty weird thing to be doing. What I&#39;ve done is register a u_string handler using this facility, which ultimately results in the normally expected xmlrpc document, which thus far seems to be the better way to go. I&#39;d be happy to share that idiom if you&#39;re interested, as I&#39;ve seen many questions regarding this on various forums.

thanks very much for your work here
  -Kevin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;25&nbsp;08:54:44&nbsp;2018</span>
    <span class="description">GNATYNA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">You have to do
$serializer-&gt;typelookup&#40;$serializer-&gt;typelookup&#41;;

after adding $serializer-&gt;typelookup-&gt;{....} to resort typelookup array.
Чтв Ноя 26 02:56:33 2015, KAMELKEV писал:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; I was carefully reading over the Serializer POD docs, and I stumbled
&gt; onto the &#34;REGISTERING A NEW DATA TYPE&#34; section, it&#39;s located here:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~phred/SOAP-Lite-">http://search.cpan.org/~phred/SOAP-Lite-</a></span>
&gt; 1.19/lib/SOAP/Serializer.pod#REGISTERING_A_NEW_DATA_TYPE
&gt; 
&gt; I think either the docs here overstate the abilities of the code, or
&gt; there is a bug.
&gt; 
&gt; Specifically, following the directions here *will* create a new type
&gt; callback, however it will never be invoked, as the existence of a
&gt; callback &#40;even with proper precedence&#41; is not sufficient to push that
&gt; callback into the type handler chain. In order to do that there is an
&gt; additional step, which is to create an entry within the
&gt; _typelookup_order array.
&gt; 
&gt; Basically the method encode_scalar&#40;&#41; iterates over the
&gt; _typelookup_order array, which is purportedly populated via the very
&gt; first call to the method typelookup, but not via direct manipulation
&gt; of the type callback registry hash. In order for your new callback to
&gt; be invoked you must actually add an entry to this array, otherwise
&gt; it&#39;s existence is not considered.
&gt; 
&gt; There are probably a few ways to fix this, but my initial thought is
&gt; that ditching the typeorder array is the way to go - probably
&gt; replacing it with some type of lazyloader that generates a cached
&gt; array which can autoupdate if it&#39;s invalidated. It&#39;s not clear to me
&gt; what direction you&#39;d want to go though, but I&#39;m willing to help here
&gt; with patches after discussion.
&gt; 
&gt; While here I also noticed that the documentation did not specify the
&gt; collation of the precedence value associated with the registration of
&gt; a type callback. I personally assumed that higher was better, which
&gt; actually ended up not being the case. The lower the precedence value,
&gt; the sooner your callback will be within the chain. I find it
&gt; incredibly unlikely that anyone is using this feature, but it&#39;s
&gt; possibly worth adding to the docs for completeness purposes.
&gt; 
&gt; The reason I was even looking at this is probably of interest.
&gt; XMLRPC::Lite inherits these methods, which I use as part of an API I
&gt; maintain. I&#39;ve noticed the UTF8 handling within XMLRPC::Lite leaves
&gt; much to be desired. Basically any utf8 characters are base64 encoded,
&gt; which is a pretty weird thing to be doing. What I&#39;ve done is register
&gt; a u_string handler using this facility, which ultimately results in
&gt; the normally expected xmlrpc document, which thus far seems to be the
&gt; better way to go. I&#39;d be happy to share that idiom if you&#39;re
&gt; interested, as I&#39;ve seen many questions regarding this on various
&gt; forums.
&gt; 
&gt; thanks very much for your work here
&gt;   -Kevin
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;25&nbsp;08:54:45&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
