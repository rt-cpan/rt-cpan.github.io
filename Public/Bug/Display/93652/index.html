<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #93652 for Math-Pari: isprime lies</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #93652 for Math-Pari: isprime lies</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Math-Pari">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Math-Pari">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Math-Pari">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Math-Pari">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Pari">Math-Pari CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">93652</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Math-Pari">Math-Pari</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpan [...] zoffix.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
DANAJ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20832-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.01080605    </td>
  </tr>
  <tr id="CF-20833-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=93652">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1335570" href="/Public/Bug/Display.html?id=93652#txn-1335570">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;08&nbsp;08:07:37&nbsp;2014</span>
    <span class="description">cpan [...] zoffix.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> isprime lies</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1335570/708631/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/708631">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 582b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hey,

Not sure if this was reported already, but I just saw in the logs someone show this bug on IRC. I was able to reproduce it on my box with Math::Pari version 2.01080605 and perl version 5.14.2 &#40;i686-linux-gnu-thread-multi-64int&#41;

&lt;danaj&gt; This amuses me, especially with all the security bugs elsewhere.   perl -MMath::Pari=isprime -E &#39;while &#40;1&#41; { die &#34;22027*44053 is prime?  Cool story, bro!&#34; if isprime&#40;22027*44053&#41;; }&#39;
&lt;danaj&gt; Doesn&#39;t work if you have compiled Math::Pari to use Pari 2.3.5, but that&#39;s not the default.


-- 

Cheers,
ZZ [ <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/author/ZOFFIX">https://metacpan.org/author/ZOFFIX</a></span> ]
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1335671" href="/Public/Bug/Display.html?id=93652#txn-1335671">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;08&nbsp;17:07:55&nbsp;2014</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1335671/708692/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/708692">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Summary: Caused by Pari 2.1.7 using a weak probable prime test.  Later versions of Pari use a much stronger test.


See <span class="clickylink"><a target="new" rel="nofollow" href="http://oeis.org/A141768">http://oeis.org/A141768</a></span> for more examples of &#34;easy&#34; numbers.  The example I gave is one of the easiest with Pari 2.1.7&#39;s RNG, as it fails after only 799 attempts if run first thing.  &#34;9&#34; is another funny example.  Note that any number could be wrong, it&#39;s just the ones from the list will fail more often.

This is a consequence of Pari 2.1.7 giving only two options for isprime: &#40;1&#41; run 10 M-R tests with randomly chosen bases &#40;using its own RNG that is seeded identically each startup&#41;, or &#40;2&#41; run a BLS5 proof, which works great for relatively small numbers, but isn&#39;t workable for 100+ digit numbers &#40;it requires factoring n-1&#41;.

Pari 2.3 fixed this by following the lead of every other math package and using the BPSW test, which is not only faster but has no known counterexample after 34 years of searching.  They do exist, but we just haven&#39;t found one &#40;there are good reasons why we expect them to be very rare&#41;.

This is the same problem I&#39;ve harped on Perl 6, though there is a solution there since we control the source code so can fairly easily add a Lucas test and then change the isprime function to do what we&#39;d like without any user visible change &#40;other than fixing the known examples it gets wrong&#41;.  GMP&#39;s mpz_probab_prime_p has similar issues, with known examples that fail for 16 tests.  Like Perl 6 there is no re-randomization, so the known examples will fail every call.


Why is this important?  Because currently there are CPAN Crypto modules using Math::Pari, and isprime is expected to work well.  There are replacements for most &#40;all?&#41; of the modules, but they&#39;re not known or used in most cases &#40;other than Strawberry Perl which can&#39;t use Math::Pari&#41;.  They may also have replaced the existing defects with new unknown defects.


How do we fix?  Have Math::Pari use a newer version of Pari.  This is not easy.  Getting Pari 2.3.5 to work on some machines is easy, and on many others it requires a *lot* of work.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1335672" href="/Public/Bug/Display.html?id=93652#txn-1335672">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;08&nbsp;17:07:55&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1335701" href="/Public/Bug/Display.html?id=93652#txn-1335701">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;08&nbsp;18:42:03&nbsp;2014</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93652] isprime lies</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 8 Mar 2014 15:41:50 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Dana Jacobsen via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1335701/708705/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/708705">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Mar 08, 2014 at 05:07:55PM -0500, Dana Jacobsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-Pari
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=93652">https://rt.cpan.org/Ticket/Display.html?id=93652</a></span> &gt;
&gt; 
&gt; Summary: Caused by Pari 2.1.7 using a weak probable prime test.  Later versions of Pari use a much stronger test.
&gt; 
&gt; 
&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="http://oeis.org/A141768">http://oeis.org/A141768</a></span> for more examples of &#34;easy&#34; numbers.  The example I gave is one of the easiest with Pari 2.1.7&#39;s RNG, as it fails after only 799 attempts if run first thing.  &#34;9&#34; is another funny example.  Note that any number could be wrong, it&#39;s just the ones from the list will fail more often.
&gt; 
&gt; This is a consequence of Pari 2.1.7 giving only two options for isprime: &#40;1&#41; run 10 M-R tests with randomly chosen bases &#40;using its own RNG that is seeded identically each startup&#41;, or &#40;2&#41; run a BLS5 proof, which works great for relatively small numbers, but isn&#39;t workable for 100+ digit numbers &#40;it requires factoring n-1&#41;.
</div>
What is the expected number of rounds to make the probability below 10^-20?

And what is “startup”, “PARI startup”?  Then Math::Pari/the-user can
call is_prime&#40;&#41; several times to circumvent this?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; How do we fix?  Have Math::Pari use a newer version of Pari.  This is not easy.  Getting Pari 2.3.5 to work on some machines is easy, and on many others it requires a *lot* of work.
</div>
Did not hear about this.  Oups, I see now:
  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/8590d4ea-89ed-11e3-a768-862a330ec7e2">http://www.cpantesters.org/cpan/report/8590d4ea-89ed-11e3-a768-862a330ec7e2</a></span>
Do not know when I will be able to work around this…

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1335882" href="/Public/Bug/Display.html?id=93652#txn-1335882">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;09&nbsp;05:48:21&nbsp;2014</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1335882/708800/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/708800">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 08 18:42:03 2014, nospam-abuse@ilyaz.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What is the expected number of rounds to make the probability below
&gt; 10^-20?
</div>
Worst case numbers have a probability of almost 25% of passing a given test &#40;they are at *most* 25% via Monier 1980, Rabin 1980&#41;.  So 0.25^10 is a bit less than 10^-7.  You&#39;d need 34 tests to stay under 10^-20.  It&#39;s a lot more complicated if trying to get the probability of random inputs rather than worst case &#40;see Damgard,Landrock,Pomerance 1993 for example&#41;.  NIST uses the random input probability in FIPS 186-4, as the p and q are not generated by an adversary.  They end up with 40 tests for 2^-80 at a 1024-bit size &#40;they give many values based on the input sizes and desired error level&#41;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And what is “startup”, “PARI startup”?  Then Math::Pari/the-user can
&gt; call is_prime&#40;&#41; several times to circumvent this?
</div>
Good point that a workaround would be to call isprime more than once, which will &#40;unlike GMP or libtommath&#41; use different bases each time.  You  get 10 new tests each time, so can run multiple times.

By startup I meant that Pari 2.1.7&#39;s random number generator is seeded with the value &#34;1&#34; and then follows a simple LRG &#40;see mymyrand in bibli2.c&#41;.  Hence you get the same sequence each time you start Pari.

These numbers will fail regardless if you call it enough times &#40;it just needs to hit one of the 24.99% of possible bad bases for the number 10 times in a row&#41;.  Because I know the sequence, I can find some that will fail after a small number of calls assuming it was the only action, e.g. the initial example that takes only 799 calls to see.  199*397 takes 1868 calls.  If you ignore that failure and keep calling it, the next one happens after 239k more calls.  Then another 450k calls.  This is just demonstrating that we&#39;re only running 10 M-R tests.



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; How do we fix?  Have Math::Pari use a newer version of Pari.  This is
&gt; &gt; not easy.  Getting Pari 2.3.5 to work on some machines is easy, and
&gt; &gt; on many others it requires a *lot* of work.
</div>&gt; 
&gt; Did not hear about this.  Oups, I see now:
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/8590d4ea-89ed-11e3-a768-">http://www.cpantesters.org/cpan/report/8590d4ea-89ed-11e3-a768-</a></span>
&gt; 862a330ec7e2
&gt; Do not know when I will be able to work around this…
</div>
Thanks for the reply.  It&#39;s been around for a long time, and most people don&#39;t really care.  I think just having the note about it and indicating one can call isprime multiple times should cover it.

Oh with Pari 2.3.5 the API changed:  &#34;ispseudoprime&#34; does the BPSW test &#40;better and faster probable prime test&#41; while &#34;isprime&#34; turns into a primality proof &#40;much slower, albeit they use APR-CL which is quite fast as proofs go&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1335886" href="/Public/Bug/Display.html?id=93652#txn-1335886">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;09&nbsp;05:49:07&nbsp;2014</span>
    <span class="description">DANAJ [...] cpan.org -  Cc DANAJ added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1354740" href="/Public/Bug/Display.html?id=93652#txn-1354740">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;25&nbsp;04:39:18&nbsp;2014</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93652] isprime lies</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Apr 2014 01:39:07 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Dana Jacobsen via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1354740/718996/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/718996">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Mar 09, 2014 at 05:48:22AM -0400, Dana Jacobsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; What is the expected number of rounds to make the probability below
&gt; &gt; 10^-20?
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Worst case numbers have a probability of almost 25% of passing a given test &#40;they are at *most* 25% via Monier 1980, Rabin 1980&#41;.  So 0.25^10 is a bit less than 10^-7.  You&#39;d need 34 tests to stay under 10^-20.  It&#39;s a lot more complicated if trying to get the probability of random inputs rather than worst case &#40;see Damgard,Landrock,Pomerance 1993 for example&#41;.  NIST uses the random input probability in FIPS 186-4, as the p and q are not generated by an adversary.  They end up with 40 tests for 2^-80 at a 1024-bit size &#40;they give many values based on the input sizes and desired error level&#41;.
</div>
Actually, I made a quick search, and could not find what you said as
stated explicitely anywhere I looked!  Essentially, you say that there
is an analogue of Carmichael numbers for the R-M algorithm, but they
have not “exactly the worst possible case &#40;25%&#41; of residues being
non-witnesses”, but “close to 25%”.  They do not even write that the
numbers in <span class="clickylink"><a target="new" rel="nofollow" href="http://oeis.org/A141768">http://oeis.org/A141768</a></span> have close to 25% non-witnesses…

Is it just my inability to Google?  Do you know anything more specific
about these “worst case numbers”?

Thanks,
Ilya

P.S.  I put some random musing into the BUGS part of the latest
      version &#40;with 0.75 misprinted as 0.25 :-[&#41;.

      Page up from
           <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Math-Pari/Pari.pm#INITIALIZATION">http://search.cpan.org/dist/Math-Pari/Pari.pm#INITIALIZATION</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1355002" href="/Public/Bug/Display.html?id=93652#txn-1355002">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;25&nbsp;18:03:02&nbsp;2014</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1355002/719157/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/719157">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Apologies for this long, disorganized answer.  I do not have an unconditional answer, and I&#39;m not sure if I&#39;m answering the right question.

<span class="clickylink"><a target="new" rel="nofollow" href="http://oeis.org/A090659">http://oeis.org/A090659</a></span> may be of more interest.  Note CRG4&#39;s comments about not knowing whether this sequence is infinite or not &#40;which is the cause for a lot of my wandering discussion below&#41;.


Monier &#40;1980&#41; and Rabin &#40;1980&#41; both show the upper bound of 1/4.  E.g. Monier 1980:

  &#34;Proposition 2.  The failure probability alpha_n of Miller-Rabin&#39;s test is less than 1/4 for any composite n.   One remarks that we cannot presently give an upper bound lower than 1/4 since we do not know whether the set of numbers approaching this value is finite or not.&#34;

AGP 1994 notes &#34;A slightly stronger version of the result of Monier [M] and Rabin [R] mentioned in the introduction is that if n &gt; 9 is an odd composite, then at least 3/4 of the integers in [1,n] are witnesses for n.&#34;

Also see the last paragraph of the accuracy section on Wikipedia: <span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Miller-Rabin_primality_test#Accuracy_of_the_test">http://en.wikipedia.org/wiki/Miller-Rabin_primality_test#Accuracy_of_the_test</a></span>.  While not a primary reference, this does not show any new results contrary to the 1/4 limit, and also indicates the general point that on average the false acceptance probability goes down rapidly with the size of the input, but adversarial situations should assume the inputs may be near worst case numbers.



More discussion:
I do not have a proof that there are infinitely many numbers within a given epsilon of 25%.  However, some anecdotal ways of seeing these.  First, from the A141768 sequence:

1. wget <span class="clickylink"><a target="new" rel="nofollow" href="http://oeis.org/A141768/b141768.txt">http://oeis.org/A141768/b141768.txt</a></span>

2. perl -MMath::Prime::Util=:all -nE &#39;&#40;$n&#41; = /^\d+ &#40;\d+&#41;/; &#40;$lb,$t&#41;=&#40;$n-1,0&#41;; for &#40;2..$lb&#41; { $t += is_strong_pseudoprime&#40;$n,$_&#41;; } say &#34;$n &#34;,100*$t/&#40;$n-1&#41;;&#39; b141768.txt

A similar method can be done with Math::Pari, using something like Hasler&#39;s is_A001262&#40;&#41; function in A001262.  This is brute forcing the search -- the method in A141768 may be faster.

This may be easier to see by using A090659 instead, as it by definition will give a monotonically increasing sequence.  If the sequence is infinite &#40;conjectured but not proven&#41;, then I think we could make a precise statement such as &#34;For any given epsilon &gt; 0, there exists a c_0 such that there are infinitely many composites n &gt; c_0 having at least &#40;n-1&#41; * &#40;1/4 - epsilon&#41; non-witnesses.&#34;


Monier &#40;1980&#41; breaks the composite n&#39;s into three categories.  The last are non-Carmichael numbers, with the maximum P&#40;n&#41; occurring with two factors of form &#40;2p+1&#41;&#40;4p+1&#41; for odd p.  We can do a similar experiment:

  perl -MMath::Prime::Util=:all -E &#39;forprimes { $p=&#40;$_-1&#41;&gt;&gt;1; &#40;$p1,$p2&#41; = &#40;$_,2*&#40;$_-1&#41;+1&#41;; if &#40;$p &#38; 1 &#38;&#38; is_prime&#40;$p2&#41;&#41; { $n = $_*$p2;  &#40;$lb,$t&#41;=&#40;$n-1,0&#41;; for &#40;2..$lb&#41; { $t += is_strong_pseudoprime&#40;$n,$_&#41;; } say &#34;$n &#34;,100*$t/&#40;$n-1&#41;; } } 9,10**12;&#39;

and see a similar pattern, with monotonically increasing percentages &#40;note: Higgens conjecture 2 shows it is monotonic, though just a conjecture&#41;.  Monier notes it is an open question as to whether this sequence is infinite or not.

For one of the other cases, Carmichael numbers, there are infinitely many Carmichael numbers &#40;AGP 1994&#41;, but I am not sure that this includes the subset we care about, with exactly three prime factors each congruent to 3 mod 4.  See section 3 of AGP 1994.


Rabin &#40;1980&#41; discusses these numbers on page 133, but mostly noting that they exist hence reducing the constant 3/4 seems not to be possible.  I did not see discussion of frequencies or distributions of these numbers.

The papers by Kim and Pomerance &#40;1989&#41; and Damgård, Landrock, and Pomerance &#40;1993&#41; may have more information.  They are looking at the average probability of accepting a composite number, which is what we care about in a non-adversarial situation, and why for most cases &#40;i.e. where the user isn&#39;t actively trying to find faults&#41; the isprime function works pretty well.

According to the text in A141768, the sequence is infinite, but that would be true with the much weaker proposition that the absolute number of bases increases, allowing a decreasing percentage.  I am unable to parse the AGP 1994 paper well enough to see if there is more information.  Note that this follows from the comments in the sequences A141768 and A090659 -- the former is known to be infinite, while the latter is implied by Dickson&#39;s conjecture, but not proven.


Maybe I&#39;m not understanding the question.  As far as I know, the limit of 3/4 is the best limit known.  Are you thinking that numbers requiring near that limit do not exist?  [Rabin 1980 says they do, as do the programs above]  That they are not infinite?  [still an open question].  That &#34;close to&#34; is not precise enough?  [granted, though we can conjecture a precise statement]

Thanks,
  Dana
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1355027" href="/Public/Bug/Display.html?id=93652#txn-1355027">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;25&nbsp;19:45:43&nbsp;2014</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93652] isprime lies</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Apr 2014 16:45:28 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Dana Jacobsen via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1355027/719166/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/719166">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Apr 25, 2014 at 06:03:03PM -0400, Dana Jacobsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe I&#39;m not understanding the question.  As far as I know, the limit of 3/4 is the best limit known.  Are you thinking that numbers requiring near that limit do not exist?  [Rabin 1980 says they do, as do the programs above]  That they are not infinite?  [still an open question].  That &#34;close to&#34; is not precise enough?  [granted, though we can conjecture a precise statement]
</div>
Thank you a lot, you completely filled the holes in what I knew!

Can you vet the current variant for obvious errors?

Thanks,
Ilya

=======================================================

In older versions of PARI, the one-argument variant of the function
isprime&#40;&#41; is actually checking for probable primes.  Moreover, it has
certain problems.

B&lt;POSSIBLE WORKAROUND &#40;not needed for newer PARI&#41;:&gt; before version 2.3
of PARI, to get probability of misdetecting a prime below 1e-12, call
isprime&#40;&#41; twice; below 1e-18, call it 3 times; etc.  &#40;The algorithm is
probabilistic, and the implementation is such that the result depends
on which calls to isprime&#40;&#41; were performed ealier.&#41;

The problems: first, while the default algorithm &#40;before version 2.3&#41;
gives practically acceptable results in non-adversarial situations,
the worst-case behaviour is significantly worse than the average
behaviour.  The algorithm is looking for so-called &#34;witnesses&#34; &#40;with
up to 10 tries&#41; among random integers; usually, witnesses are
abundant.  However, there are non-prime numbers for which the fraction
of witnesses is close to the theoretical mininum, 0.75; with 10 random
tries, the probability of missing a witness for such numbers is close
to 1e-6.  &#40;The known worst-case numbers M have phi&#40;M&#41;/4 non-witnesses,
with M=P&#40;2P-1&#41;, prime P, 2P-1 and 4|P+1; the proportion of such
numbers near K is expected to be const/sqrt&#40;K&#41;log&#40;K&#41;^2.  Note that
numbers which have more than about 5% non-witnesses may also be
candidates for false positives.  Conjecturally, they are of the form
&#40;aD+1&#41;&#40;bD+1&#41; with a&lt;b, ab &lt;= const, prime aD+1, and bD+1, and D not
divisible by high power of 2 &#40;above a=1, b=2 and D is odd&#41;; the
proportion of such numbers may have a similar asymptotic
const/sqrt&#40;K&#41;log&#40;K&#41;^2.&#41;

Second, the random number generator is &#34;reset to known state&#34; when
PARI library is initialized.  That means that the behaviour is
actually predictable if one knows which calls to isprime&#40;&#41; are
performed; an adversary can find non-primes M which will trigger a
false positive exactly on the Nth call to isprime&#40;M&#41; &#40;for particular
values of N&#41;.  With enough computing resources, one can find
non-primes M for which N is relatively small &#40;with M about 1e9, one
can achieve N as low as 1000&#41;.  Compare with similar examples for
simpler algorithm, L&lt;Carmichael
numbers|<span class="clickylink"><a target="new" rel="nofollow" href="http://primes.utm.edu/glossary/xpage/CarmichaelNumber.html">http://primes.utm.edu/glossary/xpage/CarmichaelNumber.html</a></span>&gt;;
see also L&lt;numbers with big proportion of
non-witnesses|<span class="clickylink"><a target="new" rel="nofollow" href="http://oeis.org/A090659">http://oeis.org/A090659</a></span>&gt; and L&lt;numbers with many
non-witnesses|<span class="clickylink"><a target="new" rel="nofollow" href="http://oeis.org/A141768">http://oeis.org/A141768</a></span>&gt;, and L&lt;the conjecture about
proportion|<span class="clickylink"><a target="new" rel="nofollow" href="http://web.archive.org/web/*/http://www.ma.iup.edu/MAA/proceedings/vol1/higgins.pdf">http://web.archive.org/web/*/http://www.ma.iup.edu/MAA/proceedings/vol1/higgins.pdf</a></span>&gt;.
  
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.530627</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
