<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53698 for CAM-PDF: Error Bad request for object HASH&#40;0xe927170&#41; at position 0 in the file</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53698 for CAM-PDF: Error Bad request for object HASH&#40;0xe927170&#41; at position 0 in the file</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CAM-PDF/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CAM-PDF/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CAM-PDF/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CAM-PDF/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CAM-PDF">CAM-PDF CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53698</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CAM-PDF/Active/">CAM-PDF</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Hans.Reichenecker [...] woehr.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-4996-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.52    </td>
  </tr>
  <tr id="CF-4997-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




53698.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/721031/372302/53698.patch">
Sun Jan 17 03:35:37 2010 (1.6k) by ralacroix [...] hydro.mb.ca
</a>
</font></li>
</ul>


Form4BugReport.odt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/720050/371742/Form4BugReport.odt">
Thu Jan 14 15:22:32 2010 (9.8k) by Hans.Reichenecker [...] woehr.de
</a>
</font></li>
</ul>


Form4BugReport.pdf<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/720050/371741/Form4BugReport.pdf">
Thu Jan 14 15:22:32 2010 (12.2k) by Hans.Reichenecker [...] woehr.de
</a>
</font></li>
</ul>


rt53698.pdf<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/721031/372303/rt53698.pdf">
Sun Jan 17 03:35:38 2010 (12.2k) by ralacroix [...] hydro.mb.ca
</a>
</font></li>
</ul>


rt53698.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/721031/372301/rt53698.t">
Sun Jan 17 03:35:37 2010 (273b) by ralacroix [...] hydro.mb.ca
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;14&nbsp;15:22:32&nbsp;2010</span>
    <span class="description">Hans.Reichenecker [...] woehr.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Error Bad request for object HASH&#40;0xe927170&#41; at position 0 in the
 file</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">CAM-PDF does a good Job. But when I create a pdf with OpenOffice it
does&#39;t work. The new Form is generated but the fields are not filled:

Command:
fillpdffields.pl Form4BugReport.pdf test.pdf AuftragNr 0901234 Datum 15

Result:
Bad request for object HASH&#40;0x1e35a810&#41; at position 0 in the file
Bad request for object HASH&#40;0x1e35a810&#41; at position 0 in the file

What went wrong?

Regards
hr

perl -v
This is perl, v5.8.8 built for x86_64-linux-thread-multi

uname -a
Linux bls-1.woehr.de 2.6.18-92.1.13.el5 #1 SMP Thu Sep 4 03:51:21 EDT
2008 x86_64
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Form4BugReport.pdf</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/720050/371741/Form4BugReport.pdf">Download Form4BugReport.pdf</a><br />
<span class="downloadcontenttype">application/force-download 12.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Form4BugReport.odt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/720050/371742/Form4BugReport.odt">Download Form4BugReport.odt</a><br />
<span class="downloadcontenttype">application/vnd.oasis.opendocument.text 9.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;02:56:04&nbsp;2010</span>
    <span class="description">ralacroix [...] hydro.mb.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well it&#39;s a start - this patch for 1.52 works with the given test case.
 No guarantees on what else might break though.

--- /usr/local/share/perl/5.10.0/CAM/PDF.pm     2010-01-15
01:31:25.000000000 -0600
+++ CAM/PDF.pm  2010-01-15 01:43:07.270502531 -0600
@@ -2825,9 +2825,7 @@ sub getFormField
       {
          my $root = $self-&gt;getRootDict&#40;&#41;-&gt;{AcroForm};
          return if &#40;!$root&#41;;
-         $parent = $self-&gt;dereference&#40;$root-&gt;{value}&#41;;
-         return if &#40;!$parent&#41;;
-         my $dict = $self-&gt;getValue&#40;$parent&#41;;
+         my $dict = $self-&gt;getValue&#40;$root&#41;;
          return if &#40;!exists $dict-&gt;{Fields}&#41;;
          $kidlist = $self-&gt;getValue&#40;$dict-&gt;{Fields}&#41;;
       }
@@ -4576,15 +4574,16 @@ sub fillFormFields  ## no critic&#40;Subrout
             # Search out font resources.  This is a total kluge.
             # TODO: the right way to do this is to look for the DR
             # attribute in the form element or it&#39;s ancestors.
-            for my $font &#40;@rsrcs&#41;
-            {
-               my $fobj = $self-&gt;dereference&#40;&#34;/$font&#34;, &#39;All&#39;&#41;;
-               if &#40;!$fobj&#41;
-               {
-                  die &#34;Could not find resource /$font while preparing
form field $key\n&#34;;
-               }
-               $fdict-&gt;{$font} = CAM::PDF::Node-&gt;new&#40;&#39;reference&#39;,
$fobj-&gt;{objnum}, $formonum, $formgnum&#41;;
-            }
+# RAL 20100115 this code doesn&#39;t work for the test case in bug #53698
+#            for my $font &#40;@rsrcs&#41;
+#            {
+#               my $fobj = $self-&gt;dereference&#40;&#34;/$font&#34;, &#39;All&#39;&#41;;
+#               if &#40;!$fobj&#41;
+#               {
+#                  die &#34;Could not find resource /$font while preparing
form field $key\n&#34;;
+#               }
+#               $fdict-&gt;{$font} = CAM::PDF::Node-&gt;new&#40;&#39;reference&#39;,
$fobj-&gt;{objnum}, $formonum, $formgnum&#41;;
+#            }
          }
       }
       $filled++;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;02:56:10&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;17&nbsp;03:35:34&nbsp;2010</span>
    <span class="description">ralacroix [...] hydro.mb.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> cdolan [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The patch passes all tests distributed with version 1.52, and also
passes the new test case attached. The requestor&#39;s PDF input file is
renamed in this attachment for the new test case.

The first part of the patch fixes the object HASH error. The font search
code near the end of fillFormFields&#40;&#41; is commented for the routine to
complete successfully. Instead of this, it might be better fail softly,
by doing the search but not dying if the font isn&#39;t found.

I tried looking for the font in $propdict because it includes the
field&#39;s inherited attributes, however I didn&#39;t find a suitable object.

Chris, can you run this patch against the full battery of tests and
confirm that this patch resolves the ticket?

Robert
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt53698.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

use warnings;
use strict;

use Test::More tests =&gt; 1;
use CAM::PDF;

# tests the patch for bug report 53698

my $doc = CAM::PDF-&gt;new&#40;&#39;t/rt53698.pdf&#39;&#41; || die $CAM::PDF::errstr;
ok&#40;$doc-&gt;fillFormFields&#40;qw&#40; AuftragNr 0901234 Datum 15 &#41;&#41;, &#39;fields filled&#39;&#41;;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 53698.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/local/share/perl/5.10.0/CAM/PDF.pm	2010-01-15 01:31:25.000000000 -0600
+++ CAM/PDF.pm	2010-01-15 01:54:56.126502736 -0600
@@ -2825,9 +2825,7 @@ sub getFormField
       {
          my $root = $self-&gt;getRootDict&#40;&#41;-&gt;{AcroForm};
          return if &#40;!$root&#41;;
-         $parent = $self-&gt;dereference&#40;$root-&gt;{value}&#41;;
-         return if &#40;!$parent&#41;;
-         my $dict = $self-&gt;getValue&#40;$parent&#41;;
+         my $dict = $self-&gt;getValue&#40;$root&#41;;
          return if &#40;!exists $dict-&gt;{Fields}&#41;;
          $kidlist = $self-&gt;getValue&#40;$dict-&gt;{Fields}&#41;;
       }
@@ -4576,15 +4574,16 @@ sub fillFormFields  ## no critic&#40;Subrout
             # Search out font resources.  This is a total kluge.
             # TODO: the right way to do this is to look for the DR
             # attribute in the form element or it&#39;s ancestors.
-            for my $font &#40;@rsrcs&#41;
-            {
-               my $fobj = $self-&gt;dereference&#40;&#34;/$font&#34;, &#39;All&#39;&#41;;
-               if &#40;!$fobj&#41;
-               {
-                  die &#34;Could not find resource /$font while preparing form field $key\n&#34;;
-               }
-               $fdict-&gt;{$font} = CAM::PDF::Node-&gt;new&#40;&#39;reference&#39;, $fobj-&gt;{objnum}, $formonum, $formgnum&#41;;
-            }
+# this code doesn&#39;t work with the fix for bug #53698
+#            for my $font &#40;@rsrcs&#41;
+#            {
+#               my $fobj = $self-&gt;dereference&#40;&#34;/$font&#34;, &#39;All&#39;&#41;;
+#               if &#40;!$fobj&#41;
+#               {
+#                  die &#34;Could not find resource /$font while preparing form field $key\n&#34;;
+#               }
+#               $fdict-&gt;{$font} = CAM::PDF::Node-&gt;new&#40;&#39;reference&#39;, $fobj-&gt;{objnum}, $formonum, $formgnum&#41;;
+#            }
          }
       }
       $filled++;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt53698.pdf</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/721031/372303/rt53698.pdf">Download rt53698.pdf</a><br />
<span class="downloadcontenttype">application/pdf 12.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
