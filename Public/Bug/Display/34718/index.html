<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34718 for ExtUtils-Command: cp fails to update timestamp on Win32</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34718 for ExtUtils-Command: cp fails to update timestamp on Win32</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-Command/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-Command/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-Command/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-Command/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-Command">ExtUtils-Command CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34718</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-Command/Active/">ExtUtils-Command</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
adamk [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-40880-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.14    </td>
  </tr>
  <tr id="CF-40881-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;06&nbsp;07:00:21&nbsp;2008</span>
    <span class="description">adamk [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> cp fails to update timestamp on Win32</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">cp currently misbehaves on Win32 on NTFS under some circumstances,
because the newly copied file retains the timestamp of the old file.

This creates critical failures in downstream functionality, in
particular it completely destroys the functionality of makefiles,
because copied files are expected to have updated timestamps.

The cp implementation should validate that the timestamp is updated, and
if not it should touch the file to ensure that the timestamp is updated.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;08&nbsp;01:17:56&nbsp;2008</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34718] AutoReply: cp fails to update timestamp on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 8 Apr 2008 07:17:45 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-Command [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Adam Kennedy&#34; &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Followup.

I can validate that something as simple as

if &#40; $^O eq &#39;MSWin32&#39; &#41; {
    my $t = time;
    utime&#40;$t, $t, $dst&#41;;
}

... at the end inside the main foreach in cp is enough to get it
working for Strawberry Perl. I&#39;ve patched the version I bundle with
this change.

Adam K

On 06/04/2008, Bugs in ExtUtils-Command via RT
&lt;bug-ExtUtils-Command@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Greetings,
&gt;
&gt; This message has been automatically generated in response to the
&gt; creation of a trouble ticket regarding:
&gt;        &#34;cp fails to update timestamp on Win32&#34;,
&gt; a summary of which appears below.
&gt;
&gt; There is no need to reply to this message right now.  Your ticket has been
&gt; assigned an ID of [rt.cpan.org #34718].  Your ticket is accessible
&gt; on the web at:
&gt;
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=34718">http://rt.cpan.org/Ticket/Display.html?id=34718</a></span>
&gt;
&gt; Please include the string:
&gt;
&gt;         [rt.cpan.org #34718]
&gt;
&gt; in the subject line of all future correspondence about this issue. To do so,
&gt; you may reply to this message.
&gt;
&gt;                        Thank you,
&gt;                        bug-ExtUtils-Command@rt.cpan.org
&gt;
&gt; -------------------------------------------------------------------------
&gt; cp currently misbehaves on Win32 on NTFS under some circumstances,
&gt; because the newly copied file retains the timestamp of the old file.
&gt;
&gt; This creates critical failures in downstream functionality, in
&gt; particular it completely destroys the functionality of makefiles,
&gt; because copied files are expected to have updated timestamps.
&gt;
&gt; The cp implementation should validate that the timestamp is updated, and
&gt; if not it should touch the file to ensure that the timestamp is updated.
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;08&nbsp;01:17:58&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;09&nbsp;20:28:26&nbsp;2008</span>
    <span class="description">RKOBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 08 01:17:56 2008, adamkennedybackup@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Followup.
&gt; 
&gt; I can validate that something as simple as
&gt; 
&gt; if &#40; $^O eq &#39;MSWin32&#39; &#41; {
&gt;     my $t = time;
&gt;     utime&#40;$t, $t, $dst&#41;;
&gt; }
&gt; 
&gt; ... at the end inside the main foreach in cp is enough to get it
&gt; working for Strawberry Perl. I&#39;ve patched the version I bundle with
&gt; this change.
&gt; 
&gt; Adam K
</div>
I&#39;d be worried a bit about changing this behaviour, in that
ExtUtils::Command::cp:
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/RKOBES/ExtUtils-Command-1.14/lib/ExtUtils/Command.pm">http://search.cpan.org/src/RKOBES/ExtUtils-Command-1.14/lib/ExtUtils/Command.pm</a></span>
relies on File::Copy::copy:
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/RGARCIA/perl-5.10.0/lib/File/Copy.pm">http://search.cpan.org/src/RGARCIA/perl-5.10.0/lib/File/Copy.pm</a></span>
which doesn&#39;t preserve OS-specific attributes, apparently by choice.
File::Copy instead provides syscopy, the documentation for which says in
part

File::Copy also provides the C&lt;syscopy&gt; routine, which copies the
file specified in the first parameter to the file specified in the
second parameter, preserving OS-specific attributes and file
structure.  For Unix systems, this is equivalent to the simple
C&lt;copy&gt; routine, which doesn&#39;t preserve OS-specific attributes.  For
VMS systems, this calls the C&lt;rmscopy&gt; routine &#40;see below&#41;.  For OS/2
systems, this calls the C&lt;syscopy&gt; XSUB directly. For Win32 systems,
this calls C&lt;Win32::CopyFile&gt;.

For the particular problem of Win32, the documentation for
Win32::CopyFile says, in part:

 Win32::CopyFile&#40;FROM, TO, OVERWRITE&#41;
     [CORE] The Win32::CopyFile&#40;&#41; function copies an existing file to a
     new file. All file information like creation time and file
     attributes will be copied to the new file. However it will not copy
     the security information. If the destination file already exists it
     will only be overwritten when the OVERWRITE parameter is true. But
     even this will not overwrite a read-only file; you have to unlink&#40;&#41;
     it first yourself.

So, to be in synch with File::Copy, perhaps ExtUtils::Command could
provide a ExtUtils::Command::syscopy function, which would copy creation
time and file attributes to the new file. This though wouldn&#39;t solve the
problem of Makefiles using ExtUtils::Command::cp.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;10&nbsp;06:16:16&nbsp;2008</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34718] cp fails to update timestamp on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Apr 2008 18:15:59 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-Command [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Adam Kennedy&#34; &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As I understand itm ExtUtils::Command is intended to provide
unix-style semantics?

And so making Win32 behave like unix is desirable?

Adam K

On 10/04/2008, RKOBES via RT &lt;bug-ExtUtils-Command@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=34718">http://rt.cpan.org/Ticket/Display.html?id=34718</a></span> &gt;
&gt;
&gt; On Tue Apr 08 01:17:56 2008, adamkennedybackup@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Followup.
&gt; &gt;
&gt; &gt; I can validate that something as simple as
&gt; &gt;
&gt; &gt; if &#40; $^O eq &#39;MSWin32&#39; &#41; {
&gt; &gt;     my $t = time;
&gt; &gt;     utime&#40;$t, $t, $dst&#41;;
&gt; &gt; }
&gt; &gt;
&gt; &gt; ... at the end inside the main foreach in cp is enough to get it
&gt; &gt; working for Strawberry Perl. I&#39;ve patched the version I bundle with
&gt; &gt; this change.
&gt; &gt;
&gt; &gt; Adam K
</div>&gt;
&gt; I&#39;d be worried a bit about changing this behaviour, in that
&gt; ExtUtils::Command::cp:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/RKOBES/ExtUtils-Command-1.14/lib/ExtUtils/Command.pm">http://search.cpan.org/src/RKOBES/ExtUtils-Command-1.14/lib/ExtUtils/Command.pm</a></span>
&gt; relies on File::Copy::copy:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/RGARCIA/perl-5.10.0/lib/File/Copy.pm">http://search.cpan.org/src/RGARCIA/perl-5.10.0/lib/File/Copy.pm</a></span>
&gt; which doesn&#39;t preserve OS-specific attributes, apparently by choice.
&gt; File::Copy instead provides syscopy, the documentation for which says in
&gt; part
&gt;
&gt; File::Copy also provides the C&lt;syscopy&gt; routine, which copies the
&gt; file specified in the first parameter to the file specified in the
&gt; second parameter, preserving OS-specific attributes and file
&gt; structure.  For Unix systems, this is equivalent to the simple
&gt; C&lt;copy&gt; routine, which doesn&#39;t preserve OS-specific attributes.  For
&gt; VMS systems, this calls the C&lt;rmscopy&gt; routine &#40;see below&#41;.  For OS/2
&gt; systems, this calls the C&lt;syscopy&gt; XSUB directly. For Win32 systems,
&gt; this calls C&lt;Win32::CopyFile&gt;.
&gt;
&gt; For the particular problem of Win32, the documentation for
&gt; Win32::CopyFile says, in part:
&gt;
&gt;  Win32::CopyFile&#40;FROM, TO, OVERWRITE&#41;
&gt;     [CORE] The Win32::CopyFile&#40;&#41; function copies an existing file to a
&gt;     new file. All file information like creation time and file
&gt;     attributes will be copied to the new file. However it will not copy
&gt;     the security information. If the destination file already exists it
&gt;     will only be overwritten when the OVERWRITE parameter is true. But
&gt;     even this will not overwrite a read-only file; you have to unlink&#40;&#41;
&gt;     it first yourself.
&gt;
&gt; So, to be in synch with File::Copy, perhaps ExtUtils::Command could
&gt; provide a ExtUtils::Command::syscopy function, which would copy creation
&gt; time and file attributes to the new file. This though wouldn&#39;t solve the
&gt; problem of Makefiles using ExtUtils::Command::cp.
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;10&nbsp;11:47:11&nbsp;2008</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34718] cp fails to update timestamp on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Apr 2008 17:46:26 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-Command [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Adam Kennedy via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As I understand itm ExtUtils::Command is intended to provide
&gt; unix-style semantics?
&gt; 
&gt; And so making Win32 behave like unix is desirable?
</div>
Yes, that&#39;s the idea.  It&#39;s meant to provide unified cross-platform behavior.


-- 
But there&#39;s no sense crying over every mistake.
You just keep on trying till you run out of cake.
     -- Jonathan Coulton, &#34;Still Alive&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;23:46:47&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In order to emulate Unix behavior, the file is only be touched if it
actually changed.  Otherwise the times are left alone.  That&#39;s annoying
to have to check, because now we have to check every time before we copy.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;09&nbsp;00:11:34&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If this is an NTFS only thing it should be safe to make a Windows
exception to always touch the file.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/ExtUtils/Command.pm b/lib/ExtUtils/Command.pm
index fbb7d13..528a02f 100644
--- a/lib/ExtUtils/Command.pm
+++ b/lib/ExtUtils/Command.pm
@@ -14,7 +14,9 @@ use vars qw&#40;@ISA @EXPORT @EXPORT_OK $VERSION&#41;;
                 dos2unix&#41;;
 $VERSION = &#39;1.14&#39;;
 
-my $Is_VMS = $^O eq &#39;VMS&#39;;
+my $Is_VMS   = $^O eq &#39;VMS&#39;;
+my $Is_Win32 = $^O eq &#39;MSWin32&#39;;
+
 
 =head1 NAME
 
@@ -210,6 +212,10 @@ sub cp {
     my $nok = 0;
     foreach my $src &#40;@src&#41; {
         $nok ||= !copy&#40;$src,$dst&#41;;
+
+        # Win32 does not update the mod time of a copied file, just the
+        # created time which make does not look at.
+        utime&#40;time, time, $dst&#41; if $Is_Win32;
     }
     return $nok;
 }
diff --git a/t/eu_command.t b/t/eu_command.t
index e994f83..99e45aa 100644
--- a/t/eu_command.t
+++ b/t/eu_command.t
@@ -22,10 +22,8 @@ BEGIN {
     File::Path::rmtree&#40; &#39;ecmddir&#39; &#41;;
 }
 
-BEGIN {
-    use Test::More tests =&gt; 40;
-    use File::Spec;
-}
+use Test::More tests =&gt; 40;
+use File::Spec;
 
 BEGIN {
     # bad neighbor, but test_f&#40;&#41; uses exit&#40;&#41;
--- /dev/null	2008-10-08 23:59:56.000000000 -0400
+++ t/cp.t	2008-10-09 00:04:10.000000000 -0400
@@ -0,0 +1,33 @@
+#!/usr/bin/perl -w
+
+BEGIN {
+    if&#40; $ENV{PERL_CORE} &#41; {
+        chdir &#39;t&#39;;
+        @INC = &#40;&#39;../lib&#39;, &#39;lib/&#39;&#41;;
+    }
+    else {
+        unshift @INC, &#39;t/lib/&#39;;
+    }
+}
+chdir &#39;t&#39;;
+
+use ExtUtils::Command;
+use Test::More tests =&gt; 1;
+
+open FILE, &#34;&gt;source&#34; or die $!;
+print FILE &#34;stuff\n&#34;;
+close FILE;
+
+# Instead of sleeping to make the file time older
+utime time - 900, time - 900, &#34;source&#34;;
+
+END { 1 while unlink &#34;source&#34;, &#34;dest&#34;; }
+
+# Win32 bug, cp wouldn&#39;t update mtime.
+{
+    local @ARGV = qw&#40;source dest&#41;;
+    cp&#40;&#41;;
+    my $mtime = &#40;stat&#40;&#34;dest&#34;&#41;&#41;[9];
+    my $now   = time;
+    cmp_ok&#40; abs&#40;$mtime - $now&#41;, &#39;&lt;=&#39;, 1, &#39;cp updated mtime&#39; &#41;;
+}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;12&nbsp;18:22:02&nbsp;2008</span>
    <span class="description">RKOBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks very much for the patch - I applied this to the svn sources, and
will make a new CPAN release shortly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;12&nbsp;18:22:04&nbsp;2008</span>
    <span class="description">RKOBES [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
