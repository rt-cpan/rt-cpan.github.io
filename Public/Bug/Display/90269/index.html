<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #90269 for Prima: maximize by NET-WM message</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #90269 for Prima: maximize by NET-WM message</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Prima">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Prima">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Prima">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Prima">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Prima">Prima CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">90269</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Prima">Prima</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-27120-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-27121-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




foo.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1286576/681780/foo.pl">
Mon Nov 11 16:45:55 2013 (663b) by user42 [...] zip.com.au
</a>
</font></li>
</ul>


patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1291163/684155/patch">
Fri Nov 22 03:53:19 2013 (2.4k) by KARASIK [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=90269">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1286576" href="/Public/Bug/Display.html?id=90269#txn-1286576">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;11&nbsp;16:45:55&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Nov 2013 08:45:19 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1286576/681779/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/681779">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve had a bit of trouble with the prima window maximize&#40;&#41; under recent
debian i386 fvwm 2.6.5.  After maximizing a restore does not return to
the previous size, whereas I hoped it would.

Simple program below.  Pressing maximize button maximizes as expected,
but then pressing restore does not return to the previous size.

Nosing around with xmon it seems maximize is

    Unmap
    ClientMessage
    set _NET_WM_STATE property
    Map

I wonder if for netwm it would be ClientMessage alone and trust the wm
to update the state and maintain the &#34;normal&#34; size, with no unmapping or
property storing.

I saw a comment in apc_win.c

   /* net hints changes by themselves do not result in maximization -
      need explicit map/unmap. */

If that meant storing to _NET_WM_STATE does nothing then yes that&#39;s so.
As I understand it after mapping a client should send wm messages for
any changes &#40;any client can ask to change any toplevel&#41;.  Initial
_NET_WM_STATE can be set for desired initial state.

Incidentally the code syncing with the wm seems hairy.  I&#39;m not sure
there&#39;s a protocol for that.  You&#39;d be tempted to send ClientMessage and
not worry that the actual change will take place a little later.  Could
applications tolerate the maximize state not changing immediately but
only a little later?
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1286576/681780/foo.pl">Download foo.pl</a><br />
<span class="downloadcontenttype">text/x-perl 663b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1286589" href="/Public/Bug/Display.html?id=90269#txn-1286589">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;11&nbsp;17:30:06&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Nov 2013 23:29:46 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kevin Ryde via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1286589/681789/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/681789">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve had a bit of trouble with the prima window maximize&#40;&#41; under recent
&gt; debian i386 fvwm 2.6.5.  After maximizing a restore does not return to
&gt; the previous size, whereas I hoped it would.
</div>
Hi Kevin,

Thanks for the report, I&#39;ll take a look as soon as I can, this or next week.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Nosing around with xmon it seems maximize is
&gt; 
&gt;     Unmap
&gt;     ClientMessage
&gt;     set _NET_WM_STATE property
&gt;     Map
&gt; 
&gt; I wonder if for netwm it would be ClientMessage alone and trust the wm
&gt; to update the state and maintain the &#34;normal&#34; size, with no unmapping or
&gt; property storing.
&gt; 
&gt; I saw a comment in apc_win.c
&gt; 
&gt;    /* net hints changes by themselves do not result in maximization -
&gt;       need explicit map/unmap. */
&gt; 
&gt; If that meant storing to _NET_WM_STATE does nothing then yes that&#39;s so.
&gt; As I understand it after mapping a client should send wm messages for
&gt; any changes &#40;any client can ask to change any toplevel&#41;.  Initial
&gt; _NET_WM_STATE can be set for desired initial state.
</div>
There&#39;s a simple explanation to this, this code was adapted from gtk2, and worked
fairly well since.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Incidentally the code syncing with the wm seems hairy.  I&#39;m not sure
&gt; there&#39;s a protocol for that.
</div>
I don&#39;t think there&#39;s any, but it&#39;s generally fairly legit to send a resize &#40;map etc&#41; request
and wait for ConfigureNotify &#40;MapNotify etc&#41; event.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  You&#39;d be tempted to send ClientMessage and
&gt; not worry that the actual change will take place a little later.  Could
&gt; applications tolerate the maximize state not changing immediately but
&gt; only a little later?
</div>
Not really, that would break lots of logic. Prima tries to wait for ConfigureNotify 
so that size and state changes happens inside maximize&#40;&#41;. Of course its best effort can fail,
so size change event can indeed arrive later; but not the state event.

It looks to me that the culprit code is this:

   if &#40; XX-&gt; flags. zoomed &#38;&#38; state != wsMaximized&#41; {
      set_net_hints&#40; X_WINDOW, -1, -1, 0, -1&#41;;
      apc_window_set_rect&#40; self, XX-&gt; zoomRect. left, XX-&gt; zoomRect. bottom, 
         XX-&gt; zoomRect. right, XX-&gt; zoomRect. top&#41;;
      if &#40; XX-&gt; flags. zoomed&#41; sync = ConfigureNotify;
      XX-&gt; flags. zoomed = 0; 
   }   

and most probably XX-&gt;zoomRect has wrong values for one or another reason ...
if you feel like it you can try to print out its values, and also run the
program with --debug=E and/or --icccm, possibly it sheds some light to why it happens. 

-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1286590" href="/Public/Bug/Display.html?id=90269#txn-1286590">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;11&nbsp;17:30:07&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1286636" href="/Public/Bug/Display.html?id=90269#txn-1286636">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;11&nbsp;19:08:20&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Nov 2013 11:07:19 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1286636/681820/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/681820">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 821b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Dmitry Karasik via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; and most probably XX-&gt;zoomRect has wrong values for one or another reason ...
&gt; if you feel like it you can try to print out its values,
</div>
Oh, I tried some prints a while ago but couldn&#39;t tell how it went wrong.
Yes I think the zoomRect became big, but dunno why.  I think I wondered
whether for netwm the &#34;normal&#34; size in the toolkit should be unused
anyway, if it&#39;s all left to the wm.  It used to happen only in my big
slow program which made it hard to see.  It might be easier now in the
small program.

Incidentally unmap+map is potentially undesirable for &#34;interactive
placement&#34; mode where the wm has the user interactively position a newly
mapped window.  Perhaps no netwm window manager does that now.  It was a
common option in some of the early wms.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1286827" href="/Public/Bug/Display.html?id=90269#txn-1286827">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;12&nbsp;03:18:43&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Nov 2013 09:18:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kevin Ryde via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1286827/681892/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/681892">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 909b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Incidentally unmap+map is potentially undesirable for &#34;interactive
&gt; placement&#34; mode where the wm has the user interactively position a newly
&gt; mapped window.  Perhaps no netwm window manager does that now.  It was a
&gt; common option in some of the early wms.
</div>
AFAIR not newly mapped window, but rather a newly created window. I vaguely
remember I tested this under twm which does exactly that, waits the user to
position a new window, that it doesn&#39;t intercept map/unmap requests. But again,
twm is a non-netwm manager.

But generally speaking, yes, we&#39;re totally at a mercy of a wm, whether
netwm-complicant or not; it can easily deny &#40;or worse, replace&#41; each
configure/map/zorder request and Prima will not be able to detect whether the
request was denied or it waited not long enough. So there&#39;s quite a lot of
ad-hoc code that incidentally works with most popular wms.


-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1286830" href="/Public/Bug/Display.html?id=90269#txn-1286830">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;12&nbsp;03:28:27&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Nov 2013 09:28:10 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Dmitry Karasik via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1286830/681895/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/681895">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 149b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just have tried the example with fvwm 2.5.30 in my ubuntu. Works fine , both
maximize and restore work as expected.

-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1286833" href="/Public/Bug/Display.html?id=90269#txn-1286833">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;12&nbsp;03:43:19&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Nov 2013 09:43:06 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Dmitry Karasik via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1286833/681898/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/681898">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 284b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Also, just tried fvwm 2.6.5. Fine in all aspects .. also tried it on two-monitor setup, in various
combinations, creating window on different screen and dragging it between them, all works o.k. here.
I have no idea why the problem might happen ..  :&#40;

-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1287965" href="/Public/Bug/Display.html?id=90269#txn-1287965">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;14:40:43&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Nov 2013 06:39:53 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1287965/682523/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/682523">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 906b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Dmitry Karasik via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Also, just tried fvwm 2.6.5. Fine in all aspects ..
</div>
Ah dear, a thousand pardons, the blame is all with fvwm.  It maximizes
by the _NET_WM_STATE flags and messages, but deletes the flags from the
_NET_WM_STATE property.  So everyone else sees the window grow but the
flags are unset.

If prima is fast enough then it sees the _NET_WM_STATE property flags
which it &#40;prima&#41; itself stored, causing prima to work correctly.  If
it&#39;s slowed then fvwm has deleted the _NET_WM_STATE maximize flags and
prima falls back to its default but fvwm has already grown the window.
:-&#40;

Incidentally, fvwm _NET_WM_STATE flags are not completely broken, only
mostly.  Its FULLSCREEN flag seems about right and I&#39;d been using it in
other things.  That tricked me into thinking it had all the net-wm bits
it advertises in _NET_SUPPORTED :-&#40;


-- 
No, eees hamster.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1287967" href="/Public/Bug/Display.html?id=90269#txn-1287967">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;14:52:17&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Nov 2013 06:51:13 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1287967/682525/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/682525">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 952b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Dmitry Karasik via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; AFAIR not newly mapped window, but rather a newly created window. I vaguely
&gt; remember I tested this under twm which does exactly that, waits the user to
&gt; position a new window, that it doesn&#39;t intercept map/unmap requests. But again,
&gt; twm is a non-netwm manager.
</div>
Hmm.  fvwm has this mode if you add to .fvwmrc

Style * ManualPlacement

When first opening a prima window it goes interactive as expected, but
then on maximizing it goes interactive a second time.  But thereafter
it&#39;s automatic for any maximize and restore.  The second interactive
seems a bit stupid since it has the maximize flags and so will be the
full screen, not where you place it.  Why it does it only the two times
I don&#39;t know.  It must as you say remember the windows even when unmap
in principle means &#34;withdraw&#34; from window management.  But fvwm has
rather fallen in my appreciation just at this moment ... :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1288005" href="/Public/Bug/Display.html?id=90269#txn-1288005">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;17:04:02&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 23:03:46 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kevin Ryde via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1288005/682549/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/682549">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 846b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm.  fvwm has this mode if you add to .fvwmrc
&gt; 
&gt; Style * ManualPlacement
&gt; 
&gt; When first opening a prima window it goes interactive as expected, but
&gt; then on maximizing it goes interactive a second time.  But thereafter
&gt; it&#39;s automatic for any maximize and restore.  The second interactive
&gt; seems a bit stupid since it has the maximize flags and so will be the
&gt; full screen, not where you place it.  Why it does it only the two times
&gt; I don&#39;t know.  It must as you say remember the windows even when unmap
&gt; in principle means &#34;withdraw&#34; from window management.  But fvwm has
&gt; rather fallen in my appreciation just at this moment ... :-&#41;
</div>
That&#39;s doesn&#39;t look right, no. But it would be interesting to see if it does
the same on a native gtk application &#40;because maximization code was lifter off gtk&#41;..

-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1288041" href="/Public/Bug/Display.html?id=90269#txn-1288041">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;18:51:43&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Nov 2013 10:50:50 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1288041/682568/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/682568">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 544b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Dmitry Karasik via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; But it would be interesting to see if it does
&gt; the same on a native gtk application &#40;because maximization code was lifter off gtk&#41;..
</div>
With a test program, it doesn&#39;t.  Interactive placement for first open,
then maximize is not interactive.

Did gtk once unmap/set/map?  I see for example even back to gtk 2.0.0
gdk/x11/gdkwindow-x11.c gdk_wmspec_change_state&#40;&#41; is XSendEvent&#40;&#41; of
ClientMessage to ask the wm for change.  Some xmond suggests this is
still so in, umm, recent 2.24.21.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1288048" href="/Public/Bug/Display.html?id=90269#txn-1288048">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;19:33:33&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Nov 2013 01:33:21 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kevin Ryde via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1288048/682570/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/682570">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Nov 14, 2013 at 06:51:44PM -0500, Kevin Ryde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Prima
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90269">https://rt.cpan.org/Ticket/Display.html?id=90269</a></span> &gt;
&gt; 
&gt; &#34;Dmitry Karasik via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; But it would be interesting to see if it does
&gt; &gt; the same on a native gtk application &#40;because maximization code was lifter off gtk&#41;..
</div>&gt; 
&gt; With a test program, it doesn&#39;t.  Interactive placement for first open,
&gt; then maximize is not interactive.
&gt; 
&gt; Did gtk once unmap/set/map?  I see for example even back to gtk 2.0.0
&gt; gdk/x11/gdkwindow-x11.c gdk_wmspec_change_state&#40;&#41; is XSendEvent&#40;&#41; of
&gt; ClientMessage to ask the wm for change.  Some xmond suggests this is
&gt; still so in, umm, recent 2.24.21.
</div>
Hmm gdk did _not_ do map/unmap? This gets strange. I don&#39;t remember it was my idea...

Anyway the code is definitely there for a purpose, and I can&#39;t remember what specific setup it was
for. I see it is from 2003, and back then I was using KDE, which might do strange things.

Also, generally, I agree that map/unmap is a weird technique for maximization, and deserves
even if not removal, but at least testing again on modern WMs. Especially that gtk
doesn&#39;t do it.

Could I then ask you then if you can try to remove this map/unmap path and see if it gets any better
on your fvwm setup? 

/dk

-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1290606" href="/Public/Bug/Display.html?id=90269#txn-1290606">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;20&nbsp;18:36:09&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 21 Nov 2013 10:34:49 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1290606/683849/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/683849">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1018b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Dmitry Karasik via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Could I then ask you then if you can try to remove this map/unmap path and see if it gets any better
&gt; on your fvwm setup? 
</div>
Use the change message instead?  fvwm is equally bad on that for the
maximize I think, but it would help the manual placement bit.

What do you think of sending a change message and wait for the
_NET_WM_STATE property to change to the desired setting &#40;with a
timeout&#41;.  In general that might be more reliable than listening for
ConfigureNotify.

You could even think about not doing the fallback maximize if the state
doesn&#39;t become what&#39;s desired.  If the wm says _NET_SUPPORTED then take
it at its word and if the change message doesn&#39;t actually do anything
then too bad.

I reached all this because I had in my program a keybinding &#40;and a menu
entry&#41; to control the maximize from the program.  I toggle there rather
than set to a particular state, if maybe there was something in prima to
send a toggle message when under net-wm.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1290779" href="/Public/Bug/Display.html?id=90269#txn-1290779">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;21&nbsp;04:08:36&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 21 Nov 2013 10:08:18 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kevin Ryde via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1290779/683943/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/683943">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hi Kevin,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Could I then ask you then if you can try to remove this map/unmap path and see if it gets any better
&gt; &gt; on your fvwm setup? 
</div>&gt; Use the change message instead?  fvwm is equally bad on that for the
&gt; maximize I think, but it would help the manual placement bit.
</div>
No, not even change message, just how it works without map/unmap. I suspect that
my comment &#34;net hints changes by themselves do not result in maximization
need explicit map/unmap&#34; might just not be valid anymore in 2013.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What do you think of sending a change message and wait for the
&gt; _NET_WM_STATE property to change to the desired setting &#40;with a
&gt; timeout&#41;.  In general that might be more reliable than listening for
&gt; ConfigureNotify.
&gt;
&gt; You could even think about not doing the fallback maximize if the state
&gt; doesn&#39;t become what&#39;s desired.  If the wm says _NET_SUPPORTED then take
&gt; it at its word and if the change message doesn&#39;t actually do anything
&gt; then too bad.
</div>
I believe prima does it exactly as you&#39;re describing it. It waits for ConfigureNotify
and then checks for _NET_WM_STATE. It needs ConfigureNotify _also_ because it wants to 
fire cmSize synchronously, if possible. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I reached all this because I had in my program a keybinding &#40;and a menu
&gt; entry&#41; to control the maximize from the program.  I toggle there rather
&gt; than set to a particular state, if maybe there was something in prima to
&gt; send a toggle message when under net-wm.
</div>
I&#39;m not sure if I understand difference between &#34;toggle&#34; and &#34;set to a particular state&#34;,
what do you mean by that? Only send NET_WM_STATE change without map/unmap? 

-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1291033" href="/Public/Bug/Display.html?id=90269#txn-1291033">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;21&nbsp;18:22:14&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Nov 2013 10:21:55 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1291033/684086/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684086">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Dmitry Karasik via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; No, not even change message, just how it works without map/unmap. I suspect that
&gt; my comment &#34;net hints changes by themselves do not result in maximization
&gt; need explicit map/unmap&#34; might just not be valid anymore in 2013.
</div>
I think from my reading of net-wm spec that a client shouldn&#39;t change
_NET_WM_STATE after the window is managed, that the property belongs to
the wm then.  Which would explain your comment in the code, if that was
what you found didn&#39;t work.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It waits for ConfigureNotify
&gt; and then checks for _NET_WM_STATE. It needs ConfigureNotify _also_ because it wants to 
&gt; fire cmSize synchronously, if possible. 
</div>
Oh, I was thinking about waiting for _NET_WM_STATE.  Could wait for both
_NET_WM_STATE and ConfigureNotify.  It&#39;s probably unspecified which
comes first, though they&#39;d be very close together.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not sure if I understand difference between &#34;toggle&#34; and &#34;set to a particular state&#34;,
&gt; what do you mean by that? Only send NET_WM_STATE change without map/unmap? 
</div>
A ClientMessage can ask for &#34;ADD&#34;, &#34;REMOVE&#34; or &#34;TOGGLE&#34; of a state
&#40;or two states&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1291153" href="/Public/Bug/Display.html?id=90269#txn-1291153">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;22&nbsp;03:48:15&nbsp;2013</span>
    <span class="description">dmitry [...] karasik.eu.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Nov 2013 09:47:56 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kevin Ryde via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dmitry Karasik &lt;dmitry [...] karasik.eu.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1291153/684147/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684147">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; No, not even change message, just how it works without map/unmap. I suspect that
&gt; &gt; my comment &#34;net hints changes by themselves do not result in maximization
&gt; &gt; need explicit map/unmap&#34; might just not be valid anymore in 2013.
</div>&gt; 
&gt; I think from my reading of net-wm spec that a client shouldn&#39;t change
&gt; _NET_WM_STATE after the window is managed, that the property belongs to
&gt; the wm then.  Which would explain your comment in the code, if that was
&gt; what you found didn&#39;t work.
</div>
That very well might be true, thank you. And explain some mystic behaviors I observed.
Because I remember that I wrote direct hacking of _NET_WM_STATE when there were no wm spec yet
&#40;or I did bad job finding it&#41;, and the code that changes properties using XSentEvent came later;
but direct hacking wasn&#39;t removed. 

I think I&#39;ll try to remove it then and ask you to test of that works on fvwm.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I&#39;m not sure if I understand difference between &#34;toggle&#34; and &#34;set to a particular state&#34;,
&gt; &gt; what do you mean by that? Only send NET_WM_STATE change without map/unmap? 
</div>&gt; A ClientMessage can ask for &#34;ADD&#34;, &#34;REMOVE&#34; or &#34;TOGGLE&#34; of a state
&gt; &#40;or two states&#41;.
</div>
Ah no, there&#39;s no such thing, prima uses only ADD and REMOVE

-- 
Sincerely,
        Dmitry Karasik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1291163" href="/Public/Bug/Display.html?id=90269#txn-1291163">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;22&nbsp;03:53:19&nbsp;2013</span>
    <span class="description">KARASIK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1291163/684154/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684154">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 131b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Kevin

Here it is, can you please try it in your setups, and I&#39;ll try it under wms I can find. It works so far on metacity.

/dk
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1291163/684155/patch">Download patch</a><br />
<span class="downloadcontenttype">application/octet-stream 2.4k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1292587" href="/Public/Bug/Display.html?id=90269#txn-1292587">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;20:02:29&nbsp;2013</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90269] maximize by NET-WM message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 24 Nov 2013 11:58:24 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prima [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1292587/684845/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684845">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 484b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;KARASIK via RT&#34; &lt;bug-Prima@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Here it is, can you please try it in your setups, and I&#39;ll try it
&gt; under wms I can find. It works so far on metacity.
</div>
Looks good.

Works for fvwm, or rather it works but fvwm&#39;s non-compliance makes it do
the fallback the same.

Last time I tried metacity it wouldn&#39;t run without gnome, I&#39;ll have to
see what I broke.  I had a list of net/non-net wms somewhere ...



-- 
&#34;It&#39;s a long way to the shop if you want a sausage roll.&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1314746" href="/Public/Bug/Display.html?id=90269#txn-1314746">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;20&nbsp;04:35:15&nbsp;2014</span>
    <span class="description">KARASIK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1314746/696920/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/696920">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 227b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s at last I tested and committed the bigger patch that simplifies the logic, removes the hack with cmMinimize and hopefully works as intended. I&#39;d very much like to ask you to test it in your setup as well.

Thanks,
Dmitry
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1345637" href="/Public/Bug/Display.html?id=90269#txn-1345637">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;13:58:55&nbsp;2014</span>
    <span class="description">KARASIK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.914043</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
