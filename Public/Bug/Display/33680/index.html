<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33680 for Device-Jtag-PP: limitation in shiftdr function</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33680 for Device-Jtag-PP: limitation in shiftdr function</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Device-Jtag-PP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Device-Jtag-PP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Device-Jtag-PP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Device-Jtag-PP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Device-Jtag-PP">Device-Jtag-PP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33680</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Device-Jtag-PP/Active/">Device-Jtag-PP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sammy [...] nelsim.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-43742-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.02    </td>
  </tr>
  <tr id="CF-43743-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;28&nbsp;20:42:40&nbsp;2008</span>
    <span class="description">sammy [...] nelsim.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> limitation in shiftdr function</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was reading the source code because I&#39;m considering doing something
similar for a different hardware interface. It appears that the function
shiftdr will work reading a 32-bit register when that tap controller is
the last device in the chain. I&#39;d guess it also would work writing a
register if it is in the first tap controller of the chain. The author
has confirmed that a bug may exist here. He wrote:

Toby wrote:
I think you&#39;ve identified some bugs, or shortcomings, that happened to
work for my setup &#40;32 bit data register&#41; where the device I always read
from was last in the JTAG chain.  Please do file a bug report and I&#39;ll
work on it.  I&#39;m glad some one has found this useful.  You might also
check out the Device:JTAG:USB module as it got more of my attention and
might be further developed than the PP version.

I&#39;m still planning on doing something similar for different hardware. If
so, I&#39;ll be able to &#39;test&#39; a fix and post a patch. Currently I only have
an untested fix. The fix involves adding additional &#39;0&#39; bits to $data
&#40;lsb&#41; to compensate for bypassed taps before and after the desired
device. Also the last line of the routine would select the appropriate
bits and not always 32. The untested concept is shown below:

sub shiftdr {
  my $self    = shift;
  my $device  = shift;
  my $data    = shift;
  my $tdo     = undef;

  #print &#34;Sending data $data to device $device...\n&#34;;

  # assumes RTI is beginning state
  # Go to the SELECT-DR state
  set_tms&#40;$self,1&#41;;
  tog_tck&#40;$self,1&#41;;

  # Go to the SHIFT-DR state
  set_tms&#40;$self,0&#41;;
  tog_tck&#40;$self,2&#41;;

  # The first bit of data we want is now sitting on TDO of the selected
  # device.  If there are any devices in the chain after the selected
  # device, the data we want must get through the each subsequent
  # device&#39;s BYPASS register, which is 1 bit long.  This means that if
  # there are N devices in the chain after the selected device, and the
  # number of bits of data being shifted is M, the total number of shifts
  # must be N+M.  Additionally, the first N bits of data received on
  # TDO should be discarded.
  $tdo = get_tdo&#40;$self&#41;;

  # Find the number of devices on the scan chain
  my $numdev = scalar&#40;@{$self-&gt;{CHAIN}}&#41;;

  # compute how many extra leading bits may be required &#40;to get first
bit to the device and receive first bit from the device&#41;
  # this is dependent upon the number of tap controllers preceeding and
following the addressed tap controller
  my $dlen = length&#40;$data&#41;;
  my $max = $numdev - $device - 1;  # number of devices following
  if &#40;$max &lt; $device&#41; { $max = $device }
  $data = $data . &#39;0&#39; x $max;

  # Shift data, the rightmost bit goes first
  for &#40;$b=length&#40;$data&#41;-1;$b&gt;=0;$b--&#41; {
    set_tdi&#40;$self,substr&#40;$data,$b,1&#41;&#41;;
    my $tms = $b eq 0? 1 : 0;  #set TMS=1 on the last shift to go to the
EXIT1-IR state
    set_tms&#40;$self,$tms&#41;;
    tog_tck&#40;$self,1&#41;;
    $tdo = get_tdo&#40;$self&#41; . $tdo; # get tdo, build word from right to left
  }

  # Return to RTI state
  set_tms&#40;$self,1&#41;;
  tog_tck&#40;$self,1&#41;;

  set_tms&#40;$self,0&#41;;
  tog_tck&#40;$self,1&#41;;

  # Find the number of subsequent devices on the chain following the
selected device
  my $subdev = &#40;$numdev-1&#41;-$device;

  # Return tdo as hex string
  return convert_hex&#40;substr&#40;$tdo, -1*&#40;$dlen+$subdev&#41;, $dlen&#41;&#41;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;28&nbsp;21:10:30&nbsp;2008</span>
    <span class="description">tdeitrich [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tdeitrich [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks to Dave for finding this.

I think the best approach is to make use of the Bit:Vector module as I
did in the more stable module Device:JTAG:USB:FTCJTAG.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;28&nbsp;21:10:31&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
