<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63478 for Encoding-FixLatin: Feature suggestion: filter_null</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63478 for Encoding-FixLatin: Feature suggestion: filter_null</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Encoding-FixLatin/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Encoding-FixLatin/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Encoding-FixLatin/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Encoding-FixLatin/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Encoding-FixLatin">Encoding-FixLatin CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63478</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Encoding-FixLatin/Active/">Encoding-FixLatin</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
JNW [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-226800-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.02    </td>
  </tr>
  <tr id="CF-226801-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;17:11:06&nbsp;2010</span>
    <span class="description">JNW [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Feature suggestion: filter_null</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve added a --filter-null option, to help with 16-bit encodings, where
every second byte is a \0 character most of the time.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fixlatin_nonnull.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Encoding-FixLatin-1.02/lib/Encoding/FixLatin.pm.orig	2010-05-01 04:04:05.000000000 +0200
+++ Encoding-FixLatin-1.02/lib/Encoding/FixLatin.pm	2010-11-30 23:04:57.000000000 +0100
@@ -5,7 +5,7 @@ use strict;
 
 require 5.008;
 
-our $VERSION = &#39;1.02&#39;;
+our $VERSION = &#39;1.021&#39;;
 
 use Carp     qw&#40;croak&#41;;
 use Exporter qw&#40;import&#41;;
@@ -17,6 +17,8 @@ our @EXPORT_OK = qw&#40;fix_latin&#41;;
 my $byte_map;
 
 my $ascii_str = qr{\A&#40;[\x00-\x7F]+&#41;&#40;.*&#41;\z}s;
+my $ascii_str_nonnull = qr{\A&#40;[\x01-\x7F]+&#41;&#40;.*&#41;\z}s;
+my $ascii_str_print   = qr{\A&#40;[\t\r\n\x20-\x7E]+&#41;&#40;.*&#41;\z}s;
 
 my $cont_byte = &#39;[\x80-\xBF]&#39;;
 my $utf8_2    = qr{\A&#40;[\xC0-\xDF]&#41;&#40;$cont_byte&#41;&#40;.*&#41;\z}s;
@@ -24,7 +26,7 @@ my $utf8_3    = qr{\A&#40;[\xE0-\xEF]&#41;&#40;$cont
 my $utf8_4    = qr{\A&#40;[\xF0-\xF7]&#41;&#40;$cont_byte&#41;&#40;$cont_byte&#41;&#40;$cont_byte&#41;&#40;.*&#41;\z}s;
 my $utf8_5    = qr{\A&#40;[\xF8-\xFB]&#41;&#40;$cont_byte&#41;&#40;$cont_byte&#41;&#40;$cont_byte&#41;&#40;$cont_byte&#41;&#40;.*&#41;\z}s;
 
-my %known_opt = map { $_ =&gt; 1 } qw&#40;bytes_only ascii_hex overlong_fatal&#41;;
+my %known_opt = map { $_ =&gt; 1 } qw&#40;bytes_only ascii_hex overlong_fatal filter_nonprint filter_null&#41;;
 
 my %non_1252  = &#40;
     &#34;\x81&#34; =&gt; &#39;%81&#39;,
@@ -40,6 +42,8 @@ sub fix_latin {
         ascii_hex      =&gt; 1,
         bytes_only     =&gt; 0,
         overlong_fatal =&gt; 0,
+        filter_nonprint =&gt; 0,
+        filter_null =&gt; 0,
         @_
     &#41;;
 
@@ -49,6 +53,9 @@ sub fix_latin {
 
     return unless defined&#40;$input&#41;;
     _init_byte_map&#40;\%opt&#41; unless $byte_map;
+    $byte_map-&gt;{pack&#40;&#39;C&#39;, 0&#41;} = &#39;&#39; if $opt{filter_null};
+    $ascii_str = $ascii_str_nonnull if $opt{filter_null};
+    $ascii_str = $ascii_str_print   if $opt{filter_nonprint};
 
     if&#40;is_utf8&#40;$input&#41;&#41; {       # input string already has utf8 flag set
         if&#40;$opt{bytes_only}&#41; {
@@ -305,6 +312,15 @@ use eval to trap and handle this scenari
 There is a strong argument that overlong sequences are only ever encountered
 in malicious input and therefore they should always be rejected.
 
+=item filter_null =&gt; 1/0
+
+This option removes any occurance of the binary NUL character &#40;&#34;\0&#34;&#41; from the file.
+This helps making files readable that use a fixed width 16-bit encoding like UCS-2.
+Default is 0, which retains NUL characters.
+
+Please note, that data corruption is to be expected, if an UCS-2 encoded input
+actually uses codepoints above decimal 255, regardless how this option is set.
+
 =back
 
 =head1 LIMITATIONS OF THIS MODULE
--- Encoding-FixLatin-1.02/script/fix_latin.orig	2010-04-30 12:22:53.000000000 +0200
+++ Encoding-FixLatin-1.02/script/fix_latin	2010-11-30 22:55:53.000000000 +0100
@@ -24,14 +24,15 @@ use Encoding::FixLatin qw&#40;fix_latin&#41;;
 
 my %opt;
 
-if&#40;!GetOptions&#40;\%opt, &#39;help|?&#39;&#41;&#41; {
+if&#40;!GetOptions&#40;\%opt, &#39;help|?&#39;, &#39;filter_null|0&#39;&#41;&#41; {
     pod2usage&#40;-exitval =&gt; 1,  -verbose =&gt; 0&#41;;
 }
+my $always = defined&#40;$opt{filter_null}&#41;;
 
 pod2usage&#40;-exitstatus =&gt; 0, -verbose =&gt; 2&#41; if&#40;$opt{&#39;help&#39;}&#41;;
 
 while&#40;&lt;&gt;&#41; {
-    $_ = fix_latin&#40;$_, bytes_only =&gt; 1&#41; if /[^\x00-\x7f]/;
+    $_ = fix_latin&#40;$_, bytes_only =&gt; 1, %opt&#41; if $always or /[^\x00-\x7f]/;
     print;
 }
 
@@ -52,6 +53,8 @@ latin &#40;ie: non-ASCII 8 bit&#41; characters
 
    -?     detailed help message
 
+   -0     strip NUL bytes
+
 =head1 DESCRIPTION
 
 The script acts as a filter, taking source data which may contain a mix of
@@ -62,7 +65,7 @@ Multi-byte UTF8 characters will be passe
 UTF8 byte sequences will be converted to the shortest normal form&#41;.  Single
 byte characters will be converted as follows:
 
-  0x00 - 0x7F   ASCII - passed through unchanged
+  0x00 - 0x7F   ASCII - passed through unchanged &#40;0x01-0x7F under option -0&#41;
   0x80 - 0x9F   Converted to UTF8 using CP1252 mappings
   0xA0 - 0xFF   Converted to UTF8 using Latin-1 mappings
 
@@ -74,6 +77,14 @@ byte characters will be converted as fol
 
 Display this documentation.
 
+=item B&lt;-0&gt;
+
+=item B&lt;--filter-null&gt;
+
+Strip binary NUL characters &#40;&#39;\0&#39;&#41; from the file. This helps making UCS-2 files readable.
+Note that with or without -0, data corruption is to be expected if your UCS-2
+file uses codepoints above 255.
+
 =back
 
 =head1 EXAMPLES
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;17:11:19&nbsp;2010</span>
    <span class="description">JNW [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;17:38:31&nbsp;2010</span>
    <span class="description">grantm [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jurgen

Thanks for your suggestion and patch - however I&#39;ve decided not to
integrate it into Encoding::FixLatin.

The Encoding::FixLatin module exists because I&#39;ve encountered numerous
files that mix multiple encodings from the ASCII, UTF8 and Latin-1
variants.  I haven&#39;t encountered UTF-16 variants mixed in the same way
and the potential for data corruption is higher than I want to take on.

For use cases where a 16 bit encoding is used but not mixed with other
encodings then Perl IO layers or iconv can be used without the risk of
data corruption.

In the case where people want to use fix_latin and drop null bytes in
the manner you suggest, they can simply use &#39;tr&#39; or a Perl one-liner in
their processing pipeline.

Thanks again
Grant
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;17:38:31&nbsp;2010</span>
    <span class="description">grantm [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;08:23:03&nbsp;2010</span>
    <span class="description">jw [...] suse.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> JNW [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63478] Feature suggestion: filter_null</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Dec 2010 14:22:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Grant McLean via RT &lt;bug-Encoding-FixLatin [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Juergen Weigert &lt;jw [...] suse.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Nov 30, 10 17:38:31 -0500, Grant McLean via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63478">https://rt.cpan.org/Ticket/Display.html?id=63478</a></span> &gt;
&gt; 
&gt; Hi Jurgen
&gt; 
&gt; Thanks for your suggestion and patch - however I&#39;ve decided not to
&gt; integrate it into Encoding::FixLatin.
&gt; 
&gt; The Encoding::FixLatin module exists because I&#39;ve encountered numerous
&gt; files that mix multiple encodings from the ASCII, UTF8 and Latin-1
&gt; variants.  I haven&#39;t encountered UTF-16 variants mixed in the same way
&gt; and the potential for data corruption is higher than I want to take on.
</div>
Okay. Valid point.
My usecase is one, where that kind of data corruption would be irrelevant.

        cheers,
                JW-

-- 
 o \  Juergen Weigert  paint it green!    __/ _=======.=======_
&lt;V&gt; | jw@suse.de       back to ascii!  __/        _---|____________\/
 \  | 0911 74053-508                __/          &#40;____/            /\
&#40;/&#41; | _____________________________/              _/ \_ vim:set sw=2 wm=8
SUSE LINUX Products GmbH, GF: Markus Rex, HRB 16746 &#40;AG Nuernberg&#41;

SuSE. Supporting Linux since 1992.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;08:23:03&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;15:09:04&nbsp;2010</span>
    <span class="description">grantm [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
