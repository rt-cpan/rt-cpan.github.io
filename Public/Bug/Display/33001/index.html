<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33001 for XML-RSS: does not implement RSS 2.0 guid isPermaLink properly; hides guids</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33001 for XML-RSS: does not implement RSS 2.0 guid isPermaLink properly; hides guids</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-RSS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-RSS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-RSS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-RSS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-RSS">XML-RSS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33001</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">30 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-RSS/Active/">XML-RSS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">SHLOMIF [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
GWOLF [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
463774 [...] bugs.debian.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-37498-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.30</li>
<li>
1.31</li>
</ul>
    </td>
  </tr>
  <tr id="CF-37499-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;07&nbsp;19:12:09&nbsp;2008</span>
    <span class="description">GWOLF [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> 463774 [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> does not implement RSS 2.0 guid isPermaLink properly; hides guids</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;m copying over this bug report we received in the Debian bug tracker:

<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=463774">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=463774</a></span>

This bug seems to have first appeared in version 1.30.

Consider a feed such as the music I listen to:
<span class="clickylink"><a target="new" rel="nofollow" href="http://ws.audioscrobbler.com/1.0/user/joeyhess/recenttracks.rss">http://ws.audioscrobbler.com/1.0/user/joeyhess/recenttracks.rss</a></span>

      &lt;item&gt;
         &lt;title&gt;Foo Fighters â€“ Come Alive&lt;/title&gt;
         &lt;link&gt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.last.fm/music/Foo+Fighters/_/Come+Alive">http://www.last.fm/music/Foo+Fighters/_/Come+Alive</a></span>&lt;/link&gt;
         &lt;pubDate&gt;Sun, 27 Jan 2008 05:07:00 +0000&lt;/pubDate&gt;
         &lt;guid&gt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.last.fm/user/joeyhess/#1201410420">http://www.last.fm/user/joeyhess/#1201410420</a></span>&lt;/guid&gt;
                
&lt;description&gt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.last.fm/music/Foo+Fighters">http://www.last.fm/music/Foo+Fighters</a></span>&lt;/description&gt;
      &lt;/item&gt;

If I parse this using XML::RSS, this happens:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.last.fm/music/Foo+Fighters/_/Come+Alive">http://www.last.fm/music/Foo+Fighters/_/Come+Alive</a></span>
joey@kodama:~&gt;perl -le &#39;use XML::RSS; local $/=undef; $feed=&lt;&gt;;
        $r=XML::RSS-&gt;new&#40;version =&gt; &#34;1.0&#34;&#41;; $r-&gt;parse&#40;$feed&#41;;
        print &#34;link: &#34;.$r-&gt;{items}-&gt;[0]-&gt;{link};
        print &#34;guid: &#34;.$r-&gt;{items}-&gt;[0]-&gt;{guid}&#39; &lt; recenttracks.rss
link: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.last.fm/music/Foo+Fighters/_/Come+Alive">http://www.last.fm/music/Foo+Fighters/_/Come+Alive</a></span>
guid: 

In this feed, the link links to the song. Which I might play multiple
times. Thus the guid, which differs for each play. Since I get back the
same link each time, and can&#39;t look at the guid, there&#39;s no way to
distinguish one play of the song from another.

Here&#39;s the culprit:

        # guid element is a permanent link unless isPermaLink attribute
        # is set to false
    }
    elsif &#40;$el eq &#39;guid&#39;&#41; {
        $self-&gt;{&#39;items&#39;}-&gt;[$self-&gt;{num_items} - 1]-&gt;{&#39;isPermaLink&#39;} =
          !&#40;exists&#40;$attribs{&#39;isPermaLink&#39;}&#41; &#38;&#38; &#40;$attribs{&#39;isPermaLink&#39;}
eq &#39;false&#39;&#41;&#41;;

        # beginning of taxo li element in item element
        #&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://purl.org/rss/1.0/modules/taxonomy/&#39;">http://purl.org/rss/1.0/modules/taxonomy/&#39;</a></span> =&gt; &#39;taxo&#39;
    }

This is just wrong. The RSS 2.0 spec says:

    If the guid element has an attribute named &#34;isPermaLink&#34; with a value of
    true, the reader may assume that it is a permalink to the item

The above code is exactly backwards to the spec, assuming that the guid
is a permalink unless isPermaLink=false. The guid doesn&#39;t even have to
be an url according to the spec, so this is very wrong. It can be fixed
as follows. &#40;I threw in an lc too, because attributes should &#40;probably&#41;
be parsed case-insensatively.&#41; Note that I had to patch the test suite,
since this does change behavior -- the test suite was testing for the
same incorrect reading of the spec.

Index: t/2.0-permalink.t
===================================================================
--- t/2.0-permalink.t   &#40;revision 13998&#41;
+++ t/2.0-permalink.t   &#40;working copy&#41;
@@ -21,9 +21,8 @@
 &#41;;
 
 # TEST
-is &#40;$item_with_guid_missing-&gt;{&#34;permaLink&#34;}, 
-    &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://community.livejournal.com/lj_dev/713810.html">http://community.livejournal.com/lj_dev/713810.html</a></span>&#34;,
-    &#34;guid&#39;s isPermaLink is missing, so the item permalink property
should be set to the value of the guid tag&#34;
+ok &#40;&#40;!$item_with_guid_missing-&gt;{&#34;permaLink&#34;}&#41;,
+    &#34;guid&#39;s isPermaLink is missing &#40;implicitly false&#41;, so the item
permalink property should not be set&#34;
 &#41;;
 
 # TEST
Index: lib/XML/RSS.pm
===================================================================
--- lib/XML/RSS.pm      &#40;revision 13998&#41;
+++ lib/XML/RSS.pm      &#40;working copy&#41;
@@ -786,11 +786,12 @@
             }
         }
 
-        # guid element is a permanent link unless isPermaLink attribute
is set to false
+        # guid element is a permanent link IFF isPermaLink attribute is set
+        # to true
     }
     elsif &#40;$el eq &#39;guid&#39;&#41; {
         $self-&gt;{&#39;items&#39;}-&gt;[$self-&gt;{num_items} - 1]-&gt;{&#39;isPermaLink&#39;} =
-          !&#40;exists&#40;$attribs{&#39;isPermaLink&#39;}&#41; &#38;&#38; &#40;$attribs{&#39;isPermaLink&#39;}
eq &#39;false&#39;&#41;&#41;;
+           &#40;exists&#40;$attribs{&#39;isPermaLink&#39;}&#41; &#38;&#38;
&#40;lc&#40;$attribs{&#39;isPermaLink&#39;}&#41; eq &#39;true&#39;&#41;&#41;;
 
         # beginning of taxo li element in item element
         #&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://purl.org/rss/1.0/modules/taxonomy/&#39;">http://purl.org/rss/1.0/modules/taxonomy/&#39;</a></span> =&gt; &#39;taxo&#39;

-- System Information:
Debian Release: lenny/sid
  APT prefers unstable
  APT policy: &#40;500, &#39;unstable&#39;&#41;, &#40;500, &#39;testing&#39;&#41;, &#40;500, &#39;stable&#39;&#41;, &#40;1,
&#39;experimental&#39;&#41;
Architecture: i386 &#40;i686&#41;

Kernel: Linux 2.6.24-1-686 &#40;SMP w/1 CPU core&#41;
Locale: LANG=en_US.UTF-8, LC_CTYPE=en_US.UTF-8 &#40;charmap=UTF-8&#41;
Shell: /bin/sh linked to /bin/bash

Versions of packages libxml-feed-perl depends on:
ii  libclass-errorhandler-perl 0.01-2        Base class for error handling
ii  libdatetime-format-mail-pe 0.3001-1      Convert between DateTime
and RFC28
ii  libdatetime-format-w3cdtf- 0.04-2        Parse and format W3CDTF
datetime s
ii  libdatetime-perl           2:0.41-1      perl DateTime - Reference
implemen
ii  libfeed-find-perl          0.06-2        Syndication feed auto-discovery
ii  libhtml-parser-perl        3.56-1        A collection of modules
that parse
ii  liburi-fetch-perl          0.08-1        Smart URI fetching/caching
ii  liburi-perl                1.35.dfsg.1-1 Manipulates and accesses
URI strin
ii  libwww-perl                5.808-1       WWW client/server library
for Perl
ii  libxml-atom-perl           0.25-2        Atom feed and API
implementation
ii  libxml-rss-perl            1.31-3        Perl module for managing
RSS &#40;RDF 
ii  perl                       5.8.8-12      Larry Wall&#39;s Practical
Extraction 

libxml-feed-perl recommends no packages.

-- no debconf information

-- 
see shy jo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;08&nbsp;03:43:57&nbsp;2008</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">30 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the bug report and the patch. This is fixed in trunk 
&#40;r10702&#41; and I will upload an XML-RSS-1.32 to the CPAN shortly.

Thanks again.

Regards,

        Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;08&nbsp;03:43:59&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;08&nbsp;03:44:00&nbsp;2008</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;08&nbsp;03:44:01&nbsp;2008</span>
    <span class="description">SHLOMIF [...] cpan.org -  Given to SHLOMIF</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
