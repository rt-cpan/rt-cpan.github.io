<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75673 for Test-Smoke: [PATCH] Support sendEmail to make it easier emailing from Win32</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75673 for Test-Smoke: [PATCH] Support sendEmail to make it easier emailing from Win32</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Smoke">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Smoke">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Smoke">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Smoke">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Smoke">Test-Smoke CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75673</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Smoke">Test-Smoke</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
shay [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-31598-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.44    </td>
  </tr>
  <tr id="CF-31599-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.46    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




sendemail.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1048515/548035/sendemail.patch">
Sat Mar 10 11:52:29 2012 (8.1k) by shay [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=75673">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1048515" href="/Public/Bug/Display.html?id=75673#txn-1048515">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;10&nbsp;11:52:29&nbsp;2012</span>
    <span class="description">shay [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Support sendEmail to make it easier emailing from Win32</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1048515/548034/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/548034">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m trying to set up my personal &#40;Windows&#41; PC to run Test-Smoke and I
find that it fails at the last hurdle: it is unable to email the final
smoke report.

Windows doesn&#39;t have sendmail, mail or mailx, or even an SMTP server by
default any more &#40;I&#39;m running Windows 7 Home Premium; I think there are
options for installing an SMTP server on higher-spec versions of Windows
7, and on older Windows OSes, but that doesn&#39;t help me&#41;.

I considered installing the non-standard hMailServer suggested here:
<span class="clickylink"><a target="new" rel="nofollow" href="http://social.technet.microsoft.com/forums/en-us/w7itproinstall/thread/7CEF5DA9-5B31-4B98-9BD9-9F7777DD7B37">http://social.technet.microsoft.com/forums/en-us/w7itproinstall/thread/7CEF5DA9-5B31-4B98-9BD9-9F7777DD7B37</a></span>
but I think a simpler option would be to just use smtp.gmail.com :-&#41;

Unfortunately, the bundled Mail::Sendmail won&#39;t work with that as-is
because Gmail requires an SSL/TLS connection &#40;see
<span class="clickylink"><a target="new" rel="nofollow" href="http://support.google.com/mail/bin/answer.py?hl=en&#38;answer=13287&#41;">http://support.google.com/mail/bin/answer.py?hl=en&#38;answer=13287&#41;</a></span>, and
there is no IO::Socket::SSL bundled with Test-Smoke. The popular Windows
command-line program called &#34;Blat&#34; has the same problem, so supporting
that in Test-Smoke wouldn&#39;t help either.

A solution to that is to have stunnel running, providing a secure
connection to programs without it. I did get that running, but I&#39;ve
finally found a simpler solution still: there is another Windows
command-line program called &#34;sendEmail&#34; &#40;actually written in perl,
compiled into an executable, but with the source code available too&#41;
which works very much like Blat but *does* support SSL/TLS and hence
works out of the box with Gmail. The download page for sendEmail is
here: <span class="clickylink"><a target="new" rel="nofollow" href="http://caspian.dotconf.net/menu/Software/SendEmail/">http://caspian.dotconf.net/menu/Software/SendEmail/</a></span>

The attached patch against Test-Smoke-1.44 adds support for this
sendEmail program, thus providing an easy option for Windows users,
without the hassle of setting up an SMTP server or building
IO::Socket::SSL or configuring stunnel.

Note that the configsmoke.pl script requests a username and password
with which to connect to the specified SMTP server when using sendEmail.
The password, if supplied, will be stored in plaintext format in the
_config file, which is not ideal. However, you can choose to leave it
empty, in which case the sendEmail program will prompt for the password
at the point of sending the email, thus avoiding the need to store the
password at all.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> sendemail.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1048515/548035/sendemail.patch">Download sendemail.patch</a><br />
<span class="downloadcontenttype">text/x-diff 8.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ruN Test-Smoke-1.44.orig\configsmoke.pl Test-Smoke-1.44\configsmoke.pl
--- Test-Smoke-1.44.orig\configsmoke.pl	Fri Aug 27 19:09:28 2010
+++ Test-Smoke-1.44\configsmoke.pl	Sat Mar 10 16:15:29 2012
@@ -526,6 +526,17 @@
         alt =&gt; [ ],
         dft =&gt; &#39;localhost&#39;,
     },
+    muser =&gt; {
+        msg =&gt; &#39;Which username should be used for the SMTP server?&#39;,
+        alt =&gt; [ ],
+        dft =&gt; &#39;&#39;,
+    },
+    mpass =&gt; {
+        msg =&gt; &#39;Which password should be used for the SMTP server?&#39; .
+               &#34;\nLeave empty to be prompted when sending email&#34;,
+        alt =&gt; [ ],
+        dft =&gt; &#39;&#39;,
+    },
 
     to =&gt; {
        msg =&gt; &lt;&lt;EOMSG,
@@ -1224,6 +1235,20 @@
             $config{ $arg } = prompt&#40; $arg &#41;;
 	};
 
+        /^sendemail$/       &#38;&#38; do {
+            $arg = &#39;from&#39;;
+            $config{ $arg } = prompt&#40; $arg &#41;;
+
+            $arg = &#39;mserver&#39;;
+            $config{ $arg } = prompt&#40; $arg &#41;;
+
+            $arg = &#39;muser&#39;;
+            $config{ $arg } = prompt&#40; $arg &#41;;
+
+            $arg = &#39;mpass&#39;;
+            $config{ $arg } = prompt&#40; $arg &#41;;
+	};
+
         /^&#40;?:Mail::Sendmail|MIME::Lite&#41;$/ &#38;&#38; do {
             $arg = &#39;from&#39;;
             $opt{ $arg }{chk} = &#39;\S+&#39;;
@@ -1677,7 +1702,7 @@
         qw&#40; force_c_locale locale defaultenv &#41;,
 
         # Report related
-        qw&#40; mail mail_type mserver from to ccp5p_onfail
+        qw&#40; mail mail_type mserver muser mpass from to ccp5p_onfail
             swcc cc swbcc bcc &#41;,
 
         # Archive reports and logfile
@@ -2171,6 +2196,8 @@
         local $ENV{PATH} = &#34;$ENV{PATH}$Config{path_sep}/usr/sbin&#34;;
         $map{ $mailer } = whereis&#40; $mailer &#41;;
     }
+    $mailer = &#39;sendemail&#39;;
+    $map{ $mailer } = whereis&#40; $mailer &#41;;
 
     eval { require Mail::Sendmail };
     $map{ &#39;Mail::Sendmail&#39; } = $@ ? &#39;&#39; : &#39;Mail::Sendmail&#39;;
diff -ruN Test-Smoke-1.44.orig\lib\Test\Smoke\Mailer.pm Test-Smoke-1.44\lib\Test\Smoke\Mailer.pm
--- Test-Smoke-1.44.orig\lib\Test\Smoke\Mailer.pm	Fri Aug 27 19:09:28 2010
+++ Test-Smoke-1.44\lib\Test\Smoke\Mailer.pm	Sat Mar 10 16:12:50 2012
@@ -27,12 +27,14 @@
     mail             =&gt; [qw&#40; bcc cc mailbin &#41;],
     df_mailxbin      =&gt; &#39;mailx&#39;,
     mailx            =&gt; [qw&#40; bcc cc mailxbin swcc swbcc &#41;],
+    df_sendemailbin  =&gt; &#39;sendemail&#39;,
+    sendemail        =&gt; [qw&#40; from bcc cc sendemailbin mserver muser mpass &#41;],
     df_sendmailbin   =&gt; &#39;sendmail&#39;,
     sendmail         =&gt; [qw&#40; from bcc cc sendmailbin &#41;],
     &#39;Mail::Sendmail&#39; =&gt; [qw&#40; from bcc cc mserver &#41;],
     &#39;MIME::Lite&#39;     =&gt; [qw&#40; from bcc cc mserver &#41;],
 
-    valid_mailer =&gt; { sendmail =&gt; 1, mail =&gt; 1, mailx =&gt; 1,
+    valid_mailer =&gt; { sendmail =&gt; 1, mail =&gt; 1, mailx =&gt; 1, sendemail =&gt; 1,
                       &#39;Mail::Sendmail&#39; =&gt; 1, &#39;MIME::Lite&#39; =&gt; 1, },
 &#41;;
 
@@ -51,7 +53,7 @@
 
 =head1 DESCRIPTION
 
-This little wrapper still allows you to use the B&lt;sendmail&gt;, 
+This little wrapper still allows you to use the B&lt;sendmail&gt;, B&lt;sendemail&gt;,
 B&lt;mail&gt; or B&lt;mailx&gt; programs, but prefers to use the B&lt;Mail::Sendmail&gt;
 module &#40;which comes with this distribution&#41; to send the reports.
 
@@ -63,7 +65,7 @@
 
 Can we provide sensible defaults for the mail stuff?
 
-    mhowto  =&gt; [Module::Name|sendmail|mail|mailx]
+    mhowto  =&gt; [Module::Name|sendmail|mail|mailx|sendemail]
     mserver =&gt; an SMTP server || localhost
     mbin    =&gt; the full path to the mail binary
     mto     =&gt; list of addresses &#40;comma separated!&#41;
@@ -101,6 +103,7 @@
 
         /^sendmail$/  &#38;&#38; return Test::Smoke::Mailer::Sendmail-&gt;new&#40; %fields &#41;;
         /^mailx?$/ &#38;&#38; return Test::Smoke::Mailer::Mail_X-&gt;new&#40; %fields &#41;;
+        /^sendemail?$/ &#38;&#38; return Test::Smoke::Mailer::SendEmail-&gt;new&#40; %fields &#41;;
         /^Mail::Sendmail$/ &#38;&#38; 
             return Test::Smoke::Mailer::Mail_Sendmail-&gt;new&#40; %fields &#41;;
         /^MIME::Lite$/ &#38;&#38; 
@@ -119,15 +122,15 @@
 sub fetch_report {
     my $self = shift;
 
-    my $report_file = File::Spec-&gt;catfile&#40; $self-&gt;{ddir}, $self-&gt;{rptfile} &#41;;
+    $self-&gt;{file} = File::Spec-&gt;catfile&#40; $self-&gt;{ddir}, $self-&gt;{rptfile} &#41;;
 
     local *REPORT;
-    if &#40; open REPORT, &#34;&lt; $report_file&#34; &#41; {
+    if &#40; open REPORT, &#34;&lt; $self-&gt;{file}&#34; &#41; {
         $self-&gt;{body} = do { local $/; &lt;REPORT&gt; };
         close REPORT;
     } else {
         require Carp;
-        Carp::croak&#40; &#34;Cannot read &#39;$report_file&#39;: $!&#34; &#41;;
+        Carp::croak&#40; &#34;Cannot read &#39;$self-&gt;{file}&#39;: $!&#34; &#41;;
     }
 
     my @config = parse_report_Config&#40; $self-&gt;{body} &#41;;
@@ -336,6 +339,80 @@
             $self-&gt;{error} = &#34;Error in pipe to &#39;$mailer&#39;: $! &#40;&#34; . $?&gt;&gt;8 . &#34;&#41;&#34;;
     } else {
 	$self-&gt;{error} = &#34;Cannot fork &#39;$mailer&#39;: $!&#34;;
+    }
+    $self-&gt;{v} and print $self-&gt;{error} ? &#34;not OK\n&#34; : &#34;OK\n&#34;;
+
+    return ! $self-&gt;{error};
+}
+
+=back
+
+=head1 Test::Smoke::Mailer::SendEmail
+
+This handles sending the message with the B&lt;sendEmail&gt; program.
+
+=over 4
+
+=cut
+
+package Test::Smoke::Mailer::SendEmail;
+
+@Test::Smoke::Mailer::SendEmail::ISA = qw&#40; Test::Smoke::Mailer &#41;;
+
+=item Test::Smoke::Mailer::SendEmail-&gt;new&#40; %args &#41;
+
+Keys for C&lt;%args&gt;:
+
+  * ddir
+  * mserver
+  * muser
+  * mpass
+  * sendemailbin
+  * to
+  * from
+  * cc
+  * v
+
+=cut
+
+sub new {
+    my $proto = shift;
+    my $class = ref $proto || $proto;
+
+    return bless { @_ }, $class;
+}
+
+=item $mailer-&gt;mail&#40; &#41;
+
+C&lt;mail&#40;&#41;&gt; sets up the commandline and body and passes it to the 
+B&lt;sendemail&gt; program.
+
+=cut
+
+sub mail {
+    my $self = shift;
+
+    my $mailer = $self-&gt;{sendemailbin};
+
+    my $subject = $self-&gt;fetch_report&#40;&#41;;
+    my $cc = $self-&gt;_get_cc&#40; $subject &#41;;
+
+    my $cmdline = qq|$mailer -u &#34;$subject&#34;|;
+    $self-&gt;{swcc}  ||= &#39;-cc&#39;,  $cmdline   .= qq| $self-&gt;{swcc} &#34;$cc&#34;| if $cc;
+    $self-&gt;{swbcc} ||= &#39;-bcc&#39;, $cmdline   .= qq| $self-&gt;{swbcc} &#34;$self-&gt;{bcc}&#34;|
+        if $self-&gt;{bcc};
+    $cmdline   .= qq| -t &#34;$self-&gt;{to}&#34;|;
+    $cmdline   .= qq| -f &#34;$self-&gt;{from}&#34;| if $self-&gt;{from};
+    $cmdline   .= qq| -s &#34;$self-&gt;{mserver}&#34;| if $self-&gt;{mserver};
+    $cmdline   .= qq| -xu &#34;$self-&gt;{muser}&#34;| if $self-&gt;{muser};
+    $cmdline   .= qq| -xp &#34;$self-&gt;{mpass}&#34;| if &#40;$self-&gt;{mpass}&#41;;
+    $cmdline   .= qq| -o message-file=&#34;$self-&gt;{file}&#34;|;
+
+    $self-&gt;{v} &gt; 1 and print &#34;[$cmdline]\n&#34;;
+    $self-&gt;{v} and print &#34;Sending report to $self-&gt;{to}\n&#34;;
+    system $cmdline;
+    if &#40;$?&#41; {
+        $self-&gt;{error} = &#34;Error executing &#39;$mailer&#39;: &#34; . $?&gt;&gt;8;
     }
     $self-&gt;{v} and print $self-&gt;{error} ? &#34;not OK\n&#34; : &#34;OK\n&#34;;
 
diff -ruN Test-Smoke-1.44.orig\mailrpt.pl Test-Smoke-1.44\mailrpt.pl
--- Test-Smoke-1.44.orig\mailrpt.pl	Fri Aug 27 19:09:28 2010
+++ Test-Smoke-1.44\mailrpt.pl	Sat Mar 10 15:47:20 2012
@@ -29,6 +29,8 @@
     ccp5p_onfail =&gt; undef,
     from         =&gt; undef,
     mserver      =&gt; undef,
+    muser        =&gt; undef,
+    mpass        =&gt; undef,
     v            =&gt; undef,
 
     rptfile      =&gt; &#39;mktest.rpt&#39;,
@@ -42,7 +44,7 @@
 
 my $defaults = Test::Smoke::Mailer-&gt;config&#40; &#39;all_defaults&#39; &#41;;
 
-my %valid_type = map { $_ =&gt; 1 } qw&#40; mail mailx sendmail 
+my %valid_type = map { $_ =&gt; 1 } qw&#40; mail mailx sendmail sendemail
                                      Mail::Sendmail MIME::Lite &#41;;
 
 =head1 NAME
@@ -76,7 +78,8 @@
     --to &lt;emailaddresses&gt;    Comma separated list &#40;smokers-reports@perl.org&#41;
     --cc &lt;emailaddresses&gt;    Comma separated list
 
-    -t | --type &lt;type&gt;       mail mailx sendmail Mail::Sendmail [mandatory]
+    -t | --type &lt;type&gt;       mail mailx sendmail sendemail Mail::Sendmail
+                             [mandatory]
 
     --nomail                 Don&#39;t send the message
     --report                 Create a report anyway
@@ -96,6 +99,13 @@
 
     --from &lt;address&gt;
 
+=item * B&lt;options for&gt; -t sendemail
+
+    --from &lt;address&gt;
+    --mserver &lt;smtpserver&gt;  &#40;localhost&#41;
+    --muser &lt;smtpserverusername&gt;
+    --mpass &lt;smtpserverpassword&gt;
+
 =item * B&lt;options for&gt; -t Mail::Sendmail | MIME::Lite
 
     --from &lt;address&gt;
@@ -114,7 +124,7 @@
     &#39;type|t=s&#39;, &#39;ddir|d=s&#39;, &#39;to=s&#39;, &#39;cc=s&#39;, &#39;bcc=s&#39;, &#39;ccp5p_onfail!&#39;,
     &#39;v|verbose=i&#39;,
 
-    &#39;from=s&#39;, &#39;mserver=s&#39;,
+    &#39;from=s&#39;, &#39;mserver=s&#39;, &#39;muser=s&#39;, &#39;mpass=s&#39;,
 
     &#39;help|h&#39;, &#39;man&#39;,
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1051184" href="/Public/Bug/Display.html?id=75673#txn-1051184">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;16&nbsp;20:37:09&nbsp;2012</span>
    <span class="description">abeltje [...] cpan.org -  Fixed in 1.46 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1051185" href="/Public/Bug/Display.html?id=75673#txn-1051185">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;16&nbsp;20:37:09&nbsp;2012</span>
    <span class="description">abeltje [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1051185/549629/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/549629">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 20b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Integrated.

-- Abe.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1051187" href="/Public/Bug/Display.html?id=75673#txn-1051187">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;16&nbsp;20:37:10&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1051188" href="/Public/Bug/Display.html?id=75673#txn-1051188">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;16&nbsp;20:37:10&nbsp;2012</span>
    <span class="description">abeltje [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.398839</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
