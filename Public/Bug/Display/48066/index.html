<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #48066 for Socket-Class: very easy to DOS server, needs a server version of starttls&#40;&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #48066 for Socket-Class: very easy to DOS server, needs a server version of starttls&#40;&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Socket-Class">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Socket-Class">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Socket-Class">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Socket-Class">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Socket-Class">Socket-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">48066</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Socket-Class">Socket-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dmuey [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45020-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45021-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dos_test.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636650/324567/dos_test.pl">
Wed Jul 22 16:10:31 2009 (522b) by dmuey [...] cpan.org
</a>
</font></li>
</ul>


dos_test.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636546/324508/dos_test.zip">
Wed Jul 22 13:09:33 2009 (6.7k) by christian [...] hbr1.com
</a>
</font></li>
</ul>


dosable_socket_class_ssl.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636650/324561/dosable_socket_class_ssl.pl">
Wed Jul 22 16:10:31 2009 (2.9k) by dmuey [...] cpan.org
</a>
</font></li>
</ul>


dost_test.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636132/324315/dost_test.zip">
Tue Jul 21 20:54:49 2009 (6.7k) by christian [...] hbr1.com
</a>
</font></li>
</ul>


simple_socket_class_ssl.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/638539/325660/simple_socket_class_ssl.pl">
Sat Jul 25 20:34:33 2009 (3.1k) by christian [...] hbr1.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/636650/324564/simple_socket_class_ssl.pl">
Wed Jul 22 16:10:31 2009 (3.2k) by dmuey [...] cpan.org
</a>
</font></li>
</ul>


socket_class_dos.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636100/324298/socket_class_dos.tar.gz">
Tue Jul 21 19:54:51 2009 (2.9k) by nick [...] cpanel.net
</a>
</font></li>
</ul>


ssl_better_server.perl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636095/324283/ssl_better_server.perl">
Tue Jul 21 18:58:25 2009 (1.1k) by dmuey [...] cpan.org
</a>
</font></li>
</ul>


ssl_client.perl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636095/324289/ssl_client.perl">
Tue Jul 21 18:58:25 2009 (375b) by dmuey [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/636001/324206/ssl_client.perl">
Tue Jul 21 13:50:08 2009 (375b) by dmuey [...] cpan.org
</a>
</font></li>
</ul>


ssl_dos_client.perl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636095/324286/ssl_dos_client.perl">
Tue Jul 21 18:58:25 2009 (142b) by dmuey [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/636076/324263/ssl_dos_client.perl">
Tue Jul 21 17:13:57 2009 (142b) by dmuey [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/636074/324257/ssl_dos_client.perl">
Tue Jul 21 17:12:43 2009 (144b) by dmuey [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/636001/324200/ssl_dos_client.perl">
Tue Jul 21 13:50:08 2009 (144b) by dmuey [...] cpan.org
</a>
</font></li>
</ul>


ssl_server.perl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/636089/324273/ssl_server.perl">
Tue Jul 21 18:24:07 2009 (885b) by christian [...] hbr1.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/636001/324203/ssl_server.perl">
Tue Jul 21 13:50:08 2009 (673b) by dmuey [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=48066">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636001" href="/Public/Bug/Display.html?id=48066#txn-636001">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;13:50:08&nbsp;2009</span>
    <span class="description">dmuey [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636001/324197/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324197">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 711b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

The attached script illustrates the problem pretty well.

1&#41; in one terminal start up ssl_server.perl &#40;essentially the basic example&#41;

2&#41; in one or more start running ssl_client.perl &#40;essentially the basic example&#41; over and over 
in a large loop 
 
so far so good!

3&#41; run ssl_dos_client.perl in another terminal one time

Now the existing and subsequent ssl_client.perl are denied.

To resolve this the server needs to start up non-SSL, then fork and upgrade to SSL.

This doesn&#39;t currently seem possible with Socket::Class::SSL.

I&#39;ll attach an example IO::Socket::SSL based ssl_server script that will sanely handle 
misbehaving clients soon so you&#39;ll be able to see the difference yourself.

thanks!
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ssl_dos_client.perl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636001/324200/ssl_dos_client.perl">Download ssl_dos_client.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 144b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ssl_server.perl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636001/324203/ssl_server.perl">Download ssl_server.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 673b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ssl_client.perl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636001/324206/ssl_client.perl">Download ssl_client.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 375b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636067" href="/Public/Bug/Display.html?id=48066#txn-636067">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;17:04:24&nbsp;2009</span>
    <span class="description">christian [...] hbr1.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Jul 2009 23:04:01 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Mueller&#34; &lt;christian [...] hbr1.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636067/324247/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324247">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">hello,

it is possible to start ssl on connected plain sockets via the starttls&#40;&#41;
function.

$ssl_socket = Socket::Class::SSL-&gt;starttls&#40; $socket &#41;;

is it this you are looking for?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Jul 21 13:50:08 2009: Request 48066 was acted upon.
&gt; Transaction: Ticket created by DMUEY
&gt;        Queue: Socket-Class
&gt;      Subject: very easy to DOS server, needs a server version of
&gt; starttls&#40;&#41;
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: dmuey@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt;
&gt; Hello,
&gt;
&gt; The attached script illustrates the problem pretty well.
&gt;
&gt; 1&#41; in one terminal start up ssl_server.perl &#40;essentially the basic
&gt; example&#41;
&gt;
&gt; 2&#41; in one or more start running ssl_client.perl &#40;essentially the basic
&gt; example&#41; over and over
&gt; in a large loop
&gt;
&gt; so far so good!
&gt;
&gt; 3&#41; run ssl_dos_client.perl in another terminal one time
&gt;
&gt; Now the existing and subsequent ssl_client.perl are denied.
&gt;
&gt; To resolve this the server needs to start up non-SSL, then fork and
&gt; upgrade to SSL.
&gt;
&gt; This doesn&#39;t currently seem possible with Socket::Class::SSL.
&gt;
&gt; I&#39;ll attach an example IO::Socket::SSL based ssl_server script that will
&gt; sanely handle
&gt; misbehaving clients soon so you&#39;ll be able to see the difference yourself.
&gt;
&gt; thanks!
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636068" href="/Public/Bug/Display.html?id=48066#txn-636068">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;17:04:25&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636071" href="/Public/Bug/Display.html?id=48066#txn-636071">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;17:11:11&nbsp;2009</span>
    <span class="description">webmaster [...] simplemood.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Jul 2009 16:10:46 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Muey &lt;webmaster [...] simplemood.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636071/324250/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324250">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 495b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Jul 21, 2009, at 4:04 PM, Christian Mueller via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=48066">http://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt; hello,
&gt;
&gt; it is possible to start ssl on connected plain sockets via the  
&gt; starttls&#40;&#41;
&gt; function.
&gt;
&gt; $ssl_socket = Socket::Class::SSL-&gt;starttls&#40; $socket &#41;;
&gt;
&gt; is it this you are looking for?
</div>
Maybe, I&#39;ve been trying to get it to work, I need to get my boss&#39;s  
IO::Socket::SSL version working then change it to use Socket::Class  
and see if that does the trick :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636074" href="/Public/Bug/Display.html?id=48066#txn-636074">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;17:12:43&nbsp;2009</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636074/324254/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324254">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 80b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The ssl_dos_client.perl attached in the OP had a typo, here&#39;s the actual one 
:&#41;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636074/324257/ssl_dos_client.perl">Download ssl_dos_client.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 144b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636076" href="/Public/Bug/Display.html?id=48066#txn-636076">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;17:13:57&nbsp;2009</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636076/324260/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324260">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 173b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 21 17:12:43 2009, DMUEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The ssl_dos_client.perl attached in the OP had a typo, here&#39;s the
&gt; actual one
&gt; :&#41;
</div>
ok, lets try this *again* shesh.. sorry :&#41;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636076/324263/ssl_dos_client.perl">Download ssl_dos_client.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 142b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636080" href="/Public/Bug/Display.html?id=48066#txn-636080">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;17:57:17&nbsp;2009</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/636080/324266/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324266">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 835b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 21 17:04:24 2009, christian@hbr1.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; hello,
&gt; 
&gt; it is possible to start ssl on connected plain sockets via the starttls&#40;&#41;
&gt; function.
&gt; 
&gt; $ssl_socket = Socket::Class::SSL-&gt;starttls&#40; $socket &#41;;
&gt; 
&gt; is it this you are looking for?
</div>

If I adjust the ssl_server to do that before it&#39;s while&#40;&#41; the clients all get:

   my $ssl = Socket::Class::SSL-&gt;starttls&#40; $sock &#41;
          or die &#39;TLS initialization failed: &#39; . $sock-&gt;error;

    while &#40; my $c = $ssl-&gt;accept &#41; {


Some I/O error occurred at ssl_client.perl line 3.

That is with or without calling

  $ssl-&gt;set_certificate&#40;&#39;/usr/local/apache/conf/ssl.crt/server.crt&#39;&#41;;
  $ssl-&gt;set_private_key&#40;&#39;/usr/local/apache/conf/ssl.key/server.key&#39;&#41;;

before the while&#40;&#41;

any ideas how to do the simple server example as a non SSL socket then 
upgrade it to SSL?

thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636082" href="/Public/Bug/Display.html?id=48066#txn-636082">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;18:05:23&nbsp;2009</span>
    <span class="description">christian [...] hbr1.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Jul 2009 00:05:01 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Mueller&#34; &lt;christian [...] hbr1.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636082/324268/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324268">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Socket-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt; On Tue Jul 21 17:04:24 2009, christian@hbr1.com wrote:
<div class="message-stanza open">&gt;&gt; hello,
&gt;&gt;
&gt;&gt; it is possible to start ssl on connected plain sockets via the
&gt;&gt; starttls&#40;&#41;
&gt;&gt; function.
&gt;&gt;
&gt;&gt; $ssl_socket = Socket::Class::SSL-&gt;starttls&#40; $socket &#41;;
&gt;&gt;
&gt;&gt; is it this you are looking for?
</div>&gt;
&gt;
&gt; If I adjust the ssl_server to do that before it&#39;s while&#40;&#41; the clients all
&gt; get:
&gt;
&gt;    my $ssl = Socket::Class::SSL-&gt;starttls&#40; $sock &#41;
&gt;           or die &#39;TLS initialization failed: &#39; . $sock-&gt;error;
&gt;
&gt;     while &#40; my $c = $ssl-&gt;accept &#41; {
</div>
This wont work. starttls&#40;&#41; only works on connected sockets.
But by the way whats the different to creating a listening ssl socket
directly? I thought you want do something like this:

while&#40; $client = $socket-&gt;accept &#41; {
    $ssl = Socket::Class::SSL-&gt;starttls&#40; $client &#41;
        or die $client-&gt;error;
    $ssl-&gt;say&#40; &#34;HELLO CLIENT&#34; &#41;;
    ...
}

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; Some I/O error occurred at ssl_client.perl line 3.
&gt;
&gt; That is with or without calling
&gt;
&gt;   $ssl-&gt;set_certificate&#40;&#39;/usr/local/apache/conf/ssl.crt/server.crt&#39;&#41;;
&gt;   $ssl-&gt;set_private_key&#40;&#39;/usr/local/apache/conf/ssl.key/server.key&#39;&#41;;
&gt;
&gt; before the while&#40;&#41;
&gt;
&gt; any ideas how to do the simple server example as a non SSL socket then
&gt; upgrade it to SSL?
&gt;
&gt; thanks!
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636089" href="/Public/Bug/Display.html?id=48066#txn-636089">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;18:24:07&nbsp;2009</span>
    <span class="description">christian [...] hbr1.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Jul 2009 00:23:41 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Mueller&#34; &lt;christian [...] hbr1.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636089/324272/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324272">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">well it will block the server infinitely. but its not a ssl issue. please
try out the server script in the attachement.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Jul 21 13:50:08 2009: Request 48066 was acted upon.
&gt; Transaction: Ticket created by DMUEY
&gt;        Queue: Socket-Class
&gt;      Subject: very easy to DOS server, needs a server version of
&gt; starttls&#40;&#41;
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: dmuey@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt;
&gt; Hello,
&gt;
&gt; The attached script illustrates the problem pretty well.
&gt;
&gt; 1&#41; in one terminal start up ssl_server.perl &#40;essentially the basic
&gt; example&#41;
&gt;
&gt; 2&#41; in one or more start running ssl_client.perl &#40;essentially the basic
&gt; example&#41; over and over
&gt; in a large loop
&gt;
&gt; so far so good!
&gt;
&gt; 3&#41; run ssl_dos_client.perl in another terminal one time
&gt;
&gt; Now the existing and subsequent ssl_client.perl are denied.
&gt;
&gt; To resolve this the server needs to start up non-SSL, then fork and
&gt; upgrade to SSL.
&gt;
&gt; This doesn&#39;t currently seem possible with Socket::Class::SSL.
&gt;
&gt; I&#39;ll attach an example IO::Socket::SSL based ssl_server script that will
&gt; sanely handle
&gt; misbehaving clients soon so you&#39;ll be able to see the difference yourself.
&gt;
&gt; thanks!
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636089/324273/ssl_server.perl">Download ssl_server.perl</a><br />
<span class="downloadcontenttype">text/plain 885b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636092" href="/Public/Bug/Display.html?id=48066#txn-636092">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;18:48:02&nbsp;2009</span>
    <span class="description">webmaster [...] simplemood.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Jul 2009 17:47:27 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Muey &lt;webmaster [...] simplemood.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636092/324276/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324276">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 465b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This wont work. starttls&#40;&#41; only works on connected sockets.
&gt; But by the way whats the different to creating a listening ssl socket
&gt; directly? I thought you want do something like this:
&gt;
&gt; while&#40; $client = $socket-&gt;accept &#41; {
&gt;    $ssl = Socket::Class::SSL-&gt;starttls&#40; $client &#41;
&gt;        or die $client-&gt;error;
&gt;    $ssl-&gt;say&#40; &#34;HELLO CLIENT&#34; &#41;;
&gt;    ...
&gt; }
</div>
That&#39;s what I was doing wrong, doh! Our IO::Socket::SSL one does that,  
sorry I missed that detail :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636095" href="/Public/Bug/Display.html?id=48066#txn-636095">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;18:58:25&nbsp;2009</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636095/324280/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324280">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 309b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">ok, this one does the upgrade-to-ssl thing and behaves like to original 
&#40;i.e. still has DOS potential&#41;

The forkage logic causes strange behavior, like blank requests &#40;no output&#41; 
and duplicate requests &#40;the incremented number may revert back to 
previous ones&#41;.

We&#39;ll get it yet, thanks for the assistance!
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636095/324283/ssl_better_server.perl">Download ssl_better_server.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 1.1k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636095/324286/ssl_dos_client.perl">Download ssl_dos_client.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 142b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636095/324289/ssl_client.perl">Download ssl_client.perl</a><br />
<span class="downloadcontenttype">application/octet-stream 375b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636097" href="/Public/Bug/Display.html?id=48066#txn-636097">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;19:16:05&nbsp;2009</span>
    <span class="description">christian [...] hbr1.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Jul 2009 01:15:44 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Mueller&#34; &lt;christian [...] hbr1.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636097/324291/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324291">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 641b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Socket-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt; ok, this one does the upgrade-to-ssl thing and behaves like to original
&gt; &#40;i.e. still has DOS potential&#41;
&gt;
&gt; The forkage logic causes strange behavior, like blank requests &#40;no output&#41;
&gt; and duplicate requests &#40;the incremented number may revert back to
&gt; previous ones&#41;.
&gt;
&gt; We&#39;ll get it yet, thanks for the assistance!
&gt;
</div>
the server is very simple and almost insecure. for example readline
expects correct data send to the server. but as i see the server operates
outside the ssl context now. $c-&gt;write sends the data to the plain socket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636100" href="/Public/Bug/Display.html?id=48066#txn-636100">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;19:54:51&nbsp;2009</span>
    <span class="description">nick [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> nick [...] cpanel.net</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636100/324295/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324295">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is the explanation in code:

Example dosable forking server that runs on port 10001

socket_class_dos/dos_test.pl   --  Script to test to see if the dos will happen
socket_class_dos/dosable_socket_class_ssl.pl  -- Functional version that just uses accept&#40;&#41;
socket_class_dos/simple_io_socket_ssl.pl         -- Safe version that uses IO::Socket::SSL
socket_class_dos/simple_socket_class_ssl.pl    -- How I would envision doing this with 
Socket::Class::SSL -- not functional


Usage:

perl dosable_socket_class_ssl.pl &#38;
perl dos_test.pl  

OR

perl simple_io_socket_ssl.pl &#38;
perl dos_test.pl  




On Tue Jul 21 19:16:05 2009, christian@hbr1.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;        Queue: Socket-Class
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt; &gt;
&gt; &gt; ok, this one does the upgrade-to-ssl thing and behaves like to original
&gt; &gt; &#40;i.e. still has DOS potential&#41;
&gt; &gt;
&gt; &gt; The forkage logic causes strange behavior, like blank requests &#40;no output&#41;
&gt; &gt; and duplicate requests &#40;the incremented number may revert back to
&gt; &gt; previous ones&#41;.
&gt; &gt;
&gt; &gt; We&#39;ll get it yet, thanks for the assistance!
&gt; &gt;
</div>&gt; 
&gt; the server is very simple and almost insecure. for example readline
&gt; expects correct data send to the server. but as i see the server operates
&gt; outside the ssl context now. $c-&gt;write sends the data to the plain socket.
&gt; 
&gt; 
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636100/324298/socket_class_dos.tar.gz">Download socket_class_dos.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 2.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636132" href="/Public/Bug/Display.html?id=48066#txn-636132">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;20:54:49&nbsp;2009</span>
    <span class="description">christian [...] hbr1.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Jul 2009 02:54:28 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Mueller&#34; &lt;christian [...] hbr1.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636132/324314/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324314">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">please use the $sock object instead of the socket handle with starttls.
does the scripts in the attachment work like expected?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Socket-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt; Here is the explanation in code:
&gt;
&gt; Example dosable forking server that runs on port 10001
&gt;
&gt; socket_class_dos/dos_test.pl   --  Script to test to see if the dos will
&gt; happen
&gt; socket_class_dos/dosable_socket_class_ssl.pl  -- Functional version that
&gt; just uses accept&#40;&#41;
&gt; socket_class_dos/simple_io_socket_ssl.pl         -- Safe version that uses
&gt; IO::Socket::SSL
&gt; socket_class_dos/simple_socket_class_ssl.pl    -- How I would envision
&gt; doing this with
&gt; Socket::Class::SSL -- not functional
&gt;
&gt;
&gt; Usage:
&gt;
&gt; perl dosable_socket_class_ssl.pl &#38;
&gt; perl dos_test.pl
&gt;
&gt; OR
&gt;
&gt; perl simple_io_socket_ssl.pl &#38;
&gt; perl dos_test.pl
&gt;
&gt;
&gt;
&gt;
&gt; On Tue Jul 21 19:16:05 2009, christian@hbr1.com wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt;        Queue: Socket-Class
&gt;&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; ok, this one does the upgrade-to-ssl thing and behaves like to
</div>&gt;&gt; original
<div class="message-stanza open">&gt;&gt; &gt; &#40;i.e. still has DOS potential&#41;
&gt;&gt; &gt;
&gt;&gt; &gt; The forkage logic causes strange behavior, like blank requests &#40;no
</div>&gt;&gt; output&#41;
<div class="message-stanza open">&gt;&gt; &gt; and duplicate requests &#40;the incremented number may revert back to
&gt;&gt; &gt; previous ones&#41;.
&gt;&gt; &gt;
&gt;&gt; &gt; We&#39;ll get it yet, thanks for the assistance!
&gt;&gt; &gt;
</div>&gt;&gt;
&gt;&gt; the server is very simple and almost insecure. for example readline
&gt;&gt; expects correct data send to the server. but as i see the server
&gt;&gt; operates
&gt;&gt; outside the ssl context now. $c-&gt;write sends the data to the plain
&gt;&gt; socket.
&gt;&gt;
&gt;&gt;
</div>&gt;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636132/324315/dost_test.zip">Download dost_test.zip</a><br />
<span class="downloadcontenttype">application/x-zip-compressed 6.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636546" href="/Public/Bug/Display.html?id=48066#txn-636546">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;13:09:32&nbsp;2009</span>
    <span class="description">christian [...] hbr1.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Jul 2009 19:09:13 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Mueller&#34; &lt;christian [...] hbr1.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636546/324507/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324507">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok i did understand the problem. I fixed starttls to accept parameters and
changed the functionality on server side. Its part of version 2.23 which i
uploaded to cpan. the scripts in the attachment should work with it.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Socket-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt; Here is the explanation in code:
&gt;
&gt; Example dosable forking server that runs on port 10001
&gt;
&gt; socket_class_dos/dos_test.pl   --  Script to test to see if the dos will
&gt; happen
&gt; socket_class_dos/dosable_socket_class_ssl.pl  -- Functional version that
&gt; just uses accept&#40;&#41;
&gt; socket_class_dos/simple_io_socket_ssl.pl         -- Safe version that uses
&gt; IO::Socket::SSL
&gt; socket_class_dos/simple_socket_class_ssl.pl    -- How I would envision
&gt; doing this with
&gt; Socket::Class::SSL -- not functional
&gt;
&gt;
&gt; Usage:
&gt;
&gt; perl dosable_socket_class_ssl.pl &#38;
&gt; perl dos_test.pl
&gt;
&gt; OR
&gt;
&gt; perl simple_io_socket_ssl.pl &#38;
&gt; perl dos_test.pl
&gt;
&gt;
&gt;
&gt;
&gt; On Tue Jul 21 19:16:05 2009, christian@hbr1.com wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt;        Queue: Socket-Class
&gt;&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; ok, this one does the upgrade-to-ssl thing and behaves like to
</div>&gt;&gt; original
<div class="message-stanza open">&gt;&gt; &gt; &#40;i.e. still has DOS potential&#41;
&gt;&gt; &gt;
&gt;&gt; &gt; The forkage logic causes strange behavior, like blank requests &#40;no
</div>&gt;&gt; output&#41;
<div class="message-stanza open">&gt;&gt; &gt; and duplicate requests &#40;the incremented number may revert back to
&gt;&gt; &gt; previous ones&#41;.
&gt;&gt; &gt;
&gt;&gt; &gt; We&#39;ll get it yet, thanks for the assistance!
&gt;&gt; &gt;
</div>&gt;&gt;
&gt;&gt; the server is very simple and almost insecure. for example readline
&gt;&gt; expects correct data send to the server. but as i see the server
&gt;&gt; operates
&gt;&gt; outside the ssl context now. $c-&gt;write sends the data to the plain
&gt;&gt; socket.
&gt;&gt;
&gt;&gt;
</div>&gt;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636546/324508/dos_test.zip">Download dos_test.zip</a><br />
<span class="downloadcontenttype">application/x-zip-compressed 6.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636650" href="/Public/Bug/Display.html?id=48066#txn-636650">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;16:10:31&nbsp;2009</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/636650/324558/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324558">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 525b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 22 13:09:32 2009, christian@hbr1.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ok i did understand the problem. I fixed starttls to accept parameters 
</div>and
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; changed the functionality on server side. Its part of version 2.23 
</div>which i
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; uploaded to cpan. the scripts in the attachment should work with it.
</div>
Looks nice! w/ v2.23 I get these results:

terminal 1&#41; perl dosable_socket_class_ssl.pl
terminal 2&#41; perl dos_test.pl

note the DOS happen

terminal 1&#41; perl simple_socket_class_ssl.pl
terminal 2&#41;  perl dos_test.pl

note the DOS does not happen
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636650/324561/dosable_socket_class_ssl.pl">Download dosable_socket_class_ssl.pl</a><br />
<span class="downloadcontenttype">text/x-perl 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use Socket::Class      &#40;&#41;;
use Socket::Class::SSL &#40;&#41;;
use IO::Select         &#40;&#41;;

my $pem = &#39;-----BEGIN RSA PRIVATE KEY-----
MIICXgIBAAKBgQC5hCJbBaDK3vhJN51DaVwUdUQkb7fnbYV36F1cYSQ0XcuUhWSb
wB1Kq9BKzuYW/qaIIH08n9W41GMbQcZGLGe6pn0eZsvv/TrXLV8a2Yf6QzWw4ufH
aJc1NLDvq8P2N0jxhiWmGf1u5ZJw6nGShqbrNEnB5WJZDvmdMgzGp6G7DwIDAQAB
AoGBAJsmsPzi9hj05T2Gr5WjVgkeEcFPVcTNSeSAhyQtcfQBxbMO5JeF0nmSu/70
jmYIzwnl8hdzrXCI3+H53nLtzElXPM8FJ10SOAsklHZexjvV3fCC3U7Qo5su2R1e
cKsRfNYx3X++kODuKGHzOi+fi9V0hiZtHgs3s9Lb4Gr2VKoRAkEA3sBUz70DEkBd
UHfCh1kRRph4yUtytx9EETaewQ5kc94QHHuUk8G61zlBoItbPU+bQAJGzwap0PNe
EJCqLe6ctQJBANU0/asX/q/mALPZqjE5XpzbXY4d8ZdKxJjLaEzjBHSyw4bGAD4W
Q/k7E7b8r/M5wGdipBvSFbCvS2qE2c/bVzMCQQCu5u/xKeV2eEmM/GwnIF17RA9b
Zz2M4iTtKykeR3HCtPOLmdGA71YI1nFcYO/kRVSOvvrgZcgDRIRwl1a4uCodAkEA
y8T1nIw2Uo8UpM+npZwbHPdblvRvbhV7iDz/1lwyagZgcXLT0IMfPBiGYyFmWKQd
i7Hu/tfu+wrOnWOTeOE9mQJAQaMngYlDh0SLABUiMk6MuBtZArrCL735ostnWnpf
efsi37gWPlbX0Yy+4HyDPIcFpXJ46cZecFVlOq2NZSSEAg==
-----END RSA PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIDRTCCAq6gAwIBAgIBADANBgkqhkiG9w0BAQQFADB7MQswCQYDVQQGEwJVUzEQ
MA4GA1UECBMHVW5rbm93bjEQMA4GA1UEBxMHVW5rbm93bjEQMA4GA1UEChMHVW5r
bm93bjEQMA4GA1UECxMHVW5rbm93bjEMMAoGA1UEAxMDcGlnMRYwFAYJKoZIhvcN
AQkBFgdzc2xAcGlnMB4XDTA4MTIyNDAzNDE0NFoXDTA5MTIyNDAzNDE0NFowezEL
MAkGA1UEBhMCVVMxEDAOBgNVBAgTB1Vua25vd24xEDAOBgNVBAcTB1Vua25vd24x
EDAOBgNVBAoTB1Vua25vd24xEDAOBgNVBAsTB1Vua25vd24xDDAKBgNVBAMTA3Bp
ZzEWMBQGCSqGSIb3DQEJARYHc3NsQHBpZzCBnzANBgkqhkiG9w0BAQEFAAOBjQAw
gYkCgYEAuYQiWwWgyt74STedQ2lcFHVEJG+3522Fd+hdXGEkNF3LlIVkm8AdSqvQ
Ss7mFv6miCB9PJ/VuNRjG0HGRixnuqZ9HmbL7/061y1fGtmH+kM1sOLnx2iXNTSw
76vD9jdI8YYlphn9buWScOpxkoam6zRJweViWQ75nTIMxqehuw8CAwEAAaOB2DCB
1TAdBgNVHQ4EFgQUQRmLH9Vlf7Ts39g1omt38SEf3wowgaUGA1UdIwSBnTCBmoAU
QRmLH9Vlf7Ts39g1omt38SEf3wqhf6R9MHsxCzAJBgNVBAYTAlVTMRAwDgYDVQQI
EwdVbmtub3duMRAwDgYDVQQHEwdVbmtub3duMRAwDgYDVQQKEwdVbmtub3duMRAw
DgYDVQQLEwdVbmtub3duMQwwCgYDVQQDEwNwaWcxFjAUBgkqhkiG9w0BCQEWB3Nz
bEBwaWeCAQAwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQQFAAOBgQBqpceFZCqa
c2g3sjstCfDPm3PESyiPNvN152+GLuwiyu0X0KXUNzqAbQbvQ1hABjQBDWbV0hw7
tDgd0FNDIxw4+X8N4e9UVHuYlXCF4G5nLuKm5GJyHnfNCZLHdG8dNUHFwG0MN8+Q
ET5BUqESHHx8ODIGnoUK6wWamINhU/Uiig==
-----END CERTIFICATE-----&#39;;

my $homedir = &#40; getpwuid&#40;$&gt;&#41; &#41;[7];
if &#40; open&#40; my $pem_fh, &#39;&gt;&#39;, $homedir . &#39;/mypem_ssl_test.pem&#39; &#41; &#41; {
    print {$pem_fh} $pem;
    close&#40;$pem_fh&#41;;
}

my %SSLARGS = &#40;
    &#39;private_key&#39; =&gt; $homedir . &#39;/mypem_ssl_test.pem&#39;,
    &#39;certificate&#39; =&gt; $homedir . &#39;/mypem_ssl_test.pem&#39;,

    #&#39;SSL_cipher_list&#39; =&gt; &#39;ALL:!ADH:+HIGH:+MEDIUM:-LOW:-SSLv2:-EXP&#39;
&#41;;

my $port = 10001;
my %ARGS = &#40;
    &#39;listen&#39;     =&gt; &#39;45&#39;,
    &#39;proto&#39;      =&gt; &#39;tcp&#39;,
    &#39;local_port&#39; =&gt; $port,
    &#39;reuseaddr&#39;  =&gt; &#39;1&#39;,
&#41;;
my $fd = Socket::Class::SSL-&gt;new&#40; %ARGS, %SSLARGS &#41;;
while &#40;1&#41; {
    $socket = $fd-&gt;accept&#40;&#41; || next;
    if &#40; fork&#40;&#41; &#41; {
        $socket-&gt;close&#40;&#41;;

        #parent
    }
    else {
        $socket-&gt;read&#40; $constring, 2 &#41;;
        $socket-&gt;write&#40;&#34;SSL SERVER CONNETED OK\n&#34;&#41;;
        exit&#40;&#41;;
    }
}
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636650/324564/simple_socket_class_ssl.pl">Download simple_socket_class_ssl.pl</a><br />
<span class="downloadcontenttype">text/x-perl 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

BEGIN {
    unshift @INC, &#39;blib/lib&#39;, &#39;blib/arch&#39;;
}

use Socket::Class      &#40;&#41;;
use Socket::Class::SSL &#40;&#41;;

my $pem = &#39;-----BEGIN RSA PRIVATE KEY-----
MIICXgIBAAKBgQC5hCJbBaDK3vhJN51DaVwUdUQkb7fnbYV36F1cYSQ0XcuUhWSb
wB1Kq9BKzuYW/qaIIH08n9W41GMbQcZGLGe6pn0eZsvv/TrXLV8a2Yf6QzWw4ufH
aJc1NLDvq8P2N0jxhiWmGf1u5ZJw6nGShqbrNEnB5WJZDvmdMgzGp6G7DwIDAQAB
AoGBAJsmsPzi9hj05T2Gr5WjVgkeEcFPVcTNSeSAhyQtcfQBxbMO5JeF0nmSu/70
jmYIzwnl8hdzrXCI3+H53nLtzElXPM8FJ10SOAsklHZexjvV3fCC3U7Qo5su2R1e
cKsRfNYx3X++kODuKGHzOi+fi9V0hiZtHgs3s9Lb4Gr2VKoRAkEA3sBUz70DEkBd
UHfCh1kRRph4yUtytx9EETaewQ5kc94QHHuUk8G61zlBoItbPU+bQAJGzwap0PNe
EJCqLe6ctQJBANU0/asX/q/mALPZqjE5XpzbXY4d8ZdKxJjLaEzjBHSyw4bGAD4W
Q/k7E7b8r/M5wGdipBvSFbCvS2qE2c/bVzMCQQCu5u/xKeV2eEmM/GwnIF17RA9b
Zz2M4iTtKykeR3HCtPOLmdGA71YI1nFcYO/kRVSOvvrgZcgDRIRwl1a4uCodAkEA
y8T1nIw2Uo8UpM+npZwbHPdblvRvbhV7iDz/1lwyagZgcXLT0IMfPBiGYyFmWKQd
i7Hu/tfu+wrOnWOTeOE9mQJAQaMngYlDh0SLABUiMk6MuBtZArrCL735ostnWnpf
efsi37gWPlbX0Yy+4HyDPIcFpXJ46cZecFVlOq2NZSSEAg==
-----END RSA PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIDRTCCAq6gAwIBAgIBADANBgkqhkiG9w0BAQQFADB7MQswCQYDVQQGEwJVUzEQ
MA4GA1UECBMHVW5rbm93bjEQMA4GA1UEBxMHVW5rbm93bjEQMA4GA1UEChMHVW5r
bm93bjEQMA4GA1UECxMHVW5rbm93bjEMMAoGA1UEAxMDcGlnMRYwFAYJKoZIhvcN
AQkBFgdzc2xAcGlnMB4XDTA4MTIyNDAzNDE0NFoXDTA5MTIyNDAzNDE0NFowezEL
MAkGA1UEBhMCVVMxEDAOBgNVBAgTB1Vua25vd24xEDAOBgNVBAcTB1Vua25vd24x
EDAOBgNVBAoTB1Vua25vd24xEDAOBgNVBAsTB1Vua25vd24xDDAKBgNVBAMTA3Bp
ZzEWMBQGCSqGSIb3DQEJARYHc3NsQHBpZzCBnzANBgkqhkiG9w0BAQEFAAOBjQAw
gYkCgYEAuYQiWwWgyt74STedQ2lcFHVEJG+3522Fd+hdXGEkNF3LlIVkm8AdSqvQ
Ss7mFv6miCB9PJ/VuNRjG0HGRixnuqZ9HmbL7/061y1fGtmH+kM1sOLnx2iXNTSw
76vD9jdI8YYlphn9buWScOpxkoam6zRJweViWQ75nTIMxqehuw8CAwEAAaOB2DCB
1TAdBgNVHQ4EFgQUQRmLH9Vlf7Ts39g1omt38SEf3wowgaUGA1UdIwSBnTCBmoAU
QRmLH9Vlf7Ts39g1omt38SEf3wqhf6R9MHsxCzAJBgNVBAYTAlVTMRAwDgYDVQQI
EwdVbmtub3duMRAwDgYDVQQHEwdVbmtub3duMRAwDgYDVQQKEwdVbmtub3duMRAw
DgYDVQQLEwdVbmtub3duMQwwCgYDVQQDEwNwaWcxFjAUBgkqhkiG9w0BCQEWB3Nz
bEBwaWeCAQAwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQQFAAOBgQBqpceFZCqa
c2g3sjstCfDPm3PESyiPNvN152+GLuwiyu0X0KXUNzqAbQbvQ1hABjQBDWbV0hw7
tDgd0FNDIxw4+X8N4e9UVHuYlXCF4G5nLuKm5GJyHnfNCZLHdG8dNUHFwG0MN8+Q
ET5BUqESHHx8ODIGnoUK6wWamINhU/Uiig==
-----END CERTIFICATE-----&#39;;

my $homedir = &#40; getpwuid&#40;$&gt;&#41; &#41;[7];
if &#40; open&#40; my $pem_fh, &#39;&gt;&#39;, $homedir . &#39;/mypem_ssl_test.pem&#39; &#41; &#41; {
    print {$pem_fh} $pem;
    close&#40;$pem_fh&#41;;
}

my %SSLARGS = &#40;
    &#39;private_key&#39; =&gt; $homedir . &#39;/mypem_ssl_test.pem&#39;,
    &#39;certificate&#39; =&gt; $homedir . &#39;/mypem_ssl_test.pem&#39;,

    #&#39;SSL_cipher_list&#39; =&gt; &#39;ALL:!ADH:+HIGH:+MEDIUM:-LOW:-SSLv2:-EXP&#39;
&#41;;

my $port = 10001;
my %ARGS = &#40;
    &#39;listen&#39;     =&gt; &#39;45&#39;,
    &#39;proto&#39;      =&gt; &#39;tcp&#39;,
    &#39;local_port&#39; =&gt; $port,
    &#39;reuseaddr&#39;  =&gt; &#39;1&#39;,
&#41;;
my $fd = Socket::Class-&gt;new&#40;%ARGS&#41;;

while &#40;1&#41; {
    $fd-&gt;select&#40; $read_set = 1, undef, undef, 5 &#41;;
    if &#40;$read_set&#41; {
        $socket = $fd-&gt;accept&#40;&#41; || next;
        if &#40; fork&#40;&#41; &#41; {

            # parent

            $socket-&gt;close&#40;&#41;;
        }
        else {

            # child
            my $sslsocket = Socket::Class::SSL-&gt;starttls&#40;
                $socket,
                &#39;server&#39; =&gt; 1,
                %SSLARGS
            &#41; || die &#34;Could not start ssl&#34;;
            $sslsocket-&gt;read&#40; $constring, 2 &#41;;
            $sslsocket-&gt;write&#40;&#34;SSL SERVER CONNETED OK\n&#34;&#41;;
            exit&#40;&#41;;
        }
    }
}
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/636650/324567/dos_test.pl">Download dos_test.pl</a><br />
<span class="downloadcontenttype">text/x-perl 522b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

BEGIN {
    unshift @INC, &#39;blib/lib&#39;, &#39;blib/arch&#39;;
}

$SIG{&#39;ALRM&#39;} = sub {
    die &#34;DoS successful\n&#34;;
};
alarm&#40;10&#41;;
use Socket::Class::SSL&#40;&#41;;
my $ssl = Socket::Class-&gt;new&#40; &#39;remote_port&#39; =&gt; 10001 &#41;;
print &#34;Connected\n&#34;;

my $ssl2 = Socket::Class::SSL-&gt;new&#40; &#39;remote_port&#39; =&gt; 10001 &#41; or die Socket::Class-&gt;error;
$ssl2-&gt;write&#40; &#39;test&#39; . &#34;\n&#34; &#41;;
print &#34;Connected - 2\n&#34;;

my $line = $ssl2-&gt;readline&#40;&#41;;

if &#40; $line =~ /conn/i &#41; {
    print &#34;DoS failed - Server OK\n&#34;;
}
else {
    die &#34;DoS successful\n&#34;;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-636752" href="/Public/Bug/Display.html?id=48066#txn-636752">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;19:40:25&nbsp;2009</span>
    <span class="description">post-christian [...] freenet.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-637190" href="/Public/Bug/Display.html?id=48066#txn-637190">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;23&nbsp;14:47:22&nbsp;2009</span>
    <span class="description">nick [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/637190/324917/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/324917">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The DoS problem is confirmed fixed, however the downside is that the ssl context cannot be 
reused.  Its fastest to init in the parent, and then reuse in the child.   IO::Socket::SSL supports 
its as follows:


SSL_reuse_ctx
If you have already set the above options &#40;SSL_version through SSL_check_crl; this does not 
include SSL_cipher_list yet&#41; for a previous instance of IO::Socket::SSL, then you can reuse the 
SSL context of that instance by passing it as the value for the SSL_reuse_ctx parameter. You 
may also create a new instance of the IO::Socket::SSL::SSL_Context class, using any context 
options that you desire without specifying connection options, and pass that here instead.

If you use this option, all other context-related options that you pass in the same call to 
new&#40;&#41; will be ignored unless the context supplied was invalid. Note that, contrary to versions 
of IO::Socket::SSL below v0.90, a global SSL context will not be implicitly used unless you use 
the set_default_context&#40;&#41; function.


With having to reload the certificate every time it has to re-read the certificates after every 
fork.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-637191" href="/Public/Bug/Display.html?id=48066#txn-637191">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;23&nbsp;14:47:23&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-638539" href="/Public/Bug/Display.html?id=48066#txn-638539">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;20:34:33&nbsp;2009</span>
    <span class="description">christian [...] hbr1.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48066] very easy to DOS server, needs a server version of starttls&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 26 Jul 2009 02:34:08 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Mueller&#34; &lt;christian [...] hbr1.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/638539/325659/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/325659">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">2.25 supports shared ssl contexts.
hope it works as expected.
the modified server script is attached.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Socket-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt;
&gt; The DoS problem is confirmed fixed, however the downside is that the ssl
&gt; context cannot be
&gt; reused.  Its fastest to init in the parent, and then reuse in the child.
&gt; IO::Socket::SSL supports
&gt; its as follows:
&gt;
&gt;
&gt; SSL_reuse_ctx
&gt; If you have already set the above options &#40;SSL_version through
&gt; SSL_check_crl; this does not
&gt; include SSL_cipher_list yet&#41; for a previous instance of IO::Socket::SSL,
&gt; then you can reuse the
&gt; SSL context of that instance by passing it as the value for the
&gt; SSL_reuse_ctx parameter. You
&gt; may also create a new instance of the IO::Socket::SSL::SSL_Context class,
&gt; using any context
&gt; options that you desire without specifying connection options, and pass
&gt; that here instead.
&gt;
&gt; If you use this option, all other context-related options that you pass in
&gt; the same call to
&gt; new&#40;&#41; will be ignored unless the context supplied was invalid. Note that,
&gt; contrary to versions
&gt; of IO::Socket::SSL below v0.90, a global SSL context will not be
&gt; implicitly used unless you use
&gt; the set_default_context&#40;&#41; function.
&gt;
&gt;
&gt; With having to reload the certificate every time it has to re-read the
&gt; certificates after every
&gt; fork.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/638539/325660/simple_socket_class_ssl.pl">Download simple_socket_class_ssl.pl</a><br />
<span class="downloadcontenttype">text/x-perl 3.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-640120" href="/Public/Bug/Display.html?id=48066#txn-640120">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;27&nbsp;01:46:11&nbsp;2009</span>
    <span class="description">nick [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> nick [...] cpanel.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/640120/327028/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/327028">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Its working, however perl is seg faulting on exit on my test machine.

In XS_Socket__Class_END
                    ==&gt;    sc2 = sc1-&gt;next; &lt;== segfaults here if I create the ctx after the Socket 
object


             ==&gt;           socket_class_free&#40; sc1 &#41;; &lt;== segfaults here if I create the Socket after the 
ctx


On Sat Jul 25 20:34:33 2009, christian@hbr1.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2.25 supports shared ssl contexts.
&gt; hope it works as expected.
&gt; the modified server script is attached.
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt;        Queue: Socket-Class
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48066">https://rt.cpan.org/Ticket/Display.html?id=48066</a></span> &gt;
&gt; &gt;
&gt; &gt; The DoS problem is confirmed fixed, however the downside is that the ssl
&gt; &gt; context cannot be
&gt; &gt; reused.  Its fastest to init in the parent, and then reuse in the child.
&gt; &gt; IO::Socket::SSL supports
&gt; &gt; its as follows:
&gt; &gt;
&gt; &gt;
&gt; &gt; SSL_reuse_ctx
&gt; &gt; If you have already set the above options &#40;SSL_version through
&gt; &gt; SSL_check_crl; this does not
&gt; &gt; include SSL_cipher_list yet&#41; for a previous instance of IO::Socket::SSL,
&gt; &gt; then you can reuse the
&gt; &gt; SSL context of that instance by passing it as the value for the
&gt; &gt; SSL_reuse_ctx parameter. You
&gt; &gt; may also create a new instance of the IO::Socket::SSL::SSL_Context class,
&gt; &gt; using any context
&gt; &gt; options that you desire without specifying connection options, and pass
&gt; &gt; that here instead.
&gt; &gt;
&gt; &gt; If you use this option, all other context-related options that you pass in
&gt; &gt; the same call to
&gt; &gt; new&#40;&#41; will be ignored unless the context supplied was invalid. Note that,
&gt; &gt; contrary to versions
&gt; &gt; of IO::Socket::SSL below v0.90, a global SSL context will not be
&gt; &gt; implicitly used unless you use
&gt; &gt; the set_default_context&#40;&#41; function.
&gt; &gt;
&gt; &gt;
&gt; &gt; With having to reload the certificate every time it has to re-read the
&gt; &gt; certificates after every
&gt; &gt; fork.
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.230613</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
