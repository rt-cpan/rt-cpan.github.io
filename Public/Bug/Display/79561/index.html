<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79561 for Sereal-Decoder: Chunked decoding support</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79561 for Sereal-Decoder: Chunked decoding support</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Sereal-Decoder">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Sereal-Decoder">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Sereal-Decoder">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Sereal-Decoder">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/Sereal/Sereal/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sereal-Decoder">Sereal-Decoder CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79561</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Sereal-Decoder">Sereal-Decoder</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dolmen [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-245622-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-245623-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=79561">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1118674" href="/Public/Bug/Display.html?id=79561#txn-1118674">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;11&nbsp;03:59:24&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Streaming support</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1118674/588483/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588483">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 553b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
For use in network protocol it would be helpful to have a chunked decoder.

Requirements:
- receive a buffer, consume data up to a single complete packet, and
report if the packet is complete or not.
- do not consume more that one packet
- either:
   - consume &#40;remove&#41; the used data from the original buffer but keep
the non used bytes
   - do not consume, but report the count of used bytes


That could be useful to build an AnyEvent read_type &#40;look for
::anyevent_read_type in AnyEvent::Handle&#41;.


-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1118677" href="/Public/Bug/Display.html?id=79561#txn-1118677">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;11&nbsp;04:03:52&nbsp;2012</span>
    <span class="description">demerphq [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79561] Streaming support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Sep 2012 10:03:43 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sereal-Decoder [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> demerphq &lt;demerphq [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1118677/588486/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588486">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 11 September 2012 09:59, Olivier Mengué via RT
&lt;bug-Sereal-Decoder@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Sep 11 03:59:24 2012: Request 79561 was acted upon.
&gt; Transaction: Ticket created by DOLMEN
&gt;        Queue: Sereal-Decoder
&gt;      Subject: Streaming support
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: Wishlist
&gt;        Owner: Nobody
&gt;   Requestors: dolmen@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79561">https://rt.cpan.org/Ticket/Display.html?id=79561</a></span> &gt;
&gt;
&gt;
&gt;
&gt; For use in network protocol it would be helpful to have a chunked decoder.
&gt;
&gt; Requirements:
&gt; - receive a buffer, consume data up to a single complete packet, and
&gt; report if the packet is complete or not.
&gt; - do not consume more that one packet
&gt; - either:
&gt;    - consume &#40;remove&#41; the used data from the original buffer but keep
&gt; the non used bytes
&gt;    - do not consume, but report the count of used bytes
&gt;
&gt;
&gt; That could be useful to build an AnyEvent read_type &#40;look for
&gt; ::anyevent_read_type in AnyEvent::Handle&#41;.
</div>
Hi, thanks, interesting. We will think about this. Some support for
this is built in, but not all of it.

Yves


-- 
perl -Mre=debug -e &#34;/just|another|perl|hacker/&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1118680" href="/Public/Bug/Display.html?id=79561#txn-1118680">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;11&nbsp;04:03:53&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1118860" href="/Public/Bug/Display.html?id=79561#txn-1118860">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;11&nbsp;13:18:09&nbsp;2012</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79561] Streaming support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Sep 2012 19:17:53 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sereal-Decoder [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1118860/588601/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588601">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 09/11/2012 09:59 AM, Olivier Mengué via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Sep 11 03:59:24 2012: Request 79561 was acted upon.
&gt; Transaction: Ticket created by DOLMEN
&gt;         Queue: Sereal-Decoder
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For use in network protocol it would be helpful to have a chunked decoder.
&gt;
&gt; Requirements:
&gt; - receive a buffer, consume data up to a single complete packet, and
&gt; report if the packet is complete or not.
&gt; - do not consume more that one packet
&gt; - either:
&gt;     - consume &#40;remove&#41; the used data from the original buffer but keep
&gt; the non used bytes
&gt;     - do not consume, but report the count of used bytes
&gt;
&gt;
&gt; That could be useful to build an AnyEvent read_type &#40;look for
&gt; ::anyevent_read_type in AnyEvent::Handle&#41;.
</div>
Interesting. Well, within a given Sereal packet, we will never achieve 
&#34;proper&#34; streaming. Our back-reference logic may requires being able to 
jump forward and backward within the string buffer that holds the Sereal 
packet. But what&#39;s possible &#40;already now&#41; is concatenating multiple 
Sereal packets and then while&#40;&#41;{} ing over them. To wit from the docs 
&#40;with a bug fix&#41;:

   my @out;
   my $pos = 0;
   eval {
     while &#40;1&#41; {
       push @out, $decoder-&gt;decode_with_offset&#40;$sereal_string, 0&#41;;
       $pos += $decoder-&gt;bytes_consumed;
       last if $pos &gt;= length&#40;$sereal_string&#41;
            or not $decoder-&gt;bytes_consumed;
     }
   };

This is untested and obviously needs proper exception handling, etc. But 
the point is that you can provide an offset and determine the number of 
bytes consumed.

--Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1118863" href="/Public/Bug/Display.html?id=79561#txn-1118863">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;11&nbsp;13:20:41&nbsp;2012</span>
    <span class="description">demerphq [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79561] Streaming support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Sep 2012 19:20:30 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sereal-Decoder [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> demerphq &lt;demerphq [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1118863/588604/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588604">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 11 September 2012 19:18, Steffen Mueller via RT
&lt;bug-Sereal-Decoder@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Sereal-Decoder
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79561">https://rt.cpan.org/Ticket/Display.html?id=79561</a></span> &gt;
&gt;
&gt; On 09/11/2012 09:59 AM, Olivier Mengué via RT wrote:
<div class="message-stanza open">&gt;&gt; Tue Sep 11 03:59:24 2012: Request 79561 was acted upon.
&gt;&gt; Transaction: Ticket created by DOLMEN
&gt;&gt;         Queue: Sereal-Decoder
</div>&gt;
<div class="message-stanza open">&gt;&gt; For use in network protocol it would be helpful to have a chunked decoder.
&gt;&gt;
&gt;&gt; Requirements:
&gt;&gt; - receive a buffer, consume data up to a single complete packet, and
&gt;&gt; report if the packet is complete or not.
&gt;&gt; - do not consume more that one packet
&gt;&gt; - either:
&gt;&gt;     - consume &#40;remove&#41; the used data from the original buffer but keep
&gt;&gt; the non used bytes
&gt;&gt;     - do not consume, but report the count of used bytes
&gt;&gt;
&gt;&gt;
&gt;&gt; That could be useful to build an AnyEvent read_type &#40;look for
&gt;&gt; ::anyevent_read_type in AnyEvent::Handle&#41;.
</div>&gt;
&gt; Interesting. Well, within a given Sereal packet, we will never achieve
&gt; &#34;proper&#34; streaming. Our back-reference logic may requires being able to
&gt; jump forward and backward within the string buffer that holds the Sereal
&gt; packet. But what&#39;s possible &#40;already now&#41; is concatenating multiple
&gt; Sereal packets and then while&#40;&#41;{} ing over them. To wit from the docs
&gt; &#40;with a bug fix&#41;:
&gt;
&gt;    my @out;
&gt;    my $pos = 0;
&gt;    eval {
&gt;      while &#40;1&#41; {
&gt;        push @out, $decoder-&gt;decode_with_offset&#40;$sereal_string, 0&#41;;
&gt;        $pos += $decoder-&gt;bytes_consumed;
&gt;        last if $pos &gt;= length&#40;$sereal_string&#41;
&gt;             or not $decoder-&gt;bytes_consumed;
&gt;      }
&gt;    };
&gt;
&gt; This is untested and obviously needs proper exception handling, etc. But
&gt; the point is that you can provide an offset and determine the number of
&gt; bytes consumed.
</div>
We could provide a way to passthrough length data in the header, which
would allow us to know when a packet has been read.

Yves


-- 
perl -Mre=debug -e &#34;/just|another|perl|hacker/&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119013" href="/Public/Bug/Display.html?id=79561#txn-1119013">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;02:01:11&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Chunked decoding support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> smueller [...] cpan.org, demerphq [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119013/588697/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588697">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2012-09-11 19:18:09, SMUELLER a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Interesting. Well, within a given Sereal packet, we will never achieve 
&gt; &#34;proper&#34; streaming.
</div>
That&#39;s not what I&#39;m asking for.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Our back-reference logic may requires being able to 
&gt; jump forward and backward within the string buffer that holds the Sereal 
&gt; packet.
</div>
That is fine. At least the serialisation protocol should allows a
decoder to be able to detect packet boundaries without relying only on
the size of the input buffer.
Is Sereal clean on that matter?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But what&#39;s possible &#40;already now&#41; is concatenating multiple 
&gt; Sereal packets and then while&#40;&#41;{} ing over them. To wit from the docs 
&gt; &#40;with a bug fix&#41;:
&gt; 
&gt;    my @out;
&gt;    my $pos = 0;
&gt;    eval {
&gt;      while &#40;1&#41; {
&gt;        push @out, $decoder-&gt;decode_with_offset&#40;$sereal_string, 0&#41;;
&gt;        $pos += $decoder-&gt;bytes_consumed;
&gt;        last if $pos &gt;= length&#40;$sereal_string&#41;
&gt;             or not $decoder-&gt;bytes_consumed;
&gt;      }
&gt;    };
</div>
What I&#39;m asking for is for a stateful decoder that works when
$sereal_string is not a complete Sereal buffer and that, when fed, can
report if it got too few or too much data. When it has a full packet it
can return it decoded.
This could allow to put in a binary stream various packets encoded using
different encoders &#40;the application writing/reading the stream is
responsible for calling successively each decoder as appropriate&#41;.

AnyEvent supports this with JSON &#40;thanks to JSON::XS&#41; has this capability.
MessagePack has some partial support &#40;Data::MessagePack::Stream&#41;, but it
is incomplete &#40;it doesn&#39;t report the consumed bytes, so MessagePack
packets can&#39;t be mixed with other packets&#41;.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119016" href="/Public/Bug/Display.html?id=79561#txn-1119016">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;02:01:41&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Subject changed from &#39;Streaming support&#39; to &#39;Chunked decoding support&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119030" href="/Public/Bug/Display.html?id=79561#txn-1119030">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;02:39:39&nbsp;2012</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119030/588710/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588710">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe that the Sereal decoder should mostly do what you want if I 
understand you correctly. Given the example code I pasted, you&#39;ll get an 
exception from Sereal::Decoder on invalid input data/premature end of 
packet. Now, we could try to at least record the approximate position in 
the buffer when an exception occurs. But I doubt that we will be able to 
make the decoder signal to you that there&#39;s data missing and then 
restart from where it left off with the next chunk. That would be 
exceedingly difficult.

What we could do, however, is to embed the length of the packet in the 
header at a fixed position &#40;but optional, based on a flag which is in a 
fixed position after the magic string&#41; or something like that. This 
would allow you to assert that you read enough data to deserialize.

The practical problem that this poses to the encoder is that it has to 
go back to the beginning of the buffer and insert the length of the 
output &#40;which it only knows after it&#39;s done serializing&#41;. This is easy 
to do if we reserve a fixed four or eight bytes for the length, but hard 
&#40;or slow&#41; if we want a variable-length &#40;ie. compact&#41; integer 
representation for the packet length.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119033" href="/Public/Bug/Display.html?id=79561#txn-1119033">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;02:47:13&nbsp;2012</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119033/588713/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588713">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 171b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oh, as for embedding packet lengths: Doing that is really easy in your 
application/protocol. It&#39;s simply doing very basic framing &#40;which you 
probably need to do anyway&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119036" href="/Public/Bug/Display.html?id=79561#txn-1119036">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;02:48:11&nbsp;2012</span>
    <span class="description">demerphq [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79561] Chunked decoding support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 12 Sep 2012 08:48:01 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sereal-Decoder [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> demerphq &lt;demerphq [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119036/588716/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588716">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12 September 2012 08:39, Steffen Mueller via RT
&lt;bug-Sereal-Decoder@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Sereal-Decoder
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79561">https://rt.cpan.org/Ticket/Display.html?id=79561</a></span> &gt;
&gt;
&gt; I believe that the Sereal decoder should mostly do what you want if I
&gt; understand you correctly. Given the example code I pasted, you&#39;ll get an
&gt; exception from Sereal::Decoder on invalid input data/premature end of
&gt; packet. Now, we could try to at least record the approximate position in
&gt; the buffer when an exception occurs. But I doubt that we will be able to
&gt; make the decoder signal to you that there&#39;s data missing and then
&gt; restart from where it left off with the next chunk. That would be
&gt; exceedingly difficult.
</div>
Actually I don&#39;t know that that is really the case.  It would be time
consuming to do in that it would require a complete rewrite of the
current decoder but I think &#34;exceedingly difficult&#34; is a bit strong.
Anyway, it definitely is not on MY todo list.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What we could do, however, is to embed the length of the packet in the
&gt; header at a fixed position &#40;but optional, based on a flag which is in a
&gt; fixed position after the magic string&#41; or something like that. This
&gt; would allow you to assert that you read enough data to deserialize.
&gt;
&gt; The practical problem that this poses to the encoder is that it has to
&gt; go back to the beginning of the buffer and insert the length of the
&gt; output &#40;which it only knows after it&#39;s done serializing&#41;. This is easy
&gt; to do if we reserve a fixed four or eight bytes for the length, but hard
&gt; &#40;or slow&#41; if we want a variable-length &#40;ie. compact&#41; integer
&gt; representation for the packet length.
</div>
Considering that the current encoder does not stream to secondary
media its actually not that difficult to make this reasonably fast.

Another option would be to support a validation mode in the decoder.

Yves


-- 
perl -Mre=debug -e &#34;/just|another|perl|hacker/&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119039" href="/Public/Bug/Display.html?id=79561#txn-1119039">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;03:05:46&nbsp;2012</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119039/588719/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588719">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 944b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 12 02:48:11 2012, demerphq@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually I don&#39;t know that that is really the case.  It would be time
&gt; consuming to do in that it would require a complete rewrite of the
&gt; current decoder but I think &#34;exceedingly difficult&#34; is a bit strong.
&gt; Anyway, it definitely is not on MY todo list.
</div>
Fair point. And it&#39;s not high on my list either.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Considering that the current encoder does not stream to secondary
&gt; media its actually not that difficult to make this reasonably fast.
&gt; 
&gt; Another option would be to support a validation mode in the decoder.
</div>
Yeah, I guess &#34;slow&#34; and &#34;fast&#34; are rather relative terms here. How slow 
is it to do a single memcpy of a medium-size string? Probably not really 
all that slow. Doing any better than that is tricky, though: In Perl, 
there&#39;s the offset hack that can help avoid the memcpy, but we&#39;ll be 
damning tentative other encoder implementations that don&#39;t have this 
trick.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119047" href="/Public/Bug/Display.html?id=79561#txn-1119047">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;03:17:31&nbsp;2012</span>
    <span class="description">demerphq [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79561] Chunked decoding support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 12 Sep 2012 09:17:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sereal-Decoder [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> demerphq &lt;demerphq [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119047/588722/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588722">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12 September 2012 09:05, Steffen Mueller via RT
&lt;bug-Sereal-Decoder@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Sereal-Decoder
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79561">https://rt.cpan.org/Ticket/Display.html?id=79561</a></span> &gt;
&gt;
&gt; On Wed Sep 12 02:48:11 2012, demerphq@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; Actually I don&#39;t know that that is really the case.  It would be time
&gt;&gt; consuming to do in that it would require a complete rewrite of the
&gt;&gt; current decoder but I think &#34;exceedingly difficult&#34; is a bit strong.
&gt;&gt; Anyway, it definitely is not on MY todo list.
</div>&gt;
&gt; Fair point. And it&#39;s not high on my list either.
&gt;
<div class="message-stanza open">&gt;&gt; Considering that the current encoder does not stream to secondary
&gt;&gt; media its actually not that difficult to make this reasonably fast.
&gt;&gt;
&gt;&gt; Another option would be to support a validation mode in the decoder.
</div>&gt;
&gt; Yeah, I guess &#34;slow&#34; and &#34;fast&#34; are rather relative terms here. How slow
&gt; is it to do a single memcpy of a medium-size string? Probably not really
&gt; all that slow. Doing any better than that is tricky, though: In Perl,
&gt; there&#39;s the offset hack that can help avoid the memcpy, but we&#39;ll be
&gt; damning tentative other encoder implementations that don&#39;t have this
&gt; trick.
</div>
IMO we aren&#39;t really damming them.

Most languages will have a way to do the same kind of &#34;pointer into a
buffer&#34; trick. At its simplest form you wrap a larger buffer in an
object with an offset that use with substr&#40;&#41; &#40;think about how you
would solve this in Perl without exploiting OOK.&#41;

But I dont think its up to us to solve this problem in any language
other than C and Perl.

Those implementing this in other languages will figure stuff out I am very sure.

cheers,
Yves




-- 
perl -Mre=debug -e &#34;/just|another|perl|hacker/&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119872" href="/Public/Bug/Display.html?id=79561#txn-1119872">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;03:51:32&nbsp;2012</span>
    <span class="description">MAXS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119872/589123/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589123">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Mer 12 Sep 2012 02:39:39, SMUELLER a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I believe that the Sereal decoder should mostly do what you want if I 
&gt; understand you correctly. Given the example code I pasted, you&#39;ll get an 
&gt; exception from Sereal::Decoder on invalid input data/premature end of 
&gt; packet. Now, we could try to at least record the approximate position in 
&gt; the buffer when an exception occurs. But I doubt that we will be able to 
&gt; make the decoder signal to you that there&#39;s data missing and then 
&gt; restart from where it left off with the next chunk. That would be 
&gt; exceedingly difficult.
&gt; 
&gt; What we could do, however, is to embed the length of the packet in the 
&gt; header at a fixed position &#40;but optional, based on a flag which is in a 
&gt; fixed position after the magic string&#41; or something like that. This 
&gt; would allow you to assert that you read enough data to deserialize.
&gt; 
&gt; The practical problem that this poses to the encoder is that it has to 
&gt; go back to the beginning of the buffer and insert the length of the 
&gt; output &#40;which it only knows after it&#39;s done serializing&#41;. This is easy 
&gt; to do if we reserve a fixed four or eight bytes for the length, but hard 
&gt; &#40;or slow&#41; if we want a variable-length &#40;ie. compact&#41; integer 
&gt; representation for the packet length.
</div>
After reading your explanations, if we can&#39;t distinguish the premature
end of data from the encoding error, I think it would be better to add
the length at the AnyEvent &#40;or any other &#34;streamer&#34;&#41; level, like it does
for the Storable case with a pack&#40;&#39;w&#39;, $length&#41;. Note that POE does the
same but using &#34;$length\0...&#34;.

It would be easier for everyone, streamers and packers... :&#41;

Max.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119892" href="/Public/Bug/Display.html?id=79561#txn-1119892">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;07:21:54&nbsp;2012</span>
    <span class="description">MAXS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119892/589132/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589132">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 131b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Implementation of AnyEvent::Sereal :
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/maxatome/p5-anyevent-sereal">https://github.com/maxatome/p5-anyevent-sereal</a></span> using the same way as
Storable.

Regards,

Max.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119971" href="/Public/Bug/Display.html?id=79561#txn-1119971">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;09:58:38&nbsp;2012</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> demerphq [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119971/589177/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589177">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 679b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 14 07:21:54 2012, MAXS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Implementation of AnyEvent::Sereal :
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/maxatome/p5-anyevent-sereal">https://github.com/maxatome/p5-anyevent-sereal</a></span> using the same way as
&gt; Storable.
</div>
That&#39;s awesome, thank you very much!

Minor comments: You&#39;ll improve performance if you use the OO interface 
since that can reuse various structures and options. Furthermore, you 
might want to give users a way to provide options for the serializer and 
deserializer. For example, Sereal supports Snappy compression and 
whether or not you need it depends on your particular application.

Thanks again for using our software. If you have any feedback, we&#39;d be 
very interested in hearing it.

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1120661" href="/Public/Bug/Display.html?id=79561#txn-1120661">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;03:05:53&nbsp;2012</span>
    <span class="description">MAXS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> smueller [...] cpan.org, demerphq [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1120661/589543/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589543">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Ven 14 Sep 2012 09:58:38, SMUELLER a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Sep 14 07:21:54 2012, MAXS wrote:
<div class="message-stanza open">&gt; &gt; Implementation of AnyEvent::Sereal :
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/maxatome/p5-anyevent-sereal">https://github.com/maxatome/p5-anyevent-sereal</a></span> using the same way as
&gt; &gt; Storable.
</div>&gt; 
&gt; That&#39;s awesome, thank you very much!
&gt; 
&gt; Minor comments: You&#39;ll improve performance if you use the OO interface 
&gt; since that can reuse various structures and options. Furthermore, you 
&gt; might want to give users a way to provide options for the serializer and 
&gt; deserializer. For example, Sereal supports Snappy compression and 
&gt; whether or not you need it depends on your particular application.
</div>
I did it, and you are right it is particularly faster. :&#41;

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/AnyEvent::Sereal">https://metacpan.org/module/AnyEvent::Sereal</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Thanks again for using our software. If you have any feedback, we&#39;d be 
&gt; very interested in hearing it.
</div>
One thing at this time: it could be cool to have croak_on_bless option
on the decoder side. If the source of the stream can not be trusted, it
could be fine to avoid instantiation of objects when decoding it...

Best regards,

Max.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1120669" href="/Public/Bug/Display.html?id=79561#txn-1120669">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;03:23:55&nbsp;2012</span>
    <span class="description">demerphq [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79561] Chunked decoding support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 17 Sep 2012 09:23:41 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sereal-Decoder [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> demerphq &lt;demerphq [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1120669/589550/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589550">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 17 September 2012 09:05, Maxime Soulé via RT
&lt;bug-Sereal-Decoder@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79561">https://rt.cpan.org/Ticket/Display.html?id=79561</a></span> &gt;
&gt;
&gt; Le Ven 14 Sep 2012 09:58:38, SMUELLER a écrit :
<div class="message-stanza open">&gt;&gt; On Fri Sep 14 07:21:54 2012, MAXS wrote:
<div class="message-stanza open">&gt;&gt; &gt; Implementation of AnyEvent::Sereal :
&gt;&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/maxatome/p5-anyevent-sereal">https://github.com/maxatome/p5-anyevent-sereal</a></span> using the same way as
&gt;&gt; &gt; Storable.
</div>&gt;&gt;
&gt;&gt; That&#39;s awesome, thank you very much!
&gt;&gt;
&gt;&gt; Minor comments: You&#39;ll improve performance if you use the OO interface
&gt;&gt; since that can reuse various structures and options. Furthermore, you
&gt;&gt; might want to give users a way to provide options for the serializer and
&gt;&gt; deserializer. For example, Sereal supports Snappy compression and
&gt;&gt; whether or not you need it depends on your particular application.
</div>&gt;
&gt; I did it, and you are right it is particularly faster. :&#41;
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/AnyEvent::Sereal">https://metacpan.org/module/AnyEvent::Sereal</a></span>
&gt;
<div class="message-stanza open">&gt;&gt;
&gt;&gt; Thanks again for using our software. If you have any feedback, we&#39;d be
&gt;&gt; very interested in hearing it.
</div>&gt;
&gt; One thing at this time: it could be cool to have croak_on_bless option
&gt; on the decoder side. If the source of the stream can not be trusted, it
&gt; could be fine to avoid instantiation of objects when decoding it...
</div>
I thought we already had this? If not it is definitely on our todo list.

BTW, we will NOT bless ANY objects until we have completely
deserialized the data structure with no errors.. IOW, we more or less
guarantee that no methods, such as DESTROY, will be called on the
object during deserialization.

Yves




-- 
perl -Mre=debug -e &#34;/just|another|perl|hacker/&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1120733" href="/Public/Bug/Display.html?id=79561#txn-1120733">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;07:21:53&nbsp;2012</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1120733/589599/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589599">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 17 03:23:55 2012, demerphq@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 17 September 2012 09:05, Maxime Soulé via RT
&gt; &lt;bug-Sereal-Decoder@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79561">https://rt.cpan.org/Ticket/Display.html?id=79561</a></span> &gt;
&gt; &gt;
&gt; &gt; One thing at this time: it could be cool to have croak_on_bless 
</div></div>option
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; on the decoder side. If the source of the stream can not be trusted, 
</div></div>it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; could be fine to avoid instantiation of objects when decoding it...
</div>&gt; 
&gt; I thought we already had this? If not it is definitely on our todo 
</div>list.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; BTW, we will NOT bless ANY objects until we have completely
&gt; deserialized the data structure with no errors.. IOW, we more or less
&gt; guarantee that no methods, such as DESTROY, will be called on the
&gt; object during deserialization.
</div>
We didn&#39;t. Ooops. Oversight. This check was available only on the 
encoder side since that&#39;s what WE need at work. I just pushed a change 
to implement such an option in the decoder. Will be in the next release.

Related note: Please report issues in a separate bug report/whatever. 
Having a giant unrelated thread in the &#34;Chunked decoding support&#34; ticket 
doesn&#39;t help. :&#41;

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.769735</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
