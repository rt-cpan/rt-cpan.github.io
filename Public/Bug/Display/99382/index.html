<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #99382 for List-BinarySearch: Enhacement suggestion: A binsearch_pos method with an exact/best_position indication</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #99382 for List-BinarySearch: Enhacement suggestion: A binsearch_pos method with an exact/best_position indication</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/List-BinarySearch/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/List-BinarySearch/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/List-BinarySearch/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/List-BinarySearch/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/daoswald/List-BinarySearch/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/List-BinarySearch">List-BinarySearch CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">99382</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">20 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/List-BinarySearch/Active/">List-BinarySearch</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">davido [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
meir [...] guttman.co.il

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-243548-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-243549-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.20    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;10:05:31&nbsp;2014</span>
    <span class="description">meir [...] guttman.co.il -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Enhacement suggestion: A binsearch_pos method with an exact/best_position indication</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 08 Oct 2014 17:05:16 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-List-BinarySearch [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Meir Guttman &lt;meir [...] guttman.co.il&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear David,
First thank you for a very useful, easy to use and exceptionally documented
module.
I would like to have a forth method, &#34;binsearch_best_effort&#34; &#40;other name
suggestions are more than welcome&#41; that report
    1&#41; Whatever  &#39;binsearch_pos&#39; returns, but also ...
    2&#41; ... an indication whether it is an exact match or is it the best
insertion point.
The second item, the indication, could be either a second scalar or a
negative index.

Running first binsearch and then binsearch_pos if the first returns &#39;undef&#39;
seems ... ugly.

Distribution: List::BinarySearch v.0.20
Perl version: All &#40;although I am now on v.5.18.2&#41;
OS: All &#40;although I am on Win-7 Pro 64 bit&#41;

Regards,
Meir
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;12:24:08&nbsp;2014</span>
    <span class="description">davido [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">20 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 08 07:05:31 2014, meir@guttman.co.il wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would like to have a forth method, &#34;binsearch_best_effort&#34; &#40;other name
&gt; suggestions are more than welcome&#41; that report
&gt;     1&#41; Whatever  &#39;binsearch_pos&#39; returns, but also ...
&gt;     2&#41; ... an indication whether it is an exact match or is it the best
&gt; insertion point.
&gt; The second item, the indication, could be either a second scalar or a
&gt; negative index.
&gt; 
&gt; Running first binsearch and then binsearch_pos if the first returns &#39;undef&#39;
&gt; seems ... ugly.
</div>
Thanks for your interest in, and support of this module.  I&#39;m glad you find it useful.

I considered an approach similar to what you are suggesting while designing the module, but ultimately decided against it.  I&#39;ll try to explain my rationale.

First, it&#39;s unnecessary to do two searches.  One simply needs to check that $needle is a match for $haystack[$pos].

For example:

    my $pos = binsearch_pos { $a cmp $b } $needle, @haystack;
    if&#40; $needle eq $haystack[$pos] &#41; {
      print &#34;Match at $pos.\n&#34;;
    }
    else {
      print &#34;Insert at $pos.\n&#34;;
    }

As you can see here, we&#39;re only doing one search.  It&#39;s trivial to detect whether the element at $pos is a match or not.

Now consider the following code:

    use strict;
    use warnings;
    use feature &#39;say&#39;;
    
    use List::BinarySearch &#39;binsearch_pos&#39;;
    
    # Draft implementation:
    sub binsearch_pos_exact &#40;&#38;$\@&#41; {
      my&#40; $comparator, $needle, $haystack_aref &#41; = @_;
      my $res = binsearch_pos {$comparator-&gt;&#40;&#41;} $needle, @{$haystack_aref};
      local&#40; $a, $b &#41; = &#40; $needle, $haystack_aref-&gt;[$res] &#41;;
      return&#40; $res, !&#40; $comparator-&gt;&#40;&#41; &#41; &#41;;
    }
    
    
    
    
    my @haystack = &#40; &#39;a&#39; .. &#39;m&#39;, &#39;o&#39; .. &#39;z&#39; &#41;; # &#39;n&#39; is missing.
    my $needle_ok    = &#39;y&#39;;
    my $needle_nok   = &#39;n&#39;;
    
    find_pos&#40; $needle_ok,  \@haystack &#41;;
    find_pos_exact&#40; $needle_ok,  \@haystack &#41;;
    find_pos&#40; $needle_nok, \@haystack &#41;;
    find_pos_exact&#40; $needle_nok, \@haystack &#41;;
    
    
    sub find_pos {
      my&#40; $needle, $haystack_aref &#41; = @_;
    
      my $res = binsearch_pos { $a cmp $b } $needle, @{$haystack_aref};
      
      if&#40; $needle eq $haystack_aref-&gt;[$res] &#41; {
        say &#34;$needle found at $res&#34;;
      }
      else {
        say &#34;$needle not found; insert at $res&#34;;
      }
    }
    
    
    sub find_pos_exact {
      my&#40; $needle, $haystack_aref &#41; = @_;
      my&#40; $res, $exact &#41;
        = binsearch_pos_exact { $a cmp $b } $needle, @$haystack_aref;
    
      if&#40; $exact &#41; {
        say &#34;$needle found at $res&#34;;
      }
      else {
        say &#34;$needle not found; insert at $res&#34;;
      }
    }

As you can see, the new implementation requires a Boolean test inside the binsearch_pos_exact, *and* in the user&#39;s code: if&#40; $exact &#41;...

So the amount of work being done is actually greater than the user simply detecting a match himself.

Additionally, to make the solution generally useful, the final comparison inside of binsearch_pos_exact has to call out to the user-supplied comparator function.  So that&#39;s one more function call, whereas if the
user were doing the comparison, it might be acceptable to simply do a simple &#39;eq&#39; or &#39;==&#39; comparison.

Within the XS version of the module, we could make the final comparator call before tearing down the MULTICALL call-stack, so it wouldn&#39;t be terribly inefficient, but there is still a cost, and that cost is still probably greater than the user doing his own match detection.

A real-world implementation would inline the binsearch_pos code into binsearch_pos_exact, but it would still result in an extra Boolean comparison, and an extra function call to the user-supplied comparator.

So to summarize:

*  The feature request is based on the incorrect assumption that one must search twice; in reality the user only needs to detect a match using a simple comparison, as demonstrated above.  &#40; if&#40; $needle == $haystack[$pos] &#41; {... &#41;

*  The feature request would not reduce the number of Boolean comparisons being done.  The user will still need to do an if&#40;$exists&#41;{... test, as demonstrated in my second example above.

*  The feature request actually *adds* a Boolean comparison internally as well as a subroutine call to the user-supplied comparator.  So efficiency actually suffers.  This internal comparison and subroutine call is demonstrated in my second example, above.

* I believe that if&#40; $needle eq $haystack[$pos] &#41; ... is more self-documenting than if&#40; $exists &#41;...

* The feature request adds more complexity to the module without removing significant complexity from the user&#39;s code.

I&#39;m really happy when people provide suggestions because they do help me to refine my work, and sometimes make it more useful.  But in this case I&#39;m going to reject the request for the reasons summarized above.  However, I&#39;m still open to discussing it if you can show in code a use case that becomes simplified by the addition of binsearch_pos_exact.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;12:24:08&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;12:24:08&nbsp;2014</span>
    <span class="description">davido [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;12:24:09&nbsp;2014</span>
    <span class="description">davido [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;12:24:09&nbsp;2014</span>
    <span class="description">davido [...] cpan.org -  Fixed in 0.20 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;14:47:17&nbsp;2014</span>
    <span class="description">mguttman4 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99382] Enhacement suggestion: A binsearch_pos method with an exact/best_position indication</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 8 Oct 2014 21:47:05 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-List-BinarySearch [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Meir Guttman &lt;mguttman4 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear David,
Wow, what a detailed and convincing dissertation! Thank you! Well, I
shouldn&#39;t be surprised, having seen your module&#39;s documentation.
OK, yes, you convinced me. No reason to do this suggestion of mine.
So, happy searching, binary or otherwise
Meir
On Oct 8, 2014 7:24 PM, &#34;David J. Oswald via RT&#34; &lt;
bug-List-BinarySearch@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99382">https://rt.cpan.org/Ticket/Display.html?id=99382</a></span> &gt;
&gt;
&gt; On Wed Oct 08 07:05:31 2014, meir@guttman.co.il wrote:
&gt;
<div class="message-stanza open">&gt; &gt; I would like to have a forth method, &#34;binsearch_best_effort&#34; &#40;other name
&gt; &gt; suggestions are more than welcome&#41; that report
&gt; &gt;     1&#41; Whatever  &#39;binsearch_pos&#39; returns, but also ...
&gt; &gt;     2&#41; ... an indication whether it is an exact match or is it the best
&gt; &gt; insertion point.
&gt; &gt; The second item, the indication, could be either a second scalar or a
&gt; &gt; negative index.
&gt; &gt;
&gt; &gt; Running first binsearch and then binsearch_pos if the first returns
</div>&gt; &#39;undef&#39;
<div class="message-stanza open">&gt; &gt; seems ... ugly.
</div>&gt;
&gt; Thanks for your interest in, and support of this module.  I&#39;m glad you
&gt; find it useful.
&gt;
&gt; I considered an approach similar to what you are suggesting while
&gt; designing the module, but ultimately decided against it.  I&#39;ll try to
&gt; explain my rationale.
&gt;
&gt; First, it&#39;s unnecessary to do two searches.  One simply needs to check
&gt; that $needle is a match for $haystack[$pos].
&gt;
&gt; For example:
&gt;
&gt;     my $pos = binsearch_pos { $a cmp $b } $needle, @haystack;
&gt;     if&#40; $needle eq $haystack[$pos] &#41; {
&gt;       print &#34;Match at $pos.\n&#34;;
&gt;     }
&gt;     else {
&gt;       print &#34;Insert at $pos.\n&#34;;
&gt;     }
&gt;
&gt; As you can see here, we&#39;re only doing one search.  It&#39;s trivial to detect
&gt; whether the element at $pos is a match or not.
&gt;
&gt; Now consider the following code:
&gt;
&gt;     use strict;
&gt;     use warnings;
&gt;     use feature &#39;say&#39;;
&gt;
&gt;     use List::BinarySearch &#39;binsearch_pos&#39;;
&gt;
&gt;     # Draft implementation:
&gt;     sub binsearch_pos_exact &#40;&#38;$\@&#41; {
&gt;       my&#40; $comparator, $needle, $haystack_aref &#41; = @_;
&gt;       my $res = binsearch_pos {$comparator-&gt;&#40;&#41;} $needle, @{$haystack_aref};
&gt;       local&#40; $a, $b &#41; = &#40; $needle, $haystack_aref-&gt;[$res] &#41;;
&gt;       return&#40; $res, !&#40; $comparator-&gt;&#40;&#41; &#41; &#41;;
&gt;     }
&gt;
&gt;
&gt;
&gt;
&gt;     my @haystack = &#40; &#39;a&#39; .. &#39;m&#39;, &#39;o&#39; .. &#39;z&#39; &#41;; # &#39;n&#39; is missing.
&gt;     my $needle_ok    = &#39;y&#39;;
&gt;     my $needle_nok   = &#39;n&#39;;
&gt;
&gt;     find_pos&#40; $needle_ok,  \@haystack &#41;;
&gt;     find_pos_exact&#40; $needle_ok,  \@haystack &#41;;
&gt;     find_pos&#40; $needle_nok, \@haystack &#41;;
&gt;     find_pos_exact&#40; $needle_nok, \@haystack &#41;;
&gt;
&gt;
&gt;     sub find_pos {
&gt;       my&#40; $needle, $haystack_aref &#41; = @_;
&gt;
&gt;       my $res = binsearch_pos { $a cmp $b } $needle, @{$haystack_aref};
&gt;
&gt;       if&#40; $needle eq $haystack_aref-&gt;[$res] &#41; {
&gt;         say &#34;$needle found at $res&#34;;
&gt;       }
&gt;       else {
&gt;         say &#34;$needle not found; insert at $res&#34;;
&gt;       }
&gt;     }
&gt;
&gt;
&gt;     sub find_pos_exact {
&gt;       my&#40; $needle, $haystack_aref &#41; = @_;
&gt;       my&#40; $res, $exact &#41;
&gt;         = binsearch_pos_exact { $a cmp $b } $needle, @$haystack_aref;
&gt;
&gt;       if&#40; $exact &#41; {
&gt;         say &#34;$needle found at $res&#34;;
&gt;       }
&gt;       else {
&gt;         say &#34;$needle not found; insert at $res&#34;;
&gt;       }
&gt;     }
&gt;
&gt; As you can see, the new implementation requires a Boolean test inside the
&gt; binsearch_pos_exact, *and* in the user&#39;s code: if&#40; $exact &#41;...
&gt;
&gt; So the amount of work being done is actually greater than the user simply
&gt; detecting a match himself.
&gt;
&gt; Additionally, to make the solution generally useful, the final comparison
&gt; inside of binsearch_pos_exact has to call out to the user-supplied
&gt; comparator function.  So that&#39;s one more function call, whereas if the
&gt; user were doing the comparison, it might be acceptable to simply do a
&gt; simple &#39;eq&#39; or &#39;==&#39; comparison.
&gt;
&gt; Within the XS version of the module, we could make the final comparator
&gt; call before tearing down the MULTICALL call-stack, so it wouldn&#39;t be
&gt; terribly inefficient, but there is still a cost, and that cost is still
&gt; probably greater than the user doing his own match detection.
&gt;
&gt; A real-world implementation would inline the binsearch_pos code into
&gt; binsearch_pos_exact, but it would still result in an extra Boolean
&gt; comparison, and an extra function call to the user-supplied comparator.
&gt;
&gt; So to summarize:
&gt;
&gt; *  The feature request is based on the incorrect assumption that one must
&gt; search twice; in reality the user only needs to detect a match using a
&gt; simple comparison, as demonstrated above.  &#40; if&#40; $needle == $haystack[$pos]
&gt; &#41; {... &#41;
&gt;
&gt; *  The feature request would not reduce the number of Boolean comparisons
&gt; being done.  The user will still need to do an if&#40;$exists&#41;{... test, as
&gt; demonstrated in my second example above.
&gt;
&gt; *  The feature request actually *adds* a Boolean comparison internally as
&gt; well as a subroutine call to the user-supplied comparator.  So efficiency
&gt; actually suffers.  This internal comparison and subroutine call is
&gt; demonstrated in my second example, above.
&gt;
&gt; * I believe that if&#40; $needle eq $haystack[$pos] &#41; ... is more
&gt; self-documenting than if&#40; $exists &#41;...
&gt;
&gt; * The feature request adds more complexity to the module without removing
&gt; significant complexity from the user&#39;s code.
&gt;
&gt; I&#39;m really happy when people provide suggestions because they do help me
&gt; to refine my work, and sometimes make it more useful.  But in this case I&#39;m
&gt; going to reject the request for the reasons summarized above.  However, I&#39;m
&gt; still open to discussing it if you can show in code a use case that becomes
&gt; simplified by the addition of binsearch_pos_exact.
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
