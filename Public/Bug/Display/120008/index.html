<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #120008 for Test-Smoke: Test-Smoke failing to update branch being tested</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #120008 for Test-Smoke: Test-Smoke failing to update branch being tested</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-Smoke/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Smoke">Test-Smoke CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">120008</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-Smoke/Active/">Test-Smoke</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jkeenan [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31598-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31599-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;27&nbsp;11:07:33&nbsp;2017</span>
    <span class="description">jkeenan [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test-Smoke failing to update branch being tested</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a bug report which provides an additional instance of a problem originally reported to the perl.qa mailing list/newsgroup &#40;thread starting at: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.qa/2017/01/msg13734.html&#41;">http://www.nntp.perl.org/group/perl.qa/2017/01/msg13734.html&#41;</a></span>.

I have a VM of FreeBSD-10.3 in which I customarily test blead and/or smoke-me branches in the Perl 5 core distribution.  When I wish to test a smoke-me branch, I set the first line of &#39;p5smoke/install/smokecurrent.gitbranch&#39; to the name of that branch as it appears on remote &#39;origin&#39;.  I then call &#39;cd ~/p5smoke/install; sh ./smokecurrent.sh&#39; and let Test-Smoke do its thing.

On Jan 26 at about 2200 localtime &#40;Jan 27 0300 UTC&#41; I conducted a smoke test run on the &#39;smoke-me/jkeenan/130635-storable&#39; branch:

#####
$ grep -n smoke_branch jsnd6115793d6cc41755a3ed4baaa38d30653656f41.jsn 
85:      &#34;smoke_branch&#34; : &#34;smoke-me/jkeenan/130635-storable&#34;,
#####

The smoke test run -- whose report you can see at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/53530">http://perl5.test-smoke.org/report/53530</a></span> -- resulted in FAILs:

#####
Failures: &#40;common-args&#41; -Doptimize=&#34;-O2 -pipe -fstack-protector -fno-strict-aliasing&#34;
[stdio/perlio] -DDEBUGGING -Duseithreads
    ../t/porting/exec-bit.t.....................................FAILED
        97-98
    ../t/porting/podcheck.t.....................................FAILED
        183
#####

These failures had nothing to do with the branch being smoked.  That branch had been created minutes earlier by pushing one commit on top of Perl 5 blead.  Those failures occurred in blead, originating in this commit:

#####
commit 1f74a12bfce8b82144fa7fef29618af1e8023298
Author: Christian Millour &lt;cm.perl@abtela.com&gt;
Date:   Thu Jan 19 11:49:03 2017 +0100

    document nature and use of $a and $b in sort&#40;&#41;
    
    Signed-off-by: Abigail &lt;abigail@abigail.be&gt;
#####

I switched to a separate git checkout directory that I maintain on the same VM, updated and tested blead, confirmed and corrected the two test failures and pushed the corrections to blead.

#####
commit 475b224feea308464e18cc6bef788e7a152afa51
Author:     James E Keenan &lt;jkeenan@cpan.org&gt;
AuthorDate: Thu Jan 26 22:44:03 2017
Commit:     James E Keenan &lt;jkeenan@cpan.org&gt;
CommitDate: Thu Jan 26 22:45:26 2017

    Correct file mode and line lengths to keep porting tests happy.
#####

This morning I returned to that VM, moved into p5smoke/install and updated smokecurrent.gitbranch to have its first line read &#39;blead&#39;:

#####
$ head -5 smokecurrent.gitbranch 
blead
smoke-me/jkeenan/130635-storable
smoke-me/jkeenan/revert-cpan-118470
smoke-me/jkeenan/77934-threads
smoke-me/jkeenan/petdance/130519-remove-two-unused-macros
#####

I then called &#39;sh ./smokecurrent.sh&#39; to kick off another smoke test run, this time for &#39;blead&#39;.  At that point additional commits had been made to blead.  HEAD was:

#####
commit 9a7b7fba267b8910dbea2920dd675030f796320c
Author:     Yves Orton &lt;demerphq@gmail.com&gt;
AuthorDate: Fri Jan 27 04:23:05 2017
Commit:     Yves Orton &lt;demerphq@gmail.com&gt;
CommitDate: Fri Jan 27 04:23:24 2017
#####

When the smoke test run completed, however, I was surprised to see that the commit being tested -- HEAD in the p5smoke/perl-current and p5smoke/git-perl directories -- was still commit 1f74a12bfce8b82144fa7fef29618af1e8023298 -- the commit which caused the porting test errors and for which I had already pushed corrections to blead!

Here is the &#39;sysinfo&#39; element from jsn1f74a12bfce8b82144fa7fef29618af1e8023298.jsn:

#####
   &#34;sysinfo&#34; : {
      &#34;lang&#34; : null,
      &#34;smoke_date&#34; : &#34;2017-01-27 08:11:48 -0500&#34;,
      &#34;git_id&#34; : &#34;1f74a12bfce8b82144fa7fef29618af1e8023298&#34;,
      &#34;git_describe&#34; : &#34;v5.25.9-49-g1f74a12&#34;,
      &#34;osname&#34; : &#34;freebsd&#34;,
      &#34;smoker_version&#34; : &#34;0.046&#34;,
      &#34;test_jobs&#34; : &#34;8&#34;,
      &#34;smoke_revision&#34; : &#34;1.70&#34;,
      &#34;osversion&#34; : &#34;10.3-RELEASE&#34;,
      &#34;username&#34; : &#34;jkeenan&#34;,
      &#34;lc_all&#34; : null,
      &#34;smoke_branch&#34; : &#34;blead&#34;,
      &#34;smoke_perl&#34; : &#34;5.20.3&#34;,
      &#34;reporter&#34; : null,
      &#34;cpu_description&#34; : &#34;Intel&#40;R&#41; Core&#40;TM&#41; i5-4200M CPU @ 2.50GHz&#34;,
      &#34;hostname&#34; : &#34;localhost&#34;,
      &#34;cpu_count&#34; : &#34;1&#34;,
      &#34;user_note&#34; : &#34;Occasional failures observed in long-running tests in:\n    t/re/speed.t\n    t/re/speed_thr.t\n    cpan/Memoize/t/expmod_t.t\n    dist/Time-HiRes/t/alarm.t\n&#34;,
      &#34;smoke_version&#34; : &#34;1.70&#34;,
      &#34;reporter_version&#34; : &#34;0.053&#34;,
      &#34;duration&#34; : 2349,
      &#34;perl_id&#34; : &#34;5.25.10&#34;,
      &#34;config_count&#34; : 1,
      &#34;architecture&#34; : &#34;amd64&#34;
   },
#####

Not surprisingly, since &#39;blead&#39; had not been moved forward from the commit at which the porting test errors were introduced, those errors were still present:

#####
               &#34;failures&#34; : [
                  {
                     &#34;extra&#34; : [
                        &#34;97-98&#34;
                     ],
                     &#34;test&#34; : &#34;../t/porting/exec-bit.t&#34;,
                     &#34;status&#34; : &#34;FAILED&#34;
                  },
                  {
                     &#34;extra&#34; : [
                        &#34;183&#34;
                     ],
                     &#34;status&#34; : &#34;FAILED&#34;,
                     &#34;test&#34; : &#34;../t/porting/podcheck.t&#34;
                  }
#####

Here is the first part of the smokecurrent.log for this run -- with some comments:

#####
[2017-01-27 08:11:22-0500] Read configuration from: /usr/home/jkeenan/p5smoke/install/smokecurrent_config
[2017-01-27 08:11:22-0500] Commitlevel before sync: d6115793d6cc41755a3ed4baaa38d30653656f41

# d611579 was HEAD in the previous branch being smoked: smoke-me/jkeenan/130635-storable

[2017-01-27 08:11:22-0500] ==&gt; Starting synctree
[2017-01-27 08:11:22-0500] Reading branch to smoke from: &#39;/usr/home/jkeenan/p5smoke/install/smokecurrent.gitbranch&#39;
[2017-01-27 08:11:22-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/git-perl&#41; running:
[2017-01-27 08:11:22-0500] qx[/usr/local/bin/git pull --all]
From git://perl5.git.perl.org/perl
   1f74a12..9a7b7fb  blead      -&gt; origin/blead
[2017-01-27 08:11:37-0500] Fetching origin
[2017-01-27 08:11:37-0500] Already up-to-date.
[2017-01-27 08:11:37-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/git-perl&#41; running:
[2017-01-27 08:11:37-0500] qx[/usr/local/bin/git remote prune origin]
[2017-01-27 08:11:38-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/git-perl&#41; running:
[2017-01-27 08:11:38-0500] qx[/usr/local/bin/git checkout blead
[2017-01-27 08:11:38-0500]  2&gt;&#38;1]
Switched to branch &#39;blead&#39;
[2017-01-27 08:11:41-0500] Your branch is behind &#39;origin/blead&#39; by 7 commits, and can be fast-forwarded.
[2017-01-27 08:11:41-0500]   &#40;use &#34;git pull&#34; to update your local branch&#41;

# Note: No indication that &#39;git pull&#39; was actually run!  Why not?

[2017-01-27 08:11:41-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/perl-current&#41; running:
[2017-01-27 08:11:41-0500] qx[/usr/local/bin/git reset --hard]

# Note: Although &#39;man git-reset&#39; is not explicit about this, we can probably assume
# that &#39;git reset --hard&#39; with no &lt;commit&gt; resets to HEAD -- i.e., no update to checkout.

[2017-01-27 08:11:43-0500] HEAD is now at d611579 Fix stack buffer overflow in deserialization of hooks.
#####

So why does Test-Smoke not update the branch being tested in cases like this?

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;29&nbsp;09:06:25&nbsp;2017</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> demerphq [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 27 11:07:33 2017, JKEENAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is a bug report which provides an additional instance of a
&gt; problem originally reported to the perl.qa mailing list/newsgroup
&gt; &#40;thread starting at:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.qa/2017/01/msg13734.html&#41;">http://www.nntp.perl.org/group/perl.qa/2017/01/msg13734.html&#41;</a></span>.
&gt; 
&gt; I have a VM of FreeBSD-10.3 in which I customarily test blead and/or
&gt; smoke-me branches in the Perl 5 core distribution.  When I wish to
&gt; test a smoke-me branch, I set the first line of
&gt; &#39;p5smoke/install/smokecurrent.gitbranch&#39; to the name of that branch as
&gt; it appears on remote &#39;origin&#39;.  I then call &#39;cd ~/p5smoke/install; sh
&gt; ./smokecurrent.sh&#39; and let Test-Smoke do its thing.
&gt; 
&gt; On Jan 26 at about 2200 localtime &#40;Jan 27 0300 UTC&#41; I conducted a
&gt; smoke test run on the &#39;smoke-me/jkeenan/130635-storable&#39; branch:
&gt; 
&gt; #####
&gt; $ grep -n smoke_branch jsnd6115793d6cc41755a3ed4baaa38d30653656f41.jsn
&gt; 85:      &#34;smoke_branch&#34; : &#34;smoke-me/jkeenan/130635-storable&#34;,
&gt; #####
&gt; 
&gt; The smoke test run -- whose report you can see at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test">http://perl5.test</a></span>-
&gt; smoke.org/report/53530 -- resulted in FAILs:
&gt; 
&gt; #####
&gt; Failures: &#40;common-args&#41; -Doptimize=&#34;-O2 -pipe -fstack-protector -fno-
&gt; strict-aliasing&#34;
&gt; [stdio/perlio] -DDEBUGGING -Duseithreads
&gt;     ../t/porting/exec-bit.t.....................................FAILED
&gt;         97-98
&gt;     ../t/porting/podcheck.t.....................................FAILED
&gt;         183
&gt; #####
&gt; 
&gt; These failures had nothing to do with the branch being smoked.  That
&gt; branch had been created minutes earlier by pushing one commit on top
&gt; of Perl 5 blead.  Those failures occurred in blead, originating in
&gt; this commit:
&gt; 
&gt; #####
&gt; commit 1f74a12bfce8b82144fa7fef29618af1e8023298
&gt; Author: Christian Millour &lt;cm.perl@abtela.com&gt;
&gt; Date:   Thu Jan 19 11:49:03 2017 +0100
&gt; 
&gt; document nature and use of $a and $b in sort&#40;&#41;
&gt; 
&gt; Signed-off-by: Abigail &lt;abigail@abigail.be&gt;
&gt; #####
&gt; 
&gt; I switched to a separate git checkout directory that I maintain on the
&gt; same VM, updated and tested blead, confirmed and corrected the two
&gt; test failures and pushed the corrections to blead.
&gt; 
&gt; #####
&gt; commit 475b224feea308464e18cc6bef788e7a152afa51
&gt; Author:     James E Keenan &lt;jkeenan@cpan.org&gt;
&gt; AuthorDate: Thu Jan 26 22:44:03 2017
&gt; Commit:     James E Keenan &lt;jkeenan@cpan.org&gt;
&gt; CommitDate: Thu Jan 26 22:45:26 2017
&gt; 
&gt; Correct file mode and line lengths to keep porting tests happy.
&gt; #####
&gt; 
&gt; This morning I returned to that VM, moved into p5smoke/install and
&gt; updated smokecurrent.gitbranch to have its first line read &#39;blead&#39;:
&gt; 
&gt; #####
&gt; $ head -5 smokecurrent.gitbranch
&gt; blead
&gt; smoke-me/jkeenan/130635-storable
&gt; smoke-me/jkeenan/revert-cpan-118470
&gt; smoke-me/jkeenan/77934-threads
&gt; smoke-me/jkeenan/petdance/130519-remove-two-unused-macros
&gt; #####
&gt; 
&gt; I then called &#39;sh ./smokecurrent.sh&#39; to kick off another smoke test
&gt; run, this time for &#39;blead&#39;.  At that point additional commits had been
&gt; made to blead.  HEAD was:
&gt; 
&gt; #####
&gt; commit 9a7b7fba267b8910dbea2920dd675030f796320c
&gt; Author:     Yves Orton &lt;demerphq@gmail.com&gt;
&gt; AuthorDate: Fri Jan 27 04:23:05 2017
&gt; Commit:     Yves Orton &lt;demerphq@gmail.com&gt;
&gt; CommitDate: Fri Jan 27 04:23:24 2017
&gt; #####
&gt; 
&gt; When the smoke test run completed, however, I was surprised to see
&gt; that the commit being tested -- HEAD in the p5smoke/perl-current and
&gt; p5smoke/git-perl directories -- was still commit
&gt; 1f74a12bfce8b82144fa7fef29618af1e8023298 -- the commit which caused
&gt; the porting test errors and for which I had already pushed corrections
&gt; to blead!
&gt; 
&gt; Here is the &#39;sysinfo&#39; element from
&gt; jsn1f74a12bfce8b82144fa7fef29618af1e8023298.jsn:
&gt; 
&gt; #####
&gt; &#34;sysinfo&#34; : {
&gt;    &#34;lang&#34; : null,
&gt;    &#34;smoke_date&#34; : &#34;2017-01-27 08:11:48 -0500&#34;,
&gt;    &#34;git_id&#34; : &#34;1f74a12bfce8b82144fa7fef29618af1e8023298&#34;,
&gt;    &#34;git_describe&#34; : &#34;v5.25.9-49-g1f74a12&#34;,
&gt;    &#34;osname&#34; : &#34;freebsd&#34;,
&gt;    &#34;smoker_version&#34; : &#34;0.046&#34;,
&gt;    &#34;test_jobs&#34; : &#34;8&#34;,
&gt;    &#34;smoke_revision&#34; : &#34;1.70&#34;,
&gt;    &#34;osversion&#34; : &#34;10.3-RELEASE&#34;,
&gt;    &#34;username&#34; : &#34;jkeenan&#34;,
&gt;    &#34;lc_all&#34; : null,
&gt;    &#34;smoke_branch&#34; : &#34;blead&#34;,
&gt;    &#34;smoke_perl&#34; : &#34;5.20.3&#34;,
&gt;    &#34;reporter&#34; : null,
&gt;    &#34;cpu_description&#34; : &#34;Intel&#40;R&#41; Core&#40;TM&#41; i5-4200M CPU @ 2.50GHz&#34;,
&gt;    &#34;hostname&#34; : &#34;localhost&#34;,
&gt;    &#34;cpu_count&#34; : &#34;1&#34;,
&gt;    &#34;user_note&#34; : &#34;Occasional failures observed in long-running tests
&gt; in:\n    t/re/speed.t\n    t/re/speed_thr.t\n
&gt; cpan/Memoize/t/expmod_t.t\n    dist/Time-HiRes/t/alarm.t\n&#34;,
&gt;    &#34;smoke_version&#34; : &#34;1.70&#34;,
&gt;    &#34;reporter_version&#34; : &#34;0.053&#34;,
&gt;    &#34;duration&#34; : 2349,
&gt;    &#34;perl_id&#34; : &#34;5.25.10&#34;,
&gt;    &#34;config_count&#34; : 1,
&gt;    &#34;architecture&#34; : &#34;amd64&#34;
&gt; },
&gt; #####
&gt; 
&gt; Not surprisingly, since &#39;blead&#39; had not been moved forward from the
&gt; commit at which the porting test errors were introduced, those errors
&gt; were still present:
&gt; 
&gt; #####
&gt; &#34;failures&#34; : [
&gt;    {
&gt;       &#34;extra&#34; : [
&gt;          &#34;97-98&#34;
&gt;       ],
&gt;       &#34;test&#34; : &#34;../t/porting/exec-bit.t&#34;,
&gt;       &#34;status&#34; : &#34;FAILED&#34;
&gt;    },
&gt;    {
&gt;       &#34;extra&#34; : [
&gt;          &#34;183&#34;
&gt;       ],
&gt;       &#34;status&#34; : &#34;FAILED&#34;,
&gt;       &#34;test&#34; : &#34;../t/porting/podcheck.t&#34;
&gt;    }
&gt; #####
&gt; 
&gt; Here is the first part of the smokecurrent.log for this run -- with
&gt; some comments:
&gt; 
&gt; #####
&gt; [2017-01-27 08:11:22-0500] Read configuration from:
&gt; /usr/home/jkeenan/p5smoke/install/smokecurrent_config
&gt; [2017-01-27 08:11:22-0500] Commitlevel before sync:
&gt; d6115793d6cc41755a3ed4baaa38d30653656f41
&gt; 
&gt; # d611579 was HEAD in the previous branch being smoked: smoke-
&gt; me/jkeenan/130635-storable
&gt; 
&gt; [2017-01-27 08:11:22-0500] ==&gt; Starting synctree
&gt; [2017-01-27 08:11:22-0500] Reading branch to smoke from:
&gt; &#39;/usr/home/jkeenan/p5smoke/install/smokecurrent.gitbranch&#39;
&gt; [2017-01-27 08:11:22-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/git-perl&#41;
&gt; running:
&gt; [2017-01-27 08:11:22-0500] qx[/usr/local/bin/git pull --all]
&gt; From git://perl5.git.perl.org/perl
&gt;    1f74a12..9a7b7fb  blead      -&gt; origin/blead
&gt; [2017-01-27 08:11:37-0500] Fetching origin
&gt; [2017-01-27 08:11:37-0500] Already up-to-date.
&gt; [2017-01-27 08:11:37-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/git-perl&#41;
&gt; running:
&gt; [2017-01-27 08:11:37-0500] qx[/usr/local/bin/git remote prune origin]
&gt; [2017-01-27 08:11:38-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/git-perl&#41;
&gt; running:
&gt; [2017-01-27 08:11:38-0500] qx[/usr/local/bin/git checkout blead
&gt; [2017-01-27 08:11:38-0500]  2&gt;&#38;1]
&gt; Switched to branch &#39;blead&#39;
&gt; [2017-01-27 08:11:41-0500] Your branch is behind &#39;origin/blead&#39; by 7
&gt; commits, and can be fast-forwarded.
&gt; [2017-01-27 08:11:41-0500]   &#40;use &#34;git pull&#34; to update your local
&gt; branch&#41;
&gt; 
&gt; # Note: No indication that &#39;git pull&#39; was actually run!  Why not?
&gt; 
&gt; [2017-01-27 08:11:41-0500] In pwd&#40;/usr/home/jkeenan/p5smoke/perl-
&gt; current&#41; running:
&gt; [2017-01-27 08:11:41-0500] qx[/usr/local/bin/git reset --hard]
&gt; 
&gt; # Note: Although &#39;man git-reset&#39; is not explicit about this, we can
&gt; probably assume
&gt; # that &#39;git reset --hard&#39; with no &lt;commit&gt; resets to HEAD -- i.e., no
&gt; update to checkout.
&gt; 
&gt; [2017-01-27 08:11:43-0500] HEAD is now at d611579 Fix stack buffer
&gt; overflow in deserialization of hooks.
&gt; #####
&gt; 
&gt; So why does Test-Smoke not update the branch being tested in cases
&gt; like this?
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div>
Pull request filed:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/abeltje/Test-Smoke/pull/26">https://github.com/abeltje/Test-Smoke/pull/26</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;29&nbsp;11:36:12&nbsp;2017</span>
    <span class="description">demerphq [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120008] Test-Smoke failing to update branch being tested</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 29 Jan 2017 17:35:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Smoke [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> demerphq &lt;demerphq [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 29 January 2017 at 15:06, James E Keenan via RT
&lt;bug-Test-Smoke@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=120008">https://rt.cpan.org/Ticket/Display.html?id=120008</a></span> &gt;
&gt;
&gt; On Fri Jan 27 11:07:33 2017, JKEENAN wrote:
&gt; Pull request filed:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/abeltje/Test-Smoke/pull/26">https://github.com/abeltje/Test-Smoke/pull/26</a></span>
</div>
I had a quick scan of your patch. While i have no doubt it works, I
find it really weird that smokers reclone every time, and i find it
really weird to see

$gitout = $gitbin-&gt;run&#40;rebase =&gt; &#39;origin/blead&#39;&#41;;

in the smoker. A smoker should never rebase. Why is that happening?

I would expect to see pseudo code like this:

git fetch origin
foreach $branch in `git branch -r` like /smoke-me/
   git checkout $branch
   git reset --hard origin/$branch
   run_smoke&#40;&#41;;
next;

It should never rebase, it should never merge, it should never pull,
and it should not have to reclone every time. So why does the code do
that? Am i missing something?

I will try to find some dedicated time to review the smoker code more
closely, but right now I dont have the round tuits.

cheers,
Yves

-- 
perl -Mre=debug -e &#34;/just|another|perl|hacker/&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;29&nbsp;11:36:12&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;02&nbsp;20:18:16&nbsp;2017</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 29 11:36:12 2017, demerphq@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 29 January 2017 at 15:06, James E Keenan via RT
&gt; &lt;bug-Test-Smoke@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=120008">https://rt.cpan.org/Ticket/Display.html?id=120008</a></span> &gt;
&gt; &gt;
&gt; &gt; On Fri Jan 27 11:07:33 2017, JKEENAN wrote:
&gt; &gt; Pull request filed:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/abeltje/Test-Smoke/pull/26">https://github.com/abeltje/Test-Smoke/pull/26</a></span>
</div>&gt; 
&gt; I had a quick scan of your patch. While i have no doubt it works, I
&gt; find it really weird that smokers reclone every time, and i find it
&gt; really weird to see
&gt; 
&gt; $gitout = $gitbin-&gt;run&#40;rebase =&gt; &#39;origin/blead&#39;&#41;;
&gt; 
&gt; in the smoker. A smoker should never rebase. Why is that happening?
&gt; 
&gt; I would expect to see pseudo code like this:
&gt; 
&gt; git fetch origin
&gt; foreach $branch in `git branch -r` like /smoke-me/
&gt;    git checkout $branch
&gt;    git reset --hard origin/$branch
&gt;    run_smoke&#40;&#41;;
&gt; next;
&gt; 
&gt; It should never rebase, it should never merge, it should never pull,
&gt; and it should not have to reclone every time. So why does the code do
&gt; that? Am i missing something?
&gt; 
&gt; I will try to find some dedicated time to review the smoker code more
&gt; closely, but right now I dont have the round tuits.
&gt; 
&gt; cheers,
&gt; Yves
&gt; 
</div>
I was ill/afk so could not respond sooner.  I have revised the code in the pull request so that it no longer uses &#39;git rebase&#39; but instead uses &#39;git revert&#39; in one place per your suggestion.

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;12&nbsp;07:32:22&nbsp;2017</span>
    <span class="description">abeltje [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/abeltje/Test-Smoke/pull/26">https://github.com/abeltje/Test-Smoke/pull/26</a></span> was adapted  and integrated in release 1.70_9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;12&nbsp;07:32:33&nbsp;2017</span>
    <span class="description">abeltje [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;25&nbsp;11:13:25&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Reference by ticket #125927 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;05&nbsp;18:05:42&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Reference by ticket #127577 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
