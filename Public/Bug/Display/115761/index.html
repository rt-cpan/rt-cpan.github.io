<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #115761 for Math-Currency: Overloaded bcmp incorrect</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #115761 for Math-Currency: Overloaded bcmp incorrect</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-Currency/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-Currency/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-Currency/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-Currency/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Currency">Math-Currency CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">115761</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-Currency/Active/">Math-Currency</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
daniel [...] trustnetworks.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20602-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20603-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.50    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Math.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1643696/881508/Math.zip">
Thu Jun 30 13:33:48 2016 (132.3k) by daniel [...] trustnetworks.co.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;11:51:38&nbsp;2016</span>
    <span class="description">daniel [...] trustnetworks.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Overloaded bcmp incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Jun 2016 16:51:23 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Math-Currency [...] rt.cpan.org&#34; &lt;bug-Math-Currency [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Beardsmore &lt;daniel [...] trustnetworks.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Good afternoon
 
Please see the following tests:
 
        trust-database:~ $ perl
        use Math::Currency;
        use feature qw/say/;
        
        my $small = new Math::Currency&#40;10&#41;;
        my $large = new Math::Currency&#40;100&#41;;
        
        say &#34;$small $large&#34;;
        say &#34;small vs large = &#34; . $small-&gt;bcmp&#40;$large&#41;;
        say &#34;$small $large&#34;;
        say &#34;large vs small = &#34; . $large-&gt;bcmp&#40;$small&#41;;
        say &#34;$small $large&#34;;
        #10.00 #100.00
        small vs large = 1
        #10.00 #100.00
        large vs small = 1
        #10.00 #100.00
        
        
        trust-database:~ $ perl
        use Math::BigFloat;
        use feature qw/say/;
        
        my $small = new Math::BigFloat&#40;10&#41;;
        my $large = new Math::BigFloat&#40;100&#41;;
        
        say &#34;$small $large&#34;;
        say &#34;small vs large = &#34; . $small-&gt;bcmp&#40;$large&#41;;
        say &#34;$small $large&#34;;
        say &#34;large vs small = &#34; . $large-&gt;bcmp&#40;$small&#41;;
        say &#34;$small $large&#34;;
        
        10 100
        small vs large = -1
        10 100
        large vs small = 1
        10 100

Notice that Math::Currency returns 1 for both large &lt;=&gt; small and small &lt;=&gt; large.


The problem is thus:

Math::BigFloat defines bcmp as follows:

  $x-&gt;bcmp&#40;$y&#41;;           # compare numbers &#40;undef, &lt; 0, == 0, &gt; 0&#41;

Your undocumented overridden function expects the following for older Math::BigInt versions:

  Math::Currency-&gt;bcmp&#40;$x, $y&#41;

I can see that either 0.48 resolved a compatibility issue with newer versions of BigInt, but you&#39;re only applying it to versions at least 1.999717. I am using Debian 8.4 with Perl 5.20.2 and this has BigInt 1.9993; the revised behaviour was certainly required for this version of BigInt. In fact, I don&#39;t even know what your original implementation of bcmp was intended to achieve: my PC has Perl 5.8.9 installed and bcmp in Math::BigInt even then was only expecting one parameter.

I&#39;ve worked around this by resetting _LEGACY_MATH_BIGINT to 0.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;11:56:24&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Reference to ticket #115247 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;12:01:36&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 30 11:51:38 2016, daniel@trustnetworks.co.uk wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can see that either 0.48 resolved a compatibility issue with newer
&gt; versions of BigInt, but you&#39;re only applying it to versions at least
&gt; 1.999717. I am using Debian 8.4 with Perl 5.20.2 and this has BigInt
&gt; 1.9993; the revised behaviour was certainly required for this version
&gt; of BigInt. In fact, I don&#39;t even know what your original
&gt; implementation of bcmp was intended to achieve: my PC has Perl 5.8.9
&gt; installed and bcmp in Math::BigInt even then was only expecting one
&gt; parameter.
</div>
The problem that v0.48 solved is that Math::BigInt v1.999718 *completely* broke comparisons.  See <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115247">https://rt.cpan.org/Ticket/Display.html?id=115247</a></span>

The _LEGACY_MATH_BIGINT was to attempt to be compliant with older releases as well as newer ones.

Its possible 1.999717 is not the correct point where things broke perhaps?  I&#39;ll see if I can narrow this down farther if so.  Debian also has a history of patching modules so they do not match what is in CPAN.  I don&#39;t know if that is the case here, but if they have patched Math::BigInt so it behaves differently from CPAN, its going to be very difficult to determine what _LEGACY_MATH_BIGINT should be set to.

Otherwise, probably the best long term solution is going to be for Math::Currency to require at least Math::BigInt 1.999717 and do not support older versions any longer.

-- 
Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;12:01:36&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;12:10:37&nbsp;2016</span>
    <span class="description">daniel [...] trustnetworks.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115761] Overloaded bcmp incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Jun 2016 17:10:22 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Math-Currency [...] rt.cpan.org&#34; &lt;bug-Math-Currency [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Beardsmore &lt;daniel [...] trustnetworks.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The problem with your override is that you&#39;re converting bcmp from a one-arg function to a two-arg function, which destroys it.

Your function should still accept one and only one parameter &#40;the number to compare with&#41; and *internally* mess about with parameters. Your corrections may need to internally make alterations to the true parameter list &#40;including the package/object received as parameter one&#41;, but you&#39;re actually breaking the function&#39;s contract and rendering it completely inoperable.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: MSCHOUT via RT [mailto:bug-Math-Currency@rt.cpan.org] 
&gt; Sent: 30 June 2016 17:02
&gt; To: Daniel Beardsmore
&gt; Subject: [rt.cpan.org #115761] Overloaded bcmp incorrect
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115761">https://rt.cpan.org/Ticket/Display.html?id=115761</a></span> &gt;
&gt; 
&gt; On Thu Jun 30 11:51:38 2016, daniel@trustnetworks.co.uk wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; I can see that either 0.48 resolved a compatibility issue with newer
&gt; &gt; versions of BigInt, but you&#39;re only applying it to versions at least
&gt; &gt; 1.999717. I am using Debian 8.4 with Perl 5.20.2 and this has BigInt
&gt; &gt; 1.9993; the revised behaviour was certainly required for 
</div>&gt; this version
<div class="message-stanza open">&gt; &gt; of BigInt. In fact, I don&#39;t even know what your original
&gt; &gt; implementation of bcmp was intended to achieve: my PC has Perl 5.8.9
&gt; &gt; installed and bcmp in Math::BigInt even then was only expecting one
&gt; &gt; parameter.
</div>&gt; 
&gt; The problem that v0.48 solved is that Math::BigInt v1.999718 
&gt; *completely* broke comparisons.  See 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115247">https://rt.cpan.org/Ticket/Display.html?id=115247</a></span>
&gt; 
&gt; The _LEGACY_MATH_BIGINT was to attempt to be compliant with 
&gt; older releases as well as newer ones.
&gt; 
&gt; Its possible 1.999717 is not the correct point where things 
&gt; broke perhaps?  I&#39;ll see if I can narrow this down farther if 
&gt; so.  Debian also has a history of patching modules so they do 
&gt; not match what is in CPAN.  I don&#39;t know if that is the case 
&gt; here, but if they have patched Math::BigInt so it behaves 
&gt; differently from CPAN, its going to be very difficult to 
&gt; determine what _LEGACY_MATH_BIGINT should be set to.
&gt; 
&gt; Otherwise, probably the best long term solution is going to 
&gt; be for Math::Currency to require at least Math::BigInt 
&gt; 1.999717 and do not support older versions any longer.
&gt; 
&gt; -- 
&gt; Regards,
&gt; Michael Schout
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;12:16:40&nbsp;2016</span>
    <span class="description">daniel [...] trustnetworks.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115761] Overloaded bcmp incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Jun 2016 17:16:23 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Math-Currency [...] rt.cpan.org&#34; &lt;bug-Math-Currency [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Beardsmore &lt;daniel [...] trustnetworks.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Something I didn&#39;t mention: 0.47 was also broken. The 0.48 fix didn&#39;t break it -- the function never worked at all. It always swallowed the first parameter &#40;the nonexistent class parameter it thinks existed but doesn&#39;t&#41; and expected two more parameters, causing a comparison with undef of everything. The function was thinking it was being called as Math::Currency-&gt;bcmp&#40;$x, $y&#41;, it seems, yet the docs for BigFloat/BigInt expect $x-&gt;bcmp&#40;$y&#41;, causing the function to be broken.

0.48 fixes the original bug, but only for newer BigInts.

I had 0.47 before, and updated thinking the change fixed it, and found the function still broken.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: MSCHOUT via RT [mailto:bug-Math-Currency@rt.cpan.org] 
&gt; Sent: 30 June 2016 17:02
&gt; To: Daniel Beardsmore
&gt; Subject: [rt.cpan.org #115761] Overloaded bcmp incorrect
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115761">https://rt.cpan.org/Ticket/Display.html?id=115761</a></span> &gt;
&gt; 
&gt; On Thu Jun 30 11:51:38 2016, daniel@trustnetworks.co.uk wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; I can see that either 0.48 resolved a compatibility issue with newer
&gt; &gt; versions of BigInt, but you&#39;re only applying it to versions at least
&gt; &gt; 1.999717. I am using Debian 8.4 with Perl 5.20.2 and this has BigInt
&gt; &gt; 1.9993; the revised behaviour was certainly required for 
</div>&gt; this version
<div class="message-stanza open">&gt; &gt; of BigInt. In fact, I don&#39;t even know what your original
&gt; &gt; implementation of bcmp was intended to achieve: my PC has Perl 5.8.9
&gt; &gt; installed and bcmp in Math::BigInt even then was only expecting one
&gt; &gt; parameter.
</div>&gt; 
&gt; The problem that v0.48 solved is that Math::BigInt v1.999718 
&gt; *completely* broke comparisons.  See 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115247">https://rt.cpan.org/Ticket/Display.html?id=115247</a></span>
&gt; 
&gt; The _LEGACY_MATH_BIGINT was to attempt to be compliant with 
&gt; older releases as well as newer ones.
&gt; 
&gt; Its possible 1.999717 is not the correct point where things 
&gt; broke perhaps?  I&#39;ll see if I can narrow this down farther if 
&gt; so.  Debian also has a history of patching modules so they do 
&gt; not match what is in CPAN.  I don&#39;t know if that is the case 
&gt; here, but if they have patched Math::BigInt so it behaves 
&gt; differently from CPAN, its going to be very difficult to 
&gt; determine what _LEGACY_MATH_BIGINT should be set to.
&gt; 
&gt; Otherwise, probably the best long term solution is going to 
&gt; be for Math::Currency to require at least Math::BigInt 
&gt; 1.999717 and do not support older versions any longer.
&gt; 
&gt; -- 
&gt; Regards,
&gt; Michael Schout
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;13:29:47&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 30 12:16:40 2016, daniel@trustnetworks.co.uk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Something I didn&#39;t mention: 0.47 was also broken.
</div>
Understood, thanks
-- 
Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;13:33:48&nbsp;2016</span>
    <span class="description">daniel [...] trustnetworks.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115761] Overloaded bcmp incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Jun 2016 18:33:29 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Math-Currency [...] rt.cpan.org&#34; &lt;bug-Math-Currency [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Beardsmore &lt;daniel [...] trustnetworks.co.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, here&#39;s a workaround:

sub bcmp {
    my $class = $#_ == 2 ? shift : __PACKAGE__;

    # make sure we&#39;re dealing with two Math::Currency objects
    my &#40; $x, $y &#41; =
      map { ref $_ ne $class ? $class-&gt;new&#40;$_&#41; : $_ } @_[ 0, 1 ];
    return $x-&gt;as_float &lt;=&gt; $y-&gt;as_float;
}

Cause:

The OOP contract stipulates that bcmp takes one parameter, the number for comparison. This is how the method functions when called by a client.

Math::BigInt 1.9993 also passes the package name as an extra parameter when using bcmp to implement == through overloading -- this means that the function will either fail for bcmp or fail for == and will never work for both at the same time. This is true of both 0.47 and 0.49.

The above quick hack checks for the parameter count: if the true count is 3, then the first one is shifted off as the class, allowing the function to continue working as expected.

I may have a rogue version of BigInt -- I don&#39;t know. Clearly something is very wrong in Camel Land. I&#39;ve attached a copy of all of /usr/share/perl/5.20.2/Math in case it helps!

Cheers

Daniel.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: MSCHOUT via RT [mailto:bug-Math-Currency@rt.cpan.org] 
&gt; Sent: 30 June 2016 17:02
&gt; To: Daniel Beardsmore
&gt; Subject: [rt.cpan.org #115761] Overloaded bcmp incorrect
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115761">https://rt.cpan.org/Ticket/Display.html?id=115761</a></span> &gt;
&gt; 
&gt; On Thu Jun 30 11:51:38 2016, daniel@trustnetworks.co.uk wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; I can see that either 0.48 resolved a compatibility issue with newer
&gt; &gt; versions of BigInt, but you&#39;re only applying it to versions at least
&gt; &gt; 1.999717. I am using Debian 8.4 with Perl 5.20.2 and this has BigInt
&gt; &gt; 1.9993; the revised behaviour was certainly required for 
</div>&gt; this version
<div class="message-stanza open">&gt; &gt; of BigInt. In fact, I don&#39;t even know what your original
&gt; &gt; implementation of bcmp was intended to achieve: my PC has Perl 5.8.9
&gt; &gt; installed and bcmp in Math::BigInt even then was only expecting one
&gt; &gt; parameter.
</div>&gt; 
&gt; The problem that v0.48 solved is that Math::BigInt v1.999718 
&gt; *completely* broke comparisons.  See 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115247">https://rt.cpan.org/Ticket/Display.html?id=115247</a></span>
&gt; 
&gt; The _LEGACY_MATH_BIGINT was to attempt to be compliant with 
&gt; older releases as well as newer ones.
&gt; 
&gt; Its possible 1.999717 is not the correct point where things 
&gt; broke perhaps?  I&#39;ll see if I can narrow this down farther if 
&gt; so.  Debian also has a history of patching modules so they do 
&gt; not match what is in CPAN.  I don&#39;t know if that is the case 
&gt; here, but if they have patched Math::BigInt so it behaves 
&gt; differently from CPAN, its going to be very difficult to 
&gt; determine what _LEGACY_MATH_BIGINT should be set to.
&gt; 
&gt; Otherwise, probably the best long term solution is going to 
&gt; be for Math::Currency to require at least Math::BigInt 
&gt; 1.999717 and do not support older versions any longer.
&gt; 
&gt; -- 
&gt; Regards,
&gt; Michael Schout
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1643696/881508/Math.zip">Download Math.zip</a><br />
<span class="downloadcontenttype">application/x-zip-compressed 132.3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;13:34:13&nbsp;2016</span>
    <span class="description">daniel [...] trustnetworks.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115761] Overloaded bcmp incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Jun 2016 18:33:52 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Math-Currency [...] rt.cpan.org&#34; &lt;bug-Math-Currency [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Beardsmore &lt;daniel [...] trustnetworks.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It might be that BigInt is itself broken! 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: MSCHOUT via RT [mailto:bug-Math-Currency@rt.cpan.org] 
&gt; Sent: 30 June 2016 18:30
&gt; To: Daniel Beardsmore
&gt; Subject: [rt.cpan.org #115761] Overloaded bcmp incorrect
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115761">https://rt.cpan.org/Ticket/Display.html?id=115761</a></span> &gt;
&gt; 
&gt; On Thu Jun 30 12:16:40 2016, daniel@trustnetworks.co.uk wrote:
<div class="message-stanza open">&gt; &gt; Something I didn&#39;t mention: 0.47 was also broken.
</div>&gt; 
&gt; Understood, thanks
&gt; -- 
&gt; Regards,
&gt; Michael Schout
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;01:19:17&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, here&#39;s whats going on.

Even though Math::BigInt documents bcmp&#40;&#41; as a one-arg object method, it was not always used this way.

In Math::BigInt, the overload of operator &lt;=&gt; in 1.99, it was called as:

   ref&#40;$_[0]&#41;-&gt;bcmp&#40;$_[0],$_[1]&#41;

In 1.999718 the overload of &lt;=&gt; in BigInt was changed to:

 $_[0]-&gt;bcmp&#40;$_[1]&#41;

These two ways that bcmp&#40;&#41; might get called break the signature of bcmp in an incompatible way.

It seems the best choice is to use your proposed solution and check the number of args to bcmp&#40;&#41; moving forward.  This fixes things so bcmp&#40;&#41; works as an object method, and also that &lt;=&gt; overloading works in both old and new Math::BigInt versions.

I&#39;ll have something released tomorrow sometime.

Thanks for your patience.

-- 
Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;03:22:17&nbsp;2016</span>
    <span class="description">daniel [...] trustnetworks.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115761] Overloaded bcmp incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Jul 2016 08:22:04 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Math-Currency [...] rt.cpan.org&#34; &lt;bug-Math-Currency [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Beardsmore &lt;daniel [...] trustnetworks.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I figured it was something like that as soon as I noticed that my fix broke the use of ==. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: MSCHOUT via RT [mailto:bug-Math-Currency@rt.cpan.org] 
&gt; Sent: 01 July 2016 06:19
&gt; To: Daniel Beardsmore
&gt; Subject: [rt.cpan.org #115761] Overloaded bcmp incorrect
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115761">https://rt.cpan.org/Ticket/Display.html?id=115761</a></span> &gt;
&gt; 
&gt; Ok, here&#39;s whats going on.
&gt; 
&gt; Even though Math::BigInt documents bcmp&#40;&#41; as a one-arg object 
&gt; method, it was not always used this way.
&gt; 
&gt; In Math::BigInt, the overload of operator &lt;=&gt; in 1.99, it was 
&gt; called as:
&gt; 
&gt;    ref&#40;$_[0]&#41;-&gt;bcmp&#40;$_[0],$_[1]&#41;
&gt; 
&gt; In 1.999718 the overload of &lt;=&gt; in BigInt was changed to:
&gt; 
&gt;  $_[0]-&gt;bcmp&#40;$_[1]&#41;
&gt; 
&gt; These two ways that bcmp&#40;&#41; might get called break the 
&gt; signature of bcmp in an incompatible way.
&gt; 
&gt; It seems the best choice is to use your proposed solution and 
&gt; check the number of args to bcmp&#40;&#41; moving forward.  This 
&gt; fixes things so bcmp&#40;&#41; works as an object method, and also 
&gt; that &lt;=&gt; overloading works in both old and new Math::BigInt versions.
&gt; 
&gt; I&#39;ll have something released tomorrow sometime.
&gt; 
&gt; Thanks for your patience.
&gt; 
&gt; -- 
&gt; Regards,
&gt; Michael Schout
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;05&nbsp;10:22:41&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This has been fixed in v0.50 which I released to CPAN yesterday.

Let me know if you still have problems.

Thanks
-- 
Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;05&nbsp;10:22:42&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;05&nbsp;10:22:42&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Fixed in 0.50 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;06&nbsp;15:00:57&nbsp;2016</span>
    <span class="description">daniel [...] trustnetworks.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115761] Overloaded bcmp incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 6 Jul 2016 20:00:44 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Math-Currency [...] rt.cpan.org&#34; &lt;bug-Math-Currency [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Beardsmore &lt;daniel [...] trustnetworks.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can see that there&#39;s a lot more changed in that file than just argument check, so hopefully no new bugs :&#41;

The test I put in place to look for ==/bcmp errors passes with the new module, so fingers crossed!

Cheers.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: MSCHOUT via RT [mailto:bug-Math-Currency@rt.cpan.org] 
&gt; Sent: 05 July 2016 15:23
&gt; To: Daniel Beardsmore
&gt; Subject: [rt.cpan.org #115761] Overloaded bcmp incorrect
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115761">https://rt.cpan.org/Ticket/Display.html?id=115761</a></span> &gt;
&gt; 
&gt; This has been fixed in v0.50 which I released to CPAN yesterday.
&gt; 
&gt; Let me know if you still have problems.
&gt; 
&gt; Thanks
&gt; -- 
&gt; Regards,
&gt; Michael Schout
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;06&nbsp;15:50:17&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 06 15:00:57 2016, daniel@trustnetworks.co.uk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can see that there&#39;s a lot more changed in that file than just
&gt; argument check, so hopefully no new bugs :&#41;
</div>
FWIW, the vast majority of hte code changes are just cleanups / formatting.  I&#39;ve taken this module over recently and 0.50 is the first release from me that is built using Dist::Zilla which generates most of the POD and other files like README/LICENSE, Makefile.PL etc. If you are just diffing the distribution tarballs there will be a LOT of diffs due to that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; The test I put in place to look for ==/bcmp errors passes with the new
&gt; module, so fingers crossed!
</div>
Your tests are included in t/010_bcmp.t FYI

I have not seen a single failure of 0.50 from cpantesters yet &#40;288 passes&#41;, so things are looking good so far.

I&#39;m going to resolve this ticket as I consider the issue this ticket refers to resolved in 0.50.

If you run into another issue please open a new ticket.

-- 
Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;06&nbsp;15:50:28&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
