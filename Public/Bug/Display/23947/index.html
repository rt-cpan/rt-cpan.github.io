<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #23947 for Net-SSH-Perl: Net::SSH::Perl::Auth::KeyboardInt should offer non-interactive option.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #23947 for Net-SSH-Perl: Net::SSH::Perl::Auth::KeyboardInt should offer non-interactive option.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSH-Perl">Net-SSH-Perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">23947</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SSH-Perl/Active/">Net-SSH-Perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
toddr [...] cpanel.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23272-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.29    </td>
  </tr>
  <tr id="CF-23273-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;15&nbsp;00:20:40&nbsp;2006</span>
    <span class="description">toddr [...] cpanel.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::SSH::Perl::Auth::KeyboardInt should offer non-interactive
 option.</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">With the below minor change, keyboard-interactive mode can be done in 
batch mode. I&#39;m guessing a decision was made to stay true to the 
openssh model. Is this why it was not done? I&#39;d be really appreciative 
if this mod made it into the next release...

&lt;         for &#40;1..$prompts&#41; {
&lt;             my $res = _prompt&#40;$packet-&gt;get_str, undef, $packet-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;get_int8&#41;;
</div>---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       my $username_passed = $ssh-&gt;config-&gt;get&#40;&#39;user&#39;&#41;;
&gt;         my $password_passed = $ssh-&gt;config-&gt;get&#40;&#39;pass&#39;&#41;;
&gt;       for &#40;1..$prompts&#41; {
&gt;           my $string = $packet-&gt;get_str;
&gt;           my $res;
&gt;           if&#40;defined $password_passed &#38;&#38; $string =~ m/
</div>${username_passed}\&#39;s Password:/&#41; {
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;               $res = $password_passed;
&gt;           } else {
&gt;               my $res = _prompt&#40;$string, undef, $packet-&gt;get_int8&#41;;
&gt;           }
</div>68c76
&lt;     }&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; }&#41;;
</div></div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> KeyboardInt.pm.html</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;15&nbsp;00:30:12&nbsp;2006</span>
    <span class="description">toddr [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> todd.e.rinaldo [...] jpmorgan.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My Bad. Minor mod on the diff

&lt;         for &#40;1..$prompts&#41; {
&lt;             my $res = _prompt&#40;$packet-&gt;get_str, undef, $packet-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;get_int8&#41;;
</div>---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       my $username_passed = $ssh-&gt;config-&gt;get&#40;&#39;user&#39;&#41;;
&gt;         my $password_passed = $ssh-&gt;config-&gt;get&#40;&#39;pass&#39;&#41;;
&gt;       for &#40;1..$prompts&#41; {
&gt;           my $string = $packet-&gt;get_str;
&gt;           my $res;
&gt;           if&#40;defined $password_passed &#38;&#38; $password_passed =~ m/\S/ &#38;&#38; 
</div>$string =~ m/${username_passed}\&#39;s Password:/&#41; {
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;               $res = $password_passed;
&gt;           } else {
&gt;               $res = _prompt&#40;$string, undef, $packet-&gt;get_int8&#41;;
&gt;           }
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;01:40:46&nbsp;2007</span>
    <span class="description">dbrobins [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I do appreciate the diff, but it doesn&#39;t have any context information. 
Please provide a unified diff &#40;-u&#41; showing which file was changed &#40;&#34;diff
-u old new&#34; should suffice, and attach the result&#41;.  In general I&#39;m not
fixing non-critical Net::SSH::Perl errors, but given that there&#39;s a
diff, if this passes tests I&#39;ll fix it given a unified diff.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;01:40:47&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;01:40:48&nbsp;2007</span>
    <span class="description">dbrobins [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;01:43:24&nbsp;2007</span>
    <span class="description">dbrobins [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;The reason I&#39;m not fixing non-critical Net::SSH::Perl errors is that
it&#39;s been mostly superseded by Net::SSH2, which has less dependencies,
and is based on a C library libssh2 which makes it much faster.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;01:43:26&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;01:58:40&nbsp;2007</span>
    <span class="description">dbrobins [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;05&nbsp;15:07:55&nbsp;2008</span>
    <span class="description">toddr [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> todd.e.rinaldo [...] jpmorgan.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Unified Diff

--- KeyboardInt.pm.133.pm       Wed Nov 05 14:04:57 2008
+++ KeyboardInt.pm.mod          Wed Nov 05 14:04:57 2008
@@ -60,12 +60,22 @@
         my $prompts = $packet-&gt;get_int32;
         my $pres = $ssh-&gt;packet_start&#40;SSH2_MSG_USERAUTH_INFO_RESPONSE&#41;;
         $pres-&gt;put_int32&#40;$prompts&#41;;
+        my $username_passed = $ssh-&gt;config-&gt;get&#40;&#39;user&#39;&#41;;
+        my $password_passed = $ssh-&gt;config-&gt;get&#40;&#39;pass&#39;&#41;;
         for &#40;1..$prompts&#41; {
-            my $res = _prompt&#40;$packet-&gt;get_str, undef, $packet-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;get_int8&#41;;
</div>+            my $string = $packet-&gt;get_str;
+            my $res;
+            if&#40;defined $password_passed
+                   &#38;&#38; $password_passed =~ m/\S/
+                   &#38;&#38; $string =~ m/${username_passed}\&#39;s Password:/&#41; {
+            $res = $password_passed;
+            } else {
+            $res = _prompt&#40;$string, undef, $packet-&gt;get_int8&#41;;
+        }
             $pres-&gt;put_str&#40;$res&#41;;
         }
         $pres-&gt;send;
-    }&#41;;
+}&#41;;

     return 1;
 }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;05&nbsp;15:07:56&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;05&nbsp;17:11:12&nbsp;2008</span>
    <span class="description">toddr [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> todd.e.rinaldo [...] jpmorgan.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Changed code to die if automatic KB int is attempted twice

--- KeyboardInt.pm.133.pm       Wed Nov 05 16:08:56 2008
+++ KeyboardInt.pm.mod  Wed Nov 05 16:08:56 2008
@@ -60,12 +60,26 @@
         my $prompts = $packet-&gt;get_int32;
         my $pres = $ssh-&gt;packet_start&#40;SSH2_MSG_USERAUTH_INFO_RESPONSE&#41;;
         $pres-&gt;put_int32&#40;$prompts&#41;;
-        for &#40;1..$prompts&#41; {
-            my $res = _prompt&#40;$packet-&gt;get_str, undef, $packet-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;get_int8&#41;;
</div>+    my $username_passed = $ssh-&gt;config-&gt;get&#40;&#39;user&#39;&#41;;
+        my $password_passed = $ssh-&gt;config-&gt;get&#40;&#39;pass&#39;&#41;;
+    for &#40;1..$prompts&#41; {
+        my $string = $packet-&gt;get_str;
+        my $res;
+        if&#40;$password_passed &#38;&#38; $string =~ m/${username_passed}\&#39;s 
Password:/&#41; {
+        $ssh-&gt;debug&#40;&#34;Attempting keyboard-interactive with passed 
password from login&#40;&#41;&#34;&#41;;
+        if&#40;$ssh-&gt;config-&gt;get&#40;&#39;interactive_attempted&#39;&#41;&#41; { # Die if 
we&#39;ve tried this before.
+            die&#40;&#34;Interactive KB attempted once already&#34;&#41;;
+        }
+        $res = $password_passed;
+        $ssh-&gt;config-&gt;set&#40;&#39;interactive_attempted&#39;, 1&#41;; # Assure 
keyboard int won&#39;t re-try.
+        } else {
+        $res = _prompt&#40;$string, undef, $packet-&gt;get_int8&#41;;
+        }
+    # Modification Ends.
             $pres-&gt;put_str&#40;$res&#41;;
         }
         $pres-&gt;send;
-    }&#41;;
+}&#41;;

     return 1;
 }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;05&nbsp;17:12:56&nbsp;2008</span>
    <span class="description">toddr [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> todd.e.rinaldo [...] jpmorgan.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Net::SSH2 is far from offering all of the features this version has. I 
would humbly request this patch be considered.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;12&nbsp;16:59:31&nbsp;2008</span>
    <span class="description">polettix [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 05 17:12:56 2008, todd_rinaldo wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Net::SSH2 is far from offering all of the features this version has. I 
&gt; would humbly request this patch be considered.
</div>
I would as well.

I used Net::SSH::Perl in a context in which I ask for the password once
and use it for a multitude of servers, and they only support
keyboard-interactive. Being required to insert the same password all the
times... is simply not Perl :&#41; My code change was even simpler:

--- KeyboardInt.pm      2008-10-21 19:54:23.000000000 +0200
+++ /opt/perl/lib/site_perl/5.8.8/Net/SSH/Perl/Auth/KeyboardInt.pm     
2008-10-22 10:13:07.000000000 +0200
@@ -61,7 +61,7 @@
         my $pres = $ssh-&gt;packet_start&#40;SSH2_MSG_USERAUTH_INFO_RESPONSE&#41;;
         $pres-&gt;put_int32&#40;$prompts&#41;;
         for &#40;1..$prompts&#41; {
-            my $res = _prompt&#40;$packet-&gt;get_str, undef, $packet-&gt;get_int8&#41;;
+            my $res = $ssh-&gt;config-&gt;get&#40;&#39;pass&#39;&#41; ||
_prompt&#40;$packet-&gt;get_str, undef, $packet-&gt;get_int8&#41;;
             $pres-&gt;put_str&#40;$res&#41;;
         }
         $pres-&gt;send;

but, of course, is slightly wrong &#40;does not work if the password is &#39;0&#39;&#41;
and lacks all the checks of the proposed change.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;15&nbsp;10:49:26&nbsp;2008</span>
    <span class="description">toddr [...] cpanel.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> todd.e.rinaldo [...] jpmorgan.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The big enhancement my solution offers over yours is that in my 
environment, it&#39;s critical that login fail if the password is wrong. In 
previous attempts on this patch, I failed to think of this and on more 
than one occasion locked my account out.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;28&nbsp;02:27:18&nbsp;2008</span>
    <span class="description">jamie [...] audible.transient.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jamie [...] audible.transient.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 15 10:49:26 2008, todd_rinaldo wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The big enhancement my solution offers over yours is that in my 
&gt; environment, it&#39;s critical that login fail if the password is wrong. In 
&gt; previous attempts on this patch, I failed to think of this and on more 
&gt; than one occasion locked my account out.
</div>
I&#39;ve written a replacement for KeyboardInt.pm that both facilitates what
it is you want to do &#40;try the password in $ssh-&gt;config-&gt;get&#40;&#39;pass&#39;&#41;&#41; but
doesn&#39;t get in they way of compliance with RFC 4256, or impose any
limitations on any other users of this package that may not enjoy a
change in existing behavior.  What I haven&#39;t written is any
documentation for it &#40;yet&#41;.  If there&#39;s a chance that my replacement
could just become the default keyboard-interactive authentication method
implementation for Net::SSH::Perl, then I&#39;d happily write up some pod
too, but here&#39;s the basic feature list and how it differs from
KeyboardInt.pm:

1&#41; isn&#39;t limited to interactive mode

Incidentally, despite the name &#34;keyboard-interactive&#34;, a completely
legitimate userauth info request may include a request with empty
strings for the name, and instruction fields and 0 num-prompts, the
correct response for which is handled entirely without any user
interaction.  Given that the SSH authentication protocol allows for
multi-method authentication sequences, it&#39;s completely possible for such
a request to be part of a such a sequence, and it would be silly to not
support it just because the client hadn&#39;t been configured as
&#34;interactive.&#34;  I consider the current package to be buggy in this regard.

2&#41; includes debugging

Figuring out where and why authentication is failing can be tricky.  I
just used the existing debugging framework and added some appropriate
debug calls.

3&#41; implements control character filtering

Client&#39;s shouldn&#39;t blindly trust the text servers give them to be safe
for display, so I rip out any control characters per RFC 4251 section 9.2.

4&#41; includes the ability to register info request handlers

Want to introspect the userauth info request and send an automated reply
to it if the request matches some set of heuristics?  This the feature
that lets you do that.  If you don&#39;t register any handlers, this module
acts pretty much the same as KeyboardInt.pm acts now &#40;modulo the above 3
features anyway&#41;.

I&#39;ve attached my replacement package.

As an example of how you might use it to go about installing a one-shot
automatic password handler that will only be triggered if the name and
instruction strings in the userauth info request message are empty,
num-prompts is 1, the prompt looks like the word &#34;password&#34; and we have
a stored password for the current user...

use Net::SSH::Perl;
use Net::SSH::Perl::Auth::KeyboardInteractive qw&#40;add_kbdint_handler&#41;;
my $ssh = new Net::SSH::Perl-&gt;new&#40;$host, &#39;protocol&#39; =&gt; 2&#41;;
add_kbdint_handler&#40;$ssh,
    sub {
        my &#40;$auth, $name, $instruction, $lang, $prompts&#41; = @_;
        return defined&#40;$auth-&gt;{&#39;ssh&#39;}-&gt;config-&gt;get&#40;&#39;pass&#39;&#41;&#41; &#38;&#38;
               $name eq &#39;&#39; &#38;&#38; $instruction eq &#39;&#39; &#38;&#38;
               @$prompts == 1 &#38;&#38;
               $prompts-&gt;[0]-&gt;[0] =~ /\Apassword\W*\z/i;
    },
    sub {
        my &#40;$auth, $name, $instruction, $lang, $prompt, $echo&#41; = @_;
        $auth-&gt;del_handler;
        return $auth-&gt;{&#39;ssh&#39;}-&gt;config-&gt;get&#40;&#39;pass&#39;&#41;;
    }
&#41;;
$ssh-login&#40;...
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Net::SSH::Perl::Auth::KeyboardInteractive;

use strict;
use warnings;

use Exporter qw&#40;import&#41;;
use Net::SSH::Perl::Constants qw&#40;:msg2&#41;;
use Net::SSH::Perl::Util qw&#40;_prompt&#41;;
use Scalar::Util qw&#40;weaken&#41;;

use base qw&#40;Net::SSH::Perl::Auth&#41;;

our @EXPORT_OK = qw&#40;add_kbdint_handler del_kbdint_handler&#41;;

sub add_kbdint_handler {
    my &#40;$ssh, $handles, $handler, $pos&#41; = @_;
    my $handlers = $ssh-&gt;config-&gt;get&#40;&#39;auth_kbd_interactive_handlers&#39;&#41; || [];
    $pos = @$handlers unless &#40;defined $pos&#41;;
    splice @$handlers, $pos, 0, {&#39;handler&#39; =&gt; $handler, &#39;handles&#39; =&gt; $handles};
    $ssh-&gt;config-&gt;set&#40;&#39;auth_kbd_interactive_handlers&#39;, $handlers&#41;;
    return $pos;
}

sub del_kbdint_handler {
    my &#40;$ssh, $pos&#41; = @_;
    my $handlers = $ssh-&gt;config-&gt;get&#40;&#39;auth_kbd_interactive_handlers&#39;&#41; or return;
    $pos = -1 unless &#40;defined $pos&#41;;
    splice @$handlers, $pos, 1;
    return $pos;
}

sub _dispatch {
    my &#40;$auth, $name, $instruction, $lang, $prompts&#41; = @_;
    foreach &#40;@{$auth-&gt;{&#39;_handlers&#39;}}&#41; {
        return $_-&gt;{&#39;handler&#39;}
            if &#40;$_-&gt;{&#39;handles&#39;}&#40;$auth, $name, $instruction, $lang, $prompts&#41;&#41;;
    }
    return;
}

sub new {
    my &#40;$class, $ssh&#41; = @_;
    my $auth = bless {&#39;ssh&#39; =&gt; $ssh}, $class;
    weaken&#40;$auth-&gt;{&#39;ssh&#39;}&#41;;
    my $handlers = $ssh-&gt;config-&gt;get&#40;&#39;auth_kbd_interactive_handlers&#39;&#41; || [];
    @{$auth-&gt;{&#39;_handlers&#39;}} = map { {%$_} } @$handlers; # 1 level deep copy
    $auth-&gt;enabled&#40;$ssh-&gt;config-&gt;get&#40;&#39;auth_kbd_interactive&#39;&#41;&#41;;
    return $auth;
}

sub enabled {
    my $self = shift;
    $self-&gt;{&#39;enabled&#39;} = shift if &#40;@_&#41;;
    return $self-&gt;{&#39;enabled&#39;};
}

sub add_handler {
    my &#40;$self, $handles, $handler, $pos&#41; = @_;
    $pos = @{$self-&gt;{&#39;_handlers&#39;}} unless &#40;defined $pos&#41;;
    splice @{$self-&gt;{&#39;_handlers&#39;}}, $pos, 0,
           { &#39;handler&#39; =&gt; $handler, &#39;handles&#39; =&gt; $handles };
    return $pos;
}

sub del_handler {
    my &#40;$self, $pos&#41; = @_;
    return unless &#40;@{$self-&gt;{&#39;_handlers&#39;}}&#41;;
    $pos = -1 unless &#40;defined $pos&#41;;
    splice @{$self-&gt;{&#39;_handlers&#39;}}, $pos, 1;
    return $pos;
}

sub authenticate {
    my $self = shift;
    my $ssh = $self-&gt;{&#39;ssh&#39;};

    return unless &#40;$self-&gt;enabled&#41;;

    $self-&gt;mgr-&gt;register_handler&#40;SSH2_MSG_USERAUTH_INFO_REQUEST, sub {
        my &#40;$amgr, $pkt&#41; = @_;
        $ssh-&gt;debug&#40;&#39;auth keyboard-interactive: rcvd info req&#39;&#41;;
        my &#40;$name, $instruction, $lang, $n_prompts&#41; =
            &#40;$pkt-&gt;get_str, $pkt-&gt;get_str, $pkt-&gt;get_str, $pkt-&gt;get_int32&#41;;
        $ssh-&gt;debug&#40;&#34;auth info req: name=&#39;$name&#39; instruction=&#39;$instruction&#39; &#34; .
                    &#34;language=&#39;$lang&#39; prompts=$n_prompts&#34;&#41;;
        my @prompts = map { [$pkt-&gt;get_str, $pkt-&gt;get_int8] } &#40;1 .. $n_prompts&#41;;
        my $r_pkt = $ssh-&gt;packet_start&#40;SSH2_MSG_USERAUTH_INFO_RESPONSE&#41;;
        $r_pkt-&gt;put_int32&#40;$n_prompts&#41;;
        if &#40;my $h = _dispatch&#40;$self, $name, $instruction, $lang, \@prompts&#41;&#41; {
            $r_pkt-&gt;put_str&#40;&#38;$h&#40;$self, $name, $instruction, $lang, @$_&#41;&#41;
                for &#40;@prompts&#41;;
        } elsif &#40;$ssh-&gt;config-&gt;get&#40;&#39;interactive&#39;&#41;&#41; {
            print map { s/[[:cntrl:]]+//g; &#34;$_\n&#34; } grep { length }
                  &#40;$name, $instruction&#41;;
            $r_pkt-&gt;put_str&#40;_prompt&#40;$_-&gt;[0], undef, $_-&gt;[1]&#41;&#41; for &#40;@prompts&#41;;
        } elsif &#40;$n_prompts != 0&#41; {
            $ssh-&gt;debug&#40;&#39;auth keyboard-interactive: cannot handle info req&#39;&#41;;
            # We&#39;re not in interactive mode so we can&#39;t prompt anybody
            # and we don&#39;t have a handler for this request, so we mark
            # ourselves disabled, and abandon the current info request
            # by sending a new, &#34;none&#34; method, auth request.
            $self-&gt;enabled&#40;0&#41;;
            $r_pkt = $ssh-&gt;packet_start&#40;SSH2_MSG_USERAUTH_REQUEST&#41;;
            $r_pkt-&gt;put_str&#40;$ssh-&gt;config-&gt;get&#40;&#39;user&#39;&#41;&#41;;	# user
            $r_pkt-&gt;put_str&#40;&#39;ssh-connection&#39;&#41;;		# service name
            $r_pkt-&gt;put_str&#40;&#39;none&#39;&#41;;			# method name
        }
        $r_pkt-&gt;send;
    }&#41;;

    $ssh-&gt;debug&#40;&#39;auth keyboard-interactive: send req&#39;&#41;;
    my $packet = $ssh-&gt;packet_start&#40;SSH2_MSG_USERAUTH_REQUEST&#41;;
    $packet-&gt;put_str&#40;$ssh-&gt;config-&gt;get&#40;&#39;user&#39;&#41;&#41;;	# user
    $packet-&gt;put_str&#40;&#39;ssh-connection&#39;&#41;;			# service name
    $packet-&gt;put_str&#40;&#39;keyboard-interactive&#39;&#41;;		# method name
    $packet-&gt;put_str&#40;&#39;&#39;&#41;;				# language
    $packet-&gt;put_str&#40;&#39;&#39;&#41;;				# submethods
    $packet-&gt;send;

    return 1;
}

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;25&nbsp;20:16:20&nbsp;2009</span>
    <span class="description">greg [...] turnstep.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If there&#39;s a chance that my replacement
&gt; could just become the default keyboard-interactive authentication method
&gt; implementation for Net::SSH::Perl, then I&#39;d happily write up some pod
&gt; too
</div>
There is definitely a chance, so POD would be very welcome.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;04:20:44&nbsp;2012</span>
    <span class="description">schwigon [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 25 20:16:20 2009, TURNSTEP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; If there&#39;s a chance that my replacement
&gt; &gt; could just become the default keyboard-interactive authentication method
&gt; &gt; implementation for Net::SSH::Perl, then I&#39;d happily write up some pod
&gt; &gt; too
</div>&gt; 
&gt; There is definitely a chance, so POD would be very welcome.
</div>
The patch is now in its own branch here:

  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/renormalist/Net-SSH-Perl/tree/keyboardinteractive">https://github.com/renormalist/Net-SSH-Perl/tree/keyboardinteractive</a></span>

Kind regards,
Steffen
-- 
Steffen Schwigon &lt;ss5@renormalist.net&gt;
Dresden Perl Mongers &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://dresden-pm.org/">http://dresden-pm.org/</a></span>&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;06:16:30&nbsp;2012</span>
    <span class="description">schwigon [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Branch maintenance. It&#39;s now here:

 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/renormalist/Net-SSH-Perl/tree/rt23947-keyboard-interactive">https://github.com/renormalist/Net-SSH-Perl/tree/rt23947-keyboard-interactive</a></span>

Steffen
-- 
Steffen Schwigon &lt;ss5@renormalist.net&gt;
Dresden Perl Mongers &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://dresden-pm.org/">http://dresden-pm.org/</a></span>&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;09&nbsp;18:31:28&nbsp;2013</span>
    <span class="description">schwigon [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 10 06:16:30 2012, SCHWIGON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Branch maintenance. It&#39;s now here:
&gt; 
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/renormalist/Net-SSH-Perl/tree/rt23947-keyboard-">https://github.com/renormalist/Net-SSH-Perl/tree/rt23947-keyboard-</a></span>
&gt; interactive
</div>
Now part of v1.36, just uploaded to CPAN.

Steffen
-- 
Steffen Schwigon &lt;ss5@renormalist.net&gt;
Dresden Perl Mongers &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://dresden-pm.org/">http://dresden-pm.org/</a></span>&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;09&nbsp;18:33:39&nbsp;2013</span>
    <span class="description">schwigon [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
