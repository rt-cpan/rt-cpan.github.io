<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #1818 for NexTrieve: problem with hitlist::hit - attributes with value &#39;0&#39;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #1818 for NexTrieve: problem with hitlist::hit - attributes with value &#39;0&#39;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/NexTrieve/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/NexTrieve/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/NexTrieve/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/NexTrieve/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/NexTrieve">NexTrieve CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">1818</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/NexTrieve/Active/">NexTrieve</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ELIZABETH [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
vladimir.tomasovic [...] galeus.sk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-23656-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23657-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;25&nbsp;09:21:43&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> problem with hitlist::hit - attributes with value &#39;0&#39;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Current version has problem with Hitlist::Hit.pm in Nextrvieve.pm v 0.38, because attributes with value &#39;0&#39; are returned as &#39;1&#39;.

I&#39;m sending patched version as attachments, however the solution is not clean, &#39;cause it might break &#34;$value || 1&#34; pattern used originally. 

I expect, that some other parts of Nextrieve expect empty attribute to mean &#39;1&#39; &#40;flag type?&#41;. Maybe it depend on attribute type, however, for correct handling, attribute type would have to be checked before altering attribute value stored in attribute hash.

One more comment: I run the test suite with attribute &#34;flag&#34; typed as &#34;number&#34;, &#39;cause using attribute type &#34;flag&#34; causes segmentation faults &#40;Nextrieve company has been informed already&#41;.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package NexTrieve::Hitlist::Hit;

# Set modules to inherit from
# Set version information
# Make sure we do everything by the book from now on

@ISA = qw&#40;NexTrieve&#41;; # nothing from NexTrieve::Hitlist
$VERSION = &#39;0.38&#39;;
use strict;

# Satisfy -require-

1;

#------------------------------------------------------------------------

#  IN: 1..N names of single valued attributes &#40;default: all in void context&#41;
# OUT: 1..N values &#40;firsts if &gt;1 attribute, else all of single attribute&#41;
# sets variables in caller&#39;s namespace if called in void contect

sub attributes {

# Obtain the object
# Obtain the reference to the hash

  my $self = shift;
  my $hash = $self-&gt;[2];

# If we&#39;re expected to return a list
#  Return multivalued single attribute data if only one name specified
#  Return all first values of the attribute names specified

  if &#40;wantarray&#41; {
    return map {$_-&gt;[1]} @{$hash-&gt;{scalar&#40;shift&#41;}} if @_ == 1;
    return map {
                exists&#40; $hash-&gt;{$_} &#41; ? &#40;defined&#40; $hash-&gt;{$_}-&gt;[0]-&gt;[1] &#41; ? $hash-&gt;{$_}-&gt;[0]-&gt;[1] : 1&#41; : undef
               } @_;
  }

# If we&#39;re expecting a scalar value
#  Add error if there is more than one name specified
#  Fetch all values of the first attribute and return them

  if &#40;defined&#40;wantarray&#41;&#41; {
    my $name = shift;
    $self-&gt;_add_error&#40; &#34;Can only return a single value, multiple attribute names specified, returning only &#39;$name&#39;&#34; &#41; if @_;
    return map {$_-&gt;[1]} @{$hash-&gt;{$name}};
  }

# Allow variable references
# Obtain the namespace to be used
# For all of the attributes specified
#  Obtain all of the values and put as list in namespace
#  If an attribute exists but has no value, it is a flag and it should be set
#  Make sure the first value of the list is also a scalar in the namespace

  no strict &#39;refs&#39;;
  my $namespace = caller&#40;&#41;.&#39;::&#39;;
  foreach my $name &#40;@_&#41; {
    my $fullname = $namespace.$name;
    @{$fullname} = map {&#40;defined&#40; $_-&gt;[1] &#41; ? $_-&gt;[1] : 1&#41; } @{$hash-&gt;{$name}};
    ${$fullname} = &#40;@{$fullname}&#41;[0];
  }
} #attributes

#------------------------------------------------------------------------

# OUT: 1 docid of hit

sub docid { shift-&gt;[0]-&gt;{&#39;docid&#39;} } #docid

#------------------------------------------------------------------------

# OUT: 1 ordinal number of hit

sub ordinal { shift-&gt;[0]-&gt;{&#39;ordinal&#39;} } #ordinal

#------------------------------------------------------------------------

# OUT: 1 preview of hit

sub preview { shift-&gt;[1] } #preview

#------------------------------------------------------------------------

# OUT: 1 score of hit

sub score { shift-&gt;[0]-&gt;{&#39;score&#39;} } #score

#------------------------------------------------------------------------

__END__

=head1 NAME

NexTrieve::Hitlist::Hit - handle the Hit specifications of NexTrieve

=head1 SYNOPSIS

 use NexTrieve;
 $ntv = NexTrieve-&gt;new&#40; | {method =&gt; value} &#41;;
 $search = $ntv-&gt;Search&#40; file | $resource | server:port | port &#41;;
 $query = $ntv-&gt;Query&#40; | file | xml | {method =&gt; value} &#41;;
 $hitlist = $search-&gt;Hitlist&#40; $query | xml | {method =&gt; value} &#41;;

 # loop through all hits
 foreach $hit &#40;$hitlist-&gt;Hits&#41; { }

 # get a specific hit
 $hit = $hitlist-&gt;Hit&#40; $ordinal &#41;;

=head1 DESCRIPTION

The Hit object of the Perl support for NexTrieve.  Do not create
directly, but through the Hit&#40;s&#41; method of the NexTrieve::Hitlist object.

Please note that the NexTrieve::Hitlist::Hit object is actually part of the
NexTrieve::Hitlist object and can therefore only be created through any module
that creates a NexTrieve::Hitlist object &#40;such as the NexTrieve::Search module&#41;.

=head1 METHODS

The following methods are available to the NexTrieve::Hitlist::Hit object.

=head2 attributes

 @multi = $hit-&gt;attributes&#40; &#39;multivaluedattributename&#39; &#41;;

 $single = $hit-&gt;attributes&#40; &#39;singlevaluedattributename&#39; &#41;;
 &#40;$one,$two,$three&#41; = $hit-&gt;attributes&#40; qw&#40;attr1 attr2 attr3&#41; &#41;;

 $hit-&gt;attributes&#40; qw&#40;attr1 attr2&#41; &#41;; # set @attr1, $attr1, @attr2 $attr2

The &#34;attributes&#34; method is a versatile method that returns the attribute
information of one or more attributes.

If an attribute is multi-valued &#40;i.e. it has a multiplicity of &#34;*&#34; in the
NexTrieve resource file&#41;, then all the values of one such attribute can be
returned at a time.  In that case, the one and only input parameter is the
name of the attribute.

If the attributes in question, are single-valued &#40;i.e. have a multiplicity of
&#34;1&#34; in the NexTrieve Resource file&#41;, then there are basically two modes of
operation.  In the first of those modes, you simply specify the name&#40;s&#41; of the
attribute&#40;s&#41; of which you want to obtain the values.  They are then returned
in the same order as with which the names are specified.

In the other of these modes, the &#34;attributes&#34; method is called in void
context.  It then sets the global variables and lists with the same name
as the name of the attribute in the namespace of the calling subroutine.  This
can be particularly handy in templating situations, where you want to quickly
access the result of a search query without being particularly interested in
the efficiency of execution.

=head2 docid

 $docid = $hit-&gt;docid;

The &#34;docid&#34; method returns the docid number of the document for which the
hit is returned in the hitlist.  It is an arbitrary number uniquely identifying
the document in the NexTrieve index.

=head2 ordinal

 $ordinal = $hit-&gt;ordinal;

The &#34;ordinal&#34; method returns the ordinal number of the hit in the conceptual
hitlist that was returned.  Its value is between the values returned by the
&#34;firsthit&#34; and &#34;lasthit&#34; methods of the NexTrieve::Hitlist object inclusive.

=head2 preview

 $preview = $hit-&gt;preview;

The &#34;preview&#34; method returns the preview that is associated with this
particular hit.  It is an XML string that may contain &lt;B&gt;...&lt;/B&gt; containers
for highlighted words.

=head2 score

 $score = $hit-&gt;score;

The &#34;score&#34; method returns the score that is associated with this particular
hit.  It is a numeric value that has no meaning by itself but only in relation
to other values in the hitlist.  The value of the score determines the order
of the hits in the hitlist.

=head1 AUTHOR

Elizabeth Mattijsen, &lt;liz@dijkmat.nl&gt;.

Please report bugs to &lt;perlbugs@dijkmat.nl&gt;.

=head1 COPYRIGHT

Copyright &#40;c&#41; 1995-2002 Elizabeth Mattijsen &lt;liz@dijkmat.nl&gt;. All rights
reserved.  This program is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.

=head1 SEE ALSO

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.nextrieve.com">http://www.nextrieve.com</a></span>, the NexTrieve.pm and the other NexTrieve::xxx modules.

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;25&nbsp;12:34:05&nbsp;2002</span>
    <span class="description">ELIZABETH [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;26&nbsp;09:56:48&nbsp;2002</span>
    <span class="description">liz [...] dijkmat.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 26 Nov 2002 15:57:10 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-NexTrieve [...] rt.cpan.org, &#34;AdminCc of cpan Ticket #1818&#34;: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Elizabeth Mattijsen &lt;liz [...] dijkmat.nl&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #1818] problem with hitlist::hit - attributes with value &#39;0&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">At 09:21 -0500 11/25/02, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;This message about NexTrieve was sent to you by guest via rt.cpan.org
&gt;
&gt;Full context and any attached attachments can be found at:
&gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=1818">https://rt.cpan.org/Ticket/Display.html?id=1818</a></span> &gt;
&gt;
&gt;Hello,
&gt;
&gt;Current version has problem with Hitlist::Hit.pm in Nextrvieve.pm v 
&gt;0.38, because attributes with value &#39;0&#39; are returned as &#39;1&#39;.
&gt;I&#39;m sending patched version as attachments, however the solution is 
&gt;not clean, &#39;cause it might break &#34;$value || 1&#34; pattern used 
&gt;originally.
</div>
I&#39;m not sure what the problem is exactly.  And to be honest, I don&#39;t 
have the tuits to really look into this until the weekend.

I seem to recall however that for performance reasons, the existence 
of an attribute should be construed as &#34;1&#34;, and the absence as &#34;0&#34;. 
Which was the reason for the code as you found in 
NexTrieve::Hitlist::Hit.pm.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I expect, that some other parts of Nextrieve expect empty attribute 
&gt;to mean &#39;1&#39; &#40;flag type?&#41;. Maybe it depend on attribute type, 
&gt;however, for correct handling, attribute type would have to be 
&gt;checked before altering attribute value stored in attribute hash.
</div>
Probably.  But to be sure that your patch doesn&#39;t break things, I 
will need some more tuits.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;One more comment: I run the test suite with attribute &#34;flag&#34; typed 
&gt;as &#34;number&#34;, &#39;cause using attribute type &#34;flag&#34; causes segmentation 
&gt;faults &#40;Nextrieve company has been informed already&#41;.
</div>
Just curious: did they respond?  And if so, how?



Liz
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;09&nbsp;08:12:27&nbsp;2003</span>
    <span class="description">ELIZABETH [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
