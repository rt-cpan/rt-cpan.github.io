<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #19867 for Encode: Transcoding problems &#40;ISO-2022-JP to UTF-8&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #19867 for Encode: Transcoding problems &#40;ISO-2022-JP to UTF-8&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Encode/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Encode/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Encode/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Encode/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Encode">Encode CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">19867</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Encode/Active/">Encode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Ben.Evans [...] morganstanley

<br />
com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-12062-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12063-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;13&nbsp;07:04:16&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Transcoding problems &#40;ISO-2022-JP to UTF-8&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dan,

I&#39;ve encountered an issue whereby Microsoft and other tools working in a
Japanese encoding &#40;JIS X 208&#41; will use the code point 0x2d21 to
represent a character comprising a circled digit 1 &#40;and 0x2d22 is
circle-2, etc&#41; and save the resulting as ISO-2022-JP. 

This is not officially defined in the standards, but according to
Japanese colleagues is in widespread usage.

When transcoding to UTF-8 0x2d21 is converted to U2460 &#40;which seems like
a sane thing to do&#41;, but on round-tripping back to ISO-2022-JP, this
code point is lost, and is left as \x{2460}.

I&#39;ve attached a sample file of Japanese text. The roundtrip code should
be trivial.

&#40;The use case here, for reference, is that I have text/html in
ISO-20220-JP and need to convert it to UTF-8 prior to parsing, else the
parser tends to fall over any 0x3c bytes in the stream which are coming
from Japanese mode, and then need to get it back to ISO-2022-JP prior to
display&#41;. 

Is there any way of getting Encode to use a &#39;quirks&#39; mode or similar to
allow the non-standard code points to be converted back to MSFT&#39;s
version of JIS X 208?

Oh, this is the Encode which comes as standard with both perl 5.8.4 and
5.8.8 - it&#39;s a custom build running on RHEL 3.0

Thanks,

Ben
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> hy-new-2006-06-13-1.txt</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">test1テスト
齡ぢ３柑３源３校４飴４瓜鹿粡鹿粡
鹿粡
鹿粡
鹿粡
鹿粡
寂蝟赱齠就站續鱇銖痺闔纉黶艱闥鱚齔闔纐緕⊂
寂蝟赱齠就站續鱇銖痺闔⊂
寂蝟赱齠就辣籬⊂
首鞜竚癈鷭♯紜碵雹
鹿齔瘤首鞜竚癈鷭≫癆紜菖碵雹宝遉鈞齔傘界鈞齔三刑姥些孔鈞齔参旭脅鞜郛
首鞜竚癈鷭≫纉竰蜷闔⊂珍遼惑蘇鞜隨闥闥鱚齔闔粤釿痲粤篌鞜郛
首鞜竚癈鷭♯蜊絖諷遐昭鞜郛首鞜竚癈鷭≡笏蜿銖蜆粤遐昭鞜郛
鹿粡
寂蝟赱齠就竢銓緕槇

寂蝟赱齠就辣齠瘍繧閼寂蝟赱齠就辣齠瘍絖齡瘤赱蜴纔蜚絖齔痺紜章奕宝嘘刑梓艮屋斡苺纉阡綺
首鞜竚癈鷭纉黶艱鋩甅肬趙纈跫黼笄
闔竚蜒觸∽闌籖辣齠瘍縷齡瘤蓍鵺嚠阯樢屋髟阡繖樢屋К皮粤樢屋髟阡繖樢屋З拶肖蓖髟阡繖纔鞜郛錫寂蝟赱齠就辣齠瘍絖齡瘤跫黼笄商苳鶴遯
Γ街事緕竢鱚瘤齠蒹鱚磔蜒鳫齒胄鈔纈闖踈闥謇鈑瘰瘤纉緕竢粡鈑４飴壁屋研４瓜蛹竢粤濶銓箍
辮鱚黼銓葹鱇笏纈闕頏蜩蜴竕鱆跂粡芍Γ完氏鈔箍蜩
蜥竚絖岡Γ官瘤黶蒹纉鈑瓶廊屋臆豫蓍蜩阡聿蜒蛛跛粤肅鈬蜴蒹鈔癇糂碯痺竢鰾蜴
瘰瘤纉竢跛縺苺纉蜴蜆纉頏縺瘍絎
鹿粡
麗閹肅竕瘡蒹鱚肬鱚阡竟鶯繖鞳鱸閼壽蜩齔繝蛛跛緕竢辣嗜芦沖偏
首鞜竚癈鷭纉黶艱鋩甅肬趙纈跫黼笄
闔竚蜒觸∽闌籖辣齠瘍縷齡瘤蓍鵺嚠阯樢屋髟阡繖樢屋К皮粤樢屋髟阡繖樢屋З拶肖蓖髟阡繖纔鞜郛錫寂蝟赱齠就辣齠瘍絖齡瘤跫黼笄商苳怦緕鱇銖竢粡鈑孕騰因俄憶竢鉚纈牡彊４飴蜒黼纃跚諷
瘤蜴錵４瓜碯闔阨鈔鱸韶蜴矚站瓶廊屋臆亂蓍閼竟蜴蜩闢鈔跂胄樢感胤鹿粡
部Γ街雌闔皷粤鱚轣趾闥辣蜴嗜芦沖偏梼竢粤痺鈑闥鱚笏踟
首鞜竚癈鷭纉黶艱鋩甅肬趙纈跫黼笄
闔竚蜒觸∽闌籖辣齠瘍縷齡瘤蓍鵺嚠阯樢屋髟阡繖樢屋К皮粤樢屋髟阡繖樢屋З拶肖蓖髟阡繖纔鞜郛錫寂蝟赱齠就辣齠瘍絖齡瘤跫黼笄商苳髭３校痺蒹黶逅跂蛹閹瘰瘤纉壽鳫糘鱸竢粤蓖蝟蛛谺
４飴壽竅黼纈絳闥繙纈緕竇蜩葹葹纔蔗迪嗜芦屋瘤鈬繖竢鉚纈蜚孕騰頏蜿癇皷鈑繻黼蒹
癇黼鈔瘡阮纈銷磔蜴蒹縺蜒癇竢迚鈑
鳫捕鞜鈬黼閼絳鈔蒹鈬繖艱蜚痺嗜芦沖偏鱸闥蜩韭癨Γ官皿纈瘤閹續鈑釿閼黼３校髟蜥謫Γ街迴粤皷迚赱
跛阯蒹闔鈔癇竢粤濶銓竢鉚纈矚站羊瀞Γ街雌
纈皷闔壁屋舷
鹿粡
侮齡縺閹鳬閼絳釿閼閹聽鴦纈蜿癨痲迴鱚釿閼蜴苴黼梼竢粤査梼竢粡鈑鵺釿怪瘤梼竢粤査鍍段侏肬粤蛹鶤

瘡齒繝闕緕癆阨瘡癇絖黶轣蜴蜴梼竢粤査鍍段侏闔蓍
頏閧跂蹼
吏闢蜚蜿蜩葹竅銕阡葹鈑梼竢粤癈闔阨鱇闔瘡皷釿纈癇繿闥纐緕闥銛轤纈鞳關跂覗瀕嘖き蜴瓶廊屋臆豫

囂鱸釿閼纔銖蜿癆阨鈬繖鞳鱶瘰癇絖黶隨綜鼈癇鱚齡蛛仭流

秩黼蜩迚齠繖
首鞜竚癈鷭纉黶艱鋩甅肬趙纈跫黼笄
闔竚蜒觸∽闌籖辣齠瘍縷齡瘤蓍鵺嚠阯樢屋髟阡繖樢屋К皮粤樢屋髟阡繖樢屋З拶肖蓖髟阡繖纔鞜郛錫寂蝟赱齠就辣齠瘍絖齡瘤跫黼笄商苳蜩梼竢粤蓍竏闕纉齡瘤籬鰾蜚硼纈貴軒瘤熙３校笊齡闕趙鉗鈑卮徒
葹鉉鵺
緕
鹿粡
鶴梼竢粤瘟銓瘟鈬鹿粡鹿粡
鹿粡
鹿粡
鹿粡
寂蝟赱齠就站續鱇銖痺闔癈蜒囈癆粐⊂
寂蝟赱齠就站續鱇銖痺闔⊂
寂蝟赱齠就辣籬⊂
首鞜竚癈鷭♯紜碵雹
鹿齔瘤首鞜竚癈鷭≫癆紜菖碵雹宝遉鈞齔傘界鈞齔三刑姥佐愛鈞齔参旭脅鞜郛
首鞜竚癈鷭≫纉竰蜷闔⊂壽參蜚黼趾囈癆葹鈑繖鳫Γ街試纓Γ街３校關緕Γ街纂鞜郛
首鞜竚癈鷭♯蜊絖諷遐昭鞜郛首鞜竚癈鷭≡笏蜿銖蜆粤遐昭鞜郛
鹿粡
寂蝟赱齠就竢銓緕槇鹿粡
鹿粡
鹿粡
寂蝟赱齠就站續鱇銖痺闔癈蜒囈癆遐寂蝟赱齠就站續鱇銖痺闔⊂
寂蝟赱齠就辣籬⊂
首鞜竚癈鷭♯紜碵雹
鹿齔瘤首鞜竚癈鷭≫癆紜菖碵雹宝遉鈞齔傘界鈞齔三刑姥佐共鈞齔参旭脅鞜郛
首鞜竚癈鷭≫纉竰蜷闔⊂珍遼惑蘇鞜隨闥竏瘤艱胙闕３校關緕Γ街３校鱚齒踝繖Γ街纂鞜郛
首鞜竚癈鷭♯蜊絖諷遐昭鞜郛首鞜竚癈鷭≡笏蜿銖蜆粤遐昭鞜郛
鹿粡
寂蝟赱齠就竢銓緕槇鹿粡
鹿粡
鹿粡
鹿粡
取竚癈鷭≪跂癇
鹿粡
鹿粡




鹿粡


取竚癈鷭≪跂癇
鹿粡
鹿硼糯鹿蔗迪