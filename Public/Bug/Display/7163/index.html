<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #7163 for Spreadsheet-WriteExcel: File created in UNIX crashes Excel</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #7163 for Spreadsheet-WriteExcel: File created in UNIX crashes Excel</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Spreadsheet-WriteExcel">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Spreadsheet-WriteExcel">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Spreadsheet-WriteExcel">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Spreadsheet-WriteExcel">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Spreadsheet-WriteExcel">Spreadsheet-WriteExcel CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p><b>If you are reporting a bug in Spreadsheet::WriteExcel here are some pointers</b>
<p>

1) State the issues as clearly and as concisely as possible. A simple program or Excel test file (see below) will often explain the issue better than a lot of text.
<p>

2) Provide information on your system, version of perl and module versions. The following program will generate everything that is required. Put this information in your bug report.
<pre>
    #!/usr/bin/perl -w

    print "\n    Perl version   : $]";
    print "\n    OS name        : $^O";
    print "\n    Module versions: (not all are required)\n";

    my @modules = qw(
                      Spreadsheet::WriteExcel
                      Parse::RecDescent
                      File::Temp
                      OLE::Storage_Lite
                      IO::Stringy
                      Spreadsheet::ParseExcel
                      Scalar::Util
                      Unicode::Map
                    );

    for my $module (@modules) {
        my $version;
        eval "require $module";

        if (not $@) {
            $version = $module-&gt;VERSION;
            $version = '(unknown)' if not defined $version;
        }
        else {
            $version = '(not installed)';
        }

        printf "%21s%-24s\t%s\n", "", $module, $version;
    }

    __END__
</pre>
<p>

3) Upgrade to the latest version of Spreadsheet::WriteExcel (or at least test on a system with an upgraded version). The issue you are reporting may already have been fixed.

<p>
4) <b>Create a small but complete example program that demonstrates your problem.</b> The program should be as small as possible. At the same time it should be a complete program that generates an Excel file. If the Spreadsheet::WriteExcel section is part of a much larger program then simplify it down to the essentials. Simulate any DB reads with an array.
<p>

5) Say if you tested with Excel, OpenOffice, Gnumeric or something else. Say which version of that application you used.
<p>

6) If you are submitting a patch you should check with the author whether the issue has already been patched or if a fix is in the works. Patches should be accompanied by test cases.
<p>
<b>Asking a question</b>
<p>
If you would like to ask a more general question there is the <a href="http://groups.google.com/group/spreadsheet-writeexcel">Spreadsheet::WriteExcel Google Group</a>.
<p></p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">7163</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">20 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Spreadsheet-WriteExcel">Spreadsheet-WriteExcel</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jmcnamara [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Marianne.M.Mason [...] verizon.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-29480-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.03    </td>
  </tr>
  <tr id="CF-29481-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




TNECPC04-CTR1.xls<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/108809/21230/TNECPC04-CTR1.xls">
Wed Jul 28 15:17:38 2004 (10k) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=7163">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-108809" href="/Public/Bug/Display.html?id=7163#txn-108809">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;28&nbsp;15:17:38&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> File created in UNIX crashes Excel</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/108809/21229/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21229">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am trying to create spreadsheet from data extracted from MySQL 3.23.
The script is running on SunOS corsair 5.6 Generic_105181-29 sun4u sparc SUNW,Ultra-Enterprise.

When opening file in Excel XP &#40;2003&#41; or Excel 2000, the following behavior occurs:
First appearance of text in column A, and column Q &#40;last column written&#41; is not shown.
Attempts to resize any column or otherwise format the cell to make the text appear, causes Excel to crash and send error report.
Upon restarting and repairing the original file, all text is seen and no actions cause Excel to crash.

Code snippet as follows:
my $workbook = Spreadsheet::WriteExcel-&gt;new&#40;&#34;TNECPC04-CTR1.xls&#34;&#41;;
$sheet1 = $workbook-&gt;add_worksheet&#40;&#34;NE CPC TOTAL&#34;&#41;;
$format1 = $workbook-&gt;add_format&#40;&#41;;
$format1-&gt;set_bold&#40;&#41;;
$format1-&gt;set_align&#40;&#39;center&#39;&#41;;
$format1-&gt;set_valign&#40;&#39;vcenter&#39;&#41;;
$format2 = $workbook-&gt;add_format&#40;&#41;;
$format2-&gt;set_bg_color&#40;&#39;red&#39;&#41;;

$format3 = $workbook-&gt;add_format&#40;&#41;;
$format3-&gt;set_bold&#40;&#41;;
$format3-&gt;set_align&#40;&#39;center&#39;&#41;;
$format3-&gt;set_valign&#40;&#39;center&#39;&#41;;
$format3-&gt;set_italic&#40;&#41;;
$format3-&gt;set_size&#40;&#39;8&#39;&#41;;

$format4 = $workbook-&gt;add_format&#40;&#41;;
$format4-&gt;set_align&#40;&#39;left&#39;&#41;;
$format4-&gt;set_italic&#40;&#41;;
$format4-&gt;set_size&#40;&#39;8&#39;&#41;;

$fnum1 = $workbook-&gt;add_format&#40;&#41;;
$fnum1-&gt;set_num_format&#40;&#39;#,##0&#39;&#41;;
$fnum2 = $workbook-&gt;add_format&#40;&#41;;
$fnum2-&gt;set_num_format&#40;&#39;0.00%&#39;&#41;;
$sheet1-&gt;set_column&#40;&#39;A:A&#39;, 20&#41;;
$sheet1-&gt;set_column&#40;&#39;Q:Q&#39;, 10&#41;;
$sheet1-&gt;merge_range&#40;&#39;A1:Q1&#39;, &#39;Main Title&#39;, $format1&#41;;
$sheet1-&gt;merge_range&#40;&#39;A2:Q2&#39;, &#39;SubTitle&#39;, $format1&#41;;
$sheet1-&gt;merge_range&#40;&#39;A3:Q3&#39;, &#39;SubTitle&#39;, $format1&#41;;
$sheet1-&gt;merge_range&#40;&#39;A4:Q4&#39;, &#34;$mon, $year&#34;, $format1&#41;;
$sheet1-&gt;merge_range&#40;&#39;A5:Q5&#39;, &#39;         &#39;, $format1&#41;;
$sheet1-&gt;write_blank&#40;&#39;A6&#39;, undef&#41;;
$sheet1-&gt;write&#40;&#39;B6&#39;, &#39;MESSAGE&#39;, $format1&#41;;#this text sporadically appears
$sheet1-&gt;merge_range&#40;&#39;C6:G6&#39;, &#39;DSO\&#39;s&#39;, $format1&#41;;
$sheet1-&gt;write&#40;&#39;H6&#39;, &#39;HI-CAP&#39;, $format1&#41;;
$sheet1-&gt;merge_range&#40;&#39;I6:K6&#39;, &#39;CARRIER&#39;, $format1&#41;;
$sheet1-&gt;merge_range&#40;&#39;L6:P6&#39;, &#39;OTHER TIRKS PROVISIONING&#39;, $format1&#41;;
$sheet1-&gt;write&#40;&#39;Q6&#39;, &#39;TOTAL&#39;, $format1&#41;;#this text does not appear
$sheet1-&gt;write&#40;&#39;A7&#39;, &#39;TOTAL MONTH&#39;, $format1&#41;;#this text does not appear
$sheet1-&gt;write_blank&#40;&#39;B7&#39;, $format1&#41;;
$sheet1-&gt;write&#40;&#39;C7&#39;, &#39;Analog&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;D7&#39;, &#39;Digital&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;E7&#39;, &#39;Loc. Spec.&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;F7&#39;, &#39;Comp. Ckts.&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;G7&#39;, &#39;Total&#39;, $format3&#41;;
$sheet1-&gt;write_blank&#40;&#39;H7&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;I7&#39;, &#39;Customer&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;J7&#39;, &#39;Infra.&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;K7&#39;, &#39;Total&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;L7&#39;, &#39;Cables&#39;, $format3&#41;;
$sheet1-&gt;write_string&#40;&#39;M7&#39;, &#39;Power/Pulse&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;N7&#39;, &#39;Routing&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;O7&#39;, &#39;Spans&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;P7&#39;, &#39;Total&#39;, $format3&#41;;
$sheet1-&gt;write_blank&#40;&#39;Q7&#39;, $format3&#41;;
$sheet1-&gt;set_row&#40;7, 5&#41;;
$sheet1-&gt;merge_range&#40;&#39;A8:Q8&#39;, &#39; &#39;, $format2&#41;;
#row 9 
$sheet1-&gt;write&#40;&#39;A9&#39;, &#39;Orders RID Total&#39;, $format4&#41;;
$sheet1-&gt;write&#40;&#39;B9&#39;, &#34;$messagetotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;C9&#39;, &#34;$dsoanatotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;D9&#39;, &#34;$dsodigtotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;E9&#39;, &#34;$dsolstotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;F9&#39;, &#34;$dsocctotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;G9&#39;, &#34;$dsototal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;H9&#39;, &#34;$hicaptotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;I9&#39;, &#34;$carriercustotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;J9&#39;, &#34;$carrierinfratotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;K9&#39;, &#34;$carriertotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;L9&#39;, &#34;$cablestotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;M9&#39;, &#34;$pptotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;N9&#39;, &#34;$routingtotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;O9&#39;, &#34;$spanstotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;P9&#39;, &#39;=SUM&#40;L9:O9&#41;&#39;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;Q9&#39;, &#39;=SUM&#40;B9,G9,H9,K9,P9&#41;&#39;, $fnum1&#41;;
.... more of same code....
$sheet1-&gt;activate&#40;&#41;;
$sheet1-&gt;select&#40;&#41;;
$workbook-&gt;close&#40;&#41;;

Thank you for any help or suggestions you may provide.
Marianne
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/108809/21230/TNECPC04-CTR1.xls">Download TNECPC04-CTR1.xls</a><br />
<span class="downloadcontenttype">application/vnd.ms-excel 10k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-108810" href="/Public/Bug/Display.html?id=7163#txn-108810">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;28&nbsp;16:37:36&nbsp;2004</span>
    <span class="description">jmcnamara [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-108811" href="/Public/Bug/Display.html?id=7163#txn-108811">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;28&nbsp;16:49:33&nbsp;2004</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">20 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/108811/21236/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21236">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Wed Jul 28 15:17:38 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When opening file in Excel XP &#40;2003&#41; or Excel 2000, the following
&gt; behavior occurs:
&gt; First appearance of text in column A, and column Q &#40;last column
&gt; written&#41; is not shown.
&gt; Attempts to resize any column or otherwise format the cell to make the
&gt; text appear, causes Excel to crash and send error report.
&gt; Upon restarting and repairing the original file, all text is seen and
&gt; no actions cause Excel to crash.
&gt; 
&gt; Code snippet as follows:
&gt; ...
&gt;
</div>
Hi,

Thanks for the detailed report.

The problem is that formats used for merged ranges shouldn&#39;t be used for
 non-merged cells. This is mentioned in the documentation but it
probably isn&#39;t highlighted enough. See

<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~jmcnamara/Spreadsheet-WriteExcel/lib/Spreadsheet/WriteExcel.pm#merge_range&#40;$first_row,_$first_col,_$last_row,_$last_col,_$token,_$format&#41;">http://search.cpan.org/~jmcnamara/Spreadsheet-WriteExcel/lib/Spreadsheet/WriteExcel.pm#merge_range&#40;$first_row,_$first_col,_$last_row,_$last_col,_$token,_$format&#41;</a></span>

I have some code changes that will make this unnecessary but they
require further testing.

In the meantime the workaround for this problem is to use separate
formats for merge_ranges&#40;&#41;. For example I added the following to your
code and then used the $formatX_merge formats in the merge_range&#40;&#41; calls:

    # New formats only to be used with merged ranges.
    $format1_merge = $workbook-&gt;add_format&#40;&#41;;
    $format2_merge = $workbook-&gt;add_format&#40;&#41;;

    $format1_merge -&gt;copy&#40;$format1&#41;;
    $format2_merge -&gt;copy&#40;$format2&#41;;

Here is your updated code. I tested this with Excel 97, 2000 and 2003.
It also fixes the related problem of the text in some cells not displaying.

#!/usr/bin/perl -w


#use strict;
use Spreadsheet::WriteExcel;

my $workbook  = Spreadsheet::WriteExcel-&gt;new&#40;&#39;TNECPC04-CTR1.xls&#39;&#41;;

$sheet1 = $workbook-&gt;add_worksheet&#40;&#34;NE CPC TOTAL&#34;&#41;;
$format1 = $workbook-&gt;add_format&#40;&#41;;
$format1-&gt;set_bold&#40;&#41;;
$format1-&gt;set_align&#40;&#39;center&#39;&#41;;
$format1-&gt;set_valign&#40;&#39;vcenter&#39;&#41;;

$format2 = $workbook-&gt;add_format&#40;&#41;;
$format2-&gt;set_bg_color&#40;&#39;red&#39;&#41;;


$format3 = $workbook-&gt;add_format&#40;&#41;;
$format3-&gt;set_bold&#40;&#41;;
$format3-&gt;set_align&#40;&#39;center&#39;&#41;;
$format3-&gt;set_valign&#40;&#39;center&#39;&#41;;
$format3-&gt;set_italic&#40;&#41;;
$format3-&gt;set_size&#40;&#39;8&#39;&#41;;


$format4 = $workbook-&gt;add_format&#40;&#41;;
$format4-&gt;set_align&#40;&#39;left&#39;&#41;;
$format4-&gt;set_italic&#40;&#41;;
$format4-&gt;set_size&#40;&#39;8&#39;&#41;;

# New formats only to be used with merged ranges.
$format1_merge = $workbook-&gt;add_format&#40;&#41;;
$format2_merge = $workbook-&gt;add_format&#40;&#41;;

$format1_merge -&gt;copy&#40;$format1&#41;;
$format2_merge -&gt;copy&#40;$format2&#41;;


$fnum1 = $workbook-&gt;add_format&#40;&#41;;
$fnum1-&gt;set_num_format&#40;&#39;#,##0&#39;&#41;;
$fnum2 = $workbook-&gt;add_format&#40;&#41;;
$fnum2-&gt;set_num_format&#40;&#39;0.00%&#39;&#41;;
$sheet1-&gt;set_column&#40;&#39;A:A&#39;, 20&#41;;
$sheet1-&gt;set_column&#40;&#39;Q:Q&#39;, 10&#41;;
$sheet1-&gt;merge_range&#40;&#39;A1:Q1&#39;, &#39;Main Title&#39;,  $format1_merge&#41;;
$sheet1-&gt;merge_range&#40;&#39;A2:Q2&#39;, &#39;SubTitle&#39;,    $format1_merge&#41;;
$sheet1-&gt;merge_range&#40;&#39;A3:Q3&#39;, &#39;SubTitle&#39;,    $format1_merge&#41;;
$sheet1-&gt;merge_range&#40;&#39;A4:Q4&#39;, &#34;$mon, $year&#34;, $format1_merge&#41;;
$sheet1-&gt;merge_range&#40;&#39;A5:Q5&#39;, &#39;         &#39;,   $format1_merge&#41;;
$sheet1-&gt;write_blank&#40;&#39;A6&#39;, undef&#41;;
$sheet1-&gt;write&#40;&#39;B6&#39;, &#39;MESSAGE&#39;, $format1&#41;;#this text sporadically appears
$sheet1-&gt;merge_range&#40;&#39;C6:G6&#39;, &#39;DSO\&#39;s&#39;, $format1_merge&#41;;
$sheet1-&gt;write&#40;&#39;H6&#39;, &#39;HI-CAP&#39;, $format1&#41;;
$sheet1-&gt;merge_range&#40;&#39;I6:K6&#39;, &#39;CARRIER&#39;, $format1_merge&#41;;
$sheet1-&gt;merge_range&#40;&#39;L6:P6&#39;, &#39;OTHER TIRKS PROVISIONING&#39;, $format1_merge&#41;;
$sheet1-&gt;write&#40;&#39;Q6&#39;, &#39;TOTAL&#39;, $format1&#41;;#this text does not appear
$sheet1-&gt;write&#40;&#39;A7&#39;, &#39;TOTAL MONTH&#39;, $format1&#41;;#this text does not appear
$sheet1-&gt;write_blank&#40;&#39;B7&#39;, $format1&#41;;
$sheet1-&gt;write&#40;&#39;C7&#39;, &#39;Analog&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;D7&#39;, &#39;Digital&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;E7&#39;, &#39;Loc. Spec.&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;F7&#39;, &#39;Comp. Ckts.&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;G7&#39;, &#39;Total&#39;, $format3&#41;;
$sheet1-&gt;write_blank&#40;&#39;H7&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;I7&#39;, &#39;Customer&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;J7&#39;, &#39;Infra.&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;K7&#39;, &#39;Total&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;L7&#39;, &#39;Cables&#39;, $format3&#41;;
$sheet1-&gt;write_string&#40;&#39;M7&#39;, &#39;Power/Pulse&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;N7&#39;, &#39;Routing&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;O7&#39;, &#39;Spans&#39;, $format3&#41;;
$sheet1-&gt;write&#40;&#39;P7&#39;, &#39;Total&#39;, $format3&#41;;
$sheet1-&gt;write_blank&#40;&#39;Q7&#39;, $format3&#41;;
$sheet1-&gt;set_row&#40;7, 5&#41;;
$sheet1-&gt;merge_range&#40;&#39;A8:Q8&#39;, &#39; &#39;, $format2_merge&#41;;
#row 9
$sheet1-&gt;write&#40;&#39;A9&#39;, &#39;Orders RID Total&#39;, $format4&#41;;
$sheet1-&gt;write&#40;&#39;B9&#39;, &#34;$messagetotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;C9&#39;, &#34;$dsoanatotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;D9&#39;, &#34;$dsodigtotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;E9&#39;, &#34;$dsolstotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;F9&#39;, &#34;$dsocctotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;G9&#39;, &#34;$dsototal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;H9&#39;, &#34;$hicaptotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;I9&#39;, &#34;$carriercustotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;J9&#39;, &#34;$carrierinfratotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;K9&#39;, &#34;$carriertotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;L9&#39;, &#34;$cablestotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;M9&#39;, &#34;$pptotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;N9&#39;, &#34;$routingtotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;O9&#39;, &#34;$spanstotal&#34;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;P9&#39;, &#39;=SUM&#40;L9:O9&#41;&#39;, $fnum1&#41;;
$sheet1-&gt;write&#40;&#39;Q9&#39;, &#39;=SUM&#40;B9,G9,H9,K9,P9&#41;&#39;, $fnum1&#41;;
#.... more of same code....
$sheet1-&gt;activate&#40;&#41;;
$sheet1-&gt;select&#40;&#41;;
$workbook-&gt;close&#40;&#41;;

__END__
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-108813" href="/Public/Bug/Display.html?id=7163#txn-108813">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;28&nbsp;18:38:34&nbsp;2004</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/108813/21238/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21238">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 285b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[Marianne.M.Mason@verizon.com - Wed Jul 28 18:21:48 2004]:


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Thank you for your detailed response.  I apologize for not picking
&gt; that up
</div>
It is far from obvious. :-&#41;

I&#39;ve made a TODO note to highlight this feature more clearly in the
documentation until it is fixed.

John.
-- 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-108814" href="/Public/Bug/Display.html?id=7163#txn-108814">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;28&nbsp;18:39:00&nbsp;2004</span>
    <span class="description">jmcnamara [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.334297</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
