<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24629 for XML-Tiny: Failure on vanilla 5.004_05</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24629 for XML-Tiny: Failure on vanilla 5.004_05</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Tiny/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Tiny/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Tiny/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Tiny/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Tiny">XML-Tiny CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24629</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">5 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Tiny/Active/">XML-Tiny</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
unobe@cpan.org
(no email address)

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-42252-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.0    </td>
  </tr>
  <tr id="CF-42253-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;27&nbsp;07:36:36&nbsp;2007</span>
    <span class="description">unobe [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Failure on vanilla 5.004_05</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">perl -v:

This is perl, version 5.004_05 built for ppc-darwin

Copyright 1987-1998, Larry Wall

Perl may be copied only under the terms of either the Artistic License
or the
GNU General Public License, which may be found in the Perl 5.0 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using `man perl&#39; or `perldoc perl&#39;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.com/">http://www.perl.com/</a></span>, the Perl Home Page.

uname -a:
Darwin blithe.local 8.8.0 Darwin Kernel Version 8.8.0: Fri Sep  8
17:18:57 PDT 2006; root:xnu-792.12.6.obj~1/RELEASE_PPC Power Macintosh
powerpc

The version of Test::Harness shipped w/5.4.5 is 1.1602 and needs the #
of tests at the beginning, so I changed the test files to fix that. The
overriding of $SIG{__WARN__} also had a typo &#40;$@ needs to be @_&#41;. For
Tiny.pm, in 5.4.5 &#34;exists&#34; only works with hash values &#40;not array
values&#41; so I removed the exists at the end of parsefile&#40;&#41;. This won&#39;t
change functionality b/c the values being tested won&#39;t autovivify. I
also added a test for the value of $file before s///g in Tiny.pm,
because otherwise an &#34;Undefined value...&#34; warning is thrown making the
second test in 00-file-handling.t fail. The attached file is a patch.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XML-Tiny.5.4.5.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -u -r lib/XML/Tiny.pm.orig lib/XML/Tiny.pm
--- lib/XML/Tiny.pm.orig	2007-01-27 04:10:34.000000000 -0800
+++ lib/XML/Tiny.pm	2007-01-27 03:58:06.000000000 -0800
@@ -64,6 +64,7 @@
         $file = &lt;FH&gt;;
         close&#40;FH&#41;;
     } else { $file = &lt;$arg&gt;; }
+    die&#40;&#34;No elements\n&#34;&#41; if &#40;!defined $file or $file =~ /^\s*$/&#41;;
     # strip leading/trailing whitespace and comments &#40;which don&#39;t nest - phew!&#41;
     $file =~ s/^\s+|&lt;!--.*?--&gt;|\s+$//g;
     
diff -u -r t/00-file-handling.t.orig t/00-file-handling.t
--- t/00-file-handling.t.orig	2007-01-25 10:05:54.000000000 -0800
+++ t/00-file-handling.t	2007-01-27 04:14:26.000000000 -0800
@@ -2,10 +2,12 @@
 
 use strict;
 require &#34;t/test_functions&#34;;
+my $tests = $] &gt;= 5.005003 ? 5 : 4;
+print &#34;1..$tests\n&#34;;
 
 $^W = 1;
 
-$SIG{__WARN__} = sub { die&#40;&#34;Caught a warning, making it fatal:\n\n$@\n&#34;&#41;; };
+$SIG{__WARN__} = sub { die&#40;&#34;Caught a warning, making it fatal:\n\n@_\n&#34;&#41;; };
 
 eval { parsefile&#40;&#34;t/non-existent-file&#34;&#41;; };
 ok&#40;$@ eq &#34;XML::Tiny::parsefile: Can&#39;t open t/non-existent-file\n&#34;,
diff -u -r t/01-real-world-xml.t.orig t/01-real-world-xml.t
--- t/01-real-world-xml.t.orig	2007-01-25 10:05:59.000000000 -0800
+++ t/01-real-world-xml.t	2007-01-27 03:31:39.000000000 -0800
@@ -2,6 +2,8 @@
 
 use strict;
 require &#34;t/test_functions&#34;;
+my $tests = 2;
+print &#34;1..$tests\n&#34;;
 
 $^W = 1;
 
diff -u -r t/02-oddballs.t.orig t/02-oddballs.t
--- t/02-oddballs.t.orig	2007-01-25 10:06:04.000000000 -0800
+++ t/02-oddballs.t	2007-01-27 03:31:52.000000000 -0800
@@ -2,6 +2,8 @@
 
 use strict;
 require &#34;t/test_functions&#34;;
+my $tests = 1;
+print &#34;1..$tests\n&#34;;
 
 $^W = 1;
 
diff -u -r t/test_functions.orig t/test_functions
--- t/test_functions.orig	2007-01-25 09:21:57.000000000 -0800
+++ t/test_functions	2007-01-27 03:29:47.000000000 -0800
@@ -66,6 +66,4 @@
     }
 }
 
-sub END { print &#34;1..$counter\n&#34;; }
-
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;27&nbsp;17:48:41&nbsp;2007</span>
    <span class="description">unobe [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> unobe [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jan 27 07:36:36 2007, UNOBE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached file is a patch.
</div>Forgot to include one of the fixes in the previous patch &#40;removing
&#34;exists&#34;&#41;. Try this one :-&#41;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- t/00-file-handling.t.orig	2007-01-25 10:05:54.000000000 -0800
+++ t/00-file-handling.t	2007-01-27 04:14:26.000000000 -0800
@@ -2,10 +2,12 @@
 
 use strict;
 require &#34;t/test_functions&#34;;
+my $tests = $] &gt;= 5.005003 ? 5 : 4;
+print &#34;1..$tests\n&#34;;
 
 $^W = 1;
 
-$SIG{__WARN__} = sub { die&#40;&#34;Caught a warning, making it fatal:\n\n$@\n&#34;&#41;; };
+$SIG{__WARN__} = sub { die&#40;&#34;Caught a warning, making it fatal:\n\n@_\n&#34;&#41;; };
 
 eval { parsefile&#40;&#34;t/non-existent-file&#34;&#41;; };
 ok&#40;$@ eq &#34;XML::Tiny::parsefile: Can&#39;t open t/non-existent-file\n&#34;,
--- t/01-real-world-xml.t.orig	2007-01-25 10:05:59.000000000 -0800
+++ t/01-real-world-xml.t	2007-01-27 03:31:39.000000000 -0800
@@ -2,6 +2,8 @@
 
 use strict;
 require &#34;t/test_functions&#34;;
+my $tests = 2;
+print &#34;1..$tests\n&#34;;
 
 $^W = 1;
 
--- t/02-oddballs.t.orig	2007-01-25 10:06:04.000000000 -0800
+++ t/02-oddballs.t	2007-01-27 03:31:52.000000000 -0800
@@ -2,6 +2,8 @@
 
 use strict;
 require &#34;t/test_functions&#34;;
+my $tests = 1;
+print &#34;1..$tests\n&#34;;
 
 $^W = 1;
 
--- t/test_functions.orig	2007-01-25 09:21:57.000000000 -0800
+++ t/test_functions	2007-01-27 03:29:47.000000000 -0800
@@ -66,6 +66,4 @@
     }
 }
 
-sub END { print &#34;1..$counter\n&#34;; }
-
 1;
--- lib/XML/Tiny.pm.orig	2007-01-26 06:19:57.000000000 -0800
+++ lib/XML/Tiny.pm	2007-01-27 14:40:55.000000000 -0800
@@ -64,6 +64,7 @@
         $file = &lt;FH&gt;;
         close&#40;FH&#41;;
     } else { $file = &lt;$arg&gt;; }
+    die&#40;&#34;No elements\n&#34;&#41; if &#40;!defined $file or $file =~ /^\s*$/&#41;;
     # strip leading/trailing whitespace and comments &#40;which don&#39;t nest - phew!&#41;
     $file =~ s/^\s+|&lt;!--.*?--&gt;|\s+$//g;
     
@@ -91,8 +92,8 @@
             push @{$elem-&gt;{content}}, { content =&gt; $token, type =&gt; &#39;t&#39; };
         }
     }
-    die&#40;&#34;Junk after end of document\n&#34;&#41; if&#40;exists&#40;$elem-&gt;{content}-&gt;[1]&#41;&#41;;
-    die&#40;&#34;No elements\n&#34;&#41; if&#40;!exists&#40;$elem-&gt;{content}-&gt;[0]&#41;&#41;;
+    die&#40;&#34;Junk after end of document\n&#34;&#41; if&#40; $elem-&gt;{content}-&gt;[1] &#41;;
+    die&#40;&#34;No elements\n&#34;&#41; if&#40;! $elem-&gt;{content}-&gt;[0] &#41;;
     return $elem-&gt;{content};
 }
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;27&nbsp;17:48:45&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;29&nbsp;17:09:23&nbsp;2007</span>
    <span class="description">dcantrell [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">5 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, patches applied
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;29&nbsp;17:09:24&nbsp;2007</span>
    <span class="description">dcantrell [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
