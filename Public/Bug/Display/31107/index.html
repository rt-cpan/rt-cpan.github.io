<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #31107 for CGI: Needs Confirmation: 400 Bad request &#40;malformed multipart POST&#41; with multipart/related</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #31107 for CGI: Needs Confirmation: 400 Bad request &#40;malformed multipart POST&#41; with multipart/related</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=CGI">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=CGI">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=CGI">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=CGI">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/leejo/CGI.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI">CGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">31107</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=CGI">CGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sebastiano.piccoli [...] staff.dada.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=31107">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-389029" href="/Public/Bug/Display.html?id=31107#txn-389029">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;30&nbsp;11:22:25&nbsp;2007</span>
    <span class="description">sebastiano.piccoli [...] staff.dada.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> lstein [...] cshl.edu</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 400 Bad request &#40;malformed multipart POST&#41; with multipart/related</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 Nov 2007 17:20:18 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI.pm [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sebastiano Piccoli &lt;sebastiano.piccoli [...] staff.dada.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/389029/178709/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/178709">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

  since the version 3.27 it seems that a posted multipart/related data 
generates the error:

400 Bad request &#40;malformed multipart POST&#41;

I have parsed the content with MIME::Parser and it&#39;s ok. It seems that 
the function readHeader in read_multipart_related returns a void hash.

Below the POST &#40;------=_Part_0.7772611529786723.1196412625897 is the 
first line&#41;:

------=_Part_0.7772611529786723.1196412625897
Content-Type: text/xml
Content-Transfer-Encoding: 7bit
Content-ID: &lt;mm7-submit&gt;

&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
        &lt;env:Envelope xmlns:env=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>&#34;&gt;
                &lt;env:Header&gt;
                        &lt;mm7:TransactionID env:mustUnderstand=&#34;1&#34; 
xmlns:mm7=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0">http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0</a></span>&#34;&gt;4401196412625869430&lt;/mm7:TransactionID&gt;
                &lt;/env:Header&gt;
                &lt;env:Body&gt;
                        &lt;mm7:CapabilityASReplyReq 
xmlns:mm7=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0">http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0</a></span>&#34;&gt;
                                &lt;MM7Version&gt;5.3.0&lt;/MM7Version&gt;
                                &lt;SenderAddress&gt;XXXXX&lt;/SenderAddress&gt;
                                
&lt;CapRequestId&gt;4401196412625869430&lt;/CapRequestId&gt;
                                &lt;TimeStamp&gt;2007-11-30 09:50:25&lt;/TimeStamp&gt;
                                &lt;StatusCode&gt;1000&lt;/StatusCode&gt;
                                &lt;StatusText&gt;Request Received&lt;/StatusText&gt;
                                &lt;Content href=&#34;cid:generic_content_id&#34;/&gt;
                        &lt;/mm7:CapabilityASReplyReq&gt;
                &lt;/env:Body&gt;
        &lt;/env:Envelope&gt;
------=_Part_0.7772611529786723.1196412625897
Content-Type: application/x-zip; name=capabilities.zip
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename=capabilities.zip
Content-ID: &lt;capabilities.zip&gt;

UEsDBBQACAAIA
------=_Part_0.7772611529786723.1196412625897--

and a bash script to post it:

**********************************************************
#!/bin/sh

lwp-request -m &#39;post&#39; -c &#39;multipart/related; 
boundary=&#34;----=_Part_0.7772611529786723.1196412625897&#34;; type=&#34;text/xml&#34;; 
start=&#34;cid:mm7-submit&#34;&#39; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://urltest.local.com/cgi-bin/my.cgi&#39;">http://urltest.local.com/cgi-bin/my.cgi&#39;</a></span> &lt; post.txt
**********************************************************

Just to version 3.25 the same content was pushed in POSTDATA.

Thanks

-- 
Sebastiano Piccoli
Software developer
Dada SpA
sebastiano.piccoli@staff.dada.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.dada.net/">http://www.dada.net/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-389840" href="/Public/Bug/Display.html?id=31107#txn-389840">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;03&nbsp;11:25:52&nbsp;2007</span>
    <span class="description">sebastiano.piccoli [...] staff.dada.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> lstein [...] cshl.edu</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #31107] AutoReply: 400 Bad request &#40;malformed multipart POST&#41; with multipart/related</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 03 Dec 2007 17:23:45 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI.pm [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sebastiano Piccoli &lt;sebastiano.piccoli [...] staff.dada.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/389840/179122/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/179122">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Lincoln,

  I reply to my question.

I think the issue is in the CRLF sequence. I&#39;m using Linux Ubuntu.

In particular if I set :

  local&#40;$CRLF&#41; = &#34;\012&#34;;

in sub readHeader, CGI works and my &#34;parts are available as uploads with 
the Content-ID as the key&#34;. This behavior is changed: before we got the 
content in the param POSTDATA.

A very important question: is it possible to keep _also_ the old 
behavior and let the content of the POST in the param POSTDATA.

Only I expect to find _also_ the exact POST made somewhere.

Thanks,
Sebastiano

Bugs in CGI.pm via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Greetings,
&gt;
&gt; This message has been automatically generated in response to the
&gt; creation of a trouble ticket regarding:
&gt;       &#34;400 Bad request &#40;malformed multipart POST&#41; with multipart/related&#34;, 
&gt; a summary of which appears below.
&gt;
&gt; There is no need to reply to this message right now.  Your ticket has been
&gt; assigned an ID of [rt.cpan.org #31107].  Your ticket is accessible
&gt; on the web at:
&gt;
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31107">http://rt.cpan.org/Ticket/Display.html?id=31107</a></span>
&gt;
&gt; Please include the string:
&gt;
&gt;          [rt.cpan.org #31107]
&gt;
&gt; in the subject line of all future correspondence about this issue. To do so, 
&gt; you may reply to this message.
&gt;
&gt;                         Thank you,
&gt;                         bug-CGI.pm@rt.cpan.org
&gt;
&gt; -------------------------------------------------------------------------
&gt; Hi,
&gt;
&gt;   since the version 3.27 it seems that a posted multipart/related data 
&gt; generates the error:
&gt;
&gt; 400 Bad request &#40;malformed multipart POST&#41;
&gt;
&gt; I have parsed the content with MIME::Parser and it&#39;s ok. It seems that 
&gt; the function readHeader in read_multipart_related returns a void hash.
&gt;
&gt; Below the POST &#40;------=_Part_0.7772611529786723.1196412625897 is the 
&gt; first line&#41;:
&gt;
&gt; ------=_Part_0.7772611529786723.1196412625897
&gt; Content-Type: text/xml
&gt; Content-Transfer-Encoding: 7bit
&gt; Content-ID: &lt;mm7-submit&gt;
&gt;
&gt; &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
&gt;         &lt;env:Envelope xmlns:env=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>&#34;&gt;
&gt;                 &lt;env:Header&gt;
&gt;                         &lt;mm7:TransactionID env:mustUnderstand=&#34;1&#34; 
&gt; xmlns:mm7=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0">http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0</a></span>&#34;&gt;4401196412625869430&lt;/mm7:TransactionID&gt;
&gt;                 &lt;/env:Header&gt;
&gt;                 &lt;env:Body&gt;
&gt;                         &lt;mm7:CapabilityASReplyReq 
&gt; xmlns:mm7=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0">http://www.3gpp.org/ftp/Specs/archive/23_series/23.140/schema/REL-5-MM7-1-0</a></span>&#34;&gt;
&gt;                                 &lt;MM7Version&gt;5.3.0&lt;/MM7Version&gt;
&gt;                                 &lt;SenderAddress&gt;XXXXX&lt;/SenderAddress&gt;
&gt;                                 
&gt; &lt;CapRequestId&gt;4401196412625869430&lt;/CapRequestId&gt;
&gt;                                 &lt;TimeStamp&gt;2007-11-30 09:50:25&lt;/TimeStamp&gt;
&gt;                                 &lt;StatusCode&gt;1000&lt;/StatusCode&gt;
&gt;                                 &lt;StatusText&gt;Request Received&lt;/StatusText&gt;
&gt;                                 &lt;Content href=&#34;cid:generic_content_id&#34;/&gt;
&gt;                         &lt;/mm7:CapabilityASReplyReq&gt;
&gt;                 &lt;/env:Body&gt;
&gt;         &lt;/env:Envelope&gt;
&gt; ------=_Part_0.7772611529786723.1196412625897
&gt; Content-Type: application/x-zip; name=capabilities.zip
&gt; Content-Transfer-Encoding: base64
&gt; Content-Disposition: attachment; filename=capabilities.zip
&gt; Content-ID: &lt;capabilities.zip&gt;
&gt;
&gt; UEsDBBQACAAIA
&gt; ------=_Part_0.7772611529786723.1196412625897--
&gt;
&gt; and a bash script to post it:
&gt;
&gt; **********************************************************
&gt; #!/bin/sh
&gt;
&gt; lwp-request -m &#39;post&#39; -c &#39;multipart/related; 
&gt; boundary=&#34;----=_Part_0.7772611529786723.1196412625897&#34;; type=&#34;text/xml&#34;; 
&gt; start=&#34;cid:mm7-submit&#34;&#39; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://urltest.local.com/cgi-bin/my.cgi&#39;">http://urltest.local.com/cgi-bin/my.cgi&#39;</a></span> &lt; post.txt
&gt; **********************************************************
&gt;
&gt; Just to version 3.25 the same content was pushed in POSTDATA.
&gt;
&gt; Thanks
&gt;
&gt;   
</div>

-- 
Sebastiano Piccoli
Software developer
Dada SpA
sebastiano.piccoli@staff.dada.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.dada.net/">http://www.dada.net/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-638364" href="/Public/Bug/Display.html?id=31107#txn-638364">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;15:14:28&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-638365" href="/Public/Bug/Display.html?id=31107#txn-638365">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;15:14:42&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Subject changed from &#39;400 Bad request &#40;malformed multipart POST&#41; with multipart/related&#39; to &#39;Needs Confirmation: 400 Bad request &#40;malformed multipart POST&#41; with multipart/related&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-638366" href="/Public/Bug/Display.html?id=31107#txn-638366">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;15:15:35&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/638366/325561/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/325561">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 84b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Do you find that this issue is still reproducible with CGI.pm 3.43?

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-638367" href="/Public/Bug/Display.html?id=31107#txn-638367">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;15:15:39&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-857979" href="/Public/Bug/Display.html?id=31107#txn-857979">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;20&nbsp;15:56:52&nbsp;2010</span>
    <span class="description">MARKSTOS [...] cpan.org -  Reference by ticket #62446 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1366031" href="/Public/Bug/Display.html?id=31107#txn-1366031">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;08:03:19&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1366031/725256/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/725256">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 240b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This issue has been copied to: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/leejo/CGI.pm/issues/53">https://github.com/leejo/CGI.pm/issues/53</a></span> please take all future correspondence there.
This ticket will remain open but please do not reply here.
This ticket will be closed when the github issue is dealt with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1366944" href="/Public/Bug/Display.html?id=31107#txn-1366944">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;14:28:02&nbsp;2014</span>
    <span class="description">The RT System itself -  Queue changed from CGI.pm to CGI</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1376856" href="/Public/Bug/Display.html?id=31107#txn-1376856">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;18&nbsp;16:51:02&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1376856/731051/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/731051">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Rejecting, there is nothing to do here. Your multipart headers *MUST* contain the CRLF. Test case added with the above examples to confirm. If you remove the line feed characters you will see the upload break with &#34;400 bad request headers&#34; error.

commit fed3f145c5e5d13485ef57a2eccb9e08bf009e95
Author: Lee Johnson &lt;lee@givengain.ch&gt;
Date:   Wed Jun 18 22:36:44 2014 +0200

    resolve #53 [rt.cpan.org #31107] - test case

    for multipart data sending xml content. there is nothing to do here,
    if you post multipart form data you MUST include CRLF in the boundary
    delimiters as this is part of the protocol. see the following RFC:

        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ietf.org/rfc/rfc2046.txt">http://www.ietf.org/rfc/rfc2046.txt</a></span>

    note the potentially misleading part in section 5.1.1:

        &#34;NOTE: The CRLF preceding the boundary delimiter line is
        conceptually attached to the boundary so that it is possible
        to have a part that does not end with a CRLF &#40;line break&#41;.&#34;

    but when one reads the BNF, we notice this isn&#39;t always true:

         dash-boundary := &#34;--&#34; boundary
                          ; boundary taken from the value of
                          ; boundary parameter of the
                          ; Content-Type field.

         multipart-body := [preamble CRLF]
                           dash-boundary transport-padding CRLF
                           body-part *encapsulation
                           close-delimiter transport-padding
                           [CRLF epilogue]

         encapsulation := delimiter transport-padding
                          CRLF body-part

         delimiter := CRLF dash-boundary

    wherein we see that the first MIME multipart dash-boundary doesn&#39;t
    include a CRLF.

    irrespective of the above, we are to spec and your MIME headers must
    include CRLF &#40;well, unless you&#39;re on VMS&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1376859" href="/Public/Bug/Display.html?id=31107#txn-1376859">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;18&nbsp;16:51:03&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1376863" href="/Public/Bug/Display.html?id=31107#txn-1376863">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;18&nbsp;17:01:29&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1376863/731057/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/731057">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 579b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just an addendum, MIME::Parser explicitly states that its parsing logic goes beyond the RFC, this is why you can parse your original message with that module but not CGI.pm:

----

Fuzzing of CRLF and newline on input
 
RFC 2045 dictates that MIME streams have lines terminated by CRLF &#40;C&lt;&#34;\r\n&#34;&gt;&#41;.  However, it is extremely likely that folks will want to parse MIME streams where each line ends in the local newline character C&lt;&#34;\n&#34;&gt; instead.
 
An attempt has been made to allow the parser to handle both CRLF and newline-terminated input.

---

This will not be added to CGI.pm
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.402579</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
