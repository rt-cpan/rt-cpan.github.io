<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #82784 for Digest-SHA: [PATCH] Compile error on Windows using VC++ in C++ mode</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #82784 for Digest-SHA: [PATCH] Compile error on Windows using VC++ in C++ mode</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Digest-SHA/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-SHA">Digest-SHA CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">82784</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">15 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Digest-SHA/Active/">Digest-SHA</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">mshelor [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
shay [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-11544-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
5.81    </td>
  </tr>
  <tr id="CF-11545-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
5.82    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;17&nbsp;03:55:38&nbsp;2013</span>
    <span class="description">shay [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Compile error on Windows using VC++ in C++ mode</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It can be useful to build things in C++ mode rather than plain C for
extra compiler checks / warnings etc. Some people do this with the core
perl distribution on Linux and other platforms, but when I try it with
VC++ on Windows &#40;by simply adding CXX_FLAG into EXTRACFLAGS in
win32/Makefile&#41;, the build gets as far as Digest-SHA and then fails with
the following compiler errors in Digest-SHA&#39;s src\sha[64bit].c files:

        cl -c  -I.  -nologo -GF -W3 -TP -EHsc -MD -Zi -DNDEBUG -O1
-DWIN32 -D_CONSOLE -DNO_STRICT -D_CRT_SECURE_NO_DEPRECATE
-D_CRT_NONSTDC_NO_DEPRECATE -DPERL_TEXTMODE_SCRIPTS
-DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -DUSE_PERLIO -MD -Zi
-DNDEBUG -O1    -DVERSION=\&#34;5.81\&#34;  -DXS_VERSION=\&#34;5.81\&#34; 
&#34;-I..\..\lib\CORE&#34; -DSHA_PERL_MODULE SHA.c
SHA.c
c:\dev\git\perl\cpan\digest-sha\src/sha.c&#40;89&#41; : error C3530: &#39;auto&#39;
cannot be combined with any other type-specifier
c:\dev\git\perl\cpan\digest-sha\src/sha.c&#40;90&#41; : error C2440:
&#39;initializing&#39; : cannot convert from &#39;int [16]&#39; to &#39;unsigned int *&#39;
        Types pointed to are unrelated; conversion requires
reinterpret_cast, C-style cast or function-style cast
c:\dev\git\perl\cpan\digest-sha\src/sha.c&#40;93&#41; : error C2440:
&#39;initializing&#39; : cannot convert from &#39;int [16]&#39; to &#39;unsigned int *&#39;
        Types pointed to are unrelated; conversion requires
reinterpret_cast, C-style cast or function-style cast
c:\dev\git\perl\cpan\digest-sha\src/sha.c&#40;156&#41; : error C3530: &#39;auto&#39;
cannot be combined with any other type-specifier
c:\dev\git\perl\cpan\digest-sha\src/sha.c&#40;158&#41; : error C2440:
&#39;initializing&#39; : cannot convert from &#39;int [16]&#39; to &#39;unsigned int *&#39;
        Types pointed to are unrelated; conversion requires
reinterpret_cast, C-style cast or function-style cast
c:\dev\git\perl\cpan\digest-sha\src/sha.c&#40;161&#41; : error C2440:
&#39;initializing&#39; : cannot convert from &#39;int [16]&#39; to &#39;unsigned int *&#39;
        Types pointed to are unrelated; conversion requires
reinterpret_cast, C-style cast or function-style cast
c:\dev\git\perl\cpan\digest-sha\src\sha64bit.c&#40;98&#41; : error C3530: &#39;auto&#39;
cannot be combined with any other type-specifier
c:\dev\git\perl\cpan\digest-sha\src\sha64bit.c&#40;102&#41; : error C2440:
&#39;initializing&#39; : cannot convert from &#39;__int64 [80]&#39; to &#39;unsigned __int64 *&#39;
        Types pointed to are unrelated; conversion requires
reinterpret_cast, C-style cast or function-style cast
NMAKE : fatal error U1077: &#39;&#34;C:\Program Files &#40;x86&#41;\Microsoft Visual
Studio 11.0\VC\bin\cl.EXE&#34;&#39; : return code &#39;0x2&#39;
Stop.
Unsuccessful make&#40;cpan/Digest-SHA&#41;: code=512 at ..\make_ext.pl line 490.
NMAKE : fatal error U1077: &#39;..\miniperl.exe&#39; : return code &#39;0x2&#39;
Stop.

Simply providing a blank definition of SHA_STO_CLASS for VC++
&#40;identified by _MSC_VER being #defined&#41; fixes the problem. See the
attached patch. &#40;Not sure if the same would need doing for g++ builds on
Windows too because I haven&#39;t got that working very far yet, but
probably not since g++ builds work fine on Linux.&#41;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> auto.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ruN Digest-SHA-5.81.orig/src/sha.h Digest-SHA-5.81/src/sha.h
--- Digest-SHA-5.81.orig/src/sha.h	2013-01-14 12:17:10.000000000 +0000
+++ Digest-SHA-5.81/src/sha.h	2013-01-17 08:45:18.286139500 +0000
@@ -109,7 +109,11 @@
  */
 
 #if !defined&#40;SHA_STO_CLASS&#41;
-	#define SHA_STO_CLASS	auto
+	#if defined&#40;_MSC_VER&#41;
+		#define SHA_STO_CLASS
+	#else
+		#define SHA_STO_CLASS	auto
+	#endif
 #endif
 
 /* Override use of static arrays if compiling for thread-safety */
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;17&nbsp;20:36:27&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;17&nbsp;20:49:30&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">15 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 17 03:55:38 2013, SHAY wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It can be useful to build things in C++ mode rather than plain C for
&gt; extra compiler checks / warnings etc. Some people do this with the core
&gt; 
&gt; Simply providing a blank definition of SHA_STO_CLASS for VC++
&gt; &#40;identified by _MSC_VER being #defined&#41; fixes the problem. See the
&gt; attached patch.
</div>

Thanks for the patch!

Actually I&#39;m doing away with SHA_STO_CLASS in the next version. 
Compilers now produce code with roughly the same performance, regardless
of whether the message schedule is stored as a &#34;static&#34; or &#34;auto&#34; variable.

This was a kludge to begin with.  But, early on, it was a useful kludge:
the transforms ran 20% faster on Intels by declaring the message
schedule to be static.  Such is not the case anymore.

BTW your patch would have needed to extend to the next clause in the
header file, but there&#39;s no need to worry about that now.

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;17&nbsp;20:49:31&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;17&nbsp;20:52:59&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Severity Important changed to Normal</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;24&nbsp;17:51:35&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Fixed in 5.82 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;24&nbsp;17:51:35&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Severity Normal changed to Unimportant</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;24&nbsp;17:56:13&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 5.82.

All references to SHA_STO_CLASS were removed from 5.82, so the submitted
patch wasn&#39;t necessary.

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;24&nbsp;17:56:14&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
