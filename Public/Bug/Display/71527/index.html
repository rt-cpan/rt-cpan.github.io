<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71527 for PHP-Include: Declaring variables issue introduced in .34</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71527 for PHP-Include: Declaring variables issue introduced in .34</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PHP-Include">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PHP-Include">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PHP-Include">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PHP-Include">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PHP-Include">PHP-Include CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71527</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PHP-Include">PHP-Include</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DERRICK.A.SHIELDS [...] saic.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25854-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25855-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=71527">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-985682" href="/Public/Bug/Display.html?id=71527#txn-985682">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;07&nbsp;14:13:36&nbsp;2011</span>
    <span class="description">DERRICK.A.SHIELDS [...] saic.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Declaring variables issue introduced in .34</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Oct 2011 14:13:26 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-PHP-Include [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Shields, Derrick A.&#34; &lt;DERRICK.A.SHIELDS [...] saic.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/985682/513192/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/513192">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

 

I recently upgraded from PHP::Include .33 to .34 and am encountering an
issue with variable declarations.  Here&#39;s my scenario:

 

I have Apache with two perl filters using PerlFixupHandler.  I use
include_php_vars to include a global configuration file into both
filters.

 

The problem:

 

With the upgrade to .34, one of the filters will now fail to compile
with many errors of &#34;Global symbol X requires explicit package name&#34;.
After turning on DEBUG, what I see is that the first filter to get
compiled compiles correctly because the variables are properly lexically
scoped &#40;my $var = ...&#41;.  But the second filter fails because the
variables aren&#39;t declared with &#34;my&#34; and are therefore package variables.

 

Looking at the new Vars.pm code, I see there is now code to attempt to
be smart about avoiding declaring a variable multiple times using the
declared_vars hash.  But in the case of Apache with multiple filters in
separate files, apparently this hash is shared resulting in only the
first file getting the proper declaration.

 

My quick fix:

 

For a quick fix, I simply commented out the line which adds the variable
to the declared_vars hash, which forces the &#34;my&#34; qualifier every time
like in version .33.  I just wanted to make you aware of this issue for
a proper fix.

 

Derrick Shields
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/985682/513193/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/513193">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.9k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-985743" href="/Public/Bug/Display.html?id=71527#txn-985743">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;07&nbsp;15:44:04&nbsp;2011</span>
    <span class="description">ambs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/985743/513226/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/513226">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

How is your code running? mod_perl? with multiple threads?
Just to try to find a solution other than adding a switch the the
command line function... :&#41;

Cheers


On Fri Oct 07 14:13:36 2011, DERRICK.A.SHIELDS@saic.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt;  
&gt; 
&gt; I recently upgraded from PHP::Include .33 to .34 and am encountering an
&gt; issue with variable declarations.  Here&#39;s my scenario:
&gt; 
&gt;  
&gt; 
&gt; I have Apache with two perl filters using PerlFixupHandler.  I use
&gt; include_php_vars to include a global configuration file into both
&gt; filters.
&gt; 
&gt;  
&gt; 
&gt; The problem:
&gt; 
&gt;  
&gt; 
&gt; With the upgrade to .34, one of the filters will now fail to compile
&gt; with many errors of &#34;Global symbol X requires explicit package name&#34;.
&gt; After turning on DEBUG, what I see is that the first filter to get
&gt; compiled compiles correctly because the variables are properly lexically
&gt; scoped &#40;my $var = ...&#41;.  But the second filter fails because the
&gt; variables aren&#39;t declared with &#34;my&#34; and are therefore package variables.
&gt; 
&gt;  
&gt; 
&gt; Looking at the new Vars.pm code, I see there is now code to attempt to
&gt; be smart about avoiding declaring a variable multiple times using the
&gt; declared_vars hash.  But in the case of Apache with multiple filters in
&gt; separate files, apparently this hash is shared resulting in only the
&gt; first file getting the proper declaration.
&gt; 
&gt;  
&gt; 
&gt; My quick fix:
&gt; 
&gt;  
&gt; 
&gt; For a quick fix, I simply commented out the line which adds the variable
&gt; to the declared_vars hash, which forces the &#34;my&#34; qualifier every time
&gt; like in version .33.  I just wanted to make you aware of this issue for
&gt; a proper fix.
&gt; 
&gt;  
&gt; 
&gt; Derrick Shields
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-985746" href="/Public/Bug/Display.html?id=71527#txn-985746">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;07&nbsp;15:44:05&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-985779" href="/Public/Bug/Display.html?id=71527#txn-985779">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;07&nbsp;16:36:12&nbsp;2011</span>
    <span class="description">DERRICK.A.SHIELDS [...] saic.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #71527] Declaring variables issue introduced in .34 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Oct 2011 16:36:02 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-PHP-Include [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Shields, Derrick A.&#34; &lt;DERRICK.A.SHIELDS [...] saic.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/985779/513244/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/513244">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Yes, mod_perl with linux default worker strategy of prefork &#40;not threaded&#41;.

Derrick

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: rt-cpan-org-return@perl.org [mailto:rt-cpan-org-return@perl.org] On Behalf Of Alberto SimÃµes via RT
Sent: Friday, October 07, 2011 3:44 PM
To: Shields, Derrick A.
Subject: [rt.cpan.org #71527] Declaring variables issue introduced in .34 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71527">https://rt.cpan.org/Ticket/Display.html?id=71527</a></span> &gt;

Hello,

How is your code running? mod_perl? with multiple threads?
Just to try to find a solution other than adding a switch the the
command line function... :&#41;

Cheers


On Fri Oct 07 14:13:36 2011, DERRICK.A.SHIELDS@saic.com wrote:
<div class="message-stanza open">&gt; Hi,
&gt; 
&gt;  
&gt; 
&gt; I recently upgraded from PHP::Include .33 to .34 and am encountering an
&gt; issue with variable declarations.  Here&#39;s my scenario:
&gt; 
&gt;  
&gt; 
&gt; I have Apache with two perl filters using PerlFixupHandler.  I use
&gt; include_php_vars to include a global configuration file into both
&gt; filters.
&gt; 
&gt;  
&gt; 
&gt; The problem:
&gt; 
&gt;  
&gt; 
&gt; With the upgrade to .34, one of the filters will now fail to compile
&gt; with many errors of &#34;Global symbol X requires explicit package name&#34;.
&gt; After turning on DEBUG, what I see is that the first filter to get
&gt; compiled compiles correctly because the variables are properly lexically
&gt; scoped &#40;my $var = ...&#41;.  But the second filter fails because the
&gt; variables aren&#39;t declared with &#34;my&#34; and are therefore package variables.
&gt; 
&gt;  
&gt; 
&gt; Looking at the new Vars.pm code, I see there is now code to attempt to
&gt; be smart about avoiding declaring a variable multiple times using the
&gt; declared_vars hash.  But in the case of Apache with multiple filters in
&gt; separate files, apparently this hash is shared resulting in only the
&gt; first file getting the proper declaration.
&gt; 
&gt;  
&gt; 
&gt; My quick fix:
&gt; 
&gt;  
&gt; 
&gt; For a quick fix, I simply commented out the line which adds the variable
&gt; to the declared_vars hash, which forces the &#34;my&#34; qualifier every time
&gt; like in version .33.  I just wanted to make you aware of this issue for
&gt; a proper fix.
&gt; 
&gt;  
&gt; 
&gt; Derrick Shields
&gt; 
</div>


</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-996488" href="/Public/Bug/Display.html?id=71527#txn-996488">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;06&nbsp;09:06:21&nbsp;2011</span>
    <span class="description">ambs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/996488/518959/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/518959">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello, Derrick

This wasn&#39;t yet fixed, right? :-|
Sorry, I forgot it, and now I am kind lost :&#41;

Cheers
Alberto


On Fri Oct 07 16:36:12 2011, DERRICK.A.SHIELDS@saic.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; Yes, mod_perl with linux default worker strategy of prefork
&gt; &#40;not threaded&#41;.
&gt; 
&gt; Derrick
&gt; 
&gt; -----Original Message-----
&gt; From: rt-
&gt; cpan-org-return@perl.org [mailto:rt-cpan-org-return@perl.org] On
&gt; Behalf Of Alberto SimÃµes via RT
&gt; Sent: Friday, October 07, 2011 3:44
&gt; PM
&gt; To: Shields, Derrick A.
&gt; Subject: [rt.cpan.org #71527] Declaring
&gt; variables issue introduced in .34 
&gt; 
&gt; &lt;URL:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71527">https://rt.cpan.org/Ticket/Display.html?id=71527</a></span> &gt;
&gt; 
&gt; Hello,
&gt; 
&gt; How is
&gt; your code running? mod_perl? with multiple threads?
&gt; Just to try to
&gt; find a solution other than adding a switch the the
&gt; command line
&gt; function... :&#41;
&gt; 
&gt; Cheers
&gt; 
&gt; 
&gt; On Fri Oct 07 14:13:36 2011,
&gt; DERRICK.A.SHIELDS@saic.com wrote:
<div class="message-stanza open">&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt;  
&gt; &gt; 
&gt; &gt; I recently
</div>&gt; upgraded from PHP::Include .33 to .34 and am encountering an
<div class="message-stanza open">&gt; &gt; issue
</div>&gt; with variable declarations.  Here&#39;s my scenario:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt;  
&gt; &gt; 
&gt; &gt; I
</div>&gt; have Apache with two perl filters using PerlFixupHandler.  I use
<div class="message-stanza open">&gt; &gt;
</div>&gt; include_php_vars to include a global configuration file into both
<div class="message-stanza open">&gt; &gt;
</div>&gt; filters.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt;  
&gt; &gt; 
&gt; &gt; The problem:
&gt; &gt; 
&gt; &gt;  
&gt; &gt; 
&gt; &gt; With the upgrade
</div>&gt; to .34, one of the filters will now fail to compile
<div class="message-stanza open">&gt; &gt; with many
</div>&gt; errors of &#34;Global symbol X requires explicit package name&#34;.
<div class="message-stanza open">&gt; &gt; After
</div>&gt; turning on DEBUG, what I see is that the first filter to get
<div class="message-stanza open">&gt; &gt;
</div>&gt; compiled compiles correctly because the variables are properly
&gt; lexically
<div class="message-stanza open">&gt; &gt; scoped &#40;my $var = ...&#41;.  But the second filter fails
</div>&gt; because the
<div class="message-stanza open">&gt; &gt; variables aren&#39;t declared with &#34;my&#34; and are therefore
</div>&gt; package variables.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt;  
&gt; &gt; 
&gt; &gt; Looking at the new Vars.pm code, I
</div>&gt; see there is now code to attempt to
<div class="message-stanza open">&gt; &gt; be smart about avoiding
</div>&gt; declaring a variable multiple times using the
<div class="message-stanza open">&gt; &gt; declared_vars hash.
</div>&gt; But in the case of Apache with multiple filters in
<div class="message-stanza open">&gt; &gt; separate files,
</div>&gt; apparently this hash is shared resulting in only the
<div class="message-stanza open">&gt; &gt; first file
</div>&gt; getting the proper declaration.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt;  
&gt; &gt; 
&gt; &gt; My quick fix:
&gt; &gt; 
&gt; &gt;
&gt; &gt; 
&gt; &gt; For a quick fix, I simply commented out the line which adds the
</div>&gt; variable
<div class="message-stanza open">&gt; &gt; to the declared_vars hash, which forces the &#34;my&#34; qualifier
</div>&gt; every time
<div class="message-stanza open">&gt; &gt; like in version .33.  I just wanted to make you aware of
</div>&gt; this issue for
<div class="message-stanza open">&gt; &gt; a proper fix.
&gt; &gt; 
&gt; &gt;  
&gt; &gt; 
&gt; &gt; Derrick Shields
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.236519</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
