<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24301 for Text-Diff-HTML: XHTML doesn&#39;t allow div element inside pre element</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24301 for Text-Diff-HTML: XHTML doesn&#39;t allow div element inside pre element</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Text-Diff-HTML">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Text-Diff-HTML">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Text-Diff-HTML">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Text-Diff-HTML">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/theory/text-diff-html/issues/">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-Diff-HTML">Text-Diff-HTML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24301</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Text-Diff-HTML">Text-Diff-HTML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pete [...] void.printf.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31894-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31895-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.06    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=24301">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-282414" href="/Public/Bug/Display.html?id=24301#txn-282414">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;10&nbsp;11:52:18&nbsp;2007</span>
    <span class="description">pete [...] void.printf.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XHTML doesn&#39;t allow div element inside pre element</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Jan 2007 16:51:48 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-text-diff-html [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pete Gillin &lt;pete [...] void.printf.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/282414/126792/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/126792">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The POD for Text::Diff::HTML suggests that: &#39;You will also likely want
to wrap the output of your diff in a &#34;&lt;pre&gt;&#34; element.&#39; This is great
advice... except that the output includes div elements and the XHTML
spec &#40;XHTML 1.0 Strict, at least&#41; does not allow div elements within a
pre element. So either it is a bug that the documentation suggests
that you wrap in a pre element and can obtain valid XHTML by doing so,
or it is a bug that the output produced includes divs.

As a workaround &#40;because you&#39;re right, the pre element is very
useful&#41;, I have subclassed Text::Diff::HTML are reimplemented the
&#40;file|hunk&#41;_&#40;header|footer&#41; methods to do the same thing but with
spans instead of divs. I humbly suggest that this change should
&#40;possibly optionally, or possibly with an option to revert to div to
maintain backwards compatibility where essential&#41; be adopted in
Text::Diff::HTML.

Best wishes,

Pete.

P.S. While I was subclassing, I also reimplemented the _header method
in my subclass to honour options FILENAME_SUFFIX_[AB] which, if
defined, are joined onto the end of the lines of the file header. This
made it easy for me to mark up and apply style to each line
separately, specifically to have the +++ and --- lines in colours
related to the + and - lines in the hunk, which I feel improves
readability. If you wanted to consider this for a subsequent version,
that would be great too.

P.P.S. I can supply patches for either of the above if that would
help.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-457715" href="/Public/Bug/Display.html?id=24301#txn-457715">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;05&nbsp;16:29:14&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/457715/225053/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225053">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 10 11:52:18 2007, pete@void.printf.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The POD for Text::Diff::HTML suggests that: &#39;You will also likely want
&gt; to wrap the output of your diff in a &#34;&lt;pre&gt;&#34; element.&#39; This is great
&gt; advice... except that the output includes div elements and the XHTML
&gt; spec &#40;XHTML 1.0 Strict, at least&#41; does not allow div elements within a
&gt; pre element. So either it is a bug that the documentation suggests
&gt; that you wrap in a pre element and can obtain valid XHTML by doing so,
&gt; or it is a bug that the output produced includes divs.
</div>
Good catch, thanks. I&#39;ve changed that documentation to instead read:

  You will also likely want to wrap the output of your diff in its own
  element &#40;a C&lt;&lt; &lt;div&gt; &gt;&gt; will do&#41; styled with &#34;white-space: pre&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As a workaround &#40;because you&#39;re right, the pre element is very
&gt; useful&#41;, I have subclassed Text::Diff::HTML are reimplemented the
&gt; &#40;file|hunk&#41;_&#40;header|footer&#41; methods to do the same thing but with
&gt; spans instead of divs. I humbly suggest that this change should
&gt; &#40;possibly optionally, or possibly with an option to revert to div to
&gt; maintain backwards compatibility where essential&#41; be adopted in
&gt; Text::Diff::HTML.
</div>
I think that keeping things as they are and making a more intelligent
CSS suggestion, as I&#39;ve done above, is the way to go.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; P.S. While I was subclassing, I also reimplemented the _header method
&gt; in my subclass to honour options FILENAME_SUFFIX_[AB] which, if
&gt; defined, are joined onto the end of the lines of the file header. This
&gt; made it easy for me to mark up and apply style to each line
&gt; separately, specifically to have the +++ and --- lines in colours
&gt; related to the + and - lines in the hunk, which I feel improves
&gt; readability. If you wanted to consider this for a subsequent version,
&gt; that would be great too.
</div>
Can you send me a patch for that, and maybe an example of what it looks
like?

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-457716" href="/Public/Bug/Display.html?id=24301#txn-457716">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;05&nbsp;16:29:15&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458966" href="/Public/Bug/Display.html?id=24301#txn-458966">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;08&nbsp;09:12:46&nbsp;2008</span>
    <span class="description">pete [...] void.printf.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #24301] XHTML doesn&#39;t allow div element inside pre element</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 May 2008 14:12:03 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> David Wheeler via RT &lt;bug-Text-Diff-HTML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pete Gillin &lt;pete [...] void.printf.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/458966/225741/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225741">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, May 05, 2008 at 04:29:15PM -0400, David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Good catch, thanks. I&#39;ve changed that documentation to instead read:
&gt; 
&gt;   You will also likely want to wrap the output of your diff in its own
&gt;   element &#40;a C&lt;&lt; &lt;div&gt; &gt;&gt; will do&#41; styled with &#34;white-space: pre&#34;.
</div>
I agree that this is a better solution, and have changed my instance
to use this method.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; P.S. While I was subclassing, I also reimplemented the _header method
&gt; &gt; in my subclass to honour options FILENAME_SUFFIX_[AB] which, if
&gt; &gt; defined, are joined onto the end of the lines of the file
&gt; &gt; header...
</div>&gt; Can you send me a patch for that, and maybe an example of what it
&gt; looks like?
</div>
Actually, on reflection, I can&#39;t really provide a clean patch. What I
did was to subclass Text::Diff::HTML &#40;patching would have led to
portability issues&#41;, and I had to override the _header method from
Text::Diff to add in the SUFFIX options &#40;i.e. take FILENAME_SUFFIX_A
and FILENAME_SUFFIX_B as per the PREFIX options and include them in
the output before the newline if defined&#41;. This is a bit of a shame,
because it&#39;s copying rather than reusing most of the code from that
method, and it might be worth looking for a better solution --- I
can&#39;t think of one other than patching Text::Diff itself, but maybe
you can.

Once I&#39;d done that, it was just a question of overriding file_header
with a version which did not encode the PREFIX and SUFFIX options, so
that I could supply values like &#39;&lt;del&gt;---&#39;, &#39;&lt;/del&gt;&#39;, &#39;&lt;ins&gt;+++&#39;, and
&#39;&lt;/ins&gt;&#39;, so that I marked up the file header lines the same way as I
mark up the corresponding hunk lines.

Sorry that this isn&#39;t as clean as I initially suggested...

Regards,

Pete.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-459057" href="/Public/Bug/Display.html?id=24301#txn-459057">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;08&nbsp;12:49:58&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #24301] XHTML doesn&#39;t allow div element inside pre element</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 May 2008 09:49:41 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-Diff-HTML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/459057/225798/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225798">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On May 8, 2008, at 06:12, Pete Gillin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I agree that this is a better solution, and have changed my instance
&gt; to use this method.
</div>
Cool. I have this checked in to svn, too, if you want to grab it there.

   <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.kineticode.com/Text-Diff-HTML/trunk/">https://svn.kineticode.com/Text-Diff-HTML/trunk/</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually, on reflection, I can&#39;t really provide a clean patch. What I
&gt; did was to subclass Text::Diff::HTML &#40;patching would have led to
&gt; portability issues&#41;, and I had to override the _header method from
&gt; Text::Diff to add in the SUFFIX options &#40;i.e. take FILENAME_SUFFIX_A
&gt; and FILENAME_SUFFIX_B as per the PREFIX options and include them in
&gt; the output before the newline if defined&#41;. This is a bit of a shame,
&gt; because it&#39;s copying rather than reusing most of the code from that
&gt; method, and it might be worth looking for a better solution --- I
&gt; can&#39;t think of one other than patching Text::Diff itself, but maybe
&gt; you can.
&gt;
&gt; Once I&#39;d done that, it was just a question of overriding file_header
&gt; with a version which did not encode the PREFIX and SUFFIX options, so
&gt; that I could supply values like &#39;&lt;del&gt;---&#39;, &#39;&lt;/del&gt;&#39;, &#39;&lt;ins&gt;+++&#39;, and
&gt; &#39;&lt;/ins&gt;&#39;, so that I marked up the file header lines the same way as I
&gt; mark up the corresponding hunk lines.
&gt;
&gt; Sorry that this isn&#39;t as clean as I initially suggested...
</div>
I&#39;m still not really following what it is you&#39;re doing here. I mean,  
what is the outcome? How does the output change?

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-459108" href="/Public/Bug/Display.html?id=24301#txn-459108">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;08&nbsp;13:58:09&nbsp;2008</span>
    <span class="description">pete [...] void.printf.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #24301] XHTML doesn&#39;t allow div element inside pre element</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 May 2008 18:57:33 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> David Wheeler via RT &lt;bug-Text-Diff-HTML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pete Gillin &lt;pete [...] void.printf.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/459108/225830/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225830">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, May 08, 2008 at 12:49:59PM -0400, David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m still not really following what it is you&#39;re doing here. I mean,
&gt; what is the outcome? How does the output change?
</div>
Sorry, let me try to explain a bit better.

 * What I want to do:

The normal behaviour of Text::Diff::HTML is to render the difference
between the list of fruits in foofile and barfile as follows.

&lt;div class=&#34;file&#34;&gt;&lt;span class=&#34;fileheader&#34;&gt;--- foofile [date]
+++ barfile [date]
&lt;/span&gt;&lt;div class=&#34;hunk&#34;&gt;&lt;span class=&#34;hunkheader&#34;&gt;@@ -1,7 +1,7 @@
&lt;/span&gt;&lt;span class=&#34;ctx&#34;&gt;   apple
   banana
   clementine
&lt;/span&gt;&lt;del&gt;-  date
&lt;/del&gt;&lt;ins&gt;+  damson
&lt;/ins&gt;&lt;span class=&#34;ctx&#34;&gt;   elderberry
   fig
   guava
&lt;/span&gt;&lt;span class=&#34;hunkfooter&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class=&#34;filefooter&#34;&gt;&lt;/span&gt;&lt;/div&gt;

I want to be able to produce the following instead.

&lt;div class=&#34;file&#34;&gt;&lt;span class=&#34;fileheader&#34;&gt;&lt;del&gt;--- foofile [date]
&lt;/del&gt;&lt;ins&gt;+++ barfile [date]
&lt;/ins&gt;&lt;/span&gt;&lt;div class=&#34;hunk&#34;&gt;&lt;span class=&#34;hunkheader&#34;&gt;@@ -1,7 +1,7 @@
&lt;/span&gt;&lt;span class=&#34;ctx&#34;&gt;   apple
   banana
   clementine
&lt;/span&gt;&lt;del&gt;-  date
&lt;/del&gt;&lt;ins&gt;+  damson
&lt;/ins&gt;&lt;span class=&#34;ctx&#34;&gt;   eggfruit
   fig
   guava
&lt;/span&gt;&lt;span class=&#34;hunkfooter&gt;&lt;/span&gt;&lt;/div&gt;&lt;span class=&#34;filefooter&#34;&gt;&lt;/span&gt;&lt;/div&gt;

Note the del and ins elements which appear around the filenames in the
fileheader now. I wanted to do this because I use colour coding on
these elements, and I wanted the filenames at the top of the diff to
appear in the same colours &#40;or rather different shades of the same
hues&#41; as the lines which appear only in that file. In the above case
&#39;foofile&#39; is coloured like &#39;date&#39; and &#39;barfile&#39; is coloured like
&#39;damson&#39;. I think &#40;and my users agreed&#41; that this improves readability
of the diff. &#40;It doesn&#39;t have to be del and ins, but there needs to be
some markup to distinguish the two lines, which there isn&#39;t at
present.&#41;

 * How I currently do this:

The &#39;---&#39; and &#39;+++&#39; prefixes were added by Text::Diff::_header from
the FILENAME_PREFIX_A and _B options. To make my change, I effectively
replace those values with &#39;&lt;del&gt;---&#39; and &#39;&lt;ins&gt;+++&#39;, but
&#40;a&#41; I also need to be able to supply a FILENAME_SUFFIX_A of &#39;&lt;/del&gt;&#39;
    and a FILENAME_SUFFIX_B of &#39;&lt;/ins&gt;&#39;, so I had to override _header
    with a new implemenation which took those options and used them
    &#40;if defined&#41; in the correct places in its return value; and
&#40;b&#41; I need to stop Text::Diff::HTML::file_header doing entity encoding
    on those values, because I don&#39;t want to escape the markup I&#39;m
    providing, so I had to override that method too.

 * How I would do this in an ideal world:

I think that Text::Diff could be patched to honour the SUFFIX options
without breaking anything. That would mean I didn&#39;t need to do &#40;a&#41;,
which is good as &#40;a&#41; is poor code reuse.

Avoiding &#40;b&#41; a little more complicated, I guess, because the current
behaviour &#40;that it should use &#39;---&#39; and &#39;+++&#39; prefixes by default,
that these can be changed by user-supplied option, and that they
should be escaped&#41; didn&#39;t ought to change for backwards compatibility
reasons. Either &#40;i&#41; making Text::Diff::HTML add the del and ins tags
to the SUFFIX and PREFIX values, or &#40;ii&#41; making it not escape the
user-supplied values, might break users&#39; existing code. I guess it
might be possible to provide a new option to turn on one or other of
these behaviours, but that might be over-engineering...

Regards,

Pete.

P.S. I appreciate that this is the wrong place to be requesting
patches to Text::Diff. I only threw this in as an aside since I was
mentioning the documentation error you&#39;ve already fixed --- it isn&#39;t a
big deal to me, and I don&#39;t want to take up too much of your time with
it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-459110" href="/Public/Bug/Display.html?id=24301#txn-459110">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;08&nbsp;14:08:01&nbsp;2008</span>
    <span class="description">pete [...] void.printf.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #24301] XHTML doesn&#39;t allow div element inside pre element</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 May 2008 19:07:29 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> David Wheeler via RT &lt;bug-Text-Diff-HTML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pete Gillin &lt;pete [...] void.printf.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/459110/225832/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225832">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 519b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Actually, I&#39;ve just thought that there&#39;s another option to fix by &#40;b&#41;
above: Text::Diff::HTML could arrange for the each filename to appear
in a span element with an appropriate class. Then I&#39;d be able to
attach the CSS I wanted to those classes to colour code them like the
del and ins elements, and it wouldn&#39;t break any existing code
&#40;except in the unlikely event that someone has already defined CSS for
the new classes you&#39;re adding&#41;.

This is still not possible without the patch to Text::Diff to fix &#40;a&#41;.

Pete.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-459125" href="/Public/Bug/Display.html?id=24301#txn-459125">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;08&nbsp;14:26:36&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #24301] XHTML doesn&#39;t allow div element inside pre element</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 May 2008 11:26:20 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-Diff-HTML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/459125/225842/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225842">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On May 8, 2008, at 10:58, Pete Gillin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Note the del and ins elements which appear around the filenames in the
&gt; fileheader now. I wanted to do this because I use colour coding on
&gt; these elements, and I wanted the filenames at the top of the diff to
&gt; appear in the same colours &#40;or rather different shades of the same
&gt; hues&#41; as the lines which appear only in that file. In the above case
&gt; &#39;foofile&#39; is coloured like &#39;date&#39; and &#39;barfile&#39; is coloured like
&gt; &#39;damson&#39;. I think &#40;and my users agreed&#41; that this improves readability
&gt; of the diff. &#40;It doesn&#39;t have to be del and ins, but there needs to be
&gt; some markup to distinguish the two lines, which there isn&#39;t at
&gt; present.&#41;
</div>
Okay, that&#39;s kind of what I thought you were saying, though I wasn&#39;t  
sure. Thanks for the detailed example.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * How I currently do this:
&gt;
&gt; The &#39;---&#39; and &#39;+++&#39; prefixes were added by Text::Diff::_header from
&gt; the FILENAME_PREFIX_A and _B options. To make my change, I effectively
&gt; replace those values with &#39;&lt;del&gt;---&#39; and &#39;&lt;ins&gt;+++&#39;, but
&gt; &#40;a&#41; I also need to be able to supply a FILENAME_SUFFIX_A of &#39;&lt;/del&gt;&#39;
&gt;    and a FILENAME_SUFFIX_B of &#39;&lt;/ins&gt;&#39;, so I had to override _header
&gt;    with a new implemenation which took those options and used them
&gt;    &#40;if defined&#41; in the correct places in its return value; and
&gt; &#40;b&#41; I need to stop Text::Diff::HTML::file_header doing entity encoding
&gt;    on those values, because I don&#39;t want to escape the markup I&#39;m
&gt;    providing, so I had to override that method too.
&gt;
&gt; * How I would do this in an ideal world:
&gt;
&gt; I think that Text::Diff could be patched to honour the SUFFIX options
&gt; without breaking anything. That would mean I didn&#39;t need to do &#40;a&#41;,
&gt; which is good as &#40;a&#41; is poor code reuse.
</div>
Well, it&#39;d be simpler to wrap them in spans instead of del and ins  
tags. That way the closing tag is always the same.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Avoiding &#40;b&#41; a little more complicated, I guess, because the current
&gt; behaviour &#40;that it should use &#39;---&#39; and &#39;+++&#39; prefixes by default,
&gt; that these can be changed by user-supplied option, and that they
&gt; should be escaped&#41; didn&#39;t ought to change for backwards compatibility
&gt; reasons. Either &#40;i&#41; making Text::Diff::HTML add the del and ins tags
&gt; to the SUFFIX and PREFIX values, or &#40;ii&#41; making it not escape the
&gt; user-supplied values, might break users&#39; existing code. I guess it
&gt; might be possible to provide a new option to turn on one or other of
&gt; these behaviours, but that might be over-engineering...
</div>
Okay, I&#39;ll have to look more closely at the code &#40;it has been a while&#41;  
and see what I can figure out. This is a reasonable feature request,  
though, as it adds semantic meaning to the output, which is always  
good &#40;and easy to style&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; P.S. I appreciate that this is the wrong place to be requesting
&gt; patches to Text::Diff. I only threw this in as an aside since I was
&gt; mentioning the documentation error you&#39;ve already fixed --- it isn&#39;t a
&gt; big deal to me, and I don&#39;t want to take up too much of your time with
&gt; it.
</div>
It&#39;s okay with me for feature requests to be here. It makes it easier  
to keep track. ;-&#41;

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-459127" href="/Public/Bug/Display.html?id=24301#txn-459127">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;08&nbsp;14:27:13&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #24301] XHTML doesn&#39;t allow div element inside pre element</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 May 2008 11:27:03 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-Diff-HTML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/459127/225844/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225844">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 658b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On May 8, 2008, at 11:08, Pete Gillin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually, I&#39;ve just thought that there&#39;s another option to fix by &#40;b&#41;
&gt; above: Text::Diff::HTML could arrange for the each filename to appear
&gt; in a span element with an appropriate class. Then I&#39;d be able to
&gt; attach the CSS I wanted to those classes to colour code them like the
&gt; del and ins elements, and it wouldn&#39;t break any existing code
&gt; &#40;except in the unlikely event that someone has already defined CSS for
&gt; the new classes you&#39;re adding&#41;.
</div>
GMTA. ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is still not possible without the patch to Text::Diff to fix &#40;a&#41;.
</div>
I&#39;ll take a look at it sometime in the next week.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-588332" href="/Public/Bug/Display.html?id=24301#txn-588332">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;07&nbsp;18:37:45&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-588334" href="/Public/Bug/Display.html?id=24301#txn-588334">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;07&nbsp;18:37:46&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Fixed in 0.06 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.471979</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
