<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53914 for Win32-API: Bug report for Win32::API::Callback [GenerateConsoleCtrlEvent]</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53914 for Win32-API: Bug report for Win32::API::Callback [GenerateConsoleCtrlEvent]</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Win32-API/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Win32-API/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Win32-API/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Win32-API/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Win32-API">Win32-API CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53914</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Win32-API/Active/">Win32-API</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">BULKDD [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
CHORNY [...] cpan.org

<br />
perlsite [...] mail.bg

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-35436-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.68    </td>
  </tr>
  <tr id="CF-35437-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.70_01    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;22&nbsp;06:26:39&nbsp;2010</span>
    <span class="description">perlsite [...] mail.bg -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug report for Win32::API::Callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Jan 2010 13:24:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-API [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> perlsite [...] mail.bg</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

The code below generate exception and application dies with the  
following &#34;Error signature&#34;

AppName: perl.exe     AppVer: 5.10.0.1004     ModName: perl510.dll
ModVer: 5.10.0.1004     Offset: 000961d5

# --- code start ---

#!/usr/bin/perl
use strict;
use Win32::API;
use Win32::API::Callback;

Win32::API-&gt;Import&#40;&#39;kernel32&#39;, &#39;SetConsoleCtrlHandler&#39;, &#39;KL&#39;, &#39;L&#39;&#41;;
Win32::API-&gt;Import&#40;&#39;kernel32&#39;, &#39;GenerateConsoleCtrlEvent&#39;, &#39;LL&#39;, &#39;L&#39;&#41;;
Win32::API-&gt;Import&#40;&#39;kernel32&#39;, &#39;GetLastError&#39;, &#39;&#39;, &#39;L&#39;&#41;;

sub cb {
     my &#40;$dwCtrlType&#41; = @_;

     open &#40;FILE, &#39;&gt;c:/QUIT.TXT&#39;&#41;;
     print FILE &#34;RECEIVED SIGNAL: $dwCtrlType\n&#34;;
     close FILE;

     return 0;
}

my $callback = Win32::API::Callback-&gt;new&#40;\&#38;cb, &#34;L&#34;, &#34;L&#34;&#41;;

SetConsoleCtrlHandler&#40;$callback, 1&#41;  or die &#34;Error: &#34; . GetLastError&#40;&#41; . &#34;\n&#34;;

sleep&#40;1&#41;;
GenerateConsoleCtrlEvent&#40;0, 0&#41;;
sleep&#40;2&#41;;

# --- code end ---

The error occurs when cb&#40;&#41; routine is called, no matter whether it is  
triggered through GenerateConsoleCtrlEvent call or via while&#40;1&#41;{} and  
Ctrl+C. Also specific implementation of cb&#40;&#41; routine doesn&#39;t matter,  
i.e. callback body can be just return 0 or return 1 - same effect &#40;in  
my implementation no file is created, so I assume that exception is  
generated when OS try to call the callback&#41;. My personal opinion is  
that $callback handler is not properly implemented.

My test fails both with Win32-API version 0.55 and 0.58 &#40;ActiveState build&#41;.
I&#39;m using Windows XP Professional, SP3 &#40;up-to-date installation&#41;.

Regards,
Julian


-------------------------------------

Хостинг от 3.60 лв/м| Домейни от 17.46 лв/с ДДС| Сървъри, VPS от 48.00  
лв/м с ДДС!
18 GB място, Неограничен трафик, Безплатен домейн – 6.90 лв./м с ДДС!
25 GB място, 1200 GB трафик, Безплатен домейн – 11.46 лв./м с ДДС!
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;07&nbsp;07:04:22&nbsp;2010</span>
    <span class="description">cosimo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 22 06:26:39 2010, perlsite@mail.bg wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The error occurs when cb&#40;&#41; routine is called, no matter whether it is
&gt; triggered through GenerateConsoleCtrlEvent call or via while&#40;1&#41;{} and
&gt; Ctrl+C. Also specific implementation of cb&#40;&#41; routine doesn&#39;t matter,
&gt; i.e. callback body can be just return 0 or return 1 - same effect &#40;in
&gt; my implementation no file is created, so I assume that exception is
&gt; generated when OS try to call the callback&#41;. My personal opinion is
&gt; that $callback handler is not properly implemented.
</div>
Hi Julian,

sorry for the late reply.
I have to admit I don&#39;t have too much time to debug this,
but I also have no clue about what&#39;s going wrong.

I guess you haven&#39;t found a way around your problem...

-- 
Cosimo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;07&nbsp;07:04:23&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;07&nbsp;07:51:32&nbsp;2010</span>
    <span class="description">dada [...] perl.it -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">my &#40;wild enough&#41; guess is that there is something different in the
PHANDLER_ROUTINE &#40;the callback SetConsoleCtrlHandler expects&#41; from other
working callbacks. Namely:

BOOL WINAPI HandlerRoutine&#40;
  __in  DWORD dwCtrlType
&#41;;

versus e.g.:

BOOL CALLBACK EnumWindowsProc&#40;
  __in  HWND hwnd,
  __in  LPARAM lParam
&#41;;

the difference is the WINAPI instead of CALLBACK definition. I think it
may have something to do with calling conventions and how parameters are
pushed to the stack. 

this would man that callbacks defined in C as WINAPI are not supported,
only those defined as CALLBACK are.

but digging in the C headers to find the real difference between WINAPI
and CALLBACK, or even adding support for different calling conventions
in Win32::API::Callback is beyond my scope at the moment, sorry :-&#40;

cheers,
Aldo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;07&nbsp;15:44:56&nbsp;2010</span>
    <span class="description">JDB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 07 07:51:32 2010, ACALPINI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the difference is the WINAPI instead of CALLBACK definition. I think it
&gt; may have something to do with calling conventions and how parameters are
&gt; pushed to the stack. 
&gt; 
&gt; this would man that callbacks defined in C as WINAPI are not supported,
&gt; only those defined as CALLBACK are.
&gt; 
&gt; but digging in the C headers to find the real difference between WINAPI
&gt; and CALLBACK, or even adding support for different calling conventions
&gt; in Win32::API::Callback is beyond my scope at the moment, sorry :-&#40;
</div>
I think WINAPI and CALLBACK are both synonyms for __stdcall, so that
should not make any difference.

Cheers,
-Jan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;07&nbsp;17:30:54&nbsp;2010</span>
    <span class="description">dbecoll [...] roadrunner.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53914] Bug report for Win32::API::Callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Sep 2010 14:30:15 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-API [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bill Luebkert &lt;dbecoll [...] roadrunner.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 9/7/2010 4:51 AM, Aldo Calpini via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Sep 07 07:51:32 2010: Request 53914 was acted upon.
&gt; Transaction: Correspondence added by ACALPINI
&gt;         Queue: Win32-API
&gt;       Subject: Bug report for Win32::API::Callback
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: perlsite@mail.bg
&gt;        Status: open
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53914">https://rt.cpan.org/Ticket/Display.html?id=53914</a></span>&gt;
&gt;
&gt;
&gt; my &#40;wild enough&#41; guess is that there is something different in the
&gt; PHANDLER_ROUTINE &#40;the callback SetConsoleCtrlHandler expects&#41; from other
&gt; working callbacks. Namely:
&gt;
&gt; BOOL WINAPI HandlerRoutine&#40;
&gt;    __in  DWORD dwCtrlType
&gt; &#41;;
&gt;
&gt; versus e.g.:
&gt;
&gt; BOOL CALLBACK EnumWindowsProc&#40;
&gt;    __in  HWND hwnd,
&gt;    __in  LPARAM lParam
&gt; &#41;;
&gt;
&gt; the difference is the WINAPI instead of CALLBACK definition. I think it
&gt; may have something to do with calling conventions and how parameters are
&gt; pushed to the stack.
&gt;
&gt; this would man that callbacks defined in C as WINAPI are not supported,
&gt; only those defined as CALLBACK are.
&gt;
&gt; but digging in the C headers to find the real difference between WINAPI
&gt; and CALLBACK, or even adding support for different calling conventions
&gt; in Win32::API::Callback is beyond my scope at the moment, sorry :-&#40;
</div>
They appear to be the esentially the same.
Looks like it&#39;s just a matter of whether __stdcall calling convention
is in use or not.

WINDEF.H:

#if &#40;_MSC_VER &gt;= 800&#41; || defined&#40;_STDCALL_SUPPORTED&#41;
#define CALLBACK    __stdcall
#define WINAPI      __stdcall
#define WINAPIV     __cdecl
#define APIENTRY    WINAPI
#define APIPRIVATE  __stdcall
#define PASCAL      __stdcall
#else
#define CALLBACK
#define WINAPI
#define WINAPIV
#define APIENTRY    WINAPI
#define APIPRIVATE
#define PASCAL      pascal
#endif
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;02:14:29&nbsp;2010</span>
    <span class="description">rurban [...] x-ray.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> libwin32 [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53914] Bug report for Win32::API::Callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 8 Sep 2010 08:14:20 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-API [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Reini Urban &lt;rurban [...] x-ray.at&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2010/9/7 Cosimo Streppone via RT &lt;bug-Win32-API@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Sep 07 07:04:22 2010: Request 53914 was acted upon.
&gt; Transaction: Correspondence added by COSIMO
&gt;       Queue: Win32-API
&gt;     Subject: Bug report for Win32::API::Callback
&gt;   Broken in: &#40;no value&#41;
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: perlsite@mail.bg
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53914">https://rt.cpan.org/Ticket/Display.html?id=53914</a></span> &gt;
&gt;
&gt;
&gt; On Fri Jan 22 06:26:39 2010, perlsite@mail.bg wrote:
&gt;
<div class="message-stanza open">&gt;&gt; The error occurs when cb&#40;&#41; routine is called, no matter whether it is
&gt;&gt; triggered through GenerateConsoleCtrlEvent call or via while&#40;1&#41;{} and
&gt;&gt; Ctrl+C. Also specific implementation of cb&#40;&#41; routine doesn&#39;t matter,
&gt;&gt; i.e. callback body can be just return 0 or return 1 - same effect &#40;in
&gt;&gt; my implementation no file is created, so I assume that exception is
&gt;&gt; generated when OS try to call the callback&#41;. My personal opinion is
&gt;&gt; that $callback handler is not properly implemented.
</div>&gt;
&gt; Hi Julian,
&gt;
&gt; sorry for the late reply.
&gt; I have to admit I don&#39;t have too much time to debug this,
&gt; but I also have no clue about what&#39;s going wrong.
&gt;
&gt; I guess you haven&#39;t found a way around your problem...
</div>
/usr/include/w32api/windef.h:#define CALLBACK __stdcall

So it should just work, both are the same calling convention,
CALLBACK is not using cdecl.

I&#39;ll check if I see something wrong how callbacks &#40;T_CODE&#41;
are handled in API.xs
But I rather believe the user callback sub is just wrong.
You have to debug into the perl-side of the callback.
-- 
Reini Urban
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;04:40:17&nbsp;2010</span>
    <span class="description">rurban [...] x-ray.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> libwin32 [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53914] Bug report for Win32::API::Callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 8 Sep 2010 10:40:08 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-API [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Reini Urban &lt;rurban [...] x-ray.at&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2010/9/8 Reini Urban &lt;rurban@x-ray.at&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll check if I see something wrong how callbacks &#40;T_CODE&#41;
&gt; are handled in API.xs
&gt; But I rather believe the user callback sub is just wrong.
&gt; You have to debug into the perl-side of the callback.
</div>
In my app the Ctrl-C or Ctrl-Break signal is never generated.
Maybe we need a AllocConsole beforehand.
Attached is a test case.

-- 
Reini Urban
<span class="clickylink"><a target="new" rel="nofollow" href="http://phpwiki.org/">http://phpwiki.org/</a></span>           <span class="clickylink"><a target="new" rel="nofollow" href="http://murbreak.at/">http://murbreak.at/</a></span>
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;28&nbsp;16:02:10&nbsp;2011</span>
    <span class="description">cosimo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> rurban [...] x-ray.at, libwin32 [...] perl.org, dbecoll [...] roadrunner.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 08 04:40:17 2010, rurban@x-ray.at wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2010/9/8 Reini Urban &lt;rurban@x-ray.at&gt;:
<div class="message-stanza open">&gt; &gt; I&#39;ll check if I see something wrong how callbacks &#40;T_CODE&#41;
&gt; &gt; are handled in API.xs
&gt; &gt; But I rather believe the user callback sub is just wrong.
&gt; &gt; You have to debug into the perl-side of the callback.
</div>&gt; 
&gt; In my app the Ctrl-C or Ctrl-Break signal is never generated.
&gt; Maybe we need a AllocConsole beforehand.
&gt; Attached is a test case.
</div>
Took me almost a year to come back to this bug.
I have now included the test script under the Callback/t folder.
Unfortunately, I don&#39;t have a test Win32 install available.
I&#39;ll try to find one to see if that test can trigger the callback.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/cosimo/perl5-win32-api/">https://github.com/cosimo/perl5-win32-api/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;14:35:12&nbsp;2012</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Aug 28 16:02:10 2011, COSIMO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Sep 08 04:40:17 2010, rurban@x-ray.at wrote:
<div class="message-stanza open">&gt; &gt; 2010/9/8 Reini Urban &lt;rurban@x-ray.at&gt;:
</div>&gt; 
&gt; Took me almost a year to come back to this bug.
&gt; I have now included the test script under the Callback/t folder.
</div>
I get a failure &#40;actually a crash&#41; on Callback/t/04_rt_53914.t during
GenerateConsoleCtrlEvent&#40;1, 0&#41;.

All other tests pass.
For 32-bit Strawberry perl 5.14.2 on a 64-bit machine.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;20&nbsp;10:15:13&nbsp;2012</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2012-02-14 14:35:12, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Aug 28 16:02:10 2011, COSIMO wrote:
<div class="message-stanza open">&gt; &gt; On Wed Sep 08 04:40:17 2010, rurban@x-ray.at wrote:
<div class="message-stanza open">&gt; &gt; &gt; 2010/9/8 Reini Urban &lt;rurban@x-ray.at&gt;:
</div>&gt; &gt; 
&gt; &gt; Took me almost a year to come back to this bug.
&gt; &gt; I have now included the test script under the Callback/t folder.
</div>&gt; 
&gt; I get a failure &#40;actually a crash&#41; on Callback/t/04_rt_53914.t during
&gt; GenerateConsoleCtrlEvent&#40;1, 0&#41;.
&gt; 
&gt; All other tests pass.
&gt; For 32-bit Strawberry perl 5.14.2 on a 64-bit machine.
</div>
I get similar results with perl 5.10.1 from the Cygwin distribution: 
Perl crashes &#40;leaves stackdump&#41;, and the RXVT window it&#39;s running in closes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;23&nbsp;13:02:58&nbsp;2012</span>
    <span class="description">cosimo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 20 10:15:13 2012, JDHEDDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2012-02-14 14:35:12, DOUGW wrote:
<div class="message-stanza open">&gt; &gt; On Sun Aug 28 16:02:10 2011, COSIMO wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Wed Sep 08 04:40:17 2010, rurban@x-ray.at wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; 2010/9/8 Reini Urban &lt;rurban@x-ray.at&gt;:
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; Took me almost a year to come back to this bug.
&gt; &gt; &gt; I have now included the test script under the Callback/t folder.
</div>&gt; &gt; 
&gt; &gt; I get a failure &#40;actually a crash&#41; on Callback/t/04_rt_53914.t 
</div></div>during
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; GenerateConsoleCtrlEvent&#40;1, 0&#41;.
&gt; &gt; 
&gt; &gt; All other tests pass.
&gt; &gt; For 32-bit Strawberry perl 5.14.2 on a 64-bit machine.
</div>&gt; 
&gt; I get similar results with perl 5.10.1 from the Cygwin distribution: 
&gt; Perl crashes &#40;leaves stackdump&#41;, and the RXVT window it&#39;s running in 
</div>closes.

All the reports I got so far, or those that I have managed to keep 
track of in my email, are from users of 64-bit Windows, but running a 
32 bit perl.

My guess is that in this case a Win32::API-&gt;Import&#40;&#41; with &#34;L&#34; as type 
considers &#34;L&#34; as 32 bits, while on the native machine is 64 bits. Is 
this the case? Can we do something?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;01&nbsp;15:18:38&nbsp;2012</span>
    <span class="description">CHORNY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 23 13:02:58 2012, COSIMO wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; All the reports I got so far, or those that I have managed to keep 
&gt; track of in my email, are from users of 64-bit Windows, but running a 
&gt; 32 bit perl.
</div>
I have 32-bit Perl on 32-bit Windows XP

t/04_rt_53914.t .. 1/2 # callback installed, sleep 1, generate Ctrl-C signal
Terminating on signal SIGBREAK&#40;21&#41;
# callback called or not
^C^C^C


-- 
Alexandr Ciornii, <span class="clickylink"><a target="new" rel="nofollow" href="http://chorny.net">http://chorny.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;07&nbsp;19:19:54&nbsp;2012</span>
    <span class="description">CHORNY [...] cpan.org -  Requestor CHORNY added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;10&nbsp;14:39:35&nbsp;2012</span>
    <span class="description">cosimo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Until we know more about this, I have modified the test case to 
&#34;skip_all&#34;. At least people can build Win32::API...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;10:43:04&nbsp;2012</span>
    <span class="description">bulk88&#40;1&#41; [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bulk88&#40;1&#41; [...] hotmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 10 14:39:35 2012, COSIMO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Until we know more about this, I have modified the test case to 
&gt; &#34;skip_all&#34;. At least people can build Win32::API...
</div>
This is NEVER going to work. Read
<span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms683242%28v=vs.85%29.aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/ms683242%28v=vs.85%29.aspx</a></span>
. I&#39;ll quote.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_______________
Remarks

Because the system creates a new thread in the process to execute the
handler function, it is possible that the handler function will be
terminated by another thread in the process. Be sure to synchronize
threads in the process with the thread for the handler function.
<div class="message-stanza open">________________

A new thread.

Here is a callstack from Win32::API::Callback&#39;s dynamically generated
callback.
<div class="message-stanza open">________________
<div class="message-stanza open">&gt;       00833fbc&#40;&#41;      
</div>        kernel32.dll!_CtrlRoutine@4&#40;&#41;  + 0x118  
        kernel32.dll!_BaseThreadStart@8&#40;&#41;  + 0x37       
<div class="message-stanza open">________________

The breakpoint is the first line below

<div class="message-stanza open">________________
00833FBC 55               push        ebp  
00833FBD 8B EC            mov         ebp,esp 
00833FBF 83 EC 18         sub         esp,18h 
00833FC2 C7 45 E8 B4 F1 91 00 mov         dword ptr [ebp-18h],91F1B4h 
00833FC9 C7 45 F0 01 00 00 00 mov         dword ptr [ebp-10h],1 
00833FD0 8B 45 F0         mov         eax,dword ptr [ebp-10h] 
00833FD3 C1 E0 05         shl         eax,5 
00833FD6 50               push        eax  
00833FD7 E8 4E FA B9 FF   call        Perl_safesysmalloc &#40;3D3A2Ah&#41; 
00833FDC 83 C4 04         add         esp,4 
00833FDF 89 45 F8         mov         dword ptr [ebp-8],eax 
00833FE2 C7 45 F4 10 00 DE C0 mov         dword ptr [ebp-0Ch],0C0DE0010h 
00833FE9 C7 45 FC 00 00 00 00 mov         dword ptr [ebp-4],0 
00833FF0 8B 4D FC         mov         ecx,dword ptr [ebp-4] 
00833FF3 C1 E1 05         shl         ecx,5 
00833FF6 8B 55 F8         mov         edx,dword ptr [ebp-8] 
00833FF9 C7 04 0A 03 00 00 00 mov         dword ptr [edx+ecx],3 
<div class="message-stanza open">__________________

There is no dTHX/my_perl in TLS in this new thread. You wouldn&#39;t want to
add one anyways due to the race problems of 2 OS threads, 1 perl interp.
<div class="message-stanza open">___________________
I step into the safesysmalloc call.
<div class="message-stanza open">___________________
    72: 
    73: /* paranoid version of system&#39;s malloc&#40;&#41; */
    74: 
    75: Malloc_t
    76: Perl_safesysmalloc&#40;MEM_SIZE size&#41;
    77: {
281C2160 55               push        ebp  
281C2161 8B EC            mov         ebp,esp 
281C2163 83 EC 18         sub         esp,18h 
    78:     dTHX;
281C2166 E8 B5 19 E4 FF   call        @ILT+11035&#40;_Perl_get_context&#41;
&#40;28003B20h&#41; 
281C216B 89 45 FC         mov         dword ptr [my_perl],eax 
    79:     Malloc_t ptr;
    80: #ifdef HAS_64K_LIMIT
    81:         if &#40;size &gt; 0xffff&#41; {
    82:             PerlIO_printf&#40;Perl_error_log,
    83:                           &#34;Allocation too large: %lx\n&#34;, size&#41; FLUSH;
    84:             my_exit&#40;1&#41;;
    85:         }
    86: #endif /* HAS_64K_LIMIT */
<div class="message-stanza open">_______________________
I see a dTHX, step into that.
<div class="message-stanza open">_______________________
    21: 
    22: void *
    23: Perl_get_context&#40;void&#41;
    24: {
281EA190 55               push        ebp  
281EA191 8B EC            mov         ebp,esp 
281EA193 83 EC 08         sub         esp,8 
    25: #if defined&#40;USE_ITHREADS&#41;
    26: #  ifdef USE_DECLSPEC_THREAD
    27:     return Perl_current_context;
    28: #  else
    29:     DWORD err = GetLastError&#40;&#41;;
281EA196 FF 15 38 78 22 28 call        dword ptr [__imp__GetLastError@0
&#40;28227838h&#41;] 
281EA19C 89 45 F8         mov         dword ptr [err],eax 
    30:     void *result = TlsGetValue&#40;PL_thr_key&#41;;
281EA19F A1 D8 6E 22 28   mov         eax,dword ptr [_PL_thr_key
&#40;28226ED8h&#41;] 
281EA1A4 50               push        eax  
281EA1A5 FF 15 14 78 22 28 call        dword ptr [__imp__TlsGetValue@4
&#40;28227814h&#41;] 
281EA1AB 89 45 FC         mov         dword ptr [result],eax 
    31:     SetLastError&#40;err&#41;;
281EA1AE 8B 4D F8         mov         ecx,dword ptr [err] 
<div class="message-stanza open">___________________________
result is 
        result  0x00000000      void *

This is will never work unless you build a new ithread perl interp for
each callback run.

Perhaps a more graceful console warning, or less graceful console
warning + process exit that the dyn callback func ran from the wrong
thread is needed and then this bug can be closed. I may or may not put
this warning into my Win32 API 0.69.
</div></div></div></div></div></div></div></div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;13:58:03&nbsp;2012</span>
    <span class="description">bulk88&#40;1&#41; [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bulk88&#40;1&#41; [...] hotmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I may or may not put
&gt; this warning into my Win32 API 0.69.
</div>

I&#39;m working on putting the warning in. Its very complicated.
CallbackTemplate has no jmp codes or branches, and CreateCallback
doesn&#39;t detect or adjust them currently. I think I will be successful
though.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;19&nbsp;01:29:52&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Member ticket #75336 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;19&nbsp;01:33:32&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Subject changed from &#39;Bug report for Win32::API::Callback&#39; to &#39;Bug report for Win32::API::Callback [GenerateConsoleCtrlEvent]&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;19&nbsp;21:43:20&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> bulk88 [...] hotmail.com, libwin32 [...] perl.org, rurban [...] x-ray.at,
 dbecoll [...] roadrunner.com, perlsite [...] mail.bg</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun May 20 13:58:03 2012, bulk88. wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I may or may not put
&gt; &gt; this warning into my Win32 API 0.69.
</div>&gt; 
&gt; 
&gt; I&#39;m working on putting the warning in. Its very complicated.
&gt; CallbackTemplate has no jmp codes or branches, and CreateCallback
&gt; doesn&#39;t detect or adjust them currently. I think I will be successful
&gt; though.
</div>
As of Win32::API 0.69 this will not crash, only a fatal error &#40;see this
code chunk
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/COSIMO/Win32-API-0.72/Callback/Callback.xs#L204">https://metacpan.org/source/COSIMO/Win32-API-0.72/Callback/Callback.xs#L204</a></span>
&#41; and possible resource leaks &#40;ExitThread&#40;&#41;&#41;. Is this a good enough
resolution to the problem or does someone seriously want the Perl interp
to be automatically moved between OS threads? The
GenerateConsoleCtrlEvent API always runs the callback in a brand new OS
thread each time Ctrl-C or synthesized equivalent happens, unlike Unix
signals.

To automatically move the threaded interp between OS threads without an
explicit command to suspend and transfer the interp on a Script level,
reenterancy and race conditions *I think* will make it very unstable.
This would involve adding an &#34;event loop&#34; to Win32::API or integration
with the event loop in the interp&#39;s alarm/Windows Messages/Win32 safe
signals system. Does anyone want Win32::API to move the interp between
OS threads or is the fatal error to console enough? If I dont get any
responses in the next couple days or week I will close this ticket as
resolved/fixed &#40;as fatal error in 0.69 rather than previous crash&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;19&nbsp;21:43:25&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;21:05:47&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Broken in 0.68 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;21:05:48&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Fixed in 0.70_01 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;21:06:40&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> libwin32 [...] perl.org, rurban [...] x-ray.at, dbecoll [...] roadrunner.com,
 perlsite [...] mail.bg</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 19 21:43:20 2012, BULKDD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As of Win32::API 0.69 this will not crash, only a fatal error &#40;see this
&gt; code chunk
&gt;
</div><span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/COSIMO/Win32-API-0.72/Callback/Callback.xs#L204">https://metacpan.org/source/COSIMO/Win32-API-0.72/Callback/Callback.xs#L204</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#41; and possible resource leaks &#40;ExitThread&#40;&#41;&#41;. Is this a good enough
&gt; resolution to the problem or does someone seriously want the Perl interp
&gt; to be automatically moved between OS threads? The
&gt; GenerateConsoleCtrlEvent API always runs the callback in a brand new OS
&gt; thread each time Ctrl-C or synthesized equivalent happens, unlike Unix
&gt; signals.
&gt; 
&gt; To automatically move the threaded interp between OS threads without an
&gt; explicit command to suspend and transfer the interp on a Script level,
&gt; reenterancy and race conditions *I think* will make it very unstable.
&gt; This would involve adding an &#34;event loop&#34; to Win32::API or integration
&gt; with the event loop in the interp&#39;s alarm/Windows Messages/Win32 safe
&gt; signals system. Does anyone want Win32::API to move the interp between
&gt; OS threads or is the fatal error to console enough? If I dont get any
&gt; responses in the next couple days or week I will close this ticket as
&gt; resolved/fixed &#40;as fatal error in 0.69 rather than previous crash&#41;.
</div>
This was fixed with a fatal error in 0.69 instead of the previous crash.
No response 30 days, closing as resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;21:06:41&nbsp;2012</span>
    <span class="description">BULKDD [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
