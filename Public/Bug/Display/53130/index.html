<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53130 for DBD-mysql: UTF8 strings have no utf8 flag set</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53130 for DBD-mysql: UTF8 strings have no utf8 flag set</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-mysql">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-mysql">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-mysql">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-mysql">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-mysql">DBD-mysql CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53130</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-mysql">DBD-mysql</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dragon31337 [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
pali [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-10170-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.011    </td>
  </tr>
  <tr id="CF-10171-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
4.041_01    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dbinit.sql<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/711704/367332/dbinit.sql">
Sun Dec 27 18:05:00 2009 (868b) by dragon31337 [...] gmail.com
</a>
</font></li>
</ul>


repro-utf8-2011-01-27.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/888194/460367/repro-utf8-2011-01-27.diff">
Thu Jan 27 09:49:28 2011 (742b) by http://peter.vereshagin.org/
</a>
</font></li>
</ul>


repro.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/711704/367333/repro.pl">
Sun Dec 27 18:05:00 2009 (1.5k) by dragon31337 [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=53130">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-711704" href="/Public/Bug/Display.html?id=53130#txn-711704">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;27&nbsp;18:05:00&nbsp;2009</span>
    <span class="description">dragon31337 [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> UTF8 strings have no utf8 flag set</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/711704/367331/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367331">with headers</a>
<br />
<span class="downloadcontenttype">text/html 730b</span>
</div>
<div class="messagebody">
<div class="message-stanza">I can't clearly figure out if is dupe, seems like it is not. Others were not touched for years already.<br>

Unicode strings has no utf8 flag set. So strings are encoded in utf8, but there is no utf8 flag.<br>

I've created a unicode db and a table in it, see dbinit.sql for mo detail.<br>

Repro script in attach.<br>

<br>

All strings are valid utf8 strings but without utf flag. These strings go to output incorrectly unless I update it myself.<br>

<br>

Note: all utf8&nbsp; flags set for outputs, etc...<br>

<br>

perl version:&nbsp; v5.10.1, build 1006 [291086]<br>

DBD-mysql: 4.011<br>

DBI: 1.609<br>

OS: Windows 7 32bit [Version 6.1.7600]<br>

MySQL: 5.1.37 win32 on localhost<br>

<br>

<br>

<br>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dbinit.sql</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/711704/367332/dbinit.sql">Download dbinit.sql</a><br />
<span class="downloadcontenttype">application/octet-stream 868b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> repro.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/711704/367333/repro.pl">Download repro.pl</a><br />
<span class="downloadcontenttype">text/x-perl 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use Data::Dumper;
use strict;
use DBI;
use utf8;
use Encode;
binmode STDOUT, &#34;:utf8&#34;;
binmode STDIN, &#34;:utf8&#34;;


    my &#40;$host, $port, $database, $user, $password, $rise&#41; = &#40;&#39;localhost&#39;,&#39;3306&#39;,&#39;flights&#39;,&#39;root&#39;,&#39;itsme&#39;&#41;;
    my $dsn = &#34;DBI:mysql:host=$host;port=$port;&#34;.
              &#34;database=$database;&#34;.
              &#34;mysql_compression=1;&#34;.
              &#34;mysql_client_found_rows=1;&#34;.
              &#34;mysql_auto_reconnect=1;&#34;.
              &#34;mysql_enable_utf8=1;&#34;;
    my $dbh = DBI-&gt;connect&#40;
                            $dsn,
                            $user,
                            $password,
                            {
                              RaiseError =&gt; 1,
                            }
                          &#41;;                         
    $dbh-&gt;do&#40;&#34;SET character_set_client     = utf8;&#34;&#41;;
    $dbh-&gt;do&#40;&#34;SET character_set_connection = utf8;&#34;&#41;;
    $dbh-&gt;do&#40;&#34;SET character_set_results    = utf8;&#34;&#41;;
    my $query = $dbh-&gt;prepare&#40;&#34;SELECT * FROM countries&#34;&#41;;
    $query-&gt;execute&#40;&#41;;
    my $data = $query-&gt;fetchall_arrayref&#40;&#41;;
    foreach my $str &#40;@$data&#41;
    {
      foreach my $val &#40;@$str&#41;
      {
        print &#40;&#34;Value: $val, it is &#34;.&#40;utf8::is_utf8&#40;$val&#41;?&#34;&#34;:&#34;non-&#34;&#41;.&#34;utf8 string, and &#34;.&#40;utf8::valid&#40;$str&#41;?&#34;&#34;:&#34;not&#34;&#41;.&#34; valid&lt;br&gt;\n&#34;&#41;;
        Encode::_utf8_on&#40;$val&#41;;
        print &#40;&#34;Value: $val, it is &#34;.&#40;utf8::is_utf8&#40;$val&#41;?&#34;&#34;:&#34;non-&#34;&#41;.&#34;utf8 string, and &#34;.&#40;utf8::valid&#40;$str&#41;?&#34;&#34;:&#34;not&#34;&#41;.&#34; valid&lt;br&gt;\n&#34;&#41;;
      }
    }
    $query-&gt;finish&#40;&#41;;
    $dbh-&gt;disconnect&#40;&#41;;
    return $data;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-888194" href="/Public/Bug/Display.html?id=53130#txn-888194">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;27&nbsp;09:49:28&nbsp;2011</span>
    <span class="description">http://peter.vereshagin.org/ -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> peter [...] vereshagin.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/888194/460366/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/460366">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 210b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have another kind of trouble here.
WHat do you think about the patch I supply here?
I was trying your repro.pl to know out if that is your trouble, too:
<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.mysql.com/perl/4382">http://lists.mysql.com/perl/4382</a></span>
But it looks like not.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> repro-utf8-2011-01-27.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/888194/460367/repro-utf8-2011-01-27.diff">Download repro-utf8-2011-01-27.diff</a><br />
<span class="downloadcontenttype">text/x-diff 742b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- repro.pl.old	2011-01-27 17:31:29.000000000 +0300
+++ repro.pl	2011-01-27 17:33:19.000000000 +0300
@@ -1,9 +1,7 @@
 use Data::Dumper;
 use strict;
 use DBI;
-use utf8;
 use Encode;
-binmode STDOUT, &#34;:utf8&#34;;
 binmode STDIN, &#34;:utf8&#34;;
 
 
@@ -33,11 +31,10 @@
       foreach my $val &#40;@$str&#41;
       {
         print &#40;&#34;Value: $val, it is &#34;.&#40;utf8::is_utf8&#40;$val&#41;?&#34;&#34;:&#34;non-&#34;&#41;.&#34;utf8 string, and &#34;.&#40;utf8::valid&#40;$str&#41;?&#34;&#34;:&#34;not&#34;&#41;.&#34; valid&lt;br&gt;\n&#34;&#41;;
-        Encode::_utf8_on&#40;$val&#41;;
+        utf8::upgrade&#40; $val &#41;;
         print &#40;&#34;Value: $val, it is &#34;.&#40;utf8::is_utf8&#40;$val&#41;?&#34;&#34;:&#34;non-&#34;&#41;.&#34;utf8 string, and &#34;.&#40;utf8::valid&#40;$str&#41;?&#34;&#34;:&#34;not&#34;&#41;.&#34; valid&lt;br&gt;\n&#34;&#41;;
       }
     }
     $query-&gt;finish&#40;&#41;;
     $dbh-&gt;disconnect&#40;&#41;;
-    return $data;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-888197" href="/Public/Bug/Display.html?id=53130#txn-888197">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;27&nbsp;09:49:29&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-956365" href="/Public/Bug/Display.html?id=53130#txn-956365">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;16&nbsp;00:09:58&nbsp;2011</span>
    <span class="description">starrychloe [...] oliveyou.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MySQL driver does not handle UTF strings properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> starrychloe [...] oliveyou.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/956365/497520/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/497520">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes this is a bug. Mistakenly reported it to MSSQL before. It does not get 
the same values it writes. Here is test case:

use DBI;
use Data::Dumper;
use strict;
use utf8;
binmode STDOUT, &#34;:utf8&#34;;
my $h = DBI-&gt;connect&#40;&#39;dbi:mysql:database=xxx;host=server99&#39;, &#39;xxx&#39;, 
&#39;xxxxx&#39;&#41; or die&#40;&#34;Cannot connect to MySQL database: &#34;, $DBI::errstr&#41;;
$h-&gt;do&#40;&#39;SET NAMES utf8&#39;&#41;;
eval {
        $h-&gt;do&#40;q/drop table mje/&#41;;
};
$h-&gt;do&#40;q/create table mje &#40;a nvarchar&#40;20&#41;&#41;/&#41;;
my $unicode = &#34;\x{e9} é \x{20ac}&#34;;
print $unicode, &#39;, &#39;, utf8::is_utf8&#40;$unicode&#41;, &#39;, &#39;, Dumper&#40;$unicode&#41;;
$h-&gt;do&#40;q/insert into mje values&#40;?&#41;/, undef, $unicode&#41;;
my $s = $h-&gt;prepare&#40;q/select * from mje/&#41;;
$s-&gt;execute;
my $f = $s-&gt;fetchall_arrayref;
my $x = $f-&gt;[0]-&gt;[0];
# utf8::decode&#40;$x&#41;;
print $x, &#39;, &#39;, utf8::is_utf8&#40;$x&#41;, &#39;, &#39;, &#40;map { sprintf&#40;&#39;%02X &#39;, ord&#40;$_&#41;&#41; } 
split &#40;//, $x&#41;&#41;, &#39;, &#39;, Dumper&#40;$f&#41;, &#34;\n&#34;;
exit;

----------------------- This is the output

├⌐ ├⌐ Γé¼, 1, $VAR1 = &#34;\x{e9} \x{e9} \x{20ac}&#34;;
├â┬⌐ ├â┬⌐ ├ó┬é┬¼, , C3 A9 20 C3 A9 20 E2 82 AC , $VAR1 = [
          [
            &#39;├â┬⌐ ├â┬⌐ ├ó┬é┬¼&#39;
          ]
        ];
------------------------

You must forgive the line drawing characters because it was using 
ActiveState Perl on Windows, which cannot print even hardcoded Unicode to 
the console, nor can Strawbery Perl. Only Cygwin Perl seems to display 
Unicode properly &#40;but I cannot get DBD::MySQL to compile with Cygwin&#41;.

The important point to notice is that &#39;1&#39; value, indicating is_utf&#40;&#41;, and 
the hexadecimal representation of é, which is E9 in Unicode, and C3 A9 in 
UTF8. The first Dumper output is correct. 

On the 2nd line, notice is_utf&#40;&#41; does not return a value of &#39;1&#39;, and that 
the hexadecimal value of the string is broken down into a UTF8 byte stream. 
It was not decoded properly. If I use utf8::decode&#40;&#41; on the value returned 
from the database, then it works ok. Without the UTF8 decoding, Perl is 
assuming the multiple bytes C3 A9 which represents é and should be combined 
into Unicode E9 are separate Unicode characters C3 and another character 
A9, which is completely not what was expected. 

Here is additional information

--------------------------

&#40;Terminal is set to UTF8 character set.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">mysql&gt; select a,hex&#40;a&#41; from mje;
</div>+-----------+--------------------+
| a         | hex&#40;a&#41;             |
+-----------+--------------------+
| é é € | C3A920C3A920E282AC |
+-----------+--------------------+

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">mysql&gt; status
</div>--------------
mysql  Ver 14.12 Distrib 5.0.60, for pc-linux-gnu &#40;i686&#41; using readline 5.2

Server version:         5.0.60-log Gentoo Linux mysql-5.0.60-r1
Protocol version:       10
Connection:             Localhost via UNIX socket
Server characterset:    utf8
Db     characterset:    utf8
Client characterset:    utf8
Conn.  characterset:    utf8


List of Unicode characters and their UTF8 hex values
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.utf8-chartable.de/">http://www.utf8-chartable.de/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-956368" href="/Public/Bug/Display.html?id=53130#txn-956368">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;16&nbsp;00:23:11&nbsp;2011</span>
    <span class="description">starrychloe [...] oliveyou.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> starrychloe [...] oliveyou.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/956368/497523/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/497523">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 343b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Additional information:

C:\Users\xxxxxxx\Documents\xxxx-serverscripts&gt;perl -MDBI -e &#34;DBI-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;installed_versions&#34;
</div>  Perl            : 5.010001    &#40;MSWin32-x64-multi-thread&#41;
  OS              : MSWin32     &#40;5.2&#41;
  DBI             : 1.615
  DBD::mysql      : 4.018


Similar but misfiled bug:
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=69362">https://rt.cpan.org/Public/Bug/Display.html?id=69362</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1678062" href="/Public/Bug/Display.html?id=53130#txn-1678062">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;22&nbsp;11:13:42&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Cc PALI added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1678064" href="/Public/Bug/Display.html?id=53130#txn-1678064">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;22&nbsp;11:14:51&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1678064/900566/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/900566">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 195b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fix for UTF-8 support in DBD::mysql is in my pull request: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/perl5-dbi/DBD-mysql/pull/67">https://github.com/perl5-dbi/DBD-mysql/pull/67</a></span>
I would like if more people affected by UTF-8 bugs in DBD::mysql could test my changes...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1699888" href="/Public/Bug/Display.html?id=53130#txn-1699888">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;22&nbsp;11:49:58&nbsp;2017</span>
    <span class="description">MICHIELB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1699890" href="/Public/Bug/Display.html?id=53130#txn-1699890">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;22&nbsp;11:50:09&nbsp;2017</span>
    <span class="description">MICHIELB [...] cpan.org -  Fixed in 4.041_01 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1736376" href="/Public/Bug/Display.html?id=53130#txn-1736376">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;01&nbsp;05:16:53&nbsp;2017</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1736376/933818/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/933818">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 37b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Reopening, fix was reverted in 4.043.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1736379" href="/Public/Bug/Display.html?id=53130#txn-1736379">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;01&nbsp;05:17:04&nbsp;2017</span>
    <span class="description">pali [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1757909" href="/Public/Bug/Display.html?id=53130#txn-1757909">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;15&nbsp;02:47:03&nbsp;2017</span>
    <span class="description">MICHIELB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1757909/945956/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945956">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 78b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ticket migrated to github as <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/perl5-dbi/DBD-mysql/issues/182">https://github.com/perl5-dbi/DBD-mysql/issues/182</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1757912" href="/Public/Bug/Display.html?id=53130#txn-1757912">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;15&nbsp;02:47:06&nbsp;2017</span>
    <span class="description">MICHIELB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.631192</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
