<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #22057 for HTTP-Body: &#40;PATCH&#41; Support for XForms submissions</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #22057 for HTTP-Body: &#40;PATCH&#41; Support for XForms submissions</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=HTTP-Body">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=HTTP-Body">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=HTTP-Body">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=HTTP-Body">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTTP-Body">HTTP-Body CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">22057</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=HTTP-Body">HTTP-Body</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DRUOSO [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-16270-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16271-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




HTTP-Body-0.6-xforms.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/249663/107075/HTTP-Body-0.6-xforms.patch">
Thu Oct 12 11:22:06 2006 (10.4k) by DRUOSO [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=22057">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-249663" href="/Public/Bug/Display.html?id=22057#txn-249663">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;11:22:06&nbsp;2006</span>
    <span class="description">DRUOSO [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#40;PATCH&#41; Support for XForms submissions</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/249663/107072/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/107072">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 595b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

XForms describes two new unique ways of posting. These are identified by
a POST with Content-type: application/xml or a POST with Content-type:
multipart/related; boundary=xxx; start=xxx; where start is the
Content-ID of the XML data.

Attached is a patch that implements the support for this two types of
POST, the patch includes a new test script which test the new
feature. All the tests continue to pass in my environment.

Please consider applying this patch, XForms is starting to become an
option for new web applications in controlled environments.

Thanks in advance,

Daniel Ruoso
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> HTTP-Body-0.6-xforms.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/249663/107075/HTTP-Body-0.6-xforms.patch">Download HTTP-Body-0.6-xforms.patch</a><br />
<span class="downloadcontenttype">text/x-diff 10.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -uNard HTTP-Body-0.6-ori/Changes HTTP-Body-0.6/Changes
--- HTTP-Body-0.6-ori/Changes	2006-01-06 11:40:59.000000000 +0000
+++ HTTP-Body-0.6/Changes	2006-10-12 16:08:30.000000000 +0100
@@ -1,5 +1,8 @@
 This file documents the revision history for Perl extension HTTP::Body.
 
+Patch on 0.6 2006-10-12 16:08:00 WEST
+        - Adding support for XForms submissions, Daniel Ruoso &lt;daniel@ruoso.com&gt;
+
 0.6   2006-01-06 00:00:00
         - Fixed buffer bug in OctetStream, reported by Daisuke Murase &lt;typester@cpan.org&gt;.
         - Fixed YAML prereq, reported by Jess Robinson
diff -uNard HTTP-Body-0.6-ori/lib/HTTP/Body/MultiPart.pm HTTP-Body-0.6/lib/HTTP/Body/MultiPart.pm
--- HTTP-Body-0.6-ori/lib/HTTP/Body/MultiPart.pm	2005-11-17 12:59:02.000000000 +0000
+++ HTTP-Body-0.6/lib/HTTP/Body/MultiPart.pm	2006-10-12 15:26:04.000000000 +0100
@@ -270,17 +270,12 @@
 
         $part-&gt;{name}     = $name;
         $part-&gt;{filename} = $filename;
-
-        if &#40;$filename&#41; {
-
-            my $fh = File::Temp-&gt;new&#40; UNLINK =&gt; 0 &#41;;
-
-            $part-&gt;{fh}       = $fh;
-            $part-&gt;{tempname} = $fh-&gt;filename;
-        }
     }
 
     if &#40; $part-&gt;{filename} &#38;&#38; &#40; my $length = length&#40; $part-&gt;{data} &#41; &#41; &#41; {
+        my $fh = File::Temp-&gt;new&#40; UNLINK =&gt; 0 &#41;;
+        $part-&gt;{fh}       = $fh;
+        $part-&gt;{tempname} = $fh-&gt;filename;
         $part-&gt;{fh}-&gt;write&#40; substr&#40; $part-&gt;{data}, 0, $length, &#39;&#39; &#41;, $length &#41;;
     }
 
diff -uNard HTTP-Body-0.6-ori/lib/HTTP/Body/XFormsMultipart.pm HTTP-Body-0.6/lib/HTTP/Body/XFormsMultipart.pm
--- HTTP-Body-0.6-ori/lib/HTTP/Body/XFormsMultipart.pm	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/lib/HTTP/Body/XFormsMultipart.pm	2006-10-12 16:10:39.000000000 +0100
@@ -0,0 +1,96 @@
+package HTTP::Body::XFormsMultipart;
+
+use strict;
+use base &#39;HTTP::Body::MultiPart&#39;;
+use bytes;
+
+use IO::File;
+use File::Temp 0.14;
+
+=head1 NAME
+
+HTTP::Body::XFormsMultipart - HTTP Body XForms multipart/related submission Parser
+
+=head1 SYNOPSIS
+
+    use HTTP::Body::XForms;
+
+=head1 DESCRIPTION
+
+HTTP Body XForms submission Parser. Inherits HTTP::Body::MultiPart.
+
+This body type is used to parse XForms submission. In this case, the
+XML part that contains the model is indicated by the start attribute
+in the content-type. The XML content is stored unparsed on the
+parameter XForms:Model.
+
+=head1 METHODS
+
+=over 4
+
+=item init
+
+This function is overrided to detect the start part of the
+multipart/related post.
+
+=cut
+
+sub init {
+    my $self = shift;
+    $self-&gt;SUPER::init&#40;@_&#41;;
+    unless &#40; $self-&gt;content_type =~ /start=\&#34;?\&lt;?&#40;[^\&#34;\&gt;;,]+&#41;\&gt;?\&#34;?/ &#41; {
+        my $content_type = $self-&gt;content_type;
+        Carp::croak&#40;&#34;Invalid boundary in content_type: &#39;$content_type&#39;&#34;&#41;;
+    }
+    $self-&gt;{start} = $1;
+
+    return $self;
+}
+
+=item start
+
+Defines the start part of the multipart/related body.
+
+=cut
+
+sub start {
+    return shift-&gt;{start};
+}
+
+=item handler
+
+This function is overrided to differ the start part, which should be
+set as the XForms:Model param if its content type is application/xml.
+
+=cut
+
+sub handler {
+    my &#40;$self,$part&#41; = @_;
+
+    my $contentid = $part-&gt;{headers}{&#39;Content-ID&#39;};
+    $contentid =~ s/^.*[\&lt;\&#34;]//;
+    $contentid =~ s/[\&gt;\&#34;].*$//;
+    if &#40;$contentid eq $self-&gt;start&#41; {
+            $part-&gt;{name} = &#39;XForms:Model&#39;;
+    } elsif &#40;defined $contentid&#41; {
+            $part-&gt;{name} = $contentid;
+            $part-&gt;{filename} = $contentid;
+    }
+
+    return $self-&gt;SUPER::handler&#40;$part&#41;;
+}
+
+=back
+
+=head1 AUTHOR
+
+Daniel Ruoso C&lt;daniel@ruoso.com&gt;
+
+=head1 LICENSE
+
+This library is free software . You can redistribute it and/or modify 
+it under the same terms as perl itself.
+
+=cut
+
+1;
diff -uNard HTTP-Body-0.6-ori/lib/HTTP/Body/XForms.pm HTTP-Body-0.6/lib/HTTP/Body/XForms.pm
--- HTTP-Body-0.6-ori/lib/HTTP/Body/XForms.pm	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/lib/HTTP/Body/XForms.pm	2006-10-12 16:08:43.000000000 +0100
@@ -0,0 +1,56 @@
+package HTTP::Body::XForms;
+
+use strict;
+use base &#39;HTTP::Body&#39;;
+use bytes;
+
+use File::Temp 0.14;
+
+=head1 NAME
+
+HTTP::Body::XForms - HTTP Body XForms Parser
+
+=head1 SYNOPSIS
+
+    use HTTP::Body::XForms;
+
+=head1 DESCRIPTION
+
+HTTP Body XForms Parser. This module parses single part XForms
+submissions, which are identifiable by the content-type
+application/xml. The XML is stored unparsed on the parameter
+XForms:Model.
+
+=head1 METHODS
+
+=over 4
+
+=item spin
+
+This method is overwrited to set the param XForms:Model with
+the buffer content.
+
+=cut
+
+sub spin {
+    my $self = shift;
+    $self-&gt;param&#40;&#39;XForms:Model&#39;,$self-&gt;{buffer}&#41;;
+    $self-&gt;{buffer} = &#39;&#39;;
+    $self-&gt;{state} = &#39;done&#39;;
+    return $self-&gt;SUPER::init&#40;&#41;;
+}
+
+=back
+
+=head1 AUTHOR
+
+Daniel Ruoso, C&lt;daniel@ruoso.com&gt;
+
+=head1 LICENSE
+
+This library is free software . You can redistribute it and/or modify 
+it under the same terms as perl itself.
+
+=cut
+
+1;
diff -uNard HTTP-Body-0.6-ori/lib/HTTP/Body.pm HTTP-Body-0.6/lib/HTTP/Body.pm
--- HTTP-Body-0.6-ori/lib/HTTP/Body.pm	2005-11-22 23:15:16.000000000 +0000
+++ HTTP-Body-0.6/lib/HTTP/Body.pm	2006-10-12 16:13:20.000000000 +0100
@@ -9,12 +9,16 @@
 our $TYPES = {
     &#39;application/octet-stream&#39;          =&gt; &#39;HTTP::Body::OctetStream&#39;,
     &#39;application/x-www-form-urlencoded&#39; =&gt; &#39;HTTP::Body::UrlEncoded&#39;,
-    &#39;multipart/form-data&#39;               =&gt; &#39;HTTP::Body::MultiPart&#39;
+    &#39;multipart/form-data&#39;               =&gt; &#39;HTTP::Body::MultiPart&#39;,
+    &#39;multipart/related&#39;                 =&gt; &#39;HTTP::Body::XFormsMultipart&#39;,
+    &#39;application/xml&#39;                   =&gt; &#39;HTTP::Body::XForms&#39;
 };
 
 require HTTP::Body::OctetStream;
 require HTTP::Body::UrlEncoded;
 require HTTP::Body::MultiPart;
+require HTTP::Body::XFormsMultipart;
+require HTTP::Body::XForms;
 
 =head1 NAME
 
diff -uNard HTTP-Body-0.6-ori/t/07xforms.t HTTP-Body-0.6/t/07xforms.t
--- HTTP-Body-0.6-ori/t/07xforms.t	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/t/07xforms.t	2006-10-12 16:05:30.000000000 +0100
@@ -0,0 +1,49 @@
+#!perl
+
+use strict;
+use warnings;
+
+use Test::More tests =&gt; 12;
+
+use Cwd;
+use HTTP::Body;
+use File::Spec::Functions;
+use IO::File;
+use YAML;
+
+my $path = catdir&#40; getcwd&#40;&#41;, &#39;t&#39;, &#39;data&#39;, &#39;xforms&#39; &#41;;
+
+for &#40; my $i = 1; $i &lt;= 2; $i++ &#41; {
+
+    my $test    = sprintf&#40; &#34;%.3d&#34;, $i &#41;;
+    my $headers = YAML::LoadFile&#40; catfile&#40; $path, &#34;$test-headers.yml&#34; &#41; &#41;;
+    my $results = YAML::LoadFile&#40; catfile&#40; $path, &#34;$test-results.yml&#34; &#41; &#41;;
+    my $content = IO::File-&gt;new&#40; catfile&#40; $path, &#34;$test-content.dat&#34; &#41; &#41;;
+    my $body    = HTTP::Body-&gt;new&#40; $headers-&gt;{&#39;Content-Type&#39;}, $headers-&gt;{&#39;Content-Length&#39;} &#41;;
+
+    binmode $content, &#39;:raw&#39;;
+
+    while &#40; $content-&gt;read&#40; my $buffer, 1024 &#41; &#41; {
+        $body-&gt;add&#40;$buffer&#41;;
+    }
+    
+    for my $field &#40; keys %{ $body-&gt;upload } &#41; {
+
+        my $value = $body-&gt;upload-&gt;{$field};
+
+        for &#40; &#40; ref&#40;$value&#41; eq &#39;ARRAY&#39; &#41; ? @{$value} : $value &#41; {
+            delete $_-&gt;{tempname};
+        }
+    }
+
+    is_deeply&#40; $body-&gt;body, $results-&gt;{body}, &#34;$test XForms body&#34; &#41;;
+    is_deeply&#40; $body-&gt;param, $results-&gt;{param}, &#34;$test XForms param&#34; &#41;;
+    is_deeply&#40; $body-&gt;upload, $results-&gt;{upload}, &#34;$test XForms upload&#34; &#41;;
+    if &#40;$body-&gt;isa&#40;&#39;HTTP::Body::XFormsMultipart&#39;&#41;&#41; {
+            cmp_ok&#40; $body-&gt;start, &#39;eq&#39;, $results-&gt;{start}, &#34;$test XForms start&#34; &#41;;
+    } else {
+            ok&#40;1,&#34;$test XForms start&#34;&#41;;
+    }
+    cmp_ok&#40; $body-&gt;state, &#39;eq&#39;, &#39;done&#39;, &#34;$test XForms state&#34; &#41;;
+    cmp_ok&#40; $body-&gt;length, &#39;==&#39;, $headers-&gt;{&#39;Content-Length&#39;}, &#34;$test XForms length&#34; &#41;;
+}
diff -uNard HTTP-Body-0.6-ori/t/data/xforms/001-content.dat HTTP-Body-0.6/t/data/xforms/001-content.dat
--- HTTP-Body-0.6-ori/t/data/xforms/001-content.dat	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/t/data/xforms/001-content.dat	2006-10-12 16:04:53.000000000 +0100
@@ -0,0 +1,13 @@
+------------0xKhTmLbOuNdArY
+Content-ID: &lt;asdfg@asdfg.com&gt;
+
+&lt;model&gt;&lt;data1&gt;asdfg&lt;/data1&gt;&lt;data2&gt;asdfg&lt;/data2&gt;&lt;/model&gt;
+------------0xKhTmLbOuNdArY
+Content-ID: &lt;qwert@qwerty.com&gt;
+
+Attachment file 1
+------------0xKhTmLbOuNdArY
+Content-ID: &lt;zxcvb@zxcvb.com&gt;
+
+Attachment file 2
+------------0xKhTmLbOuNdArY--
diff -uNard HTTP-Body-0.6-ori/t/data/xforms/001-headers.yml HTTP-Body-0.6/t/data/xforms/001-headers.yml
--- HTTP-Body-0.6-ori/t/data/xforms/001-headers.yml	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/t/data/xforms/001-headers.yml	2006-10-12 16:04:59.000000000 +0100
@@ -0,0 +1,4 @@
+---
+Content-Length: 313
+Content-Type: multipart/related; boundary=----------0xKhTmLbOuNdArY; start=&lt;asdfg@asdfg.com&gt;
+User-Agent: &#39;Mozilla/5.0 &#40;Macintosh; U; PPC Mac OS X; en&#41; AppleWebKit/312.1 &#40;KHTML, like Gecko&#41; Safari/312&#39;
diff -uNard HTTP-Body-0.6-ori/t/data/xforms/001-results.yml HTTP-Body-0.6/t/data/xforms/001-results.yml
--- HTTP-Body-0.6-ori/t/data/xforms/001-results.yml	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/t/data/xforms/001-results.yml	2006-10-12 15:28:02.000000000 +0100
@@ -0,0 +1,18 @@
+---
+body: ~
+start: asdfg@asdfg.com
+param:
+  XForms:Model: &lt;model&gt;&lt;data1&gt;asdfg&lt;/data1&gt;&lt;data2&gt;asdfg&lt;/data2&gt;&lt;/model&gt;
+upload:
+  qwert@qwerty.com:
+    filename: qwert@qwerty.com
+    headers:
+      Content-ID: &lt;qwert@qwerty.com&gt;
+    name: qwert@qwerty.com
+    size: 17
+  zxcvb@zxcvb.com:
+    filename: zxcvb@zxcvb.com
+    headers:
+      Content-ID: &lt;zxcvb@zxcvb.com&gt;
+    name: zxcvb@zxcvb.com
+    size: 17
diff -uNard HTTP-Body-0.6-ori/t/data/xforms/002-content.dat HTTP-Body-0.6/t/data/xforms/002-content.dat
--- HTTP-Body-0.6-ori/t/data/xforms/002-content.dat	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/t/data/xforms/002-content.dat	2006-10-12 15:50:53.000000000 +0100
@@ -0,0 +1 @@
+&lt;model&gt;&lt;data1&gt;asdfg&lt;/data1&gt;&lt;data2&gt;asdfg&lt;/data2&gt;&lt;/model&gt;
\ NÃ£o hÃ¡ quebra de linha no final do arquivo
diff -uNard HTTP-Body-0.6-ori/t/data/xforms/002-headers.yml HTTP-Body-0.6/t/data/xforms/002-headers.yml
--- HTTP-Body-0.6-ori/t/data/xforms/002-headers.yml	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/t/data/xforms/002-headers.yml	2006-10-12 15:57:37.000000000 +0100
@@ -0,0 +1,4 @@
+---
+Content-Length: 55
+Content-Type: application/xml
+User-Agent: &#39;Mozilla/5.0 &#40;Macintosh; U; PPC Mac OS X; en&#41; AppleWebKit/312.1 &#40;KHTML, like Gecko&#41; Safari/312&#39;
diff -uNard HTTP-Body-0.6-ori/t/data/xforms/002-results.yml HTTP-Body-0.6/t/data/xforms/002-results.yml
--- HTTP-Body-0.6-ori/t/data/xforms/002-results.yml	1970-01-01 01:00:00.000000000 +0100
+++ HTTP-Body-0.6/t/data/xforms/002-results.yml	2006-10-12 16:03:22.000000000 +0100
@@ -0,0 +1,5 @@
+---
+body: ~
+param:
+  XForms:Model: &lt;model&gt;&lt;data1&gt;asdfg&lt;/data1&gt;&lt;data2&gt;asdfg&lt;/data2&gt;&lt;/model&gt;
+upload: {}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-426008" href="/Public/Bug/Display.html?id=22057#txn-426008">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;10:36:11&nbsp;2008</span>
    <span class="description">AGRUNDMA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/426008/208374/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208374">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 192b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry to let this sit out here so long.  Is your patch still compatible
with the latest XForms spec?  Also, do any browsers natively support
XForms yet?  I&#39;m wondering how useful this will be.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-426009" href="/Public/Bug/Display.html?id=22057#txn-426009">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;10:36:15&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-426012" href="/Public/Bug/Display.html?id=22057#txn-426012">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;10:56:25&nbsp;2008</span>
    <span class="description">AGRUNDMA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/426012/208377/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208377">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 110b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ah nevermind, I&#39;ve applied the patch for 1.00, as it&#39;s self-contained
and it won&#39;t possibly break anything. :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-426015" href="/Public/Bug/Display.html?id=22057#txn-426015">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;10:56:29&nbsp;2008</span>
    <span class="description">AGRUNDMA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.381898</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
