<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #51445 for Config-IniFiles: 2.52 CRLF-ini with multi-value params fails under Linux</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #51445 for Config-IniFiles: 2.52 CRLF-ini with multi-value params fails under Linux</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Config-IniFiles/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Config-IniFiles/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Config-IniFiles/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Config-IniFiles/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Config-IniFiles">Config-IniFiles CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">51445</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Config-IniFiles/Active/">Config-IniFiles</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SHE [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-7712-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-7713-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;11&nbsp;10:00:33&nbsp;2009</span>
    <span class="description">SHE [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 2.52 CRLF-ini with multi-value params fails under Linux</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This ini file

1:# This ini-file has DOS-style line endings &#40;CRLF&#41;
2:[app_params]
3:pathes = &lt;&lt;EOTP
4:path1
5:path2
6:EOTP
7:

read by the script below
works on windows:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;initest.pl
</div>Created
pathes:
path1
path2

fails on Linux:
# ./initest.pl
Can&#39;t use an undefined value as a symbol reference at
/usr/lib/perl5/site_perl/5.8.8/Config/IniFiles.pm line 682, &lt;GEN0&gt; line 56.

After changing the ini to UNIX line feeds it is working on both systems.
The idea however, is that the same configurations should be
interchangeable between platforms. And in our case should be editable by
layouters with little understanding of the backgrounds.

Same test script on both systems:
#!/usr/bin/perl 
use strict;
use warnings;
use Config::IniFiles;

my $defaultcfg = new Config::IniFiles -file =&gt; &#39;./initest.ini&#39;
  or die &#34;Error reading from &#39;./initest.ini&#39;: $!&#34;;

print &#34;Created\n&#34;;

if &#40;$defaultcfg-&gt;exists&#40;&#39;app_params&#39;, &#39;pathes&#39;&#41;&#41; {
  my @pathes = $defaultcfg-&gt;val&#40;&#39;app_params&#39;, &#39;pathes&#39;&#41;;
  print &#34;pathes:\n&#34;, join&#40;&#34;\n&#34;, @pathes&#41;, &#34;\n&#34;;
}

exit 0;

Trying to figure it out myself, I found that in sub ReadConfig on Linux
and inside the loop on &#34;here&#34; values the \x0a part is being left over by
the generic line separator:

$self-&gt;{line_ends}=&#39;\x0d&#39;
$eotmark=&#39;EOTP&#39;
$_=&#39;
path1&#39;=\x0a\x70\x61\x74\x68\x31
$_=&#39;
path2&#39;=\x0a\x70\x61\x74\x68\x32
$_=&#39;
EOTP&#39;=\x0a\x45\x4f\x54\x50
$_=&#39;&#39;=
$foundeot=&#39;0&#39;

Unfortunately I have no idea how this can be solved in an easy way. &#40;And
without possibly corrupting unicode input.&#41;

Thank you,
Steffen Heinrich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;11&nbsp;14:46:44&nbsp;2009</span>
    <span class="description">SHE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> cause and possible patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After some more delving I come to think that it is not possible to
determine a separator consisting of 2 bytes in the intended way, by just
reading in 1 byte at a time.
The reason why this never became obvious is that on windows the \x0d
&#40;CR&#41; characters are stripped from a file unless it gets opened in binmode.
&#40;This of course, would cripple any utf encoding.&#41;
So, \x0a is the proper line separator there.

And on Unix systems it is rarely causing problems because the remaining
\x0a &#40;after the separator has been set to \x0d&#41; is attached to the
beginning of next line, usually a param name, which will get trimmed
before further processing.

Only in &#39;here&#39; syntax, when multiple values are defined, the end label
cannot be found.

I suggest the following patch to sub _nextline:

OUT:

656             do {
657                     local $/=\1; my $nextchar=&lt;$fh&gt;;
658                     return undef if &#40;!defined $nextchar&#41;;
659                     $_ .= $nextchar;
660             } until &#40;m/&#40;\015\012?|\012|\025|\n&#41;$/s&#41;;
661             $self-&gt;{line_ends}=$1;

Replace with
IN:
        {
          local $/=\1;
          my $nextchar;
          do {
              $nextchar=&lt;$fh&gt;;
              return undef if &#40;!defined $nextchar&#41;;
              $_ .= $nextchar;
          } until &#40;m/&#40;&#40;\015|\012|\025|\n&#41;$&#41;/s&#41;;

          $self-&gt;{line_ends}=$1;

          if &#40;$nextchar eq &#34;\x0d&#34;&#41; {
            # peek at the next char
            $nextchar = &lt;$fh&gt;;
            if &#40;$nextchar eq &#34;\x0a&#34;&#41; {
              $self-&gt;{line_ends} .= &#34;\x0a&#34;;
            } else {
              seek $fh, -1, 1;
            }
          }
        }

Regards, Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;11&nbsp;14:46:45&nbsp;2009</span>
    <span class="description">SHE [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;12&nbsp;03:02:08&nbsp;2009</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Steffen!

If possible, please write a test case, and submit a unified diff patch
against:

<span class="clickylink"><a target="new" rel="nofollow" href="https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/">https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/</a></span>

&#40;Use &#34;svn diff&#34;&#41;.

This will help me apply it.

Regards,

-- Shlomi Fish

On Wed Nov 11 14:46:44 2009, SHE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; After some more delving I come to think that it is not possible to
&gt; determine a separator consisting of 2 bytes in the intended way, by just
&gt; reading in 1 byte at a time.
&gt; The reason why this never became obvious is that on windows the \x0d
&gt; &#40;CR&#41; characters are stripped from a file unless it gets opened in binmode.
&gt; &#40;This of course, would cripple any utf encoding.&#41;
&gt; So, \x0a is the proper line separator there.
&gt; 
&gt; And on Unix systems it is rarely causing problems because the remaining
&gt; \x0a &#40;after the separator has been set to \x0d&#41; is attached to the
&gt; beginning of next line, usually a param name, which will get trimmed
&gt; before further processing.
&gt; 
&gt; Only in &#39;here&#39; syntax, when multiple values are defined, the end label
&gt; cannot be found.
&gt; 
&gt; I suggest the following patch to sub _nextline:
&gt; 
&gt; OUT:
&gt; 
&gt; 656           do {
&gt; 657                   local $/=\1; my $nextchar=&lt;$fh&gt;;
&gt; 658                   return undef if &#40;!defined $nextchar&#41;;
&gt; 659                   $_ .= $nextchar;
&gt; 660           } until &#40;m/&#40;\015\012?|\012|\025|\n&#41;$/s&#41;;
&gt; 661           $self-&gt;{line_ends}=$1;
&gt; 
&gt; Replace with
&gt; IN:
&gt;         {
&gt;           local $/=\1;
&gt;           my $nextchar;
&gt;           do {
&gt;               $nextchar=&lt;$fh&gt;;
&gt;               return undef if &#40;!defined $nextchar&#41;;
&gt;               $_ .= $nextchar;
&gt;           } until &#40;m/&#40;&#40;\015|\012|\025|\n&#41;$&#41;/s&#41;;
&gt; 
&gt;           $self-&gt;{line_ends}=$1;
&gt; 
&gt;           if &#40;$nextchar eq &#34;\x0d&#34;&#41; {
&gt;             # peek at the next char
&gt;             $nextchar = &lt;$fh&gt;;
&gt;             if &#40;$nextchar eq &#34;\x0a&#34;&#41; {
&gt;               $self-&gt;{line_ends} .= &#34;\x0a&#34;;
&gt;             } else {
&gt;               seek $fh, -1, 1;
&gt;             }
&gt;           }
&gt;         }
&gt; 
&gt; Regards, Steffen
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;12&nbsp;11:53:21&nbsp;2009</span>
    <span class="description">SHE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Do. 12. Nov. 2009, 03:02:08, SHLOMIF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Steffen!
&gt; 
&gt; If possible, please write a test case, and submit a unified diff patch
&gt; against:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/">https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/</a></span>
&gt; 
&gt; &#40;Use &#34;svn diff&#34;&#41;.
&gt; 
&gt; This will help me apply it.
&gt; 
&gt; Regards,
&gt; 
&gt; -- Shlomi Fish
&gt; 
</div>Hello Shlomi!

the diff is attached.
But since I&#39;ve never done that test case stuff before it might take some
time I&#39;m afraid - shame on me.
 :-&#40;

Could you maybe provide a helpful link to get me started?
It would be much appreciated.

Thanks,
Steffen
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: trunk/config-inifiles/lib/Config/IniFiles.pm
===================================================================
--- trunk/config-inifiles/lib/Config/IniFiles.pm	&#40;Revision 146&#41;
+++ trunk/config-inifiles/lib/Config/IniFiles.pm	&#40;Arbeitskopie&#41;
@@ -653,12 +653,25 @@
 	if &#40;!exists $self-&gt;{line_ends}&#41; {
 		# no $self-&gt;{line_ends} is a hint set by caller that we are at
 		# the first line &#40;kludge kludge&#41;.
-		do {
-			local $/=\1; my $nextchar=&lt;$fh&gt;;
-			return undef if &#40;!defined $nextchar&#41;;
-			$_ .= $nextchar;
-		} until &#40;m/&#40;\015\012?|\012|\025|\n&#41;$/s&#41;;
-		$self-&gt;{line_ends}=$1;
+		{
+			local $/=\1;
+			my $nextchar;
+			do {
+				$nextchar=&lt;$fh&gt;;
+				return undef if &#40;!defined $nextchar&#41;;
+				$_ .= $nextchar;
+			} until &#40;m/&#40;&#40;\015|\012|\025|\n&#41;$&#41;/s&#41;;
+			$self-&gt;{line_ends}=$1;
+			if &#40;$nextchar eq &#34;\x0d&#34;&#41; {
+				# peek at the next char
+				$nextchar = &lt;$fh&gt;;
+				if &#40;$nextchar eq &#34;\x0a&#34;&#41; {
+					$self-&gt;{line_ends} .= &#34;\x0a&#34;;
+				} else {
+					seek $fh, -1, 1;
+				}
+			}
+		}
 
 		# If there&#39;s a UTF BOM &#40;Byte-Order-Mark&#41; in the first
 		# character of the first line then remove it before processing
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;12&nbsp;14:09:55&nbsp;2009</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Nov 12 11:53:21 2009, SHE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Do. 12. Nov. 2009, 03:02:08, SHLOMIF wrote:
<div class="message-stanza open">&gt; &gt; Hi Steffen!
&gt; &gt; 
&gt; &gt; If possible, please write a test case, and submit a unified diff patch
&gt; &gt; against:
&gt; &gt; 
&gt; &gt;
</div></div><span class="clickylink"><a target="new" rel="nofollow" href="https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/">https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; &#40;Use &#34;svn diff&#34;&#41;.
&gt; &gt; 
&gt; &gt; This will help me apply it.
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt; 
&gt; &gt; -- Shlomi Fish
&gt; &gt; 
</div>&gt; Hello Shlomi!
&gt; 
&gt; the diff is attached.
&gt; But since I&#39;ve never done that test case stuff before it might take some
&gt; time I&#39;m afraid - shame on me.
&gt;  :-&#40;
&gt; 
&gt; Could you maybe provide a helpful link to get me started?
&gt; It would be much appreciated.
&gt; 
</div>
Hi Steffen!

I guess you should read Test-Tutorial &#40;though I&#39;m not sure if I have
ever read it, but it has a good repuation&#41;:

<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod">http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod</a></span>

And touting my own horn, I&#39;d like to note this:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.shlomifish.org/lecture/Perl/Newbies/lecture5/">http://www.shlomifish.org/lecture/Perl/Newbies/lecture5/</a></span>

The automated tests part is at the start. Are you familiar with &#34;./Build
test&#34;? Make sure it passes all tests &#40;including the new ones&#41; after the
patch.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;12&nbsp;18:53:47&nbsp;2009</span>
    <span class="description">SHE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Do. 12. Nov. 2009, 14:09:55, SHLOMIF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Nov 12 11:53:21 2009, SHE wrote:
<div class="message-stanza open">&gt; &gt; On Do. 12. Nov. 2009, 03:02:08, SHLOMIF wrote:
<div class="message-stanza open">&gt; &gt; &gt; Hi Steffen!
&gt; &gt; &gt; 
&gt; &gt; &gt; If possible, please write a test case, and submit a unified diff patch
&gt; &gt; &gt; against:
&gt; &gt; &gt; 
&gt; &gt; &gt;
</div></div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/">https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/</a></span>
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; &#40;Use &#34;svn diff&#34;&#41;.
&gt; &gt; &gt; 
&gt; &gt; &gt; This will help me apply it.
&gt; &gt; &gt; 
&gt; &gt; &gt; Regards,
&gt; &gt; &gt; 
&gt; &gt; &gt; -- Shlomi Fish
&gt; &gt; &gt; 
</div>&gt; &gt; Hello Shlomi!
&gt; &gt; 
&gt; &gt; the diff is attached.
&gt; &gt; But since I&#39;ve never done that test case stuff before it might take some
&gt; &gt; time I&#39;m afraid - shame on me.
&gt; &gt;  :-&#40;
&gt; &gt; 
&gt; &gt; Could you maybe provide a helpful link to get me started?
&gt; &gt; It would be much appreciated.
&gt; &gt; 
</div>&gt; 
&gt; Hi Steffen!
&gt; 
&gt; I guess you should read Test-Tutorial &#40;though I&#39;m not sure if I have
&gt; ever read it, but it has a good repuation&#41;:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod">http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod</a></span>
&gt; 
&gt; And touting my own horn, I&#39;d like to note this:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.shlomifish.org/lecture/Perl/Newbies/lecture5/">http://www.shlomifish.org/lecture/Perl/Newbies/lecture5/</a></span>
&gt; 
&gt; The automated tests part is at the start. Are you familiar with &#34;./Build
&gt; test&#34;? Make sure it passes all tests &#40;including the new ones&#41; after the
&gt; patch.
&gt; 
&gt; Regards,
&gt; 
&gt; -- Shlomi Fish
</div>
Hi Shlomi,

here is it, my first test case ever.

No sorry, I am not familiar with ./Build test and don&#39;t know how to
invoke it.
But a normal make test went equally well on windows and linux &#40;and
failed on linux with the unpatched version&#41;.

Thank you for your help,
Steffen

&#40;I very much enjoy your web site. Will take a closer look occasionally.&#41;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

# This script attempts to reproduce:
# <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=51445">http://rt.cpan.org/Public/Bug/Display.html?id=51445</a></span>
#
# #51445: 2.52 CRLF-ini with multi-value params fails under Linux

use Test::More tests =&gt; 20;

use strict;
use warnings;

use Config::IniFiles;

{

    # being pedantic, we don&#39;t take line breaks from this or an external file for granted
    my $sample_ini = 
    &#34;&lt;eol&gt;
    &lt;sol&gt;# this is a sample file for testing the proper detection of line endings in Config::Inifiles&lt;eol&gt;
    &lt;sol&gt;&lt;eol&gt;
    &lt;sol&gt;[single values]&lt;eol&gt;
    &lt;sol&gt;firstval = first value&lt;eol&gt;
    &lt;sol&gt;secondval=2nd&lt;eol&gt;
    &lt;sol&gt;&lt;eol&gt;
    &lt;sol&gt;# in v2.52 on linux multi values with crlf lines are failing&lt;eol&gt;
    &lt;sol&gt;[multi value]&lt;eol&gt;
    &lt;sol&gt;Pathes=&lt;&lt;EOT&lt;eol&gt;
    &lt;sol&gt;path1&lt;eol&gt;
    &lt;sol&gt;path2&lt;eol&gt;
    &lt;sol&gt;EOT&lt;eol&gt;
    &lt;sol&gt;&lt;eol&gt;
    &lt;sol&gt;&#34;;

    chdir&#40;&#39;t&#39;&#41; if &#40; -d &#39;t&#39; &#41;;

    foreach my $lf &#40;&#40;&#34;\x0d\x0a&#34;, &#34;\x0d&#34;, &#34;\x0a&#34;, &#34;\x15&#34;, &#34;\n&#34;&#41;&#41; {
        my $ini = $sample_ini;
        $ini =~ s/&lt;eol&gt;[^&lt;]*&lt;sol&gt;/$lf/g;

        open my $INI, &#39;&gt;:raw&#39;, &#39;test25.ini&#39; or die $!;
        print $INI $ini;
        close $INI;

        my $lf_print = join&#40;&#39;&#39;, map {sprintf &#39;\x%0.2x&#39;, ord $_} split&#40;//, $lf&#41;&#41;;

        my $cfg = Config::IniFiles-&gt;new&#40;-file =&gt; &#39;test25.ini&#39;&#41;;

        # TEST
        ok&#40;$cfg, &#34;Loading from a &#39;$lf_print&#39;-separated file&#34;&#41;;
        
        # TEST
        my $value = $cfg-&gt;val&#40;&#39;single values&#39;, &#39;firstval&#39;&#41;;
        is &#40;
            $value, &#39;first value&#39;,
            &#34;Reading a single value from a &#39;$lf_print&#39;-separated file&#34;
        &#41;;

        # TEST
        $value = $cfg-&gt;val&#40;&#39;single values&#39;, &#39;secondval&#39;&#41;;
        is &#40;
            $value, &#39;2nd&#39;,
            &#34;Reading a single value from a &#39;$lf_print&#39;-separated file&#34;
        &#41;;

        my @vals = $cfg-&gt;val&#40;&#34;multi value&#34;, &#34;Pathes&#34;&#41;;

        # TEST
        is_deeply&#40;
            \@vals,
            [&#39;path1&#39;, &#39;path2&#39;],
            &#34;Reading a multiple value from a &#39;$lf_print&#39;-separated file&#34;,
        &#41;;

    }
}

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;05:04:13&nbsp;2009</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Nov 12 18:53:47 2009, SHE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Do. 12. Nov. 2009, 14:09:55, SHLOMIF wrote:
<div class="message-stanza open">&gt; &gt; On Thu Nov 12 11:53:21 2009, SHE wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Do. 12. Nov. 2009, 03:02:08, SHLOMIF wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Hi Steffen!
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; If possible, please write a test case, and submit a unified diff
</div></div></div></div>patch
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; against:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt;
</div>&gt; &gt;
</div></div><span class="clickylink"><a target="new" rel="nofollow" href="https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/">https://config-inifiles.svn.sourceforge.net/svnroot/config-inifiles/trunk/</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &#40;Use &#34;svn diff&#34;&#41;.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; This will help me apply it.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Regards,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; -- Shlomi Fish
&gt; &gt; &gt; &gt; 
</div>&gt; &gt; &gt; Hello Shlomi!
&gt; &gt; &gt; 
&gt; &gt; &gt; the diff is attached.
&gt; &gt; &gt; But since I&#39;ve never done that test case stuff before it might
</div></div>take some
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; time I&#39;m afraid - shame on me.
&gt; &gt; &gt;  :-&#40;
&gt; &gt; &gt; 
&gt; &gt; &gt; Could you maybe provide a helpful link to get me started?
&gt; &gt; &gt; It would be much appreciated.
&gt; &gt; &gt; 
</div>&gt; &gt; 
&gt; &gt; Hi Steffen!
&gt; &gt; 
&gt; &gt; I guess you should read Test-Tutorial &#40;though I&#39;m not sure if I have
&gt; &gt; ever read it, but it has a good repuation&#41;:
&gt; &gt; 
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod">http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod</a></span>
&gt; &gt; 
&gt; &gt; And touting my own horn, I&#39;d like to note this:
&gt; &gt; 
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.shlomifish.org/lecture/Perl/Newbies/lecture5/">http://www.shlomifish.org/lecture/Perl/Newbies/lecture5/</a></span>
&gt; &gt; 
&gt; &gt; The automated tests part is at the start. Are you familiar with &#34;./Build
&gt; &gt; test&#34;? Make sure it passes all tests &#40;including the new ones&#41; after the
&gt; &gt; patch.
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt; 
&gt; &gt; -- Shlomi Fish
</div>&gt; 
&gt; Hi Shlomi,
&gt; 
&gt; here is it, my first test case ever.
&gt; 
</div>
Great, I applied it along with your patch &#40;I had to apply the patch
semi-manually, possibly due to CRLF/LF problems&#41; and modified the test
case a bit to avoid chdir&#39;ing into t/ and to delete the file after use.

Many thanks!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No sorry, I am not familiar with ./Build test and don&#39;t know how to
&gt; invoke it.
</div>
perl Build.PL ; ./Build ; ./Build test is the Module-Build alternative
to ExtUtils-MakeMaker&#39;s &#34;perl Makefile.PL ; make ; make test&#34;. But EU-MM
will also work here by virtue of Module::Build::Compat.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But a normal make test went equally well on windows and linux &#40;and
&gt; failed on linux with the unpatched version&#41;.
&gt; 
</div>
Yes, I saw that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you for your help,
</div>
You&#39;re welcome.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Steffen
&gt; 
&gt; &#40;I very much enjoy your web site. Will take a closer look occasionally.&#41;
</div>
I&#39;m glad you do and thanks.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;25&nbsp;07:25:08&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 2.53. Closing as resolved. Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;25&nbsp;07:25:12&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
