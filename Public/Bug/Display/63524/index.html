<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63524 for Mail-IMAPClient: fetch_hash&#40;&#41; parse error</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63524 for Mail-IMAPClient: fetch_hash&#40;&#41; parse error</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-IMAPClient">Mail-IMAPClient CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63524</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Mail-IMAPClient/Active/">Mail-IMAPClient</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">PLOBBES [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bpkroth [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19960-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19961-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
3.26    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;23:33:54&nbsp;2010</span>
    <span class="description">bpkroth [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fetch_hash&#40;&#41; parse error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Dec 2010 22:33:20 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brian Kroth &lt;bpkroth [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There&#39;s actually two issues here.

1&#41; fetch_hash&#40;&#41; seems to fail parsing ENVELOPE field values that have
certain quote characters in them.

2&#41; fetch_hash&#40;&#41; doesn&#39;t return X-SAVEDATE fields as requested.

Attached is the debug output.
Versions involved are as follows:
libmail-imapclient-perl 3.25-1
perl 5.10.1-16
Debian Squeeze

Here&#39;s a snippit from the code:

# Connect ...
# Fetch mailboxes.
my @mboxes = $imap-&gt;folders&#40;&#41; or die&#40;&#34;ERROR: Failed to LIST:\n$@\n&#34;&#41;;
foreach my $mbox &#40;@mboxes&#41; {
        # Select the mailbox.
        $imap-&gt;select&#40;$mbox&#41; or die&#40;&#34;ERROR: Failed to SELECT \&#34;$mbox\&#34;:\n$@\n&#34;&#41;;
        # Search for UIDs that are marked as deleted.
        my @uids = $imap-&gt;search&#40;&#39;DELETED&#39;&#41;;
        if &#40;scalar&#40;@uids&#41; &gt; 0&#41; {
                my $uid_list = $imap-&gt;Range&#40;@uids&#41;;
                # Get the date info on those uids.
                my @old_uids;
                my @fetch_fields = &#40;&#39;UID&#39;, &#39;X-SAVEDATE&#39;, &#39;FLAGS&#39;, &#39;ENVELOPE&#39;&#41;;
                my %old_msg_data = $imap-&gt;fetch_hash&#40;$uid_list, @fetch_fields&#41;
                       or die&#40;&#34;ERROR: Failed to FETCH message data on DELETED UIDs $uid_list:\n$@\n&#34;&#41;;
                print &#34;Found the following DELETED message data:\n&#34;, Dumper&#40;\%old_msg_data&#41;;
                # Do stuff with that message data ...
        }
}
# Disconnect ...

Let me know if you need anything else.

Thanks,
Brian
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;10:41:23&nbsp;2010</span>
    <span class="description">bpkroth [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63524] AutoReply: fetch_hash&#40;&#41; parse error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Dec 2010 09:40:45 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Mail-IMAPClient via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brian Kroth &lt;bpkroth [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There&#39;s actually two issues here.
&gt; 
&gt; 1&#41; fetch_hash&#40;&#41; seems to fail parsing ENVELOPE field values that have
&gt; certain quote characters in them.
&gt; 
&gt; 2&#41; fetch_hash&#40;&#41; doesn&#39;t return X-SAVEDATE fields as requested.
&gt; 
&gt; Attached is the debug output.
&gt; Versions involved are as follows:
&gt; libmail-imapclient-perl 3.25-1
&gt; perl 5.10.1-16
&gt; Debian Squeeze
&gt; 
&gt; Here&#39;s a snippit from the code:
&gt; 
&gt; # Connect ...
&gt; # Fetch mailboxes.
&gt; my @mboxes = $imap-&gt;folders&#40;&#41; or die&#40;&#34;ERROR: Failed to LIST:\n$@\n&#34;&#41;;
&gt; foreach my $mbox &#40;@mboxes&#41; {
&gt;       # Select the mailbox.
&gt;       $imap-&gt;select&#40;$mbox&#41; or die&#40;&#34;ERROR: Failed to SELECT \&#34;$mbox\&#34;:\n$@\n&#34;&#41;;
&gt;       # Search for UIDs that are marked as deleted.
&gt;       my @uids = $imap-&gt;search&#40;&#39;DELETED&#39;&#41;;
&gt;       if &#40;scalar&#40;@uids&#41; &gt; 0&#41; {
&gt;               my $uid_list = $imap-&gt;Range&#40;@uids&#41;;
&gt;               # Get the date info on those uids.
&gt;               my @old_uids;
&gt;               my @fetch_fields = &#40;&#39;UID&#39;, &#39;X-SAVEDATE&#39;, &#39;FLAGS&#39;, &#39;ENVELOPE&#39;&#41;;
&gt;               my %old_msg_data = $imap-&gt;fetch_hash&#40;$uid_list, @fetch_fields&#41;
&gt;                      or die&#40;&#34;ERROR: Failed to FETCH message data on DELETED UIDs $uid_list:\n$@\n&#34;&#41;;
&gt;               print &#34;Found the following DELETED message data:\n&#34;, Dumper&#40;\%old_msg_data&#41;;
&gt;               # Do stuff with that message data ...
</div>
In working around this, I found that if instead of the above
$imap-&gt;fetch_hash&#40;&#41; code I do the following:
                my @lines = $imap-&gt;fetch&#40;$uid_list, @fetch_fields&#41;;

Then I get the following problems:

1&#41; Multi-line string literals {nnn} are not replaced and concatenated as
the documentation reports.

2&#41; I can&#39;t call the function as shown above, else I get a BAD response
from IMAP &#40;see below&#41;.  Instead I have to do the following &#40;basically
compose the IMAP message myself&#41;:
                @lines = $imap-&gt;fetch&#40;$uid_list, &#39;&#40;&#39;.join&#40;&#39; &#39;, @fetch_fields&#41;.&#39;&#41;&#39;&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       }
&gt; }
&gt; # Disconnect ...
&gt; 
&gt; Let me know if you need anything else.
&gt; 
&gt; Thanks,
&gt; Brian
</div>
Sending: 19 UID FETCH 12:13,17 UID X-SAVEDATE FLAGS ENVELOPE
Sent 53 bytes
Read:   19 BAD Error in IMAP command UID FETCH: Invalid arguments.
ERROR: 19 BAD Error in IMAP command UID FETCH: Invalid arguments. at /usr/share/perl5/Mail/IMAPClient.pm line 1457
        Mail::IMAPClient::_get_response&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, 19, undef&#41; called at /usr/share/perl5/Mail/IMAPClient.pm line 1406
        Mail::IMAPClient::_imap_command_do&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, &#39;UID FETCH 12:13,17 UID X-SAVEDATE FLAGS ENVELOPE&#39;&#41; called at /usr/share/perl5/Mail/IMAPClient.pm line 1312
        Mail::IMAPClient::_imap_command&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, &#39;UID FETCH 12:13,17 UID X-SAVEDATE FLAGS ENVELOPE&#39;&#41; called at /usr/share/perl5/Mail/IMAPClient.pm line 1488
        Mail::IMAPClient::_imap_uid_command&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, &#39;FETCH&#39;, &#39;12:13,17&#39;, &#39;UID&#39;, &#39;X-SAVEDATE&#39;, &#39;FLAGS&#39;, &#39;ENVELOPE&#39;&#41; called at /usr/share/perl5/Mail/IMAPClient.pm line 2107
        Mail::IMAPClient::fetch&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, &#39;Mail::IMAPClient::MessageSet=SCALAR&#40;0x282ffe0&#41;&#39;, &#39;UID&#39;, &#39;X-SAVEDATE&#39;, &#39;FLAGS&#39;, &#39;ENVELOPE&#39;&#41; called at ./dovecot-maintenance-v4.pl line 154
ERROR: 19 BAD Error in IMAP command UID FETCH: Invalid arguments. at /usr/share/perl5/Mail/IMAPClient.pm line 1357
        Mail::IMAPClient::_imap_command&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, &#39;UID FETCH 12:13,17 UID X-SAVEDATE FLAGS ENVELOPE&#39;&#41; called at /usr/share/perl5/Mail/IMAPClient.pm line 1488
        Mail::IMAPClient::_imap_uid_command&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, &#39;FETCH&#39;, &#39;12:13,17&#39;, &#39;UID&#39;, &#39;X-SAVEDATE&#39;, &#39;FLAGS&#39;, &#39;ENVELOPE&#39;&#41; called at /usr/share/perl5/Mail/IMAPClient.pm line 2107
        Mail::IMAPClient::fetch&#40;&#39;Mail::IMAPClient=HASH&#40;0x2922498&#41;&#39;, &#39;Mail::IMAPClient::MessageSet=SCALAR&#40;0x282ffe0&#41;&#39;, &#39;UID&#39;, &#39;X-SAVEDATE&#39;, &#39;FLAGS&#39;, &#39;ENVELOPE&#39;&#41; called at ./dovecot-maintenance-v4.pl line 154
Use of uninitialized value $line in pattern match &#40;m//&#41; at ./dovecot-maintenance-v4.pl line 160.
Use of uninitialized value $line in pattern match &#40;m//&#41; at ./dovecot-maintenance-v4.pl line 160.
Use of uninitialized value $line in concatenation &#40;.&#41; or string at ./dovecot-maintenance-v4.pl line 165.
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;12:00:42&nbsp;2010</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the bug report, we clearly have a few bugs to clean up here...

On Thu Dec 02 10:41:23 2010, bpkroth@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; There&#39;s actually two issues here.
&gt; &gt;
&gt; &gt; 1&#41; fetch_hash&#40;&#41; seems to fail parsing ENVELOPE field values that
&gt; &gt;    have certain quote characters in them.
</div></div>
Clearly a bug here.  If you get a chance to write a test case based
on the problem that would be great.  See t/fetch_hash.t for a starting
point if you are interested, otherwise I&#39;ll do this when I get a little
time.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 2&#41; fetch_hash&#40;&#41; doesn&#39;t return X-SAVEDATE fields as requested.
</div></div>
I just did a very quick glance at the code and I don&#39;t see why this
would be the case but perhaps this is related to the issue in #1.

[...snip...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In working around this, I found that if instead of the above
&gt; $imap-&gt;fetch_hash&#40;&#41; code I do the following:
&gt;               my @lines = $imap-&gt;fetch&#40;$uid_list, @fetch_fields&#41;;
&gt; 
&gt; Then I get the following problems:
&gt; 
&gt; 1&#41; Multi-line string literals {nnn} are not replaced and concatenated
&gt; as the documentation reports.
</div>
Can you provide a little more detail here?  The output from fetch&#40;&#41; is
&#34;raw&#34; per the original code from the original author.  Are you saying
you&#39;re still seeing &#34;{nnn}&#34; interspersed in with the actual data?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; I can&#39;t call the function as shown above, else I get a BAD response
&gt; from IMAP &#40;see below&#41;.  Instead I have to do the following &#40;basically
&gt; compose the IMAP message myself&#41;:
&gt;               @lines = $imap-&gt;fetch&#40;$uid_list, &#39;&#40;&#39;.join&#40;&#39; &#39;, @fetch_fields&#41;.&#39;&#41;&#39;&#41;;
</div>
Clearly a bug.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;12:00:43&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;12:00:43&nbsp;2010</span>
    <span class="description">PLOBBES [...] cpan.org -  Given to PLOBBES</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;14:44:11&nbsp;2010</span>
    <span class="description">bpkroth [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> DJKERNEN__NO_SOLICITING__ [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63524] fetch_hash&#40;&#41; parse error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Dec 2010 13:43:57 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Phil Pearl &#40;Lobbes&#41; via RT&#34; &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brian Kroth &lt;bpkroth [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Phil Pearl &#40;Lobbes&#41; via RT &lt;bug-Mail-IMAPClient@rt.cpan.org&gt; 2010-12-02 12:00:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63524">https://rt.cpan.org/Ticket/Display.html?id=63524</a></span> &gt;
&gt; 
&gt; Thanks for the bug report, we clearly have a few bugs to clean up here...
&gt; 
&gt; On Thu Dec 02 10:41:23 2010, bpkroth@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; There&#39;s actually two issues here.
&gt; &gt; &gt;
&gt; &gt; &gt; 1&#41; fetch_hash&#40;&#41; seems to fail parsing ENVELOPE field values that
&gt; &gt; &gt;    have certain quote characters in them.
</div>&gt; 
&gt; Clearly a bug here.  If you get a chance to write a test case based
&gt; on the problem that would be great.  See t/fetch_hash.t for a starting
&gt; point if you are interested, otherwise I&#39;ll do this when I get a little
&gt; time.
</div>
The test case was basically a message with the following subject line:
foo &#34;bar&#34; baz&#39;s

Then I FETCH &#40;ENVELOPE&#41; of the messages from that mailbox and it gets
angry while parsing it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you provide a little more detail here?  The output from fetch&#40;&#41; is
&gt; &#34;raw&#34; per the original code from the original author.  Are you saying
&gt; you&#39;re still seeing &#34;{nnn}&#34; interspersed in with the actual data?
</div>
As I read the docs [1] I would expect a response like this:
* FETCH 10 &#40;UID 6 ENVELOPE &#40;some-date {15}
foo &#34;bar&#34; baz&#39;s &#34;other-properly-quoted-junk&#34;&#41;&#41;

To be turned into this:
* FETCH 10 &#40;UID 6 ENVELOPE &#40;some-date foo &#34;bar&#34; baz&#39;s &#34;other-properly-quoted-junk&#34;&#41;&#41;

Instead they come out like this:
* FETCH 10 &#40;UID 6 ENVELOPE &#40;some-date
foo &#34;bar&#34; baz&#39;s 
&#34;other-properly-quoted-junk&#34;&#41;&#41;

I hope that makes sense.

Thanks,
Brian

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~plobbes/Mail-IMAPClient/lib/Mail/IMAPClient.pod#fetch">http://search.cpan.org/~plobbes/Mail-IMAPClient/lib/Mail/IMAPClient.pod#fetch</a></span>
&#34;The only exception to this is literal strings, which will be inserted
into the output line at the point at which they were encountered
&#40;without the {nnn} literal field indicator&#41;&#34;
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;28&nbsp;22:22:11&nbsp;2011</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am preparing to release Mail::IMAPClient 3.26 soon and I have fixed the 
two issues you reported.  Here are the related Changelog entries:

  - rt.cpan.org#63524: fetch_hash&#40;&#41; parse errors
    [Brian Kroth]
    + fixed handling of LITERAL values in response
    + fixed handling of field names with a dash &#40;e.g. X-SAVEDATE&#41;
    + fetch_hash now uses Escaped_results&#40;&#41; method
  - *fixed Escaped_results&#40;&#41; to properly join LITERAL data with
    the data that comes before and after it

Once the new version is released &#40;hopefully next week&#41; please try it out 
and let me know if you see any other problems.  Thanks again for reporting 
these issues!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;28&nbsp;22:22:12&nbsp;2011</span>
    <span class="description">PLOBBES [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;09:44:38&nbsp;2011</span>
    <span class="description">PLOBBES [...] cpan.org -  Fixed in 3.26 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;09:44:38&nbsp;2011</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mail::IMAPClient 3.26 has been released to CPAN.  Please install it if you 
get a chance and let me know if you run into any more problems, thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;09:44:39&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;09:44:39&nbsp;2011</span>
    <span class="description">PLOBBES [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;14:39:28&nbsp;2011</span>
    <span class="description">bpkroth [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> DJKERNEN__NO_SOLICITING__ [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63524] fetch_hash&#40;&#41; parse error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 1 Feb 2011 13:39:17 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Phil Pearl &#40;Lobbes&#41; via RT&#34; &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brian Kroth &lt;bpkroth [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Phil Pearl &#40;Lobbes&#41; via RT &lt;bug-Mail-IMAPClient@rt.cpan.org&gt; 2011-02-01 09:44:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63524">https://rt.cpan.org/Ticket/Display.html?id=63524</a></span> &gt;
&gt; 
&gt; Mail::IMAPClient 3.26 has been released to CPAN.  Please install it if you 
&gt; get a chance and let me know if you run into any more problems, thanks!
</div>
Looks good to me so far.

Thanks,
Brian
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;14:39:29&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;13&nbsp;12:21:35&nbsp;2011</span>
    <span class="description">PLOBBES [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
