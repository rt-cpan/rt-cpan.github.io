<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #116196 for Encode: [PATCH] Synchronize encoding.pm with blead</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #116196 for Encode: [PATCH] Synchronize encoding.pm with blead</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Encode/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Encode/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Encode/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Encode/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Encode">Encode CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">116196</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Encode/Active/">Encode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
&#39;spro^^*%*^6ut# [...] &#38;$%*c

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12062-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12063-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;15&nbsp;20:05:35&nbsp;2016</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Synchronize encoding.pm with blead</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In bleadperl &#40;5.25.3-to-be&#41;, the functionality of the ${^ENCODING} variable is no longer supported, so encoding.pm dies unless invoked with the Filter option.

The attached patch contains the changes made in blead.

Also, bleadperl currently uses 2.17_01 temporarily as the version.  I did not include the version hunk in the patch, since no doubt you will use something else, like 2.18.

If you disagree with any of this, by all means, please speak up on p5p.  Thank you.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> open_6jOV70zj.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rup Encode-2.84-dueVua/encoding.pm /Users/sprout/perl/perl.git-copy/cpan/Encode/encoding.pm
--- Encode-2.84-dueVua/encoding.pm	2016-04-11 00:17:04.000000000 -0700
+++ /Users/sprout/perl/perl.git-copy/cpan/Encode/encoding.pm	2016-07-14 18:13:21.000000000 -0700
@@ -114,10 +114,9 @@ sub import {
         Carp::croak&#40;&#34;encoding: pragma does not support EBCDIC platforms&#34;&#41;;
     }
 
-    if &#40;$] &gt;= 5.017&#41; {
-	warnings::warnif&#40;&#34;deprecated&#34;,
-			 &#34;Use of the encoding pragma is deprecated&#34;&#41;
-    }
+    my $deprecate =
+        $] &gt;= 5.017 ? &#34;Use of the encoding pragma is deprecated&#34; : 0;
+
     my $class = shift;
     my $name  = shift;
     if &#40;!$name&#41;{
@@ -142,6 +141,12 @@ sub import {
     }
     $name = $enc-&gt;name;    # canonize
     unless &#40; $arg{Filter} &#41; {
+        if &#40;$] &gt;= 5.025003&#41; {
+            require Carp;
+            Carp::croak&#40;&#34;The encoding pragma is no longer supported&#34;&#41;;
+        }
+        warnings::warnif&#40;&#34;deprecated&#34;,$deprecate&#41; if $deprecate;
+
         DEBUG and warn &#34;_exception&#40;$name&#41; = &#34;, _exception&#40;$name&#41;;
         if &#40;! _exception&#40;$name&#41;&#41; {
             if &#40;!PERL_5_21_7&#41; {
@@ -158,6 +163,8 @@ sub import {
         HAS_PERLIO or return 1;
     }
     else {
+        warnings::warnif&#40;&#34;deprecate&#34;,$deprecate&#41; if $deprecate;
+
         defined&#40; ${^ENCODING} &#41; and undef ${^ENCODING};
         undef ${^E_NCODING} if PERL_5_21_7;
 
@@ -280,6 +287,10 @@ Old code should be converted to UTF-8, v
 L&lt;/SYNOPSIS&gt; &#40;though this simple approach may require manual adjustments
 afterwards&#41;.
 
+If UTF-8 is not an option, it is recommended that one use a simple source
+filter, such as that provided by L&lt;Filter::Encoding&gt; on CPAN or this
+pragma&#39;s own C&lt;Filter&gt; option &#40;see below&#41;.
+
 The only legitimate use of this pragma is almost certainly just one per file,
 near the top, with file scope, as the file is likely going to only be written
 in one encoding.  Further restrictions apply in Perls before v5.22 &#40;see
@@ -291,6 +302,9 @@ There are two basic modes of operation &#40;
 
 =item C&lt;use encoding [&#39;I&lt;ENCNAME&gt;&#39;] ;&gt;
 
+Please note: This mode of operation is no longer supported as of Perl
+v5.26.
+
 This is the normal operation.  It translates various literals encountered in
 the Perl source file from the encoding I&lt;ENCNAME&gt; into UTF-8, and similarly
 converts character code points.  This is used when the script is a combination
Only in /Users/sprout/perl/perl.git-copy/cpan/Encode/: pm_to_blib
diff -rup Encode-2.84-dueVua/t/enc_data.t /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_data.t
--- Encode-2.84-dueVua/t/enc_data.t	2016-04-11 00:17:06.000000000 -0700
+++ /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_data.t	2016-07-13 01:12:58.000000000 -0700
@@ -14,6 +14,10 @@ BEGIN {
     print &#34;1..0 # encoding pragma does not support EBCDIC platforms\n&#34;;
     exit&#40;0&#41;;
     }
+    if &#40;&#34;$]&#34; &gt;= 5.025&#41; {
+    print &#34;1..0 # encoding pragma not supported in Perl 5.26\n&#34;;
+    exit&#40;0&#41;;
+    }
     if &#40;$] &lt;= 5.008 and !$Config{perl_patchlevel}&#41;{
     print &#34;1..0 # Skip: Perl 5.8.1 or later required\n&#34;;
     exit 0;
diff -rup Encode-2.84-dueVua/t/enc_eucjp.t /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_eucjp.t
--- Encode-2.84-dueVua/t/enc_eucjp.t	2016-04-11 00:17:06.000000000 -0700
+++ /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_eucjp.t	2016-07-13 01:12:58.000000000 -0700
@@ -19,6 +19,10 @@ BEGIN {
     print &#34;1..0 # Skip: Perl 5.8.1 or later required\n&#34;;
     exit 0;
     }
+    if &#40;$] &gt;= 5.025003&#41;{
+    print &#34;1..0 # Skip: Perl 5.25.2 or lower required\n&#34;;
+    exit 0;
+    }
 }
 
 no warnings &#34;deprecated&#34;;
diff -rup Encode-2.84-dueVua/t/enc_module.t /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_module.t
--- Encode-2.84-dueVua/t/enc_module.t	2016-04-11 00:17:06.000000000 -0700
+++ /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_module.t	2016-07-13 01:12:58.000000000 -0700
@@ -18,6 +18,10 @@ BEGIN {
     print &#34;1..0 # encoding pragma does not support EBCDIC platforms\n&#34;;
     exit&#40;0&#41;;
     }
+    if &#40;&#34;$]&#34; &gt;= 5.025&#41; {
+    print &#34;1..0 # encoding pragma not supported in Perl 5.26\n&#34;;
+    exit&#40;0&#41;;
+    }
 }
 use lib qw&#40;t ext/Encode/t ../ext/Encode/t&#41;; # latter 2 for perl core
 use Mod_EUCJP;
diff -rup Encode-2.84-dueVua/t/enc_utf8.t /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_utf8.t
--- Encode-2.84-dueVua/t/enc_utf8.t	2016-04-11 00:17:06.000000000 -0700
+++ /Users/sprout/perl/perl.git-copy/cpan/Encode/t/enc_utf8.t	2016-07-13 01:12:58.000000000 -0700
@@ -15,6 +15,10 @@ BEGIN {
     print &#34;1..0 # encoding pragma does not support EBCDIC platforms\n&#34;;
     exit&#40;0&#41;;
     }
+    if &#40;$] &gt;= 5.025003&#41;{
+    print &#34;1..0 # Skip: Perl 5.25.2 or lower required\n&#34;;
+    exit 0;
+    }
 }
 
 no warnings &#34;deprecated&#34;;
diff -rup Encode-2.84-dueVua/t/encoding.t /Users/sprout/perl/perl.git-copy/cpan/Encode/t/encoding.t
--- Encode-2.84-dueVua/t/encoding.t	2015-09-13 19:27:20.000000000 -0700
+++ /Users/sprout/perl/perl.git-copy/cpan/Encode/t/encoding.t	2016-07-13 01:12:58.000000000 -0700
@@ -12,6 +12,10 @@ BEGIN {
     print &#34;1..0 # encoding pragma does not support EBCDIC platforms\n&#34;;
     exit&#40;0&#41;;
     }
+    if &#40;&#34;$]&#34; &gt;= 5.025&#41; {
+    print &#34;1..0 # encoding pragma not supported in Perl 5.26\n&#34;;
+    exit&#40;0&#41;;
+    }
 }
 
 print &#34;1..33\n&#34;;
diff -rup Encode-2.84-dueVua/t/jperl.t /Users/sprout/perl/perl.git-copy/cpan/Encode/t/jperl.t
--- Encode-2.84-dueVua/t/jperl.t	2016-04-11 00:17:06.000000000 -0700
+++ /Users/sprout/perl/perl.git-copy/cpan/Encode/t/jperl.t	2016-07-13 01:12:58.000000000 -0700
@@ -17,6 +17,10 @@ BEGIN {
     print &#34;1..0 # Skip: EBCDIC\n&#34;;
     exit 0;
     }
+    if &#40;&#34;$]&#34; &gt;= 5.025&#41; {
+    print &#34;1..0 # encoding pragma not supported in Perl 5.26\n&#34;;
+    exit&#40;0&#41;;
+    }
     $| = 1;
 }
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;13:58:22&nbsp;2016</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Your patch is in:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dankogai/p5-encode/commit/cf6ff75f721b58676d44dc3f8d10e3dc8919795e">https://github.com/dankogai/p5-encode/commit/cf6ff75f721b58676d44dc3f8d10e3dc8919795e</a></span>

I needed to fix one letter:

@@ -160,6 +165,8 @@ sub import {
         }
     }
     else {
+        warnings::warnif&#40;&#34;deprecate&#34;,$deprecate&#41; if $deprecate;
+
         defined&#40; ${^ENCODING} &#41; and undef ${^ENCODING};
         undef ${^E_NCODING} if PERL_5_21_7;
 
&#34;deprecate&#34; should&#39;ve been &#34;deprecated&#34; or t/jperl.t fails.

Dan the Maintainer Thereof

On Fri Jul 15 20:05:35 2016, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In bleadperl &#40;5.25.3-to-be&#41;, the functionality of the ${^ENCODING}
&gt; variable is no longer supported, so encoding.pm dies unless invoked
&gt; with the Filter option.
&gt; 
&gt; The attached patch contains the changes made in blead.
&gt; 
&gt; Also, bleadperl currently uses 2.17_01 temporarily as the version.  I
&gt; did not include the version hunk in the patch, since no doubt you will
&gt; use something else, like 2.18.
&gt; 
&gt; If you disagree with any of this, by all means, please speak up on
&gt; p5p.  Thank you.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;13:58:23&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;13:58:23&nbsp;2016</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
