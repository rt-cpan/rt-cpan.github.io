<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #132428 for Object-Pad: method does not warn of shadowed $self lexical</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #132428 for Object-Pad: method does not warn of shadowed $self lexical</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Object-Pad">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Object-Pad">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Object-Pad">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Object-Pad">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Object-Pad">Object-Pad CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">132428</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Object-Pad">Object-Pad</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
leonerd-cpan [...] leonerd.org.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-273988-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.25    </td>
  </tr>
  <tr id="CF-273989-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.26    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




rt132428.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1895100/1016039/rt132428.patch">
Sun Apr 26 21:18:37 2020 (3.4k) by leonerd-cpan [...] leonerd.org.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=132428">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895095" href="/Public/Bug/Display.html?id=132428#txn-1895095">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;19:27:53&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> method does not warn of shadowed $self lexical</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895095/1016033/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016033">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 572b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A regular perl sub warns:

  $ perl -Mwarnings -E &#39;sub x { my $self = shift; my $self = shift }&#39;
  &#34;my&#34; variable $self masks earlier declaration in same scope at -e line 1.

but a method does not

  method x {
    my $self = shift;
    ...
  }

produces no warning of this obviously-wrong code, leading to unexpected behaviour if the method body tries to use $self.

This warning in particular would be useful when converting existing code into Object::Pad as a common mistake when converting such code is forgetting to delete the `my $self = shift` line.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895097" href="/Public/Bug/Display.html?id=132428#txn-1895097">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;19:33:43&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895097/1016035/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016035">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 979b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This failure comes from the fact that XS::Parse::Sublike uses parse_block&#40;&#41; to parse the body of the method, resulting in a new block scope. In effect the body parses like

  perl -Mwarnings -E &#39;sub x { my $self = shift; { my $self = shift } }&#39;

and so the inner scope does not create the warning.

It might first seem that XS::Parse::Sublike should just use parse_stmtseq&#40;&#41; instead of parse_block&#40;&#41; and consume the surrounding braces itself, however initial testing on this proves not that simple.

An empty body is returned as NULL, which is easy enough to resolve by substituting newOP&#40;OP_STUB, 0&#41;.

A more serious problem is that parse_stmtseq&#40;&#41; expects a sequence of statements, which must be terminated with semicolons; which regular blocks &#40;such as function bodies&#41; need not be.

  method one { 1 }

now no longer parses without error; it requires the semicolon

  method one { 1; }

This feels, if not a bug as such, at least an oversight on core&#39;s part.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895098" href="/Public/Bug/Display.html?id=132428#txn-1895098">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;20:21:51&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895098/1016036/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016036">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 207b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Apr 26 19:33:43 2020, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This feels, if not a bug as such, at least an oversight on core&#39;s
&gt; part.
</div>
Added an upstream Issue:
  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl/perl5/issues/17754">https://github.com/Perl/perl5/issues/17754</a></span>


-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895100" href="/Public/Bug/Display.html?id=132428#txn-1895100">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;21:18:37&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895100/1016038/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016038">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 149b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">While not a complete fix, the attached patch at least hacks in a warning that should work in most cases to detect this common error.

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt132428.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895100/1016039/rt132428.patch">Download rt132428.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;hax/perl-additions.c.inc&#39;
--- old/hax/perl-additions.c.inc	2020-04-23 16:49:20 +0000
+++ new/hax/perl-additions.c.inc	2020-04-27 01:14:50 +0000
@@ -4,6 +4,12 @@
 #  define av_count&#40;av&#41;           &#40;av_top_index&#40;av&#41; + 1&#41;
 #endif
 
+#if HAVE_PERL_VERSION&#40;5, 22, 0&#41;
+#  define PadnameIsNULL&#40;pn&#41;  &#40;!&#40;pn&#41;&#41;
+#else
+#  define PadnameIsNULL&#40;pn&#41;  &#40;!&#40;pn&#41; || &#40;pn&#41; == &#38;PL_sv_undef&#41;
+#endif
+
 #define save_strndup&#40;s, l&#41;  S_save_strndup&#40;aTHX_ s, l&#41;
 static char *S_save_strndup&#40;pTHX_ char *s, STRLEN l&#41;
 {

=== modified file &#39;lib/Object/Pad.xs&#39;
--- old/lib/Object/Pad.xs	2020-04-25 12:47:34 +0000
+++ new/lib/Object/Pad.xs	2020-04-27 01:15:19 +0000
@@ -159,6 +159,26 @@
   return GvAV&#40;*gvp&#41;;
 }
 
+#define find_cop_for_lvintro&#40;padix, o, copp&#41;  S_find_cop_for_lvintro&#40;aTHX_ padix, o, copp&#41;
+static COP *S_find_cop_for_lvintro&#40;pTHX_ PADOFFSET padix, OP *o, COP **copp&#41;
+{
+  for&#40; ; o; o = OpSIBLING&#40;o&#41;&#41; {
+    if&#40;OP_CLASS&#40;o&#41; == OA_COP&#41; {
+      *copp = &#40;COP *&#41;o;
+    }
+    else if&#40;o-&gt;op_type == OP_PADSV &#38;&#38; o-&gt;op_targ == padix &#38;&#38; o-&gt;op_private &#38; OPpLVAL_INTRO&#41; {
+      return *copp;
+    }
+    else if&#40;o-&gt;op_flags &#38; OPf_KIDS&#41; {
+      COP *ret = find_cop_for_lvintro&#40;padix, cUNOPx&#40;o&#41;-&gt;op_first, copp&#41;;
+      if&#40;ret&#41;
+        return ret;
+    }
+  }
+
+  return NULL;
+}
+
 /*********************************
  * Class and Slot Implementation *
  *********************************/
@@ -1219,6 +1239,30 @@
   if&#40;repr == REPR_AUTOSELECT &#38;&#38; !compclassmeta-&gt;foreign_new&#41;
     repr = REPR_NATIVE;
 
+  {
+    ENTER;
+    SAVEVPTR&#40;PL_curcop&#41;;
+
+    /* See <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132428">https://rt.cpan.org/Ticket/Display.html?id=132428</a></span>
+     *   <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl/perl5/issues/17754">https://github.com/Perl/perl5/issues/17754</a></span>
+     */
+    PADOFFSET padix;
+    for&#40;padix = PADIX_SELF + 1; padix &lt;= PadnamelistMAX&#40;PadlistNAMES&#40;CvPADLIST&#40;PL_compcv&#41;&#41;&#41;; padix++&#41; {
+      PADNAME *pn = padnames[padix];
+      if&#40;PadnameIsNULL&#40;pn&#41; || !PadnameLEN&#40;pn&#41;&#41;
+        continue;
+      if&#40;!strEQ&#40;PadnamePV&#40;pn&#41;, &#34;$self&#34;&#41;&#41;
+        continue;
+
+      COP *padcop = NULL;
+      if&#40;find_cop_for_lvintro&#40;padix, ctx-&gt;body, &#38;padcop&#41;&#41;
+        PL_curcop = padcop;
+      warn&#40;&#34;\&#34;my\&#34; variable $self masks earlier declaration in same scope&#34;&#41;;
+    }
+
+    LEAVE;
+  }
+
   slotops = op_append_list&#40;OP_LINESEQ, slotops,
     newSTATEOP&#40;0, NULL, NULL&#41;&#41;;
   slotops = op_append_list&#40;OP_LINESEQ, slotops,
@@ -1277,10 +1321,7 @@
     PADOFFSET padix;
     for&#40;padix = 1; padix &lt;= PadnamelistMAX&#40;pnl&#41;; padix++&#41; {
       PADNAME *pn = PadnamelistARRAY&#40;pnl&#41;[padix];
-      if&#40;!pn || 
-#if !HAVE_PERL_VERSION&#40;5, 22, 0&#41;
-         pn == &#38;PL_sv_undef ||
-#endif
+      if&#40;PadnameIsNULL&#40;pn&#41; ||
          !PadnameOUTER&#40;pn&#41; ||
          !PARENT_PAD_INDEX&#40;pn&#41;&#41;
         continue;

=== modified file &#39;t/01method.t&#39;
--- old/t/01method.t	2020-04-16 20:40:18 +0000
+++ new/t/01method.t	2020-04-27 01:08:11 +0000
@@ -56,4 +56,26 @@
    is&#40; $obj-&gt;value, 123, &#39;$obj-&gt;value from BUILD-generated anon method&#39; &#41;;
 }
 
+# method warns about redeclared $self &#40;RT132428&#41;
+{
+   class RT132428 {
+      BEGIN {
+         my $warnings = &#34;&#34;;
+         local $SIG{__WARN__} = sub { $warnings .= join &#34;&#34;, @_; };
+
+         ::ok&#40; defined eval &lt;&lt;&#39;EOPERL&#39;,
+            method test {
+               my $self = shift;
+            }
+            1;
+EOPERL
+            &#39;method compiles OK&#39; &#41;;
+
+         ::like&#40; $warnings,
+            qr/^&#34;my&#34; variable \$self masks earlier declaration in same scope at \&#40;eval \d+\&#41; line 2\./,
+            &#39;warning from redeclared $self comes from correct line&#39; &#41;;
+      }
+   }
+}
+
 done_testing;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1897433" href="/Public/Bug/Display.html?id=132428#txn-1897433">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;11&nbsp;20:21:44&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1897434" href="/Public/Bug/Display.html?id=132428#txn-1897434">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;May&nbsp;11&nbsp;20:21:44&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Fixed in 0.26 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.266153</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
