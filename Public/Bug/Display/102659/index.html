<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #102659 for XML-Bare: ForceArray feature request</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #102659 for XML-Bare: ForceArray feature request</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Bare/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Bare/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Bare/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Bare/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Bare">XML-Bare CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">102659</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Bare/Active/">XML-Bare</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">cpan [...] codechild.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bpkroth [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-43826-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-43827-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;15:20:40&nbsp;2015</span>
    <span class="description">bpkroth [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ForceArray feature request</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Mar 2015 14:20:28 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Bare [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brian Kroth &lt;bpkroth [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, I was looking at using XML::Bare as a replacement for XML::Simple, 
but I found that it&#39;s currently lacking the ability to return a fully 
arrayified structure.  Instead, I have to modify my code to call 
forcearray&#40;&#41; on everything just in case.  It&#39;d be cool if this was done 
automatically based on something like a ForceArray&#40;&#41; option to either 
XMLin&#40;&#41; or simple&#40;&#41;.

Thanks,
Brian
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;16:57:30&nbsp;2015</span>
    <span class="description">cpan [...] codechild.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 09 15:20:40 2015, bpkroth@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi, I was looking at using XML::Bare as a replacement for XML::Simple, 
&gt; but I found that it&#39;s currently lacking the ability to return a fully 
&gt; arrayified structure.
</div>Are you suggesting to always return an array for all nodes, or to have a ForceArray option specifying the names of nodes to force?

XML structures typically only have specific portions that need to always be arrays. Most parts do not need to be forced to be an array. That is why the set of names for the ForceArray option in XML::Simple exists.

I don&#39;t like that option, because it ignores where those nodes are found. Realistically, you should know what paths in the XML are arrays, and be able to easily turn them into arrays before handling them.

That is, it is an elementary task to create a function that accepts a bunch of XML paths, and then traverses the XML running forcearray on each.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Instead, I have to modify my code to call 
&gt; forcearray&#40;&#41; on everything just in case.
</div>
Do you really mean &#34;everything&#34;?
&lt;xml&gt;
  &lt;person&gt;
    &lt;age&gt;24&lt;/age&gt;
  &lt;/person&gt;
&lt;/xml&gt;

You want age to be turned into an array also?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  It&#39;d be cool if this was done 
&gt; automatically based on something like a ForceArray&#40;&#41; option to either 
&gt; XMLin&#40;&#41; or simple&#40;&#41;.
&gt; 
&gt; Thanks,
&gt; Brian
</div>
If you really want to have the exact options that XML::Simple provides, it is possible to use the parser in XML::Bare together with XML::Simple itself by way of using XML::Bare::SAX::Parser. Note I haven&#39;t updated it in a while and it is some number of versions behind; but that is a potential option for you.

Another thing to consider is that the parser itself is in the process of being rewritten. The new core of the parser can be found at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/nanoscopic/xml-bare">https://github.com/nanoscopic/xml-bare</a></span>. My intention in the long term is to integrate this parser into a new perl module, and use tied arrays/hashes, so that you can transparently treat nodes like either arrays or hashes.

I have also considered making it possible for nodes to automatically be made into arrays based on the &#34;xml bare schema&#34; that you are using. That is, if you denote that a node can have more than one of it, that it will automatically be made into an array. This option would be the cleanest and easiest way to do what you want. You would of course have to write a trivial XBS that matches your XML for this to work.

For now, that is going to be the solution. I will make a new version that does so.

Basically this will happen:

XML:
&lt;xml&gt;&lt;person&gt;&lt;age&gt;24&lt;/age&gt;&lt;/person&gt;&lt;/xml&gt;

XBS:
&lt;xml&gt;&lt;person*/&gt;&lt;/xml&gt;
or
&lt;xml&gt;&lt;person+/&gt;&lt;/xml&gt;

Using XBS like that will let the parser know that &#34;person&#34; nodes either have 0 or more, or at least 1, and should automatically be made into arrays.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;16:57:30&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;16:57:37&nbsp;2015</span>
    <span class="description">cpan [...] codechild.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;10&nbsp;00:20:39&nbsp;2015</span>
    <span class="description">bpkroth [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102659] ForceArray feature request</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Mar 2015 23:20:23 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> David Helkowski via RT &lt;bug-XML-Bare [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brian Kroth &lt;bpkroth [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Helkowski via RT &lt;bug-XML-Bare@rt.cpan.org&gt; 2015-03-09 16:57:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=102659">https://rt.cpan.org/Ticket/Display.html?id=102659</a></span> &gt;
&gt;
&gt;On Mon Mar 09 15:20:40 2015, bpkroth@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; Hi, I was looking at using XML::Bare as a replacement for XML::Simple,
&gt;&gt; but I found that it&#39;s currently lacking the ability to return a fully
&gt;&gt; arrayified structure.
</div>&gt;Are you suggesting to always return an array for all nodes, or to have a ForceArray option specifying the names of nodes to force?
</div>
Both I guess.  I think XML::Simple let ForceArray reference either 1 or an array of element type names.  I&#39;ve used both in the past.  Sometimes I know upfront what nodes will have multiples in them, but sometimes I don&#39;t and I just want to handle all of them in a generic loop.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;XML structures typically only have specific portions that need to always be arrays. Most parts do not need to be forced to be an array. That is why the set of names for the ForceArray option in XML::Simple exists.
</div>
True, but there are cases where you may get an array in one case and just a hash in another depending upon the XML input your given.

For instance &#40;a really simple and small example from a much larger thing I was working on earlier today&#41;:

&lt;addresses&gt;
        &lt;address&gt;
                &lt;mac&gt;00:de:ad:be:ef:00&lt;/mac&gt;
        &lt;/address&gt;
&lt;/addresses&gt;

results in something like

$tree = {
        addresses =&gt; {
                address =&gt; {
                        mac     =&gt; {
                                content =&gt; &#39;00:de:ad:be:ef:00&#39;,
                        },
                },
        },
};

whereas this:

&lt;addresses&gt;
        &lt;address&gt;
                &lt;mac&gt;00:de:ad:be:ef:00&lt;/mac&gt;
        &lt;/address&gt;
        &lt;address&gt;
                &lt;mac&gt;00:00:00:c0:ff:ee&lt;/mac&gt;
        &lt;/address&gt;
&lt;/addresses&gt;

results in something like:

$tree = {
        addresses =&gt; {
                address =&gt; [
                        {
                                mac     =&gt; {
                                        content =&gt; &#39;00:de:ad:be:ef:00&#39;,
                                },
                        },
                        {
                                mac     =&gt; {
                                        content =&gt; &#39;00:00:00:c0:ff:ee&#39;,
                                },
                        },
                ],
        },
};

Now, when I&#39;m iterating through this, I need to test to see at each level &#40;or just certain levels if I have enough foreknowledge&#41;, is the result a hash reference or an array reference.  It&#39;d be much more convenient to just always assume that you&#39;re given an array reference, and iterate through each element, even if the iterate through is only a singleton.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I don&#39;t like that option, because it ignores where those nodes are found. Realistically, you should know what paths in the XML are arrays, and be able to easily turn them into arrays before handling them.
</div>
Perhaps if you know all of the XML you&#39;re going to be handling up front, but that may not always be the case.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;That is, it is an elementary task to create a function that accepts a bunch of XML paths, and then traverses the XML running forcearray on each.
&gt;
<div class="message-stanza open">&gt;&gt;  Instead, I have to modify my code to call
&gt;&gt; forcearray&#40;&#41; on everything just in case.
</div>&gt;
&gt;Do you really mean &#34;everything&#34;?
</div>
Well, in the absence of other knowledge from something like a schema or dtd &#40;which I don&#39;t always have&#41;, yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&lt;xml&gt;
&gt;  &lt;person&gt;
&gt;    &lt;age&gt;24&lt;/age&gt;
&gt;  &lt;/person&gt;
&gt;&lt;/xml&gt;
&gt;
&gt;You want age to be turned into an array also?
&gt;
<div class="message-stanza open">&gt;&gt;  It&#39;d be cool if this was done
&gt;&gt; automatically based on something like a ForceArray&#40;&#41; option to either
&gt;&gt; XMLin&#40;&#41; or simple&#40;&#41;.
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Brian
</div>&gt;
&gt;If you really want to have the exact options that XML::Simple provides, it is possible to use the parser in XML::Bare together with XML::Simple itself by way of using XML::Bare::SAX::Parser. Note I haven&#39;t updated it in a while and it is some number of versions behind; but that is a potential option for you.
&gt;
&gt;Another thing to consider is that the parser itself is in the process of being rewritten. The new core of the parser can be found at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/nanoscopic/xml-bare">https://github.com/nanoscopic/xml-bare</a></span>. My intention in the long term is to integrate this parser into a new perl module, and use tied arrays/hashes, so that you can transparently treat nodes like either arrays or hashes.
</div>
Neat.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I have also considered making it possible for nodes to automatically be made into arrays based on the &#34;xml bare schema&#34; that you are using. That is, if you denote that a node can have more than one of it, that it will automatically be made into an array. This option would be the cleanest and easiest way to do what you want. You would of course have to write a trivial XBS that matches your XML for this to work.
</div>
Ah, like I described above.  Cool.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;For now, that is going to be the solution. I will make a new version that does so.
&gt;
&gt;Basically this will happen:
&gt;
&gt;XML:
&gt;&lt;xml&gt;&lt;person&gt;&lt;age&gt;24&lt;/age&gt;&lt;/person&gt;&lt;/xml&gt;
&gt;
&gt;XBS:
&gt;&lt;xml&gt;&lt;person*/&gt;&lt;/xml&gt;
&gt;or
&gt;&lt;xml&gt;&lt;person+/&gt;&lt;/xml&gt;
&gt;
&gt;Using XBS like that will let the parser know that &#34;person&#34; nodes either have 0 or more, or at least 1, and should automatically be made into arrays.
</div>
Yeah, the trouble is, if you&#39;re parsing output from another source that you don&#39;t have full knowledge or control over, you&#39;re left to sort of guess what sort of garbage XML they might spit out at you.

Thanks for your efforts.

Cheers,
Brian
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;10&nbsp;11:18:34&nbsp;2015</span>
    <span class="description">cpan [...] codechild.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">See attached. I created a function that does as you want. Enjoy.

Example output from the examples within, for people who would like to see it without having to run it:

$VAR1 = {
          &#39;xml&#39; =&gt; {
                     &#39;person&#39; =&gt; [
                                   {
                                     &#39;age&#39; =&gt; &#39;25&#39;
                                   }
                                 ]
                   }
        };
$VAR1 = {
          &#39;xml&#39; =&gt; {
                     &#39;do_not_touch&#39; =&gt; {
                                         &#39;person&#39; =&gt; {
                                                       &#39;name&#39; =&gt; &#39;Bob&#39;
                                                     }
                                       },
                     &#39;person&#39; =&gt; [
                                   {
                                     &#39;age&#39; =&gt; &#39;25&#39;
                                   }
                                 ]
                   }
        };
$VAR1 = {
          &#39;a&#39; =&gt; [
                   {
                     &#39;b&#39; =&gt; [
                              &#39;2&#39;
                            ],
                     &#39;c&#39; =&gt; [
                              &#39;3&#39;
                            ]
                   }
                 ]
        };
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fa_with_examples.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use XML::Bare qw/forcearray/;
use Data::Dumper;

example_1&#40;&#41;;
example_2&#40;&#41;;
example_3&#40;&#41;;

sub example_1 {
    my &#40; $ob, $xml &#41; = XML::Bare-&gt;simple&#40; text =&gt; &#34;
        &lt;xml&gt;
            &lt;person&gt;
                &lt;age&gt;25&lt;/age&gt;
            &lt;/person&gt;
        &lt;/xml&gt;
    &#34; &#41;;
    XMLSimpleForceArray&#40; $xml, nodenames =&gt; [ qw/person/ ] &#41;;
    print Dumper&#40; $xml &#41;;
}

sub example_2 {
    my &#40; $ob, $xml &#41; = XML::Bare-&gt;simple&#40; text =&gt; &#34;
        &lt;xml&gt;
            &lt;person&gt;
                &lt;age&gt;25&lt;/age&gt;
            &lt;/person&gt;
            &lt;do_not_touch&gt;
                &lt;person&gt;
                    &lt;name&gt;Bob&lt;/name&gt;
                &lt;/person&gt;
            &lt;/do_not_touch&gt;
        &lt;/xml&gt;
    &#34; &#41;;
    XMLSimpleForceArray&#40; $xml, dotpaths =&gt; [ qw/xml.person/ ] &#41;;
    print Dumper&#40; $xml &#41;;
}
sub example_3 {
    my &#40; $ob, $xml &#41; = XML::Bare-&gt;simple&#40; text =&gt; &#34;
        &lt;a c=3&gt;
            &lt;b&gt;2&lt;/b&gt;
        &lt;/a&gt;
    &#34; &#41;;
    XMLSimpleForceArray&#40; $xml, forceall =&gt; 1 &#41;;
    print Dumper&#40; $xml &#41;;
}

sub XMLSimpleForceArray {
    my $xml = shift;
    my $ops = { @_ };
    if&#40; $ops-&gt;{&#39;nodenames&#39;} &#41; {
        my $nodenames = $ops-&gt;{&#39;nodenames&#39;};
        my $namehash = {};
        for my $nodename &#40; @$nodenames &#41; {
            $namehash-&gt;{ $nodename } = 1;
        }
        XSFA_recurse&#40; $xml, $namehash &#41;;
    }
    
    if&#40; $ops-&gt;{&#39;dotpaths&#39;} &#41; {
        my $arrpaths = [];
        my $dotpaths = $ops-&gt;{&#39;dotpaths&#39;};
        for my $dotpath &#40; @$dotpaths &#41; {
            my @arr = split&#40; &#39;\.&#39;, $dotpath &#41;;
            push&#40; @$arrpaths, \@arr &#41;;
        }
        $ops-&gt;{&#39;arraypaths&#39;} = $arrpaths;
        delete $ops-&gt;{&#39;dotpaths&#39;};
    }
    
    if&#40; $ops-&gt;{&#39;arraypaths&#39;} &#41; {
        my $nodepaths = $ops-&gt;{&#39;arraypaths&#39;};
        my $pathhash = {};
        for my $nodepath &#40; @$nodepaths &#41; {
            my $pathtext = join&#40; &#39;--&#39;, @$nodepath &#41;;
            $pathhash-&gt;{ $pathtext } = 1;
        }
        XSFA_path_recurse&#40; $xml, &#39;&#39;, $pathhash &#41;;
    }
    
    if&#40; $ops-&gt;{&#39;forceall&#39;} &#41; {
        XSFA_all_recurse&#40; $xml &#41;;
    }
}

sub XSFA_all_recurse {
    my &#40; $xml &#41; = @_;
    my $ref = ref&#40; $xml &#41;;
    return if&#40; !$ref &#41;;
    if&#40; $ref eq &#39;ARRAY&#39; &#41; {
        for my $item &#40; @$xml &#41; {
            XSFA_all_recurse&#40; $xml &#41;;
        }
    }                             
    elsif&#40; $ref eq &#39;HASH&#39; &#41; {
        for my $key &#40; keys %$xml &#41; {
            my $val = $xml-&gt;{ $key };
            $xml-&gt;{ $key } = [ $val ];
            XSFA_all_recurse&#40; $val &#41;;
        }
    }
    else { die &#34;Error&#34;; }
}

sub XSFA_path_recurse {
    my &#40; $xml, $path, $pathhash &#41; = @_;
    my $ref = ref&#40; $xml &#41;;
    return if&#40; !$ref &#41;;
    if&#40; $ref eq &#39;ARRAY&#39; &#41; {
        for my $item &#40; @$xml &#41; {
            XSFA_path_recurse&#40; $item, $path, $pathhash &#41;;
        }
    }
    elsif&#40; $ref eq &#39;HASH&#39; &#41; {
        for my $key &#40; keys %$xml &#41; {
            my $val = $xml-&gt;{ $key };
            my $p1 = $path ? &#34;$path--$key&#34; : $key;
            if&#40; $pathhash-&gt;{ $p1 } &#41; {
                $xml-&gt;{ $key } = [ $val ];
            }
            XSFA_path_recurse&#40; $val, $p1, $pathhash &#41;;
        }
    }
    else { die &#34;Error&#34;; }
}

sub XSFA_recurse {
    my &#40; $xml, $namehash &#41; = @_;
    my $ref = ref&#40; $xml &#41;;
    return if&#40; !$ref &#41;;
    if&#40; $ref eq &#39;ARRAY&#39; &#41; {
        for my $item &#40; @$xml &#41; {
            XSFA_recurse&#40; $item, $namehash &#41;;
        }
    }
    elsif&#40; $ref eq &#39;HASH&#39; &#41; {
        for my $key &#40; keys %$xml &#41; {
            my $val = $xml-&gt;{ $key };
            if&#40; $namehash-&gt;{ $key } &#41; {
                $xml-&gt;{ $key } = [ $val ];
            }
            XSFA_recurse&#40; $val, $namehash &#41;;
        }
    }
    else { die &#34;Error&#34;; }
}</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
