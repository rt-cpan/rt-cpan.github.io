<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #37833 for IO-Compress-Zlib: &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #37833 for IO-Compress-Zlib: &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Compress-Zlib">IO-Compress-Zlib CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">37833</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Compress-Zlib/Active/">IO-Compress-Zlib</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Peter.Lamb [...] csiro.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38616-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38617-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




gunzipbug.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/488445/241611/gunzipbug.pl">
Mon Jul 21 21:04:23 2008 (154b) by Peter.Lamb [...] csiro.au
</a>
</font></li>
</ul>


gunzipbug1.out<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/488893/241845/gunzipbug1.out">
Tue Jul 22 19:28:14 2008 (1.3k) by Peter.Lamb [...] csiro.au
</a>
</font></li>
</ul>


gunzipbug1.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/489703/242316/gunzipbug1.pl">
Thu Jul 24 20:46:02 2008 (365b) by Peter.Lamb [...] csiro.au
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/488893/241846/gunzipbug1.pl">
Tue Jul 22 19:28:14 2008 (314b) by Peter.Lamb [...] csiro.au
</a>
</font></li>
</ul>


linux.bin.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/488445/241612/linux.bin.gz">
Mon Jul 21 21:04:34 2008 (2939.3k) by Peter.Lamb [...] csiro.au
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;21:04:20&nbsp;2008</span>
    <span class="description">Peter.Lamb [...] csiro.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Jul 2008 11:01:09 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-IO-Compress-Zlib [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Peter.Lamb [...] csiro.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/488445/241612/linux.bin.gz">Download linux.bin.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 2.8m</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Distribution: IO-Compress-Zlib-2.012

Perl version: This is perl, v5.10.0 built for cygwin-thread-multi-64int
&#40;with 6 registered patches, see perl -V for more detail&#41;

OS: CYGWIN_NT-5.1 PREGIO-BT 1.5.25&#40;0.156/4/2&#41; 2008-06-12 19:34 i686
Cygwin &#40;running in Win XP 2002 SP 2&#41;

 

When I try to ungzip the attached gzip file with IO::Uncompress::Gunzip
using the attached script, I get:

 

Out of memory during &#34;large&#34; request for 536875008 bytes, total sbrk&#40;&#41;
is 269887488 bytes at
/usr/lib/perl5/5.10/i686-cygwin/IO/Uncompress/Adapter/Inflate.pm line
60.

 

I get the same error with similar related files. The attached gzip file
uncompresses correctly with &#34;gunzip -c&#34; &#40;gunzip version 1.3.12&#41;. The
file as uncompressed with &#34;gunzip -c&#34; is 20681384 bytes.

 

Any help would be appreciated.

 

Regards,

Peter Lamb

 
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;05:02:12&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 21 21:04:20 2008, Peter.Lamb@csiro.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Distribution: IO-Compress-Zlib-2.012
&gt; 
&gt; Perl version: This is perl, v5.10.0 built for cygwin-thread-multi-64int
&gt; &#40;with 6 registered patches, see perl -V for more detail&#41;
&gt; 
&gt; OS: CYGWIN_NT-5.1 PREGIO-BT 1.5.25&#40;0.156/4/2&#41; 2008-06-12 19:34 i686
&gt; Cygwin &#40;running in Win XP 2002 SP 2&#41;
&gt; 
&gt;  
&gt; 
&gt; When I try to ungzip the attached gzip file with IO::Uncompress::Gunzip
&gt; using the attached script, I get:
&gt; 
&gt;  
&gt; 
&gt; Out of memory during &#34;large&#34; request for 536875008 bytes, total sbrk&#40;&#41;
&gt; is 269887488 bytes at
&gt; /usr/lib/perl5/5.10/i686-cygwin/IO/Uncompress/Adapter/Inflate.pm line
&gt; 60.
&gt; 
&gt;  
&gt; 
&gt; I get the same error with similar related files. The attached gzip file
&gt; uncompresses correctly with &#34;gunzip -c&#34; &#40;gunzip version 1.3.12&#41;. The
&gt; file as uncompressed with &#34;gunzip -c&#34; is 20681384 bytes.
&gt; 
</div>
Hi Peter

I tried your test script on a Linux box, a Solaris box and a Windows
box. All worked fine. I don&#39;t have access to a Cygwin box.

We need to see if the problem is with the uncompression or the way
filehandles work on Cygwin. Can you try running this and report back on
what you get please?

#!/usr/bin/perl

use strict;
use warnings;

use IO::Uncompress::Gunzip qw&#40;gunzip $GunzipError&#41; ;

my $gz = new IO::Uncompress::Gunzip &#39;linux.bin.gz&#39;
    or die &#34;Cannot gunzip: $GunzipError\n&#34;;


my $buffer;
my $out;

while &#40;$gz-&gt;read&#40;$buffer&#41;&#41;
{
    $out += length $buffer;
}

print &#34;Got $out buyes\n&#34;;

cheers
Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;05:02:39&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;19:28:14&nbsp;2008</span>
    <span class="description">Peter.Lamb [...] csiro.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Jul 2008 09:27:02 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-IO-Compress-Zlib [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Peter.Lamb [...] csiro.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Paul, thanks for getting back to me so quickly.

I took the liberty of moving your print statement into the read loop in
the code you posted, because otherwise all you see is the &#34;Out of
memory&#34; message as with my original post; I also set autoflush on
STDOUT. The script as I ran it and the output are attached. I had tried
doing much the same myself to see if I could get a handle on the
problem, but I got nowhere. The uncompressed file is about 20MB; the
ungzip dies about 2.5MB into the uncompressed stream.

./gunzipbug1.pl linux.bin.gz  &gt; gunzipbug1.out 2&gt;&#38;1

If you want to try the problem yourself, you can run Cygwin on your
Windows box &#40;free download from <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cygwin.com/&#41;">http://www.cygwin.com/&#41;</a></span>; it&#39;s a Unix
compatibility shell for Windows, and I&#39;m running it under Win XP 2002
SP2.

I don&#39;t know why you got two copies of the bug report; I only have a
record off a single email message to bug-IO-Compress-Zlib@rt.cpan.org,
but I did get two automated responses with the two ticket numbers 37833
and 37834. Sorry for any inconvenience.

Anyway, if there are more tests you&#39;d like me to run, please let me
know.

Cheers,
Peter

Dr Peter Lamb
Project Leader
Information Engineering Laboratory
CSIRO ICT Centre
Innovative ICT transforming Australian industries

Post: PO Box 664, Canberra, ACT 2601, Australia
Office: Computer Science &#38; Information Technology Building &#40;Building
108&#41;
        Australian National University, Acton, ACT 2601
T: +61 2 6216 7047, F: +61 2 6216 7111
www.ict.csiro.au
 
 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Paul Marquess via RT [mailto:bug-IO-Compress-Zlib@rt.cpan.org]
&gt; Sent: Tuesday, 22 July 2008 19:03
&gt; To: Lamb, Peter &#40;ICT Centre, Acton&#41;
&gt; Subject: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in
&gt; IO::Uncompress::Gunzip
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=37833">http://rt.cpan.org/Ticket/Display.html?id=37833</a></span> &gt;
&gt; 
&gt; On Mon Jul 21 21:04:20 2008, Peter.Lamb@csiro.au wrote:
<div class="message-stanza open">&gt; &gt; Distribution: IO-Compress-Zlib-2.012
&gt; &gt;
&gt; &gt; Perl version: This is perl, v5.10.0 built for
</div></div>cygwin-thread-multi-64int
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &#40;with 6 registered patches, see perl -V for more detail&#41;
&gt; &gt;
&gt; &gt; OS: CYGWIN_NT-5.1 PREGIO-BT 1.5.25&#40;0.156/4/2&#41; 2008-06-12 19:34 i686
&gt; &gt; Cygwin &#40;running in Win XP 2002 SP 2&#41;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; When I try to ungzip the attached gzip file with
</div></div>IO::Uncompress::Gunzip
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; using the attached script, I get:
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Out of memory during &#34;large&#34; request for 536875008 bytes, total
</div></div>sbrk&#40;&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; is 269887488 bytes at
&gt; &gt; /usr/lib/perl5/5.10/i686-cygwin/IO/Uncompress/Adapter/Inflate.pm
</div></div>line
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 60.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; I get the same error with similar related files. The attached gzip
</div></div>file
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; uncompresses correctly with &#34;gunzip -c&#34; &#40;gunzip version 1.3.12&#41;. The
&gt; &gt; file as uncompressed with &#34;gunzip -c&#34; is 20681384 bytes.
&gt; &gt;
</div>&gt; 
&gt; Hi Peter
&gt; 
&gt; I tried your test script on a Linux box, a Solaris box and a Windows
&gt; box. All worked fine. I don&#39;t have access to a Cygwin box.
&gt; 
&gt; We need to see if the problem is with the uncompression or the way
&gt; filehandles work on Cygwin. Can you try running this and report back
</div>on
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; what you get please?
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; 
&gt; use IO::Uncompress::Gunzip qw&#40;gunzip $GunzipError&#41; ;
&gt; 
&gt; my $gz = new IO::Uncompress::Gunzip &#39;linux.bin.gz&#39;
&gt;     or die &#34;Cannot gunzip: $GunzipError\n&#34;;
&gt; 
&gt; 
&gt; my $buffer;
&gt; my $out;
&gt; 
&gt; while &#40;$gz-&gt;read&#40;$buffer&#41;&#41;
&gt; {
&gt;     $out += length $buffer;
&gt; }
&gt; 
&gt; print &#34;Got $out buyes\n&#34;;
&gt; 
&gt; cheers
&gt; Paul
&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/488893/241845/gunzipbug1.out">Download gunzipbug1.out</a><br />
<span class="downloadcontenttype">application/octet-stream 1.3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;24&nbsp;04:53:39&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Peter

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I took the liberty of moving your print statement into the read loop in
&gt; the code you posted, because otherwise all you see is the &#34;Out of
&gt; memory&#34; message as with my original post; I also set autoflush on
&gt; STDOUT. The script as I ran it and the output are attached. I had tried
&gt; doing much the same myself to see if I could get a handle on the
&gt; problem, but I got nowhere. The uncompressed file is about 20MB; the
&gt; ungzip dies about 2.5MB into the uncompressed stream.
&gt; 
&gt; ./gunzipbug1.pl linux.bin.gz  &gt; gunzipbug1.out 2&gt;&#38;1
&gt; 
&gt; If you want to try the problem yourself, you can run Cygwin on your
&gt; Windows box &#40;free download from <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cygwin.com/&#41;">http://www.cygwin.com/&#41;</a></span>; it&#39;s a Unix
&gt; compatibility shell for Windows, and I&#39;m running it under Win XP 2002
&gt; SP2.
</div>
I&#39;ve used cygwin before, and if I had enough space on my work laptop I&#39;d
install it. :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know why you got two copies of the bug report; I only have a
&gt; record off a single email message to bug-IO-Compress-Zlib@rt.cpan.org,
&gt; but I did get two automated responses with the two ticket numbers 37833
&gt; and 37834. Sorry for any inconvenience.
</div>
No problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway, if there are more tests you&#39;d like me to run, please let me
&gt; know.
</div>
The output you&#39;ve sent me has given me enough info to spot the problem.

  ...
  Got 2554049 buyes
  Out of memory during &#34;large&#34; request for 536875008 bytes...

If I look at the output from running a slight variant on the same script
&#40;I output the number of bytes uncompressed in each call to read&#41; on a
Linux box this is what I see

  ...
  Got 52941 bytes    -&gt; total 2554049 bytes
  Got 10499407 bytes -&gt; total 13053456 bytes

Notice the size of the uncompressed data in the call after the last
successful call you got. It looks like cygwin is failing when it is
trying to create a 10 meg output buffer. Not sure why cygwin reports a
request for 500meg though.

So here is where I think the problem lies - at the moment my code reads
the compressed data in 4k chunks. It will carry out uncompression on
that input buffer until it is exhausted, regardless of how much
uncompressed data that will generate - the output buffer will be grown
if needed. So basically the output buffer size is unbounded.

The obvious fix for this is for me to make the output buffer size
bounded. Unfortunately that will take a bit of work on my part.

In the interim if you just want to uncompress a file you can use this

    system &#34;gunzip -c $inputfile &gt;$outputfile&#34;;

Or if you need to process the contents, this

    open F, &#34;gunzip -c $inputfile|&#34;;
    while &#40;&lt;F&gt;&#41;
    {
        # do something
    }

Are those workarounds good enough for your purposes?

Paul 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;24&nbsp;20:46:00&nbsp;2008</span>
    <span class="description">Peter.Lamb [...] csiro.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Jul 2008 10:45:24 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-IO-Compress-Zlib [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Peter.Lamb [...] csiro.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Paul. Thanks for the analysis of the problem.

I think I may be able to help you create files that will let you
experiment with the problem more if you want.

The linux.bin.gz file is the uClinux kernel for a Beyonwiz PVR, and it
has the PVR&#39;s root file system embedded in it as a ROMFS. The &#34;real&#34;
code that I&#39;m running extracts and unpacks the ROMFS &#40;and also lets me
pack a new ROMFS into the space where the old one sat&#41;. The root ROMFS
contains a 10MB file, /bank0, containing all null bytes. My
understanding is that it&#39;s mmapped to provide an allocation arena for
malloc. I think that it&#39;s the unpacking of this large contiguous chunk
of null bytes that&#39;s forcing the large buffer size in Gunzip. I don&#39;t
know why the malloc of that in perl is choking.

I suspect that it may be possible to create a file that contains a large
null-ed out block to trigger the same problem. Unfortunately, a file
made just by compressing a single 10MB chunk of zeros unpacks just fine:
        dd if=/dev/zero bs=1k count=10240 | gzip -c &gt; null.gz

Unfortunately, your workaround won&#39;t do the job I need. I want the code
to be able to run on a Windows machine that doesn&#39;t have g[un]zip.
Fortunately, the workaround in the attached script does work. However,
there doesn&#39;t seem to be any way to pass the read&#40;&#41; buffer length
through to Gunzip::gunzip&#40;&#41;. The workaround also works in my &#34;real&#34;
code.

Thanks for your help.

Peter

Dr Peter Lamb
Project Leader
Information Engineering Laboratory
CSIRO ICT Centre
Innovative ICT transforming Australian industries

Post: PO Box 664, Canberra, ACT 2601, Australia
Office: Computer Science &#38; Information Technology Building &#40;Building
108&#41;
        Australian National University, Acton, ACT 2601
T: +61 2 6216 7047, F: +61 2 6216 7111
www.ict.csiro.au
 
 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Paul Marquess via RT [mailto:bug-IO-Compress-Zlib@rt.cpan.org]
&gt; Sent: Thursday, 24 July 2008 18:54
&gt; To: Lamb, Peter &#40;ICT Centre, Acton&#41;
&gt; Subject: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in
&gt; IO::Uncompress::Gunzip
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=37833">http://rt.cpan.org/Ticket/Display.html?id=37833</a></span> &gt;
&gt; 
&gt; Hi Peter
&gt; 
<div class="message-stanza open">&gt; &gt; I took the liberty of moving your print statement into the read loop
</div></div>in
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the code you posted, because otherwise all you see is the &#34;Out of
&gt; &gt; memory&#34; message as with my original post; I also set autoflush on
&gt; &gt; STDOUT. The script as I ran it and the output are attached. I had
</div></div>tried
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; doing much the same myself to see if I could get a handle on the
&gt; &gt; problem, but I got nowhere. The uncompressed file is about 20MB; the
&gt; &gt; ungzip dies about 2.5MB into the uncompressed stream.
&gt; &gt;
&gt; &gt; ./gunzipbug1.pl linux.bin.gz  &gt; gunzipbug1.out 2&gt;&#38;1
&gt; &gt;
&gt; &gt; If you want to try the problem yourself, you can run Cygwin on your
&gt; &gt; Windows box &#40;free download from <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cygwin.com/&#41;">http://www.cygwin.com/&#41;</a></span>; it&#39;s a Unix
&gt; &gt; compatibility shell for Windows, and I&#39;m running it under Win XP
</div></div>2002
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; SP2.
</div>&gt; 
&gt; I&#39;ve used cygwin before, and if I had enough space on my work laptop
</div>I&#39;d
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; install it. :-&#41;
&gt; 
<div class="message-stanza open">&gt; &gt; I don&#39;t know why you got two copies of the bug report; I only have a
&gt; &gt; record off a single email message to
</div></div>bug-IO-Compress-Zlib@rt.cpan.org,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; but I did get two automated responses with the two ticket numbers
</div></div>37833
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; and 37834. Sorry for any inconvenience.
</div>&gt; 
&gt; No problem.
&gt; 
<div class="message-stanza open">&gt; &gt; Anyway, if there are more tests you&#39;d like me to run, please let me
&gt; &gt; know.
</div>&gt; 
&gt; The output you&#39;ve sent me has given me enough info to spot the
</div>problem.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;   ...
&gt;   Got 2554049 buyes
&gt;   Out of memory during &#34;large&#34; request for 536875008 bytes...
&gt; 
&gt; If I look at the output from running a slight variant on the same
</div>script
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;I output the number of bytes uncompressed in each call to read&#41; on a
&gt; Linux box this is what I see
&gt; 
&gt;   ...
&gt;   Got 52941 bytes    -&gt; total 2554049 bytes
&gt;   Got 10499407 bytes -&gt; total 13053456 bytes
&gt; 
&gt; Notice the size of the uncompressed data in the call after the last
&gt; successful call you got. It looks like cygwin is failing when it is
&gt; trying to create a 10 meg output buffer. Not sure why cygwin reports a
&gt; request for 500meg though.
&gt; 
&gt; So here is where I think the problem lies - at the moment my code
</div>reads
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the compressed data in 4k chunks. It will carry out uncompression on
&gt; that input buffer until it is exhausted, regardless of how much
&gt; uncompressed data that will generate - the output buffer will be grown
&gt; if needed. So basically the output buffer size is unbounded.
&gt; 
&gt; The obvious fix for this is for me to make the output buffer size
&gt; bounded. Unfortunately that will take a bit of work on my part.
&gt; 
&gt; In the interim if you just want to uncompress a file you can use this
&gt; 
&gt;     system &#34;gunzip -c $inputfile &gt;$outputfile&#34;;
&gt; 
&gt; Or if you need to process the contents, this
&gt; 
&gt;     open F, &#34;gunzip -c $inputfile|&#34;;
&gt;     while &#40;&lt;F&gt;&#41;
&gt;     {
&gt;         # do something
&gt;     }
&gt; 
&gt; Are those workarounds good enough for your purposes?
&gt; 
&gt; Paul
&gt; 
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;08:09:38&nbsp;2009</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Peter, 

just in case you are still interested in this issue, I&#39;ve uploaded a new
version of IO::Uncompress::Gunzip &#40;version 2.017&#41; that fixes the
problem. Note - IO::Uncompress::Gunzip now lives in the IO-Compress
distribution.

I&#39;m going to close this issue, so if you do find a problem, please drop
me a line or create a new issue.

cheers
Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;08:25:49&nbsp;2009</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;21:25:40&nbsp;2009</span>
    <span class="description">Peter.Lamb [...] csiro.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Apr 2009 11:25:17 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-IO-Compress-Zlib [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Peter.Lamb [...] csiro.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, Paul. I&#39;ll try updating my version of IO::Uncompress::Gunzip and see if I can remove my workarounds for this problem.

I&#39;ve also noticed that the Perl version of IO::Uncompress::Gzip I was using doesn&#39;t compress as well as the gzip program does for the same compression level settings. I&#39;ve had to work around that by using &#34;system &#39;gzip&#39;, ...&#34; because the application is in compressing firmware for a flash device where space is tight, and I can&#39;t afford having the compressed file grow by more than a few kB. It currently is several tens of kB bigger &#40;total compressed size about 8MB&#41;.

Any ideas?

Regards,
Peter

 

Dr Peter Lamb
Project Leader
Information Engineering Laboratory
CSIRO ICT Centre
Innovative ICT transforming Australian industries

Post: PO Box 664, Canberra, ACT 2601, Australia
Office: Computer Science &#38; Information Technology Building &#40;Building 108&#41;
        Australian National University, Acton, ACT 2601
T: +61 2 6216 7047, F: +61 2 6216 7111
www.ict.csiro.au

 


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Paul Marquess via RT [mailto:bug-IO-Compress-Zlib@rt.cpan.org] 
Sent: Monday, 6 April 2009 22:10
To: Lamb, Peter &#40;ICT Centre, Acton&#41;
Subject: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=37833">https://rt.cpan.org/Ticket/Display.html?id=37833</a></span> &gt;

Hi Peter, 

just in case you are still interested in this issue, I&#39;ve uploaded a new
version of IO::Uncompress::Gunzip &#40;version 2.017&#41; that fixes the
problem. Note - IO::Uncompress::Gunzip now lives in the IO-Compress
distribution.

I&#39;m going to close this issue, so if you do find a problem, please drop
me a line or create a new issue.

cheers
Paul
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;21:25:42&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;03:12:35&nbsp;2009</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 27 21:25:40 2009, Peter.Lamb@csiro.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks, Paul. I&#39;ll try updating my version of IO::Uncompress::Gunzip
&gt;    and see if I can remove my workarounds for this problem.
</div>
Thanks - if you have any issues with the changes, please get back to me.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve also noticed that the Perl version of IO::Uncompress::Gzip I was
&gt;    using doesn&#39;t compress as well as the gzip program does for the
&gt;    same compression level settings. I&#39;ve had to work around that by
&gt;    using &#34;system &#39;gzip&#39;, ...&#34; because the application is in
&gt;    compressing firmware for a flash device where space is tight, and I
&gt;    can&#39;t afford having the compressed file grow by more than a few kB.
&gt;    It currently is several tens of kB bigger &#40;total compressed size
&gt;    about 8MB&#41;.
&gt; 
&gt; Any ideas?
</div>
Have you set the &#34;Level&#34; option when creating the gzip object?

my $gz = new IO::Uncompress::Gunzip &#39;linux.bin.gz&#39;, 
Level =&gt; Z_BEST_COMPRESSION
or die &#34;Cannot gunzip: $GunzipError\n&#34;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;03:16:46&nbsp;2009</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Damn - accidentally pressed send before I had finished the reply.

I assume you set the &#34;Level&#34; option when creating the gzip object?

my $gz = new IO::Compress::Gzip &#39;linux.bin.gz&#39;, 
               Level =&gt; Z_BEST_COMPRESSION
      or die &#34;Cannot gunzip: $GzipError\n&#34;;

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;03:24:56&nbsp;2009</span>
    <span class="description">Peter.Lamb [...] csiro.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Apr 2009 17:17:29 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-IO-Compress-Zlib [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Peter.Lamb [...] csiro.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, Paul. Thanks for getting back.

Yes, I have both tried leaving the level unset, and compared it with gzip with the level unset, and tried setting it to the maximum &#40;I used the numeric 9 rather than the symbolic value&#41; and compared it to gzip with the level set. It&#39;s been a while since I tried testing this. I&#39;ll give it another go and give you some proper examples.

I assume you meant IO::Uncompress::Gzip rather than IO::Uncompress::Gunzip in your example.

Peter Lamb

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Paul Marquess via RT [mailto:bug-IO-Compress-Zlib@rt.cpan.org] 
Sent: Tuesday, 28 April 2009 17:13
To: Lamb, Peter &#40;ICT Centre, Acton&#41;
Subject: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=37833">https://rt.cpan.org/Ticket/Display.html?id=37833</a></span> &gt;

On Mon Apr 27 21:25:40 2009, Peter.Lamb@csiro.au wrote:
<div class="message-stanza open">&gt; Thanks, Paul. I&#39;ll try updating my version of IO::Uncompress::Gunzip
&gt;    and see if I can remove my workarounds for this problem.
</div>
Thanks - if you have any issues with the changes, please get back to me.

<div class="message-stanza open">&gt; I&#39;ve also noticed that the Perl version of IO::Uncompress::Gzip I was
&gt;    using doesn&#39;t compress as well as the gzip program does for the
&gt;    same compression level settings. I&#39;ve had to work around that by
&gt;    using &#34;system &#39;gzip&#39;, ...&#34; because the application is in
&gt;    compressing firmware for a flash device where space is tight, and I
&gt;    can&#39;t afford having the compressed file grow by more than a few kB.
&gt;    It currently is several tens of kB bigger &#40;total compressed size
&gt;    about 8MB&#41;.
&gt; 
&gt; Any ideas?
</div>
Have you set the &#34;Level&#34; option when creating the gzip object?

my $gz = new IO::Uncompress::Gunzip &#39;linux.bin.gz&#39;, 
Level =&gt; Z_BEST_COMPRESSION
or die &#34;Cannot gunzip: $GunzipError\n&#34;;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;03:49:42&nbsp;2009</span>
    <span class="description">Peter.Lamb [...] csiro.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Apr 2009 17:49:21 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-IO-Compress-Zlib [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Peter.Lamb [...] csiro.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I assume you set the &#34;Level&#34; option when creating the gzip object?
</div>:oops: Yes.

I&#39;ll send you the information about the compression differences I see from my home email &#40;peter_lamb2001@yahoo.com.au&#41; rather than this one, my work email.

Thanks,
Peter


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Paul Marquess via RT [mailto:bug-IO-Compress-Zlib@rt.cpan.org] 
Sent: Tuesday, 28 April 2009 17:17
To: Lamb, Peter &#40;ICT Centre, Acton&#41;
Subject: [rt.cpan.org #37833] &#34;Out of memory error&#34; unzipping file in IO::Uncompress::Gunzip 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=37833">https://rt.cpan.org/Ticket/Display.html?id=37833</a></span> &gt;

Damn - accidentally pressed send before I had finished the reply.

I assume you set the &#34;Level&#34; option when creating the gzip object?

my $gz = new IO::Compress::Gzip &#39;linux.bin.gz&#39;, 
               Level =&gt; Z_BEST_COMPRESSION
      or die &#34;Cannot gunzip: $GzipError\n&#34;;

Paul
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;17:12:23&nbsp;2009</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Peter,

the compression size difference between my module &#40;which uses the zlib
library&#41; and the command-line gzip program is going to be down to the
different implementations of the deflate algorithm. The gzip program was
written well before the zlib library, and although the same set of
people were involved in the both gzip &#38; zlib, the implementations are
not identical.

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;05&nbsp;12:36:21&nbsp;2009</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
