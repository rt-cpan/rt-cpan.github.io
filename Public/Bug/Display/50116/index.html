<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #50116 for CGI-Session: Cookies Expiration Timestamp</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #50116 for CGI-Session: Cookies Expiration Timestamp</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI-Session/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Session">CGI-Session CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">50116</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">deleted</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI-Session/Active/">CGI-Session</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
noobpanda
(no email address)

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-5872-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.42    </td>
  </tr>
  <tr id="CF-5873-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;01:45:15&nbsp;2009</span>
    <span class="description">noobpanda -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Cookies Expiration Timestamp</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think CGI::Session didn&#39;t convert the time correctly from PDT to GMT
in my case.  Please correct me if I am wrong about how CGI::Session
works.  Thank you.

Calls used:
$session = new CGI::Session&#40;&#34;driver:mysql&#34;, undef,
{DataSource=&gt;&#39;dbi:mysql:testdb&#39;, User=&gt;&#39;test&#39;, Password=&gt;&#39;test&#39;}&#41;;
$session-&gt;expire&#40;&#34;+5m&#34;&#41;;

When I called a perl script to get a HTTP cookie with an expiration date
&#40;in 5 minutes&#41;, I was surprised to see the result that showed that the
expiration date passed from CGI::Session to my browser is not right. 
Actually, it gets the time from my Linux system clock and just add 5
minutes to it.  Then, it&#39;s converted to Unix Time.  This is supposed to
be converted to GMT then Unix Time, but it never happened.  As a result,
IE8 and Google Chrome failed to keep a cookie with 5 min expiration date
because they are already expired &#40;it wasn&#39;t converted to GMT&#41;.  So, when
IE8 and Chrome compared the expiration date and current date in GMT,
they determined that they were expired. Interestingly, Firefox somehow
corrected the expiration date on its own and kept the cookie successfully.

1&#41; Centos 5.3 x86_64&#39;s current time: Tue Sep 29 15:32:01 PDT 2009

2&#41; A session copied from mysql:
| id                               | a_session    |
| 128aada22c4cb656924e36a5c5ff3acd | $D = {&#39;_SESSION_ETIME&#39; =&gt;
300,&#39;_SESSION_ID&#39; =&gt; &#39;128aada22c4cb656924e36a5c5ff3acd&#39;,&#39;_SESSION_ATIME&#39;
=&gt; 1254263521,&#39;_SESSION_REMOTE_ADDR&#39; =&gt; &#39;192.168.2.12&#39;,&#39;_SESSION_CTIME&#39;
=&gt; 1254263521};;$D                                |

3&#41; Packet Capture of HTTP containing Set-Cookie:
Set-Cookie: CGISESSID=128aada22c4cb656924e36a5c5ff3acd; path=/;
expires=Tue, 29-Sep-2009 22:37:01 GMT\r\n

4&#41; result: IE8 and Google Chrome failed to keep the cookies because they
figured they are expired.  Also, the expiration date isn&#39;t converted to
GMT by CGI::Session.  Firefox had no problem.

I look forward to hearing from you soon about this issue.  I hope we&#39;ll
resolve this issue. Thank you very much.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;01:56:27&nbsp;2009</span>
    <span class="description">ron [...] savage.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #50116] Cookies Expiration Timestamp</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Sep 2009 15:56:01 +1000 &#40;EST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ron Savage&#34; &lt;ron [...] savage.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi noobpanda

noobpanda via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Sep 30 01:45:15 2009: Request 50116 was acted upon.
</div>[snip]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think CGI::Session didn&#39;t convert the time correctly from PDT to GMT
&gt; in my case.  Please correct me if I am wrong about how CGI::Session
&gt; works.  Thank you.
</div>
Thanx for the detailed info.

CGI::Session has no code in it to convert times. It passes such data to
CGI::Cookie.

Could you please write a little demo using CGI and CGI::Cookie, to output
a web page and cookie.

I thing you&#39;ll find that&#39;s where the problem lies.

Of course, if it turns out CGI::Session is at fault, we&#39;ll patch it.

-- 
Ron Savage
ron@savage.net.au
<span class="clickylink"><a target="new" rel="nofollow" href="http://savage.net.au/">http://savage.net.au/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;01:56:27&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;01:56:58&nbsp;2009</span>
    <span class="description">noobpanda -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oh man!! Please delete this bug report.  My brain was so dead.  I found
out that my clock on my Linux server is way off by several hours.  I
apologize for reporting a bad bug report.  Sorry!

Thank you.

On Wed Sep 30 01:45:15 2009, noobpanda wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think CGI::Session didn&#39;t convert the time correctly from PDT to GMT
&gt; in my case.  Please correct me if I am wrong about how CGI::Session
&gt; works.  Thank you.
&gt; 
&gt; Calls used:
&gt; $session = new CGI::Session&#40;&#34;driver:mysql&#34;, undef,
&gt; {DataSource=&gt;&#39;dbi:mysql:testdb&#39;, User=&gt;&#39;test&#39;, Password=&gt;&#39;test&#39;}&#41;;
&gt; $session-&gt;expire&#40;&#34;+5m&#34;&#41;;
&gt; 
&gt; When I called a perl script to get a HTTP cookie with an expiration date
&gt; &#40;in 5 minutes&#41;, I was surprised to see the result that showed that the
&gt; expiration date passed from CGI::Session to my browser is not right. 
&gt; Actually, it gets the time from my Linux system clock and just add 5
&gt; minutes to it.  Then, it&#39;s converted to Unix Time.  This is supposed to
&gt; be converted to GMT then Unix Time, but it never happened.  As a result,
&gt; IE8 and Google Chrome failed to keep a cookie with 5 min expiration date
&gt; because they are already expired &#40;it wasn&#39;t converted to GMT&#41;.  So, when
&gt; IE8 and Chrome compared the expiration date and current date in GMT,
&gt; they determined that they were expired. Interestingly, Firefox somehow
&gt; corrected the expiration date on its own and kept the cookie successfully.
&gt; 
&gt; 1&#41; Centos 5.3 x86_64&#39;s current time: Tue Sep 29 15:32:01 PDT 2009
&gt; 
&gt; 2&#41; A session copied from mysql:
&gt; | id                               | a_session    |
&gt; | 128aada22c4cb656924e36a5c5ff3acd | $D = {&#39;_SESSION_ETIME&#39; =&gt;
&gt; 300,&#39;_SESSION_ID&#39; =&gt; &#39;128aada22c4cb656924e36a5c5ff3acd&#39;,&#39;_SESSION_ATIME&#39;
&gt; =&gt; 1254263521,&#39;_SESSION_REMOTE_ADDR&#39; =&gt; &#39;192.168.2.12&#39;,&#39;_SESSION_CTIME&#39;
&gt; =&gt; 1254263521};;$D                                |
&gt; 
&gt; 3&#41; Packet Capture of HTTP containing Set-Cookie:
&gt; Set-Cookie: CGISESSID=128aada22c4cb656924e36a5c5ff3acd; path=/;
&gt; expires=Tue, 29-Sep-2009 22:37:01 GMT\r\n
&gt; 
&gt; 4&#41; result: IE8 and Google Chrome failed to keep the cookies because they
&gt; figured they are expired.  Also, the expiration date isn&#39;t converted to
&gt; GMT by CGI::Session.  Firefox had no problem.
&gt; 
&gt; I look forward to hearing from you soon about this issue.  I hope we&#39;ll
&gt; resolve this issue. Thank you very much.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;01:58:45&nbsp;2009</span>
    <span class="description">ron [...] savage.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #50116] Cookies Expiration Timestamp</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Sep 2009 15:58:21 +1000 &#40;EST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ron Savage&#34; &lt;ron [...] savage.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi noobpanda

noobpanda via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: CGI-Session
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=50116">https://rt.cpan.org/Ticket/Display.html?id=50116</a></span> &gt;
&gt;
&gt; Oh man!! Please delete this bug report.  My brain was so dead.  I found
&gt; out that my clock on my Linux server is way off by several hours.  I
&gt; apologize for reporting a bad bug report.  Sorry!
</div>
Hahaha. No wonder pandas are dying out :-&#41;&#41;&#41;&#41;!

-- 
Ron Savage
ron@savage.net.au
<span class="clickylink"><a target="new" rel="nofollow" href="http://savage.net.au/">http://savage.net.au/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;09:29:14&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
