<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30945 for SOAP-Lite: SOAP::Serializer::envelope: Client Denied access to method</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30945 for SOAP-Lite: SOAP::Serializer::envelope: Client Denied access to method</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SOAP-Lite/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SOAP-Lite">SOAP-Lite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30945</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SOAP-Lite/Active/">SOAP-Lite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pierre.girard [...] in2p3.fr

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29122-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29123-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;23&nbsp;19:42:31&nbsp;2007</span>
    <span class="description">pierre.girard [...] in2p3.fr -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SOAP::Serializer::envelope: Client Denied access to method</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Nov 2007 01:41:42 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SOAP-Lite [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pierre GIRARD &lt;pierre.girard [...] in2p3.fr&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I&#39;m using SOAP::Lite 0.69.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [pierre@localhost SOAP]$ perl -MSOAP::Lite -e &#39;print 
&gt; $SOAP::Lite::VERSION.&#34;\n&#34;;&#39;
&gt; 0.69
</div>
I noticed a problem when SOAP::Transport::HTTP::Daemon is dynamically 
binding for the first time a perl module that has already been imported 
by the perl program. In such a case, if you request the call at any 
method of this imported module, you will get a &#34;Client Denied access to 
method&#34; error.

- Problem
  That comes from a bad test at line 2500 of SOAP/Lite.pm within 
find_target method:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    2493 # TODO - sort this mess out:
&gt;    2494 # SOAP::Lite 0.60:
&gt;    2495 #  unless &#40;defined %{&#34;${class}::&#34;}&#41; {
&gt;    2496 # Patch to SOAP::Lite 0.60:
&gt;    2497 # The following patch does not work for packages defined 
&gt; within a BEGIN block
&gt;    2498 #  unless &#40;exists&#40;$INC{join &#39;/&#39;, split /::/, $class.&#39;.pm&#39;}&#41;&#41; {
&gt;    2499 # Combination of 0.60 and patch:
&gt;    2500   unless &#40;defined&#40;%{&#34;*${class}::&#34;}&#41; || exists&#40;$INC{join &#39;/&#39;, 
&gt; split /::/, $class.&#39;.pm&#39;}&#41;&#41; {
&gt;    2501     # allow all for static and only specified path for dynamic 
&gt; bindings
&gt;    2502     local @INC = &#40;&#40;$static ? @INC : &#40;&#41;&#41;, grep {!ref &#38;&#38; 
&gt; m![/\\.]!} $self-&gt;dispatch_to&#41;;
&gt;    2503     eval &#39;local $^W; &#39; . &#34;require $class&#34;;
&gt;    2504     die &#34;Failed to access class &#40;$class&#41;: $@&#34; if $@;
&gt;    2505     $self-&gt;dispatched&#40;$class&#41; unless $static;
&gt;    2506   }
</div>Indeed, if $class was already used before executing this code, the above 
block is never performed and so, $class is never &#34;dispatched&#34;.

- Fix:
  I think that you should dispatch the class after the block:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    2500   unless &#40;defined&#40;%{&#34;*${class}::&#34;}&#41; || exists&#40;$INC{join &#39;/&#39;, 
&gt; split /::/, $class.&#39;.pm&#39;}&#41;&#41; {
&gt;    2501     # allow all for static and only specified path for dynamic 
&gt; bindings
&gt;    2502     local @INC = &#40;&#40;$static ? @INC : &#40;&#41;&#41;, grep {!ref &#38;&#38; 
&gt; m![/\\.]!} $self-&gt;dispatch_to&#41;;
&gt;    2503     eval &#39;local $^W; &#39; . &#34;require $class&#34;;
&gt;    2504     die &#34;Failed to access class &#40;$class&#41;: $@&#34; if $@;
&gt;    2505   }
&gt;    2506   $self-&gt;dispatched&#40;$class&#41; unless&#40;$static || grep 
&gt; {/^$class$/} $self-&gt;dispatched&#41; ;
</div>And then remove the useless test
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    2508   die &#34;Denied access to method &#40;$method_name&#41; in class &#40;$class&#41;&#34;
&gt;    2509     unless $static || grep {/^$class$/} $self-&gt;dispatched;
</div>
- Reproducing the problem

************ ./Modules/Hello.pm
package Hello;
sub new {
    my $class = shift;
    my $self = {};
    bless &#40;$self, $class&#41;;
    return $self;
}

sub hello {
    my $self = shift;
    my $name = shift;   
    return &#34;Hello $name&#34;;
}
1;

************ server code

use SOAP::Transport::HTTP;

my $daemon = SOAP::Transport::HTTP::Daemon
  -&gt; new &#40;LocalAddr =&gt; &#39;localhost&#39;, LocalPort =&gt; 80&#41;
  -&gt; dispatch_to&#40;&#39;./Mdules&#39;&#41;;
print &#34;Contact to SOAP server at &#34;, $daemon-&gt;url, &#34;\n&#34;;
$daemon-&gt;handle;


************ Emulate Hello-&gt;new&#40;&#41;-&gt;hello&#40;&#34;pierre&#34;&#41; by using curl to send 
a SOAP message
curl --stderr /dev/null \
-H &#34;Content-Type: text/xml; charset=utf-8&#34; \
-H &#34;SOAPAction: \&#34;urn:Hello#hello\&#34;&#34; \
-d &#34;&lt;SOAP-ENV:Envelope 
SOAP-ENV:encodingStyle=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>\&#34;
  xmlns:SOAP-ENV=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>\&#34;
  xmlns:namesp1=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespaces.soaplite.com/perl">http://namespaces.soaplite.com/perl</a></span>\&#34;
  xmlns:xsi=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>\&#34;
  xmlns:xsd=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</a></span>\&#34; 
xmlns:SOAP-ENC=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>\&#34;&gt;
&lt;SOAP-ENV:Header&gt;
&lt;/SOAP-ENV:Header&gt;
&lt;SOAP-ENV:Body&gt;
&lt;hello xmlns=\&#34;urn:Hello\&#34;&gt;
    &lt;!-- FAILURE COMES FROM THERE:
        The first argument is a Hello instance.
        So, in order to evaluate the hello method arguments, SOAP server 
will prematurely
        require Hello.pm module without declaring it as a dispatched 
module of the server.
        the hello call will then fail because Hello module is already 
used but it is not part of the dispatched module.
    --&gt;
        &lt;Hello xsi:type=\&#34;namesp1:Hello\&#34;/&gt;
        &lt;c-gensym3 xsi:type=\&#34;xsd:string\&#34;&gt;Herong&lt;/c-gensym3&gt;
&lt;/hello&gt;
&lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;&#34; <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:80">http://localhost:80</a></span>

************ Result
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;soap:Envelope 
xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34; 
xmlns:soapenc=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34; 
xmlns:xsd=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</a></span>&#34; 
soap:encodingStyle=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34; 
xmlns:soap=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>&#34;&gt;&lt;soap:Body&gt;&lt;soap:Fault&gt;&lt;faultcode&gt;soap:Client&lt;/faultcode&gt;&lt;faultstring&gt;Denied 
access to method &#40;hello&#41; in class &#40;Hello&#41; at 
/usr/local/lib/perl5/site_perl/5.8.8/SOAP/Lite.pm line 2509.
&lt;/faultstring&gt;&lt;faultactor&gt;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost.localdomain:1981/">http://localhost.localdomain:1981/</a></span>&lt;/faultactor&gt;&lt;/soap:Fault&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;


Hope that helps,

Pierre
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;24&nbsp;14:27:28&nbsp;2007</span>
    <span class="description">pierre.girard [...] in2p3.fr -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #30945]  Some additional clarifications and a quick fix</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Nov 2007 20:26:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SOAP-Lite [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pierre GIRARD &lt;pierre.girard [...] in2p3.fr&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello again,

Investigating a bit more about this problem, I understood better the 
problem:

At line 2500:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2500   unless &#40;defined&#40;%{&#34;*${class}::&#34;}&#41; 
&gt;       || exists&#40;$INC{join &#39;/&#39;,split /::/, $class.&#39;.pm&#39;}&#41;&#41; {
</div>you assume that &#39;defined&#40;%{&#34;${class}::&#34;}&#39; is false when handling the 
first SOAP message requiring this $class, but it can be true because of 
2 reasons at least: 

1&#41; For any reason, you had to use the target module &#40;Hello module here&#41; 
in your server code before handling any SOAP message referring to this 
module.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use SOAP::Lite trace =&gt; [ &#39;all&#39; ];
&gt; use SOAP::Transport::HTTP;
&gt; use Modules::Hello
&gt;
&gt; # VIC &#40;Very Importnt Code&#41;:
&gt; # make my server very polite by making it say &#39;hello&#39; when starting
&gt; print Hello-&gt;new-&gt;hello&#40;&#39;Pierre&#39;&#41;.&#34;\n&#34;;  
&gt;
&gt; # Then, any SOAP message referring to any Hello method will fail.
&gt; my $daemon = SOAP::Transport::HTTP::Daemon
&gt;     -&gt; new &#40;LocalAddr =&gt; &#39;localhost&#39;, LocalPort =&gt; 80&#41;
&gt;     -&gt; dispatch_to&#40;&#39;./Modules&#39;&#41;;
</div>
2&#41; For some reason, a statement &#34;bless&#40;$res =&gt; $class&#41;&#34; was prematurely 
executed. For instance, this the case with the SOAP message below:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;SOAP-ENV:Envelope 
&gt; SOAP-ENV:encodingStyle=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34;
&gt;   xmlns:SOAP-ENV=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>&#34;
&gt;   xmlns:namesp1=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespaces.soaplite.com/perl">http://namespaces.soaplite.com/perl</a></span>&#34;
&gt;   xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;
&gt;   xmlns:xsd=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</a></span>&#34; 
&gt; xmlns:SOAP-ENC=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34;&gt;
&gt; &lt;SOAP-ENV:Header&gt;
&gt; &lt;/SOAP-ENV:Header&gt;
&gt; &lt;SOAP-ENV:Body&gt;
&gt; &lt;hello xmlns=&#34;urn:Hello&#34;&gt;
&gt;         &lt;Hello xsi:type=&#34;namesp1:Hello&#34;/&gt;
&gt;         &lt;c-gensym3 xsi:type=&#34;xsd:string&#34;&gt;Herong&lt;/c-gensym3&gt;
&gt; &lt;/hello&gt;
&gt; &lt;/SOAP-ENV:Body&gt;
&gt; &lt;/SOAP-ENV:Envelope&gt;
</div>Indeed, by default, when decoding the value of first argument &#34;&lt;Hello 
xsi:type=&#34;namesp1:Hello&#34;/&gt;&#34;, a hash will be blessed into &#34;Hello&#34;.  
Consequently, &#39;defined&#40;%{&#34;*Hello::&#34;} will be true, even if Hello package 
has not yet been required and then, its methods are not yet available.

Proposed solutions:

- To solve 1st case, take the class dispatching out of &#39;unless&#39; block, 
as proposed in my previous message.
- To solve 2nd case, it&#39;s a bit more complicated, but we can propose 
different solutions:
  a- Don&#39;t bless into a class without checking before that the required 
class is already available.
  b- Find a better way than &#39;defined&#40;%{&#34;*${class}::&#34;}&#39; test to check the 
availability of the class

In both a&#41; and b&#41;, you need to be able to check that the class is 
already in use, but I don&#39;t know how to do it in Perl. Let me know if 
you know how to do so.

However, I can at least make your test stronger by checking whether the 
called method of the class actually exists or not by replacing 
&#39;defined&#40;%{&#34;${class}::&#34;}&#41;&#39; by &#39;exists&#40;${&#34;${class}::&#34;}{${method_name}}&#39;.

So for now, my complete quick fix to your code to deal with my problems is:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  unless &#40;exists&#40;${&#34;${class}::&#34;}{${method_name}}&#41; || exists&#40;$INC{join 
&gt; &#39;/&#39;, split /::/, $class.&#39;.pm&#39;}&#41;&#41; {
&gt;     # allow all for static and only specified path for dynamic bindings
&gt;     local @INC = &#40;&#40;$static ? @INC : &#40;&#41;&#41;, grep {!ref &#38;&#38; m![/\\.]!} 
&gt; $self-&gt;dispatch_to&#41;;
&gt;     eval &#39;local $^W; &#39; . &#34;require $class&#34;;
&gt;     die &#34;Failed to access class &#40;$class&#41;: $@&#34; if $@;
&gt;   }
&gt;
&gt;   $self-&gt;dispatched&#40;$class&#41; unless $static || grep {/^$class$/} 
&gt; $self-&gt;dispatched;
&gt;
&gt;   return &#40;$class, $method_uri, $method_name&#41;;
</div>It seems to work.

Let me know if there is any problem with that.

Cheers

Pierre
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;04:21:53&nbsp;2007</span>
    <span class="description">kutterma [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Pierre,

in fact, for 2&#41;, there&#39;s no easy way out. 

Perl creates a packages symbol table entry by its first use, so you
can&#39;t check whether a class has been loaded properly or been created on
the fly &#40;accidentally or on purpose - class factories use this&#41;, so one
cannot trust defined&#40;%{&#34;*${class}::&#34;} for this question.

Chacking %INC is a bad idea either: It just answers whether a file with
that name has been loaded, not if the file contained the package in
question.

exists&#40;${&#34;${class}::&#34;}{${method_name}} actually checks whether the class
contains any symbol &#40;scalar, hash, array, glob, or subroutine&#41; of the
name $method_name, and should be replaced by 

exists &#38;{ &#34;$class\::$method_name } &#40;which, to my knowledge, is the
fastest way to check whether a subroutine exists in the class in question&#41;.

However, this still neglects inheritance &#40;the class in question might
inherit the method from a base class&#41;, so we would have to use
$class-&gt;can&#40;$method_name&#41;, and it neglects AUTOLOAD which simply cannot
be tested.

So problem 2&#41; looks pretty much unsolveable in current perls - it would
require the ability to check whether a class has been defind via
&#34;package $class;&#34;. 

I will, however, adress 1&#41; - but I&#39;ll have to dig into HTTP::Server to
make sure the security checks actually do what they&#39;re supposed to, so
it&#39;ll take a few days.

Thanks for reporting,

Martin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;04:21:56&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;04:50:00&nbsp;2007</span>
    <span class="description">kutterma [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Pierre,

in fact, for 2&#41;, there&#39;s no easy way out. 

Perl creates a packages symbol table entry by its first use, so you
can&#39;t check whether a class has been loaded properly or been created on
the fly &#40;accidentally or on purpose - class factories use this&#41;, so one
cannot trust defined&#40;%{&#34;*${class}::&#34;} for this question.

Chacking %INC is a bad idea either: It just answers whether a file with
that name has been loaded, not if the file contained the package in
question.

exists&#40;${&#34;${class}::&#34;}{${method_name}} actually checks whether the class
contains any symbol &#40;scalar, hash, array, glob, or subroutine&#41; of the
name $method_name, and should be replaced by 

exists &#38;{ &#34;$class\::$method_name } &#40;which, to my knowledge, is the
fastest way to check whether a subroutine exists in the class in question&#41;.

However, this still neglects inheritance &#40;the class in question might
inherit the method from a base class&#41;, so we would have to use
$class-&gt;can&#40;$method_name&#41;, and it neglects AUTOLOAD which simply cannot
be tested.

So problem 2&#41; looks pretty much unsolveable in current perls - it would
require the ability to check whether a class has been defind via
&#34;package $class;&#34;. 

I will, however, adress 1&#41; - but I&#39;ll have to dig into HTTP::Server to
make sure the security checks actually do what they&#39;re supposed to, so
it&#39;ll take a few days.

Thanks for reporting,

Martin
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
