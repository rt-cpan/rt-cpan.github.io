<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30693 for HTML-Template-Compiled: allow LOOP also for a single value</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30693 for HTML-Template-Compiled: allow LOOP also for a single value</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=HTML-Template-Compiled">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=HTML-Template-Compiled">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=HTML-Template-Compiled">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=HTML-Template-Compiled">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTML-Template-Compiled">HTML-Template-Compiled CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p><b>Note: there is a bug with caching and TMPL_INCLUDE_VAR since 0.97_004 until 0.98. either use an earlier version or upgrade to 0.98_001. Another workaround is to precompile all templates to file_cache_dir. The bug happens when including a template via INCLUDE_VAR and the template is not yet compiled or has changed.</b>
<br><br>
<b>I'm sorry if the change about aliases came quite unannounced. I didn't expect any problems since dollar signs are not allowed in template vars, but I heard from at least one case where people were doing exactly this.<br>
Please do not use unallowed characters in template vars.
Allowed are (from the HTML::Template::FAQ): Numbers, letters, '.', '/', '+', '-' and '_'.
<br>This should work in HTML::Template::Compiled::Classic.<br>
in HTML::Template::Compiled you should be only using numbers, letters and _.<br>
The dot, for example, is special. If you need to get a hash key from the template parameters with special charcaters, you can try &lt;tmpl_var _.$var$name$with$dollars &gt;<br><br>
There will be a workaround in the next version:<br>
local $HTML::Template::Compiled::Compiler::DISABLE_NEW_ALIAS = 1;
</b><br><br>

Please report any bug you find.<br>

The code is now hosted on <a href="https://github.com/perlpunk/HTML-Template-Compiled">https://github.com/perlpunk/HTML-Template-Compiled</a><br>
If you have a bug report, you can also post it there in the "Issues" section.<br>

In the bugreport, please include, if possible, the module version, perl version and a testcase that reproduces the error; that makes it easier to find the bug.
<br><br>
The issue with not reloading includes of includes should be fixed in version 0.95_003.
If you have any problems though please report!
<br><br>
Using query() and the dot syntax might not work together always. If you have a tmpL_var name="..foo" (going up the stash one level) the var foo is not detected and will not be reported by the query() function. Since the dot syntax is for dereferencing hashes and method calls the query function might not make sense anyway. I believe it is a bad idea to let the program do things if the template is using a certain variable.

<br><br>
Thanks!</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30693</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=HTML-Template-Compiled">HTML-Template-Compiled</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ac0v [...] sys-network.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-16072-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.89    </td>
  </tr>
  <tr id="CF-16073-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.93    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




13_loop_with_overload.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/388137/178253/13_loop_with_overload.t">
Wed Nov 28 18:46:58 2007 (624b) by ac0v [...] sys-network.de
</a>
</font></li>
</ul>


Compiler.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/382738/175334/Compiler.diff">
Tue Nov 13 10:34:51 2007 (198b) by ac0v [...] sys-network.de
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/382722/175316/Compiler.diff">
Tue Nov 13 10:10:01 2007 (213b) by ac0v [...] sys-network.de
</a>
</font></li>
</ul>


Compiler.pm.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/388137/178256/Compiler.pm.diff">
Wed Nov 28 18:46:58 2007 (1k) by ac0v [...] sys-network.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=30693">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-382722" href="/Public/Bug/Display.html?id=30693#txn-382722">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;13&nbsp;10:10:00&nbsp;2007</span>
    <span class="description">ac0v [...] sys-network.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> allow LOOP also for a single value</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/382722/175313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/175313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 751b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The &lt;%LOOP ... %&gt; Function is only usable for arrayrefs. It would be
great if it would act like perl&#39;s for. So it should run the loop once if
we iterate over an an single value.

Why do I/we need this?
Many modules for XML handling are creating array references only if
there in more than one element in an hierarchy. So if you&#39;ll pass this
data to a LOOP in your HTC, you&#39;ll run into problems. &#40;this means that
nothing is shown, if there is one element instead of an arrayref&#41;.

I think it&#39;s not very usefull to prepare all data for HTC before passing
it to HTC via $htc-&gt;param&#40;&#41;. I&#39;ve attached a small diff for HTC&#39;s
Compiler.pm, which upgrades all single values whose are used in an loop
to an array ref before looping.

What do you think about it?
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Compiler.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/382722/175316/Compiler.diff">Download Compiler.diff</a><br />
<span class="downloadcontenttype">text/x-diff 213b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">497c497,498
&lt; ${indent}if &#40;UNIVERSAL::isa&#40;my \$array = $varstr, &#39;ARRAY&#39;&#41; &#41;\{
---
&gt; ${indent}if &#40; defined $varstr &#41;\{
&gt; ${indent}${ind}my \$array = ref $varstr &#38;&#38; ref $varstr eq &#39;ARRAY&#39; ? $varstr : [$varstr];
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-382737" href="/Public/Bug/Display.html?id=30693#txn-382737">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;13&nbsp;10:33:22&nbsp;2007</span>
    <span class="description">ac0v [...] sys-network.de -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-382738" href="/Public/Bug/Display.html?id=30693#txn-382738">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;13&nbsp;10:34:50&nbsp;2007</span>
    <span class="description">ac0v [...] sys-network.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/382738/175331/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/175331">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 62b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">sry - there was some crap in the diff, fixed diff is attached.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/382738/175334/Compiler.diff">Download Compiler.diff</a><br />
<span class="downloadcontenttype">text/x-diff 198b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">497c497,498
&lt; ${indent}if &#40;UNIVERSAL::isa&#40;my \$array = $varstr, &#39;ARRAY&#39;&#41; &#41;\{
---
&gt; ${indent}if &#40; defined $varstr &#41;\{
&gt; ${indent}${ind}my \$array = ref $varstr eq &#39;ARRAY&#39; ? $varstr : [$varstr];
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-383989" href="/Public/Bug/Display.html?id=30693#txn-383989">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;16&nbsp;04:27:08&nbsp;2007</span>
    <span class="description">TINITA [...] cpan.org -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-385181" href="/Public/Bug/Display.html?id=30693#txn-385181">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;19&nbsp;05:26:12&nbsp;2007</span>
    <span class="description">TINITA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/385181/176750/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/176750">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 824b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Di. 13. Nov. 2007, 10:10:00, ACID wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The &lt;%LOOP ... %&gt; Function is only usable for arrayrefs. It would be
&gt; great if it would act like perl&#39;s for.
</div>
actually perl&#39;s for iterates over arrays/lists. if you have an
arrayref you have to dereference it. if the variable is not an array
ref you have that to check yourself. &#39;for&#39; doesn&#39;t do that for you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So it should run the loop once if
&gt; we iterate over an an single value.
&gt; 
&gt; Why do I/we need this?
&gt; Many modules for XML handling are creating array references only if
&gt; there in more than one element in an hierarchy. So if you&#39;ll pass this
&gt; data to a LOOP in your HTC, you&#39;ll run into problems. &#40;this means that
&gt; nothing is shown, if there is one element instead of an arrayref&#41;.
</div>
i&#39;ll have a look, though i think the templating shouldn&#39;t try to be
too smart.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-385189" href="/Public/Bug/Display.html?id=30693#txn-385189">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;19&nbsp;05:28:48&nbsp;2007</span>
    <span class="description">TINITA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/385189/176752/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/176752">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 296b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Di. 13. Nov. 2007, 10:34:50, ACID wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ref $varstr eq &#39;ARRAY&#39; ? $varstr : [$varstr];
</div>
Actually this is different from my code in that I do UNIVERSAL::isa
instead of ref&#40;&#41; which allows to iterate over an object which is an
array. But I guess that this functionality is not really needed...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-388137" href="/Public/Bug/Display.html?id=30693#txn-388137">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;28&nbsp;18:46:58&nbsp;2007</span>
    <span class="description">ac0v [...] sys-network.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ac0v [...] sys-network.de</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/388137/178250/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/178250">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 475b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Tina,

I&#39;ve found another problem with LOOP, which also affects EACH.
If someone overloads @{} it&#39;s not possible to use LOOP in the template.

Why do I need this?
The overload problem occurs while passing object created by SOAP::WSDL
to my Templates.

I&#39;ve attached a small test script and a possible patch for the
Compiler.pm which has a changed LOOP and EACH.

This patch would waste the requested feature &#34;allow LOOP also for a
single value&#34; for me :&#41;

Regards,
Andreas
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/388137/178253/13_loop_with_overload.t">Download 13_loop_with_overload.t</a><br />
<span class="downloadcontenttype">text/x-perl 624b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl

use lib qw&#40;blib/lib&#41;;
use Test::More tests =&gt; 1;
BEGIN { use_ok&#40;&#39;HTML::Template::Compiled&#39;&#41; };

my @test_values = qw&#40;some multi values&#41;;

package MyOverloadSample;
use overload &#39;@{}&#39; =&gt; sub { \@test_values; };
sub new { return bless \&#40;my $anon&#41;, shift; }

package main;

{
    my $htc = HTML::Template::Compiled-&gt;new&#40;
        scalarref =&gt; \&#40;my $anon = &#34;&lt;%LOOP test_var %&gt;&lt;%= _ %&gt;&lt;%/LOOP%&gt;&#34;&#41;,
        out_fh    =&gt; 0,
    &#41;;
    $htc-&gt;param&#40;test_var =&gt; MyOverloadSample-&gt;new&#40;&#41;&#41;;
    my $out = $htc-&gt;output&#40;&#41;;
    $out =~ s{\s+}{}xmsg;
    cmp_ok&#40;$out, &#39;eq&#39;, &#40;join q{}, @test_values&#41;, &#39;loop with overloaded @{} ok&#39;&#41;;
}
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/388137/178256/Compiler.pm.diff">Download Compiler.pm.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /tmp/HTML-Template-Compiled-0.90/lib/HTML/Template/Compiled/Compiler.pm	2007-11-15 00:41:08.000000000 +0100
+++ /tmp/My-Template-Compiled-0.90/lib/HTML/Template/Compiled/Compiler.pm	2007-11-28 23:07:44.000000000 +0100
@@ -482,10 +482,10 @@
             }
             elsif &#40;$tname eq T_EACH&#41; {
                 $code .= &lt;&lt;&#34;EOM&#34;;
-${indent}if &#40;UNIVERSAL::isa&#40;my \$hash = $varstr, &#39;HASH&#39;&#41; &#41; \{
+${indent}if &#40; my \%hash = eval \{ my \$var = $varstr; \%\{\$var} } &#41;\{
 ${indent}${indent}local \$__ix__ = -1;
 ${indent}${ind}local &#40;\$__key__,\$__value__&#41;;
-${indent}${ind}while &#40;&#40;\$__key__,\$__value__&#41; = each %\$hash&#41; \{
+${indent}${ind}while &#40;&#40;\$__key__,\$__value__&#41; = each %hash&#41; \{
 ${indent}${indent}\$__ix__++;
 $insert_break
 EOM
@@ -506,8 +506,8 @@
                     
                 }
                 $code .= &lt;&lt;&#34;EOM&#34;;
-${indent}if &#40;UNIVERSAL::isa&#40;my \$array = $varstr, &#39;ARRAY&#39;&#41; &#41;\{
-${indent}${ind}my \$size = \$#{ \$array };
+my \$array = $varstr;
+${indent}if &#40; my \$size = eval \{ \$#{ \$array } } &#41;\{
 $global
 
 ${indent}${ind}# loop over $var
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-500032" href="/Public/Bug/Display.html?id=30693#txn-500032">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;05:32:03&nbsp;2008</span>
    <span class="description">TINITA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/500032/247755/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/247755">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 777b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mi. 28. Nov. 2007, 18:46:58, ACID wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Why do I need this?
&gt; The overload problem occurs while passing object created by SOAP::WSDL
&gt; to my Templates.
&gt; 
&gt; I&#39;ve attached a small test script and a possible patch for the
&gt; Compiler.pm which has a changed LOOP and EACH.
&gt; 
&gt; This patch would waste the requested feature &#34;allow LOOP also for a
&gt; single value&#34; for me :&#41;
</div>
i think i will put this into the next version. it makes it a bit slower
overall, but i can probably live with that.
this would also just ignore any non-array vars instead of dying
which is probably a good thing, only that it is even more different
than the HTML::Template behaviour.

Could you please test the current version from Sourceforge?
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/svn/?group_id=147988">http://sourceforge.net/svn/?group_id=147988</a></span>

thanks,
tina
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-528908" href="/Public/Bug/Display.html?id=30693#txn-528908">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;04&nbsp;13:26:51&nbsp;2008</span>
    <span class="description">TINITA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/528908/264779/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/264779">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 192b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fr. 22. Aug. 2008, 05:32:03, TINITA wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; i think i will put this into the next version. [...]
</div>
I didn&#39;t hear from you, but I guess it will be working. It&#39;s in 0.93 
now.

regards,
tina
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-528910" href="/Public/Bug/Display.html?id=30693#txn-528910">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;04&nbsp;13:27:18&nbsp;2008</span>
    <span class="description">TINITA [...] cpan.org -  Fixed in 0.93 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-528911" href="/Public/Bug/Display.html?id=30693#txn-528911">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;04&nbsp;13:27:50&nbsp;2008</span>
    <span class="description">TINITA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.698032</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
