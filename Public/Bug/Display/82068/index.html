<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #82068 for FCGI: FCGI breaks with IIS 7.5</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #82068 for FCGI: FCGI breaks with IIS 7.5</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=FCGI">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=FCGI">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=FCGI">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=FCGI">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/FCGI">FCGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">82068</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=FCGI">FCGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
johannes.wilke [...] striata.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12604-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12605-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




iistype5.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1156513/608232/iistype5.txt">
Tue Dec 18 01:54:11 2012 (689.1k) by johannes.wilke [...] striata.com
</a>
</font></li>
</ul>


latest-blog-post-image-380x24.php<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1156513/608231/latest-blog-post-image-380x24.php">
Tue Dec 18 01:54:11 2012 (1.7k) by johannes.wilke [...] striata.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=82068">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1156513" href="/Public/Bug/Display.html?id=82068#txn-1156513">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;18&nbsp;01:54:11&nbsp;2012</span>
    <span class="description">johannes.wilke [...] striata.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> FCGI breaks with IIS 7.5</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 18 Dec 2012 09:00:43 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FCGI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Johannes Wilke &lt;johannes.wilke [...] striata.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1156513/608228/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/608228">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Good day,

I have found that FCGI using IIS 7.5 can get in to a state that brings 
down your website.

When you do many post requests in a short period of time IIS at some 
point will not send the TYPE 5 terminating packet &#40;ZERO content length&#41;. 
IIS continues to send the FCGI packets for new requests that comes in 
but, FCGI is stuck in a state where it ignores any new packets cause it 
is waiting for the TYPE 5 terminating packet for Request ID N. This 
leaves your web service in a state that you constantly get an 500 
internal server error. Only when IIS restart the process &#40;specified by 
the IIS settings for FCGI&#41; will the service be back up and running.

This is an actual IIS issue cause they are at fault for not sending the 
TYPE 5 terminating packet at some point in time, but FCGI is left in a 
very bad state. I saw that PHP users complains about intermittent 500 
internal server errors when using IIS. I believe that the PHP FCGI 
interface probably drops the incomplete packet but continue processing 
new requests coming in.

Can FCGI maybe handle this more appropriately instead of discarding all 
new incoming packets.

Please find attached &#40;iistype5.txt&#41; a TCP log between IIS and Perl FCGI 
showing the missing TYPE 5 terminating packet from IIS and that Perl 
FCGI rejects every request afterwards.

1&#41; Load the file with Wireshark. Set the filter options to &#34;tcp.port == 
57696&#34;
2&#41; Entry no 1972 shows FCGI TYPE 1 packet for Request ID 0x91
3&#41; Entry no 1974 shows FCGI TYPE 4 packet &#40;PARAMS&#41; for Request ID 0x91
4&#41; Entry no 1977 shows FCGI TYPE 4 terminating packet
5&#41; Entry no 1979 shows FCGI TYPE 5 &#40;DATA_IN&#41; packet
6&#41; Entry no 1981 shows FCGI TYPE 5 terminating packet
7&#41; Entry no 1983 shows FCGI TYPE 6 data out packet. In this same TCP 
packet is the TYPE 6 terminating packet and TYPE 3 end request packet.
8&#41; This was the last successfull packet. Note that the TYPE 1 packets 
are all RESPONSE role packets meaning that TYPE 6 packets can be sent 
before teh TYPE 5 terminating packet. If the log file is inspected you 
will note that most of the time the TYPE 6 packet is sent before the 
TYPE 5 terminating packet is received.

1&#41; Entry no 1985 shows the FCGI TYPE 1 packet for request ID 0x92
2&#41; Entry no 1987 shows the FCGI TYPE 4 packet
3&#41; Entry no 1990 shows the FCGI TYPE 4 terminating packet.
4&#41; Entry no 1992 shows the FCGI TYPE 5 packet.
5&#41; Entry no 1994 shows the FCGI TYPE 6 packet, with its terminating 
packet and the TYPE 3 end request packet.
6&#41; Entry no 1996 shows the FCGI TYPE 1 packet for Request ID 0x93.

NOTE: IIS Never sent the TYPE 5 terminating packet for Reuqest Id 0x92.

7&#41; Entry no 1998 shows the TYPE 3 end request packet for Request Id 0x93.

 From this point Perl FCGI is ending all requests cause the Request Id 
does not match 0x92.


-- 

*Johannes Wilke*
Striata - Software Engineer
Office: +27&#40;81&#41;308-1837
Email: *johannes.wilke@striata.com* &lt;mailto:johannes.wilke@striata.com&gt;
Striata on: *Twitter* &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://twitter.com/striata">https://twitter.com/striata</a></span>&gt; | *LinkedIn* 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.linkedin.com/company/striata">http://www.linkedin.com/company/striata</a></span>&gt; | *Facebook* 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.facebook.com/striata.innovation">https://www.facebook.com/striata.innovation</a></span>&gt; | *striata.com* 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.striata.com">http://www.striata.com</a></span>&gt;
*Latest blog post: <span class="clickylink"><a target="new" rel="nofollow" href="http://striata.com/blog*">http://striata.com/blog*</a></span> 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://striata.com/blog?signature">http://striata.com/blog?signature</a></span>&gt;
This email and all contents are subject to the following disclaimer:
*<span class="clickylink"><a target="new" rel="nofollow" href="http://www.striata.com/_disclaimer*">http://www.striata.com/_disclaimer*</a></span>
</div></div>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1156513/608230/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/608230">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.6k</span>
</div>
<div class="messagebody">
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1156513/608231/latest-blog-post-image-380x24.php">Download latest-blog-post-image-380x24.php</a><br />
<span class="downloadcontenttype">image/gif 1.7k</span>
</div>
<div class="messagebody">
<img alt="latest-blog-post-image-380x24.php" title="latest-blog-post-image-380x24.php" src="/Ticket/Attachment/1156513/608231/" /></div>
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1156513/608232/iistype5.txt">Download iistype5.txt</a><br />
<span class="downloadcontenttype">text/plain 689.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.28622</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
