<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63000 for Moose: Regression from Moose 1.05 to 1.06 on HP-UX 11.31</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63000 for Moose: Regression from Moose 1.05 to 1.06 on HP-UX 11.31</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Moose/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Moose/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Moose/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Moose/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moose">Moose CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63000</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Moose/Active/">Moose</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
philip.monsen [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.06</li>
<li>
1.07</li>
<li>
1.08</li>
<li>
1.09</li>
<li>
1.10</li>
<li>
1.11</li>
<li>
1.12</li>
<li>
1.13</li>
<li>
1.14</li>
<li>
1.15</li>
<li>
1.16</li>
<li>
1.17</li>
<li>
1.18</li>
<li>
1.19</li>
</ul>
    </td>
  </tr>
  <tr id="CF-38787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:42:14&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Regression from Moose 1.05 to 1.06 on HP-UX 11.31</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 15 Nov 2010 11:41:55 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Philip Monsen &lt;philip.monsen [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.06 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.07 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.08 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.09 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.10 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.11 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.12 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.13 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.14 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.15 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.16 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.17 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.18 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;15&nbsp;12:46:18&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Broken in 1.19 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;21&nbsp;11:23:16&nbsp;2010</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t really know what the problem is. I&#39;m inclined to blame it on a
Perl core bug, though that&#39;s a bit of a cop out.

The changes in 1.06 were really minor. Basically, we changed some code
so that instead of comparing the refaddr&#40;&#41; of two objects, the objects
overloading numification by returning their refaddr, and now we just
compare the objects directly.

Could you post the results of testing the latest version of Moose? The
test suite and internals have changed a fair bit since 1.06.

You might also try with other versions of Perl, and/or with another
compiler if you can, just to see if any of those are the source of the
problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;21&nbsp;11:23:17&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;23&nbsp;10:36:28&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m pretty sure the problem is with some subtle effects introduced by
the new overloading behavior added in v1.06.  It&#39;s not that the defined
overloads are wrong per se, it&#39;s just that there aren&#39;t enough of them
-- at least for my brew of perl.  If you also overload &#39;==&#39; and adjust
&#39;&#34;&#34;&#39; to allow for normal strings, then all tests for 1.06 pass.

I arrived at this conclusion by experimenting with the effect of
removing each of the overloads in turn.  In particular when I removed
the fallback overload, some tests failed with errors indicating that we
were missing overloads for &#39;==&#39; and &#39;eq&#39;, i.e. that the numification and
stringification weren&#39;t getting the job done in every possible case
&#40;which I suppose is why &#39;fallback&#39; is set to true in the first place&#41;. 
Overloading &#39;eq&#39; was problematic as it bled over into the tests and
produced strange failures of things like cmp_ok&#40;&#41; that should have
succeeded, so I didn&#39;t do that.  In the end, after adjusting the &#39;&#34;&#34;&#39;
spec and adding &#39;==&#39; I put the &#39;fallback&#39; spec back.

Here&#39;s a rough patch for the TypeContraints.pm in 1.06, I am guessing
something similar would hold for later versions.  With this patch, all
tests pass given Class::MOP v1.02.

On Sun Nov 21 11:23:16 2010, DROLSKY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The changes in 1.06 were really minor. Basically, we changed some code
&gt; so that instead of comparing the refaddr&#40;&#41; of two objects, the objects
&gt; overloading numification by returning their refaddr, and now we just
&gt; compare the objects directly.
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TypeConstraint.pm-patch_for_v1_06</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;23&nbsp;10:43:12&nbsp;2010</span>
    <span class="description">doy [...] tozt.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63000] Regression from Moose 1.05 to 1.06 on HP-UX 11.31</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 23 Nov 2010 09:42:59 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Philip Monsen via RT &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jesse Luehrs &lt;doy [...] tozt.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Nov 23, 2010 at 10:36:28AM -0500, Philip Monsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Moose
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63000">https://rt.cpan.org/Ticket/Display.html?id=63000</a></span> &gt;
&gt; 
&gt; I&#39;m pretty sure the problem is with some subtle effects introduced by
&gt; the new overloading behavior added in v1.06.  It&#39;s not that the defined
&gt; overloads are wrong per se, it&#39;s just that there aren&#39;t enough of them
&gt; -- at least for my brew of perl.  If you also overload &#39;==&#39; and adjust
&gt; &#39;&#34;&#34;&#39; to allow for normal strings, then all tests for 1.06 pass.
&gt; 
&gt; I arrived at this conclusion by experimenting with the effect of
&gt; removing each of the overloads in turn.  In particular when I removed
&gt; the fallback overload, some tests failed with errors indicating that we
&gt; were missing overloads for &#39;==&#39; and &#39;eq&#39;, i.e. that the numification and
&gt; stringification weren&#39;t getting the job done in every possible case
&gt; &#40;which I suppose is why &#39;fallback&#39; is set to true in the first place&#41;. 
&gt; Overloading &#39;eq&#39; was problematic as it bled over into the tests and
&gt; produced strange failures of things like cmp_ok&#40;&#41; that should have
&gt; succeeded, so I didn&#39;t do that.  In the end, after adjusting the &#39;&#34;&#34;&#39;
&gt; spec and adding &#39;==&#39; I put the &#39;fallback&#39; spec back.
&gt; 
&gt; Here&#39;s a rough patch for the TypeContraints.pm in 1.06, I am guessing
&gt; something similar would hold for later versions.  With this patch, all
&gt; tests pass given Class::MOP v1.02.
</div>
That patch doesn&#39;t really make any sense at all... do you know why it
works, or were you just fiddling with things until the tests passed? It
wouldn&#39;t surprise me if the tests are only passing with that patch due
to a lack of sufficient test coverage, because the patch doesn&#39;t seem to
be doing anything in a more correct way &#40;in particular, the changes to
the stringification overload don&#39;t look like they should ever be
triggered&#41;.

-doy
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;23&nbsp;11:04:34&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That patch doesn&#39;t really make any sense at all... do
&gt; you know why it works, or were you just fiddling
&gt; with things until the tests passed? 
</div>
I&#39;ll admit, my testing strategy focused exclusively on fixing failing
tests &#40;and not breaking others&#41; by adjusting the module code, vs.
adjusting the test code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It wouldn&#39;t surprise me if the tests are only passing
&gt; with that patch due to a lack of sufficient test
&gt; coverage, because the patch doesn&#39;t seem to
&gt; be doing anything in a more correct way &#40;in particular,
&gt; the changes to the stringification overload don&#39;t
&gt; look like they should ever be triggered&#41;.
</div>
I backed out the stringification modification and all tests still pass.
 So the only interesting piece of the patch that matters is the addition
of the &#39;==&#39; modification.  I&#39;m just hypothesizing that supplying &#39;0+&#39;
and &#39;fallback&#39; isn&#39;t enough to constrain the arguments of &#39;==&#39; to numify
via the overloaded numification.
  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;23&nbsp;13:00:22&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just to follow up on the apparent lack of an appropriate &#39;==&#39; method in
some cases, and that &#39;eq&#39; is able to be autogenerated okay, I set
&#39;fallback&#39; to undef rather than to 1 &#40;true&#41;, and quite a number of tests
&#40;I count 35&#41; fail with &#39;Operation &#34;==&#34;: no method found&#39; exceptions.

So, taking a step back, maybe the only issue is that &#39;==&#39; is just
ambiguous enough with the supplied overloads that the significant use of
it in Moose::Meta::TypeConstraint::equals&#40;&#41; simply needs to force its
arguments to numify.  The patch then just becomes:

--- Moose-1.06-orig/lib/Moose/Meta/TypeConstraint.pm  2010-06-01
13:49:54 -0500
+++ Moose-1.06/lib/Moose/Meta/TypeConstraint.pm    2010-11-23 11:50:56 -0600

@@ -135,7 +135,7 @@

     my $other =
Moose::Util::TypeConstraints::find_type_constraint&#40;$type_or_name&#41; or return;

-    return 1 if $self == $other;
+    return 1 if 0+$self == 0+$other;

     if &#40; $self-&gt;has_hand_optimized_type_constraint and
$other-&gt;has_hand_optimized_type_constraint &#41; {
         return 1 if $self-&gt;hand_optimized_type_constraint ==
$other-&gt;hand_optimized_type_constraint;


This single change seems more in spirit with the previous v1.05 code and
with the overloading changes, and also results in all tests passing.

On Tue Nov 23 11:04:34 2010, ICERIDER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  So the only interesting piece of the patch that matters is the addition
&gt; of the &#39;==&#39; modification.  I&#39;m just hypothesizing that supplying &#39;0+&#39;
&gt; and &#39;fallback&#39; isn&#39;t enough to constrain the arguments of &#39;==&#39; to numify
&gt; via the overloaded numification.
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;23&nbsp;13:22:39&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Also, that one-line patch results in all tests passing with the latest
Moose &#40;1.19&#41; in conjunction with the latest Class::MOP &#40;1.11&#41; with my
perl build as well.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;23&nbsp;13:26:28&nbsp;2010</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63000] Regression from Moose 1.05 to 1.06 on HP-UX 11.31 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 23 Nov 2010 12:26:13 -0600 &#40;CST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Philip Monsen via RT &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 23 Nov 2010, Philip Monsen via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -    return 1 if $self == $other;
</div>
Can you add a warning to the num overloading sub to see if it gets called 
in this case? It _should_ be called, but if it&#39;s not, that would explain 
the issue.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; +    return 1 if 0+$self == 0+$other;
</div>
And of course we would expect it to be called in this cas.e


-dave

/*============================================================
<span class="clickylink"><a target="new" rel="nofollow" href="http://VegGuide.org">http://VegGuide.org</a></span>               <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.urth.org">http://blog.urth.org</a></span>
Your guide to all that&#39;s veg      House Absolute&#40;ly Pointless&#41;
============================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;24&nbsp;12:04:47&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 23 13:26:28 2010, autarch@urth.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you add a warning to the num overloading sub to see if it gets called 
&gt; in this case? It _should_ be called, but if it&#39;s not, that would explain 
&gt; the issue.
</div>
Turns out it always *is* called.  This made getting to the bottom of
things very, very interesting.  However, in the end I believe I finally
know the underlying issue.

To better understand why forcing numification on that one numeric
equality test seemed to make all the difference, I decided to compare
results of bare &#39;==&#39; with results of forced numification then &#39;==&#39;.

In both cases, the overloaded numification is invoked and works as
expected.  However, mysteriously, the bare &#39;==&#39; returns true when the
refaddr&#40;&#41; values are different,  but &#39;==&#39; after forced numification
returns false.

&#34;Huh?&#34;  That was perplexing.  So I looked a little closer at the
reference addresses and found that they are 64-bit addresses with high
bit set, but stored under the hood as UVs.  After playing around a while
with various types of numeric operations, I found that under some
conditions, this bit was being interpreted as a sign indicator and we
were getting rounded floating point results instead of expected 64-bit
integer results.

This seemed to indicate that
    use integer;  
is needed in TypeConstraint.pm, at least if full-strength 64-bitness is
in play.  This wouldn&#39;t necessary guarantee results are &#34;correct&#34; in an
abstract mathematical sense, but would seem to require that &#40;at a
minimum&#41; numeric operators behave consistently with the numification
overload in effect.

Indeed, adding this single pragma at package scope, with no other
changes to the stock code, returns all tests to PASS.  Pragma scope can
be restricted to just equals&#40;&#41; with the same effect.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;12:53:00&nbsp;2010</span>
    <span class="description">philip.monsen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> autarch [...] urth.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve attached an updated patch against Moose-1.21 that corrects the
issue as per my further investigation described in my last post. 
Without this patch I still see the same issue manifesting itself in some
invocations of Moose::Meta::TypeConstraint-&gt;equals&#40;&#41;.  The same basic
patch corrects the issue on Moose-1.06 &#40;and presumably all versions in
between&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TypeConstraint.pm-use-integer-patch</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;14&nbsp;20:35:23&nbsp;2011</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 02 12:53:00 2010, ICERIDER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve attached an updated patch against Moose-1.21 that corrects the
&gt; issue as per my further investigation described in my last post. 
&gt; Without this patch I still see the same issue manifesting itself in some
&gt; invocations of Moose::Meta::TypeConstraint-&gt;equals&#40;&#41;.  The same basic
&gt; patch corrects the issue on Moose-1.06 &#40;and presumably all versions in
&gt; between&#41;.
</div>
Sorry to be so slow to reply. This patch is really hard to understand.
For some reason you changed the indentation of the entire sub, so the
patch is basically &#34;replace the whole sub&#34;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;14&nbsp;23:24:45&nbsp;2011</span>
    <span class="description">philip.monsen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63000] Regression from Moose 1.05 to 1.06 on HP-UX 11.31</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 14 Mar 2011 22:24:35 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Philip Monsen &lt;philip.monsen [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Mar 14, 2011 at 7:35 PM, Dave Rolsky via RT
&lt;bug-Moose@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63000">https://rt.cpan.org/Ticket/Display.html?id=63000</a></span> &gt;
&gt; Sorry to be so slow to reply.
</div>
No worries.  Sorry for obscuring my suggested fix &#40;see below&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This patch is really hard to understand.
&gt; For some reason you changed the indentation of the entire sub, so the
&gt; patch is basically &#34;replace the whole sub&#34;.
</div>
In retrospect I wondered whether it &#40;i.e. introducing an enclosing
scope to the Moose::Meta::TypeConstraint::equals&#40;&#41; method in which
&#39;use integer&#39; was active&#41; was overkill.  All I was really trying to
accomplish was to scope the &#39;use integer;&#39; pragma to the equals&#40;&#41;
method.  In fact, on the version I patched and am using on my HP-UX
system I inserted the pragma invocation within the method body, as:

sub equals {
    my &#40; $self, $type_or_name &#41; = @_;

    use integer;   # Force math ops to be consistent, avoid FP overflow

    ...
}

That would amount to a simple one-line patch &#40;or two lines, if you
include the additional blank line&#41;.  I&#39;d like to offer this up as an
alternative.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;30&nbsp;18:30:22&nbsp;2011</span>
    <span class="description">DROLSKY [...] cpan.org -  Reference to ticket #59478 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;07&nbsp;21:16:37&nbsp;2013</span>
    <span class="description">cpan [...] prather.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 14 23:24:45 2011, ICERIDER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon, Mar 14, 2011 at 7:35 PM, Dave Rolsky via RT
&gt; &lt;bug-Moose@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63000">https://rt.cpan.org/Ticket/Display.html?id=63000</a></span> &gt;
&gt; &gt; Sorry to be so slow to reply.
</div>&gt; 
&gt; No worries.  Sorry for obscuring my suggested fix &#40;see below&#41;.
&gt; 
<div class="message-stanza open">&gt; &gt; This patch is really hard to understand.
&gt; &gt; For some reason you changed the indentation of the entire sub, so the
&gt; &gt; patch is basically &#34;replace the whole sub&#34;.
</div>&gt; 
&gt; In retrospect I wondered whether it &#40;i.e. introducing an enclosing
&gt; scope to the Moose::Meta::TypeConstraint::equals&#40;&#41; method in which
&gt; &#39;use integer&#39; was active&#41; was overkill.  All I was really trying to
&gt; accomplish was to scope the &#39;use integer;&#39; pragma to the equals&#40;&#41;
&gt; method.  In fact, on the version I patched and am using on my HP-UX
&gt; system I inserted the pragma invocation within the method body, as:
&gt; 
&gt; sub equals {
&gt;     my &#40; $self, $type_or_name &#41; = @_;
&gt; 
&gt;     use integer;   # Force math ops to be consistent, avoid FP overflow
&gt; 
&gt;     ...
&gt; }
&gt; 
&gt; That would amount to a simple one-line patch &#40;or two lines, if you
&gt; include the additional blank line&#41;.  I&#39;d like to offer this up as an
&gt; alternative.
</div>

Is this still an issue? Has an actual patch been produced? A branch in moose.git? 

I&#39;m marking this stalled until we move forward on this.

-Chris
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;07&nbsp;21:16:39&nbsp;2013</span>
    <span class="description">cpan [...] prather.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
