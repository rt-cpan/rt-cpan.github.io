<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #133592 for Lyrics-Fetcher-AZLyrics: PATCH to handle current azlyrics.com + a new fetcher for genius.com!</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #133592 for Lyrics-Fetcher-AZLyrics: PATCH to handle current azlyrics.com + a new fetcher for genius.com!</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Lyrics-Fetcher-AZLyrics/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Lyrics-Fetcher-AZLyrics/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Lyrics-Fetcher-AZLyrics/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Lyrics-Fetcher-AZLyrics/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Lyrics-Fetcher-AZLyrics">Lyrics-Fetcher-AZLyrics CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">133592</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Lyrics-Fetcher-AZLyrics/Active/">Lyrics-Fetcher-AZLyrics</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">davidp [...] preshweb.co.uk
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
turnerjw784 [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-42354-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.05    </td>
  </tr>
  <tr id="CF-42355-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;21&nbsp;22:19:04&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PATCH to handle current azlyrics.com + a new fetcher for genius.com!</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This code is 10 years old &#38; no longer works, but azlyrics.com &#40;now https&#41; still DOES, so I modified your code to now work with the site here in 2020!  I also made a new fetcher module for www.genius.com whilst I was at it!  Please review, make any changes you see fit and feel free to update to v0.06!

BTW, Lyricwiki is now defunct as of a few weeks/months ago &#40;I know b/c I did a bunch of work on the lyricwiki plugin for Fauxdacious &#40;my Audacious fork&#41;, and now I&#39;m going to have to do a bunch more! :&#40;

Oh, and thank you for these modules!

Regards,

Jim Turner
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> AZLyrics.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Lyrics::Fetcher::AZLyrics;

# $Id$

use 5.008000;
use strict;
use warnings;
use LWP::UserAgent;
use HTTP::Request;
use HTML::Strip;
use Carp;

our $VERSION = &#39;0.05&#39;;

# the HTTP User-Agent we&#39;ll send:
our $AGENT = &#34;Mozilla/5.0 &#40;X11; Linux x86_64; rv:80.0&#41; Gecko/20100101 Firefox/80.0&#34;;

sub fetch {
    
    my $self = shift;
    my &#40; $artist, $song &#41; = @_;
    
    # reset the error var, change it if an error occurs.
    $Lyrics::Fetcher::Error = &#39;OK&#39;;
    
    unless &#40;$artist &#38;&#38; $song&#41; {
        carp&#40;$Lyrics::Fetcher::Error = 
            &#39;fetch&#40;&#41; called without artist and song&#39;&#41;;
        return;
    }
    
    $artist =~ s/[^a-z0-9]//gi;
    $song   =~ s/[^a-z0-9]//gi;
    
    my $url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.azlyrics.com/lyrics/&#39;">https://www.azlyrics.com/lyrics/&#39;</a></span>;
    $url .= join&#40;&#39;/&#39;, lc $artist, lc $song&#41; . &#39;.html&#39;;
    
    my $ua = LWP::UserAgent-&gt;new&#40;
		ssl_opts =&gt; {	verify_hostname =&gt; 0, }
	&#41;;
	$ua-&gt;timeout&#40;10&#41;;
    $ua-&gt;agent&#40;$AGENT&#41;;
	$ua-&gt;protocols_allowed&#40;[&#39;https&#39;]&#41;;
	$ua-&gt;cookie_jar&#40; {} &#41;;
	push @{ $ua-&gt;requests_redirectable }, &#39;GET&#39;;
	&#40;my $referer = $url&#41; =~ s#^&#40;\w+&#41;\:\/\/##;
	my $protocol = $1;
	$referer =~ s#\/.+$#\/#;
	my $host = $referer;
	$host =~ s#\/$##;
	$referer = $protocol . &#39;://&#39; . $referer;
	my $req = new HTTP::Request &#39;GET&#39; =&gt; $url;
	$req-&gt;header&#40;
	    &#39;Accept&#39; =&gt; &#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;,
	    &#39;Accept-Language&#39; =&gt; &#39;en-US,en;q=0.5&#39;,
	    &#39;Accept-Encoding&#39; =&gt; &#39;gzip, deflate&#39;,
	    &#39;Connection&#39;      =&gt; &#39;keep-alive&#39;,
	    &#39;Upgrade-insecure-requests&#39; =&gt; 1,
	    &#39;Host&#39; =&gt; $host,
	&#41;;

	my $res = $ua-&gt;request&#40;$req&#41;;

    if &#40; $res-&gt;is_success &#41; {
        my $lyrics = _parse&#40;$res-&gt;decoded_content&#41;;
        return $lyrics;
    } else {
        if &#40;$res-&gt;status_line =~ /^404/&#41; {
            $Lyrics::Fetcher::Error = 
                &#39;Lyrics not found&#39;;
            return;
        } else {
            carp&#40;$Lyrics::Fetcher::Error = 
                &#34;Failed to retrieve $url &#40;&#34;.$res-&gt;status_line.&#39;&#41;&#39;&#41;;
            return;
        }
    }


}


sub _parse {
    my $html = shift;

    # Nasty - look for everything in between the two ringtones links:
    if &#40;my &#40;$goodbit&#41; = $html =~
        m{our licensing agreement. Sorry about that. \-\-\&gt;&#40;.+&#41;\&lt;\/div\&gt;}msi&#41;
        #m{\&lt;div\s+class\=\&#34;lyrics\&#34;\&gt;&#40;.+&#41;\&lt;\!\-\-\/sse\-\-\&gt;}msi&#41;
    {
		my $hs = HTML::Strip-&gt;new&#40;&#41;;
        my $text = $hs-&gt;parse&#40;$goodbit&#41;;

        $text =~ s/\s+$//xmgi;

        # Scoop out any credits for these lyrics:
#DEPRECIATED?        my @credits;
#DEPRECIATED?        @Lyrics::Fetcher::azcredits = &#40;&#41;;
#DEPRECIATED?        while &#40;$text =~ s{\[ Thanks \s to \s &#40;.+&#41; \]}{}xgi&#41; {
#DEPRECIATED?            push @Lyrics::Fetcher::azcredits, $1;
#DEPRECIATED?        }
#DEPRECIATED?
#DEPRECIATED?        $text =~ s/\s*\[.+at \s www.AZLyrics.com\s+\]\s*//xmgi;

        # finally, clear up excess blank lines:
        $text =~ s/&#40;\r?\n&#41;{2,}/\n\n/gs;

        return $text;

    } else {
        carp &#34;Failed to identify lyrics on result page&#34;;
        return;
    }

} # end of sub parse

1;

__END__

=head1 NAME

Lyrics::Fetcher::AZLyrics - Get song lyrics from www.azlyrics.com

=head1 SYNOPSIS

  use Lyrics::Fetcher;
  print Lyrics::Fetcher-&gt;fetch&#40;&#34;&lt;artist&gt;&#34;,&#34;&lt;song&gt;&#34;,&#34;AZLyrics&#34;&#41;;

  # or, if you want to use this module directly without Lyrics::Fetcher&#39;s
  # involvement:
  use Lyrics::Fetcher::AZLyrics;
  print Lyrics::Fetcher::AZLyrics-&gt;fetch&#40;&#39;&lt;artist&gt;&#39;, &#39;&lt;song&gt;&#39;&#41;;


=head1 DESCRIPTION

This module tries to get song lyrics from www.azlyrics.com.  It&#39;s designed to
be called by Lyrics::Fetcher, but can be used directly if you&#39;d prefer.

=head1 INTERFACE

=over 4

=item fetch&#40;$artist, $title&#41;

Attempts to fetch lyrics.

=back


=head1 BUGS

Probably.  If you find any, please let me know.  If azlyrics.com change their
site much, this module may well stop working.  If you find any songs which
have lyrics listed on the www.azlyrics.com site, but for which this module is
unable to fetch lyrics, please let me know also.  It seems that the HTML on
the lyrics pages isn&#39;t consistent, so it&#39;s entirely possible &#40;likely, in fact&#41;
that there are some pages which this script will not be able to parse.


=head1 COPYRIGHT

This program is free software; you can redistribute it and/or modify it under 
the same terms as Perl itself.


=head1 AUTHOR

David Precious E&lt;lt&gt;davidp@preshweb.co.ukE&lt;gt&gt;



=head1 COPYRIGHT AND LICENSE

Copyright &#40;C&#41; 2007-08 by David Precious

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.8.7 or,
at your option, any later version of Perl 5 you may have available.

Legal disclaimer: I have no connection with the owners of www.azlyrics.com.
Lyrics fetched by this script may be copyrighted by the authors, it&#39;s up to 
you to determine whether this is the case, and if so, whether you are entitled 
to request/use those lyrics.  You will almost certainly not be allowed to use
the lyrics obtained for any commercial purposes.

=cut
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Genius.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Lyrics::Fetcher::Genius;

# $Id$

use 5.008000;
use strict;
use warnings;
use LWP::UserAgent;
use HTTP::Request;
use HTML::Strip;
use Carp;

our $VERSION = &#39;0.05&#39;;

# the HTTP User-Agent we&#39;ll send:
our $AGENT = &#34;Mozilla/5.0 &#40;X11; Linux x86_64; rv:80.0&#41; Gecko/20100101 Firefox/80.0&#34;;
#    &#34;Mozilla/5.0 &#40;Macintosh; Intel Mac OS X 10_10_1&#41; AppleWebKit/537.36 &#40;KHTML, like Gecko&#41; Chrome/39.0.2171.95 Safari/537.36&#34;&#41;;

    

sub fetch {
    
    my $self = shift;
    my &#40; $artist, $song &#41; = @_;
    
    # reset the error var, change it if an error occurs.
    $Lyrics::Fetcher::Error = &#39;OK&#39;;
    
    unless &#40;$artist &#38;&#38; $song&#41; {
        carp&#40;$Lyrics::Fetcher::Error = 
            &#39;fetch&#40;&#41; called without artist and song&#39;&#41;;
        return;
    }
    
#x    $artist =~ s/[^a-z0-9]//gi;
#x    $song   =~ s/[^a-z0-9]//gi;
    
#x    my $url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.genius.com/&#39;">https://www.genius.com/&#39;</a></span>;
#x    $url .= join&#40;&#39;/&#39;, lc $artist, lc $song&#41; . &#39;.html&#39;;

	&#40;my $url = $artist&#41; =~ s#\/.*$##;
	$url .= &#34;-${song}-lyrics&#34;;
	$url =~ s/ +/\-/g;
	$url =~ s/\%20/\-/g;
	$url =~ s/\%\d+//g;
	$url =~ s/\.//g;
	$url =~ s/[^a-zA-Z0-9\.\-]+//g;
	$url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://genius.com/&#39;">https://genius.com/&#39;</a></span> . $url;
    
    my $ua = LWP::UserAgent-&gt;new&#40;
		ssl_opts =&gt; {	verify_hostname =&gt; 0, }
	&#41;;
	$ua-&gt;timeout&#40;10&#41;;
    $ua-&gt;agent&#40;$AGENT&#41;;
	$ua-&gt;protocols_allowed&#40;[&#39;https&#39;]&#41;;
	$ua-&gt;cookie_jar&#40; {} &#41;;
	push @{ $ua-&gt;requests_redirectable }, &#39;GET&#39;;
	&#40;my $referer = $url&#41; =~ s#^&#40;\w+&#41;\:\/\/##;
	my $protocol = $1;
	$referer =~ s#\/.+$#\/#;
	my $host = $referer;
	$host =~ s#\/$##;
	$referer = $protocol . &#39;://&#39; . $referer;
	my $req = new HTTP::Request &#39;GET&#39; =&gt; $url;
	$req-&gt;header&#40;
	    &#39;Accept&#39; =&gt; &#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;,
	    &#39;Accept-Language&#39; =&gt; &#39;en-US,en;q=0.5&#39;,
	    &#39;Accept-Encoding&#39; =&gt; &#39;gzip, deflate&#39;,
	    &#39;Connection&#39;      =&gt; &#39;keep-alive&#39;,
	    &#39;Upgrade-insecure-requests&#39; =&gt; 1,
	    &#39;Host&#39; =&gt; $host,
	&#41;;

	my $res = $ua-&gt;request&#40;$req&#41;;

    if &#40; $res-&gt;is_success &#41; {
        my $lyrics = _parse&#40;$res-&gt;decoded_content&#41;;
        return $lyrics;
    } else {
        if &#40;$res-&gt;status_line =~ /^404/&#41; {
            $Lyrics::Fetcher::Error = 
                &#39;Lyrics not found&#39;;
            return;
        } else {
            carp&#40;$Lyrics::Fetcher::Error = 
                &#34;Failed to retrieve $url &#40;&#34;.$res-&gt;status_line.&#39;&#41;&#39;&#41;;
            return;
        }
    }


}


sub _parse {
    my $html = shift;

    # Nasty - look for everything in between the two ringtones links:
    if &#40;my &#40;$goodbit&#41; = $html =~
        m{\&lt;div\s+class\=\&#34;lyrics\&#34;\&gt;&#40;.+&#41;\&lt;\!\-\-\/sse\-\-\&gt;}msi&#41;
    {
		my $hs = HTML::Strip-&gt;new&#40;&#41;;
        my $text = $hs-&gt;parse&#40;$goodbit&#41;;

        $text =~ s/\s+$//xmgi;
        # finally, clear up excess blank lines:
        $text =~ s/&#40;\r?\n&#41;{2,}/\n\n/gs;

        return $text;

    } else {
        carp &#34;Failed to identify lyrics on result page&#34;;
        return;
    }

} # end of sub parse

1;

__END__

=head1 NAME

Lyrics::Fetcher::Genius - Get song lyrics from www.genius.com

=head1 SYNOPSIS

  use Lyrics::Fetcher;
  print Lyrics::Fetcher-&gt;fetch&#40;&#34;&lt;artist&gt;&#34;,&#34;&lt;song&gt;&#34;,&#34;Genius&#34;&#41;;

  # or, if you want to use this module directly without Lyrics::Fetcher&#39;s
  # involvement:
  use Lyrics::Fetcher::Genius;
  print Lyrics::Fetcher::Genius-&gt;fetch&#40;&#39;&lt;artist&gt;&#39;, &#39;&lt;song&gt;&#39;&#41;;


=head1 DESCRIPTION

This module tries to get song lyrics from www.genius.com.  It&#39;s designed to
be called by Lyrics::Fetcher, but can be used directly if you&#39;d prefer.

=head1 INTERFACE

=over 4

=item fetch&#40;$artist, $title&#41;

Attempts to fetch lyrics.

=back


=head1 BUGS

Probably.  If you find any, please let me know.  If genius.com change their
site much, this module may well stop working.  If you find any songs which
have lyrics listed on the www.genius.com site, but for which this module is
unable to fetch lyrics, please let me know also.  It seems that the HTML on
the lyrics pages isn&#39;t consistent, so it&#39;s entirely possible &#40;likely, in fact&#41;
that there are some pages which this script will not be able to parse.


=head1 COPYRIGHT

This program is free software; you can redistribute it and/or modify it under 
the same terms as Perl itself.


=head1 AUTHOR

David Precious E&lt;lt&gt;davidp@preshweb.co.ukE&lt;gt&gt;



=head1 COPYRIGHT AND LICENSE

Copyright &#40;C&#41; 2007-08 by David Precious

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.8.7 or,
at your option, any later version of Perl 5 you may have available.

Legal disclaimer: I have no connection with the owners of www.genius.com.
Lyrics fetched by this script may be copyrighted by the authors, it&#39;s up to 
you to determine whether this is the case, and if so, whether you are entitled 
to request/use those lyrics.  You will almost certainly not be allowed to use
the lyrics obtained for any commercial purposes.

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;01:30:47&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 21 22:19:04 2020, TURNERJW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This code is 10 years old &#38; no longer works, but azlyrics.com &#40;now
&gt; https&#41; still DOES, so I modified your code to now work with the site
&gt; here in 2020!  I also made a new fetcher module for www.genius.com
&gt; whilst I was at it!  Please review, make any changes you see fit and
&gt; feel free to update to v0.06!
&gt; 
&gt; BTW, Lyricwiki is now defunct as of a few weeks/months ago &#40;I know b/c
&gt; I did a bunch of work on the lyricwiki plugin for Fauxdacious &#40;my
&gt; Audacious fork&#41;, and now I&#39;m going to have to do a bunch more! :&#40;
&gt; 
&gt; Oh, and thank you for these modules!
&gt; 
&gt; Regards,
&gt; 
&gt; Jim Turner
</div>

Here&#39;s another one for ya &#40;Musixmatch&#41;!:
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Musixmatch.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Lyrics::Fetcher::Musixmatch;

# $Id$

use 5.008000;
use strict;
use warnings;
use LWP::UserAgent;
use HTTP::Request;
use HTML::Strip;
use Carp;

our $VERSION = &#39;0.06&#39;;

# the HTTP User-Agent we&#39;ll send:
our $AGENT = &#34;Mozilla/5.0 &#40;X11; Linux x86_64; rv:80.0&#41; Gecko/20100101 Firefox/80.0&#34;;

sub fetch {

    my $self = shift;
    my &#40; $artist, $song &#41; = @_;
    
    # reset the error var, change it if an error occurs.
    $Lyrics::Fetcher::Error = &#39;OK&#39;;

    unless &#40;$artist &#38;&#38; $song&#41; {
        carp&#40;$Lyrics::Fetcher::Error = 
            &#39;fetch&#40;&#41; called without artist and song&#39;&#41;;
        return;
    }

	$artist =~ s/ +/\-/g;
	$song =~ s/ +/\-/g;
    $artist =~ s/[^a-z0-9\-]//gi;
    $song   =~ s/[^a-z0-9\-]//gi;

	#<span class="clickylink"><a target="new" rel="nofollow" href="https://www.musixmatch.com/lyrics/Artist-name/Title">https://www.musixmatch.com/lyrics/Artist-name/Title</a></span>
    my $url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.musixmatch.com/lyrics/&#39;">https://www.musixmatch.com/lyrics/&#39;</a></span>;
    $url .= join&#40;&#39;/&#39;, lc $artist, lc $song&#41;;

    my $ua = LWP::UserAgent-&gt;new&#40;
		ssl_opts =&gt; {	verify_hostname =&gt; 0, }
	&#41;;
	$ua-&gt;timeout&#40;10&#41;;
    $ua-&gt;agent&#40;$AGENT&#41;;
	$ua-&gt;protocols_allowed&#40;[&#39;https&#39;]&#41;;
	$ua-&gt;cookie_jar&#40; {} &#41;;
	push @{ $ua-&gt;requests_redirectable }, &#39;GET&#39;;
	&#40;my $referer = $url&#41; =~ s#^&#40;\w+&#41;\:\/\/##;
	my $protocol = $1;
	$referer =~ s#\/.+$#\/#;
	my $host = $referer;
	$host =~ s#\/$##;
	$referer = $protocol . &#39;://&#39; . $referer;
	my $req = new HTTP::Request &#39;GET&#39; =&gt; $url;
	$req-&gt;header&#40;
	    &#39;Accept&#39; =&gt; &#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;,
	    &#39;Accept-Language&#39; =&gt; &#39;en-US,en;q=0.5&#39;,
	    &#39;Accept-Encoding&#39; =&gt; &#39;gzip, deflate&#39;,
	    &#39;Connection&#39;      =&gt; &#39;keep-alive&#39;,
	    &#39;Upgrade-insecure-requests&#39; =&gt; 1,
	    &#39;Host&#39; =&gt; $host,
	&#41;;

	my $res = $ua-&gt;request&#40;$req&#41;;

    if &#40; $res-&gt;is_success &#41; {
        my $lyrics = _parse&#40;$res-&gt;decoded_content&#41;;
        return $lyrics;
    } else {
        if &#40;$res-&gt;status_line =~ /^404/&#41; {
            $Lyrics::Fetcher::Error = 
                &#39;Lyrics not found&#39;;
            return;
        } else {
            carp&#40;$Lyrics::Fetcher::Error = 
                &#34;Failed to retrieve $url &#40;&#34;.$res-&gt;status_line.&#39;&#41;&#39;&#41;;
            return;
        }
    }
}


sub _parse {
    my $html = shift;

    # Nasty - look for everything in between the two ringtones links:
    if &#40;my &#40;$goodbit&#41; = $html =~
        m{\&lt;span\s+class\=\&#34;lyrics\_+content\_+ok\&#34;\&gt;&#40;.+?&#41;\&lt;\/span\&gt;}msi&#41;
        #m{\&lt;div\s+class\=\&#34;lyrics\&#34;\&gt;&#40;.+&#41;\&lt;\!\-\-\/sse\-\-\&gt;}msi&#41;
    {
		my $hs = HTML::Strip-&gt;new&#40;&#41;;
        my $text = $hs-&gt;parse&#40;$goodbit&#41;;

        $text =~ s/\s+$//xmgi;
        $text =~ s/&#40;\r?\n&#41;{2,}/\n\n/gs;

        return $text;

    } else {
        carp &#34;Failed to identify lyrics on result page&#34;;
        return;
    }

} # end of sub parse

1;

__END__

=head1 NAME

Lyrics::Fetcher::Musixmatch - Get song lyrics from www.musixmatch.com

=head1 SYNOPSIS

  use Lyrics::Fetcher;
  print Lyrics::Fetcher-&gt;fetch&#40;&#34;&lt;artist&gt;&#34;,&#34;&lt;song&gt;&#34;,&#34;Musixmatch&#34;&#41;;

  # or, if you want to use this module directly without Lyrics::Fetcher&#39;s
  # involvement:
  use Lyrics::Fetcher::Musixmatch;
  print Lyrics::Fetcher::Musixmatch-&gt;fetch&#40;&#39;&lt;artist&gt;&#39;, &#39;&lt;song&gt;&#39;&#41;;


=head1 DESCRIPTION

This module tries to get song lyrics from www.musixmatch.com.  It&#39;s designed to
be called by Lyrics::Fetcher, but can be used directly if you&#39;d prefer.

=head1 INTERFACE

=over 4

=item fetch&#40;$artist, $title&#41;

Attempts to fetch lyrics.

=back


=head1 BUGS

Probably.  If you find any, please let me know.  If musixmatch.com change their
site much, this module may well stop working.  If you find any songs which
have lyrics listed on the www.musixmatch.com site, but for which this module is
unable to fetch lyrics, please let me know also.  It seems that the HTML on
the lyrics pages isn&#39;t consistent, so it&#39;s entirely possible &#40;likely, in fact&#41;
that there are some pages which this script will not be able to parse.


=head1 COPYRIGHT

This program is free software; you can redistribute it and/or modify it under 
the same terms as Perl itself.


=head1 AUTHOR

David Precious E&lt;lt&gt;davidp@preshweb.co.ukE&lt;gt&gt;



=head1 COPYRIGHT AND LICENSE

Copyright &#40;C&#41; 2007-08 by David Precious

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.8.7 or,
at your option, any later version of Perl 5 you may have available.

Legal disclaimer: I have no connection with the owners of www.musixmatch.com.
Lyrics fetched by this script may be copyrighted by the authors, it&#39;s up to 
you to determine whether this is the case, and if so, whether you are entitled 
to request/use those lyrics.  You will almost certainly not be allowed to use
the lyrics obtained for any commercial purposes.

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;05:56:09&nbsp;2020</span>
    <span class="description">davidp [...] preshweb.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hi Jim,

Many thanks for your contributions - very much appreciated!

I&#39;ve released an updated Lyrics::Fetcher::AZLyrics with your changes this morning, and also released a new Lyrics::Fetcher::Genius distribution too.

I will get to create a distribution for Lyrics::Fetcher::Musixmatch ASAP too, hopefully later today.

I&#39;ve also pushed out an updated Lyrics::Fetcher::LyricWiki which removes all attempts to fetch and just carries a deprecation notice.

I&#39;ll get these releases installed on the box that runs my www.lyricsbadger.co.uk site &#40;basically a lyrics search aggregator&#41; too.

Thanks again,

Dave P &#40;BIGPRESH&#41;

On 2020-10-22 03:19:04, TURNERJW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This code is 10 years old &#38; no longer works, but azlyrics.com &#40;now
&gt; https&#41; still DOES, so I modified your code to now work with the site
&gt; here in 2020!  I also made a new fetcher module for www.genius.com
&gt; whilst I was at it!  Please review, make any changes you see fit and
&gt; feel free to update to v0.06!
&gt; 
&gt; BTW, Lyricwiki is now defunct as of a few weeks/months ago &#40;I know b/c
&gt; I did a bunch of work on the lyricwiki plugin for Fauxdacious &#40;my
&gt; Audacious fork&#41;, and now I&#39;m going to have to do a bunch more! :&#40;
&gt; 
&gt; Oh, and thank you for these modules!
&gt; 
&gt; Regards,
&gt; 
&gt; Jim Turner
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;05:56:09&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;13:14:12&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Wow, that was QUICK!!  A cpl things I just thought of though not bugs, could improve Lyric::Fetcher in general in a future release would be:  1&#41;  A method function for the user to set &#40;override&#41; the $AGENT string for all the fetchers.  2&#41;  Perhaps a &#34;random&#34; fetcher option in Lyric::Fetcher-&gt;fetch&#40;&#41;.  It&#39;s been my experience that in general, many sited do not like being frequently &#34;scraped&#34;, and if using in a streaming audio player, can result in a &#34;hit&#34; every few minutes.  By making it easy to randomize the site being scraped &#40;as we now have at least 3 to choose from&#41;, one can reduce the likelyhood of having their IP address banned by a site.  I haven&#39;t had a chance to install and test your official new release &#40;but I assume it&#39;s functionally the same&#41;, so you can go ahead and close this bug!  By getting this working and out quickly, I&#39;ll now be able to update the &#40;currently broken&#41; Lyrics plugins in Fauxdacious media player &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://wildstar84.wordpress.com/fauxdacious/&#41;">https://wildstar84.wordpress.com/fauxdacious/&#41;</a></span> to replace the defunct hardcoded &#34;lyrickwiki/fandom&#34; site with a dynamic &#34;pure perl&#34; interface using your Lyrics::Fetcher module &#40;similar to how I wrote my &#34;StreamFinder&#34; module &#40;see CPAN&#41; for fetching streaming radio-stations &#38; metadata, which works in similar ways!

Thanks again for your quick response!


On Thu Oct 22 05:56:09 2020, BIGPRESH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Hi Jim,
&gt; 
&gt; Many thanks for your contributions - very much appreciated!
&gt; 
&gt; I&#39;ve released an updated Lyrics::Fetcher::AZLyrics with your changes
&gt; this morning, and also released a new Lyrics::Fetcher::Genius
&gt; distribution too.
&gt; 
&gt; I will get to create a distribution for Lyrics::Fetcher::Musixmatch
&gt; ASAP too, hopefully later today.
&gt; 
&gt; I&#39;ve also pushed out an updated Lyrics::Fetcher::LyricWiki which
&gt; removes all attempts to fetch and just carries a deprecation notice.
&gt; 
&gt; I&#39;ll get these releases installed on the box that runs my
&gt; www.lyricsbadger.co.uk site &#40;basically a lyrics search aggregator&#41;
&gt; too.
&gt; 
&gt; Thanks again,
&gt; 
&gt; Dave P &#40;BIGPRESH&#41;
&gt; 
&gt; On 2020-10-22 03:19:04, TURNERJW wrote:
<div class="message-stanza open">&gt; &gt; This code is 10 years old &#38; no longer works, but azlyrics.com &#40;now
&gt; &gt; https&#41; still DOES, so I modified your code to now work with the site
&gt; &gt; here in 2020!  I also made a new fetcher module for www.genius.com
&gt; &gt; whilst I was at it!  Please review, make any changes you see fit and
&gt; &gt; feel free to update to v0.06!
&gt; &gt;
&gt; &gt; BTW, Lyricwiki is now defunct as of a few weeks/months ago &#40;I know
&gt; &gt; b/c
&gt; &gt; I did a bunch of work on the lyricwiki plugin for Fauxdacious &#40;my
&gt; &gt; Audacious fork&#41;, and now I&#39;m going to have to do a bunch more! :&#40;
&gt; &gt;
&gt; &gt; Oh, and thank you for these modules!
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt;
&gt; &gt; Jim Turner
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;28&nbsp;23:02:20&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Marking resolved and submitting an updated request #133624 covering this module and Lyrics::Fetcher in general.

On Thu Oct 22 13:14:12 2020, TURNERJW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wow, that was QUICK!!  A cpl things I just thought of though not bugs,
&gt; could improve Lyric::Fetcher in general in a future release would be:
&gt; 1&#41;  A method function for the user to set &#40;override&#41; the $AGENT string
&gt; for all the fetchers.  2&#41;  Perhaps a &#34;random&#34; fetcher option in
&gt; Lyric::Fetcher-&gt;fetch&#40;&#41;.  It&#39;s been my experience that in general,
&gt; many sited do not like being frequently &#34;scraped&#34;, and if using in a
&gt; streaming audio player, can result in a &#34;hit&#34; every few minutes.  By
&gt; making it easy to randomize the site being scraped &#40;as we now have at
&gt; least 3 to choose from&#41;, one can reduce the likelyhood of having their
&gt; IP address banned by a site.  I haven&#39;t had a chance to install and
&gt; test your official new release &#40;but I assume it&#39;s functionally the
&gt; same&#41;, so you can go ahead and close this bug!  By getting this
&gt; working and out quickly, I&#39;ll now be able to update the &#40;currently
&gt; broken&#41; Lyrics plugins in Fauxdacious media player
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://wildstar84.wordpress.com/fauxdacious/&#41;">https://wildstar84.wordpress.com/fauxdacious/&#41;</a></span> to replace the defunct
&gt; hardcoded &#34;lyrickwiki/fandom&#34; site with a dynamic &#34;pure perl&#34;
&gt; interface using your Lyrics::Fetcher module &#40;similar to how I wrote my
&gt; &#34;StreamFinder&#34; module &#40;see CPAN&#41; for fetching streaming radio-stations
&gt; &#38; metadata, which works in similar ways!
&gt; 
&gt; Thanks again for your quick response!
&gt; 
&gt; 
&gt; On Thu Oct 22 05:56:09 2020, BIGPRESH wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Hi Jim,
&gt; &gt;
&gt; &gt; Many thanks for your contributions - very much appreciated!
&gt; &gt;
&gt; &gt; I&#39;ve released an updated Lyrics::Fetcher::AZLyrics with your changes
&gt; &gt; this morning, and also released a new Lyrics::Fetcher::Genius
&gt; &gt; distribution too.
&gt; &gt;
&gt; &gt; I will get to create a distribution for Lyrics::Fetcher::Musixmatch
&gt; &gt; ASAP too, hopefully later today.
&gt; &gt;
&gt; &gt; I&#39;ve also pushed out an updated Lyrics::Fetcher::LyricWiki which
&gt; &gt; removes all attempts to fetch and just carries a deprecation notice.
&gt; &gt;
&gt; &gt; I&#39;ll get these releases installed on the box that runs my
&gt; &gt; www.lyricsbadger.co.uk site &#40;basically a lyrics search aggregator&#41;
&gt; &gt; too.
&gt; &gt;
&gt; &gt; Thanks again,
&gt; &gt;
&gt; &gt; Dave P &#40;BIGPRESH&#41;
&gt; &gt;
&gt; &gt; On 2020-10-22 03:19:04, TURNERJW wrote:
<div class="message-stanza open">&gt; &gt; &gt; This code is 10 years old &#38; no longer works, but azlyrics.com &#40;now
&gt; &gt; &gt; https&#41; still DOES, so I modified your code to now work with the
&gt; &gt; &gt; site
&gt; &gt; &gt; here in 2020!  I also made a new fetcher module for www.genius.com
&gt; &gt; &gt; whilst I was at it!  Please review, make any changes you see fit
&gt; &gt; &gt; and
&gt; &gt; &gt; feel free to update to v0.06!
&gt; &gt; &gt;
&gt; &gt; &gt; BTW, Lyricwiki is now defunct as of a few weeks/months ago &#40;I know
&gt; &gt; &gt; b/c
&gt; &gt; &gt; I did a bunch of work on the lyricwiki plugin for Fauxdacious &#40;my
&gt; &gt; &gt; Audacious fork&#41;, and now I&#39;m going to have to do a bunch more! :&#40;
&gt; &gt; &gt;
&gt; &gt; &gt; Oh, and thank you for these modules!
&gt; &gt; &gt;
&gt; &gt; &gt; Regards,
&gt; &gt; &gt;
&gt; &gt; &gt; Jim Turner
</div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;28&nbsp;23:02:20&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
