<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #51507 for Business-OnlinePayment-PayflowPro: Add tax, tax exempt, freight, duty, and ponum fields</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #51507 for Business-OnlinePayment-PayflowPro: Add tax, tax exempt, freight, duty, and ponum fields</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Business-OnlinePayment-PayflowPro/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Business-OnlinePayment-PayflowPro/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Business-OnlinePayment-PayflowPro/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Business-OnlinePayment-PayflowPro/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Business-OnlinePayment-PayflowPro">Business-OnlinePayment-PayflowPro CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">51507</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Business-OnlinePayment-PayflowPro/Active/">Business-OnlinePayment-PayflowPro</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
josh [...] infogears.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-4690-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.01</li>
<li>
0.02</li>
<li>
0.03</li>
<li>
0.05</li>
<li>
0.06</li>
<li>
0.07</li>
<li>
0.07_06</li>
<li>
1.00</li>
<li>
1.01</li>
</ul>
    </td>
  </tr>
  <tr id="CF-4691-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;11:48:56&nbsp;2009</span>
    <span class="description">josh [...] infogears.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add tax, tax exempt, freight, duty, and ponum fields</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patch:

*&#41; adds the TAXAMT, FREIGHTAMT, DUTYAMT, TAXEXEMPT, and PONUM fields. I
did not find a document on what fields BOP wants to use for these, so I
used the fields found in the following BOP::AuthorizeNet pending patch,
which seemed to make sense to me. &#40;tax, freight, duty, tax_exempt, and
po_number.&#41;
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=42046">http://rt.cpan.org/Public/Bug/Display.html?id=42046</a></span>

*&#41; allows the user to explicitly set CUSTREF. I did not know a good BOP
field to use for this, so it needs to be used directly if the user needs it.

*&#41; adds clarification in documentation that login/password need to be
used in content call.

-- Josh
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PayflowPro_tax_freight_field_1_01_diff.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/local/lib/perl5/site_perl/5.10.0/Business/OnlinePayment/PayflowPro.pm	2009-09-22 15:11:53.000000000 -0600
+++ PayflowPro.pm	2009-11-13 09:31:39.000000000 -0700
@@ -8,7 +8,7 @@
 
 use base qw&#40;Business::OnlinePayment::HTTPS&#41;;
 
-$VERSION = &#39;1.01&#39;;
+$VERSION = &#39;1.02&#39;;
 $VERSION = eval $VERSION;
 $DEBUG   = 0;
 
@@ -216,6 +216,13 @@
         SHIPTOSTATE     =&gt; &#39;ship_state&#39;,
         SHIPTOZIP       =&gt; &#39;ship_zip&#39;,
         SHIPTOCOUNTRY   =&gt; &#39;ship_country&#39;,
+
+        TAXAMT          =&gt; &#39;tax&#39;,
+        FREIGHTAMT      =&gt; &#39;freight&#39;,
+        DUTYAMT         =&gt; &#39;duty&#39;,
+        TAXEXEMPT       =&gt; &#39;tax_exempt&#39;,
+        PONUM           =&gt; &#39;po_number&#39;,
+
     &#41;;
 
     # Reload %content as _revmap_fields makes our copy old/invalid!
@@ -244,6 +251,7 @@
           SHIPTOFIRSTNAME SHIPTOLASTNAME
           SHIPTOSTREET SHIPTOCITY SHIPTOSTATE SHIPTOZIP SHIPTOCOUNTRY
           CUSTCODE
+          TAXAMT FREIGHTAMT DUTYAMT TAXEXEMPT PONUM CUSTREF
           &#41;
     &#41;;
 
@@ -397,13 +405,15 @@
   
   my $tx = new Business::OnlinePayment&#40;
       &#39;PayflowPro&#39;,
-      &#39;vendor&#39;  =&gt; &#39;your_vendor&#39;,
+      &#39;vendor&#39;  =&gt; &#39;your_vendor_aka_merchant_login&#39;,
       &#39;partner&#39; =&gt; &#39;your_partner&#39;,
       &#39;client_certification_id&#39; =&gt; &#39;GuidUpTo32Chars&#39;,
   &#41;;
   
   # See the module documentation for details of content&#40;&#41;
   $tx-&gt;content&#40;
+      login          =&gt; &#39;your_username&#39;,
+      password       =&gt; &#39;your_password&#39;,
       type           =&gt; &#39;VISA&#39;,
       action         =&gt; &#39;Normal Authorization&#39;,
       description    =&gt; &#39;Business::OnlinePayment::PayflowPro test&#39;,
@@ -647,6 +657,13 @@
       SHIPTOZIP       =&gt; &#39;ship_zip&#39;,
       SHIPTOCOUNTRY   =&gt; &#39;ship_country&#39;,
 
+      TAXAMT          =&gt; &#39;tax&#39;,
+      FREIGHTAMT      =&gt; &#39;freight&#39;,
+      DUTYAMT         =&gt; &#39;duty&#39;,
+      TAXEXEMPT       =&gt; &#39;tax_exempt&#39;,
+      PONUM           =&gt; &#39;po_number&#39;,
+
+
 The required Payflow Pro parameters for credit card transactions are:
 
   TRXTYPE TENDER PARTNER VENDOR USER PWD ORIGID
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;14&nbsp;21:08:05&nbsp;2009</span>
    <span class="description">ivan-pause [...] 420.am -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> phil [...] perkpartners.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 13 11:48:56 2009, josh@infogears.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This patch:
&gt; 
&gt; *&#41; adds the TAXAMT, FREIGHTAMT, DUTYAMT, TAXEXEMPT, and PONUM fields.
&gt;  I did not find a document on what fields BOP wants to use for these,
&gt; so I used the fields found in the following BOP::AuthorizeNet pending
&gt; patch, which seemed to make sense to me. &#40;tax, freight, duty,
&gt; tax_exempt, and po_number.&#41;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=42046">http://rt.cpan.org/Public/Bug/Display.html?id=42046</a></span>
</div>
I applied the patch in 42046 to the AuthorizeNet module, and also
updated B:OP and included those fields as standard content fields.  The
changes will appear in the next releases of those modules.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; *&#41; allows the user to explicitly set CUSTREF. I did not know a good
&gt;  BOP field to use for this, so it needs to be used directly if the
&gt; user needs it.
</div>
Looking at the Payflow Pro documentation, they suggest using the invoice
number, or a unique transaction identifier.

I could see doing one of two things:

1&#41; Use invoice_number.  We don&#39;t map this to anything else except
COMMENT2 right now, and it is what they suggest.  Setting this to our
own unique transaction identifier probably isn&#39;t necessary to find
transactions, since we return the PNREF as order_number.

2&#41; Define a new B:OP content field for unique identifiers and pass this
as CUSTREF &#40;generate one if not passed?&#41;.  We could use request_id? 
&#40;the current docs don&#39;t seem to mention anything about requiring it for
X-VPS-Request-ID or any X-VPS-* headers, actually.  I wonder if they&#39;re
still necessary&#41;. 

Leaning toward the first option.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;14&nbsp;21:08:06&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;16&nbsp;21:10:46&nbsp;2009</span>
    <span class="description">josh [...] infogears.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 14 21:08:05 2009, IVAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Nov 13 11:48:56 2009, josh@infogears.com wrote:
<div class="message-stanza open">&gt; &gt; *&#41; allows the user to explicitly set CUSTREF. I did not know a good
&gt; &gt;  BOP field to use for this, so it needs to be used directly if the
&gt; &gt; user needs it.
</div>&gt; 
&gt; Looking at the Payflow Pro documentation, they suggest using the invoice
&gt; number, or a unique transaction identifier.
&gt; 
&gt; I could see doing one of two things:
&gt; 
&gt; 1&#41; Use invoice_number.  We don&#39;t map this to anything else except
&gt; COMMENT2 right now, and it is what they suggest.  Setting this to our
&gt; own unique transaction identifier probably isn&#39;t necessary to find
&gt; transactions, since we return the PNREF as order_number.
&gt; 
&gt; 2&#41; Define a new B:OP content field for unique identifiers and pass this
&gt; as CUSTREF &#40;generate one if not passed?&#41;.  We could use request_id? 
&gt; &#40;the current docs don&#39;t seem to mention anything about requiring it for
&gt; X-VPS-Request-ID or any X-VPS-* headers, actually.  I wonder if they&#39;re
&gt; still necessary&#41;. 
&gt; 
&gt; Leaning toward the first option.
</div>
Hmm, this is sort of a difficult decision here, because it seems if we
make either of these changes, we may end up breaking something for
someone. For example with 1, the CUSTREF field is limited to 12
characters according to the docs, while COMMENT2 is limited to 128. So
making that change could start truncating someone&#39;s method of reporting
if they are using the invoice_number field for something longer. I guess
we could store to both to keep backward compatibility.

In #2, switching to use request_id seems kind of scary too. Best not to
mess with code that has already been time-tested and works.

I like the idea of adding the unique identifiers, because there are
fields that just aren&#39;t mappable sometimes.

Perhaps we can take a two pronged approach here:
*&#41; map invoice_number to CUSTREF and COMMENT2. This will maintain
backward compatibility and keep the BOP public interface correct.

*&#41; give the user the option to add/override specific payment fields.
This override would be from the custom BOP content unique identifier
field you mentioned. &#40;The keys/values there would get added to the
submitted content data after the regular mapping is done.&#41;

That should give 0 breakage, but provide flexibility to the user in the
cases they need it. &#40;ie. For times when there is no field mapping for a
field they need or if they need to override a mapping done in one of the
payment modules.&#41;

Thoughts?
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
