<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69871 for perl-ldap: LDAPS SSL validation</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69871 for perl-ldap: LDAPS SSL validation</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=perl-ldap">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=perl-ldap">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=perl-ldap">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=perl-ldap">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/perl-ldap">perl-ldap CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69871</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=perl-ldap">perl-ldap</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kacarstensen [...] csupomona.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25226-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25227-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




specify-verifycn-scheme.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/965645/502511/specify-verifycn-scheme.patch">
Tue Aug 09 19:21:28 2011 (2.2k) by kacarstensen [...] csupomona.edu
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/961303/500242/specify-verifycn-scheme.patch">
Thu Jul 28 19:30:25 2011 (1.6k) by kacarstensen [...] csupomona.edu
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=69871">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-961303" href="/Public/Bug/Display.html?id=69871#txn-961303">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;19:30:25&nbsp;2011</span>
    <span class="description">kacarstensen [...] csupomona.edu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> LDAPS SSL validation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 28 Jul 2011 16:30:13 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-perl-ldap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevan Carstensen &lt;kacarstensen [...] csupomona.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/961303/500241/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/500241">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I noticed that Net::LDAP doesn&#39;t seem to correctly verify the SSL
certificate presented by a remote LDAP server, even if verify =&gt;
&#39;require&#39; is given when creating a connection, as in:

    my $ldap = new Net::LDAP&#40;
                             &#34;ldaps://some.ldap.server&#34;,
                             version =&gt; 3,
                             verify =&gt; &#34;require&#34;,
                             capath =&gt; &#34;/etc/ssl/certs&#34;,
                            &#41;;

Specifically, Net::LDAP doesn&#39;t seem to attempt to verify the server&#39;s
identity at all -- as long as the server presents a certificate signed
by a CA that the client trusts, the client allows the connection to
proceed.  This is intuitively wrong, violates section 3.1.3 of RFC 4513,
which describes how LDAP clients should validate SSL certificates, and
effectively allows anyone with an SSL certificate for any site signed by
a widely-trusted CA to successfully impersonate, from the perspective of
Net::LDAP clients, any LDAP server, even if those clients are configured
to strictly validate server certificates.

This behavior seems to be a result of IO::Socket::SSL&#39;s default behavior
regarding identity verification, which is to not validate identities:

  SSL_verifycn_scheme

    Set the scheme used to automatically verify the hostname of the
    peer. See the information about the verification schemes in
    verify_hostname. The default is undef, e.g. to not automatically
    verify the hostname.

&#40;from <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~sullr/IO-Socket-SSL-1.44/SSL.pm&#41;">http://search.cpan.org/~sullr/IO-Socket-SSL-1.44/SSL.pm&#41;</a></span>

We can easily address this by changing the options passed to
IO::Socket::SSL&#39;s new and start_SSL functions. I&#39;m attaching a patch
that does this, setting SSL_verifycn_name to &#39;ldap&#39;. This behaves
correctly in my tests: LDAPS connections to a server only succeed if the
server presents a certificate &#40;signed by a CA trusted by the client&#41;
that correctly identifies the name that the client connected to. 

Details about my setup:

OS/platform: Linux hostname 2.6.37-gentoo-r4 #3 SMP Mon Jul 25 13:44:53 PDT 2011 x86_64 Intel&#40;R&#41; Xeon&#40;TM&#41; CPU 3.16GHz GenuineIntel GNU/Linux

Perl version: This is perl 5, version 12, subversion 3 &#40;v5.12.3&#41; built for x86_64-linux &#40;with 13 registered patches, see perl -V for more detail&#41;
              Locally applied patches:
              0001-gentoo_MakeMaker-RUNPATH.diff
              0002-gentoo_config_over.diff
              0003-gentoo_cpan_definstalldirs.diff
              0004-gentoo_cpanplus_definstalldirs.diff
              0005-gentoo_create-libperl-soname.diff
              0006-gentoo_MakeMaker-delete_packlist.diff
              0007-fixes_8d66b3f9_h2hp_fix.diff
              0008-fixes_f178b03b_h2ph_using_deprecated_goto.diff
              0009-gentoo_mod-paths.diff
              0010-gentoo_enc2xs.diff
              0011-gentoo_IO-Compress_AutoLoader_dropped_from_Compress-Zlib.diff
              0012-gentoo_drop-fstack-protector.diff
              0013-fixes_539689e74a_unwarrantedly_laundering_tainted_data.diff

Package and version: perl-ldap-0.4001

Thanks,
-- 
Kevan Carstensen                        &lt;kacarstensen@csupomona.edu&gt;
Operating Systems Analyst, I&#38;IT Systems, Cal Poly Pomona
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/961303/500242/specify-verifycn-scheme.patch">Download specify-verifycn-scheme.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.6k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-961320" href="/Public/Bug/Display.html?id=69871#txn-961320">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;20:52:47&nbsp;2011</span>
    <span class="description">gbarr [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69871] LDAPS SSL validation </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 28 Jul 2011 19:52:37 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-perl-ldap [...] rt.cpan.org&#34; &lt;bug-perl-ldap [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graham Barr &lt;gbarr [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/961320/500256/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/500256">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 244b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I do not consider myself an expert with SSL options. As such most code in Net::LDAP for SSL has been contributed by others. So before I apply such a patch please consider posting your patch and reasons to the Perl-ldap mailing list. 

iGraham. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-961323" href="/Public/Bug/Display.html?id=69871#txn-961323">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;20:52:48&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-965645" href="/Public/Bug/Display.html?id=69871#txn-965645">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;19:21:28&nbsp;2011</span>
    <span class="description">kacarstensen [...] csupomona.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69871] LDAPS SSL validation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 09 Aug 2011 16:21:16 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-perl-ldap [...] rt.cpan.org&#34; &lt;bug-perl-ldap [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevan Carstensen &lt;kacarstensen [...] csupomona.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/965645/502510/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/502510">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Excerpts from Graham Barr via RT&#39;s message of 2011-07-28 17:52:48 -0700:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69871">https://rt.cpan.org/Ticket/Display.html?id=69871</a></span> &gt;
&gt; 
&gt; I do not consider myself an expert with SSL options. As such most code
&gt; in Net::LDAP for SSL has been contributed by others. So before I apply
&gt; such a patch please consider posting your patch and reasons to the
&gt; Perl-ldap mailing list. 
</div>
You can see the discussion thread at [1]. I&#39;ve attached a copy of the
patch referenced in [2] to this message so it&#39;ll show up on the bug. It
still needs a Changes entry. I&#39;m not sure if you prefer to write those
yourself; if not, I can handle it.

Do you think that&#39;s enough feedback, or would you prefer to wait a
little bit longer to see if any more comments come out of the woodwork?

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.ldap/2011/08/msg3530.html">http://www.nntp.perl.org/group/perl.ldap/2011/08/msg3530.html</a></span> 
[2] <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.ldap/2011/08/msg3533.html">http://www.nntp.perl.org/group/perl.ldap/2011/08/msg3533.html</a></span>

Thanks,
-- 
Kevan Carstensen                        &lt;kacarstensen@csupomona.edu&gt;
Operating Systems Analyst, I&#38;IT Systems, Cal Poly Pomona
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/965645/502511/specify-verifycn-scheme.patch">Download specify-verifycn-scheme.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.2k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-973598" href="/Public/Bug/Display.html?id=69871#txn-973598">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;19:18:16&nbsp;2011</span>
    <span class="description">kacarstensen [...] csupomona.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69871] LDAPS SSL validation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 02 Sep 2011 16:18:07 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-perl-ldap [...] rt.cpan.org&#34; &lt;bug-perl-ldap [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevan Carstensen &lt;kacarstensen [...] csupomona.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/973598/506704/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/506704">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 207b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ping. Any movement on getting these changes merged into perl-ldap?

Thanks,
-- 
Kevan Carstensen                        &lt;kacarstensen@csupomona.edu&gt;
Operating Systems Analyst, I&#38;IT Systems, Cal Poly Pomona
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-973655" href="/Public/Bug/Display.html?id=69871#txn-973655">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;03&nbsp;08:51:22&nbsp;2011</span>
    <span class="description">gbarr [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69871] LDAPS SSL validation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 3 Sep 2011 07:51:06 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-perl-ldap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graham Barr &lt;gbarr [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/973655/506742/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/506742">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 104b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, I dropped the ball on this. 0.42 has been release to CPAN including this pathc

Thanks,
Graham.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-974625" href="/Public/Bug/Display.html?id=69871#txn-974625">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;12:05:24&nbsp;2011</span>
    <span class="description">kacarstensen [...] csupomona.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69871] LDAPS SSL validation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 06 Sep 2011 09:05:15 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-perl-ldap [...] rt.cpan.org&#34; &lt;bug-perl-ldap [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevan Carstensen &lt;kacarstensen [...] csupomona.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/974625/507207/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/507207">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 350b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Excerpts from Graham Barr via RT&#39;s message of 2011-09-03 05:51:23 -0700:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry, I dropped the ball on this. 0.42 has been release to CPAN
&gt; including this pathc
</div>
No worries. Thanks for releasing the new version. :-&#41;

-- 
Kevan Carstensen                        &lt;kacarstensen@csupomona.edu&gt;
Operating Systems Analyst, I&#38;IT Systems, Cal Poly Pomona
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1029774" href="/Public/Bug/Display.html?id=69871#txn-1029774">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;29&nbsp;14:25:33&nbsp;2012</span>
    <span class="description">MARSCHAP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1029774/537113/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/537113">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 440b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 06 12:05:24 2011, kacarstensen@csupomona.edu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Excerpts from Graham Barr via RT&#39;s message of 2011-09-03 05:51:23
</div>-0700:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Sorry, I dropped the ball on this. 0.42 has been release to CPAN
&gt; &gt; including this pathc
</div>&gt; 
&gt; No worries. Thanks for releasing the new version. :-&#41;
</div>
Now that 0.44 has been released with changes in that region, can you
give it a try, test whether it fixes the issue and report back?

Thanks
Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1037018" href="/Public/Bug/Display.html?id=69871#txn-1037018">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;13&nbsp;12:48:01&nbsp;2012</span>
    <span class="description">Sam.Patterson [...] nau.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69871] LDAPS SSL validation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Feb 2012 17:47:39 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-perl-ldap [...] rt.cpan.org&#34; &lt;bug-perl-ldap [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Samuel Trever Patterson &lt;Sam.Patterson [...] nau.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1037018/541377/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/541377">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 857b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Peter,

We were also seeing problems with certificate validation with Net::LDAP version 0.44.

Using the &#34;start_tls&#34; method the only time we see any error at all is using the &#39;cafile&#39; argument and pointing to a file that does not exist. If the file exists at all &#40;even containing a totally non-matching certificate&#41; the TLS connection succeeds. The &#39;capath&#39; argument always results in a successful TLS connection, even if the directory does not exist, exists and has no certs in it, or even if it exists and has the wrong certs in it.

In these tests Perl was version 5.14.2 and IO::Socket::SSL was version 1.54. This was running on 2.6.18-238.9.1.el5.

Regards,

Sam

-- 
Samuel T. Patterson
Systems Administrator-Senior
Northern Arizona University
Information Technology Services
1300 S. Knoles Dr.
Flagstaff, AZ 86011
928-523-1880
Sam.Patterson@nau.edu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1039483" href="/Public/Bug/Display.html?id=69871#txn-1039483">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;09:49:56&nbsp;2012</span>
    <span class="description">MARSCHAP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> LDAPS SSL validation - cannot reproduce</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1039483/542790/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/542790">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Mon Feb 13 12:48:01 2012, Sam.Patterson@nau.edu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We were also seeing problems with certificate validation with
&gt;    Net::LDAP version 0.44.
&gt; 
&gt; Using the &#34;start_tls&#34; method the only time we see any error at all is
&gt;    using the &#39;cafile&#39; argument and pointing to a file that does not
&gt;    exist. If the file exists at all &#40;even containing a totally non-
&gt;    matching certificate&#41; the TLS connection succeeds. The &#39;capath&#39;
&gt;    argument always results in a successful TLS connection, even if the
&gt;    directory does not exist, exists and has no certs in it, or even if
&gt;    it exists and has the wrong certs in it.
&gt; 
&gt; In these tests Perl was version 5.14.2 and IO::Socket::SSL was version
&gt;    1.54. This was running on 2.6.18-238.9.1.el5.
</div>
Strange, I cannot reproduce it.
Using the same Perl and IO::Socket::SSL version that you use, the 
following simple test script:
  #!/usr/bin/perl -W
  use Net::LDAP;
  use Data::Dumper;
  my $ldap = new Net::LDAP&#40;$ARGV[0]&#41; or die &#34;$@&#34;;
  my $mesg = $ldap-&gt;start_tls&#40;verify =&gt; &#34;require&#34;, 
                              cafile =&gt; $ARGV[1],
                              capath =&gt; $ARGV[2]&#41;;
  print Dumper&#40;\$mesg&#41;;

dumps a successfully encrypted session only when
* either &#39;cafile&#39; is set to a non-empty value that contains the
  filename of the certificate of the root CA that issued
  the server&#39;s certificate
* or &#39;capath&#39; is set to a non-empty value and set to a path that
  contains the c_rehash&#39;ed root CA certificate issuing the server&#39;s
  sertificate
In all other cases I tested &#40;e.g. &#39;cafile&#39; not pointing to the
root CA of the server&#39;s cert or &#39;capath&#39; not containing the
file of the server&#39;s root CA&#41; the script dumped an unsuccessful
start_tls operation.

Best
Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1041890" href="/Public/Bug/Display.html?id=69871#txn-1041890">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;12:14:20&nbsp;2012</span>
    <span class="description">Sam.Patterson [...] nau.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69871] LDAPS SSL validation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 24 Feb 2012 17:14:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&lt;bug-perl-ldap [...] rt.cpan.org&gt;&#34; &lt;bug-perl-ldap [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Samuel Trever Patterson &lt;Sam.Patterson [...] nau.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1041890/544129/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/544129">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Peter,

Thanks for getting back to me. I used your code snip and still got those odd results… it looks like the problem is not with Net::LDAP! 

I thought it might have something to do my testing platform and started doing all sorts of tests in various places. 

As far as I was able to determine, this is really an issue with Net::SSLeay and OpenSSL. Net::SSLeay built with version OpenSSL 1.0.0x worked as expected, but Net::SSLeay using OpenSSL version 0.9.8x displayed this odd behavior. &#40;In fact, this 0.9.8x I seem to get a working object in the dump if I used _any_ valid certificate or certificate chain. I only get an error if there were no certificates or the certificate I pointed at was not a real certificate but some random text.&#41; 

I used ldd to &#40;really&#41; see where each SSLeay.so was getting its OpenSSL libraries from. Here&#39;s what I found.

These combinations of software/module failed my tests:
- RHEL 5 Linux with perl 5.8.9, Net::LDAP 0.44, IO::Socket::SSL 1.55, Net::SSLeay 1.42, OpenSSL 0.9.8r
- RHEL 5 Linux with perl 5.12.1, Net::LDAP 0.4001, IO::Socket::SSL 1.33, Net::SSLeay 1.36, OpenSSL 0.9.8o
- OS X with perl 5.12.3, Net::LDAP .04001, IO::Socket::SSL 1.35, Net::SSLeay 1.36, OpenSSL 0.9.8r &#40;This is all the OS X delivered stuff.&#41;

And these succeeded at validating a cert and acted as expected:
- RHEL 5 Linux with perl 5.8.9, Net::LDAP 0.44, IO::Socket::SSL 1.55, Net::SSLeay 1.42, OpenSSL 1.0.0g
- RHEL 5 Linux with perl 5.14.2, Net::LDAP 0.44, IO::Socket::SSL 1.55, Net::SSLeay 1.42, OpenSSL 1.0.0g
- RHEL 6 Linux with perl 5.14.2, Net::LDAP 0.44, IO::Socket::SSL 1.55, Net::SSLeay 1.42, OpenSSL 1.0.0e
- RHEL 6 Linux with perl 5.12.4, Net::LDAP 0.4001, IO::Socket::SSL 1.44, Net::SSLeay 1.36, OpenSSL 1.0.0d
- RHEL 6 Linux with perl 5.8.9, Net::LDAP 0.4001, IO::Socket::SSL 1.44, Net::SSLeay 1.36, OpenSSL 1.0.0-fips

The other problem &#40;and this took a while to find&#41; was that when building Net::SSLeay, if there is a default version of OpenSSL delivered with your Linux distro and you then build your own, more up-to-date version of OpenSSL, the makefile for Net::SSLeay will end up finding the distro-delivered libraries first and using them instead of the version you asked for. &#40;This makes what is really built for Net::SSLeay a bit unpredictable despite what the Makefile.PL prints to the screen…&#41; This is why building Net::SSLeay fails to work sometimes… the headers and libraries may be from totally different versions of OpenSSL. It seems to be a matter of the &#34;-L&#34;s the makefile sends to the complier/linker. I&#39;ll submit a bug for the Net::SSLeay issue.

I do appreciate all of your time and help!

Regards,

Sam
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1078899" href="/Public/Bug/Display.html?id=69871#txn-1078899">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;12:30:32&nbsp;2012</span>
    <span class="description">MARSCHAP [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.476743</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
