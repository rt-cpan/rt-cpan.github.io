<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #19154 for Tk-JComboBox: configure -state=&gt;disabled twice loses original foreground setting</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #19154 for Tk-JComboBox: configure -state=&gt;disabled twice loses original foreground setting</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk-JComboBox/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk-JComboBox/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk-JComboBox/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk-JComboBox/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk-JComboBox">Tk-JComboBox CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">19154</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk-JComboBox/Active/">Tk-JComboBox</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
neal

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-33828-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.05    </td>
  </tr>
  <tr id="CF-33829-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.11    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;08&nbsp;14:59:57&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> configure -state=&gt;disabled twice loses original foreground setting</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you have a jcombobox widget and set its state to disabled twice, if 
you then try to enable it, the color of the foreground text remains 
disabled.  This occurs because the DisableControls sub saves the 
current setting of the colors without checking to see if the controls 
are already disabled.  When DisableControls is called the 2nd time, 
the original saved settings are lost &#40;they&#39;re replaced by the 
current &#39;disabled&#39; settings&#41;.

Env: Tk::JCombobox 1.10 &#40;same code appears in 1.05 - oldest release I 
could find on CPAN&#41;, ActiveState Perl 5.8.8.817, WinXP SP2.

I attached a file to reproduce and a patch with one way to fix.

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;08&nbsp;15:02:45&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Neal</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon May 08 14:59:57 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you have a jcombobox widget and set its state to disabled twice, 
</div>if 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; you then try to enable it, the color of the foreground text remains 
&gt; disabled.  This occurs because the DisableControls sub saves the 
&gt; current setting of the colors without checking to see if the 
</div>controls 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; are already disabled.  When DisableControls is called the 2nd time, 
&gt; the original saved settings are lost &#40;they&#39;re replaced by the 
&gt; current &#39;disabled&#39; settings&#41;.
&gt; 
&gt; Env: Tk::JCombobox 1.10 &#40;same code appears in 1.05 - oldest release 
</div>I 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; could find on CPAN&#41;, ActiveState Perl 5.8.8.817, WinXP SP2.
&gt; 
&gt; I attached a file to reproduce and a patch with one way to fix.
&gt; 
&gt; Thanks.
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
use strict;

use Tk;
use Tk::JComboBox;

my $jcbDir;
my $jcbSelected = &#39;a&#39;;
my @history_table = &#40;&#34;a&#34;,&#34;b&#34;,&#34;c&#34;&#41;;
my $top = MainWindow-&gt;new&#40;&#41;;
$jcbDir = $top-&gt;JComboBox&#40;
  -mode =&gt; &#39;readonly&#39;, -textvariable =&gt; \$jcbSelected,
  -choices =&gt; \@history_table,
&#41;;
$jcbDir-&gt;pack&#40;
  -side =&gt; &#39;left&#39;, -expand =&gt; 0, -fill =&gt; &#34;none&#34;,
&#41;;
$jcbDir-&gt;configure&#40;-state =&gt; &#39;disabled&#39;&#41;;
#
# Following statement causes control to look
# disabled, yet it still responds to events
#
$jcbDir-&gt;configure&#40;-state =&gt; &#39;disabled&#39;&#41;;
$jcbDir-&gt;configure&#40;-state =&gt; &#39;normal&#39;&#41;;
MainLoop&#40;&#41;;
  
exit 1;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- old\JComboBox.pm    Sun Oct 23 09:46:08 2005
+++ new\JComboBox.pm    Mon May  8 14:31:16 2006
@@ -1002,19 +1002,26 @@

    my $bg = $cw-&gt;cget&#40;&#39;-disabledbackground&#39;&#41;;
    my $fg = $cw-&gt;cget&#40;&#39;-disabledforeground&#39;&#41;;
-   $button-&gt;{$SWAP_FG} = $button-&gt;cget&#40;&#39;-foreground&#39;&#41;;
-   $button-&gt;configure&#40;-foreground =&gt; $fg&#41;;
-
+
+   if &#40;$fg ne $button-&gt;cget&#40;&#39;-foreground&#39;&#41;&#41; {
+      $button-&gt;{$SWAP_FG} = $button-&gt;cget&#40;&#39;-foreground&#39;&#41;;
+      $button-&gt;configure&#40;-foreground =&gt; $fg&#41;;
+   }
+
    $cw-&gt;configure&#40;-takefocus =&gt; 0&#41;;
    if &#40;$cw-&gt;mode eq MODE_EDITABLE&#41; {
       $entry-&gt;configure&#40;-state =&gt; &#39;disabled&#39;&#41;;
       return if $Tk::VERSION &gt;= 804;

-      $entry-&gt;{$SWAP_BG} = $entry-&gt;cget&#40;&#39;-background&#39;&#41;;
-      $entry-&gt;configure&#40;-background =&gt; $bg&#41;;
+      if &#40;$bg ne $button-&gt;cget&#40;&#39;-background&#39;&#41;&#41; {
+         $entry-&gt;{$SWAP_BG} = $entry-&gt;cget&#40;&#39;-background&#39;&#41;;
+         $entry-&gt;configure&#40;-background =&gt; $bg&#41;;
+      }
+   }
+   if &#40;$fg ne $button-&gt;cget&#40;&#39;-foreground&#39;&#41;&#41; {
+      $entry-&gt;{$SWAP_FG} = $entry-&gt;cget&#40;&#39;-foreground&#39;&#41;;
+      $entry-&gt;configure&#40;-foreground =&gt; $fg&#41;;
    }
-   $entry-&gt;{$SWAP_FG} = $entry-&gt;cget&#40;&#39;-foreground&#39;&#41;;
-   $entry-&gt;configure&#40;-foreground =&gt; $fg&#41;;
 }

 sub EnableControls</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;08&nbsp;15:02:49&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;09:21:31&nbsp;2006</span>
    <span class="description">RCSEEGE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;09:21:35&nbsp;2006</span>
    <span class="description">RCSEEGE [...] cpan.org -  Fixed in 1.11 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;09:25:11&nbsp;2006</span>
    <span class="description">RCSEEGE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Neal,

  Thanks for the patch. The bug should be resolved in version 1.11 of
Tk-JComboBox.

Rob
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tk-JComboBox-1.11.tar.gz</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;09:25:13&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;09:26:01&nbsp;2006</span>
    <span class="description">RCSEEGE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
