<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #41986 for XML-TreePP: [patch] Prevent a warning when checking Encode version</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #41986 for XML-TreePP: [patch] Prevent a warning when checking Encode version</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-TreePP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-TreePP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-TreePP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-TreePP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-TreePP">XML-TreePP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">41986</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-TreePP/Active/">XML-TreePP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SAPER [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-38466-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38467-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;27&nbsp;12:17:08&nbsp;2008</span>
    <span class="description">SAPER [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [patch] Prevent a warning when checking Encode version</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Yusuke,

XML::TreePP is used at work, and recently I was asked to take 
a look at it because of unwanted warnings, which fill the logs. 
The problem lies in the fact that we mostly use Debian sarge, 
which is shipped with Perl 5.8.4, which includes Encode 1.99_01. 
When the method encode_from_to&#40;&#41; is called, it generates this 
warning: Argument &#34;1.99_01&#34; isn&#39;t numeric in numeric lt &#40;&lt;&#41; 
at .../XML/TreePP.pm line 882

I proposed a patch for the calling to silence the warning. 
Here is a similar patch, now for XML::TreePP itself. 

Also, depending on how often this method is called &#40;I don&#39;t 
maintain the code which makes use of XML::TreePP&#41;, I&#39;d suggest 
to move $check at package level so it&#39;s evaluated only once. 
A even better optimisation &#40;but harder to do&#41; would be to inline 
all the small parts in this method so that when it is called, 
only the code for the current versions of Perl and Encode are 
executed.


Thanks in advance

-- 
Close the world, txEn eht nepO.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XML-TreePP-0.36-version-check.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ru XML-TreePP-0.36-orig/lib/XML/TreePP.pm XML-TreePP-0.36-new/lib/XML/TreePP.pm
--- XML-TreePP-0.36-orig/lib/XML/TreePP.pm	2008-10-26 07:17:10.000000000 +0100
+++ XML-TreePP-0.36-new/lib/XML/TreePP.pm	2008-12-25 20:07:15.000000000 +0100
@@ -1095,7 +1095,11 @@
 
     if &#40; $] &gt;= 5.008 &#41; {
         &#38;load_encode&#40;&#41;;
-        my $check = &#40; $Encode::VERSION &lt; 2.13 &#41; ? 0x400 : Encode::FB_XMLCREF&#40;&#41;;
+        my $check = do {
+            local $SIG{__WARN__} = sub {};
+            $Encode::VERSION &lt; 2.13 ? 0x400 : Encode::FB_XMLCREF&#40;&#41;;
+        };
+
         if &#40; $] &gt;= 5.008001 &#38;&#38; utf8::is_utf8&#40; $$txtref &#41; &#41; {
             if &#40; $to =~ /^utf-?8$/i &#41; {
                 # skip
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;15&nbsp;11:52:23&nbsp;2009</span>
    <span class="description">u-suke [...] kawa.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> xml-treepp [...] yahoogroups.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your patch.

-        my $check = &#40; $Encode::VERSION &lt; 2.13 &#41; ? 0x400 :
Encode::FB_XMLCREF&#40;&#41;;
+        my $ver = &#40; $Encode::VERSION =~ /^&#40;[\d\.]+&#41;/ &#41;[0];
+        my $check = &#40; $ver &lt; 2.13 &#41; ? 0x400 : Encode::FB_XMLCREF&#40;&#41;;

could be fine &#40;but not tested well&#41;.
The next release will be updated with this.

---- Yusuke Kawasaki

On 2008/12/27 12:17:08, SAPER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello Yusuke,
&gt; 
&gt; XML::TreePP is used at work, and recently I was asked to take 
&gt; a look at it because of unwanted warnings, which fill the logs. 
&gt; The problem lies in the fact that we mostly use Debian sarge, 
&gt; which is shipped with Perl 5.8.4, which includes Encode 1.99_01. 
&gt; When the method encode_from_to&#40;&#41; is called, it generates this 
&gt; warning: Argument &#34;1.99_01&#34; isn&#39;t numeric in numeric lt &#40;&lt;&#41; 
&gt; at .../XML/TreePP.pm line 882
&gt; 
&gt; I proposed a patch for the calling to silence the warning. 
&gt; Here is a similar patch, now for XML::TreePP itself. 
&gt; 
&gt; Also, depending on how often this method is called &#40;I don&#39;t 
&gt; maintain the code which makes use of XML::TreePP&#41;, I&#39;d suggest 
&gt; to move $check at package level so it&#39;s evaluated only once. 
&gt; A even better optimisation &#40;but harder to do&#41; would be to inline 
&gt; all the small parts in this method so that when it is called, 
&gt; only the code for the current versions of Perl and Encode are 
&gt; executed.
&gt; 
&gt; 
&gt; Thanks in advance
</div>

FYI, about the reason for &#40; $ver &lt; 2.13 &#41;, see also:
<span class="clickylink"><a target="new" rel="nofollow" href="http://kawa.at.webry.info/200605/article_11.html">http://kawa.at.webry.info/200605/article_11.html</a></span>

Dan-san suggested to use below:
my $check = &#40; $Encode::VERSION &lt; 2.13 &#41; ?  Encode::FB_XMLCREF&#40;&#41; :
Encode::XMLCREF&#40;&#41;;
<span class="clickylink"><a target="new" rel="nofollow" href="http://blog.livedoor.jp/dankogai/archives/50502791.html">http://blog.livedoor.jp/dankogai/archives/50502791.html</a></span>

Both articles are written in Japanese however!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;15&nbsp;11:52:24&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;15&nbsp;15:59:55&nbsp;2009</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41986] [patch] Prevent a warning when checking Encode version </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 Jan 2009 21:58:44 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-TreePP [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sébastien Aperghis-Tramoni &lt;SAPER [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yusuke Kawasaki wrote via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for your patch.
&gt;
&gt; -        my $check = &#40; $Encode::VERSION &lt; 2.13 &#41; ? 0x400 :
&gt; Encode::FB_XMLCREF&#40;&#41;;
&gt; +        my $ver = &#40; $Encode::VERSION =~ /^&#40;[\d\.]+&#41;/ &#41;[0];
&gt; +        my $check = &#40; $ver &lt; 2.13 &#41; ? 0x400 : Encode::FB_XMLCREF&#40;&#41;;
&gt;
&gt; could be fine &#40;but not tested well&#41;.
&gt; The next release will be updated with this.
</div>
Thanks

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; FYI, about the reason for &#40; $ver &lt; 2.13 &#41;, see also:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://kawa.at.webry.info/200605/article_11.html">http://kawa.at.webry.info/200605/article_11.html</a></span>
&gt;
&gt; Dan-san suggested to use below:
&gt; my $check = &#40; $Encode::VERSION &lt; 2.13 &#41; ?  Encode::FB_XMLCREF&#40;&#41; :
&gt; Encode::XMLCREF&#40;&#41;;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.livedoor.jp/dankogai/archives/50502791.html">http://blog.livedoor.jp/dankogai/archives/50502791.html</a></span>
&gt;
&gt; Both articles are written in Japanese however!
</div>

I think I understand the main part of the problem &#40;with the help of  
the fish&#41;.
I was guessing that it wasn&#39;t a gratuitous check, given I have  
similar tests in some of my code that has to deal with old modules or  
old Perls.


-- 
Sébastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;17&nbsp;10:27:30&nbsp;2009</span>
    <span class="description">u-suke [...] kawa.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">XML::TreePP version 0.37 fixed the problem.

<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/XML-TreePP/">http://search.cpan.org/dist/XML-TreePP/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.kawa.net/works/perl/treepp/dist/XML-TreePP-0.37.tar.gz">http://www.kawa.net/works/perl/treepp/dist/XML-TreePP-0.37.tar.gz</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://xml-treepp.googlecode.com/svn/trunk/XML-TreePP/Changes">http://xml-treepp.googlecode.com/svn/trunk/XML-TreePP/Changes</a></span>

2009/01/17 &#40;0.37&#41;
    * supports Perl 5.8.4 which includes Encode 1.99_01. &#40;thanks to 
SAPER&#41;
      <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=41986">http://rt.cpan.org/Public/Bug/Display.html?id=41986</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;17&nbsp;10:27:31&nbsp;2009</span>
    <span class="description">u-suke [...] kawa.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
