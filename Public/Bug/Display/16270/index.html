<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #16270 for Crypt-CBC: Data corruption... Something wrong...</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #16270 for Crypt-CBC: Data corruption... Something wrong...</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Crypt-CBC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Crypt-CBC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Crypt-CBC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Crypt-CBC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-CBC">Crypt-CBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">16270</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Crypt-CBC/Active/">Crypt-CBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">LDS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
msk [...] newmail.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-8356-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
2.15</li>
<li>
2.24</li>
</ul>
    </td>
  </tr>
  <tr id="CF-8357-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;18:48:02&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Data corruption... Something wrong...</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Example

#!/usr/bin/perl
use Crypt::CBC;

my $cipher = Crypt::CBC-&gt;new&#40;
    -key =&gt; &#39;&#39;,
    -cipher =&gt; &#39;Blowfish&#39;,
    -salt   =&gt; 0,
    -padding =&gt; &#34;oneandzeroes&#34;,
    -prepend_iv =&gt; 0
&#41;;
my $key = Crypt::CBC::_null_padding&#40;&#39;aaa&#39;,8,&#39;&#39;&#41;;
$cipher-&gt;key&#40;$key&#41;;
$cipher-&gt;iv&#40;&#39;abcdefgh&#39;&#41;;

$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX&#39;; # Last symbol replaced by P!
#$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAx&#39;; # Last symbol replaced by p!
#$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8&#39;; # Last symbol replaced by 0!
#$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH&#39;; # Last symbol replaced by @!
#$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAh&#39;; # Last symbol replaced by &#39;!


$work = $cipher-&gt;encrypt&#40;$string&#41;; #Encrypt string
$work = $cipher-&gt;decrypt&#40;$work&#41;; #...and decrypt

print $string.&#34;\n&#34;;
print $work.&#34;\n&#34;;



Result:
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP

Other combinations with last symbol of string is ok.

BTW:
Error in documentation:
-------------
  -padding        The padding method, one of &#34;standard&#34;, &#34;space&#34;,                          &#34;onesandzeroes&#34;, or &#34;null&#34;. &#40;default &#34;standard&#34;&#41; 
-------------
oneSandzeroes - must be oneandzeroes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;13:36:16&nbsp;2008</span>
    <span class="description">CHORNY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Shorter program that fails on current version:

#!/usr/bin/perl

use strict;
use warnings;
use Crypt::CBC;

my $cipher = Crypt::CBC-&gt;new&#40;
-key =&gt; &#39;aaab&#39;,
-cipher =&gt; &#39;Blowfish&#39;,
-padding =&gt; &#34;oneandzeroes&#34;,
&#41;;
my $string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX&#39;;
# Last symbol replaced by P!

my $work = $cipher-&gt;encrypt&#40;$string&#41;; #Encrypt string
$work = $cipher-&gt;decrypt&#40;$work&#41;; #...and decrypt

print $string.&#34;\n&#34;;
print $work.&#34;\n&#34;;
die unless $string eq $work;

-- 
Alexandr Ciornii, <span class="clickylink"><a target="new" rel="nofollow" href="http://chorny.net">http://chorny.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;13:36:20&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;13:37:06&nbsp;2008</span>
    <span class="description">CHORNY [...] cpan.org -  Broken in 2.24 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;13:56:55&nbsp;2008</span>
    <span class="description">LDS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;13:57:14&nbsp;2008</span>
    <span class="description">LDS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks. I&#39;m working on this now.

Lincoln

On Sat Dec 03 18:48:02 2005, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Example
&gt; 
&gt; #!/usr/bin/perl
&gt; use Crypt::CBC;
&gt; 
&gt; my $cipher = Crypt::CBC-&gt;new&#40;
&gt;     -key =&gt; &#39;&#39;,
&gt;     -cipher =&gt; &#39;Blowfish&#39;,
&gt;     -salt   =&gt; 0,
&gt;     -padding =&gt; &#34;oneandzeroes&#34;,
&gt;     -prepend_iv =&gt; 0
&gt; &#41;;
&gt; my $key = Crypt::CBC::_null_padding&#40;&#39;aaa&#39;,8,&#39;&#39;&#41;;
&gt; $cipher-&gt;key&#40;$key&#41;;
&gt; $cipher-&gt;iv&#40;&#39;abcdefgh&#39;&#41;;
&gt; 
&gt; $string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX&#39;;
&gt; # Last symbol replaced by P!
&gt; #$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAx&#39;;
&gt; # Last symbol replaced by p!
&gt; #$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8&#39;;
&gt; # Last symbol replaced by 0!
&gt; #$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH&#39;;
&gt; # Last symbol replaced by @!
&gt; #$string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAh&#39;;
&gt; # Last symbol replaced by &#39;!
&gt; 
&gt; 
&gt; $work = $cipher-&gt;encrypt&#40;$string&#41;; #Encrypt string
&gt; $work = $cipher-&gt;decrypt&#40;$work&#41;; #...and decrypt
&gt; 
&gt; print $string.&#34;\n&#34;;
&gt; print $work.&#34;\n&#34;;
&gt; 
&gt; 
&gt; 
&gt; Result:
&gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX
&gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP
&gt; 
&gt; Other combinations with last symbol of string is ok.
&gt; 
&gt; BTW:
&gt; Error in documentation:
&gt; -------------
&gt;   -padding        The padding method, one of &#34;standard&#34;, &#34;space&#34;,
&gt; &#34;onesandzeroes&#34;, or &#34;null&#34;. &#40;default &#34;standard&#34;&#41;
&gt; -------------
&gt; oneSandzeroes - must be oneandzeroes
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;15:26:12&nbsp;2008</span>
    <span class="description">LDS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Try applying this patch. It turns out that Crypt::CBC&#39;s implementation
of oneandzeroes padding is different from Crypt::Rijndael&#39;s, so I&#39;ve had
to add a new compatibility padding.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">? Crypt-CBC-2.24
? Makefile
? blib
? failure.pl
? failure_rijndael.pl
? onezeropadding.patch
? pm_to_blib
Index: CBC.pm
===================================================================
RCS file: /usr/local/cvs_repository/Crypt-CBC/CBC.pm,v
retrieving revision 1.35
diff -c -r1.35 CBC.pm
*** CBC.pm	28 Sep 2007 15:24:12 -0000	1.35
--- CBC.pm	11 Jan 2008 20:24:40 -0000
***************
*** 116,139 ****
  	  unless &#40;$rbs == $bs&#41;;
        }
      } else {
!       $padding = $padding eq &#39;null&#39;          ? \&#38;_null_padding
! 	        :$padding eq &#39;space&#39;         ? \&#38;_space_padding
! 		:$padding eq &#39;oneandzeroes&#39;  ? \&#38;_oneandzeroes_padding
!                 :$padding eq &#39;standard&#39;      ? \&#38;_standard_padding
  	        :croak &#34;&#39;$padding&#39; padding not supported.  See perldoc Crypt::CBC for instructions on creating your own.&#34;;
      }
  
      # CONSISTENCY CHECKS
      # HEADER consistency
      if &#40;$header_mode eq &#39;salt&#39;&#41; {
!       croak &#34;Cannot use salt-based key generation if literal key is specified&#34; if $options-&gt;{literal_key};
!       croak &#34;Cannot use salt-based IV generation if literal IV is specified&#34;   if exists $options-&gt;{iv};
      }
      elsif &#40;$header_mode eq &#39;randomiv&#39;&#41; {
!       croak &#34;Cannot encrypt using a non-8 byte blocksize cipher when using randomiv header mode&#34; unless $bs == 8 || $legacy_hack;
      }
      elsif &#40;$header_mode eq &#39;none&#39;&#41; {
!       croak &#34;You must provide an initialization vector using -iv when using -header=&gt;&#39;none&#39;&#34; unless exists $options-&gt;{iv};
      }
  
      # KEYSIZE consistency
--- 116,144 ----
  	  unless &#40;$rbs == $bs&#41;;
        }
      } else {
!       $padding = $padding eq &#39;null&#39;           ? \&#38;_null_padding
! 	        :$padding eq &#39;space&#39;          ? \&#38;_space_padding
! 		:$padding eq &#39;oneandzeroes&#39;   ? \&#38;_oneandzeroes_padding
! 		:$padding eq &#39;rijndael_compat&#39;? \&#38;_rijndael_compat
!                 :$padding eq &#39;standard&#39;       ? \&#38;_standard_padding
  	        :croak &#34;&#39;$padding&#39; padding not supported.  See perldoc Crypt::CBC for instructions on creating your own.&#34;;
      }
  
      # CONSISTENCY CHECKS
      # HEADER consistency
      if &#40;$header_mode eq &#39;salt&#39;&#41; {
!       croak &#34;Cannot use salt-based key generation if literal key is specified&#34;
! 	if $options-&gt;{literal_key};
!       croak &#34;Cannot use salt-based IV generation if literal IV is specified&#34;
! 	if exists $options-&gt;{iv};
      }
      elsif &#40;$header_mode eq &#39;randomiv&#39;&#41; {
!       croak &#34;Cannot encrypt using a non-8 byte blocksize cipher when using randomiv header mode&#34;
! 	unless $bs == 8 || $legacy_hack;
      }
      elsif &#40;$header_mode eq &#39;none&#39;&#41; {
!       croak &#34;You must provide an initialization vector using -iv when using -header=&gt;&#39;none&#39;&#34;
! 	unless exists $options-&gt;{iv};
      }
  
      # KEYSIZE consistency
***************
*** 222,227 ****
--- 227,236 ----
  
      my $bs = $self-&gt;{&#39;blocksize&#39;};
  
+     croak &#34;When using rijndael_compat padding, plaintext size must be a multiple of $bs&#34;
+       if $self-&gt;{&#39;padding&#39;} eq \&#38;_rijndael_compat
+ 	and length&#40;$data&#41; % $bs;
+ 
      return $result unless &#40;length&#40;$self-&gt;{&#39;buffer&#39;}&#41; &gt;= $bs&#41;;
  
      my @blocks = unpack&#40;&#34;a$bs &#34;x&#40;int&#40;length&#40;$self-&gt;{&#39;buffer&#39;}&#41;/$bs&#41;&#41; . &#34;a*&#34;, $self-&gt;{&#39;buffer&#39;}&#41;;
***************
*** 468,474 ****
  
  sub _oneandzeroes_padding &#40;$$$&#41; {
    my &#40;$b,$bs,$decrypt&#41; = @_;
-   return unless length $b;
    $b = length $b ? $b : &#39;&#39;;
    if &#40;$decrypt eq &#39;d&#39;&#41; {
       my $hex = unpack&#40;&#34;H*&#34;, $b&#41;;
--- 477,482 ----
***************
*** 478,483 ****
--- 486,502 ----
    return $b . pack&#40;&#34;C*&#34;, 128, &#40;0&#41; x &#40;$bs - length&#40;$b&#41; % $bs - 1&#41; &#41;;
  }
  
+ sub _rijndael_compat &#40;$$$&#41; {
+   my &#40;$b,$bs,$decrypt&#41; = @_;
+   return unless length $b;
+   if &#40;$decrypt eq &#39;d&#39;&#41; {
+      my $hex = unpack&#40;&#34;H*&#34;, $b&#41;;
+      $hex =~ s/80*$//s;
+      return pack&#40;&#34;H*&#34;, $hex&#41;;
+   }
+   return $b . pack&#40;&#34;C*&#34;, 128, &#40;0&#41; x &#40;$bs - length&#40;$b&#41; % $bs - 1&#41; &#41;;
+ }
+ 
  sub get_initialization_vector &#40;\$&#41; {
    my $self = shift;
    $self-&gt;iv&#40;&#41;;
***************
*** 628,635 ****
                      &#39;randomiv&#39; -- Randomiv-compatible &#34;RandomIV&#34; header
                      &#39;none&#39;   -- prepend no header at all
  
!   -padding        The padding method, one of &#34;standard&#34;, &#34;space&#34;,
!                      &#34;onesandzeroes&#34;, or &#34;null&#34;. &#40;default &#34;standard&#34;&#41;
  
    -literal_key    If true, the key provided by &#34;key&#34; is used directly
                        for encryption/decryption.  Otherwise the actual
--- 647,655 ----
                      &#39;randomiv&#39; -- Randomiv-compatible &#34;RandomIV&#34; header
                      &#39;none&#39;   -- prepend no header at all
  
!   -padding        The padding method, one of &#34;standard&#34; &#40;default&#41;,
!                      &#34;space&#34;, &#34;oneandzeroes&#34;, &#34;rijndael_compat&#34;,
!                      or &#34;null&#34; &#40;default &#34;standard&#34;&#41;.
  
    -literal_key    If true, the key provided by &#34;key&#34; is used directly
                        for encryption/decryption.  Otherwise the actual
***************
*** 925,931 ****
  
  When the last block of plaintext is shorter than the block size,
  it must be padded. Padding methods include: &#34;standard&#34; &#40;i.e., PKCS#5&#41;,
! &#34;oneandzeroes&#34;, &#34;space&#34;, and &#34;null&#34;.
  
     standard: &#40;default&#41; Binary safe
        pads with the number of bytes that should be truncated. So, if 
--- 945,951 ----
  
  When the last block of plaintext is shorter than the block size,
  it must be padded. Padding methods include: &#34;standard&#34; &#40;i.e., PKCS#5&#41;,
! &#34;oneandzeroes&#34;, &#34;space&#34;, &#34;rijndael_compat&#34; and &#34;null&#34;.
  
     standard: &#40;default&#41; Binary safe
        pads with the number of bytes that should be truncated. So, if 
***************
*** 938,951 ****
        block. If the last block is a full block and blocksize is 8, a
        block of &#34;8000000000000000&#34; will be appended.
  
     null: text only
        pads with as many &#34;00&#34; necessary to fill the block. If the last 
!       block is a full block and blocksize is 8, a block of 
        &#34;0000000000000000&#34; will be appended.
  
     space: text only
        same as &#34;null&#34;, but with &#34;20&#34;.
!       
  Both the standard and oneandzeroes paddings are binary safe.  The
  space and null paddings are recommended only for text data.  Which
  type of padding you use depends on whether you wish to communicate
--- 958,978 ----
        block. If the last block is a full block and blocksize is 8, a
        block of &#34;8000000000000000&#34; will be appended.
  
+    rijndael_compat: Binary safe, with caveats
+       similar to oneandzeroes, except that no padding is performed if
+       the last block is a full block. This is provided for
+       compatibility with Crypt::Rijndael only and can only be used
+       with messages that are a multiple of the Rijndael blocksize
+       of 16 bytes.
+ 
     null: text only
        pads with as many &#34;00&#34; necessary to fill the block. If the last 
!       block is a full block and blocksize is 8, a block of
        &#34;0000000000000000&#34; will be appended.
  
     space: text only
        same as &#34;null&#34;, but with &#34;20&#34;.
! 
  Both the standard and oneandzeroes paddings are binary safe.  The
  space and null paddings are recommended only for text data.  Which
  type of padding you use depends on whether you wish to communicate
Index: MANIFEST
===================================================================
RCS file: /usr/local/cvs_repository/Crypt-CBC/MANIFEST,v
retrieving revision 1.15
diff -c -r1.15 MANIFEST
*** MANIFEST	13 Aug 2006 02:33:15 -0000	1.15
--- MANIFEST	11 Jan 2008 20:24:40 -0000
***************
*** 16,21 ****
--- 16,22 ----
  t/IDEA.t
  t/PCBC.t
  t/Rijndael.t
+ t/onezeropadding.t
  t/Rijndael_compat.t
  t/func.t
  t/null_data.t
Index: t/Rijndael_compat.t
===================================================================
RCS file: /usr/local/cvs_repository/Crypt-CBC/t/Rijndael_compat.t,v
retrieving revision 1.6
diff -c -r1.6 Rijndael_compat.t
*** t/Rijndael_compat.t	9 Jan 2006 23:47:11 -0000	1.6
--- t/Rijndael_compat.t	11 Jan 2008 20:24:40 -0000
***************
*** 48,54 ****
  			    -iv          =&gt; &#39;f&#39; x $bs,
  			    -literal_key =&gt; 1,
  			    -header      =&gt; &#39;none&#39;,
! 			    -padding     =&gt; &#39;oneandzeroes&#39;
                             &#41;,
                             &#34;Couldn&#39;t create new object&#34;&#41;;
  test&#40;3,$j = Crypt::Rijndael-&gt;new&#40;&#39;a&#39; x $ks, Crypt::Rijndael-&gt;MODE_CBC&#41;,
--- 48,54 ----
  			    -iv          =&gt; &#39;f&#39; x $bs,
  			    -literal_key =&gt; 1,
  			    -header      =&gt; &#39;none&#39;,
! 			    -padding     =&gt; &#39;rijndael_compat&#39;,
                             &#41;,
                             &#34;Couldn&#39;t create new object&#34;&#41;;
  test&#40;3,$j = Crypt::Rijndael-&gt;new&#40;&#39;a&#39; x $ks, Crypt::Rijndael-&gt;MODE_CBC&#41;,
Index: t/null_data.t
===================================================================
RCS file: /usr/local/cvs_repository/Crypt-CBC/t/null_data.t,v
retrieving revision 1.4
diff -c -r1.4 null_data.t
*** t/null_data.t	9 Jan 2006 23:47:11 -0000	1.4
--- t/null_data.t	11 Jan 2008 20:24:40 -0000
***************
*** 40,47 ****
  
  for my $mod &#40;@in&#41; {
    for my $pad &#40;@pads&#41; {
!     my $cipher = Crypt::CBC-&gt;new&#40;-key =&gt; &#39;secret&#39;,
! 				 -cipher =&gt; $mod,
  				 -padding =&gt; $pad,
  				&#41;;
      for my $length &#40;1..128&#41; {
--- 40,47 ----
  
  for my $mod &#40;@in&#41; {
    for my $pad &#40;@pads&#41; {
!     my $cipher = Crypt::CBC-&gt;new&#40;-key     =&gt; &#39;secret&#39;,
! 				 -cipher  =&gt; $mod,
  				 -padding =&gt; $pad,
  				&#41;;
      for my $length &#40;1..128&#41; {
Index: t/onezeropadding.t
===================================================================
RCS file: t/onezeropadding.t
diff -N t/onezeropadding.t
*** /dev/null	1 Jan 1970 00:00:00 -0000
--- t/onezeropadding.t	11 Jan 2008 20:24:40 -0000
***************
*** 0 ****
--- 1,46 ----
+ #!/usr/local/bin/perl
+ 
+ use lib &#39;..&#39;,&#39;../blib/lib&#39;,&#39;.&#39;,&#39;./blib/lib&#39;;
+ 
+ my &#40;@mods,@pads,@in,$tnum&#41;;
+ 
+ @mods = qw/Rijndael
+            Blowfish
+            Blowfish_PP
+            IDEA
+            DES
+           /;
+ 
+ for $mod &#40;@mods&#41; {
+    eval &#34;use Crypt::$mod&#40;&#41;; 1&#34; &#38;&#38; push @in,$mod;
+ }
+ 
+ unless &#40;$#in &gt; -1&#41; {
+    print &#34;1..0 # Skipped: no cryptographic modules found\n&#34;;
+    exit;
+ }
+ 
+ sub test {
+     local&#40;$^W&#41; = 0;
+     my&#40;$num, $true,$msg&#41; = @_;
+     $$num++;
+     print&#40;$true ? &#34;ok $$num\n&#34; : &#34;not ok $$num $msg\n&#34;&#41;;
+ }
+ 
+ $tnum = 0;
+ 
+ eval &#34;use Crypt::CBC&#34;;
+ test&#40;\$tnum,!$@,&#34;Couldn&#39;t load module&#34;&#41;;
+ 
+ my $cipher = Crypt::CBC-&gt;new&#40;
+ 			     -key    =&gt; &#39;aaab&#39;,
+ 			     -cipher =&gt; &#39;Rijndael&#39;,
+ 			     -padding =&gt; &#34;oneandzeroes&#34;,
+ &#41;;
+ my $string = &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX&#39;;
+ 
+ my $work  = $cipher-&gt;encrypt&#40;$string&#41;; #Encrypt string
+ my $plain = $cipher-&gt;decrypt&#40;$work&#41;; #...and decrypt
+ 
+ test&#40;\$tnum,$string eq $plain,&#34;oneandzeroes padding not working\n&#34;&#41;;
+ 
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
