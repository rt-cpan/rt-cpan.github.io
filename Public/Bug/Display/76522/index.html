<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #76522 for Catalyst-Runtime: FCGI issues with IIS 7.5</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #76522 for Catalyst-Runtime: FCGI issues with IIS 7.5</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Runtime">Catalyst-Runtime CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">76522</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-Runtime/Active/">Catalyst-Runtime</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">bobtfish [...] bobtfish.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KnowZeroX [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-40040-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
5.90011    </td>
  </tr>
  <tr id="CF-40041-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;12&nbsp;22:59:50&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On IIS7.5 FCGI, PATH_INFO and SCRIPT_NAME seem to be the same, so the Plack CGI 
handler removes PATH_INFO and makes it blank.

In Plack::Handler::FCGI

 $env-&gt;{PATH_INFO} =~ s/^\Q$env-&gt;{SCRIPT_NAME}\E//;

The iis6scriptname fix seems to be useless as it relies on PATH_INFO. Though I am not 
sure it is even necessary anymore. All I know is with a blank PATH_INFO Catalyst does 
not seem to work. And under IIS 7.5 and FCGI the PATH_INFO will always be blank.

I wrote a script for myself around it with no problem but it definitely needs to be 
patched either in Catalyst or Plack.

To note I am using ActiveState Perl and have tested this in 5.12 and 5.14. &#40;Don&#39;t know 
if this makes a difference in comparison to Strawberry Perl&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;04:17:07&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Subject changed from &#40;no value&#41; to &#39;FCGI issues with IIS 7.5&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;04:17:07&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90011 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;04:18:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 12 22:59:50 2012, KnowZeroX@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; it
&gt; definitely needs to be
&gt; patched either in Catalyst or Plack.
</div>
Ok - I agree we should certainly fix this, however I don&#39;t have access
to an IIS 7.5 environment - can you give us a dump of the incoming ENV
before Plack mangles it?

Also, some additional details about what you&#39;re doing to fix it would be
good.

Fixing this &#40;should be&#41; fairly easy - however without appropriate test
data, I&#39;m going to be groping blindly in the dark, and there isn&#39;t quite
enough info in this bug yet for me to be confident in writing tests for
the issue.

Thanks for the bug report, and thanks in advance for further assistance
getting this fixed!
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;04:18:26&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;04:47:38&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the quick response!

On Fri Apr 13 04:18:23 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Apr 12 22:59:50 2012, KnowZeroX@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt; it
&gt; &gt; definitely needs to be
&gt; &gt; patched either in Catalyst or Plack.
</div>&gt; 
&gt; Ok - I agree we should certainly fix this, however I don&#39;t have access
&gt; to an IIS 7.5 environment - can you give us a dump of the incoming ENV
&gt; before Plack mangles it?
&gt; 
</div>
Here are the relevant ENV variables:

GET <span class="clickylink"><a target="new" rel="nofollow" href="http://127.0.0.1:5000/testme/try.html">http://127.0.0.1:5000/testme/try.html</a></span>

PATH_INFO: /testme/try.html
SCRIPT_NAME: /testme/try.html
PATH_TRANSLATED: C:\Sites\Test\root\testme\try.html

GET <span class="clickylink"><a target="new" rel="nofollow" href="http://127.0.0.1:5000/testme/">http://127.0.0.1:5000/testme/</a></span>

PATH_INFO: /testme/test/
SCRIPT_NAME: /testme/test/
PATH_TRANSLATED: C:\Sites\Test\root\testme\test\



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, some additional details about what you&#39;re doing to fix it would 
</div>be
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; good.
&gt; 
&gt; Fixing this &#40;should be&#41; fairly easy - however without appropriate test
&gt; data, I&#39;m going to be groping blindly in the dark, and there isn&#39;t 
</div>quite
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; enough info in this bug yet for me to be confident in writing tests 
</div>for
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the issue.
&gt; 
&gt; Thanks for the bug report, and thanks in advance for further 
</div>assistance
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; getting this fixed!
&gt;  
</div>
As for my patch, I modified the FCGI handler itself with:


        if &#40;$env-&gt;{SERVER_SOFTWARE} &#38;&#38; $env-&gt;{SERVER_SOFTWARE} =~ m/IIS/ 
&#38;&#38; $env-&gt;{SCRIPT_NAME} eq $env-&gt;{PATH_INFO}&#41; {

        } else {
           $env-&gt;{PATH_INFO} =~ s/^\Q$env-&gt;{SCRIPT_NAME}\E//;
        }

Another approach I did was just backup the PATH_INFO into 
PLACK_PATH_INFO and then restore it into the iis6fix middleware, that 
works too.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;05:31:29&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 13 04:47:38 2012, KnowZeroX@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the quick response!
</div>
Thanks for the quick follow up!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here are the relevant ENV variables:
</div>
&lt;snip&gt; - thanks

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Also, some additional details about what you&#39;re doing to fix it 
</div></div>
&lt;snip&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for my patch, I modified the FCGI handler itself with:
</div>
&lt;snip&gt;

Thanks, that&#39;s about the info I need.

Only remaining thing - as this fix behavior should probably be
conditional only to newer versions of IIS - can you confirm what
SERVER_SOFTWARE this should be expecting?

I&#39;m away for all this weekend - but I&#39;ll try to find time to push a
branch with a possible fix on Monday or Tuesday night.

Please feel free to pester if you don&#39;t hear anything for a week &#40;as
I&#39;ve probably forgotten/got distracted&#41; :&#41; 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;12:03:15&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Only remaining thing - as this fix behavior should probably be
&gt; conditional only to newer versions of IIS - can you confirm what
&gt; SERVER_SOFTWARE this should be expecting?
</div>
SERVER_SOFTWARE: Microsoft-IIS/7.5

Not sure how IIS 7.0 is, but I have access to an IIS 6 instance so I am 
going to install a test there and see what effect it has there and get 
back to you.

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m away for all this weekend - but I&#39;ll try to find time to push a
&gt; branch with a possible fix on Monday or Tuesday night.
&gt; 
&gt; Please feel free to pester if you don&#39;t hear anything for a week &#40;as
&gt; I&#39;ve probably forgotten/got distracted&#41; :&#41; 
</div>
I understand, I am leaving on vacation next week myself ;&#41;, if by the 
time I get back I don&#39;t see a fix I&#39;ll follow up with you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;15:50:46&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmmm...IIS 6 seems to be behaving the same way as IIS7.5. And I used Perl 
5.10 on this test.

PATH_INFO: /tryme/test.html
SCRIPT_NAME: /tryme/test.html
PATH_TRANSLATED: C:\Sites\Test\root\tryme\test.html

I guess that leaves 1 more thing to test, whether or not strawberry perl 
differs from activestate perl.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;21:41:53&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have ran Strawberry perl on IIS6

PATH_INFO: /testmenow/now.html
SCRIPT_NAME: /testmenow/now.html
PATH_TRANSLATED: C:\Sites\Test\root\testmenow\now.html

Same output.

By commenting out:

$env-&gt;{PATH_INFO} =~ s/^\Q$env-&gt;{SCRIPT_NAME}\E//;

and leaving iis6 test script running I get the following:

PATH INFO: //testme/try.html
SCRIPT_NAME: 
PATH_TRANSLATED: C:\Sites\Test\root\testme\try.html


So the IIS6 script removes the script name and leaves only the path 
info.

Which leaves me to believe that maybe the person who made the iis6 
testscript may have been working on a earlier version of catalyst on 
their end that did not null out the PATH_INFO. Assuming what the iis6 
script is doing is correct. The simplest solution seems to be:

  my @script_name = split&#40;m!/!, $env-&gt;{SCRIPT_NAME}&#41;;

instead of

  my @script_name = split&#40;m!/!, $env-&gt;{PATH_INFO}&#41;;

in the iis6 script middleware?

or maybe a bit more paranoid approach of:

my @script_name = split&#40;m!/!, $env-&gt;{PATH_INFO} eq &#39;&#39; ? $env-&gt;
{SCRIPT_NAME}:$env-&gt;{PATH_INFO} &#41;;

This way if for some reason somewhere PATH_INFO is actually used it 
won&#39;t intervene with the script.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;23:32:24&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, I think I figured out the logic of why the IIS6ScriptNameFix is there.

If I were to guess IIS6ScriptNameFix was meant for CGI and not for FCGI. 
So a more universal way would be the paranoid way which should work for 
both CGI and FCGI:

my @script_name = split&#40;m!/!, $env-&gt;{PATH_INFO} eq &#39;&#39; ? $env-&gt;
{SCRIPT_NAME}:$env-&gt;{PATH_INFO} &#41;;


And sorry for all the spam, I am just being very paranoid here to not 
break anything for anyone else lol
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;26&nbsp;01:55:34&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Alight I am back, any progress on this issue? or anything else you need 
tested?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;29&nbsp;23:58:45&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t want to give any names, but someone asked me to pester you if 
there has been no patch within a week. So I am following up on the 
progress.

Also would be interested to know if this is an issue with Plack or with 
Catalyst?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;02&nbsp;00:15:39&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Reminder #3

my $count=3;
while &#40; !exists&#40;$bobtfish&#41; &#41; {

print &#34;Reminder #&#34;.&#40;$count++&#41;;
sleep&#40; &#40;24*60*60&#41; &#41;;

}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;08:05:52&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;08:06:27&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, haven&#39;t had the expected time available!

However:

<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=catagits/Catalyst-Runtime.git;a=commitdiff;h=b56161ed4a857706da4a786670694260d38feb6b">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=catagits/Catalyst-Runtime.git;a=commitdiff;h=b56161ed4a857706da4a786670694260d38feb6b</a></span>

Failing tests committed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;08:26:26&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Having studied it more, I think this should be fixed in
Plack::Handler::FCGI - to make the slashes fix &#40;which according to the
comments is lighttpd only&#41; only apply for lighty.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bobtfish/Plack/tree/t0m_iis_fcgi_rt76522">https://github.com/bobtfish/Plack/tree/t0m_iis_fcgi_rt76522</a></span>

I&#39;ve pushed a branch for Plack with some failing tests demonstrating this..
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;08:26:57&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/miyagawa/Plack/pull/284">https://github.com/miyagawa/Plack/pull/284</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;13:34:24&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, thanks a lot!

Have you had a chance to look at the content-length bug?

I have found it causes much more issues then I originally anticipated.

People get this on redirects:


Object Has Moved.

This document can be found at

~~GZIPPED CONTENT~~


As you can guess that looks pretty scary to some users :/

Personally I don&#39;t understand why the &#34;Object Has Moved&#34; is written by 
catalyst. Could it be that both catalyst and IIS are writing an Object 
Has Moved response?

I am going to look into it further myself but so far I think the best 
solution is to have a parameter to tick on and off catalyst writing 
object has moved.

Tell me if you need any testing done.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
