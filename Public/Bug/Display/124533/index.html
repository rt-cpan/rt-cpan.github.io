<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #124533 for File-Find-Object-Rule: Missed root items for option depth enabled as iterator mode</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #124533 for File-Find-Object-Rule: Missed root items for option depth enabled as iterator mode</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/File-Find-Object-Rule/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/File-Find-Object-Rule/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/File-Find-Object-Rule/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/File-Find-Object-Rule/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-Find-Object-Rule">File-Find-Object-Rule CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">124533</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/File-Find-Object-Rule/Active/">File-Find-Object-Rule</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
grzegorz.szyszlo [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-226088-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-226089-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;22&nbsp;04:25:31&nbsp;2018</span>
    <span class="description">grzegorz.szyszlo [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Missed root items for option depth enabled as iterator mode</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Feb 2018 10:24:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-File-Find-Object-Rule [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Grzegorz Szyszlo &lt;grzegorz.szyszlo [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Environment:

Debian perl 5.20.2-3+deb8u9

Debian libfile-find-object-rule-perl 0.0305-1

perl -v

This is perl 5, version 20, subversion 2 &#40;v5.20.2&#41; built for 
x86_64-linux-gnu-thread-multi
&#40;with 100 registered patches, see perl -V for more detail&#41;

additional info, linux distro debian/jessie , working directory is 
formatted as XFS.


Example code that does not work as it should:

use File::Find::Object::Rule;

my   $rule=File::Find::Object::Rule-&gt;new&#40;&#41;;
$rule-&gt;mindepth&#40;1&#41;;   #main directory should not be listed
$rule-&gt;extras&#40;{&#39;depth&#39;=&gt;1}&#41;; #additional option for descending scan, 
usable for remove tree
$rule-&gt;start&#40;&#39;/full/path/to/destroy/something&#39;&#41;; #make iterator

while &#40;&#41;{

     my $item = $rule-&gt;match&#40;&#41;; #fetching iterator

     last unless defined $item;  #this should be done here, because 
$item can be for example 0 or 00 or 000 file or directory, that is 
defined as false and breaks while loop.

     print &#34;$item\n&#34;;  #it in some situation does not display first 
level of subdirectories, because match&#40;&#41; iterator does not give it.

     #some optional work with destroying like:

    #if &#40;-d $item&#41; {rmdir $item; next}; unlink $item;  #destroy file or 
directory

   }

prepare on first level about 16 subdirectories, at second level 256 
subdirectories perl first level subdirectory, and in all 2th level 
subdirectory, prepare 256 empty files maked for example by touch shell 
command.


Main directory contains only subdirectories, and its contains second 
level of subdirectories. Finally, second level subdirectories contains 
files.

Variant one, match method gives all items, excepts first subdirectory level.

Variant two, structure has only empty first subdirectory level, and all 
is working properly.


I do some workaroud, continously call scanning with removing items, 
unless last scan gives no elements. Usually it do 2 scans.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;22&nbsp;06:06:30&nbsp;2018</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 22 04:25:31 2018, grzegorz.szyszlo@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Environment:
&gt; 
&gt; Debian perl 5.20.2-3+deb8u9
&gt; 
&gt; Debian libfile-find-object-rule-perl 0.0305-1
&gt; 
</div>
Hi Gregor!

It is not clear from your report how to reproduce the problem. Can you please read over <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shlomif/how-to-share-code-online">https://github.com/shlomif/how-to-share-code-online</a></span> carefully and prepare a github/etc. repo with everything that is needed to reproduce the problem? Perhaps use Test::More.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -v
&gt; 
&gt; This is perl 5, version 20, subversion 2 &#40;v5.20.2&#41; built for 
&gt; x86_64-linux-gnu-thread-multi
&gt; &#40;with 100 registered patches, see perl -V for more detail&#41;
&gt; 
&gt; additional info, linux distro debian/jessie , working directory is 
&gt; formatted as XFS.
&gt; 
&gt; 
&gt; Example code that does not work as it should:
&gt; 
&gt; use File::Find::Object::Rule;
&gt; 
&gt; my   $rule=File::Find::Object::Rule-&gt;new&#40;&#41;;
&gt; $rule-&gt;mindepth&#40;1&#41;;   #main directory should not be listed
&gt; $rule-&gt;extras&#40;{&#39;depth&#39;=&gt;1}&#41;; #additional option for descending scan, 
&gt; usable for remove tree
&gt; $rule-&gt;start&#40;&#39;/full/path/to/destroy/something&#39;&#41;; #make iterator
&gt; 
&gt; while &#40;&#41;{
&gt; 
&gt;      my $item = $rule-&gt;match&#40;&#41;; #fetching iterator
&gt; 
&gt;      last unless defined $item;  #this should be done here, because 
&gt; $item can be for example 0 or 00 or 000 file or directory, that is 
&gt; defined as false and breaks while loop.
&gt; 
&gt;      print &#34;$item\n&#34;;  #it in some situation does not display first 
&gt; level of subdirectories, because match&#40;&#41; iterator does not give it.
&gt; 
&gt;      #some optional work with destroying like:
&gt; 
&gt;     #if &#40;-d $item&#41; {rmdir $item; next}; unlink $item;  #destroy file or 
&gt; directory
&gt; 
&gt;    }
&gt; 
&gt; prepare on first level about 16 subdirectories, at second level 256 
&gt; subdirectories perl first level subdirectory, and in all 2th level 
&gt; subdirectory, prepare 256 empty files maked for example by touch shell 
&gt; command.
&gt; 
&gt; 
&gt; Main directory contains only subdirectories, and its contains second 
&gt; level of subdirectories. Finally, second level subdirectories contains 
&gt; files.
&gt; 
&gt; Variant one, match method gives all items, excepts first subdirectory level.
&gt; 
&gt; Variant two, structure has only empty first subdirectory level, and all 
&gt; is working properly.
&gt; 
&gt; 
&gt; I do some workaroud, continously call scanning with removing items, 
&gt; unless last scan gives no elements. Usually it do 2 scans.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;22&nbsp;06:06:31&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;19&nbsp;13:40:00&nbsp;2018</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 22 06:06:30 2018, SHLOMIF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Feb 22 04:25:31 2018, grzegorz.szyszlo@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Environment:
&gt; &gt;
&gt; &gt; Debian perl 5.20.2-3+deb8u9
&gt; &gt;
&gt; &gt; Debian libfile-find-object-rule-perl 0.0305-1
&gt; &gt;
</div>&gt; 
&gt; Hi Gregor!
&gt; 
&gt; It is not clear from your report how to reproduce the problem. Can you
&gt; please read over <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shlomif/how-to-share-code-online">https://github.com/shlomif/how-to-share-code-online</a></span>
&gt; carefully and prepare a github/etc. repo with everything that is
&gt; needed to reproduce the problem? Perhaps use Test::More.
&gt; 
</div>
marking as rejected because my request was not handled for 4 months now.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; perl -v
&gt; &gt;
&gt; &gt; This is perl 5, version 20, subversion 2 &#40;v5.20.2&#41; built for
&gt; &gt; x86_64-linux-gnu-thread-multi
&gt; &gt; &#40;with 100 registered patches, see perl -V for more detail&#41;
&gt; &gt;
&gt; &gt; additional info, linux distro debian/jessie , working directory is
&gt; &gt; formatted as XFS.
&gt; &gt;
&gt; &gt;
&gt; &gt; Example code that does not work as it should:
&gt; &gt;
&gt; &gt; use File::Find::Object::Rule;
&gt; &gt;
&gt; &gt; my   $rule=File::Find::Object::Rule-&gt;new&#40;&#41;;
&gt; &gt; $rule-&gt;mindepth&#40;1&#41;;   #main directory should not be listed
&gt; &gt;  $rule-&gt;extras&#40;{&#39;depth&#39;=&gt;1}&#41;; #additional option for descending scan,
&gt; &gt; usable for remove tree
&gt; &gt; $rule-&gt;start&#40;&#39;/full/path/to/destroy/something&#39;&#41;; #make iterator
&gt; &gt;
&gt; &gt; while &#40;&#41;{
&gt; &gt;
&gt; &gt;     my $item = $rule-&gt;match&#40;&#41;; #fetching iterator
&gt; &gt;
&gt; &gt;     last unless defined $item;  #this should be done here, because
&gt; &gt; $item can be for example 0 or 00 or 000 file or directory, that is
&gt; &gt; defined as false and breaks while loop.
&gt; &gt;
&gt; &gt;     print &#34;$item\n&#34;;  #it in some situation does not display first
&gt; &gt; level of subdirectories, because match&#40;&#41; iterator does not give it.
&gt; &gt;
&gt; &gt;     #some optional work with destroying like:
&gt; &gt;
&gt; &gt;    #if &#40;-d $item&#41; {rmdir $item; next}; unlink $item;  #destroy file
&gt; &gt; or
&gt; &gt; directory
&gt; &gt;
&gt; &gt;   }
&gt; &gt;
&gt; &gt; prepare on first level about 16 subdirectories, at second level 256
&gt; &gt; subdirectories perl first level subdirectory, and in all 2th level
&gt; &gt; subdirectory, prepare 256 empty files maked for example by touch
&gt; &gt; shell
&gt; &gt; command.
&gt; &gt;
&gt; &gt;
&gt; &gt; Main directory contains only subdirectories, and its contains second
&gt; &gt; level of subdirectories. Finally, second level subdirectories
&gt; &gt; contains
&gt; &gt; files.
&gt; &gt;
&gt; &gt; Variant one, match method gives all items, excepts first subdirectory
&gt; &gt; level.
&gt; &gt;
&gt; &gt; Variant two, structure has only empty first subdirectory level, and
&gt; &gt; all
&gt; &gt; is working properly.
&gt; &gt;
&gt; &gt;
&gt; &gt; I do some workaroud, continously call scanning with removing items,
&gt; &gt; unless last scan gives no elements. Usually it do 2 scans.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;19&nbsp;13:40:01&nbsp;2018</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
