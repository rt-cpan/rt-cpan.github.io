<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #49061 for DBD-ODBC: SQL Server connection broken after query with many bind parameters</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #49061 for DBD-ODBC: SQL Server connection broken after query with many bind parameters</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-ODBC">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-ODBC">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-ODBC">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-ODBC">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">49061</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-ODBC">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
oystein.torget [...] dnv.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.15    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




faq_entry.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/680583/350357/faq_entry.txt">
Thu Oct 22 02:38:03 2009 (1.4k) by oystein.torget [...] dnv.com
</a>
</font></li>
</ul>


test_number_of_bind.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/654222/335360/test_number_of_bind.pl">
Thu Aug 27 05:05:21 2009 (831b) by oystein.torget [...] dnv.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=49061">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-654222" href="/Public/Bug/Display.html?id=49061#txn-654222">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;27&nbsp;05:05:21&nbsp;2009</span>
    <span class="description">oystein.torget [...] dnv.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SQL Server connection broken after query with many bind paramters</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/654222/335357/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/335357">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 889b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When using more than 2097 bind parameters in a single query, the query 
will fail and database handle will be unusable afterwards and the error 
below is given:

[Microsoft][ODBC SQL Server Driver][DBNETLIB]ConnectionWrite &#40;send&#40;&#41;&#41;. 
&#40;SQL-01000&#41; [state was 01000 now 08S01]
[Microsoft][ODBC SQL Server Driver][DBNETLIB]General network error. 
Check your network documentation. &#40;SQL-08S01&#41;

I am unsure if SQL Server supports more bind parameters[1], but the 
database handle should probably not be unusable afterwards.

The attached script demonstrates the error. It requires a SQL server 
database with a single table called TEST_QUERYSIZE. The table should 
have the columns TESTID and TEST_COLUMN. The type these columns should 
not matter.

The error occurs on SQL Server 2000. I have not tested it on newer 
versions.

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/aa933149&#40;SQL.80&#41;.aspx">http://msdn.microsoft.com/en-us/library/aa933149&#40;SQL.80&#41;.aspx</a></span>
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test_number_of_bind.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/654222/335360/test_number_of_bind.pl">Download test_number_of_bind.pl</a><br />
<span class="downloadcontenttype">text/x-perl 831b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl

use strict;
use warnings;

use DBI;

my $dns = &#34;driver={SQL Server};database=test_querysize;pwd=test;uid=test;server=localhost&#34;;
my $dbh = DBI-&gt;connect&#40; &#34;DBI:ODBC:${dns}&#34;, undef, undef, { PrintError =&gt; 0, RaiseError =&gt; 1 } &#41;;

my @values = 1 .. 2_098 ;
my $question_marks = join&#40; &#39;, &#39;, map { &#39;?&#39; } @values &#41;;


print &#34;\nNumber of bind parameters: &#34; . scalar @values;
print &#34;\n&#34;;

my $select_sql_bind = &lt;&lt;END_SQL;
SELECT
    TESTID
    TEST_COLUMN
FROM
    TEST_QUERYSIZE
WHERE
    TEST_COLUMN IN &#40; $question_marks &#41;
END_SQL

my $result;
eval {
    $result = $dbh-&gt;selectall_arrayref&#40; $select_sql_bind, {}, @values &#41;;
};

if&#40; $@ &#41;{
    print $dbh-&gt;errstr&#40;&#41;;
}


eval {
    $dbh-&gt;selectall_arrayref&#40; &#39;SELECT COUNT&#40;*&#41; FROM TEST_QUERYSIZE&#39; &#41;;
};

if&#40; $@ &#41;{
    print $dbh-&gt;errstr&#40;&#41;;
}</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-660397" href="/Public/Bug/Display.html?id=49061#txn-660397">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;07&nbsp;09:05:18&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/660397/338705/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/338705">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 27 05:05:21 2009, oyse wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When using more than 2097 bind parameters in a single query, the query 
&gt; will fail and database handle will be unusable afterwards and the error 
&gt; below is given:
&gt; 
&gt; [Microsoft][ODBC SQL Server Driver][DBNETLIB]ConnectionWrite &#40;send&#40;&#41;&#41;. 
&gt; &#40;SQL-01000&#41; [state was 01000 now 08S01]
&gt; [Microsoft][ODBC SQL Server Driver][DBNETLIB]General network error. 
&gt; Check your network documentation. &#40;SQL-08S01&#41;
&gt; 
&gt; I am unsure if SQL Server supports more bind parameters[1], but the 
&gt; database handle should probably not be unusable afterwards.
&gt; 
&gt; The attached script demonstrates the error. It requires a SQL server 
&gt; database with a single table called TEST_QUERYSIZE. The table should 
&gt; have the columns TESTID and TEST_COLUMN. The type these columns should 
&gt; not matter.
&gt; 
&gt; The error occurs on SQL Server 2000. I have not tested it on newer 
&gt; versions.
&gt; 
&gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/aa933149&#40;SQL.80&#41;.aspx">http://msdn.microsoft.com/en-us/library/aa933149&#40;SQL.80&#41;.aspx</a></span>
</div>
Sorry it has taken 11 days to reply but I&#39;ve been on holiday. Your test
table and perl script works fine with DBD::ODBC and a number of SQL
Server drivers I use here but fails with some Microsoft SQL Server
drivers. I believe this is a bug in the sql server driver you are using.
As for the database handle being left unusable that depends on whether
it is unusable in DBI/ODBC terms or unusable because the driver has now
broken the protocol it uses on the socket - neither DBI or DBD::ODBC can
do anything about the latter.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-660398" href="/Public/Bug/Display.html?id=49061#txn-660398">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;07&nbsp;09:05:20&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-660903" href="/Public/Bug/Display.html?id=49061#txn-660903">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;08&nbsp;02:32:07&nbsp;2009</span>
    <span class="description">oystein.torget [...] dnv.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/660903/338968/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/338968">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 07 09:05:18 2009, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Aug 27 05:05:21 2009, oyse wrote:
<div class="message-stanza open">&gt; &gt; When using more than 2097 bind parameters in a single query, the query 
&gt; &gt; will fail and database handle will be unusable afterwards and the error 
&gt; &gt; below is given:
&gt; &gt; 
&gt; &gt; [Microsoft][ODBC SQL Server Driver][DBNETLIB]ConnectionWrite &#40;send&#40;&#41;&#41;. 
&gt; &gt; &#40;SQL-01000&#41; [state was 01000 now 08S01]
&gt; &gt; [Microsoft][ODBC SQL Server Driver][DBNETLIB]General network error. 
&gt; &gt; Check your network documentation. &#40;SQL-08S01&#41;
&gt; &gt; 
&gt; &gt; I am unsure if SQL Server supports more bind parameters[1], but the 
&gt; &gt; database handle should probably not be unusable afterwards.
&gt; &gt; 
&gt; &gt; The attached script demonstrates the error. It requires a SQL server 
&gt; &gt; database with a single table called TEST_QUERYSIZE. The table should 
&gt; &gt; have the columns TESTID and TEST_COLUMN. The type these columns should 
&gt; &gt; not matter.
&gt; &gt; 
&gt; &gt; The error occurs on SQL Server 2000. I have not tested it on newer 
&gt; &gt; versions.
&gt; &gt; 
&gt; &gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/aa933149&#40;SQL.80&#41;.aspx">http://msdn.microsoft.com/en-us/library/aa933149&#40;SQL.80&#41;.aspx</a></span>
</div>&gt; 
&gt; Sorry it has taken 11 days to reply but I&#39;ve been on holiday. Your test
&gt; table and perl script works fine with DBD::ODBC and a number of SQL
&gt; Server drivers I use here but fails with some Microsoft SQL Server
&gt; drivers. I believe this is a bug in the sql server driver you are using.
&gt; As for the database handle being left unusable that depends on whether
&gt; it is unusable in DBI/ODBC terms or unusable because the driver has now
&gt; broken the protocol it uses on the socket - neither DBI or DBD::ODBC can
&gt; do anything about the latter.
&gt; 
&gt; Martin
</div>
Thank you for the reply. Could you post a list of all the MS SQL Server
drivers that the test script fails for? Then I could check if the driver
that we use corresponds to one where the test fails.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-664274" href="/Public/Bug/Display.html?id=49061#txn-664274">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;11:06:13&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/664274/340995/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/340995">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1018b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 08 02:32:07 2009, oyse wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Thank you for the reply. Could you post a list of all the MS SQL Server
&gt; drivers that the test script fails for? Then I could check if the driver
&gt; that we use corresponds to one where the test fails.
</div>
Both of your test programs fail with the MS SQL Server ODBC Driver
2000.85.1132.00. I have at least 7 other versions of the driver but no
time to run through them all. Perhaps you could tell me which driver and
version you are using.

Neither of your test programs fail in the same way with the MS SQL
Server Native Client 2005.90.1399.00. In this case, the
test_number_of_bind.pl script fails with &#34;too many parameters provided
in the RPC request. The maximum is 2100&#34;. The test_query_with_binding.pl
script completes with &#34;query length 65552&#34;.

I will leave your 2 issues open for a while whilst we discuss this but I
don&#39;t believe either of them are bugs in DBD::ODBC neither to I believe
there is any way around the problem.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-664496" href="/Public/Bug/Display.html?id=49061#txn-664496">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;03:12:59&nbsp;2009</span>
    <span class="description">oystein.torget [...] dnv.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/664496/341098/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/341098">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 474b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I currently have the SQL Server 2000.85.1132.00 driver.

As both the test cases work as expected with a newer driver it seems 
likely that the problem is the ODBC driver. In that case I see no 
reason to keep the bugs open and it is ok for me if they are closed.

Perhaps an entry about this could be added to the distribution FAQ or 
some other appropriate place in cases others come across the same 
problem? If you want to I can write the entry and submit it as a patch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-664498" href="/Public/Bug/Display.html?id=49061#txn-664498">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;03:56:22&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/664498/341100/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/341100">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 703b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 16 03:12:59 2009, oyse wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I currently have the SQL Server 2000.85.1132.00 driver.
&gt; 
&gt; As both the test cases work as expected with a newer driver it seems 
&gt; likely that the problem is the ODBC driver. In that case I see no 
&gt; reason to keep the bugs open and it is ok for me if they are closed.
&gt; 
&gt; Perhaps an entry about this could be added to the distribution FAQ or 
&gt; some other appropriate place in cases others come across the same 
&gt; problem? If you want to I can write the entry and submit it as a patch.
</div>
I would gratefully accept a FAQ entry including the errors you got and
worth mentioning the limit specified in the error I got. 

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-680366" href="/Public/Bug/Display.html?id=49061#txn-680366">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;21&nbsp;16:05:53&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/680366/350233/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/350233">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 904b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 16 03:56:22 2009, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Sep 16 03:12:59 2009, oyse wrote:
<div class="message-stanza open">&gt; &gt; I currently have the SQL Server 2000.85.1132.00 driver.
&gt; &gt; 
&gt; &gt; As both the test cases work as expected with a newer driver it seems 
&gt; &gt; likely that the problem is the ODBC driver. In that case I see no 
&gt; &gt; reason to keep the bugs open and it is ok for me if they are closed.
&gt; &gt; 
&gt; &gt; Perhaps an entry about this could be added to the distribution FAQ or 
&gt; &gt; some other appropriate place in cases others come across the same 
&gt; &gt; problem? If you want to I can write the entry and submit it as a patch.
</div>&gt; 
&gt; I would gratefully accept a FAQ entry including the errors you got and
&gt; worth mentioning the limit specified in the error I got. 
&gt; 
&gt; Martin
</div>
I am writing this off as an ODBC driver issue and lacking any input on a
FAQ entry there is nothing further I can do.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-680373" href="/Public/Bug/Display.html?id=49061#txn-680373">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;21&nbsp;16:08:00&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-680583" href="/Public/Bug/Display.html?id=49061#txn-680583">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;02:38:03&nbsp;2009</span>
    <span class="description">oystein.torget [...] dnv.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> oystein.torget [...] dnv.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/680583/350354/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/350354">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 21 16:05:53 2009, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Sep 16 03:56:22 2009, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Wed Sep 16 03:12:59 2009, oyse wrote:
<div class="message-stanza open">&gt; &gt; &gt; I currently have the SQL Server 2000.85.1132.00 driver.
&gt; &gt; &gt; 
&gt; &gt; &gt; As both the test cases work as expected with a newer driver it seems 
&gt; &gt; &gt; likely that the problem is the ODBC driver. In that case I see no 
&gt; &gt; &gt; reason to keep the bugs open and it is ok for me if they are closed.
&gt; &gt; &gt; 
&gt; &gt; &gt; Perhaps an entry about this could be added to the distribution FAQ or 
&gt; &gt; &gt; some other appropriate place in cases others come across the same 
&gt; &gt; &gt; problem? If you want to I can write the entry and submit it as a
</div></div></div>patch.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; I would gratefully accept a FAQ entry including the errors you got and
&gt; &gt; worth mentioning the limit specified in the error I got. 
&gt; &gt; 
&gt; &gt; Martin
</div>&gt; 
&gt; I am writing this off as an ODBC driver issue and lacking any input on a
&gt; FAQ entry there is nothing further I can do.
&gt; 
&gt; Martin
</div>
Feel free to close the issue.

I have attached FAQ entries for the two reported bugs. Sorry for the delay.

- Øystein
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/680583/350357/faq_entry.txt">Download faq_entry.txt</a><br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">=head2 &#34;ConnectionWrite &#40;send&#40;&#41;&#41;&#34; error and bind parameters

The following error can happen when using more than 2097 bind parameters in a single query with SQL Server 2000:

 [Microsoft][ODBC SQL Server Driver][DBNETLIB]ConnectionWrite &#40;send&#40;&#41;&#41;.
 &#40;SQL-01000&#41; [state was 01000 now 08S01]
 [Microsoft][ODBC SQL Server Driver][DBNETLIB]General network error.
 Check your network documentation. &#40;SQL-08S01&#41;

This error is most likely due to a bug in the Microsoft SQL Server ODBC driver as it fails for some version of the driver and not others. It is known to fail for version 2000.85.1132.00

Se bug report <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=49061">https://rt.cpan.org/Public/Bug/Display.html?id=49061</a></span> for more details.

=head2 SQL query length limited to about 65500 characters in SQL Server 2000

When using bind parameters and a query longer than about 65500 characters the query will fail with some versions of the SQL Server 2000 ODBC driver. The error message from the server can vary. Below is an example:

 [Microsoft][ODBC SQL Server Driver][SQL Server]Invalid column name
 &#39;TES[...]P1I&#39;. &#40;SQL-42S22&#41; [state was 42S22 now 42000]
 [Microsoft][ODBC SQL Server Driver][SQL Server]Statement&#40;s&#41; could not
 be prepared. &#40;SQL-42000&#41;

Removing the use of binding will allow queries that are longer than 65500 characters.

This bug is known to affect Microsoft SQL Server ODBC driver version 2000.85.1132.00.

See bug report <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=49065">https://rt.cpan.org/Public/Bug/Display.html?id=49065</a></span></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-680584" href="/Public/Bug/Display.html?id=49061#txn-680584">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;02:38:04&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-680626" href="/Public/Bug/Display.html?id=49061#txn-680626">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;03:46:58&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/680626/350380/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/350380">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 127b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the FAQ entries, I have added them and they will be in the
next release.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-680629" href="/Public/Bug/Display.html?id=49061#txn-680629">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;03:47:23&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-680631" href="/Public/Bug/Display.html?id=49061#txn-680631">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;22&nbsp;03:47:45&nbsp;2009</span>
    <span class="description">bohica [...] ntlworld.com -  Subject changed from &#39;SQL Server connection broken after query with many bind paramters&#39; to &#39;SQL Server connection broken after query with many bind parameters&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.585854</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
