<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #5779 for WWW-Mechanize-Cached: please add debug and expiresIn</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #5779 for WWW-Mechanize-Cached: please add debug and expiresIn</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize-Cached/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize-Cached/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize-Cached/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/WWW-Mechanize-Cached/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/oalders/www-mechanize-cached/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-Mechanize-Cached">WWW-Mechanize-Cached CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">5779</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">20 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/WWW-Mechanize-Cached/Active/">WWW-Mechanize-Cached</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
svhwan_forums1

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-36220-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36221-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;24&nbsp;02:20:20&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> please add debug and expiresIn</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I wanted to add 2 features to WWW::Mechanize::Cached:
  1. in new&#40;&#41;, I want to be able to put the WMC in a debug mode to let me know whether it used the cache or not.  I did this by having an additional optional parameter in the new&#40;&#41; - user can set wmc_debug =&gt; 1.
     Then, in the _make_request, I detect this, and set another internal variable wmc_usedCached - from the outside, you check this variable after doing a get&#40;&#41;.

  2. Ooops!  I left one of my debugging print statements in _make_request -
print &#34;REQUEST [$req]\n&#34;;
needs to be taken out.

  3. I want to be able to specify the expiresIn time on a per-get basis.  I added a get&#40;&#41; method that looks for one more parameter &#39;wmc_customExpiresIn&#39; =&gt; &#39;1 day&#39;
or something like that in the get&#40;&#41;.  This gets pulled off the @_ and set in the object.  At the _make_request, it detects the wmc_customExpiresIn and can override the cache set&#40;&#41;.  In the process of this, _make_request deletes the wmc_customExpiresIn, so if I call get again w/o the parameter, it doesn&#39;t leave it set.

  Oh, I don&#39;t know pod, so I didn&#39;t add any of the above to the docs.  Sorry about that.

I attached my file that has these two features.  I based it off the 1.30 release.

-Steve
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package WWW::Mechanize::Cached;

use strict;
use warnings FATAL =&gt; &#39;all&#39;;

=head1 NAME

WWW::Mechanize::Cached - Cache response to be polite

=head1 VERSION

Version 1.30

    $Header: /home/cvs/www-mechanize-cached/Cached.pm,v 1.14 2004/03/14 08:52:43 andy Exp $

=cut

use vars qw&#40; $VERSION &#41;;
$VERSION = &#39;1.30&#39;;

=head1 SYNOPSIS

    use WWW::Mechanize::Cached;

    my $cacher = WWW::Mechanize::Cached-&gt;new;
    $cacher-&gt;get&#40; $url &#41;;

=head1 DESCRIPTION

Uses the L&lt;Cache::Cache&gt; hierarchy to implement a caching Mech. This
lets one perform repeated requests without hammering a server impolitely.

=cut

use base qw&#40; WWW::Mechanize &#41;;
use Carp qw&#40; carp croak &#41;;
use Storable qw&#40; freeze thaw &#41;;

my $cache_key = __PACKAGE__;

=head1 CONSTRUCTOR

=head2 new

Behaves like, and calls, L&lt;WWW::Mechanize&gt;&#39;s C&lt;new&gt; method.  Any parms
passed in get passed to WWW::Mechanize&#39;s constructor.

You can pass in a C&lt;&lt; cache =&gt; $cache_object &gt;&gt; if you want.  The
I&lt;$cache_object&gt; must have C&lt;get&#40;&#41;&gt; and C&lt;set&#40;&#41;&gt; methods like the
C&lt;Cache::Cache&gt; family.

The I&lt;cache&gt; parm used to be a set of parms that described how the
cache object was to be initialized, but I think it makes more sense
to have the user initialize the cache however she wants, and then
pass it in.

=cut

sub new {
    my $class = shift;
    my %mech_args = @_;

    my $cache = delete $mech_args{cache};
    if &#40; $cache &#41; {
        my $ok = &#40;ref&#40;$cache&#41; ne &#34;HASH&#34;&#41; &#38;&#38; $cache-&gt;can&#40;&#34;get&#34;&#41; &#38;&#38; $cache-&gt;can&#40;&#34;set&#34;&#41;;
        if &#40; !$ok &#41; {
            carp &#34;The cache parm must be an initialized cache object&#34;;
            $cache = undef;
        }
    }

    my $wmc_debug = delete $mech_args{&#39;wmc_debug&#39;};

    my $self = $class-&gt;SUPER::new&#40; %mech_args &#41;;
    if &#40;$wmc_debug&#41; {
        $self-&gt;{&#39;wmc_debug&#39;} = $wmc_debug;
    }

    if &#40; !$cache &#41; {
        require Cache::FileCache;
        my $cache_parms = {
            default_expires_in =&gt; &#34;1d&#34;,
            namespace =&gt; &#39;www-mechanize-cached&#39;,
        };
        $cache = Cache::FileCache-&gt;new&#40; $cache_parms &#41;;
    }

    $self-&gt;{$cache_key} = $cache;

    return $self;
}

=head1 METHODS

All methods are provided by L&lt;WWW::Mechanize&gt;. See that module&#39;s
documentation for details.

=cut

sub _make_request {
    my $self = shift;
    my $request = shift;

    my $req = $request-&gt;as_string;
    my $cache = $self-&gt;{$cache_key};
    my $v = $cache-&gt;get&#40; $req &#41;;
    my $wmc_customExpiresIn = delete $self-&gt;{&#39;wmc_customExpiresIn&#39;};
    if &#40;$v&#41; {
        if &#40;$self-&gt;{&#39;wmc_debug&#39;}&#41; {
		$self-&gt;{&#39;wmc_usedCached&#39;} = 1;
        }
        $v = thaw $v;
    } else {
print &#34;REQUEST [$req]\n&#34;;
        if &#40;$self-&gt;{&#39;wmc_debug&#39;}&#41; {
		$self-&gt;{&#39;wmc_usedCached&#39;} = 0;
        }
        $v = $self-&gt;SUPER::_make_request&#40; $request, @_ &#41;;
        if &#40;defined&#40;$wmc_customExpiresIn&#41;&#41; {
            $cache-&gt;set&#40; $req, freeze&#40;$v&#41;, $wmc_customExpiresIn &#41;;
        } else {
            $cache-&gt;set&#40; $req, freeze&#40;$v&#41; &#41;;
        }
    };

    # An odd line to need.
    $self-&gt;{proxy} = {} unless defined $self-&gt;{proxy};

    return $v;
}

sub get {
    my $self = shift;
    my $uri = shift;
    my %paramHash = @_;

    my $wmc_customExpiresIn = delete $paramHash{&#39;wmc_customExpiresIn&#39;};
    if &#40;defined&#40;$wmc_customExpiresIn&#41;&#41; {
        $self-&gt;{&#39;wmc_customExpiresIn&#39;} = $wmc_customExpiresIn;
    }
    @_ = &#40;%paramHash&#41;;

    return $self-&gt;SUPER::get&#40; $uri, @_ &#41;;
}

=head1 THANKS

Andy Lester &#40;PETDANCE&#41; for L&lt;WWW::Mechanize&gt;.

=head1 ODDITIES

It may sometimes seem as if it&#39;s not caching something. And this
may well be true. It uses the HTTP request, in string form, as the key
to the cache entries, so any minor changes will result in a different
key. This is most noticable when following links as L&lt;WWW::Mechanize&gt;
adds a C&lt;Referer&gt; header.

=head1 BUGS, REQUESTS, COMMENTS

Support for this module is provided via the CPAN RT system:

    <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/NoAuth/ReportBug.html?Queue=WWW-Mechanize-Cached">http://rt.cpan.org/NoAuth/ReportBug.html?Queue=WWW-Mechanize-Cached</a></span>

    bug-www-mechanize-cached@rt.cpan.org

This makes it much easier for me to track things and thus means
your problem is less likely to be neglected.

=head1 LICENCE AND COPYRIGHT

This module is copyright Iain Truskett and Andy Lester, 2004. All rights
reserved.

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.000 or,
at your option, any later version of Perl 5 you may have available.

The full text of the licences can be found in the F&lt;Artistic&gt; and
F&lt;COPYING&gt; files included with this module, or in L&lt;perlartistic&gt; and
L&lt;perlgpl&gt; as supplied with Perl 5.8.1 and later.

=head1 AUTHOR

Iain Truskett &lt;spoon@cpan.org&gt;, currently maintained by Andy Lester
&lt;petdance@cpan.org&gt;

=head1 SEE ALSO

L&lt;perl&gt;, L&lt;WWW::Mechanize&gt;.

=cut

&#34;We miss you, Spoon&#34;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;24&nbsp;11:08:17&nbsp;2004</span>
    <span class="description">andy [...] petdance.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Mar 2004 10:08:12 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andy Lester &lt;andy [...] petdance.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-WWW-Mechanize-Cached [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;AdminCc of cpan Ticket #5779&#34;: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #5779] please add debug and expiresIn</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I wanted to add 2 features to WWW::Mechanize::Cached:
&gt;   1. in new&#40;&#41;, I want to be able to put the WMC in a debug mode
</div>
I think what I&#39;ll do is add a method $mech-&gt;cached&#40;&#41; that you can ask
about, and don&#39;t even have to put it in debug mode.

I&#39;ll try to look at your patches tonight.  I have a project I&#39;m working
on that does heavy use of WMC, so your patches are hitting just right.

xoa

-- 
Andy Lester =&gt; andy@petdance.com =&gt; www.petdance.com =&gt; AIM:petdance
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;30&nbsp;01:10:50&nbsp;2010</span>
    <span class="description">olaf [...] wundersolutions.com -  Correspondence added</span>
    <span class="time-taken">20 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 24 11:08:17 2004, andy@petdance.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I wanted to add 2 features to WWW::Mechanize::Cached:
&gt; &gt;   1. in new&#40;&#41;, I want to be able to put the WMC in a debug mode
</div>&gt; 
&gt; I think what I&#39;ll do is add a method $mech-&gt;cached&#40;&#41; that you can ask
&gt; about, and don&#39;t even have to put it in debug mode.
&gt; 
&gt; I&#39;ll try to look at your patches tonight.  I have a project I&#39;m working
&gt; on that does heavy use of WMC, so your patches are hitting just right.
&gt; 
&gt; xoa
&gt; 
</div>
I see that the is_cached&#40;&#41; method was added some time ago.  As far as
expiring on a per-response basis, I&#39;m not sure how useful that would be.
 If this is still something you feel strongly about, feel free to open a
wish list ticket to discuss this.  I think that since this ticket has
been open around 6 years now, it might be OK to close it since this
doesn&#39;t seem like a high demand issue at this point.

All the best,

Olaf
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;30&nbsp;01:10:50&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;30&nbsp;01:10:50&nbsp;2010</span>
    <span class="description">olaf [...] wundersolutions.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
