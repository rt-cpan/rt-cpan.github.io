<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #56687 for Fey: Except clause in SQLite</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #56687 for Fey: Except clause in SQLite</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Fey/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Fey/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Fey/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Fey/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Fey">Fey CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">56687</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Fey/Active/">Fey</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bitcard [...] iijo.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-220552-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-220553-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;17&nbsp;10:06:15&nbsp;2010</span>
    <span class="description">bitcard [...] iijo.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Except clause in SQLite</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fey generates a query that looks like:

&#40;select_clause_A&#41; EXCEPT &#40;select_clause_B&#41;

Running this on SQLite 3.6.10, I get the following error:

SQL Error: near &#34;&#40;&#34;: syntax error

SQLite will only accept:

select_clause_A EXCEPT select_clause_B

I think Fey generates similar sql for union and intersect, and again 
SQLite doesn&#39;t like the parenthesis for those statements &#40;see the 
&#39;compound operater&#39;&#41;:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/lang_select.html">http://www.sqlite.org/lang_select.html</a></span>

Unfortunately I think MySQL does require parenthesis if you use an 
&#39;order by&#39; clause:
<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.0/en/union.html">http://dev.mysql.com/doc/refman/5.0/en/union.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;21&nbsp;23:43:11&nbsp;2010</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 17 10:06:15 2010, bitcard@iijo.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fey generates a query that looks like:
&gt; 
&gt; &#40;select_clause_A&#41; EXCEPT &#40;select_clause_B&#41;
&gt; 
&gt; Running this on SQLite 3.6.10, I get the following error:
&gt; 
&gt; SQL Error: near &#34;&#40;&#34;: syntax error
&gt; 
&gt; SQLite will only accept:
&gt; 
&gt; select_clause_A EXCEPT select_clause_B
&gt; 
&gt; I think Fey generates similar sql for union and intersect, and again 
&gt; SQLite doesn&#39;t like the parenthesis for those statements &#40;see the 
&gt; &#39;compound operater&#39;&#41;:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/lang_select.html">http://www.sqlite.org/lang_select.html</a></span>
&gt; 
&gt; Unfortunately I think MySQL does require parenthesis if you use an 
&gt; &#39;order by&#39; clause:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.0/en/union.html">http://dev.mysql.com/doc/refman/5.0/en/union.html</a></span>
</div>
If one form or the other is standard, that&#39;s one Fey should generate.

One way to fix this would be to release a Fey::SQL::SQLite which
provided some SQLite specific SQL generation tweaks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;21&nbsp;23:43:14&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;11&nbsp;00:34:17&nbsp;2011</span>
    <span class="description">bitcard [...] iijo.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bitcard [...] iijo.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I looked into this some more today.  Apparently the MySQL docs I linked to 
previously are just *suggesting* parens.  They aren&#39;t actually *required*.  I 
tested it out on MySQL and PostgreSQL and verified parens are not required.  So 
this bug became a lot easier -- lets just remove the parens.  

Note that MySQL allows you to order and limit each clause of a 
union/except/intersect.  This is apparently not part of the SQL standard according 
to the link below.  However, if you remove to the parens from Fey, these types of 
queries will no longer work even though they did in the past.  

Also FYI, the link below seems to indicate that the SQL standard allows parens, 
but doesn&#39;t require them.  

<span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/4653124/what-does-the-sql-standard-say-about-">http://stackoverflow.com/questions/4653124/what-does-the-sql-standard-say-about-</a></span>
parentheses-in-unions



On Fri May 21 23:43:11 2010, DROLSKY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Apr 17 10:06:15 2010, bitcard@iijo.org wrote:
<div class="message-stanza open">&gt; &gt; Fey generates a query that looks like:
&gt; &gt; 
&gt; &gt; &#40;select_clause_A&#41; EXCEPT &#40;select_clause_B&#41;
&gt; &gt; 
&gt; &gt; Running this on SQLite 3.6.10, I get the following error:
&gt; &gt; 
&gt; &gt; SQL Error: near &#34;&#40;&#34;: syntax error
&gt; &gt; 
&gt; &gt; SQLite will only accept:
&gt; &gt; 
&gt; &gt; select_clause_A EXCEPT select_clause_B
&gt; &gt; 
&gt; &gt; I think Fey generates similar sql for union and intersect, and again 
&gt; &gt; SQLite doesn&#39;t like the parenthesis for those statements &#40;see the 
&gt; &gt; &#39;compound operater&#39;&#41;:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/lang_select.html">http://www.sqlite.org/lang_select.html</a></span>
&gt; &gt; 
&gt; &gt; Unfortunately I think MySQL does require parenthesis if you use an 
&gt; &gt; &#39;order by&#39; clause:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.0/en/union.html">http://dev.mysql.com/doc/refman/5.0/en/union.html</a></span>
</div>&gt; 
&gt; If one form or the other is standard, that&#39;s one Fey should generate.
&gt; 
&gt; One way to fix this would be to release a Fey::SQL::SQLite which
&gt; provided some SQLite specific SQL generation tweaks.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;11&nbsp;01:45:28&nbsp;2011</span>
    <span class="description">bitcard [...] iijo.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bitcard [...] iijo.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I made the change to remove parens on github real quick by forking Fey 
from gitpan.  But no matter what I click, it tries to make me submit the 
pull request to gitpan instead of autarch.  I guess I don&#39;t understand 
the work flow for this kind of thing. 

Let me know if there is anything I can do to help out.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kablamo/Fey">https://github.com/kablamo/Fey</a></span>


On Tue Jan 11 00:34:17 2011, bitcard@iijo.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I looked into this some more today.  Apparently the MySQL docs I
&gt; linked to
&gt; previously are just *suggesting* parens.  They aren&#39;t actually
&gt; *required*.  I
&gt; tested it out on MySQL and PostgreSQL and verified parens are not
&gt; required.  So
&gt; this bug became a lot easier -- lets just remove the parens.
&gt; 
&gt; Note that MySQL allows you to order and limit each clause of a
&gt; union/except/intersect.  This is apparently not part of the SQL
&gt; standard according
&gt; to the link below.  However, if you remove to the parens from Fey,
&gt; these types of
&gt; queries will no longer work even though they did in the past.
&gt; 
&gt; Also FYI, the link below seems to indicate that the SQL standard
&gt; allows parens,
&gt; but doesn&#39;t require them.
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/4653124/what-does-the-sql-standard-">http://stackoverflow.com/questions/4653124/what-does-the-sql-standard-</a></span>
&gt; say-about-
&gt; parentheses-in-unions
&gt; 
&gt; 
&gt; 
&gt; On Fri May 21 23:43:11 2010, DROLSKY wrote:
<div class="message-stanza open">&gt; &gt; On Sat Apr 17 10:06:15 2010, bitcard@iijo.org wrote:
<div class="message-stanza open">&gt; &gt; &gt; Fey generates a query that looks like:
&gt; &gt; &gt;
&gt; &gt; &gt; &#40;select_clause_A&#41; EXCEPT &#40;select_clause_B&#41;
&gt; &gt; &gt;
&gt; &gt; &gt; Running this on SQLite 3.6.10, I get the following error:
&gt; &gt; &gt;
&gt; &gt; &gt; SQL Error: near &#34;&#40;&#34;: syntax error
&gt; &gt; &gt;
&gt; &gt; &gt; SQLite will only accept:
&gt; &gt; &gt;
&gt; &gt; &gt; select_clause_A EXCEPT select_clause_B
&gt; &gt; &gt;
&gt; &gt; &gt; I think Fey generates similar sql for union and intersect, and
</div></div>&gt; again
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; SQLite doesn&#39;t like the parenthesis for those statements &#40;see the
&gt; &gt; &gt; &#39;compound operater&#39;&#41;:
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/lang_select.html">http://www.sqlite.org/lang_select.html</a></span>
&gt; &gt; &gt;
&gt; &gt; &gt; Unfortunately I think MySQL does require parenthesis if you use an
&gt; &gt; &gt; &#39;order by&#39; clause:
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.0/en/union.html">http://dev.mysql.com/doc/refman/5.0/en/union.html</a></span>
</div>&gt; &gt;
&gt; &gt; If one form or the other is standard, that&#39;s one Fey should
</div>&gt; generate.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; One way to fix this would be to release a Fey::SQL::SQLite which
&gt; &gt; provided some SQLite specific SQL generation tweaks.
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
