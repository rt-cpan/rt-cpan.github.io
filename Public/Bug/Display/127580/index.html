<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127580 for RT-Extension-REST2: Asset search via REST2.0 only works AFTER doing a search on web UI</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127580 for RT-Extension-REST2: Asset search via REST2.0 only works AFTER doing a search on web UI</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=RT-Extension-REST2">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=RT-Extension-REST2">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=RT-Extension-REST2">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=RT-Extension-REST2">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/RT-Extension-REST2">RT-Extension-REST2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127580</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=RT-Extension-REST2">RT-Extension-REST2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mgronczewski [...] efigence.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-268538-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-268539-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=127580">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1818429" href="/Public/Bug/Display.html?id=127580#txn-1818429">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;06&nbsp;09:16:55&nbsp;2018</span>
    <span class="description">mgronczewski [...] efigence.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Asset search via REST2.0 only works AFTER doing a search on web UI</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Nov 2018 14:32:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RT-Extension-REST2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mariusz Gronczewski &lt;mgronczewski [...] efigence.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1818429/978389/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/978389">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe it might be related to <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=123261">https://rt.cpan.org/Public/Bug/Display.html?id=123261</a></span>

tested on stable RT from debian packages and from source running from fastcgi, I&#39;ve set amount of workers to 1 to make repeating it simpler. Only rest2 and token plugins are installed.

REST2.0 search API only starts working AFTER manually doing search via web UI

When searching via REST2.0 API results are always empty at first &#40;catalog have exactly one asset&#41;:

POST {{server_url}}/REST/2.0/assets
Accept: */*
Cache-Control: no-cache
Authorization: token {{token}}

[{ &#34;field&#34; : &#34;id&#34;, &#34;operator&#34; : &#34;&gt;=&#34;, &#34;value&#34; : 0 }]

HTTP/1.1 200 OK
Server: nginx/1.10.3
Date: Tue, 06 Nov 2018 13:27:42 GMT
Content-Type: application/json; charset=&#34;utf-8&#34;
Content-Length: 87
Connection: keep-alive

{
  &#34;page&#34;: 1,
  &#34;count&#34;: 0,
  &#34;items&#34;: [],
  &#34;per_page&#34;: 20,
  &#34;total&#34;: 0
}



but making request to &#34;normal&#34; search &#34;fixes&#34; it:

GET {{server_url}}/Asset/Search/index.html?Catalog=1&#38;Status=&#38;Name=&#38;%21Name=&#38;Description=&#38;%21Description=&#38;Role.Owner=&#38;%21Role.Owner=&#38;Role.HeldBy=&#38;%21Role.HeldBy=&#38;Role.Contact=&#38;%21Role.Contact=&#38;SearchAssets=Search&#38;
Accept: */*
Cache-Control: no-cache
Referer: {{server_url}}
Authorization: token {{token}}

HTTP/1.1 200 OK
Server: nginx/1.10.3
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
Set-Cookie: RT_SID_dev-rt.non.3dart.com.80=699da318b9410dfdd1ebe95fed3e3088; path=/; HttpOnly
Date: Tue, 06 Nov 2018 13:28:28 GMT
Cache-control: no-cache
Pragma: no-cache
X-Frame-Options: DENY

&lt;!DOCTYPE html&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;Found 1 asset&lt;/title&gt;
---- snip ----

after that REST2.0 returns search &#40;same request as first correctly&#41;:


HTTP/1.1 200 OK
Server: nginx/1.10.3
Date: Tue, 06 Nov 2018 13:29:28 GMT
Content-Type: application/json; charset=&#34;utf-8&#34;
Content-Length: 220
Connection: keep-alive

{
  &#34;total&#34;: 1,
  &#34;per_page&#34;: 20,
  &#34;items&#34;: [
    {
      &#34;id&#34;: &#34;1&#34;,
      &#34;_url&#34;: &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://dev-rt.non.3dart.com/REST/2.0/asset/1">http://dev-rt.non.3dart.com/REST/2.0/asset/1</a></span>&#34;,
      &#34;type&#34;: &#34;asset&#34;
    }
  ],
  &#34;count&#34;: 1,
  &#34;page&#34;: 1
}



--
Mariusz Gronczewski, Administrator

Efigence S. A.
ul. WoÅ‚oska 9a, 02-583 Warszawa
T: [+48] 22 380 13 13
F: [+48] 22 380 13 14
E: mariusz.gronczewski@efigence.com &lt;mailto:mariusz.gronczewski@efigence.com&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1818463" href="/Public/Bug/Display.html?id=127580#txn-1818463">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;06&nbsp;13:31:27&nbsp;2018</span>
    <span class="description">BPS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1818463/978412/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/978412">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 405b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 06 09:16:55 2018, mgronczewski@efigence.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I believe it might be related to
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=123261">https://rt.cpan.org/Public/Bug/Display.html?id=123261</a></span>
&gt; 
&gt; tested on stable RT from debian packages and from source running from
&gt; fastcgi,
</div>
Hi Mariusz,

What version of RT and RT::Extension::REST2? You can get these from the system configuration page at Admin &gt; Tools &gt; System Configuration.

Thanks,
Jim
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1818464" href="/Public/Bug/Display.html?id=127580#txn-1818464">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;06&nbsp;13:31:27&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1818574" href="/Public/Bug/Display.html?id=127580#txn-1818574">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;07&nbsp;05:31:08&nbsp;2018</span>
    <span class="description">mgronczewski [...] efigence.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #127580] Asset search via REST2.0 only works AFTER doing a search on web UI</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Nov 2018 11:30:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RT-Extension-REST2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mariusz Gronczewski &lt;mgronczewski [...] efigence.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1818574/978455/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/978455">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 6 Nov 2018 13:31:27 -0500, &#34;Best Practical Solutions Â»|Â« via RT&#34; &lt;bug-RT-Extension-REST2@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127580">https://rt.cpan.org/Ticket/Display.html?id=127580</a></span> &gt;
&gt; 
&gt; On Tue Nov 06 09:16:55 2018, mgronczewski@efigence.com wrote:
<div class="message-stanza open">&gt; &gt; I believe it might be related to
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=123261">https://rt.cpan.org/Public/Bug/Display.html?id=123261</a></span>
&gt; &gt; 
&gt; &gt; tested on stable RT from debian packages and from source running from
&gt; &gt; fastcgi,  
</div>&gt; 
&gt; Hi Mariusz,
&gt; 
&gt; What version of RT and RT::Extension::REST2? You can get these from the system configuration page at Admin &gt; Tools &gt; System Configuration.
&gt; 
&gt; Thanks,
&gt; Jim
&gt; 
</div>
Hi,

Install 1:

RT::VERSION     4.4.2 &#40;stable from source&#41;
RT::Authen::Token       0.03
RT::Extension::REST2    1.04
RT::Extension::Assets::Import::CSV      2.2

Install 2

RT::VERSION     4.4.1-3  &#40;Debian package&#41;
RT::Authen::Token       0.03 
RT::Extension::ConditionalCustomFields  0.12 
RT::Extension::REST2    1.04 

Cheers
--
Mariusz Gronczewski, Administrator

Efigence S. A.
ul. WoÅ‚oska 9a, 02-583 Warszawa
T: [+48] 22 380 13 13
F: [+48] 22 380 13 14
E: mariusz.gronczewski@efigence.com &lt;mailto:mariusz.gronczewski@efigence.com&gt;
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.154825</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
