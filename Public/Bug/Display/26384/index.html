<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #26384 for Archive-Zip: Archive::Zip::MemberRead::getline ignores $INPUT_RECORD_SEPARATOR</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #26384 for Archive-Zip: Archive::Zip::MemberRead::getline ignores $INPUT_RECORD_SEPARATOR</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Archive-Zip">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Archive-Zip">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Archive-Zip">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Archive-Zip">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Archive-Zip">Archive-Zip CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">26384</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">2 hours (120 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Archive-Zip">Archive-Zip</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">SHLOMIF [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kovesp [...] sympatico.ca

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-2540-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-2541-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




MemberRead.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/310082/141072/MemberRead.pm">
Sun Apr 15 15:50:27 2007 (7.1k) by kovesp [...] sympatico.ca
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=26384">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-310082" href="/Public/Bug/Display.html?id=26384#txn-310082">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;15&nbsp;15:50:27&nbsp;2007</span>
    <span class="description">kovesp [...] sympatico.ca -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Archive::Zip::MemberRead::getline ignores $INPUT_RECORD_SEPARATOR</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 Apr 2007 15:50:04 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Archive-Zip [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Koves &lt;kovesp [...] sympatico.ca&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/310082/141072/MemberRead.pm">Download MemberRead.pm</a><br />
<span class="downloadcontenttype">text/x-perl 7.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Archive::Zip::MemberRead;

# Copyright &#40;c&#41; 2002 Sreeji K. Das. All rights reserved.  This program is free
# software; you can redistribute it and/or modify it under the same terms
# as Perl itself.

=head1 NAME

Archive::Zip::MemberRead - A wrapper that lets you read Zip archive members as if they were files.

=cut

=head1 SYNOPSIS

  use Archive::Zip;
  use Archive::Zip::MemberRead;
  $zip = new Archive::Zip&#40;&#34;file.zip&#34;&#41;;
  $fh  = new Archive::Zip::MemberRead&#40;$zip, &#34;subdir/abc.txt&#34;&#41;;
  while &#40;defined&#40;$line = $fh-&gt;getline&#40;&#41;&#41;&#41;
  {
      print $fh-&gt;input_line_number . &#34;#: $line\n&#34;;
  }

  $read = $fh-&gt;read&#40;$buffer, 32*1024&#41;;
  print &#34;Read $read bytes as :$buffer:\n&#34;;

=head1 DESCRIPTION

The Archive::Zip::MemberRead module lets you read Zip archive member data
just like you read data from files.

=head1 METHODS

=over 4

=cut

use strict;
use Archive::Zip qw&#40; :ERROR_CODES :CONSTANTS &#41;;

use vars qw{$VERSION};

my $nl;

BEGIN {
    $VERSION = &#39;1.18&#39;;
    $VERSION = eval $VERSION;
	 # Requirement for newline conversion. Should check for e.g., DOS and OS/2 as well, but am too lazy.
	 $nl = $^O eq &#39;MSWin32&#39; ? &#34;\r\n&#34; : &#34;\n&#34;;
}

=item Archive::Zip::Member::readFileHandle&#40;&#41;

You can get a C&lt;Archive::Zip::MemberRead&gt; from an archive member by
calling C&lt;readFileHandle&#40;&#41;&gt;:

  my $member = $zip-&gt;memberNamed&#40;&#39;abc/def.c&#39;&#41;;
  my $fh = $member-&gt;readFileHandle&#40;&#41;;
  while &#40;defined&#40;$line = $fh-&gt;getline&#40;&#41;&#41;&#41;
  {
	  # ...
  }
  $fh-&gt;close&#40;&#41;;

=cut

sub Archive::Zip::Member::readFileHandle {
    return Archive::Zip::MemberRead-&gt;new&#40; shift&#40;&#41; &#41;;
}

=item Archive::Zip::MemberRead-&gt;new&#40;$zip, $fileName&#41;

=item Archive::Zip::MemberRead-&gt;new&#40;$zip, $member&#41;

=item Archive::Zip::MemberRead-&gt;new&#40;$member&#41;

Construct a new Archive::Zip::MemberRead on the specified member.

  my $fh = Archive::Zip::MemberRead-&gt;new&#40;$zip, &#39;fred.c&#39;&#41;

=cut

sub new {
    my &#40; $class, $zip, $file &#41; = @_;
    my &#40; $self, $member &#41;;

    if &#40; $zip &#38;&#38; $file &#41;    # zip and filename, or zip and member
    {
        $member = ref&#40;$file&#41; ? $file : $zip-&gt;memberNamed&#40;$file&#41;;
    }
    elsif &#40; $zip &#38;&#38; !$file &#38;&#38; ref&#40;$zip&#41; &#41;    # just member
    {
        $member = $zip;
    }
    else {
        die&#40;
&#39;Archive::Zip::MemberRead::new needs a zip and filename, zip and member, or member&#39;
        &#41;;
    }

    $self = {};
    bless&#40; $self, $class &#41;;
    $self-&gt;set_member&#40;$member&#41;;
    return $self;
}

sub set_member {
    my &#40; $self, $member &#41; = @_;

    $self-&gt;{member} = $member;
    $self-&gt;set_compression&#40;COMPRESSION_STORED&#41;;
    $self-&gt;rewind&#40;&#41;;
}

sub set_compression {
    my &#40; $self, $compression &#41; = @_;
    $self-&gt;{member}-&gt;desiredCompressionMethod&#40;$compression&#41; if $self-&gt;{member};
}

=item setLineEnd&#40;expr&#41;

Set the line end character to use. This is set to \n by default
except on Windows systems where it is set to \r\n. You will
only need to set this on systems which are not Windows or Unix
based and require a line end diffrent from \n.
This is a class method so call as C&lt;Archive::Zip::MemberRead&gt;-&gt;C&lt;setLineEnd&#40;$nl&#41;&gt;

=cut

sub setLineEnd {
	shift;
	$nl = shift;
}

=item rewind&#40;&#41;

Rewinds an C&lt;Archive::Zip::MemberRead&gt; so that you can read from it again
starting at the beginning.

=cut

sub rewind {
    my $self = shift;

    $self-&gt;_reset_vars&#40;&#41;;
    $self-&gt;{member}-&gt;rewindData&#40;&#41; if $self-&gt;{member};
}

sub _reset_vars {
    my $self = shift;
    $self-&gt;{line_no} = 0;
    $self-&gt;{at_end}  = 0;
	 delete $self-&gt;{buffer};
}

=item input_record_separator&#40;expr&#41;

If the argumnet is given, input_record_separator for this
instance is set to it. The current setting &#40;which may be
the global $/&#41; is always returned.

=cut

sub input_record_separator {
    my $self = shift;
	 if &#40;@_&#41; {
		 $self-&gt;{sep}    = shift;
		 $self-&gt;{sep_re} = _sep_as_re&#40;$self-&gt;{sep}&#41;; # Cache the RE as an optimization
	 }
	 return exists $self-&gt;{sep} ? $self-&gt;{sep} : $/;
}

# Return the input_record_separator in use as an RE fragment
# Note that if we have a per-instance input_record_separator
# we can just return the already converted value. Otherwise,
# the conversion must be done on $/ every time since we cannot
# know whether it has changed or not.
sub _sep_re {
	my $self = shift;
	# Important to phrase this way: sep&#39;s value may be undef.
	return exists $self-&gt;{sep} ? $self-&gt;{sep_re} : sep_as_re&#40;$/&#41;;
}

# Convert the input record separator into an RE and return it.
sub _sep_as_re {
	my $sep = shift;
	if &#40;defined $sep&#41; {
		if &#40;$sep eq &#39;&#39;&#41; {
			return &#34;&#40;?:$nl&#41;{2,}&#34;;
		} else {
			$sep =~ s/\n/$nl/og;
			return quotemeta $sep;
		}
	} else {
		return undef;
	}
}

=item input_line_number&#40;&#41;

Returns the current line number, but only if you&#39;re using C&lt;getline&#40;&#41;&gt;.
Using C&lt;read&#40;&#41;&gt; will not update the line number.

=cut

sub input_line_number {
    my $self = shift;
    return $self-&gt;{line_no};
}

=item close&#40;&#41;

Closes the given file handle.

=cut

sub close {
    my $self = shift;

    $self-&gt;_reset_vars&#40;&#41;;
    $self-&gt;{member}-&gt;endRead&#40;&#41;;
}

=item buffer_size&#40;[ $size ]&#41;

Gets or sets the buffer size used for reads.
Default is the chunk size used by Archive::Zip.

=cut

sub buffer_size {
    my &#40; $self, $size &#41; = @_;

    if &#40; !$size &#41; {
        return $self-&gt;{chunkSize} || Archive::Zip::chunkSize&#40;&#41;;
    }
    else {
        $self-&gt;{chunkSize} = $size;
    }
}

=item getline&#40;&#41;

Returns the next line from the currently open member.
Makes sense only for text files.
A read error is considered fatal enough to die.
Returns undef on eof. All subsequent calls would return undef,
unless a rewind&#40;&#41; is called.
Note: The line returned has the input_record_separator &#40;default: newline&#41; removed.

=cut

sub getline {
    my $self = shift;
    my $size = $self-&gt;buffer_size&#40;&#41;;
	 my $sep  = $self-&gt;_sep_re&#40;&#41;;

	 for &#40;;;&#41; {
		 if &#40;$sep &#38;&#38; $self-&gt;{buffer} =~ s/^&#40;.*?&#41;$sep//s&#41; {
			 $self-&gt;{line_no}++;
			 return $1;
		 } elsif &#40;$self-&gt;{at_end}&#41; {
			 $self-&gt;{line_no}++ if $self-&gt;{buffer};
			 return delete $self-&gt;{buffer};
		 }
		 my &#40;$temp,$status&#41; = $self-&gt;{member}-&gt;readChunk&#40;$size&#41;;
		 if &#40;$status != AZ_OK &#38;&#38; $status != AZ_STREAM_END&#41; {
			 die &#34;ERROR: Error reading chunk from archive - $status&#34;;
		 }
		 $self-&gt;{at_end} = $status == AZ_STREAM_END;
		 $self-&gt;{buffer} .= $$temp;
	 }
}

=item read&#40;$buffer, $num_bytes_to_read&#41;

Simulates a normal C&lt;read&#40;&#41;&gt; system call.
Returns the no. of bytes read. C&lt;undef&gt; on error, 0 on eof, I&lt;e.g.&gt;:

  $fh = new Archive::Zip::MemberRead&#40;$zip, &#34;sreeji/secrets.bin&#34;&#41;;
  while &#40;1&#41;
  {
    $read = $fh-&gt;read&#40;$buffer, 1024&#41;;
    die &#34;FATAL ERROR reading my secrets !\n&#34; if &#40;!defined&#40;$read&#41;&#41;;
    last if &#40;!$read&#41;;
    # Do processing.
    ....
   }

=cut

#
# All these $_ are required to emulate read&#40;&#41;.
#
sub read {
    my $self = $_[0];
    my $size = $_[2];
    my &#40; $temp, $status, $ret &#41;;

    &#40; $temp, $status &#41; = $self-&gt;{member}-&gt;readChunk&#40;$size&#41;;
    if &#40; $status != AZ_OK &#38;&#38; $status != AZ_STREAM_END &#41; {
        $_[1] = undef;
        $ret = undef;
    }
    else {
        $_[1] = $$temp;
        $ret = length&#40;$$temp&#41;;
    }
    return $ret;
}

1;

=back

=head1 AUTHOR

Sreeji K. Das, &lt;sreeji_k@yahoo.com&gt;
See L&lt;Archive::Zip&gt; by Ned Konz without which this module does not make
any sense! 

Minor mods by Ned Konz.

=head1 COPYRIGHT

Copyright &#40;c&#41; 2002 Sreeji K. Das. All rights reserved.  This program is free
software; you can redistribute it and/or modify it under the same terms
as Perl itself.

=cut
</div></div>
</div>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/310082/141070/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/141070">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was trying to use MemberRead to read entries from a zip file. I needed 
to read in paragraph mode, so I set
    $INPUT_RECORD_SEPARATOR = &#39;&#39;;
&#40;AKA $/&#41;. And discovered that MemberRead ignores this. Further 
investigation uncovered other problems:

    * MemberRead was *always *using \n as the newline character, and
      this of course does not work correctly on e.g., Windows.
    * The implementation of MemberRead::getline is really bad. It reads
      a new chunk from the zip entry on *every* invocation of getline
      and adds the chunk to an array of lines maintained in an instance
      variable. Since I had very large files in the zip &#40;1.5 GB+&#41; this
      rapidly became untenable; in fact it caused Perl itself to crash.

I am attaching a version of MemberRead that fixes these issues, namely:

   1. It adds the input_record_separator method to allow setting a
      per-instance separator. The value that can be passed is the same
      as for the Perl var $/. If a per-instance value is not set, it
      uses the value of the global $/.
   2. On Windows systems it takes into account that the line end is
      \r\n. A class method setLineEnd is provided to use on systems
      other than Unix or Windows.
   3. getline is fixed to take into account the separator as detailed in
      1. and to be as lazy as possible. That is, the part of the zip
      entry that is read into memory will only be more than a chunk if
      this is required to be able to return a complete input record as
      determined by the separator.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/310082/141071/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/141071">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-374519" href="/Public/Bug/Display.html?id=26384#txn-374519">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;23&nbsp;07:45:33&nbsp;2007</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SHLOMIF [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/374519/170514/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/170514">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 312b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Applied in revision 2249 of the repository. Next time please add a 
regression test script &#40;which I added&#41;, and make sure the code runs 
and does not generate any warnings under &#34;use warnings;&#34;/&#34;-w&#34;. I had 
to fix some warnings with undefined values and to prepend an 
underscore to the name of a function there.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-374520" href="/Public/Bug/Display.html?id=26384#txn-374520">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;23&nbsp;07:45:55&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-385685" href="/Public/Bug/Display.html?id=26384#txn-385685">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;20&nbsp;13:37:22&nbsp;2007</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">120 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/385685/176984/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/176984">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 54b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in the repository. A modified patch was applied.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-385688" href="/Public/Bug/Display.html?id=26384#txn-385688">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;20&nbsp;13:37:26&nbsp;2007</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-385690" href="/Public/Bug/Display.html?id=26384#txn-385690">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;20&nbsp;13:37:29&nbsp;2007</span>
    <span class="description">SHLOMIF [...] cpan.org -  Given to SHLOMIF</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.368044</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
