<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13358 for CPANPLUS: chmod in CPANPLUS::Internals::Extract breaks installation of File::MMagic</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13358 for CPANPLUS: chmod in CPANPLUS::Internals::Extract breaks installation of File::MMagic</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CPANPLUS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CPANPLUS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CPANPLUS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CPANPLUS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CPANPLUS">CPANPLUS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13358</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CPANPLUS/Active/">CPANPLUS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
trevor.schellhorn-perl [...] marketingtips.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-8270-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.055    </td>
  </tr>
  <tr id="CF-8271-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;21&nbsp;23:15:12&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> chmod in CPANPLUS::Internals::Extract breaks installation of
 File::MMagic</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is the section that I am referring to:

167:    ### set them all to be +w for the owner, so we don&#39;t get permission
168:    ### denied for overwriting files that are just +r
169:    chmod 0755, map { File::Spec-&gt;rel2abs&#40; File::Spec-&gt;catdir&#40;$to, $_&#41; &#41; }
170:                @{$ae-&gt;files};

This does more then change the file to be &#39;+w&#39; for the owner. It also sets the execute bit for the files also.

Doing this breaks the installation of File::MMagic as it relies on the *.t files to not be executable.  Doing so changes the output of the program.

This will also break another other module that relies on the permissions being a certain mode. I think you need to come up with a better solution for this part.

If you need to change the permissions so that you can write to them, just change the mode for the owner of the file so that it is writable.

This is using CPANPLUS verison 0.055 on ActivePerl 5.8.7 running on CentOS 4.0.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;22&nbsp;03:39:07&nbsp;2005</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Tue Jun 21 23:15:12 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here is the section that I am referring to:
&gt; 
&gt; 167:    ### set them all to be +w for the owner, so we don&#39;t get
&gt;    permission
&gt; 168:    ### denied for overwriting files that are just +r
&gt; 169:    chmod 0755, map { File::Spec-&gt;rel2abs&#40; File::Spec-&gt;catdir&#40;$to,
&gt;    $_&#41; &#41; }
&gt; 170:                @{$ae-&gt;files};
&gt; 
&gt; This does more then change the file to be &#39;+w&#39; for the owner. It also
&gt;    sets the execute bit for the files also.
</div>
I&#39;ve applied the following patch to only set mode +w for the owner, as this is the
bear minimum to make our functions work:

--
   Jos

==== //depot/cpanplus/devel/lib/CPANPLUS/Internals/Extract.pm#41 - /Users/kane/
sources/p4/cpanplus/devel/lib/CPANPLUS/Internals/Extract.pm ====
169,170c169,178
&lt;     chmod 0755, map { File::Spec-&gt;rel2abs&#40; File::Spec-&gt;catdir&#40;$to, $_&#41; &#41; }
&lt;                 @{$ae-&gt;files};
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     
&gt;     ### this is to rigurous -- just change to +w for the owner [cpan #13358] 
&gt;     #chmod 0755, map { File::Spec-&gt;rel2abs&#40; File::Spec-&gt;catdir&#40;$to, $_&#41; &#41; }
&gt;     #            @{$ae-&gt;files};
&gt;     
&gt;     for my $file &#40; @{$ae-&gt;files} &#41; { 
&gt;         my $path = File::Spec-&gt;rel2abs&#40; File::Spec-&gt;catdir&#40;$to, $file&#41; &#41;;
&gt;     
&gt;         $self-&gt;_mode_plus_w&#40; file =&gt; $path &#41;;
&gt;     }
</div>==== //depot/cpanplus/devel/lib/CPANPLUS/Internals/Utils.pm#21 - /Users/kane/
sources/p4/cpanplus/devel/lib/CPANPLUS/Internals/Utils.pm ====
287a288,310
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; sub _mode_plus_w {
&gt;     my $self = shift;
&gt;     my %hash = @_;
&gt;     
&gt;     require File::stat;
&gt;     
&gt;     my $file;
&gt;     my $tmpl = {
&gt;         file    =&gt; { required =&gt; 1, allow =&gt; IS_FILE, store =&gt; \$file },
&gt;     };
&gt;     
&gt;     check&#40; $tmpl, \%hash &#41; or return;
&gt;     
&gt;     my $x = File::stat::stat&#40; $file &#41;;
&gt;     if&#40; $x and chmod&#40; $x-&gt;mode|0200, $file &#41; &#41; {
&gt;         return 1;
&gt; 
&gt;     } else {        
&gt;         error&#40;loc&#40;&#34;Failed to &#39;%1&#39; &#39;%2&#39;: &#39;%3&#39;&#34;, &#39;chmod +w&#39;, $file, $!&#41;&#41;;
&gt;         return;
&gt;     }
&gt; }    
&gt; 
</div>==== //depot/cpanplus/devel/t/00_CPANPLUS-Internals-Utils.t#10 - /Users/kane/
sources/p4/cpanplus/devel/t/00_CPANPLUS-Internals-Utils.t ====
24c24
&lt; use Test::More tests =&gt; 31;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use Test::More tests =&gt; 36;
</div>39a40
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; my $File    = &#39;zot&#39;;
</div>118a120,140
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ### _mode_plus_w tests ###
&gt; {   open my $fh, &#34;&gt;$File&#34; or die &#34;Could not open $File for writing: $!&#34;;
&gt;     close $fh;
&gt;     
&gt;     ### remove perms
&gt;     ok&#40; -e $File,               &#34;File &#39;$File&#39; created&#34; &#41;;
&gt;     ok&#40; chmod&#40; 000, $File &#41;,    &#34;   File permissions set to 000&#34; &#41;;
&gt;     
&gt;     ok&#40; $Class-&gt;_mode_plus_w&#40; file =&gt; $File &#41;,
&gt;                                 &#34;   File permissions set to +w&#34; &#41;;
&gt;     ok&#40; -w $File,               &#34;   File is writable&#34; &#41;;
&gt; 
&gt;     1 while unlink $File;
&gt;     
&gt;     ok&#40; !-e $File,              &#34;   File removed&#34; &#41;;
&gt; }
&gt;  
</div> 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;22&nbsp;03:39:08&nbsp;2005</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
