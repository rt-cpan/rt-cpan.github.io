<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71708 for DhMakePerl: </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71708 for DhMakePerl: </h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DhMakePerl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DhMakePerl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DhMakePerl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DhMakePerl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DhMakePerl">DhMakePerl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71708</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DhMakePerl/Active/">DhMakePerl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DKOGAN [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
gregoa [...] cpan.org

<br />
NWELLNHOF [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227886-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227887-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.75    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dh-make-perl-patches.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/988154/514420/dh-make-perl-patches.tar.gz">
Sat Oct 15 17:22:21 2011 (2.1k) by DKOGAN [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;15&nbsp;17:22:21&nbsp;2011</span>
    <span class="description">DKOGAN [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patch series is designed to make recursive building/installing 
work correctly. The command I was trying to make work was

dh-make-perl --cpan ffmpeg --build --install --recursive

The FFMPEG distribution on CPAN depends on Image::Magick::Iterator and 
Image::PBMlib which aren&#39;t available in the standard debian/unstable 
APT repo. The desired behavior I was looking for was the above command 
to pull in all the needed CPAN distributions, package them all, install 
them as needed so that in the end I&#39;d get libffmpeg-perl installed 
along with its dependencies. &#40;Note: the ffmpeg distribution on CPAN 
itself has bugs and doesn&#39;t build. A &#39;successful&#39; run here is for 
everything to progress and fail when actually building ffmpeg.xs 
because of a missing header.&#41;

This uncovered several bugs in dh-make-perl, most of which are fixed in 
this patch series. There are two more outstanding issues that are NOT 
fixed in this series because I&#39;m not sure how to best address them:

1. If a depended-on CPAN package is built first, it must be installed 
in order for dh-make-perl to proceed. This clearly requires root. I&#39;d 
like to do everything root-less as much as possible, so maybe dh-make-
perl should have a cmdline option to sudo the actual package install 
&#40;and only the install itself&#41;. Thoughts?

2. At one point in make.pm there&#39;s an inadvertent chdir. This line:

$dist-&gt;get || die &#34;Cannot get &#34;, $dist-&gt;pretty_id, &#34;\n&#34;; # &lt;- here $ENV
{&#39;PWD&#39;} gets set to $HOME/.cpan/build

dh-make-perl is aware of this and tries to use global paths from that 
point on. In its current state this confuses recursive builds since the 
first distribution will be extracted in the current directory and all 
subsequent ones in ~/.cpan/build. Then the package ends up in the wrong 
place and install&#40;&#41; can&#39;t find it. This can be fixed by making install
&#40;&#41; more careful about where it looks for the .deb or by simply placing 
a chdir $orig_pwd; immediately after that line of code to chdir back to 
where we were. This would simplify lots of other bits of the code too. 
Is there some underlying reason we don&#39;t chdir&#40;&#41; back?

dima
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dh-make-perl-patches.tar.gz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/988154/514420/dh-make-perl-patches.tar.gz">Download dh-make-perl-patches.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 2.1k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;22&nbsp;22:21:50&nbsp;2011</span>
    <span class="description">NWELLNHOF [...] cpan.org -  Cc NWELLNHOF added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;19:13:28&nbsp;2011</span>
    <span class="description">gregoa [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Oct 15 17:22:21 2011, DKOGAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This patch series is designed to make recursive building/installing 
&gt; work correctly. 
</div>
Thanks for your patches, and sorry for the late reply.
I&#39;ve applied them in our git repo now.

&#40;BTW: I you want to join dh-make-perl development just shout &#40;and get an
Alioth account and we can add you to the pkg-perl group&#41;&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. If a depended-on CPAN package is built first, it must be installed 
&gt; in order for dh-make-perl to proceed. This clearly requires root. I&#39;d 
&gt; like to do everything root-less as much as possible, so maybe dh-make-
&gt; perl should have a cmdline option to sudo the actual package install 
&gt; &#40;and only the install itself&#41;. Thoughts?
</div>
Not sure about this one; I guess the problem is that probably none of us
&#40;Debian pkg-perl team&#41; usese --build or --install.
But yes, sudo-only-for-install, and only called when --install is given
sounds acceptable.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. At one point in make.pm there&#39;s an inadvertent chdir. This line:
&gt; 
&gt; $dist-&gt;get || die &#34;Cannot get &#34;, $dist-&gt;pretty_id, &#34;\n&#34;; # &lt;- here $ENV
&gt; {&#39;PWD&#39;} gets set to $HOME/.cpan/build
&gt; 
&gt; dh-make-perl is aware of this and tries to use global paths from that 
&gt; point on. In its current state this confuses recursive builds since the 
&gt; first distribution will be extracted in the current directory and all 
&gt; subsequent ones in ~/.cpan/build. Then the package ends up in the wrong 
&gt; place and install&#40;&#41; can&#39;t find it. 
</div>
Ouch, that probably happened becaause --recursive was implemented &#40;and
never really tested&#41; later.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This can be fixed by making install
&gt; &#40;&#41; more careful about where it looks for the .deb or by simply placing 
&gt; a chdir $orig_pwd; immediately after that line of code to chdir back to 
&gt; where we were. This would simplify lots of other bits of the code too. 
&gt; Is there some underlying reason we don&#39;t chdir&#40;&#41; back?
</div>
Probably not :&#41;
Also committed to git right now.

&#40;Hm, --recursive also doesn&#39;t seem to play nice with with --vcs git&#41;


Thanks again,
gregor
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;19:13:30&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;19:14:15&nbsp;2011</span>
    <span class="description">gregoa [...] cpan.org -  Cc GREGOA added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;11&nbsp;05:02:42&nbsp;2013</span>
    <span class="description">dam [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RT#71708 DhMakePerl: patches to make recursive building work</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">На 08 дек. 2011, чт 02:13:28, GREGOA написа:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Oct 15 17:22:21 2011, DKOGAN wrote:
<div class="message-stanza open">&gt; &gt; This patch series is designed to make recursive building/installing 
&gt; &gt; work correctly. 
</div>&gt; 
&gt; Thanks for your patches, and sorry for the late reply.
&gt; I&#39;ve applied them in our git repo now.
</div>
Thanks, gregor. I am closing this ticket now, since there is a release containing the patches.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;BTW: I you want to join dh-make-perl development just shout &#40;and get an
&gt; Alioth account and we can add you to the pkg-perl group&#41;&#41;.
</div>
This still holds :&#41;

-- dam
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;11&nbsp;05:02:43&nbsp;2013</span>
    <span class="description">dam [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;11&nbsp;05:02:43&nbsp;2013</span>
    <span class="description">dam [...] cpan.org -  Fixed in 0.75 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
