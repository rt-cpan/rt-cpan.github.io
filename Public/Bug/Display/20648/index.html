<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #20648 for DBD-Pg: Server side prepares fail on load-balanced web servers.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #20648 for DBD-Pg: Server side prepares fail on load-balanced web servers.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-Pg">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-Pg">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-Pg">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-Pg">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Pg">DBD-Pg CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">20648</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-Pg">DBD-Pg</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MARKSTOS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10200-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.48    </td>
  </tr>
  <tr id="CF-10201-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=20648">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-226783" href="/Public/Bug/Display.html?id=20648#txn-226783">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;24&nbsp;12:32:32&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Server side prepares fail on load-balanced web servers.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/226783/94273/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/94273">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 583b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

After deploying DBD::Pg 1.48 on a load-balanced web server talking to
PostgreSQL 8.1, I saw a lot of these kind of errors:

 prepared statement &#34;dbdpg_7&#34; already exists

I suspect this is because DBD::Pg is on two different machines,
talking to the same database, and each has different concept of
what should be stored in &#39;dbdpg_7&#39;.

If so, it would be nice if this could be avoided. 

Using a hash of the query itself would be a useful key, because that
means it could originate on one of the front end web servers, 
and then be re-used by one of the other ones.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-230160" href="/Public/Bug/Display.html?id=20648#txn-230160">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;04&nbsp;19:09:34&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> MARKSTOS [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/230160/96056/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/96056">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 24 12:32:32 2006, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; After deploying DBD::Pg 1.48 on a load-balanced web server talking to
&gt; PostgreSQL 8.1, I saw a lot of these kind of errors:
&gt; 
&gt;  prepared statement &#34;dbdpg_7&#34; already exists
&gt; 
&gt; I suspect this is because DBD::Pg is on two different machines,
&gt; talking to the same database, and each has different concept of
&gt; what should be stored in &#39;dbdpg_7&#39;.
&gt; 
&gt; If so, it would be nice if this could be avoided. 
&gt; 
&gt; Using a hash of the query itself would be a useful key, because that
&gt; means it could originate on one of the front end web servers, 
&gt; and then be re-used by one of the other ones.
</div>
I found a thread about this here. A couple of different other reasons
are reported. Sometimes the error is also appearing a modperl context,
sometimes not. No-one else was running on a load-balanced web server, so
I&#39;ll take that to mean my initial guess about the cause was wrong. 

<span class="clickylink"><a target="new" rel="nofollow" href="http://gborg.postgresql.org/pipermail/dbdpg-general/2005-December/001926.html">http://gborg.postgresql.org/pipermail/dbdpg-general/2005-December/001926.html</a></span>

I found a related mention of this issue here:
<span class="clickylink"><a target="new" rel="nofollow" href="http://fudforum.org/forum/index.php?t=msg&#38;th=4598&#38;start=0&#38;">http://fudforum.org/forum/index.php?t=msg&#38;th=4598&#38;start=0&#38;</a></span>

There the fix involved putting using DEALLOCATE when persistent
connections are detected. The actual patch they used in their
application was here:

<span class="clickylink"><a target="new" rel="nofollow" href="http://cvs.prohost.org/c/index.cgi/FUDforum/chngview?cn=10611">http://cvs.prohost.org/c/index.cgi/FUDforum/chngview?cn=10611</a></span>

I don&#39;t see any calls to DEALLOCATE in the current DBD::Pg code base.
Maybe that could help? 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.postgresql.org/docs/8.1/interactive/sql-deallocate.html">http://www.postgresql.org/docs/8.1/interactive/sql-deallocate.html</a></span>

      Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-230534" href="/Public/Bug/Display.html?id=20648#txn-230534">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;06&nbsp;22:47:17&nbsp;2006</span>
    <span class="description">blblack [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> BLBLACK [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/230534/96265/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/96265">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 04 19:09:34 2006, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jul 24 12:32:32 2006, MARKSTOS wrote:
<div class="message-stanza open">&gt; &gt; Hello,
&gt; &gt;
&gt; &gt; After deploying DBD::Pg 1.48 on a load-balanced web server talking
</div>&gt; to
<div class="message-stanza open">&gt; &gt; PostgreSQL 8.1, I saw a lot of these kind of errors:
&gt; &gt;
&gt; &gt;  prepared statement &#34;dbdpg_7&#34; already exists
</div></div>
I can&#39;t know what your exact issue is remotely, but all the times in the
past that I&#39;ve encountered those errors, it has always been a case of
two seperate processes or threads sharing the same database connection
&#40;socket&#41;, for some reason or other.

In a mod_perl situation, this could happen if your are preloading a
module at pre-fork time, and then the individual forked children are all
accessing the same connection that was created then.  The solution tends
to be to make sure you are disconnected from the database before forking
&#40;let each child connect for itself&#41;.

If that sounds like too many connections, then you can look into any of
the available ways to pool and share connections properly - but sharing
a connection blindly via forking will always cause problems.

DBIx::Class&#39;s storage driver handles all this sort of stuff for you
&#40;forking, threading, server disconnecting due to idle timeouts, etc&#41;,
but when using a raw DBI driver handle, you have to do this stuff yourself.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-230535" href="/Public/Bug/Display.html?id=20648#txn-230535">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;06&nbsp;22:47:18&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-230654" href="/Public/Bug/Display.html?id=20648#txn-230654">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;07&nbsp;08:09:12&nbsp;2006</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20648] Server side prepares fail under mod_perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 07 Aug 2006 08:05:12 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/230654/96328/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/96328">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"> &gt;&gt;&gt;  prepared statement &#34;dbdpg_7&#34; already exists
</div></div>
Thanks for the response.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; I can&#39;t know what your exact issue is remotely, but all the times in the
 &gt; past that I&#39;ve encountered those errors, it has always been a case of
 &gt; two separate processes or threads sharing the same database connection
 &gt; &#40;socket&#41;, for some reason or other.
 &gt;
 &gt; In a mod_perl situation, this could happen if your are preloading a
 &gt; module at pre-fork time, and then the individual forked children are all
 &gt; accessing the same connection that was created then.  The solution tends
 &gt; to be to make sure you are disconnected from the database before forking
 &gt; &#40;let each child connect for itself&#41;.
</div>
In startup.pl, we load Apache::DBI, and DBI, but don&#39;t connect there.

We fork in one place in the application, but explicitly use a second
connection there, with the syntax that tells Apache::DBI not just re-use
an existing connection.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; DBIx::Class&#39;s storage driver handles all this sort of stuff for you
 &gt; &#40;forking, threading, server disconnecting due to idle timeouts, etc&#41;,
 &gt; but when using a raw DBI driver handle, you have to do this stuff 
</div>yourself.

We are using a raw handle, so I could look at DBIx::Class is doing
differently.

I&#39;ll also try the patch which adds the current PID into the name, and
see if that helps.

Thanks again.

     Mark

-- 
<span class="clickylink"><a target="new" rel="nofollow" href="http://mark.stosberg.com/">http://mark.stosberg.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-287187" href="/Public/Bug/Display.html?id=20648#txn-287187">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;29&nbsp;10:18:21&nbsp;2007</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> more thoughts on &#34;prepared statement...already exists&#34; and
 $if_active.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> MARKSTOS [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/287187/129344/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/129344">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 743b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just a note for future people who have a symptom like this.  I recently
got errors like  /after/ applying the patch that will appear in 1.50.
the errors looked like:

prepared statement &#34;dbdpg_12456_7&#34; already exists

I believe the cause in this case what that I had accidentally shared the
database handle across a modperl fork, which should always be avoided.
After I repaired that issue, these errors seemed to clear up. 

See also this related &#34;wish&#34; report for DBI:
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=24544">http://rt.cpan.org/Ticket/Display.html?id=24544</a></span>

DBI supports an &#34;if active&#34; attribute which can be used to gracefully
recover from this error, but the interface for this option is currently
awkward to use, and it is not possible to easily set a default behavior
for it.  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-406007" href="/Public/Bug/Display.html?id=20648#txn-406007">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;07&nbsp;00:28:48&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/406007/197849/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/197849">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 245b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is going to become more prevalent as things like pg_bouncer take
off. Best solution is to simply set pg_server_prepare to always be off. See:

<span class="clickylink"><a target="new" rel="nofollow" href="http://people.planetpostgresql.org/greg/index.php?/archives/110-Using-DBDPg-with-pg_bouncer.html">http://people.planetpostgresql.org/greg/index.php?/archives/110-Using-DBDPg-with-pg_bouncer.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-406010" href="/Public/Bug/Display.html?id=20648#txn-406010">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;07&nbsp;00:29:30&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.453395</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
