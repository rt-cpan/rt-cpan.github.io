<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #36430 for Archive-Zip: PATCH for VMS &#40;changes I made to get tests to pass&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #36430 for Archive-Zip: PATCH for VMS &#40;changes I made to get tests to pass&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Archive-Zip">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Archive-Zip">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Archive-Zip">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Archive-Zip">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Archive-Zip">Archive-Zip CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">36430</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Archive-Zip">Archive-Zip</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpan [...] pjedwards.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-2540-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.23    </td>
  </tr>
  <tr id="CF-2541-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




archive_zip_1_23_VMS.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/469801/231690/archive_zip_1_23_VMS.patch">
Wed Jun 04 06:05:43 2008 (6.9k) by cpan [...] pjedwards.co.uk
</a>
</font></li>
</ul>


vms_changes_for_archive_zip_1_31_01.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/897282/465238/vms_changes_for_archive_zip_1_31_01.txt">
Tue Feb 15 07:53:01 2011 (4.6k) by cpan [...] pjedwards.co.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=36430">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-469801" href="/Public/Bug/Display.html?id=36430#txn-469801">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;06:05:43&nbsp;2008</span>
    <span class="description">cpan [...] pjedwards.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PATCH for VMS &#40;changes I made to get tests to pass&#41;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/469801/231687/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/231687">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 133b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello and thanks for Archive::Zip 1.23
I&#39;ve attached the changes I made to get the tests to pass on VMS.
Cheers,
Peter &#40;Stig&#41; Edwards
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> archive_zip_1_23_VMS.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/469801/231690/archive_zip_1_23_VMS.patch">Download archive_zip_1_23_VMS.patch</a><br />
<span class="downloadcontenttype">text/x-diff 6.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">==== Archive-Zip-1.23/lib/Archive/Zip.pm#2 &#40;xtext&#41; ====


@@ -500,10 +500,13 @@
 	my $forceDir  = shift;
 	my $volReturn = shift;
 	my &#40; $volume, $directories, $file &#41; =
-	  File::Spec-&gt;splitpath&#40; File::Spec-&gt;canonpath&#40;$name&#41;, $forceDir &#41;;
+	  File::Spec::Unix-&gt;splitpath&#40; File::Spec::Unix-&gt;canonpath&#40;$name&#41;, $forceDir &#41;;
 	$$volReturn = $volume if &#40; ref&#40;$volReturn&#41; &#41;;
-	my @dirs = map { $_ =~ s{/}{_}g; $_ } File::Spec-&gt;splitdir&#40;$directories&#41;;
+	my @dirs = map { $_ =~ s{/}{_}g; $_ } File::Spec::Unix-&gt;splitdir&#40;$directories&#41;;
 	if &#40; @dirs &gt; 0 &#41; { pop &#40;@dirs&#41; unless $dirs[-1] }   # remove empty component
+        if&#40;$^O eq &#39;VMS&#39;&#41;{
+            if &#40; @dirs &gt; 0 &#41; { shift &#40;@dirs&#41; unless $dirs[0] }   # remove empty component
+        }
 	push &#40; @dirs, defined&#40;$file&#41; ? $file : &#39;&#39; &#41;;
 	#return wantarray ? @dirs : join &#40; &#39;/&#39;, @dirs &#41;;
     return join &#40; &#39;/&#39;, @dirs &#41;;



==== Archive-Zip-1.23/lib/Archive/Zip/Archive.pm#2 &#40;xtext&#41; ====


@@ -318,7 +318,7 @@
     $fh = undef;
 
     if &#40; $status != AZ_OK &#41; {
-        unlink&#40;$tempName&#41;;
+        1 while unlink&#40;$tempName&#41;;
         _printError&#40;&#34;Can&#39;t write to $tempName&#34;&#41;;
         return $status;
     }
@@ -328,7 +328,7 @@
     # rename the zip
     if &#40; -f $zipName &#38;&#38; !rename&#40; $zipName, $backupName &#41; &#41; {
         $err = $!;
-        unlink&#40;$tempName&#41;;
+        1 while unlink&#40;$tempName&#41;;
         return _error&#40; &#34;Can&#39;t rename $zipName as $backupName&#34;, $err &#41;;
     }
 
@@ -336,14 +336,16 @@
     unless &#40; File::Copy::move&#40; $tempName, $zipName &#41; &#41; {
         $err = $!;
         rename&#40; $backupName, $zipName &#41;;
-        unlink&#40;$tempName&#41;;
+        1 while unlink&#40;$tempName&#41;;
         return _error&#40; &#34;Can&#39;t move $tempName to $zipName&#34;, $err &#41;;
     }
 
     # unlink the backup
-    if &#40; -f $backupName &#38;&#38; !unlink&#40;$backupName&#41; &#41; {
-        $err = $!;
-        return _error&#40; &#34;Can&#39;t unlink $backupName&#34;, $err &#41;;
+    if &#40; -f $backupName &#41; {
+        1 while unlink&#40;$backupName&#41;;
+        if&#40;-e $backupName&#41;{
+            return _error&#40; &#34;Can&#39;t unlink $backupName&#34;, $! &#41;;
+        }
     }
 
     return AZ_OK;



==== Archive-Zip-1.23/t/02_main.t#2 &#40;xtext&#41; ====


@@ -487,7 +487,7 @@
 	my $fh;
 	if &#40;$catWorks&#41;
 	{
-		unlink&#40; OUTPUTZIP &#41;;
+		1 while unlink&#40; OUTPUTZIP &#41;;
 		$fh = FileHandle-&gt;new&#40; CATPIPE . OUTPUTZIP &#41;;
 		binmode&#40;$fh&#41;;
 	}



==== Archive-Zip-1.23/t/03_ex.t#2 &#40;xtext&#41; ====


@@ -8,10 +8,11 @@
 use Archive::Zip qw&#40; :ERROR_CODES :CONSTANTS &#41;;
 use File::Spec;
 use IO::File;
+use Config;
 
 use Test::More tests =&gt; 17;
 BEGIN {
-    unshift @INC, &#34;t/&#34;; 
+    unshift @INC, &#34;t/&#34;;
     require&#40; File::Spec-&gt;catfile&#40;&#39;t&#39;, &#39;common.pl&#39;&#41; &#41;
 		or die &#34;Can&#39;t load t/common.pl&#34;;
 }
@@ -19,17 +20,22 @@
 sub runPerlCommand
 {
 	my $libs = join &#40; &#39; -I&#39;, @INC &#41;;
-	my $cmd    = &#34;\&#34;$^X\&#34; \&#34;-I$libs\&#34; -w \&#34;&#34;. join&#40;&#39;&#34; &#34;&#39;, @_&#41;. &#39;&#34;&#39;;
+        my $this_perl = $^X;
+        if &#40;$^O ne &#39;VMS&#39;&#41;{
+            $this_perl .= $Config{_exe} unless $this_perl =~ m/$Config{_exe}$/i;
+        }
+
+        my $cmd    = &#34;$this_perl \&#34;-I$libs\&#34; \&#34;-w\&#34; \&#34;&#34;. join&#40;&#39;&#34; &#34;&#39;, @_&#41;. &#39;&#34;&#39;;
 	my $output = `$cmd`;
 	return wantarray ? &#40; $?, $output &#41; : $?;
 }
 
-use constant FILENAME =&gt; File::Spec-&gt;catpath&#40; &#39;&#39;, TESTDIR, &#39;testing.txt&#39; &#41;;
+use constant FILENAME =&gt; File::Spec-&gt;catfile&#40; TESTDIR, &#39;testing.txt&#39; &#41;;
 use constant ZFILENAME =&gt; TESTDIR . &#34;/testing.txt&#34;; # name in zip
 
 my $zip = Archive::Zip-&gt;new&#40;&#41;;
 isa_ok&#40; $zip, &#39;Archive::Zip&#39; &#41;;
-$zip-&gt;addString&#40; TESTSTRING, FILENAME &#41;;
+$zip-&gt;addString&#40; TESTSTRING, ZFILENAME &#41;;
 $zip-&gt;writeToFileNamed&#40;INPUTZIP&#41;;
 
 my &#40; $status, $output &#41;;
@@ -64,9 +70,9 @@
 # removed because requires IO::Scalar
 # ok&#40; runPerlCommand&#40;&#39;examples/readScalar.pl&#39;&#41;, 0 &#41;;
 
-unlink&#40;OUTPUTZIP&#41;;
+1 while unlink&#40;OUTPUTZIP&#41;;
 is&#40; runPerlCommand&#40; &#39;examples/selfex.pl&#39;, OUTPUTZIP, FILENAME &#41;, 0 &#41;;
-unlink&#40;FILENAME&#41;;
+1 while unlink&#40;FILENAME&#41;;
 is&#40; runPerlCommand&#40;OUTPUTZIP&#41;, 0 &#41;;
 my $fn =
   File::Spec-&gt;catpath&#40; &#39;&#39;, File::Spec-&gt;catdir&#40; &#39;extracted&#39;, TESTDIR &#41;,
@@ -79,9 +85,14 @@
 # zipcheck.pl
 # ziprecent.pl
 
-unlink&#40;OUTPUTZIP&#41;;
+1 while unlink&#40;OUTPUTZIP&#41;;
 is&#40; runPerlCommand&#40; &#39;examples/updateTree.pl&#39;, OUTPUTZIP, TESTDIR &#41;, 0, &#34;updateTree.pl create&#34; &#41;;
 is&#40; -f OUTPUTZIP, 1, &#34;zip created&#34; &#41;;
 is&#40; runPerlCommand&#40; &#39;examples/updateTree.pl&#39;, OUTPUTZIP, TESTDIR &#41;, 0, &#34;updateTree.pl update&#34; &#41;;
-is&#40; -f OUTPUTZIP, 1, &#34;zip updated&#34; &#41;;
-unlink&#40;OUTPUTZIP&#41;;
+SKIP: {
+    skip &#39;Running on VMS&#39;,1,if &#40;$^O eq &#39;VMS&#39;&#41;;
+    is&#40; -f OUTPUTZIP, 1, &#34;zip updated&#34; &#41;;
+}
+if&#40;-e OUTPUTZIP&#41;{
+    1 while unlink&#40;OUTPUTZIP&#41;;
+}



==== Archive-Zip-1.23/t/06_update.t#2 &#40;xtext&#41; ====


@@ -23,11 +23,18 @@
 
 my $zip = Archive::Zip-&gt;new&#40;&#41;;
 my $testDir = File::Spec-&gt;catpath&#40; $testFileVolume, $testFileDirs, &#39;&#39; &#41;;
+if&#40;$^O eq &#39;VMS&#39;&#41;{
+    $testDir = &#39;t&#39;;
+}
 
 my $numberOfMembers = 0;
 my @memberNames;
-sub countMembers { unless &#40;$_ eq &#39;.&#39;&#41;
-	{ push&#40;@memberNames, $_&#41;; $numberOfMembers++; } };
+sub countMembers {
+    unless &#40; &#40;$_ eq &#39;.&#39;&#41; || &#40;$_ eq &#39;[]&#39;&#41; &#41; {
+	push&#40;@memberNames, $_&#41;;
+        $numberOfMembers++;
+    }
+};
 File::Find::find&#40; \&#38;countMembers, $testDir &#41;;
 is&#40; $numberOfMembers &gt; 1, 1, &#39;not enough members to test&#39;&#41;;
 
@@ -42,6 +49,9 @@
 
 # add a file to the directory
 $testFileName = File::Spec-&gt;catpath&#40; $testFileVolume, $testFileDirs, &#39;xxxxxx&#39; &#41;;
+if&#40;$^O eq &#39;VMS&#39;&#41;{
+    $testFileName = File::Spec-&gt;catfile&#40; $testDir, &#39;xxxxxx&#39; &#41;;
+}
 my $fh = IO::File-&gt;new&#40; $testFileName, &#39;w&#39;&#41;;
 $fh-&gt;print&#40;&#39;xxxx&#39;&#41;;
 undef&#40;$fh&#41;;
@@ -52,7 +62,7 @@
 is&#40; scalar&#40;$zip-&gt;members&#40;&#41;&#41;, $numberOfMembers + 1, &#39;wrong number of members after update&#39; &#41;;
 
 # Delete the file.
-unlink&#40;$testFileName&#41;;
+1 while unlink&#40;$testFileName&#41;;
 is&#40; -f $testFileName, undef, &#34;deleting $testFileName failed&#34;&#41;;
 
 # updating without the mirror option should keep the members



==== Archive-Zip-1.23/t/07_filenames_of_0.t#2 &#40;xtext&#41; ====


@@ -32,12 +32,16 @@
 my $archive = Archive::Zip-&gt;new;
 
 $archive-&gt;addTree&#40;
-	File::Spec-&gt;catfile&#40;&#39;testdir&#39;, &#39;folder&#39;&#41;,
+	File::Spec::Unix-&gt;catfile&#40;&#39;testdir&#39;, &#39;folder&#39;&#41;,
 	&#39;folder&#39;,
 &#41;;
 
 # TEST
-ok&#40;scalar&#40;grep { $_ eq &#34;folder/0&#34; } $archive-&gt;memberNames&#40;&#41;&#41;,
+my $dot = q{};
+if&#40;$^O eq &#39;VMS&#39;&#41;{
+    $dot = q{.};
+}
+ok&#40;scalar&#40;grep { $_ eq &#34;folder/0$dot&#34; } $archive-&gt;memberNames&#40;&#41;&#41;,
     &#34;Checking that a file called &#39;0&#39; was added properly&#34;
 &#41;;
 



==== Archive-Zip-1.23/t/common.pl#2 &#40;xtext&#41; ====


@@ -148,6 +148,9 @@
 #--------- check to see if cat works
 
 sub testCat {
+        if&#40;$^O eq &#39;VMS&#39;&#41;{
+            return 0;
+        }
 	my $fh = IO::File-&gt;new&#40; CATPIPE . OUTPUTZIP &#41;;
 	binmode&#40;$fh&#41;;
 	my $testString = pack&#40; &#39;C256&#39;, 0 .. 255 &#41;;
@@ -158,7 +161,7 @@
 	my @stat = stat&#40;OUTPUTZIP&#41;;
 	$stat[7] == length&#40;$testString&#41; or return 0;
 	fileCRC&#40;OUTPUTZIP&#41; == $testCrc or return 0;
-	unlink&#40;OUTPUTZIP&#41;;
+	1 while unlink&#40;OUTPUTZIP&#41;;
 	return 1;
 }
 
@@ -172,7 +175,7 @@
 #--------- check to see if zip works &#40;and make INPUTZIP&#41;
 
 BEGIN {
-	unlink&#40;INPUTZIP&#41;;
+	1 while unlink&#40;INPUTZIP&#41;;
 
 	# Do we have zip installed?
 	if &#40; HAVEZIP &#41; {</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-469853" href="/Public/Bug/Display.html?id=36430#txn-469853">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;08:52:08&nbsp;2008</span>
    <span class="description">steve [...] fisharerojo.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #36430] PATCH for VMS &#40;changes I made to get tests to pass&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 4 Jun 2008 07:51:45 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Archive-Zip [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Steve Peters&#34; &lt;steve [...] fisharerojo.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/469853/231725/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/231725">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 787b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jun 4, 2008 at 5:05 AM, Peter John Edwards via RT
&lt;bug-Archive-Zip@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Wed Jun 04 06:05:43 2008: Request 36430 was acted upon.
&gt; Transaction: Ticket created by cpan@pjedwards.co.uk
&gt;       Queue: Archive-Zip
&gt;     Subject: PATCH for VMS &#40;changes I made to get tests to pass&#41;
&gt;   Broken in: 1.23
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: cpan@pjedwards.co.uk
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=36430">http://rt.cpan.org/Ticket/Display.html?id=36430</a></span> &gt;
&gt;
&gt;
&gt; Hello and thanks for Archive::Zip 1.23
&gt; I&#39;ve attached the changes I made to get the tests to pass on VMS.
&gt; Cheers,
&gt; Peter &#40;Stig&#41; Edwards
&gt;
</div>
Thanks!  I&#39;ll see if I can get Craig Berry, the perl5-porters VMS guy,
to try out Archive-Zip and this patch.

Steve Peters
steve@fisharerojo.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-469854" href="/Public/Bug/Display.html?id=36430#txn-469854">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;08:52:10&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-897282" href="/Public/Bug/Display.html?id=36430#txn-897282">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;15&nbsp;07:53:01&nbsp;2011</span>
    <span class="description">cpan [...] pjedwards.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/897282/465237/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/465237">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1008b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 04 08:52:08 2008, steve@fisharerojo.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed, Jun 4, 2008 at 5:05 AM, Peter John Edwards via RT
&gt; &lt;bug-Archive-Zip@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Wed Jun 04 06:05:43 2008: Request 36430 was acted upon.
&gt; &gt; Transaction: Ticket created by cpan@pjedwards.co.uk
&gt; &gt;       Queue: Archive-Zip
&gt; &gt;     Subject: PATCH for VMS &#40;changes I made to get tests to pass&#41;
&gt; &gt;   Broken in: 1.23
&gt; &gt;    Severity: &#40;no value&#41;
&gt; &gt;       Owner: Nobody
&gt; &gt;  Requestors: cpan@pjedwards.co.uk
&gt; &gt;      Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=36430">http://rt.cpan.org/Ticket/Display.html?id=36430</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Hello and thanks for Archive::Zip 1.23
&gt; &gt; I&#39;ve attached the changes I made to get the tests to pass on VMS.
&gt; &gt; Cheers,
&gt; &gt; Peter &#40;Stig&#41; Edwards
&gt; &gt;
</div>&gt; 
&gt; Thanks!  I&#39;ll see if I can get Craig Berry, the perl5-porters VMS guy,
&gt; to try out Archive-Zip and this patch.
&gt; 
&gt; Steve Peters
&gt; steve@fisharerojo.org
</div>
I&#39;ve attached the changes I made to get the tests to pass on VMS, for 
1.31_01.
Cheers,
Peter &#40;Stig&#41; Edwards
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> vms_changes_for_archive_zip_1_31_01.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/897282/465238/vms_changes_for_archive_zip_1_31_01.txt">Download vms_changes_for_archive_zip_1_31_01.txt</a><br />
<span class="downloadcontenttype">text/plain 4.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
==== archive-zip-1_31_01/lib/archive/zip.pm#1 - archive-zip-1_31_01.lib.archive]zip.pm ====
519c519
&lt;       File::Spec-&gt;splitpath&#40; File::Spec-&gt;canonpath&#40;$name&#41;, $forceDir &#41;;
---
&gt;       File::Spec::Unix-&gt;splitpath&#40; File::Spec::Unix-&gt;canonpath&#40;$name&#41;, $forceDir &#41;;
521c521
&lt;     my @dirs = map { $_ =~ s{/}{_}g; $_ } File::Spec-&gt;splitdir&#40;$directories&#41;;
---
&gt;     my @dirs = map { $_ =~ s{/}{_}g; $_ } File::Spec::Unix-&gt;splitdir&#40;$directories&#41;;
522a523,525
&gt;     if&#40;$^O eq &#39;VMS&#39;&#41;{
&gt;         if &#40; @dirs &gt; 0 &#41; { shift &#40;@dirs&#41; unless $dirs[0] }   # remove empty component
&gt;     }


==== archive-zip-1_31_01/lib/archive/zip/archive.pm#1 - archive-zip-1_31_01.lib.archive.zip]archive.pm ====
469c469
&lt;         unlink&#40;$tempName&#41;;
---
&gt;         1 while&#40;unlink&#40;$tempName&#41;&#41;;
479c479
&lt;         unlink&#40;$tempName&#41;;
---
&gt;         1 while&#40;unlink&#40;$tempName&#41;&#41;;
487c487
&lt;         unlink&#40;$tempName&#41;;
---
&gt;         1 while&#40;unlink&#40;$tempName&#41;&#41;;
492,494c492,496
&lt;     if &#40; -f $backupName &#38;&#38; !unlink&#40;$backupName&#41; &#41; {
&lt;         $err = $!;
&lt;         return _error&#40; &#34;Can&#39;t unlink $backupName&#34;, $err &#41;;
---
&gt;     if &#40; -f $backupName &#41; {
&gt;         1 while unlink&#40;$backupName&#41;;
&gt;         if&#40;-e $backupName&#41;{
&gt;             return _error&#40; &#34;Can&#39;t unlink $backupName&#34;, $! &#41;;
&gt;         }


==== archive-zip-1_31_01/t/02_main.t#1 - archive-zip-1_31_01.t]02_main.t ====
491c491
&lt;               unlink&#40; OUTPUTZIP &#41;;
---
&gt;               1 while&#40;unlink&#40; OUTPUTZIP &#41;&#41;;


==== archive-zip-1_31_01/t/03_ex.t#1 - archive-zip-1_31_01.t]03_ex.t ====
10a11
&gt; use Config;
22c23,27
&lt;       my $cmd    = &#34;\&#34;$^X\&#34; \&#34;-I$libs\&#34; -w \&#34;&#34;. join&#40;&#39;&#34; &#34;&#39;, @_&#41;. &#39;&#34;&#39;;
---
&gt;         my $this_perl = $^X;
&gt;         if &#40;$^O ne &#39;VMS&#39;&#41;{
&gt;             $this_perl .= $Config{_exe} unless $this_perl =~ m/$Config{_exe}$/i;
&gt;         }
&gt;         my $cmd    = &#34;$this_perl \&#34;-I$libs\&#34; \&#34;-w\&#34; \&#34;&#34;. join&#40;&#39;&#34; &#34;&#39;, @_&#41;. &#39;&#34;&#39;;
27c32
&lt; use constant FILENAME =&gt; File::Spec-&gt;catpath&#40; &#39;&#39;, TESTDIR, &#39;testing.txt&#39; &#41;;
---
&gt; use constant FILENAME =&gt; File::Spec-&gt;catfile&#40; TESTDIR, &#39;testing.txt&#39; &#41;;
32c37
&lt; $zip-&gt;addString&#40; TESTSTRING, FILENAME &#41;;
---
&gt; $zip-&gt;addString&#40; TESTSTRING, ZFILENAME &#41;;
67c72
&lt; unlink&#40;OUTPUTZIP&#41;;
---
&gt; 1 while&#40;unlink&#40;OUTPUTZIP&#41;&#41;;
69c74
&lt; unlink&#40;FILENAME&#41;;
---
&gt; 1 while&#40;unlink&#40;FILENAME&#41;&#41;;
82c87
&lt; unlink&#40;OUTPUTZIP&#41;;
---
&gt; 1 while&#40;unlink&#40;OUTPUTZIP&#41;&#41;;
86,87c91,97
&lt; is&#40; -f OUTPUTZIP, 1, &#34;zip updated&#34; &#41;;
&lt; unlink&#40;OUTPUTZIP&#41;;
---
&gt; SKIP: {
&gt;     skip &#39;Running on VMS&#39;,1,if &#40;$^O eq &#39;VMS&#39;&#41;;
&gt;     is&#40; -f OUTPUTZIP, 1, &#34;zip updated&#34; &#41;;
&gt; }
&gt; if&#40;-e OUTPUTZIP&#41;{
&gt;     1 while&#40;unlink&#40;OUTPUTZIP&#41;&#41;;
&gt; }


==== archive-zip-1_31_01/t/06_update.t#1 - archive-zip-1_31_01.t]06_update.t ====
25a26,28
&gt; if&#40;$^O eq &#39;VMS&#39;&#41;{
&gt;     $testDir = &#39;t&#39;;
&gt; }
29,30c32,37
&lt; sub countMembers { unless &#40;$_ eq &#39;.&#39;&#41;
&lt;       { push&#40;@memberNames, $_&#41;; $numberOfMembers++; } };
---
&gt; sub countMembers {
&gt;     unless &#40; &#40;$_ eq &#39;.&#39;&#41; || &#40;$_ eq &#39;[]&#39;&#41; &#41; {
&gt;         push&#40;@memberNames, $_&#41;;
&gt;         $numberOfMembers++;
&gt;     }
&gt; }
44a52,54
&gt; if&#40;$^O eq &#39;VMS&#39;&#41;{
&gt;     $testFileName = File::Spec-&gt;catfile&#40; $testDir, &#39;xxxxxx&#39; &#41;;
&gt; }
55c65
&lt; unlink&#40;$testFileName&#41;;
---
&gt; 1 while&#40;unlink&#40;$testFileName&#41;&#41;;


==== archive-zip-1_31_01/t/07_filenames_of_0.t#1 - archive-zip-1_31_01.t]07_filenames_of_0.t ====
35c35
&lt;       File::Spec-&gt;catfile&#40;&#39;testdir&#39;, &#39;folder&#39;&#41;,
---
&gt;       File::Spec::Unix-&gt;catfile&#40;&#39;testdir&#39;, &#39;folder&#39;&#41;,
40c40,44
&lt; ok&#40;scalar&#40;grep { $_ eq &#34;folder/0&#34; } $archive-&gt;memberNames&#40;&#41;&#41;,
---
&gt; my $dot = q{};
&gt; if&#40;$^O eq &#39;VMS&#39;&#41;{
&gt;     $dot = q{.};
&gt; }
&gt; ok&#40;scalar&#40;grep { $_ eq &#34;folder/0$dot&#34; } $archive-&gt;memberNames&#40;&#41;&#41;,


==== archive-zip-1_31_01/t/09_output_record_sep.t#1 - archive-zip-1_31_01.t]09_output_record_sep.t ====
14,15c14,15
&lt; my $expected_fn = File::Spec-&gt;catfile&#40;
&lt;     File::Spec-&gt;curdir, &#34;t&#34;, &#34;badjpeg&#34;, &#34;expected.jpg&#34;
---
&gt; my $expected_fn = File::Spec::Unix-&gt;catfile&#40;
&gt;     File::Spec::Unix-&gt;curdir, &#34;t&#34;, &#34;badjpeg&#34;, &#34;expected.jpg&#34;
16a17
&gt;
26,27c27,28
&lt;       open my $fh, &#34;&lt;$filename&#34;
&lt;       or die &#39;Can not open file&#39;;
---
&gt;       open my $fh, &#39;&lt;&#39;, $filename
&gt;       or die qq{Can not open file &#39;$filename&#39;};
89c90
&lt;         unlink $got_fn;
---
&gt;         1 while&#40;unlink $got_fn&#41;;
111,112c112,113
&lt;         unlink $got_fn;
&lt;         unlink $archive_fn;
---
&gt;         1 while&#40;unlink $got_fn&#41;;
&gt;         1 while&#40;unlink $archive_fn&#41;;


==== archive-zip-1_31_01/t/common.pl#1 - archive-zip-1_31_01.t]common.pl ====
150a151,153
&gt;         if&#40;$^O eq &#39;VMS&#39;&#41;{
&gt;             return 0;
&gt;         }
161c164
&lt;       unlink&#40;OUTPUTZIP&#41;;
---
&gt;       1 while &#40;unlink&#40;OUTPUTZIP&#41;&#41;;
175c178
&lt;       unlink&#40;INPUTZIP&#41;;
---
&gt;       1 while &#40;unlink&#40;INPUTZIP&#41;&#41;;

</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.410594</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
