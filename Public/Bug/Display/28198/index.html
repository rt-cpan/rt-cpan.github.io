<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #28198 for Net-DNS: Net::DNS bug in v.60 with $_</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #28198 for Net-DNS: Net::DNS bug in v.60 with $_</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">28198</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS/Active/">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">OLAF [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bb [...] otrs.com

<br />
medwards [...] nasba.org

<br />
sec [...] 42.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Net-DNS-0.60.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/342932/153812/Net-DNS-0.60.diff">
Wed Jul 11 11:13:41 2007 (3.1k) by bb [...] otrs.com
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/342953/153824/signature.asc">
Wed Jul 11 11:56:30 2007 (189b) by bb [...] otrs.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/342932/153813/signature.asc">
Wed Jul 11 11:13:41 2007 (189b) by bb [...] otrs.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;11&nbsp;11:13:41&nbsp;2007</span>
    <span class="description">bb [...] otrs.com - Ticket #28106:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Modification of a read-only value attempted at /usr/local/lib/perl/5.8.8/Net/DNS/Question.pm line 47</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Jul 2007 17:12:43 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bodo Bauer &lt;bb [...] otrs.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/342932/153813/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

OTRS utilizes Net::DNS to check if a host name is valid &#40;for email
address entries&#41;. Up to version 0.59 this worked perfectly well. Version
0.60 throws an error:

Modification of a read-only value attempted at /usr/local/lib/perl/5.8.8/Net/DNS/Question.pm line 47

Strangely enough this only happens if the script runs in the Web Server
environment. I wasn&#39;t able to reproduce it in a &#39;regular&#39; script.

The issue is that $_ in modified at a few places. This is where the
module breaks. Attached is a small patch wich fixes the issue. Not sure
I caught all occurrences. But at least the ones we use are fixed :&#41;  

Modifying $_ is deprecated anyway, so I think it&#39;s a good direction to
be headed for. IIRC, Perl 6 is supposed to enforce this policy anyway.

Cheers,
BB
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;11&nbsp;11:56:30&nbsp;2007</span>
    <span class="description">bb [...] otrs.com - Ticket #28106:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #28106] Reference to OTRS Bugzilla</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Jul 2007 17:55:34 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bodo Bauer &lt;bb [...] otrs.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is a reference to the referring bug in our Bugzilla:

<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.otrs.org/show_bug.cgi?id=2017">http://bugs.otrs.org/show_bug.cgi?id=2017</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/342953/153824/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;14&nbsp;07:54:18&nbsp;2007</span>
    <span class="description">sec [...] 42.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::DNS bug in v.60 with $_</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 14 Jul 2007 13:53:57 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stefan `Sec` Zehl &lt;sec [...] 42.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

There is a bug with the new Net::DNS v.60 - It improperly uses $_
inside, and thus overwrites the Callers $_ variable.

One &#40;easy&#41; example is:

| ice:~&gt;perl -MNet::DNS -we &#39;use strict;
| my $res=new Net::DNS::Resolver;
| for &#40;0&#41;{
|     my $q=$res-&gt;send&#40;&#34;freebsd.org&#34;,&#34;A&#34;&#41;;
| }
| &#39;

Modification of a read-only value attempted at /usr/local/lib/perl5/site_perl/5.8.8/mach/Net/DNS/Question.pm line 47.

If you instead add a variable to the for loop, it runs as expected.

CU,
    Sec

P.S.: some system info, in case you need it:


ice:~&gt;uname -a
FreeBSD ice 6.2-STABLE FreeBSD 6.2-STABLE #38: Sun Feb 25 09:20:09 CET 2007     root@ice:/export/obj/export/src/sys/ICE  i386

ice:~&gt;pkg_info -aI|grep Net-DNS
p5-Net-DNS-0.60     Perl5 interface to the DNS resolver, and dynamic updates

ice:~&gt;perl -V
Summary of my perl5 &#40;revision 5 version 8 subversion 8&#41; configuration:
  Platform:
    osname=freebsd, osvers=6.2-prerelease, archname=i386-freebsd-64int
    uname=&#39;freebsd ice 6.2-prerelease freebsd 6.2-prerelease #36: sun oct 1 00:50:35 cest 2006 root@:exportobjexportsrcsysice i386 &#39;
    config_args=&#39;-sde -Dprefix=/usr/local -Darchlib=/usr/local/lib/perl5/5.8.8/mach -Dprivlib=/usr/local/lib/perl5/5.8.8 -Dman3dir=/usr/local/lib/perl5/5.8.8/perl/man/man3 -Dman1dir=/usr/local/man/man1 -Dsitearch=/usr/local/lib/perl5/site_perl/5.8.8/mach -Dsitelib=/usr/local/lib/perl5/site_perl/5.8.8 -Dscriptdir=/usr/local/bin -Dsiteman3dir=/usr/local/lib/perl5/5.8.8/man/man3 -Dsiteman1dir=/usr/local/man/man1 -Ui_malloc -Ui_iconv -Uinstallusrbinperl -Dcc=cc -Duseshrplib -Dccflags=-DAPPLLIB_EXP=&#34;/usr/local/lib/perl5/5.8.8/BSDPAN&#34; -Doptimize=-O2 -fno-strict-aliasing -pipe -march=k6 -Ud_dosuid -Ui_gdbm -Dusethreads=n -Dusemymalloc=y -Duse64bitint&#39;
    hint=recommended, useposix=true, d_sigaction=define
    usethreads=undef use5005threads=undef useithreads=undef usemultiplicity=undef
    useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
    use64bitint=define use64bitall=undef uselongdouble=undef
    usemymalloc=y, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-DAPPLLIB_EXP=&#34;/usr/local/lib/perl5/5.8.8/BSDPAN&#34; -DHAS_FPSETMASK -DHAS_FLOATINGPOINT_H -fno-strict-aliasing -pipe -Wdeclaration-after-statement -I/usr/local/include&#39;,
    optimize=&#39;-O2 -fno-strict-aliasing -pipe -march=k6&#39;,
    cppflags=&#39;-DAPPLLIB_EXP=&#34;/usr/local/lib/perl5/5.8.8/BSDPAN&#34; -DHAS_FPSETMASK -DHAS_FLOATINGPOINT_H -fno-strict-aliasing -pipe -Wdeclaration-after-statement -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;3.4.6 [FreeBSD] 20060305&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=4, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39; -Wl,-E -L/usr/local/lib&#39;
    libpth=/usr/lib /usr/local/lib
    libs=-lgdbm -lm -lcrypt -lutil
    perllibs=-lm -lcrypt -lutil
    libc=, so=so, useshrplib=true, libperl=libperl.so
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;  -Wl,-R/usr/local/lib/perl5/5.8.8/mach/CORE&#39;
    cccdlflags=&#39;-DPIC -fPIC&#39;, lddlflags=&#39;-shared  -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MYMALLOC PERL_MALLOC_WRAP USE_64_BIT_INT
                        USE_LARGE_FILES USE_PERLIO
  Locally applied patches:
        defined-or
  Built under freebsd
  Compiled at Oct  1 2006 02:28:53
  @INC:
    /usr/local/lib/perl5/5.8.8/BSDPAN
    /usr/local/lib/perl5/site_perl/5.8.8/mach
    /usr/local/lib/perl5/site_perl/5.8.8
    /usr/local/lib/perl5/site_perl/5.8.7
    /usr/local/lib/perl5/site_perl/5.8.6
    /usr/local/lib/perl5/site_perl/5.8.5
    /usr/local/lib/perl5/site_perl/5.8.4
    /usr/local/lib/perl5/site_perl/5.8.2
    /usr/local/lib/perl5/site_perl/5.005
    /usr/local/lib/perl5/site_perl
    /usr/local/lib/perl5/5.8.8/mach
    /usr/local/lib/perl5/5.8.8
    .

-- 
Failure is not an option. It comes bundled with your Microsoft product.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;04:16:15&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org - Ticket #28106:  Merged into ticket #28198</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;04:16:15&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Merged into ticket #28198</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;04:16:19&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;31&nbsp;11:56:14&nbsp;2007</span>
    <span class="description">medwards [...] nasba.org - Ticket #28590:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> $_ inadvertently altered leading to side effects in calling program</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve isolated and patched a somewhat obscure bug in the most recent
&#40;0.60&#41; Net::DNS package.  Calling mx&#40;&#41; either as a function or a method
overwrites the current value of $_ with the IP address of the DNS server
that responded to the query. I haven&#39;t checked all the functions the
package provides, but I know this effect is at least produced by the
mx&#40;&#41; function.

Consider this code fragment:

--- snip ---
use strict;
use warnings;
use Net::DNS;

my @a = &#40;
    { &#39;name&#39; =&gt; &#39;www.google.com&#39; },
    { &#39;name&#39; =&gt; &#39;www.yahoo.com&#39; }
&#41;;

foreach &#40;@a&#41; {
    print mx&#40;$_-&gt;{name}&#41; . &#34; is the ip for $_-&gt;{&#39;name&#39;}\n&#34;;
}

--- snip ---

Because the mx function overwrites the value of $_, we get a runtime
error when we try to use $_ as a hash reference after the function call:

Can&#39;t use string &#40;&#34;192.168.1.3&#34;&#41; as a HASH ref while &#34;strict refs&#34; in
use at - line 13.

Further, since in the foreach loop $_ is an alias for each array entry,
the mx function has also inadvertently overwritten the contents of @a.

Since $_ in a true global variable, avoiding its use in the foreach only
allows the alteration of $_ to manifest itself somewhere else.  In my
case it appeared 4 method calls above a call to Email::Valid::address&#40;&#41;,
which uses Net::DNS internally to verify that the domain name exists.

Below are the 3 places I&#39;ve found where alterations to $_ occur and the
alterations I made to prevent it.

In Net::DNS::Question::new&#40;&#41; replace
    my $qname = defined &#40;$_ = shift&#41; ? $_ : &#39;&#39;;
with
    my $qname = shift;
    $qname = &#39;&#39; unless defined &#40;$qname&#41;;

In Net::DNS::Resolver::Base in _ip_is_ipv4&#40;&#41; and _ip_is_ipv6&#40;&#41; replace
    $_ = shift;
with
    local $_ = shift;

This effect is most likely platform neutral, but it has appeared for me
in perl 5.8.8 on Gentoo and CentOs Linux, with the above snippet pasted
directly into perl and under various minor revisions of mod_perl and
apache 2.

Please let me know if there is anything I can do to help.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;31&nbsp;11:56:42&nbsp;2007</span>
    <span class="description">medwards [...] nasba.org - Ticket #28591:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> $_ inadvertently altered leading to side effects in calling program</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve isolated and patched a somewhat obscure bug in the most recent
&#40;0.60&#41; Net::DNS package.  Calling mx&#40;&#41; either as a function or a method
overwrites the current value of $_ with the IP address of the DNS server
that responded to the query. I haven&#39;t checked all the functions the
package provides, but I know this effect is at least produced by the
mx&#40;&#41; function.

Consider this code fragment:

--- snip ---
use strict;
use warnings;
use Net::DNS;

my @a = &#40;
    { &#39;name&#39; =&gt; &#39;www.google.com&#39; },
    { &#39;name&#39; =&gt; &#39;www.yahoo.com&#39; }
&#41;;

foreach &#40;@a&#41; {
    print mx&#40;$_-&gt;{name}&#41; . &#34; is the ip for $_-&gt;{&#39;name&#39;}\n&#34;;
}

--- snip ---

Because the mx function overwrites the value of $_, we get a runtime
error when we try to use $_ as a hash reference after the function call:

Can&#39;t use string &#40;&#34;192.168.1.3&#34;&#41; as a HASH ref while &#34;strict refs&#34; in
use at - line 13.

Further, since in the foreach loop $_ is an alias for each array entry,
the mx function has also inadvertently overwritten the contents of @a.

Since $_ in a true global variable, avoiding its use in the foreach only
allows the alteration of $_ to manifest itself somewhere else.  In my
case it appeared 4 method calls above a call to Email::Valid::address&#40;&#41;,
which uses Net::DNS internally to verify that the domain name exists.

Below are the 3 places I&#39;ve found where alterations to $_ occur and the
alterations I made to prevent it.

In Net::DNS::Question::new&#40;&#41; replace
    my $qname = defined &#40;$_ = shift&#41; ? $_ : &#39;&#39;;
with
    my $qname = shift;
    $qname = &#39;&#39; unless defined &#40;$qname&#41;;

In Net::DNS::Resolver::Base in _ip_is_ipv4&#40;&#41; and _ip_is_ipv6&#40;&#41; replace
    $_ = shift;
with
    local $_ = shift;

This effect is most likely platform neutral, but it has appeared for me
in perl 5.8.8 on Gentoo and CentOs Linux, with the above snippet pasted
directly into perl and under various minor revisions of mod_perl and
apache 2.

Please let me know if there is anything I can do to help.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;09:45:51&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in Net::DNS 0.61

Just released
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;09:45:53&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;09:45:54&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;09:59:33&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org - Ticket #28590:  Merged into ticket #28198</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;09:59:33&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Merged into ticket #28198</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;10:00:05&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org - Ticket #28591:  Merged into ticket #28198</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;10:00:05&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Merged into ticket #28198</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;10:09:53&nbsp;2007</span>
    <span class="description">sec [...] 42.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28198] Net::DNS bug in v.60 with $_</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Aug 2007 16:08:59 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olaf Kolkman via RT &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stefan `Sec` Zehl &lt;sec [...] 42.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Aug 01, 2007 at 09:45 -0400, Olaf Kolkman via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28198">http://rt.cpan.org/Ticket/Display.html?id=28198</a></span> &gt;
&gt; 
&gt; Fixed in Net::DNS 0.61
&gt; 
&gt; Just released
</div>
Thanks!

CU,
    Sec
-- 
In 1968 it took the computing-Power of 2 C-64 to fly a rocket to the moon.
Now, 1997 it takes the Power of a Pentium 133 to run Microsoft Windows 95.
                    Something must have gone wrong.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;10:10:10&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;30&nbsp;21:16:17&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.61.. some time ago...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;30&nbsp;21:16:22&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
