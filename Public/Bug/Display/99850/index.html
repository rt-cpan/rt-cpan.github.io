<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #99850 for Net-STOMP-Client: Net::STOMP::Client::IO::send_data BUG</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #99850 for Net-STOMP-Client: Net::STOMP::Client::IO::send_data BUG</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-STOMP-Client/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-STOMP-Client/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-STOMP-Client/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-STOMP-Client/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-STOMP-Client">Net-STOMP-Client CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">99850</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-STOMP-Client/Active/">Net-STOMP-Client</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pedrom [...] ccbill.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-231880-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-231881-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;27&nbsp;22:43:12&nbsp;2014</span>
    <span class="description">pedrom [...] ccbill.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::STOMP::Client::IO::send_data BUG</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Oct 2014 02:42:56 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-STOMP-Client [...] rt.cpan.org&#34; &lt;bug-Net-STOMP-Client [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pedro Morales &lt;pedrom [...] ccbill.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hey team,

  We&#39;ve used this for a long time. No issues works great.  However, we recently upgraded to perl 5.10 and we have found an issue.  Let me know what you guys think.

Distro name and version:  Net-STOMP-Client-2.2
Perl:  v5.10.1 &#40;*&#41; built for x86_64-linux-thread-multi
OS vendor/version: x86_64 GNU/Linux

Pseudo code:
my $stompFrame = Net::STOMP::Client::Frame-&gt;new&#40;
        command =&gt; &#39;SEND&#39;,
        headers =&gt; {
            destination      =&gt; &#39;/queue/MYQUEUE&#39;,
            &#39;content-length&#39; =&gt; &#39;&#39;,
        },
        body =&gt; &#39;&lt;xml&gt;&lt;testvalue&gt;1&lt;/testvalue&gt;&lt;/xml&gt;&#39;,
&#41;;

if &#40;!Net::STOMP::Client::send_frame&#40;$stompFrame&#41;&#41;{
        print STDERR &#34;Unable to send stomp packet to /queue/MYQUEUE\n&#34;;
        return 0;
}

This is how we have our code implemented.  The issue is that it seems that in the new version of PERL Net::STOMP::Client::send_frame doesn&#39;t actually return the number of bytes written.  I did a little digging and I found the following snippet in there for that method:

sub send_frame : method {
    my&#40;$self, $frame, %option&#41;;

    $self = shift&#40;@_&#41;;
    $frame = shift&#40;@_&#41;;
    %option = _hackopt&#40;@_&#41;;
    # queue the frame
    $self-&gt;queue_frame&#40;$frame, %option&#41;;
    # send queued data
    $self-&gt;send_data&#40;%option&#41;;
    # make sure we did send _all_ data
    dief&#40;&#34;could not send all data!&#34;&#41; if $self-&gt;outgoing_buffer_length&#40;&#41;;
}

Do you see how send_frame doesn&#39;t have an explicit return value?  Normally, this would return the last statement executed &#40;$self-&gt;send_data&#40;&#41;&#41; however, it seems as of the new version of PERL it&#39;s not. I  keep getting 0 which im guessing is coming from the last statement&#39;s $self-&gt;outgoing_buffer_length&#40;&#41;.  FYI, this doesn&#39;t cause any deal breaking issues.  The frame still gets sent to the queue its just the way we test the condition for true fails now and we print the &#34;Unable to send stomp packet... &#34;message in our logs repeatedly.

Let me know if any of this doesn&#39;t make sense.  Could it be a bug in PERL? Now that it&#39;s behaving differently?  Are you able to reproduce this behavior in PERL 5.10?  For reference,  we have this implementation working on LIVE environment using PERL 5.8.7

Thanks.




 Pedro M
 Software Developer II

 T 480.449.7751 ext. 143
 M 602.206.1447
 F 480.422.2038
 E pedrom@ccbill.com
&lt;mailto:pedrom@ccbill.com&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ccbill.com/">http://www.ccbill.com/</a></span>

[CCBill, LLC]&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.ccbill.com/">http://www.ccbill.com/</a></span>&gt;








 CCBill, LLC * 2353 W University Dr. * Tempe, AZ  85281 * USA
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>

<div class="messagebody">
<img alt="image002.png" title="image002.png" src="/Ticket/Attachment/1426039/757542/" /></div>

<div class="messagebody">
<img alt="image004.png" title="image004.png" src="/Ticket/Attachment/1426039/757543/" /></div>

<div class="messagebody">
<img alt="image006.png" title="image006.png" src="/Ticket/Attachment/1426039/757544/" /></div>

<div class="messagebody">
<img alt="image007.png" title="image007.png" src="/Ticket/Attachment/1426039/757545/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;08:26:38&nbsp;2014</span>
    <span class="description">LCONS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">send_frame&#40;&#41; indeed does not return a value. This is by design so you should not try to use its return value.

If you want to make sure that whatever you sent previously indeed got sent, you should check the length of the outgoing buffer. Something like:

if &#40;$broker-&gt;outgoing_buffer_length&#40;&#41; &gt; 0&#41; { ... send is not complete ... }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;08:26:38&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;08:54:44&nbsp;2014</span>
    <span class="description">pedrom [...] ccbill.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Pedro Morales &lt;pedrom [...] ccbill.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99850] Net::STOMP::Client::IO::send_data BUG</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Oct 2014 12:54:29 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-STOMP-Client [...] rt.cpan.org&#34; &lt;bug-Net-STOMP-Client [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pedro Morales &lt;pedrom [...] ccbill.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok understood. Ty for the quick response :&#41;

--Pedro
Sent from my Samsung Galaxy SÂ® III

Lionel Cons via RT &lt;bug-Net-STOMP-Client@rt.cpan.org&gt; wrote:


&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99850">https://rt.cpan.org/Ticket/Display.html?id=99850</a></span> &gt;

send_frame&#40;&#41; indeed does not return a value. This is by design so you should not try to use its return value.

If you want to make sure that whatever you sent previously indeed got sent, you should check the length of the outgoing buffer. Something like:

if &#40;$broker-&gt;outgoing_buffer_length&#40;&#41; &gt; 0&#41; { ... send is not complete ... }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;09:09:24&nbsp;2014</span>
    <span class="description">LCONS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
