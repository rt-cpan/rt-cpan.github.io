<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #61361 for DBD-SQLite: Problems building 1.31 with system SQLite</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #61361 for DBD-SQLite: Problems building 1.31 with system SQLite</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-SQLite/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">61361</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-SQLite/Active/">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
paul [...] city-fan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;15&nbsp;11:51:38&nbsp;2010</span>
    <span class="description">paul [...] city-fan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problems building 1.31 with system SQLite</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A couple of issues came up whilst trying to build DBD-SQLite with an
existing SQLite installation &#40;after patching the &#34;if &#40;0&#41;&#34; to &#34;if &#40;1&#41;&#34; in
Makefile.PL of course&#41;:

1. The addition of &#34;-I.&#34; to the compiler flags in Makefile.PL means that
the bundled &#34;sqlite3.h&#34; is used even when building with the system
SQLite version. This may cause some strange behaviour where the system
version is only slightly different, or it may cause complete failure of
the module if for instance the system version is older than 3.6.23, when
this happens in the test suite:

#   Failed test &#39;use DBD::SQLite;&#39;
#   at t/01_compile.t line 15.
#     Tried to use &#39;DBD::SQLite&#39;.
#     Error:  Can&#39;t load
&#39;/builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/SQLite.so&#39;
for module DBD::SQLite:
/builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/SQLite.so:
undefined symbol: sqlite3_compileoption_get at
/usr/lib64/perl5/DynaLoader.pm line 200.
#  at &#40;eval 7&#41; line 2
# Compilation failed in require at &#40;eval 7&#41; line 2.
# BEGIN failed--compilation aborted at &#40;eval 7&#41; line 2.
# $DBI::VERSION=1.613
Use of inherited AUTOLOAD for non-method DBD::SQLite::compile_options&#40;&#41;
is deprecated at t/01_compile.t line 20.
Can&#39;t locate auto/DBD/SQLite/compile_opt.al in @INC &#40;@INC contains: inc
/builddir/build/BUILD/DBD-SQLite-1.31/blib/lib
/builddir/build/BUILD/DBD-SQLite-1.31/blib/arch /usr/local/lib64/perl5
/usr/local/share/perl5 /usr/local/share/perl5 /usr/lib64/perl5
/usr/share/perl5 /usr/share/perl5 /usr/lib64/perl5 /usr/share/perl5
/usr/local/lib64/perl5/site_perl/5.10.0/x86_64-linux-thread-multi
/usr/local/lib/perl5/site_perl/5.10.0
/usr/lib64/perl5/vendor_perl/5.10.0/x86_64-linux-thread-multi
/usr/lib/perl5/vendor_perl /usr/lib/perl5/site_perl .&#41; at t/01_compile.t
line 20
# Looks like you failed 1 test of 3.
# Looks like your test exited with 2 just after 3.
t/01_compile.t ...........................
Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
Failed 1/3 subtests

This is because the bundled sqlite3.h says that SQLITE_VERSION_NUMBER is
3007002 and hence sqlite3_compileoption_get should be available but it&#39;s
not present in the actual library so module loading fails.

I worked around this by deleting the bundled sqlite3.c, sqlite3.h and
sqlite3ext.h before running Makefile.PL.

2. If the existing SQLite wasn&#39;t built with the ENABLE_FTS3_PARENTHESIS
option enabled, the test suite fails:

#   Failed test &#39;moutons NOT lait &#40;unicode is 0&#41;&#39;
#   at t/43_fts3.t line 98.
#     Structures begin differing at:
#          $got-&gt;[0] = Does not exist
#     $expected-&gt;[0] = &#39;2&#39;
#   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 0&#41;&#39;
#   at t/43_fts3.t line 98.
#     Structures begin differing at:
#          $got-&gt;[0] = Does not exist
#     $expected-&gt;[0] = &#39;1&#39;
#   Failed test &#39;moutons NOT lait &#40;unicode is 1&#41;&#39;
#   at t/43_fts3.t line 98.
#     Structures begin differing at:
#          $got-&gt;[0] = Does not exist
#     $expected-&gt;[0] = &#39;2&#39;
#   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 1&#41;&#39;
#   at t/43_fts3.t line 98.
#     Structures begin differing at:
#          $got-&gt;[0] = Does not exist
#     $expected-&gt;[0] = &#39;1&#39;
# Looks like you failed 4 tests of 19.
t/43_fts3.t ..............................
Dubious, test returned 4 &#40;wstat 1024, 0x400&#41;
Failed 4/19 subtests

The SQLite in Fedora is affected by this issue for instance.

Attached patch resolves that problem.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBD-SQLite-1.31-FTS3.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- DBD-SQLite-1.31/t/43_fts3.t	2010-09-15 08:16:43.000000000 +0100
+++ DBD-SQLite-1.31/t/43_fts3.t	2010-09-15 14:50:58.529161202 +0100
@@ -90,6 +90,11 @@
   }
 
   # queries
+SKIP: {
+  skip &#34;These tests require SQLite compiled with ENABLE_FTS3_PARENTHESIS option&#34;, scalar @tests
+    unless DBD::SQLite-&gt;can&#40;&#39;compile_options&#39;&#41; &#38;&#38;
+    grep /ENABLE_FTS3_PARENTHESIS/, DBD::SQLite::compile_options&#40;&#41;;
+
   my $sql = &#34;SELECT docid FROM try_fts3 WHERE content MATCH ?&#34;;
   for my $t &#40;@tests&#41; {
     my &#40;$query, @expected&#41; = @$t;
@@ -97,6 +102,9 @@
     my $results = $dbh-&gt;selectcol_arrayref&#40;$sql, undef, $query&#41;;
     is_deeply&#40;$results, \@expected, &#34;$query &#40;unicode is $use_unicode&#41;&#34;&#41;;
   }
+
+}
+
 }
 
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;03:17:43&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As for the first issue, we expect anyone sophisticated enough to use a 
system sqlite is also sophisticated enough to have a system that can 
remove bundled sqlite source files, as noted in the Makefile.PL &#40;with 
slight modification :&#41;

As for the second issue, I applied your patch to the trunk.

Thanks,

Kenichi

On Wed Sep 15 11:51:38 2010, paul@city-fan.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A couple of issues came up whilst trying to build DBD-SQLite with an
&gt; existing SQLite installation &#40;after patching the &#34;if &#40;0&#41;&#34; to &#34;if &#40;1&#41;&#34; 
</div>in
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Makefile.PL of course&#41;:
&gt; 
&gt; 1. The addition of &#34;-I.&#34; to the compiler flags in Makefile.PL means 
</div>that
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the bundled &#34;sqlite3.h&#34; is used even when building with the system
&gt; SQLite version. This may cause some strange behaviour where the system
&gt; version is only slightly different, or it may cause complete failure 
</div>of
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the module if for instance the system version is older than 3.6.23, 
</div>when
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; this happens in the test suite:
&gt; 
&gt; #   Failed test &#39;use DBD::SQLite;&#39;
&gt; #   at t/01_compile.t line 15.
&gt; #     Tried to use &#39;DBD::SQLite&#39;.
&gt; #     Error:  Can&#39;t load
&gt; &#39;/builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/
</div>SQLite.so&#39;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; for module DBD::SQLite:
&gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/
</div>SQLite.so:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; undefined symbol: sqlite3_compileoption_get at
&gt; /usr/lib64/perl5/DynaLoader.pm line 200.
&gt; #  at &#40;eval 7&#41; line 2
&gt; # Compilation failed in require at &#40;eval 7&#41; line 2.
&gt; # BEGIN failed--compilation aborted at &#40;eval 7&#41; line 2.
&gt; # $DBI::VERSION=1.613
&gt; Use of inherited AUTOLOAD for non-method DBD::SQLite::compile_options
</div>&#40;&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; is deprecated at t/01_compile.t line 20.
&gt; Can&#39;t locate auto/DBD/SQLite/compile_opt.al in @INC &#40;@INC contains: 
</div>inc
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/lib
&gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/arch /usr/local/lib64/perl5
&gt; /usr/local/share/perl5 /usr/local/share/perl5 /usr/lib64/perl5
&gt; /usr/share/perl5 /usr/share/perl5 /usr/lib64/perl5 /usr/share/perl5
&gt; /usr/local/lib64/perl5/site_perl/5.10.0/x86_64-linux-thread-multi
&gt; /usr/local/lib/perl5/site_perl/5.10.0
&gt; /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-linux-thread-multi
&gt; /usr/lib/perl5/vendor_perl /usr/lib/perl5/site_perl .&#41; at 
</div>t/01_compile.t
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; line 20
&gt; # Looks like you failed 1 test of 3.
&gt; # Looks like your test exited with 2 just after 3.
&gt; t/01_compile.t ...........................
&gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; Failed 1/3 subtests
&gt; 
&gt; This is because the bundled sqlite3.h says that SQLITE_VERSION_NUMBER 
</div>is
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3007002 and hence sqlite3_compileoption_get should be available but 
</div>it&#39;s
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; not present in the actual library so module loading fails.
&gt; 
&gt; I worked around this by deleting the bundled sqlite3.c, sqlite3.h and
&gt; sqlite3ext.h before running Makefile.PL.
&gt; 
&gt; 2. If the existing SQLite wasn&#39;t built with the 
</div>ENABLE_FTS3_PARENTHESIS
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; option enabled, the test suite fails:
&gt; 
&gt; #   Failed test &#39;moutons NOT lait &#40;unicode is 0&#41;&#39;
&gt; #   at t/43_fts3.t line 98.
&gt; #     Structures begin differing at:
&gt; #          $got-&gt;[0] = Does not exist
&gt; #     $expected-&gt;[0] = &#39;2&#39;
&gt; #   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 0&#41;&#39;
&gt; #   at t/43_fts3.t line 98.
&gt; #     Structures begin differing at:
&gt; #          $got-&gt;[0] = Does not exist
&gt; #     $expected-&gt;[0] = &#39;1&#39;
&gt; #   Failed test &#39;moutons NOT lait &#40;unicode is 1&#41;&#39;
&gt; #   at t/43_fts3.t line 98.
&gt; #     Structures begin differing at:
&gt; #          $got-&gt;[0] = Does not exist
&gt; #     $expected-&gt;[0] = &#39;2&#39;
&gt; #   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 1&#41;&#39;
&gt; #   at t/43_fts3.t line 98.
&gt; #     Structures begin differing at:
&gt; #          $got-&gt;[0] = Does not exist
&gt; #     $expected-&gt;[0] = &#39;1&#39;
&gt; # Looks like you failed 4 tests of 19.
&gt; t/43_fts3.t ..............................
&gt; Dubious, test returned 4 &#40;wstat 1024, 0x400&#41;
&gt; Failed 4/19 subtests
&gt; 
&gt; The SQLite in Fedora is affected by this issue for instance.
&gt; 
&gt; Attached patch resolves that problem.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;03:17:44&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;03:17:44&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;03:44:23&nbsp;2010</span>
    <span class="description">adam [...] ali.as -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61361] Problems building 1.31 with system SQLite</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Sep 2010 17:44:14 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-SQLite [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">For the record, I don&#39;t consider this important enough to warrant a
new release unless I see complaints for several different distro
packagers.

Adam K

On 16 September 2010 17:17, Kenichi Ishigaki via RT
&lt;bug-DBD-SQLite@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: DBD-SQLite
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61361">https://rt.cpan.org/Ticket/Display.html?id=61361</a></span> &gt;
&gt;
&gt; As for the first issue, we expect anyone sophisticated enough to use a
&gt; system sqlite is also sophisticated enough to have a system that can
&gt; remove bundled sqlite source files, as noted in the Makefile.PL &#40;with
&gt; slight modification :&#41;
&gt;
&gt; As for the second issue, I applied your patch to the trunk.
&gt;
&gt; Thanks,
&gt;
&gt; Kenichi
&gt;
&gt; On Wed Sep 15 11:51:38 2010, paul@city-fan.org wrote:
<div class="message-stanza open">&gt;&gt; A couple of issues came up whilst trying to build DBD-SQLite with an
&gt;&gt; existing SQLite installation &#40;after patching the &#34;if &#40;0&#41;&#34; to &#34;if &#40;1&#41;&#34;
</div>&gt; in
<div class="message-stanza open">&gt;&gt; Makefile.PL of course&#41;:
&gt;&gt;
&gt;&gt; 1. The addition of &#34;-I.&#34; to the compiler flags in Makefile.PL means
</div>&gt; that
<div class="message-stanza open">&gt;&gt; the bundled &#34;sqlite3.h&#34; is used even when building with the system
&gt;&gt; SQLite version. This may cause some strange behaviour where the system
&gt;&gt; version is only slightly different, or it may cause complete failure
</div>&gt; of
<div class="message-stanza open">&gt;&gt; the module if for instance the system version is older than 3.6.23,
</div>&gt; when
<div class="message-stanza open">&gt;&gt; this happens in the test suite:
&gt;&gt;
&gt;&gt; #   Failed test &#39;use DBD::SQLite;&#39;
&gt;&gt; #   at t/01_compile.t line 15.
&gt;&gt; #     Tried to use &#39;DBD::SQLite&#39;.
&gt;&gt; #     Error:  Can&#39;t load
&gt;&gt; &#39;/builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/
</div>&gt; SQLite.so&#39;
<div class="message-stanza open">&gt;&gt; for module DBD::SQLite:
&gt;&gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/
</div>&gt; SQLite.so:
<div class="message-stanza open">&gt;&gt; undefined symbol: sqlite3_compileoption_get at
&gt;&gt; /usr/lib64/perl5/DynaLoader.pm line 200.
&gt;&gt; #  at &#40;eval 7&#41; line 2
&gt;&gt; # Compilation failed in require at &#40;eval 7&#41; line 2.
&gt;&gt; # BEGIN failed--compilation aborted at &#40;eval 7&#41; line 2.
&gt;&gt; # $DBI::VERSION=1.613
&gt;&gt; Use of inherited AUTOLOAD for non-method DBD::SQLite::compile_options
</div>&gt; &#40;&#41;
<div class="message-stanza open">&gt;&gt; is deprecated at t/01_compile.t line 20.
&gt;&gt; Can&#39;t locate auto/DBD/SQLite/compile_opt.al in @INC &#40;@INC contains:
</div>&gt; inc
<div class="message-stanza open">&gt;&gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/lib
&gt;&gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/arch /usr/local/lib64/perl5
&gt;&gt; /usr/local/share/perl5 /usr/local/share/perl5 /usr/lib64/perl5
&gt;&gt; /usr/share/perl5 /usr/share/perl5 /usr/lib64/perl5 /usr/share/perl5
&gt;&gt; /usr/local/lib64/perl5/site_perl/5.10.0/x86_64-linux-thread-multi
&gt;&gt; /usr/local/lib/perl5/site_perl/5.10.0
&gt;&gt; /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-linux-thread-multi
&gt;&gt; /usr/lib/perl5/vendor_perl /usr/lib/perl5/site_perl .&#41; at
</div>&gt; t/01_compile.t
<div class="message-stanza open">&gt;&gt; line 20
&gt;&gt; # Looks like you failed 1 test of 3.
&gt;&gt; # Looks like your test exited with 2 just after 3.
&gt;&gt; t/01_compile.t ...........................
&gt;&gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt;&gt; Failed 1/3 subtests
&gt;&gt;
&gt;&gt; This is because the bundled sqlite3.h says that SQLITE_VERSION_NUMBER
</div>&gt; is
<div class="message-stanza open">&gt;&gt; 3007002 and hence sqlite3_compileoption_get should be available but
</div>&gt; it&#39;s
<div class="message-stanza open">&gt;&gt; not present in the actual library so module loading fails.
&gt;&gt;
&gt;&gt; I worked around this by deleting the bundled sqlite3.c, sqlite3.h and
&gt;&gt; sqlite3ext.h before running Makefile.PL.
&gt;&gt;
&gt;&gt; 2. If the existing SQLite wasn&#39;t built with the
</div>&gt; ENABLE_FTS3_PARENTHESIS
<div class="message-stanza open">&gt;&gt; option enabled, the test suite fails:
&gt;&gt;
&gt;&gt; #   Failed test &#39;moutons NOT lait &#40;unicode is 0&#41;&#39;
&gt;&gt; #   at t/43_fts3.t line 98.
&gt;&gt; #     Structures begin differing at:
&gt;&gt; #          $got-&gt;[0] = Does not exist
&gt;&gt; #     $expected-&gt;[0] = &#39;2&#39;
&gt;&gt; #   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 0&#41;&#39;
&gt;&gt; #   at t/43_fts3.t line 98.
&gt;&gt; #     Structures begin differing at:
&gt;&gt; #          $got-&gt;[0] = Does not exist
&gt;&gt; #     $expected-&gt;[0] = &#39;1&#39;
&gt;&gt; #   Failed test &#39;moutons NOT lait &#40;unicode is 1&#41;&#39;
&gt;&gt; #   at t/43_fts3.t line 98.
&gt;&gt; #     Structures begin differing at:
&gt;&gt; #          $got-&gt;[0] = Does not exist
&gt;&gt; #     $expected-&gt;[0] = &#39;2&#39;
&gt;&gt; #   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 1&#41;&#39;
&gt;&gt; #   at t/43_fts3.t line 98.
&gt;&gt; #     Structures begin differing at:
&gt;&gt; #          $got-&gt;[0] = Does not exist
&gt;&gt; #     $expected-&gt;[0] = &#39;1&#39;
&gt;&gt; # Looks like you failed 4 tests of 19.
&gt;&gt; t/43_fts3.t ..............................
&gt;&gt; Dubious, test returned 4 &#40;wstat 1024, 0x400&#41;
&gt;&gt; Failed 4/19 subtests
&gt;&gt;
&gt;&gt; The SQLite in Fedora is affected by this issue for instance.
&gt;&gt;
&gt;&gt; Attached patch resolves that problem.
</div>&gt;
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;03:44:24&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;20&nbsp;22:07:14&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;10&nbsp;01:47:08&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">DBD::SQLite 1.32_01 with your patch is out. Thanks.

On 2010-9-16 Thu 03:17:43, ISHIGAKI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for the first issue, we expect anyone sophisticated enough to use 
</div>a 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; system sqlite is also sophisticated enough to have a system that can 
&gt; remove bundled sqlite source files, as noted in the Makefile.PL &#40;with 
&gt; slight modification :&#41;
&gt; 
&gt; As for the second issue, I applied your patch to the trunk.
&gt; 
&gt; Thanks,
&gt; 
&gt; Kenichi
&gt; 
&gt; On Wed Sep 15 11:51:38 2010, paul@city-fan.org wrote:
<div class="message-stanza open">&gt; &gt; A couple of issues came up whilst trying to build DBD-SQLite with an
&gt; &gt; existing SQLite installation &#40;after patching the &#34;if &#40;0&#41;&#34; to &#34;if 
</div></div>&#40;1&#41;&#34; 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; in
<div class="message-stanza open">&gt; &gt; Makefile.PL of course&#41;:
&gt; &gt; 
&gt; &gt; 1. The addition of &#34;-I.&#34; to the compiler flags in Makefile.PL means 
</div>&gt; that
<div class="message-stanza open">&gt; &gt; the bundled &#34;sqlite3.h&#34; is used even when building with the system
&gt; &gt; SQLite version. This may cause some strange behaviour where the 
</div></div>system
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; version is only slightly different, or it may cause complete 
</div></div>failure 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; of
<div class="message-stanza open">&gt; &gt; the module if for instance the system version is older than 3.6.23, 
</div>&gt; when
<div class="message-stanza open">&gt; &gt; this happens in the test suite:
&gt; &gt; 
&gt; &gt; #   Failed test &#39;use DBD::SQLite;&#39;
&gt; &gt; #   at t/01_compile.t line 15.
&gt; &gt; #     Tried to use &#39;DBD::SQLite&#39;.
&gt; &gt; #     Error:  Can&#39;t load
&gt; &gt; &#39;/builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/
</div>&gt; SQLite.so&#39;
<div class="message-stanza open">&gt; &gt; for module DBD::SQLite:
&gt; &gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/arch/auto/DBD/SQLite/
</div>&gt; SQLite.so:
<div class="message-stanza open">&gt; &gt; undefined symbol: sqlite3_compileoption_get at
&gt; &gt; /usr/lib64/perl5/DynaLoader.pm line 200.
&gt; &gt; #  at &#40;eval 7&#41; line 2
&gt; &gt; # Compilation failed in require at &#40;eval 7&#41; line 2.
&gt; &gt; # BEGIN failed--compilation aborted at &#40;eval 7&#41; line 2.
&gt; &gt; # $DBI::VERSION=1.613
&gt; &gt; Use of inherited AUTOLOAD for non-method 
</div></div>DBD::SQLite::compile_options
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;&#41;
<div class="message-stanza open">&gt; &gt; is deprecated at t/01_compile.t line 20.
&gt; &gt; Can&#39;t locate auto/DBD/SQLite/compile_opt.al in @INC &#40;@INC contains: 
</div>&gt; inc
<div class="message-stanza open">&gt; &gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/lib
&gt; &gt; /builddir/build/BUILD/DBD-SQLite-1.31/blib/arch /usr/local/lib64/
</div></div>perl5
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; /usr/local/share/perl5 /usr/local/share/perl5 /usr/lib64/perl5
&gt; &gt; /usr/share/perl5 /usr/share/perl5 /usr/lib64/perl5 /usr/share/perl5
&gt; &gt; /usr/local/lib64/perl5/site_perl/5.10.0/x86_64-linux-thread-multi
&gt; &gt; /usr/local/lib/perl5/site_perl/5.10.0
&gt; &gt; /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-linux-thread-multi
&gt; &gt; /usr/lib/perl5/vendor_perl /usr/lib/perl5/site_perl .&#41; at 
</div>&gt; t/01_compile.t
<div class="message-stanza open">&gt; &gt; line 20
&gt; &gt; # Looks like you failed 1 test of 3.
&gt; &gt; # Looks like your test exited with 2 just after 3.
&gt; &gt; t/01_compile.t ...........................
&gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; Failed 1/3 subtests
&gt; &gt; 
&gt; &gt; This is because the bundled sqlite3.h says that 
</div></div>SQLITE_VERSION_NUMBER 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; is
<div class="message-stanza open">&gt; &gt; 3007002 and hence sqlite3_compileoption_get should be available but 
</div>&gt; it&#39;s
<div class="message-stanza open">&gt; &gt; not present in the actual library so module loading fails.
&gt; &gt; 
&gt; &gt; I worked around this by deleting the bundled sqlite3.c, sqlite3.h 
</div></div>and
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; sqlite3ext.h before running Makefile.PL.
&gt; &gt; 
&gt; &gt; 2. If the existing SQLite wasn&#39;t built with the 
</div>&gt; ENABLE_FTS3_PARENTHESIS
<div class="message-stanza open">&gt; &gt; option enabled, the test suite fails:
&gt; &gt; 
&gt; &gt; #   Failed test &#39;moutons NOT lait &#40;unicode is 0&#41;&#39;
&gt; &gt; #   at t/43_fts3.t line 98.
&gt; &gt; #     Structures begin differing at:
&gt; &gt; #          $got-&gt;[0] = Does not exist
&gt; &gt; #     $expected-&gt;[0] = &#39;2&#39;
&gt; &gt; #   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 0&#41;&#39;
&gt; &gt; #   at t/43_fts3.t line 98.
&gt; &gt; #     Structures begin differing at:
&gt; &gt; #          $got-&gt;[0] = Does not exist
&gt; &gt; #     $expected-&gt;[0] = &#39;1&#39;
&gt; &gt; #   Failed test &#39;moutons NOT lait &#40;unicode is 1&#41;&#39;
&gt; &gt; #   at t/43_fts3.t line 98.
&gt; &gt; #     Structures begin differing at:
&gt; &gt; #          $got-&gt;[0] = Does not exist
&gt; &gt; #     $expected-&gt;[0] = &#39;2&#39;
&gt; &gt; #   Failed test &#39;&#40;il OR elle&#41; AND un* &#40;unicode is 1&#41;&#39;
&gt; &gt; #   at t/43_fts3.t line 98.
&gt; &gt; #     Structures begin differing at:
&gt; &gt; #          $got-&gt;[0] = Does not exist
&gt; &gt; #     $expected-&gt;[0] = &#39;1&#39;
&gt; &gt; # Looks like you failed 4 tests of 19.
&gt; &gt; t/43_fts3.t ..............................
&gt; &gt; Dubious, test returned 4 &#40;wstat 1024, 0x400&#41;
&gt; &gt; Failed 4/19 subtests
&gt; &gt; 
&gt; &gt; The SQLite in Fedora is affected by this issue for instance.
&gt; &gt; 
&gt; &gt; Attached patch resolves that problem.
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;10&nbsp;01:47:09&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;10&nbsp;01:47:09&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
