<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #67357 for Algorithm-TokenBucket: Occasional test failures</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #67357 for Algorithm-TokenBucket: Occasional test failures</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Algorithm-TokenBucket">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Algorithm-TokenBucket">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Algorithm-TokenBucket">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Algorithm-TokenBucket">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/kappa/Algorithm-TokenBucket/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Algorithm-TokenBucket">Algorithm-TokenBucket CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">67357</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Algorithm-TokenBucket">Algorithm-TokenBucket</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">KAPPA [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-1002-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.32    </td>
  </tr>
  <tr id="CF-1003-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=67357">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-921045" href="/Public/Bug/Display.html?id=67357#txn-921045">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;10&nbsp;07:40:10&nbsp;2011</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Occasional test failures</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/921045/477875/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/477875">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 144b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The CPAN testers matrix shows that tests sometimes fail:
<span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Algorithm-TokenBucket&#38;maxver=">http://matrix.cpantesters.org/?dist=Algorithm-TokenBucket&#38;maxver=</a></span>

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542245" href="/Public/Bug/Display.html?id=67357#txn-1542245">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;12:03:04&nbsp;2015</span>
    <span class="description">KAPPA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1542245/823394/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/823394">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 719b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, Slaven.

I still see failures for Algorithm::TokenBucket from your FreeBSD boxes.

Could you please help me a little with this?

Could you run those tests on those boxes by hand and preferable under &#34;time&#34;?

My current idea is that your boxes are so overloaded that my time-sensitive tests fail. Since this is a real-time module, the tests may break if there are literally seconds between consecutive lines. 

So, are those testing boxes really under heavy load running thousands of tests simultaneously?


10 Nis 2011 Pzr, 07:40:10 tarihinde, SREZIC yazdı:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The CPAN testers matrix shows that tests sometimes fail:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Algorithm-TokenBucket&#38;maxver=">http://matrix.cpantesters.org/?dist=Algorithm-TokenBucket&#38;maxver=</a></span>
&gt; 
&gt; Regards,
&gt;     Slaven
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542246" href="/Public/Bug/Display.html?id=67357#txn-1542246">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;12:03:04&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542248" href="/Public/Bug/Display.html?id=67357#txn-1542248">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;12:03:05&nbsp;2015</span>
    <span class="description">KAPPA [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542775" href="/Public/Bug/Display.html?id=67357#txn-1542775">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;07&nbsp;15:13:43&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1542775/823704/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/823704">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The failures are not exclusive to FreeBSD; I was able to generate fails on Linux systems &#40;reports will be visible in a few hours&#41;. Maybe an interesting data point is that all of my smokers run in virtual machines &#40;VirtualBox and Xen&#41;, and it&#39;s well known that timing is problematic in virtual environments. However, I was also able to get a test failure on a physical Linux box. It does not seem that failures happen due to heavy load; I see both: passing tests when another smoker process is running in the same VM, and failing tests if the whole system is nearly idle.

Here&#39;s a run of basic.t on a FreeBSD 10.1 system, prefixed with the fractional epoch time &#40;using <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/distribution/App-Timestamper/bin/timestamper">https://metacpan.org/pod/distribution/App-Timestamper/bin/timestamper</a></span> &#41;:

$ perl5.20.3 -Mblib t/basic.t |&#38; /usr/perl5.20.3p/bin/timestamper
1444244257.130156994    1..30
1444244257.137207031    ok 1 - use Algorithm::TokenBucket;
1444244257.142980099    ok 2 - An object of class &#39;Algorithm::TokenBucket&#39; isa &#39;Algorithm::TokenBucket&#39;
1444244257.148297071    ok 3 - info_rate init
1444244257.151695013    ok 4 - burst_size init
1444244257.162719011    ok 5 - check_time init
1444244257.173449993    ok 6 - tokens init
1444244257.178256989    not ok 7 - ~0 tokens in new bucket
1444244257.179416895    #   Failed test &#39;~0 tokens in new bucket&#39;
1444244257.180851936    #   at t/basic.t line 17.
1444244257.182490110    #     &#39;1.51029825210571&#39;
1444244257.183644056    #         &lt;
1444244257.186130047    #     &#39;0.99&#39;
1444244257.309364080    ok 8 - 0 conforms
1444244257.323513985    ok 9 - 4 conforms
1444244257.354871988    ok 10 - 5 does not conform
1444244257.366426945    ok 11 - 4 no more conforms
1444244257.402510881    ok 12 - only 3 does
1444244257.449511051    ok 13 - ~3 tokens indeed
1444244257.456573963    ok 14 - ~0 tokens again
1444244257.466741085    ok 15 - 1.1 conforms no more
1444244257.470427990    ok 16 - -= 1000 drained bucket to 0
1444244259.323415995    ok 17 - 50 or less in 2 seconds
1444244259.325280905    ok 18 - state[0]
1444244259.327215910    ok 19 - state[1]
1444244259.328716040    ok 20 - state[2]
1444244259.330478907    ok 21 - state[3]
1444244259.332042933    ok 22 - An object of class &#39;Algorithm::TokenBucket&#39; isa &#39;Algorithm::TokenBucket&#39;
1444244259.333476067    ok 23 - restored bucket is almost empty
1444244259.437441111    ok 24 - restored bucket works
1444244259.438899994    ok 25 - no wait time for 1
1444244259.440474033    ok 26 - wait time
1444244259.442068100    ok 27 - bigger wait time for a bigger number
1444244259.443654060    ok 28 - until&#40;&#41; is sort of accurate
1444244259.453411102    ok 29 - state is the same
1444244259.454673052    ok 30 - no warnings
1444244259.455193043    # Looks like you failed 1 test of 30.


On 2015-10-06 12:03:04, KAPPA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi, Slaven.
&gt; 
&gt; I still see failures for Algorithm::TokenBucket from your FreeBSD
&gt; boxes.
&gt; 
&gt; Could you please help me a little with this?
&gt; 
&gt; Could you run those tests on those boxes by hand and preferable under
&gt; &#34;time&#34;?
&gt; 
&gt; My current idea is that your boxes are so overloaded that my time-
&gt; sensitive tests fail. Since this is a real-time module, the tests may
&gt; break if there are literally seconds between consecutive lines.
&gt; 
&gt; So, are those testing boxes really under heavy load running thousands
&gt; of tests simultaneously?
&gt; 
&gt; 
&gt; 10 Nis 2011 Pzr, 07:40:10 tarihinde, SREZIC yazdı:
<div class="message-stanza open">&gt; &gt; The CPAN testers matrix shows that tests sometimes fail:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Algorithm-TokenBucket&#38;maxver=">http://matrix.cpantesters.org/?dist=Algorithm-TokenBucket&#38;maxver=</a></span>
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt;     Slaven
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.290496</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
