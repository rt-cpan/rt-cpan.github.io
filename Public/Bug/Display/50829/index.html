<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #50829 for XML-LibXML: Malformed UTF-8 in tests</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #50829 for XML-LibXML: Malformed UTF-8 in tests</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-LibXML/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML">XML-LibXML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">50829</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-LibXML/Active/">XML-LibXML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MARKOV [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-37350-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.70    </td>
  </tr>
  <tr id="CF-37351-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;26&nbsp;05:07:54&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Malformed UTF-8 in tests</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Various tests of t/02parse.t produce as warning:

  Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at lib/XML/LibXML/Error.pm line 217

test 40 twice, test 41 once, test 88 twice, test 89 once, test 134
twice, test 135 once, test 181 twice, test 182 once.

Running Perl 5.10.1 on openSuSE 11.0
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;04&nbsp;13:22:19&nbsp;2009</span>
    <span class="description">perl [...] evancarroll.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can confirm

Compiled against libxml2 version: 20706

Argument &#34;20706-GITv2.7.6&#34; isn&#39;t numeric in numeric ne &#40;!=&#41; at
t/01basic.t line 18.
FAILED test 3
        Failed 1/3 tests, 66.67% okay
t/02parse.....................Malformed UTF-8 character &#40;unexpected end
of string&#41; in substitution &#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution
&#40;s///&#41; at
/root/.cpanplus/5.10.0/build/XML-LibXML-1.70/blib/lib/XML/LibXML/Error.pm line
217.


-- 
Evan Carroll
perl@evancarroll.com
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.evancarroll.com">http://www.evancarroll.com</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;04&nbsp;13:22:20&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;06&nbsp;16:02:48&nbsp;2010</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m seeing this while smoking my perl 5.12 build. The patch is easy, as long as it&#39;s not pointing 
to something more nefarious under the hood:
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/XML/LibXML/Error.pm b/lib/XML/LibXML/Error.pm
index b60d6cf..ee46b11 100644
--- a/lib/XML/LibXML/Error.pm
+++ b/lib/XML/LibXML/Error.pm
@@ -213,7 +213,7 @@ sub as_string {
     } elsif &#40;defined $self-&gt;{context}&#41; {
       my $context = $self-&gt;{context};
       $msg.=$context.&#34;\n&#34;;
-      $context = substr&#40;$context,0,$self-&gt;{column}&#41;;
+      $context = substr&#40;$context,0,$self-&gt;{column}&#41; || &#39;&#39;;
       $context=~s/[^\t]/ /g;
       $msg.=$context.&#34;^\n&#34;;
     }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;06&nbsp;16:24:36&nbsp;2010</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My bad. This patch actually just hides the problem. 

A Quick run on tests for 02parse.t, which didn&#39;t change from 1.69 seems to indicate that this is 
a regression issue.

It appears that UTF8 data is being corrupted
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;06&nbsp;16:49:14&nbsp;2010</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Verbose test output:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;prove -bvm t/02parse.t 
</div>t/02parse.t .. 
1..496
# Running under perl version 5.012000 for linux
# Current time local: Tue Apr  6 15:45:42 2010
# Current time GMT:   Tue Apr  6 20:45:42 2010
# Using Test.pm version 1.25_02
# 1 NON VALIDATING PARSER
# 1.1 WELL FORMED STRING PARSING
# 1.1.1 DEFAULT VALUES
ok 1
ok 2
...
ok 39
ok 40
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 41
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 42
...
ok 86
ok 87
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 88
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 89
...
ok 134
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 135
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 136
ok 137
...
ok 180
ok 181
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 182
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 183
ok 184
...
ok 495
ok 496
ok
All tests successful.
Files=1, Tests=496,  0 wallclock secs &#40; 0.08 usr  0.02 sys +  0.13 cusr  0.02 csys =  0.25 CPU&#41;
Result: PASS
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;06&nbsp;18:58:53&nbsp;2010</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">applying patches from 56334, I&#39;ve been able to more easily determine the source of the 
warnings.

Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
Malformed UTF-8 character &#40;unexpected end of string&#41; in substitution &#40;s///&#41; at 
/home/toddr/projects/cpperl/cpan/SOURCES/modules/XML-LibXML-
1.70/blib/lib/XML/LibXML/Error.pm line 217.
ok 41 - Error thrown passing &#39;&lt;foob&lt;E4&gt;r/&gt;&#39;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;06&nbsp;19:00:49&nbsp;2010</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This command causes this warning. I assume because it&#39;s a bad encoding?

$parser-&gt;parse_string&#40;&#34;&lt;foobär/&gt;&#34;&#41;;

Perhaps parse_string should check encoding before doing anything with the data it&#39;s passed?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;07&nbsp;03:49:23&nbsp;2010</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #50829] Malformed UTF-8 in tests</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Apr 2010 09:49:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Todd Rinaldo via RT &lt;bug-XML-LibXML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Todd Rinaldo via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [100406 23:00]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=50829">https://rt.cpan.org/Ticket/Display.html?id=50829</a></span> &gt;
&gt; This command causes this warning. I assume because it&#39;s a bad encoding?
&gt; 
&gt; $parser-&gt;parse_string&#40;&#34;&lt;foobär/&gt;&#34;&#41;;
&gt; 
&gt; Perhaps parse_string should check encoding before doing anything
&gt; with the data it&#39;s passed?
</div>
Well, there are various interpretations of your example: is your
file utf-8 or latin1?

When it is latin1, I get
  panic: sv_pos_u2b_cache cache 7 real 5 for &lt;foob�r/&gt; at
  /usr/lib/perl5/site_perl/5.10.0/x86_64-linux-thread-multi/XML/LibXML/Error.pm
  line 216.

Except when I add &#34;use encoding &#39;latin1&#39;;&#34; to the script.  Then it stops
crashing.

Different to Perl, XML::LibXML expects strings to be either in utf8
or in &#34;the same encoding as the input/output document has specified&#34;.

The problem you encounter is comparible to that of the tests: the Perl
scripts should not trust on Perl&#39;s smart behavior trying to autodetect
the character-encoding of the files based on OS information. Probably,
you should add &#34;use utf8;&#34; to the top of your file.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;16:43:04&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m resolving this bug as old, because I am unable to reproduce it here
&#40;Mandriva Linux Cooker, x86-64 or Mageia Linux Cauldron, x86-32, both
with the latest libxml2 and a UTF-8 locale.&#41;. If you can reproduce it
please reply to it with a reproduction recipe.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;16:43:04&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
