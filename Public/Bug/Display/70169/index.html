<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70169 for MARC-Record: MARC::File::USMARC gets tripped up if fields contain 0x1D</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70169 for MARC-Record: MARC::File::USMARC gets tripped up if fields contain 0x1D</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=MARC-Record">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=MARC-Record">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=MARC-Record">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=MARC-Record">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MARC-Record">MARC-Record CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70169</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=MARC-Record">MARC-Record</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
m.e.phillips [...] durham.ac.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20332-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20333-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




clergy.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/965903/502653/clergy.zip">
Wed Aug 10 11:52:48 2011 (1.3k) by m.e.phillips [...] durham.ac.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=70169">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-965514" href="/Public/Bug/Display.html?id=70169#txn-965514">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;10:12:50&nbsp;2011</span>
    <span class="description">m.e.phillips [...] durham.ac.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MARC::File::USMARC gets tripped up if fields contain 0x1D</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 9 Aug 2011 15:12:24 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-MARC-Record [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;PHILLIPS M.E.&#34; &lt;m.e.phillips [...] durham.ac.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/965514/502441/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/502441">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have been using the MARC::Record Perl module to process some MARC
records exported from Millennium.  For some reason, a few records
actually have the character 0x1D as part of field values, not just as an
end of record marker.  These can occur because Millennium extends the
multi-byte character encoding of CJK to allow arbitrary 16-bit Unicode
characters to appear.  We mainly see this with directional quotes pasted
into our records by cataloguers.

Anyhow, MARC::File::USMARC gets tripped up by this because in &#34;sub next&#34;
the record is read by setting $/ to 0x1D and reading a &#34;line&#34; from the
file:

    local $/ = END_OF_RECORD;
    my $usmarc = &lt;$fh&gt;;

I found that by replacing those two lines with the following I was able
to overcome the problem:

    my $length;
    read&#40;$fh, $length, 5&#41; || return;
    return unless $length&gt;=5;

    my $record;
    read&#40;$fh, $record, $length-5&#41; || return;
    my $usmarc = $length.$record;

This works by reading the first five bytes of the record, which signify
the record length, and then reading the remaining number of bytes as
stipulated by the record length.

Perhaps you might consider incorporating this change into the next
version of MARC::File::USMARC?

Other than this minor niggle, I find the MARC::Record module to be a
really powerful tool: great stuff!

Matthew

-- 
Matthew Phillips
Electronic Systems Librarian, Durham University
Durham University Library, Stockton Road, Durham, DH1 3LY
+44 &#40;0&#41;191 334 2941
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-965536" href="/Public/Bug/Display.html?id=70169#txn-965536">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;11:00:51&nbsp;2011</span>
    <span class="description">GMCHARLT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/965536/502461/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/502461">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Tue Aug 09 10:12:50 2011, m.e.phillips@durham.ac.uk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have been using the MARC::Record Perl module to process some MARC
&gt; records exported from Millennium.  For some reason, a few records
&gt; actually have the character 0x1D as part of field values, not just as 
</div>an
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; end of record marker.  These can occur because Millennium extends the
&gt; multi-byte character encoding of CJK to allow arbitrary 16-bit Unicode
&gt; characters to appear.  We mainly see this with directional quotes 
</div>pasted
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; into our records by cataloguers.
</div>
Could you attach such a record for use as a test case?  I also maintain 
MARC::Charset, so I&#39;m also interested in the III character encoding 
extensions in general.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This works by reading the first five bytes of the record, which 
</div>signify
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the record length, and then reading the remaining number of bytes as
&gt; stipulated by the record length.
&gt; 
&gt; Perhaps you might consider incorporating this change into the next
&gt; version of MARC::File::USMARC?
</div>
Yes, though there will need to be a switch controlling how 
MARC::File::USMARC slurps records, since unfortunately there are plenty 
of MARC records in the wild whose Leader/00-04 is not trustworthy but 
where splitting on \x1D and &#40;loosely&#41; parsing the record can be made to 
work.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Other than this minor niggle, I find the MARC::Record module to be a
&gt; really powerful tool: great stuff!
</div>
Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-965539" href="/Public/Bug/Display.html?id=70169#txn-965539">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;11:00:52&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-965903" href="/Public/Bug/Display.html?id=70169#txn-965903">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;11:52:48&nbsp;2011</span>
    <span class="description">m.e.phillips [...] durham.ac.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #70169] MARC::File::USMARC gets tripped up if fields contain 0x1D</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Aug 2011 16:52:16 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-MARC-Record [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;PHILLIPS M.E.&#34; &lt;m.e.phillips [...] durham.ac.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/965903/502652/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/502652">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could you attach such a record for use as a test case?  I also maintain
&gt; MARC::Charset, so I&#39;m also interested in the III character encoding
&gt; extensions in general.
</div>
I&#39;ve attached a zip file, clergy.zip, which contains clergy.out, a file with a single unblocked MARC record output from Millennium.  The record can be seen on our OPAC at <span class="clickylink"><a target="new" rel="nofollow" href="http://library.dur.ac.uk/record=b2660297~S1">http://library.dur.ac.uk/record=b2660297~S1</a></span>

Rather than hunt for a record containing a 0x1d in the field data I have cheated by doctoring this record.  The 0x1d appears as part of the closing double quotes round the words &#34;Online Journal&#34; in the 520 note field.

Here is an excerpt using hexdump -C:

000008a0  28 42 4f 6e 6c 69 6e 65  20 4a 6f 75 72 6e 61 6c  |&#40;BOnline Journal|
000008b0  1b 24 31 7f 20 1d 1b 28  42 20 63 6f 6e 74 61 69  |.$1. ..&#40;B contai|

It appears that Millennium subverts the CJK character set in order to put 16-bit Unicode characters into the records.

The sequence 1b 24 31 7f 20 1d 1b 28 42 equates to:

1B 24 31 = set G0 to CJK character set
7f 20 1d = invalid CJK code, made up of 7f followed by 20 1d &#40;big-endian UTF-16 code&#41;
1b 28 42 = set G0 to Basic Latin &#40;ASCII&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, though there will need to be a switch controlling how
&gt; MARC::File::USMARC slurps records, since unfortunately there are plenty
&gt; of MARC records in the wild whose Leader/00-04 is not trustworthy but
&gt; where splitting on \x1D and &#40;loosely&#41; parsing the record can be made to
&gt; work.
</div>
Yes, I&#39;d forgotten that problem, which I have met before!  Another approach would be to check the record length by examining the directory, which has to be pretty accurate in order to parse the fields at all.

Incidentally, could I contact you via e-mail to ask one or two questions about MARC::Charset as I am a bit puzzled by the implementation in one or two places.  Is your gmail address as shown on CPAN the best way?

Matthew

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/965903/502653/clergy.zip">Download clergy.zip</a><br />
<span class="downloadcontenttype">application/x-zip-compressed 1.3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-965921" href="/Public/Bug/Display.html?id=70169#txn-965921">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;12:46:06&nbsp;2011</span>
    <span class="description">gmcharlt [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70169] MARC::File::USMARC gets tripped up if fields contain 0x1D</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Aug 2011 12:45:57 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MARC-Record [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Galen Charlton &lt;gmcharlt [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/965921/502663/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/502663">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Wed, Aug 10, 2011 at 11:52 AM, PHILLIPS M.E. via RT
&lt;bug-MARC-Record@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Â  Â  Â  Queue: MARC-Record
&gt; Â Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70169">https://rt.cpan.org/Ticket/Display.html?id=70169</a></span> &gt;
&gt; I&#39;ve attached a zip file, clergy.zip, which contains clergy.out, a file with a single unblocked MARC record output from Millennium. Â The record can be seen on our OPAC at <span class="clickylink"><a target="new" rel="nofollow" href="http://library.dur.ac.uk/record=b2660297~S1">http://library.dur.ac.uk/record=b2660297~S1</a></span>
</div>
Thanks for supplying the example and the additional information
regarding III&#39;s hack of MARC-8.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, I&#39;d forgotten that problem, which I have met before! Â Another approach would be to check the record length by examining the directory, which has to be pretty accurate in order to parse the fields at all.
</div>
You&#39;d be surprised.  I&#39;ve run into cases where the length and offset
values in the directory were completely long, but as long as the
number of directory entries corresponds to the number of field
terminator characters, I&#39;ve been able to successfully parse such
records.  Might be worth adding a parsing mode to MARC::File::USMARC
to support that, not that encouraging such sloppy MARC records is a
good idea. :&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Incidentally, could I contact you via e-mail to ask one or two questions about MARC::Charset as I am a bit puzzled by the implementation in one or two places. Â Is your gmail address as shown on CPAN the best way?
</div>
Yes, it is.

Regards,

Galen
-- 
Galen Charlton
gmcharlt@gmail.com
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.380575</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
