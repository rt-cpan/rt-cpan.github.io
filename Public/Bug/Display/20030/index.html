<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #20030 for HTTP-Recorder: Frame Support and Patch for extra inserted newlines</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #20030 for HTTP-Recorder: Frame Support and Patch for extra inserted newlines</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=HTTP-Recorder">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=HTTP-Recorder">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=HTTP-Recorder">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=HTTP-Recorder">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTTP-Recorder">HTTP-Recorder CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">20030</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=HTTP-Recorder">HTTP-Recorder</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tolga [...] cpanel.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16394-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16395-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




CustomHTTPRecorder.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/211639/82997/CustomHTTPRecorder.pm">
Wed Jun 21 15:24:15 2006 (2.5k) by Guest
</a>
</font></li>
</ul>


CustomHTTPRecorderLogger.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/211639/83000/CustomHTTPRecorderLogger.pm">
Wed Jun 21 15:24:15 2006 (5.4k) by Guest
</a>
</font></li>
</ul>


Logger.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/211639/82991/Logger.diff">
Wed Jun 21 15:24:15 2006 (5.2k) by Guest
</a>
</font></li>
</ul>


Recorder.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/211639/82994/Recorder.diff">
Wed Jun 21 15:24:15 2006 (9.8k) by Guest
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=20030">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-211632" href="/Public/Bug/Display.html?id=20030#txn-211632">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;21&nbsp;15:19:32&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Frame Support and Patch for extra inserted newlines</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/211632/82977/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/82977">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I use HTTP::Recorder to generate test cases. Then I plug the
generated code to my custom test module. I had to make
some changes to the original source code to support frames and
to be able to check HTML content in the responses.

I have been using the SVN tarball that was recommended in the bug
reports posted by neuhaus &#40;can&#39;t locate object method &#34;query_param...&#41;

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bitmistress.org/websvn/dl.php?repname=HTTP%3A%3ARecorder&#38;path=%2Ftrunk%2Flib%2FHTTP%2F&#38;rev=0&#38;isdir=1">http://www.bitmistress.org/websvn/dl.php?repname=HTTP%3A%3ARecorder&#38;path=%2Ftrunk%2Flib%2FHTTP%2F&#38;rev=0&#38;isdir=1</a></span>

The patch files I attached fix an issue where extra newlines
get inserted in HTTP::Recorder. This causes
a mismatch between WWW::Mechanize::content&#40;&#41; &#40;especially format =&gt; &#39;text&#39;&#41; 
output and HTTP::Recorder recorded session. The patch basically
removes some newlines. 

I use HTTP::Recorder as a base class
and override modify_response&#40;&#41; to keep track of frames as well
as log HTML content via my custom logger class. The test code
generated via my custom logger class uses the HTML content
to verify the HTML responses.

The patches also add &#39;rec-frame&#39; tags and add support to
handle &#39;target&#39; attributes in links. I use these with
my custom Logger. The test code generated uses the
proper WWW::Mechanize agent that corresponds to the frame.

I would appreciate if you could take a look and see if these
files are useful.

Regards,

Tolga Ceylan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-211639" href="/Public/Bug/Display.html?id=20030#txn-211639">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;21&nbsp;15:24:14&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/211639/82988/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/82988">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 70b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
The patches did not show up in the original posting. Here we go...
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/211639/82991/Logger.diff">Download Logger.diff</a><br />
<span class="downloadcontenttype">text/x-diff 5.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- HTTP/Recorder/Logger.pm	2006-01-08 14:35:01.000000000 -0600
+++ ../for_diff/HTTP/Recorder/Logger.pm	2006-06-21 13:17:43.000000000 -0500
@@ -90,7 +90,12 @@
 	@_
 	&#41;;
 
-    $self-&gt;Log&#40;&#34;get&#34;, &#34;&#39;$args{url}&#39;&#34;&#41;;
+    $self-&gt;Log&#40;
+        &#34;get&#34;, 
+        &#34;&#39;$args{url}&#39;&#34;, 
+        &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39; =&gt; $args{&#39;target&#39;}
+        &#41;;
 }
 
 sub FollowLink {
@@ -103,14 +108,26 @@
 
     if &#40;$args{text}&#41; {
 	$args{text} =~ s/&#34;/\\&#34;/g;
-	$self-&gt;Log&#40;&#34;follow_link&#34;, 
-		   &#34;text =&gt; &#39;$args{text}&#39;, n =&gt; &#39;$args{index}&#39;&#34;&#41;;
+        $self-&gt;Log&#40;
+            &#34;follow_link&#34;, 
+		    &#34;text =&gt; &#39;$args{text}&#39;, n =&gt; &#39;$args{index}&#39;&#34;,
+            &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+            &#39;target&#39; =&gt; $args{&#39;target&#39;}
+           &#41;;
     } elsif &#40;$args{url}&#41; {
-	$self-&gt;Log&#40;&#34;follow_link&#34;, 
-		   &#34;url =&gt; &#39;$args{url}&#39;&#34;&#41;;
+        $self-&gt;Log&#40;
+            &#34;follow_link&#34;, 
+		    &#34;url =&gt; &#39;$args{url}&#39;&#34;,
+            &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+            &#39;target&#39; =&gt; $args{&#39;target&#39;}
+           &#41;;
     } else {
-	$self-&gt;Log&#40;&#34;follow_link&#34;, 
-		   &#34;n =&gt; &#39;$args{index}&#39;&#34;&#41;;
+        $self-&gt;Log&#40;
+            &#34;follow_link&#34;, 
+		    &#34;n =&gt; &#39;$args{index}&#39;&#34;,
+            &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+            &#39;target&#39; =&gt; $args{&#39;target&#39;}
+            &#41;;
     }
 }
 
@@ -123,26 +140,46 @@
 		button_name =&gt; {},
 		button_value =&gt; {},
 		button_number =&gt; {},
+        frame =&gt; &#39;&#39;,
+        target =&gt; &#39;&#39;,
 		@_
 		&#41;;
 
-    $self-&gt;SetForm&#40;name =&gt; $args{name}, number =&gt; $args{number}&#41;;
+    $self-&gt;SetForm&#40;
+        &#39;name&#39;      =&gt; $args{&#39;name&#39;}, 
+        &#39;number&#39;    =&gt; $args{&#39;number&#39;}, 
+        &#39;frame&#39;     =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39;    =&gt; $args{&#39;target&#39;}
+        &#41;;
 
     my %fields = %{$args{&#39;fields&#39;}};
+
     foreach my $field &#40;keys %fields&#41; {
 	if &#40;$fields{$field}{&#39;type&#39;} eq &#39;checkbox&#39;&#41; {
-	    $self-&gt;Check&#40;name =&gt; $fields{$field}{&#39;name&#39;}, 
-			 value =&gt; $fields{$field}{&#39;value&#39;}&#41;;
+            $self-&gt;Check&#40;
+                &#39;name&#39;   =&gt; $fields{$field}{&#39;name&#39;}, 
+                &#39;value&#39;  =&gt; $fields{$field}{&#39;value&#39;},
+                &#39;frame&#39;  =&gt; $args{&#39;frame&#39;},
+                &#39;target&#39; =&gt; $args{&#39;target&#39;}
+                &#41;;
 	} else {
-	    $self-&gt;SetField&#40;name =&gt; $fields{$field}{&#39;name&#39;}, 
-			    value =&gt; $fields{$field}{&#39;value&#39;}&#41;;
+            $self-&gt;SetField&#40;
+                &#39;name&#39;  =&gt; $fields{$field}{&#39;name&#39;}, 
+                &#39;value&#39; =&gt; $fields{$field}{&#39;value&#39;},
+                &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+                &#39;target&#39; =&gt; $args{&#39;target&#39;}
+                &#41;;
 	}
     }
+
     # use click instead of submit
-    $self-&gt;Click&#40;name =&gt; $args{name}, 
-		  button_name =&gt; $args{button_name},
-		  button_value =&gt; $args{button_value},
-		  button_number =&gt; $args{button_number},
+    $self-&gt;Click&#40;
+        &#39;name&#39;          =&gt; $args{&#39;name&#39;}, 
+		&#39;button_name&#39;   =&gt; $args{&#39;button_name&#39;},
+		&#39;button_value&#39;  =&gt; $args{&#39;button_value&#39;},
+		&#39;button_number&#39; =&gt; $args{&#39;button_number&#39;},
+        &#39;frame&#39;         =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39;        =&gt; $args{&#39;target&#39;}
 		  &#41;;
 }
 
@@ -153,9 +190,19 @@
 	&#41;;
 
     if &#40;$args{name}&#41; {
-	$self-&gt;Log&#40;&#34;form_name&#34;, &#34;&#39;$args{name}&#39;&#34;&#41;;
+        $self-&gt;Log&#40;
+            &#39;form_name&#39;, 
+            &#34;&#39;$args{name}&#39;&#34;, 
+            &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+            &#39;target&#39; =&gt; $args{&#39;target&#39;}
+            &#41;;
     } else {
-	$self-&gt;Log&#40;&#34;form_number&#34;, $args{number}&#41;;
+	    $self-&gt;Log&#40;
+            &#39;form_number&#39;, 
+            $args{number}, 
+            &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+            &#39;target&#39; =&gt; $args{&#39;target&#39;}
+            &#41;;
     }
 }
 
@@ -167,13 +214,18 @@
 		@_
 		&#41;;
 
-    return unless $args{name};
+    return unless $args{&#39;name&#39;};
 
     # escape single quotes
-    $args{name} =~ s/&#39;/\\&#39;/g;
-    $args{value} =~ s/&#39;/\\&#39;/g if $args{value};
+    $args{&#39;name&#39;} =~ s/&#39;/\\&#39;/g;
+    $args{&#39;value&#39;} =~ s/&#39;/\\&#39;/g if $args{&#39;value&#39;};
 
-    $self-&gt;Log&#40;&#34;field&#34;, &#34;&#39;$args{name}&#39;, &#39;&#34; . &#40;$args{value} || &#39;&#39;&#41; . &#34;&#39;&#34;&#41;;
+    $self-&gt;Log&#40;
+        &#39;field&#39;, 
+        &#34;&#39;$args{name}&#39;, &#39;&#34; . &#40;$args{value} || &#39;&#39;&#41; . &#34;&#39;&#34;,
+        &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39; =&gt; $args{&#39;target&#39;}
+        &#41;;
 }
 
 sub Check {
@@ -190,7 +242,12 @@
     $args{name} =~ s/&#39;/\\&#39;/g;
     $args{value} =~ s/&#39;/\\&#39;/g;
 
-    $self-&gt;Log&#40;&#34;tick&#34;, &#34;&#39;$args{name}&#39;, &#39;$args{value}&#39;&#34;&#41;;
+    $self-&gt;Log&#40;
+        &#39;tick&#39;, 
+        &#34;&#39;$args{name}&#39;, &#39;$args{value}&#39;&#34;,
+        &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39; =&gt; $args{&#39;target&#39;}
+        &#41;;
 }
 
 sub UnCheck {
@@ -207,7 +264,12 @@
     $args{name} =~ s/&#39;/\\&#39;/g;
     $args{value} =~ s/&#39;/\\&#39;/g;
 
-    $self-&gt;Log&#40;&#34;untick&#34;, &#34;&#39;$args{name}&#39;, &#39;$args{value}&#39;&#34;&#41;;
+    $self-&gt;Log&#40;
+        &#39;untick&#39;, 
+        &#34;&#39;$args{name}&#39;, &#39;$args{value}&#39;&#34;,
+        &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39; =&gt; $args{&#39;target&#39;}
+        &#41;;
 }
 
 sub Submit {
@@ -232,7 +294,12 @@
     # TODO: also support button value, number
     # Don&#39;t add this until WWW::Mechanize supports it
 
-    $self-&gt;Log&#40;&#34;submit_form&#34;, $submitargs&#41;;
+    $self-&gt;Log&#40;
+        &#39;submit_form&#39;, 
+        $submitargs,
+        &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39; =&gt; $args{&#39;target&#39;}
+        &#41;;
 }
 
 sub Click {
@@ -248,7 +315,12 @@
 
     # TODO: also support button value, number
     # Don&#39;t add this until WWW::Mechanize supports it
-    $self-&gt;Log&#40;&#34;click&#34;, $clickargs&#41;;
+    $self-&gt;Log&#40;
+        &#39;click&#39;, 
+        $clickargs,
+        &#39;frame&#39; =&gt; $args{&#39;frame&#39;},
+        &#39;target&#39; =&gt; $args{&#39;target&#39;}
+        &#41;;
 }
 
 1;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/211639/82994/Recorder.diff">Download Recorder.diff</a><br />
<span class="downloadcontenttype">text/x-diff 9.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- HTTP/Recorder.pm	2006-01-08 14:35:01.000000000 -0600
+++ ../for_diff/HTTP/Recorder.pm	2006-06-21 13:24:55.000000000 -0500
@@ -182,6 +182,7 @@
     my $request = shift;
 
     my $response;
+    my $frame_name;
 
     # make a HTTP::Recorder::Request object
     my $newrequest = HTTP::Recorder::Request-&gt;new&#40;request =&gt; $request,
@@ -232,6 +233,18 @@
     } else {
 	my $values = $newrequest-&gt;get_params;
 	my $action = $values-&gt;{&#34;$self-&gt;{prefix}-action&#34;};
+
+        # try to get the frame name if target exists, then
+        # that&#39;s our frame name, if not try to use rec-frame
+        # that we have inserted previously.
+        #
+        $frame_name = $values-&gt;{&#34;$self-&gt;{&#39;prefix&#39;}-target&#34;} 
+                || $values-&gt;{&#34;$self-&gt;{&#39;prefix&#39;}-frame&#34;};
+        if &#40;$frame_name&#41; {
+            # remove the prefix
+            $frame_name =~ s/^$self-&gt;{&#39;prefix&#39;}//;
+        }
+
 	if &#40; $self-&gt;{ignore_favicon} &#38;&#38; 
 	     $newrequest-&gt;uri-&gt;path =~ /favicon\.ico$/i&#41; {
 	    # don&#39;t do anything
@@ -268,7 +281,7 @@
 
 	# don&#39;t try to modify the content unless it&#39;s text/html
 	if &#40;$content_type =~ m#^text/html#i&#41; {
-	    $self-&gt;modify_response&#40;$response&#41;;
+            $self-&gt;modify_response&#40;$response,$frame_name&#41;;
 	}
     }
 
@@ -284,9 +297,15 @@
 
     # log the actions
     if &#40;$action eq &#34;follow&#34;&#41; {
-	$self-&gt;{logger}-&gt;FollowLink&#40;text =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-text&#34;} || &#34;&#34;,
-			    index =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-index&#34;} || &#34;&#34;,
-			    url =&gt; uri_unescape&#40;$values-&gt;{&#34;$self-&gt;{prefix}-url&#34;}&#41;&#41;;
+
+        $self-&gt;{logger}-&gt;FollowLink&#40;
+            &#39;text&#39;      =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-text&#34;} || &#39;&#39;,
+            &#39;index&#39;     =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-index&#34;} || &#39;&#39;,
+            &#39;url&#39;       =&gt; uri_unescape&#40;$values-&gt;{&#34;$self-&gt;{prefix}-url&#34;}&#41;,
+            &#39;target&#39;    =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-target&#34;} || &#39;&#39;,
+            &#39;frame&#39;     =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-frame&#34;} || &#39;&#39; 
+            &#41;;
+
     } elsif &#40;$action eq &#34;submitform&#34;&#41; {
 	my %fields;
 	my &#40;$btn_name, $btn_value, $btn_number&#41;;
@@ -321,11 +345,15 @@
 	    }
 	}
 
-	$self-&gt;{logger}-&gt;SetFieldsAndSubmit&#40;name =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-formname&#34;}, 
-					    number =&gt; $values-&gt;{&#34;$self-&gt;{prefix}-formnumber&#34;},
-					    fields =&gt; \%fields,
-					    button_name =&gt; $btn_name,
-					    button_value =&gt; $btn_value&#41;;
+        $self-&gt;{logger}-&gt;SetFieldsAndSubmit&#40;
+                            &#39;name&#39;          =&gt; $values-&gt;{&#34;$self-&gt;{&#39;prefix&#39;}-formname&#34;}, 
+                            &#39;number&#39;        =&gt; $values-&gt;{&#34;$self-&gt;{&#39;prefix&#39;}-formnumber&#34;},
+                            &#39;fields&#39;        =&gt; \%fields,
+                            &#39;button_name&#39;   =&gt; $btn_name,
+                            &#39;button_value&#39;  =&gt; $btn_value,
+                            &#39;frame&#39;         =&gt; $values-&gt;{&#34;$self-&gt;{&#39;prefix&#39;}-frame&#34;},
+                            &#39;target&#39;        =&gt; $values-&gt;{&#34;$self-&gt;{&#39;prefix&#39;}-target&#34;}
+                            &#41;;
 
 	# log a blank line to give the code a little breathing room
 	$self-&gt;{logger}-&gt;LogLine&#40;&#41;;
@@ -336,6 +364,12 @@
 sub modify_response {
     my $self = shift;
     my $response = shift;
+
+    # we&#39;ll use this to tag links/forms on this page, so that we
+    # can figure out which frame is issuing the request later.
+    #
+    my $frame_name = shift;
+
     my $formcount = 0;
     my $formnumber = 0;
     my $linknumber = 1;
@@ -392,22 +427,36 @@
 		if &#40;$attrs-&gt;{&#39;href&#39;} =~ m/^javascript:/i&#41; {
 		    $js_href = 1;
 		} else {
+                    my $target = $attrs-&gt;{&#39;target&#39;};
 		    if &#40;$tagname eq &#39;a&#39;&#41; {
-			$attrs-&gt;{&#39;href&#39;} = 
-			    $self-&gt;rewrite_href&#40;$attrs-&gt;{&#39;href&#39;}, 
-						$text, 
-						$index,
-						$response-&gt;base&#41;;
+                        $attrs-&gt;{&#39;href&#39;} = $self-&gt;rewrite_href&#40;
+                            { &#39;href&#39;    =&gt; $attrs-&gt;{&#39;href&#39;}, 
+                            &#39;text&#39;    =&gt; $text, 
+                            &#39;index&#39;   =&gt; $index,
+                            &#39;base&#39;    =&gt; $response-&gt;base,
+                            &#39;target&#39;  =&gt; $target,
+                            &#39;frame&#39;   =&gt; $frame_name,
+                            }
+                        &#41;;
+
 		    } elsif &#40;$tagname eq &#39;area&#39;&#41; {
-			$attrs-&gt;{&#39;href&#39;} = 
-			    $self-&gt;rewrite_href&#40;$attrs-&gt;{&#39;href&#39;}, 
-						&#39;&#39;, 
-						$index,
-						$response-&gt;base&#41;;
+                        $attrs-&gt;{&#39;href&#39;} = $self-&gt;rewrite_href&#40;
+                            { &#39;href&#39;    =&gt; $attrs-&gt;{&#39;href&#39;}, 
+                            &#39;text&#39;    =&gt; &#39;&#39;, 
+                            &#39;index&#39;   =&gt; $index,
+                            &#39;base&#39;    =&gt; $response-&gt;base,
+                            &#39;target&#39;  =&gt; $target,
+                            &#39;frame&#39;   =&gt; $frame_name,
+                            }
+                        &#41;;
 		    } elsif &#40;$tagname eq &#39;link&#39;&#41; {
-			$attrs-&gt;{&#39;href&#39;} = 
-			    $self-&gt;rewrite_linkhref&#40;$attrs-&gt;{&#39;href&#39;}, 
-						    $response-&gt;base&#41;;
+                        $attrs-&gt;{&#39;href&#39;} = $self-&gt;rewrite_linkhref&#40;
+                            { &#39;href&#39;    =&gt; $attrs-&gt;{&#39;href&#39;}, 
+                            &#39;base&#39;    =&gt; $response-&gt;base,
+                            &#39;target&#39;  =&gt; $target,
+                            &#39;frame&#39;   =&gt; $frame_name,
+                            }
+                        &#41;;
 		    }
 		}
 		$linknumber++;
@@ -427,7 +476,7 @@
 		    $fieldname = $attrs-&gt;{name};
 		    $formfield = &#40;$fieldprefix . &#39;-&#39; . 
 				  $fieldtype . &#39;-&#39; . $fieldname&#41;;
-		    $newcontent .= &#34;&lt;input type=\&#34;hidden\&#34; name=\&#34;$formfield\&#34; value=1&gt;\n&#34;;
+                    $newcontent .= &#34;&lt;input type=\&#34;hidden\&#34; name=\&#34;$formfield\&#34; value=1&gt;&#34;;
 		}
 	    }
 
@@ -441,12 +490,18 @@
 		# - it&#39;s not a hidden field
 		$newcontent .= &#40;&#34; &#34;.$attr.&#34;=\&#34;&#34;.$attrs-&gt;{$attr}.&#34;\&#34;&#34;&#41;;
 	    }
-	    $newcontent .= &#40;&#34;&gt;\n&#34;&#41;;
+            $newcontent .= &#40;&#34;&gt;&#34;&#41;;
 	    if &#40;$tagname eq &#39;form&#39;&#41; {
 		if &#40;$formcount == 1&#41; {
-		    $newcontent .= $self-&gt;rewrite_form_content&#40;$attrs-&gt;{name} || &#34;&#34;,
-							       $formnumber,
-							       $response-&gt;base&#41;;
+                    $newcontent .= $self-&gt;rewrite_form_content&#40;
+                        {
+                            &#39;name&#39;      =&gt; $attrs-&gt;{&#39;name&#39;} || &#39;&#39;,
+                            &#39;number&#39;    =&gt; $formnumber,
+                            &#39;url&#39;       =&gt; $response-&gt;base,
+                            &#39;frame&#39;     =&gt; $frame_name,
+                            &#39;target&#39;    =&gt; $attrs-&gt;{&#39;target&#39;} || &#39;&#39;,
+                        }
+                    &#41;;
 		}
 	    }
 	} elsif &#40;@$token[0] eq &#39;E&#39;&#41; {
@@ -455,13 +510,13 @@
 		if &#40;!$basehref&#41; {
 		    $basehref = $response-&gt;base;
 		    $basehref-&gt;scheme&#40;&#39;http&#39;&#41; if $basehref-&gt;scheme eq &#39;https&#39;;
-		    $newcontent .= &#34;&lt;base href=\&#34;&#34; . $basehref . &#34;\&#34;&gt;\n&#34;;
+                    $newcontent .= &#34;&lt;base href=\&#34;&#34; . $basehref . &#34;\&#34;&gt;&#34;;
 		}
 		$basehref = &#34;&#34;;
 		$in_head = 0;
 	    }
 	    $newcontent .= &#40;&#34;&lt;/&#34;&#41;;
-	    $newcontent .= &#40;$tagname.&#34;&gt;\n&#34;&#41;;
+            $newcontent .= &#40;$tagname.&#34;&gt;&#34;&#41;;
 	    if &#40;$tagname eq &#39;form&#39;&#41; {
 		$formcount--;
 	    } elsif &#40;$tagname eq &#39;a&#39; || $tagname eq &#39;link&#39;&#41; {
@@ -480,11 +535,14 @@
 }
 
 sub rewrite_href {
-    my $self = shift;
-    my $href = shift || &#34;&#34;;
-    my $text = shift || &#34;&#34;;
-    my $index = shift || 1;
-    my $base = shift;
+    my &#40;$self, $arg_ref&#41; = @_;
+
+    my $href   = $arg_ref-&gt;{&#39;href&#39;} || &#39;&#39;;
+    my $text   = $arg_ref-&gt;{&#39;text&#39;} || &#39;&#39;;
+    my $index  = $arg_ref-&gt;{&#39;index&#39;} || 1;
+    my $base   = $arg_ref-&gt;{&#39;base&#39;};
+    my $target = $arg_ref-&gt;{&#39;target&#39;};
+    my $frame  = $arg_ref-&gt;{&#39;frame&#39;};
 
     my $newhref = new URI&#40;$href&#41;;
     my $prefix = $self-&gt;{prefix};
@@ -505,13 +563,23 @@
     $newhref-&gt;query_param_append&#40; &#34;$prefix-text&#34;, $text&#41;;
     $newhref-&gt;query_param_append&#40; &#34;$prefix-index&#34;, $index&#41;;
 
+    if &#40;$target&#41; {
+        $newhref-&gt;query_param_append&#40; &#34;$prefix-target&#34;, $target&#41;;
+    }
+    if &#40;$frame&#41; {
+        $newhref-&gt;query_param_append&#40; &#34;$prefix-frame&#34;, $frame&#41;;
+    }
+
     return $newhref;
 }
 
 sub rewrite_linkhref {
-    my $self = shift;
-    my $href = shift || &#34;&#34;;
-    my $base = shift;
+    my &#40;$self, $arg_ref&#41; = @_;
+
+    my $href    = $arg_ref-&gt;{&#39;href&#39;} || &#39;&#39;;
+    my $base    = $arg_ref-&gt;{&#39;base&#39;};
+    my $target  = $arg_ref-&gt;{&#39;target&#39;};
+    my $frame   = $arg_ref-&gt;{&#39;frame&#39;};
 
     my $newhref = new URI&#40;$href&#41;;
     my $prefix = $self-&gt;{prefix};
@@ -525,23 +593,41 @@
     # the action &#40;i.e. don&#39;t record&#41;
     $newhref-&gt;query_param_append&#40; &#34;$prefix-action&#34;, &#39;norecord&#39;&#41;;
 
+    if &#40;$target&#41; {
+        $newhref-&gt;query_param_append&#40; &#34;$prefix-target&#34;, $target&#41;;
+    }
+    if &#40;$frame&#41; {
+        $newhref-&gt;query_param_append&#40; &#34;$prefix-frame&#34;, $frame&#41;;
+    }
+
     return $newhref;
 }
 
 sub rewrite_form_content {
-    my $self = shift;
-    my $name = shift || &#34;&#34;;
-    my $number = shift;
-    my $url = shift;
+    my &#40;$self, $arg_ref&#41; = @_;
+
+    my $name    = $arg_ref-&gt;{&#39;name&#39;} || &#39;&#39;;
+    my $number  = $arg_ref-&gt;{&#39;number&#39;} ;
+    my $url     = $arg_ref-&gt;{&#39;url&#39;} ;
+    my $frame   = $arg_ref-&gt;{&#39;frame&#39;};
+    my $target  = $arg_ref-&gt;{&#39;target&#39;};
+
     my $fields;
 
     my $https = 1 if &#40;$url-&gt;scheme eq &#39;https&#39;&#41;;
 
-    $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-action\&#34; value=\&#34;submitform\&#34;&gt;\n&#34;&#41;;
-    $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-formname\&#34; value=\&#34;$name\&#34;&gt;\n&#34;&#41;;
-    $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-formnumber\&#34; value=\&#34;$number\&#34;&gt;\n&#34;&#41;;
+    $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-action\&#34; value=\&#34;submitform\&#34;&gt;&#34;&#41;;
+    $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-formname\&#34; value=\&#34;$name\&#34;&gt;&#34;&#41;;
+    $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-formnumber\&#34; value=\&#34;$number\&#34;&gt;&#34;&#41;;
+
+    if &#40;$frame&#41; {
+        $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-frame\&#34; value=\&#34;$frame\&#34;&gt;&#34;&#41;;
+    }
+    if &#40;$target&#41; {
+        $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-target\&#34; value=\&#34;$target\&#34;&gt;&#34;&#41;;
+    }
     if &#40;$https&#41; {
-	$fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-https\&#34; value=\&#34;$https\&#34;&gt;\n&#34;&#41;;
+	    $fields .= &#40;&#34;&lt;input type=hidden name=\&#34;$self-&gt;{prefix}-https\&#34; value=\&#34;$https\&#34;&gt;&#34;&#41;;
     }
 
     return $fields;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/211639/82997/CustomHTTPRecorder.pm">Download CustomHTTPRecorder.pm</a><br />
<span class="downloadcontenttype">text/x-perl 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package CustomHTTPRecorder;
use strict;
use warnings;
use version; our $VERSION = qv&#40;&#39;0.0.1&#39;&#41;;
use HTTP::Recorder;
use Data::Dumper;
use HTML::TreeBuilder;
use base qw&#40;HTTP::Recorder&#41;;

sub new {
    my $class = shift;
    my $self = $class-&gt;SUPER::new&#40;@_&#41;;
    bless $self, $class;

    $self-&gt;{&#39;frames&#39;} = {};

    return $self;
}

sub modify_response {
    my $self = shift;
    my $response = shift;
    my $frame_name = shift || &#39;&#39;;

    #
    # check the response if it has frames in it.
    #
    if &#40;    $response-&gt;is_success&#40;&#41; 
        &#38;&#38;  $response-&gt;content&#40;&#41; =~ /html/&#41; {

        my $tree = HTML::TreeBuilder-&gt;new&#40;&#41;;
        $tree-&gt;parse&#40;$response-&gt;content&#40;&#41;&#41;;
        $tree-&gt;eof&#40;&#41;;
        $tree-&gt;elementify&#40;&#41;;

        # Record these frames
        #
        my @frames = $tree-&gt;look_down&#40;&#39;_tag&#39;,&#39;frame&#39;&#41;;
        if &#40;scalar @frames &gt; 0&#41; {
            foreach my $frame &#40;@frames&#41; {
                my $name = $frame-&gt;attr&#40;&#39;name&#39;&#41;;
                my $src  = $frame-&gt;attr&#40;&#39;src&#39;&#41;;

                # check if the src is absolute or relative
                if &#40;$src =~ m{ \A / }xms &#41; {
                    # prepend the base url to this.
                    #
                    my $req = $response-&gt;request&#40;&#41;;
                    if &#40;$req&#41; {
                        my $uri = $req-&gt;uri&#40;&#41;;
                        if &#40;$uri !~ m{ \A / } &#41; {

                            # remove excess &#39;/&#39;
                            $uri =~ s/\/$//;
                            $src =~ s/^\///;

                            $src = $uri . &#39;/&#39; . $src;
                        }
                    }
                }
                $self-&gt;{&#39;frames&#39;}-&gt;{$src} = $name;
            }
        }
    }

    if &#40;!$frame_name&#41; {
        #
        # Check if the request for this response corresponds
        # to any frames recorded before.
        #
        my $req = $response-&gt;request&#40;&#41;;
        if &#40;$req &#38;&#38; $req-&gt;uri&#40;&#41;&#41; {
            my $uri = $req-&gt;uri&#40;&#41;;
            foreach my $frame_uri &#40;keys %{ $self-&gt;{&#39;frames&#39;} }&#41; {
                if &#40;$frame_uri eq $uri&#41; {
                    $frame_name = $self-&gt;{&#39;frames&#39;}-&gt;{$frame_uri};

                    # to prevent accidental matches against this frame url
                    # in subsequent requests &#40;which can actually call the frame
                    # url later&#41; delete this frame record.
                    #
                    delete $self-&gt;{&#39;frames&#39;}-&gt;{$frame_uri};
                }
            }
        }
    }

    $self-&gt;SUPER::modify_response&#40;$response,$frame_name&#41;;
    $self-&gt;{&#39;logger&#39;}-&gt;LogContent&#40;$response-&gt;content&#40;&#41;,$frame_name&#41;;
    return ;
}
1;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/211639/83000/CustomHTTPRecorderLogger.pm">Download CustomHTTPRecorderLogger.pm</a><br />
<span class="downloadcontenttype">text/x-perl 5.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package CustomHTTPRecorderLogger;
use strict;
use warnings;
use version; our $VERSION = qv&#40;&#39;0.0.1&#39;&#41;;
use Carp;
use HTML::TreeBuilder;
use HTTP::Recorder::Logger;
our @ISA = qw&#40; HTTP::Recorder::Logger&#41;;

################################################################
# This is the modified version of the original SUPER::LogContent
# It outputs 2 perl lines; a string variable containing the
# HTML text, and the regex test line to check the contents.
################################################################
sub LogContent {
    my $self        = shift;
    my $content     = shift;
    my $frame_name  = shift;
    my $content_txt;

    my $scriptfile = $self-&gt;{&#39;file&#39;};
    open my $fh, &#39;&gt;&gt;&#39;, $scriptfile 
        || croak &#34;Failed to append to $scriptfile: $!&#34;;

    # parse the content, and strip the HTML tags,
    # to convert it to TEXT
    #
    # this sucks. Clean this up. There should be a better
    # way to check if content is HTML
    if &#40;$content =~ /html/&#41; {
        my $tree = HTML::TreeBuilder-&gt;new&#40;&#41;;
        $tree-&gt;parse&#40;$content&#41;;
        $tree-&gt;eof&#40;&#41;;
        $tree-&gt;elementify&#40;&#41;; 

        # find frame src, name and id
        #
        my @frames = $tree-&gt;look_down&#40;&#39;_tag&#39;,&#39;frame&#39;&#41;;
        if &#40;scalar @frames &gt; 0&#41; {

            print {$fh} &#34;\n#---------------------------------\n&#34;;
            print {$fh} &#34;# Detected Frames:\n&#34;;
            foreach my $frame &#40;@frames&#41; {
                my $name    = $frame-&gt;attr&#40;&#39;name&#39;&#41;;
                print {$fh} &#34;#frame_name = $name\n&#34;;
            }
            print {$fh} &#34;#---------------------------------\n&#34;;
        }
        else {
            $content_txt = $tree-&gt;as_text&#40;&#41;;
        }
        $tree-&gt;delete;

        if &#40;$content_txt&#41; {

            print {$fh} &#34;\n#-------------------------------------\n&#34;;
            print {$fh} qq{\$match = &#34;$content_txt&#34;;\n};
            print {$fh} &#34;\n&#34;;

            if &#40;$frame_name&#41; {
                print {$fh} &#34;ok&#40;\$agent_hash_ref-&gt;{&#39;&#34;
                            .$frame_name
                            .&#34;&#39;}-&gt;get_content&#40;&#41; =~ m/\$match/ms,\n&#34;;
            }
            else {
                print {$fh} &#34;ok&#40;\$agent-&gt;get_content&#40;&#41; =~ m/\$match/ms,\n&#34;;
            }

            print {$fh} &#34;   \&#39;checking if HTML response is ok\&#39;&#41;;\n&#34;;
            print {$fh} &#34;#-------------------------------------\n&#34;;
        }
    }    

    close $fh 
        || croak &#34;Failed to close $scriptfile: $!&#34;;

}

################################################################
# Append the line to the logfile
################################################################
sub _append_log {
    my &#40;$self, $line&#41; = @_;

    my $scriptfile = $self-&gt;{&#39;file&#39;};
    open my $fh, &#39;&gt;&gt;&#39;,$scriptfile 
        || croak &#34;Failed to append to $scriptfile: $!&#34;;
    print {$fh} $line;
    close $fh
        || croak &#34;Failed to close $scriptfile: $!&#34;;
}

################################################################
# Modified version of SUPER::Log. Calls LogMore
################################################################
sub Log {
    my $self = shift;
    my $function = shift;
    my $args = shift || &#39;&#39;;
    my %remaining_args = &#40;@_&#41;;
    $self-&gt;LogMore&#40;
        {
            &#39;function&#39;  =&gt; $function,
            &#39;args&#39;      =&gt; $args,
            &#39;frame&#39;     =&gt; $remaining_args{&#39;frame&#39;},
            &#39;target&#39;    =&gt; $remaining_args{&#39;target&#39;},
        }
    &#41;;
}

################################################################
# Modified version of SUPER::Log. Encloses the output in a ok&#40;&#41;
# call for Test::More and handles frames and target attributes.
#
################################################################
sub LogMore {
    my &#40;$self, $arg_ref&#41; = @_;
    my $function    = $arg_ref-&gt;{&#39;function&#39;};
    my $args        = $arg_ref-&gt;{&#39;args&#39;} || &#39;&#39;;

    # Note the target/frame magic here. Basically, if the results
    # of the action will be displayed on a specific frame &#40;target 
    # HTML attribute&#41;, then we use &#39;target&#39;, but if there&#39;s no
    # target, then we check if we know which frame we are in 
    # using &#39;frame&#39; argument.
    #
    my $frame       = $arg_ref-&gt;{&#39;target&#39;} || $arg_ref-&gt;{&#39;frame&#39;} || &#39;&#39;;

    return unless $function;
    my $line;
    if &#40;$frame&#41; {
        $line = 
            &#34;ok&#40;\$agent_hash_ref&#34;
            . q/-&gt;{&#39;/
            . $frame
            . q/&#39;}/
            . &#34;-&gt;${function}&#40;${args}&#41;,\n    \&#39;Check ${function}\&#39;&#41;;\n&#34;;
    }
    else {
        $line = 
            &#34;ok&#40;\$agent-&gt;${function}&#40;${args}&#41;,\n    \&#39;Check ${function}\&#39;&#41;;\n&#34;;
    }

    $self-&gt;_append_log&#40;$line&#41;;
}
################################################################
# A modified version of SUPER::FollowLink subroutine.
# HTTP::Recorder messes up the ordering of links. To fix this,
# We should use explicit &#34;url=&gt;&#34; argument in follow_links&#40;&#41; instead of 
# &#34;text=&gt;&#34; or &#34;n=&gt;&#34; .
################################################################
sub FollowLink {
    my $self = shift;
    my %args = &#40; @_&#41;;

    my $function;
    my $function_args;

    # we must translate this into &#39;get&#39; if target is defined. If target
    # is defined, then this actually means a get in another frame.
    #
    if &#40;$args{&#39;target&#39;}&#41; {
        $function       = &#39;get&#39;;
        $function_args  = &#34;\&#39;$args{&#39;url&#39;}\&#39;&#34;;
    }
    else {
        $function       = &#39;follow_link&#39;;
        $function_args  = &#34;&#39;url&#39; =&gt; \&#39;$args{&#39;url&#39;}\&#39;&#34;;
    }

    $self-&gt;LogMore&#40;
        { 
            &#39;function&#39;    =&gt; $function,
            &#39;args&#39;        =&gt; $function_args,
            &#39;frame&#39;       =&gt; $args{&#39;frame&#39;},
            &#39;target&#39;      =&gt; $args{&#39;target&#39;},
        }
    &#41;;
}
1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-211640" href="/Public/Bug/Display.html?id=20030#txn-211640">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;21&nbsp;15:24:18&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.435592</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
