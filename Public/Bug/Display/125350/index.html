<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #125350 for Mail-Message: dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #125350 for Mail-Message: dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Mail-Message">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Mail-Message">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Mail-Message">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Mail-Message">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-Message">Mail-Message CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">125350</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Mail-Message">Mail-Message</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gary [...] intrepid.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-267174-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-267175-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=125350">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786968" href="/Public/Bug/Display.html?id=125350#txn-1786968">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;19&nbsp;16:31:23&nbsp;2018</span>
    <span class="description">gary [...] intrepid.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 May 2018 13:31:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Message [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gary Funck &lt;gary [...] intrepid.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786968/961166/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961166">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 644b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Mail::Message::Body
VERSION: 3.006

This code,

251     my $dir      = shift;
252     my $filename = &#39;&#39;;
253     if&#40;defined $base&#41;
254     {   $filename = basename $base;
255         $filename =~ s/[^\w.-]//;
256     }

The purpose of the string substitution is unclear.  It looks like it may
want to remove all non-word, or &#34;.&#34; and &#34;-&#34; characters, but is missing a
s///g.  Instead, it just removes the first match.

That said, it isn&#39;t clear to me that dispositionFilename&#40;&#41; should modify
the filename in this way.  The documentation doesn&#39;t seem to indicate that
it does this.   In my case, I&#39;d like the original filename, unaltered.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786968/961167/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961167">with headers</a>
<br />
<span class="downloadcontenttype">text/html 926b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787122" href="/Public/Bug/Display.html?id=125350#txn-1787122">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;03:42:00&nbsp;2018</span>
    <span class="description">mark [...] nluug.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125350] dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 May 2018 09:34:50 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gary Funck via RT &lt;bug-Mail-Message [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] nluug.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787122/961261/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961261">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gary Funck via RT &#40;bug-Mail-Message@rt.cpan.org&#41; [180519 20:31]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sat May 19 16:31:23 2018: Request 125350 was acted upon.
&gt; Transaction: Ticket created by gary@intrepid.com
&gt;        Queue: Mail-Message
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt; 
&gt; package Mail::Message::Body
&gt; VERSION: 3.006
&gt; 
&gt; 255         $filename =~ s/[^\w.-]//;
&gt; 
&gt; The purpose of the string substitution is unclear.  It looks like it may
&gt; want to remove all non-word, or &#34;.&#34; and &#34;-&#34; characters, but is missing a
&gt; s///g.  Instead, it just removes the first match.
</div>
Yes, it should have a &#39;g&#39;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That said, it isn&#39;t clear to me that dispositionFilename&#40;&#41; should modify
&gt; the filename in this way.  The documentation doesn&#39;t seem to indicate that
&gt; it does this.   In my case, I&#39;d like the original filename, unaltered.
</div>
Read <span class="clickylink"><a target="new" rel="nofollow" href="https://tools.ietf.org/html/rfc6266#section-4.3">https://tools.ietf.org/html/rfc6266#section-4.3</a></span>

MailBox is usually for automatic processing, so there is no-one to
check whether there resulting filename is harmless... I choose to be
very careful.

I would consider accepting blanks:

    for&#40;$filename&#41; {
                s/\s+/ /g; s/ $//; s/^ //;
        s/[^\w .-]//g;
    }

Are there other characters you like to see passed, safe on any OS?
-- 
greetz,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787128" href="/Public/Bug/Display.html?id=125350#txn-1787128">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;03:42:01&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787178" href="/Public/Bug/Display.html?id=125350#txn-1787178">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;11:42:47&nbsp;2018</span>
    <span class="description">gary [...] intrepid.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125350] dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 May 2018 08:42:30 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Message [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gary Funck &lt;gary [...] intrepid.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787178/961282/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961282">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, May 20, 2018 at 12:42 AM, Mark Overmeer via RT &lt;
bug-Mail-Message@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt;
&gt; * Gary Funck via RT &#40;bug-Mail-Message@rt.cpan.org&#41; [180519 20:31]:
<div class="message-stanza open">&gt; &gt; Sat May 19 16:31:23 2018: Request 125350 was acted upon.
&gt; &gt;
&gt; &gt; 255         $filename =~ s/[^\w.-]//;
&gt; &gt;
&gt; &gt; The purpose of the string substitution is unclear.  It looks like it may
&gt; &gt; want to remove all non-word, or &#34;.&#34; and &#34;-&#34; characters, but is missing a
&gt; &gt; s///g.  Instead, it just removes the first match.
</div>&gt;
&gt; Yes, it should have a &#39;g&#39;
&gt;
<div class="message-stanza open">&gt; &gt; That said, it isn&#39;t clear to me that dispositionFilename&#40;&#41; should modify
&gt; &gt; the filename in this way.  The documentation doesn&#39;t seem to indicate
</div>&gt; that
<div class="message-stanza open">&gt; &gt; it does this.   In my case, I&#39;d like the original filename, unaltered.
</div>&gt;
&gt; Read <span class="clickylink"><a target="new" rel="nofollow" href="https://tools.ietf.org/html/rfc6266#section-4.3">https://tools.ietf.org/html/rfc6266#section-4.3</a></span>
&gt;
&gt; MailBox is usually for automatic processing, so there is no-one to
&gt; check whether there resulting filename is harmless... I choose to be
&gt; very careful.
&gt;
&gt; I would consider accepting blanks:
&gt;
&gt;     for&#40;$filename&#41; {
&gt;                 s/\s+/ /g; s/ $//; s/^ //;
&gt;         s/[^\w .-]//g;
&gt;     }
&gt;
&gt; Are there other characters you like to see passed, safe on any OS?
&gt;
</div>
Greetz, I hope the last decade/two since we last corresponded have treated
you well. :&#41;

Thanks for the RFC reference.  I see how/why caution is advised when
writing the attachment.  However, in my case, [- .] are innocuous and I&#39;d
like them back; I want the raw filename, but wouldn&#39;t mind some
documentation that tells me how/why I should be careful, or even having the
filtering as default.

For reference, here is the current documentation.

       $obj-&gt;dispositionFilename&#40; [$directory] &#41;
           Returns the name which can be used as filename to store the
           information in the indicated $directory. To get a filename,
various
           fields are searched for &#34;filename&#34; and &#34;name&#34; attributes.
Without
           $directory, the name found will be returned.

           Only the basename of the found name will be used, for security
           reasons: otherwise, it may be possible to access other
directories
           than the one indicated.  If no name was found, or the name is
           already in use, then an unique name is generated.


Can we have dispositionFilenameRaw&#40;&#41;, or dispositionFilename&#40;raw =&gt; 1&#41;, or
a cleanup function callout?  Barring that - break out the cleanup into its
own sub that can be overridden by the user &#40;via the symbol table&#41;?

Regarding your suggested change:

for&#40;$filename&#41; {
        s/\s+/ /g; s/ $//; s/^ //;
        s/[^\w .-]//g;
    }


s/\s+/ /g;   OK
s/ $//;   maybe  s/ +$//;  instead
s/^ //;   maybe  s/^ +//;  instead


Regarding  s/[^\w .-]//g;

Won&#39;t that &#34; &#34; &#40;space&#41; in there undo the previous rewrites into space
characters?  If that is what you&#39;re after, then this will &#40;I think&#41; be an
equivalent pattern, covering all of them.

  s/[\W\s.-]+//g;

BTW, what prevents the current code and the suggested new code from wiping
out the final &#34;.&#34; which delimits the file&#39;s extension?

I don&#39;t recall the current implementation doing that &#40;I have not noticed
issues with extensions being glommed into the filename&#41;, but don&#39;t see why
it doesn&#39;t do that?

Reading the current implementation, it looks like I might already have my
&#39;raw&#39; filename capability.  It seems that this filtering only kicks in *if*
the &#40;optional&#41; directory argument is supplied.  At the moment, I supply
that parameter, but it would be easy enough for me to prepend it upon
return.  If that capability can be left in &#40;and documented&#41; that would meet
my needs.

Regarding the RFC, it seems that filtering extensions would be in keeping
with the theme?  For example,
<span class="clickylink"><a target="new" rel="nofollow" href="https://www.howtogeek.com/137270/50-file-extensions-that-are-potentially-dangerous-on-windows/">https://www.howtogeek.com/137270/50-file-extensions-that-are-potentially-dangerous-on-windows/</a></span>
has a list of dangerous extensions &#40;for Windows/DOS users&#41;.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787178/961283/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961283">with headers</a>
<br />
<span class="downloadcontenttype">text/html 22.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787217" href="/Public/Bug/Display.html?id=125350#txn-1787217">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;14:20:58&nbsp;2018</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125350] dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 May 2018 20:00:42 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gary Funck via RT &lt;bug-Mail-Message [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787217/961304/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961304">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gary Funck via RT &#40;bug-Mail-Message@rt.cpan.org&#41; [180520 15:43]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Message
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt; 
&gt; Greetz, I hope the last decade/two since we last corresponded have treated
&gt; you well. :&#41;
</div>
In all dimensions ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can we have dispositionFilenameRaw&#40;&#41;, or dispositionFilename&#40;raw =&gt; 1&#41;, or
&gt; a cleanup function callout?  Barring that - break out the cleanup into its
&gt; own sub that can be overridden by the user &#40;via the symbol table&#41;?
</div>
When you do not provide a directory, you get the unprocessed name back.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Regarding your suggested change:
&gt; 
&gt; for&#40;$filename&#41; {
&gt;         s/\s+/ /g; s/ $//; s/^ //;
&gt;         s/[^\w .-]//g;
&gt;     }
&gt; 
&gt; s/\s+/ /g;   OK
&gt; s/ $//;   maybe  s/ +$//;  instead
&gt; s/^ //;   maybe  s/^ +//;  instead
</div>
After the first change, there can only be one blank at the beginning and the end.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Regarding  s/[^\w .-]//g;
&gt; 
&gt; Won&#39;t that &#34; &#34; &#40;space&#41; in there undo the previous rewrites into space
&gt; characters?  If that is what you&#39;re after, then this will &#40;I think&#41; be an
&gt; equivalent pattern, covering all of them.
&gt; 
&gt;   s/[\W\s.-]+//g;
</div>
This is very different.  My expression says: do *not* throw away word-chars,
nor blanks, nor dots, nor dashes.  That&#39;s what you want.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BTW, what prevents the current code and the suggested new code from wiping
&gt; out the final &#34;.&#34; which delimits the file&#39;s extension?
</div>
It does not removee dots.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Reading the current implementation, it looks like I might already have my
&gt; &#39;raw&#39; filename capability.  [...]
&gt; If that capability can be left in &#40;and documented&#41; that would meet
&gt; my needs.
</div>
The docs are unclear, I agree:

    Without $directory, the name found will be returned.

I will restructure the docs:

   Various fields are searched for C&lt;filename&gt; and C&lt;name&gt; attributes.  Without
   $directory, the name found will be returned unmodified.

   When a $directory is given, a filename is composed.  For security reasons,
   only the basename of the found name gets used and many potentially
   dangerous characters removed.  If no name was found, or when the found 
   name is already in use, then an unique name is generated.

   Don&#39;t forget to read RFC6266 section 4.3 for the security aspects in your
   email application.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Regarding the RFC, it seems that filtering extensions would be in keeping
&gt; with the theme?  For example,
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://www.howtogeek.com/137270/50-file-extensions-that-are-potentially-dangerous-on-windows/">https://www.howtogeek.com/137270/50-file-extensions-that-are-potentially-dangerous-on-windows/</a></span>
&gt; has a list of dangerous extensions &#40;for Windows/DOS users&#41;.
</div>
I think that handling the contents of the attachment is out-of-scope for
MailBox.  Let&#39;s hope the author of the client know what he is doing ;-&#41;
-- 
Regards,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787223" href="/Public/Bug/Display.html?id=125350#txn-1787223">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;14:32:52&nbsp;2018</span>
    <span class="description">gary [...] intrepid.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125350] dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 May 2018 11:32:38 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Message [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gary Funck &lt;gary [...] intrepid.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787223/961310/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961310">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, May 20, 2018 at 11:20 AM, Mark Overmeer via RT &lt;
bug-Mail-Message@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt;
&gt; * Gary Funck via RT &#40;bug-Mail-Message@rt.cpan.org&#41; [180520 15:43]:
&gt;
&gt;
<div class="message-stanza open">&gt; &gt; Can we have dispositionFilenameRaw&#40;&#41;, or dispositionFilename&#40;raw =&gt; 1&#41;,
</div>&gt; or
<div class="message-stanza open">&gt; &gt; a cleanup function callout?  Barring that - break out the cleanup into
</div>&gt; its
<div class="message-stanza open">&gt; &gt; own sub that can be overridden by the user &#40;via the symbol table&#41;?
</div>&gt;
&gt; When you do not provide a directory, you get the unprocessed name back.
&gt;
<div class="message-stanza open">&gt; &gt; Regarding your suggested change:
&gt; &gt;
&gt; &gt; for&#40;$filename&#41; {
&gt; &gt;         s/\s+/ /g; s/ $//; s/^ //;
&gt; &gt;         s/[^\w .-]//g;
&gt; &gt;     }
&gt; &gt;
&gt; &gt; s/\s+/ /g;   OK
&gt; &gt; s/ $//;   maybe  s/ +$//;  instead
&gt; &gt; s/^ //;   maybe  s/^ +//;  instead
</div>&gt;
&gt; After the first change, there can only be one blank at the beginning and
&gt; the end.
&gt;
<div class="message-stanza open">&gt; &gt; Regarding  s/[^\w .-]//g;
&gt; &gt;
&gt; &gt; Won&#39;t that &#34; &#34; &#40;space&#41; in there undo the previous rewrites into space
&gt; &gt; characters?  If that is what you&#39;re after, then this will &#40;I think&#41; be an
&gt; &gt; equivalent pattern, covering all of them.
&gt; &gt;
&gt; &gt;   s/[\W\s.-]+//g;
</div>&gt;
&gt; This is very different.  My expression says: do *not* throw away
&gt; word-chars,
&gt; nor blanks, nor dots, nor dashes.  That&#39;s what you want.
&gt;
</div>
Yeah, I didn&#39;t read that carefully.  Obviously &#40;now&#41;, the initial ^ applied
to all the characters in that set.
A small comment might help there, for those of us not paying attention in
class.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt; &gt; BTW, what prevents the current code and the suggested new code from
</div>&gt; wiping
<div class="message-stanza open">&gt; &gt; out the final &#34;.&#34; which delimits the file&#39;s extension?
</div>&gt;
&gt; It does not remove dots.
&gt;
</div>
Got it now, thanks.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt; &gt; Reading the current implementation, it looks like I might already have my
&gt; &gt; &#39;raw&#39; filename capability.  [...]
&gt; &gt; If that capability can be left in &#40;and documented&#41; that would meet
&gt; &gt; my needs.
</div>&gt;
&gt; The docs are unclear, I agree:
&gt;
&gt;     Without $directory, the name found will be returned.
&gt;
&gt; I will restructure the docs:
&gt;
&gt;    Various fields are searched for C&lt;filename&gt; and C&lt;name&gt; attributes.
&gt; Without
&gt;    $directory, the name found will be returned unmodified.
&gt;
&gt;    When a $directory is given, a filename is composed.  For security
&gt; reasons,
&gt;    only the basename of the found name gets used and many potentially
&gt;    dangerous characters removed.  If no name was found, or when the found
&gt;    name is already in use, then an unique name is generated.
&gt;
&gt;    Don&#39;t forget to read RFC6266 section 4.3 for the security aspects in
&gt; your
&gt;    email application.
&gt;
</div>
Sounds good, with a hyperlink to the RFC, perhaps.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt; &gt; Regarding the RFC, it seems that filtering extensions would be in keeping
&gt; &gt; with the theme?  For example,
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://www.howtogeek.com/137270/50-file-extensions-">https://www.howtogeek.com/137270/50-file-extensions-</a></span>
</div>&gt; that-are-potentially-dangerous-on-windows/
<div class="message-stanza open">&gt; &gt; has a list of dangerous extensions &#40;for Windows/DOS users&#41;.
</div>&gt;
&gt; I think that handling the contents of the attachment is out-of-scope for
&gt; MailBox.  Let&#39;s hope the author of the client know what he is doing ;-&#41;
&gt;
</div>
Yes, let&#39;s hope.  :&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787223/961311/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961311">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787228" href="/Public/Bug/Display.html?id=125350#txn-1787228">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;15:25:38&nbsp;2018</span>
    <span class="description">gary [...] intrepid.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125350] dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 May 2018 12:25:01 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Message [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gary Funck &lt;gary [...] intrepid.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787228/961314/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961314">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, May 20, 2018 at 11:20 AM, Mark Overmeer via RT &lt;
bug-Mail-Message@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt;
&gt; * Gary Funck via RT &#40;bug-Mail-Message@rt.cpan.org&#41; [180520 15:43]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Message
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
</div>&gt;
<div class="message-stanza open">&gt; &gt; Can we have dispositionFilenameRaw&#40;&#41;, or dispositionFilename&#40;raw =&gt; 1&#41;,
</div>&gt; or
<div class="message-stanza open">&gt; &gt; a cleanup function callout?  Barring that - break out the cleanup into
</div>&gt; its
<div class="message-stanza open">&gt; &gt; own sub that can be overridden by the user &#40;via the symbol table&#41;?
</div>&gt;
&gt; When you do not provide a directory, you get the unprocessed name back.
&gt;
&gt;
</div>Yes, except, we also don&#39;t get a name generated for us if there isn&#39;t one
found in the attachment&#39;s disposition description.

This code is not executed.

unless&#40;length $filename&#41;
    {   my $ext    = &#40;$self-&gt;mimeType-&gt;extensions&#41;[0] || &#39;raw&#39;;
        my $unique;
        for&#40;$unique = &#39;part-0&#39;; 1; $unique++&#41;
        {   my $out = File::Spec-&gt;catfile&#40;$dir, &#34;$unique.$ext&#34;&#41;;
            open IN, &#39;&lt;&#39;, $out or last;  # does not exist: can use it
            close IN;
        }
        $filename = &#34;$unique.$ext&#34;;
    }


I guess that&#39;s OK, just some logic that has to be moved out to the client.


BTW, that &#34;$unique++&#34; above appears to be problematic when applied to
&#39;part-0&#39;?
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787228/961315/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961315">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787252" href="/Public/Bug/Display.html?id=125350#txn-1787252">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;18:40:58&nbsp;2018</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125350] dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 May 2018 00:40:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gary Funck via RT &lt;bug-Mail-Message [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787252/961323/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961323">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 986b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gary Funck via RT &#40;bug-Mail-Message@rt.cpan.org&#41; [180520 19:25]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Message
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt; 
&gt; Yes, except, we also don&#39;t get a name generated for us if there isn&#39;t one
&gt; found in the attachment&#39;s disposition description.
</div>
True, either you want the pure value or the intelligence ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; for&#40;$unique = &#39;part-0&#39;; 1; $unique++&#41;
&gt; BTW, that &#34;$unique++&#34; above appears to be problematic when applied to
&gt; &#39;part-0&#39;?
</div>
Ai, the &#39;-&#39; makes it a non-bareword.  Compare:
   perl -we &#39;$a = &#34;part-0&#34;; print ++$a, &#34;\n&#34;&#39;
   perl -we &#39;$a = &#34;part0&#34;;  print ++$a, &#34;\n&#34;&#39;

I&#39;ll upload the changes to Github
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787255" href="/Public/Bug/Display.html?id=125350#txn-1787255">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;20&nbsp;18:50:45&nbsp;2018</span>
    <span class="description">gary [...] intrepid.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125350] dispositionFilename&#40;&#41; gratuitously removes first non-word character in returned file name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 May 2018 15:50:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Message [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gary Funck &lt;gary [...] intrepid.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787255/961327/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961327">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, May 20, 2018 at 3:40 PM, Mark Overmeer via RT &lt;
bug-Mail-Message@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt;
&gt; * Gary Funck via RT &#40;bug-Mail-Message@rt.cpan.org&#41; [180520 19:25]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Message
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125350">https://rt.cpan.org/Ticket/Display.html?id=125350</a></span> &gt;
&gt; &gt;
&gt; &gt; Yes, except, we also don&#39;t get a name generated for us if there isn&#39;t one
&gt; &gt; found in the attachment&#39;s disposition description.
</div>&gt;
&gt; True, either you want the pure value or the intelligence ;-&#41;
&gt;
</div>
I&#39;m slowly coming around to your new suggested fix.  :&#41;

BTW, if gilding the lily, the code could check the OS variable and use safe
characters for Windows &#40;or cygwin?&#41; or Linux.  If neither of those, then
revert to your current approach.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt; &gt; for&#40;$unique = &#39;part-0&#39;; 1; $unique++&#41;
&gt; &gt; BTW, that &#34;$unique++&#34; above appears to be problematic when applied to
&gt; &gt; &#39;part-0&#39;?
</div>&gt;
&gt; Ai, the &#39;-&#39; makes it a non-bareword.  Compare:
&gt;    perl -we &#39;$a = &#34;part-0&#34;; print ++$a, &#34;\n&#34;&#39;
&gt;    perl -we &#39;$a = &#34;part0&#34;;  print ++$a, &#34;\n&#34;&#39;
&gt;
&gt;
&gt;
</div>Yup.  I didn&#39;t analyze it.  Just tried it out like your first version
&#40;&#39;part-0&#39;&#41; above and it burped.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787255/961328/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961328">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1856875" href="/Public/Bug/Display.html?id=125350#txn-1856875">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;08:51:58&nbsp;2019</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1856875/997475/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/997475">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 23b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Released fixes in 3.007
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1856877" href="/Public/Bug/Display.html?id=125350#txn-1856877">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;08:51:59&nbsp;2019</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.645155</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
