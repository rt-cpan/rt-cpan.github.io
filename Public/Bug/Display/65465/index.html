<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #65465 for Perl-Critic: ProhibitUnusedVariables notice readline &lt;$fh&gt;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #65465 for Perl-Critic: ProhibitUnusedVariables notice readline &lt;$fh&gt;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Perl-Critic">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Perl-Critic">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Perl-Critic">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Perl-Critic">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/Perl-Critic/Perl-Critic/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Critic">Perl-Critic CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">65465</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Perl-Critic">Perl-Critic</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25198-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25199-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




unused-readline.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/892735/462810/unused-readline.diff">
Fri Feb 04 18:06:42 2011 (2.2k) by user42 [...] zip.com.au
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=65465">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-892735" href="/Public/Bug/Display.html?id=65465#txn-892735">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;04&nbsp;18:06:42&nbsp;2011</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ProhibitUnusedVariables notice readline &lt;$fh&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 05 Feb 2011 10:06:34 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/892735/462809/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/462809">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 490b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">ProhibitUnusedVariables doesn&#39;t seem to know that a readline style
&lt;$foo&gt; is a use of the variable $foo.  I get some joy from the change
below.

I struck this in the second .run addition,

    open &#40;my $foo, &#39;&lt;&#39;, &#39;/etc/motd&#39;&#41; or die;
    my $line = &lt;$foo&gt;;

I suppose it might also recognise that open&#40;my $foo, ...&#41; initializes
$foo by side-effect, if the intention of the policy is to pick up only
vars which are both uninitialized and then unused.  Dunno if that would
be a bit tricky.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/892735/462810/unused-readline.diff">Download unused-readline.diff</a><br />
<span class="downloadcontenttype">text/x-diff 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: lib/Perl/Critic/Policy/Variables/ProhibitUnusedVariables.pm
===================================================================
--- lib/Perl/Critic/Policy/Variables/ProhibitUnusedVariables.pm	&#40;revision 4013&#41;
+++ lib/Perl/Critic/Policy/Variables/ProhibitUnusedVariables.pm	&#40;working copy&#41;
@@ -41,6 +41,7 @@
     my %symbol_usage;
     _get_symbol_usage&#40; \%symbol_usage, $document &#41;;
     _get_regexp_symbol_usage&#40; \%symbol_usage, $document &#41;;
+    _get_readline_usage&#40; \%symbol_usage, $document &#41;;
     return if not %symbol_usage;
 
     my $declarations = $document-&gt;find&#40;&#39;PPI::Statement::Variable&#39;&#41;;
@@ -114,6 +115,28 @@
     return;
 }
 
+# Look for PPI::Token::QuoteLike::Readline of &lt;$foo&gt;, which is handle $foo
+# being used.
+# Sometimes PPI &#40;as of version 1.213&#41; parses &lt;$foo&gt; as operator &#39;&lt;&#39;, symbol
+# $foo, operator &#39;&gt;&#39;, eg. &#34;print &lt;$foo&gt;&#34;.  That&#39;s picked up by
+# _get_symbol_usage&#40;&#41; above.
+#
+sub _get_readline_usage {
+    my &#40; $symbol_usage, $document &#41; = @_;
+
+    my $readlines = $document-&gt;find&#40;&#39;PPI::Token::QuoteLike::Readline&#39;&#41;
+      || return; # if none
+
+    foreach my $readline &#40; @{$readlines} &#41; {
+        ### readline content: $readline-&gt;content
+        if &#40;$readline-&gt;content =~ /^&lt;&#40;\$.*&#41;&gt;$/&#41; {
+            ### add: $1
+            $symbol_usage-&gt;{$1}++;
+        }
+    }
+
+    return;
+}
 #-----------------------------------------------------------------------------
 
 1;
Index: t/Variables/ProhibitUnusedVariables.run
===================================================================
--- t/Variables/ProhibitUnusedVariables.run	&#40;revision 4013&#41;
+++ t/Variables/ProhibitUnusedVariables.run	&#40;working copy&#41;
@@ -162,6 +162,24 @@
 
 #-----------------------------------------------------------------------------
 
+## name Variable used in &lt;$foo&gt; readline
+## failures 0
+## cut
+
+my $foo;
+my $line = &lt;$foo&gt;;
+
+#-----------------------------------------------------------------------------
+
+## name Variable used in open&#40;&#41; and &lt;$foo&gt;
+## failures 0
+## cut
+
+open &#40;my $foo, &#39;&lt;&#39;, &#39;/etc/motd&#39;&#41; or die;
+my $line = &lt;$foo&gt;;
+
+#-----------------------------------------------------------------------------
+
 ##############################################################################
 #      $URL$
 #     $Date$
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-893064" href="/Public/Bug/Display.html?id=65465#txn-893064">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;05&nbsp;12:11:19&nbsp;2011</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/893064/462980/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/462980">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 04 18:06:42 2011, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ProhibitUnusedVariables doesn&#39;t seem to know that a readline style
&gt; &lt;$foo&gt; is a use of the variable $foo.  I get some joy from the change
&gt; below.
&gt; 
&gt; I struck this in the second .run addition,
&gt; 
&gt;     open &#40;my $foo, &#39;&lt;&#39;, &#39;/etc/motd&#39;&#41; or die;
&gt;     my $line = &lt;$foo&gt;;
&gt; 
&gt; I suppose it might also recognise that open&#40;my $foo, ...&#41; initializes
&gt; $foo by side-effect, if the intention of the policy is to pick up only
&gt; vars which are both uninitialized and then unused.  Dunno if that would
&gt; be a bit tricky.
&gt; 
&gt; 
</div>

Thank you for the report. This is a specific case of RT #64929, which
simply notes that ProhibitUnusedVariables does not find all unused
variables.

I&#39;m attempting to put a few more teeth in this policy, and believe me,
the devil is in the details. The current philosophy is that
initialization does not count as use, so

open my $fh, &#39;&lt;&#39;, &#39;foo.bar&#39;;

would be a violation unless the file was actually read. On the other hand,

while &#40; &lt;$fh&gt; &#41; { ... }

would count as a use of the variable, addressing your specific concern.

Whether this makes the upcoming release is another question - I rather
suspect it will not, I&#39;m afraid.

Tom
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-893067" href="/Public/Bug/Display.html?id=65465#txn-893067">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;05&nbsp;12:11:19&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-894077" href="/Public/Bug/Display.html?id=65465#txn-894077">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;07&nbsp;19:09:29&nbsp;2011</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #65465] ProhibitUnusedVariables notice readline &lt;$fh&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 08 Feb 2011 11:09:21 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/894077/463512/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/463512">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 504b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; The current philosophy is that
&gt; initialization does not count as use, so
</div>
Umm, I think initialization currently does count as use, so for instance

    my $guard = Scope::Guard-&gt;new &#40;sub { some_cleanup&#40;&#41; }&#41;;

passes.  Dunno if that should remain so.  warnings::unused reports it as
unused.  As long as it&#39;s not too hard to flag as something created for
block-scoped purposes then it could be worth reporting initialized but
otherwise unused.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-894412" href="/Public/Bug/Display.html?id=65465#txn-894412">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;08&nbsp;11:00:34&nbsp;2011</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/894412/463705/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/463705">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 07 19:09:29 2011, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; The current philosophy is that
&gt; &gt; initialization does not count as use, so
</div>&gt; 
&gt; Umm, I think initialization currently does count as use, so for instance
&gt; 
&gt;     my $guard = Scope::Guard-&gt;new &#40;sub { some_cleanup&#40;&#41; }&#41;;
&gt; 
&gt; passes.  Dunno if that should remain so.  warnings::unused reports it as
&gt; unused.  As long as it&#39;s not too hard to flag as something created for
&gt; block-scoped purposes then it could be worth reporting initialized but
&gt; otherwise unused.
</div>
That&#39;s one that could go either way, and it depends on what you think is
a use. As you note, warnings::unused thinks it&#39;s unused. And certainly

my $VERSION = something-or-other;

which appears in a surprising number of CPAN modules, does not represent
a use of $VERSION in any way I can think of.

But you are right that sentinel variables are used in a meaningful sense
of the word even though they are initialized and then not otherwise
referred to in the code. I was going to provide a configuration variable
to cause the policy to accept otherwise-unused variables computed by the
code of your choice:

[ProhibitUnusedVariables]
allow_if_computed_by = Scope::Guard unpack stat

This is a fairly simple-minded test -- the code simply compares the
first significant token to the right of the assignment operator with the
configured word. It has already been suggested that Scope::Guard and
maybe some of its friends ought to be pre-configured, but I have not
done that yet because I&#39;m validating versus warnings::unused and I&#39;m
lazy enough not to want to deliberately introduce differences in behavior.

By default I was _not_ going to complain about unused subroutine
arguments -- at least, if unpacked in a way the code understands, like

my &#40; $self, $arg1, $unused &#41; = @_;

nor when a reference to the initialization is taken, as in

\&#40; my $foo = &#39;baz&#39; &#41;

though in the latter case I have not actually been ambitious enough to
try to find out if anything is done with the reference. So far, there
have been more than enough edge cases to keep me busy tracking down
false positives.

Some of the false positives can not be detected by static analysis in
any way I can think of: variables only used in a stringy eval, or by
code inserted by a filter. Those will require an &#39;I meant to do that&#39;
comment &#40;spelled &#39;## no critic &#40;ProhibitUnusedVariables&#41;&#39;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-895963" href="/Public/Bug/Display.html?id=65465#txn-895963">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;11&nbsp;18:35:56&nbsp;2011</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #65465] ProhibitUnusedVariables notice readline &lt;$fh&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 12 Feb 2011 10:35:52 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/895963/464510/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/464510">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; my $VERSION = something-or-other;
</div>
Ah.  I see for instance Finance::BeanCounter has that doing its own
exported BeanCounterVersion&#40;&#41; func, which wouldn&#39;t seem to add much to
the usual -&gt;VERSION etc.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [ProhibitUnusedVariables]
&gt; allow_if_computed_by = Scope::Guard unpack stat
</div>
There&#39;s quite a few of those destructor-action things.  My crib list of
the generic ones &#40;from my own Glib::Ex::FreezeNotify, which is a
specific one&#41;,

        AtExit
        End
        ReleaseAction
        Sub::ScopeFinalizer
        Guard

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; simply compares the
&gt; first significant token to the right of the assignment operator
</div>
I suppose it could do an &#34;is this a class method call&#34; to pick up the
alternative syntax thingie &#34;new Scope::Guard ...&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It has already been suggested that Scope::Guard and
&gt; maybe some of its friends ought to be pre-configured,
</div>
If nothing else those like SelectSaver which come with perl would be
strong candidates.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; By default I was _not_ going to complain about unused subroutine
&gt; arguments -- at least, if unpacked in a way the code understands, like
&gt;
&gt; my &#40; $self, $arg1, $unused &#41; = @_;
</div>
Sounds good, that&#39;s one of the most annoying things warnings:unused
gives &#40;which is just in it&#39;s nature of course&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ## no critic &#40;ProhibitUnusedVariables&#41;
</div>
A bit ugly, but as long as it wasn&#39;t needed most of the time.  It&#39;s
tempting to think of naming block-scoped variables in some way
suggesting their purpose to both human and computer readers, like
&#34;..._saver&#34;, &#34;block_scope_...&#34;, or something.  I suppose people might
have different preferences for that though.

    my $foo_saver = guard { some_code&#40;&#41;; };
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.388484</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
