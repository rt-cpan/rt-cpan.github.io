<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #96454 for Net-OAuth2: using client_id and client_secret in get_access_token&#40;&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #96454 for Net-OAuth2: using client_id and client_secret in get_access_token&#40;&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-OAuth2">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-OAuth2">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-OAuth2">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-OAuth2">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-OAuth2">Net-OAuth2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">96454</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-OAuth2">Net-OAuth2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sweisman [...] pobox.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235290-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235291-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.59    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=96454">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1375629" href="/Public/Bug/Display.html?id=96454#txn-1375629">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;14&nbsp;20:13:01&nbsp;2014</span>
    <span class="description">sweisman [...] pobox.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> using client_id and client_secret in get_access_token&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 Jun 2014 03:12:51 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OAuth2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott Weisman &lt;sweisman [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375629/730486/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730486">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 666b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi there. I am using the OAuth2 service of QQ Catalyst.

I had to step through your code to understand why get_access_token&#40;&#41; would
not work, even though everything up through that point worked fine.

It turns out that QQ Catalyst&#39;s OAuth2 server did not like having the
client_id and client_secret in the POST content. It returns with a 400. I
removed these params from the content in the module and now everything is
grand. Can you add a config option of whether to add an Auth header &#40;with
the encoded client_id and client_secret&#41; or add those params to the POST
body &#40;or both&#41;?

i hate to rely on a customized CPAN module for my project to work.

Thanks,

Scott
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375629/730487/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730487">with headers</a>
<br />
<span class="downloadcontenttype">text/html 814b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1375818" href="/Public/Bug/Display.html?id=96454#txn-1375818">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;15&nbsp;17:00:10&nbsp;2014</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96454] using client_id and client_secret in get_access_token&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 Jun 2014 22:59:53 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Scott Weisman via RT &lt;bug-Net-OAuth2 [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375818/730585/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730585">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 904b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Scott Weisman via RT &#40;bug-Net-OAuth2@rt.cpan.org&#41; [140615 00:13]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sat Jun 14 20:13:01 2014: Request 96454 was acted upon.
&gt; Transaction: Ticket created by sweisman@pobox.com
&gt;        Queue: Net-OAuth2
&gt;      Subject: using client_id and client_secret in get_access_token&#40;&#41;
&gt;   Requestors: sweisman@pobox.com
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
</div>   ...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It turns out that QQ Catalyst&#39;s OAuth2 server did not like having the
&gt; client_id and client_secret in the POST content.
</div>
Can you supply a patch, so I can see exactly what works for you?
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1375819" href="/Public/Bug/Display.html?id=96454#txn-1375819">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;15&nbsp;17:00:11&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1375857" href="/Public/Bug/Display.html?id=96454#txn-1375857">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;16&nbsp;02:06:54&nbsp;2014</span>
    <span class="description">sweisman [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96454] using client_id and client_secret in get_access_token&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jun 2014 09:06:43 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OAuth2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott Weisman &lt;sweisman [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375857/730598/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730598">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a hard-coded solution to make it work for the server I am
connecting to in WebServer.pm &#40;my additions and comments in bold&#41;:

sub get_access_token&#40;$@&#41;
{   my &#40;$self, $code, @req_params&#41; = @_;

    # rfc6749 section &#34;2.3.1. Client Password&#34;
    # header is always supported, client_id/client_secret may be.  We do
both.
    my $params   = $self-&gt;access_token_params&#40;code =&gt; $code, @req_params&#41;;
    my $basic    = encode_base64
&#34;$params-&gt;{client_id}:$params-&gt;{client_secret}&#34;
      , &#39;&#39;;   # no new-lines!

*delete&#40;$$params{client_id}&#41;; # above you say that &#34;header is always
supported, client_id/client_secret may be. We do both.&#34;*
*delete&#40;$$params{client_secret}&#41;; # At the server I am trying to auth
with, **client_id/client_secret ARE NOT SUPPORTED and in fact cause the
auth request to be denied.*
*# so I delete them after $basic is calculated but before build_request is
invoked, so they are not in the POST request body.*
*# since header is ALWAYS supported as you say, that is the only needed
method anyway*
*# it just happens that sites like Google ignore them, but not all sites do*

    my $request  = $self-&gt;build_request
      &#40; $self-&gt;access_token_method
      , $self-&gt;access_token_url
      , $params
      &#41;;

    $request-&gt;headers-&gt;header&#40;Authorization =&gt; &#34;Basic $basic&#34;&#41;;
    my $response = $self-&gt;request&#40;$request&#41;;

    Net::OAuth2::AccessToken-&gt;new
      &#40; profile      =&gt; $self
      , auto_refresh =&gt; !!$self-&gt;auto_save
      , $self-&gt;params_from_response&#40;$response, &#39;access token&#39;&#41;
      &#41;;
}



On Mon, Jun 16, 2014 at 12:00 AM, Mark Overmeer via RT &lt;
bug-Net-OAuth2@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
&gt;
&gt; * Scott Weisman via RT &#40;bug-Net-OAuth2@rt.cpan.org&#41; [140615 00:13]:
<div class="message-stanza open">&gt; &gt; Sat Jun 14 20:13:01 2014: Request 96454 was acted upon.
&gt; &gt; Transaction: Ticket created by sweisman@pobox.com
&gt; &gt;        Queue: Net-OAuth2
&gt; &gt;      Subject: using client_id and client_secret in get_access_token&#40;&#41;
&gt; &gt;   Requestors: sweisman@pobox.com
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
</div>&gt;    ...
<div class="message-stanza open">&gt; &gt; It turns out that QQ Catalyst&#39;s OAuth2 server did not like having the
&gt; &gt; client_id and client_secret in the POST content.
</div>&gt;
&gt; Can you supply a patch, so I can see exactly what works for you?
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375857/730599/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730599">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1375873" href="/Public/Bug/Display.html?id=96454#txn-1375873">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;16&nbsp;02:26:51&nbsp;2014</span>
    <span class="description">sweisman [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96454] using client_id and client_secret in get_access_token&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jun 2014 09:26:41 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OAuth2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott Weisman &lt;sweisman [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375873/730616/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730616">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s the relevant quote from 2.3.1:

Alternatively, the authorization server MAY support including the
   client credentials in the request-body using the following
   parameters:

...

 Including the client credentials in the request-body using the two
   parameters is NOT RECOMMENDED and SHOULD be limited to clients unable
   to directly utilize the HTTP Basic authentication scheme &#40;or other
   password-based HTTP authentication schemes&#41;.  The parameters can only
   be transmitted in the request-body and MUST NOT be included in the
   request URI.


As you see, this method MAY be supported, which also means it MAY NOT be.
It may even be rejected, since there&#39;s no language preventing that in the
RFC.

Further, your &#34;do both&#34; solution violates the RFC.

So, it&#39;s either best to add a new config option to the module &#40;eg
&#34;send_secret_in_body&#34; or something like that&#41; or just remove it completely
&#40;since that is the RFC&#39;s recommended practice&#41;, as it is likely that no one
will notice anyway. While your code clearly passed on big sites like
Google, there may be many more sites like the one I encountered. That might
even be the default for the OAuth2 library they&#39;re using. Net::OAuth2 works
great, now that I figured out the problem. Once I got my head around how it
works, it&#39;s very simple and easy to use. Thanks.

One other thing. Why does an auth failure die? Yes, I can eval it, but why
require that? Also, in order to diagnose the problem, I had to add
debugging output to the code to print the entire request header and body.
Some sort of verbose output would be nice.

Scott


On Mon, Jun 16, 2014 at 9:06 AM, Scott Weisman &lt;sweisman@pobox.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is a hard-coded solution to make it work for the server I am
&gt; connecting to in WebServer.pm &#40;my additions and comments in bold&#41;:
&gt;
&gt; sub get_access_token&#40;$@&#41;
&gt; {   my &#40;$self, $code, @req_params&#41; = @_;
&gt;
&gt;     # rfc6749 section &#34;2.3.1. Client Password&#34;
&gt;     # header is always supported, client_id/client_secret may be.  We do
&gt; both.
&gt;     my $params   = $self-&gt;access_token_params&#40;code =&gt; $code, @req_params&#41;;
&gt;     my $basic    = encode_base64
&gt; &#34;$params-&gt;{client_id}:$params-&gt;{client_secret}&#34;
&gt;       , &#39;&#39;;   # no new-lines!
&gt;
&gt; *delete&#40;$$params{client_id}&#41;; # above you say that &#34;header is always
&gt; supported, client_id/client_secret may be. We do both.&#34;*
&gt; *delete&#40;$$params{client_secret}&#41;; # At the server I am trying to auth
&gt; with, **client_id/client_secret ARE NOT SUPPORTED and in fact cause the
&gt; auth request to be denied.*
&gt; *# so I delete them after $basic is calculated but before build_request is
&gt; invoked, so they are not in the POST request body.*
&gt; *# since header is ALWAYS supported as you say, that is the only needed
&gt; method anyway*
&gt; *# it just happens that sites like Google ignore them, but not all sites
&gt; do*
&gt;
&gt;     my $request  = $self-&gt;build_request
&gt;       &#40; $self-&gt;access_token_method
&gt;       , $self-&gt;access_token_url
&gt;       , $params
&gt;       &#41;;
&gt;
&gt;     $request-&gt;headers-&gt;header&#40;Authorization =&gt; &#34;Basic $basic&#34;&#41;;
&gt;     my $response = $self-&gt;request&#40;$request&#41;;
&gt;
&gt;     Net::OAuth2::AccessToken-&gt;new
&gt;       &#40; profile      =&gt; $self
&gt;       , auto_refresh =&gt; !!$self-&gt;auto_save
&gt;       , $self-&gt;params_from_response&#40;$response, &#39;access token&#39;&#41;
&gt;       &#41;;
&gt; }
&gt;
&gt;
&gt;
&gt; On Mon, Jun 16, 2014 at 12:00 AM, Mark Overmeer via RT &lt;
&gt; bug-Net-OAuth2@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
&gt;&gt;
&gt;&gt; * Scott Weisman via RT &#40;bug-Net-OAuth2@rt.cpan.org&#41; [140615 00:13]:
<div class="message-stanza open">&gt;&gt; &gt; Sat Jun 14 20:13:01 2014: Request 96454 was acted upon.
&gt;&gt; &gt; Transaction: Ticket created by sweisman@pobox.com
&gt;&gt; &gt;        Queue: Net-OAuth2
&gt;&gt; &gt;      Subject: using client_id and client_secret in get_access_token&#40;&#41;
&gt;&gt; &gt;   Requestors: sweisman@pobox.com
&gt;&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
</div>&gt;&gt;    ...
<div class="message-stanza open">&gt;&gt; &gt; It turns out that QQ Catalyst&#39;s OAuth2 server did not like having the
&gt;&gt; &gt; client_id and client_secret in the POST content.
</div>&gt;&gt;
&gt;&gt; Can you supply a patch, so I can see exactly what works for you?
&gt;&gt; --
&gt;&gt; Regards,
&gt;&gt;                MarkOv
&gt;&gt;
&gt;&gt; ------------------------------------------------------------------------
&gt;&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;&gt;
&gt;&gt;
&gt;&gt;
</div>&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375873/730617/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730617">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1375882" href="/Public/Bug/Display.html?id=96454#txn-1375882">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;16&nbsp;04:54:54&nbsp;2014</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96454] using client_id and client_secret in get_access_token&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jun 2014 10:54:33 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Scott Weisman via RT &lt;bug-Net-OAuth2 [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375882/730624/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730624">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Scott Weisman via RT &#40;bug-Net-OAuth2@rt.cpan.org&#41; [140616 06:07]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-OAuth2
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
&gt; 
&gt; *delete&#40;$$params{client_id}&#41;; # above you say that &#34;header is always
&gt; supported, client_id/client_secret may be. We do both.&#34;*
&gt; *delete&#40;$$params{client_secret}&#41;; # At the server I am trying to auth
&gt; with,
</div>
You get the %$params from a library.  Please do not change such a HASH
you got from a library, because in most cases you will be modifying
the original!  So, in the next call to collect these data, the records
are missing.

A safer option is
  local $params-&gt;{client_id};
  local $params-&gt;{client_secret};

But I have chosen to implement an option flag
   Net::OAuth2::Profile::new&#40;secrets_in_params&#41; 

I send you my updated version in a separate email.  Please test.
-- 
Regards,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1375885" href="/Public/Bug/Display.html?id=96454#txn-1375885">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;16&nbsp;04:57:35&nbsp;2014</span>
    <span class="description">sweisman [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96454] using client_id and client_secret in get_access_token&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jun 2014 11:57:24 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OAuth2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott Weisman &lt;sweisman [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375885/730628/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730628">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you. My solution was quick and dirty. Thanks for the tip.


On Mon, Jun 16, 2014 at 11:54 AM, Mark Overmeer via RT &lt;
bug-Net-OAuth2@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
&gt;
&gt; * Scott Weisman via RT &#40;bug-Net-OAuth2@rt.cpan.org&#41; [140616 06:07]:
<div class="message-stanza open">&gt; &gt;        Queue: Net-OAuth2
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96454">https://rt.cpan.org/Ticket/Display.html?id=96454</a></span> &gt;
&gt; &gt;
&gt; &gt; *delete&#40;$$params{client_id}&#41;; # above you say that &#34;header is always
&gt; &gt; supported, client_id/client_secret may be. We do both.&#34;*
&gt; &gt; *delete&#40;$$params{client_secret}&#41;; # At the server I am trying to auth
&gt; &gt; with,
</div>&gt;
&gt; You get the %$params from a library.  Please do not change such a HASH
&gt; you got from a library, because in most cases you will be modifying
&gt; the original!  So, in the next call to collect these data, the records
&gt; are missing.
&gt;
&gt; A safer option is
&gt;   local $params-&gt;{client_id};
&gt;   local $params-&gt;{client_secret};
&gt;
&gt; But I have chosen to implement an option flag
&gt;    Net::OAuth2::Profile::new&#40;secrets_in_params&#41;
&gt;
&gt; I send you my updated version in a separate email.  Please test.
&gt; --
&gt; Regards,
&gt;
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1375885/730629/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/730629">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1508734" href="/Public/Bug/Display.html?id=96454#txn-1508734">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;17&nbsp;04:30:49&nbsp;2015</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1508736" href="/Public/Bug/Display.html?id=96454#txn-1508736">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;17&nbsp;04:30:55&nbsp;2015</span>
    <span class="description">MARKOV [...] cpan.org -  Fixed in 0.59 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.598167</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
