<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #118097 for XML-Twig: expand_external_ents fails to work as documented</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #118097 for XML-Twig: expand_external_ents fails to work as documented</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Twig/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Twig">XML-Twig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">118097</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Twig/Active/">XML-Twig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dmoppert [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
CARNIL [...] cpan.org

<br />
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37682-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37683-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;23:05:27&nbsp;2016</span>
    <span class="description">dmoppert [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> expand_external_ents fails to work as documented</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Sep 2016 12:35:13 +0930</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Doran Moppert &lt;dmoppert [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From the manual:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; expand_external_ents
&gt;
&gt; When this option is used external entities &#40;that are defined&#41; are
&gt; expanded when the document is output using &#34;print&#34; functions such as
&gt; print , sprint , flush and xml_string . Note that in the twig the
&gt; entity will be stored as an element with a tag &#39;#ENT&#39;, the entity will
&gt; not be expanded there, so you might want to process the entities
&gt; before outputting it.
</div>
The default is indeed 0 &#40;verified by inspecting $twig-&gt;global_state&#41;,
but it seems that external entities are expanded in *all* cases.

I&#39;m not sure how much XML::Parser is responsible &#40;see end of
transcript&#41;, but the manual there isn&#39;t clearly telling me how XXE
can be turned off.

Same results with XML::Twig 3.26 through 3.49.

Is there a good way to de-fang this behaviour that I have failed to
identify?

~~~
$ cat test.pl
use XML::Twig;

my $twig = XML::Twig-&gt;new&#40; expand_external_ents =&gt; $ARGV[0] &#41;;
$twig-&gt;parsefile&#40; &#34;test.xml&#34;&#41;;
$twig-&gt;print;

$ cat test.xml
&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;!DOCTYPE foo [
    &lt;!ENTITY xxe PUBLIC &#34;bar&#34; &#34;boom.txt&#34;&gt;
]&gt;
&lt;root&gt;&#38;xxe;&lt;/root&gt;

$ echo Boom &gt; boom.txt

$ perl test.pl 1 | grep Boom
&lt;root&gt;Boom

$ perl test.pl 0 | grep Boom
&lt;root&gt;Boom

$ perl test.pl -1 | grep Boom
&lt;root&gt;Boom

$ chmod 0 boom.txt

$ perl test.pl 1
cannot load SYSTEM entity &#39;xxe&#39; from &#39;boom.txt&#39;: cannot open &#39;boom.txt&#39;: Permission denied at /usr/lib64/perl5/vendor_perl/XML/Parser/Expat.pm line 474.
 at /usr/lib64/perl5/vendor_perl/XML/Parser.pm line 187.
        eval {...} called at /usr/lib64/perl5/vendor_perl/XML/Parser.pm line 186
        XML::Parser::parse&#40;XML::Twig=HASH&#40;0xaab468&#41;, &#34;*XML::Parser::FILE&#34;&#41; called at /usr/share/perl5/XML/Twig.pm line 767
        eval {...} called at /usr/share/perl5/XML/Twig.pm line 767
        XML::Twig::parse&#40;XML::Twig=HASH&#40;0xaab468&#41;, &#34;*XML::Parser::FILE&#34;&#41; called at /usr/lib64/perl5/vendor_perl/XML/Parser.pm line 233
        eval {...} called at /usr/lib64/perl5/vendor_perl/XML/Parser.pm line 232
        XML::Parser::parsefile&#40;XML::Twig=HASH&#40;0xaab468&#41;, &#34;test.xml&#34;&#41; called at /usr/share/perl5/XML/Twig.pm line 781
        eval {...} called at /usr/share/perl5/XML/Twig.pm line 781
        XML::Twig::parsefile&#40;XML::Twig=HASH&#40;0xaab468&#41;, &#34;test.xml&#34;&#41; called at test.pl line 4
 at test.pl line 4.
 at test.pl line 4.

$ perl test.pl 0
cannot expand &#38;xxe; - cannot load &#39;boom.txt&#39; at /usr/lib64/perl5/vendor_perl/XML/Parser/Expat.pm line 474.
 at test.pl line 4.
 at test.pl line 4.

$ perl test.pl -1
&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;!DOCTYPE foo [
&lt;!ENTITY xxe PUBLIC &#34;bar&#34; &#34;boom.txt&#34;&gt;
]&gt;
&lt;root&gt;&lt;!-- cannot expand &#38;xxe; - cannot load &#39;boom.txt&#39; --&gt;&lt;/root&gt;
~~~

-- 
Doran Moppert
Red Hat Product Security
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;01:41:48&nbsp;2016</span>
    <span class="description">CARNIL [...] cpan.org -  Cc CARNIL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;01:26:14&nbsp;2016</span>
    <span class="description">KENTNL [...] cpan.org -  Cc KENTNL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;04&nbsp;06:10:18&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">CVE-2016-9180 identifier was assigned to this vulnerability &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://seclists.org/oss-sec/2016/q4/329">http://seclists.org/oss-sec/2016/q4/329</a></span>&gt;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;04&nbsp;06:10:18&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;13&nbsp;04:52:10&nbsp;2016</span>
    <span class="description">hertzog [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> xmltwig [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #118097] no_xxe in released module but not in git?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 13 Dec 2016 10:51:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Raphael Hertzog &lt;hertzog [...] debian.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Michel,

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/changes/release/MIROD/XML-Twig-3.52">https://metacpan.org/changes/release/MIROD/XML-Twig-3.52</a></span> shows that
version 3.50 added the missing no_xxe flag but for some reason the git
repository is not up-to-date:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mirod/xmltwig/commits/master">https://github.com/mirod/xmltwig/commits/master</a></span> only contains commit
up to June 21.

Can you update the git repository so that we can see the commit
that added this new feature? Idealy if you can push git tags too, that
would be nice.

And while this new feature is certainly welcome, what&#39;s your
stance on the behaviour of expand_external_ents which apparently
does not work as advertised? Do you expect to fix that at some
point?

FWIW I have reproduced the results of Doran with version 3.50 of XML::Twig.

Thank you.
-- 
Raphaël Hertzog ◈ Writer/Consultant ◈ Debian Developer

Discover the Debian Administrator&#39;s Handbook:
→ <span class="clickylink"><a target="new" rel="nofollow" href="http://debian-handbook.info/get/">http://debian-handbook.info/get/</a></span>
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
