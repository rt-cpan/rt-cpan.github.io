<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24818 for WWW-TV: Failing test cases due to new content/layout on tv.com</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24818 for WWW-TV: Failing test cases due to new content/layout on tv.com</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=WWW-TV">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=WWW-TV">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=WWW-TV">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=WWW-TV">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-TV">WWW-TV CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24818</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">15 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=WWW-TV">WWW-TV</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">tigris [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
stennie [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40074-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.04    </td>
  </tr>
  <tr id="CF-40075-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




20_series.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/289220/130345/20_series.t">
Tue Feb 06 08:03:25 2007 (1.4k) by stennie [...] cpan.org
</a>
</font></li>
</ul>


Series.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/289220/130342/Series.pm">
Tue Feb 06 08:03:23 2007 (7.5k) by stennie [...] cpan.org
</a>
</font></li>
</ul>


www-tv.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/289218/130336/www-tv.diff">
Tue Feb 06 07:57:06 2007 (1008b) by stennie [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=24818">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-289218" href="/Public/Bug/Display.html?id=24818#txn-289218">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;06&nbsp;07:57:00&nbsp;2007</span>
    <span class="description">stennie [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Failing test cases due to new content/layout on tv.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/289218/130333/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/130333">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 619b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Due to changes in html/content, there are two test failures in t/20_series:

t/20_series.....ok 6/0                                                       
#   Failed test &#39;summary&#39;
#   at t/20_series.t line 21.
t/20_series.....NOK 7/0                                                      
#   Failed test &#39;cast&#39;
#   at t/20_series.t line 22.
t/20_series.....ok 19/0# Looks like you failed 2 tests of 19.                
t/20_series.....dubious                               

Fixes are:
  - change text in $series-&gt;summary test case
  - update regex in $series-&gt;cast&#40;&#41;

Diff and updated files attached.

Cheers,
Stephen
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> www-tv.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/289218/130336/www-tv.diff">Download www-tv.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1008b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- WWW-TV-0.04.dist/lib/WWW/TV/Series.pm	2006-08-12 11:15:32.000000000 +1000
+++ WWW-TV-0.04/lib/WWW/TV/Series.pm	2007-02-06 23:41:57.000000000 +1100
@@ -169,8 +169,7 @@
     my @cast;
     for my $line &#40;split /\n/, $self-&gt;_html&#41; {
         next unless $line =~ m{
-            &lt;a\shref=&#34;http://www\.tv\.com/.*?person/\d+/summary\.html
-            \?tag=cast;name;\d+&#34;&gt;&#40;.*?&#41;&lt;/a&gt;&lt;br\s/&gt;
+            &lt;a .*?href=&#34;http://www\.tv\.com/.*?person/\d+/summary\.html\?.*?tag=cast;name;\d+&#34;&gt;&#40;.*?&#41;&lt;/a&gt;
         }x;
         push @cast, $1;
     }

--- WWW-TV-0.04.dist/t/20_series.t	2006-08-03 03:31:00.000000000 +1000
+++ WWW-TV-0.04/t/20_series.t	2007-02-06 23:46:16.000000000 +1100
@@ -18,7 +18,7 @@
         my $series = WWW::TV::Series-&gt;new&#40;name =&gt; &#39;Prison Break&#39;&#41;,
         &#39;WWW::TV::Series&#39;,
     &#41;;
-    ok&#40;$series-&gt;summary =~ /death row/, &#39;summary&#39;&#41;;
+    ok&#40;$series-&gt;summary =~ /Fox River/, &#39;summary&#39;&#41;;
     ok&#40;$series-&gt;cast =~ /Wentworth Miller/, &#39;cast&#39;&#41;;
     ok&#40;$series-&gt;image =~ /\.jpg$/, &#39;image&#39;&#41;;
 }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-289220" href="/Public/Bug/Display.html?id=24818#txn-289220">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;06&nbsp;08:03:21&nbsp;2007</span>
    <span class="description">stennie [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/289220/130339/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/130339">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 125b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">File attachments .. updates to WWW::TV 0.04 as reflected in the diff:
  lib/WWW/TV/Series.pm
  t/20_series.t

Cheers,
Stephen
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/289220/130342/Series.pm">Download Series.pm</a><br />
<span class="downloadcontenttype">text/x-perl 7.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">=head1 NAME

WWW::TV::Series - Parse TV.com for TV Series information.

=head1 SYNOPSIS

  use WWW::TV::Series qw&#40;&#41;;
  my $series = WWW::TV::Series-&gt;new&#40;name =&gt; &#39;Prison Break&#39;&#41;;

  my @episodes = $series-&gt;episodes;
  print $series-&gt;summary;

=head1 DESCRIPTION

The L&lt;WWW::TV::Series&gt; module parses TV.com series information using
L&lt;LWP::UserAgent&gt;.

=head1 METHODS

=cut

package WWW::TV::Series;
use strict;
use warnings;

our $VERSION = &#39;0.04&#39;;

use Carp qw&#40;croak&#41;;
use LWP::UserAgent qw&#40;&#41;;

=head2 new

    The new&#40;&#41; method is the constructor. It takes the id of the show if
    you have previously looked that up, or the name of the show which
    will be used to perform a search and the id will be taken from the
    first result.

        my $series = WWW::TV::Series-&gt;new&#40;name =&gt; &#39;Prison Break&#39;&#41;;
        my $series = WWW::TV::Series-&gt;new&#40;id =&gt; 31635&#41;;

    It is recommended that you lookup the show first and use the ID,
    otherwise you just don&#39;t know what will be returned.

    The constructor also takes a single scalar as an argument and does
    it&#39;s best to figure out what you want. But due to some shows being
    all digits as a name &#40;e.g. &#34;24&#34;&#41;, use of this is not recommended
    &#40;and in future may be deprecated&#41;.

=cut

sub new {
    my $class = ref $_[0] ? ref&#40;shift&#41; : shift;

    my %data;
    if &#40;@_ == 1&#41; {
        # If they gave us a plain scalar argument, try our best to figure out
        # what it is. Of course this dies in the arse if you want to search
        # for a program with a name like &#39;24&#39;.
        if &#40;$_[0] =~ /^\d+$/&#41; {
            $data{id} = shift;
        }
        else {
            $data{name} = shift;
        }
    }
    elsif &#40;scalar&#40;@_&#41; % 2 == 0&#41; {
        %data = @_;
    }

    $data{id} = $class-&gt;_get_first_search_result&#40;$data{name}&#41;
        if exists $data{name};

    croak &#39;No id or name given to constructor&#39; unless exists $data{id};
    croak &#34;Invalid id: $data{id}&#34; unless $data{id} =~ /^\d+$/;

    return bless {
        id     =&gt; $data{id},
        filled =&gt; { id =&gt; 1 },
    }, $class;
}

sub _get_first_search_result {
    my &#40;$class, $name&#41; = @_;

    my $rc = LWP::UserAgent-&gt;new-&gt;get&#40;
        &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tv.com/search.php?stype=program&#38;qs=$name">http://www.tv.com/search.php?stype=program&#38;qs=$name</a></span>&#34;
    &#41;;
    croak &#34;Unable to get search results for $name&#34; unless $rc-&gt;is_success;

    for &#40;split /\n/, $rc-&gt;content&#41; {
        next unless m#
            ^
            \s+
            &lt;a\s.*?\shref=&#34;http://www.tv.com/.*?show/&#40;\d+&#41;/summary.html
            \?q=.*?&#38;tag=search_results
        #x;
        return $1;
    }
    croak &#39;Unable to find a show in the search results.&#39;;
}

=head2 summary

    Returns a string containing basic information about this series.

=cut

sub summary {
    my &#40;$self&#41; = @_;
    return $self-&gt;{summary} if exists $self-&gt;{filled}-&gt;{summary};
    $self-&gt;{filled}-&gt;{summary} = 1;

    &#40;$self-&gt;{summary}&#41; = $self-&gt;_html =~ m{
            &lt;div\sclass=&#34;mt-10&#34;&gt;\n
            &#40;?:
                &lt;a\sclass=&#34;default-image\smore&#34;\shref=.*?&gt;\n
                &lt;img\ssrc=.*?\s/&gt;More\sPictures\s*&lt;/a&gt;\n
            &#41;?
            &#40;.*?&#41;\n
            &lt;/div&gt;\n
    }sx;

    return $self-&gt;{summary};
}

=head2 genres

    Returns a string containing a comma delimited list of all the genres
    that TV.com have categorised this series as.

        my $genres = $series-&gt;genres;
        my @genres = split&#40;/,/, $series-&gt;genres&#41;;

=cut

sub genres {
    my &#40;$self&#41; = @_;
    return $self-&gt;{genres} if exists $self-&gt;{filled}-&gt;{genres};
    $self-&gt;{filled}-&gt;{genres} = 1;

    my &#40;$genres_row&#41; = $self-&gt;_html =~ m{
        Show\sCategories:\n
        &#40;&lt;a\shref=.*&lt;/a&gt;&#41;
    }x;

    $self-&gt;{genres} =
        join&#40;
            &#39;, &#39;,
            map { s/\s*&lt;a href=&#34;[^&#34;]+&#34;&gt;&#40;.*?&#41;&lt;\/a&gt;\s*/$1/; $_ }
            split&#40;/,/, $genres_row&#41;
        &#41;;

    return $self-&gt;{genres};
}

=head2 cast

    A comma delimited string of the cast members. The order is the same
    as they appear on TV.com, which is most likely nothing to go by, but
    in most cases is the main cast order.

=cut

sub cast {
    my &#40;$self&#41; = @_;
    return $self-&gt;{cast} if exists $self-&gt;{filled}-&gt;{cast};
    $self-&gt;{filled}-&gt;{cast} = 1;

    my @cast;
    for my $line &#40;split /\n/, $self-&gt;_html&#41; {
        next unless $line =~ m{
            &lt;a .*?href=&#34;http://www\.tv\.com/.*?person/\d+/summary\.html\?.*?tag=cast;name;\d+&#34;&gt;&#40;.*?&#41;&lt;/a&gt;
        }x;
        push @cast, $1;
    }
    $self-&gt;{cast} = join&#40;&#39;, &#39;, @cast&#41;;

    return $self-&gt;{cast};
}

=head2 name

    Returns a string containing the name of the series.

=cut

sub name {
    my &#40;$self&#41; = @_;
    return $self-&gt;{name} if exists $self-&gt;{filled}-&gt;{name};
    $self-&gt;{filled}-&gt;{name} = 1;

    &#40;$self-&gt;{name}&#41; = $self-&gt;_html =~ m{
        &lt;div\sid=&#34;content-head&#34;.*?&gt;\n\n?
        &lt;h1&gt;&#40;.*?&#41;&lt;/h1&gt;\n
    }x;

    return $self-&gt;{name};
}

=head2 image

    Returns the url of an image that can be used to identify this series.

=cut

sub image {
    my &#40;$self&#41; = @_;
    return $self-&gt;{image} if exists $self-&gt;{filled}-&gt;{image};
    $self-&gt;{filled}-&gt;{image} = 1;

    &#40;$self-&gt;{image}&#41; = $self-&gt;_html =~ m{
        &lt;a\sclass=&#34;default-image\smore&#34;\shref=&#34;.+;image&#34;&gt;\n
        &lt;img\ssrc=&#34;&#40;.+&#41;&#34;\salt=&#34;.+&#34;\s/&gt;More\sPictures\s+&lt;/a&gt;\n
    }x;

    return $self-&gt;{image};
}

=head2 episodes

    Returns an array of L&lt;WWW::TV::Episode&gt; objects in order.

=cut

sub episodes {
    my &#40;$self&#41; = @_;
    return @{$self-&gt;{episodes}} if $self-&gt;{filled}-&gt;{episodes};
    $self-&gt;{filled}-&gt;{episodes} = 1;

    my $rc = LWP::UserAgent-&gt;new-&gt;get&#40;$self-&gt;episode_url&#41;;
    croak sprintf&#40;&#39;Unable to fetch episodes for series %s&#39;, $self-&gt;id&#41;
        unless $rc-&gt;is_success;

    require WWW::TV::Episode;
    my @episodes =
        grep { defined }
        map {
            my $ep;
            if &#40;m#&lt;a href=&#34;.*/episode/&#40;\d+&#41;/summary\.html[^&#34;]*&#34;&gt;&#40;.*&#41;&lt;/a&gt;#&#41; {
                $ep = WWW::TV::Episode-&gt;new&#40;id =&gt; $1, name =&gt; $2&#41;;
            }
            $ep;
        } split /\n/, $rc-&gt;content;

    $self-&gt;{episodes} = \@episodes;
    return @episodes;
}

sub _html {
    my &#40;$self&#41; = @_;
    return $self-&gt;{html} if $self-&gt;{filled}-&gt;{html};
    $self-&gt;{filled}-&gt;{html} = 1;

    my $rc = LWP::UserAgent-&gt;new-&gt;get&#40;$self-&gt;url&#41;;
    croak sprintf&#40;&#39;Unable to fetch page for series %s&#39;, $self-&gt;id&#41;
        unless $rc-&gt;is_success;

    $self-&gt;{html} =
        join&#40;
            &#34;\n&#34;,
            map { s/^\s*//; s/\s*$//; $_ }
            split /\n/, $rc-&gt;content
        &#41;;

    return shift-&gt;{html};
}

=head2 id

    The ID of this series, according to TV.com

=cut

sub id {
    return shift-&gt;{id};
}

=head2 url

    Returns the url that was used to create this object.

=cut

sub url {
    return sprintf&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tv.com/show/">http://www.tv.com/show/</a></span>%d/summary.html&#39;, shift-&gt;id&#41;;
}

=head2 episode_url

    Returns the url that is used to get the episode listings for this
    series.

=cut

sub episode_url {
    return sprintf&#40;
        &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tv.com/show/">http://www.tv.com/show/</a></span>%d/episode_listings.html?season=0&#39;,
        shift-&gt;id
    &#41;;
}

1;

__END__

=head1 SEE ALSO

L&lt;WWW::TV::Episode&gt;

=head1 KNOWN ISSUES

There isn&#39;t yet any caching support. I don&#39;t see a need for it, but if you feel
the need to implement it then don&#39;t let me stop you.

There also isn&#39;t support for proxy servers yet. LWP should use it from your
environment if you really need it, but who still uses them anyway? Isn&#39;t it all
done transparently these days.

=head1 BUGS

Please report any bugs or feature requests to
C&lt;bug-WWW-TV@rt.cpan.org&gt;, or through the web interface at
L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org">http://rt.cpan.org</a></span>&gt;.

=head1 AUTHOR

Danial Pearce C&lt;cpan@tigris.id.au&gt;

=head1 LICENCE AND COPYRIGHT

Copyright &#40;c&#41; 2006, Danial Pearce C&lt;cpan@tigris.id.au&gt;. All rights reserved.

This module is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/289220/130345/20_series.t">Download 20_series.t</a><br />
<span class="downloadcontenttype">text/x-perl 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#! /usr/bin/perl
use strict;
use warnings;

use Test::More qw&#40;no_plan&#41;;

use_ok&#40;&#39;WWW::TV::Series&#39;&#41;;

{ # MASH via id =&gt;
    isa_ok&#40;my $series = WWW::TV::Series-&gt;new&#40;id =&gt; 119&#41;, &#39;WWW::TV::Series&#39;&#41;;
    is&#40;$series-&gt;name, &#39;M*A*S*H&#39;, &#39;name&#39;&#41;;
    is&#40;$series-&gt;url, &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tv.com/show/119/summary.html&#39;">http://www.tv.com/show/119/summary.html&#39;</a></span>, &#39;url&#39;&#41;;
    is&#40;$series-&gt;genres, &#39;Comedy, Drama&#39;, &#39;genres&#39;&#41;;
}

{ # Prison Break via name =&gt;
    isa_ok&#40;
        my $series = WWW::TV::Series-&gt;new&#40;name =&gt; &#39;Prison Break&#39;&#41;,
        &#39;WWW::TV::Series&#39;,
    &#41;;
    ok&#40;$series-&gt;summary =~ /Fox River/, &#39;summary&#39;&#41;;
    ok&#40;$series-&gt;cast =~ /Wentworth Miller/, &#39;cast&#39;&#41;;
    ok&#40;$series-&gt;image =~ /\.jpg$/, &#39;image&#39;&#41;;
}

{ # Joey via id =&gt;, and check episodes from both season 1 and 2
    isa_ok&#40;my $series = WWW::TV::Series-&gt;new&#40;id =&gt; 20952&#41;, &#39;WWW::TV::Series&#39;&#41;;
    is&#40;$series-&gt;name, &#39;Joey&#39;, &#39;name&#39;&#41;;
    isa_ok&#40;
        my $episode_1 = &#40;$series-&gt;episodes&#41;[1], # Skip pilot episode
        &#39;WWW::TV::Episode&#39;,
    &#41;;
    is&#40;$episode_1-&gt;name, &#39;Joey and the Student&#39;, &#39;episode name&#39;&#41;;
    is&#40;$episode_1-&gt;season_number, 1, &#39;episode season&#39;&#41;;
    isa_ok&#40;
        my $episode_27 = &#40;$series-&gt;episodes&#41;[26], # From season 2
        &#39;WWW::TV::Episode&#39;,
    &#41;;
    is&#40;$episode_27-&gt;name, &#39;Joey and the Spanking&#39;, &#39;episode name&#39;&#41;;
    is&#40;$episode_27-&gt;season_number, 2, &#39;episode season&#39;&#41;;
    isa_ok&#40;$episode_27-&gt;series, &#39;WWW::TV::Series&#39;&#41;;
    is&#40;$episode_27-&gt;series-&gt;name, &#39;Joey&#39;, &#39;episode series&#39;&#41;;
}

exit 0;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-289221" href="/Public/Bug/Display.html?id=24818#txn-289221">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;06&nbsp;08:03:35&nbsp;2007</span>
    <span class="description">stennie [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-291961" href="/Public/Bug/Display.html?id=24818#txn-291961">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;19:23:10&nbsp;2007</span>
    <span class="description">tigris [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">15 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/291961/131726/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/131726">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 58b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Stephen. This is fixed as of 0.05.

regards,
Danial
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-291963" href="/Public/Bug/Display.html?id=24818#txn-291963">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;19:23:12&nbsp;2007</span>
    <span class="description">tigris [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-291965" href="/Public/Bug/Display.html?id=24818#txn-291965">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;19:23:14&nbsp;2007</span>
    <span class="description">tigris [...] cpan.org -  Given to TIGRIS</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.42344</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
