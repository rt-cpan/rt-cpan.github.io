<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #18908 for XML-DOM: beautifying whitespace [patch]</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #18908 for XML-DOM: beautifying whitespace [patch]</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-DOM/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-DOM/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-DOM/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-DOM/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-DOM">XML-DOM CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">18908</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-DOM/Active/">XML-DOM</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
frank [...] kuesterei.ch

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-37040-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.44    </td>
  </tr>
  <tr id="CF-37041-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;25&nbsp;03:49:18&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> beautifying whitespace [patch]</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

the TeXLive project is using XML::DOM, and one member &#40;Fabrice Popineau
who&#39;s currently not very active&#41; has patched DOM.pm to give output
that&#39;s better usable in strings - it either removes whitespace, or adds
consistent indendation.

I must admit that I do not completely understand the purpose or use
cases.  I have just come across it because I wanted to reuse texlive&#39;s
xml files and Perl scripts, and had to use the patched DOM.pm or change
the scripts to get it running.

It might be that the clean solution would be to put the &#34;whitespace
beautifying&#34; code into a separate module, but just in case you&#39;re
interested I send you the patch.  It&#39;s clear that it can&#39;t be applied
without changes &#40;hardcoded variables which should be setable from the
calling script&#41;, but it&#39;s a start.  

I&#39;d be glad if you could tell me whether you are interested, or not at
all.  The code is in the public domain &#40;I can send you a mail by the
author in which he asserts this, if you wish&#41;.

Thank you in advance,
Frank

P.S. and it&#39;s based on an old version, but that&#39;s trivial to find.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DOM.pm.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/share/perl5/XML/DOM.pm	2003-07-29 00:46:43.000000000 +0200
+++ src/Packages/texlive/texlive/LocalTPM/Tools/XML/DOM.pm	2006-03-23 13:46:15.000000000 +0100
@@ -34,6 +34,7 @@
 use vars qw&#40; $VERSION @ISA @EXPORT
 	     $IgnoreReadOnly $SafeMode $TagStyle
 	     %DefaultEntities %DecodeDefaultEntity
+	     $beautifying $current_indent $string_indent $current_print_level @need_indent
 	   &#41;;
 use Carp;
 use XML::RegExp;
@@ -41,7 +42,7 @@
 BEGIN
 {
     require XML::Parser;
-    $VERSION = &#39;1.43&#39;;
+    $VERSION = &#39;1.42&#39;;
 
     my $needVersion = &#39;2.28&#39;;
     die &#34;need at least XML::Parser version $needVersion &#40;current=${XML::Parser::VERSION}&#41;&#34;
@@ -113,6 +114,12 @@
  &#34;&#38;&#34; =&gt; &#34;&#38;amp;&#34;
 &#41;;
 
+$beautifying = 1;
+$current_indent = 0;
+$string_indent = &#34;  &#34;;
+$current_print_level = 0;
+@need_indent = &#40;&#41;;
+
 #
 # If you don&#39;t want DOM warnings to use &#39;warn&#39;, override this method like this:
 #
@@ -2710,6 +2717,12 @@
 
     my $name = $self-&gt;[_TagName];
 
+    if &#40;$XML::DOM::beautifying&#41; {
+      for &#40;my $i = 0; $i &lt; $XML::DOM::current_indent; $i++&#41; {
+	$FILE-&gt;print &#40;$XML::DOM::string_indent&#41;;
+      }
+    }
+
     $FILE-&gt;print &#40;&#34;&lt;$name&#34;&#41;;
 
     if &#40;defined $self-&gt;[_A]&#41;
@@ -2728,12 +2741,38 @@
     my @kids = @{$self-&gt;[_C]};
     if &#40;@kids &gt; 0&#41;
     {
-	$FILE-&gt;print &#40;&#34;&gt;&#34;&#41;;
+        $FILE-&gt;print &#40;&#34;&gt;&#34;&#41;;
+	$XML::DOM::current_print_level++;
+	if &#40;$XML::DOM::beautifying&#41; 
+	{
+	    if &#40;$#kids &gt; 0 || ! $kids[0]-&gt;isTextNode&#41; 
+            {
+	        $FILE-&gt;print &#40;&#34;\n&#34;&#41;;
+	    }
+	    $XML::DOM::current_indent++;
+	}
 	for my $kid &#40;@kids&#41;
 	{
 	    $kid-&gt;print &#40;$FILE&#41;;
 	}
+	if &#40;$XML::DOM::beautifying&#41; 
+        {
+	    $XML::DOM::current_indent--;
+	    if &#40;$#kids &gt; 0|| &#40;$#kids == 0 &#38;&#38; ! $kids[0]-&gt;isTextNode&#41; || $XML::DOM::need_indent[$XML::DOM::current_print_level]&#41;
+            {
+	        for &#40;my $i = 0; $i &lt; $XML::DOM::current_indent; $i++&#41;
+                {
+		    $FILE-&gt;print &#40;$XML::DOM::string_indent&#41;;
+		}
+	    }
+	    $XML::DOM::need_indent[$XML::DOM::current_print_level] = 0;
+	}
 	$FILE-&gt;print &#40;&#34;&lt;/$name&gt;&#34;&#41;;
+	$XML::DOM::current_print_level--;
+	if &#40;$XML::DOM::beautifying&#41; 
+        {
+	    $FILE-&gt;print &#40;&#34;\n&#34;&#41;;
+	}
     }
     else
     {
@@ -2750,6 +2789,10 @@
 	{
 	    $FILE-&gt;print &#40;&#34; /&gt;&#34;&#41;;
 	}
+	if &#40;$XML::DOM::beautifying&#41;
+	{
+	    $FILE-&gt;print &#40;&#34;\n&#34;&#41;;
+        }
     }
 }
 
@@ -3174,7 +3217,24 @@
 sub print
 {
     my &#40;$self, $FILE&#41; = @_;
-    $FILE-&gt;print &#40;XML::DOM::encodeText &#40;$self-&gt;getData, &#39;&lt;&#38;&gt;&#34;&#39;&#41;&#41;;
+    my &#40;$s&#41; = XML::DOM::encodeText &#40;$self-&gt;getData, &#39;&lt;&#38;&gt;&#34;&#39;&#41;;
+    if &#40;$XML::DOM::beautifying&#41; 
+    {
+        $s =~ s@^[\s\n]*&#40;.*&#41;[\s\n]*$@$1@so;
+	$s =~ s@\n\s*@\n@gm;
+	if &#40;length&#40;$s&#41; + $XML::DOM::current_print_level &gt; 48&#41;
+	{
+	    $XML::DOM::need_indent[$XML::DOM::current_print_level] = 1;
+	    $s = &#34;\n$s\n&#34;;
+	    $s =~ s@\n\n$@\n@;
+	}
+	else 
+        {
+	    $XML::DOM::need_indent[$XML::DOM::current_print_level] = 0;
+	    $s =~ s@\n$@@;
+	}
+    }
+    $FILE-&gt;print &#40;$s&#41;;
 }
 
 sub isTextNode
@@ -4198,7 +4258,7 @@
 {
     my &#40;$class, %args&#41; = @_;
 
-    $args{Style} = &#39;XML::Parser::Dom&#39;;
+    $args{Style} = &#39;Dom&#39;;
     $class-&gt;SUPER::new &#40;%args&#41;;
 }
 
@@ -4264,30 +4324,30 @@
 	# request, which we could convert to a stream with a fork&#40;&#41;...
 
 	my $result;
-	eval
-	{
-	    use LWP::UserAgent;
-
-	    my $ua = $self-&gt;{LWP_UserAgent};
-	    unless &#40;defined $ua&#41;
-	    {
-		unless &#40;defined $LWP_USER_AGENT&#41;
-		{
-		    $LWP_USER_AGENT = LWP::UserAgent-&gt;new;
-
-		    # Load proxy settings from environment variables, i.e.:
-		    # http_proxy, ftp_proxy, no_proxy etc. &#40;see LWP::UserAgent&#40;3&#41;&#41;
-		    # You need these to go thru firewalls.
-		    $LWP_USER_AGENT-&gt;env_proxy;
-		}
-		$ua = $LWP_USER_AGENT;
-	    }
-	    my $req = new HTTP::Request &#39;GET&#39;, $url;
-	    my $response = $ua-&gt;request &#40;$req&#41;;
+# 	eval
+# 	{
+# 	    use LWP::UserAgent;
 
-	    # Parse the result of the HTTP request
-	    $result = $self-&gt;parse &#40;$response-&gt;content, @_&#41;;
-	};
+# 	    my $ua = $self-&gt;{LWP_UserAgent};
+# 	    unless &#40;defined $ua&#41;
+# 	    {
+# 		unless &#40;defined $LWP_USER_AGENT&#41;
+# 		{
+# 		    $LWP_USER_AGENT = LWP::UserAgent-&gt;new;
+
+# 		    # Load proxy settings from environment variables, i.e.:
+# 		    # http_proxy, ftp_proxy, no_proxy etc. &#40;see LWP::UserAgent&#40;3&#41;&#41;
+# 		    # You need these to go thru firewalls.
+# 		    $LWP_USER_AGENT-&gt;env_proxy;
+# 		}
+# 		$ua = $LWP_USER_AGENT;
+# 	    }
+# 	    my $req = new HTTP::Request &#39;GET&#39;, $url;
+# 	    my $response = $ua-&gt;request &#40;$req&#41;;
+
+# 	    # Parse the result of the HTTP request
+# 	    $result = $self-&gt;parse &#40;$response-&gt;content, @_&#41;;
+# 	};
 	if &#40;$@&#41;
 	{
 	    die &#34;Couldn&#39;t parsefile [$url] with LWP: $@&#34;;
@@ -4900,7 +4960,7 @@
 =item $VERSION
 
 The variable $XML::DOM::VERSION contains the version number of this 
-implementation, e.g. &#34;1.43&#34;.
+implementation, e.g. &#34;1.42&#34;.
 
 =back
 
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
