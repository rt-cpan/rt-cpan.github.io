<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #121350 for Text-CSV_XS: bind_columns with old values</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #121350 for Text-CSV_XS: bind_columns with old values</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-CSV_XS">Text-CSV_XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">121350</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Text-CSV_XS/Active/">Text-CSV_XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
felix.ostmann [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-31868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;24&nbsp;10:38:21&nbsp;2017</span>
    <span class="description">felix.ostmann [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bind_columns with old values</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Missing columns get values from previous rows if the separator is missing

SCRIPT:
use 5.18.1;
use warnings;
use Text::CSV_XS;

my $data = &lt;&lt;__CSV__;
owner,admin
1,1
2
3,
4,4
__CSV__

open my $fh, &#34;&lt;&#34;, \$data;

my $csv = Text::CSV_XS-&gt;new &#40;{ auto_diag =&gt; 1 }&#41;;
my %row;
$csv-&gt;bind_columns &#40;\@row{@{$csv-&gt;getline &#40;$fh&#41;}}&#41;;
while &#40;$csv-&gt;getline &#40;$fh&#41;&#41; {
    printf &#34;owner: %s ; admin: %s\n&#34;,
        $row{owner},
        $row{admin},
    ;
}


OUTPUT:
owner: 1 ; admin: 1
owner: 2 ; admin: 1
owner: 3 ; admin: 
owner: 4 ; admin: 4


I expected for owner 2 a empty admin and not the value from the previous owner.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;24&nbsp;11:26:19&nbsp;2017</span>
    <span class="description">HMBRAND [...] cpan.org -  Severity Critical changed to Normal</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;24&nbsp;11:26:20&nbsp;2017</span>
    <span class="description">HMBRAND [...] cpan.org -  Broken in 1.28 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;24&nbsp;11:26:20&nbsp;2017</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is documented behavior. See the last paragraph of the docs for bind_columns. That is why I will close this ticket as invalid. Nothing personal: I understand your expectation.

--8&lt;---
   bind_columns
       Takes a list of scalar references to be used for output with  &#34;print&#34;
       or to store in the fields fetched by &#34;getline&#34;.  When you do not pass
       enough references to store the fetched fields in, &#34;getline&#34; will fail
       with error 3006.  If you pass more than there are fields to return,
       the content of the remaining references is left untouched.

        $csv-&gt;bind_columns &#40;\$code, \$name, \$price, \$description&#41;;
        while &#40;$csv-&gt;getline &#40;$io&#41;&#41; {
            print &#34;The price of a $name is \x{20ac} $price\n&#34;;
            }

       To reset or clear all column binding, call &#34;bind_columns&#34; with the
       single argument &#34;undef&#34;. This will also clear column names.

        $csv-&gt;bind_columns &#40;undef&#41;;

       If no arguments are passed at all, &#34;bind_columns&#34; will return the list
       of current bindings or &#34;undef&#34; if no binds are active.

       Note that in parsing with  &#34;bind_columns&#34;,  the fields are set on the
       fly.  That implies that if the third field  of a row  causes an error,
       the first two fields already have been assigned the values of the
       current row,  while the rest will still hold the values of the previous
       row.
--&gt;8---

This behavior is because of speed: 98% of all CSV datasets &#40;estimated guess, it might even be more than that&#41; have rows with the same number of fields for each row. Clearing all remaining fields after error states or incomplete rows will seriously slow down the general case.

If you want the behavior you expect, you should create an after_parse hook.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;24&nbsp;11:26:20&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;24&nbsp;11:26:25&nbsp;2017</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;25&nbsp;04:12:47&nbsp;2017</span>
    <span class="description">felix.ostmann [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> felix.ostmann [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, i understand that approach, but i would suggest the saver way: make the modul work with default options in 100% of input data and for someone who needs the speed add something like a option to disable the save way.

In my case it was horrible wrong to have values from old rows and i guess that can hit others easily too.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;25&nbsp;06:04:44&nbsp;2017</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #121350] bind_columns with old values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 Apr 2017 12:03:02 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ok, i understand that approach, but i would suggest the saver way:
&gt; make the modul work with default options in 100% of input data and
&gt; for someone who needs the speed add something like a option to
&gt; disable the save way.
</div>
Absolutely not. The way it currently works *is* safe. I *know* of
processes that *depend* on this behavior.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In my case it was horrible wrong to have values from old rows and i
&gt; guess that can hit others easily too.
</div>
In that case, you might be &#40;very&#41; interested in the new strict
attribute that just got pushed to github. You can checkout and test if
that fits your needs. This option was on my TODO list for a long time,
but your ticket triggered me to actually implement and test it

$ cat rt121350.pl
use 5.18.1;
use warnings;
use Text::CSV_XS;

my $data = &lt;&lt;&#34;__CSV__&#34;;
owner,admin
1,1
2
3,
4,4
__CSV__

open my $fh, &#34;&lt;&#34;, \$data;

my $csv = Text::CSV_XS-&gt;new &#40;{ auto_diag =&gt; 1, strict =&gt; 1 }&#41;;
my %row;
$csv-&gt;bind_columns &#40;\@row{@{$csv-&gt;getline &#40;$fh&#41;}}&#41;;
while &#40;$csv-&gt;getline &#40;$fh&#41;&#41; {
    printf &#34;owner: %s ; admin: %s\n&#34;, $row{owner}, $row{admin};
    }
$ perl rt121350.pl
owner: 1 ; admin: 1
# CSV_XS ERROR: 2014 - ENF - Inconsistent number of fields @ rec 3 pos 3 field 1

-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>   Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using perl5.00307 .. 5.25   porting perl5 on HP-UX, AIX, and openSUSE
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org/">http://www.test-smoke.org/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1722408/925963/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 473b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;25&nbsp;07:27:26&nbsp;2017</span>
    <span class="description">felix.ostmann [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> felix.ostmann [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Di 25. Apr 2017, 06:04:44, h.m.brand@xs4all.nl schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Ok, i understand that approach, but i would suggest the saver way:
&gt; &gt; make the modul work with default options in 100% of input data and
&gt; &gt; for someone who needs the speed add something like a option to
&gt; &gt; disable the save way.
</div>&gt; 
&gt; Absolutely not. The way it currently works *is* safe. I *know* of
&gt; processes that *depend* on this behavior.
</div>
OK, this is a point where religion wars can start ...

I get input from customers and end up with wrong data. In my opinion a good modul should save me with the default options. I see that at this point it is not possible to switch that anymore &#40;because somone might depend on the current behavior&#41;. 



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; In my case it was horrible wrong to have values from old rows and i
&gt; &gt; guess that can hit others easily too.
</div>&gt; 
&gt; In that case, you might be &#40;very&#41; interested in the new strict
&gt; attribute that just got pushed to github. You can checkout and test if
&gt; that fits your needs. This option was on my TODO list for a long time,
&gt; but your ticket triggered me to actually implement and test it
</div>
yeah, works as expected and is my favorite beloved possibility to deal with ambignious data :&#41; don&#39;t accept it! If only this could be the default behavior ... ;&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; $ cat rt121350.pl
&gt; use 5.18.1;
&gt; use warnings;
&gt; use Text::CSV_XS;
&gt; 
&gt; my $data = &lt;&lt;&#34;__CSV__&#34;;
&gt; owner,admin
&gt; 1,1
&gt; 2
&gt; 3,
&gt; 4,4
&gt; __CSV__
&gt; 
&gt; open my $fh, &#34;&lt;&#34;, \$data;
&gt; 
&gt; my $csv = Text::CSV_XS-&gt;new &#40;{ auto_diag =&gt; 1, strict =&gt; 1 }&#41;;
&gt; my %row;
&gt; $csv-&gt;bind_columns &#40;\@row{@{$csv-&gt;getline &#40;$fh&#41;}}&#41;;
&gt; while &#40;$csv-&gt;getline &#40;$fh&#41;&#41; {
&gt;     printf &#34;owner: %s ; admin: %s\n&#34;, $row{owner}, $row{admin};
&gt;     }
&gt; $ perl rt121350.pl
&gt; owner: 1 ; admin: 1
&gt; # CSV_XS ERROR: 2014 - ENF - Inconsistent number of fields @ rec 3 pos
&gt; 3 field 1
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;25&nbsp;08:30:45&nbsp;2017</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #121350] bind_columns with old values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 Apr 2017 14:30:02 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 25 Apr 2017 07:27:29 -0400, &#34;Felix Antonius Wilhelm Ostmann via
RT&#34; &lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Text-CSV_XS
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=121350">https://rt.cpan.org/Ticket/Display.html?id=121350</a></span> &gt;
&gt; 
&gt; Am Di 25. Apr 2017, 06:04:44, h.m.brand@xs4all.nl schrieb:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Ok, i understand that approach, but i would suggest the saver way:
&gt; &gt; &gt; make the modul work with default options in 100% of input data and
&gt; &gt; &gt; for someone who needs the speed add something like a option to
&gt; &gt; &gt; disable the save way.  
</div>&gt; &gt;
&gt; &gt; Absolutely not. The way it currently works *is* safe. I *know* of
&gt; &gt; processes that *depend* on this behavior.  
</div>&gt; 
&gt; OK, this is a point where religion wars can start ...
&gt; 
&gt; I get input from customers and end up with wrong data. In my opinion
&gt; a good modul should save me with the default options.
</div>
A good module offers not only basic functionality, but also a test
suite and documentation that covers all options. Most options are
implemented as attributes and stem from direct wishes from users.
They were not all a result of my devious mind. &#40;Some are though&#41;

Keep in mind that this module is written with SPEED &#40;yes, in capitals&#41;
is a primary goal &#40;after correctness of course&#41;.

If *you* choose to use bind_column because of speed &#40;which you should,
as it can cause a lot of speed-up&#41;, you inherently choose to take the
side-effects that come with it &#40;and are documented&#41;.

If you would not use bind_columns, you could check the size of the row
inside your parsing loop. If you choose to use bind_columns, with the
current implementation and documented side-effects, you can not state
that it has erroneous behavior. There are &#40;many&#41; alternatives to work
around that issue.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I see that at this point it is not possible to switch that anymore
&gt; &#40;because somone might depend on the current behavior&#41;.
</div>
not might. I&#39;m very sure about it.

Even if it were possible, I would not. It is not a rare case that data
is set up so that trailing columns are expected to be copies of the row
above.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; In my case it was horrible wrong to have values from old rows and
&gt; &gt; &gt; i guess that can hit others easily too.  
</div>&gt; &gt;
&gt; &gt; In that case, you might be &#40;very&#41; interested in the new strict
&gt; &gt; attribute that just got pushed to github. You can checkout and test
&gt; &gt; if that fits your needs. This option was on my TODO list for a long
&gt; &gt; time, but your ticket triggered me to actually implement and test
&gt; &gt; it  
</div>&gt; 
&gt; yeah, works as expected and is my favorite beloved possibility to
&gt; deal with ambignious data :&#41; don&#39;t accept it! If only this could be
&gt; the default behavior ... ;&#41;
</div>
The only default behavior that I seriously want to change - but cannot
due to backward incompatibilities - is the default for the binary
attribute. That should have been default from the start. But alas, I
did not write the first version. As you will probably need a default
list of attributes like binary and auto_diag, having strict in there as
well shouldn&#39;t be too much of a strain

  my $csv = Text::CSV_XS-&gt;new &#40;{ binary =&gt; 1, strict =&gt; 1, auto_diag =&gt; 1 }&#41;;

FWIW I also now implemented the same option in Text::CSV for perl6,
where it *also* defaults to False. The invocation is simpler though, as
in the perl6 module I was able to make binary the default

  my $csv = Text::CSV.new &#40;:strict, :auto-diag&#41;;

I&#39;ll start the test phase and will try to get out this new version asap
for you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; $ cat rt121350.pl
&gt; &gt; use 5.18.1;
&gt; &gt; use warnings;
&gt; &gt; use Text::CSV_XS;
&gt; &gt;
&gt; &gt; my $data = &lt;&lt;&#34;__CSV__&#34;;
&gt; &gt; owner,admin
&gt; &gt; 1,1
&gt; &gt; 2
&gt; &gt; 3,
&gt; &gt; 4,4
&gt; &gt; __CSV__
&gt; &gt;
&gt; &gt; open my $fh, &#34;&lt;&#34;, \$data;
&gt; &gt;
&gt; &gt; my $csv = Text::CSV_XS-&gt;new &#40;{ auto_diag =&gt; 1, strict =&gt; 1 }&#41;;
&gt; &gt; my %row;
&gt; &gt; $csv-&gt;bind_columns &#40;\@row{@{$csv-&gt;getline &#40;$fh&#41;}}&#41;;
&gt; &gt; while &#40;$csv-&gt;getline &#40;$fh&#41;&#41; {
&gt; &gt;     printf &#34;owner: %s ; admin: %s\n&#34;, $row{owner}, $row{admin};
&gt; &gt;     }
&gt; &gt; $ perl rt121350.pl
&gt; &gt; owner: 1 ; admin: 1
&gt; &gt; # CSV_XS ERROR: 2014 - ENF - Inconsistent number of fields @ rec 3
&gt; &gt; pos 3 field 1  
</div>
-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>   Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using perl5.00307 .. 5.25   porting perl5 on HP-UX, AIX, and openSUSE
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org/">http://www.test-smoke.org/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1722413/925970/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 473b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
