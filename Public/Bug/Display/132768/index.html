<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #132768 for Net-SFTP-Foreign: directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #132768 for Net-SFTP-Foreign: directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SFTP-Foreign">Net-SFTP-Foreign CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">132768</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SFTP-Foreign/Active/">Net-SFTP-Foreign</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rosert.20.ftumsh [...] xoxy.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23164-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23165-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;06:50:57&nbsp;2020</span>
    <span class="description">rosert.20.ftumsh [...] xoxy.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2020 11:27:15 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-net-sftp-foreign [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rosert.20.ftumsh [...] xoxy.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

It looks like the 1.90_1 doesn&#39;t work.

I get the error &#39; directory listing failed: Couldn&#39;t read directory 
&#39;/foo&#39;: bad packet sequence, expected 3, got 4&#39;

when the directory is empty and also when it has a certain number of 
files. That number varies depending upon the size of file.

For example 14 or more files of 1 byte in size cause the error. 13 or 
fewer works as expected. When I changed to 1000byte size files I still 
got the error with 13 files. &#40;I didn&#39;t test fewer files&#41;.


#  This is Net::SFTP::Foreign 1.90_01
#  Loaded from /usr/local/share/perl5/Net/SFTP/Foreign.pm
#  Running on Perl v5.10.1 for linux
#  debug set to 65536
#  ~0 is 18446744073709551615
#  Using backend Net::SFTP::Foreign::Backend::Unix 1.88_02
OpenSSH_5.3p1, OpenSSL 1.0.1e-fips 11 Feb 2013

Warmly

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;07:04:10&nbsp;2020</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 04 06:50:57 2020, rosert.20.ftumsh@xoxy.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
</div>
Hi!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It looks like the 1.90_1 doesn&#39;t work.
&gt; 
&gt; I get the error &#39; directory listing failed: Couldn&#39;t read directory 
&gt; &#39;/foo&#39;: bad packet sequence, expected 3, got 4&#39;
&gt; 
</div>
Could you enable debugging, rerun your program and post here &#40;or send it directly to me by email, if you thing it may include any sensible information&#41;?

Just add the following line at the beginning of your script:

$Net::SFTP::Foreign::debug = -1;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;07:04:10&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;08:08:33&nbsp;2020</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 04 06:50:57 2020, rosert.20.ftumsh@xoxy.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; It looks like the 1.90_1 doesn&#39;t work.
</div>
Also, 1.90_01 is working for me, and by the error you get it could actually be an interoperability issue.

So, could you tell me which software and version is running on the remote side?

You can get it connecting with netcat or some similar tool to the remote server. For instance:

  $ nc localhost 22
  SSH-2.0-OpenSSH_8.2p1 Ubuntu-4
  ^C
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;09:02:17&nbsp;2020</span>
    <span class="description">rosert.20.ftumsh [...] xoxy.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132768] directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2020 14:01:59 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-net-sftp-foreign [...] rt.cpan.org &lt;bug-net-sftp-foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rosert.20.ftumsh [...] xoxy.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello!

Yes, I&#39;ll send what I can.

COuld you keep it off the public page please?

Warmly

John

On 04/06/2020 13:08, Salvador Fandino Garcia via RT - 
bug-Net-SFTP-Foreign@rt.cpan.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt;
&gt; On Thu Jun 04 06:50:57 2020, rosert.20.ftumsh@xoxy.net wrote:
<div class="message-stanza open">&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; It looks like the 1.90_1 doesn&#39;t work.
</div>&gt; Also, 1.90_01 is working for me, and by the error you get it could actually be an interoperability issue.
&gt;
&gt; So, could you tell me which software and version is running on the remote side?
&gt;
&gt; You can get it connecting with netcat or some similar tool to the remote server. For instance:
&gt;
&gt;    $ nc localhost 22
&gt;    SSH-2.0-OpenSSH_8.2p1 Ubuntu-4
&gt;    ^C
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;09:05:09&nbsp;2020</span>
    <span class="description">rosert.20.ftumsh [...] xoxy.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132768] directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2020 14:04:47 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-net-sftp-foreign [...] rt.cpan.org &lt;bug-net-sftp-foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rosert.20.ftumsh [...] xoxy.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As requested.

On 04/06/2020 13:08, Salvador Fandino Garcia via RT - 
bug-Net-SFTP-Foreign@rt.cpan.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt;
&gt; On Thu Jun 04 06:50:57 2020, rosert.20.ftumsh@xoxy.net wrote:
<div class="message-stanza open">&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; It looks like the 1.90_1 doesn&#39;t work.
</div>&gt; Also, 1.90_01 is working for me, and by the error you get it could actually be an interoperability issue.
&gt;
&gt; So, could you tell me which software and version is running on the remote side?
&gt;
&gt; You can get it connecting with netcat or some similar tool to the remote server. For instance:
&gt;
&gt;    $ nc localhost 22
&gt;    SSH-2.0-OpenSSH_8.2p1 Ubuntu-4
&gt;    ^C
&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;09:22:52&nbsp;2020</span>
    <span class="description">rosert.20.ftumsh [...] xoxy.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132768] directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2020 14:22:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-net-sftp-foreign [...] rt.cpan.org &lt;bug-net-sftp-foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rosert.20.ftumsh [...] xoxy.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just to be clear, this works with every other connection we have and 
they are numerous.

Here&#39;s code, cut down a little...


my%opts= &#40;
host =&gt; $args-&gt;{server_name},
port =&gt; $args-&gt;{port_} || 22,
user =&gt; $args-&gt;{user_},
more =&gt; [ qw&#40;-oStrictHostKeyChecking=no -oLogLevel=ERROR&#41;]
&#41;;
push@{$opts{more}}, &#39;-vvv&#39;if$args-&gt;{debug};
$Net::SFTP::Foreign::debug= $args-&gt;{debug} if$args-&gt;{debug};
if&#40; $args-&gt;{private_key} &#41; {
$opts{key_path} = $key_file;
$opts{passphrase} = $args-&gt;{password_} if$args-&gt;{password_};
}
elsif&#40; $args-&gt;{password_} &#41; {
$opts{password} = $args-&gt;{password_};
}
$sftp= Net::SFTP::Foreign-&gt;new&#40;%opts&#41;;
$sftp-&gt;setcwd&#40;$args-&gt;{dest_dir}&#41; or die&#34;unable to change cwd: &#34;. 
$sftp-&gt;error;
my$file_list= $sftp-&gt;ls or die&#39;directory listing failed: &#39;. $sftp-&gt;error;
On 04/06/2020 13:08, Salvador Fandino Garcia via RT - 
bug-Net-SFTP-Foreign@rt.cpan.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt;
&gt; On Thu Jun 04 06:50:57 2020, rosert.20.ftumsh@xoxy.net wrote:
<div class="message-stanza open">&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; It looks like the 1.90_1 doesn&#39;t work.
</div>&gt; Also, 1.90_01 is working for me, and by the error you get it could actually be an interoperability issue.
&gt;
&gt; So, could you tell me which software and version is running on the remote side?
&gt;
&gt; You can get it connecting with netcat or some similar tool to the remote server. For instance:
&gt;
&gt;    $ nc localhost 22
&gt;    SSH-2.0-OpenSSH_8.2p1 Ubuntu-4
&gt;    ^C
&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;10:40:43&nbsp;2020</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132768] directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2020 16:40:24 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SFTP-Foreign [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandiño &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 4/6/20 15:05, rosert.20.ftumsh@xoxy.net via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: Net-SFTP-Foreign
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt;
&gt; As requested.
</div>
You have set $Net::SFTP::Foreign::debug to 65536 but I need you to set 
it to -1 in order to enable all the debugging flags.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 04/06/2020 13:08, Salvador Fandino Garcia via RT -
&gt; bug-Net-SFTP-Foreign@rt.cpan.org wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt;&gt;
&gt;&gt; On Thu Jun 04 06:50:57 2020, rosert.20.ftumsh@xoxy.net wrote:
<div class="message-stanza open">&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; It looks like the 1.90_1 doesn&#39;t work.
</div>&gt;&gt; Also, 1.90_01 is working for me, and by the error you get it could actually be an interoperability issue.
&gt;&gt;
&gt;&gt; So, could you tell me which software and version is running on the remote side?
&gt;&gt;
&gt;&gt; You can get it connecting with netcat or some similar tool to the remote server. For instance:
&gt;&gt;
&gt;&gt;     $ nc localhost 22
&gt;&gt;     SSH-2.0-OpenSSH_8.2p1 Ubuntu-4
&gt;&gt;     ^C
&gt;&gt;
&gt;&gt;
&gt;&gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;10:47:40&nbsp;2020</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132768] directory listing failed: Couldn&#39;t read directory &#39;/foo&#39;: bad packet sequence, expected 3, got 4</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2020 16:47:30 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SFTP-Foreign [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandiño &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 4/6/20 15:22, rosert.20.ftumsh@xoxy.net via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: Net-SFTP-Foreign
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt;
&gt; Just to be clear, this works with every other connection we have and
&gt; they are numerous.
</div>
Yeah, that looks like an interoperability issue. Probably AWS is using 
their own implementation of the SFTP protocol.

In any case:

1&#41; Are you able to use any previous version of Net::SFTP::Foreign to 
connect to that AWS service and list or transfer files?

2&#41; Are you able to connect to other servers using Net::SFTP::Foreign 
version 1.90_01?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;24&nbsp;08:48:11&nbsp;2020</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 04 10:47:40 2020, sfandino@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On 4/6/20 15:22, rosert.20.ftumsh@xoxy.net via RT wrote:
<div class="message-stanza open">&gt; &gt;         Queue: Net-SFTP-Foreign
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt; &gt;
&gt; &gt; Just to be clear, this works with every other connection we have and
&gt; &gt; they are numerous.
</div>&gt; 
&gt; Yeah, that looks like an interoperability issue. Probably AWS is using 
&gt; their own implementation of the SFTP protocol.
</div>
Yeah, it seems that AWS_SFTP 1.0 server can reply in an out of order fashion. In theory, that is something that clients should support, but in practice, and until now, no server was doing it and Net::SFTP::Foreign relies on reply packets arriving in order.

As a work around you can disable pipelining:

$sftp = Net::SFPT::Foreign-&gt;new&#40;..., queue_size =&gt; 1&#41;


Unfortunatelly, disabling pipelining would probably reduce the transfer speed a lot.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;24&nbsp;14:54:56&nbsp;2020</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 24 08:48:11 2020, SALVA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Jun 04 10:47:40 2020, sfandino@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; On 4/6/20 15:22, rosert.20.ftumsh@xoxy.net via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt; Queue: Net-SFTP-Foreign
&gt; &gt; &gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132768">https://rt.cpan.org/Ticket/Display.html?id=132768</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Just to be clear, this works with every other connection we have
&gt; &gt; &gt; and
&gt; &gt; &gt; they are numerous.
</div>&gt; &gt;
&gt; &gt; Yeah, that looks like an interoperability issue. Probably AWS is
&gt; &gt; using
&gt; &gt; their own implementation of the SFTP protocol.
</div>&gt; 
&gt; Yeah, it seems that AWS_SFTP 1.0 server can reply in an out of order
&gt; fashion. In theory, that is something that clients should support, but
&gt; in practice, and until now, no server was doing it and
&gt; Net::SFTP::Foreign relies on reply packets arriving in order.
&gt; 
&gt; As a work around you can disable pipelining:
&gt; 
&gt; $sftp = Net::SFPT::Foreign-&gt;new&#40;..., queue_size =&gt; 1&#41;
&gt; 
&gt; 
&gt; Unfortunatelly, disabling pipelining would probably reduce the
&gt; transfer speed a lot.
</div>
I have released two new versions: the stable 1.91 that fixes the ls queue size bug and a development version, 1.92_01, that adds support for incoming out of order responses.

Could you check if 1.92_01 works for you?

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.92_01">https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.92_01</a></span>
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
