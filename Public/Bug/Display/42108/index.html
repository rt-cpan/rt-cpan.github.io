<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42108 for WebService-Simple-Google-Chart: [PATCH] Multiple Fixes and Improvements</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42108 for WebService-Simple-Google-Chart: [PATCH] Multiple Fixes and Improvements</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/WebService-Simple-Google-Chart/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/WebService-Simple-Google-Chart/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/WebService-Simple-Google-Chart/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/WebService-Simple-Google-Chart/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/WebService-Simple-Google-Chart">WebService-Simple-Google-Chart CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42108</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/WebService-Simple-Google-Chart/Active/">WebService-Simple-Google-Chart</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
michael [...] thegrebs.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-221932-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221933-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;02&nbsp;15:30:27&nbsp;2009</span>
    <span class="description">michael [...] thegrebs.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Multiple Fixes and Improvements</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch provides a couple of bugfixes as well as enhancements
against WebService::Simple::Google::Chart version 0.04.

The enhancements support sending the labels correctly for map and spark
line charts and allowing passing the data and labels as an arrayref in
addition to the current hashref method.  This allows preserving the
order of the fields, necessary for line charts and spark line charts.

Lastly, a bugfix.  The encoded values for the text encoded method are
meant to be percentage of the maximum value not percentage of the total
value as the module provides without this patch.  This is not noticeable
on pie charts or line/bar charts but is very noticeable on the map charts.

A sample of graphs produced with this module with the patch applied are
available at &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://thegrebs.com/spam/">http://thegrebs.com/spam/</a></span>&gt;.

The map and encoding sections of the patch were included in a patch I
emailed to you directly some months back.  If you don&#39;t have the time to
keep up with the module I would be interested in co-maintainer status
for the module so that I could upload a new release with this patch plus
a docs patch I&#39;m working on.

Mike
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Encode-values-as-of-max-not-of-total-as-specifie.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From a497183b36c90da73a46a022e19448606e0a4aa9 Mon Sep 17 00:00:00 2001
From: Michael Greb &lt;mgreb@linode.com&gt;
Date: Fri, 2 Jan 2009 15:17:24 -0500
Subject: [PATCH] Encode values as % of max not % of total as specified in API docs.
 Support map chart types
 Support spark line chart types
 Allow labels and values to be passed as array refs to preserve ordering

---
 lib/WebService/Simple/Google/Chart.pm |   31 ++++++++++++++++++++++---------
 1 files changed, 22 insertions&#40;+&#41;, 9 deletions&#40;-&#41;

diff --git a/lib/WebService/Simple/Google/Chart.pm b/lib/WebService/Simple/Google/Chart.pm
index b10ceaf..c712953 100644
--- a/lib/WebService/Simple/Google/Chart.pm
+++ b/lib/WebService/Simple/Google/Chart.pm
@@ -28,16 +28,29 @@ sub render_to_file {
 
 sub _set_data_param {
     my &#40;$self, $data&#41; = @_;
-    my &#40; @label, @value, $total_count &#41;;
-    $total_count = 0;
-    map { $total_count += $data-&gt;{$_} } keys %$data;
-    foreach my $key &#40; keys %$data &#41; {
-        push&#40; @label, $key &#41;;
-        my $percent = int&#40; $data-&gt;{$key} / $total_count * 100 + 0.5 &#41;;
-        push&#40; @value, $percent &#41;;
+    my &#40; @label, @value &#41;;
+
+    my $max = 0;
+    if &#40;ref&#40;$data&#41; eq &#39;HASH&#39;&#41; {
+        map { $max = $data-&gt;{$_} &gt; $max ? $data-&gt;{$_} : $max } keys %$data;
+        foreach my $key &#40; keys %$data &#41; {
+            push&#40; @label, $key &#41;;
+            push&#40; @value, sprintf&#40;&#34;%.1f&#34;, $data-&gt;{$key} / $max * 100&#41; &#41;;
+        }
+        my $data_param = {};
+    } else {
+        map { $max = $_ &gt; $max ? $_ : $max } @{$data-&gt;[1]};
+        @label = @{$data-&gt;[0]};
+        @value = map { sprintf&#40;&#34;%.1f&#34;, $_ / $max * 100&#41; } @{$data-&gt;[1]};
+    }
+
+    if &#40;$self-&gt;{request_param}{cht} ne &#39;ls&#39;&#41; {
+        if &#40;$self-&gt;{request_param}{cht} ne &#39;t&#39;&#41; {
+            $self-&gt;{request_param}-&gt;{chl} = join&#40; &#34;|&#34;, @label &#41;;
+        } else {
+            $self-&gt;{request_param}-&gt;{chld} = join&#40; &#34;&#34;, @label &#41;;
+        }
     }
-    my $data_param = {};
-    $self-&gt;{request_param}-&gt;{chl} = join&#40; &#34;|&#34;, @label &#41;;
     $self-&gt;{request_param}-&gt;{chd} = &#34;t:&#34; . join&#40; &#34;,&#34;, @value &#41;;
 }
 
-- 
1.6.0.5

</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
