<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #129481 for Template-Generate: code to handle [% ... %] in Template::Generate</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #129481 for Template-Generate: code to handle [% ... %] in Template::Generate</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Template-Generate/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Template-Generate/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Template-Generate/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Template-Generate/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Template-Generate">Template-Generate CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">129481</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Template-Generate/Active/">Template-Generate</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jacklangsdorf [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30824-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30825-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;07&nbsp;12:08:31&nbsp;2019</span>
    <span class="description">jacklangsdorf [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> code to handle [% ... %] in Template::Generate</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 May 2019 12:08:11 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> autrijus [...] autrijus.org, bug-Template-Generate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jack Langsdorf &lt;jacklangsdorf [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

I wrote some code that gives simple but notrivial generation of [% ... %]
in Template::Generate.

My concept is that every fixed string of length &gt; 1 in the template is
potentially replaced with the combination of a prefix, a [% ... %], and a
suffix. The prefix and suffix match for all cases.

The diff is attached.

Handling [% ... %] makes Template::Generate much more powerful when it is
being used to build a web scraping template - you no longer need to work
out all of the pieces of data that were used to generate the original
page. Given
a web page with a list of items with Template style formatting, if you
identify the data you want to grab from two of them, the script can find
the common template &#40;ignoring other junk in each listing&#41; and then you can
push that template back into Template::Extract to extract the data from the
entire list. See the attached example file. &#40;You do have to contribute the
strings that are associated with FOREACH and END manually.&#41;

ALSO, I noticed that Generate seems to sometimes miss cases if one of the
data items appears multiple times in the text, but the desired template
needs to ignore one case of the data item. In the attached
generate_and_extract.pl, if you search for google rather than slashdot, it
fails to find the template needed. All of the suggested templates have [%
rate %] before [% url %], because it picks up the unrelated A+ given to
slashdot.&#41; The case that we need is like the 0th case, but deleting
everything before the first &#34;.

0  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
%] [% comment %].[% ... %] [% rate %]&#39;

1  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
%] [% rate %] [% ... %] [% comment %]&#39;

2  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
%] [% comment %]&#39;

3  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
%] [% rate %] [% ... %] [% comment %].[% ... %] [% rate %]&#39;


I will see if I can find a fix for that bug.


Also, I notice that it is pretty slow when I run on large documents, like
1000 lines of html code. I will poke around and see if maybe there is a
faster way to implement it, perhaps using the index function rather than
regex. So I may send you another note at some point.


      - Jack Langsdorf
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;14&nbsp;15:11:06&nbsp;2019</span>
    <span class="description">jacklangsdorf [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129481] AutoReply: code to handle [% ... %] in Template::Generate</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 May 2019 15:10:21 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Template-Generate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jack Langsdorf &lt;jacklangsdorf [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello -

I rewrote the entire module, which I submit for your review.

This version uses index/substr instead of regex. It handles [% ... %]
correctly, and also handles cases where one of the data items appears more
than once correctly.

Compared to my previous submission on this bug which added the [% ... %]
handling, this version is 400x faster on my large testcase &#40;from 2.5
minutes to 0.33 seconds&#41;. In the testcase, I supply data for two items in a
list found on a webpage &#40;xkcd_blag.htm&#41; and then use Template::Generate to
generate the template for those items, then use Template::Extract to
recover the full list. &#40;During testing I renamed the module to Generate2.pm
and Generate3.pm for comparison&#41;.

       - Jack Langsdorf

On Tue, May 7, 2019 at 12:08 PM Bugs in Template-Generate via RT &lt;
bug-Template-Generate@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Greetings,
&gt;
&gt; This message has been automatically generated in response to the
&gt; creation of a trouble ticket regarding:
&gt;         &#34;code to handle [% ... %] in Template::Generate&#34;,
&gt; a summary of which appears below.
&gt;
&gt; There is no need to reply to this message right now.  Your ticket has been
&gt; assigned an ID of [rt.cpan.org #129481].  Your ticket is accessible
&gt; on the web at:
&gt;
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129481">https://rt.cpan.org/Ticket/Display.html?id=129481</a></span>
&gt;
&gt; Please include the string:
&gt;
&gt;          [rt.cpan.org #129481]
&gt;
&gt; in the subject line of all future correspondence about this issue. To do
&gt; so,
&gt; you may reply to this message.
&gt;
&gt;                         Thank you,
&gt;                         bug-Template-Generate@rt.cpan.org
&gt;
&gt; -------------------------------------------------------------------------
&gt; Hi!
&gt;
&gt; I wrote some code that gives simple but notrivial generation of [% ... %]
&gt; in Template::Generate.
&gt;
&gt; My concept is that every fixed string of length &gt; 1 in the template is
&gt; potentially replaced with the combination of a prefix, a [% ... %], and a
&gt; suffix. The prefix and suffix match for all cases.
&gt;
&gt; The diff is attached.
&gt;
&gt; Handling [% ... %] makes Template::Generate much more powerful when it is
&gt; being used to build a web scraping template - you no longer need to work
&gt; out all of the pieces of data that were used to generate the original
&gt; page. Given
&gt; a web page with a list of items with Template style formatting, if you
&gt; identify the data you want to grab from two of them, the script can find
&gt; the common template &#40;ignoring other junk in each listing&#41; and then you can
&gt; push that template back into Template::Extract to extract the data from the
&gt; entire list. See the attached example file. &#40;You do have to contribute the
&gt; strings that are associated with FOREACH and END manually.&#41;
&gt;
&gt; ALSO, I noticed that Generate seems to sometimes miss cases if one of the
&gt; data items appears multiple times in the text, but the desired template
&gt; needs to ignore one case of the data item. In the attached
&gt; generate_and_extract.pl, if you search for google rather than slashdot, it
&gt; fails to find the template needed. All of the suggested templates have [%
&gt; rate %] before [% url %], because it picks up the unrelated A+ given to
&gt; slashdot.&#41; The case that we need is like the 0th case, but deleting
&gt; everything before the first &#34;.
&gt;
&gt; 0  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
&gt; %] [% comment %].[% ... %] [% rate %]&#39;
&gt;
&gt; 1  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
&gt; %] [% rate %] [% ... %] [% comment %]&#39;
&gt;
&gt; 2  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
&gt; %] [% comment %]&#39;
&gt;
&gt; 3  &#39;[% ... %] [% rate %] [% ... %]&#34;[% url %]&#34;[% ... %]&gt;[% title %]&lt;[% ...
&gt; %] [% rate %] [% ... %] [% comment %].[% ... %] [% rate %]&#39;
&gt;
&gt;
&gt; I will see if I can find a fix for that bug.
&gt;
&gt;
&gt; Also, I notice that it is pretty slow when I run on large documents, like
&gt; 1000 lines of html code. I will poke around and see if maybe there is a
&gt; faster way to implement it, perhaps using the index function rather than
&gt; regex. So I may send you another note at some point.
&gt;
&gt;
&gt;       - Jack Langsdorf
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
