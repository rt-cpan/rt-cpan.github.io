<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #98284 for Helios: helios_config_get don&#39;t return config where --hostname=* when a value for the current host is set</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #98284 for Helios: helios_config_get don&#39;t return config where --hostname=* when a value for the current host is set</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Helios/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Helios/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Helios/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Helios/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Helios">Helios CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">98284</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Helios/Active/">Helios</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">LAJANDY [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
LAJANDY [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-223222-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
2.80</li>
<li>
2.801_3270</li>
<li>
2.801_3350</li>
<li>
2.81</li>
</ul>
    </td>
  </tr>
  <tr id="CF-223223-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<ul>
<li>
2.811_3850</li>
<li>
2.811_4150</li>
<li>
2.82</li>
</ul>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;23&nbsp;18:30:39&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> helios_config_get don&#39;t return config where --hostname=* when a
 value for the current host is set</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Issue the following commands to set a MAX_WORKERS parameter for Helios::TestService for all hosts and another for the current host:

helios_config_set --service=Helios::TestService --hostname=* --param=MAX_WORKERS --value=2
Service: Helios::TestService Host: * Param: MAX_WORKERS SET.

helios_config_set --service=Helios::TestService --param=MAX_WORKERS --value=5
Service: Helios::TestService Host: ubuntu-precise64-1 Param: MAX_WORKERS SET.

Now, use helios_config_get to retrieve the param values:

# don&#39;t specify host, you get current host, as expected
helios_config_get --service=Helios::TestService --param=MAX_WORKERS
5

# ask specifically for the parameter for all hosts, 
# and you still get the current host&#39;s parameter
helios_config_get --service=Helios::TestService --param=MAX_WORKERS --hostname=*
5

This use case runs counter to how Helios services are usually used, but you would expect to get the all hosts &#40;*&#41; parameter value if you specifically ask for it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;19&nbsp;21:17:30&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> helios_config_get doesn&#39;t return config where --hostname=* when a
 value for the current host is set</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The problem is with the Helios::Config-&gt;getParam&#40;&#41; method.  Helios::Config caches the config hash that results from a parseConfig&#40;&#41; call to reduce database queries and maximize performance.  The getParam&#40;&#41; method checks this hash for the requested parameter and returns its value if it is present.  

In this case, however, the user is asking not for the parameter set for this host, but for another host &#40;in the example, actually the special &#39;*&#39; all hosts value&#41;.  The getParam&#40;&#41; code that checks the cached config hash does not take into account the requested host is different than the current host, and incorrectly returns the cached value instead of querying the database for the correct value.

The offending code is this section of getParam&#40;&#41;:

        # shortcut: if the current config hash has already been retrieved
        # and the requested param is set, return *that* param
        if &#40; defined&#40;$self-&gt;getConfig&#40;&#41;&#41; &#38;&#38; defined&#40;$self-&gt;getServiceName&#41; &#38;&#38;
                &#40;$self-&gt;getServiceName eq $service_name&#41; &#38;&#38; 
                defined&#40;$self-&gt;getConfig&#40;&#41;-&gt;{$param_name}&#41; &#41; {
                return $self-&gt;getConfig&#40;&#41;-&gt;{$param_name};
        }

This if&#40;&#41; statement needs to take not only the service name into account but also the host.

On Sat Aug 23 18:30:39 2014, LAJANDY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Issue the following commands to set a MAX_WORKERS parameter for
&gt; Helios::TestService for all hosts and another for the current host:
&gt; 
&gt; helios_config_set --service=Helios::TestService --hostname=*
&gt; --param=MAX_WORKERS --value=2
&gt; Service: Helios::TestService Host: * Param: MAX_WORKERS SET.
&gt; 
&gt; helios_config_set --service=Helios::TestService --param=MAX_WORKERS
&gt; --value=5
&gt; Service: Helios::TestService Host: ubuntu-precise64-1 Param:
&gt; MAX_WORKERS SET.
&gt; 
&gt; Now, use helios_config_get to retrieve the param values:
&gt; 
&gt; # don&#39;t specify host, you get current host, as expected
&gt; helios_config_get --service=Helios::TestService --param=MAX_WORKERS
&gt; 5
&gt; 
&gt; # ask specifically for the parameter for all hosts,
&gt; # and you still get the current host&#39;s parameter
&gt; helios_config_get --service=Helios::TestService --param=MAX_WORKERS
&gt; --hostname=*
&gt; 5
&gt; 
&gt; This use case runs counter to how Helios services are usually used,
&gt; but you would expect to get the all hosts &#40;*&#41; parameter value if you
&gt; specifically ask for it.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;19&nbsp;21:17:31&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;19&nbsp;21:17:31&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;04&nbsp;23:07:58&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 2.811_3850.  Will be included in next stable release.

On Sat Aug 23 18:30:39 2014, LAJANDY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Issue the following commands to set a MAX_WORKERS parameter for
&gt; Helios::TestService for all hosts and another for the current host:
&gt; 
&gt; helios_config_set --service=Helios::TestService --hostname=*
&gt; --param=MAX_WORKERS --value=2
&gt; Service: Helios::TestService Host: * Param: MAX_WORKERS SET.
&gt; 
&gt; helios_config_set --service=Helios::TestService --param=MAX_WORKERS
&gt; --value=5
&gt; Service: Helios::TestService Host: ubuntu-precise64-1 Param:
&gt; MAX_WORKERS SET.
&gt; 
&gt; Now, use helios_config_get to retrieve the param values:
&gt; 
&gt; # don&#39;t specify host, you get current host, as expected
&gt; helios_config_get --service=Helios::TestService --param=MAX_WORKERS
&gt; 5
&gt; 
&gt; # ask specifically for the parameter for all hosts,
&gt; # and you still get the current host&#39;s parameter
&gt; helios_config_get --service=Helios::TestService --param=MAX_WORKERS
&gt; --hostname=*
&gt; 5
&gt; 
&gt; This use case runs counter to how Helios services are usually used,
&gt; but you would expect to get the all hosts &#40;*&#41; parameter value if you
&gt; specifically ask for it.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;04&nbsp;23:07:58&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Fixed in 2.811_3850 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;23&nbsp;20:49:57&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Aug 23 18:30:39 2014, LAJANDY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Issue the following commands to set a MAX_WORKERS parameter for
&gt; Helios::TestService for all hosts and another for the current host:
&gt; 
&gt; helios_config_set --service=Helios::TestService --hostname=*
&gt; --param=MAX_WORKERS --value=2
&gt; Service: Helios::TestService Host: * Param: MAX_WORKERS SET.
&gt; 
&gt; helios_config_set --service=Helios::TestService --param=MAX_WORKERS
&gt; --value=5
&gt; Service: Helios::TestService Host: ubuntu-precise64-1 Param:
&gt; MAX_WORKERS SET.
&gt; 
&gt; Now, use helios_config_get to retrieve the param values:
&gt; 
&gt; # don&#39;t specify host, you get current host, as expected
&gt; helios_config_get --service=Helios::TestService --param=MAX_WORKERS
&gt; 5
&gt; 
&gt; # ask specifically for the parameter for all hosts,
&gt; # and you still get the current host&#39;s parameter
&gt; helios_config_get --service=Helios::TestService --param=MAX_WORKERS
&gt; --hostname=*
&gt; 5
&gt; 
&gt; This use case runs counter to how Helios services are usually used,
&gt; but you would expect to get the all hosts &#40;*&#41; parameter value if you
&gt; specifically ask for it.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;23&nbsp;20:49:58&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;23&nbsp;20:49:58&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Fixed in 2.811_4150 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;23&nbsp;20:49:58&nbsp;2014</span>
    <span class="description">LAJANDY [...] cpan.org -  Fixed in 2.82 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
