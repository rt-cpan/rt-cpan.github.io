<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #51486 for Moose: defaults are applied before all args from new&#40;&#41; are assigned</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #51486 for Moose: defaults are applied before all args from new&#40;&#41; are assigned</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Moose">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Moose">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Moose">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Moose">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moose">Moose CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">51486</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Moose">Moose</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">stevan.little [...] gmail.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mschwern [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-38786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.92    </td>
  </tr>
  <tr id="CF-38787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




bugs.plx<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/690076/355188/bugs.plx">
Fri Nov 13 02:02:23 2009 (765b) by mschwern [...] cpan.org
</a>
</font></li>
</ul>


defaults_last.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/690741/355593/defaults_last.patch">
Sat Nov 14 13:18:46 2009 (955b) by schwern [...] pobox.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=51486">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690076" href="/Public/Bug/Display.html?id=51486#txn-690076">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;02:02:23&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> defaults are applied before all args from new&#40;&#41; are assigned</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/690076/355185/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355185">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 305b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems like attribute defaults are run before all the arguments from
new&#40;&#41; are set in the object.  This causes problems if a default
references another attribute, it won&#39;t yet be populated.  The attached
test demonstrates.

A work around is to set the attribute as lazy, but this behavior is
Surprising.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bugs.plx</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/690076/355188/bugs.plx">Download bugs.plx</a><br />
<span class="downloadcontenttype">application/octet-stream 765b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690085" href="/Public/Bug/Display.html?id=51486#txn-690085">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;02:31:03&nbsp;2009</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #51486] defaults are applied before all args from new&#40;&#41; are assigned </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Nov 2009 01:30:51 -0600 &#40;CST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michael G Schwern via RT &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/690085/355191/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355191">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 987b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 13 Nov 2009, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems like attribute defaults are run before all the arguments from
&gt; new&#40;&#41; are set in the object.  This causes problems if a default
&gt; references another attribute, it won&#39;t yet be populated.  The attached
&gt; test demonstrates.
</div>
Actually, you left a &#34;lazy =&gt; 1&#34; that makes your test pass.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A work around is to set the attribute as lazy, but this behavior is
&gt; Surprising.
</div>
The manual does mention this gotcha in several places and specifically 
says:

  When the &#34;default&#34; is called during object construction, it may be called
  before other attributes have been set. If your default is dependent on
  other parts of the object&#39;s state, you can make the attribute &#34;lazy&#34;.


-dave

/*============================================================
<span class="clickylink"><a target="new" rel="nofollow" href="http://VegGuide.org">http://VegGuide.org</a></span>               <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.urth.org">http://blog.urth.org</a></span>
Your guide to all that&#39;s veg      House Absolute&#40;ly Pointless&#41;
============================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690086" href="/Public/Bug/Display.html?id=51486#txn-690086">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;02:31:04&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690182" href="/Public/Bug/Display.html?id=51486#txn-690182">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;06:53:33&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/690182/355255/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355255">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 291b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">As Dave pointed out, this gotcha is mentioned in the manual.

The order of attribute initialization is hash order and therefore not to be relied upon. If you 
need control over the ordering use lazy. Sorry this is surprising to you, but it is not a bug, it is 
documented behavior.

- Stevan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690185" href="/Public/Bug/Display.html?id=51486#txn-690185">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;06:53:35&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690186" href="/Public/Bug/Display.html?id=51486#txn-690186">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;06:53:36&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Given to STEVAN</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690188" href="/Public/Bug/Display.html?id=51486#txn-690188">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;07:01:29&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/690188/355258/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355258">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 338b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Quoted from Moose::Meta::Attribute docs:

&#34;Note that there is no guarantee that attributes are initialized in any particular order, so you cannot rely on the value of some other attribute when generating the default.&#34;

FWIW, I would be willing to accept a patch to make this more explicit in the other docs so as to 
not be as surprising.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690189" href="/Public/Bug/Display.html?id=51486#txn-690189">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;07:01:30&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690197" href="/Public/Bug/Display.html?id=51486#txn-690197">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;07:10:19&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690469" href="/Public/Bug/Display.html?id=51486#txn-690469">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;19:45:50&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/690469/355419/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355419">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 612b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 13 07:01:29 2009, STEVAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Quoted from Moose::Meta::Attribute docs:
&gt; 
&gt; &#34;Note that there is no guarantee that attributes are initialized in
&gt; any particular order, so you cannot rely on the value of some other
&gt; attribute when generating the default.&#34;
</div>
I don&#39;t see that in the 0.92 docs.  Ahh, its in Class::MOP::Attribute. 
Of course. :/


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; FWIW, I would be willing to accept a patch to make this more explicit
&gt; in the other docs so as to not be as surprising.
</div>
Instead of putting bigger signs around the pit, could we fill in the
pit?  Is there a good reason defaults aren&#39;t applied last?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690470" href="/Public/Bug/Display.html?id=51486#txn-690470">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;19:45:51&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690502" href="/Public/Bug/Display.html?id=51486#txn-690502">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;21:23:21&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/690502/355454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 13 19:45:50 2009, MSCHWERN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Nov 13 07:01:29 2009, STEVAN wrote:
<div class="message-stanza open">&gt; &gt; Quoted from Moose::Meta::Attribute docs:
&gt; &gt; 
&gt; &gt; &#34;Note that there is no guarantee that attributes are initialized in
&gt; &gt; any particular order, so you cannot rely on the value of some other
&gt; &gt; attribute when generating the default.&#34;
</div>&gt; 
&gt; I don&#39;t see that in the 0.92 docs.  Ahh, its in Class::MOP::Attribute. 
&gt; Of course. :/
</div>
Sorry, yes you are correct.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; FWIW, I would be willing to accept a patch to make this more explicit
&gt; &gt; in the other docs so as to not be as surprising.
</div>&gt; 
&gt; Instead of putting bigger signs around the pit, could we fill in the
&gt; pit?  
</div>
Honestly, it is a pit people fall in once, perhaps twice, but probably no more then a handful of times before they learn that if you need 
control over this, you use lazy. We really try hard to balance between trying to not surprise new users and making sure advanced users 
are not hampered. You may not agree with the choices we make regarding this, and that is your right, but know that they were not made 
hastily and often times were pondered over days, weeks, months and even years. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a good reason defaults aren&#39;t applied last?
</div>
Because that doesn&#39;t solve the problem, what if the other attribute you want to call also has a default? Trust me, we have thought this 
one through pretty extensively and we even had a discussion again about it this morning after I saw your bug. Trying to put a definitive 
and predictable order on attribute initialization is pretty hairy in the face of things like lazy attributes, roles, multiple inheritance, 
attribute overriding &#40;+foo&#41; and such. Sure it could be figured out, but we pretty much all agreed that the additional code and probable 
performance penalty would not be worth it when lazy exists and works exceedingly well in this capacity. 

Personally, I have a real aversion to having multiple features which are mostly similar but behave in subtly different ways. Which is pretty 
much what we would end up with since we almost certainly need some kind of lazy-like feature contained within the attribute 
initialization phase which would behave in subtly different ways from the real lazy. I find these types of things to be conceptual pits &#40;to 
borrow you analogy&#41; that are far more difficult for users to navigate and understand then something like &#34;when you need control over the 
ordering, just use lazy&#34;. 

All this said, I will leave this bug open as a reminder for us to include better docs that explain the lack of init ordering and reasons why 
&#39;lazy&#39; is the appropriate solution to that problem. Of course I would gladly accept a patch from you for this if you are so inclined.

If you are still interested in having this type of feature I suggest you contact Jesse Luehrs &#40;doy on IRC&#41; or Yuval Kogman &#40;nothingmuch on 
IRC&#41; as they both spent some time pondering a possible MooseX:: module for this based on attribute traits, I am sure they would be 
happy to pass on their ideas to you.

- Stevan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690741" href="/Public/Bug/Display.html?id=51486#txn-690741">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;14&nbsp;13:18:45&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #51486] defaults are applied before all args from new&#40;&#41; are assigned</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 14 Nov 2009 10:18:27 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/690741/355592/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355592">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Stevan Little via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Is there a good reason defaults aren&#39;t applied last?
</div>&gt; 
&gt; Because that doesn&#39;t solve the problem, what if the other attribute you want to call also has a default?
</div>
If A depends on B and B depends on A and neither are supplied then they&#39;re 
actually circular, its impossible to resolve and that&#39;s the user&#39;s fault. 
This would not be a surprise, at least not Moose&#39;s, as it would be a logic 
error with or without Moose.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Trust me, we have thought this 
&gt; one through pretty extensively and we even had a discussion again about it this morning after I saw your bug. Trying to put a definitive 
&gt; and predictable order on attribute initialization is pretty hairy in the face of things like lazy attributes, roles, multiple inheritance, 
&gt; attribute overriding &#40;+foo&#41; and such. Sure it could be figured out, but we pretty much all agreed that the additional code and probable 
&gt; performance penalty would not be worth it when lazy exists and works exceedingly well in this capacity. 
&gt; 
&gt; Personally, I have a real aversion to having multiple features which are mostly similar but behave in subtly different ways. Which is pretty 
&gt; much what we would end up with since we almost certainly need some kind of lazy-like feature contained within the attribute 
&gt; initialization phase which would behave in subtly different ways from the real lazy. I find these types of things to be conceptual pits &#40;to 
&gt; borrow you analogy&#41; that are far more difficult for users to navigate and understand then something like &#34;when you need control over the 
&gt; ordering, just use lazy&#34;. 
</div>
I can&#39;t argue about the details of Moose, but &#34;defaults are applied last&#34; 
doesn&#39;t seem like a conceptual pit.  Since initializing an object is an atomic 
operation from the user&#39;s perspective, when default is called within 
initialization isn&#39;t even under consideration.

There seems two very easy ways to handle it.  When you loop over the 
attributes initializing the object, do the user supplied keys first.  Or have 
two attribute initialization loops, the first does everything BUT defaults and 
the second applies defaults.

The former seems like its just a small change to 
Class::MOP::Class-&gt;_construct_instance&#40;&#41;.  It also seems like the least 
exceptional thing to do.  I&#39;ve attached a small patch which fixes the problem. 
  All Class::MOP and Moose tests pass without change.  It makes my bug test 
pass.  I&#39;ll whip up some Class::MOP tests if you want to take the patch.

It can be optimized to be O&#40;n&#41; instead of O&#40;n log n&#41; if its thought that&#39;s a 
realistic performance problem.


-- 
3. Not allowed to threaten anyone with black magic.
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/690741/355593/defaults_last.patch">Download defaults_last.patch</a><br />
<span class="downloadcontenttype">text/x-diff 955b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Class/MOP/Class.pm b/lib/Class/MOP/Class.pm
index 9e969ee..9f6c20d 100644
--- a/lib/Class/MOP/Class.pm
+++ b/lib/Class/MOP/Class.pm
@@ -361,7 +361,18 @@ sub _construct_instance {
     # but this is foreign inheritance, so we might
     # have to kludge it in the end.
     my $instance = $params-&gt;{__INSTANCE__} || $meta_instance-&gt;create_instance&#40;&#41;;
-    foreach my $attr &#40;$class-&gt;get_all_attributes&#40;&#41;&#41; {
+
+    # Init the user supplied attributes first so defaults don&#39;t get applied
+    # before the attribute is set.
+    my @attributes = sort {
+        my $aexists = exists $params-&gt;{$a-&gt;name};
+        my $bexists = exists $params-&gt;{$b-&gt;name};
+        return 0 unless $aexists xor $bexists;
+        return -1 if $aexists;
+        return 1  if $bexists;
+    } $class-&gt;get_all_attributes&#40;&#41;;
+
+    foreach my $attr &#40;@attributes&#41; {
         $attr-&gt;initialize_instance_slot&#40;$meta_instance, $instance, $params&#41;;
     }
     # NOTE:
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-690757" href="/Public/Bug/Display.html?id=51486#txn-690757">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;14&nbsp;13:36:36&nbsp;2009</span>
    <span class="description">hdp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/690757/355604/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/355604">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 800b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 14 13:18:45 2009, schwern@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Stevan Little via RT wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; Is there a good reason defaults aren&#39;t applied last?
</div>&gt; &gt;
&gt; &gt; Because that doesn&#39;t solve the problem, what if the other attribute
</div>&gt; you want to call also has a default?
&gt; 
&gt; If A depends on B and B depends on A and neither are supplied then
&gt; they&#39;re
&gt; actually circular, its impossible to resolve and that&#39;s the user&#39;s
&gt; fault.
&gt; This would not be a surprise, at least not Moose&#39;s, as it would be a
&gt; logic
&gt; error with or without Moose.
</div>
Wrong example.  What if A has a default and B has a default and neither
are supplied and A depends on B?  No circularity, but there&#39;s no way to
know that B&#39;s default needs to be set before A&#39;s.

Saying &#34;let&#39;s just do defaults last&#34; moves the problem instead of
solving it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-691839" href="/Public/Bug/Display.html?id=51486#txn-691839">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;01:53:42&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #51486] defaults are applied before all args from new&#40;&#41; are assigned</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Nov 2009 22:53:22 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/691839/356150/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/356150">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hans Dieter Pearcey via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wrong example.  What if A has a default and B has a default and neither
&gt; are supplied and A depends on B?  No circularity, but there&#39;s no way to
&gt; know that B&#39;s default needs to be set before A&#39;s.
</div>
Won&#39;t that auto-resolve?  Let&#39;s play this out.

# name depends on nothing
has name =&gt;
        is      =&gt; &#39;rw&#39;,
        isa     =&gt; &#39;Str&#39;,
        default =&gt; sub { &#34;Chuck&#34; }
;

# nickname depends on name
has nickname =&gt;
        is      =&gt; &#39;rw&#39;,
        isa     =&gt; &#39;Str&#39;,
        default =&gt; sub { $_[0]-&gt;name }
;

If nickname is called first, name is called, resolves to the default and 
nickname resolves fine.  Then name is checked and its already resolved.

If name is called first, name is resolved.  Then nickname is called, it calls 
name which is already resolved, and nickname resolves.

No problem, right?


-- 
151. The proper way to report to my Commander is &#34;Specialist Schwarz,
      reporting as ordered, Sir&#34; not &#34;You can&#39;t prove a thing!&#34;
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-691843" href="/Public/Bug/Display.html?id=51486#txn-691843">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;02:00:42&nbsp;2009</span>
    <span class="description">DOY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/691843/356153/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/356153">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 450b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 17 01:53:42 2009, schwern@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If nickname is called first, name is called, resolves to the default
&gt; and
&gt; nickname resolves fine.  Then name is checked and its already
&gt; resolved.
</div>
Nope, this is the entire reason you have to mark things lazy to get them
to work properly. When name is called, it won&#39;t automatically populate
the default unless the name attribute is lazy - otherwise, the initial
problem still occurs.

-doy
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-691901" href="/Public/Bug/Display.html?id=51486#txn-691901">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;04:15:09&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #51486] defaults are applied before all args from new&#40;&#41; are assigned</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Nov 2009 01:14:44 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/691901/356181/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/356181">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jesse Luehrs via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=51486">https://rt.cpan.org/Ticket/Display.html?id=51486</a></span> &gt;
&gt; 
&gt; On Tue Nov 17 01:53:42 2009, schwern@pobox.com wrote:
<div class="message-stanza open">&gt;&gt; If nickname is called first, name is called, resolves to the default
&gt;&gt; and
&gt;&gt; nickname resolves fine.  Then name is checked and its already
&gt;&gt; resolved.
</div>&gt; 
&gt; Nope, this is the entire reason you have to mark things lazy to get them
&gt; to work properly. When name is called, it won&#39;t automatically populate
&gt; the default unless the name attribute is lazy - otherwise, the initial
&gt; problem still occurs.
</div>
So it doesn&#39;t DWIM.  They&#39;re not part of the accessor but called separately 
during object instantiation?  So its not safe to have a default depend on 
another default. :&#40;

I might as well take this to its logical conclusion.  It seems like lazy 
solves a lot of problems.  Why isn&#39;t lazy the default?  Is there a drawback to 
lazy?

I can imagine there might be a performance hit for checking if the default has 
been applied, and I see that Class::MOP::Method::Generated adds an exists 
check to the accessor for lazy.  Benchmarking reveals a performance penalty of 
30-40% on accessor reads, wow!

So here is a situation where the default is faster, but unstable.

Its too bad this isn&#39;t object inheritance where each object&#39;s accessor could 
be replaced with a slimmer one as soon as the default was applied.

One solution would be during object instantiation to put into place full 
lazy/default style accessors and then remove them when instantiation is 
complete, but that would probably place a drag on object creation as well as 
introduce all sorts of fun side-effects.

Ok, so full stability of non-lazy interdependent defaults without a 
performance hit cannot be achieved. My patch still solves a good chunk of the 
problem. It doesn&#39;t move the problem, but reveals a deeper, but narrower, 
problem that was there all along.


-- 
124. Two drink limit does not mean first and last.
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-691938" href="/Public/Bug/Display.html?id=51486#txn-691938">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;07:04:26&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/691938/356203/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/356203">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 231b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is not a bug, you simply need to use &#40;lazy =&gt; 1&#41; and it will solve your problem, that is 
exactly the reason why that feature exists. Please use the mailing list next time, RT is not your 
personal Moose help-desk.

- Stevan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-691941" href="/Public/Bug/Display.html?id=51486#txn-691941">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;07:04:35&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-692329" href="/Public/Bug/Display.html?id=51486#txn-692329">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;18:48:44&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #51486] defaults are applied before all args from new&#40;&#41; are assigned</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Nov 2009 15:48:09 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/692329/356440/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/356440">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Stevan Little via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=51486">https://rt.cpan.org/Ticket/Display.html?id=51486</a></span> &gt;
&gt; 
&gt; This is not a bug, you simply need to use &#40;lazy =&gt; 1&#41; and it will solve your problem, that is 
&gt; exactly the reason why that feature exists. Please use the mailing list next time, RT is not your 
&gt; personal Moose help-desk.
</div>
Dude, I said from the beginning that setting lazy would &#34;solve&#34; it.  If I just 
wanted to just make my code work I&#39;d have left it at that.

Users shouldn&#39;t have to set magic flags or study the documentation to make 
things work sensibly.  They shouldn&#39;t have to set a 
make_it_work_right_but_a_little_slower flag 
&#40;make_it_work_wrong_but_a_little_faster would be better&#41;.  If you have to put 
caveats and warnings in the docs to steer the users away from the obvious 
choice of action that&#39;s a red flag and a source of user errors.

I also like to report when I fall into pits so that later when someone else 
reports it they don&#39;t get &#34;well you&#39;re the only one to report it so its not a 
problem&#34;.  Bugs reports are like cockroaches, for every that gets reported 
there&#39;s a hundred you don&#39;t.  Ten times that for interface problems which are 
technically not &#34;bugs&#34; and can be an uphill climb to convince the devs there&#39;s 
even a problem.

I made the effort to dig into Class::MOP and figure out what&#39;s going on.  I 
wrote my thinking out loud so maybe there could be a discussion or something. 
  I submitted a simple patch which passes all tests and fixes a good chunk of 
the problem.  I haven&#39;t been given a clear reason why it can&#39;t be applied as a 
partial solution.

I didn&#39;t get an answer as to why lazy is not the default.  If its for 
performance or just backwards compatibility, fine.  Just say so.  Until I know 
there&#39;s a good reason behind an awkward design choice I&#39;ll continue to pick at it.

These are not personal help desk tickets.  I found something hard to use, I 
want to make it easier for the next guy and a took a stab at patching it. 
That&#39;s what I do.  That&#39;s what you&#39;re supposed to do.

Not all bugs have an error message.


-- 
87. If the thought of something makes me giggle for longer than 15
     seconds, I am to assume that I am not allowed to do it.
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-692330" href="/Public/Bug/Display.html?id=51486#txn-692330">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;18:48:45&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-692381" href="/Public/Bug/Display.html?id=51486#txn-692381">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;22:34:31&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/692381/356475/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/356475">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dude, I said from the beginning that setting lazy would &#34;solve&#34; it.  If I just
&gt; wanted to just make my code work I&#39;d have left it at that.
</div>
But that is the whole point, if you leave it out then your accessor will *not* be
lazy and therefore will not exhibit the lazy behavior. We gave you a solution
&#40;actually you had it all along&#41; that works perfectly and allows for room to grow
even, but you decided you didn&#39;t want it, but wanted us to change core behavior
instead.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Users shouldn&#39;t have to set magic flags or study the documentation to make
&gt; things work sensibly.  They shouldn&#39;t have to set a
&gt; make_it_work_right_but_a_little_slower flag
</div>
Well to start with, lazy is not a &#34;magic flag&#34;, it is a flag that indicates the
generator accessor should behave in a certain way which is pretty clearly explained
in the docs and is really not all that hard to understand. It is one of those
features that straddles the line and will do easy things easily &#40;like your use
case&#41; and allows much more complex behaviors such as the Tree example in the
Cookbook &#40;which prevents infinite recursion in a circular data structure&#41;.

As for users studying the documentation, I disagree, I think if you want to learn
how to use a powerful tool, you are going to need to read some docs. It is simply
impossible for a tool as powerful as Moose to be so intuitive to everyone that
close study of the documentation is not required at some point.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;make_it_work_wrong_but_a_little_faster would be better&#41;.
</div>
I could not possibly disagree more with that statement, making it &#34;work wrong&#34;
but &#34;a little faster&#34; is not a compromise I am willing to take, I think my record
on this is clear, I prefer correctness over speed anyday. And as with the &#34;accessors
should always be generated&#34; discussion we had at YAPC, I would prefer that you get
what you ask for, rather then having to ask *not* to get something.

Also, your &#34;right&#34; and &#34;wrong&#34; are subjective and I disagree with your assessment,
in fact I see them as the inverse.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you have to put caveats and warnings in the docs to steer the users away
&gt; from the obvious choice of action that&#39;s a red flag and a source of user errors.
</div>
I don&#39;t totally agree that it is &#34;obvious&#34; that default values will DWIM like you
seem to think they should. But I think it has been pretty well established already
that you and I disagree on what &#34;DWIM&#34; means so there is no need to belabor that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I also like to report when I fall into pits so that later when someone else
&gt; reports it they don&#39;t get &#34;well you&#39;re the only one to report it so its not a
&gt; problem&#34;.  Bugs reports are like cockroaches, for every that gets reported
&gt; there&#39;s a hundred you don&#39;t.  Ten times that for interface problems which are
&gt; technically not &#34;bugs&#34; and can be an uphill climb to convince the devs there&#39;s
&gt; even a problem.
</div>
Sure, and we took your report to heart and it spawned several discussions among
the cabal members, but in the end it was decided that lazy was a far superior
solution. To make what you wanted work properly would not only increase the
object construction and accessor overhead, but add complexity to a part of the
code which is already pretty complex. To solve this problem correctly would
require a partial laziness to be implemented within object construction which
would not only complicate the part of Class::MOP you patched, but also all the
constructor and accessor code generation in Class::MOP and Moose. The end decision
was that all this work, overhead and future maintanance was not worth it when
lazy already existed and does the job perfectly and, as I said before, allows
for room to grow.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I made the effort to dig into Class::MOP and figure out what&#39;s going on.
</div>
And I appreciate that very much.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I wrote my thinking out loud so maybe there could be a discussion or something.
</div>
Right, but unfortunately you did it in an inappropriate forum, one which you have
been asked repeatedly to not use in such a way. Discussion is for the mailing list
or IRC where we can go over the details of the issue and get varied input from
people /other then those who get the emails from RT/. If after that it is decided that
it truely is a bug, then I am happy to have you put it into RT or re-open a
closed or rejected bug. This is pretty much said/implied in the Moose::Manual::Contributing
document as is the fact that we do not accept new features that are not first vetted
by a MooseX:: module &#40;which I suggested you do with this&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  I submitted a simple patch which passes all tests and fixes a good chunk of
&gt; the problem.  I haven&#39;t been given a clear reason why it can&#39;t be applied as a
&gt; partial solution.
</div>
Actually, I disagree that it fixes the problem, or even a decent chunk of it, in fact
I think that it creates more problems. Your patch solves your problem quite well, it does
not solve the slightly more complex case Dieter &#40;HDP&#41; and Jesse &#40;DOY&#41; mentioned. Your
partial solution would then require yet more caveats and workarounds to be added to the docs,
something you yourself have said is a bad thing.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I didn&#39;t get an answer as to why lazy is not the default.  If its for
&gt; performance or just backwards compatibility, fine.  Just say so.
</div>
Yes, it is exactly that ... and more. We have tried very hard to make sure &#40;at runtime&#41; you
only pay for what you use and making lazy the default would incur a penalty even on those who
didn&#39;t ask for it. But it is not just about performance penalty, I believe, as I said above,
that you should let the user decide and not make decisions for them. I find it very unintuitive
to have to ask to *not* have a feature.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Until I know there&#39;s a good reason behind an awkward design choice I&#39;ll continue
&gt; to pick at it.
</div>
Again, we disagree on what DWIM means and what constitutes an &#34;awkward design choice&#34;
so I don&#39;t expect to convince you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; These are not personal help desk tickets.  I found something hard to use, I
&gt; want to make it easier for the next guy and a took a stab at patching it.
&gt; That&#39;s what I do.  That&#39;s what you&#39;re supposed to do.
</div>
Right, I don&#39;t disagree with that, I just think that RT is the wrong forum for *continuing*
such a discussion, as I have stated to you already in the past &#40;RT #34039 and #34313&#41; and in
my response to you in this ticket. Subscribe to the mailing list or visit us on #moose or even
#moose-dev to discuss this further and pled your case.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Not all bugs have an error message.
</div>
And not everything *you* think is a bug is /actually/ a bug. In this case, it is your
opinion that Moose is doing the wrong thing, not an indisputable fact, and I flat out disagree
with you.

Honestly our fundemental disagreement reminds me of the whole debate over the RoR philosophy
of &#34;convention over configuration&#34;. You are suggesting that Moose embrace &#34;convention&#34;, while
I am much more firmly in the &#34;configuration&#34; camp. As I am sure you will agree, configuration
is the more flexible of the two, but at the cost of requiring explicitness from the user. While
convention brings more consistency and percieved simplicity, at the cost of reduced flexibility.

Moose is not like other CPAN libraries, it is a library with which to write other libraries with.
In essence Moose&#39;s problem domain is not unlike that of a programming language. And as we all
well know, programming languages are very subjective things, some people love Perl and find it
very intuitive &#40;warts and all&#41;, others hate it with a strong passion. Moose has already clearly
exhibited this exact same ability to evoke strong emotions and opinions in others. In fact, I
have always said that Moose is not for everyone and that no one should ever feel compelled to use
it if they don&#39;t want.

So, anyway, in conclusion &#40;cause this is getting long&#41;, please take these things to the mailing
list or IRC where they can get greater feedback and discussion, but do not be surprised when
you ask us to change core behavior that we don&#39;t insist you vet this behavior in a MooseX:: module
first. There is nothing worse then adding a feature only to find it has inheriant problems and 
then being stuck in situation of having to maintain backwards compatibility for a mistake .

- Stevan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-692384" href="/Public/Bug/Display.html?id=51486#txn-692384">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;17&nbsp;22:34:32&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.835455</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
