<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #1490 for HTML-TableParser: TableParser patch</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #1490 for HTML-TableParser: TableParser patch</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTML-TableParser/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTML-TableParser/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTML-TableParser/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTML-TableParser/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTML-TableParser">HTML-TableParser CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">1490</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTML-TableParser/Active/">HTML-TableParser</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
xma [...] arctur.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-16026-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.31    </td>
  </tr>
  <tr id="CF-16027-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.32    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;31&nbsp;13:32:54&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TableParser patch</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -cr HTML-TableParser-0.31/TableParser.pm HTML-TableParser-0.31.orig/TableParser.pm
*** HTML-TableParser-0.31/TableParser.pm	Sat Aug 31 10:11:10 2002
--- HTML-TableParser-0.31.orig/TableParser.pm	Fri Apr 19 22:56:06 2002
***************
*** 921,935 ****
    my &#40; $self, $attr, $line &#41; = @_;
  
    my $otbl = $self-&gt;{Tables}[-1];
!   my $oids;
!   if &#40;! $otbl&#41; {
!     #    print STDERR &#34;No old table\n&#34;;
!     $oids = undef;
!   }else{
!     $oids = $otbl-&gt;ids;
!   }
!   my $tbl = HTML::TableParser::Table-&gt;new&#40; $self,
! 					   $oids,
  					   $self-&gt;{reqs}, $line &#41;;
  
    $self-&gt;process&#40; $tbl-&gt;process &#41;;
--- 921,929 ----
    my &#40; $self, $attr, $line &#41; = @_;
  
    my $otbl = $self-&gt;{Tables}[-1];
! 
!   my $tbl = HTML::TableParser::Table-&gt;new&#40; $self, 
! 					   $self-&gt;{Tables}[-1]-&gt;ids,
  					   $self-&gt;{reqs}, $line &#41;;
  
    $self-&gt;process&#40; $tbl-&gt;process &#41;;
***************
*** 945,951 ****
    my $tbl = pop @{$self-&gt;{Tables}};
    undef $tbl;
  
!   $self-&gt;process&#40; $self-&gt;{Tables}[-1]-&gt;process &#41; if defined $self-&gt;{Tables}[-1];
  }
  
  
--- 939,945 ----
    my $tbl = pop @{$self-&gt;{Tables}};
    undef $tbl;
  
!   $self-&gt;process&#40; $self-&gt;{Tables}[-1]-&gt;process &#41;;
  }
  
  
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;03&nbsp;09:24:37&nbsp;2002</span>
    <span class="description">djerius [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;03&nbsp;11:10:06&nbsp;2002</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your bug report.  The &#34;real&#34; problem is that the input HTML
is malformed. There is an extra &lt;/table&gt; tag in line 1016 of the input
which caused the error.  It&#39;s this line:

1016:&lt;/TABLE&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;&lt;A NAME=&#34;_BOTTOM&#34;&gt;&lt;/A&gt;

I&#39;ve modified the code to croak if there&#39;s an extra end table tag.

I&#39;ll upload it to CPAN shortly.

Diab

[guest - Sat Aug 31 13:32:54 2002]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The patch attached fixes the following errors, which show up only when
&gt;    turning on &#34;use diagnostics&#34;:
&gt; Uncaught exception from user code:
&gt;         Uncaught exception from user code:
&gt;         Modification of non-creatable array value attempted, subscript
&gt;    -1 at /usr/lib/perl5/site_perl/5.6.1/HTML/TableParser.pm line 942.
&gt;         HTML::TableParser::end_table&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
&gt;    undef, 1016&#41; called at
&gt;    /usr/lib/perl5/site_perl/5.6.1/HTML/TableParser.pm line 905
&gt;         HTML::TableParser::end&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
&gt;    &#39;table&#39;, undef, 1016&#41; called at
&gt;    /usr/lib/perl5/site_perl/5.6.1/cygwin-multi/HTML/Parser.pm line 104
&gt;         eval {...} called at /usr/lib/perl5/site_perl/5.6.1/cygwin-
&gt;    multi/HTML/Parser.pm line 104
&gt;         HTML::Parser::parse_file&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
&gt;    &#39;EP0210645_1&#39;&#41; called at
&gt;    /downloads/XiaoJunMa/SoftDev/Perl/scripts/parsePatent.pl line 33
&gt;         HTML::Parser::parse_file&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
&gt;    &#39;EP0210645_1&#39;&#41; called at
&gt;    /downloads/XiaoJunMa/SoftDev/Perl/scripts/parsePatent.pl line 33
</div></div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;03&nbsp;13:37:07&nbsp;2002</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">xiao-jun,


What&#39;s happening is that there&#39;s a row which contains data as well as
starts a new table, i.e.:

&lt;tr&gt;
&lt;td&gt; data &lt;/td&gt;
&lt;td&gt; &lt;table&gt; .... &lt;/table&gt; &lt;/td&gt;
&lt;/tr&gt;

The parser has to finish off the embedded table before it can finish
off the row.  So, the data for the embedded table are returned before
the data for the enclosing row.  There&#39;s no way around this,
unfortunately.

If you modify your row routine to print out the table id, you&#39;ll see
that the out-of-order rows are due to embedded tables, as described
above.

You should use the table id passed to row&#40;&#41; to sort your data, or
use the class constructor method to create a new object per table.

diab


[xma@arcturusag.com - Tue Sep  3 12:20:29 2002]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Diab,
&gt; 
&gt; Thanks for the clarification. I also noticed that the row handlers are
&gt;    fired
&gt; out of line order, for example with the file I attached before:
&gt; 
&gt; 828: [:IPC Code:::::C07K 15/00;....]
&gt; 849: [Aug. 1, 1985:DE1985003527568]
&gt; 862: []
&gt; 844: [:Priority Number::::::]
&gt; 
&gt; by this code :
&gt; sub row {
&gt;     my &#40; $tbl_id, $line_no, $data, $udata &#41; = @_;
&gt;     print STDERR &#34;$line_no: &#34;, &#34;[&#34;, join&#40;&#34;:&#34;, @$data&#41;, &#34;]\n&#34;;
&gt; }
&gt; 
&gt; This can cause problems for getting the right table cell. Do you have
&gt;    any
&gt; suggestions?
&gt; &#40;I had to save all rows then sort by line number before I use them&#41;?
&gt; 
&gt; Thanks,
&gt; 
&gt; xiao-jun
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -----Original Message-----
&gt; From: via RT [mailto:comment-HTML-TableParser@rt.cpan.org]
&gt; Sent: Tuesday, September 03, 2002 8:10 AM
&gt; To: Xiao-Jun Ma
&gt; Subject: [cpan #1490] TableParser patch
&gt; 
&gt; 
&gt; This message about HTML-TableParser was sent to you by DJERIUS via
&gt; rt.cpan.org
&gt; 
&gt; Full context and any attached attachments can be found at:
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/NoAuth/Bug.html?id=1490">http://rt.cpan.org/NoAuth/Bug.html?id=1490</a></span> &gt;
&gt; 
&gt; Thanks for your bug report.  The &#34;real&#34; problem is that the input HTML
&gt; is malformed. There is an extra &lt;/table&gt; tag in line 1016 of the input
&gt; which caused the error.  It&#39;s this line:
&gt; 
&gt; 1016:&lt;/TABLE&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;&lt;A
&gt;    NAME=&#34;_BOTTOM&#34;&gt;&lt;/A&gt;
&gt; 
&gt; I&#39;ve modified the code to croak if there&#39;s an extra end table tag.
&gt; 
&gt; I&#39;ll upload it to CPAN shortly.
&gt; 
&gt; Diab
&gt; 
&gt; [guest - Sat Aug 31 13:32:54 2002]:
&gt; 
<div class="message-stanza open">&gt; &gt; The patch attached fixes the following errors, which show up only
</div>&gt;    when
<div class="message-stanza open">&gt; &gt;    turning on &#34;use diagnostics&#34;:
&gt; &gt; Uncaught exception from user code:
&gt; &gt;         Uncaught exception from user code:
&gt; &gt;         Modification of non-creatable array value attempted,
</div>&gt;    subscript
<div class="message-stanza open">&gt; &gt;    -1 at /usr/lib/perl5/site_perl/5.6.1/HTML/TableParser.pm line
</div>&gt;    942.
<div class="message-stanza open">&gt; &gt;
</div>&gt;    HTML::TableParser::end_table&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
<div class="message-stanza open">&gt; &gt;    undef, 1016&#41; called at
&gt; &gt;    /usr/lib/perl5/site_perl/5.6.1/HTML/TableParser.pm line 905
&gt; &gt;         HTML::TableParser::end&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
&gt; &gt;    &#39;table&#39;, undef, 1016&#41; called at
&gt; &gt;    /usr/lib/perl5/site_perl/5.6.1/cygwin-multi/HTML/Parser.pm line
</div>&gt;    104
<div class="message-stanza open">&gt; &gt;         eval {...} called at /usr/lib/perl5/site_perl/5.6.1/cygwin-
&gt; &gt;    multi/HTML/Parser.pm line 104
&gt; &gt;
</div>&gt;    HTML::Parser::parse_file&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
<div class="message-stanza open">&gt; &gt;    &#39;EP0210645_1&#39;&#41; called at
&gt; &gt;    /downloads/XiaoJunMa/SoftDev/Perl/scripts/parsePatent.pl line 33
&gt; &gt;
</div>&gt;    HTML::Parser::parse_file&#40;&#39;HTML::TableParser=HASH&#40;0xa0210f4&#41;&#39;,
<div class="message-stanza open">&gt; &gt;    &#39;EP0210645_1&#39;&#41; called at
&gt; &gt;    /downloads/XiaoJunMa/SoftDev/Perl/scripts/parsePatent.pl line 33
</div></div></div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;12:29:40&nbsp;2002</span>
    <span class="description">djerius [...] cpan.org -  Fixed in 0.32 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;12:29:40&nbsp;2002</span>
    <span class="description">djerius [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
