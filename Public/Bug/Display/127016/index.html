<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127016 for Forks-Super: Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127016 for Forks-Super: Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Forks-Super/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Forks-Super/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Forks-Super/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Forks-Super/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Forks-Super">Forks-Super CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127016</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Forks-Super/Active/">Forks-Super</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
heptite [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230402-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230403-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.96    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;23:25:42&nbsp;2018</span>
    <span class="description">heptite [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 31 Aug 2018 21:25:21 -0600 &#40;Mountain Daylight Time&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Forks-Super [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian J. Robinson&#34; &lt;heptite [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Under Windows 10, using Strawberry Perl, I am trying to use 
Forks::Super to create a sub-process that handles the job of gathering 
a small amount of data from a website &#40;via an API key&#41;.

The sub-process &#40;child&#41; is supposed to gather that data then print it 
to STDOUT, and wait for the parent process to read that data before it 
does it all over again.

The parent process only tries to read the data from the child every 20 
minutes, and that data is hopefully immediately available.

Unfortunately the whole thing seems to fail to work as expected:

     $pid = fork {child_fh =&gt; [&#39;in&#39;, &#39;out&#39;, &#39;pipe&#39;, &#39;block&#39;], on_busy =&gt; &#39;fail&#39;};
     die &#34;fork failed: $!&#34; unless defined $pid;
     if &#40;$pid&#41;
     {
         $child_fh = $pid-&gt;{child_stdout};
         $line = &lt;$child_fh&gt;;
         print &#34;&gt;&gt;$line&lt;&lt;\n&#34;;
     } else {
         while &#40;1&#41;
         {
             @aqi = &#38;getAQI;
             print STDOUT join&#40;&#39; &#39;, @aqi&#41;.&#34;\n&#34;;
         }
     }

The &#38;getAQI subroutine can take up to a minute to complete, and 
meanwhile the parent process IMMEDIATELY outputs &#34;&gt;&gt;&lt;&lt;&#34; instead of 
waiting for the child process to gather the data and send it.

Moreover, the child process seems to rapidly loop instead of waiting 
for the parent to gather the data before proceeding to run the data 
gathering subroutine again.

I&#39;ve tried using IO::Select::can_read/can_write on the file handles to 
wait for data, but that doesn&#39;t work either.

Am I making a fundamental mistake, or have I discovered a bug?

perl -v output:
This is perl 5, version 24, subversion 0 &#40;v5.24.0&#41; built for MSWin32-x64-multi-thread

-- 
Christian J. Robinson &lt;heptite@gmail.com&gt; -- <span class="clickylink"><a target="new" rel="nofollow" href="https://christianrobinson.name/">https://christianrobinson.name/</a></span>
And on the seventh day, He exited from append mode.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;02&nbsp;17:50:05&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Reproduced
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;02&nbsp;17:50:09&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;11:22:21&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Forks::Super sets attributes on IO handles to indicate how the user wants them to behave. In lib/Forks/Super/Job/Ipc.pm, for example, there are dozens of assignments like

    $$fh-&gt;{is_socket} = 1

The distribution also uses an experimental set of tied classes, Forks::Super::Tie::IPCxxxHandle, for most interprocess communication. My vision was that these objects would be able to monitor how the I/O handles are used in an application and someday would be able to recommend how to tune the Forks::Super module to run your application more effectively.

This issue arises because an attribute is set on the Windows socket handle &#40;pipes on Windows are always emulated with sockets&#41; to indicate that it should be a blocking socket handle _before_ the socket handle is tied. The block attribute is not visible when you query the tied filehandle.

To fix this, I am checking for the attribute on the original handle and updating the handle used by the tied handle class each time a readline operation is done on the socket handle. This seems to resolve the problem.

On older version of Forks::Super, a workaround is to disable the use of these tied handle classes. Some ways to do this are:

    set the environment variable NO_TIES=1 prior to loading Forks::Super

    set the variables $Forks::Super::Job::Ipc::USE_TIE_SH = $Forks::Super::Job::Ipc::USE_TIE_FH = $Forks::Super::Job::Ipc::USE_TIE_PH = 0 in your program, preferrably before the first `fork` call

    edit Forks/Super/Job/Ipc.pm, lines 53-59, to ensure that the $USE_TIE_xxx variables are set to false values


Thank you for using Forks::Super and thank you for the bug report. Please continue to let me know about any other difficulty you have using this distribution.

-- Marty O&#39;Brien
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;11:22:22&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;11:22:22&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Fixed in 0.96 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;15:37:57&nbsp;2018</span>
    <span class="description">heptite [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #127016] Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2018 13:37:54 -0600 &#40;Mountain Daylight Time&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Marty O&#39;Brien via RT &lt;bug-Forks-Super [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian J. Robinson&#34; &lt;heptite [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This has not resolved my problem.  The behavior is different, in that 
the first iteration of the loop it does appear to block, but then it 
reverts to the old behavior where there appears to be no blocking.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;15:42:46&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Re-opening. Christian, do you have a short code sample that would demonstrate the current issue?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;15:42:48&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;15:55:51&nbsp;2018</span>
    <span class="description">heptite [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #127016] Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2018 13:55:46 -0600 &#40;Mountain Daylight Time&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Marty O&#39;Brien via RT &lt;bug-Forks-Super [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian J. Robinson&#34; &lt;heptite [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The same code snippet I already provided, but I&#39;ll add:

     sub getAQI
     {
         print STDERR &#34;in getAQI\n&#34;;
         sleep 1;
         return &#40;&#39;--&#39;,&#39;--&#39;&#41;;
     }

Then it outputs something like this:

     in getAQI
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">     &gt;&gt;-- --
</div>     &lt;&lt;
     in getAQI
     in getAQI
     in getAQI
     in getAQI
     in getAQI
     in getAQI
     in getAQI
     Terminating on signal SIGINT&#40;2&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;16:14:31&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Christian,
I&#39;m still not sure you have demonstrated a problem. In the script you provided, the parent process code is just

    if &#40;$pid&#41; {
        $child_fh = $pid-&gt;{child_stdout};
        $line = &lt;$child_fh&gt;;
        print &#34;&gt;&gt;$line&lt;&lt;\n&#34;;
    } ...

so it is expected that it will only read and display one line of output from the child process. If you put a loop into the parent code, it does appear to read and display more than one line from the child, and with an appropriate pause between lines of output.

On Thu Sep 13 15:55:51 2018, heptite@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The same code snippet I already provided, but I&#39;ll add:
&gt; 
&gt;      sub getAQI
&gt;      {
&gt;          print STDERR &#34;in getAQI\n&#34;;
&gt;          sleep 1;
&gt;          return &#40;&#39;--&#39;,&#39;--&#39;&#41;;
&gt;      }
&gt; 
&gt; Then it outputs something like this:
&gt; 
&gt;      in getAQI
<div class="message-stanza open">&gt;      &gt;&gt;-- --
</div>&gt;      &lt;&lt;
&gt;      in getAQI
&gt;      in getAQI
&gt;      in getAQI
&gt;      in getAQI
&gt;      in getAQI
&gt;      in getAQI
&gt;      in getAQI
&gt;      Terminating on signal SIGINT&#40;2&#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;16:25:16&nbsp;2018</span>
    <span class="description">heptite [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #127016] Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2018 14:24:39 -0600 &#40;Mountain Daylight Time&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Marty O&#39;Brien via RT &lt;bug-Forks-Super [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian J. Robinson&#34; &lt;heptite [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My actual script invokes a Win32::GUI instance that has a repeating 
timer that will read from the child process every 20 minutes.  The 
problem is that the child process just continually prints &#34;in getAQI&#34; 
every second, even though the parent isn&#39;t reading from the child.

I have to do the fork before I instantiate Win32::GUI, but I wonder if 
Win32::GUI is incompatible with Forks::Super?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;16:38:46&nbsp;2018</span>
    <span class="description">mobrule [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #127016] Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2018 16:38:24 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Forks-Super [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Marty O&#39;Brien&#34; &lt;mobrule [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So you want the child to block until the parent can read all of its output?

On Thu, Sep 13, 2018 at 4:25 PM Christian J. Robinson via RT &lt;
bug-Forks-Super@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Forks-Super
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127016">https://rt.cpan.org/Ticket/Display.html?id=127016</a></span> &gt;
&gt;
&gt; My actual script invokes a Win32::GUI instance that has a repeating
&gt; timer that will read from the child process every 20 minutes.  The
&gt; problem is that the child process just continually prints &#34;in getAQI&#34;
&gt; every second, even though the parent isn&#39;t reading from the child.
&gt;
&gt; I have to do the fork before I instantiate Win32::GUI, but I wonder if
&gt; Win32::GUI is incompatible with Forks::Super?
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;16:46:22&nbsp;2018</span>
    <span class="description">heptite [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #127016] Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2018 14:45:27 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Forks-Super [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian J. Robinson&#34; &lt;heptite [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I want the child to block until the parent reads, then gather new data and
block until the parent reads again, repeated indefinitely.  I wouldn&#39;t even
bother forking to gather the data but the Win32::GUI would freeze every
time the data is gathered, which is undesirable.

On Thu, Sep 13, 2018 at 2:38 PM, Marty O&#39;Brien via RT &lt;
bug-Forks-Super@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127016">https://rt.cpan.org/Ticket/Display.html?id=127016</a></span> &gt;
&gt;
&gt; So you want the child to block until the parent can read all of its output?
&gt;
&gt; On Thu, Sep 13, 2018 at 4:25 PM Christian J. Robinson via RT &lt;
&gt; bug-Forks-Super@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt;        Queue: Forks-Super
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127016">https://rt.cpan.org/Ticket/Display.html?id=127016</a></span> &gt;
&gt; &gt;
&gt; &gt; My actual script invokes a Win32::GUI instance that has a repeating
&gt; &gt; timer that will read from the child process every 20 minutes.  The
&gt; &gt; problem is that the child process just continually prints &#34;in getAQI&#34;
&gt; &gt; every second, even though the parent isn&#39;t reading from the child.
&gt; &gt;
&gt; &gt; I have to do the fork before I instantiate Win32::GUI, but I wonder if
&gt; &gt; Win32::GUI is incompatible with Forks::Super?
&gt; &gt;
</div>&gt;
&gt;
</div>

-- 
Christian J. Robinson &lt;heptite@gmail.com&gt;
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;17:18:22&nbsp;2018</span>
    <span class="description">mobrule [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #127016] Can&#39;t get a forked process to &#34;block&#34; stdin/stdout filehandles</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2018 17:17:59 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Forks-Super [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Marty O&#39;Brien&#34; &lt;mobrule [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Got you. That&#39;s not really what the `block` attribute is for -- it&#39;s for
blocking on read operations while an input stream reader waits for more
input.

To block on writing, I can see a few different things to try.

1. If the output is always the same number of bytes &#40;fixed record length&#41;,
there is a way of setting the buffer size of the socket/pipe so that after
one record has been written, the socket buffer is full and will block until
the other process reads from the socket. I would have to refresh my memory
about how to do that.

2. You could use a blocking queue with a max size of one element, like
Forks::Queue, to pass messages from child to parent instead of standard
filehandles. Or at a more basic level, have the parent read from a file and
then erase the file, and have the child sleep while that file exists, and
then create a new file with the same name.

3. The `sync` option in a Forks::Super::fork call is kind of a solution in
search of a problem, but this may be an application. The concept is that
the processes share one or more synchronization objects with the property
that only one process can &#34;acquire&#34; an object at a time. So consider
sharing two synchronization objects between parent and child, let&#39;s call
them A and B. At the time of the fork, the parent possesses A and the child
possesses B.

When the parent is ready to read, it follows this process:
    release A
    acquire B
    acquire A
    read data from child
    release B

When the child is ready to write data, it follows this process
    write data to parent
    release B
    acquire A
    acquire B
    release A

I think this scheme would not deadlock and would make the child wait after
writing until the parent could read it &#40;it&#39;s untested, though&#41;.




On Thu, Sep 13, 2018 at 4:46 PM Christian J. Robinson via RT &lt;
bug-Forks-Super@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Forks-Super
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127016">https://rt.cpan.org/Ticket/Display.html?id=127016</a></span> &gt;
&gt;
&gt; I want the child to block until the parent reads, then gather new data and
&gt; block until the parent reads again, repeated indefinitely.  I wouldn&#39;t even
&gt; bother forking to gather the data but the Win32::GUI would freeze every
&gt; time the data is gathered, which is undesirable.
&gt;
&gt; On Thu, Sep 13, 2018 at 2:38 PM, Marty O&#39;Brien via RT &lt;
&gt; bug-Forks-Super@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127016">https://rt.cpan.org/Ticket/Display.html?id=127016</a></span> &gt;
&gt; &gt;
&gt; &gt; So you want the child to block until the parent can read all of its
</div>&gt; output?
<div class="message-stanza open">&gt; &gt;
&gt; &gt; On Thu, Sep 13, 2018 at 4:25 PM Christian J. Robinson via RT &lt;
&gt; &gt; bug-Forks-Super@rt.cpan.org&gt; wrote:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt;        Queue: Forks-Super
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127016">https://rt.cpan.org/Ticket/Display.html?id=127016</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; My actual script invokes a Win32::GUI instance that has a repeating
&gt; &gt; &gt; timer that will read from the child process every 20 minutes.  The
&gt; &gt; &gt; problem is that the child process just continually prints &#34;in getAQI&#34;
&gt; &gt; &gt; every second, even though the parent isn&#39;t reading from the child.
&gt; &gt; &gt;
&gt; &gt; &gt; I have to do the fork before I instantiate Win32::GUI, but I wonder if
&gt; &gt; &gt; Win32::GUI is incompatible with Forks::Super?
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
&gt; --
&gt; Christian J. Robinson &lt;heptite@gmail.com&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;09:10:08&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Marking as resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;09:10:08&nbsp;2018</span>
    <span class="description">MOB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
