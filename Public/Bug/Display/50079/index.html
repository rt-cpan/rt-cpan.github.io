<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #50079 for POE: t/30_loops/select/wheel_sf_ipv6.t &#40;FAILS on Win32&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #50079 for POE: t/30_loops/select/wheel_sf_ipv6.t &#40;FAILS on Win32&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/POE/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/POE/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/POE/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/POE/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/POE">POE CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">50079</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/POE/Active/">POE</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
acferen [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-26342-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.269    </td>
  </tr>
  <tr id="CF-26343-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;28&nbsp;16:49:19&nbsp;2009</span>
    <span class="description">acferen [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/30_loops/select/wheel_sf_ipv6.t &#40;FAILS on Win32&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># r2672 introduces this particular failure.


S:\poe\trunk\poe&gt;prove -b t/30_loops/select/wheel_sf_ipv6.t
t/30_loops/select/wheel_sf_ipv6....# This test may hang if your firewall
blocks IPv6
# packets across your localhost interface.
getsockname&#40;&#41; on unopened socket GEN0 at
blib\lib/POE/Wheel/SocketFactory.pm line 425.
Use of uninitialized value in subroutine entry at
C:\Perl\site\lib\POE\Test\Loops/wheel_sf_ipv6.pm line 72.
t/30_loops/select/wheel_sf_ipv6....ok 1/3Bad arg length for
Socket6::unpack_sockaddr_in6, length is 0, should be 28 at
C:\Perl\site\lib\POE\Test\Loops/wheel_sf_ipv6.pm line 72.
Compilation failed in require at t/30_loops/select/wheel_sf_ipv6.t line 20.
# Looks like you planned 3 tests but ran 1.
# Looks like your test exited with 2 just after 1.
t/30_loops/select/wheel_sf_ipv6....dubious
        Test returned status 2 &#40;wstat 512, 0x200&#41;
DIED. FAILED tests 2-3
        Failed 2/3 tests, 33.33% okay &#40;less 1 skipped test: 0 okay, 0.00%&#41;
Failed Test                       Stat Wstat Total Fail  List of Failed
-------------------------------------------------------------------------------
t/30_loops/select/wheel_sf_ipv6.t    2   512     3    4  2-3
1 subtest skipped.
Failed 1/1 test scripts. 2/3 subtests failed.
Files=1, Tests=3,  2 wallclock secs &#40; 0.00 cusr +  0.00 csys =  0.00 CPU&#41;
Failed 1/1 test programs. 2/3 subtests failed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;23:23:35&nbsp;2009</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This change sets the port to 0 so that a free port may be automatically
allocated.  In what way is this the wrong thing to do on Win32 platforms?

On Mon Sep 28 16:49:19 2009, acferen@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # r2672 introduces this particular failure.
&gt; 
&gt; 
&gt; S:\poe\trunk\poe&gt;prove -b t/30_loops/select/wheel_sf_ipv6.t
&gt; t/30_loops/select/wheel_sf_ipv6....# This test may hang if your
&gt; firewall
&gt; blocks IPv6
&gt; # packets across your localhost interface.
&gt; getsockname&#40;&#41; on unopened socket GEN0 at
&gt; blib\lib/POE/Wheel/SocketFactory.pm line 425.
&gt; Use of uninitialized value in subroutine entry at
&gt; C:\Perl\site\lib\POE\Test\Loops/wheel_sf_ipv6.pm line 72.
&gt; t/30_loops/select/wheel_sf_ipv6....ok 1/3Bad arg length for
&gt; Socket6::unpack_sockaddr_in6, length is 0, should be 28 at
&gt; C:\Perl\site\lib\POE\Test\Loops/wheel_sf_ipv6.pm line 72.
&gt; Compilation failed in require at t/30_loops/select/wheel_sf_ipv6.t
&gt; line 20.
&gt; # Looks like you planned 3 tests but ran 1.
&gt; # Looks like your test exited with 2 just after 1.
&gt; t/30_loops/select/wheel_sf_ipv6....dubious
&gt;         Test returned status 2 &#40;wstat 512, 0x200&#41;
&gt; DIED. FAILED tests 2-3
&gt;         Failed 2/3 tests, 33.33% okay &#40;less 1 skipped test: 0 okay,
&gt; 0.00%&#41;
&gt; Failed Test                       Stat Wstat Total Fail  List of
&gt; Failed
&gt;
</div>-------------------------------------------------------------------------------
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/30_loops/select/wheel_sf_ipv6.t    2   512     3    4  2-3
&gt; 1 subtest skipped.
&gt; Failed 1/1 test scripts. 2/3 subtests failed.
&gt; Files=1, Tests=3,  2 wallclock secs &#40; 0.00 cusr +  0.00 csys =  0.00
&gt; CPU&#41;
&gt; Failed 1/1 test programs. 2/3 subtests failed.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;23:23:36&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;01&nbsp;02:21:51&nbsp;2009</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Actually, it&#39;s working here. Do you have IPv6 enabled, and IPv6 routing
enabled on your firewall?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;01&nbsp;12:21:14&nbsp;2009</span>
    <span class="description">acferen [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Oct 01 02:21:51 2009, RCAPUTO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually, it&#39;s working here. Do you have IPv6 enabled, and IPv6 routing
&gt; enabled on your firewall?
</div>
On closer inspection ipv6 is not installed.  Previously the test had not
passed, but failed more gracefully.  The issue is that when the new
Started event fires things die and the test no longer exits gracefully.

attached is a patch to get the test to fail gracefully by skipping all
the expected tests.

To test on Win32 XP &#34;ipv6 install&#34; and &#34;ipv6 uninstall&#34; to
install/uninstall the IPv6 stack.  Unfortunately at least with
ActiveState Socket6 will install/load with out error even if the IPv6
stack isn&#39;t there.  I didn&#39;t see an obvious way to deal with this directly.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: lib/POE/Test/Loops/wheel_sf_ipv6.pm
===================================================================
--- lib/POE/Test/Loops/wheel_sf_ipv6.pm	&#40;revision 2706&#41;
+++ lib/POE/Test/Loops/wheel_sf_ipv6.pm	&#40;working copy&#41;
@@ -69,9 +69,17 @@
   Error              =&gt; \&#38;server_got_error,
   ClientError        =&gt; sub { }, # Hush a warning.
   Started            =&gt; sub {
-    $tcp_server_port = &#40;
-      Socket6::unpack_sockaddr_in6&#40;$_[HEAP]-&gt;{listener}-&gt;getsockname&#40;&#41;&#41;
-    &#41;[0];
+    eval {
+      my $socketname= $_[HEAP]-&gt;{listener}-&gt;getsockname&#40;&#41;;
+      $tcp_server_port = &#40;Socket6::unpack_sockaddr_in6&#40;$socketname&#41;&#41;[0];
+    };
+    if &#40;!$tcp_server_port || $@&#41; {
+      $tcp_server_port = undef;
+    SKIP: {
+      my $errstr = $@ || &#39;server port undefined&#39;;
+      skip &#34;AF_INET6 probably not supported/configured &#40;$errstr&#41;&#34;, 2
+      }
+    }
   },
 &#41;;
 
@@ -111,17 +119,19 @@
 ###############################################################################
 # Start the TCP client.
 
-POE::Component::Client::TCP-&gt;new&#40;
-  RemoteAddress =&gt; &#39;::1&#39;,
-  RemotePort    =&gt; $tcp_server_port,
-  Domain        =&gt; Socket6::AF_INET6,
-  BindAddress   =&gt; &#39;::1&#39;,
-  Connected     =&gt; \&#38;client_got_connect,
-  ServerInput   =&gt; \&#38;client_got_input,
-  ServerFlushed =&gt; \&#38;client_got_flush,
-  Disconnected  =&gt; \&#38;client_got_disconnect,
-  ConnectError  =&gt; \&#38;client_got_connect_error,
-&#41;;
+if &#40;$tcp_server_port&#41; {
+  POE::Component::Client::TCP-&gt;new&#40;
+    RemoteAddress =&gt; &#39;::1&#39;,
+    RemotePort    =&gt; $tcp_server_port,
+    Domain        =&gt; Socket6::AF_INET6,
+    BindAddress   =&gt; &#39;::1&#39;,
+    Connected     =&gt; \&#38;client_got_connect,
+    ServerInput   =&gt; \&#38;client_got_input,
+    ServerFlushed =&gt; \&#38;client_got_flush,
+    Disconnected  =&gt; \&#38;client_got_disconnect,
+    ConnectError  =&gt; \&#38;client_got_connect_error,
+    &#41;;
+}
 
 sub client_got_connect {
   my $heap = $_[HEAP];
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;01&nbsp;23:48:16&nbsp;2009</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch applied as revision 2707, but I was reading the wrong ticket
during the commit and attributed the wrong person.  Sorry, Andrew.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;01&nbsp;23:48:18&nbsp;2009</span>
    <span class="description">RCAPUTO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
