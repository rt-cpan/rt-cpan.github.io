<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #122236 for ExtUtils-MakeMaker: EUMM: Partial INSTALLVENDOR* override results in non-arch INSTALLVENDORARCH</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #122236 for ExtUtils-MakeMaker: EUMM: Partial INSTALLVENDOR* override results in non-arch INSTALLVENDORARCH</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-MakeMaker">ExtUtils-MakeMaker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">122236</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-MakeMaker/Active/">ExtUtils-MakeMaker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
al.dunsmuir [...] sympatico.ca

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;26&nbsp;08:37:36&nbsp;2017</span>
    <span class="description">al.dunsmuir [...] sympatico.ca -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> EUMM: Partial INSTALLVENDOR* override results in non-arch INSTALLVENDORARCH</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Jun 2017 08:33:55 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Al Dunsmuir &lt;al.dunsmuir [...] sympatico.ca&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I&#39;ve tracked down a build problem building all vendor arch files on
AIX in the following ticket. It was suggested I open another here.

#131559: ExtUtils::Command::MM not installing files in vendor arch-specific directories
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=131559">https://rt.perl.org/Ticket/Display.html?id=131559</a></span>

I&#39;ve got over 300 AIX-specific perl rpm packages that I&#39;m trying to
build with 5.26.0 &#40;updated to EU:MM 7.30 with the AIX test fix&#41;.

The non-arch builds worked fine, but all all arch-specific builds
failed because the arch-specific files were being installed into
non-arch directoryies.

My original RPM .spec file recipe was:
%{__perl} Makefile.PL INSTALLDIRS=vendor \
         INSTALLVENDORLIB=%{perl_vendorlib}
         INSTALLVENDORMAN3DIR=%{_mandir}/man3 \
         NO_PACKLIST=1 OPTIMIZE=&#34;%{optflags}&#34;

I changed this to:
%{__perl} Makefile.PL INSTALLDIRS=vendor \
         INSTALLVENDORLIB=%{perl_vendorlib}
         INSTALLVENDORARCH=%{perl_vendorarch} \
         INSTALLVENDORMAN3DIR=%{_mandir}/man3 \
         NO_PACKLIST=1 OPTIMIZE=&#34;%{optflags}&#34;
and the build was successful

It appears that overriding INSTALLVENDORLIB without also overriding
INSTALLVENDORARCH caused the INSTALLVENDORARCH value to be corrupted.

I tried the minimalistic version:
%{__perl} Makefile.PL INSTALLDIRS=vendor NO_PACKLIST=1 OPTIMIZE=&#34;%{optflags}&#34;
and that also worked.

So it appears that the EU:MM handling of just INSTALLVENDORLIB results
in an invalid INSTALLVENDORARCH value. These overrides were from a few
perl RPM builds back to 5.8.8 days and were simply propagated across
all the new pagkages. Since I&#39;m doing a full rebase to 5.26.0 anyway,
I will remove them from all my .spec file recipes. That solves my
immediate problem, but EU:MM should be corrected in this area.

-- 
Al Dunsmuir
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;27&nbsp;22:38:37&nbsp;2017</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Al,

Thanks for this report. The behaviour you describe as a &#34;corrupt&#34; value is apparently a deliberate choice as implemented in init_lib2arch at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl-Toolchain-Gang/ExtUtils-MakeMaker/blob/master/lib/ExtUtils/MM_Unix.pm#L1926">https://github.com/Perl-Toolchain-Gang/ExtUtils-MakeMaker/blob/master/lib/ExtUtils/MM_Unix.pm#L1926</a></span> - to use the VENDORLIB for &#34;arch&#34; files if no VENDORARCH supplied.

I have made a PR which updates the documentation and welcome your thoughts: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl-Toolchain-Gang/ExtUtils-MakeMaker/pull/306/files">https://github.com/Perl-Toolchain-Gang/ExtUtils-MakeMaker/pull/306/files</a></span>

Best regards,
Ed
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;27&nbsp;22:38:38&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;28&nbsp;18:41:39&nbsp;2017</span>
    <span class="description">al.dunsmuir [...] sympatico.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> al.dunsmuir [...] sympatico.ca</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 27 22:38:37 2017, ETJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Al,
&gt; 
&gt; Thanks for this report. The behaviour you describe as a &#34;corrupt&#34;
&gt; value is apparently a deliberate choice as implemented in
&gt; init_lib2arch at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl-Toolchain-Gang/ExtUtils-">https://github.com/Perl-Toolchain-Gang/ExtUtils-</a></span>
&gt; MakeMaker/blob/master/lib/ExtUtils/MM_Unix.pm#L1926 - to use the
&gt; VENDORLIB for &#34;arch&#34; files if no VENDORARCH supplied.
&gt; 
&gt; I have made a PR which updates the documentation and welcome your
&gt; thoughts: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl-Toolchain-Gang/ExtUtils-">https://github.com/Perl-Toolchain-Gang/ExtUtils-</a></span>
&gt; MakeMaker/pull/306/files
&gt; 
&gt; Best regards,
&gt; Ed
</div>
Ed,

The problem is that neither the current nor your documentation update
matches the the actual or what I believe is the intended behavior.

The Perl configuration process sets up two sets of configuration 
values:
- When building pure Perl &#40;architecture-neutral&#41; components, the files
  generated by the build are placed in the a common location.  Under 
  the convention for building RPMs &#40;Red Hat RHEL, Centos, or Fedora&#41;
  and most other platforms/distributions this is &#34;noarch&#34;.
- When building components containing architecture-specific elements
  &#40;written in C, C++, etc.&#41; the files generated by the build are placed
  in a directory under the common location.   This ensures that each
  architecture is independent of the other and allows cases such as 
  mine with parallel 32-bit and 64-bit builds.

If one is specifying one override for these builds &#40;such as where the
generated man.3 pages are to be placed&#41;, it is important that specifying
one override keyword must not affect the other keyword values.  Only 
that value must change from the configuration values generated during 
the build of Perl.  

This is important because if a new output file type is defined, specifying
the override for that type must not affect all other file types.  Otherwise
if one wants to move one file type, you must know ALL affected configuration
variables that might change without notice, and specify them all merely to
get the standard Perl configuration value.

The vendor build system for Perl is designed to create a parallel installable 
instance of Perl &#40;Perl itself and related modules&#41; that in NO WAY impacts the 
standard Perl instance.  This is important from a security and sanity point of
view because modules for one Perl instance may be totally incompatible with the
other.

Specifying installdirs=vendor uses the alternate &#40;distinct&#41; set of Perl 
configuration values, so that the output directory names for both noarch and 
arch-specific files have the same relative relationship as before, but are under
an further directory level to ensure that they do not collide with the system
default Perl.   Note that the use of installdirs=vendor without any further 
overrides works just fine.  

Specifying a full set of overrides for either non-vendor or vendor builds works,
assuming you know all of the keywords that must be overridden.  

It is not acceptable is for an individual keyword to be specified, and that value
not to be used instead of the original configuration value.  Similarly, if a 
keyword value is not specified, it must end up with the original configuration
value - unless that configuration value is related - for example if one changes
the location of a tree of directories by changing the root, one EXPECTS that all
directories under that root will change.

The current behavior is wrong in two ways:
- The vendor arch-specific directory is relative to the noarch directory.
  This relationship is critical - otherwise one could build and _successfully_ 
  test a broken vendor package that when installed will overlay &#40;and likely
  render non-functional&#41; that package in the system Perl.   The whole point
  of the separate vendor tree is to isolate the system and vendor Perl.  
  Using a directory from the wrong set is unacceptable in either direction,
- The whole point of my original problem report is that the value that was
  generated in the makefile was wrong because IT DOES NOT WORK.  Note that 
  one part of the Perl build system placed the files in the wrong directory,
  but other parts of the build system knew the original directory from the
  Perl configuration value, and since that value WAS NOT OVERRIDED by the 
  user used that value to look for the files.

If you are going to change values for unrelated keywords, you at least need
to pick a sane value AND you need to make it so that new value is consistently 
used and the final result is functional.

In this case, I would submit that specifying one keyword in the set of vendor
&#40;or non-vendor&#41; keywords should NOT suddenly result in new values for other
keywords.  If it would result in a new value, that new value must be sane.

Note that vendor builds are *not* rare - all RedHat Linux &#40;RHEL, Centos, and
Fedora&#41; builds use it for their only Perl instance.  The vendor builds must
not be treated as some sort of second-class configuration where it is OK to
have quirky behavior.

Al Dunsmuir
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;28&nbsp;21:44:39&nbsp;2017</span>
    <span class="description">al.dunsmuir [...] sympatico.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> al.dunsmuir [...] sympatico.ca</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ed,

A few days without much sleep left my answer run on.  Let&#39;s try
again, after a nap 8^&#41;.

There are 4 quadrants that one can develop a package for:
- Standard Perl, noarch
- Standard Perl, arch
- Vendor Perl, noarch
- Vendor Perl, arch

Each has a different and incompatible set of directories into 
which each file within the Perl package must be delivered by the
Perl build system.

Delivered to the wrong directory, you may end up with a package
where the tests pass, but the resulting files are not usable.
It may be possible to manipulate the final directories after the
fact, but this may result in a final package that does not work
because they no longer match paths embedded during build.

In the case of 32-bit and 64-bit parallel builds &#40;each to their
own separate 32bit and 64bit source/build subtree, you could easily
end up with files that collide in the final package if the arch-
specific portion of the directories is missing... even though each
arch was successfully built and tested.   

Inadvertently getting noarch when you need arch is just as bad as
dropping files into the wrong perl &#40;standard vs vendor&#41; quadrant.  

In the case that I&#39;m reporting, it worked with my older 5.22.1 setup,
&#40;almost 500 packages on AIX&#41; but now fails with 5.26.0 AND a rebuilt
5.22.1 Perl.   I had to manually update the build recipes within each
package to delete the 2 previously-benign overrides &#40;that actually 
specified the default configuration values&#41; so that I got the correct
INSTALLVENDORARCH value on arch-specific packages &#40;and avoided future
issues with noarch&#41;.  

This was after spending time over an elapsed week tracking down the 
incorrect behavior change.  I&#39;d prefer it was fixed in the code so
that it does not burn someone else - documenting that each keyword&#39;s 
value can not be trusted if you specify OTHER keywords just does not
seem like the right approach. 

Al
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;28&nbsp;22:52:31&nbsp;2017</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Al,

I hope you will accept I understand what the &#34;arch&#34; stuff is for, and why it&#39;s important.

I would need to do more research to discover exactly what has changed for these purposes between 5.22 and 5.26. You said that you get success if you either:

* supply both *LIB and *ARCH
* supply neither

I accept there is a change in behaviour, and that is unfortunate. You&#39;re saying you get the behaviour you want if you just supply both variables &#40;I assume &#34;supply neither&#34; is unacceptable since that would use the Config values for arch, which isn&#39;t desired&#41;. If that works, what are your thoughts on just making the docs reflect that? I&#39;m highly reluctant to change any behaviour in EUMM if we have something that works, since that often creates unintended consequences.

Best regards,
Ed
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;28&nbsp;23:38:55&nbsp;2017</span>
    <span class="description">al.dunsmuir [...] sympatico.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> al.dunsmuir [...] sympatico.ca</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 28 22:52:31 2017, ETJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Al,
&gt; 
&gt; I hope you will accept I understand what the &#34;arch&#34; stuff is for, and
&gt; why it&#39;s important.
&gt; 
&gt; I would need to do more research to discover exactly what has changed
&gt; for these purposes between 5.22 and 5.26. You said that you get
&gt; success if you either:
&gt; 
&gt; * supply both *LIB and *ARCH
&gt; * supply neither
&gt; 
&gt; I accept there is a change in behaviour, and that is unfortunate.
&gt; You&#39;re saying you get the behaviour you want if you just supply both
&gt; variables &#40;I assume &#34;supply neither&#34; is unacceptable since that would
&gt; use the Config values for arch, which isn&#39;t desired&#41;. If that works,
&gt; what are your thoughts on just making the docs reflect that? I&#39;m
&gt; highly reluctant to change any behaviour in EUMM if we have something
&gt; that works, since that often creates unintended consequences.
&gt; 
&gt; Best regards,
&gt; Ed
</div>
Ed,

Please follow the back trail through the tickets I created in the main Perl5
bug tracker.  I&#39;ve provided ticket# and links back along the trail.

If you specify just installdirs=vendor, you get the correct values for
both noarch and arch vendor builds.  As noted, this is the final solution
that I chose to adopt because it helps verify that the main Perl build has
the correct configuration values, and minimizes the possibility of problems
with variable combinations.  It also means the build recipes are the same 
for arch and noarch .spec files &#40;K.I.S.S. principal&#41;.

As noted, the Perl 5.26.0 build is updated to incorporate EU::MM to 2.30 to
get around the test failures with the default EU::MM shipped in 5.26.0...
and also has patches to the ExtUtil::CBuilder that fix issues in building 
C and C++ files using IBM&#39;s XL C/C++ compiler &#40;instead of gcc/g++&#41; - same
as my 5.22.1 Perl.

Unfortunately, I lost my original 5.22.1 build from last summer when I built
and installed a new one with full logs to compare against 5.26.0 - 8^&#40;.  The
newly built 5.22.1 had the same issue even though the older original one worked
just fine with the same RPM .spec and source file.  8^&#40; 8^&#40;.   My new .spec 
files also now build a standardized build.log file and saves it in the source
rpm &#40;.src.rpm&#41; file that is built along with the binary .rpm file.

It&#39;s likely that something has changed in my build environment over the 9
months since my last build... but that interval was effectively much shorter
as the AIX system was mostly shut down while I was renovating my basement 
and &#40;finally&#41; moving my office down there &#40;to avoid sawdust and drywall
dust contamination&#41;.  Whatever it is was subtle, and I have not spotted it.
In any case both Perl builds show the correct configuration values and uses
them correctly if only the basic &#34;installdir=vendor&#34; is used. 

Al
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;29&nbsp;00:35:22&nbsp;2017</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Al,

So it works correctly now if you say &#34;installdirs=vendor&#34; and nothing else? If so, then it seems to me EUMM is now functioning in a comprehensible and consistent way?

If that&#39;s true, then can we just document a/the &#34;right way&#34; and leave it at that?

Best regards,
Ed
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;29&nbsp;08:48:55&nbsp;2017</span>
    <span class="description">al.dunsmuir [...] sympatico.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> al.dunsmuir [...] sympatico.ca</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 29 00:35:22 2017, ETJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Al,
&gt; 
&gt; So it works correctly now if you say &#34;installdirs=vendor&#34; and nothing
&gt; else? If so, then it seems to me EUMM is now functioning in a
&gt; comprehensible and consistent way?
&gt; 
&gt; If that&#39;s true, then can we just document a/the &#34;right way&#34; and leave
&gt; it at that?
&gt; 
&gt; Best regards,
&gt; Ed
</div>
Ed,

The problem is as reported in the start of this bug report and previous
tickets that got me here.  It would be great to be able to have simply
updated the original ticket subject and component so it&#39;s all in one place
but the bugtracker does not seem to support that for end users.

I stated the results with 3 different EU::MM options combinations specified, 
with one that is clearly broken which needs to be fixed.  The tickets show the correct Perl configuration values which are accessed by EU:MM via config.pm 
and Makefile attachments showing the case where the wrong value is generated.

While specifying &#34;installdirs=vendor&#34; by itself works, specifying two of
the additional vendor-related keywords WITHOUT specifying that third results
in a hidden INCORRECT change for third keyword value in the generated Makefile.
This is NOT MATCH in any your proposed update in any way.

Because the INSTALLVENDORARCH value in the EU:MM generated Makefile does not
match the Config.pm value that EU:MM starts with, and there was no keyword
INSTALLVENDORARCH=value specified to EU:MM, it is clearly a bug that this
value is changed.  As I explained, it is especially bad since this slams all
the architecture-specific build output into the no-arch output directory
resulting is NON-FUNCTIONAL build that still passes all tests.  

The only reason I catch it is that the RPM build system looks for the output
to appear in the arch-specific directory and fails when it does not. In a pure
CPAN environment, you would see the problem if you are running on a multilib 
system that supports both 32-bit and 64-bit operation, and CPAN tries to build
both both 32-bit and 64-bit variations of the same arch-specific package.

In looking at the EU:MM code, for AIX this processing is being done in 
lib/ExtUtils/Unix.pm so I expect this should be EASILY reproducible on Linux.

Al
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;29&nbsp;14:17:35&nbsp;2017</span>
    <span class="description">BINGOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have been doing some digging through repository history and the behaviour where one defines an installation directory
but not an architecture directory is pretty much implemented as described in the comment in sub init_lib2arch&#40;&#41;

    # The user who requests an installation directory explicitly
    # should not have to tell us an architecture installation directory
    # as well. We look if a directory exists that is named after the
    # architecture. If not we take it as a sign that it should be the
    # same as the requested installation directory. Otherwise we take
    # the found one.

I built and installed a v5.24.1 perl with vendor paths:

  Built under freebsd
  Compiled at Jun 16 2017 09:47:23
  @INC:
    /opt/perl-5.24.1/lib/site_perl/5.24.1/amd64-freebsd
    /opt/perl-5.24.1/lib/site_perl/5.24.1
    /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
    /opt/perl-5.24.1/lib/vendor_perl/5.24.1
    /opt/perl-5.24.1/lib/5.24.1/amd64-freebsd
    /opt/perl-5.24.1/lib/5.24.1
    .

  # perl -V:vendorlib
  vendorlib=&#39;/opt/perl-5.24.1/lib/vendor_perl/5.24.1&#39;;
  # perl -V:vendorarch
  vendorarch=&#39;/opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd&#39;;

We have nothing under vendor yet:

  # ls /opt/perl-5.24.1/lib/vendor_perl/
  # 

I unwrapped the Variable-Magic-0.61 tarball and amended the Makefile.PL to add $ExtUtils::MakeMaker::Verbose=1

  5 use ExtUtils::MakeMaker;
  6 $ExtUtils::MakeMaker::Verbose=1;
  7 use Config;

  # perl Makefile.PL INSTALLDIRS=vendor INSTALLVENDORLIB=/opt/perl-5.24.1/lib/vendor_perl/5.24.1
  Checking if this is ActiveState Perl 5.8.8 build 822 or higher... no
  Checking if this is gcc 3.4 on Windows trying to link against an import library... no
  MakeMaker &#40;v7.3&#41;
  Checking if your kit is complete...
  Looks good
    ABSTRACT_FROM =&gt; q[lib/Variable/Magic.pm]
    AUTHOR =&gt; [q[Vincent Pit &lt;perl@profvince.com&gt;]]
    BUILD_REQUIRES =&gt; { Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }
    CONFIGURE_REQUIRES =&gt; {  }
    INSTALLDIRS =&gt; q[vendor]
    INSTALLVENDORLIB =&gt; q[/opt/perl-5.24.1/lib/vendor_perl/5.24.1]
    LICENSE =&gt; q[perl]
    META_MERGE =&gt; { build_requires=&gt;{ Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }, configure_requires=&gt;{ Config=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0] }, dynamic_config=&gt;q[1], resources=&gt;{ bugtracker=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Dist/Display.html?Name=Variable-Magic">http://rt.cpan.org/Dist/Display.html?Name=Variable-Magic</a></span>], homepage=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Variable-Magic/">http://search.cpan.org/dist/Variable-Magic/</a></span>], license=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></span>], repository=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl%2Fmodules%2FVariable-Magic.git">http://git.profvince.com/?p=perl%2Fmodules%2FVariable-Magic.git</a></span>] } }
    MIN_PERL_VERSION =&gt; q[5.008]
    NAME =&gt; q[Variable::Magic]
    PL_FILES =&gt; {  }
    PREREQ_PM =&gt; { Carp=&gt;q[0], Exporter=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0] }
    TEST_REQUIRES =&gt; {  }
    VERSION_FROM =&gt; q[lib/Variable/Magic.pm]
    clean =&gt; { FILES=&gt;q[Variable-Magic-* *.gcov *.gcda *.gcno cover_db Debian_CPANTS.txt*] }
    dist =&gt; { COMPRESS=&gt;q[gzip -9f], PREOP=&gt;q[pod2text -u lib/Variable/Magic.pm &gt; $&#40;DISTVNAME&#41;/README], SUFFIX=&gt;q[gz] }
  Directory /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd not found
  Defaulting INSTALLVENDORARCH to /opt/perl-5.24.1/lib/vendor_perl/5.24.1
  Using PERL=/opt/perl-5.24.1/bin/perl
  Generating a Unix-style Makefile
  Writing Makefile for Variable::Magic
  Writing MYMETA.yml and MYMETA.json

The important part is &#34;Directory /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd not found&#34;

Let&#39;s create that directory:

  # mkdir -p /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd

And run Makefile.PL again:

  # perl Makefile.PL INSTALLDIRS=vendor INSTALLVENDORLIB=/opt/perl-5.24.1/lib/vendor_perl/5.24.1
  Checking if this is ActiveState Perl 5.8.8 build 822 or higher... no
  Checking if this is gcc 3.4 on Windows trying to link against an import library... no
  MakeMaker &#40;v7.3&#41;
    ABSTRACT_FROM =&gt; q[lib/Variable/Magic.pm]
    AUTHOR =&gt; [q[Vincent Pit &lt;perl@profvince.com&gt;]]
    BUILD_REQUIRES =&gt; { Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }
    CONFIGURE_REQUIRES =&gt; {  }
    INSTALLDIRS =&gt; q[vendor]
    INSTALLVENDORLIB =&gt; q[/opt/perl-5.24.1/lib/vendor_perl/5.24.1]
    LICENSE =&gt; q[perl]
    META_MERGE =&gt; { build_requires=&gt;{ Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }, configure_requires=&gt;{ Config=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0] }, dynamic_config=&gt;q[1], resources=&gt;{ bugtracker=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Dist/Display.html?Name=Variable-Magic">http://rt.cpan.org/Dist/Display.html?Name=Variable-Magic</a></span>], homepage=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Variable-Magic/">http://search.cpan.org/dist/Variable-Magic/</a></span>], license=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></span>], repository=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl%2Fmodules%2FVariable-Magic.git">http://git.profvince.com/?p=perl%2Fmodules%2FVariable-Magic.git</a></span>] } }
    MIN_PERL_VERSION =&gt; q[5.008]
    NAME =&gt; q[Variable::Magic]
    PL_FILES =&gt; {  }
    PREREQ_PM =&gt; { Carp=&gt;q[0], Exporter=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0] }
    TEST_REQUIRES =&gt; {  }
    VERSION_FROM =&gt; q[lib/Variable/Magic.pm]
    clean =&gt; { FILES=&gt;q[Variable-Magic-* *.gcov *.gcda *.gcno cover_db Debian_CPANTS.txt*] }
    dist =&gt; { COMPRESS=&gt;q[gzip -9f], PREOP=&gt;q[pod2text -u lib/Variable/Magic.pm &gt; $&#40;DISTVNAME&#41;/README], SUFFIX=&gt;q[gz] }
  Defaulting INSTALLVENDORARCH to /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
  Using PERL=/opt/perl-5.24.1/bin/perl
  Generating a Unix-style Makefile
  Writing Makefile for Variable::Magic
  Writing MYMETA.yml and MYMETA.json

This time it sets INSTALLVENDORARCH correctly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;29&nbsp;15:21:57&nbsp;2017</span>
    <span class="description">al.dunsmuir [...] sympatico.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> al.dunsmuir [...] sympatico.ca</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 29 14:17:35 2017, BINGOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have been doing some digging through repository history and the
&gt; behaviour where one defines an installation directory
&gt; but not an architecture directory is pretty much implemented as
&gt; described in the comment in sub init_lib2arch&#40;&#41;
&gt; 
&gt; # The user who requests an installation directory explicitly
&gt; # should not have to tell us an architecture installation directory
&gt; # as well. We look if a directory exists that is named after the
&gt; # architecture. If not we take it as a sign that it should be the
&gt; # same as the requested installation directory. Otherwise we take
&gt; # the found one.
&gt; 
&gt; I built and installed a v5.24.1 perl with vendor paths:
&gt; 
&gt; Built under freebsd
&gt; Compiled at Jun 16 2017 09:47:23
&gt; @INC:
&gt;   /opt/perl-5.24.1/lib/site_perl/5.24.1/amd64-freebsd
&gt;   /opt/perl-5.24.1/lib/site_perl/5.24.1
&gt;   /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
&gt;   /opt/perl-5.24.1/lib/vendor_perl/5.24.1
&gt;   /opt/perl-5.24.1/lib/5.24.1/amd64-freebsd
&gt;   /opt/perl-5.24.1/lib/5.24.1
&gt;   .
&gt; 
&gt; # perl -V:vendorlib
&gt; vendorlib=&#39;/opt/perl-5.24.1/lib/vendor_perl/5.24.1&#39;;
&gt; # perl -V:vendorarch
&gt; vendorarch=&#39;/opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd&#39;;
&gt; 
&gt; We have nothing under vendor yet:
&gt; 
&gt; # ls /opt/perl-5.24.1/lib/vendor_perl/
&gt;  #
&gt; 
&gt; I unwrapped the Variable-Magic-0.61 tarball and amended the
&gt; Makefile.PL to add $ExtUtils::MakeMaker::Verbose=1
&gt; 
&gt; 5 use ExtUtils::MakeMaker;
&gt; 6 $ExtUtils::MakeMaker::Verbose=1;
&gt; 7 use Config;
&gt; 
&gt; # perl Makefile.PL INSTALLDIRS=vendor INSTALLVENDORLIB=/opt/perl-
&gt; 5.24.1/lib/vendor_perl/5.24.1
&gt; Checking if this is ActiveState Perl 5.8.8 build 822 or higher... no
&gt; Checking if this is gcc 3.4 on Windows trying to link against an
&gt; import library... no
&gt; MakeMaker &#40;v7.3&#41;
&gt; Checking if your kit is complete...
&gt; Looks good
&gt;   ABSTRACT_FROM =&gt; q[lib/Variable/Magic.pm]
&gt;   AUTHOR =&gt; [q[Vincent Pit &lt;perl@profvince.com&gt;]]
&gt;   BUILD_REQUIRES =&gt; { Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0],
&gt; ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0],
&gt; IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0],
&gt; XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }
&gt;   CONFIGURE_REQUIRES =&gt; {  }
&gt;   INSTALLDIRS =&gt; q[vendor]
&gt;   INSTALLVENDORLIB =&gt; q[/opt/perl-5.24.1/lib/vendor_perl/5.24.1]
&gt;   LICENSE =&gt; q[perl]
&gt;   META_MERGE =&gt; { build_requires=&gt;{ Carp=&gt;q[0], Config=&gt;q[0],
&gt; Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0],
&gt; IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0],
&gt; Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] },
&gt; configure_requires=&gt;{ Config=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0] },
&gt; dynamic_config=&gt;q[1], resources=&gt;{
&gt; bugtracker=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Dist/Display.html?Name=Variable-">http://rt.cpan.org/Dist/Display.html?Name=Variable-</a></span>
&gt; Magic], homepage=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Variable-Magic/">http://search.cpan.org/dist/Variable-Magic/</a></span>],
&gt; license=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></span>],
&gt; repository=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl%2Fmodules%2FVariable-">http://git.profvince.com/?p=perl%2Fmodules%2FVariable-</a></span>
&gt; Magic.git] } }
&gt;   MIN_PERL_VERSION =&gt; q[5.008]
&gt;   NAME =&gt; q[Variable::Magic]
&gt;   PL_FILES =&gt; {  }
&gt;   PREREQ_PM =&gt; { Carp=&gt;q[0], Exporter=&gt;q[0], XSLoader=&gt;q[0],
&gt; base=&gt;q[0] }
&gt;   TEST_REQUIRES =&gt; {  }
&gt;   VERSION_FROM =&gt; q[lib/Variable/Magic.pm]
&gt;   clean =&gt; { FILES=&gt;q[Variable-Magic-* *.gcov *.gcda *.gcno cover_db
&gt; Debian_CPANTS.txt*] }
&gt;   dist =&gt; { COMPRESS=&gt;q[gzip -9f], PREOP=&gt;q[pod2text -u
&gt; lib/Variable/Magic.pm &gt; $&#40;DISTVNAME&#41;/README], SUFFIX=&gt;q[gz] }
&gt; Directory /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd not
&gt; found
&gt; Defaulting INSTALLVENDORARCH to /opt/perl-
&gt; 5.24.1/lib/vendor_perl/5.24.1
&gt; Using PERL=/opt/perl-5.24.1/bin/perl
&gt; Generating a Unix-style Makefile
&gt; Writing Makefile for Variable::Magic
&gt; Writing MYMETA.yml and MYMETA.json
&gt; 
&gt; The important part is &#34;Directory /opt/perl-
&gt; 5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd not found&#34;
&gt; 
&gt; Let&#39;s create that directory:
&gt; 
&gt; # mkdir -p /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
&gt; 
&gt; And run Makefile.PL again:
&gt; 
&gt; # perl Makefile.PL INSTALLDIRS=vendor INSTALLVENDORLIB=/opt/perl-
&gt; 5.24.1/lib/vendor_perl/5.24.1
&gt; Checking if this is ActiveState Perl 5.8.8 build 822 or higher... no
&gt; Checking if this is gcc 3.4 on Windows trying to link against an
&gt; import library... no
&gt; MakeMaker &#40;v7.3&#41;
&gt;   ABSTRACT_FROM =&gt; q[lib/Variable/Magic.pm]
&gt;   AUTHOR =&gt; [q[Vincent Pit &lt;perl@profvince.com&gt;]]
&gt;   BUILD_REQUIRES =&gt; { Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0],
&gt; ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0],
&gt; IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0],
&gt; XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }
&gt;   CONFIGURE_REQUIRES =&gt; {  }
&gt;   INSTALLDIRS =&gt; q[vendor]
&gt;   INSTALLVENDORLIB =&gt; q[/opt/perl-5.24.1/lib/vendor_perl/5.24.1]
&gt;   LICENSE =&gt; q[perl]
&gt;   META_MERGE =&gt; { build_requires=&gt;{ Carp=&gt;q[0], Config=&gt;q[0],
&gt; Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0],
&gt; IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0],
&gt; Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] },
&gt; configure_requires=&gt;{ Config=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0] },
&gt; dynamic_config=&gt;q[1], resources=&gt;{
&gt; bugtracker=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Dist/Display.html?Name=Variable-">http://rt.cpan.org/Dist/Display.html?Name=Variable-</a></span>
&gt; Magic], homepage=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Variable-Magic/">http://search.cpan.org/dist/Variable-Magic/</a></span>],
&gt; license=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></span>],
&gt; repository=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl%2Fmodules%2FVariable-">http://git.profvince.com/?p=perl%2Fmodules%2FVariable-</a></span>
&gt; Magic.git] } }
&gt;   MIN_PERL_VERSION =&gt; q[5.008]
&gt;   NAME =&gt; q[Variable::Magic]
&gt;   PL_FILES =&gt; {  }
&gt;   PREREQ_PM =&gt; { Carp=&gt;q[0], Exporter=&gt;q[0], XSLoader=&gt;q[0],
&gt; base=&gt;q[0] }
&gt;   TEST_REQUIRES =&gt; {  }
&gt;   VERSION_FROM =&gt; q[lib/Variable/Magic.pm]
&gt;   clean =&gt; { FILES=&gt;q[Variable-Magic-* *.gcov *.gcda *.gcno cover_db
&gt; Debian_CPANTS.txt*] }
&gt;   dist =&gt; { COMPRESS=&gt;q[gzip -9f], PREOP=&gt;q[pod2text -u
&gt; lib/Variable/Magic.pm &gt; $&#40;DISTVNAME&#41;/README], SUFFIX=&gt;q[gz] }
&gt; Defaulting INSTALLVENDORARCH to /opt/perl-
&gt; 5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
&gt; Using PERL=/opt/perl-5.24.1/bin/perl
&gt; Generating a Unix-style Makefile
&gt; Writing Makefile for Variable::Magic
&gt; Writing MYMETA.yml and MYMETA.json
</div>
Chris,

Thank you for your assistance!

In ticket 131415 Perl 5.24+ Configure loses hints script changes
                 <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=131415">https://rt.perl.org/Ticket/Display.html?id=131415</a></span>

I have some details, but without the EU::MM Verbose flag set.
Look for &#34;A test 5.26.0 build of perl-Variable-Magic completed the 
          perl-specific build and test successfully, but failed 
          during the rpm install/packaging related portion.&#34;

Since the hints portion of the issue was fixed by removing a 
bogus Configure line, I started a new ticket to track this
 #131559: ExtUtils::Command::MM not installing files in vendor arch-specific directories
          <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=131559">https://rt.perl.org/Ticket/Display.html?id=131559</a></span>

It has attachments for Makefile generated by MakeMaker which shows 
the arch-specific install directory missing the arch &#40;ppc-thread-multilib&#41;
suffix, even though it was present in the Perl configuration accessed by
Config.pm in EU::MM.  Without the RPM packaging failure after the Perl
package build complets, the arch-specific files were silently placed in
the noarch directory.

I will do whatever builds you need with the EU:MM verbose output enabled
to help track this down.  Because the build is under rpm, I&#39;ll need to 
update the Makefile.PL via a patch.  I was thinking of doing the build 
for all 3 variations &#40;just installvendor, installvendor plus 2 overrides,
install vendor plus the 3 overrides&#41;.  I would attach the full build.log
files and the generated Makefiles.  Hopefully this would give you enough
information to determine why the 2nd  case ends up with a bad value for
INSTALLVARCHVENDOR.  Worse case, I can repeat after patching in some code
to emit more verbose debug output from EU:MM.  

I&#39;d be doing this sometime this weekend.  Is there anything else that you
wish to see?

Al
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;28&nbsp;18:10:43&nbsp;2020</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 29 15:21:57 2017, al.dunsmuir@sympatico.ca wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Jun 29 14:17:35 2017, BINGOS wrote:
<div class="message-stanza open">&gt; &gt; I have been doing some digging through repository history and the
&gt; &gt; behaviour where one defines an installation directory
&gt; &gt; but not an architecture directory is pretty much implemented as
&gt; &gt; described in the comment in sub init_lib2arch&#40;&#41;
&gt; &gt;
&gt; &gt; # The user who requests an installation directory explicitly
&gt; &gt; # should not have to tell us an architecture installation directory
&gt; &gt; # as well. We look if a directory exists that is named after the
&gt; &gt; # architecture. If not we take it as a sign that it should be the
&gt; &gt; # same as the requested installation directory. Otherwise we take
&gt; &gt; # the found one.
&gt; &gt;
&gt; &gt; I built and installed a v5.24.1 perl with vendor paths:
&gt; &gt;
&gt; &gt; Built under freebsd
&gt; &gt; Compiled at Jun 16 2017 09:47:23
&gt; &gt; @INC:
&gt; &gt;   /opt/perl-5.24.1/lib/site_perl/5.24.1/amd64-freebsd
&gt; &gt;   /opt/perl-5.24.1/lib/site_perl/5.24.1
&gt; &gt;   /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
&gt; &gt;   /opt/perl-5.24.1/lib/vendor_perl/5.24.1
&gt; &gt;   /opt/perl-5.24.1/lib/5.24.1/amd64-freebsd
&gt; &gt;   /opt/perl-5.24.1/lib/5.24.1
&gt; &gt;   .
&gt; &gt;
&gt; &gt; # perl -V:vendorlib
&gt; &gt; vendorlib=&#39;/opt/perl-5.24.1/lib/vendor_perl/5.24.1&#39;;
&gt; &gt; # perl -V:vendorarch
&gt; &gt; vendorarch=&#39;/opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd&#39;;
&gt; &gt;
&gt; &gt; We have nothing under vendor yet:
&gt; &gt;
&gt; &gt; # ls /opt/perl-5.24.1/lib/vendor_perl/
&gt; &gt;  #
&gt; &gt;
&gt; &gt; I unwrapped the Variable-Magic-0.61 tarball and amended the
&gt; &gt; Makefile.PL to add $ExtUtils::MakeMaker::Verbose=1
&gt; &gt;
&gt; &gt; 5 use ExtUtils::MakeMaker;
&gt; &gt; 6 $ExtUtils::MakeMaker::Verbose=1;
&gt; &gt; 7 use Config;
&gt; &gt;
&gt; &gt; # perl Makefile.PL INSTALLDIRS=vendor INSTALLVENDORLIB=/opt/perl-
&gt; &gt; 5.24.1/lib/vendor_perl/5.24.1
&gt; &gt; Checking if this is ActiveState Perl 5.8.8 build 822 or higher... no
&gt; &gt; Checking if this is gcc 3.4 on Windows trying to link against an
&gt; &gt; import library... no
&gt; &gt; MakeMaker &#40;v7.3&#41;
&gt; &gt; Checking if your kit is complete...
&gt; &gt; Looks good
&gt; &gt;   ABSTRACT_FROM =&gt; q[lib/Variable/Magic.pm]
&gt; &gt;   AUTHOR =&gt; [q[Vincent Pit &lt;perl@profvince.com&gt;]]
&gt; &gt;   BUILD_REQUIRES =&gt; { Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0],
&gt; &gt; ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0],
&gt; &gt; IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0],
&gt; &gt; XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }
&gt; &gt;   CONFIGURE_REQUIRES =&gt; {  }
&gt; &gt;   INSTALLDIRS =&gt; q[vendor]
&gt; &gt;   INSTALLVENDORLIB =&gt; q[/opt/perl-5.24.1/lib/vendor_perl/5.24.1]
&gt; &gt;   LICENSE =&gt; q[perl]
&gt; &gt;   META_MERGE =&gt; { build_requires=&gt;{ Carp=&gt;q[0], Config=&gt;q[0],
&gt; &gt; Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0],
&gt; &gt; IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0],
&gt; &gt; Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] },
&gt; &gt; configure_requires=&gt;{ Config=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0] },
&gt; &gt; dynamic_config=&gt;q[1], resources=&gt;{
&gt; &gt; bugtracker=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Dist/Display.html?Name=Variable-">http://rt.cpan.org/Dist/Display.html?Name=Variable-</a></span>
&gt; &gt; Magic], homepage=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Variable-Magic/">http://search.cpan.org/dist/Variable-Magic/</a></span>],
&gt; &gt; license=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></span>],
&gt; &gt; repository=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl%2Fmodules%2FVariable-">http://git.profvince.com/?p=perl%2Fmodules%2FVariable-</a></span>
&gt; &gt; Magic.git] } }
&gt; &gt;   MIN_PERL_VERSION =&gt; q[5.008]
&gt; &gt;   NAME =&gt; q[Variable::Magic]
&gt; &gt;   PL_FILES =&gt; {  }
&gt; &gt;   PREREQ_PM =&gt; { Carp=&gt;q[0], Exporter=&gt;q[0], XSLoader=&gt;q[0],
&gt; &gt; base=&gt;q[0] }
&gt; &gt;   TEST_REQUIRES =&gt; {  }
&gt; &gt;   VERSION_FROM =&gt; q[lib/Variable/Magic.pm]
&gt; &gt;   clean =&gt; { FILES=&gt;q[Variable-Magic-* *.gcov *.gcda *.gcno cover_db
&gt; &gt; Debian_CPANTS.txt*] }
&gt; &gt;   dist =&gt; { COMPRESS=&gt;q[gzip -9f], PREOP=&gt;q[pod2text -u
&gt; &gt; lib/Variable/Magic.pm &gt; $&#40;DISTVNAME&#41;/README], SUFFIX=&gt;q[gz] }
&gt; &gt; Directory /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd not
&gt; &gt; found
&gt; &gt; Defaulting INSTALLVENDORARCH to /opt/perl-
&gt; &gt; 5.24.1/lib/vendor_perl/5.24.1
&gt; &gt; Using PERL=/opt/perl-5.24.1/bin/perl
&gt; &gt; Generating a Unix-style Makefile
&gt; &gt; Writing Makefile for Variable::Magic
&gt; &gt; Writing MYMETA.yml and MYMETA.json
&gt; &gt;
&gt; &gt; The important part is &#34;Directory /opt/perl-
&gt; &gt; 5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd not found&#34;
&gt; &gt;
&gt; &gt; Let&#39;s create that directory:
&gt; &gt;
&gt; &gt; # mkdir -p /opt/perl-5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
&gt; &gt;
&gt; &gt; And run Makefile.PL again:
&gt; &gt;
&gt; &gt; # perl Makefile.PL INSTALLDIRS=vendor INSTALLVENDORLIB=/opt/perl-
&gt; &gt; 5.24.1/lib/vendor_perl/5.24.1
&gt; &gt; Checking if this is ActiveState Perl 5.8.8 build 822 or higher... no
&gt; &gt; Checking if this is gcc 3.4 on Windows trying to link against an
&gt; &gt; import library... no
&gt; &gt; MakeMaker &#40;v7.3&#41;
&gt; &gt;   ABSTRACT_FROM =&gt; q[lib/Variable/Magic.pm]
&gt; &gt;   AUTHOR =&gt; [q[Vincent Pit &lt;perl@profvince.com&gt;]]
&gt; &gt;   BUILD_REQUIRES =&gt; { Carp=&gt;q[0], Config=&gt;q[0], Exporter=&gt;q[0],
&gt; &gt; ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0], IO::Select=&gt;q[0],
&gt; &gt; IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0], Test::More=&gt;q[0],
&gt; &gt; XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] }
&gt; &gt;   CONFIGURE_REQUIRES =&gt; {  }
&gt; &gt;   INSTALLDIRS =&gt; q[vendor]
&gt; &gt;   INSTALLVENDORLIB =&gt; q[/opt/perl-5.24.1/lib/vendor_perl/5.24.1]
&gt; &gt;   LICENSE =&gt; q[perl]
&gt; &gt;   META_MERGE =&gt; { build_requires=&gt;{ Carp=&gt;q[0], Config=&gt;q[0],
&gt; &gt; Exporter=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0], IO::Handle=&gt;q[0],
&gt; &gt; IO::Select=&gt;q[0], IPC::Open3=&gt;q[0], POSIX=&gt;q[0], Socket=&gt;q[0],
&gt; &gt; Test::More=&gt;q[0], XSLoader=&gt;q[0], base=&gt;q[0], lib=&gt;q[0] },
&gt; &gt; configure_requires=&gt;{ Config=&gt;q[0], ExtUtils::MakeMaker=&gt;q[0] },
&gt; &gt; dynamic_config=&gt;q[1], resources=&gt;{
&gt; &gt; bugtracker=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Dist/Display.html?Name=Variable-">http://rt.cpan.org/Dist/Display.html?Name=Variable-</a></span>
&gt; &gt; Magic], homepage=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Variable-Magic/">http://search.cpan.org/dist/Variable-Magic/</a></span>],
&gt; &gt; license=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></span>],
&gt; &gt; repository=&gt;q[<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl%2Fmodules%2FVariable-">http://git.profvince.com/?p=perl%2Fmodules%2FVariable-</a></span>
&gt; &gt; Magic.git] } }
&gt; &gt;   MIN_PERL_VERSION =&gt; q[5.008]
&gt; &gt;   NAME =&gt; q[Variable::Magic]
&gt; &gt;   PL_FILES =&gt; {  }
&gt; &gt;   PREREQ_PM =&gt; { Carp=&gt;q[0], Exporter=&gt;q[0], XSLoader=&gt;q[0],
&gt; &gt; base=&gt;q[0] }
&gt; &gt;   TEST_REQUIRES =&gt; {  }
&gt; &gt;   VERSION_FROM =&gt; q[lib/Variable/Magic.pm]
&gt; &gt;   clean =&gt; { FILES=&gt;q[Variable-Magic-* *.gcov *.gcda *.gcno cover_db
&gt; &gt; Debian_CPANTS.txt*] }
&gt; &gt;   dist =&gt; { COMPRESS=&gt;q[gzip -9f], PREOP=&gt;q[pod2text -u
&gt; &gt; lib/Variable/Magic.pm &gt; $&#40;DISTVNAME&#41;/README], SUFFIX=&gt;q[gz] }
&gt; &gt; Defaulting INSTALLVENDORARCH to /opt/perl-
&gt; &gt; 5.24.1/lib/vendor_perl/5.24.1/amd64-freebsd
&gt; &gt; Using PERL=/opt/perl-5.24.1/bin/perl
&gt; &gt; Generating a Unix-style Makefile
&gt; &gt; Writing Makefile for Variable::Magic
&gt; &gt; Writing MYMETA.yml and MYMETA.json
</div>&gt; 
&gt; Chris,
&gt; 
&gt; Thank you for your assistance!
&gt; 
&gt; In ticket 131415 Perl 5.24+ Configure loses hints script changes
&gt;                  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=131415">https://rt.perl.org/Ticket/Display.html?id=131415</a></span>
&gt; 
&gt; I have some details, but without the EU::MM Verbose flag set.
&gt;  Look for &#34;A test 5.26.0 build of perl-Variable-Magic completed the
&gt;            perl-specific build and test successfully, but failed
&gt;           during the rpm install/packaging related portion.&#34;
&gt; 
&gt; Since the hints portion of the issue was fixed by removing a
&gt; bogus Configure line, I started a new ticket to track this
&gt; #131559: ExtUtils::Command::MM not installing files in vendor arch-
&gt; specific directories
&gt;          <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=131559">https://rt.perl.org/Ticket/Display.html?id=131559</a></span>
&gt; 
&gt; It has attachments for Makefile generated by MakeMaker which shows
&gt; the arch-specific install directory missing the arch &#40;ppc-thread-
&gt; multilib&#41;
&gt; suffix, even though it was present in the Perl configuration accessed
&gt; by
&gt; Config.pm in EU::MM.  Without the RPM packaging failure after the Perl
&gt; package build complets, the arch-specific files were silently placed
&gt; in
&gt; the noarch directory.
&gt; 
&gt; I will do whatever builds you need with the EU:MM verbose output
&gt; enabled
&gt;  to help track this down.  Because the build is under rpm, I&#39;ll need
&gt; to
&gt;  update the Makefile.PL via a patch.  I was thinking of doing the
&gt; build
&gt; for all 3 variations &#40;just installvendor, installvendor plus 2
&gt; overrides,
&gt; install vendor plus the 3 overrides&#41;.  I would attach the full
&gt; build.log
&gt; files and the generated Makefiles.  Hopefully this would give you
&gt; enough
&gt; information to determine why the 2nd  case ends up with a bad value
&gt; for
&gt; INSTALLVARCHVENDOR.  Worse case, I can repeat after patching in some
&gt; code
&gt;   to emit more verbose debug output from EU:MM.
&gt; 
&gt; I&#39;d be doing this sometime this weekend.  Is there anything else that
&gt; you
&gt; wish to see?
&gt; 
&gt; Al
</div>
Would it be possible to get an update on the status of this ticket?

The Perl 5 bug ticket on which it has a bearing has been migrated to a github issue:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl/perl5/issues/15992">https://github.com/Perl/perl5/issues/15992</a></span>

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
