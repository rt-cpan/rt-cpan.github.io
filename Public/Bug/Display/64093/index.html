<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #64093 for Test-Weaken: constructor return multiple values</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #64093 for Test-Weaken: constructor return multiple values</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-Weaken/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-Weaken/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-Weaken/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-Weaken/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Weaken">Test-Weaken CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">64093</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-Weaken/Active/">Test-Weaken</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jkegl [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45720-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45721-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;20&nbsp;17:29:42&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> constructor return multiple values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Dec 2010 09:29:30 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I made a mistake in a &#34;constructor&#34; and returned a list of refs instead
of a single one, like ret.pl below.  I suppose I meant to return \@ret,
but instead returned @ret as a list.

On returning multiple values only the last one seems to be checked.  In
ret.pl for example $circular_obj is leaky, but only detected if it&#39;s the
second in the @ret, not the first.

I wonder if Test::Weaken might either process multiple values returned,
or give an error if it&#39;s not allowed.  If allowed then I suppose all the
values could be passed to the subsequent &#34;destructor&#34; call.

I see the current \&#40;$constructor-&gt;&#40;&#41;&#41; form in Test::Weaken::test&#40;&#41; is
list context already &#40;and eg. context.pl below&#41;, so there&#39;d be no change
to the calling, just to what was done if the return is multiple values.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use Test::Weaken;
print Test::Weaken-&gt;VERSION,&#34;\n&#34;;

my $leaks = Test::Weaken::leaks
  &#40;{ constructor =&gt; sub {
       my $obj = [];
       my $circular_obj = {};
       $circular_obj-&gt;{&#39;circular&#39;} = $circular_obj;
       my @ret = &#40;$circular_obj, $obj&#41;;
       return @ret;
     },
   }&#41;;
print $leaks ? &#34;leaky\n&#34; : &#34;no leaks\n&#34;;

if &#40;$leaks&#41; {
  my $probes = $leaks-&gt;unfreed_proberefs;
  print @$probes,&#34;\n&#34;;
}
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use Test::Weaken;
print Test::Weaken-&gt;VERSION,&#34;\n&#34;;

my $leaks = Test::Weaken::leaks
  &#40;{ constructor =&gt; sub {
       print wantarray&#40;&#41;,&#34;\n&#34;;
       return [];
     },
   }&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;27&nbsp;00:52:21&nbsp;2010</span>
    <span class="description">jkegl [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;03&nbsp;20:19:53&nbsp;2012</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, the return is in scalar context, and a list in scalar context is
reduced to its last item.  My thought on this is that Test::Weaken&#39;s
current behavior is a reasonable way to deal with this kind of user
mistake.  I&#39;ll leave this bug open a little while for further comments
and then, absent reasons not to so do, close it.

On Mon Dec 20 17:29:42 2010, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I made a mistake in a &#34;constructor&#34; and returned a list of refs instead
&gt; of a single one, like ret.pl below.  I suppose I meant to return \@ret,
&gt; but instead returned @ret as a list.
&gt; 
&gt; On returning multiple values only the last one seems to be checked.  
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;03&nbsp;20:19:54&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;08&nbsp;12:16:39&nbsp;2012</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Marked as resolved, based on my explanation above.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;08&nbsp;12:16:39&nbsp;2012</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;12&nbsp;16:46:28&nbsp;2012</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64093] constructor return multiple values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Jan 2012 08:46:39 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Yes, the return is in scalar context, and a list in scalar context is
&gt; reduced to its last item.  My thought on this is that Test::Weaken&#39;s
&gt; current behavior is a reasonable way to deal with this kind of user
&gt; mistake.
</div>
Well, the problem with the current behaviour is that silently ignoring
lets mistakes go unnoticed.  It looks like the result is a successful
check when in fact it was unchecked, if you know what I mean.
Ie. &#34;silently ignored because you made a mistake in your return&#34; versus
&#34;checked successfully there were no leaks in your data&#34;.

Such a mistake in a constructor could go unnoticed almost forever :-&#41;.
You thought you&#39;d been good and tested for circular refs in some oopery,
but alas due to writing

    return&#40;$foo,$bar&#41;;

instead of

    return[$foo,$bar];

it was not so, the subtle or not so subtle difference means $foo is not
checked.

I think checking all of multiple return values would be good because
it&#39;d help xsub stuff returning multiple scalars, there&#39;d be no need to
do the map{} etc from my bit of docs taking refs and putting them into a
new array.




-- 
The sigfile finance for the layman series:
Read a mining company&#39;s annual report.  The more pages of excrutiating
detail about geology and minerals, the less chance it will make money.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;12&nbsp;16:46:29&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;12&nbsp;17:40:43&nbsp;2012</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, I see your point.  If this were an application, the expense of
buller-proofing the return would not be justified.  But in debugging, a
potential situation, where a user error might cause problems to be
silently ignored, is more important.

Let me think out what I want to do.  Could you submit a test script? 
Don&#39;t worry a lot about its format, as I&#39;ll rearrange that anyway.

Thanks, jeffrey

On Thu Jan 12 16:46:28 2012, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Yes, the return is in scalar context, and a list in scalar context is
&gt; &gt; reduced to its last item.  My thought on this is that Test::Weaken&#39;s
&gt; &gt; current behavior is a reasonable way to deal with this kind of user
&gt; &gt; mistake.
</div>&gt; 
&gt; Well, the problem with the current behaviour is that silently ignoring
&gt; lets mistakes go unnoticed.  It looks like the result is a successful
&gt; check when in fact it was unchecked, if you know what I mean.
&gt; Ie. &#34;silently ignored because you made a mistake in your return&#34; versus
&gt; &#34;checked successfully there were no leaks in your data&#34;.
&gt; 
&gt; Such a mistake in a constructor could go unnoticed almost forever :-&#41;.
&gt; You thought you&#39;d been good and tested for circular refs in some oopery,
&gt; but alas due to writing
&gt; 
&gt;     return&#40;$foo,$bar&#41;;
&gt; 
&gt; instead of
&gt; 
&gt;     return[$foo,$bar];
&gt; 
&gt; it was not so, the subtle or not so subtle difference means $foo is not
&gt; checked.
&gt; 
&gt; I think checking all of multiple return values would be good because
&gt; it&#39;d help xsub stuff returning multiple scalars, there&#39;d be no need to
&gt; do the map{} etc from my bit of docs taking refs and putting them into a
&gt; new array.
&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;12&nbsp;19:47:04&nbsp;2012</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64093] constructor return multiple values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Jan 2012 11:46:34 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Let me think out what I want to do.  Could you submit a test script? 
</div>
Perhaps per below, adapted from the ret.pl I first posted.  As of now
the first test fails and the second succeeds &#40;as the last value returned
is checked&#41;.

Of course you could instead make multiple return values an error.
That&#39;d still be compatible with the documented behaviour and could relax
it as a feature later.

The constructor call is already in array context, so switching to
map{\$_}&#38;$func&#40;&#41; to detect multiple return doesn&#39;t change the
wantarray&#40;&#41; the func sees, if I&#39;m not mistaken.  Not that array vs
scalar context for the constructor is a documented feature ...
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

use strict;
use warnings;
use Test::Weaken;
use Test::More tests =&gt; 2;

{
  # first of two return values leaks
  my $leaks = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub {
         my $obj = [];
         my $circular_obj = {};
         $circular_obj-&gt;{&#39;circular&#39;} = $circular_obj;
         my @ret = &#40;$circular_obj, $obj&#41;;
         return @ret;
       },
     }&#41;;
  my $unfreed_count = &#40;$leaks ? $leaks-&gt;unfreed_count&#40;&#41; : 0&#41;;
  is &#40;$unfreed_count, 2, # the hash and the scalar in it
      &#39;first of two return values leaky -- detected&#39;&#41;;
}

{
  # second of two return values leaks
  my $leaks = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub {
         my $obj = [];
         my $circular_obj = {};
         $circular_obj-&gt;{&#39;circular&#39;} = $circular_obj;
         my @ret = &#40;$obj, $circular_obj&#41;;
         return @ret;
       },
     }&#41;;
  my $unfreed_count = &#40;$leaks ? $leaks-&gt;unfreed_count&#40;&#41; : 0&#41;;
  is &#40;$unfreed_count, 2, # the hash and the scalar in it
      &#39;second of two return values leaky -- detected&#39;&#41;;
}
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">


-- 
... This is reflected in the sort of menus that offer smoked eel, pad
thai and pepper ice cream.  &#40;If that strikes you as a ridiculous
mixture, you are not conceited enough to work in a professional kitchen,
where the vile frequently masquerades as the exotic.&#41;  -- Tony White
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;12&nbsp;19:57:18&nbsp;2012</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My current thinking is to make it an error.  That way the user says
&#34;Oops!&#34; and fixes it.  I think that&#39;s best.  There&#39;s no real advantage
gained the other way, and there would be complications and potential
bugs aplenty.

The current release candidate is testing cleanly, and I will wait until
after its official release to tackle this ticket.  I hope that will just
be a few days.

thanks, Jeffrey

On Thu Jan 12 19:47:04 2012, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Let me think out what I want to do.  Could you submit a test script? 
</div>&gt; 
&gt; Perhaps per below, adapted from the ret.pl I first posted.  As of now
&gt; the first test fails and the second succeeds &#40;as the last value returned
&gt; is checked&#41;.
&gt; 
&gt; Of course you could instead make multiple return values an error.
&gt; That&#39;d still be compatible with the documented behaviour and could relax
&gt; it as a feature later.
&gt; 
&gt; The constructor call is already in array context, so switching to
&gt; map{\$_}&#38;$func&#40;&#41; to detect multiple return doesn&#39;t change the
&gt; wantarray&#40;&#41; the func sees, if I&#39;m not mistaken.  Not that array vs
&gt; scalar context for the constructor is a documented feature ...
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;12&nbsp;20:02:52&nbsp;2012</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64093] constructor return multiple values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Jan 2012 12:03:05 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; My current thinking is to make it an error.  That way the user says
&gt; &#34;Oops!&#34; and fixes it.  I think that&#39;s best.  There&#39;s no real advantage
&gt; gained the other way, and there would be complications and potential
&gt; bugs aplenty.
</div>
Don&#39;t you keep an array of pending targets to be descended?  Multiple
returns from the constructor could just start that from a few values
instead of one, no?

Even if you want to start from one you could always make it

    my $start = [ map {\$_} &#38;$constructor&#40;&#41; ];

encapsulating what the constructor would otherwise have to do itself.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;12&nbsp;20:26:13&nbsp;2012</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ll keep this possibility in mind when I study this ticket in a few
days.  Frankly, I just have never seen any value in allowing the
constructor to return lists.  If the user wants multiple values in an
array ref, he can create the array ref and return it from the
constructor himself, right?  And that way, the user knows precisely
what&#39;s going on and why. 

-- jeffrey
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;14&nbsp;17:47:12&nbsp;2012</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64093] constructor return multiple values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 Jan 2012 09:46:56 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; If the user wants multiple values in an
&gt; array ref, he can create the array ref and return it from the
&gt; constructor himself, right?
</div>
Oh, well, there&#39;s more than one way to do it :-&#41;.  &#34;return @foo&#34; or
&#34;return \@foo&#34; or &#34;return $a,$b&#34;, etc.  If there&#39;s something with a
reasonable meaning there&#39;s not much reason not to allow it, after all
this is perl not python.

The multiple values I&#39;ve wanted to do have sometimes been C-code
sub-objects which won&#39;t be reached by the normal traversal, and
sometimes because I&#39;ve tinkered with sub-parts in the constructor code
and might as well return the parts too so as to be sure they all go as
intended ...




-- 
The sigfile restaurant jargon elucidated for the layman series:
&#34;Special&#34; -- something almost gone bad that has to be sold today.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;27&nbsp;21:56:27&nbsp;2012</span>
    <span class="description">KRYDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Done as checking all returned values.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;27&nbsp;21:56:28&nbsp;2012</span>
    <span class="description">KRYDE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
