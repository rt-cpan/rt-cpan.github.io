<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #103484 for Prima: Font tests fail with hlv fonts</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #103484 for Prima: Font tests fail with hlv fonts</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Prima/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Prima/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Prima/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Prima/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Prima">Prima CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">103484</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Prima/Active/">Prima</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-27120-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.43    </td>
  </tr>
  <tr id="CF-27121-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;05:07:36&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Font tests fail with hlv fonts</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">While 1.42 passes all tests for me, 1.43 fails on the same system:

t/Object/Fonts.t ........ 183/? 
#   Failed test &#39;width by size / hlv&#39;
#   at t/Object/Fonts.t line 51.
#          got: &#39;5&#39;
#     expected: &#39;4&#39;
xft: want 10x0.0.variable.hlv/iso8859-1^0
xft: refuse
xft: want 42x0.0.variable.hlv/iso8859-1^0
xft: refuse
xft: want 10x0.0.variable.hlv/iso8859-1^0
xft: refuse
xft: want -36x0.0.variable.hlv/iso8859-1^0
xft: refuse
xft: want -8x0.0.variable.hlv/iso8859-1^0
xft: refuse
xft: want 9x0.0.default.hlv/iso8859-1^12
xft: try nonrotated font
xft:    want 9x0.0.default.hlv/iso8859-1^0
xft:    refuse
xft: FC_PIXEL_SIZE = 9
xft: refuse bitmapped font
xft: want 9x0.0.default.hlv/iso8859-1^0
xft: refuse
xft: want 9x0.0.variable.hlv/iso8859-1^0
xft: refuse
xft: want 9x24.0.default.hlv/iso8859-1^0
xft: refuse
xft: want 9x4.0.default.hlv/iso8859-1^0
xft: refuse
xft: want -7x0.0.variable.hlv/iso8859-1^0
xft: refuse
xft: want -7x24.0.default.hlv/iso8859-1^0
xft: refuse
xft: want -7x4.0.default.hlv/iso8859-1^0
xft: refuse

#   Failed test &#39;width by size / hlv&#39;
#   at t/Object/Fonts.t line 51.
#          got: &#39;5&#39;
#     expected: &#39;4&#39;
xft: want 8x0.ffffffc7.default.hlv/iso8859-1^0
xft: refuse
font reqH:8&#40;s=7&#41;x0.ffffffff.default hlv/iso8859-1
font: #1481 &#40;diff=50&#41;: -mplus-hlv-bold-i-normal--0-0-75-75-p-0-iso8859-1
font: pick:0&#40;0&#41;x0.5.variable hlv/iso8859-1 .vector
font: construct h=8, s=0
font: loading -mplus-hlv-bold-i-normal--8-0-75-75-p-0-iso8859-1
font height pick: 1::8 =&gt; 9, advised 71
font: construct h=7.1, s=0
font: loading -mplus-hlv-bold-i-normal--7-0-75-75-p-0-iso8859-1
font: width = FXA_AVERAGE_WIDTH 4&#40;44&#41;
font cache add: 8&#40;6&#41;x4.5.variable hlv/iso8859-1
xft: want 8x0.0.default.hlv/iso8859-1^0
xft: refuse
xft: want 16x0.0.variable.hlv/iso8859-1^0
xft: refuse

#   Failed test &#39;width by size / hlvw&#39;
#   at t/Object/Fonts.t line 51.
#          got: &#39;6&#39;
#     expected: &#39;5&#39;
xft: want 12x0.0.variable.hlvw/iso8859-1^0
xft: refuse
xft: want 48x0.0.variable.hlvw/iso8859-1^0
xft: refuse
xft: want 12x0.0.variable.hlvw/iso8859-1^0
xft: refuse
xft: want -39x0.0.variable.hlvw/iso8859-1^0
xft: refuse
xft: want -9x0.0.variable.hlvw/iso8859-1^0
xft: refuse
xft: want 11x0.0.default.hlvw/iso8859-1^12
xft: try nonrotated font
xft:    want 11x0.0.default.hlvw/iso8859-1^0
xft:    refuse
xft: FC_PIXEL_SIZE = 11
xft: refuse bitmapped font
xft: want 11x0.0.default.hlvw/iso8859-1^0
xft: refuse
xft: want 11x0.0.variable.hlvw/iso8859-1^0
xft: refuse
xft: want 11x30.0.default.hlvw/iso8859-1^0
xft: refuse
xft: want 11x6.0.default.hlvw/iso8859-1^0
xft: refuse
xft: want -8x0.0.variable.hlvw/iso8859-1^0
xft: refuse
xft: want -8x27.0.default.hlvw/iso8859-1^0
xft: refuse
xft: want -8x5.0.default.hlvw/iso8859-1^0
xft: refuse

#   Failed test &#39;width by size / hlvw&#39;
#   at t/Object/Fonts.t line 51.
#          got: &#39;6&#39;
#     expected: &#39;5&#39;
xft: want 9x0.ffffffc7.default.hlvw/iso8859-1^0
xft: refuse
font reqH:9&#40;s=8&#41;x0.ffffffff.default hlvw/iso8859-1
font: #1489 &#40;diff=6050&#41;: -mplus-hlvw-medium-r-normal--0-0-75-75-p-0-iso8859-1
font: pick:0&#40;0&#41;x0.0.variable hlvw/iso8859-1 .vector
font: construct h=9, s=0
font: loading -mplus-hlvw-medium-r-normal--9-0-75-75-p-0-iso8859-1
font height pick: 1::9 =&gt; 11, advised 73
font: construct h=7.3, s=0
font: loading -mplus-hlvw-medium-r-normal--7-0-75-75-p-0-iso8859-1
font height pick: 2::9 =&gt; 8, advised 79
font: construct h=7.9, s=0
font: loading -mplus-hlvw-medium-r-normal--7-0-75-75-p-0-iso8859-1
font height pick: 3::9 =&gt; 8, advised 83
font: construct h=8.3, s=0
font: loading -mplus-hlvw-medium-r-normal--8-0-75-75-p-0-iso8859-1
font: width = FXA_AVERAGE_WIDTH 5&#40;49&#41;
font cache add: 9&#40;7&#41;x5.0.variable hlvw/iso8859-1
xft: want 9x0.0.default.hlvw/iso8859-1^0
xft: refuse
xft: want 16x0.0.variable.hlvw/iso8859-1^0
xft: refuse
t/Object/Fonts.t ........ 960/? # Looks like you failed 4 tests of 1099.
t/Object/Fonts.t ........ Dubious, test returned 4 &#40;wstat 1024, 0x400&#41;
Failed 4/1099 subtests 
        &#40;less 148 skipped subtests: 947 okay&#41;

The hlv fonts are some Japanese bitmap fonts. You can get them from this RPM package &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://koji.fedoraproject.org/koji/buildinfo?buildID=533147">https://koji.fedoraproject.org/koji/buildinfo?buildID=533147</a></span>&gt;. There are these files:

$ fc-list  |grep hlv
/usr/share/fonts/japanese-bitmap/mplus_h12rw.pcf.gz: hlvw:style=Regular
/usr/share/fonts/japanese-bitmap/mplus_h12b-euro.pcf.gz: hlv:style=Bold
/usr/share/fonts/japanese-bitmap/mplus_h10b-euro.pcf.gz: hlv:style=Bold
/usr/share/fonts/japanese-bitmap/mplus_h10-euro.pcf.gz: hlv:style=Regular
/usr/share/fonts/japanese-bitmap/mplus_h12-euro.pcf.gz: hlv:style=Regular
/usr/share/fonts/japanese-bitmap/mplus_h12.pcf.gz: hlv:style=Regular
/usr/share/fonts/japanese-bitmap/mplus_h10i-euro.pcf.gz: hlv:style=Italic
/usr/share/fonts/japanese-bitmap/mplus_h12i-euro.pcf.gz: hlv:style=Italic
/usr/share/fonts/japanese-bitmap/mplus_h12bi-euro.pcf.gz: hlv:style=Bold Italic
/usr/share/fonts/japanese-bitmap/mplus_h10bi.pcf.gz: hlv:style=Bold Italic
/usr/share/fonts/japanese-bitmap/mplus_h12bi.pcf.gz: hlv:style=Bold Italic
/usr/share/fonts/japanese-bitmap/mplus_h10bi-euro.pcf.gz: hlv:style=Bold Italic
/usr/share/fonts/japanese-bitmap/mplus_h12rw-euro.pcf.gz: hlvw:style=Regular
/usr/share/fonts/japanese-bitmap/mplus_h10b.pcf.gz: hlv:style=Bold
/usr/share/fonts/japanese-bitmap/mplus_h12b.pcf.gz: hlv:style=Bold
/usr/share/fonts/japanese-bitmap/mplus_h10i.pcf.gz: hlv:style=Italic
/usr/share/fonts/japanese-bitmap/mplus_h10.pcf.gz: hlv:style=Regular
/usr/share/fonts/japanese-bitmap/mplus_h12i.pcf.gz: hlv:style=Italic

Probably your test requires a feature not supported by these fonts. `fc-list -v&#39; shows more details about the fonts but I don&#39;t know what information is important for you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;16&nbsp;13:00:16&nbsp;2015</span>
    <span class="description">KARASIK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, thanks for the report! These fonts indeed are corner cases, reporting FXA_AVERAGE_WIDTHs inconsistent with the requested XLFD widths; I think I adapted for this now. May I ask you
to run the test again with the following patch and see if that works for you?

Sincerely, Dmitry

--- a/unix/apc_font.c
+++ b/unix/apc_font.c
@@ -1291,7 +1291,10 @@ AGAIN:

       /* detailing width */
       if &#40; f-&gt; font. width == 0 || !f-&gt; flags. width&#41; {
-         if &#40; XGetFontProperty&#40; s, FXA_AVERAGE_WIDTH, &#38;v&#41; &#38;&#38; v&#41; {
+        if &#40; f-&gt; vecname &#38;&#38; font-&gt; width &gt; 0&#41; {
+            f-&gt; font. width = font-&gt; width;
+            Fdebug&#40;&#34;font: width = copy as is %d\n&#34;, f-&gt;font.width&#41;;
+        } else if &#40; XGetFontProperty&#40; s, FXA_AVERAGE_WIDTH, &#38;v&#41; &#38;&#38; v&#41; {
             XCHECKPOINT;
             f-&gt; font. width = &#40;v + 5&#41; / 10;
             Fdebug&#40;&#34;font: width = FXA_AVERAGE_WIDTH %d&#40;%d&#41;\n&#34;, f-&gt;font.width, v&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;16&nbsp;13:00:16&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;20&nbsp;08:10:57&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #103484] Font tests fail with hlv fonts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 20 Apr 2015 14:10:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> KARASIK via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Apr 16, 2015 at 01:00:16PM -0400, KARASIK via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi, thanks for the report! These fonts indeed are corner cases, reporting
&gt; FXA_AVERAGE_WIDTHs inconsistent with the requested XLFD widths; I think
&gt; I adapted for this now. May I ask you
&gt; to run the test again with the following patch and see if that works for you?
&gt; 
</div>The patch makes the test passing for me. However in constrained testing
environment &#40;only a few installed fonts&#41; I get a new failure:

$ xvfb-run -a prove -b t/Object/Fonts.t
t/Object/Fonts.t .. Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
t/Object/Fonts.t .. 1/? Fontconfig warning: FcPattern object size does not accept value 27&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 5&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 5&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 30&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 6&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 30&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 6&#40;i&#41;

#   Failed test &#39;size / Liberation Sans&#39;
#   at t/Object/Fonts.t line 33.
#          got: &#39;12&#39;
#     expected: &#39;6&#39;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
xft: want 10x0.0.default.Liberation Sans/iso8859-1^0
xft: want 42x0.0.variable.Liberation Sans/iso8859-1^0
xft: want 10x0.0.variable.Liberation Sans/iso8859-1^0
xft: want -30x0.0.variable.Liberation Sans/iso8859-1^0
xft: want -6x0.0.variable.Liberation Sans/iso8859-1^0

#   Failed test &#39;size / Liberation Sans&#39;
#   at t/Object/Fonts.t line 33.
#          got: &#39;12&#39;
#     expected: &#39;6&#39;
xft: want 20x0.0.default.Liberation Sans/iso8859-1^12
xft: want 20x0.0.default.Liberation Sans/iso8859-1^0
xft: want 20x0.0.variable.Liberation Sans/iso8859-1^0
xft: want 20x42.0.default.Liberation Sans/iso8859-1^0
xft: want 20x10.0.default.Liberation Sans/iso8859-1^0
xft: want -12x0.0.variable.Liberation Sans/iso8859-1^0
xft: want -12x42.0.default.Liberation Sans/iso8859-1^0
xft: want -12x10.0.default.Liberation Sans/iso8859-1^0
xft: want 20x0.ffffffc7.default.Liberation Sans/iso8859-1^0
xft: want 20x0.0.default.Liberation Sans/iso8859-1^0
xft: want 16x0.0.variable.Liberation Sans/iso8859-1^0
Fontconfig warning: FcPattern object size does not accept value 30&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 6&#40;i&#41;

#   Failed test &#39;size / Comfortaa&#39;
#   at t/Object/Fonts.t line 33.
#          got: &#39;12&#39;
#     expected: &#39;6&#39;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
Fontconfig warning: FcPattern object size does not accept value 12&#40;i&#41;
xft: want 10x0.0.default.Comfortaa/iso8859-1^0
xft: want 42x0.0.variable.Comfortaa/iso8859-1^0
xft: want 10x0.0.variable.Comfortaa/iso8859-1^0
xft: want -30x0.0.variable.Comfortaa/iso8859-1^0
xft: want -6x0.0.variable.Comfortaa/iso8859-1^0

#   Failed test &#39;size / Comfortaa&#39;
#   at t/Object/Fonts.t line 33.
#          got: &#39;12&#39;
#     expected: &#39;6&#39;
xft: want 19x0.0.default.Comfortaa/iso8859-1^12
xft: want 19x0.0.default.Comfortaa/iso8859-1^0
xft: want 19x0.0.variable.Comfortaa/iso8859-1^0
xft: want 19x42.0.default.Comfortaa/iso8859-1^0
xft: want 19x10.0.default.Comfortaa/iso8859-1^0
xft: want -12x0.0.variable.Comfortaa/iso8859-1^0
xft: want -12x42.0.default.Comfortaa/iso8859-1^0
xft: want -12x10.0.default.Comfortaa/iso8859-1^0
xft: want 19x0.ffffffc7.default.Comfortaa/iso8859-1^0
xft: want 19x0.0.default.Comfortaa/iso8859-1^0
xft: want 16x0.0.variable.Comfortaa/iso8859-1^0
# Looks like you failed 4 tests of 63.
t/Object/Fonts.t .. Dubious, test returned 4 &#40;wstat 1024, 0x400&#41;
Failed 4/63 subtests

On different system, I get different expected number:

#   Failed test &#39;height / glisp&#39;
#   at t/Object/Fonts.t line 33.
#          got: &#39;12&#39;
#     expected: &#39;11&#39;

I will try to find which fonts make the test happy.

-- Petr
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;20&nbsp;08:54:37&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Po 20.dub.2015 08:10:57, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ xvfb-run -a prove -b t/Object/Fonts.t
&gt; t/Object/Fonts.t .. Fontconfig warning: FcPattern object size does not
&gt; accept value 12&#40;i&#41;
&gt; t/Object/Fonts.t .. 1/? Fontconfig warning: FcPattern object size does
&gt; not accept value 27&#40;i&#41;
&gt; Fontconfig warning: FcPattern object size does not accept value 5&#40;i&#41;
&gt; Fontconfig warning: FcPattern object size does not accept value 5&#40;i&#41;
&gt; Fontconfig warning: FcPattern object size does not accept value 30&#40;i&#41;
&gt; Fontconfig warning: FcPattern object size does not accept value 6&#40;i&#41;
&gt; Fontconfig warning: FcPattern object size does not accept value 30&#40;i&#41;
&gt; Fontconfig warning: FcPattern object size does not accept value 6&#40;i&#41;
&gt; 
&gt; #   Failed test &#39;size / Liberation Sans&#39;
&gt; #   at t/Object/Fonts.t line 33.
&gt; #          got: &#39;12&#39;
&gt; #     expected: &#39;6&#39;
</div>
I could not reproduce the pass without these failures on other machine. On the one machine where is passes, it fails the same way when running against Xfvb instead of the Xorg with nouveau. Maybe something related to DPI and font scaling.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;18:49:21&nbsp;2015</span>
    <span class="description">KARASIK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Petr,

May I ask to test with another patch? This time I cannot give the proper one because it&#39;s too far off with all debug stuff I&#39;ve added, but can you try something like this fix below? 

Thank you!
Dmitry

diff --git a/unix/xft.c b/unix/xft.c
index 442c702..a530d37 100644
--- a/unix/xft.c
+++ b/unix/xft.c
@@ -690,7 +690,7 @@ prima_xft_font_pick&#40; Handle self, Font * source, Font * dest
, double * size, Xft
          FcPatternAddDouble&#40; request, FC_SIZE, *size&#41;;
          XFTdebug&#40;&#34;FC_SIZE = %.1f&#34;, *size&#41;;
       } else {
-         FcPatternAddInteger&#40; request, FC_SIZE, requested_font. size&#41;;
+         FcPatternAddDouble&#40; request, FC_SIZE, requested_font. size&#41;;
          XFTdebug&#40;&#34;FC_SIZE = %d&#34;, requested_font. size&#41;;
       }
    } else {
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;23&nbsp;03:20:55&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #103484] Font tests fail with hlv fonts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Apr 2015 09:20:43 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> KARASIK via RT &lt;bug-Prima [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Apr 22, 2015 at 06:49:21PM -0400, KARASIK via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; May I ask to test with another patch? This time I cannot give the proper one
&gt; because it&#39;s too far off with all debug stuff I&#39;ve added, but can you try
&gt; something like this fix below? 
&gt; 
</div>Great. Applying this patch on top of the previous one makes all tests passing.
Both on real Xorg and also on Xvfb on all the machines I tested previously.

-- Petr
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;23&nbsp;04:27:11&nbsp;2015</span>
    <span class="description">KARASIK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
