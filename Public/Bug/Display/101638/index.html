<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #101638 for Net-SSLeay: On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #101638 for Net-SSLeay: On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">101638</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SSLeay/Active/">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MITHALDU [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;20&nbsp;16:57:38&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The error message it prints is:

    OPENSSL_Uplink&#40;02831000,08&#41;: no OPENSSL_Applink

Stackoverflow suggests &#40; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/a/22435989/145119">http://stackoverflow.com/a/22435989/145119</a></span> &#41; that it can be easily fixed:

    <span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/support/faq.html#PROG2">https://www.openssl.org/support/faq.html#PROG2</a></span>

Note the last paragraph.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;18:02:49&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Jan 2015 09:02:34 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I have not been able to reproduce this yet.

how did you build and install your openssl 1.0.1l?

Cheers.

On Tuesday, January 20, 2015 04:57:39 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Jan 20 16:57:38 2015: Request 101638 was acted upon.
&gt; Transaction: Ticket created by MITHALDU
&gt;        Queue: Net-SSLeay
&gt;      Subject: On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: MITHALDU@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; 
&gt; The error message it prints is:
&gt; 
&gt;     OPENSSL_Uplink&#40;02831000,08&#41;: no OPENSSL_Applink
&gt; 
&gt; Stackoverflow suggests &#40; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/a/22435989/145119">http://stackoverflow.com/a/22435989/145119</a></span> &#41; that
&gt; it can be easily fixed:
&gt; 
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/support/faq.html#PROG2">https://www.openssl.org/support/faq.html#PROG2</a></span>
&gt; 
&gt; Note the last paragraph.
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;18:02:50&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;18:24:15&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Some more information:

I&#39;m running this ActivePerl:

  This is perl 5, version 16, subversion 3 &#40;v5.16.3&#41; built for MSWin32-x86-multi-thread
  &#40;with 1 registered patch, see perl -V for more detail&#41;
  
  Copyright 1987-2012, Larry Wall
  
  Binary build 1604 [298023] provided by ActiveState <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span>
  Built Apr 14 2014 14:32:20

You may need to try and install a newer ActivePerl, since the dmake+gcc packages installed when cpan is first run, may be locked on older versions.

To get my OpenSSL i downloaded it from here:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://slproweb.com/download/Win32OpenSSL-1_0_1L.exe">http://slproweb.com/download/Win32OpenSSL-1_0_1L.exe</a></span>

Once that was installed i set the OPENSSL_PREFIX &#40;sp&#41; env var to point at that directory and attempted an install.

If you need more information, please ask here, or poke me on irc.perl.org as Mithaldu at pretty much any time. :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;19:15:09&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Jan 2015 10:14:55 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Wednesday, January 21, 2015 06:24:15 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; Some more information:
&gt; 
&gt; I&#39;m running this ActivePerl:
&gt; 
&gt;   This is perl 5, version 16, subversion 3 &#40;v5.16.3&#41; built for
&gt; MSWin32-x86-multi-thread &#40;with 1 registered patch, see perl -V for more
&gt; detail&#41;
&gt; 
&gt;   Copyright 1987-2012, Larry Wall
&gt; 
&gt;   Binary build 1604 [298023] provided by ActiveState
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span> Built Apr 14 2014 14:32:20
&gt; 
&gt; You may need to try and install a newer ActivePerl, since the dmake+gcc
&gt; packages installed when cpan is first run, may be locked on older versions.
&gt; 
&gt; To get my OpenSSL i downloaded it from here:
&gt; 
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://slproweb.com/download/Win32OpenSSL-1_0_1L.exe">http://slproweb.com/download/Win32OpenSSL-1_0_1L.exe</a></span>
&gt; 
&gt; Once that was installed i set the OPENSSL_PREFIX &#40;sp&#41; env var to point at
&gt; that directory and attempted an install.
</div>
By what method did you &#39;attempt an install&#39;

Full transcript would help.

Cheers

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; If you need more information, please ask here, or poke me on irc.perl.org as
&gt; Mithaldu at pretty much any time. :&#41;
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;19:21:00&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I simply did cpan Net::SSLeay. I&#39;ll prepare a transcript from the start.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;19:30:59&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just realized i did not need to set the prefix for the install, maybe i misremembered that from other things.

Here&#39;s a transcript: <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/wchristian/77942bb7fc260370ec3f">https://gist.github.com/wchristian/77942bb7fc260370ec3f</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;21:24:12&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Jan 2015 12:23:50 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks.
I can reproduce now.

Alas the fix is not as simple as just #include&#39;ing applink.c.
In a perl environment, that produces lots of errors due to perls redefinitions 
of fget to PerlSIO_fgets etc.

Ideas?

Cheers.


On Wednesday, January 21, 2015 07:31:00 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; I just realized i did not need to set the prefix for the install, maybe i
&gt; misremembered that from other things.
&gt; 
&gt; Here&#39;s a transcript: <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/wchristian/77942bb7fc260370ec3f">https://gist.github.com/wchristian/77942bb7fc260370ec3f</a></span>
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;21:28:46&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That&#39;s why i didn&#39;t include a patch myself. The problem is that you don&#39;t want to include it in your XS, but in the generated C code. Others have indicated that Module::Build will do the right thing if you use a key called c_source or c_sources. However with Module::Install, i have no clue and i couldn&#39;t find anyone who had. I personally tried with this: <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Module::Install::XSUtil">https://metacpan.org/pod/Module::Install::XSUtil</a></span> However due to you having that private module in your inc dir, it&#39;s not as easy as deleting the inc dir and letting MI rebuild its stuff. You could try asking in #toolchain, or contacting the maintainer of MI, or anyone else really who actually knows how it works. I failed in finding anyone who didn&#39;t simply tell me &#34;MI is bad, don&#39;t use it.&#34; :&#40;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;22:33:50&nbsp;2015</span>
    <span class="description">LEONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 21 21:24:12 2015, mikem@airspayce.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks.
&gt; I can reproduce now.
&gt; 
&gt; Alas the fix is not as simple as just #include&#39;ing applink.c.
&gt;  In a perl environment, that produces lots of errors due to perls
&gt; redefinitions
&gt; of fget to PerlSIO_fgets etc.
</div>
That can be turned off by #defining NO_XSLOCKS before #including XSUB.h, that will turn off PerlHost integration. PerlHost is not something you&#39;re terribly likely to want &#40;and it breaks a lot of external stuff&#41;, though I can&#39;t guarantee you won&#39;t without being familiar with this codebase.

Leon
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;22&nbsp;03:13:51&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Jan 2015 18:13:31 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Leon,

thanks. That certainly works.
But I cant find much info on what the side effects of #define NO_XSLOCKS might 
be, or even about PerlHost. Any pointers?

Cheers.


On Wednesday, January 21, 2015 10:33:51 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; On Wed Jan 21 21:24:12 2015, mikem@airspayce.com wrote:
<div class="message-stanza open">&gt; &gt; Thanks.
&gt; &gt; I can reproduce now.
&gt; &gt; 
&gt; &gt; Alas the fix is not as simple as just #include&#39;ing applink.c.
&gt; &gt; 
&gt; &gt;  In a perl environment, that produces lots of errors due to perls
&gt; &gt; 
&gt; &gt; redefinitions
&gt; &gt; of fget to PerlSIO_fgets etc.
</div>&gt; 
&gt; That can be turned off by #defining NO_XSLOCKS before #including XSUB.h,
&gt; that will turn off PerlHost integration. PerlHost is not something you&#39;re
&gt; terribly likely to want &#40;and it breaks a lot of external stuff&#41;, though I
&gt; can&#39;t guarantee you won&#39;t without being familiar with this codebase.
&gt; 
&gt; Leon
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;22&nbsp;17:18:09&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 Jan 2015 08:17:53 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmmm,

well I am baffled now.
In testing here, I have added #define NO_XSLOCKS before XSUB.h
I have added the applink.c include to SSLeay.xs. I can see its being compiled 
OK and I can see the resulting OPENSSL_Applink in the SSLeay.dll file &#40;reported 
by dumpbin&#41;. Yet at runtime I still get &#34;no OPENSSL_Applink&#34;

Anyone have any ideas?

using Perl 5.16.1, shining light 1.0.1j, Visual Studio Express 2010

Cheers.


On Wednesday, January 21, 2015 10:33:51 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; On Wed Jan 21 21:24:12 2015, mikem@airspayce.com wrote:
<div class="message-stanza open">&gt; &gt; Thanks.
&gt; &gt; I can reproduce now.
&gt; &gt; 
&gt; &gt; Alas the fix is not as simple as just #include&#39;ing applink.c.
&gt; &gt; 
&gt; &gt;  In a perl environment, that produces lots of errors due to perls
&gt; &gt; 
&gt; &gt; redefinitions
&gt; &gt; of fget to PerlSIO_fgets etc.
</div>&gt; 
&gt; That can be turned off by #defining NO_XSLOCKS before #including XSUB.h,
&gt; that will turn off PerlHost integration. PerlHost is not something you&#39;re
&gt; terribly likely to want &#40;and it breaks a lot of external stuff&#41;, though I
&gt; can&#39;t guarantee you won&#39;t without being familiar with this codebase.
&gt; 
&gt; Leon
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;23&nbsp;04:16:16&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The only hint i have is that this code does the relevant check:

            applink = &#40;void **&#40;*&#41;&#40;&#41;&#41;GetProcAddress&#40;h, &#34;OPENSSL_Applink&#34;&#41;;
            if &#40;applink == NULL&#41; {
                apphandle = &#40;HMODULE&#41; - 1;
                _tcscpy&#40;msg + len, _T&#40;&#34;no OPENSSL_Applink&#34;&#41;&#41;; 

So if that error comes out, then it&#39;s highly likely that the function simply didn&#39;t get compiled in.

Then again, i am not a C developer.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;23&nbsp;15:55:32&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Jan 2015 06:55:18 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmmm,

some hints found here 
<span class="clickylink"><a target="new" rel="nofollow" href="http://comments.gmane.org/gmane.comp.encryption.openssl.user/47487">http://comments.gmane.org/gmane.comp.encryption.openssl.user/47487</a></span>
seem to indicate that OpenSSL_Applink must be in the .exe not in the .dll.

If that is so, then we are out of luck: for us the .exe is perl.exe, which we 
have no option to modify.

Cheers.

On Friday, January 23, 2015 04:16:17 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; The only hint i have is that this code does the relevant check:
&gt; 
&gt;             applink = &#40;void **&#40;*&#41;&#40;&#41;&#41;GetProcAddress&#40;h, &#34;OPENSSL_Applink&#34;&#41;;
&gt;             if &#40;applink == NULL&#41; {
&gt;                 apphandle = &#40;HMODULE&#41; - 1;
&gt;                 _tcscpy&#40;msg + len, _T&#40;&#34;no OPENSSL_Applink&#34;&#41;&#41;;
&gt; 
&gt; So if that error comes out, then it&#39;s highly likely that the function simply
&gt; didn&#39;t get compiled in.
&gt; 
&gt; Then again, i am not a C developer.
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;24&nbsp;00:00:34&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve asked bulk88 to weigh in on this and hope he&#39;ll find the time soon.

And additionally i&#39;ve sent an email to the shining lights folks to see if they can help the situation.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;26&nbsp;02:26:50&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> kmx [...] atlas.cz</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">kmx, roping you in because you seem to have a custom-compiled openssl for Strawberry. Do you think it would be viable to turn that into an Alien::OpenSSL module? Would you be able to share your compilation process?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;26&nbsp;04:10:27&nbsp;2015</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">Hi,<br>

<br>

my openssl build script for MS Windows + gcc + mingw-w64 is here: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/StrawberryPerl/build-extlibs/blob/master/build.sh#L544">https://github.com/StrawberryPerl/build-extlibs/blob/master/build.sh#L544</a></span><br>

<br>

Basically it is built via ./Configure ... + make tests + make install_sw. The latest version (1.0.2) builds fine without any additional patches and passes all tests.<br>

<br>

As for your Alien::OpenSSL idea:<br>

<br>

There already exists Alien::OpenSSL, unfortunately MSWin32 does not seem to be their priority: <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Alien-OpenSSL+0.07">http://matrix.cpantesters.org/?dist=Alien-OpenSSL+0.07</a></span><br>

<br>

I used to love the Alien::* concept. As you can check I have couple of Alien::* modules under my maintenance + I have also invested significant effort to quite complicated Alien::SDL + Alien::SDL2 modules maintained by others. But things changed.<br>

<br>

Couple of months ago I had a discussion with Chris Marshall (from PDL project) about more extensive use of Alien::* modules for detecting external libraries in PDL (mostly to make life of Windows users easier). We have even done some research and it turned out that just a very few Alien::* modules currently available on CPAN are Windows friendly (I am not far from true when I say that only my Alien::* modules do not ignore MS Windows platform).<br>

<br>

You can go to <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/requires/distribution/Alien-Base?sort=%5B%5B2,1%5D%5D">https://metacpan.org/requires/distribution/Alien-Base?sort=%5B%5B2,1%5D%5D</a></span> and check cpantesters result for each Alien::*<br>

<br>

Many of the Alien::* modules are simply a peace of junk because the authors simply take an URL for src tarball and use UNIX build style ./configure &amp;&amp; make install and completely ignore MS Windows (and we both know that Windows users have much harder times when trying to compile/install any external library from sources). In most cases they even do not bother to at least try to detect whether the library in question is not already installed on a Windows box.<br>

<br>

Example (and one of the sources of my pessimistic approach):<br>

<br>

*/ You might know about strawberry perl PDL edition (strawberry perl + many additinal libraries, mostly maths/scientific).<br>

<br>

*/ It comes bundled with fftw3 external library in a hope that Windows users will be able to use PDL::FFTW3<br>

<br>

*/ PDL::FFTW3 module uses Alien::FFTW3 for fftw3 detection (which does not seem bad at the first sight)<br>

<br>

*/ but Alien::FFTW3 intentionally sends all Windows users to the hell: <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/ZOWIE/Alien-FFTW3-0.03/Build.PL#L7">https://metacpan.org/source/ZOWIE/Alien-FFTW3-0.03/Build.PL#L7</a></span><br>

<br>

*/ ok, I have fixed that; however my pull request <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/drzowie/Alien-FFTW3/pull/3">https://github.com/drzowie/Alien-FFTW3/pull/3</a></span> got no response<br>

<br>

Similar story with Alien::GSL.<br>

<br>

Maybe it is only my personal perspective but I really try to do what I can on strawberry perl side to make external libraries detection as easy as possible: 1/ if necessary I bundle config scritps like freetype-config.bat gsl-config.bat etc. 2/ strawberry perl has working pkg-config; 3/ strawberry perl supports ExtUtils::PkgConfig module; 4/ strawberry perl supports <span>PkgConfig module What else do they need to not ignore MS Windows and try at least to detect already pre-installed libraries? (for sure it is easier do: die &quot;install a real operating system&quot; if $^O eq &#39;MSWin32&#39; )<br>

<br>

To sum up: having truly </span>cross-platform Alien::OpenSSL is doable, I am just not sure whether it is worth the effort.<br>

<br>

BTW here are couple of RTs I have submitted to improve openssl detection on MS Windows:<br>

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=56455">https://rt.cpan.org/Public/Bug/Display.html?id=56455</a></span><br>

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=84369">https://rt.cpan.org/Public/Bug/Display.html?id=84369</a></span><br>

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=77605">https://rt.cpan.org/Public/Bug/Display.html?id=77605</a></span><br>

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=84367">https://rt.cpan.org/Public/Bug/Display.html?id=84367</a></span><br>

all of them ignored for years. What are the chances that we will manage to convince them to switch to Alien::OpenSSL?<br>

<br>

--<br>

kmx<br>

<br>

P.S. sorry for spoiling this Net-SSLeay ticket with my pessimistic Alien::* thougths :)
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;26&nbsp;07:11:53&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 20 16:57:38 2015, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The error message it prints is:
&gt; 
&gt; OPENSSL_Uplink&#40;02831000,08&#41;: no OPENSSL_Applink
&gt; 
&gt; Stackoverflow suggests &#40; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/a/22435989/145119">http://stackoverflow.com/a/22435989/145119</a></span> &#41;
&gt; that it can be easily fixed:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/support/faq.html#PROG2">https://www.openssl.org/support/faq.html#PROG2</a></span>
&gt; 
&gt; Note the last paragraph.
</div>
The problem is, the OpenSSL build process assumes that OpenSSL will be embedded in an application &#40;starting EXE&#41;, not embedded in a library &#40;DLL&#41;. The code in <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/blob/master/ms/uplink.c">https://github.com/openssl/openssl/blob/master/ms/uplink.c</a></span> in OPENSSL_Uplink is evil. it does &#34;GetModuleHandle&#40;NULL&#41;&#34; to get the process starting .exe&#39;s HMODULE, then scans its export table &#40;.EXEs almost never export anything, they can&#39;t &#40;normally&#41; be used as DLLs&#41; for certain magic functions that it calls. This smells like something written by a unix person &#34;in my days son, we didn&#39;t have shared libraries, our programs directly executed Interrupt 0x80 to call the kernel&#34;

 if &#40;&#40;h = GetModuleHandle&#40;NULL&#41;&#41; == NULL&#41; {
apphandle = &#40;HMODULE&#41; - 1;
_tcscpy&#40;msg + len, _T&#40;&#34;no host application&#34;&#41;&#41;;
break;
}

That is unreachable code. GetModuleHandle with NULL is a series of
ptr derefs  &#34;return&#40;HMODULE&#41; NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress;&#34; It will always return true unless you go mucking around in the PEB, which I will now have to do fix this very bad design by OpenSSL. OpenSSL should have offered &#34;void RegisterApplink&#40;applinktable * table&#41;;&#34; instead of looking at the export table of the process starting EXE. Related commit <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/commit/3fc378aa0b464d6296fbf4f0d84b66a207b3f8a2">https://github.com/openssl/openssl/commit/3fc378aa0b464d6296fbf4f0d84b66a207b3f8a2</a></span>

So there are 2 ways to fix this to get existing shining light openssl. Win32::API::Callback::IATPatch to hook that GetModuleHandle call to return the XS module&#39;s HMODULE and then openssl can interrogate a DLL we control &#40;Net::SSLeay&#39;s XS DLL&#41; for the correct exports. Other way, from boot:, save old NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress to perl save stack, then do NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress = __ImageBase;// &#40;our XS DLL&#39;s HMODULE&#41; then do something that will tickle OPENSSL_Uplink, OPENSSL_Uplink will do its eveil thing then, when we regain control, we restore the original NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress, Bug solved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;26&nbsp;07:12:01&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 20 16:57:38 2015, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The error message it prints is:
&gt; 
&gt; OPENSSL_Uplink&#40;02831000,08&#41;: no OPENSSL_Applink
&gt; 
&gt; Stackoverflow suggests &#40; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/a/22435989/145119">http://stackoverflow.com/a/22435989/145119</a></span> &#41;
&gt; that it can be easily fixed:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/support/faq.html#PROG2">https://www.openssl.org/support/faq.html#PROG2</a></span>
&gt; 
&gt; Note the last paragraph.
</div>
The problem is, the OpenSSL build process assumes that OpenSSL will be embedded in an application &#40;starting EXE&#41;, not embedded in a library &#40;DLL&#41;. The code in <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/blob/master/ms/uplink.c">https://github.com/openssl/openssl/blob/master/ms/uplink.c</a></span> in OPENSSL_Uplink is evil. it does &#34;GetModuleHandle&#40;NULL&#41;&#34; to get the process starting .exe&#39;s HMODULE, then scans its export table &#40;.EXEs almost never export anything, they can&#39;t &#40;normally&#41; be used as DLLs&#41; for certain magic functions that it calls. This smells like something written by a unix person &#34;in my days son, we didn&#39;t have shared libraries, our programs directly executed Interrupt 0x80 to call the kernel&#34;

 if &#40;&#40;h = GetModuleHandle&#40;NULL&#41;&#41; == NULL&#41; {
apphandle = &#40;HMODULE&#41; - 1;
_tcscpy&#40;msg + len, _T&#40;&#34;no host application&#34;&#41;&#41;;
break;
}

That is unreachable code. GetModuleHandle with NULL is a series of
ptr derefs  &#34;return&#40;HMODULE&#41; NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress;&#34; It will always return true unless you go mucking around in the PEB, which I will now have to do fix this very bad design by OpenSSL. OpenSSL should have offered &#34;void RegisterApplink&#40;applinktable * table&#41;;&#34; instead of looking at the export table of the process starting EXE. Related commit <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/commit/3fc378aa0b464d6296fbf4f0d84b66a207b3f8a2">https://github.com/openssl/openssl/commit/3fc378aa0b464d6296fbf4f0d84b66a207b3f8a2</a></span>

So there are 2 ways to fix this to get existing shining light openssl. Win32::API::Callback::IATPatch to hook that GetModuleHandle call to return the XS module&#39;s HMODULE and then openssl can interrogate a DLL we control &#40;Net::SSLeay&#39;s XS DLL&#41; for the correct exports. Other way, from boot:, save old NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress to perl save stack, then do NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress = __ImageBase;// &#40;our XS DLL&#39;s HMODULE&#41; then do something that will tickle OPENSSL_Uplink, OPENSSL_Uplink will do its eveil thing then, when we regain control, we restore the original NtCurrentTeb&#40;&#41;-&gt;Peb-&gt;ImageBaseAddress, Bug solved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;00:28:04&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Branch that fixes the 39_pkcs12.t failures <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bulk88/netssleay/commits/master">https://github.com/bulk88/netssleay/commits/master</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;11:41:27&nbsp;2015</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mike, could you review bulk&#39;s proposed fixes please? :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;17:05:01&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 26 Sep 2015 07:04:35 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Friday, September 25, 2015 11:41:28 AM Christian Walde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; Mike, could you review bulk&#39;s proposed fixes please? :&#41;
</div>
Hmmm, Im not sure Im well qualified for that :-&#40;

-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;17:07:44&nbsp;2015</span>
    <span class="description">walde.christian [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Sep 2015 23:07:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> MITHALDU [...] cpan.org, &#34;Mike McCauley via RT&#34; &lt;bug-Net-SSLeay [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Walde&#34; &lt;walde.christian [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In that case, can you maybe throw together a dev release and get it on  
cpan to see what the smokers say about it?

-- 
With regards,
Christian Walde
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;26&nbsp;18:12:38&nbsp;2015</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101638] On windows t/local/39_pkcs12.t fails with OpenSSL 1.0.1l</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 27 Sep 2015 08:12:26 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmmm, well I have been trying to build net-ssleay with bulk&#39;s patch against 
perl 15.6.1 with Windows SDK 6.1, without success.

2 main compile problems I see &#40;details below&#41; are:

No definition of PerlSIO_fgets and friends

and

NtCurrentTeb is redefined.
&#40;here it seems to get one from C:\Program Files\Microsoft 
SDKs\Windows\v6.1\Include\winnt.h&#41;
If that function can be got from a windows header file, why not use that one?

I am also a bit nervous of the structs PEB_FREE_BLOCK and PEB. These seem to 
be copied from Windows somewhere, and I dont see why they are not got with a 
#include rather than being in SSLeay.xs.

Can bulk shed any light?

gory details:

        cl -c  -IC:\OpenSSL-Win32/include  -nologo -GF -W3 -MD -Zi -DNDEBUG -
O1
-DWIN32 -D_CONSOLE -DNO_STRICT -DPERL_TEXTMODE_SCRIPTS -DUSE_SITECUSTOMIZE -
DPER
L_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -DUSE_PERLIO -D_USE_32BIT_TIME_T -MD -
Zi
-DNDEBUG -O1    -DVERSION=\&#34;1.72\&#34;  -DXS_VERSION=\&#34;1.72\&#34;  &#34;-IC:
\Perl\lib\CORE&#34;
  SSLeay.c
SSLeay.c
r:\net-ssleay\trunk\applink.c&#40;103&#41; : error C2065: &#39;PerlSIO_fgets&#39; : undeclared 
i
dentifier
r:\net-ssleay\trunk\applink.c&#40;103&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
r:\net-ssleay\trunk\applink.c&#40;104&#41; : error C2065: &#39;PerlSIO_fread&#39; : undeclared 
i
dentifier
r:\net-ssleay\trunk\applink.c&#40;104&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
r:\net-ssleay\trunk\applink.c&#40;105&#41; : error C2065: &#39;PerlSIO_fwrite&#39; : 
undeclared
identifier
r:\net-ssleay\trunk\applink.c&#40;105&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
r:\net-ssleay\trunk\applink.c&#40;108&#41; : error C2065: &#39;PerlSIO_fclose&#39; : 
undeclared
identifier
r:\net-ssleay\trunk\applink.c&#40;108&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
r:\net-ssleay\trunk\applink.c&#40;110&#41; : error C2065: &#39;PerlSIO_fopen&#39; : undeclared 
i
dentifier
r:\net-ssleay\trunk\applink.c&#40;110&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
r:\net-ssleay\trunk\applink.c&#40;111&#41; : error C2065: &#39;PerlSIO_fseek&#39; : undeclared 
i
dentifier
r:\net-ssleay\trunk\applink.c&#40;111&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
r:\net-ssleay\trunk\applink.c&#40;112&#41; : error C2065: &#39;PerlSIO_ftell&#39; : undeclared 
i
dentifier
r:\net-ssleay\trunk\applink.c&#40;112&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
r:\net-ssleay\trunk\applink.c&#40;113&#41; : error C2065: &#39;PerlSIO_fflush&#39; : undeclared
identifier
r:\net-ssleay\trunk\applink.c&#40;113&#41; : warning C4047: &#39;=&#39; : &#39;void *&#39; differs in 
le
vels of indirection from &#39;int&#39;
SSLeay.xs&#40;371&#41; : error C2084: function &#39;_TEB *NtCurrentTeb&#40;void&#41;&#39; already has 
a
body

C:\Program Files\Microsoft SDKs\Windows\v6.1\Include\winnt.h&#40;13376&#41; : se
e previous definition of &#39;NtCurrentTeb&#39;

On Friday, September 25, 2015 05:07:45 PM Christian Walde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638">https://rt.cpan.org/Ticket/Display.html?id=101638</a></span> &gt;
&gt; 
&gt; In that case, can you maybe throw together a dev release and get it on
&gt; cpan to see what the smokers say about it?
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;21:04:53&nbsp;2020</span>
    <span class="description">jkahrman [...] mathworks.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ran into the same test issue on Windows 7, VS2015, OpenSSL 1.0.2l, Net-SSLeay 1.88. 

I don&#39;t know if what I did is correct, but I was able to get past the compilation issues of the proposed patch and pass all the self tests by:

* including applink.c before XSUB.h &#40;avoids &#34;PerlSIO_f* undeclared&#34; problems&#41;
* replacing the entire first WIN32 block &#40;struct definitions&#41; with &#34;#include &lt;winternl.h&gt;&#34; and replacing the &#34;ImageBaseAddress&#34; references with &#34;Reserved3[1]&#34;

I also used the applink.c from openssl&#39;s include directory instead of adding a copy in Net-SSLeay.

Again, I&#39;m not sure if everything is working, but the tests pass.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> NetSSLeay_101638.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- a/Makefile.PL	2020-01-21 14:20:32.000000000 -0500
+++ b/Makefile.PL	2020-01-21 14:20:32.000000000 -0500
@@ -8,7 +8,7 @@
 use File::Basename &#40;&#41;;
 use Symbol qw&#40;gensym&#41;;
 
-# Define this to one if you want to link the openssl libraries statically into 
+# Define this to one if you want to link the openssl libraries statically into
 # the Net-SSLeay loadable object on Windows
 my $win_link_statically = 0;
 
@@ -76,6 +76,7 @@
       },
     },
   },
+  &#40;$^O eq &#39;MSWin32&#39; ? &#40;FUNCLIST =&gt; [&#39;boot_Net__SSLeay&#39;, &#39;OPENSSL_Applink&#39;]&#41; : &#40;&#41;&#41;,
   ssleay&#40;&#41;,
 &#41;;
 
--- a/SSLeay.xs	2020-01-21 14:20:32.000000000 -0500
+++ b/SSLeay.xs	2020-01-21 14:20:32.000000000 -0500
@@ -137,6 +137,10 @@
 #ifdef __cplusplus
 extern &#34;C&#34; {
 #endif
+#ifdef WIN32
+/* applink.c needs to be included before XSUB.h to avoid compilation errors  */
+#include &lt;openssl/applink.c&gt;
+#endif /* WIN32 */
 #include &#34;EXTERN.h&#34;
 #include &#34;perl.h&#34;
 #include &#34;XSUB.h&#34;
@@ -197,6 +201,10 @@
 #endif
 #undef BLOCK
 
+#ifdef WIN32
+#include &lt;winternl.h&gt;
+#endif /* WIN32 */
+
 /* Debugging output - to enable use:
  *
  * perl Makefile.PL DEFINE=-DSHOW_XS_DEBUG
@@ -1766,6 +1774,18 @@
 
 BOOT:
     {
+#ifdef WIN32
+/*  &#38;__ImageBase is a more efficient way to get &#34;HINSTANCE hinstDLL&#34; arg passed
+    to DllMain of this XS module, or using GetModuleHandleEx&#40;&#41; with
+    GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS &#40;&lt;- flag is WinXP or newer only,
+    no Win2k&#41; */
+#  ifndef _MSC_VER
+#    define __ImageBase _image_base__
+#  endif
+    extern IMAGE_DOS_HEADER __ImageBase;
+    PPEB peb;
+    void * OrigBaseAddress;
+#endif
     MY_CXT_INIT;
     LIB_initialized = 0;
 #ifdef USE_ITHREADS
@@ -1787,6 +1807,72 @@
 #else
     PR1&#40;&#34;BOOT:\n&#34;&#41;;
 #endif
+#ifdef WIN32
+    peb = NtCurrentTeb&#40;&#41;-&gt;ProcessEnvironmentBlock;
+    /* make sure the data under our definition of the PEB is what we want to
+       replace, if the PEB definition is wrong, &#34;peb-&gt;ImageBaseAddress&#34;
+       will contain random flags, or random pointers, so then abort patching */
+    if&#40;GetModuleHandle&#40;NULL&#41; != peb-&gt;Reserved3[1]&#41; // ImageBaseAddress
+        croak&#40;&#34;BOOT: PEB struct definition is wrong&#34;&#41;;
+    OrigBaseAddress = peb-&gt;Reserved3[1]; // ImageBaseAddress
+    /* do the patch */
+    peb-&gt;Reserved3[1] = &#38;__ImageBase; // ImageBaseAddress
+    /* verify that the patch had an effect, typically DLLs live at address
+       0x10000000 unless relocated or rebased, 0x10000000 looks like a flag so
+       the patch location might have been a false positive, and is actually
+       flag 0x10000000 if the PEB definition is wrong/changed in the future by
+       MS, so make sure that patch&#39;s effect shows in the public API
+       GetModuleHandle */
+    if&#40;GetModuleHandle&#40;NULL&#41; != &#40;HMODULE&#41;&#38;__ImageBase&#41; {
+        croak&#40;&#34;BOOT: PEB patching failed, patch had no effect&#34;&#41;;
+    }
+    {
+        /* do something that ultimatley calls OPENSSL_Applink to initialize
+           the function pointer now so we can immediatly undo the patch */
+        char fn [MAX_PATH+1];
+        BIO * bio;
+        int bio_flags;
+        FILE * f;
+        /* we know we the XS DLL exist on disk, by the sheer fact that you cant
+          delete a loaded in memory DLL */
+        DWORD res = GetModuleFileName&#40;&#40;HMODULE&#41;&#38;__ImageBase, fn, MAX_PATH+1&#41;;
+        if &#40;!res || res ==MAX_PATH+1&#41;
+            croak&#40;&#34;BOOT: GetModuleFileName failed&#34;&#41;;
+        f = fopen&#40;fn, &#34;r&#34;&#41;;
+        /* if BIO_new_file is used, applink wont be called, since openssl will
+           use it&#39;s CRT for the rest of the BIO&#39;s life, not SSLeay.xs&#39;s CRT */
+        bio = BIO_new&#40;BIO_s_file&#40;&#41;&#41;;
+        bio_flags = BIO_get_flags&#40;bio&#41;;
+#define PLSSLEAY_FLAGS_UPLINK         0x8000 /* not defined in a public header */
+        /* by default, a new BIO, has BIO_FLAGS_UPLINK flag turned on, atleast
+          for Win32 builds, setting a FILE * may or may not clear that flag.
+          Since the value of BIO_FLAGS_UPLINK may change in the future, detect
+          if it has changed and error out if the flag isn&#39;t in a fresh BIO
+          object. We must have BIO_FLAGS_UPLINK turned on to force a call
+          to OPENSSL_Applink */
+        if&#40;&#40;bio_flags &#38; PLSSLEAY_FLAGS_UPLINK&#41; != PLSSLEAY_FLAGS_UPLINK&#41;
+            croak&#40;&#34;BOOT: this Win32 OpenSSL library isn&#39;t using BIO_FLAGS_UPLINK for new BIO objects&#34;&#41;;
+        /* BIO_set_fp winds up calling BIO_set_fp-&gt;file_ctrl, and in file_ctrl
+           in &#34;case BIO_C_SET_FILE_PTR:&#34;, openssl does some tests to guess if
+           the FILE * is from openssl&#39;s CRT or not, if it guesses it is from
+           openssl&#39;s CRT, it then turns off BIO_FLAGS_UPLINK flag, but not all
+           UP_* calls do this guessing, like &#34;case BIO_CTRL_FLUSH:&#34;, so for
+           saftey force BIO_FLAGS_UPLINK back on, it may or may not already
+           have been there based on the CRT versions and guessing of origin of
+           the FILE *, this guarentees that an UP_* will be called in BIO_free
+        */
+
+        BIO_set_fp&#40;bio, f, BIO_CLOSE&#41;;
+        BIO_set_flags&#40;bio, PLSSLEAY_FLAGS_UPLINK&#41;;
+        /* OPENSSL_Applink gets called from inside BIO_free */
+        BIO_free&#40;bio&#41;;
+    }
+    /* undo the patch, the static vars inside are now set, if this isn&#39;t done
+       VC C debugger and VMMap will both claim SSLeay.dll is &#34;the process&#34; AKA
+       &#34;the .exe that started the process&#34; which is very confusing to someone
+       who is using these diagnostic tools */
+    peb-&gt;Reserved3[1] = OrigBaseAddress; // ImageBaseAddress
+#endif
     }
 
 void
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;12:04:45&nbsp;2020</span>
    <span class="description">RADIATOR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 11 21:04:53 2020, jkahrman@mathworks.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ran into the same test issue on Windows 7, VS2015, OpenSSL 1.0.2l,
&gt; Net-SSLeay 1.88.
</div>
What Perl are you using? Strawberry does not need this, but I guess, for example, ActivePerl does. I&#39;d like to understand better the target environment before working on this. What I already have is a Windows host where I have sucessfully compiled OpenSSL for another case.

Thanks,

-- 
Heikki Vatiainen
hvn@open.com.au
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;28&nbsp;01:56:40&nbsp;2020</span>
    <span class="description">ZARABOZO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m facing the same issue. Consider that:

1&#41; I&#39;m on Windows 10 x64.
2&#41; I&#39;m using MSVC command line tools from VS2017.
3&#41; I compiled Perl 5.32.0 myself with this compiler, default options.
4&#41; I compiled OpenSSL 1.1.1g myself with this compiler, default options. 

I attempted to build Net::SSLeay 1.88, again, same compiler. Everything compiled well, but I too get the test error:

t\local\39_pkcs12.t ... OPENSSL_Uplink&#40;00007FFD8073CD70,08&#41;: no OPENSSL_Applink

I&#39;m about to test the solution mentioned in <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638#txn-1884320">https://rt.cpan.org/Ticket/Display.html?id=101638#txn-1884320</a></span>

I&#39;ll post back.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;28&nbsp;02:10:21&nbsp;2020</span>
    <span class="description">ZARABOZO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 28 01:56:40 2020, ZARABOZO wrote:
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m about to test the solution mentioned in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101638#txn-1884320">https://rt.cpan.org/Ticket/Display.html?id=101638#txn-1884320</a></span>
&gt; 
&gt; I&#39;ll post back.
</div>
Well, it has indeed worked. All tests passed.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
