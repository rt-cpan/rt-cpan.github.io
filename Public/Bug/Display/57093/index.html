<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57093 for Audio-Wav: problem with bits per sample other than 16</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57093 for Audio-Wav: problem with bits per sample other than 16</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Audio-Wav/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Audio-Wav/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Audio-Wav/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Audio-Wav/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Audio-Wav">Audio-Wav CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57093</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Audio-Wav/Active/">Audio-Wav</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sergstesh [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-3106-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-3107-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Audio-Wav-r2473.tgz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/799320/414399/Audio-Wav-r2473.tgz">
Thu Jul 01 10:35:14 2010 (22.6k) by brianski [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;30&nbsp;15:20:15&nbsp;2010</span>
    <span class="description">sergstesh [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> problem with bits per sample other than 16</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 Apr 2010 12:20:02 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Audio-Wav [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sergei Steshenko &lt;sergstesh [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I&#39;ve tried to use version 0.11 of the module with other than 16 bits per
sample and the WAV file produced very distorted sound. The distortions are
obviously seen in, say, &#39;audacity&#39;.

After briefly looking into the code in

lib/site_perl/5.10.1/Audio/Wav/Write.pm

file I&#39;ve noticed the following piece of code:

    266 sub write {
    267     my &#40;$self, @args&#41; = @_;
    268     my $channels = $self -&gt; {&#39;details&#39;} -&gt; {&#39;channels&#39;};
    269     if &#40; $self -&gt; {&#39;use_offset&#39;} &#41; {
    270         return $self -&gt; write_raw&#40; pack &#39;C&#39;.$channels, map { $_ + $self -&gt; {&#39;use_offset&#39;} } @args &#41;;
    271     } else {
    272         return $self -&gt; write_raw&#40; pack &#39;v&#39;.$channels, @args &#41;;
    273     }
    274 }

, specifically, line #272. If I understand correctly, this line actually
writes samples using for this Perl built-in &#39;pack&#39; function. Manpage on
&#39;pack&#39; function says:

&#34;
                   v   An unsigned short &#40;16-bit&#41; in &#34;VAX&#34; &#40;little-endian&#41; order.
&#34;, i.e. 16 bits appear to be hard-coded.

...

Replacing &#39;v&#39; with &#39;V&#39;. i.e.

&#34;
V   An unsigned long &#40;32-bit&#41; in &#34;VAX&#34; &#40;little-endian&#41; order
&#34;

and setting 32 bits per sample produced a good &#40;both in &#39;audacity&#39; and
from the point of view of undistorted sound&#41; file.

So, apparently the &#39;v&#39; is the culprit.

The parameter should apparently be a function bits per sample, and I&#39;m not
sure what can/should be done for 24 bits per sample, i.e. what packing
should be used.

Probably the simplest thing to do is to limit the allowed values to
16 and 32 bits per sample and to add a check in the constructor.

Thanks,
  Sergei.


      
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;04&nbsp;00:54:43&nbsp;2010</span>
    <span class="description">brianski [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your detailed report.

I&#39;ve confirmed it and, I believe, fixed the problem in r2469 &#40;including
for 24-bit writes&#41;. Please check it out and see if it works for you:

  <span class="clickylink"><a target="new" rel="nofollow" href="https://chronicle.allafrica.com:8080/repository/misc/skix/cpan/Audio-Wav/">https://chronicle.allafrica.com:8080/repository/misc/skix/cpan/Audio-Wav/</a></span>

The source of the change is here:
 
<span class="clickylink"><a target="new" rel="nofollow" href="http://chronicle.allafrica.com/viewvc/viewvc.cgi/misc/skix/cpan/Audio-Wav/Wav/Write.pm?root=allafrica&#38;r1=2466&#38;r2=2469">http://chronicle.allafrica.com/viewvc/viewvc.cgi/misc/skix/cpan/Audio-Wav/Wav/Write.pm?root=allafrica&#38;r1=2466&#38;r2=2469</a></span>

For the moment, we always grab a 32-bit integer in vax format, and then
use substr to grab the bytes we care about.

If you could test it out by checking out -HEAD &#40;not rev2469&#41;, I&#39;d very
much appreciate it.

I haven&#39;t forgotten your other bug report, but I&#39;m very pressed for time
ATM, so I&#39;m not sure when.

Thanks!
Brian Szymanski
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;04&nbsp;00:54:43&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;04&nbsp;00:54:43&nbsp;2010</span>
    <span class="description">brianski [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;27&nbsp;18:35:34&nbsp;2010</span>
    <span class="description">sergstesh [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57093] Resolved: problem with bits per sample other than 16</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 27 Jun 2010 15:35:23 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Audio-Wav [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sergei Steshenko &lt;sergstesh [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

--- On Thu, 6/3/10, Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; From: Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; Subject: [rt.cpan.org #57093] Resolved: problem with bits per sample other than 16
&gt; To: sergstesh@yahoo.com
&gt; Date: Thursday, June 3, 2010, 9:54 PM
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57093">https://rt.cpan.org/Ticket/Display.html?id=57093</a></span> &gt;
&gt; 
&gt; According to our records, your request has been resolved.
&gt; If you have any
&gt; further questions or concerns, please respond to this
&gt; message.
&gt; 
</div>
I have used &#40;hopefully correctly&#41; the fix you&#39;ve suggested:

    266 sub write {
    267     my &#40;$self, @args&#41; = @_;
    268     my $channels = $self -&gt; {&#39;details&#39;} -&gt; {&#39;channels&#39;};
    269     if &#40; $self -&gt; {&#39;use_offset&#39;} &#41; {
    270         return $self -&gt; write_raw&#40; pack &#39;C&#39;.$channels, map { $_ + $self -&gt; {&#39;use_offset&#39;} } @args &#41;;
    271     } else {
    272         #return $self -&gt; write_raw&#40; pack &#39;V&#39;.$channels, @args &#41;;
    273         my $bytes_per_sample = $self-&gt;{&#39;details&#39;}-&gt;{&#39;bits_sample&#39;} &gt;&gt; 3;
    274         my @samples = map { substr pack&#40;&#39;V1&#39;, $_&#41;, 0, $bytes_per_sample } @args;
    275         return $self -&gt; write_raw&#40; @samples &#41;;
    276     }
    277 }
.

The fix doesn&#39;t work for me - when I run the same program I used to run
with my fix &#40;now commented out on line #272&#41;, I&#39;m getting a bunch of

&#34;
Argument &#34;\0\0\0\0&#34; isn&#39;t numeric in addition &#40;+&#41; at /home/sergei/my_perl-5.10.1/lib/site_perl/5.10.1/Audio/Wav/Write.pm line 307.
&#34;

messages, here is the context for line #307:

    292 sub write_raw {
    293     my $self = shift;
    294     my $data = shift;
    295     my $len = shift;
    296     $len = length $data unless $len;
    297     return unless $len;
    298     my $wrote = $len;
    299     if &#40; $self -&gt; {&#39;use_cache&#39;} &#41; {
    300         $self -&gt; {&#39;write_cache&#39;} .= $data;
    301         my $cache_len = length $self -&gt; {&#39;write_cache&#39;};
    302         $self -&gt; _purge_cache&#40; $cache_len &#41; unless $cache_len &lt; $self -&gt; {&#39;cache_size&#39;};
    303     } else {
    304         $wrote = syswrite $self -&gt; {&#39;handle&#39;}, $data, $len;
    305     }
    306
    307     $self -&gt; {&#39;pos&#39;} += $wrote;
    308     return $wrote;
    309 }
.

I think the bug should be reopened.

Thanks,
  Sergei.



      
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;27&nbsp;18:35:39&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;01&nbsp;10:35:14&nbsp;2010</span>
    <span class="description">brianski [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergei.

Thanks again for reporting this.

I added a fix soon after I responded to this ticket which may or may not
be causing the behavior you are seeing. Specifically, I added &#34;use
bytes&#34;. Possibly not related, but it should cause problems to omit it:

ski@portege:~/mysrc/skix/cpan/Audio-Wav$ diff -w -u yours mine
--- yours       2010-07-01 10:26:04.183776886 -0400
+++ mine        2010-07-01 10:26:41.533773025 -0400
@@ -4,9 +4,15 @@
 if &#40; $self -&gt; {&#39;use_offset&#39;} &#41; {
 return $self -&gt; write_raw&#40; pack &#39;C&#39;.$channels, map { $_ + $self -&gt;
{&#39;use_offset&#39;} } @args &#41;;
 } else {
-#return $self -&gt; write_raw&#40; pack &#39;V&#39;.$channels, @args &#41;;
+        #TODO: performance: when we move to _init_write_sub, just use:
+        #32: pack &#39;V1&#39;, ... 
+        #24: substr pack&#40;&#39;V1&#39;, ...&#41;, 3
+        #16: pack &#39;v1&#39;, ...
 my $bytes_per_sample = $self-&gt;{&#39;details&#39;}-&gt;{&#39;bits_sample&#39;} &gt;&gt; 3;
+        use bytes;
 my @samples = map { substr pack&#40;&#39;V1&#39;, $_&#41;, 0, $bytes_per_sample } @args;
+#warn &#34;bits/sample: $self-&gt;{&#39;details&#39;}-&gt;{&#39;bits_sample&#39;}, bytes/sample:
$bytes_per_sample&#34;;
+#warn &#34;output samples&#40;&#34;.scalar @samples.&#34;&#41;: &#34;.join &#34;-&#34;, map ord, split
//, join &#39;&#39;, @samples;
 return $self -&gt; write_raw&#40; @samples &#41;;
 }
 }

If that doesn&#39;t fix the problem, can you boil your program down to a
&#40;preferably small ;-&#41; &#41; script that shows the errant behavior?

Also, to be sure we are on the same page, please use r2473 directly from
SVN - I&#39;ve attached it here for your convenience. And if you do
encounter problems, please add and uncomment the warn statements in the
above diff &#40;lines 279 and 280 in the attached tarball / r2473&#41;.

Thanks!
Brian

On Sun Jun 27 18:35:34 2010, sergstesh wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; --- On Thu, 6/3/10, Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; From: Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; &gt; Subject: [rt.cpan.org #57093] Resolved: problem with bits per sample
</div>&gt; other than 16
<div class="message-stanza open">&gt; &gt; To: sergstesh@yahoo.com
&gt; &gt; Date: Thursday, June 3, 2010, 9:54 PM
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57093">https://rt.cpan.org/Ticket/Display.html?id=57093</a></span> &gt;
&gt; &gt;
&gt; &gt; According to our records, your request has been resolved.
&gt; &gt; If you have any
&gt; &gt; further questions or concerns, please respond to this
&gt; &gt; message.
&gt; &gt;
</div>&gt; 
&gt; I have used &#40;hopefully correctly&#41; the fix you&#39;ve suggested:
&gt; 
&gt;     266 sub write {
&gt;     267     my &#40;$self, @args&#41; = @_;
&gt;     268     my $channels = $self -&gt; {&#39;details&#39;} -&gt; {&#39;channels&#39;};
&gt;     269     if &#40; $self -&gt; {&#39;use_offset&#39;} &#41; {
&gt;     270         return $self -&gt; write_raw&#40; pack &#39;C&#39;.$channels, map {
&gt; $_ + $self -&gt; {&#39;use_offset&#39;} } @args &#41;;
&gt;     271     } else {
&gt;     272         #return $self -&gt; write_raw&#40; pack &#39;V&#39;.$channels, @args
&gt; &#41;;
&gt;     273         my $bytes_per_sample = $self-&gt;{&#39;details&#39;}-
<div class="message-stanza open">&gt; &gt;{&#39;bits_sample&#39;} &gt;&gt; 3;
</div>&gt;     274         my @samples = map { substr pack&#40;&#39;V1&#39;, $_&#41;, 0,
&gt; $bytes_per_sample } @args;
&gt;     275         return $self -&gt; write_raw&#40; @samples &#41;;
&gt;     276     }
&gt;     277 }
&gt; .
&gt; 
&gt; The fix doesn&#39;t work for me - when I run the same program I used to
&gt; run
&gt; with my fix &#40;now commented out on line #272&#41;, I&#39;m getting a bunch of
&gt; 
&gt; &#34;
&gt; Argument &#34;\0\0\0\0&#34; isn&#39;t numeric in addition &#40;+&#41; at
&gt; /home/sergei/my_perl-5.10.1/lib/site_perl/5.10.1/Audio/Wav/Write.pm
&gt; line 307.
&gt; &#34;
&gt; 
&gt; messages, here is the context for line #307:
&gt; 
&gt;     292 sub write_raw {
&gt;     293     my $self = shift;
&gt;     294     my $data = shift;
&gt;     295     my $len = shift;
&gt;     296     $len = length $data unless $len;
&gt;     297     return unless $len;
&gt;     298     my $wrote = $len;
&gt;     299     if &#40; $self -&gt; {&#39;use_cache&#39;} &#41; {
&gt;     300         $self -&gt; {&#39;write_cache&#39;} .= $data;
&gt;     301         my $cache_len = length $self -&gt; {&#39;write_cache&#39;};
&gt;     302         $self -&gt; _purge_cache&#40; $cache_len &#41; unless $cache_len
&gt; &lt; $self -&gt; {&#39;cache_size&#39;};
&gt;     303     } else {
&gt;     304         $wrote = syswrite $self -&gt; {&#39;handle&#39;}, $data, $len;
&gt;     305     }
&gt;     306
&gt;     307     $self -&gt; {&#39;pos&#39;} += $wrote;
&gt;     308     return $wrote;
&gt;     309 }
&gt; .
&gt; 
&gt; I think the bug should be reopened.
&gt; 
&gt; Thanks,
&gt;   Sergei.
&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Audio-Wav-r2473.tgz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/799320/414399/Audio-Wav-r2473.tgz">Download Audio-Wav-r2473.tgz</a><br />
<span class="downloadcontenttype">application/x-compressed-tar 22.6k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;01&nbsp;10:39:26&nbsp;2010</span>
    <span class="description">brianski [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">One more thing - are you using stereo output files? That is &#34;known to be
broken&#34; for all but mono output at the moment.

On Sun Jun 27 18:35:34 2010, sergstesh wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; --- On Thu, 6/3/10, Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; From: Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; &gt; Subject: [rt.cpan.org #57093] Resolved: problem with bits per sample
</div>&gt; other than 16
<div class="message-stanza open">&gt; &gt; To: sergstesh@yahoo.com
&gt; &gt; Date: Thursday, June 3, 2010, 9:54 PM
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57093">https://rt.cpan.org/Ticket/Display.html?id=57093</a></span> &gt;
&gt; &gt;
&gt; &gt; According to our records, your request has been resolved.
&gt; &gt; If you have any
&gt; &gt; further questions or concerns, please respond to this
&gt; &gt; message.
&gt; &gt;
</div>&gt; 
&gt; I have used &#40;hopefully correctly&#41; the fix you&#39;ve suggested:
&gt; 
&gt;     266 sub write {
&gt;     267     my &#40;$self, @args&#41; = @_;
&gt;     268     my $channels = $self -&gt; {&#39;details&#39;} -&gt; {&#39;channels&#39;};
&gt;     269     if &#40; $self -&gt; {&#39;use_offset&#39;} &#41; {
&gt;     270         return $self -&gt; write_raw&#40; pack &#39;C&#39;.$channels, map {
&gt; $_ + $self -&gt; {&#39;use_offset&#39;} } @args &#41;;
&gt;     271     } else {
&gt;     272         #return $self -&gt; write_raw&#40; pack &#39;V&#39;.$channels, @args
&gt; &#41;;
&gt;     273         my $bytes_per_sample = $self-&gt;{&#39;details&#39;}-
<div class="message-stanza open">&gt; &gt;{&#39;bits_sample&#39;} &gt;&gt; 3;
</div>&gt;     274         my @samples = map { substr pack&#40;&#39;V1&#39;, $_&#41;, 0,
&gt; $bytes_per_sample } @args;
&gt;     275         return $self -&gt; write_raw&#40; @samples &#41;;
&gt;     276     }
&gt;     277 }
&gt; .
&gt; 
&gt; The fix doesn&#39;t work for me - when I run the same program I used to
&gt; run
&gt; with my fix &#40;now commented out on line #272&#41;, I&#39;m getting a bunch of
&gt; 
&gt; &#34;
&gt; Argument &#34;\0\0\0\0&#34; isn&#39;t numeric in addition &#40;+&#41; at
&gt; /home/sergei/my_perl-5.10.1/lib/site_perl/5.10.1/Audio/Wav/Write.pm
&gt; line 307.
&gt; &#34;
&gt; 
&gt; messages, here is the context for line #307:
&gt; 
&gt;     292 sub write_raw {
&gt;     293     my $self = shift;
&gt;     294     my $data = shift;
&gt;     295     my $len = shift;
&gt;     296     $len = length $data unless $len;
&gt;     297     return unless $len;
&gt;     298     my $wrote = $len;
&gt;     299     if &#40; $self -&gt; {&#39;use_cache&#39;} &#41; {
&gt;     300         $self -&gt; {&#39;write_cache&#39;} .= $data;
&gt;     301         my $cache_len = length $self -&gt; {&#39;write_cache&#39;};
&gt;     302         $self -&gt; _purge_cache&#40; $cache_len &#41; unless $cache_len
&gt; &lt; $self -&gt; {&#39;cache_size&#39;};
&gt;     303     } else {
&gt;     304         $wrote = syswrite $self -&gt; {&#39;handle&#39;}, $data, $len;
&gt;     305     }
&gt;     306
&gt;     307     $self -&gt; {&#39;pos&#39;} += $wrote;
&gt;     308     return $wrote;
&gt;     309 }
&gt; .
&gt; 
&gt; I think the bug should be reopened.
&gt; 
&gt; Thanks,
&gt;   Sergei.
&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;01&nbsp;10:47:48&nbsp;2010</span>
    <span class="description">sergstesh [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57093] problem with bits per sample other than 16</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 1 Jul 2010 07:47:25 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Audio-Wav [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sergei Steshenko &lt;sergstesh [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

--- On Thu, 7/1/10, Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; From: Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; Subject: [rt.cpan.org #57093] problem with bits per sample other than 16
&gt; To: sergstesh@yahoo.com
&gt; Date: Thursday, July 1, 2010, 7:39 AM
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57093">https://rt.cpan.org/Ticket/Display.html?id=57093</a></span> &gt;
&gt; 
&gt; One more thing - are you using stereo output files? That is
&gt; &#34;known to be
&gt; broken&#34; for all but mono output at the moment.
&gt; 
</div>

With my &#34;fix&#34; I was using stereo &#40;kind of&#41; output - i.e. I was 
intentionally generating two-channel output file with identical data in
both channels; &#39;audacity&#39; was correctly showing two channels with visually
identical data.

For me a fix &#40;or a module&#41; producing mono output is not an option -
eventually I&#39;ll need true stereo &#40;rather, completely uncorrelated data&#41;
output.

Actually, I will need even more than two channels after that.

Thanks,
  Sergei.


      
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;01&nbsp;10:54:18&nbsp;2010</span>
    <span class="description">sergstesh [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57093] problem with bits per sample other than 16</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 1 Jul 2010 07:54:08 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Audio-Wav [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sergei Steshenko &lt;sergstesh [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

--- On Thu, 7/1/10, Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; From: Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; Subject: [rt.cpan.org #57093] problem with bits per sample other than 16
&gt; To: sergstesh@yahoo.com
&gt; Date: Thursday, July 1, 2010, 7:39 AM
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57093">https://rt.cpan.org/Ticket/Display.html?id=57093</a></span> &gt;
&gt; 
&gt; One more thing - are you using stereo output files? That is
&gt; &#34;known to be
&gt; broken&#34; for all but mono output at the moment.
&gt; 
</div>
I have just modified my program to produce two channels with amplitude
ratio 1 : 0.5 - the output looks find in &#39;audacity&#39;. I mean, the module
with my &#34;fix&#34;.

Thanks,
  Sergei.


      
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;30&nbsp;16:40:58&nbsp;2012</span>
    <span class="description">brianski [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Marking stalled, as this still needs to be fixed properly in the long 
run.

Thanks Sergei.
Brian

On Thu Jul 01 10:54:18 2010, sergstesh wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; --- On Thu, 7/1/10, Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; From: Brian Szymanski via RT &lt;bug-Audio-Wav@rt.cpan.org&gt;
&gt; &gt; Subject: [rt.cpan.org #57093] problem with bits per sample other
</div>&gt; than 16
<div class="message-stanza open">&gt; &gt; To: sergstesh@yahoo.com
&gt; &gt; Date: Thursday, July 1, 2010, 7:39 AM
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57093">https://rt.cpan.org/Ticket/Display.html?id=57093</a></span> &gt;
&gt; &gt;
&gt; &gt; One more thing - are you using stereo output files? That is
&gt; &gt; &#34;known to be
&gt; &gt; broken&#34; for all but mono output at the moment.
&gt; &gt;
</div>&gt; 
&gt; I have just modified my program to produce two channels with amplitude
&gt; ratio 1 : 0.5 - the output looks find in &#39;audacity&#39;. I mean, the
&gt; module
&gt; with my &#34;fix&#34;.
&gt; 
&gt; Thanks,
&gt;   Sergei.
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;30&nbsp;16:40:59&nbsp;2012</span>
    <span class="description">brianski [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
