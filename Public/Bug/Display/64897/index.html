<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #64897 for Finance-Quote: GoldMoney site has changed &#40;patch attached&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #64897 for Finance-Quote: GoldMoney site has changed &#40;patch attached&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Finance-Quote">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Finance-Quote">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Finance-Quote">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Finance-Quote">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Finance-Quote">Finance-Quote CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">64897</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Finance-Quote">Finance-Quote</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ste [...] shared-files.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-13576-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.17    </td>
  </tr>
  <tr id="CF-13577-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-adopted-to-site-changes.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/883384/457794/0001-adopted-to-site-changes.patch">
Tue Jan 18 15:29:56 2011 (6.1k) by stephan.ebelt [...] gmx.net
</a>
</font></li>
</ul>


0002-support-palladium-lookup.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/883384/457793/0002-support-palladium-lookup.patch">
Tue Jan 18 15:29:56 2011 (5.9k) by stephan.ebelt [...] gmx.net
</a>
</font></li>
</ul>


perl-Finance-Quote-64897-0001-adopted-to-site-changes.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1022823/533461/perl-Finance-Quote-64897-0001-adopted-to-site-changes.patch">
Mon Jan 16 11:27:08 2012 (6.5k) by sbrabec [...] suse.cz
</a>
</font></li>
</ul>


perl-Finance-Quote-64897-0002-support-palladium-lookup.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1022823/533462/perl-Finance-Quote-64897-0002-support-palladium-lookup.patch">
Mon Jan 16 11:27:08 2012 (6.3k) by sbrabec [...] suse.cz
</a>
</font></li>
</ul>


perl-Finance-Quote-goldmoney-decimal-point.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1022823/533463/perl-Finance-Quote-goldmoney-decimal-point.patch">
Mon Jan 16 11:27:08 2012 (721b) by sbrabec [...] suse.cz
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=64897">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-883384" href="/Public/Bug/Display.html?id=64897#txn-883384">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;18&nbsp;15:29:56&nbsp;2011</span>
    <span class="description">stephan.ebelt [...] gmx.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> GoldMoney site has changed &#40;patch attached&#41;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/883384/457792/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/457792">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 171b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">the goldmoney site has been updated recently and they now allow to
purchase palladium as well.

attached are two patches for the GoldMoney.pm module and its test.

stephan
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0002-support-palladium-lookup.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/883384/457793/0002-support-palladium-lookup.patch">Download 0002-support-palladium-lookup.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From e410b33151f394d76219a0f0de24de232f4e8750 Mon Sep 17 00:00:00 2001
From: Stephan Ebelt &lt;ste@shared-files.de&gt;
Date: Tue, 18 Jan 2011 20:47:11 +0100
Subject: [PATCH] support &#39;palladium&#39; lookup

---
 lib/Finance/Quote/GoldMoney.pm |   46 +++++++++++++++++++++++++++++++--------
 t/goldmoney.t                  |   13 +++++++++-
 2 files changed, 47 insertions&#40;+&#41;, 12 deletions&#40;-&#41;

diff --git a/lib/Finance/Quote/GoldMoney.pm b/lib/Finance/Quote/GoldMoney.pm
index 2081652..03b5b5a 100644
--- a/lib/Finance/Quote/GoldMoney.pm
+++ b/lib/Finance/Quote/GoldMoney.pm
@@ -7,7 +7,7 @@
 #    Copyright &#40;C&#41; 2000, Brent Neal &lt;brentn@users.sourceforge.net&gt;
 #    Copyright &#40;C&#41; 2000, Volker Stuerzl &lt;volker.stuerzl@gmx.de&gt;
 #    Copyright &#40;C&#41; 2006, Klaus Dahlke &lt;klaus.dahlke@gmx.de&gt;
-#    Copyright &#40;C&#41; 2008, Stephan Ebelt &lt;stephan.ebelt@gmx.de&gt;
+#    Copyright &#40;C&#41; 2011, Stephan Ebelt &lt;ste -at- shared-files -dot- de&gt;
 #
 #    This program is free software; you can redistribute it and/or modify
 #    it under the terms of the GNU General Public License as published by
@@ -31,7 +31,6 @@ require 5.005;
 require Crypt::SSLeay;
 
 use HTTP::Request::Common;
-use HTML::TableExtract;
 use HTML::TreeBuilder;
 
 use strict;
@@ -51,7 +50,8 @@ sub labels {
 
 # goldmoney&#40;$quoter, @symbols&#41;
 #
-# - get &#39;gold&#39; and &#39;silver&#39; spot rates from goldmoney.com
+# - get &#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39; and &#39;palladium&#39; spot rates from
+#   goldmoney.com
 # - error out properly &#40;that is: ignore&#41; all other symbols
 # 
 sub goldmoney {
@@ -64,12 +64,14 @@ sub goldmoney {
 	my $ua = $quoter-&gt;user_agent;
 	my &#40;%symbolhash, @q, %info&#41;;
 	my &#40;
-		$html_string, $tree, $gold_gg, $gold_oz, $silver_oz, $platinum_oz, $platinum_pg, $currency
+		$html_string, $tree, $gold_oz, $silver_oz, $platinum_oz,
+		$palladium_oz, $currency
 	&#41;;
 
 	my $_want_gold = 0;
 	my $_want_silver = 0;
 	my $_want_platinum = 0;
+	my $_want_palladium = 0;
 
 	# - feed all requested symbols into %info &#40;to be returned later&#41;
 	# - set error state to false by default
@@ -86,8 +88,10 @@ sub goldmoney {
 			$_want_silver = 1;
 		} elsif&#40;$s eq &#39;platinum&#39;&#41; {
 			$_want_platinum = 1;
+		} elsif&#40;$s eq &#39;palladium&#39;&#41; {
+			$_want_palladium = 1;
 		} else {
-			$info{$s,&#39;errormsg&#39;} = &#34;No data returned &#40;note: this module only works for &#39;gold&#39; and &#39;silver&#39;&#41;&#34;;
+			$info{$s,&#39;errormsg&#39;} = &#34;No data returned &#40;note: this module only works for &#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39; and &#39;palladium&#39;&#41;&#34;;
 		}
 	}
 
@@ -185,6 +189,28 @@ sub goldmoney {
 			$info{&#39;platinum&#39;,&#39;currency&#39;} = $currency;
 			$info{&#39;platinum&#39;,&#39;success&#39;}  = 1;
 		}
+		
+		# get palladium rate
+		#
+		if&#40; $_want_palladium &#41; {
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-palladium-oz&#34;&#41;;
+
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
+				$palladium_oz = $1;
+				$palladium_oz =~ s/,//g;
+			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;palladium&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;palladium&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;palladium&#39;,&#39;name&#39;}     = &#39;Palladium Spot&#39;;
+			$info{&#39;palladium&#39;,&#39;last&#39;}     = $palladium_oz;
+			$info{&#39;palladium&#39;,&#39;price&#39;}    = $palladium_oz;
+			$info{&#39;palladium&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;palladium&#39;,&#39;success&#39;}  = 1;
+		}
 	}
 
 	return wantarray&#40;&#41; ? %info : \%info;
@@ -232,12 +258,12 @@ Finance::Quote::GoldMoney - obtain spot rates from GoldMoney.
 
     $q = Finance::Quote-&gt;new;
 
-    %rates = $q-&gt;fetch&#40;&#39;goldmoeny&#39;,&#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39;&#41;;
+    %rates = $q-&gt;fetch&#40;&#39;goldmoney&#39;,&#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39;, &#39;palladium&#39;&#41;;
 
 =head1 DESCRIPTION
 
-This module obtains current spot rates for &#39;gold&#39;, &#39;silver&#39; and
-&#39;platinum&#39; from Goldmoney &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmoney.com">http://www.goldmoney.com</a></span>&#41;. All other
+This module obtains current spot rates for &#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39;
+and &#39;palladium&#39; from GoldMoney &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://goldmoney.com">http://goldmoney.com</a></span>&#41;. All other
 symbols are ignored.
 
 Information returned by this module is governed by Net Transactions
@@ -251,8 +277,8 @@ The following labels are returned by Finance::Quote::GoldMoney:
 	- exchange
 	- name
 	- date, time
-	- price &#40;per ounce&#41;, price_gg &#40;per goldgram, gold only&#41;,
-      price_pg &#40;per platinumgram, platinum only&#41;
+	- price &#40;per ounce&#41;
+	- last &#40;per ounce, same as &#39;price&#39;&#41;
     - currency
 
 =head1 SEE ALSO
diff --git a/t/goldmoney.t b/t/goldmoney.t
index fe656a7..592515e 100755
--- a/t/goldmoney.t
+++ b/t/goldmoney.t
@@ -7,12 +7,12 @@ if &#40;not $ENV{ONLINE_TEST}&#41; {
     plan skip_all =&gt; &#39;Set $ENV{ONLINE_TEST} to run this test&#39;;
 }
 
-plan tests =&gt; 26;
+plan tests =&gt; 34;
 
 # Test GoldMoney functions.
 my $q      = Finance::Quote-&gt;new&#40;&#34;GoldMoney&#34;&#41;;
 $q-&gt;set_currency&#40;&#39;EUR&#39;&#41;;
-my %quotes = $q-&gt;fetch&#40;&#34;goldmoney&#34;,&#34;gold&#34;, &#34;silver&#34;, &#34;platinum&#34;, &#34;BOGUS&#34;&#41;;
+my %quotes = $q-&gt;fetch&#40;&#34;goldmoney&#34;,&#34;gold&#34;, &#34;silver&#34;, &#34;platinum&#34;, &#34;palladium&#34;, &#34;BOGUS&#34;&#41;;
 ok&#40;%quotes&#41;;
 
 # Check that sound information is returned for gold, silver and platinum.
@@ -39,6 +39,13 @@ ok&#40;$quotes{&#34;platinum&#34;,&#34;currency&#34;} eq &#34;EUR&#34;&#41;;
 ok&#40;length&#40;$quotes{&#34;platinum&#34;,&#34;date&#34;}&#41; &gt; 0&#41;;
 ok&#40;length&#40;$quotes{&#34;platinum&#34;,&#34;time&#34;}&#41; &gt; 0&#41;;
 
+ok&#40;$quotes{&#34;palladium&#34;,&#34;success&#34;}, &#39;palladium price lookup&#39;&#41;;
+ok&#40;$quotes{&#34;palladium&#34;,&#34;last&#34;} &gt; 0&#41;;
+ok&#40; $quotes{&#34;palladium&#34;,&#34;last&#34;} !~ /^0/ &#41;;
+ok&#40;$quotes{&#34;palladium&#34;,&#34;currency&#34;} eq &#34;EUR&#34;&#41;;
+ok&#40;length&#40;$quotes{&#34;palladium&#34;,&#34;date&#34;}&#41; &gt; 0&#41;;
+ok&#40;length&#40;$quotes{&#34;palladium&#34;,&#34;time&#34;}&#41; &gt; 0&#41;;
+
 my $year = &#40;localtime&#40;&#41;&#41;[5] + 1900;
 ok&#40;&#40;substr&#40;$quotes{&#34;gold&#34;,&#34;isodate&#34;},0,4&#41; == $year&#41;&#41;;
 ok&#40;&#40;substr&#40;$quotes{&#34;gold&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
@@ -46,6 +53,8 @@ ok&#40;&#40;substr&#40;$quotes{&#34;silver&#34;,&#34;isodate&#34;},0,4&#41; == $year&#41;&#41;;
 ok&#40;&#40;substr&#40;$quotes{&#34;silver&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
 ok&#40;&#40;substr&#40;$quotes{&#34;platinum&#34;,&#34;isodate&#34;},0,4&#41; == $year&#41;&#41;;
 ok&#40;&#40;substr&#40;$quotes{&#34;platinum&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
+ok&#40;&#40;substr&#40;$quotes{&#34;palladium&#34;,&#34;isodate&#34;},0,4&#41; == $year&#41;&#41;;
+ok&#40;&#40;substr&#40;$quotes{&#34;palladium&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
 
 # Check that a bogus symbol returns no-success.
 ok&#40;! $quotes{&#34;BOGUS&#34;,&#34;success&#34;}&#41;;
-- 
1.5.5.6

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-adopted-to-site-changes.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/883384/457794/0001-adopted-to-site-changes.patch">Download 0001-adopted-to-site-changes.patch</a><br />
<span class="downloadcontenttype">text/x-diff 6.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From da395b7bf039ce13e50e0da8a6c3dbd84427aa2e Mon Sep 17 00:00:00 2001
From: Stephan Ebelt &lt;ste@shared-files.de&gt;
Date: Tue, 18 Jan 2011 20:33:09 +0100
Subject: [PATCH] adopted to site changes

they dropped pretty much all tables, therefore we use HTML::TreeBuilder now
---
 lib/Finance/Quote/GoldMoney.pm |  102 ++++++++++++++++++---------------------
 1 files changed, 47 insertions&#40;+&#41;, 55 deletions&#40;-&#41;

diff --git a/lib/Finance/Quote/GoldMoney.pm b/lib/Finance/Quote/GoldMoney.pm
index dc7c781..2081652 100644
--- a/lib/Finance/Quote/GoldMoney.pm
+++ b/lib/Finance/Quote/GoldMoney.pm
@@ -32,6 +32,7 @@ require Crypt::SSLeay;
 
 use HTTP::Request::Common;
 use HTML::TableExtract;
+use HTML::TreeBuilder;
 
 use strict;
 use warnings;
@@ -58,11 +59,12 @@ sub goldmoney {
 	my @symbols = @_;
 	return unless @symbols;
 
+	my $GOLDMONEY_URL = &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://goldmoney.com">http://goldmoney.com</a></span>&#34;;
+
 	my $ua = $quoter-&gt;user_agent;
 	my &#40;%symbolhash, @q, %info&#41;;
 	my &#40;
-		$html_string, $te, $table_gold, $table_silver, $table_platinum,
-		$gold_gg, $gold_oz, $silver_oz, $platinum_oz, $platinum_pg, $currency
+		$html_string, $tree, $gold_gg, $gold_oz, $silver_oz, $platinum_oz, $platinum_pg, $currency
 	&#41;;
 
 	my $_want_gold = 0;
@@ -92,18 +94,14 @@ sub goldmoney {
 	# get the page
 	# - but only if we want either gold, silver or platinum &#40;there is nothing else there&#41;
 	if&#40; $_want_gold or $_want_silver or $_want_platinum&#41; {
-		my $GOLDMONEY_URL = &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://goldmoney.com">http://goldmoney.com</a></span>&#34;;
 		my $response = $ua-&gt;request&#40;GET $GOLDMONEY_URL&#41;;
 	
 		if &#40;$response-&gt;is_success&#41; {
 			$html_string =$response-&gt;content;
 	
-			# we want the &#39;Current Spot Rates&#39; table
-			$te = new HTML::TableExtract-&gt;new&#40; attribs=&gt;{class=&gt;&#39;spot&#39;}, subtables=&gt;1&#41;;
-			$te-&gt;parse&#40;$html_string&#41;;
-			$table_gold=$te-&gt;table&#40;3,0&#41;;
-			$table_silver=$te-&gt;table&#40;3,1&#41;;
-			$table_platinum=$te-&gt;table&#40;3,2&#41;;
+			# setup the HTML tag tree
+			$tree = new HTML::TreeBuilder-&gt;new&#40;&#41;;
+			$tree-&gt;parse&#40;$html_string&#41;;
 		} else {
 			# retrieval error - flag an error and return right away
 			foreach my $s &#40;@symbols&#41; {
@@ -125,73 +123,67 @@ sub goldmoney {
 		# get gold rate
 		#
 		if&#40; $_want_gold &#41; {
-			$_ = $table_gold-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;\d*\.\d*&#41;.*\/gg/ &#41; {
-				$gold_gg = $1;
-			}
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-gold-oz&#34;&#41;;
 
-			$_ = $table_gold-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;[,\d]*\.\d*&#41;.*\/oz/ &#41; {
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$gold_oz = $1;
 				$gold_oz =~ s/,//g;
-
-				# assemble final dataset
-				# - take &#34;now&#34; as date/time as the site is always current and does
-				#   not provide this explicitly - so there is a time-slip
-				$quoter-&gt;store_date&#40;\%info, &#39;gold&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
-				$info{&#39;gold&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
-				$info{&#39;gold&#39;,&#39;name&#39;}     = &#39;Gold Spot&#39;;
-				$info{&#39;gold&#39;,&#39;last&#39;}     = $gold_oz;
-				$info{&#39;gold&#39;,&#39;price&#39;}    = $gold_oz;
-				$info{&#39;gold&#39;,&#39;price_gg&#39;} = $gold_gg;
-				$info{&#39;gold&#39;,&#39;currency&#39;} = $currency;
-				$info{&#39;gold&#39;,&#39;success&#39;}  = 1;
 			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;gold&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;gold&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;gold&#39;,&#39;name&#39;}     = &#39;Gold Spot&#39;;
+			$info{&#39;gold&#39;,&#39;last&#39;}     = $gold_oz;
+			$info{&#39;gold&#39;,&#39;price&#39;}    = $gold_oz;
+			$info{&#39;gold&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;gold&#39;,&#39;success&#39;}  = 1;
 		}
 
 		# get silver rate
 		#
 		if&#40; $_want_silver &#41; {
-			$_ = $table_silver-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;[,\d]*\.\d*&#41;.*\/oz/ &#41; {
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-silver-oz&#34;&#41;;
+
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$silver_oz = $1;
 				$silver_oz =~ s/,//g;
-
-				$quoter-&gt;store_date&#40;\%info, &#39;silver&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
-				$info{&#39;silver&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
-				$info{&#39;silver&#39;,&#39;name&#39;}     = &#39;Silver Spot&#39;;
-				$info{&#39;silver&#39;,&#39;last&#39;}     = $silver_oz;
-				$info{&#39;silver&#39;,&#39;price&#39;}    = $silver_oz;
-				$info{&#39;silver&#39;,&#39;currency&#39;} = $currency;
-				$info{&#39;silver&#39;,&#39;success&#39;}  = 1;
 			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;silver&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;silver&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;silver&#39;,&#39;name&#39;}     = &#39;Silver Spot&#39;;
+			$info{&#39;silver&#39;,&#39;last&#39;}     = $silver_oz;
+			$info{&#39;silver&#39;,&#39;price&#39;}    = $silver_oz;
+			$info{&#39;silver&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;silver&#39;,&#39;success&#39;}  = 1;
 		}
 		
 		# get platinum rate
 		#
 		if&#40; $_want_platinum &#41; {
-			$_ = $table_platinum-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;\d*\.\d*&#41;.*\/pg/ &#41; {
-				$platinum_pg = $1;
-			}
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-platinum-oz&#34;&#41;;
 
-			$_ = $table_platinum-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;[,\d]*\.\d*&#41;.*\/oz/ &#41; {
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$platinum_oz = $1;
 				$platinum_oz =~ s/,//g;
-
-				# assemble final dataset
-				# - take &#34;now&#34; as date/time as the site is always current and does
-				#   not provide this explicitly - so there is a time-slip
-				$quoter-&gt;store_date&#40;\%info, &#39;platinum&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
-				$info{&#39;platinum&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
-				$info{&#39;platinum&#39;,&#39;name&#39;}     = &#39;Platinum Spot&#39;;
-				$info{&#39;platinum&#39;,&#39;last&#39;}     = $platinum_oz;
-				$info{&#39;platinum&#39;,&#39;price&#39;}    = $platinum_oz;
-				$info{&#39;platinum&#39;,&#39;price_pg&#39;} = $platinum_pg;
-				$info{&#39;platinum&#39;,&#39;currency&#39;} = $currency;
-				$info{&#39;platinum&#39;,&#39;success&#39;}  = 1;
 			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;platinum&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;platinum&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;platinum&#39;,&#39;name&#39;}     = &#39;Platinum Spot&#39;;
+			$info{&#39;platinum&#39;,&#39;last&#39;}     = $platinum_oz;
+			$info{&#39;platinum&#39;,&#39;price&#39;}    = $platinum_oz;
+			$info{&#39;platinum&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;platinum&#39;,&#39;success&#39;}  = 1;
 		}
 	}
 
-- 
1.5.5.6

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1022823" href="/Public/Bug/Display.html?id=64897#txn-1022823">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;16&nbsp;11:27:08&nbsp;2012</span>
    <span class="description">sbrabec [...] suse.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sbrabec [...] suse.cz</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1022823/533460/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/533460">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 340b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Your patches were based on a git version that does not exist in the
public git and differs from it.

Here are three patches. Two of them are my attempts to rebase yout
patches to the latest git snapshot.

Third patch removes U.S. locale thousand mark from the string. &#40;It seems
it was already in your snapshot, but not in the upstream one.&#41;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-Finance-Quote-64897-0001-adopted-to-site-changes.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1022823/533461/perl-Finance-Quote-64897-0001-adopted-to-site-changes.patch">Download perl-Finance-Quote-64897-0001-adopted-to-site-changes.patch</a><br />
<span class="downloadcontenttype">text/x-diff 6.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=64897">https://rt.cpan.org/Public/Bug/Display.html?id=64897</a></span>

This is a merge of the patch provided by the bug tracker to the upstream
GIT snapshot.

Date: Tue Jan 18 15:29:56 2011 stephan.ebelt [...] gmx.net - Ticket created
Subject: GoldMoney site has changed &#40;patch attached&#41;

the goldmoney site has been updated recently and they now allow to
purchase palladium as well. attached are two patches for the
GoldMoney.pm module and its test. 

From da395b7bf039ce13e50e0da8a6c3dbd84427aa2e Mon Sep 17 00:00:00 2001
From: Stephan Ebelt &lt;ste@shared-files.de&gt;
Date: Tue, 18 Jan 2011 20:33:09 +0100
Subject: [PATCH] adopted to site changes

they dropped pretty much all tables, therefore we use HTML::TreeBuilder now
---
 lib/Finance/Quote/GoldMoney.pm |  102 ++++++++++++++++++---------------------
 1 files changed, 47 insertions&#40;+&#41;, 55 deletions&#40;-&#41;

Index: finance-quote/lib/Finance/Quote/GoldMoney.pm
===================================================================
--- finance-quote.orig/lib/Finance/Quote/GoldMoney.pm
+++ finance-quote/lib/Finance/Quote/GoldMoney.pm
@@ -32,6 +32,7 @@ require Crypt::SSLeay;
 
 use HTTP::Request::Common;
 use HTML::TableExtract;
+use HTML::TreeBuilder;
 
 use strict;
 use warnings;
@@ -58,11 +59,12 @@ sub goldmoney {
 	my @symbols = @_;
 	return unless @symbols;
 
+	my $GOLDMONEY_URL = &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://goldmoney.com">http://goldmoney.com</a></span>&#34;;
+
 	my $ua = $quoter-&gt;user_agent;
 	my &#40;%symbolhash, @q, %info&#41;;
 	my &#40;
-		$html_string, $te, $table_gold, $table_silver, $table_platinum,
-		$gold_gg, $gold_oz, $silver_oz, $platinum_oz, $platinum_pg, $currency
+		$html_string, $tree, $gold_gg, $gold_oz, $silver_oz, $platinum_oz, $platinum_pg, $currency
 	&#41;;
 
 	my $_want_gold = 0;
@@ -92,18 +94,14 @@ sub goldmoney {
 	# get the page
 	# - but only if we want either gold, silver or platinum &#40;there is nothing else there&#41;
 	if&#40; $_want_gold or $_want_silver or $_want_platinum&#41; {
-		my $GOLDMONEY_URL = &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://goldmoney.com">http://goldmoney.com</a></span>&#34;;
 		my $response = $ua-&gt;request&#40;GET $GOLDMONEY_URL&#41;;
 	
 		if &#40;$response-&gt;is_success&#41; {
 			$html_string =$response-&gt;content;
 	
-			# we want the &#39;Current Spot Rates&#39; table
-			$te = new HTML::TableExtract-&gt;new&#40; attribs=&gt;{class=&gt;&#39;spot&#39;}, subtables=&gt;1&#41;;
-			$te-&gt;parse&#40;$html_string&#41;;
-			$table_gold=$te-&gt;table&#40;3,0&#41;;
-			$table_silver=$te-&gt;table&#40;3,1&#41;;
-			$table_platinum=$te-&gt;table&#40;3,2&#41;;
+			# setup the HTML tag tree
+			$tree = new HTML::TreeBuilder-&gt;new&#40;&#41;;
+			$tree-&gt;parse&#40;$html_string&#41;;
 		} else {
 			# retrieval error - flag an error and return right away
 			foreach my $s &#40;@symbols&#41; {
@@ -125,70 +123,64 @@ sub goldmoney {
 		# get gold rate
 		#
 		if&#40; $_want_gold &#41; {
-			$_ = $table_gold-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;\d*\.\d*&#41;.*\/gg/ &#41; {
-				$gold_gg = $1;
-			}
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-gold-oz&#34;&#41;;
 
-			$_ = $table_gold-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;\d*\.\d*&#41;.*\/oz/ &#41; {
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$gold_oz = $1;
-
-				# assemble final dataset
-				# - take &#34;now&#34; as date/time as the site is always current and does
-				#   not provide this explicitly - so there is a time-slip
-				$quoter-&gt;store_date&#40;\%info, &#39;gold&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
-				$info{&#39;gold&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
-				$info{&#39;gold&#39;,&#39;name&#39;}     = &#39;Gold Spot&#39;;
-				$info{&#39;gold&#39;,&#39;last&#39;}     = $gold_oz;
-				$info{&#39;gold&#39;,&#39;price&#39;}    = $gold_oz;
-				$info{&#39;gold&#39;,&#39;price_gg&#39;} = $gold_gg;
-				$info{&#39;gold&#39;,&#39;currency&#39;} = $currency;
-				$info{&#39;gold&#39;,&#39;success&#39;}  = 1;
 			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;gold&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;gold&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;gold&#39;,&#39;name&#39;}     = &#39;Gold Spot&#39;;
+			$info{&#39;gold&#39;,&#39;last&#39;}     = $gold_oz;
+			$info{&#39;gold&#39;,&#39;price&#39;}    = $gold_oz;
+			$info{&#39;gold&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;gold&#39;,&#39;success&#39;}  = 1;
 		}
 
 		# get silver rate
 		#
 		if&#40; $_want_silver &#41; {
-			$_ = $table_silver-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;\d*\.\d*&#41;.*\/oz/ &#41; {
-				$silver_oz = $1;
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-silver-oz&#34;&#41;;
 
-				$quoter-&gt;store_date&#40;\%info, &#39;silver&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
-				$info{&#39;silver&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
-				$info{&#39;silver&#39;,&#39;name&#39;}     = &#39;Silver Spot&#39;;
-				$info{&#39;silver&#39;,&#39;last&#39;}     = $silver_oz;
-				$info{&#39;silver&#39;,&#39;price&#39;}    = $silver_oz;
-				$info{&#39;silver&#39;,&#39;currency&#39;} = $currency;
-				$info{&#39;silver&#39;,&#39;success&#39;}  = 1;
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
+				$silver_oz = $1;
 			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;silver&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;silver&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;silver&#39;,&#39;name&#39;}     = &#39;Silver Spot&#39;;
+			$info{&#39;silver&#39;,&#39;last&#39;}     = $silver_oz;
+			$info{&#39;silver&#39;,&#39;price&#39;}    = $silver_oz;
+			$info{&#39;silver&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;silver&#39;,&#39;success&#39;}  = 1;
 		}
 		
 		# get platinum rate
 		#
 		if&#40; $_want_platinum &#41; {
-			$_ = $table_platinum-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;\d*\.\d*&#41;.*\/pg/ &#41; {
-				$platinum_pg = $1;
-			}
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-platinum-oz&#34;&#41;;
 
-			$_ = $table_platinum-&gt;cell&#40;0,0&#41;;
-			if&#40; /&#40;\d*\.\d*&#41;.*\/oz/ &#41; {
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$platinum_oz = $1;
-
-				# assemble final dataset
-				# - take &#34;now&#34; as date/time as the site is always current and does
-				#   not provide this explicitly - so there is a time-slip
-				$quoter-&gt;store_date&#40;\%info, &#39;platinum&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
-				$info{&#39;platinum&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
-				$info{&#39;platinum&#39;,&#39;name&#39;}     = &#39;Platinum Spot&#39;;
-				$info{&#39;platinum&#39;,&#39;last&#39;}     = $platinum_oz;
-				$info{&#39;platinum&#39;,&#39;price&#39;}    = $platinum_oz;
-				$info{&#39;platinum&#39;,&#39;price_pg&#39;} = $platinum_pg;
-				$info{&#39;platinum&#39;,&#39;currency&#39;} = $currency;
-				$info{&#39;platinum&#39;,&#39;success&#39;}  = 1;
 			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;platinum&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;platinum&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;platinum&#39;,&#39;name&#39;}     = &#39;Platinum Spot&#39;;
+			$info{&#39;platinum&#39;,&#39;last&#39;}     = $platinum_oz;
+			$info{&#39;platinum&#39;,&#39;price&#39;}    = $platinum_oz;
+			$info{&#39;platinum&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;platinum&#39;,&#39;success&#39;}  = 1;
 		}
 	}
 
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-Finance-Quote-64897-0002-support-palladium-lookup.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1022823/533462/perl-Finance-Quote-64897-0002-support-palladium-lookup.patch">Download perl-Finance-Quote-64897-0002-support-palladium-lookup.patch</a><br />
<span class="downloadcontenttype">text/x-diff 6.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=64897">https://rt.cpan.org/Public/Bug/Display.html?id=64897</a></span>

This is a merge of the patch provided by the bug tracker to the upstream
GIT snapshot.

Date: Tue Jan 18 15:29:56 2011 stephan.ebelt [...] gmx.net - Ticket created
Subject: GoldMoney site has changed &#40;patch attached&#41;

the goldmoney site has been updated recently and they now allow to
purchase palladium as well. attached are two patches for the
GoldMoney.pm module and its test. 

From e410b33151f394d76219a0f0de24de232f4e8750 Mon Sep 17 00:00:00 2001
From: Stephan Ebelt &lt;ste@shared-files.de&gt;
Date: Tue, 18 Jan 2011 20:47:11 +0100
Subject: [PATCH] support &#39;palladium&#39; lookup

---
 lib/Finance/Quote/GoldMoney.pm |   46 +++++++++++++++++++++++++++++++--------
 t/goldmoney.t                  |   13 +++++++++-
 2 files changed, 47 insertions&#40;+&#41;, 12 deletions&#40;-&#41;

Index: finance-quote/lib/Finance/Quote/GoldMoney.pm
===================================================================
--- finance-quote.orig/lib/Finance/Quote/GoldMoney.pm
+++ finance-quote/lib/Finance/Quote/GoldMoney.pm
@@ -7,7 +7,7 @@
 #    Copyright &#40;C&#41; 2000, Brent Neal &lt;brentn@users.sourceforge.net&gt;
 #    Copyright &#40;C&#41; 2000, Volker Stuerzl &lt;volker.stuerzl@gmx.de&gt;
 #    Copyright &#40;C&#41; 2006, Klaus Dahlke &lt;klaus.dahlke@gmx.de&gt;
-#    Copyright &#40;C&#41; 2008, Stephan Ebelt &lt;stephan.ebelt@gmx.de&gt;
+#    Copyright &#40;C&#41; 2011, Stephan Ebelt &lt;ste -at- shared-files -dot- de&gt;
 #
 #    This program is free software; you can redistribute it and/or modify
 #    it under the terms of the GNU General Public License as published by
@@ -31,7 +31,6 @@ require 5.005;
 require Crypt::SSLeay;
 
 use HTTP::Request::Common;
-use HTML::TableExtract;
 use HTML::TreeBuilder;
 
 use strict;
@@ -51,7 +50,8 @@ sub labels {
 
 # goldmoney&#40;$quoter, @symbols&#41;
 #
-# - get &#39;gold&#39; and &#39;silver&#39; spot rates from goldmoney.com
+# - get &#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39; and &#39;palladium&#39; spot rates from
+#   goldmoney.com
 # - error out properly &#40;that is: ignore&#41; all other symbols
 # 
 sub goldmoney {
@@ -64,12 +64,14 @@ sub goldmoney {
 	my $ua = $quoter-&gt;user_agent;
 	my &#40;%symbolhash, @q, %info&#41;;
 	my &#40;
-		$html_string, $tree, $gold_gg, $gold_oz, $silver_oz, $platinum_oz, $platinum_pg, $currency
+		$html_string, $tree, $gold_oz, $silver_oz, $platinum_oz,
+		$palladium_oz, $currency
 	&#41;;
 
 	my $_want_gold = 0;
 	my $_want_silver = 0;
 	my $_want_platinum = 0;
+	my $_want_palladium = 0;
 
 	# - feed all requested symbols into %info &#40;to be returned later&#41;
 	# - set error state to false by default
@@ -86,8 +88,10 @@ sub goldmoney {
 			$_want_silver = 1;
 		} elsif&#40;$s eq &#39;platinum&#39;&#41; {
 			$_want_platinum = 1;
+		} elsif&#40;$s eq &#39;palladium&#39;&#41; {
+			$_want_palladium = 1;
 		} else {
-			$info{$s,&#39;errormsg&#39;} = &#34;No data returned &#40;note: this module only works for &#39;gold&#39; and &#39;silver&#39;&#41;&#34;;
+			$info{$s,&#39;errormsg&#39;} = &#34;No data returned &#40;note: this module only works for &#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39; and &#39;palladium&#39;&#41;&#34;;
 		}
 	}
 
@@ -182,6 +186,28 @@ sub goldmoney {
 			$info{&#39;platinum&#39;,&#39;currency&#39;} = $currency;
 			$info{&#39;platinum&#39;,&#39;success&#39;}  = 1;
 		}
+		
+		# get palladium rate
+		#
+		if&#40; $_want_palladium &#41; {
+      		$_ = $tree-&gt;look_down&#40;&#34;_tag&#34;, &#34;span&#34;, &#34;id&#34;, &#34;spot-price-palladium-oz&#34;&#41;;
+
+			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
+				$palladium_oz = $1;
+				$palladium_oz =~ s/,//g;
+			}
+
+			# assemble final dataset
+			# - take &#34;now&#34; as date/time as the site is always current and does
+			#   not provide this explicitly - so there is a time-slip
+			$quoter-&gt;store_date&#40;\%info, &#39;palladium&#39;, {isodate =&gt; _goldmoney_time&#40;&#39;isodate&#39;&#41;}&#41;;
+			$info{&#39;palladium&#39;,&#39;time&#39;}     = _goldmoney_time&#40;&#39;time&#39;&#41;;
+			$info{&#39;palladium&#39;,&#39;name&#39;}     = &#39;Palladium Spot&#39;;
+			$info{&#39;palladium&#39;,&#39;last&#39;}     = $palladium_oz;
+			$info{&#39;palladium&#39;,&#39;price&#39;}    = $palladium_oz;
+			$info{&#39;palladium&#39;,&#39;currency&#39;} = $currency;
+			$info{&#39;palladium&#39;,&#39;success&#39;}  = 1;
+		}
 	}
 
 	return wantarray&#40;&#41; ? %info : \%info;
@@ -229,12 +255,12 @@ Finance::Quote::GoldMoney - obtain spot
 
     $q = Finance::Quote-&gt;new;
 
-    %rates = $q-&gt;fetch&#40;&#39;goldmoeny&#39;,&#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39;&#41;;
+    %rates = $q-&gt;fetch&#40;&#39;goldmoney&#39;,&#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39;, &#39;palladium&#39;&#41;;
 
 =head1 DESCRIPTION
 
-This module obtains current spot rates for &#39;gold&#39;, &#39;silver&#39; and
-&#39;platinum&#39; from Goldmoney &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmoney.com">http://www.goldmoney.com</a></span>&#41;. All other
+This module obtains current spot rates for &#39;gold&#39;, &#39;silver&#39;, &#39;platinum&#39;
+and &#39;palladium&#39; from GoldMoney &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://goldmoney.com">http://goldmoney.com</a></span>&#41;. All other
 symbols are ignored.
 
 Information returned by this module is governed by Net Transactions
@@ -248,8 +274,8 @@ The following labels are returned by Fin
 	- exchange
 	- name
 	- date, time
-	- price &#40;per ounce&#41;, price_gg &#40;per goldgram, gold only&#41;,
-      price_pg &#40;per platinumgram, platinum only&#41;
+	- price &#40;per ounce&#41;
+	- last &#40;per ounce, same as &#39;price&#39;&#41;
     - currency
 
 =head1 SEE ALSO
Index: finance-quote/t/goldmoney.t
===================================================================
--- finance-quote.orig/t/goldmoney.t
+++ finance-quote/t/goldmoney.t
@@ -7,12 +7,12 @@ if &#40;not $ENV{ONLINE_TEST}&#41; {
     plan skip_all =&gt; &#39;Set $ENV{ONLINE_TEST} to run this test&#39;;
 }
 
-plan tests =&gt; 23;
+plan tests =&gt; 31;
 
 # Test GoldMoney functions.
 my $q      = Finance::Quote-&gt;new&#40;&#34;GoldMoney&#34;&#41;;
 $q-&gt;set_currency&#40;&#39;EUR&#39;&#41;;
-my %quotes = $q-&gt;fetch&#40;&#34;goldmoney&#34;,&#34;gold&#34;, &#34;silver&#34;, &#34;platinum&#34;, &#34;BOGUS&#34;&#41;;
+my %quotes = $q-&gt;fetch&#40;&#34;goldmoney&#34;,&#34;gold&#34;, &#34;silver&#34;, &#34;platinum&#34;, &#34;palladium&#34;, &#34;BOGUS&#34;&#41;;
 ok&#40;%quotes&#41;;
 
 # Check that sound information is returned for gold, silver and platinum.
@@ -34,6 +34,13 @@ ok&#40;$quotes{&#34;platinum&#34;,&#34;currency&#34;} eq &#34;EU
 ok&#40;length&#40;$quotes{&#34;platinum&#34;,&#34;date&#34;}&#41; &gt; 0&#41;;
 ok&#40;length&#40;$quotes{&#34;platinum&#34;,&#34;time&#34;}&#41; &gt; 0&#41;;
 
+ok&#40;$quotes{&#34;palladium&#34;,&#34;success&#34;}, &#39;palladium price lookup&#39;&#41;;
+ok&#40;$quotes{&#34;palladium&#34;,&#34;last&#34;} &gt; 0&#41;;
+ok&#40; $quotes{&#34;palladium&#34;,&#34;last&#34;} !~ /^0/ &#41;;
+ok&#40;$quotes{&#34;palladium&#34;,&#34;currency&#34;} eq &#34;EUR&#34;&#41;;
+ok&#40;length&#40;$quotes{&#34;palladium&#34;,&#34;date&#34;}&#41; &gt; 0&#41;;
+ok&#40;length&#40;$quotes{&#34;palladium&#34;,&#34;time&#34;}&#41; &gt; 0&#41;;
+
 my $year = &#40;localtime&#40;&#41;&#41;[5] + 1900;
 ok&#40;&#40;substr&#40;$quotes{&#34;gold&#34;,&#34;isodate&#34;},0,4&#41; == $year&#41;&#41;;
 ok&#40;&#40;substr&#40;$quotes{&#34;gold&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
@@ -41,6 +48,8 @@ ok&#40;&#40;substr&#40;$quotes{&#34;silver&#34;,&#34;isodate&#34;},0
 ok&#40;&#40;substr&#40;$quotes{&#34;silver&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
 ok&#40;&#40;substr&#40;$quotes{&#34;platinum&#34;,&#34;isodate&#34;},0,4&#41; == $year&#41;&#41;;
 ok&#40;&#40;substr&#40;$quotes{&#34;platinum&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
+ok&#40;&#40;substr&#40;$quotes{&#34;palladium&#34;,&#34;isodate&#34;},0,4&#41; == $year&#41;&#41;;
+ok&#40;&#40;substr&#40;$quotes{&#34;palladium&#34;,&#34;date&#34;},6,4&#41; == $year&#41;&#41;;
 
 # Check that a bogus symbol returns no-success.
 ok&#40;! $quotes{&#34;BOGUS&#34;,&#34;success&#34;}&#41;;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-Finance-Quote-goldmoney-decimal-point.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1022823/533463/perl-Finance-Quote-goldmoney-decimal-point.patch">Download perl-Finance-Quote-goldmoney-decimal-point.patch</a><br />
<span class="downloadcontenttype">text/x-diff 721b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: finance-quote/lib/Finance/Quote/GoldMoney.pm
===================================================================
--- finance-quote.orig/lib/Finance/Quote/GoldMoney.pm
+++ finance-quote/lib/Finance/Quote/GoldMoney.pm
@@ -131,6 +131,7 @@ sub goldmoney {
 
 			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$gold_oz = $1;
+				$gold_oz =~ s/,//;
 			}
 
 			# assemble final dataset
@@ -152,6 +153,7 @@ sub goldmoney {
 
 			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$silver_oz = $1;
+				$silver_oz =~ s/,//;
 			}
 
 			# assemble final dataset
@@ -173,6 +175,7 @@ sub goldmoney {
 
 			if&#40; $_-&gt;as_text =~ /&#40;[\d,]*\.\d*&#41;/ &#41; {
 				$platinum_oz = $1;
+				$platinum_oz =~ s/,//;
 			}
 
 			# assemble final dataset
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1022826" href="/Public/Bug/Display.html?id=64897#txn-1022826">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;16&nbsp;11:27:10&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.420977</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
