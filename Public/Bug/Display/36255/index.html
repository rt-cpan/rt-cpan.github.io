<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #36255 for Parse-MediaWikiDump: Parse::MediaWikiDump::page::namespace may return a string which is not really a namespace</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #36255 for Parse-MediaWikiDump: Parse::MediaWikiDump::page::namespace may return a string which is not really a namespace</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Parse-MediaWikiDump/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Parse-MediaWikiDump/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Parse-MediaWikiDump/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Parse-MediaWikiDump/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Parse-MediaWikiDump">Parse-MediaWikiDump CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">36255</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Parse-MediaWikiDump/Active/">Parse-MediaWikiDump</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
amir.aharoni [...] mail.huji.ac.il

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-24738-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.40    </td>
  </tr>
  <tr id="CF-24739-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;16:41:15&nbsp;2008</span>
    <span class="description">amir.aharoni [...] mail.huji.ac.il -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Parse::MediaWikiDump::page::namespace may return a string which
 is not really a namespace</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The namespace&#40;&#41; function returns any string which appears before the
first colon in the page&#39;s title. This may be any string even if it&#39;s not
the name of one of the namespaces.

I think that i managed to solve it and a patch is attached.

What i did:

* Some cosmetics - converted spaces to tabs &#40;usually i prefer spaces,
but most of the file used tabs, so i made it consistent.&#41;

* Added use List::Util; - so i can use the function first&#40;&#41;

* Added the function namespaces_names&#40;&#41; to package
Parse::MediaWikiDump::Pages. It returns an array ref to a plain list of
namespace names and not a complex data structure that also includes the
namespace numbers. Since it will be used often to check whether a string
before the quotes is a namespace name, i thought that it&#39;s reasonable to
make access to this list easy and not have to filter out the numbers
every time.

* In parse_head&#40;&#41;: a namespace name is added to @{$data{namespaces_names}.

* In parse_page&#40;&#41;: the pages namespace is now found here. I didn&#39;t make
any calculations, but i don&#39;t think that&#39;s it&#39;s very expensive. The
algorithm: I use the same regex to find the string before the colon;
then i check whether this string is one of the namespaces; if it is,
then it&#39;s saved to %data as the page&#39;s namespace, otherwise the
namespace is &#39;&#39;.

* Parse::MediaWikiDump::page::namespace&#40;&#41; now simply returns the
namespace which was already found in parse_page&#40;&#41;.

* Update POD to include $pages-&gt;namespaces_names

How i tested it:

`make test` passes fine after my modifications. I didn&#39;t modify any
tests, because i guess that i need to add a page to the dump to be able
to test it properly, and i don&#39;t have a lot of experience playing with
actual MediaWiki installations. However, i did run it with a script that
i wrote that searches for pages without interlanguage links and it seems
to do the right thing &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Wikipedia:WPIW/HE">http://en.wikipedia.org/wiki/Wikipedia:WPIW/HE</a></span> &#41;.

Any other comments are welcome.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> true_namespaces.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Naur Parse-MediaWikiDump-0.40/lib/Parse/MediaWikiDump.pm Parse-MediaWikiDump-0.40.1/lib/Parse/MediaWikiDump.pm
--- Parse-MediaWikiDump-0.40/lib/Parse/MediaWikiDump.pm	2006-06-21 22:39:22.000000000 +0200
+++ Parse-MediaWikiDump-0.40.1/lib/Parse/MediaWikiDump.pm	2008-05-28 21:07:12.850000000 +0200
@@ -16,6 +16,7 @@
 
 use strict;
 use warnings;
+use List::Util;
 use XML::Parser;
 
 #tokens in the buffer are an array ref with the 0th element specifying
@@ -30,8 +31,8 @@
 
 	$$self{PARSER} = XML::Parser-&gt;new&#40;ProtocolEncoding =&gt; &#39;UTF-8&#39;&#41;;
 	$$self{PARSER}-&gt;setHandlers&#40;&#39;Start&#39;, \&#38;start_handler,
-				    &#39;End&#39;, \&#38;end_handler&#41;;
-        $$self{EXPAT} = $$self{PARSER}-&gt;parse_start&#40;state =&gt; $self&#41;;
+					&#39;End&#39;, \&#38;end_handler&#41;;
+		$$self{EXPAT} = $$self{PARSER}-&gt;parse_start&#40;state =&gt; $self&#41;;
 	$$self{BUFFER} = []; 
 	$$self{CHUNK_SIZE} = 32768;
 	$$self{BUF_LIMIT} = 10000;
@@ -142,6 +143,11 @@
 	return $$self{HEAD}{namespaces};
 }
 
+sub namespaces_names {
+	my $self = shift;
+	return $$self{HEAD}{namespaces_names};
+}
+
 sub current_byte {
 	my $self = shift;
 	return $$self{BYTE};
@@ -253,7 +259,10 @@
 	my $self = shift;
 	my $buffer = shift;
 	my $state = &#39;start&#39;;
-	my %data = &#40;namespaces =&gt; []&#41;;
+	my %data = &#40;
+		namespaces			=&gt; [],
+		namespaces_names	=&gt; [],
+	&#41;;
 
 	for &#40;my $i = 0; $i &lt;= $#$buffer; $i++&#41; {
 		my $token = $$buffer[$i];
@@ -375,6 +384,7 @@
 			}
 
 			push&#40;@{$data{namespaces}}, [$key, $name]&#41;;
+			push&#40;@{$data{namespaces_names}}, $name&#41;;
 
 			$token = $$buffer[++$i];
 
@@ -624,6 +634,18 @@
 		}
 	}
 
+	$data{namespace} = &#39;&#39;;
+	# Many pages just have a : in the title, but it&#39;s not necessary
+	# a namespace designation.
+	if &#40;$data{title} =~ m/^&#40;[^:]+&#41;\:/&#41; {
+		my $possible_namespace = $1;
+		if &#40;List::Util::first { /^$possible_namespace$/ }
+			@{ $self-&gt;namespaces_names&#40;&#41; }&#41;
+		{
+			$data{namespace} = $possible_namespace;
+		}
+	}
+
 	$data{minor} = 0 unless defined&#40;$data{minor}&#41;;
 
 	return \%data;
@@ -732,17 +754,7 @@
 sub namespace {
 	my $self = shift;
 
-	return $$self{CACHE}{namespace} if defined&#40;$$self{CACHE}{namespace}&#41;;
-
-	my $title = $$self{DATA}{title};
-
-	if &#40;$title =~ m/^&#40;[^:]+&#41;\:/&#41; {
-		$$self{CACHE}{namespace} = $1;
-		return $1;
-	} else {
-		$$self{CACHE}{namespace} = &#39;&#39;;
-		return &#39;&#39;;
-	}
+	return $$self{DATA}{namespace};
 }
 
 sub categories {
@@ -1081,6 +1093,11 @@
 namespace number and the second is the namespace name. In the case of namespace
 0 the text stored for the name is &#39;&#39;.
 
+=item $pages-&gt;namespaces
+
+Returns an array reference to the list of namespaces names in the instance,
+without namespaces numbers. Main namespace name is &#39;&#39;.
+
 =item $pages-&gt;current_byte
 
 Returns the number of bytes parsed so far.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;29&nbsp;02:10:24&nbsp;2008</span>
    <span class="description">triddle [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #36255] Parse::MediaWikiDump::page::namespace may return a string which is not really a namespace</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 May 2008 23:10:08 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Parse-MediaWikiDump [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tyler Riddle&#34; &lt;triddle [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Amir,
Thank you, this is a great patch. I&#39;ve reviewed the changes and I&#39;ll surely
integrate it. I only have one nit-pick: I&#39;d rather use the string comparison
operator in the first&#40;&#41; invocation over a regular expression just because it
doesn&#39;t need a pattern match.

Adding in a test case for this bug is simple and something that should be
done along with the release for this bugfix. One of the &lt;page&gt; entries in
the pages_test.xml file can be duplicated and a link created with a title
that exposes the old bug. Adding a test case to the pages.t test is also
straight forward, just duplicating the other existing test functions and
changing the values specific to the test case.

I think those changes as well as moving the test case data into the test
directory would make for a great maintenance release. I&#39;m just logging these
things for the record, I don&#39;t expect you to do them. I&#39;ll get around to the
next release as soon as I can possibly this week, possibly next.

Thanks for letting me know about the bug and especially for fixing it. I&#39;ll
be sure to put your name and the bug number in the changelog and into the
authors section of the POD.

Tyler


On Wed, May 28, 2008 at 1:41 PM, Amir E. Aharoni via RT &lt;
bug-Parse-MediaWikiDump@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Wed May 28 16:41:15 2008: Request 36255 was acted upon.
&gt; Transaction: Ticket created by amire80
&gt;       Queue: Parse-MediaWikiDump
&gt;     Subject: Parse::MediaWikiDump::page::namespace may return a string
&gt; which
&gt;  is not really a namespace
&gt;   Broken in: 0.40
&gt;    Severity: Important
&gt;       Owner: Nobody
&gt;  Requestors: amir.aharoni@gmail.com
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=36255">http://rt.cpan.org/Ticket/Display.html?id=36255</a></span> &gt;
&gt;
&gt;
&gt; The namespace&#40;&#41; function returns any string which appears before the
&gt; first colon in the page&#39;s title. This may be any string even if it&#39;s not
&gt; the name of one of the namespaces.
&gt;
&gt; I think that i managed to solve it and a patch is attached.
&gt;
&gt; What i did:
&gt;
&gt; * Some cosmetics - converted spaces to tabs &#40;usually i prefer spaces,
&gt; but most of the file used tabs, so i made it consistent.&#41;
&gt;
&gt; * Added use List::Util; - so i can use the function first&#40;&#41;
&gt;
&gt; * Added the function namespaces_names&#40;&#41; to package
&gt; Parse::MediaWikiDump::Pages. It returns an array ref to a plain list of
&gt; namespace names and not a complex data structure that also includes the
&gt; namespace numbers. Since it will be used often to check whether a string
&gt; before the quotes is a namespace name, i thought that it&#39;s reasonable to
&gt; make access to this list easy and not have to filter out the numbers
&gt; every time.
&gt;
&gt; * In parse_head&#40;&#41;: a namespace name is added to @{$data{namespaces_names}.
&gt;
&gt; * In parse_page&#40;&#41;: the pages namespace is now found here. I didn&#39;t make
&gt; any calculations, but i don&#39;t think that&#39;s it&#39;s very expensive. The
&gt; algorithm: I use the same regex to find the string before the colon;
&gt; then i check whether this string is one of the namespaces; if it is,
&gt; then it&#39;s saved to %data as the page&#39;s namespace, otherwise the
&gt; namespace is &#39;&#39;.
&gt;
&gt; * Parse::MediaWikiDump::page::namespace&#40;&#41; now simply returns the
&gt; namespace which was already found in parse_page&#40;&#41;.
&gt;
&gt; * Update POD to include $pages-&gt;namespaces_names
&gt;
&gt; How i tested it:
&gt;
&gt; `make test` passes fine after my modifications. I didn&#39;t modify any
&gt; tests, because i guess that i need to add a page to the dump to be able
&gt; to test it properly, and i don&#39;t have a lot of experience playing with
&gt; actual MediaWiki installations. However, i did run it with a script that
&gt; i wrote that searches for pages without interlanguage links and it seems
&gt; to do the right thing &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Wikipedia:WPIW/HE&#41;">http://en.wikipedia.org/wiki/Wikipedia:WPIW/HE&#41;</a></span>.
&gt;
&gt; Any other comments are welcome.
&gt;
</div>


-- 
Red Hat&#39;s vision for Unix is findgrepsedtee and a package manager that lies.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;29&nbsp;02:10:29&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;29&nbsp;02:20:05&nbsp;2008</span>
    <span class="description">amir.aharoni [...] mail.huji.ac.il -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> amir.aharoni [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 29 02:10:24 2008, triddle@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for letting me know about the bug and especially for fixing it.
&gt; I&#39;ll
&gt; be sure to put your name and the bug number in the changelog and into
&gt; the
&gt; authors section of the POD.
</div>
Thanks for the quick reply!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;30&nbsp;02:01:03&nbsp;2008</span>
    <span class="description">amir.aharoni [...] mail.huji.ac.il -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> amir.aharoni [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 29 02:10:24 2008, triddle@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Amir,
&gt; Thank you, this is a great patch. I&#39;ve reviewed the changes and I&#39;ll
&gt; surely
&gt; integrate it. I only have one nit-pick: I&#39;d rather use the string
&gt; comparison
&gt; operator in the first&#40;&#41; invocation over a regular expression just
&gt; because it
&gt; doesn&#39;t need a pattern match.
</div>
You are very right about it. $_ eq $possible_namespace is indeed
simpler. There was also a nasty bug there - if $possible_namespace has
metacharacters the regex may become invalid and crash the program in the
middle of a long dump processing session. I forget quotemeta all the
time. &#40;Perl 6 is supposed to fix this one fine day...&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;31&nbsp;12:59:43&nbsp;2008</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> triddle [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello again,

I created a test case to identify the bug you reported, verified the test case did in fact catch 
the bug, then applied your patch. I think you will be very pleased to know that after applying 
your patch and with out any further modifications the bug was fixed. Thank you! :-&#41;

I have attached 0.51 to this bug report, can you please test it and let me know if it solves 
your bug? If not, could you update the test data in t/pages_test.xml to reproduce the 
problem, then send me a diff of the test data? 

Thanks again,

Tyler

On Wed May 28 16:41:15 2008, amire80 wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The namespace&#40;&#41; function returns any string which appears before the
&gt; first colon in the page&#39;s title. This may be any string even if it&#39;s not
&gt; the name of one of the namespaces.
&gt; 
&gt; I think that i managed to solve it and a patch is attached.
&gt; 
&gt; What i did:
&gt; 
&gt; * Some cosmetics - converted spaces to tabs &#40;usually i prefer spaces,
&gt; but most of the file used tabs, so i made it consistent.&#41;
&gt; 
&gt; * Added use List::Util; - so i can use the function first&#40;&#41;
&gt; 
&gt; * Added the function namespaces_names&#40;&#41; to package
&gt; Parse::MediaWikiDump::Pages. It returns an array ref to a plain list of
&gt; namespace names and not a complex data structure that also includes the
&gt; namespace numbers. Since it will be used often to check whether a string
&gt; before the quotes is a namespace name, i thought that it&#39;s reasonable to
&gt; make access to this list easy and not have to filter out the numbers
&gt; every time.
&gt; 
&gt; * In parse_head&#40;&#41;: a namespace name is added to @{$data{namespaces_names}.
&gt; 
&gt; * In parse_page&#40;&#41;: the pages namespace is now found here. I didn&#39;t make
&gt; any calculations, but i don&#39;t think that&#39;s it&#39;s very expensive. The
&gt; algorithm: I use the same regex to find the string before the colon;
&gt; then i check whether this string is one of the namespaces; if it is,
&gt; then it&#39;s saved to %data as the page&#39;s namespace, otherwise the
&gt; namespace is &#39;&#39;.
&gt; 
&gt; * Parse::MediaWikiDump::page::namespace&#40;&#41; now simply returns the
&gt; namespace which was already found in parse_page&#40;&#41;.
&gt; 
&gt; * Update POD to include $pages-&gt;namespaces_names
&gt; 
&gt; How i tested it:
&gt; 
&gt; `make test` passes fine after my modifications. I didn&#39;t modify any
&gt; tests, because i guess that i need to add a page to the dump to be able
&gt; to test it properly, and i don&#39;t have a lot of experience playing with
&gt; actual MediaWiki installations. However, i did run it with a script that
&gt; i wrote that searches for pages without interlanguage links and it seems
&gt; to do the right thing &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Wikipedia:WPIW/HE">http://en.wikipedia.org/wiki/Wikipedia:WPIW/HE</a></span> &#41;.
&gt; 
&gt; Any other comments are welcome.
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;01&nbsp;16:02:20&nbsp;2008</span>
    <span class="description">amir.aharoni [...] mail.huji.ac.il -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> amir.aharoni [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 31 12:59:43 2008, TRIDDLE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello again,
&gt;
&gt; I have attached 0.51 to this bug report, can you please test it and
&gt; let me know if it solves
&gt; your bug? If not, could you update the test data in t/pages_test.xml
&gt; to reproduce the
&gt; problem, then send me a diff of the test data?
</div>
Tested with the dump i usually work on.  Works fine for me.

The only conceivable problem was with the installation. When i tried to
run `make test&#39; i got:

/usr/bin/perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0,
&#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/00-load.........t/00-load.t is not readable
t/links-compat....t/links-compat.t is not readable
t/links...........t/links.t is not readable
t/pages-compat....t/pages-compat.t is not readable
t/pages...........t/pages.t is not readable
FAILED--5 test scripts could be run, alas--no output ever seen
make: *** [test_dynamic] Error 255

I chmod&#39;ed everything to 777 and it was gone. &#40;Maybe it&#39;s because i have
Cygwin on Vista here and something was screwed up with the permissions.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;01&nbsp;18:15:13&nbsp;2008</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Glad to hear the bug has been resolved, thanks so much for your patch. I double checked the 
tests in the release and they worked ok on my Mac, I suspect it was a Vista related problem 
you ran into. Regardless, the cpan testers will let me know if there are problems running the 
tests.

Tyler

On Sun Jun 01 16:02:20 2008, amire80 wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat May 31 12:59:43 2008, TRIDDLE wrote:
<div class="message-stanza open">&gt; &gt; Hello again,
&gt; &gt;
&gt; &gt; I have attached 0.51 to this bug report, can you please test it and
&gt; &gt; let me know if it solves
&gt; &gt; your bug? If not, could you update the test data in t/pages_test.xml
&gt; &gt; to reproduce the
&gt; &gt; problem, then send me a diff of the test data?
</div>&gt; 
&gt; Tested with the dump i usually work on.  Works fine for me.
&gt; 
&gt; The only conceivable problem was with the installation. When i tried to
&gt; run `make test&#39; i got:
&gt; 
&gt; /usr/bin/perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0,
&gt; &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
&gt; t/00-load.........t/00-load.t is not readable
&gt; t/links-compat....t/links-compat.t is not readable
&gt; t/links...........t/links.t is not readable
&gt; t/pages-compat....t/pages-compat.t is not readable
&gt; t/pages...........t/pages.t is not readable
&gt; FAILED--5 test scripts could be run, alas--no output ever seen
&gt; make: *** [test_dynamic] Error 255
&gt; 
&gt; I chmod&#39;ed everything to 777 and it was gone. &#40;Maybe it&#39;s because i have
&gt; Cygwin on Vista here and something was screwed up with the permissions.&#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;01&nbsp;18:15:49&nbsp;2008</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Bug reporter has indicated 0.51 functions properly for him. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;01&nbsp;18:15:51&nbsp;2008</span>
    <span class="description">triddle [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
