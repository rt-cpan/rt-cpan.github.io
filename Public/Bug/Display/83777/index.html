<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #83777 for Dist-Zilla-Plugin-ShareDir-Tarball: documentation/option on tarball output location</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #83777 for Dist-Zilla-Plugin-ShareDir-Tarball: documentation/option on tarball output location</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-ShareDir-Tarball/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-ShareDir-Tarball/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-ShareDir-Tarball/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-ShareDir-Tarball/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Dist-Zilla-Plugin-ShareDir-Tarball">Dist-Zilla-Plugin-ShareDir-Tarball CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">83777</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Dist-Zilla-Plugin-ShareDir-Tarball/Active/">Dist-Zilla-Plugin-ShareDir-Tarball</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
NGLENN [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
garfieldnate [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-246290-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-246291-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




build.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1190318/627947/build.log">
Tue Mar 12 20:25:58 2013 (11.2k) by NGLENN [...] cpan.org
</a>
</font></li>
</ul>


Test-DZST-2.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1189987/627748/Test-DZST-2.zip">
Tue Mar 12 02:03:06 2013 (2.7k) by NGLENN [...] cpan.org
</a>
</font></li>
</ul>


Test-DZST.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1189426/627419/Test-DZST.zip">
Sat Mar 09 23:56:02 2013 (2.6k) by NGLENN [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;18:52:48&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> documentation/option on tarball output location</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Since you added the option to choose the input directory, I think you need 
another addition to the documentation.

&#34;The tarball is always created in a directory named &#39;share&#39;, regardless of 
the name of the directory of the input files. Therefore, the default 
argument to the &#39;dir&#39; option of L&lt;Dist::Zilla::Plugin::ShareDir] is the 
correct one.&#34;

On the other hand, you might just want to add another option to specify 
the output directory, or to keep the same directory name or not. I was 
surprised that the tarball was put in the &#34;share/&#34; directory when I used 
this, but it turned out to be very nice for my project.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;19:16:15&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmm, this is actually turning out to be really bad because  DZP::Sharedir 
doesn&#39;t runs before DZP::ShareDir::Tarball, and so doesn&#39;t see a &#39;share&#39; 
directory yet. Since there aren&#39;t any matching files, it just ignores it 
and the files aren&#39;t installed. 

This is actually a bug, not a wishlist or documentation problem. DZPST 
either needs to run before DZPS &#40;which I would like better&#41;, or it needs 
to put the tarball back into the same directory.

On Tue Mar 05 18:52:48 2013, NGLENN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; but it turned out to be very nice for my project.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;19:16:17&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;19:37:21&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 05 Mar 2013 19:36:57 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13-03-05 06:52 PM, Nathan Gary Glenn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On the other hand, you might just want to add another option to specify
&gt; the output directory, or to keep the same directory name or not. I was
&gt; surprised that the tarball was put in the &#34;share/&#34; directory when I used
&gt; this, but it turned out to be very nice for my project.
</div>
        In the case of all ShareDir modules, the output directory is generally 
&#39;share&#39;, as this is also the location where it will be installed on the 
system. Whereas I can see reasons to have the source be somewhere else 
than &#39;share/&#39;, I&#39;m not so sure about the output directory.

Joy,
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;19:38:36&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 05 Mar 2013 19:38:20 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13-03-05 07:16 PM, Nathan Gary Glenn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is actually a bug, not a wishlist or documentation problem. DZPST
&gt; either needs to run before DZPS &#40;which I would like better&#41;, or it needs
&gt; to put the tarball back into the same directory.
</div>
        The order in which plugins are running are dictated by the order in 
which they appear in your dist.ini. So, in theory, you just have to make 
sure that DZPS appears after DZPST, and everything should be good.

Joy,
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;19:57:13&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com, yanick [...] babyl.dyndns.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I tried reordering and it didn&#39;t work. Is there a way to reorder phases?
I added some printouts, and combined with &#39;[ReportPhase / Phase_Begins]&#39; 
I see the phases are the problem. DZPS is run first because it 
implements &#39;Dist::Zilla::Role::ShareDir&#39;, and the ShareDir phase is run 
before the FileMunger phase, which is what DZPST implements.

On Tue Mar 05 19:38:36 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 13-03-05 07:16 PM, Nathan Gary Glenn via RT wrote:
<div class="message-stanza open">&gt; &gt; This is actually a bug, not a wishlist or documentation problem. 
</div></div>DZPST
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; either needs to run before DZPS &#40;which I would like better&#41;, or it 
</div></div>needs
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; to put the tarball back into the same directory.
</div>&gt; 
&gt;       The order in which plugins are running are dictated by the order 
</div>in 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; which they appear in your dist.ini. So, in theory, you just have to 
</div>make 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; sure that DZPS appears after DZPST, and everything should be good.
&gt; 
&gt; Joy,
&gt; `/anick
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;20:14:26&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 05 19:57:13 2013, NGLENN wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I see the phases are the problem. DZPS is run first because it 
&gt; implements &#39;Dist::Zilla::Role::ShareDir&#39;, and the ShareDir phase is 
</div>run 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; before the FileMunger phase, which is what DZPST implements.
&gt; 
</div>
This works for me &#40;replace lines 74-102&#41;:

with &#39;Dist::Zilla::Role::ShareDir&#39;;
with &#39;Dist::Zilla::Role::FileInjector&#39;;

has dir =&gt; &#40;
  is   =&gt; &#39;ro&#39;,
  isa  =&gt; &#39;Str&#39;,
  default =&gt; &#39;share&#39;,
&#41;;

sub find_files {
    my&#40; $self &#41; = @_;

        print &#34;Hello from tarballer!\n&#34;;
    my $src = $self-&gt;dir;
    my @shared = grep { $_-&gt;name =~ m#^$src/# }  @{ $self-&gt;zilla-&gt;files 
}
        or return;

    my $archive = Archive::Tar-&gt;new;

    for &#40; @shared &#41; {
        &#40; my $archive_name = $_-&gt;name &#41; =~ s#$src/##;
        $archive-&gt;add_data&#40; $archive_name =&gt; $_-&gt;content &#41;;
        $self-&gt;zilla-&gt;prune_file&#40;$_&#41;;
    }

    $self-&gt;add_file&#40; Dist::Zilla::File::InMemory-&gt;new&#40;
        name    =&gt; &#39;share/shared-files.tar.gz&#39;,
        content =&gt; Compress::Zlib::memGzip&#40;$archive-&gt;write&#41;,
    &#41;&#41;;}

sub share_dir_map {
  my &#40;$self&#41; = @_;
  my $has_files = $self-&gt;find_files;
  return unless $has_files;

  return { dist =&gt; &#39;share&#39; };
}

With this, we no longer even need regular ol&#39; [ShareDir]. I wonder if 
this is still backwards compatible with the old version though? It may 
require some people to reorder their own dist.ini&#39;s, since the &#39;Share 
Dir&#39; phase happens sooner than the &#39;Munge Files&#39; phase. I also don&#39;t 
know if losing the FileMunger role is a loss, since it does describe the 
module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;06&nbsp;21:53:01&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com, yanick [...] babyl.dyndns.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Another option would be to path DZPS to allow a &#39;force&#39; flag which adds 
the shared directory whether it finds files there or not.

On Tue Mar 05 20:14:26 2013, NGLENN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Mar 05 19:57:13 2013, NGLENN wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; I see the phases are the problem. DZPS is run first because it 
&gt; &gt; implements &#39;Dist::Zilla::Role::ShareDir&#39;, and the ShareDir phase is 
</div>&gt; run 
<div class="message-stanza open">&gt; &gt; before the FileMunger phase, which is what DZPST implements.
&gt; &gt; 
</div>&gt; 
&gt; This works for me &#40;replace lines 74-102&#41;:
&gt; 
&gt; with &#39;Dist::Zilla::Role::ShareDir&#39;;
&gt; with &#39;Dist::Zilla::Role::FileInjector&#39;;
&gt; 
&gt; has dir =&gt; &#40;
&gt;   is   =&gt; &#39;ro&#39;,
&gt;   isa  =&gt; &#39;Str&#39;,
&gt;   default =&gt; &#39;share&#39;,
&gt; &#41;;
&gt; 
&gt; sub find_files {
&gt;     my&#40; $self &#41; = @_;
&gt; 
&gt;       print &#34;Hello from tarballer!\n&#34;;
&gt;     my $src = $self-&gt;dir;
&gt;     my @shared = grep { $_-&gt;name =~ m#^$src/# }  @{ $self-&gt;zilla-
&gt;files 
&gt; }
&gt;         or return;
&gt; 
&gt;     my $archive = Archive::Tar-&gt;new;
&gt; 
&gt;     for &#40; @shared &#41; {
&gt;         &#40; my $archive_name = $_-&gt;name &#41; =~ s#$src/##;
&gt;         $archive-&gt;add_data&#40; $archive_name =&gt; $_-&gt;content &#41;;
&gt;         $self-&gt;zilla-&gt;prune_file&#40;$_&#41;;
&gt;     }
&gt; 
&gt;     $self-&gt;add_file&#40; Dist::Zilla::File::InMemory-&gt;new&#40;
&gt;         name    =&gt; &#39;share/shared-files.tar.gz&#39;,
&gt;         content =&gt; Compress::Zlib::memGzip&#40;$archive-&gt;write&#41;,
&gt;     &#41;&#41;;}
&gt; 
&gt; sub share_dir_map {
&gt;   my &#40;$self&#41; = @_;
&gt;   my $has_files = $self-&gt;find_files;
&gt;   return unless $has_files;
&gt; 
&gt;   return { dist =&gt; &#39;share&#39; };
&gt; }
&gt; 
&gt; With this, we no longer even need regular ol&#39; [ShareDir]. I wonder if 
&gt; this is still backwards compatible with the old version though? It may 
&gt; require some people to reorder their own dist.ini&#39;s, since the &#39;Share 
&gt; Dir&#39; phase happens sooner than the &#39;Munge Files&#39; phase. I also don&#39;t 
&gt; know if losing the FileMunger role is a loss, since it does describe 
</div>the 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; module.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;07&nbsp;21:38:49&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 07 Mar 2013 21:38:29 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Okay, I think I got it. There&#39;s a new version on its way to CPAN where 
D:Z:P:SD:TB also consume the ShareDir role. Which means that indeed, we 
can do without D:Z:P:SD in the dist.ini config. Try it, and let me know 
if it works for you. :-&#41;

Joy,
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;08&nbsp;00:35:11&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com, yanick [...] babyl.dyndns.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Works great! I appreciate the time you took to do this.

On Thu Mar 07 21:38:49 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Okay, I think I got it. There&#39;s a new version on its way to CPAN where 
&gt; D:Z:P:SD:TB also consume the ShareDir role. Which means that indeed, we 
&gt; can do without D:Z:P:SD in the dist.ini config. Try it, and let me know 
&gt; if it works for you. :-&#41;
&gt; 
&gt; Joy,
&gt; `/anick
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;08&nbsp;02:59:59&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com, yanick [...] babyl.dyndns.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oops. Spoke too soon. I thought it had worked because I forgot to delete 
my old share files before running this.

The behavior of this is still broken, though now different. No sharedir 
is installed. If we also use [Sharedir] with the dir option pointing to 
the original folder &#40;not &#39;share&#39;, but value specified to the dir 
argument of [Shardir::Tarball]&#41;, then that will be stated as being the 
sharedir in Makefile and Build.PL. 

On Fri Mar 08 00:35:11 2013, NGLENN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Works great! I appreciate the time you took to do this.
&gt; 
&gt; On Thu Mar 07 21:38:49 2013, yanick@babyl.dyndns.org wrote:
<div class="message-stanza open">&gt; &gt; Okay, I think I got it. There&#39;s a new version on its way to CPAN 
</div></div>where 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; D:Z:P:SD:TB also consume the ShareDir role. Which means that indeed, 
</div></div>we 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; can do without D:Z:P:SD in the dist.ini config. Try it, and let me 
</div></div>know 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; if it works for you. :-&#41;
&gt; &gt; 
&gt; &gt; Joy,
&gt; &gt; `/anick
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;09&nbsp;20:21:15&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 09 Mar 2013 20:20:52 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13-03-08 03:00 AM, Nathan Gary Glenn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=83777">https://rt.cpan.org/Ticket/Display.html?id=83777</a></span> &gt;
&gt;
&gt; Oops. Spoke too soon. I thought it had worked because I forgot to delete
&gt; my old share files before running this.
&gt;
&gt; The behavior of this is still broken, though now different. No sharedir
&gt; is installed. If we also use [Sharedir] with the dir option pointing to
&gt; the original folder &#40;not &#39;share&#39;, but value specified to the dir
&gt; argument of [Shardir::Tarball]&#41;, then that will be stated as being the
&gt; sharedir in Makefile and Build.PL.
</div>
        Can you create an example which display the problem? I&#39;ve updated the 
GitHub repo 
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball&#41;">https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball&#41;</a></span> with 
tests for both ::MakeMaker and ::ModuleBuild, and in both cases the 
&#40;Makefile|Build&#41;.PL seems to be properly populated. It might be a 
question of what exactly resides in our respective dist.inis.

Joy &#40;and getting closer...&#41;,
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;09&nbsp;23:56:02&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com, yanick [...] babyl.dyndns.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Alright, I narrowed it down and it may or may not be your problem 
&#40;though it really may need documentation&#41;. I&#39;m uploading an example.

If [PodWeaver] is removed, or is used after [ShareDir::Tarball], then it 
works fine. Otherwise, no share directory is created.

On Sat Mar 09 20:21:15 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 13-03-08 03:00 AM, Nathan Gary Glenn via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=83777">https://rt.cpan.org/Ticket/Display.html?id=83777</a></span> &gt;
&gt; &gt;
&gt; &gt; Oops. Spoke too soon. I thought it had worked because I forgot to 
</div></div>delete
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; my old share files before running this.
&gt; &gt;
&gt; &gt; The behavior of this is still broken, though now different. No 
</div></div>sharedir
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; is installed. If we also use [Sharedir] with the dir option pointing 
</div></div>to
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the original folder &#40;not &#39;share&#39;, but value specified to the dir
&gt; &gt; argument of [Shardir::Tarball]&#41;, then that will be stated as being 
</div></div>the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; sharedir in Makefile and Build.PL.
</div>&gt; 
&gt;       Can you create an example which display the problem? I&#39;ve 
</div>updated the 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; GitHub repo 
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball&#41;">https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball&#41;</a></span> with 
&gt; tests for both ::MakeMaker and ::ModuleBuild, and in both cases the 
&gt; &#40;Makefile|Build&#41;.PL seems to be properly populated. It might be a 
&gt; question of what exactly resides in our respective dist.inis.
&gt; 
&gt; Joy &#40;and getting closer...&#41;,
&gt; `/anick
&gt; 
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test-DZST.zip</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1189426/627419/Test-DZST.zip">Download Test-DZST.zip</a><br />
<span class="downloadcontenttype">application/octet-stream 2.6k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;10&nbsp;12:11:19&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> garfieldnate [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 10 Mar 2013 12:10:58 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13-03-09 11:56 PM, Nathan Gary Glenn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Alright, I narrowed it down and it may or may not be your problem
&gt; &#40;though it really may need documentation&#41;. I&#39;m uploading an example.
</div>
        Excellent. Mucho thanks, having a concrete example to poke at really 
makes things easier.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If [PodWeaver] is removed, or is used after [ShareDir::Tarball], then it
&gt; works fine. Otherwise, no share directory is created.
</div>
        Aaaand I think I know why it does what it does in this case. The shared 
abc/xyz directory only contains an empty file. Put something, anything, 
in that file, and *pop!*, your shared tarball is going to appear.

`/.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;10&nbsp;23:24:20&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmmm that didn&#39;t work for me. When I add printouts, it seem that the 
presence or absence of [PodWeaver] changes which phase DZPST is run in.
The following works for me, though:

package Dist::Zilla::Plugin::ShareDir::Tarball;
BEGIN {
  $Dist::Zilla::Plugin::ShareDir::Tarball::AUTHORITY = &#39;cpan:YANICK&#39;;
}
{
  $Dist::Zilla::Plugin::ShareDir::Tarball::VERSION = &#39;0.3.1&#39;;
}
# ABSTRACT: Bundle your shared dir into a tarball


use strict;
use warnings;

use Moose;

use Dist::Zilla::File::InMemory;
use Compress::Zlib;
use Archive::Tar;

has dir =&gt; &#40;
  is   =&gt; &#39;ro&#39;,
  isa  =&gt; &#39;Str&#39;,
  default =&gt; &#39;share&#39;,
&#41;;

has archive =&gt; &#40;
    is =&gt; &#39;ro&#39;,
    lazy =&gt; 1,
    predicate =&gt; &#39;has_archive&#39;,
    default =&gt; sub {
        Archive::Tar-&gt;new;
    },
&#41;;

has sharedir_checked =&gt; &#40;
    is =&gt; &#39;rw&#39;,
    lazy =&gt; 1,
        isa =&gt; &#39;Bool&#39;,
    default =&gt; 0,
&#41;;

has shared_files =&gt; &#40;
        is =&gt; &#39;rw&#39;,
        lazy =&gt; 1,
    isa    =&gt; &#39;ArrayRef[Dist::Zilla::File::OnDisk]&#39;,
    default =&gt; sub { [] },
&#41;;

has share_dir_map =&gt; &#40;
    is =&gt; &#39;ro&#39;,
    lazy =&gt; 1,
    default =&gt; sub {
        my $self = shift;
                print &#34;checking for share dir!\n&#34;;
                
                if&#40;not $self-&gt;sharedir_checked&#41;{
                        $self-&gt;check_sharedir;
                }
                
        return {} unless @{$self-&gt;shared_files};

                print &#34;had a share dir!\n&#34;;
        return { dist =&gt; $self-&gt;dir };
    },
&#41;;

sub compressed_archive { 
    Compress::Zlib::memGzip&#40;$_[0]-&gt;archive-&gt;write&#41; 
}

sub find_files {
  my $self = shift;

  my $dir = $self-&gt;dir . &#39;/&#39;;
  return grep { print &#39;index of &#39; . $_-&gt;name . &#39; in &#39; . &#34;$dir is &#34; . 
&#40;!index $_-&gt;name, $dir&#41; . &#34;\n&#34;; !index $_-&gt;name, $dir } @{ $self-&gt;zilla-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;files };
</div>}

sub check_sharedir {
        my $self = shift;
        my @shared = $self-&gt;find_files;
        # $self-&gt;sharedir_checked&#40;1&#41;;
        $self-&gt;shared_files&#40;\@shared&#41;;
        $self-&gt;sharedir_checked&#40;1&#41;;
}

sub munge_files {
    my&#40; $self &#41; = @_;
        
        $self-&gt;check_sharedir
                unless $self-&gt;sharedir_checked;
        
    my $src = $self-&gt;dir;
    my @shared = @{$self-&gt;shared_files} or return;
        
    for &#40; @shared &#41; {
        &#40; my $archive_name = $_-&gt;name &#41; =~ s#$src/##;
        $self-&gt;archive-&gt;add_data&#40; $archive_name =&gt; $_-&gt;content &#41;;
        $self-&gt;zilla-&gt;prune_file&#40;$_&#41;;
    }

    $self-&gt;add_file&#40; Dist::Zilla::File::InMemory-&gt;new&#40;
        name    =&gt; &#39;share/shared-files.tar.gz&#39;,
        content =&gt; $self-&gt;compressed_archive,
    &#41;&#41;;
        print &#34;munge files got here\n&#34;;
}

with &#39;Dist::Zilla::Role::ShareDir&#39;,
     &#39;Dist::Zilla::Role::FileInjector&#39;,
     &#39;Dist::Zilla::Role::FileMunger&#39;;

1;

I&#39;ve never used Moose before, so maybe it could use a fixup. There&#39;s 
also a little bit of printing cruft I used for debugging. 
But basically it will check if files have been searched for yet, and if 
not it will search for them. It checks this at any phase &#40;munge files or 
sharedir phases&#41; and saves the search result so you don&#39;t have to search 
twice.

On my machine, at least, it doesn&#39;t matter if the found files have 
contents or not; they just need to exist.

On Sun Mar 10 12:11:19 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 13-03-09 11:56 PM, Nathan Gary Glenn via RT wrote:
<div class="message-stanza open">&gt; &gt; Alright, I narrowed it down and it may or may not be your problem
&gt; &gt; &#40;though it really may need documentation&#41;. I&#39;m uploading an example.
</div>&gt; 
&gt;       Excellent. Mucho thanks, having a concrete example to poke at 
</div>really 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; makes things easier.
&gt; 
<div class="message-stanza open">&gt; &gt; If [PodWeaver] is removed, or is used after [ShareDir::Tarball], 
</div></div>then it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; works fine. Otherwise, no share directory is created.
</div>&gt; 
&gt;       Aaaand I think I know why it does what it does in this case. The 
</div>shared 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; abc/xyz directory only contains an empty file. Put something, 
</div>anything, 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; in that file, and *pop!*, your shared tarball is going to appear.
&gt; 
&gt; `/.
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;11&nbsp;20:33:46&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Mar 2013 20:33:30 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">For giggles, what is the output of &#39;prove -l&#39; for you? For me it&#39;s

$ prove -l
t/00-compile.t ................ ok
t/000-report-versions-tiny.t .. #
#
# Generated by Dist::Zilla::Plugin::ReportVersions::Tiny v1.08
# perl: 5.016001 &#40;wanted any version&#41; on linux from 
/usr/local/soft/perlbrew/perls/perl-5.16.1/bin/perl
#
# Archive::Tar                                  =&gt; 1.90       &#40;want any 
version&#41;
# Compress::Zlib                                =&gt; 2.048      &#40;want any 
version&#41;
# Dist::Zilla::File::InMemory                   =&gt; 4.300028   &#40;want any 
version&#41;
# Dist::Zilla::Role::FileInjector               =&gt; 4.300028   &#40;want any 
version&#41;
# Dist::Zilla::Role::FileMunger                 =&gt; 4.300028   &#40;want any 
version&#41;
# Dist::Zilla::Role::ShareDir                   =&gt; 4.300028   &#40;want any 
version&#41;
# File::Find                                    =&gt; 1.20       &#40;want any 
version&#41;
# File::Temp                                    =&gt; 0.22       &#40;want any 
version&#41;
# Module::Build                                 =&gt; 0.4003     &#40;want 0.3601&#41;
# Moose                                         =&gt; 2.0604     &#40;want any 
version&#41;
# Test::DZil                                    =&gt; 4.300028   &#40;want any 
version&#41;
# Test::More                                    =&gt; 0.98       &#40;want 0.88&#41;
# strict                                        =&gt; 1.07       &#40;want any 
version&#41;
# version                                       =&gt; 0.9901     &#40;want 0.9901&#41;
# warnings                                      =&gt; 1.13       &#40;want any 
version&#41;
#
# Thanks for using my code.  I hope it works for you.
# If not, please try and include this output in the bug report.
# That will help me reproduce the issue and solve your problem.
#
t/000-report-versions-tiny.t .. ok
t/basic.t ..................... ok
All tests successful.
Files=3, Tests=4,  7 wallclock secs &#40; 0.07 usr  0.00 sys +  2.78 cusr 
0.21 csys =  3.06 CPU&#41;
Result: PASS
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;11&nbsp;20:36:39&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">*giggle*

t\00-compile.t ................
1..1
ok 1 - Dist::Zilla::Plugin::ShareDir::Tarball loaded ok
ok
t\000-report-versions-tiny.t .. #
#
# Generated by Dist::Zilla::Plugin::ReportVersions::Tiny v1.08
# perl: 5.016001 &#40;wanted any version&#41; on MSWin32 from 
C:\strawberry\perl\bin\per
l.exe
#
# Archive::Tar                                  =&gt; 1.88       &#40;want any 
version&#41;

# Compress::Zlib                                =&gt; 2.055      &#40;want any 
version&#41;

# Dist::Zilla::File::InMemory                   =&gt; 4.300030   &#40;want any 
version&#41;

# Dist::Zilla::Role::FileInjector               =&gt; 4.300030   &#40;want any 
version&#41;

# Dist::Zilla::Role::FileMunger                 =&gt; 4.300030   &#40;want any 
version&#41;

# Dist::Zilla::Role::ShareDir                   =&gt; 4.300030   &#40;want any 
version&#41;

# File::Find                                    =&gt; 1.20       &#40;want any 
version&#41;

# File::Temp                                    =&gt; 0.22       &#40;want any 
version&#41;

# Module::Build                                 =&gt; 0.4002     &#40;want 
0.3601&#41;
# Moose                                         =&gt; 2.0603     &#40;want any 
version&#41;

# Test::DZil                                    =&gt; 4.300030   &#40;want any 
version&#41;

# Test::More                                    =&gt; 0.98       &#40;want 
0.88&#41;
# strict                                        =&gt; 1.07       &#40;want any 
version&#41;

# version                                       =&gt; 0.9901     &#40;want 
0.9901&#41;
# warnings                                      =&gt; 1.13       &#40;want any 
version&#41;

#
# Thanks for using my code.  I hope it works for you.
# If not, please try and include this output in the bug report.
# That will help me reproduce the issue and solve your problem.
#

ok 1 - we really didn&#39;t test anything, just reporting data
1..1
ok
t\basic.t .....................
1..2
    1..6
    ok 1 - there is only one file
    ok 2 - and it&#39;s the tarball
    ok 3 - foo present
    ok 4 - bar present
    ok 5 - Makefile.PL present
    ok 6 - Makefile.PL has the sharedir directive
ok 1 - with corpus corpus
    1..6
    ok 1 - there is only one file
    ok 2 - and it&#39;s the tarball
    ok 3 - foo present
    ok 4 - bar present
    ok 5 - Makefile.PL present
    ok 6 - Makefile.PL has the sharedir directive
ok 2 - with corpus corpus-dir
ok
All tests successful.
Files=3, Tests=4, 19 wallclock secs &#40; 0.16 usr +  0.16 sys =  0.31 CPU&#41;
Result: PASS


On Mon Mar 11 20:33:46 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For giggles, what is the output of &#39;prove -l&#39; for you? For me it&#39;s
&gt; 
&gt; $ prove -l
&gt; t/00-compile.t ................ ok
&gt; t/000-report-versions-tiny.t .. #
&gt; #
&gt; # Generated by Dist::Zilla::Plugin::ReportVersions::Tiny v1.08
&gt; # perl: 5.016001 &#40;wanted any version&#41; on linux from 
&gt; /usr/local/soft/perlbrew/perls/perl-5.16.1/bin/perl
&gt; #
&gt; # Archive::Tar                                  =&gt; 1.90       &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Compress::Zlib                                =&gt; 2.048      &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Dist::Zilla::File::InMemory                   =&gt; 4.300028   &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Dist::Zilla::Role::FileInjector               =&gt; 4.300028   &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Dist::Zilla::Role::FileMunger                 =&gt; 4.300028   &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Dist::Zilla::Role::ShareDir                   =&gt; 4.300028   &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # File::Find                                    =&gt; 1.20       &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # File::Temp                                    =&gt; 0.22       &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Module::Build                                 =&gt; 0.4003     &#40;want 
</div>0.3601&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # Moose                                         =&gt; 2.0604     &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Test::DZil                                    =&gt; 4.300028   &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # Test::More                                    =&gt; 0.98       &#40;want 
</div>0.88&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # strict                                        =&gt; 1.07       &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; # version                                       =&gt; 0.9901     &#40;want 
</div>0.9901&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # warnings                                      =&gt; 1.13       &#40;want 
</div>any 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version&#41;
&gt; #
&gt; # Thanks for using my code.  I hope it works for you.
&gt; # If not, please try and include this output in the bug report.
&gt; # That will help me reproduce the issue and solve your problem.
&gt; #
&gt; t/000-report-versions-tiny.t .. ok
&gt; t/basic.t ..................... ok
&gt; All tests successful.
&gt; Files=3, Tests=4,  7 wallclock secs &#40; 0.07 usr  0.00 sys +  2.78 cusr 
&gt; 0.21 csys =  3.06 CPU&#41;
&gt; Result: PASS
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;11&nbsp;21:28:23&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Mar 2013 21:28:05 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
        Oh ye gods, I&#39;m a poodle-brain.

        The shared tarball was always plunked in &#39;share&#39;, but the hash_map 
returned to the main dzil object could be based on $self-&gt;dir &#40;which in 
the case of the example is &#39;abc/xyz&#39;&#41;.

        New patched version at 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball">https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball</a></span>, including 
your specific example as one of the tests. Mind trying out that one? 
Might be the last iteration you have to go through. :-&#41;

Joy,
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;12&nbsp;02:03:06&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Would you mind posting a build? I can&#39;t do &#39;dzil build&#39; because WWW-
Shorten fails on Windows, and I don&#39;t know exactly what part of the 
@Yanick INI setting creates that dependency. I did apply the small 
changes to Tarball.pm, and they work on the example distro I gave you. 
It didn&#39;t work on my actual distro, however. Heh. I&#39;m posting another 
minimal failing example &#40;fails with the newest version of Tarball.pm&#41;.

On Mon Mar 11 21:28:23 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;       Oh ye gods, I&#39;m a poodle-brain.
&gt; 
&gt;       The shared tarball was always plunked in &#39;share&#39;, but the 
</div>hash_map 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; returned to the main dzil object could be based on $self-&gt;dir &#40;which 
</div>in 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the case of the example is &#39;abc/xyz&#39;&#41;.
&gt; 
&gt;       New patched version at 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball">https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball</a></span>, 
</div>including 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; your specific example as one of the tests. Mind trying out that one? 
&gt; Might be the last iteration you have to go through. :-&#41;
&gt; 
&gt; Joy,
&gt; `/anick
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test-DZST-2.zip</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1189987/627748/Test-DZST-2.zip">Download Test-DZST-2.zip</a><br />
<span class="downloadcontenttype">application/octet-stream 2.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;12&nbsp;20:09:34&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Mar 2013 20:09:17 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13-03-12 02:03 AM, Nathan Gary Glenn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Would you mind posting a build?
</div>
        Oh. Right. Here we go: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball/tree/build/master">https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-Tarball/tree/build/master</a></span>

        And it has new changes to address the stuff below --v


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I did apply the small
&gt; changes to Tarball.pm, and they work on the example distro I gave you.
</div>
        WOOHOO!!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It didn&#39;t work on my actual distro, however.
</div>
        AUGH!!!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Heh. I&#39;m posting another
&gt; minimal failing example &#40;fails with the newest version of Tarball.pm&#41;.
</div>
        If nothing else, we&#39;re building a killer collection of test cases. ;-&#41;

        I&#39;ve made that example work. Up to now, DZPSDT was doing its magic in 
the MungeFiles phase of the build. I&#39;m beginning to suspect that this is 
wrong -- MungeFiles expects you to do things to files, but not to pop in 
new ones. Soooo I moved the operations in the earlier GatherFiles stage. 
And it seems to do the trick. Would you be so kind as to checkout the 
build branch, and see if the module will finally have the good grace to 
behave? :-&#41;

Aaaaalmost there,
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;12&nbsp;20:25:55&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Great! It works! I did have to force the install, though, since the 
tests went kablooie &#40;it fails with an error I saw a whole bunch while 
trying to edit the distro&#41;. I&#39;m posting the log.

On Tue Mar 12 20:09:34 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 13-03-12 02:03 AM, Nathan Gary Glenn via RT wrote:
<div class="message-stanza open">&gt; &gt; Would you mind posting a build?
</div>&gt; 
&gt;       Oh. Right. Here we go:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-">https://github.com/yanick/Dist-Zilla-Plugin-ShareDir-</a></span>
&gt; Tarball/tree/build/master
&gt; 
&gt;       And it has new changes to address the stuff below --v
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; I did apply the small
&gt; &gt; changes to Tarball.pm, and they work on the example distro I gave
</div>&gt; you.
&gt; 
&gt;       WOOHOO!!
&gt; 
<div class="message-stanza open">&gt; &gt; It didn&#39;t work on my actual distro, however.
</div>&gt; 
&gt;       AUGH!!!
&gt; 
<div class="message-stanza open">&gt; &gt; Heh. I&#39;m posting another
&gt; &gt; minimal failing example &#40;fails with the newest version of
</div>&gt; Tarball.pm&#41;.
&gt; 
&gt;       If nothing else, we&#39;re building a killer collection of test 
</div>cases. ;-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#41;
&gt; 
&gt;       I&#39;ve made that example work. Up to now, DZPSDT was doing its 
</div>magic in
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the MungeFiles phase of the build. I&#39;m beginning to suspect that this
&gt; is
&gt; wrong -- MungeFiles expects you to do things to files, but not to pop
&gt; in
&gt; new ones. Soooo I moved the operations in the earlier GatherFiles
&gt; stage.
&gt; And it seems to do the trick. Would you be so kind as to checkout the
&gt; build branch, and see if the module will finally have the good grace
&gt; to
&gt; behave? :-&#41;
&gt; 
&gt; Aaaaalmost there,
&gt; `/anick
&gt; 
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> build.log</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1190318/627947/build.log">Download build.log</a><br />
<span class="downloadcontenttype">application/octet-stream 11.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;12&nbsp;20:38:25&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Mar 2013 20:38:06 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13-03-12 08:25 PM, Nathan Gary Glenn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Great! It works!
</div>
        Music to my ears. ^.^

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; I did have to force the install, though, since the
&gt; tests went kablooie &#40;it fails with an error I saw a whole bunch while
&gt; trying to edit the distro&#41;. I&#39;m posting the log.
</div>
        That&#39;s all okay... just clean-up I have to do. I&#39;ll do that, anonymize 
your examples a wee bit, and I&#39;ll punt off a release sometime this week. 
Thanks for your help!

Joy,
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;12&nbsp;21:29:27&nbsp;2013</span>
    <span class="description">NGLENN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you! I feel like I made you rewrite the whole thing. This will all 
be very useful, though!
On Tue Mar 12 20:38:25 2013, yanick@babyl.dyndns.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 13-03-12 08:25 PM, Nathan Gary Glenn via RT wrote:
<div class="message-stanza open">&gt; &gt; Great! It works!
</div>&gt; 
&gt;       Music to my ears. ^.^
&gt; 
<div class="message-stanza open">&gt;  &gt; I did have to force the install, though, since the
</div><div class="message-stanza open">&gt; &gt; tests went kablooie &#40;it fails with an error I saw a whole bunch 
</div></div>while
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; trying to edit the distro&#41;. I&#39;m posting the log.
</div>&gt; 
&gt;       That&#39;s all okay... just clean-up I have to do. I&#39;ll do that, 
</div>anonymize 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; your examples a wee bit, and I&#39;ll punt off a release sometime this 
</div>week. 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for your help!
&gt; 
&gt; Joy,
&gt; `/anick
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;14&nbsp;20:03:19&nbsp;2013</span>
    <span class="description">yanick [...] babyl.dyndns.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83777] documentation/option on tarball output location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Mar 2013 20:03:01 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Dist-Zilla-Plugin-ShareDir-Tarball [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;yanick [...] babyl.dyndns.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13-03-12 09:29 PM, Nathan Gary Glenn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you! I feel like I made you rewrite the whole thing.
</div>
        You made me improve it, and a few dzil gotchas in the process, which 
are both good things.  :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;This will all be very useful, though!
</div>
        Excellent. That, right there, is all that is needed to make it worth 
it. :-&#41;

Enjoy!
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;14&nbsp;21:20:07&nbsp;2013</span>
    <span class="description">yanick+cpan [...] babyl.dyndns.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
