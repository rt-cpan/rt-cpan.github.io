<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43823 for SVN-Notify: ticket_map broken since 2.73</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43823 for SVN-Notify: ticket_map broken since 2.73</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SVN-Notify/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SVN-Notify/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SVN-Notify/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SVN-Notify/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/theory/svn-notify/issues/">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/SVN-Notify">SVN-Notify CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43823</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SVN-Notify/Active/">SVN-Notify</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dirk [...] xanthippe.ping.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-30306-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.73    </td>
  </tr>
  <tr id="CF-30307-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.79    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;03&nbsp;20:01:16&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ticket_map broken since 2.73</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have moved my svn repo to another server and during that move I have
upgraded SVN:Notify from 2.66 to 2.78. Ticket links specified by the
ticket_map stopped working with the new install that did work properly
before. Downgrading to 2.67 &#40;earliest available in CPAN&#41; made the
ticket_map work again.

I use the following map:

--ticket-map &#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s&#39;

and the input 

Mantis-161: foo bar baz

fails to generate a valid ticket. I played around with the regex quite a
bit but couldn&#39;t make it work with 2.78 regardless of the regex I specified.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;03&nbsp;20:28:40&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 3 Mar 2009 17:27:55 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A lot has changed since 2.67. What&#39;s the latest version that still  
works for you?

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;03&nbsp;20:28:40&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;03&nbsp;20:56:43&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 04 Mar 2009 02:50:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43823">https://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; A lot has changed since 2.67. What&#39;s the latest version that still  
&gt; works for you?
</div>
Ah, sorry I forgot to mention that: 2.67 is the latest version that
works for me. I updated to 2.73 and that breaks the ticket_map so I&#39;m
back to 2.67 for the moment.

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;03&nbsp;21:48:35&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 3 Mar 2009 18:40:35 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 3, 2009, at 5:56 PM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ah, sorry I forgot to mention that: 2.67 is the latest version that
&gt; works for me. I updated to 2.73 and that breaks the ticket_map so I&#39;m
&gt; back to 2.67 for the moment.
</div>
I just checked in a test for this and is passes. Can you check it out  
from SVN and make sure all the tests pass for you?

   svn co <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.kineticode.com/SVN-Notify/trunk">https://svn.kineticode.com/SVN-Notify/trunk</a></span> SVN-Notify
   cd SVN-Notify
   perl Build.PL
   ./Build test

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;21:55:33&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 05 Mar 2009 03:52:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43823">https://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; On Mar 3, 2009, at 5:56 PM, Dirk Olmes via RT wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; Ah, sorry I forgot to mention that: 2.67 is the latest version that
&gt;&gt; works for me. I updated to 2.73 and that breaks the ticket_map so I&#39;m
&gt;&gt; back to 2.67 for the moment.
</div>&gt; 
&gt; I just checked in a test for this and is passes. Can you check it out  
&gt; from SVN and make sure all the tests pass for you?
&gt; 
&gt;    svn co <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.kineticode.com/SVN-Notify/trunk">https://svn.kineticode.com/SVN-Notify/trunk</a></span> SVN-Notify
&gt;    cd SVN-Notify
&gt;    perl Build.PL
&gt;    ./Build test
</div>
Strange, that works for me. So where&#39;s the difference between my usage
and the test? I tried to have a look at t/base.t but have to admit that
I don&#39;t know enough about Perl&#39;s tests to make sense of it :-&#40;

Here&#39;s the complete commandline I use in my svn hook, maybe that helps
to isolate the bug:

/usr/bin/svnnotify --repos-path $REPOS --revision $REV \
    --to $SVNMAIL_RECIPIENTS --from $SVNMAIL_SENDER \
    --smtp $MAILHOST --no-first-line --subject-cx \
    --subject-prefix &#34;[SVN] &#34; \
    --add-header X-SVN-Repository=$REPOS \
    --ticket-map
&#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s&#39; \
    --revision-url &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://server/sventon/revinfo.svn?name=RPI&#38;revision=">http://server/sventon/revinfo.svn?name=RPI&#38;revision=</a></span>%s&#39;

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;22:10:02&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 4 Mar 2009 19:09:46 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 4, 2009, at 6:55 PM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s the complete commandline I use in my svn hook, maybe that helps
&gt; to isolate the bug:
&gt;
&gt; /usr/bin/svnnotify --repos-path $REPOS --revision $REV \
&gt;    --to $SVNMAIL_RECIPIENTS --from $SVNMAIL_SENDER \
&gt;    --smtp $MAILHOST --no-first-line --subject-cx \
&gt;    --subject-prefix &#34;[SVN] &#34; \
&gt;    --add-header X-SVN-Repository=$REPOS \
&gt;    --ticket-map
&gt; &#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s&#39; \
&gt;    --revision-url &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://server/sventon/revinfo.svn?name=RPI&#38;revision=">http://server/sventon/revinfo.svn?name=RPI&#38;revision=</a></span> 
&gt; %s&#39;
&gt;
&gt; -dirk
</div>
I wrote a simple shell script:

     #!/bin/sh
     echo $@;

Then I ran it like this:

     % try.sh &#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span> 
%s&#39;

It&#39;s output:

[Mm]antis-&#40;\d+=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s

So I think you need to escape some stuff. Try this:

% try.sh &#39;\\b[Mm]antis-&#40;\d+&#41;&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s&#39;
\b[Mm]antis-&#40;\d+&#41;=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s

I have no idea why some backslashed need escaping and some not, or why  
one &#41; disappears, but there you go. I suggest that you do some  
experimentation with the argument until it comes out right.

That&#39;s the only thing I can think of. :-&#40;

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;22:35:37&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 05 Mar 2009 04:34:58 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=43823">http://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; On Mar 4, 2009, at 6:55 PM, Dirk Olmes via RT wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; Here&#39;s the complete commandline I use in my svn hook, maybe that helps
&gt;&gt; to isolate the bug:
&gt;&gt;
&gt;&gt; /usr/bin/svnnotify --repos-path $REPOS --revision $REV \
&gt;&gt;    --to $SVNMAIL_RECIPIENTS --from $SVNMAIL_SENDER \
&gt;&gt;    --smtp $MAILHOST --no-first-line --subject-cx \
&gt;&gt;    --subject-prefix &#34;[SVN] &#34; \
&gt;&gt;    --add-header X-SVN-Repository=$REPOS \
&gt;&gt;    --ticket-map
&gt;&gt; &#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s&#39; \
&gt;&gt;    --revision-url &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://server/sventon/revinfo.svn?name=RPI&#38;revision=">http://server/sventon/revinfo.svn?name=RPI&#38;revision=</a></span> 
&gt;&gt; %s&#39;
&gt;&gt;
&gt;&gt; -dirk
</div>&gt; 
&gt; I wrote a simple shell script:
&gt; 
&gt;      #!/bin/sh
&gt;      echo $@;
&gt; 
&gt; Then I ran it like this:
&gt; 
&gt;      % try.sh &#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span> 
&gt; %s&#39;
&gt; 
&gt; It&#39;s output:
&gt; 
&gt; [Mm]antis-&#40;\d+=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s
&gt; 
&gt; So I think you need to escape some stuff. Try this:
&gt; 
&gt; % try.sh &#39;\\b[Mm]antis-&#40;\d+&#41;&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s&#39;
&gt; \b[Mm]antis-&#40;\d+&#41;=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span>%s
&gt; 
&gt; I have no idea why some backslashed need escaping and some not, or why  
&gt; one &#41; disappears, but there you go. I suggest that you do some  
&gt; experimentation with the argument until it comes out right.
</div>
I played around with shell escaping a bit, too now but that doesn&#39;t seem
to be the culprit: I copied the post-commit shell script to a different
location and tried both single quotes &#40;&#39;&#41; or double quotes &#40;&#34;&#41; but
either the ticket map is passed into svnnotify in a wrong format, then I
don&#39;t get any TicketLink output in my notify mail or, if the format is
passed correctly into svnnotify, then I get the following:

[...]
Log Message:
-----------
mantis-176: Neuer Lizenztyp: Gastlizenz

Ticket Links:
:-----------
2
Modified Paths:
--------------
[...]

I&#39;m convinced that the shell escaping is not causing this bug as
everything works OK with the older version ...

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;22:38:08&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 4 Mar 2009 19:37:53 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 4, 2009, at 7:35 PM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m convinced that the shell escaping is not causing this bug as
&gt; everything works OK with the older version ...
</div>
Okay, thanks for being persistent.

Try applying this patch and see what SVN::Notify thinks the regex is:

Index: Notify.pm
===================================================================
--- Notify.pm   &#40;revision 4332&#41;
+++ Notify.pm   &#40;working copy&#41;
@@ -1593,6 +1593,7 @@
          my $has_header = 0;
          $self-&gt;run_ticket_map&#40; sub {
              my &#40;$regex, $url&#41; = @_;
+            print STDERR &#34;Regex: &#39;$regex&#39;\n&#34;;
              while &#40;$msg =~ /$regex/ig&#41; {
                  unless &#40;$has_header&#41; {
                      print $out &#34;\nTicket Links:\n:-----------\n&#34;;

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;03:13:22&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 05 Mar 2009 08:55:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43823">https://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; On Mar 4, 2009, at 7:35 PM, Dirk Olmes via RT wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; I&#39;m convinced that the shell escaping is not causing this bug as
&gt;&gt; everything works OK with the older version ...
</div>&gt; 
&gt; Okay, thanks for being persistent.
</div>
Thanks for being patient with me :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Try applying this patch and see what SVN::Notify thinks the regex is:
&gt; 
&gt; Index: Notify.pm
&gt; ===================================================================
&gt; --- Notify.pm &#40;revision 4332&#41;
&gt; +++ Notify.pm &#40;working copy&#41;
&gt; @@ -1593,6 +1593,7 @@
&gt;           my $has_header = 0;
&gt;           $self-&gt;run_ticket_map&#40; sub {
&gt;               my &#40;$regex, $url&#41; = @_;
&gt; +            print STDERR &#34;Regex: &#39;$regex&#39;\n&#34;;
&gt;               while &#40;$msg =~ /$regex/ig&#41; {
&gt;                   unless &#40;$has_header&#41; {
&gt;                       print $out &#34;\nTicket Links:\n:-----------\n&#34;;
</div>
Ok, the regex output is:

Regex: &#39;\b[Mm]antis-&#40;\d+&#41;\b&#39;

and the resulting mail is:

Log Message:
-----------
mantis-176: Neuer Lizenztyp: Gastlizenz

Ticket Links:
:-----------
2
Modified Paths:
--------------

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;12:43:48&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Mar 2009 07:47:41 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 5, 2009, at 12:13 AM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ok, the regex output is:
&gt;
&gt; Regex: &#39;\b[Mm]antis-&#40;\d+&#41;\b&#39;
&gt;
&gt; and the resulting mail is:
&gt;
&gt; Log Message:
&gt; -----------
&gt; mantis-176: Neuer Lizenztyp: Gastlizenz
&gt;
&gt; Ticket Links:
&gt; :-----------
&gt; 2
&gt; Modified Paths:
&gt; --------------
</div>
Is that correct?

D
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;19:25:25&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 06 Mar 2009 01:24:23 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43823">https://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; On Mar 5, 2009, at 12:13 AM, Dirk Olmes via RT wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; Ok, the regex output is:
&gt;&gt;
&gt;&gt; Regex: &#39;\b[Mm]antis-&#40;\d+&#41;\b&#39;
&gt;&gt;
&gt;&gt; and the resulting mail is:
&gt;&gt;
&gt;&gt; Log Message:
&gt;&gt; -----------
&gt;&gt; mantis-176: Neuer Lizenztyp: Gastlizenz
&gt;&gt;
&gt;&gt; Ticket Links:
&gt;&gt; :-----------
&gt;&gt; 2
&gt;&gt; Modified Paths:
&gt;&gt; --------------
</div>&gt; 
&gt; Is that correct?
</div>
Sorry, what do you mean? Is the regex wrong? I just changed it to
&#39;.*[Mm]antis-&#40;\d+&#41;.*&#39; but that doesn&#39;t produce a ticket link either.

Using 2.67, I get the following output:

Log Message:
-----------
mantis-176: Neuer Lizenztyp: Gastlizenz

Ticket Links:
:-----------
    <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=176">http://quad64/mantisbt/view.php?id=176</a></span>

Modified Paths:
--------------

Even then, the leading colon below the &#34;Ticket Links:&#34; caption doesn&#39;t
look correct to me.

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;13:20:46&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Mar 2009 10:19:39 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 5, 2009, at 4:25 PM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry, what do you mean? Is the regex wrong? I just changed it to
&gt; &#39;.*[Mm]antis-&#40;\d+&#41;.*&#39; but that doesn&#39;t produce a ticket link either.
&gt;
&gt; Using 2.67, I get the following output:
&gt;
&gt; Log Message:
&gt; -----------
&gt; mantis-176: Neuer Lizenztyp: Gastlizenz
&gt;
&gt; Ticket Links:
&gt; :-----------
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=176">http://quad64/mantisbt/view.php?id=176</a></span>
&gt;
&gt; Modified Paths:
&gt; --------------
&gt;
&gt; Even then, the leading colon below the &#34;Ticket Links:&#34; caption doesn&#39;t
&gt; look correct to me.
</div>
That at least is easy to fix; done in r4596.

As for the other, I still can&#39;t replicate it. :-&#40; To test it, I  
created this simple script:

#!/usr/local/bin/perl -w

use strict;
use warnings;
use feature &#39;:5.10&#39;;

print qq{theory
2004-04-20 01:33:35 -0700 &#40;Tue, 20 Apr 2004&#41;
103
mantis-176: Neuer Lizenztyp: Gastlizenz
};

Then I put some debugging in SVN::Notify:

Index: Notify.pm
===================================================================
--- Notify.pm   &#40;revision 4596&#41;
+++ Notify.pm   &#40;working copy&#41;
@@ -1593,11 +1593,13 @@
          my $has_header = 0;
          $self-&gt;run_ticket_map&#40; sub {
              my &#40;$regex, $url&#41; = @_;
+            print STDERR $regex, $/;
              while &#40;$msg =~ /$regex/ig&#41; {
                  unless &#40;$has_header&#41; {
                      print $out &#34;\nTicket Links:\n------------\n&#34;;
                      $has_header = 1;
                  }
+                printf STDERR &#34;    $url\n&#34;,  $2 || $1;
                  printf $out &#34;    $url\n&#34;,  $2 || $1;
              }
          } &#41;;


Then I ran it like so:

% perl -Ilib ./bin/svnnotify -p /usr/local/bricolage -r 2 -l ~/bin/try  
--ticket-map &#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span> 
%s&#39; --to david@kineticode.com
\b[Mm]antis-&#40;\d+&#41;\b
     <span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=176">http://server/mantisbt/view.php?id=176</a></span>

You can see there how it output the link, yes? I got the same result  
with Perl 5.8.8.

The only other thing I can think of is if there is some sort of  
encoding issue that&#39;s causing problems. Is that log message all ASCII  
characters? Has something perhaps been stripped out in our exchanges?

Otherwise, I&#39;m at a loss. :-&#40;

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;10&nbsp;13:55:59&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Mar 2009 18:54:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;
&gt;&gt; Even then, the leading colon below the &#34;Ticket Links:&#34; caption doesn&#39;t
&gt;&gt; look correct to me.
</div>&gt; 
&gt; That at least is easy to fix; done in r4596.
</div>
Thanks :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for the other, I still can&#39;t replicate it. :-&#40; To test it, I  
&gt; created this simple script:
&gt; 
&gt; #!/usr/local/bin/perl -w
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; use feature &#39;:5.10&#39;;
&gt; 
&gt; print qq{theory
&gt; 2004-04-20 01:33:35 -0700 &#40;Tue, 20 Apr 2004&#41;
&gt; 103
&gt; mantis-176: Neuer Lizenztyp: Gastlizenz
&gt; };
&gt; 
&gt; Then I put some debugging in SVN::Notify:
&gt; 
&gt; Index: Notify.pm
&gt; ===================================================================
&gt; --- Notify.pm &#40;revision 4596&#41;
&gt; +++ Notify.pm &#40;working copy&#41;
&gt; @@ -1593,11 +1593,13 @@
&gt;           my $has_header = 0;
&gt;           $self-&gt;run_ticket_map&#40; sub {
&gt;               my &#40;$regex, $url&#41; = @_;
&gt; +            print STDERR $regex, $/;
&gt;               while &#40;$msg =~ /$regex/ig&#41; {
&gt;                   unless &#40;$has_header&#41; {
&gt;                       print $out &#34;\nTicket Links:\n------------\n&#34;;
&gt;                       $has_header = 1;
&gt;                   }
&gt; +                printf STDERR &#34;    $url\n&#34;,  $2 || $1;
&gt;                   printf $out &#34;    $url\n&#34;,  $2 || $1;
&gt;               }
&gt;           } &#41;;
&gt; 
&gt; 
&gt; Then I ran it like so:
&gt; 
&gt; % perl -Ilib ./bin/svnnotify -p /usr/local/bricolage -r 2 -l ~/bin/try  
&gt; --ticket-map &#39;\b[Mm]antis-&#40;\d+&#41;\b=<span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=">http://server/mantisbt/view.php?id=</a></span> 
&gt; %s&#39; --to david@kineticode.com
&gt; \b[Mm]antis-&#40;\d+&#41;\b
&gt;      <span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=176">http://server/mantisbt/view.php?id=176</a></span>
&gt; 
&gt; You can see there how it output the link, yes? I got the same result  
&gt; with Perl 5.8.8.
</div>
Hmm, I had no success running the command since i miss ~/bin/try and I
don&#39;t have /usr/local/bricolage on that machine either.

I *can* verify that if I run the patched SVN:Notify I get the same
output as you above:

\b[Mm]antis-&#40;\d+&#41;\b
    <span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=176">http://server/mantisbt/view.php?id=176</a></span>

Still, the email that I receive doesn&#39;t contain the link. Oh, and I can
verify that I run perl 5.8.8 on that machine, too. It&#39;s a 64 bit machine
with a 64bit Linux if that matters ...

I tried sniffing the traffic to the mailserver and I can confirm that
the link is not in the eMail that goes out to the SMTP server.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The only other thing I can think of is if there is some sort of  
&gt; encoding issue that&#39;s causing problems. Is that log message all ASCII  
&gt; characters? Has something perhaps been stripped out in our exchanges?
</div>
I don&#39;t think so .. The commit message is exactly what I have sent to
you and it doesn&#39;t contain any special characters.

Thanks for putting your energy into debugging this one with me :-&#41;

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;10&nbsp;14:19:21&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Mar 2009 11:11:14 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 10, 2009, at 10:56 AM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm, I had no success running the command since i miss ~/bin/try and I
&gt; don&#39;t have /usr/local/bricolage on that machine either.
</div>
Sorry, ~/bin/try was the script I pasted in, and /usr/local/bricolage  
was just a directory I pointed at to keep SVN::Notify from bitching  
about not having an SVN root.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I *can* verify that if I run the patched SVN:Notify I get the same
&gt; output as you above:
&gt;
&gt; \b[Mm]antis-&#40;\d+&#41;\b
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=176">http://server/mantisbt/view.php?id=176</a></span>
&gt;
&gt; Still, the email that I receive doesn&#39;t contain the link.
</div>
Interesting. Wait, you get the number 2 instead of a link in the  
message? I see this in an earlier email from you:

Ticket Links:
:-----------
2

WTF is that 2 doing there? Something is funky with the printf to $out  
there.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, and I can
&gt; verify that I run perl 5.8.8 on that machine, too. It&#39;s a 64 bit  
&gt; machine
&gt; with a 64bit Linux if that matters ...
</div>
Is it a vendor build, or did you compile it yourself?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t think so .. The commit message is exactly what I have sent to
&gt; you and it doesn&#39;t contain any special characters.
</div>
Okay, strike that idea, then.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;16:36:15&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Mar 2009 21:33:21 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I *can* verify that if I run the patched SVN:Notify I get the same
&gt;&gt; output as you above:
&gt;&gt;
&gt;&gt; \b[Mm]antis-&#40;\d+&#41;\b
&gt;&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="http://server/mantisbt/view.php?id=176">http://server/mantisbt/view.php?id=176</a></span>
&gt;&gt;
&gt;&gt; Still, the email that I receive doesn&#39;t contain the link.
</div>&gt; 
&gt; Interesting. Wait, you get the number 2 instead of a link in the  
&gt; message? I see this in an earlier email from you:
&gt; 
&gt; Ticket Links:
&gt; :-----------
&gt; 2
&gt; 
&gt; WTF is that 2 doing there? Something is funky with the printf to $out  
&gt; there.
</div>
Must be ... that&#39;s in the emails as well.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Oh, and I can
&gt;&gt; verify that I run perl 5.8.8 on that machine, too. It&#39;s a 64 bit  
&gt;&gt; machine
&gt;&gt; with a 64bit Linux if that matters ...
</div>&gt; 
&gt; Is it a vendor build, or did you compile it yourself?
</div>
Both :-&#41; I&#39;m on gentoo linux which is a source-based distro i.e. the
packages get compiled on the machine for installation. I&#39;m not in the
office right now but I can follow up with config details on the perl
installation if you think they provide additional info for debugging.

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;16:41:31&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Mar 2009 13:40:33 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 11, 2009, at 1:36 PM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; WTF is that 2 doing there? Something is funky with the printf to $out
&gt;&gt; there.
</div>&gt;
&gt; Must be ... that&#39;s in the emails as well.
&gt;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Oh, and I can
&gt;&gt;&gt; verify that I run perl 5.8.8 on that machine, too. It&#39;s a 64 bit
&gt;&gt;&gt; machine
&gt;&gt;&gt; with a 64bit Linux if that matters ...
</div>&gt;&gt;
&gt;&gt; Is it a vendor build, or did you compile it yourself?
</div>&gt;
&gt; Both :-&#41; I&#39;m on gentoo linux which is a source-based distro i.e. the
&gt; packages get compiled on the machine for installation. I&#39;m not in the
&gt; office right now but I can follow up with config details on the perl
&gt; installation if you think they provide additional info for debugging.
</div>
You&#39;re going to have to do some debugging by putting `print STDERR`  
statements here and there to see if you can figure out WTF is going  
on. I&#39;m out of ideas, I&#39;m afraid, though I *would* suggest trying to  
compile your own Perl rather than rely on Gentoo&#39;s compile, which  
likely applies patches that break Perl.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;17&nbsp;23:35:36&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 18 Mar 2009 04:36:14 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=43823">http://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; On Mar 11, 2009, at 1:36 PM, Dirk Olmes via RT wrote:
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; WTF is that 2 doing there? Something is funky with the printf to $out
&gt;&gt;&gt; there.
</div>&gt;&gt; Must be ... that&#39;s in the emails as well.
&gt;&gt;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; Oh, and I can
&gt;&gt;&gt;&gt; verify that I run perl 5.8.8 on that machine, too. It&#39;s a 64 bit
&gt;&gt;&gt;&gt; machine
&gt;&gt;&gt;&gt; with a 64bit Linux if that matters ...
</div>&gt;&gt;&gt; Is it a vendor build, or did you compile it yourself?
</div>&gt;&gt; Both :-&#41; I&#39;m on gentoo linux which is a source-based distro i.e. the
&gt;&gt; packages get compiled on the machine for installation. I&#39;m not in the
&gt;&gt; office right now but I can follow up with config details on the perl
&gt;&gt; installation if you think they provide additional info for debugging.
</div>&gt; 
&gt; You&#39;re going to have to do some debugging by putting `print STDERR`  
&gt; statements here and there to see if you can figure out WTF is going  
&gt; on. 
</div>
I finally found some time to do some printf debugging. Warning in
advance: I seriously used perl about 10 years ago so I might be doing
dumb things here ...

I started to search around line 1593 in Notify.pm which was the place
where we put the print STDERR to see if we get the correct url output.
Since we see the correct ouptut on STDERR but not on the mail I dug down
 into SVN::Notify::SMTP to see what arrives in the PRINTF function there
&#40;that&#39;s in line 2417ff&#41;. If I understand the construct

shift-&gt;PRINT&#40; sprintf @_ &#41;

correctly, that&#39;s supposed to run sprintf on the incoming array which
should contain two args, namely the url and the parsed bug number.
Inspecting @_ I found that it actually contains three elements:

element: SVN::Notify::SMTP=HASH&#40;0xb87110&#41;
element:     <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=">http://quad64/mantisbt/view.php?id=</a></span>%s

element: 176

&#40;note the element: prefix is debugging output from me&#41;.

Could this be the culprit? If I do something like

my $result = sprintf $_[1], $_[2];

and send that down the stream, the URL arrives in the mail correctly.

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;18&nbsp;00:17:08&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Mar 2009 21:16:18 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 17, 2009, at 8:35 PM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  If I understand the construct
&gt;
&gt; shift-&gt;PRINT&#40; sprintf @_ &#41;
&gt;
&gt; correctly, that&#39;s supposed to run sprintf on the incoming array which
&gt; should contain two args, namely the url and the parsed bug number.
&gt; Inspecting @_ I found that it actually contains three elements:
&gt;
&gt; element: SVN::Notify::SMTP=HASH&#40;0xb87110&#41;
&gt; element:     <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=">http://quad64/mantisbt/view.php?id=</a></span>%s
&gt;
&gt; element: 176
&gt;
&gt; &#40;note the element: prefix is debugging output from me&#41;.
&gt;
&gt; Could this be the culprit? If I do something like
&gt;
&gt; my $result = sprintf $_[1], $_[2];
&gt;
&gt; and send that down the stream, the URL arrives in the mail correctly.
</div>
Yep, that&#39;s the culprit. Bizarre that the object isn&#39;t shifted off by  
the `shift` before sprintf does its thing. I&#39;m going to change it to:

sub PRINTF {
     my $self = shift;
     $self-&gt;PRINT&#40; sprintf&#40;@_&#41; &#41;;
}

And that should do the trick.

Nice debugging; thanks!

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;04:35:27&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 18 Mar 2009 08:27:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; correctly, that&#39;s supposed to run sprintf on the incoming array which
&gt;&gt; should contain two args, namely the url and the parsed bug number.
&gt;&gt; Inspecting @_ I found that it actually contains three elements:
&gt;&gt;
&gt;&gt; element: SVN::Notify::SMTP=HASH&#40;0xb87110&#41;
&gt;&gt; element:     <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=">http://quad64/mantisbt/view.php?id=</a></span>%s
&gt;&gt;
&gt;&gt; element: 176
&gt;&gt;
&gt;&gt; &#40;note the element: prefix is debugging output from me&#41;.
&gt;&gt;
&gt;&gt; Could this be the culprit? If I do something like
&gt;&gt;
&gt;&gt; my $result = sprintf $_[1], $_[2];
&gt;&gt;
&gt;&gt; and send that down the stream, the URL arrives in the mail correctly.
</div>&gt; 
&gt; Yep, that&#39;s the culprit. Bizarre that the object isn&#39;t shifted off by  
&gt; the `shift` before sprintf does its thing. I&#39;m going to change it to:
&gt; 
&gt; sub PRINTF {
&gt;      my $self = shift;
&gt;      $self-&gt;PRINT&#40; sprintf&#40;@_&#41; &#41;;
&gt; }
&gt; 
&gt; And that should do the trick.
</div>
Hmm, I tried your fix and it doesn&#39;t work :-&#40; I printed $self as well as
@_ after the shift and everything looks ok:

self: SVN::Notify::SMTP=HASH&#40;0xb867d0&#41;
rest:     <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=">http://quad64/mantisbt/view.php?id=</a></span>%s
176

But the mail still does not contain a valid link :-&#40;

I suspect it&#39;s the sprintf here because if I STDERR an sprintf&#40;@_&#41; after
the shift I get the same wrong output as in the mail. If I take out the
two individual elements &#40;$_[0] and $_[1]&#41; then the sprintf produces the
correct link. Strange ...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Nice debugging; thanks!
</div>
Thanks for the heads up :-&#41;

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;09:55:31&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2009 14:51:49 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;  If I understand the construct
&gt;&gt;
&gt;&gt; shift-&gt;PRINT&#40; sprintf @_ &#41;
&gt;&gt;
&gt;&gt; correctly, that&#39;s supposed to run sprintf on the incoming array which
&gt;&gt; should contain two args, namely the url and the parsed bug number.
&gt;&gt; Inspecting @_ I found that it actually contains three elements:
&gt;&gt;
&gt;&gt; element: SVN::Notify::SMTP=HASH&#40;0xb87110&#41;
&gt;&gt; element:     <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=">http://quad64/mantisbt/view.php?id=</a></span>%s
&gt;&gt;
&gt;&gt; element: 176
&gt;&gt;
&gt;&gt; &#40;note the element: prefix is debugging output from me&#41;.
&gt;&gt;
&gt;&gt; Could this be the culprit? If I do something like
&gt;&gt;
&gt;&gt; my $result = sprintf $_[1], $_[2];
&gt;&gt;
&gt;&gt; and send that down the stream, the URL arrives in the mail correctly.
</div>&gt; 
&gt; Yep, that&#39;s the culprit. Bizarre that the object isn&#39;t shifted off by  
&gt; the `shift` before sprintf does its thing. I&#39;m going to change it to:
&gt; 
&gt; sub PRINTF {
&gt;      my $self = shift;
&gt;      $self-&gt;PRINT&#40; sprintf&#40;@_&#41; &#41;;
&gt; }
&gt; 
&gt; And that should do the trick.
</div>
David, what about getting around the whole PRINTF magic and doing

print $out &#34;    &#34;, sprintf &#40;$url,  $2 || $1&#41;, &#34;\n&#34;;

in Notify.pm around line 1593? This works fine for me.

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;12:37:38&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2009 09:37:22 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 19, 2009, at 1:35 AM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm, I tried your fix and it doesn&#39;t work :-&#40; I printed $self as  
&gt; well as
&gt; @_ after the shift and everything looks ok:
&gt;
&gt; self: SVN::Notify::SMTP=HASH&#40;0xb867d0&#41;
&gt; rest:     <span class="clickylink"><a target="new" rel="nofollow" href="http://quad64/mantisbt/view.php?id=">http://quad64/mantisbt/view.php?id=</a></span>%s
&gt; 176
&gt;
&gt; But the mail still does not contain a valid link :-&#40;
&gt;
&gt; I suspect it&#39;s the sprintf here because if I STDERR an sprintf&#40;@_&#41;  
&gt; after
&gt; the shift I get the same wrong output as in the mail. If I take out  
&gt; the
&gt; two individual elements &#40;$_[0] and $_[1]&#41; then the sprintf produces  
&gt; the
&gt; correct link. Strange ...
</div>
Yes, it&#39;s because of the signature for printf: It wants a scalar  
followed by a list, not just a list. So this should work:

sub PRINTF {
     my $self = shift;
     $self-&gt;PRINT&#40; sprintf&#40;shift, @_&#41; &#41;;
}

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;12:55:17&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2009 09:54:53 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 19, 2009, at 6:55 AM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; And that should do the trick.
</div>&gt;
&gt; David, what about getting around the whole PRINTF magic and doing
&gt;
&gt; print $out &#34;    &#34;, sprintf &#40;$url,  $2 || $1&#41;, &#34;\n&#34;;
&gt;
&gt; in Notify.pm around line 1593? This works fine for me.
</div>
I&#39;ve now replicated the issue in a test, and made it pass with what I  
sent a few minutes ago. So I think we&#39;re finally good to go!

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;13:35:29&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2009 18:25:18 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=43823">http://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; On Mar 19, 2009, at 6:55 AM, Dirk Olmes via RT wrote:
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; And that should do the trick.
</div>&gt;&gt; David, what about getting around the whole PRINTF magic and doing
&gt;&gt;
&gt;&gt; print $out &#34;    &#34;, sprintf &#40;$url,  $2 || $1&#41;, &#34;\n&#34;;
&gt;&gt;
&gt;&gt; in Notify.pm around line 1593? This works fine for me.
</div>&gt; 
&gt; I&#39;ve now replicated the issue in a test, and made it pass with what I  
&gt; sent a few minutes ago. So I think we&#39;re finally good to go!
</div>
Yep, I just manually tested your proposed fix and that works for me, too.

Thanks for your help!

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;31&nbsp;23:05:30&nbsp;2009</span>
    <span class="description">dirk [...] xanthippe.ping.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Apr 2009 04:57:14 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dirk Olmes &lt;dirk [...] xanthippe.ping.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=43823">http://rt.cpan.org/Ticket/Display.html?id=43823</a></span> &gt;
&gt; 
&gt; On Mar 19, 2009, at 6:55 AM, Dirk Olmes via RT wrote:
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; And that should do the trick.
</div>&gt;&gt; David, what about getting around the whole PRINTF magic and doing
&gt;&gt;
&gt;&gt; print $out &#34;    &#34;, sprintf &#40;$url,  $2 || $1&#41;, &#34;\n&#34;;
&gt;&gt;
&gt;&gt; in Notify.pm around line 1593? This works fine for me.
</div>&gt; 
&gt; I&#39;ve now replicated the issue in a test, and made it pass with what I  
&gt; sent a few minutes ago. So I think we&#39;re finally good to go!
</div>
David, does this fix warrant a new release? I&#39;d like to update my
production server using this bugfix.

-dirk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;13:32:17&nbsp;2009</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43823] ticket_map broken since 2.73</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Apr 2009 10:31:52 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mar 31, 2009, at 8:05 PM, Dirk Olmes via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I&#39;ve now replicated the issue in a test, and made it pass with what I
&gt;&gt; sent a few minutes ago. So I think we&#39;re finally good to go!
</div>&gt;
&gt; David, does this fix warrant a new release? I&#39;d like to update my
&gt; production server using this bugfix.
</div>
Yeah, I&#39;ll package one up today.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;22:05:44&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;22:05:50&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Fixed in 2.79 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
