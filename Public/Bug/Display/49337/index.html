<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #49337 for Finance-Quote: france and bourso quotation as well as currency exchange rates</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #49337 for Finance-Quote: france and bourso quotation as well as currency exchange rates</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Finance-Quote/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Finance-Quote">Finance-Quote CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">49337</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">10 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Finance-Quote/Active/">Finance-Quote</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">eco [...] ecocode.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
piggymarketsqueak [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-13576-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.16    </td>
  </tr>
  <tr id="CF-13577-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




bourso.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/687016/353616/bourso.patch">
Sun Nov 08 17:40:38 2009 (2.6k) by laurent.wozniak [...] gmail.com
</a>
</font></li>
</ul>


bourso.raw.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/686968/353574/bourso.raw.patch">
Sun Nov 08 15:41:16 2009 (2.6k) by laurent.wozniak [...] gmail.com
</a>
</font></li>
</ul>


bourso.v2.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/713642/368350/bourso.v2.patch">
Thu Dec 31 13:14:09 2009 (2.6k) by laurent.wozniak [...] gmail.com
</a>
</font></li>
</ul>


gnucash-financequote.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/657809/337194/gnucash-financequote.png">
Tue Sep 01 12:43:08 2009 (143k) by piggymarketsqueak [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;01&nbsp;12:43:08&nbsp;2009</span>
    <span class="description">piggymarketsqueak [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> france and bourso quotation as well as currency exchange rates</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, 
I am using Gnucash for a while which is based on Finance::Quote 1.16 for
updating currency exchange rates as well as stock and share quotations.
I am updating my quotations using the &#34;france&#34; option providing in
gnucash which I believe is based on Finance::Quote::Bourso.
Recently updating the exchange rates from GBP to EUR started to fell.
Now stocks and share quotation are felling as well.
this happen when you have Fund set up with source quote information set
to &#34;Unknown , france&#34;, you multiple currencies account and you go in the
menu Tools -&gt; Price Editor and click GetQuotes.
You will then receive an error message as in the file attached.
That unfortunatly the only error  message available at the moment.


Could any one point me out were to look out to fix these problem and/or
if there is any fix in progress?
I am not very familiar with perl but I may be able to help.

Disrtibution name : ubuntu 8.10
perl -v : This is perl, v5.8.8 built for i486-linux-gnu-thread-multi
uname -a : Linux guil2000 2.6.24.3-custom #3 Sun Dec 14 15:27:48 GMT
2008 i686 GNU/Linux



Guillaume.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> gnucash-financequote.png</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/657809/337194/gnucash-financequote.png">Download gnucash-financequote.png</a><br />
<span class="downloadcontenttype">image/png 143k</span>
</div>
<div class="messagebody">
<img alt="gnucash-financequote.png" title="gnucash-financequote.png" src="/Ticket/Attachment/657809/337194/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;08&nbsp;15:41:16&nbsp;2009</span>
    <span class="description">laurent.wozniak [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I had the same problem.
I modified the &#34;bourso&#34; plugin to make it work.

In &#34;bourso&#34;, the problem was with delayed OPCVM.
It uses a different html page so the regular stock parser don&#39;t work
with it.

I&#39;m still trying to find a documentation on how to submit a patch to
this project.
I probably won&#39;t have the time to create a regular patch today.
So here is the raw patch &#40;diff -u&#41;.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Bourso.ori.pm	2009-10-05 19:39:57.000000000 +0200
+++ Bourso.vN.pm	2009-11-08 20:55:22.000000000 +0100
@@ -121,7 +121,7 @@
 		};
 
 		my $symbol = $symbolline[0]-&gt;as_text;
-		&#40;$symbol&#41; = &#40;$symbol=~m/&#40;\w+&#41;-/&#41;;
+		&#40;$symbol&#41; = &#40;$symbol=~m/&#40;\w+&#41; ?-/&#41;;
 		$info{$stocks,&#34;symbol&#34;}=$symbol;
 
 		# retrieve NAME
@@ -139,31 +139,70 @@
         # set method
         $info{$stocks,&#34;method&#34;} = &#34;bourso&#34; ;
 
+		#holds table data
+		my %tempinfo;
+
 		# retrieve other data
 		my $infoclass = &#40;$tree-&gt;look_down&#40;&#39;class&#39;,&#39;info1&#39;&#41;&#41;[0];
 		unless &#40;$infoclass&#41; {
-		  $info {$stocks,&#34;success&#34;} = 0;
-		  $info {$stocks,&#34;errormsg&#34;} = &#34;$stocks retrieval not supported.&#34;;
-		  next ;
-		};
+		  my $opcvm = &#40;$tree-&gt;look_down&#40;&#39;id&#39;,&#39;cours_HeaderOPCVM_0&#39;&#41;&#41;[0];
+		  unless &#40;$opcvm&#41; {
+			$info {$stocks,&#34;success&#34;} = 0;
+			$info {$stocks,&#34;errormsg&#34;} = &#34;$stocks retrieval not supported.&#34;;
+			next ;
+		  }
+			
+		  # the stock is a delayed OPCVM
+
+		  my $infoelem = &#40;$tree-&gt;look_down&#40;&#39;id&#39;,&#39;content-gauche&#39;&#41;&#41;[0];
+		  $infoelem = &#40;$infoelem-&gt;look_down&#40;&#39;class&#39;,&#39;TabContenu&#39;&#41;&#41;[1];
+		  $infoelem = &#40;$infoelem-&gt;look_down&#40;&#39;_tag&#39;,&#39;table&#39;&#41;&#41;[1];
+
+		  my @rows = $infoelem-&gt;look_down&#40;&#39;_tag&#39;,&#39;tr&#39;&#41;;
+		  foreach my $i &#40;0..$#rows&#41; {
+			my $row = $rows[$i];
+			unless&#40;$row-&gt;attr&#40;&#39;class&#39;&#41;&#41; {
+			  next;
+			}
+
+			my $keytext = &#40;&#40;$row-&gt;look_down&#40;&#39;align&#39;,&#39;left&#39;&#41;&#41;[0]&#41;-&gt;as_text;
+			my $valuetext = &#40;&#40;$row-&gt;look_down&#40;&#39;align&#39;,&#39;right&#39;&#41;&#41;[0]&#41;-&gt;as_text;
+		    $tempinfo{$keytext} = $valuetext;
+		  }
+		}
+		else {
 
 		my $keys = &#40;$infoclass-&gt;look_down&#40;&#39;class&#39;,&#39;t01&#39;&#41;&#41;[0]; # this div contains all keys
 		my $data = &#40;$infoclass-&gt;look_down&#40;&#39;class&#39;,&#39;t03&#39;&#41;&#41;[0]; # this div contains all values
 		my @keys = $keys-&gt;look_down&#40;&#39;_tag&#39;,&#39;li&#39;&#41;;
 		my @values = $data-&gt;look_down&#40;&#39;_tag&#39;,&#39;li&#39;&#41;;
 
-		my %tempinfo; #holds table data
-
 		foreach my $i &#40;0..$#keys&#41; {
 		  my $keytext = &#40;$keys[$i]&#41;-&gt;as_text;
 		  my $valuetext = &#40;$values[$i]&#41;-&gt;as_text;
 		  $tempinfo{$keytext} = $valuetext;
 		}
 
+		}
+
 		foreach my $key &#40;keys %tempinfo&#41; {
 		  # print &#34;$key -&gt; $tempinfo{$key}\n&#34;;
 
 		ASSIGN:	for &#40; $key &#41; {
+			# OPCVM
+			/Valeur liquidative/ &#38;&#38; do {
+			  my &#40;$last, $currency&#41; = &#40;$tempinfo{$key} =~ m/&#40;\d*.?\d*&#41;\s*&#40;\w*&#41;/&#41;;
+			  $info{$stocks,&#34;last&#34;} = $last;
+			  $info{$stocks,&#34;currency&#34;} = $currency;
+			};
+			/Date/ &#38;&#38; do {
+			  $info{$stocks,&#34;date&#34;} = $tempinfo{$key};
+			  $quoter-&gt;store_date&#40;\%info, $stocks, {eurodate =&gt; $info{$stocks,&#34;date&#34;}}&#41;;
+			};
+			/Variation Veille/ &#38;&#38; do {
+			  $info{$stocks,&#34;p_change&#34;}=$tempinfo{$key}
+			};
+			# REGULAR STOCK
 			/Cours/ &#38;&#38; do {
 			  my &#40;$last, $currency&#41; = &#40;$tempinfo{$key} =~ m/&#40;\d*.?\d*&#41;\&#40;c\&#41;\s*&#40;\w*&#41;/&#41;;
 			  $info{$stocks,&#34;last&#34;} = $last;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;08&nbsp;15:41:17&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;08&nbsp;15:56:45&nbsp;2009</span>
    <span class="description">laurent.wozniak [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">TEST CASE:

BEFORE:

# gnc-fq-dump bourso FR0000937070
Finance::Quote fields Gnucash uses:
    symbol: FR0000937070 &#40;deduced&#41; &lt;=== required
      date: ** missing **        &lt;=== required
  currency: ** missing **        &lt;=== required
      last:                      &lt;=\       
       nav:                      &lt;=== one of these
     price:                      &lt;=/        
  timezone:                      &lt;=== optional

** This stock quote cannot be used by gnucash!!


AFTER:

# gnc-fq-dump bourso FR0000937070
Finance::Quote fields Gnucash uses:
    symbol: FR0000937070         &lt;=== required
      date: 11/06/2009           &lt;=== required
  currency: EUR                  &lt;=== required
      last: 53.03                &lt;=\       
       nav:                      &lt;=== one of these
     price:                      &lt;=/        
  timezone:                      &lt;=== optional
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;08&nbsp;16:19:04&nbsp;2009</span>
    <span class="description">piggymarketsqueak [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">hi mate,
Thanks for your reply.
Unfortunately, I am not very experienced using perl and CPAN projects.
Could tell me how to apply your patch and rebuild so that it going to
run on my box.
Many thanks,
Guillaume.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;08&nbsp;17:40:37&nbsp;2009</span>
    <span class="description">laurent.wozniak [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">reformatted raw patch.
re-created patch using: git diff
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Finance/Quote/Bourso.pm b/lib/Finance/Quote/Bourso.pm
index 5166794..86bd3b0 100644
--- a/lib/Finance/Quote/Bourso.pm
+++ b/lib/Finance/Quote/Bourso.pm
@@ -121,7 +121,7 @@ sub bourso {
 		};
 
 		my $symbol = $symbolline[0]-&gt;as_text;
-		&#40;$symbol&#41; = &#40;$symbol=~m/&#40;\w+&#41;-/&#41;;
+		&#40;$symbol&#41; = &#40;$symbol=~m/&#40;\w+&#41; ?-/&#41;;
 		$info{$stocks,&#34;symbol&#34;}=$symbol;
 
 		# retrieve NAME
@@ -139,31 +139,70 @@ sub bourso {
         # set method
         $info{$stocks,&#34;method&#34;} = &#34;bourso&#34; ;
 
+		#holds table data
+		my %tempinfo;
+
 		# retrieve other data
 		my $infoclass = &#40;$tree-&gt;look_down&#40;&#39;class&#39;,&#39;info1&#39;&#41;&#41;[0];
 		unless &#40;$infoclass&#41; {
-		  $info {$stocks,&#34;success&#34;} = 0;
-		  $info {$stocks,&#34;errormsg&#34;} = &#34;$stocks retrieval not supported.&#34;;
-		  next ;
-		};
+		  my $opcvm = &#40;$tree-&gt;look_down&#40;&#39;id&#39;,&#39;cours_HeaderOPCVM_0&#39;&#41;&#41;[0];
+		  unless &#40;$opcvm&#41; {
+			$info {$stocks,&#34;success&#34;} = 0;
+			$info {$stocks,&#34;errormsg&#34;} = &#34;$stocks retrieval not supported.&#34;;
+			next ;
+		  }
+
+		  # the stock is a delayed OPCVM
+
+		  my $infoelem = &#40;$tree-&gt;look_down&#40;&#39;id&#39;,&#39;content-gauche&#39;&#41;&#41;[0];
+		  $infoelem = &#40;$infoelem-&gt;look_down&#40;&#39;class&#39;,&#39;TabContenu&#39;&#41;&#41;[1];
+		  $infoelem = &#40;$infoelem-&gt;look_down&#40;&#39;_tag&#39;,&#39;table&#39;&#41;&#41;[1];
+
+		  my @rows = $infoelem-&gt;look_down&#40;&#39;_tag&#39;,&#39;tr&#39;&#41;;
+		  foreach my $i &#40;0..$#rows&#41; {
+			my $row = $rows[$i];
+			unless&#40;$row-&gt;attr&#40;&#39;class&#39;&#41;&#41; {
+			  next;
+			}
+
+			my $keytext = &#40;&#40;$row-&gt;look_down&#40;&#39;align&#39;,&#39;left&#39;&#41;&#41;[0]&#41;-&gt;as_text;
+			my $valuetext = &#40;&#40;$row-&gt;look_down&#40;&#39;align&#39;,&#39;right&#39;&#41;&#41;[0]&#41;-&gt;as_text;
+		    $tempinfo{$keytext} = $valuetext;
+		  }
+		}
+		else {
 
 		my $keys = &#40;$infoclass-&gt;look_down&#40;&#39;class&#39;,&#39;t01&#39;&#41;&#41;[0]; # this div contains all keys
 		my $data = &#40;$infoclass-&gt;look_down&#40;&#39;class&#39;,&#39;t03&#39;&#41;&#41;[0]; # this div contains all values
 		my @keys = $keys-&gt;look_down&#40;&#39;_tag&#39;,&#39;li&#39;&#41;;
 		my @values = $data-&gt;look_down&#40;&#39;_tag&#39;,&#39;li&#39;&#41;;
 
-		my %tempinfo; #holds table data
-
 		foreach my $i &#40;0..$#keys&#41; {
 		  my $keytext = &#40;$keys[$i]&#41;-&gt;as_text;
 		  my $valuetext = &#40;$values[$i]&#41;-&gt;as_text;
 		  $tempinfo{$keytext} = $valuetext;
 		}
 
+		}
+
 		foreach my $key &#40;keys %tempinfo&#41; {
 		  # print &#34;$key -&gt; $tempinfo{$key}\n&#34;;
 
 		ASSIGN:	for &#40; $key &#41; {
+			# OPCVM
+			/Valeur liquidative/ &#38;&#38; do {
+			  my &#40;$last, $currency&#41; = &#40;$tempinfo{$key} =~ m/&#40;\d*.?\d*&#41;\s*&#40;\w*&#41;/&#41;;
+			  $info{$stocks,&#34;last&#34;} = $last;
+			  $info{$stocks,&#34;currency&#34;} = $currency;
+			};
+			/Date/ &#38;&#38; do {
+			  $info{$stocks,&#34;date&#34;} = $tempinfo{$key};
+			  $quoter-&gt;store_date&#40;\%info, $stocks, {eurodate =&gt; $info{$stocks,&#34;date&#34;}}&#41;;
+			};
+			/Variation Veille/ &#38;&#38; do {
+			  $info{$stocks,&#34;p_change&#34;}=$tempinfo{$key}
+			};
+			# REGULAR STOCK
 			/Cours/ &#38;&#38; do {
 			  my &#40;$last, $currency&#41; = &#40;$tempinfo{$key} =~ m/&#40;\d*.?\d*&#41;\&#40;c\&#41;\s*&#40;\w*&#41;/&#41;;
 			  $info{$stocks,&#34;last&#34;} = $last;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;08&nbsp;17:53:40&nbsp;2009</span>
    <span class="description">laurent.wozniak [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

On Sun Nov 08 16:19:04 2009, guill wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately, I am not very experienced using perl and CPAN projects.
&gt; Could tell me how to apply your patch and rebuild so that it going to
&gt; run on my box.
</div>
If you want to quickly apply the patch:

* locate your finance quote install dir.
on my box it&#39;s either:
/usr/local/share/perl/5.10.0/Finance/Quote
or:
/usr/share/perl5/Finance/Quote
* cd into it
* apply the raw patch:
patch Bourso.pm /tmp/bourso.raw.patch

That&#39;s it, nothing to rebuild.

Cheers,
Laurent
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;31&nbsp;13:14:09&nbsp;2009</span>
    <span class="description">laurent.wozniak [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> laurent.wozniak [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Site has changed its layout, it&#39;s broken again.&lt;br /&gt;
&lt;br /&gt;
Here is the update of the patch that matches the new site.&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bourso.v2.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Finance/Quote/Bourso.pm b/lib/Finance/Quote/Bourso.pm
index 5166794..18ff338 100644
--- a/lib/Finance/Quote/Bourso.pm
+++ b/lib/Finance/Quote/Bourso.pm
@@ -121,7 +121,7 @@ sub bourso {
 		};
 
 		my $symbol = $symbolline[0]-&gt;as_text;
-		&#40;$symbol&#41; = &#40;$symbol=~m/&#40;\w+&#41;-/&#41;;
+		&#40;$symbol&#41; = &#40;$symbol=~m/&#40;\w+&#41; ?-/&#41;;
 		$info{$stocks,&#34;symbol&#34;}=$symbol;
 
 		# retrieve NAME
@@ -139,31 +139,71 @@ sub bourso {
         # set method
         $info{$stocks,&#34;method&#34;} = &#34;bourso&#34; ;
 
+		#holds table data
+		my %tempinfo;
+
 		# retrieve other data
 		my $infoclass = &#40;$tree-&gt;look_down&#40;&#39;class&#39;,&#39;info1&#39;&#41;&#41;[0];
 		unless &#40;$infoclass&#41; {
-		  $info {$stocks,&#34;success&#34;} = 0;
-		  $info {$stocks,&#34;errormsg&#34;} = &#34;$stocks retrieval not supported.&#34;;
-		  next ;
-		};
+		  my $opcvm = &#40;$tree-&gt;look_down&#40;&#39;id&#39;,&#39;opcvm_headerFund_0&#39;&#41;&#41;[0];
+		  unless &#40;$opcvm&#41; {
+			$info {$stocks,&#34;success&#34;} = 0;
+			$info {$stocks,&#34;errormsg&#34;} = &#34;$stocks retrieval not supported.&#34;;
+			next ;
+		  }
+
+		  # the stock is a delayed OPCVM
+
+		  my $infoelem = &#40;$tree-&gt;look_down&#40;&#39;id&#39;,&#39;content-gauche&#39;&#41;&#41;[0];
+		  $infoelem = &#40;$infoelem-&gt;look_down&#40;&#39;class&#39;,&#39;TabContenu&#39;&#41;&#41;[0];
+
+		  my @rows = $infoelem-&gt;look_down&#40;&#39;_tag&#39;,&#39;tr&#39;&#41;;
+		  foreach my $i &#40;0..$#rows&#41; {
+			my $row = $rows[$i];
+			unless&#40;$row-&gt;attr&#40;&#39;class&#39;&#41;&#41; {
+			  next;
+			}
+
+			my @cells = $row-&gt;look_down&#40;&#39;_tag&#39;,&#39;td&#39;&#41;;
+			my $keytext = &#40;$cells[0]&#41;-&gt;as_text;
+			my $valuetext = &#40;$cells[2]&#41;-&gt;as_text;
+
+			$tempinfo{$keytext} = $valuetext;
+		  }
+		}
+		else {
 
 		my $keys = &#40;$infoclass-&gt;look_down&#40;&#39;class&#39;,&#39;t01&#39;&#41;&#41;[0]; # this div contains all keys
 		my $data = &#40;$infoclass-&gt;look_down&#40;&#39;class&#39;,&#39;t03&#39;&#41;&#41;[0]; # this div contains all values
 		my @keys = $keys-&gt;look_down&#40;&#39;_tag&#39;,&#39;li&#39;&#41;;
 		my @values = $data-&gt;look_down&#40;&#39;_tag&#39;,&#39;li&#39;&#41;;
 
-		my %tempinfo; #holds table data
-
 		foreach my $i &#40;0..$#keys&#41; {
 		  my $keytext = &#40;$keys[$i]&#41;-&gt;as_text;
 		  my $valuetext = &#40;$values[$i]&#41;-&gt;as_text;
 		  $tempinfo{$keytext} = $valuetext;
 		}
 
+		}
+
 		foreach my $key &#40;keys %tempinfo&#41; {
 		  # print &#34;$key -&gt; $tempinfo{$key}\n&#34;;
 
 		ASSIGN:	for &#40; $key &#41; {
+			# OPCVM
+			/Valeur liquidative/ &#38;&#38; do {
+			  my &#40;$last, $currency&#41; = &#40;$tempinfo{$key} =~ m/&#40;\d*.?\d*&#41;\s*&#40;\w*&#41;/&#41;;
+			  $info{$stocks,&#34;last&#34;} = $last;
+			  $info{$stocks,&#34;currency&#34;} = $currency;
+			};
+			/Date/ &#38;&#38; do {
+			  $info{$stocks,&#34;date&#34;} = $tempinfo{$key};
+			  $quoter-&gt;store_date&#40;\%info, $stocks, {eurodate =&gt; $info{$stocks,&#34;date&#34;}}&#41;;
+			};
+			/Variation Veille/ &#38;&#38; do {
+			  $info{$stocks,&#34;p_change&#34;}=$tempinfo{$key}
+			};
+			# REGULAR STOCK
 			/Cours/ &#38;&#38; do {
 			  my &#40;$last, $currency&#41; = &#40;$tempinfo{$key} =~ m/&#40;\d*.?\d*&#41;\&#40;c\&#41;\s*&#40;\w*&#41;/&#41;;
 			  $info{$stocks,&#34;last&#34;} = $last;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;05:27:55&nbsp;2010</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken">10 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> laurent.wozniak [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 31 13:14:09 2009, laurent.wozniak wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Site has changed its layout, it&#39;s broken again.&lt;br /&gt;
&gt; &lt;br /&gt;
&gt; Here is the update of the patch that matches the new site.&lt;br /&gt;
&gt; &lt;br /&gt;
&gt; &lt;br /&gt;
</div>
Hi Laurent !

Sorry for the delay... The patch has been applied and tested and moved to master branch.
However, what does this patch resolve ? since no test broke with current version neither...

thanks for the coding !
-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;05:27:56&nbsp;2010</span>
    <span class="description">eco [...] ecocode.net -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;05:27:58&nbsp;2010</span>
    <span class="description">eco [...] ecocode.net -  Given to ecocode</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;10:29:12&nbsp;2010</span>
    <span class="description">laurent.wozniak [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> laurent.wozniak [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The patch has been applied and tested and moved to master branch.
</div>Thank you very much

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, what does this patch resolve ? since no test broke with
&gt; current version neither...
</div>The layout of the site is completely different depending on the type of
financial instrument.
Layout for a regular stock:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.boursorama.com/cours.phtml?symbole=1rPFTE">http://www.boursorama.com/cours.phtml?symbole=1rPFTE</a></span>
Layout for a delayed opcvm:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.boursorama.com/opcvm/opcvm.phtml?symbole=MP-804068">http://www.boursorama.com/opcvm/opcvm.phtml?symbole=MP-804068</a></span>

That&#39;s why I was talking about the following test case:
# gnc-fq-dump bourso FR0000937070

But I don&#39;t know how to add a unit test in this project.

Cheers,
Laurent
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;10:29:14&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;03&nbsp;05:28:28&nbsp;2014</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 13 10:29:12 2010, laurent.wozniak wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
<div class="message-stanza open">&gt; &gt; The patch has been applied and tested and moved to master branch.
</div>&gt; Thank you very much
&gt; 
<div class="message-stanza open">&gt; &gt; However, what does this patch resolve ? since no test broke with
&gt; &gt; current version neither...
</div>&gt; The layout of the site is completely different depending on the type of
&gt; financial instrument.
&gt; Layout for a regular stock:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.boursorama.com/cours.phtml?symbole=1rPFTE">http://www.boursorama.com/cours.phtml?symbole=1rPFTE</a></span>
&gt; Layout for a delayed opcvm:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.boursorama.com/opcvm/opcvm.phtml?symbole=MP-804068">http://www.boursorama.com/opcvm/opcvm.phtml?symbole=MP-804068</a></span>
&gt; 
&gt; That&#39;s why I was talking about the following test case:
&gt; # gnc-fq-dump bourso FR0000937070
&gt; 
&gt; But I don&#39;t know how to add a unit test in this project.
&gt; 
&gt; Cheers,
&gt; Laurent
</div>
Laurent,

I didn&#39;t respond for long... Is this still actual or can I close this bug ?

-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;05&nbsp;06:43:01&nbsp;2014</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Laurent,
&gt; 
&gt; I didn&#39;t respond for long... Is this still actual or can I close this bug ?
</div>
I&#39;ll close this bug for now.. reopen it if you think it should be ;&#41;

-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;05&nbsp;06:43:03&nbsp;2014</span>
    <span class="description">eco [...] ecocode.net -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
