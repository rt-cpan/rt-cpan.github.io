<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #125049 for Tcl-pTk: [macOS] black text/graphics for menu items</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #125049 for Tcl-pTk: [macOS] black text/graphics for menu items</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tcl-pTk/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tcl-pTk/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tcl-pTk/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tcl-pTk/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tcl-pTk">Tcl-pTk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">125049</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tcl-pTk/Active/">Tcl-pTk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">CAC [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
CAC [...] cpan.org

<br />
welleozean [...] googlemail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-234402-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.92    </td>
  </tr>
  <tr id="CF-234403-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.00    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




executable.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1848373/993246/executable.png">
Sun May 12 04:32:44 2019 (27.1k) by welleozean [...] googlemail.com
</a>
</font></li>
</ul>


rt125049.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1848395/993276/rt125049.diff">
Sun May 12 06:29:32 2019 (1.3k) by CAC [...] cpan.org
</a>
</font></li>
</ul>


Screen Shot 2018-07-10 at 2.34.57 AM.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1795332/965524/Screen%20Shot%202018-07-10%20at%202.34.57%20AM.png">
Tue Jul 10 03:37:42 2018 (39.5k) by CAC [...] cpan.org
</a>
</font></li>
</ul>


Screen Shot 2018-07-28 at 10.39.10 AM.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1797776/966844/Screen%20Shot%202018-07-28%20at%2010.39.10%20AM.png">
Sat Jul 28 11:40:56 2018 (19.3k) by CAC [...] cpan.org
</a>
</font></li>
</ul>


Screen Shot 2018-08-13 at 5.28.53 AM.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1799467/967716/Screen%20Shot%202018-08-13%20at%205.28.53%20AM.png">
Mon Aug 13 06:40:55 2018 (53.6k) by CAC [...] cpan.org
</a>
</font></li>
</ul>


Screen Shot 2018-08-13 at 5.30.07 AM.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1799467/967717/Screen%20Shot%202018-08-13%20at%205.30.07%20AM.png">
Mon Aug 13 06:40:55 2018 (53.4k) by CAC [...] cpan.org
</a>
</font></li>
</ul>


script.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1848373/993245/script.png">
Sun May 12 04:32:44 2019 (27.3k) by welleozean [...] googlemail.com
</a>
</font></li>
</ul>


tcl_ptk_white_menu_text.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1781030/958249/tcl_ptk_white_menu_text.png">
Mon Apr 09 12:10:11 2018 (100.4k) by CAC [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;09&nbsp;03:10:52&nbsp;2018</span>
    <span class="description">CAC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [macOS] black text/graphics for menu items</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When using the native menubar on macOS, the text and/or graphics of some menu items might always be rendered black when it should sometimes render as white, which is either:
&#40;1&#41; when the mouse pointer is over the menu item &#40;making the highlighted item hard to read&#41;, or
&#40;2&#41; when the user has enabled the dark menu bar in System Preferences &gt; General &#40;making un-highlighted items unreadable&#41;.

This issue only occurs depending on whether or not the menu was constructed using `-menuitems`. Using the Tcl::pTk widget demo, for the `menus` example, the toplevel cascades behave correctly but submenus do not. For the `menus2` example &#40;which uses `-menuitems`&#41;, nearly the opposite is observed: toplevel cascades do not behave correctly, but submenus do.

Screenshot of `menus` example: <span class="clickylink"><a target="new" rel="nofollow" href="https://user-images.githubusercontent.com/7941193/37901465-e33f2f5a-30b6-11e8-8d22-dff8bfdea0f2.png">https://user-images.githubusercontent.com/7941193/37901465-e33f2f5a-30b6-11e8-8d22-dff8bfdea0f2.png</a></span>

Screenshot of `menus2` example: <span class="clickylink"><a target="new" rel="nofollow" href="https://user-images.githubusercontent.com/7941193/37901456-dede130e-30b6-11e8-85c4-1539471fd5a0.png">https://user-images.githubusercontent.com/7941193/37901456-dede130e-30b6-11e8-85c4-1539471fd5a0.png</a></span>

Screenshot of an affected program &#40;cf. <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/hotwolf/HSW12/issues/16#issuecomment-376131642&#41;">https://github.com/hotwolf/HSW12/issues/16#issuecomment-376131642&#41;</a></span> when dark menu bar is enabled: <span class="clickylink"><a target="new" rel="nofollow" href="https://user-images.githubusercontent.com/7941193/37900580-40ae47d2-30b4-11e8-8e8e-4e7296c4925f.png">https://user-images.githubusercontent.com/7941193/37900580-40ae47d2-30b4-11e8-8e8e-4e7296c4925f.png</a></span>

This issue does not appear to affect e.g. Windows or Linux.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;09&nbsp;12:10:11&nbsp;2018</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [macOS] color of text/graphics for menu items not changing</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I need to rephrase this issue somewhat already. I&#39;ve noticed this or a similar issue can still happen for standalone Menubuttons, and with the menu items&#39; text being rendered white.

For example, the bouncing ball simulator in the widget demo program &#40;which uses the pre-Tk 8 technique of creating a menubar using packed Menubuttons*&#41;, the menuitems are rendered with text always white, so they are unreadable unless highlighted; see attached screenshot.

* &#40;I&#39;m willing to submit a patch to either Tcl::pTk or directly to Perl/Tk that updates this demo to use the Tk 8 menubar, so that the native menubar is used on Mac aqua, and to avoid an unusual-looking menu rendered as pulldown lists.&#41;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tcl_ptk_white_menu_text.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1781030/958249/tcl_ptk_white_menu_text.png">Download tcl_ptk_white_menu_text.png</a><br />
<span class="downloadcontenttype">image/png 100.4k</span>
</div>
<div class="messagebody">
<img alt="tcl_ptk_white_menu_text.png" title="tcl_ptk_white_menu_text.png" src="/Ticket/Attachment/1781030/958249/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;10&nbsp;03:37:42&nbsp;2018</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [macOS] color of text/graphics for menu items not changing</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza">This issue might not be specific to Tcl::pTk after all. I have reproduced a similar issue with Gitk 2.18.0, which is a pure Tcl/Tk app. I have not yet located an upstream bug report for this.<br>

<br>

<br>


</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Screen Shot 2018-07-10 at 2.34.57 AM.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1795332/965524/Screen%20Shot%202018-07-10%20at%202.34.57%20AM.png">Download Screen Shot 2018-07-10 at 2.34.57 AM.png</a><br />
<span class="downloadcontenttype">image/png 39.5k</span>
</div>
<div class="messagebody">
<img alt="Screen Shot 2018-07-10 at 2.34.57 AM.png" title="Screen Shot 2018-07-10 at 2.34.57 AM.png" src="/Ticket/Attachment/1795332/965524/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;28&nbsp;11:40:56&nbsp;2018</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">On Mon Apr 09 11:10:11 2018, CAC wrote:<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I need to rephrase this issue somewhat already. I&#39;ve noticed this or a<br>

&gt; similar issue can still happen for standalone Menubuttons, and with<br>

&gt; the menu items&#39; text being rendered white.<br>

&gt;<br>

&gt; For example, the bouncing ball simulator in the widget demo program<br>

&gt; (which uses the pre-Tk 8 technique of creating a menubar using packed<br>

&gt; Menubuttons*), the menuitems are rendered with text always white, so<br>

&gt; they are unreadable unless highlighted; see attached screenshot.<br>
</div><br>

For the bouncing ball example, the cause of the white text is simply because that&#39;s how it&#39;s coded in bounce.pl:</span><br>

<br>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; my $mb_list;</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; foreach $mb_list (@{$mb_list_ref}) {</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; $mb-&gt;command(</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -label&nbsp; &nbsp; &nbsp; =&gt; $mb_list-&gt;[0],</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -command&nbsp; &nbsp; =&gt; $mb_list-&gt;[1] ,</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -underline&nbsp; =&gt; $mb_list-&gt;[2],</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -background =&gt; &#39;DarkGreen&#39;,</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -foreground =&gt; &#39;White&#39;,</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; );</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; }</span></div>

<br>

<span style="font-family:arial,helvetica,sans-serif;">But simply removing the</span> <span style="font-family:courier new,courier,monospace;">-foreground</span>&nbsp;<span style="font-family:arial,helvetica,sans-serif;">and</span> <span style="font-family:courier new,courier,monospace;">-background</span> <span style="font-family:arial,helvetica,sans-serif;">options doesn&#39;t guarantee the Menubutton behaves as desired; the text might still appear black (rather than white) when hovered over (see attached screenshot). Yet menbut.pl uses similar Menubutton syntax and doesn&#39;t have this issue.</span><br>


</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Screen Shot 2018-07-28 at 10.39.10 AM.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1797776/966844/Screen%20Shot%202018-07-28%20at%2010.39.10%20AM.png">Download Screen Shot 2018-07-28 at 10.39.10 AM.png</a><br />
<span class="downloadcontenttype">image/png 19.3k</span>
</div>
<div class="messagebody">
<img alt="Screen Shot 2018-07-28 at 10.39.10 AM.png" title="Screen Shot 2018-07-28 at 10.39.10 AM.png" src="/Ticket/Attachment/1797776/966844/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;13:03:50&nbsp;2018</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">I&#39;ve opened a ticket for Tcl/Tk regarding this issue:&nbsp;<a href="https://core.tcl.tk/tk/tktview/9fcef965a54fea446d1cb99324a56047a343970a"><span class="clickylink"><a target="new" rel="nofollow" href="https://core.tcl.tk/tk/tktview/9fcef965a54fea446d1cb99324a56047a343970a">https://core.tcl.tk/tk/tktview/9fcef965a54fea446d1cb99324a56047a343970a</a></span></a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;13&nbsp;06:40:55&nbsp;2018</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">According to <span style="font-family:courier new,courier,monospace;">cget -foreground</span> and <span style="font-family:courier new,courier,monospace;">cget -background</span> there isn&#39;t any color set for both the correctly and incorrectly behaving entries, unless I had set ones manually. In which cases, both <span style="font-family:courier new,courier,monospace;">-foreground</span> and <span style="font-family:courier new,courier,monospace;">-background</span> have the same effect (though both act like <span style="font-family:courier new,courier,monospace;">-foreground</span> does on other windowingsystems) for correctly behaving entries, and only <span style="font-family:courier new,courier,monospace;">-foreground</span> has an effect on the incorrectly behaving ones.<br>

<br>

Attached is a screenshots of the <span style="font-family:courier new,courier,monospace;">-foreground</span> being set for both a correctly and incorrectly behaving entry, and then the screenshot of <span style="font-family:courier new,courier,monospace;">-background</span> being set for both.</span><br>


</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Screen Shot 2018-08-13 at 5.28.53 AM.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1799467/967716/Screen%20Shot%202018-08-13%20at%205.28.53%20AM.png">Download Screen Shot 2018-08-13 at 5.28.53 AM.png</a><br />
<span class="downloadcontenttype">image/png 53.6k</span>
</div>
<div class="messagebody">
<img alt="Screen Shot 2018-08-13 at 5.28.53 AM.png" title="Screen Shot 2018-08-13 at 5.28.53 AM.png" src="/Ticket/Attachment/1799467/967716/" /></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Screen Shot 2018-08-13 at 5.30.07 AM.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1799467/967717/Screen%20Shot%202018-08-13%20at%205.30.07%20AM.png">Download Screen Shot 2018-08-13 at 5.30.07 AM.png</a><br />
<span class="downloadcontenttype">image/png 53.4k</span>
</div>
<div class="messagebody">
<img alt="Screen Shot 2018-08-13 at 5.30.07 AM.png" title="Screen Shot 2018-08-13 at 5.30.07 AM.png" src="/Ticket/Attachment/1799467/967717/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;07:07:25&nbsp;2018</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">Yet another clue: in t/ptk-compat2.t, the File menu (which is created using <span style="font-family:courier new,courier,monospace;">Menubutton</span>) works, whereas in the File-Cascade menu, the accelerators appear correctly but not the entry labels.</span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;01&nbsp;07:46:12&nbsp;2019</span>
    <span class="description">chrischavez [...] gmx.us -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #125049] [macOS] black text/graphics for menu items</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Mar 2019 06:39:33 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Tcl-pTk via RT &lt;bug-Tcl-pTk [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christopher Chavez &lt;chrischavez [...] gmx.us&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Tcl::pTk doesn&#39;t have something like $Tkx::TRACE, and doesn&#39;t 
exclusively use Tcl::call&#40;&#41;. So after playing with Hook::LexWrap and 
Data::Dump to examine the firehose of input going into e.g. 
Tcl::invoke&#40;&#41;, I was able to spot where it indeed looks like Tcl::pTk is 
setting &#34;default&#34; colors when not explicitly specified by 
programs/scripts. I also neglected to check cget&#40;&#41; on the menus rather 
than just the entries, as Perl/Tk and Tcl/Tk documentation both say 
that&#39;s where entries will inherit colors from. cget&#40;&#41; indicated that 
non-default colors were set on affected menus. The particular colors 
being set are #d9d9d9 for background and BLACK for foreground, which 
quickly pointed to Derived.pm line 354 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/chrstphrchvz/perl-tcl-ptk/blob/57c5ec60bfc9f628cd55e73924e9b398d3ab46c3/lib/Tcl/pTk/Derived.pm#L354&gt;">https://github.com/chrstphrchvz/perl-tcl-ptk/blob/57c5ec60bfc9f628cd55e73924e9b398d3ab46c3/lib/Tcl/pTk/Derived.pm#L354&gt;</a></span> 
as being responsible for this issue.

I have not yet figured out how to resolve this. The comments for the 
section of code responsible admit the approach might not have been fully 
thought through. I wonder why default colors are being set by Tcl::pTk 
anyways rather than relying more on Tcl/Tk to decide proper defaults for 
each widget on each platform.



---
This email has been checked for viruses by Avast antivirus software.
<span class="clickylink"><a target="new" rel="nofollow" href="https://www.avast.com/antivirus">https://www.avast.com/antivirus</a></span>
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;01&nbsp;07:46:16&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;01:38:19&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">On Fri Mar 01 06:46:12 2019, chrischavez@gmx.us wrote:<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The particular colors<br>

&gt; being set are #d9d9d9 for background and BLACK for foreground, which<br>

&gt; quickly pointed to Derived.pm line 354<br>

&gt; &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/chrstphrchvz/perl-tcl-">https://github.com/chrstphrchvz/perl-tcl-</a></span><br>

&gt; ptk/blob/57c5ec60bfc9f628cd55e73924e9b398d3ab46c3/lib/Tcl/pTk/Derived.pm#L354&gt;<br>

&gt; as being responsible for this issue.<br>
</div><br>

<br>

<span style="font-family:arial,helvetica,sans-serif;">Also, that code comes from Perl/Tk (and seems to be as old as Perl/Tk is); I guess Perl/Tk would have this issue were it to support aqua. The&nbsp;POD for Tk::ConfigSpecs &sect; CAVEATS might explain its motivation.<br>

<br>

Tcl::Tk doesn&#39;t have this behavior because it doesn&#39;t have Derived widgets. Could the whole behavior be removed from Tcl::pTk without pulling the plug on Derived, or should menus on aqua be treated as an edge case? I don&#39;t know how often Perl/Tk programs assume/depend on -foreground and -background being propagated this way.</span><br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;19&nbsp;20:56:35&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;03:56:30&nbsp;2019</span>
    <span class="description">welleozean [...] googlemail.com - Ticket #129505:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> macOS Acqua Dark wrong colours in popup menus</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 10 May 2019 09:56:05 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tcl-pTk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> welle ozean &lt;welleozean [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

on macOS Mojave set to Dark mode, popup menus have a wrong colour &#40;dark
background and dark font&#41; which prevents popup menus to be readable. Note
that this happens only if the application is run as an executable &#40;inside
an application bundle for example&#41;. Different to the case when it is run as
a script, the macOS turns the main window and popups to dark.

Popup created with:

sub PupupEnterField{
  my &#40;$mw, $obj&#41; = @_;
  my $menu = $mw-&gt;Menu&#40;-tearoff=&gt;0, -menuitems=&gt;[
    [command=&gt;&#34;MY LABEL&#34;, -command=&gt;[sub {StartSub&#40;&#41;}, $obj,]],
  ]&#41;;
  $obj-&gt;menu&#40;$menu&#41;;
  $obj-&gt;bind&#40;$RightClicBind, [&#39;PostPopupMenu&#39;, Ev&#40;&#39;X&#39;&#41;, Ev&#40;&#39;Y&#39;&#41;, ]&#41;;
  return $obj;
}

On top of this there seems to be no method to get the theme currently used
by the OS &#40;in order to take some actions if it is dark&#41;, so this is quite a
big issue.

Thank you
Welle
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;04:15:42&nbsp;2019</span>
    <span class="description">welleozean [...] googlemail.com - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129505] AutoReply: macOS Acqua Dark wrong colours in popup menus</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 10 May 2019 10:14:37 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tcl-pTk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> welle ozean &lt;welleozean [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Addendum: with &#34;taking actions&#34; I meant to set, for example,
-foreground=&gt;&#39;white&#39; for each menu item. This will make the menu readable
in Dark mode.

PS: the same problem applies to the menu bar, however, quite strangely,
only for menu items of the second level &#40;for items of the first level,
-foreground is automatically switched to white&#41;

Am Fr., 10. Mai 2019 um 09:56 Uhr schrieb Bugs in Tcl-pTk via RT &lt;
bug-Tcl-pTk@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Greetings,
&gt;
&gt; This message has been automatically generated in response to the
&gt; creation of a trouble ticket regarding:
&gt;         &#34;macOS Acqua Dark wrong colours in popup menus&#34;,
&gt; a summary of which appears below.
&gt;
&gt; There is no need to reply to this message right now.  Your ticket has been
&gt; assigned an ID of [rt.cpan.org #129505].  Your ticket is accessible
&gt; on the web at:
&gt;
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129505">https://rt.cpan.org/Ticket/Display.html?id=129505</a></span>
&gt;
&gt; Please include the string:
&gt;
&gt;          [rt.cpan.org #129505]
&gt;
&gt; in the subject line of all future correspondence about this issue. To do
&gt; so,
&gt; you may reply to this message.
&gt;
&gt;                         Thank you,
&gt;                         bug-Tcl-pTk@rt.cpan.org
&gt;
&gt; -------------------------------------------------------------------------
&gt; Hello,
&gt;
&gt; on macOS Mojave set to Dark mode, popup menus have a wrong colour &#40;dark
&gt; background and dark font&#41; which prevents popup menus to be readable. Note
&gt; that this happens only if the application is run as an executable &#40;inside
&gt; an application bundle for example&#41;. Different to the case when it is run as
&gt; a script, the macOS turns the main window and popups to dark.
&gt;
&gt; Popup created with:
&gt;
&gt; sub PupupEnterField{
&gt;   my &#40;$mw, $obj&#41; = @_;
&gt;   my $menu = $mw-&gt;Menu&#40;-tearoff=&gt;0, -menuitems=&gt;[
&gt;     [command=&gt;&#34;MY LABEL&#34;, -command=&gt;[sub {StartSub&#40;&#41;}, $obj,]],
&gt;   ]&#41;;
&gt;   $obj-&gt;menu&#40;$menu&#41;;
&gt;   $obj-&gt;bind&#40;$RightClicBind, [&#39;PostPopupMenu&#39;, Ev&#40;&#39;X&#39;&#41;, Ev&#40;&#39;Y&#39;&#41;, ]&#41;;
&gt;   return $obj;
&gt; }
&gt;
&gt; On top of this there seems to be no method to get the theme currently used
&gt; by the OS &#40;in order to take some actions if it is dark&#41;, so this is quite a
&gt; big issue.
&gt;
&gt; Thank you
&gt; Welle
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:29:34&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">This strongly resembles the issue in&nbsp;<a href="https://rt.cpan.org/Ticket/Display.html?id=125049">#125049</a>, however I never suspected that issue to only appear depending on whether the program is run from a script or an app. I&#39;ve only ever run Tcl::pTk from a script, and am not familiar with packaging in an app bundle or why that would partially affect the appearance. I am likely confused on what exact difference is happening in each case; if you could provide screenshots, that would be handy. I&#39;m aware it&#39;s possible for an app bundle to force enable/disable dark mode (Info.plist?), but am not aware that that is something you have done for your app. Setting light mode in System Preferences may make the issue not noticeable; but if the menu entry&#39;s text is dark when highlighted/hovered over, then the issue is technically still present.<br>

<br>

I use dark mode, but I am not caught up on the changes recently made by Tk to support it. The macosx/README file in Tk 8.6.9 says that two new virtual events&nbsp;<span style="font-family:courier new,courier,monospace;">&lt;&lt;LightAqua&gt;&gt;</span> and <span style="font-family:courier new,courier,monospace;">&lt;&lt;DarkAqua&gt;&gt;</span>&nbsp;were&nbsp;</span><span style="font-family: arial, helvetica, sans-serif;">added to allow handling changes in appearance.&nbsp;</span><span style="font-family:arial,helvetica,sans-serif;">It is also possible to query the current appearance via AppleScript (e.g. using the <span style="font-family:courier new,courier,monospace;">osascript</span> system command), but I would not be surprised if there is now an even easier way via Tk.<br>

<br>

But from what I have investigated for #125049, I don&#39;t believe knowing the current light/dark mode is what should be used to resolve this issue. The cause, as I currently understand, is that some of the code Tcl::pTk had borrowed from Perl/Tk sets default colors for child widgets. But this code, which predates Tk Aqua, uses&nbsp;hardcoded colors, and results in some menu widgets always having entries with black text, which become illegible for the dark-background menus in recent macOS versions. Ideally, the colors should be unset by default; that way, macOS&#39; window manager automatically picks the appropriate, legible color. Unfortunately I still have not figured out how to fix this issue, even though it was one of the first issues I identified when I began using Tcl::pTk over a year ago.</span><br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:29:35&nbsp;2019</span>
    <span class="description">The RT System itself - Ticket #129505:  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:29:35&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:30:30&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Reference to ticket #125049 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:30:30&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Reference by ticket #125049 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:34:10&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">To further rephrase this issue, this also affects some popup menus (e.g. from menubuttons or right-click context menus) in macOS 10.14 Mojave, since those now have dark backgrounds when dark mode is enabled.</span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:34:11&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;05:34:11&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;04:32:44&nbsp;2019</span>
    <span class="description">welleozean [...] googlemail.com - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129505] macOS Acqua Dark wrong colours in popup menus</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 May 2019 10:32:12 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tcl-pTk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> welle ozean &lt;welleozean [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Christopher,

thank you, as always, for your insights. Here are the two screenshots:

script
[image: script.png]
executable launched from the Terminal &#40;not inside an App&#41;
[image: executable.png]

Both generated with the following script:

use Tcl::pTk;
my $mw = MainWindow-&gt;new&#40;&#41;;
my $TextWidget = $mw-&gt;Scrolled&#40;&#39;Text&#39;, -scrollbars=&gt; &#39;ose&#39;, -height=&gt; 3,
-wrap=&gt;&#39;word&#39;&#41;-&gt;pack&#40;-side=&gt;&#39;top&#39;, -expand =&gt; &#39;1&#39;,-fill =&gt; &#39;both&#39;,
-padx=&gt;6&#41;;
PupupEnterField&#40;$mw, $TextWidget&#41;;
MainLoop;

sub PupupEnterField{
  my &#40;$mw, $obj&#41; = @_;
  my $menu = $mw-&gt;Menu&#40;-tearoff=&gt;0, -menuitems=&gt;[
    [command=&gt;&#34;MY LABEL&#34;, -command=&gt;[sub {StartSub&#40;&#41;}, $obj,]],
  ]&#41;;
  $obj-&gt;menu&#40;$menu&#41;;
  $obj-&gt;bind&#40;&#39;&lt;2&gt;&#39;, [&#39;PostPopupMenu&#39;, Ev&#40;&#39;X&#39;&#41;, Ev&#40;&#39;Y&#39;&#41;, ]&#41;;
  return $obj;
}

I solved my problem with the following workaround:

my $foregroundColorMenu=&#39;black&#39;;
#reading macOS setting
eval{
our $tk_dark = $int-&gt;Eval&#40;&#39;exec defaults read -g AppleInterfaceStyle&#39;&#41;;
};
#adapting font of menu/popups depending on Dark/Light UI
if &#40;$tk_dark eq &#39;Dark&#39;&#41;{
$foregroundColorMenu=&#39;white&#39;;
}
#then adding &#34;-foreground=&gt;$foregroundColorMenu&#34; to all my menus presenting
the color problem

PS: note the use of eval, as the returned state of the function to read the
Dark/Light mode can return  &#34;Dark&#34; or die if no value can be read &#40;which
means it is Light&#41;

Not elegant, but at least my application works fine in Dark mode.

Best,
Welle


Am Fr., 10. Mai 2019 um 11:29 Uhr schrieb Christopher Alexander Chavez via
RT &lt;bug-Tcl-pTk@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129505">https://rt.cpan.org/Ticket/Display.html?id=129505</a></span> &gt;
&gt;
&gt; This strongly resembles the issue in #125049, however I never suspected
&gt; that
&gt; issue to only appear depending on whether the program is run from a script
&gt; or
&gt; an app. I&#39;ve only ever run Tcl::pTk from a script, and am not familiar with
&gt; packaging in an app bundle or why that would partially affect the
&gt; appearance. I
&gt; am likely confused on what exact difference is happening in each case; if
&gt; you
&gt; could provide screenshots, that would be handy. I&#39;m aware it&#39;s possible
&gt; for an
&gt; app bundle to force enable/disable dark mode &#40;Info.plist?&#41;, but am not
&gt; aware
&gt; that that is something you have done for your app. Setting light mode in
&gt; System
&gt; Preferences may make the issue not noticeable; but if the menu entry&#39;s
&gt; text is
&gt; dark when highlighted/hovered over, then the issue is technically still
&gt; present.
&gt;
&gt; I use dark mode, but I am not caught up on the changes recently made by Tk
&gt; to
&gt; support it. The macosx/README file in Tk 8.6.9 says that two new virtual
&gt; events
&gt; &lt;&lt;LightAqua&gt;&gt; and &lt;&lt;DarkAqua&gt;&gt; were added to allow handling changes in
&gt; appearance. It is also possible to query the current appearance via
&gt; AppleScript
&gt; &#40;e.g. using the osascript system command&#41;, but I would not be surprised if
&gt; there is now an even easier way via Tk.
&gt;
&gt; But from what I have investigated for #125049, I don&#39;t believe knowing the
&gt; current light/dark mode is what should be used to resolve this issue. The
&gt; cause, as I currently understand, is that some of the code Tcl::pTk had
&gt; borrowed from Perl/Tk sets default colors for child widgets. But this code,
&gt; which predates Tk Aqua, uses hardcoded colors, and results in some menu
&gt; widgets
&gt; always having entries with black text, which become illegible for the
&gt; dark-background menus in recent macOS versions. Ideally, the colors should
&gt; be
&gt; unset by default; that way, macOS&#39; window manager automatically picks the
&gt; appropriate, legible color. Unfortunately I still have not figured out how
&gt; to
&gt; fix this issue, even though it was one of the first issues I identified
&gt; when I
&gt; began using Tcl::pTk over a year ago.
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1848373/993245/script.png">Download script.png</a><br />
<span class="downloadcontenttype">image/png 27.3k</span>
</div>
<div class="messagebody">
<img alt="script.png" title="script.png" src="/Ticket/Attachment/1848373/993245/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1848373/993246/executable.png">Download executable.png</a><br />
<span class="downloadcontenttype">image/png 27.1k</span>
</div>
<div class="messagebody">
<img alt="executable.png" title="executable.png" src="/Ticket/Attachment/1848373/993246/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;04:53:05&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">On Sun May 12 03:32:44 2019, welleozean@googlemail.com wrote:<br>

<span style="font-family:courier new,courier,monospace;">&gt; #reading macOS setting<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; eval{<br>

&gt; our $tk_dark = $int-&gt;Eval(&#39;exec defaults read -g<br>

&gt; AppleInterfaceStyle&#39;);<br>

&gt; };</span><br>
</div><br>

Note that <span style="font-family:courier new,courier,monospace;">defaults</span>&nbsp;is a macOS system command. Here&#39;s one Perl equivalent I can think of:<br>

<br>

<span style="font-family:courier new,courier,monospace;">our $tk_dark = (`defaults read -g AppleInterfaceStyle 2&gt;/dev/null` =~ m/Dark/);</span></span><br>

<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;04:58:18&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">On Sun May 12 03:53:05 2019, CAC wrote:<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; <span style="font-family:courier new,courier,monospace;">our $tk_dark = (`defaults read -g AppleInterfaceStyle 2&gt;/dev/null` =~ m/Dark/);</span><br>
</div><br>

Oops, that sets <span style="font-family:courier new,courier,monospace;">$tk_dark</span> to <span style="font-family:courier new,courier,monospace;">1</span> if <span style="font-family:courier new,courier,monospace;">Dark</span>&nbsp;is returned. Sorry&hellip;</span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;05:40:52&nbsp;2019</span>
    <span class="description">welleozean [...] googlemail.com - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129505] macOS Acqua Dark wrong colours in popup menus</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 May 2019 11:40:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tcl-pTk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> welle ozean &lt;welleozean [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Still nice!


Am So., 12. Mai 2019 um 10:58 Uhr schrieb Christopher Alexander Chavez via
RT &lt;bug-Tcl-pTk@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129505">https://rt.cpan.org/Ticket/Display.html?id=129505</a></span> &gt;
&gt;
&gt; On Sun May 12 03:53:05 2019, CAC wrote:
<div class="message-stanza open">&gt; &gt; our $tk_dark = &#40;`defaults read -g AppleInterfaceStyle 2&gt;/dev/null` =~
</div>&gt; m/Dark/&#41;;
&gt;
&gt; Oops, that sets $tk_dark to 1 if Dark is returned. Sorry
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;05:50:29&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">Thank you for the screenshots and example code, I think that clears up any confusion I had. I still can&#39;t explain why running as a script prevents dark mode from being used; when I run Tcl::pTk as a script with prerelease Tcl/Tk built with MacPorts&#39; help, it uses dark mode. I would want to double check, is the script example running the same Tk version (via Tcl.pm) as what your app bundle contains, or is it different, e.g. a Tcl/Tk distribution? I understand that might indeed not be the case; I&#39;m just not sure what else to check.<br>

<br>

Now for the update I wanted to provide on the issue itself&hellip;<br>

<br>

In the past I had tried various combinations of commenting out lines in the responsible code, or tweaking what defaults were being set, and would usually end up with fatal errors. But I may have finally found something that works:</span><br>

<br>


<div>
	<span style="font-family:courier new,courier,monospace;">diff --git a/lib/Tcl/pTk/Derived.pm b/lib/Tcl/pTk/Derived.pm<br>
	index dc2e006..75840fa 100644<br>
	--- a/lib/Tcl/pTk/Derived.pm<br>
	+++ b/lib/Tcl/pTk/Derived.pm</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">@@ -343,15 +343,14 @@ sub ConfigDefault</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp;Tcl::pTk::catch { $cw-&gt;Tcl::pTk::Widget::cget(&#39;-background&#39;) };</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; my (@bg) = $@ ? (&#39;PASSIVE&#39;) : (&#39;SELF&#39;);</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; push(@bg,&#39;CHILDREN&#39;) if $child;</span></div>


<div>
	<span style="color:#b22222;"><span style="font-family:courier new,courier,monospace;">-&nbsp; &nbsp;my $NORMAL_BG = $^O eq &#39;MSWin32&#39; ? &quot;SystemButtonFace&quot; : &#39;#d9d9d9&#39;; # normal background for different platforms</span></span></div>


<div>
	<span style="color:#b22222;"><span style="font-family:courier new,courier,monospace;">-&nbsp; &nbsp;$specs-&gt;{&#39;-background&#39;} = [\@bg,&#39;background&#39;,&#39;Background&#39;,<strong>$NORMAL_BG</strong>];</span></span></div>


<div>
	<span style="color:#008000;"><span style="font-family:courier new,courier,monospace;">+&nbsp; &nbsp;$specs-&gt;{&#39;-background&#39;} = [\@bg,&#39;background&#39;,&#39;Background&#39;,<strong>undef</strong>];</span></span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp;}</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; unless (exists($specs-&gt;{&#39;-foreground&#39;}))</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp;{</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; Tcl::pTk::catch { $cw-&gt;Tcl::pTk::Widget::cget(&#39;-foreground&#39;) };</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; my (@fg) = $@ ? (&#39;PASSIVE&#39;) : (&#39;SELF&#39;);</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; push(@fg,&#39;CHILDREN&#39;) if $child;</span></div>


<div>
	<span style="color:#b22222;"><span style="font-family:courier new,courier,monospace;">-&nbsp; &nbsp;$specs-&gt;{&#39;-foreground&#39;} = [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,<strong>&#39;BLACK&#39;</strong>];</span></span></div>


<div>
	<span style="color:#008000;"><span style="font-family:courier new,courier,monospace;">+&nbsp; &nbsp;$specs-&gt;{&#39;-foreground&#39;} = [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,<strong>undef</strong>];</span></span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp;}</span></div>


<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; $cw-&gt;ConfigAlias(-fg =&gt; &#39;-foreground&#39;, -bg =&gt; &#39;-background&#39;);</span></div>


<div>
	&nbsp;</div>

<br>

<span style="font-family:arial,helvetica,sans-serif;">In addition to fixing the menu text color issue, it seems to avoid setting colors on <strong>any </strong>UI handled by Derived, allowing it to be consistent with any other UI using default (unset) colors, including what prerelease Tk uses for dark mode. I would appreciate others testing this to see if anything doesn&#39;t look right or gives errors. (I notice that</span><span style="font-family: arial, helvetica, sans-serif;">&nbsp;t</span><span style="font-family:arial,helvetica,sans-serif;">he widgetTclpTk demo uses some text colors and graphics that assume light background colors, and are difficult to read or don&#39;t look right with dark backgrounds.)<br>

<br>

I don&#39;t know yet if this can be considered a proper fix. For example, I don&#39;t know exactly whether existing programs should be able to depend on hardcoded default colors being set by Derived.pm; I want to see if Slaven (Perl/Tk maintainer) is familiar enough with that code to know. I think the bigger problem is that existing programs might specify colors assuming they&#39;ll appear with dark text and light backgrounds,&nbsp;</span><span style="font-family: arial, helvetica, sans-serif;">and won&#39;t look very good if that&#39;s not the case.</span><span style="font-family:arial,helvetica,sans-serif;">&nbsp;So I would probably suggest that, in general, if a specific color isn&#39;t needed, then it should be left unset.</span><br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;06:17:34&nbsp;2019</span>
    <span class="description">welleozean [...] googlemail.com - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129505] macOS Acqua Dark wrong colours in popup menus</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 May 2019 12:17:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tcl-pTk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> welle ozean &lt;welleozean [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Would you please pass me the final version of your patch &#40;just the
snippet&#41;? For some reason I can not reconstruct the change from the above.
I will test it.

Am So., 12. Mai 2019 um 11:50 Uhr schrieb Christopher Alexander Chavez via
RT &lt;bug-Tcl-pTk@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129505">https://rt.cpan.org/Ticket/Display.html?id=129505</a></span> &gt;
&gt;
&gt; Thank you for the screenshots and example code, I think that clears up any
&gt; confusion I had. I still can&#39;t explain why running as a script prevents
&gt; dark
&gt; mode from being used; when I run Tcl::pTk as a script with prerelease
&gt; Tcl/Tk
&gt; built with MacPorts&#39; help, it uses dark mode. I would want to double
&gt; check, is
&gt; the script example running the same Tk version &#40;via Tcl.pm&#41; as what your
&gt; app
&gt; bundle contains, or is it different, e.g. a Tcl/Tk distribution? I
&gt; understand
&gt; that might indeed not be the case; I&#39;m just not sure what else to check.
&gt;
&gt; Now for the update I wanted to provide on the issue itself
&gt;
&gt; In the past I had tried various combinations of commenting out lines in the
&gt; responsible code, or tweaking what defaults were being set, and would
&gt; usually
&gt; end up with fatal errors. But I may have finally found something that
&gt; works:
&gt;
&gt; diff --git a/lib/Tcl/pTk/Derived.pm b/lib/Tcl/pTk/Derived.pm
&gt; index dc2e006..75840fa 100644
&gt; --- a/lib/Tcl/pTk/Derived.pm
&gt; +++ b/lib/Tcl/pTk/Derived.pm@@ -343,15 +343,14 @@ sub ConfigDefault
&gt; Tcl::pTk::catch { $cw-&gt;Tcl::pTk::Widget::cget&#40;&#39;-background&#39;&#41; }; my &#40;@bg&#41; =
&gt; $@ ?
&gt; &#40;&#39;PASSIVE&#39;&#41; : &#40;&#39;SELF&#39;&#41;; push&#40;@bg,&#39;CHILDREN&#39;&#41; if $child;- my $NORMAL_BG =
&gt; $^O eq
&gt; &#39;MSWin32&#39; ? &#34;SystemButtonFace&#34; : &#39;#d9d9d9&#39;; # normal background for
&gt; different
&gt; platforms- $specs-&gt;{&#39;-background&#39;} =
&gt; [\@bg,&#39;background&#39;,&#39;Background&#39;,$NORMAL_BG];+
&gt; $specs-&gt;{&#39;-background&#39;} = [\@bg,&#39;background&#39;,&#39;Background&#39;,undef]; } unless
&gt; &#40;exists&#40;$specs-&gt;{&#39;-foreground&#39;}&#41;&#41; { Tcl::pTk::catch {
&gt; $cw-&gt;Tcl::pTk::Widget::cget&#40;&#39;-foreground&#39;&#41; }; my &#40;@fg&#41; = $@ ? &#40;&#39;PASSIVE&#39;&#41; :
&gt; &#40;&#39;SELF&#39;&#41;; push&#40;@fg,&#39;CHILDREN&#39;&#41; if $child;- $specs-&gt;{&#39;-foreground&#39;} =
&gt; [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,&#39;BLACK&#39;];+ $specs-&gt;{&#39;-foreground&#39;} =
&gt; [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,undef]; } $cw-&gt;ConfigAlias&#40;-fg =&gt;
&gt; &#39;-foreground&#39;, -bg =&gt; &#39;-background&#39;&#41;;
&gt; In addition to fixing the menu text color issue, it seems to avoid setting
&gt; colors on any UI handled by Derived, allowing it to be consistent with any
&gt; other UI using default &#40;unset&#41; colors, including what prerelease Tk uses
&gt; for
&gt; dark mode. I would appreciate others testing this to see if anything
&gt; doesn&#39;t
&gt; look right or gives errors. &#40;I notice that the widgetTclpTk demo uses some
&gt; text
&gt; colors and graphics that assume light background colors, and are difficult
&gt; to
&gt; read or don&#39;t look right with dark backgrounds.&#41;
&gt;
&gt; I don&#39;t know yet if this can be considered a proper fix. For example, I
&gt; don&#39;t
&gt; know exactly whether existing programs should be able to depend on
&gt; hardcoded
&gt; default colors being set by Derived.pm; I want to see if Slaven &#40;Perl/Tk
&gt; maintainer&#41; is familiar enough with that code to know. I think the bigger
&gt; problem is that existing programs might specify colors assuming they&#39;ll
&gt; appear
&gt; with dark text and light backgrounds, and won&#39;t look very good if that&#39;s
&gt; not
&gt; the case. So I would probably suggest that, in general, if a specific color
&gt; isn&#39;t needed, then it should be left unset.
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;06:22:13&nbsp;2019</span>
    <span class="description">welleozean [...] googlemail.com - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129505] macOS Acqua Dark wrong colours in popup menus</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 May 2019 12:21:46 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tcl-pTk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> welle ozean &lt;welleozean [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">PS: yes, executable and script use the very same Tcl.frameworks and
Tk.frameworks. I set them at the beginning of my script &#40;this is the only
solution I found to make Tcl.pm link to a given installation&#41;.

Am So., 12. Mai 2019 um 12:17 Uhr schrieb welle ozean &lt;
welleozean@googlemail.com&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Would you please pass me the final version of your patch &#40;just the
&gt; snippet&#41;? For some reason I can not reconstruct the change from the above.
&gt; I will test it.
&gt;
&gt; Am So., 12. Mai 2019 um 11:50 Uhr schrieb Christopher Alexander Chavez via
&gt; RT &lt;bug-Tcl-pTk@rt.cpan.org&gt;:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129505">https://rt.cpan.org/Ticket/Display.html?id=129505</a></span> &gt;
&gt;&gt;
&gt;&gt; Thank you for the screenshots and example code, I think that clears up any
&gt;&gt; confusion I had. I still can&#39;t explain why running as a script prevents
&gt;&gt; dark
&gt;&gt; mode from being used; when I run Tcl::pTk as a script with prerelease
&gt;&gt; Tcl/Tk
&gt;&gt; built with MacPorts&#39; help, it uses dark mode. I would want to double
&gt;&gt; check, is
&gt;&gt; the script example running the same Tk version &#40;via Tcl.pm&#41; as what your
&gt;&gt; app
&gt;&gt; bundle contains, or is it different, e.g. a Tcl/Tk distribution? I
&gt;&gt; understand
&gt;&gt; that might indeed not be the case; I&#39;m just not sure what else to check.
&gt;&gt;
&gt;&gt; Now for the update I wanted to provide on the issue itself
&gt;&gt;
&gt;&gt; In the past I had tried various combinations of commenting out lines in
&gt;&gt; the
&gt;&gt; responsible code, or tweaking what defaults were being set, and would
&gt;&gt; usually
&gt;&gt; end up with fatal errors. But I may have finally found something that
&gt;&gt; works:
&gt;&gt;
&gt;&gt; diff --git a/lib/Tcl/pTk/Derived.pm b/lib/Tcl/pTk/Derived.pm
&gt;&gt; index dc2e006..75840fa 100644
&gt;&gt; --- a/lib/Tcl/pTk/Derived.pm
&gt;&gt; +++ b/lib/Tcl/pTk/Derived.pm@@ -343,15 +343,14 @@ sub ConfigDefault
&gt;&gt; Tcl::pTk::catch { $cw-&gt;Tcl::pTk::Widget::cget&#40;&#39;-background&#39;&#41; }; my &#40;@bg&#41;
&gt;&gt; = $@ ?
&gt;&gt; &#40;&#39;PASSIVE&#39;&#41; : &#40;&#39;SELF&#39;&#41;; push&#40;@bg,&#39;CHILDREN&#39;&#41; if $child;- my $NORMAL_BG =
&gt;&gt; $^O eq
&gt;&gt; &#39;MSWin32&#39; ? &#34;SystemButtonFace&#34; : &#39;#d9d9d9&#39;; # normal background for
&gt;&gt; different
&gt;&gt; platforms- $specs-&gt;{&#39;-background&#39;} =
&gt;&gt; [\@bg,&#39;background&#39;,&#39;Background&#39;,$NORMAL_BG];+
&gt;&gt; $specs-&gt;{&#39;-background&#39;} = [\@bg,&#39;background&#39;,&#39;Background&#39;,undef]; } unless
&gt;&gt; &#40;exists&#40;$specs-&gt;{&#39;-foreground&#39;}&#41;&#41; { Tcl::pTk::catch {
&gt;&gt; $cw-&gt;Tcl::pTk::Widget::cget&#40;&#39;-foreground&#39;&#41; }; my &#40;@fg&#41; = $@ ? &#40;&#39;PASSIVE&#39;&#41;
&gt;&gt; :
&gt;&gt; &#40;&#39;SELF&#39;&#41;; push&#40;@fg,&#39;CHILDREN&#39;&#41; if $child;- $specs-&gt;{&#39;-foreground&#39;} =
&gt;&gt; [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,&#39;BLACK&#39;];+ $specs-&gt;{&#39;-foreground&#39;} =
&gt;&gt; [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,undef]; } $cw-&gt;ConfigAlias&#40;-fg =&gt;
&gt;&gt; &#39;-foreground&#39;, -bg =&gt; &#39;-background&#39;&#41;;
&gt;&gt; In addition to fixing the menu text color issue, it seems to avoid setting
&gt;&gt; colors on any UI handled by Derived, allowing it to be consistent with any
&gt;&gt; other UI using default &#40;unset&#41; colors, including what prerelease Tk uses
&gt;&gt; for
&gt;&gt; dark mode. I would appreciate others testing this to see if anything
&gt;&gt; doesn&#39;t
&gt;&gt; look right or gives errors. &#40;I notice that the widgetTclpTk demo uses
&gt;&gt; some text
&gt;&gt; colors and graphics that assume light background colors, and are
&gt;&gt; difficult to
&gt;&gt; read or don&#39;t look right with dark backgrounds.&#41;
&gt;&gt;
&gt;&gt; I don&#39;t know yet if this can be considered a proper fix. For example, I
&gt;&gt; don&#39;t
&gt;&gt; know exactly whether existing programs should be able to depend on
&gt;&gt; hardcoded
&gt;&gt; default colors being set by Derived.pm; I want to see if Slaven &#40;Perl/Tk
&gt;&gt; maintainer&#41; is familiar enough with that code to know. I think the bigger
&gt;&gt; problem is that existing programs might specify colors assuming they&#39;ll
&gt;&gt; appear
&gt;&gt; with dark text and light backgrounds, and won&#39;t look very good if that&#39;s
&gt;&gt; not
&gt;&gt; the case. So I would probably suggest that, in general, if a specific
&gt;&gt; color
&gt;&gt; isn&#39;t needed, then it should be left unset.
&gt;&gt;
&gt;&gt;
</div></div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;06:29:32&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">On Sun May 12 05:17:34 2019, welleozean@googlemail.com wrote:<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Would you please pass me the final version of your patch (just the<br>

&gt; snippet)? For some reason I can not reconstruct the change from the<br>

&gt; above.<br>

&gt; I will test it.<br>
</div><br>

I have added a patch based off release-0.96 it as an attachment. I have also pushed it to a temporary branch &quot;rt-125049&quot; on GitHub:&nbsp;<a href="https://github.com/chrstphrchvz/perl-tcl-ptk/commit/0b8191e"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/chrstphrchvz/perl-tcl-ptk/commit/0b8191e">https://github.com/chrstphrchvz/perl-tcl-ptk/commit/0b8191e</a></span></a><br>

<br>

Just a heads up, the change in appearance may seem quite drastic!</span>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt125049.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git lib/Tcl/pTk/Derived.pm lib/Tcl/pTk/Derived.pm
index dc2e006..75840fa 100644
--- lib/Tcl/pTk/Derived.pm
+++ lib/Tcl/pTk/Derived.pm
@@ -332,7 +332,7 @@ sub ConfigDefault
  #
  # $specs-&gt;{&#39;-cursor&#39;} = [&#39;SELF&#39;,undef,undef,undef] unless &#40;exists $specs-&gt;{&#39;-cursor&#39;}&#41;;
 
- # Now some hacks that cause colours to propogate down a composite widget
+ # Now some hacks that cause colours to propagate down a composite widget
  # tree - really needs more thought, other options adding such as active
  # colours too and maybe fonts
 
@@ -343,15 +343,14 @@ sub ConfigDefault
   Tcl::pTk::catch { $cw-&gt;Tcl::pTk::Widget::cget&#40;&#39;-background&#39;&#41; };
    my &#40;@bg&#41; = $@ ? &#40;&#39;PASSIVE&#39;&#41; : &#40;&#39;SELF&#39;&#41;;
    push&#40;@bg,&#39;CHILDREN&#39;&#41; if $child;
-   my $NORMAL_BG = $^O eq &#39;MSWin32&#39; ? &#34;SystemButtonFace&#34; : &#39;#d9d9d9&#39;; # normal background for different platforms
-   $specs-&gt;{&#39;-background&#39;} = [\@bg,&#39;background&#39;,&#39;Background&#39;,$NORMAL_BG];
+   $specs-&gt;{&#39;-background&#39;} = [\@bg,&#39;background&#39;,&#39;Background&#39;,undef];
   }
  unless &#40;exists&#40;$specs-&gt;{&#39;-foreground&#39;}&#41;&#41;
   {
    Tcl::pTk::catch { $cw-&gt;Tcl::pTk::Widget::cget&#40;&#39;-foreground&#39;&#41; };
    my &#40;@fg&#41; = $@ ? &#40;&#39;PASSIVE&#39;&#41; : &#40;&#39;SELF&#39;&#41;;
    push&#40;@fg,&#39;CHILDREN&#39;&#41; if $child;
-   $specs-&gt;{&#39;-foreground&#39;} = [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,&#39;BLACK&#39;];
+   $specs-&gt;{&#39;-foreground&#39;} = [\@fg,&#39;foreground&#39;,&#39;Foreground&#39;,undef];
   }
  $cw-&gt;ConfigAlias&#40;-fg =&gt; &#39;-foreground&#39;, -bg =&gt; &#39;-background&#39;&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;12&nbsp;09:45:34&nbsp;2019</span>
    <span class="description">welleozean [...] googlemail.com - Ticket #129505:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129505] macOS Acqua Dark wrong colours in popup menus</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 May 2019 15:45:14 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tcl-pTk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> welle ozean &lt;welleozean [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Your fix seems to work fine, at least in my application everything is
rendered properly.

Am So., 12. Mai 2019 um 12:29 Uhr schrieb Christopher Alexander Chavez via
RT &lt;bug-Tcl-pTk@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129505">https://rt.cpan.org/Ticket/Display.html?id=129505</a></span> &gt;
&gt;
&gt; On Sun May 12 05:17:34 2019, welleozean@googlemail.com wrote:
<div class="message-stanza open">&gt; &gt; Would you please pass me the final version of your patch &#40;just the
&gt; &gt; snippet&#41;? For some reason I can not reconstruct the change from the
&gt; &gt; above.
&gt; &gt; I will test it.
</div>&gt;
&gt; I have added a patch based off release-0.96 it as an attachment. I have
&gt; also
&gt; pushed it to a temporary branch &#34;rt-125049&#34; on GitHub:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/chrstphrchvz/perl-tcl-ptk/commit/0b8191e">https://github.com/chrstphrchvz/perl-tcl-ptk/commit/0b8191e</a></span>
&gt;
&gt; Just a heads up, the change in appearance may seem quite drastic!
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;01:44:57&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org - Ticket #129505:  Merged into ticket #125049</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;01:44:57&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Merged into ticket #125049</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;02:01:29&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span style="font-family:arial,helvetica,sans-serif;">Welle, thank you for testing the fix I proposed. I have incorporated it into Tcl::pTk 1.00, but I still don&#39;t know if there&#39;s any issues introduced by it. I have opened a pull request to try incorporating the change back into Perl/Tk for consistency:&nbsp;<a href="https://github.com/eserte/perl-tk/pull/52"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/eserte/perl-tk/pull/52">https://github.com/eserte/perl-tk/pull/52</a></span></a>&nbsp;<br>

<br>

<br>

As I wrote on comp.lang.tcl, there is a more &quot;official&quot; solution for determining if dark mode is in use (as well as forcing dark or light mode to be used) using Tcl syntax, available in recent core-9-6-branch, and should appear in Tk 8.6.10; it is described in the macosx/README.</span><br>

<br>


<div>
	<span style="font-family:arial,helvetica,sans-serif;">To get the current appearance of a window as a boolean value:</span></div>


<div>
	&nbsp;</div>


<div>
	<span style="font-family:courier new,courier,monospace;">tk::unsupported::MacWindowStyle isdark window</span></div>


<div>
	&nbsp;</div>


<div>
	&nbsp;</div>


<div>
	<span style="font-family:arial,helvetica,sans-serif;">To get/set the appearance as <span style="font-family:courier new,courier,monospace;">aqua</span>/<span style="font-family:courier new,courier,monospace;">darkaqua</span>/<span style="font-family:courier new,courier,monospace;">auto</span>:</span></div>


<div>
	&nbsp;</div>


<div>
	<span style="font-family:courier new,courier,monospace;">tk::unsupported::MacWindowStyle appearance window ?newAppearance?</span></div>

<br>

<br>

<span style="font-family:arial,helvetica,sans-serif;">I would prefer these commands over the <span style="font-family:courier new,courier,monospace;">defaults read -g AppleInterfaceStyle</span>&nbsp;shell command, because it actually reflects the appearance of a running Tk application rather than merely what is set in System Preferences.</span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;02:01:30&nbsp;2019</span>
    <span class="description">CAC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;03:46:07&nbsp;2020</span>
    <span class="description">CAC [...] cpan.org -  Fixed in 1.00 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
