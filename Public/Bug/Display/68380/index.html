<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68380 for FCGI: FCGI-0.70 to 0.72 with perl5.12: CGI.pm receives CGI variables from previous requests</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68380 for FCGI: FCGI-0.70 to 0.72 with perl5.12: CGI.pm receives CGI variables from previous requests</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=FCGI">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=FCGI">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=FCGI">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=FCGI">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/FCGI">FCGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68380</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=FCGI">FCGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ssinyagin [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
dam [...] cpan.org

<br />
jquelin [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-12604-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.70</li>
<li>
0.71</li>
<li>
0.71_01</li>
<li>
0.71_02</li>
<li>
0.71_03</li>
<li>
0.72</li>
<li>
0.73</li>
</ul>
    </td>
  </tr>
  <tr id="CF-12605-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




FCGI-0.73-ssinyagin-20110605.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/942567/490060/FCGI-0.73-ssinyagin-20110605.patch">
Sun Jun 05 16:54:34 2011 (951b) by ssinyagin [...] yahoo.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=68380">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-937927" href="/Public/Bug/Display.html?id=68380#txn-937927">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;22&nbsp;12:28:07&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> FCGI-0.70 to 0.72 with perl5.12: CGI.pm receives CGI variables
 from previous requests</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/937927/487001/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487001">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 712b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">hi,

I&#39;m using FCGI in Torrus, here&#39;s the code:
<span class="clickylink"><a target="new" rel="nofollow" href="http://goo.gl/Gr0oW">http://goo.gl/Gr0oW</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://goo.gl/uYBN5">http://goo.gl/uYBN5</a></span>

I installed  perl 5.12.3 from sources, and also the latest FCGI.pm. 
CGI.pm version: 3.49

The problem is reproducible in FCGI-0.70 , 0.71, 0.72.

Problem: often CGI.pm receives CGI variables from previous requests, and
 $q-&gt;url&#40;-path =&gt; 1&#41; shows a request which was executed before.

The problem is visible when more than one FastCGI processes are
launched. With only one FastCGI handler, the problem is not seen.

The server runs Apache with mod_fastcgi &#40;Ubuntu package:
libapache2-mod-fastcgi 2.4.6-1&#41;.

Downgrading to FCGI-0.69 has solved the problem, although perl is
complaining about defined&#40;%hash&#41; statements.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938226" href="/Public/Bug/Display.html?id=68380#txn-938226">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;23&nbsp;06:07:43&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/938226/487159/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487159">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 70b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I reproduced the same problem on a Redhat server with Apache+mod_fcgid
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938228" href="/Public/Bug/Display.html?id=68380#txn-938228">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;23&nbsp;06:07:44&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938391" href="/Public/Bug/Display.html?id=68380#txn-938391">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;23&nbsp;16:33:19&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/938391/487246/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487246">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 342b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Is it reproducible with a mimimal script such as:

#!/usr/bin/perl

use strict;
use warnings;

use CGI::Fast;

while &#40;my $q = CGI::Fast-&gt;new&#41; {
    print $q-&gt;header&#40;-type =&gt; &#39;text/plain&#39;&#41;,
          $q-&gt;url&#40;-path =&gt; 1&#41;, &#34;\n&#34;;
}

Could you also try with the latest CGI.pm version?

Output of perl -V might prove helpful also.

--
chansen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938962" href="/Public/Bug/Display.html?id=68380#txn-938962">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;15:26:49&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/938962/488093/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488093">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 95b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Strange, chansen, I can&#39;t reproduce it with this little script -- it
prints the URL as expected
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938983" href="/Public/Bug/Display.html?id=68380#txn-938983">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;17:04:11&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/938983/488105/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488105">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">For some reason the global hash was not working as expected. This patch
replaces it with a global hashref. Tests show behavior as expected:

diff --git a/perl/FCGI.PL b/perl/FCGI.PL
index 746aaf3..ce0d70b 100644
--- a/perl/FCGI.PL
+++ b/perl/FCGI.PL
@@ -295,14 +295,14 @@ sub Request&#40;;***$*$&#41; {
 
 sub accept&#40;&#41; {
     warn &#34;accept called as a method; you probably wanted to call
Accept&#34; if @_;
-    if &#40;%FCGI::ENV&#41; {
-        %ENV = %FCGI::ENV;
+    if &#40;defined $FCGI::ENV&#41; {
+        %ENV = %$FCGI::ENV;
     } else {
-        %FCGI::ENV = %ENV;
+        $FCGI::ENV = {%ENV};
     }
     my $rc = Accept&#40;$global_request&#41;;
-    for &#40;keys %FCGI::ENV&#41; {
-        $ENV{$_} = $FCGI::ENV{$_} unless exists $ENV{$_};
+    for &#40;keys %$FCGI::ENV&#41; {
+        $ENV{$_} = $FCGI::ENV-&gt;{$_} unless exists $ENV{$_};
     }
 
     # not SFIO
@@ -314,7 +314,7 @@ sub accept&#40;&#41; {
 
 sub finish&#40;&#41; {
     warn &#34;finish called as a method; you probably wanted to call
Finish&#34; if @_;
-    %ENV = %FCGI::ENV if %FCGI::ENV;
+    %ENV = %$FCGI::ENV if &#40;defined $FCGI::ENV&#41;;
 
     # not SFIO
     if &#40;tied &#40;*STDIN&#41;&#41; {
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939335" href="/Public/Bug/Display.html?id=68380#txn-939335">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;25&nbsp;12:57:29&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/939335/488290/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488290">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 267b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m a bit confused, first you said you couldn&#39;t reproduce the issue with the script i sent, then 
later you said &#34;For some reason the global hash was not working as expected.&#34;.

We need a reproducible case before we can accept any patches for this issue.

--
chansen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939338" href="/Public/Bug/Display.html?id=68380#txn-939338">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;25&nbsp;13:05:24&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68380] FCGI-0.70 to 0.72 with perl5.12: CGI.pm receives CGI variables from previous requests </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 25 May 2011 10:05:16 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-FCGI [...] rt.cpan.org&#34; &lt;bug-FCGI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stanislav Sinyagin &lt;ssinyagin [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/939338/488293/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488293">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 381b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I could not reproduce it with a small script like yours, but it was reproducible in my Torrus installation.


FCGI performs some manipulations with environment variables which are not quite clear to me, so I can&#39;t really analyze what&#39;s going on in it. 

In the FCGI Git repository &#40;git://git.shadowcat.co.uk/catagits/fcgi2.git&#41; the commit that breaks the functionality is 03e35f7.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-940585" href="/Public/Bug/Display.html?id=68380#txn-940585">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;30&nbsp;18:13:36&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/940585/488973/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488973">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 195b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">We have been unsuccessful with reproducing your reported issue, using persistent and non-
persistent connections. Unless a minimal test-case is provided this report will be rejected.

--
chansen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-940588" href="/Public/Bug/Display.html?id=68380#txn-940588">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;30&nbsp;18:16:01&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-940769" href="/Public/Bug/Display.html?id=68380#txn-940769">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;31&nbsp;04:31:07&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68380] FCGI-0.70 to 0.72 with perl5.12: CGI.pm receives CGI variables from previous requests </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 31 May 2011 01:30:58 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-FCGI [...] rt.cpan.org&#34; &lt;bug-FCGI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stanislav Sinyagin &lt;ssinyagin [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/940769/489067/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489067">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 118b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">well, a full Torrus installation would be a bit too much effort.
I&#39;ll try to produce a test case within few days.



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/940769/489068/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489068">with headers</a>
<br />
<span class="downloadcontenttype">text/html 612b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-940771" href="/Public/Bug/Display.html?id=68380#txn-940771">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;31&nbsp;04:31:09&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942567" href="/Public/Bug/Display.html?id=68380#txn-942567">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;05&nbsp;16:54:34&nbsp;2011</span>
    <span class="description">ssinyagin [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/942567/490059/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490059">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I managed to reproduce it.
test script:
============
#!/opt/nmstools/thirdparty/bin/perl
use lib &#39;/opt/nmstools/src/tmp/fcgi2/perl/blib/lib&#39;;
use lib &#39;/opt/nmstools/src/tmp/fcgi2/perl/blib/arch&#39;;
use strict;
use warnings;
use CGI::Fast;
while &#40;my $q = new CGI::Fast&#41;
{
    print $q-&gt;header&#40;-type =&gt; &#39;text/plain&#39;&#41;;
    print $FCGI::VERSION, &#34;\n&#34;,
    $q-&gt;param&#40;&#39;a&#39;&#41;, &#34;\n&#34;,
    $q-&gt;url&#40;-path =&gt; 1&#41;, &#34;\n&#34;;
}
==================

Apache configuration:
=========
AddHandler fcgid-script .fcgi
ScriptAlias /torrus/xxx &#34;/opt/nmstools/src/tmp/fcgitest.fcgi&#34;
&lt;Location /torrus&gt;
 Order           Allow,Deny
 Allow           from all
 Options +ExecCGI
&lt;/Location&gt;
=========

First, I access the following URL, and the printed output is as expected:
<span class="clickylink"><a target="new" rel="nofollow" href="http://HOST/torrus/xxx/ff?a=ddd">http://HOST/torrus/xxx/ff?a=ddd</a></span>
Then I access the following URL:
<span class="clickylink"><a target="new" rel="nofollow" href="http://HOST/torrus/xxx">http://HOST/torrus/xxx</a></span>
and the script prints: 
==========
0.73

<span class="clickylink"><a target="new" rel="nofollow" href="http://HOST/torrus/xxx/ff">http://HOST/torrus/xxx/ff</a></span>
==========

Expected result would be the &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://HOST/torrus/xxx">http://HOST/torrus/xxx</a></span>&#34;. 
Attached, see the patch against 0.73 without any broken linebreaks. It
solves the problem, but it&#39;s still not completely clear how the logic
behind %ENV manipulation works in FCGI.pm

cheers,
stanislav
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> FCGI-0.73-ssinyagin-20110605.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/942567/490060/FCGI-0.73-ssinyagin-20110605.patch">Download FCGI-0.73-ssinyagin-20110605.patch</a><br />
<span class="downloadcontenttype">text/x-diff 951b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/perl/FCGI.PL b/perl/FCGI.PL
index 746aaf3..ce0d70b 100644
--- a/perl/FCGI.PL
+++ b/perl/FCGI.PL
@@ -295,14 +295,14 @@ sub Request&#40;;***$*$&#41; {
 
 sub accept&#40;&#41; {
     warn &#34;accept called as a method; you probably wanted to call Accept&#34; if @_;
-    if &#40;%FCGI::ENV&#41; {
-        %ENV = %FCGI::ENV;
+    if &#40;defined $FCGI::ENV&#41; {
+        %ENV = %$FCGI::ENV;
     } else {
-        %FCGI::ENV = %ENV;
+        $FCGI::ENV = {%ENV};
     }
     my $rc = Accept&#40;$global_request&#41;;
-    for &#40;keys %FCGI::ENV&#41; {
-        $ENV{$_} = $FCGI::ENV{$_} unless exists $ENV{$_};
+    for &#40;keys %$FCGI::ENV&#41; {
+        $ENV{$_} = $FCGI::ENV-&gt;{$_} unless exists $ENV{$_};
     }
 
     # not SFIO
@@ -314,7 +314,7 @@ sub accept&#40;&#41; {
 
 sub finish&#40;&#41; {
     warn &#34;finish called as a method; you probably wanted to call Finish&#34; if @_;
-    %ENV = %FCGI::ENV if %FCGI::ENV;
+    %ENV = %$FCGI::ENV if &#40;defined $FCGI::ENV&#41;;
 
     # not SFIO
     if &#40;tied &#40;*STDIN&#41;&#41; {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975339" href="/Public/Bug/Display.html?id=68380#txn-975339">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;10:40:21&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/975339/507599/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/507599">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 115b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">There is quite good analysis in the Debian bug report about the same
issue, <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/607479">http://bugs.debian.org/607479</a></span>

--
  dam
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975342" href="/Public/Bug/Display.html?id=68380#txn-975342">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;10:40:59&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Broken in 0.71 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975343" href="/Public/Bug/Display.html?id=68380#txn-975343">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;10:41:00&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Broken in 0.71_01 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975344" href="/Public/Bug/Display.html?id=68380#txn-975344">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;10:41:00&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Broken in 0.71_02 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975345" href="/Public/Bug/Display.html?id=68380#txn-975345">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;10:41:00&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Broken in 0.71_03 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975346" href="/Public/Bug/Display.html?id=68380#txn-975346">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;10:41:00&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Broken in 0.72 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975347" href="/Public/Bug/Display.html?id=68380#txn-975347">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;10:41:00&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Broken in 0.73 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975473" href="/Public/Bug/Display.html?id=68380#txn-975473">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;16:42:33&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Cc DAM added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-976497" href="/Public/Bug/Display.html?id=68380#txn-976497">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;02:00:49&nbsp;2011</span>
    <span class="description">iarnell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/976497/508266/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/508266">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 38b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">For the record, this is CVE-2011-2766.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-978737" href="/Public/Bug/Display.html?id=68380#txn-978737">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;18&nbsp;04:08:35&nbsp;2011</span>
    <span class="description">jquelin [...] cpan.org -  Cc JQUELIN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-979695" href="/Public/Bug/Display.html?id=68380#txn-979695">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;20&nbsp;17:39:41&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/979695/510032/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/510032">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 427b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This isn&#39;t really an issue within FCGI package, the API CGI::Fast is using was deprecated 2000-
04-09 with the commit &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi">http://git.shadowcat.co.uk/gitweb/gitweb.cgi</a></span>?
p=catagits/fcgi2.git;a=commit;f=perl/oldinterface.pod;h=d2900ee847a5f541f30ca6cd47cc07a
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">2833a7f4a&gt;.
</div>
We recognize the usage of CGI::Fast package and will merge the proposed fix and notify the 
CGI.pm developers that they are using a deprecated API.

--
chansen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-981060" href="/Public/Bug/Display.html?id=68380#txn-981060">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;10:28:03&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/981060/510833/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/510833">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 258b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch has been applied [1] and a new release has been released on CPAN [2].

[1] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi">http://git.shadowcat.co.uk/gitweb/gitweb.cgi</a></span>?
p=catagits/fcgi2.git;a=commitdiff;h=297693dc8362d25bb25e473899c72508a0f71d2e&gt;

[2] <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/FCGI/">http://search.cpan.org/dist/FCGI/</a></span>

--
chansen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-981063" href="/Public/Bug/Display.html?id=68380#txn-981063">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;10:28:04&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.860847</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
