<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #3789 for POE-Exceptions: POE::Exceptions tests and sig_handled</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #3789 for POE-Exceptions: POE::Exceptions tests and sig_handled</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/POE-Exceptions/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/POE-Exceptions/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/POE-Exceptions/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/POE-Exceptions/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/POE-Exceptions">POE-Exceptions CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">3789</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/POE-Exceptions/Active/">POE-Exceptions</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">SUNGO [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gbjk [...] thermeon.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26702-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26703-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;15&nbsp;10:31:38&nbsp;2003</span>
    <span class="description">gbjk [...] thermeon.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Gareth Kirwan&#34; &lt;gbjk [...] thermeoneurope.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;eek+cpan [...] eekeek.org&gt;, &lt;bug-POE-Exceptions [...] rt.cpan.org&gt;, &lt;sungo [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> POE::Exceptions tests and sig_handled</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 15 Sep 2003 15:33:33 +0100</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When using POE::Exceptions I noticed that the DIE handler was acting as if
it didn&#39;t return 1.
After checking I noted that now I should be using $_[KERNEL]-&gt;sig_handler.

I was directed to look at the tests, and at that point I realised what the
problem seems to be.

abdigation.t &#40;
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/abdigation.t">http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/abdigation.t</a></span> &#41;
doesn&#39;t test a signal handler returning that it handled the signal with
sig_handled.
It&#39;s just there to test that if a handler doesn&#39;t return handled then the
eval picks it up.

signal_handler.t &#40;
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/signal_handler.t">http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/signal_handler.t</a></span> &#41;
doesn&#39;t check that the unhandled exception it&#39;s catching with the eval is
the second die:
    die &#34;this die will be handled, too&#34;;
and not the first one:
    die &#34;this die should be handled&#34;;

I added a check at the bottom and $@ is reporting an unhandled exception for
the first die, which should have been reported as handled by the sig_handled
at the end of &#38;death_handled.

In other words:
1&#41; On my system it seems that $_[KERNEL]-&gt;sig_handled&#40;&#41; isn&#39;t stopping the
programme from bailing after than handler has been run &#40; and it is run &#41;.
2&#41; The tests don&#39;t catch this eventuallity.

System is: Linux 2.4.18-14 with Perl 5.8.0.
POE works okay on it&#39;s own so far.

I hope the information I&#39;ve given is correct.

Thanks for your time.

Gareth Kirwan
Programming &#38; Development,
Thermeon Europe Ltd,
gbjk@thermeoneurope.com
Tel: +44 &#40;0&#41; 1293 864 303
Thermeon Europe e-Card: gbjk
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;21:46:20&nbsp;2003</span>
    <span class="description">SUNGO [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;21:55:09&nbsp;2003</span>
    <span class="description">SUNGO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[gbjk@thermeoneurope.com - Mon Sep 15 10:31:38 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; abdigation.t &#40;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/abdigation.t">http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/abdigation.t</a></span> &#41;
&gt; doesn&#39;t test a signal handler returning that it handled the signal with
&gt; sig_handled.
&gt; It&#39;s just there to test that if a handler doesn&#39;t return handled then the
&gt; eval picks it up.
</div>
yes, that&#39;s what the name of the test file is supposed to indicate. this
test file is not testing for what you want it to. it is testing whether
abdigating its signal handling works. the proper place for this test is
in signal_handler.t

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; signal_handler.t &#40;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/signal_handler.t">http://search.cpan.org/src/SUNGO/POE-Exceptions-0.02/t/signal_handler.t</a></span> &#41;
&gt; doesn&#39;t check that the unhandled exception it&#39;s catching with the eval is
</div>
good catch. will be fixing this shortly.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In other words:
&gt; 1&#41; On my system it seems that $_[KERNEL]-&gt;sig_handled&#40;&#41; isn&#39;t stopping the
&gt; programme from bailing after than handler has been run &#40; and it is run &#41;.
&gt; 2&#41; The tests don&#39;t catch this eventuallity.
</div>
well, i was operating on the assumption that poe&#39;s signal handling stuff
works. i will write tests to see where the problem is but if sig_handled
is failing, there&#39;s not a lot i&#39;m going to be able to do to this module
to fix it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;00:16:11&nbsp;2003</span>
    <span class="description">SUNGO [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;00:16:11&nbsp;2003</span>
    <span class="description">SUNGO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">i&#39;ve committed code to hopefully fix the problem and improve
signal_handler.t to catch the problem if it crops up again.

can i talk you into grabbing a cvs checkout and testing to see if it
behaves as you expect?

thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;04:43:14&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gbjk</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; can i talk you into grabbing a cvs checkout and testing to see if it
&gt; behaves as you expect?
</div>
Not a problem... what CVS server ?
I&#39;ve checked the sourceforge one and couldn&#39;t see this module there.

G
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;05:40:44&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Gotcha... sungo.sf.net.
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/cvs/?group_id=82784">http://sourceforge.net/cvs/?group_id=82784</a></span>

However the cvs server is neither responding to the web version or a
normal cvs login.

G
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;09:26:25&nbsp;2003</span>
    <span class="description">SUNGO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Wed Oct  8 05:40:44 2003]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; However the cvs server is neither responding to the web version or a
&gt; normal cvs login.
</div>
sf.net cvs is known to be kinda twitchy about anonymous cvs. it&#39;ll work
eventually tho
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;09&nbsp;12:10:55&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">New issue.

When I press ctrl+c to kill a daemon running in the foreground I get:
Use of uninitialized value in delete at
/usr/local/lib/perl5/site_perl/5.8.0/POE/Resource/SIDs.pm li
ne 76.
The daemon does not then die.
If I have POE::Exceptions loaded.
If I don&#39;t I don&#39;t get an error.

Example attached.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

use strict;
use Socket qw&#40;inet_ntoa&#41;;
use constant PORT =&gt; 32800;
use Inslink;

use POE::Exceptions;
use POE::Wheel::SocketFactory;
use POE::Wheel::ReadWrite;
use POE::Filter::Line;
use POE::Driver::SysRW;
use POE::Component::Client::HTTP;
use POE;

POE::Session-&gt;create&#40;
	inline_states =&gt; {
		_start	=&gt; \&#38;server_start,
		_stop 	=&gt; \&#38;server_stop
		},
	&#41;;

$poe_kernel-&gt;run&#40;&#41;;

exit;

sub server_start {
	
	$_[HEAP]-&gt;{listener} = POE::Wheel::SocketFactory-&gt;new&#40;
				BindAddress	=&gt; &#39;127.0.0.1&#39;,
				BindPort	=&gt; PORT,
				Reuse		=&gt; &#39;yes&#39;,
				SuccessEvent	=&gt; &#39;accept_new_client&#39;,
				FailureEvent	=&gt; &#39;accept_failed&#39;
				&#41;;

	print &#34;SERVER: Started listening on port &#34;. PORT .&#34;\n&#34;;
	}

sub server_stop {
	print &#34;SERVER: Stopped.\n&#34;;
	}

sub accept_new_client {
	my &#40;$socket, $peeraddr, $peerport&#41; = @_[ARG0..ARG2];
	$peeraddr = inet_ntoa&#40;$peeraddr&#41;;
	my $child = POE::Session-&gt;new&#40;
		_start	=&gt; \&#38;child_start,
		_stop	=&gt; \&#38;child_stop,
		&#41;;
	print &#34;SERVER: Got connection from $peeraddr:$peerport.\n&#34;;
	}

sub accept_failed {
	my &#40;$function, $error&#41; = @_[ARG0, ARG2];
	delete $_[HEAP]-&gt;{listener};
	print &#34;SERVER: call to $function&#40;&#41; failed: $error.\n&#34;;
	}

sub child_start {
	}

sub child_stop {

	}

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;17&nbsp;09:25:45&nbsp;2004</span>
    <span class="description">SUNGO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
