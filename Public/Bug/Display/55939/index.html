<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #55939 for Net-Twitter: Malformed UTF-8 character &#40;fatal&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #55939 for Net-Twitter: Malformed UTF-8 character &#40;fatal&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Twitter/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Twitter/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Twitter/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Twitter/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/semifor/Net-Twitter/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Twitter">Net-Twitter CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">55939</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Twitter/Active/">Net-Twitter</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MMIMS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
joe.paxton [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42694-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.12000    </td>
  </tr>
  <tr id="CF-42695-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;25&nbsp;10:52:50&nbsp;2010</span>
    <span class="description">joe.paxton [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Malformed UTF-8 character &#40;fatal&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m receiving the following error when using Net::Twitter 3.12:

Malformed UTF-8 character &#40;fatal&#41; at ./myScript.pl line 340.

Here is line 340:

$myString =~ s/\R/ /g;

$myString contains a string from a public timeline Twitter update
downloaded using $nt-&gt;public_timeline / OAuth.

I&#39;m continuously downloading tweets from the public timeline &#40;using
$nt-&gt;until_rate&#40;&#41; to adjust for rate limits&#41;, and this only happens
about every two or three days -- i.e., only every 500,000 tweets or so.

I&#39;ve been able to perform other search and replace operations on the
string &#40;e.g., $myString =~ s/;/ /g;&#41; without problems. So there seems to
be an interaction between the match done on the \R meta-character, and
the string I&#39;m getting back from Twitter via Net::Twitter.

I&#39;m not sure how to capture the string that causing the problem, given
the fatal error. But if it would help to have the actual string, and if
someone could tell me how to do that, I&#39;d be happy to do so and report back.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;25&nbsp;11:09:29&nbsp;2010</span>
    <span class="description">marc [...] questright.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #55939] Malformed UTF-8 character &#40;fatal&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Mar 2010 08:09:02 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Joe Paxton via RT &lt;bug-Net-Twitter [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Mims &lt;marc [...] questright.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Joe Paxton via RT &lt;bug-Net-Twitter@rt.cpan.org&gt; [100325 07:53]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I&#39;m receiving the following error when using Net::Twitter 3.12:
&gt; 
&gt; Malformed UTF-8 character &#40;fatal&#41; at ./myScript.pl line 340.
&gt; 
&gt; Here is line 340:
&gt; 
&gt; $myString =~ s/\R/ /g;
&gt; 
&gt; $myString contains a string from a public timeline Twitter update
&gt; downloaded using $nt-&gt;public_timeline / OAuth.
&gt; 
&gt; I&#39;m continuously downloading tweets from the public timeline &#40;using
&gt; $nt-&gt;until_rate&#40;&#41; to adjust for rate limits&#41;, and this only happens
&gt; about every two or three days -- i.e., only every 500,000 tweets or so.
&gt; 
&gt; I&#39;ve been able to perform other search and replace operations on the
&gt; string &#40;e.g., $myString =~ s/;/ /g;&#41; without problems. So there seems to
&gt; be an interaction between the match done on the \R meta-character, and
&gt; the string I&#39;m getting back from Twitter via Net::Twitter.
&gt; 
&gt; I&#39;m not sure how to capture the string that causing the problem, given
&gt; the fatal error. But if it would help to have the actual string, and if
&gt; someone could tell me how to do that, I&#39;d be happy to do so and report back.
</div>
You should be able to catch the error in an eval block.  &#40;I prefer
Try::Tiny for that&#41;:

    use Try::Tiny;

    my $status = ...;
    try {
        $myString =~ s/\R/ /g;
    }
    catch {
        warn &#34;Error on status $status-&gt;{id}: $_\n&#34;;
    };

Something like that should report the status in which the error occurs
and we can investigate.

This is probably not a Net::Twitter bug &#40;unless Net::Twitter is
returning something different than Twitter is sending it&#41;, but I&#39;ll keep
it open until we know.

        -Marc
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;25&nbsp;11:09:30&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;25&nbsp;11:10:21&nbsp;2010</span>
    <span class="description">MMIMS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;01&nbsp;00:53:38&nbsp;2010</span>
    <span class="description">joe.paxton [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> joe.paxton [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 25 11:09:29 2010, marc@questright.com wrote: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You should be able to catch the error in an eval block.  &#40;I prefer
&gt; Try::Tiny for that&#41;:
&gt; 
&gt;     use Try::Tiny;
&gt; 
&gt;     my $status = ...;
&gt;     try {
&gt;         $myString =~ s/\R/ /g;
&gt;     }
&gt;     catch {
&gt;         warn &#34;Error on status $status-&gt;{id}: $_\n&#34;;
&gt;     };
&gt; 
&gt; Something like that should report the status in which the error occurs
&gt; and we can investigate.
&gt; 
&gt; This is probably not a Net::Twitter bug &#40;unless Net::Twitter is
&gt; returning something different than Twitter is sending it&#41;, but I&#39;ll
&gt; keep
&gt; it open until we know.
&gt; 
&gt;       -Marc
</div>
Hi Marc,

I was able to catch the error in the way you suggested &#40;thanks for tip&#41;.
Here is the error &#40;actually two errors, but possibly with the same root
cause&#41;:

Error on status 11396609263: Malformed UTF-8 character &#40;fatal&#41; at
./myScript.pl line 344.

&#34;\x{ffff}&#34; does not map to utf8 at ./myScript.pl line 370.

Line 344 is as follows &#40;mentioned previously&#41;:

$myString =~ s/\R/ /g;

And line 370 is just a print command for the same string:

print FH &#34;$myString&#34;;

Just in case it&#39;s relevant, FH is opened for writing at the beginning of
the script in the following way:

open&#40;DATA, &#39;&gt;&gt;:encoding&#40;UTF-8&#41;&#39;, $dataFile&#41; or die $!;

Here&#39;s a link to the relevant Tweet via the Twitter website:

<span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/SunMiHoRa/statuses/11396609263">http://twitter.com/SunMiHoRa/statuses/11396609263</a></span>

Save for the fact that I can&#39;t read Chinese, I don&#39;t see anything
strange there. But perhaps that&#39;s just because the &#34;\x{ffff}&#34; is
non-printable?

In any case, it turns out that the script handles the error in more the
way I want it to when I use the try...catch block &#40;i.e., it doesn&#39;t crap
out&#41;. Thus, I think I&#39;m actually in good shape, now. But I would be
interested to know if you determine the source of the issue I am
experiencing--i.e., whether the source is Twitter itself allowing in
strange characters, Net::Twitter adding or modifying characters, or some
combination of the two. I would suspect the former, were it not for the
fact that the post shows up without issue on the web. But I also have
trouble imagining Net::Twitter would be introducing any of these strange
characters. So I&#39;m a bit confused, but ultimately not too worried. 

-Joe
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;01&nbsp;13:01:45&nbsp;2010</span>
    <span class="description">MMIMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m marking the bug closed since this isn&#39;t a Net::Twitter bug.

Net::Twitter is faithfully returning the status exactly as it was
received from Twitter.

\x{ffff} is an invalid character, but that is, apparently what the
author of the status text posted.

Using an eval block in calling code is the proper way to handle it.  You
may want to ignore statuses with invalid characters, remove the invalid
characters, or handle the error in some other way.

Thanks for posting!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;01&nbsp;13:01:47&nbsp;2010</span>
    <span class="description">MMIMS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
