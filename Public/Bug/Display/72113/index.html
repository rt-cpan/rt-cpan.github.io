<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #72113 for RT-Authen-ExternalAuth: group list membership - with possible patch</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #72113 for RT-Authen-ExternalAuth: group list membership - with possible patch</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=RT-Authen-ExternalAuth">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=RT-Authen-ExternalAuth">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=RT-Authen-ExternalAuth">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=RT-Authen-ExternalAuth">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/RT-Authen-ExternalAuth">RT-Authen-ExternalAuth CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">72113</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=RT-Authen-ExternalAuth">RT-Authen-ExternalAuth</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kiwiroy [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-221202-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.09    </td>
  </tr>
  <tr id="CF-221203-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




rt-authen-externalauth_group-list.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/994977/518120/rt-authen-externalauth_group-list.patch">
Wed Nov 02 02:49:39 2011 (5.9k) by https://www.google.com/accounts/o8/id?id=AItOawm6mqN_GWI3FdLYzSWUXoFefrtzwr-SnZk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=72113">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-994977" href="/Public/Bug/Display.html?id=72113#txn-994977">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;02:49:39&nbsp;2011</span>
    <span class="description">https://www.google.com/accounts/o8/id?id=AItOawm6mqN_GWI3FdLYzSWUXoFefrtzwr-SnZk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> group list membership - with possible patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/994977/518119/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/518119">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 786b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t know if this is a common problem with LDAP, it is with our AD,
but resolving memberships in groups of groups is not possible.  For
example say there is GROUP_A which has multiple members GROUP_X, GROUP_Y
and GROUP_Z &#40;there are no objectClass=user members&#41;. Using GROUP_A in
the $ExternalSettings-&gt;{&#39;MyLDAP&#39;}{&#39;group&#39;} does not authenticate a user
in GROUP_X.  As a result I submit the attached patch which may be of use
to someone/make it into the dist.

The approach is to specify a list of groups &#40;{&#39;MyLDAP&#39;}{&#39;group_list&#39;} =
[qw/GROUP_X GROUP_Y GROUP_Z/]&#41;. The user may be a member of one or all
and both options are available for auth based on the value of
{&#39;MyLDAP&#39;}{&#39;group_list_rule&#39;} &#40;see RT_SiteConfig.pm in patch&#41;.  This may
not be the best solution, so comments welcome.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt-authen-externalauth_group-list.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/994977/518120/rt-authen-externalauth_group-list.patch">Download rt-authen-externalauth_group-list.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/etc/RT_SiteConfig.pm b/etc/RT_SiteConfig.pm
index 4c38a5d..1f80c91 100644
--- a/etc/RT_SiteConfig.pm
+++ b/etc/RT_SiteConfig.pm
@@ -128,6 +128,10 @@ Set&#40;$ExternalSettings,      {   # AN EXAMPLE DB SERVICE
                                                         &#39;net_ldap_args&#39;             =&gt; [    version =&gt;  3   ],
                                                         # Does authentication depend on group membership? What group name?
                                                         &#39;group&#39;                     =&gt;  &#39;GROUP_NAME&#39;,
+                                                        # Does authentication depend on group membership? What group names?
+                                                        &#39;group_list&#39;                =&gt;  [ &#39;GROUP_NAME_1&#39;, &#39;GROUP_NAME_2&#39; ],
+							# Are _all_ the groups required &#40;&#39;and&#39;&#41; or just one &#40;&#39;or&#39;&#41;?
+							&#39;group_list_rule&#39;           =&gt; &#39;or&#39;,
                                                         # What is the attribute for the group object that determines membership?
                                                         &#39;group_attr&#39;                =&gt;  &#39;GROUP_ATTR&#39;,
                                                         ## RT ATTRIBUTE MATCHING SECTION
diff --git a/lib/RT/Authen/ExternalAuth/LDAP.pm b/lib/RT/Authen/ExternalAuth/LDAP.pm
index 885c7dd..750583d 100644
--- a/lib/RT/Authen/ExternalAuth/LDAP.pm
+++ b/lib/RT/Authen/ExternalAuth/LDAP.pm
@@ -18,6 +18,8 @@ sub GetAuth {
     my $base            = $config-&gt;{&#39;base&#39;};
     my $filter          = $config-&gt;{&#39;filter&#39;};
     my $group           = $config-&gt;{&#39;group&#39;};
+    my $group_list      = $config-&gt;{&#39;group_list&#39;} || [];
+    my $group_rule      = lc&#40;$config-&gt;{&#39;group_list_rule&#39;} || &#39;and&#39;&#41;;
     my $group_attr      = $config-&gt;{&#39;group_attr&#39;};
     my $attr_map        = $config-&gt;{&#39;attr_map&#39;};
     my @attrs           = &#40;&#39;dn&#39;&#41;;
@@ -92,47 +94,40 @@ sub GetAuth {
         return 0;
     }
 
-    # The user is authenticated ok, but is there an LDAP Group to check?
-    if &#40;$group&#41; {
-        # If we&#39;ve been asked to check a group...
-        $filter = Net::LDAP::Filter-&gt;new&#40;&#34;&#40;${group_attr}=${ldap_dn}&#41;&#34;&#41;;
-        
-        $RT::Logger-&gt;debug&#40; &#34;LDAP Search === &#34;,
-                            &#34;Base:&#34;,
-                            $base,
-                            &#34;== Filter:&#34;, 
-                            $filter-&gt;as_string,
-                            &#34;== Attrs:&#34;, 
-                            join&#40;&#39;,&#39;,@attrs&#41;&#41;;
-        
-        $ldap_msg = $ldap-&gt;search&#40;  base   =&gt; $group,
-                                    filter =&gt; $filter,
-                                    attrs  =&gt; \@attrs,
-                                    scope  =&gt; &#39;base&#39;&#41;;
-
-        # And the user isn&#39;t a member:
-        unless &#40;$ldap_msg-&gt;code == LDAP_SUCCESS || 
-                $ldap_msg-&gt;code == LDAP_PARTIAL_RESULTS&#41; {
-            $RT::Logger-&gt;critical&#40;  &#34;Search for&#34;, 
-                                    $filter-&gt;as_string, 
-                                    &#34;failed:&#34;,
-                                    ldap_error_name&#40;$ldap_msg-&gt;code&#41;, 
-                                    $ldap_msg-&gt;code&#41;;
+    ref&#40;$group_list&#41; eq &#39;ARRAY&#39; || do { $group_list = []; };
 
-            # Fail auth - jump to next external auth service
-            return 0;
-        }
-
-        unless &#40;$ldap_msg-&gt;count == 1&#41; {
-            $RT::Logger-&gt;info&#40;  $service,
-                                &#34;AUTH FAILED:&#34;, 
-                                $username&#41;;
-                                
-            # Fail auth - jump to next external auth service
-            return 0;
-        }
+    # The user is authenticated ok, but is there an LDAP Group to check?
+    if &#40;$group || @$group_list&#41; {
+	## incase there is only a group, push the group to the list. 
+	## if there is no group, hope there&#39;s a list
+	push @$group_list, $group if $group;
+
+	## sanity check &#39;group_rule&#39;
+	if&#40;$group_rule ne &#39;or&#39; &#38;&#38; $group_rule ne &#39;and&#39;&#41; {
+	    $group_rule = &#39;and&#39;;
+	}
+
+	my $membership = 0;
+	foreach my $group &#40;@$group_list&#41;{
+	    my $member   = _UserIsGroupMember&#40;$ldap, $service, $base, $ldap_dn, $group_attr, $group, $username, @attrs&#41;; 
+	    $membership += $member;
+
+	    ## optimise, bug out as soon as possible
+	    last if $membership  &#38;&#38; $group_rule eq &#39;or&#39;;
+	    last if $member == 0 &#38;&#38; $group_rule eq &#39;and&#39;;
+	}
+	
+	if&#40;&#40;$group_rule eq &#39;or&#39; &#38;&#38; !$membership&#41; ||
+	   &#40;$group_rule eq &#39;and&#39; &#38;&#38; $membership != @$group_list&#41;&#41; {
+	    $RT::Logger-&gt;info&#40;  $service,
+				&#34;AUTH FAILED:&#34;, 
+				$username &#41;;
+	    
+	    # Fail auth - jump to next external auth service
+	    return 0;
+	}
     }
-    
+
     # Any other checks you want to add? Add them here.
 
     # If we&#39;ve survived to this point, we&#39;re good.
@@ -476,4 +471,52 @@ sub _GetBoundLdapObj {
 
 # }}}
 
+# {{{ sub _UserIsGroupMember
+sub _UserIsGroupMember {
+    my &#40;$ldap, $service, $base, $ldap_dn, 
+	$group_attr, $group, $username, @attrs&#41; = @_;
+    my $is_member = 1;
+
+    # If we&#39;ve been asked to check a group...
+    my $filter = Net::LDAP::Filter-&gt;new&#40;&#34;&#40;${group_attr}=${ldap_dn}&#41;&#34;&#41;;
+    
+    $RT::Logger-&gt;debug&#40; &#34;LDAP Search === &#34;,
+			&#34;Base:&#34;,
+			$base,
+			&#34;== Filter:&#34;, 
+			$filter-&gt;as_string,
+			&#34;== Attrs:&#34;, 
+			join&#40;&#39;,&#39;,@attrs&#41;&#41;;
+    
+    my $ldap_msg = $ldap-&gt;search&#40;  base   =&gt; $group,
+				   filter =&gt; $filter,
+				   attrs  =&gt; \@attrs,
+				   scope  =&gt; &#39;base&#39;&#41;;
+    
+    # And the user isn&#39;t a member:
+    unless &#40;$ldap_msg-&gt;code == LDAP_SUCCESS || 
+	    $ldap_msg-&gt;code == LDAP_PARTIAL_RESULTS&#41; {
+	$RT::Logger-&gt;critical&#40;  &#34;Search for&#34;, 
+				$filter-&gt;as_string, 
+				&#34;failed:&#34;,
+				ldap_error_name&#40;$ldap_msg-&gt;code&#41;, 
+				$ldap_msg-&gt;code&#41;;
+	
+	# Fail auth - jump to next external auth service
+	return 0;
+    }
+    
+    unless &#40;$ldap_msg-&gt;count == 1&#41; {
+	$RT::Logger-&gt;info&#40;  $service,
+			    &#34;GROUP MEMBERSHIP FAILED:&#34;, 
+			    $username, &#39;! in&#39;, $group&#41;;
+	
+	return 0;
+    }
+
+    return $is_member;
+}
+
+# }}}
+
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-995294" href="/Public/Bug/Display.html?id=72113#txn-995294">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;19:17:44&nbsp;2011</span>
    <span class="description">falcone [...] bestpractical.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72113] group list membership - with possible patch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 2 Nov 2011 19:17:42 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawm6mqN_GWI3FdLYzSWUXoFefrtzwr-SnZk">https://www.google.com/accounts/o8/id?id=AItOawm6mqN_GWI3FdLYzSWUXoFefrtzwr-SnZk</a></span> via RT&#34; &lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Falcone &lt;falcone [...] bestpractical.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/995294/518310/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/518310">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Nov 02, 2011 at 02:49:40AM -0400, <span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawm6mqN_GWI3FdLYzSWUXoFefrtzwr-SnZk">https://www.google.com/accounts/o8/id?id=AItOawm6mqN_GWI3FdLYzSWUXoFefrtzwr-SnZk</a></span> via RT wrote:

Hi

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Nov 02 02:49:39 2011: Request 72113 was acted upon.
&gt; in GROUP_X.  As a result I submit the attached patch which may be of use
&gt; to someone/make it into the dist.
</div>
The patch came through with some really bizarre line endings.  Would
you be able to regenerate it? A few comments from reading through it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The approach is to specify a list of groups &#40;{&#39;MyLDAP&#39;}{&#39;group_list&#39;} =
&gt; [qw/GROUP_X GROUP_Y GROUP_Z/]&#41;. The user may be a member of one or all
&gt; and both options are available for auth based on the value of
&gt; {&#39;MyLDAP&#39;}{&#39;group_list_rule&#39;} &#40;see RT_SiteConfig.pm in patch&#41;.  This may
&gt; not be the best solution, so comments welcome.
</div>
Is there a reason not to just make group dual life as a string and an
arrayref of strings?

I worry about adding more config options to something that is already
complex and underdocumented.

I also know that at some point in the next month or so, we need to
merge down some of the existing branches &#40;you can see them here&#41;
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/rt-authen-externalauth/branches">https://github.com/bestpractical/rt-authen-externalauth/branches</a></span>
and I&#39;m not sure how well they&#39;ll all merge without looking a lot more
deeply.

You may find it useful to test the multiple emails branch and generate
your diff from that.

Thanks

-kevin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-995297" href="/Public/Bug/Display.html?id=72113#txn-995297">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;19:17:46&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1026178" href="/Public/Bug/Display.html?id=72113#txn-1026178">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;23&nbsp;11:20:27&nbsp;2012</span>
    <span class="description">tsibley [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1026178/535327/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/535327">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 814b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know if this is a common problem with LDAP, it is with our AD,
&gt; but resolving memberships in groups of groups is not possible.  For
&gt; example say there is GROUP_A which has multiple members GROUP_X, 
</div>GROUP_Y
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and GROUP_Z &#40;there are no objectClass=user members&#41;. Using GROUP_A in
&gt; the $ExternalSettings-&gt;{&#39;MyLDAP&#39;}{&#39;group&#39;} does not authenticate a 
</div>user
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; in GROUP_X.  As a result I submit the attached patch which may be of 
</div>use
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; to someone/make it into the dist.
</div>
I suspect you really just want an option to change the scope of the 
group membership check.  Currently it searches just the base, not the 
whole subtree.  This avoids the need to maintain a list of groups.

The list of the groups may be useful in other cases, but your problem is 
better solved with a scope change, I believe.

Thomas
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.295786</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
