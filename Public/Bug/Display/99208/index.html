<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #99208 for Log-Dispatch: Likely bug &#40;and patch&#41; in multithreaded use of Log::Dispatch::Syslog</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #99208 for Log-Dispatch: Likely bug &#40;and patch&#41; in multithreaded use of Log::Dispatch::Syslog</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Log-Dispatch/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Log-Dispatch/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Log-Dispatch/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Log-Dispatch/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/houseabsolute/Log-Dispatch/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Log-Dispatch">Log-Dispatch CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">99208</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Log-Dispatch/Active/">Log-Dispatch</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sergio.fernandez [...] meteologica.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19400-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19401-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.43    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;05:35:18&nbsp;2014</span>
    <span class="description">sergio.fernandez [...] meteologica.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Likely bug &#40;and patch&#41; in multithreaded use of Log::Dispatch::Syslog</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Sep 2014 11:35:00 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Log-Dispatch [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sergio Fernandez &lt;sergio.fernandez [...] meteologica.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Log-Dispatch developers:

I think I have found a bug in *Log::Dispatch::Syslog* module:

   - The problem only shows up in multithreaded execution
   - Whenever I use *log4perl.appender.syslog.lock = 0* I end up having a
   script crash: it looks like two or more threads collide and execution
   breaks down
   - Whenever I use *log4perl.appender.syslog.lock = 1* I get no logging at
   all: there is some kind of lock-related blockage and nothing comes up in
   syslog files; however the script goes on running

I have solved the problem in my environment with 2 small modifications:

   - Declare *Log::Dispatch::Syslog::thread_lock* as *:shared*.
   - Move *lock&#40;$thread_lock&#41;* out of *eval{}* block.

I am attaching the patch for you to check it.

Some of the system information that may be useful to you is below:

*log4perl config:*
log4perl.rootLogger = DEBUG,syslog
log4perl.appender.syslog            = Log::Dispatch::SyslogMeteo
log4perl.appender.syslog.min_level  = debug
log4perl.appender.syslog.ident      = demo
log4perl.appender.syslog.logopt     = cons,pid,ndelay
*log4perl.appender.syslog.lock       = 1*
log4perl.appender.syslog.facility   = local3
log4perl.appender.syslog.layout     = Log::Log4perl::Layout::PatternLayout
log4perl.appender.syslog.layout.ConversionPattern = %p - %m

*# uname -a*
Linux xxxxxxxx 2.6.38-16-server #67~lucid1-Ubuntu SMP Fri Sep 7 18:36:10
UTC 2012 x86_64 GNU/Linux

*# perl -v*
&#40;...&#41;
This is perl, v5.10.1 &#40;*&#41; built for x86_64-linux-gnu-thread-multi
&#40;...&#41;

*# cpanp l Log::Dispatch::Syslog*
Details for &#39;Log::Dispatch::Syslog&#39;
Author                   Dave Rolsky &#40;autarch@urth.org&#41;
Description              None given
Development Stage        Unknown
Installed File           /usr/local/share/perl/5.10.1/Log/Dispatch/Syslog.pm
Interface Style          Unknown
Language Used            Unknown
Package                  Log-Dispatch-2.42.tar.gz
Public License           Unknown
Support Level            Unknown
Version Installed        2.42
Version on CPAN          2.42
Contains:                Log::Dispatch                                 2.42

                         Log::Dispatch::ApacheLog                      2.42

                         Log::Dispatch::Base                           2.42

                         Log::Dispatch::Code                           2.42

                         Log::Dispatch::Email                          2.42

                         Log::Dispatch::Email::MIMELite                2.42

                         Log::Dispatch::Email::MailSend                2.42

                         Log::Dispatch::Email::MailSender              2.42

                         Log::Dispatch::Email::MailSendmail            2.42

                         Log::Dispatch::File                           2.42

                         Log::Dispatch::File::Locked                   2.42

                         Log::Dispatch::Handle                         2.42

                         Log::Dispatch::Null                           2.42

                         Log::Dispatch::Output                         2.42

                         Log::Dispatch::Screen                         2.42

                         Log::Dispatch::Syslog                         2.42


Best regards
--
Sergio Fernández Muñoz &lt;sergio.fernandez@meteologica.com&gt;

Meteológica S.A.
C/ Heliotropo, 5
28029 Madrid

Tel. +34 914 561 001 Ext: 127
Fax. +34 914 561 002

LOPD y LSSI: De acuerdo con la legislación vigente en materia de Protección
de Datos de Carácter Personal &#40;Ley 15/1999 del 13 de Diciembre&#41;, le
informamos que su dirección de correo electrónico y los mensajes que
pudiéramos recibir pasarán a formar parte de un fichero denominado EMAILS,
del que es responsable Meteológica, S.A. Puede ejercer sus derechos de
acceso, cancelación, modificación y oposición en la dirección postal C/
Heliotropo, 5 bajo, 28029 Madrid Tel. 914561001 Fax 914561002. La finalidad
de este fichero es la de realizar una correcta gestión y prestación de los
servicios ofrecidos por Meteológica, S.A. a sus clientes, no cediéndose en
ningún momento los datos facilitados.

This email and any files transmitted with it are confidential and may be
privileged and are intended solely for the use of the individual or entity
to whom they are addressed. If you are not an addressee, any unauthorised
direct or indirect dissemination, distribution, publication or copying of
this message and any attachments is strictly prohibited. If you have
received this email in error please notify the sender immediately, and
delete this email from your system.
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;18&nbsp;15:01:18&nbsp;2014</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;18&nbsp;15:01:19&nbsp;2014</span>
    <span class="description">DROLSKY [...] cpan.org -  Fixed in 2.43 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
