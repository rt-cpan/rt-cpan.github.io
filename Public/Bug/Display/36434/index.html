<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #36434 for AnyEvent: [PATCH] AnyEvent::DNS + any non-perl backend issue on systems without ipv6</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #36434 for AnyEvent: [PATCH] AnyEvent::DNS + any non-perl backend issue on systems without ipv6</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/AnyEvent/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/AnyEvent/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/AnyEvent/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/AnyEvent/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/AnyEvent">AnyEvent CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">36434</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/AnyEvent/Active/">AnyEvent</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
VOVKASM [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-1118-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.12    </td>
  </tr>
  <tr id="CF-1119-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
4.13    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;08:17:17&nbsp;2008</span>
    <span class="description">VOVKASM [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] AnyEvent::DNS + any non-perl backend issue on systems
 without ipv6</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
On my system function socket in AnyEvent/DNS.pm:
socket my $fh6, AF_INET6, &#38;Socket::SOCK_DGRAM, 0;
makes var $fh6 to true value, but without any fileno, it&#39;s works for
Impl::Perl &#40;without any bads&#41;, but dies in Impl::EV for ex.

I&#39;am create copy of core tests &#40;that&#39;s shown trouble&#41; for testing with
EV, they are can be applied with:
cd AnyEvent-4.12; patch -p1 &lt; anyevent-add-evtests.patch

And fix, that work for me, was in testing return value of socket, patch
can be applied with:
cd AnyEvent-4.12; patch -p1 &lt; anyevent-fix.patch

OS: FreeBSD 6.2-RELEASE-p1 #1: Thu Feb 15 17:00:27 MSK 2007 amd64
perl -V:
Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
  Platform:
    osname=freebsd, osvers=6.2-release-p1, archname=amd64-freebsd
    uname=&#39;freebsd zoo.rambler.ru 6.2-release-p1 freebsd 6.2-release-p1
#1: thu feb 15 17:00:27 msk 2007 root@zoo.rambler.ru:usrobjusrsrcsyszoo
amd64 &#39;
    config_args=&#39;-des -Duseshrplib -Uusemymalloc
-Dprefix=/spool/home/vovkasm/perl5.10
-Dprivlib=/spool/home/vovkasm/perl5.10/lib/perl5
-Darchlib=/spool/home/vovkasm/perl5.10/lib/perl5
-Dsitelib=/spool/home/vovkasm/perl5.10/lib/perl5
-Dsitearch=/spool/home/vovkasm/perl5.10/lib/perl5 -Dcccdlflags=-DPIC
-fPIC -Dlibs=-lm -lcrypt -lutil -lc -Dccflags=-fno-strict-aliasing -O
-pipe -Dcf_email=v.timofeev@rambler-co.ru
-Dperladmin=v.timofeev@rambler-co.ru
-Dloclibpth=/spool/home/vovkasm/perl5.10/lib /usr/local/lib
-Dlocincpth=/spool/home/vovkasm/perl5.10/include /usr/local/include -A
lddlflags=-L/spool/home/vovkasm/perl5.10/lib -L/usr/local/lib&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=undef, usemultiplicity=undef
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=define, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-fno-strict-aliasing -O -pipe -DHAS_FPSETMASK
-DHAS_FLOATINGPOINT_H -I/spool/home/vovkasm/perl5.10/include
-I/usr/local/include&#39;,
    optimize=&#39;-O&#39;,
    cppflags=&#39;-fno-strict-aliasing -O -pipe -DHAS_FPSETMASK
-DHAS_FLOATINGPOINT_H -I/spool/home/vovkasm/perl5.10/include
-I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;3.4.6 [FreeBSD] 20060305&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39;-Wl,-E  -L/usr/local/lib&#39;
    libpth=/usr/lib /usr/local/lib
    libs=-lm -lcrypt -lutil -lc
    perllibs=-lm -lcrypt -lutil -lc
    libc=, so=so, useshrplib=true, libperl=libperl.so
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39; 
-Wl,-R/spool/home/vovkasm/perl5.10/lib/perl5/CORE&#39;
    cccdlflags=&#39;-DPIC -fPIC&#39;, lddlflags=&#39;-shared 
-L/spool/home/vovkasm/perl5.10/lib -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: PERL_DONT_CREATE_GVSV PERL_MALLOC_WRAP
USE_64_BIT_ALL
                        USE_64_BIT_INT USE_LARGE_FILES USE_PERLIO
  Built under freebsd
  Compiled at Feb 22 2008 03:41:49
  %ENV:
   
PERL5LIB=&#34;/spool/home/vovkasm/module-install-libs:/spool/home/vovkasm/lib/perl&#34;
  @INC:
    /spool/home/vovkasm/module-install-libs
    /spool/home/vovkasm/lib/perl
    /spool/home/vovkasm/perl5.10/lib/perl5
    /spool/home/vovkasm/perl5.10/lib/perl5
    .
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> anyevent-fix.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Binary files AnyEvent-4.12/lib/AnyEvent/.swp and AnyEvent-4.12-fix/lib/AnyEvent/.swp differ
diff -urN AnyEvent-4.12/lib/AnyEvent/DNS.pm AnyEvent-4.12-fix/lib/AnyEvent/DNS.pm
--- AnyEvent-4.12/lib/AnyEvent/DNS.pm	Tue Jun  3 13:02:23 2008
+++ AnyEvent-4.12-fix/lib/AnyEvent/DNS.pm	Wed Jun  4 15:45:42 2008
@@ -713,11 +713,10 @@
    # try to create a ipv4 and an ipv6 socket
    # only fail when we cnanot create either
 
-   socket my $fh4, AF_INET , &#38;Socket::SOCK_DGRAM, 0;
-   socket my $fh6, AF_INET6, &#38;Socket::SOCK_DGRAM, 0;
+   my $is_fh4 = socket&#40; my $fh4, AF_INET , &#38;Socket::SOCK_DGRAM, 0&#41;;
+   my $is_fh6 = socket&#40; my $fh6, AF_INET6, &#38;Socket::SOCK_DGRAM, 0&#41;;
 
-   $fh4 || $fh6 
-      or Carp::croak &#34;unable to create either an IPv6 or an IPv4 socket&#34;;
+   if &#40;!$is_fh4 &#38;&#38; !$is_fh6&#41; { Carp::croak &#34;unable to create either an IPv6 or an IPv4 socket&#34;; }
 
    my $self = bless {
       server  =&gt; [],
@@ -735,7 +734,7 @@
 
    Scalar::Util::weaken &#40;my $wself = $self&#41;;
 
-   if &#40;$fh4&#41; {
+   if &#40;$is_fh4&#41; {
       AnyEvent::Util::fh_nonblocking $fh4, 1;
       $self-&gt;{fh4} = $fh4;
       $self-&gt;{rw4} = AnyEvent-&gt;io &#40;fh =&gt; $fh4, poll =&gt; &#34;r&#34;, cb =&gt; sub {
@@ -745,7 +744,7 @@
       }&#41;;
    }
 
-   if &#40;$fh6&#41; {
+   if &#40;$is_fh6&#41; {
       $self-&gt;{fh6} = $fh6;
       AnyEvent::Util::fh_nonblocking $fh6, 1;
       $self-&gt;{rw6} = AnyEvent-&gt;io &#40;fh =&gt; $fh6, poll =&gt; &#34;r&#34;, cb =&gt; sub {
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> anyevent-add-evtests.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN AnyEvent-4.12/Makefile.PL AnyEvent-4.12-tests/Makefile.PL
--- AnyEvent-4.12/Makefile.PL	Sat May 31 01:37:38 2008
+++ AnyEvent-4.12-tests/Makefile.PL	Wed Jun  4 14:47:11 2008
@@ -25,7 +25,7 @@
 	            COMPRESS	=&gt; &#39;gzip -9v&#39;,
 	            SUFFIX	=&gt; &#39;.gz&#39;,
 	           },
-    test         =&gt; { TESTS =&gt; &#34;t/*.t t/handle/*.t&#34; },
+    test         =&gt; { TESTS =&gt; &#34;t/*.t t/handle/*.t t/ev/*.t&#34; },
     NAME         =&gt; &#34;AnyEvent&#34;,
     VERSION_FROM =&gt; &#34;lib/AnyEvent.pm&#34;,
     EXTRA_META =&gt; q{
Binary files AnyEvent-4.12/t/ev/.00_load.t.swp and AnyEvent-4.12-tests/t/ev/.00_load.t.swp differ
Binary files AnyEvent-4.12/t/ev/.01_basic.t.swp and AnyEvent-4.12-tests/t/ev/.01_basic.t.swp differ
Binary files AnyEvent-4.12/t/ev/.02_signals.t.swp and AnyEvent-4.12-tests/t/ev/.02_signals.t.swp differ
Binary files AnyEvent-4.12/t/ev/.03_child.t.swp and AnyEvent-4.12-tests/t/ev/.03_child.t.swp differ
Binary files AnyEvent-4.12/t/ev/.04_condvar.t.swp and AnyEvent-4.12-tests/t/ev/.04_condvar.t.swp differ
Binary files AnyEvent-4.12/t/ev/.05_dns.t.swp and AnyEvent-4.12-tests/t/ev/.05_dns.t.swp differ
Binary files AnyEvent-4.12/t/ev/.swp and AnyEvent-4.12-tests/t/ev/.swp differ
diff -urN AnyEvent-4.12/t/ev/00_load.t AnyEvent-4.12-tests/t/ev/00_load.t
--- AnyEvent-4.12/t/ev/00_load.t	Thu Jan  1 03:00:00 1970
+++ AnyEvent-4.12-tests/t/ev/00_load.t	Wed Jun  4 14:54:56 2008
@@ -0,0 +1,20 @@
+$|=1;
+BEGIN { unless &#40;eval &#34;require EV&#34;&#41; { print &#34;1..0 # skip because EV isn&#39;t installed&#34;; exit } }
+BEGIN { print &#34;1..13\n&#34; }
+
+require AnyEvent; print &#34;ok 1\n&#34;;
+require AnyEvent::Impl::EV; print &#34;ok 2\n&#34;;
+require AnyEvent::Util; print &#34;ok 3\n&#34;;
+require AnyEvent::Handle; print &#34;ok 4\n&#34;;
+require AnyEvent::DNS; print &#34;ok 5\n&#34;;
+
+1 &#38;&#38; require AnyEvent::Impl::EV; print &#34;ok 6\n&#34;;
+0 &#38;&#38; require AnyEvent::Impl::Event; print &#34;ok 7\n&#34;;
+0 &#38;&#38; require AnyEvent::Impl::EventLib; print &#34;ok 8\n&#34;;
+0 &#38;&#38; require AnyEvent::Impl::Glib; print &#34;ok 9\n&#34;;
+0 &#38;&#38; require AnyEvent::Impl::Tk; print &#34;ok 10\n&#34;;
+0 &#38;&#38; require AnyEvent::Impl::Perl; print &#34;ok 11\n&#34;;
+0 &#38;&#38; require AnyEvent::Impl::POE; print &#34;ok 12\n&#34;;
+0 &#38;&#38; require AnyEvent::Impl::Qt; print &#34;ok 13\n&#34;;
+
+
diff -urN AnyEvent-4.12/t/ev/01_basic.t AnyEvent-4.12-tests/t/ev/01_basic.t
--- AnyEvent-4.12/t/ev/01_basic.t	Thu Jan  1 03:00:00 1970
+++ AnyEvent-4.12-tests/t/ev/01_basic.t	Wed Jun  4 14:55:19 2008
@@ -0,0 +1,25 @@
+$|=1;
+BEGIN { unless &#40;eval &#34;require EV&#34;&#41; { print &#34;1..0 # skip because EV isn&#39;t installed&#34;; exit } }
+BEGIN { print &#34;1..6\n&#34; }
+
+use AnyEvent;
+use AnyEvent::Impl::EV;
+
+print &#34;ok 1\n&#34;;
+
+my $cv = AnyEvent-&gt;condvar;
+
+print &#34;ok 2\n&#34;;
+
+my $timer1 = AnyEvent-&gt;timer &#40;after =&gt; 0.1, cb =&gt; sub { print &#34;ok 5\n&#34;; $cv-&gt;broadcast }&#41;;
+
+print &#34;ok 3\n&#34;;
+
+AnyEvent-&gt;timer &#40;after =&gt; 0.01, cb =&gt; sub { print &#34;not ok 5\n&#34; }&#41;;
+
+print &#34;ok 4\n&#34;;
+
+$cv-&gt;wait;
+
+print &#34;ok 6\n&#34;;
+
diff -urN AnyEvent-4.12/t/ev/02_signals.t AnyEvent-4.12-tests/t/ev/02_signals.t
--- AnyEvent-4.12/t/ev/02_signals.t	Thu Jan  1 03:00:00 1970
+++ AnyEvent-4.12-tests/t/ev/02_signals.t	Wed Jun  4 14:57:39 2008
@@ -0,0 +1,36 @@
+$|=1;
+BEGIN { unless &#40;eval &#34;require EV&#34;&#41; { print &#34;1..0 # skip because EV isn&#39;t installed&#34;; exit } }
+BEGIN {
+   print &#34;1..5\n&#34;;
+}
+
+use AnyEvent;
+use AnyEvent::Impl::EV;
+
+print &#34;ok 1\n&#34;;
+
+my $cv = AnyEvent-&gt;condvar;
+
+my $error = AnyEvent-&gt;timer &#40;after =&gt; 5, cb =&gt; sub {
+   print &lt;&lt;EOF;
+Bail out! No signal caught.
+EOF
+   exit 0;
+}&#41;;
+
+my $sw = AnyEvent-&gt;signal &#40;signal =&gt; &#39;INT&#39;, cb =&gt; sub {
+  print &#34;ok 3\n&#34;;
+  $cv-&gt;broadcast;
+}&#41;;
+
+print &#34;ok 2\n&#34;;
+kill &#39;INT&#39;, $$;
+$cv-&gt;wait;
+undef $error;
+
+print &#34;ok 4\n&#34;;
+
+undef $sw;
+
+print &#34;ok 5\n&#34;;
+
diff -urN AnyEvent-4.12/t/ev/03_child.t AnyEvent-4.12-tests/t/ev/03_child.t
--- AnyEvent-4.12/t/ev/03_child.t	Thu Jan  1 03:00:00 1970
+++ AnyEvent-4.12-tests/t/ev/03_child.t	Wed Jun  4 14:58:12 2008
@@ -0,0 +1,76 @@
+$|=1;
+BEGIN { unless &#40;eval &#34;require EV&#34;&#41; { print &#34;1..0 # skip because EV isn&#39;t installed&#34;; exit } }
+
+BEGIN {
+   # check for broken perls
+   if &#40;$^O =~ /mswin32/i&#41; {
+      my $ok;
+      local $SIG{CHLD} = sub { $ok = 1 };
+      kill &#39;CHLD&#39;, 0;
+
+      unless &#40;$ok&#41; {
+         print &lt;&lt;EOF;
+1..0 # Your perl interpreter is badly BROKEN. Child watchers will not work, ever. Try upgrading to a newer perl or a working perl &#40;cygwin&#39;s perl is known to work&#41;. If that is not an option, you should be able to use the remaining functionality of AnyEvent, but child watchers WILL NOT WORK.
+EOF
+         exit 0;
+      }
+   }
+}
+
+BEGIN {
+   print &#34;1..7\n&#34;
+}
+
+use AnyEvent;
+use AnyEvent::Impl::EV;
+
+print &#34;ok 1\n&#34;;
+
+AnyEvent::detect; # force-load event model
+
+my $pid = fork;
+
+defined $pid or die &#34;unable to fork&#34;;
+
+# work around Tk bug until it has been fixed.
+#my $timer = AnyEvent-&gt;timer &#40;after =&gt; 2, cb =&gt; sub { }&#41;;
+
+my $cv = AnyEvent-&gt;condvar;
+
+unless &#40;$pid&#41; {
+   print &#34;ok 2\n&#34;;
+   exit 3;
+}
+
+my $w = AnyEvent-&gt;child &#40;pid =&gt; $pid, cb =&gt; sub {
+   print $pid == $_[0] ? &#34;&#34; : &#34;not &#34;, &#34;ok 3\ # $pid == $_[0]\n&#34;;
+   print 3 == &#40;$_[1] &gt;&gt; 8&#41; ? &#34;&#34; : &#34;not &#34;, &#34;ok 4 # 3 == $_[1] &gt;&gt; 8 &#40;$_[1]&#41;\n&#34;;
+   $cv-&gt;broadcast;
+}&#41;;
+
+$cv-&gt;wait;
+
+my $pid2 = fork || exit 7;
+
+my $cv2 = AnyEvent-&gt;condvar;
+
+my $w2 = AnyEvent-&gt;child &#40;pid =&gt; 0, cb =&gt; sub {
+   print $pid2 == $_[0] ? &#34;&#34; : &#34;not &#34;, &#34;ok 5 # $pid2 == $_[0]\n&#34;;
+   print 7 == &#40;$_[1] &gt;&gt; 8&#41; ? &#34;&#34; : &#34;not &#34;, &#34;ok 6 # 7 == $_[1] &gt;&gt; 8 &#40;$_[1]&#41;\n&#34;;
+   $cv2-&gt;broadcast;
+}&#41;;
+
+my $error = AnyEvent-&gt;timer &#40;after =&gt; 5, cb =&gt; sub {
+   print &lt;&lt;EOF;
+Bail out! No child exit detected. This is either a bug in AnyEvent or a bug in your Perl &#40;mostly some windows distributions suffer from that&#41;: child watchers might not work properly on this platform. You can force installation of this module if you do not rely on child watchers, or you could upgrade to a working version of Perl for your platform.\n&#34;;
+EOF
+   exit 0;
+}&#41;;
+
+$cv2-&gt;wait;
+
+print &#34;ok 7\n&#34;;
+
+
+
+
diff -urN AnyEvent-4.12/t/ev/04_condvar.t AnyEvent-4.12-tests/t/ev/04_condvar.t
--- AnyEvent-4.12/t/ev/04_condvar.t	Thu Jan  1 03:00:00 1970
+++ AnyEvent-4.12-tests/t/ev/04_condvar.t	Wed Jun  4 14:58:52 2008
@@ -0,0 +1,76 @@
+$|=1;
+BEGIN { unless &#40;eval &#34;require EV&#34;&#41; { print &#34;1..0 # skip because EV isn&#39;t installed&#34;; exit } }
+BEGIN {
+   print &#34;1..21\n&#34;
+}
+
+use AnyEvent;
+use AnyEvent::Impl::EV;
+
+print &#34;ok 1\n&#34;;
+
+{
+   my $cv = AnyEvent-&gt;condvar;
+
+   $cv-&gt;cb &#40;sub {
+      print $_[0]-&gt;ready ? &#34;&#34; : &#34;not &#34;, &#34;ok 4\n&#34;;
+
+      my $x = $_[0]-&gt;recv;
+      print $x == 7 ? &#34;&#34; : &#34;not &#34;, &#34;ok 5 # $x == 7\n&#34;;
+
+      my @x = $_[0]-&gt;recv;
+      print $x[1] == 5 ? &#34;&#34; : &#34;not &#34;, &#34;ok 6 # $x[1] == 5\n&#34;;
+
+      my $y = $cv-&gt;recv;
+      print $y == 7 ? &#34;&#34; : &#34;not &#34;, &#34;ok 7 # $x == 7\n&#34;;
+   }&#41;;
+
+   my $t = AnyEvent-&gt;timer &#40;after =&gt; 0, cb =&gt; sub {
+      print &#34;ok 3\n&#34;;
+      $cv-&gt;send &#40;7, 5&#41;;
+   }&#41;;
+
+   print &#34;ok 2\n&#34;;
+   $cv-&gt;wait;
+   print &#34;ok 8\n&#34;;
+
+   my @x = $cv-&gt;recv;
+   print $x[1] == 5 ? &#34;&#34; : &#34;not &#34;, &#34;ok 9 # $x[1] == 5\n&#34;;
+}
+
+{
+   my $cv = AnyEvent-&gt;condvar;
+
+   $cv-&gt;cb &#40;sub {
+      print $_[0]-&gt;ready ? &#34;&#34; : &#34;not &#34;, &#34;ok 12\n&#34;;
+
+      my $x = eval { $_[0]-&gt;recv };
+      print !defined $x ? &#34;&#34; : &#34;not &#34;, &#34;ok 13\n&#34;;
+      print $@ =~ /^kill/ ? &#34;&#34; : &#34;not &#34;, &#34;ok 14 # $@\n&#34;;
+   }&#41;;
+
+   my $t = AnyEvent-&gt;timer &#40;after =&gt; 0, cb =&gt; sub {
+      print &#34;ok 11\n&#34;;
+      $cv-&gt;croak &#40;&#34;kill&#34;&#41;;
+      print &#34;ok 15\n&#34;;
+      $cv-&gt;send &#40;8, 6, 4&#41;;
+      print &#34;ok 16\n&#34;;
+   }&#41;;
+
+   print &#34;ok 10\n&#34;;
+   my @x = eval { $cv-&gt;recv };
+   print !@x ? &#34;&#34; : &#34;not &#34;, &#34;ok 17 # @x\n&#34;;
+   print $@ =~ /^kill / ? &#34;&#34; : &#34;not &#34;, &#34;ok 18 # $@\n&#34;;
+}
+
+{
+   my $cv = AnyEvent-&gt;condvar;
+
+   print &#34;ok 19\n&#34;;
+   my $t = AnyEvent-&gt;timer &#40;after =&gt; 0, cb =&gt; $cv&#41;;
+
+   print &#34;ok 20\n&#34;;
+   $cv-&gt;recv;
+   print &#34;ok 21\n&#34;;
+}
+
diff -urN AnyEvent-4.12/t/ev/05_dns.t AnyEvent-4.12-tests/t/ev/05_dns.t
--- AnyEvent-4.12/t/ev/05_dns.t	Thu Jan  1 03:00:00 1970
+++ AnyEvent-4.12-tests/t/ev/05_dns.t	Wed Jun  4 14:59:08 2008
@@ -0,0 +1,33 @@
+$|=1;
+BEGIN { unless &#40;eval &#34;require EV&#34;&#41; { print &#34;1..0 # skip because EV isn&#39;t installed&#34;; exit } }
+BEGIN { print &#34;1..5\n&#34; }
+
+# we avoid complicated tests here because some systems will
+# not have working DNS
+
+use AnyEvent::Impl::EV;
+use AnyEvent::DNS;
+
+print &#34;ok 1\n&#34;;
+
+AnyEvent::DNS::resolver;
+
+print &#34;ok 2\n&#34;;
+
+# make sure we timeout faster
+AnyEvent::DNS::resolver-&gt;{timeout} = [0.5];
+AnyEvent::DNS::resolver-&gt;_compile;
+
+print &#34;ok 3\n&#34;;
+
+my $cv = AnyEvent-&gt;condvar;
+
+AnyEvent::DNS::a &#34;www.google.de&#34;, sub {
+   print &#34;ok 4 # www.google.de =&gt; @_\n&#34;;
+   $cv-&gt;send;
+};
+
+$cv-&gt;recv;
+
+print &#34;ok 5\n&#34;;
+
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;16:50:43&nbsp;2008</span>
    <span class="description">schmorp [...] schmorp.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #36434] [PATCH] AnyEvent::DNS + any non-perl backend issue on systems without ipv6</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 4 Jun 2008 22:50:53 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Vladimir Timofeev via RT &lt;bug-AnyEvent [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Lehmann &lt;schmorp [...] schmorp.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

your report might get be ignored when sent to rt.cpan.org and not the
official contact address mentioned in the module documentation. Please
close your report again and use the contact address from the module
documentation to report any issues. If this is an inconvenience to you
please consider petitioning the rt.cpan.org authors to make their service
optional and not enforced, so this inconvenience can be avoided in the
future. &#40;Note that rt.cpan.org creates little gain and a lot of work for
the maintainers, who, after all, provide their modules as a free service&#41;.

Thanks a lot,
Marc Lehmann &lt;schmorp@schmorp.de&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;16:50:45&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;18:48:36&nbsp;2008</span>
    <span class="description">VOVKASM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I delete this report because of module&#39;s author request. This request
should be sent directly to the author of AnyEvent module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;05&nbsp;03:15:19&nbsp;2008</span>
    <span class="description">VOVKASM [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;05&nbsp;03:15:19&nbsp;2008</span>
    <span class="description">VOVKASM [...] cpan.org -  Fixed in 4.13 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
