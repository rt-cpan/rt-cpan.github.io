<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21268 for Mail-SPF-Query: Incorrect result for &#34;ptr&#34; mechanism</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21268 for Mail-SPF-Query: Incorrect result for &#34;ptr&#34; mechanism</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Mail-SPF-Query/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Mail-SPF-Query/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Mail-SPF-Query/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Mail-SPF-Query/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-SPF-Query">Mail-SPF-Query CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21268</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Mail-SPF-Query/Active/">Mail-SPF-Query</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">JMEHNLE [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dg [...] dezignguy.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20124-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20125-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;01&nbsp;15:42:25&nbsp;2006</span>
    <span class="description">dg [...] dezignguy.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug for Mail-SPF-Query</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Sep 2006 12:41:56 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Mail-SPF-Query [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mr. Courtney Creighton&#34; &lt;dg [...] dezignguy.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Redhat Enterprise Linux 3 &#40;Taroon Update 8&#41; with Kernel 2.4.21-47.EL
Perl 5.8.1


My spam filter &#40;ASSP - assp.sourceforge.net&#41; is rejecting mail from a user on
eskimo.com because of an SPF failure. I checked Mail-SPF-Query itself to isolate
the issue, since it appeared that ASSP relied fully on the Mail-SPF-Query module
to do all the work. Eskimo.com only lists two MX servers in their dns records,
ultra5 and ultra6, but this user is sending his outgoing mail through
ultra7.eskimo.com &#40;204.122.16.70&#41;, and eskimo.com says that server is what he
should be using. And they think that the &#39;ptr&#39; in their SPF record should cover
that situation and allow it, however Mail-SPF-Query returns an spf fail for this
setup.
 
Eskimo.com&#39;s SPF record is: 
text = &#34;v=spf1 mx ptr -all&#34; 
 
So even though &#39;ultra7.eskimo.com&#39; doesn&#39;t match as an MX, it does seem to have
a PTR record that should match: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.dnsstuff.com/tools/ptr.ch?ip=204.122.16.70">http://www.dnsstuff.com/tools/ptr.ch?ip=204.122.16.70</a></span> 
 
However, Mail-SPF-Query seems to ignore that and return SPF-Fail anyways. 
 
I see that spf.pobox.com&#39;s comment on using PTR in SPF is &#34;Expensive, unreliable
and not recommended&#34;. So I don&#39;t know why eskimo.com insists on relying solely
on their ptr record for their outgoing user email through this server. But
still, the SPF site says the mail should go through.

This is the direct query to spfquery that I tried:
spfquery --sender postmaster@eskimo.com --helo ultra7.eskimo.com --ip
204.122.16.70

fail
Please see
<span class="clickylink"><a target="new" rel="nofollow" href="http://spf.pobox.com/why.html?sender=postmaster%40eskimo.com&#38;ip=204.122.16.70&#38;re">http://spf.pobox.com/why.html?sender=postmaster%40eskimo.com&#38;ip=204.122.16.70&#38;re</a></span>
ceiver=spfquery
spfquery: domain of postmaster@eskimo.com does not designate 204.122.16.70 as
permitted sender
Received-SPF: fail &#40;spfquery: domain of postmaster@eskimo.com does not designate
204.122.16.70 as permitted sender&#41; client-ip=204.122.16.70;
envelope-from=postmaster@eskimo.com; helo=ultra7.eskimo.com;

Is there a reason that the PTR record is just not checked when using
Mail-SPF-Query? I saw a subroutine in Query.pm that looked like it should handle
this:
<span class="clickylink"><a target="new" rel="nofollow" href="http://cpan.uwinnipeg.ca/htdocs/Mail-SPF-Query/Mail/SPF/Query.pm.html#get_ptr_do">http://cpan.uwinnipeg.ca/htdocs/Mail-SPF-Query/Mail/SPF/Query.pm.html#get_ptr_do</a></span>
main- 

I want to find out if I should tell the eskimo.com user to put pressure on
eskimo.com to fix their SPF records, or if something needs done to
Mail-SPF-Query?

Thanks,
-Courtney
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;21&nbsp;09:25:50&nbsp;2007</span>
    <span class="description">JMEHNLE [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;21&nbsp;09:29:23&nbsp;2007</span>
    <span class="description">JMEHNLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am sorry for not having responded so long.  I was busy with real 
life. :-&#40;

I cannot reproduce this with Mail::SPF::Query 1.999.1:

| $ pversion Mail::SPF::Query
| 1.999001
| 
| $ spfquery.mail-spf-query-perl --version
| spfquery version 2.3
| 
| $ spfquery.mail-spf-query-perl --sender postmaster@eskimo.com \
|     --helo ultra7.eskimo.com --ip 204.122.16.70
| pass
| Please see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.openspf.orgwhy.html">http://www.openspf.orgwhy.html</a></span>?
|   sender=postmaster%40eskimo.com&#38;ip=204.122.16.70&#38;receiver=spfquery:
|   204.122.16.70 PTR ultra7.eskimo.com matches eskimo.com
| spfquery: domain of postmaster@eskimo.com designates 204.122.16.70 as
|   permitted sender
| Received-SPF: pass &#40;spfquery: domain of postmaster@eskimo.com
|   designates 204.122.16.70 as permitted sender&#41;
|   client-ip=204.122.16.70; envelope-from=postmaster@eskimo.com;
|   helo=ultra7.eskimo.com;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;21&nbsp;09:29:24&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;00:49:49&nbsp;2012</span>
    <span class="description">JMEHNLE [...] cpan.org -  Subject changed from &#39;Bug for Mail-SPF-Query&#39; to &#39;Incorrect result for &#34;ptr&#34; mechanism&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;00:49:49&nbsp;2012</span>
    <span class="description">JMEHNLE [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;00:51:18&nbsp;2012</span>
    <span class="description">JMEHNLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Rejecting.  Unable to reproduce.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;00:51:19&nbsp;2012</span>
    <span class="description">JMEHNLE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
