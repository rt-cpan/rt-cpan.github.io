<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38193 for IPC-Run: t/pty bug &#40;Locale issue with error messages&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38193 for IPC-Run: t/pty bug &#40;Locale issue with error messages&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IPC-Run/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IPC-Run">IPC-Run CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38193</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IPC-Run/Active/">IPC-Run</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">TODDR [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
vadym.chepkov [...] verizonbusiness.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-17362-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.89    </td>
  </tr>
  <tr id="CF-17363-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;05&nbsp;09:21:32&nbsp;2008</span>
    <span class="description">vadym.chepkov [...] verizonbusiness.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/pty bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 05 Aug 2008 13:21:02 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IPC-Run [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Chepkov, Vadym&#34; &lt;vadym.chepkov [...] verizonbusiness.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

 

I stumbled on a bug in IPC-Run-0.80 I hope you would help me to solve.

I try to build it on AIX 5.3. perl 5.8.2

Attached is output of make test TEST_FILES=t/pty.t TEST_VERBOSE=1
IPCRUNDEBUG=4

I tried to install it regardless, but it fails in exactly the same place
the test does.

 

Thank you very much.

Sincerely,

Vadym Chepkov
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;28&nbsp;14:12:51&nbsp;2008</span>
    <span class="description">grousse [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Same issue here on Linux with perl 5.10: t/pty.t bails out after test
13. Here is the last part of output of &#39;make test TEST_FILES=t/pty.t
TEST_VERBOSE=1 IPCRUNDEBUG=4&#39;:

ok 12
ok 13
IPC::Run 0000 01234-67---1 [#2&#40;29244&#41;]: ** finishing
IPC::Run 0000 01234-67---1 [#2&#40;29244&#41;]: checking for more input fd 11
&#40;kid&#39;s stdin&#41;
IPC::Run 0000 01234-67---1 [#2&#40;29244&#41;]: writing to fd 11 &#40;kid&#39;s stdin&#41;
IPC::Run 0000 01234-67---1 [#2&#40;29244&#41;]: write&#40; 11, &#39;quit
IPC::Run 0000 01234-67---1 [#2&#40;29244&#41;]: &#39; &#41; = 5
IPC::Run 0000 01234-67---1 [#2&#40;29244&#41;]: closing fd 11 &#40;kid&#39;s stdin&#41;
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: close&#40; 11 &#41; = 0
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: fds for select: ----r-------
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: timeout=0.01
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: selected  ----r-------
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: filtering data from fd 4 &#40;kid&#39;s
stdout&#41;
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: reading from fd 4 &#40;kid&#39;s stdout&#41;
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: read&#40; 4 &#41; = 12 chars &#39;QUIT
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: quit
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: &#39;
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: fds for select: ----r-------
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: timeout=forever
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: selected  ----r-------
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: filtering data from fd 4 &#40;kid&#39;s
stdout&#41;
IPC::Run 0000 01234-67---- [#2&#40;29244&#41;]: reading from fd 4 &#40;kid&#39;s stdout&#41;
ack Erreur d&#39;entrée/sortie: read&#40; 4 &#41; at
/home/guillomovitch/tmp/Pya17f_Hxq/perl-IPC-Run/BUILD/IPC-Run-0.82/blib/lib/IPC/Run/IO.pm
line 552
# Looks like you planned 32 tests but only ran 13.
# Looks like your test died just after 13.
 Dubious, test returned 255 &#40;wstat 65280, 0xff00&#41;
 Failed 19/32 subtests 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;28&nbsp;14:12:52&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;28&nbsp;14:13:19&nbsp;2008</span>
    <span class="description">vadym.chepkov [...] verizonbusiness.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Out of Office AutoReply: [rt.cpan.org #38193] t/pty bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 28 Dec 2008 19:13:00 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guillaume Rousse via RT &lt;bug-IPC-Run [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Chepkov, Vadym&#34; &lt;vadym.chepkov [...] verizonbusiness.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I will be out on vacation from 12/20 returning 1/5.  If this is an emergency, please contact Bob Smolarek.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;01&nbsp;16:28:17&nbsp;2009</span>
    <span class="description">ANDK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I suspect this is a locale dependency. On cpan testers I see that German
and French locale both fail on the pty test and On my own box I just
tried with setting the environment variable LANG to &#34;C&#34; and the test
suddenly passed.

So if you can try LANG=C.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;02&nbsp;10:19:09&nbsp;2009</span>
    <span class="description">vadym.chepkov [...] verizon.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #38193] t/pty bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 02 Feb 2009 15:18:01 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IPC-Run [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Chepkov, Vadym&#34; &lt;vadym.chepkov [...] verizon.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It was specifically set to C


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Andreas Koenig via RT [mailto:bug-IPC-Run@rt.cpan.org] 
Sent: Sunday, February 01, 2009 4:28 PM
To: Chepkov, Vadym
Subject: [rt.cpan.org #38193] t/pty bug

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=38193">https://rt.cpan.org/Ticket/Display.html?id=38193</a></span> &gt;

I suspect this is a locale dependency. On cpan testers I see that German
and French locale both fail on the pty test and On my own box I just
tried with setting the environment variable LANG to &#34;C&#34; and the test
suddenly passed.

So if you can try LANG=C.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;11&nbsp;12:04:44&nbsp;2009</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 02 10:19:09 2009, vadym.chepkov@verizon.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It was specifically set to C
&gt; 
</div>
What about LC_ALL? This one has precedence over the LANG variable.

Regards,
     Slaven

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; -----Original Message-----
&gt; From: Andreas Koenig via RT [mailto:bug-IPC-Run@rt.cpan.org] 
&gt; Sent: Sunday, February 01, 2009 4:28 PM
&gt; To: Chepkov, Vadym
&gt; Subject: [rt.cpan.org #38193] t/pty bug
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=38193">https://rt.cpan.org/Ticket/Display.html?id=38193</a></span> &gt;
&gt; 
&gt; I suspect this is a locale dependency. On cpan testers I see that German
&gt; and French locale both fail on the pty test and On my own box I just
&gt; tried with setting the environment variable LANG to &#34;C&#34; and the test
&gt; suddenly passed.
&gt; 
&gt; So if you can try LANG=C.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;15&nbsp;11:34:54&nbsp;2009</span>
    <span class="description">http://tripa.free.fr/~jmazon/ -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jean-Baptiste Mazon&#34; &lt;jmazon [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Lun. Mai. 11 12:04:44 2009, SREZIC a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What about LC_ALL? This one has precedence over the LANG variable.
</div>
LC_ALL=C does let the test suite go through.

Unfortunately, I can&#39;t set LC_ALL for all programs that would be liable 
to use IPC::Run.

Obviously, the core of the issue is the english-centric error checking 
in IPC::Run and IPC:Run::IO

               die $@ unless
                  $@ =~ /^Input\/output error: read/ ||
                  &#40;$@ =~ /input or output/ &#38;&#38; $^O =~ /aix/&#41; 
                  || &#40; Win32_MODE &#38;&#38; $@ =~ /Bad file descriptor/ &#41;;

and

           &#40;&#40;$c &lt; 200&#41; and &#40;$@||&#39;&#39;&#41;=~ m/^Resource temporarily/&#41; and 
redo;

The attached patch fixes the problem for the Linux systems I tested on. 
There seems to be special cases for aix and Win32; I have neither tested 
nor attempted to fix those---supposing they&#39;re actually impacted in the 
first place.

On IPC-Run-0.84 I tested on, you&#39;d have to have locales set to english 
at all times you use it.  With my patch, you only need it to be the same  
at BEGIN time and when you use it.  Perfection would be not caring about 
them.  But from what I browsed, the module&#39;s exception mechanism is a 
bit too string-oriented for that to be easy.

JB
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur lib/IPC/Run.pm blib/lib/IPC/Run.pm
--- lib/IPC/Run.pm	2009-07-15 16:52:34.000161000 +0200
+++ blib/lib/IPC/Run.pm	2009-07-15 16:53:05.001288000 +0200
@@ -1073,6 +1073,16 @@
 ###############################################################################
 
 ##
+## Error constants, not too locale-dependant
+use vars  qw&#40; $_EIO $_EAGAIN &#41;;
+use Errno qw&#40;   EIO   EAGAIN &#41;;
+BEGIN {
+  local $!;
+  $! = EIO;    $_EIO    = qr/^$!/;
+  $! = EAGAIN; $_EAGAIN = qr/^$!/;
+}
+
+##
 ## State machine states, set in $self-&gt;{STATE}
 ##
 ## These must be in ascending order numerically
@@ -2399,7 +2409,7 @@
 	       ## read&#40;&#41; throws the bad file descriptor message if the
 	       ## kid dies on Win32.
                die $@ unless
-	          $@ =~ /^Input\/output error: read/ ||
+	          $@ =~ $_EIO ||
 		  &#40;$@ =~ /input or output/ &#38;&#38; $^O =~ /aix/&#41; 
 		  || &#40; Win32_MODE &#38;&#38; $@ =~ /Bad file descriptor/ &#41;;
             }
diff -ur lib/IPC/Run/IO.pm blib/lib/IPC/Run/IO.pm
--- lib/IPC/Run/IO.pm	2009-07-15 16:52:33.000772000 +0200
+++ blib/lib/IPC/Run/IO.pm	2009-07-15 16:53:05.001223000 +0200
@@ -558,7 +558,7 @@
 	   $r = eval { IPC::Run::get_more_input&#40;&#41;; };
 	   $c++;
 	   ##$@ and warn &#34;redo &#34;, substr&#40;$@, 0, 20&#41; , &#34; &#34;;
-	   &#40;&#40;$c &lt; 200&#41; and &#40;$@||&#39;&#39;&#41;=~ m/^Resource temporarily/&#41; and redo;
+	   &#40;&#40;$c &lt; 200&#41; and &#40;$@||&#39;&#39;&#41;=~ $IPC::Run::_EAGAIN&#41; and redo;
    }
    &#40; $IPC::Run::filter_op, $IPC::Run::filter_num &#41; = &#40; $saved_op, $saved_num &#41;;
    $self-&gt;{HARNESS} = undef;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;25&nbsp;14:33:19&nbsp;2011</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">RT#25058, RT#64695, RT#62693 are duplicates of this bug

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dolmen/">http://search.cpan.org/~dolmen/</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/dolmen/">http://github.com/dolmen/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;25&nbsp;14:34:06&nbsp;2011</span>
    <span class="description">vadym.chepkov [...] verizon.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Out of Office AutoReply: [rt.cpan.org #38193] t/pty bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Mar 2011 18:33:56 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olivier &#39;dolmen&#39; Mengué via RT &lt;bug-IPC-Run [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Chepkov, Vadym&#34; &lt;vadym.chepkov [...] verizon.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am no longer working for Verizon. 
Please contact soa_support@lists.verizonbusiness.com or registry_support@lists.verizonbusiness.com for application support. 

Vadym Chepkov
vchepkov@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;28&nbsp;23:28:39&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Multiple tickets refer to this ticket. No solution yet.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;28&nbsp;23:28:41&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;29&nbsp;13:27:07&nbsp;2011</span>
    <span class="description">daxim [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No solution yet.
</div>Explain how you arrived at this conclusion.

The patch named IPC-Run-0.84-locale.patch that was attached to this 
ticket in 2009 works. I just applied it manually to 0.89 and the tests 
pass all successfully.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;29&nbsp;13:27:09&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;29&nbsp;17:29:04&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 29 13:27:07 2011, DAXIM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; No solution yet.
</div>&gt; Explain how you arrived at this conclusion.
&gt; 
&gt; The patch named IPC-Run-0.84-locale.patch that was attached to this 
&gt; ticket in 2009 works. I just applied it manually to 0.89 and the tests 
&gt; pass all successfully.
</div>
As I understand it, Windows would not function with this patch. I would prefer not to break 
windows in IPC::Run since I know it&#39;s heavily used there.

Honestly I haven&#39;t looked closely at the change in over a year. I&#39;ll try to take a look at this later 
tonight.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;23:49:46&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;23:50:21&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Subject changed from &#39;t/pty bug&#39; to &#39;t/pty bug &#40;Locale issue with error messages&#41;&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;23:50:21&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Severity Important added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;23:50:21&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Broken in 0.89 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;00:31:31&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> jmazon [...] gmail.com, vadym.chepkov [...] verizon.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Released on 0.90_03
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;00:31:32&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;06&nbsp;17:45:54&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
