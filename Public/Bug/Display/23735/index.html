<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #23735 for Module-Install: Patch against CPAN.pm batch jobs going into recursion</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #23735 for Module-Install: Patch against CPAN.pm batch jobs going into recursion</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Module-Install/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Module-Install/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Module-Install/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Module-Install/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-Install">Module-Install CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">23735</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Module-Install/Active/">Module-Install</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ANDK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-21632-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.64    </td>
  </tr>
  <tr id="CF-21633-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;30&nbsp;23:03:30&nbsp;2006</span>
    <span class="description">ANDK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch against CPAN.pm batch jobs going into recursion</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">M:I tries to detect if it is running under CPAN.pm by looking for a lock
file. But there are circumstances when this goes wrong: when the user
sets a different cpan HOME directory and when CPAN.pm is run in batch mode.

CPAN.pm will be setting the environment variable PERL5_CPAN_IS_RUNNING
and I have a patch to teach M:I using it &#40;without breaking current
heuristic&#41;.

The patch is on CPAN in ANDK/patches/Module-Install-0.64-ANDK-01.patch

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;05&nbsp;11:45:29&nbsp;2007</span>
    <span class="description">ANDK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I asked Prof Warnock about his opinion and he said I should simply set
PERL5_CPANPLUS_IS_RUNNING. What Du you think?

For CPAN.pm users this is quite a critical bug because everything goes
wrong as soon as Autoinstall sends CPAN.pm into recursion and the next
process starts to ask the same questions, fails at the same
prerequisites, starts cleaning up the build directory. etc.

I have the impression more and more people are using Autoinstall ... so
what are the plans for this?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;05&nbsp;11:45:32&nbsp;2007</span>
    <span class="description">ANDK [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;06&nbsp;04:57:14&nbsp;2007</span>
    <span class="description">adamk [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Actually, PERL5_CPANPLUS_IS_RUNNING has turned out to be almost entirely
useless.

Instead, CPANPLUS is moving to the new PERL5_CPANPLUS_IS_EXECUTING
environment variable, which contains the rel2abs of the Makefile.PL or
Build.PL.

In the CPAN.pm case. you should set PERL5_CPAN_IS_EXECUTING to the
rel2abs of the Makefile.PL.

This will 1&#41; Allow new version of Module::Install to detect the presense
of a parent CPAN.pm correctly 2&#41; Allow CPAN.pm to detect that it has
been invoked recursively, and handle that &#40;right&#41;?

Adam K
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;07&nbsp;04:56:22&nbsp;2007</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KANE [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 05 11:45:29 2007, ANDK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I asked Prof Warnock about his opinion and he said I should simply set
&gt; PERL5_CPANPLUS_IS_RUNNING. What Du you think?
</div>
Argh, please no, don&#39;t do that.

From the docs of CPANPLUS::Backend:

ENVIRONMENT
       When &#34;CPANPLUS::Backend&#34; is loaded, which is necessary for just about
       every &lt;CPANPLUS&gt; operation, the environment variable &#34;PERL5_CPAN-
       PLUS_IS_RUNNING&#34; is set to the current process id.

       This information might be useful somehow to spawned processes.

This is what that ENV var promises.  1.88_78 now sets it blindly. CPANPLUS may
not even be on the box. It certainly may not be running, and you&#39;re setting
it to &#39;1&#39; which is certainly not the process id... And you *certainly* don&#39;t want
to &#39;kill -9&#39; that to stop CPANPLUS...

Please don&#39;t set ENV vars that aren&#39;t owned by your module -- it&#39;ll do more
damage than good.

Thanks,

Jos
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;19&nbsp;00:47:09&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ping!

Andres, I think Adam and Kane&#39;s comments happened during the RT email
blackout.  You should read them if you haven&#39;t.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;23&nbsp;01:54:11&nbsp;2007</span>
    <span class="description">andreas.koenig.7os6VVqR [...] franz.ak.mind.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ANDK [...] cpan.org, KANE [...] cpan.org, ADAMK [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #23735] Patch against CPAN.pm batch jobs going into recursion</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Aug 2007 07:53:11 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Install [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> andreas.koenig.7os6VVqR [...] franz.ak.mind.de &#40;Andreas J. Koenig&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; On Sun, 19 Aug 2007 00:47:14 -0400, &#34;Michael G Schwern via RT&#34; &lt;bug-Module-Install@rt.cpan.org&gt; said:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; Andres, I think Adam and Kane&#39;s comments happened during the RT email
  &gt; blackout.  You should read them if you haven&#39;t.
</div>
Thanks Schwern! Indeed I did not receive these postings as mail.

I&#39;m sorry that I dispropriated PERL5_CPANPLUS_IS_RUNNING. This
decision wasn&#39;t done lightly. I waited for 6 months to get this
desastrous bug in Module::Install addressed and the only way to fix it
was setting this environment variable. Due to the nature of
Module::Install it is *never* upgraded, so this particular bug will
stay around forever. I changed my code now so that the variable is set
to $$. I fear I cannot stop using it for the time being. Maybe all
parties should agree on considering this variable being burnt by wrong
usage. Please deprecate it.

I have not yet fully understood the advice from Adam. Can this find
its way into the Module::Install docs? Maybe with coding guidelines
how I&#39;m consided to use this variable? I hope this desaster makes it
clear that none of us can solve this kind of problems alone. For me it
makes no sense why we need 4 environment variables to stop one
builder/installer from going wild but if you can paint the bigger
picture, I&#39;ll be glad to follow your lead.

Thanks,
-- 
andreas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;23&nbsp;09:50:36&nbsp;2007</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #23735] Patch against CPAN.pm batch jobs going into recursion</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Aug 2007 23:49:41 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Install [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Adam Kennedy&#34; &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From my perspective, PERL5_CPANPLUS_IS_RUNNING was broken by design, primary
because it doesn&#39;t do what it says. It just indicates that at some point
above me, CPANPLUS was loaded into memory, not that it is running, and
certainly not that CPANPLUS in particular happened to call the M:I
Makefile.PL.

As for the behaviour of M:I, what work I have done on it is to try and
prevent it doing worse things.

Certainly, setting PERL5_CPANPLUS_IS_RUNNING is now probably a good way to
make M:I detect a &#34;legacy&#34; version of a CPAN client.

After several long discussions in the irc.perl.org #toolchain channel, kane
and I agreed on a new
PERL5_CPANPLUS_IS_EXECUTING=/absolute/path/to/Makefile.PL, which provides
the actual functionality that we need.

As for why we need this stuff, it&#39;s to allow M:I to have some idea of what
it is working with in terms of other members of the toolchain.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I hope this desaster makes it
&gt; clear that none of us can solve this kind of problems alone.
</div>
I agree here.

I know you hate using IRC, but if you could find a way to join the rest of
the toolchain maintainers in irc.perl.org #toolchain, you&#39;ll find it&#39;s very
low traffic, and a higher bandwidth forum might help to avoid this sort of
problem in the future.

If we are limited to stretched out disconnected conversations in mail and
web forums, it&#39;s harder to co-ordinate.

On 23/08/07, &#40;Andreas J. Koenig&#41; via RT &lt;bug-Module-Install@rt.cpan.org&gt;
wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt;        Queue: Module-Install
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=23735">http://rt.cpan.org/Ticket/Display.html?id=23735</a></span> &gt;
&gt;
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt; On Sun, 19 Aug 2007 00:47:14 -0400, &#34;Michael G Schwern via RT&#34; &lt;
</div>&gt; bug-Module-Install@rt.cpan.org&gt; said:
&gt;
<div class="message-stanza open">&gt;   &gt; Andres, I think Adam and Kane&#39;s comments happened during the RT email
&gt;   &gt; blackout.  You should read them if you haven&#39;t.
</div>&gt;
&gt; Thanks Schwern! Indeed I did not receive these postings as mail.
&gt;
&gt; I&#39;m sorry that I dispropriated PERL5_CPANPLUS_IS_RUNNING. This
&gt; decision wasn&#39;t done lightly. I waited for 6 months to get this
&gt; desastrous bug in Module::Install addressed and the only way to fix it
&gt; was setting this environment variable. Due to the nature of
&gt; Module::Install it is *never* upgraded, so this particular bug will
&gt; stay around forever. I changed my code now so that the variable is set
&gt; to $$. I fear I cannot stop using it for the time being. Maybe all
&gt; parties should agree on considering this variable being burnt by wrong
&gt; usage. Please deprecate it.
&gt;
&gt; I have not yet fully understood the advice from Adam. Can this find
&gt; its way into the Module::Install docs? Maybe with coding guidelines
&gt; how I&#39;m consided to use this variable? I hope this desaster makes it
&gt; clear that none of us can solve this kind of problems alone. For me it
&gt; makes no sense why we need 4 environment variables to stop one
&gt; builder/installer from going wild but if you can paint the bigger
&gt; picture, I&#39;ll be glad to follow your lead.
&gt;
&gt; Thanks,
&gt; --
&gt; andreas
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;16:44:10&nbsp;2007</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rt-cpan [...] trout.me.uk</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 05 11:45:29 2007, ANDK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I asked Prof Warnock about his opinion and he said I should simply set
&gt; PERL5_CPANPLUS_IS_RUNNING. What Du you think?
&gt; 
&gt; For CPAN.pm users this is quite a critical bug because everything goes
&gt; wrong as soon as Autoinstall sends CPAN.pm into recursion and the next
&gt; process starts to ask the same questions, fails at the same
&gt; prerequisites, starts cleaning up the build directory. etc.
&gt; 
&gt; I have the impression more and more people are using Autoinstall ... so
&gt; what are the plans for this?
</div>
Unfortunately, your changes to CPAN.pm are now a problem for CPAN.pm
users, at least those of us who expect to be able to test for a modern
version of CPAN.pm - any autoinstall-using Makefile.PL that does a
requires onto anything that loads CPAN.pm is now broken, since the
version checks load CPAN.pm and the autoinstall process then believes
that CPANPLUS is already running and as such it shouldn&#39;t be doing anything.

This is a potentially huge problem from my POV since a lot of Catalyst
deployment setups prereq in recent CPAN.pms in order to make their
build/install scripts work sensibly, and the installdeps make target on
all of these now breaks.

Horrible though it is, the only thing I can think of that will avoid
this without re-introducing the bug is to check if Module::Install is
already loaded and not set the env var if so. I&#39;m currently adding the
following stanza -

my $no_cpanplus_env = !exists $ENV{PERL5_CPANPLUS_IS_RUNNING};
require CPAN;
delete $ENV{PERL5_CPANPLUS_IS_RUNNING} if $no_cpanplus_env;

to work around the problem but it really doesn&#39;t seem like the right
solution to need to layer a workaround on top of your workaround.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
