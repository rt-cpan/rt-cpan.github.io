<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42724 for Module-Build: [PATCH] consolidated VMS fixes</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42724 for Module-Build: [PATCH] consolidated VMS fixes</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Module-Build">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Module-Build">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Module-Build">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Module-Build">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-Build">Module-Build CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42724</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Module-Build">Module-Build</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cberry [...] cpan.org

<br />
malmberg [...] Encompasserve.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-21558-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.31012    </td>
  </tr>
  <tr id="CF-21559-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




m_b_base_bm.gdiff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/539663/271049/m_b_base_bm.gdiff">
Wed Dec 03 01:11:04 2008 (1.1k) by malmberg [...] Encompasserve.org
</a>
</font></li>
</ul>


m_b_compat_t.gdiff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/538901/270605/m_b_compat_t.gdiff">
Mon Dec 01 01:54:22 2008 (484b) by malmberg [...] Encompasserve.org
</a>
</font></li>
</ul>


m_b_platform_vms_pm.gdiff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/539303/270874/m_b_platform_vms_pm.gdiff">
Mon Dec 01 23:12:49 2008 (306b) by malmberg [...] Encompasserve.org
</a>
</font></li>
</ul>


m_b_t_install_t.gdiff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/568567/286815/m_b_t_install_t.gdiff">
Sat Feb 21 16:20:59 2009 (554b) by malmberg [...] Encompasserve.org
</a>
</font></li>
</ul>


mb_vms_20090122.patch.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/558727/281974/mb_vms_20090122.patch.txt">
Fri Jan 23 10:19:19 2009 (3.1k) by cberry [...] cpan.org
</a>
</font></li>
</ul>


mb_vms_20090514.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/605675/307067/mb_vms_20090514.patch">
Thu May 14 20:20:20 2009 (8.5k) by cberry [...] cpan.org
</a>
</font></li>
</ul>


module_build2.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/567507/286433/module_build2.patch">
Tue Feb 17 21:18:19 2009 (5.8k) by malmberg [...] Encompasserve.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=42724">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-538901" href="/Public/Bug/Display.html?id=42724#txn-538901">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;01&nbsp;01:54:22&nbsp;2008</span>
    <span class="description">malmberg [...] Encompasserve.org - Ticket #41332:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> compat.t doing case sensitive filename compare on VMS.</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/538901/270602/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/270602">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 408b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On VMS, by default filenames can be lowercased by Perl.

VMS also has a case preserved mode where it either return the case of
the file on the disk, or the case that was used to look up the file.

The attached patch makes the compare case insensitive.


# # Installing PROJECT_ROOT:[PERL-BLEAD.t._tmp348837.lbiidr]simple.pm
# &#39;
#     doesn&#39;t match
&#39;&#40;?x-ism:PROJECT_ROOT\:\[PERL\-BLEAD\.t\._tmp348837\.lbiidr\
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> m_b_compat_t.gdiff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/538901/270605/m_b_compat_t.gdiff">Download m_b_compat_t.gdiff</a><br />
<span class="downloadcontenttype">application/octet-stream 484b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-539303" href="/Public/Bug/Display.html?id=42724#txn-539303">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;01&nbsp;23:12:49&nbsp;2008</span>
    <span class="description">malmberg [...] Encompasserve.org - Ticket #41364:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> _detildefy on VMS has unexpected trailing &#39;/&#39;.</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/539303/270871/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/270871">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 178b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The tilde.t tests on VMS are failing as they expect that there is not a
trailing slash on the expanded $HOME directory.

The attached patch fixes Platform/VMS.pm for this issue.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> m_b_platform_vms_pm.gdiff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/539303/270874/m_b_platform_vms_pm.gdiff">Download m_b_platform_vms_pm.gdiff</a><br />
<span class="downloadcontenttype">application/octet-stream 306b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-539663" href="/Public/Bug/Display.html?id=42724#txn-539663">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;03&nbsp;01:11:04&nbsp;2008</span>
    <span class="description">malmberg [...] Encompasserve.org - Ticket #41389:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> .packlist not being created on VMS / uninit var in htmlify_pods</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/539663/271046/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/271046">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 358b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">In Base.pm, two bugs that are fixed by the attached patch.

An invalid index shows up in htmlify_pods during the install.t test.


The splitpath call needs to have the nopath parameter set to 0, not 1
when there is a filename component for the test.

With this patch and the patches with bug 41364, 41332, 41331, all Module
Build tests are passing for me.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> m_b_base_bm.gdiff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/539663/271049/m_b_base_bm.gdiff">Download m_b_base_bm.gdiff</a><br />
<span class="downloadcontenttype">application/octet-stream 1.1k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-558727" href="/Public/Bug/Display.html?id=42724#txn-558727">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;23&nbsp;10:19:19&nbsp;2009</span>
    <span class="description">cberry [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] consolidated VMS fixes</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/558727/281971/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/281971">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch gets M::B 0.31012 passing all tests on VMS and I&#39;ve also tested on OS X.  
In some cases it incorporates patches previously submitted by John Malmberg but in a 
couple of cases I&#39;ve been able to isolate the changes a bit better under Platform::VMS. Here&#39;s 
what&#39;s included:

In Base::htmlify_pods, check that the @dirs array has something in it before processing it -- 
that avoids an uninitialized value warning.

In Base::install_map, flip the no_file argument to splitpath from true to false.

In Compat::fake_makefile, don&#39;t double up the dollar signs when building the one-liner and 
running on VMS.

Add Platform::VMS::oneliner as an override.  When spawning a command, the arguments 
must be quoted but the command itself must not be.

Modify the Platform::VMS::_detildefy  override to remove a trailing slash from the result when 
passed a tilde by itself.

Add Platform::VMS::ACTION_clean override to work around the fact that glob on VMS treats 
glob&#40;&#39;foo&#39;&#41; as glob&#40;&#39;foo.*&#39;&#41;.

Make the check for Simple.pm in t/compat.t case insensitive.  It&#39;s name will be reported as 
simple.pm on VMS with default settings.

The one patch of John&#39;s not included here is this one:

<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=42157">http://rt.cpan.org/Public/Bug/Display.html?id=42157</a></span>

It looks fine to me but I haven&#39;t tested that one and it addresses new functionality, not just 
bug fixes.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> mb_vms_20090122.patch.txt</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/558727/281974/mb_vms_20090122.patch.txt">Download mb_vms_20090122.patch.txt</a><br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Module/Build/Base.pm;-0	2009-01-14 11:50:10 -0600
+++ lib/Module/Build/Base.pm	2009-01-22 16:45:22 -0600
@@ -2817,7 +2817,7 @@ sub htmlify_pods {
     my &#40;$name, $path&#41; = File::Basename::fileparse&#40;$pods-&gt;{$pod},
                                                  file_qr&#40;&#39;\.&#40;?:pm|plx?|pod&#41;$&#39;&#41;&#41;;
     my @dirs = File::Spec-&gt;splitdir&#40; File::Spec-&gt;canonpath&#40; $path &#41; &#41;;
-    pop&#40; @dirs &#41; if $dirs[-1] eq File::Spec-&gt;curdir;
+    pop&#40; @dirs &#41; if scalar&#40;@dirs&#41; &#38;&#38; $dirs[-1] eq File::Spec-&gt;curdir;
 
     my $fulldir = File::Spec-&gt;catfile&#40;$htmldir, @rootdirs, @dirs&#41;;
     my $outfile = File::Spec-&gt;catfile&#40;$fulldir, &#34;${name}.html&#34;&#41;;
@@ -4061,7 +4061,7 @@ sub install_map {
       # Need to remove volume from $map{$_} using splitpath, or else
       # we&#39;ll create something crazy like C:\Foo\Bar\E:\Baz\Quux
       # VMS will always have the file separate than the path.
-      my &#40;$volume, $path, $file&#41; = File::Spec-&gt;splitpath&#40; $map{$_}, 1 &#41;;
+      my &#40;$volume, $path, $file&#41; = File::Spec-&gt;splitpath&#40; $map{$_}, 0 &#41;;
 
       # catdir needs a list of directories, or it will create something
       # crazy like volume:[Foo.Bar.volume.Baz.Quux]
--- lib/Module/Build/Compat.pm;-0	2009-01-14 11:50:10 -0600
+++ lib/Module/Build/Compat.pm	2009-01-22 14:29:55 -0600
@@ -279,7 +279,7 @@ sub fake_makefile {
 
   my $Build = &#39;Build&#39; . $filetype . &#39; --makefile_env_macros 1&#39;;
   my $unlink = $class-&gt;oneliner&#40;&#39;1 while unlink $ARGV[0]&#39;, [], [$args{makefile}]&#41;;
-  $unlink =~ s/\$/\$\$/g;
+  $unlink =~ s/\$/\$\$/g unless $class-&gt;is_vmsish;
 
   my $maketext = &lt;&lt;&#34;EOF&#34;;
 all : force_do_it
--- lib/Module/Build/Platform/VMS.pm;-0	2009-01-14 11:50:10 -0600
+++ lib/Module/Build/Platform/VMS.pm	2009-01-22 16:49:35 -0600
@@ -188,6 +188,21 @@ sub do_system {
   return !system&#40;&#34;$cmd $args&#34;&#41;;
 }
 
+=item oneliner
+
+Override to ensure that we do not quote the command.
+
+=cut
+
+sub oneliner {
+    my $self = shift;
+    my $oneliner = $self-&gt;SUPER::oneliner&#40;@_&#41;;
+
+    $oneliner =~ s/^\&#34;\S+\&#34;//;
+
+    return &#34;MCR $^X $oneliner&#34;;
+}
+
 =item _infer_xs_spec
 
 Inherit the standard version but tweak the library file name to be 
@@ -309,6 +324,7 @@ sub _detildefy {
 
         # Trivial case of just ~ by it self
         if &#40;$spec eq &#39;&#39;&#41; {
+            $home =~ s#/$##;
             return $home;
         }
 
@@ -385,6 +401,20 @@ sub localize_dir_path {
   return VMS::Filespec::vmspath&#40;$path&#41;;
 }
 
+=item ACTION_clean
+
+The home-grown glob&#40;&#41; expands a bit too aggressively when given a bare name,
+so default in a zero-length extension.
+
+=cut
+
+sub ACTION_clean {
+  my &#40;$self&#41; = @_;
+  foreach my $item &#40;map glob&#40;VMS::Filespec::rmsexpand&#40;$_, &#39;.;0&#39;&#41;&#41;, $self-&gt;cleanup&#41; {
+    $self-&gt;delete_filetree&#40;$item&#41;;
+  }
+}
+
 =back
 
 =head1 AUTHOR
--- t/compat.t;-0	2009-01-14 11:50:10 -0600
+++ t/compat.t	2009-01-22 14:53:23 -0600
@@ -230,7 +230,7 @@ ok $mb, &#34;Module::Build-&gt;new_from_context
   ok $ran_ok, &#34;make fakeinstall with INSTALLDIRS=vendor ran ok&#34;;
   $output =~ s/^/# /gm;  # Don&#39;t confuse our own test output
   like $output,
-       qr/\Q$libdir2\E .* Simple\.pm/x,
+       qr/\Q$libdir2\E .* Simple\.pm/ix,
        &#39;Should have installdirs=vendor&#39;;
 
   stdout_of&#40; sub { $mb-&gt;do_system&#40;@make, &#39;realclean&#39;&#41;; } &#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-566473" href="/Public/Bug/Display.html?id=42724#txn-566473">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;14&nbsp;12:52:40&nbsp;2009</span>
    <span class="description">malmberg [...] Encompasserve.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/566473/285984/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/285984">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 121b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I would like to get this into blead so that I can merge in the Unix /
Extended file specification changes and test them.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-566474" href="/Public/Bug/Display.html?id=42724#txn-566474">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;14&nbsp;12:52:41&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-566508" href="/Public/Bug/Display.html?id=42724#txn-566508">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;14&nbsp;16:13:39&nbsp;2009</span>
    <span class="description">cberry [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/566508/286005/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/286005">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 249b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 14 12:52:40 2009, malmberg@Encompasserve.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would like to get this into blead so that I can merge in the Unix /
&gt; Extended file specification changes and test them.
</div>
It&#39;s in:

<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.git.perl.org/perl.git/commit/cd5cc49">http://perl5.git.perl.org/perl.git/commit/cd5cc49</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-567507" href="/Public/Bug/Display.html?id=42724#txn-567507">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;17&nbsp;21:18:19&nbsp;2009</span>
    <span class="description">malmberg [...] Encompasserve.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/567507/286430/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/286430">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 150b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is the remaining patches needed for Unix and filenames with the
Extended Character set.

This superceeds my previous submissions.

Thanks,
-John
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/567507/286433/module_build2.patch">Download module_build2.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /rsync_root/perl/lib/Module/Build/Platform/VMS.pm	Sat Feb 14 15:10:11 2009
+++ lib/Module/Build/Platform/VMS.pm	Sun Feb 15 21:14:13 2009
@@ -229,8 +229,9 @@
 
 =item rscan_dir
 
-Inherit the standard version but remove dots at end of name.  This may not be 
-necessary if File::Find has been fixed or DECC$FILENAME_UNIX_REPORT is in effect.
+Inherit the standard version but remove dots at end of name.
+If the extended character set is in effect, do not remove dots from filenames
+with Unix path delimiters.
 
 =cut
 
@@ -239,7 +240,11 @@
 
   my $result = $self-&gt;SUPER::rscan_dir&#40; $dir, $pattern &#41;;
 
-  for my $file &#40;@$result&#41; { $file =~ s/\.$//; }
+  for my $file &#40;@$result&#41; {
+      if &#40;!_efs&#40;&#41; &#38;&#38; &#40;$file =~ m#/#&#41;&#41; {
+          $file =~ s/\.$//;
+      }
+  }
   return $result;
 }
 
@@ -254,7 +259,7 @@
   my $self = shift;
 
   my $dist_dir = $self-&gt;SUPER::dist_dir;
-  $dist_dir =~ s/\./_/g;
+  $dist_dir =~ s/\./_/g unless _efs&#40;&#41;;
   return $dist_dir;
 }
 
@@ -322,6 +327,11 @@
         # break up the paths for the merge
         my $home = VMS::Filespec::unixify&#40;$ENV{HOME}&#41;;
 
+        # In the default VMS mode, the trailing slash is present.
+        # In Unix report mode it is not.  The parsing logic assumes that
+        # it is present.
+        $home .= &#39;/&#39; unless $home =~ m#/$#;
+
         # Trivial case of just ~ by it self
         if &#40;$spec eq &#39;&#39;&#41; {
             $home =~ s#/$##;
@@ -361,9 +371,8 @@
         # Now put the two cases back together
         $arg = File::Spec::Unix-&gt;catpath&#40;$hvol, $newdirs, $file&#41;;
 
-    } else {
-        return $arg;
     }
+    return $arg;
 
 }
 
@@ -376,7 +385,9 @@
 
 =cut
 
-sub find_perl_interpreter { return $^X; }
+sub find_perl_interpreter {
+    return VMS::Filespec::vmsify&#40;$^X&#41;;
+}
 
 =item localize_file_path
 
@@ -386,8 +397,9 @@
 
 sub localize_file_path {
   my &#40;$self, $path&#41; = @_;
+  $path = VMS::Filespec::vmsify&#40;$path&#41;;
   $path =~ s/\.\z//;
-  return VMS::Filespec::vmsify&#40;$path&#41;;
+  return $path;
 }
 
 =item localize_dir_path
@@ -413,6 +425,43 @@
   foreach my $item &#40;map glob&#40;VMS::Filespec::rmsexpand&#40;$_, &#39;.;0&#39;&#41;&#41;, $self-&gt;cleanup&#41; {
     $self-&gt;delete_filetree&#40;$item&#41;;
   }
+}
+
+
+# Need to look up the feature settings.  The preferred way is to use the
+# VMS::Feature module, but that may not be available to dual life modules.
+
+my $use_feature;
+BEGIN {
+    if &#40;eval { local $SIG{__DIE__}; require VMS::Feature; }&#41; {
+        $use_feature = 1;
+    }
+}
+
+# Need to look up the UNIX report mode.  This may become a dynamic mode
+# in the future.
+sub _unix_rpt {
+    my $unix_rpt;
+    if &#40;$use_feature&#41; {
+        $unix_rpt = VMS::Feature::current&#40;&#34;filename_unix_report&#34;&#41;;
+    } else {
+        my $env_unix_rpt = $ENV{&#39;DECC$FILENAME_UNIX_REPORT&#39;} || &#39;&#39;;
+        $unix_rpt = $env_unix_rpt =~ /^[ET1]/i; 
+    }
+    return $unix_rpt;
+}
+
+# Need to look up the EFS character set mode.  This may become a dynamic
+# mode in the future.
+sub _efs {
+    my $efs;
+    if &#40;$use_feature&#41; {
+        $efs = VMS::Feature::current&#40;&#34;efs_charset&#34;&#41;;
+    } else {
+        my $env_efs = $ENV{&#39;DECC$EFS_CHARSET&#39;} || &#39;&#39;;
+        $efs = $env_efs =~ /^[ET1]/i; 
+    }
+    return $efs;
 }
 
 =back
--- /rsync_root/perl/lib/Module/Build/t/extend.t	Tue Sep 30 06:29:35 2008
+++ lib/Module/Build/t/extend.t	Fri Dec 26 16:24:44 2008
@@ -50,7 +50,9 @@
   $mb-&gt;test_files&#40;&#39;*t*&#39;&#41;;
   my $files = $mb-&gt;test_files;
   ok  grep {$_ eq &#39;script&#39;}    @$files;
-  ok  grep {$_ eq File::Spec-&gt;catfile&#40;&#39;t&#39;, &#39;basic.t&#39;&#41;} @$files;
+  my $t_basic_t = File::Spec-&gt;catfile&#40;&#39;t&#39;, &#39;basic.t&#39;&#41;;
+  $t_basic_t = VMS::Filespec::vmsify&#40;$t_basic_t&#41; if $^O eq &#39;VMS&#39;;
+  ok  grep {$_ eq $t_basic_t} @$files;
   ok !grep {$_ eq &#39;Build.PL&#39; } @$files;
 
   # Make sure order is preserved
--- /rsync_root/perl/lib/Module/Build/t/metadata.t	Tue Sep 30 06:29:35 2008
+++ lib/Module/Build/t/metadata.t	Fri Dec 26 16:31:48 2008
@@ -33,14 +33,24 @@
 my $simple_file = &#39;lib/Simple.pm&#39;;
 my $simple2_file = &#39;lib/Simple2.pm&#39;;
 
-   #TODO:
    # Traditional VMS will return the file in in lower case, and is_deeply
    # does exact case comparisons.
-   # When ODS-5 support is active for preserved case file names, this will
-   # need to be changed.
+   # When ODS-5 support is active for preserved case file names we do not
+   # change the case.
    if &#40;$^O eq &#39;VMS&#39;&#41; {
-       $simple_file = lc&#40;$simple_file&#41;;
-       $simple2_file = lc&#40;$simple2_file&#41;;
+       my $lower_case_expect = 1;
+       my $vms_efs_case = 0;
+       if &#40;eval &#39;require VMS::Feature&#39;&#41; {
+           $vms_efs_case = VMS::Feature::current&#40;&#34;efs_case_preserve&#34;&#41;;
+       } else {
+           my $efs_case = $ENV{&#39;DECC$EFS_CASE_PRESERVE&#39;} || &#39;&#39;;
+           $vms_efs_case = $efs_case =~ /^[ET1]/i;
+       }
+       $lower_case_expect = 0 if $vms_efs_case;
+       if &#40;$lower_case_expect&#41; {
+           $simple_file = lc&#40;$simple_file&#41;;
+           $simple2_file = lc&#40;$simple2_file&#41;;
+       }
    }
 
 
--- /rsync_root/perl/lib/Module/Build/t/runthrough.t	Tue Sep 30 06:29:35 2008
+++ lib/Module/Build/t/runthrough.t	Sat Dec 27 09:53:36 2008
@@ -73,11 +73,22 @@
 
 my $dist_dir = &#39;Simple-0.01&#39;;
 
-# VMS may or may not need to modify the name, vmsify will do this if
-# the name looks like a UNIX directory.
+# VMS in traditional mode needs the $dist_dir name to not have a &#39;.&#39; in it
+# as this is a directory delimiter.  In extended character set mode the dot
+# is permitted for Unix format file specifications.
 if &#40;$^O eq &#39;VMS&#39;&#41; {
-   my @dist_dirs = File::Spec-&gt;splitdir&#40;VMS::Filespec::vmsify&#40;$dist_dir.&#39;/&#39;&#41;&#41;;
-   $dist_dir = $dist_dirs[0];
+    my $Is_VMS_noefs = 1;
+    my $vms_efs = 0;
+    if &#40;eval &#39;require VMS::Feature&#39;&#41; {
+        $vms_efs = VMS::Feature::current&#40;&#34;efs_charset&#34;&#41;;
+    } else {
+        my $efs_charset = $ENV{&#39;DECC$EFS_CHARSET&#39;} || &#39;&#39;;
+        $vms_efs = $efs_charset =~ /^[ET1]/i; 
+    }
+    $Is_VMS_noefs = 0 if $vms_efs;
+    if &#40;$Is_VMS_noefs&#41; {
+        $dist_dir = &#39;Simple-0_01&#39;;
+    }
 }
 
 is $mb-&gt;dist_dir, $dist_dir;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-568567" href="/Public/Bug/Display.html?id=42724#txn-568567">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;21&nbsp;16:20:58&nbsp;2009</span>
    <span class="description">malmberg [...] Encompasserve.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/568567/286812/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/286812">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 100b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patch to Module/Build/t/install.t for VMS when the
DECC$FILENAME_REPORT_UNIX feature is active.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/568567/286815/m_b_t_install_t.gdiff">Download m_b_t_install_t.gdiff</a><br />
<span class="downloadcontenttype">application/octet-stream 554b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-605675" href="/Public/Bug/Display.html?id=42724#txn-605675">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;20:20:20&nbsp;2009</span>
    <span class="description">cberry [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/605675/307064/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/307064">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 343b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve created and attached a consolidated version of the three previous
patches and reformulated it against a recent pull from svn.  All tests
pass in my VMS environment.

If there are objections to accepting this patch, please speak up.  If
not, it would be really nice to get it in and push the latest
development snapshot of M::B into blead.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/605675/307067/mb_vms_20090514.patch">Download mb_vms_20090514.patch</a><br />
<span class="downloadcontenttype">text/x-diff 8.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Module/Build/Base.pm~	2009-05-14 14:34:52 -0500
+++ lib/Module/Build/Base.pm	2009-05-14 14:34:52 -0500
@@ -2828,7 +2828,7 @@ sub htmlify_pods {
     my &#40;$name, $path&#41; = File::Basename::fileparse&#40;$pods-&gt;{$pod},
                                                  file_qr&#40;&#39;\.&#40;?:pm|plx?|pod&#41;$&#39;&#41;&#41;;
     my @dirs = File::Spec-&gt;splitdir&#40; File::Spec-&gt;canonpath&#40; $path &#41; &#41;;
-    pop&#40; @dirs &#41; if $dirs[-1] eq File::Spec-&gt;curdir;
+    pop&#40; @dirs &#41; if scalar&#40;@dirs&#41; &#38;&#38; $dirs[-1] eq File::Spec-&gt;curdir;
 
     my $fulldir = File::Spec-&gt;catfile&#40;$htmldir, @rootdirs, @dirs&#41;;
     my $outfile = File::Spec-&gt;catfile&#40;$fulldir, &#34;${name}.html&#34;&#41;;
@@ -4096,7 +4096,7 @@ sub install_map {
       # Need to remove volume from $map{$_} using splitpath, or else
       # we&#39;ll create something crazy like C:\Foo\Bar\E:\Baz\Quux
       # VMS will always have the file separate than the path.
-      my &#40;$volume, $path, $file&#41; = File::Spec-&gt;splitpath&#40; $map{$_}, 1 &#41;;
+      my &#40;$volume, $path, $file&#41; = File::Spec-&gt;splitpath&#40; $map{$_}, 0 &#41;;
 
       # catdir needs a list of directories, or it will create something
       # crazy like volume:[Foo.Bar.volume.Baz.Quux]
--- lib/Module/Build/Compat.pm~	2009-05-14 14:34:52 -0500
+++ lib/Module/Build/Compat.pm	2009-05-14 14:34:52 -0500
@@ -282,7 +282,7 @@ sub fake_makefile {
 
   my $Build = &#39;Build&#39; . $filetype . &#39; --makefile_env_macros 1&#39;;
   my $unlink = $class-&gt;oneliner&#40;&#39;1 while unlink $ARGV[0]&#39;, [], [$args{makefile}]&#41;;
-  $unlink =~ s/\$/\$\$/g;
+  $unlink =~ s/\$/\$\$/g unless $class-&gt;is_vmsish;
 
   my $maketext = &lt;&lt;&#34;EOF&#34;;
 all : force_do_it
--- lib/Module/Build/Platform/VMS.pm;-0	2009-05-12 21:00:19 -0500
+++ lib/Module/Build/Platform/VMS.pm	2009-05-14 15:14:46 -0500
@@ -188,6 +188,21 @@ sub do_system {
   return !system&#40;&#34;$cmd $args&#34;&#41;;
 }
 
+=item oneliner
+
+Override to ensure that we do not quote the command.
+
+=cut
+
+sub oneliner {
+    my $self = shift;
+    my $oneliner = $self-&gt;SUPER::oneliner&#40;@_&#41;;
+
+    $oneliner =~ s/^\&#34;\S+\&#34;//;
+
+    return &#34;MCR $^X $oneliner&#34;;
+}
+
 =item _infer_xs_spec
 
 Inherit the standard version but tweak the library file name to be 
@@ -214,8 +229,9 @@ sub _infer_xs_spec {
 
 =item rscan_dir
 
-Inherit the standard version but remove dots at end of name.  This may not be 
-necessary if File::Find has been fixed or DECC$FILENAME_UNIX_REPORT is in effect.
+Inherit the standard version but remove dots at end of name.
+If the extended character set is in effect, do not remove dots from filenames
+with Unix path delimiters.
 
 =cut
 
@@ -224,7 +240,11 @@ sub rscan_dir {
 
   my $result = $self-&gt;SUPER::rscan_dir&#40; $dir, $pattern &#41;;
 
-  for my $file &#40;@$result&#41; { $file =~ s/\.$//; }
+  for my $file &#40;@$result&#41; {
+      if &#40;!_efs&#40;&#41; &#38;&#38; &#40;$file =~ m#/#&#41;&#41; {
+          $file =~ s/\.$//;
+      }
+  }
   return $result;
 }
 
@@ -239,7 +259,7 @@ sub dist_dir {
   my $self = shift;
 
   my $dist_dir = $self-&gt;SUPER::dist_dir;
-  $dist_dir =~ s/\./_/g;
+  $dist_dir =~ s/\./_/g unless _efs&#40;&#41;;
   return $dist_dir;
 }
 
@@ -307,8 +327,14 @@ sub _detildefy {
         # break up the paths for the merge
         my $home = VMS::Filespec::unixify&#40;$ENV{HOME}&#41;;
 
+        # In the default VMS mode, the trailing slash is present.
+        # In Unix report mode it is not.  The parsing logic assumes that
+        # it is present.
+        $home .= &#39;/&#39; unless $home =~ m#/$#;
+
         # Trivial case of just ~ by it self
         if &#40;$spec eq &#39;&#39;&#41; {
+            $home =~ s#/$##;
             return $home;
         }
 
@@ -345,9 +371,8 @@ sub _detildefy {
         # Now put the two cases back together
         $arg = File::Spec::Unix-&gt;catpath&#40;$hvol, $newdirs, $file&#41;;
 
-    } else {
-        return $arg;
     }
+    return $arg;
 
 }
 
@@ -360,7 +385,9 @@ lossy.
 
 =cut
 
-sub find_perl_interpreter { return $^X; }
+sub find_perl_interpreter {
+    return VMS::Filespec::vmsify&#40;$^X&#41;;
+}
 
 =item localize_file_path
 
@@ -370,8 +397,9 @@ Convert the file path to the local synta
 
 sub localize_file_path {
   my &#40;$self, $path&#41; = @_;
+  $path = VMS::Filespec::vmsify&#40;$path&#41;;
   $path =~ s/\.\z//;
-  return VMS::Filespec::vmsify&#40;$path&#41;;
+  return $path;
 }
 
 =item localize_dir_path
@@ -385,6 +413,57 @@ sub localize_dir_path {
   return VMS::Filespec::vmspath&#40;$path&#41;;
 }
 
+=item ACTION_clean
+
+The home-grown glob&#40;&#41; expands a bit too aggressively when given a bare name,
+so default in a zero-length extension.
+
+=cut
+
+sub ACTION_clean {
+  my &#40;$self&#41; = @_;
+  foreach my $item &#40;map glob&#40;VMS::Filespec::rmsexpand&#40;$_, &#39;.;0&#39;&#41;&#41;, $self-&gt;cleanup&#41; {
+    $self-&gt;delete_filetree&#40;$item&#41;;
+  }
+}
+
+
+# Need to look up the feature settings.  The preferred way is to use the
+# VMS::Feature module, but that may not be available to dual life modules.
+
+my $use_feature;
+BEGIN {
+    if &#40;eval { local $SIG{__DIE__}; require VMS::Feature; }&#41; {
+        $use_feature = 1;
+    }
+}
+
+# Need to look up the UNIX report mode.  This may become a dynamic mode
+# in the future.
+sub _unix_rpt {
+    my $unix_rpt;
+    if &#40;$use_feature&#41; {
+        $unix_rpt = VMS::Feature::current&#40;&#34;filename_unix_report&#34;&#41;;
+    } else {
+        my $env_unix_rpt = $ENV{&#39;DECC$FILENAME_UNIX_REPORT&#39;} || &#39;&#39;;
+        $unix_rpt = $env_unix_rpt =~ /^[ET1]/i; 
+    }
+    return $unix_rpt;
+}
+
+# Need to look up the EFS character set mode.  This may become a dynamic
+# mode in the future.
+sub _efs {
+    my $efs;
+    if &#40;$use_feature&#41; {
+        $efs = VMS::Feature::current&#40;&#34;efs_charset&#34;&#41;;
+    } else {
+        my $env_efs = $ENV{&#39;DECC$EFS_CHARSET&#39;} || &#39;&#39;;
+        $efs = $env_efs =~ /^[ET1]/i; 
+    }
+    return $efs;
+}
+
 =back
 
 =head1 AUTHOR
--- t/extend.t;-0	2009-05-12 21:00:18 -0500
+++ t/extend.t	2009-05-14 15:14:46 -0500
@@ -50,7 +50,9 @@ print &#34;Hello, World!\n&#34;;
   $mb-&gt;test_files&#40;&#39;*t*&#39;&#41;;
   my $files = $mb-&gt;test_files;
   ok  grep {$_ eq &#39;script&#39;}    @$files;
-  ok  grep {$_ eq File::Spec-&gt;catfile&#40;&#39;t&#39;, &#39;basic.t&#39;&#41;} @$files;
+  my $t_basic_t = File::Spec-&gt;catfile&#40;&#39;t&#39;, &#39;basic.t&#39;&#41;;
+  $t_basic_t = VMS::Filespec::vmsify&#40;$t_basic_t&#41; if $^O eq &#39;VMS&#39;;
+  ok  grep {$_ eq $t_basic_t} @$files;
   ok !grep {$_ eq &#39;Build.PL&#39; } @$files;
 
   # Make sure order is preserved
--- t/metadata.t;-0	2009-05-12 21:00:18 -0500
+++ t/metadata.t	2009-05-14 15:14:46 -0500
@@ -33,14 +33,24 @@ $dist-&gt;regen;
 my $simple_file = &#39;lib/Simple.pm&#39;;
 my $simple2_file = &#39;lib/Simple2.pm&#39;;
 
-   #TODO:
    # Traditional VMS will return the file in in lower case, and is_deeply
    # does exact case comparisons.
-   # When ODS-5 support is active for preserved case file names, this will
-   # need to be changed.
+   # When ODS-5 support is active for preserved case file names we do not
+   # change the case.
    if &#40;$^O eq &#39;VMS&#39;&#41; {
-       $simple_file = lc&#40;$simple_file&#41;;
-       $simple2_file = lc&#40;$simple2_file&#41;;
+       my $lower_case_expect = 1;
+       my $vms_efs_case = 0;
+       if &#40;eval &#39;require VMS::Feature&#39;&#41; {
+           $vms_efs_case = VMS::Feature::current&#40;&#34;efs_case_preserve&#34;&#41;;
+       } else {
+           my $efs_case = $ENV{&#39;DECC$EFS_CASE_PRESERVE&#39;} || &#39;&#39;;
+           $vms_efs_case = $efs_case =~ /^[ET1]/i;
+       }
+       $lower_case_expect = 0 if $vms_efs_case;
+       if &#40;$lower_case_expect&#41; {
+           $simple_file = lc&#40;$simple_file&#41;;
+           $simple2_file = lc&#40;$simple2_file&#41;;
+       }
    }
 
 
--- t/runthrough.t;-0	2009-05-12 21:00:18 -0500
+++ t/runthrough.t	2009-05-14 15:14:47 -0500
@@ -73,11 +73,22 @@ ok -e $mb-&gt;build_script;
 
 my $dist_dir = &#39;Simple-0.01&#39;;
 
-# VMS may or may not need to modify the name, vmsify will do this if
-# the name looks like a UNIX directory.
+# VMS in traditional mode needs the $dist_dir name to not have a &#39;.&#39; in it
+# as this is a directory delimiter.  In extended character set mode the dot
+# is permitted for Unix format file specifications.
 if &#40;$^O eq &#39;VMS&#39;&#41; {
-   my @dist_dirs = File::Spec-&gt;splitdir&#40;VMS::Filespec::vmsify&#40;$dist_dir.&#39;/&#39;&#41;&#41;;
-   $dist_dir = $dist_dirs[0];
+    my $Is_VMS_noefs = 1;
+    my $vms_efs = 0;
+    if &#40;eval &#39;require VMS::Feature&#39;&#41; {
+        $vms_efs = VMS::Feature::current&#40;&#34;efs_charset&#34;&#41;;
+    } else {
+        my $efs_charset = $ENV{&#39;DECC$EFS_CHARSET&#39;} || &#39;&#39;;
+        $vms_efs = $efs_charset =~ /^[ET1]/i; 
+    }
+    $Is_VMS_noefs = 0 if $vms_efs;
+    if &#40;$Is_VMS_noefs&#41; {
+        $dist_dir = &#39;Simple-0_01&#39;;
+    }
 }
 
 is $mb-&gt;dist_dir, $dist_dir;
--- t/compat.t;-0	2009-05-12 21:00:18 -0500
+++ t/compat.t	2009-05-14 17:45:12 -0500
@@ -235,7 +235,7 @@ ok $mb, &#34;Module::Build-&gt;new_from_context
     ok $ran_ok, &#34;make fakeinstall with INSTALLDIRS=vendor ran ok&#34;;
     $output =~ s/^/# /gm;  # Don&#39;t confuse our own test output
     like $output,
-        qr/\Q$libdir2\E .* Simple\.pm/x,
+        qr/\Q$libdir2\E .* Simple\.pm/ix,
         &#39;Should have installdirs=vendor&#39;;
   }
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-605677" href="/Public/Bug/Display.html?id=42724#txn-605677">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;20:58:04&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/605677/307069/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/307069">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 110b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry it took so long.  Thank you for reformulating the patch.

Applied in trunk as revision 12770.

-- David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-605680" href="/Public/Bug/Display.html?id=42724#txn-605680">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;20:58:06&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-621672" href="/Public/Bug/Display.html?id=42724#txn-621672">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;17:07:42&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org - Ticket #41332:  Merged into ticket #42724</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-621673" href="/Public/Bug/Display.html?id=42724#txn-621673">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;17:07:42&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Merged into ticket #42724</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-621674" href="/Public/Bug/Display.html?id=42724#txn-621674">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;17:08:47&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org - Ticket #41389:  Merged into ticket #42724</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-621675" href="/Public/Bug/Display.html?id=42724#txn-621675">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;17:08:47&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Merged into ticket #42724</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-621676" href="/Public/Bug/Display.html?id=42724#txn-621676">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;17:09:19&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org - Ticket #41364:  Merged into ticket #42724</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-621677" href="/Public/Bug/Display.html?id=42724#txn-621677">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;17:09:19&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Merged into ticket #42724</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.89739</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
