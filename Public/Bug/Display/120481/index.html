<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #120481 for Crypt-SSLeay: Possible Bug Report: Round Robin DNS</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #120481 for Crypt-SSLeay: Possible Bug Report: Round Robin DNS</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Crypt-SSLeay/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Crypt-SSLeay/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Crypt-SSLeay/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Crypt-SSLeay/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-SSLeay">Crypt-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">120481</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Crypt-SSLeay/Active/">Crypt-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">nanis [...] runu.moc.invalid
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dyolcekaj [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8676-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8677-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;17:32:36&nbsp;2017</span>
    <span class="description">dyolcekaj [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Possible Bug Report: Round Robin DNS</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Mar 2017 16:32:26 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Crypt-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jake Cloyd &lt;dyolcekaj [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

In the &#34;connect&#40;&#41;&#34; subroutine of Net::SSL.pm when a connection can&#39;t be
made the code currently croaks on line 114

    else {
        *$self-&gt;{io_socket_peername}=@_ == 1 ? $_[0] :
IO::Socket::sockaddr_in&#40;@_&#41;;
        if&#40;!$self-&gt;SUPER::connect&#40;@_&#41;&#41; {
            # better to die than return here
            $@ = &#34;Connect failed: $@; $!&#34;;
            croak&#40;$@&#41;;
        }
    }

When gethostbyname&#40;&#41; returns multiple IP addresses and the first
&#34;connect&#40;&#41;&#34; attempt results in failure the croak will kill the
iterating code.  IO::Socket::INET.pm will iterate over
gethostbyname&#40;&#41;&#39;s output and die in this scenario before attempting
the second IP.  We were seeing intermittent failures when one of the
IPs a hostname would resolve to was unreachable.

To fix this in our application connect&#40;&#41; will return undef instead of
croaking in a modified Net:SSL.pm file.

    else {
        *$self-&gt;{io_socket_peername}=@_ == 1 ? $_[0] :
IO::Socket::sockaddr_in&#40;@_&#41;;
        if&#40;!$self-&gt;SUPER::connect&#40;@_&#41;&#41; {
            $@ = &#34;Connect failed: $@; $!&#34;;
            return undef;
            #croak&#40;$@&#41;;
        }
    }


Here is basically the code we were running. To reproduce you need to
have a round robin DNS entry with one of the IPs being bogus and run
something similar to the below.

@LWP::Protocol::http::EXTRA_SOCK_OPTS = &#40;
    MultiHomed =&gt; 1,
&#41;;
my $useragent  = LWP::UserAgent-&gt;new;
## build request
my $response   = $useragent-&gt;request&#40;$request&#41;;


Thanks,

Jake Cloyd
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;16:39:08&nbsp;2017</span>
    <span class="description">nanis [...] runu.moc.invalid -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the clear and concise report. I have not yet decided how to handle this, but I do have a question: Are you sure you want to continue to rely on Crypt::SSLeay &#40;and, by extension, Net::SSL&#41;? Have you read &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Crypt::SSLeay#DO-YOU-NEED-Crypt::SSLeay%3F&gt;">https://metacpan.org/pod/Crypt::SSLeay#DO-YOU-NEED-Crypt::SSLeay%3F&gt;</a></span>?

If you have are using a recent version of LWP, you would have had to install LWP::Protocol::https to install Crypt::SSLeay which would have resulted in installing IO::Socket::SSL and Net::SSLeay which are much better maintained, and, more importantly, much more secure and not just because they verify hostnames.

If in your code you are forcing the use of Crypt::SSLeay/Net::SSL using one of the techniques shown in the documentation linked above, could you try not doing it and seeing if your application suffers any ill effects?

If not, there is no reason to force the use of Crypt::SSLeay and Net::SSL.

HTH,

-- Sinan


On Thu Mar 02 17:32:36 2017, dyolcekaj@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; In the &#34;connect&#40;&#41;&#34; subroutine of Net::SSL.pm when a connection can&#39;t be
&gt; made the code currently croaks on line 114
&gt; 
&gt;     else {
&gt;         *$self-&gt;{io_socket_peername}=@_ == 1 ? $_[0] :
&gt; IO::Socket::sockaddr_in&#40;@_&#41;;
&gt;         if&#40;!$self-&gt;SUPER::connect&#40;@_&#41;&#41; {
&gt;             # better to die than return here
&gt;             $@ = &#34;Connect failed: $@; $!&#34;;
&gt;             croak&#40;$@&#41;;
&gt;         }
&gt;     }
&gt; 
&gt; When gethostbyname&#40;&#41; returns multiple IP addresses and the first
&gt; &#34;connect&#40;&#41;&#34; attempt results in failure the croak will kill the
&gt; iterating code.  IO::Socket::INET.pm will iterate over
&gt; gethostbyname&#40;&#41;&#39;s output and die in this scenario before attempting
&gt; the second IP.  We were seeing intermittent failures when one of the
&gt; IPs a hostname would resolve to was unreachable.
&gt; 
&gt; To fix this in our application connect&#40;&#41; will return undef instead of
&gt; croaking in a modified Net:SSL.pm file.
&gt; 
&gt;     else {
&gt;         *$self-&gt;{io_socket_peername}=@_ == 1 ? $_[0] :
&gt; IO::Socket::sockaddr_in&#40;@_&#41;;
&gt;         if&#40;!$self-&gt;SUPER::connect&#40;@_&#41;&#41; {
&gt;             $@ = &#34;Connect failed: $@; $!&#34;;
&gt;             return undef;
&gt;             #croak&#40;$@&#41;;
&gt;         }
&gt;     }
&gt; 
&gt; 
&gt; Here is basically the code we were running. To reproduce you need to
&gt; have a round robin DNS entry with one of the IPs being bogus and run
&gt; something similar to the below.
&gt; 
&gt; @LWP::Protocol::http::EXTRA_SOCK_OPTS = &#40;
&gt;     MultiHomed =&gt; 1,
&gt; &#41;;
&gt; my $useragent  = LWP::UserAgent-&gt;new;
&gt; ## build request
&gt; my $response   = $useragent-&gt;request&#40;$request&#41;;
&gt; 
&gt; 
&gt; Thanks,
&gt; 
&gt; Jake Cloyd
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;16:39:09&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;16:39:20&nbsp;2017</span>
    <span class="description">nanis [...] runu.moc.invalid -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
