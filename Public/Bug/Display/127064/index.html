<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127064 for PAR-Packer: Question about weird pp executable behavior </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127064 for PAR-Packer: Question about weird pp executable behavior </h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PAR-Packer/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PAR-Packer">PAR-Packer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127064</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PAR-Packer/Active/">PAR-Packer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">RSCHUPP [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cqu [...] factset.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;07&nbsp;10:58:42&nbsp;2018</span>
    <span class="description">cqu [...] factset.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Question about weird pp executable behavior </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Sep 2018 14:48:40 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PAR-Packer [...] rt.cpan.org&#34; &lt;bug-PAR-Packer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chenchen Qu &lt;cqu [...] factset.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Roderich:

We generate our production release with pp, and recently a new client ran into a weird issue.
When they run the executable file, the cache directory was input as the first argument, for example
When they do run.exe --setup the actual input was run.exe Sonntag\AppData\Local\Temp\par-4a616e20536f6e6e746167\cache-1535125512/run.exe --setup

We are running pp with version PAR Packager, version 1.037 &#40;PAR version 1.014&#41;, And the client was running the executable on Windows 7 with cmd.
I think this might be some bad setup with their PATH variable, but I&#39;m not 100% sure since I can&#39;t reproduce this on any VMs.
Any suggestion is appreciated.

Many thanks in advance,
Chenchen
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;10&nbsp;01:42:41&nbsp;2018</span>
    <span class="description">RSCHUPP [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;10&nbsp;02:04:01&nbsp;2018</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Chenchen,

On 2018-09-07 10:58:42, cqu@factset.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When they run the executable file, the cache directory was input as
&gt; the first argument, for example
&gt; When they do run.exe --setup the actual input was run.exe
&gt; Sonntag\AppData\Local\Temp\par-4a616e20536f6e6e746167\cache-
&gt; 1535125512/run.exe --setup
</div>
Just curious: how did you find out? Did you something like

pp -o run.exe -E &#34;say qq[@ARGV]&#34;

and had the client run this run.exe?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think this might be some bad setup with their PATH variable, but I&#39;m
&gt; not 100% sure since I can&#39;t reproduce this on any VMs.
&gt; Any suggestion is appreciated.
</div>
I can&#39;t think of something that would produce this effect...
I would check the following environment variables in the
client&#39;s environment whether they contain &#34;unusual&#34; characters
&#40;e.g. blanks&#41;: TMPDIR, TEMPDIR, TMP, TEMP and PATH. Also, are there
any environment variables that start with PAR_?

Note that the way how command line arguments are passed
to the packed executable changed in PAR::Packer 1.038 and later.
Could you prepare a test executable like the above packed with
the latest PAR::Packer and have the client run it?

Cheers, Roderich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;10&nbsp;02:04:02&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;10&nbsp;15:43:16&nbsp;2018</span>
    <span class="description">cqu [...] factset.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #127064] Question about weird pp executable behavior</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Sep 2018 19:12:43 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PAR-Packer [...] rt.cpan.org&#34; &lt;bug-PAR-Packer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chenchen Qu &lt;cqu [...] factset.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Roderich:

1. yes we save the @ARGV in our logs so we know exactly what the input is.
2. Weird thing is, I checked the client environment variable, there &#39;s nothing special, both TEMP and TMP are defined as the local temp directory, nothing related with PAR_*. The only thing that raised my attention is the client also have perl installed on the instance, do you think that might cause the DynaLoader to load the wrong libraries and trigger an issue like this?

I&#39;m going to suggest the client to run our application on a clean vm, so this probably won&#39;t happen. Will update with the result. 

Thanks
Chenchen

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Roderich Schupp via RT &lt;bug-PAR-Packer@rt.cpan.org&gt; 
Sent: Monday, September 10, 2018 2:04 AM
To: Chenchen Qu &lt;cqu@factset.com&gt;
Subject: [rt.cpan.org #127064] Question about weird pp executable behavior

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127064">https://rt.cpan.org/Ticket/Display.html?id=127064</a></span> &gt;

Hi Chenchen,

On 2018-09-07 10:58:42, cqu@factset.com wrote:
<div class="message-stanza open">&gt; When they run the executable file, the cache directory was input as 
&gt; the first argument, for example When they do run.exe --setup the 
&gt; actual input was run.exe
&gt; Sonntag\AppData\Local\Temp\par-4a616e20536f6e6e746167\cache-
&gt; 1535125512/run.exe --setup
</div>
Just curious: how did you find out? Did you something like

pp -o run.exe -E &#34;say qq[@ARGV]&#34;

and had the client run this run.exe?

<div class="message-stanza open">&gt; I think this might be some bad setup with their PATH variable, but I&#39;m 
&gt; not 100% sure since I can&#39;t reproduce this on any VMs.
&gt; Any suggestion is appreciated.
</div>
I can&#39;t think of something that would produce this effect...
I would check the following environment variables in the client&#39;s environment whether they contain &#34;unusual&#34; characters &#40;e.g. blanks&#41;: TMPDIR, TEMPDIR, TMP, TEMP and PATH. Also, are there any environment variables that start with PAR_?

Note that the way how command line arguments are passed to the packed executable changed in PAR::Packer 1.038 and later.
Could you prepare a test executable like the above packed with the latest PAR::Packer and have the client run it?

Cheers, Roderich

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;05:28:59&nbsp;2018</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Chenchen,

I was able to reproduce the problem with PAR::Packer 1.037 by running 
the packed executable with environment variables TEMP and TMP set 
to a path that contains blanks, e.g.

set TEMP=C:\Users\SCHRO2~1\.cpanm\work\1536826253.8944\PAR-Packer-1.037\t m p

The test script was

pp -o foo.exe -E &#34;use Data::Dumper; say &#39;ARGV = &#39;, Dumper&#40;\@ARGV&#41;;&#34;

and running this in above environment produces

.\foo.exe 1 2 3
ARGV = $VAR1 = [
          &#39;m&#39;,
          &#39;p\\par-536368526f32342d657874\\cache-688422ed2d95d8d78309df7ba393ecec060a8455/foo.exe&#39;,
          &#39;1&#39;,
          &#39;2&#39;,
          &#39;3&#39;
        ];


The same script packed with PAR::Packer 1.047 works correctly in this environment.

Cheers, Roderich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;05:29:01&nbsp;2018</span>
    <span class="description">RSCHUPP [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;10:04:27&nbsp;2018</span>
    <span class="description">cqu [...] factset.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #127064] Question about weird pp executable behavior</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2018 14:04:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PAR-Packer [...] rt.cpan.org&#34; &lt;bug-PAR-Packer [...] rt.cpan.org&gt;, &#34;par [...] perl.org&#34; &lt;par [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chenchen Qu &lt;cqu [...] factset.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Wow, thanks a lot Roderich, that would&#39;ve taken me hours to debug that issue! And yes that &#39;s exactly the cause, they do have a space in their TMP/TEMP variable.

I will inform the client to set PAR_GLOBAL_TMPDIR and PAR_GLOBAL_TEMP with no space in it as a workaround for now, and will upgrade our library now.

Really appreciate your help!
Chenchen

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Roderich Schupp via RT &lt;bug-PAR-Packer@rt.cpan.org&gt; 
Sent: Thursday, September 13, 2018 5:29 AM
To: par@perl.org
Subject: [rt.cpan.org #127064] Question about weird pp executable behavior

Thu Sep 13 05:28:59 2018: Request 127064 was acted upon.
Transaction: Correspondence added by RSCHUPP
       Queue: PAR-Packer
     Subject: Question about weird pp executable behavior 
   Broken in: &#40;no value&#41;
    Severity: &#40;no value&#41;
       Owner: RSCHUPP
  Requestors: cqu@factset.com
      Status: open
 Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=127064">https://rt.cpan.org/Ticket/Display.html?id=127064</a></span> &gt;


Hi Chenchen,

I was able to reproduce the problem with PAR::Packer 1.037 by running the packed executable with environment variables TEMP and TMP set to a path that contains blanks, e.g.

set TEMP=C:\Users\SCHRO2~1\.cpanm\work\1536826253.8944\PAR-Packer-1.037\t m p

The test script was

pp -o foo.exe -E &#34;use Data::Dumper; say &#39;ARGV = &#39;, Dumper&#40;\@ARGV&#41;;&#34;

and running this in above environment produces

.\foo.exe 1 2 3
ARGV = $VAR1 = [
          &#39;m&#39;,
          &#39;p\\par-536368526f32342d657874\\cache-688422ed2d95d8d78309df7ba393ecec060a8455/foo.exe&#39;,
          &#39;1&#39;,
          &#39;2&#39;,
          &#39;3&#39;
        ];


The same script packed with PAR::Packer 1.047 works correctly in this environment.

Cheers, Roderich
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
