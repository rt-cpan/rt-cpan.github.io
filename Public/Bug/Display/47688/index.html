<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #47688 for Geo-Coder-Bing: Problem using non utf8-flagged strings</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #47688 for Geo-Coder-Bing: Problem using non utf8-flagged strings</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Geo-Coder-Bing/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Geo-Coder-Bing/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Geo-Coder-Bing/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Geo-Coder-Bing/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Geo-Coder-Bing">Geo-Coder-Bing CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">47688</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Geo-Coder-Bing/Active/">Geo-Coder-Bing</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-228260-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.02    </td>
  </tr>
  <tr id="CF-228261-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;08&nbsp;04:23:01&nbsp;2009</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem using non utf8-flagged strings</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems that Geo::Coder::Bing requires the address argument to be in
utf8 *octets*. This is not how perl modules should work, but they should
always operate on *characters*. The attached test script shows the
problem. The script does two geolocation attempts with the same string.
In the first case, the string does not have the utf8 flag, in the second
case, it has. Only the second case delivers a result. Note that I added
a test in the middle to show that the two versions of the string are
equal &#40;is $utf8_address, $address&#41;.

I guess that the geolocation API expects the arguments to be in utf8. So
somewhere an

    encode &#34;utf-8&#34;, $string

call is probably missing in the Geo::Coder::Bing module.

Regards,
    Slaven
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> utf8.t</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
# -*- perl -*-

use strict;
use warnings;
use Data::Dumper;
use Devel::Peek;
use Encode;
use Geo::Coder::Bing;
use Test::More tests =&gt; 3;

my $VERBOSE = 1;

my $geocoder = Geo::Coder::Bing-&gt;new;

my $address = &#34;Rübländerstraße, Berlin, Germany&#34;;
Dump $address if $VERBOSE;
my $location = $geocoder-&gt;geocode&#40;$address&#41;;
ok $location, &#34;Supplied string without utf8 flag&#34;;
warn Dumper $location if $VERBOSE;

my $utf8_address = decode&#40;&#34;iso-8859-1&#34;, $address&#41;; # force utf8 flag
is $utf8_address, $address;
Dump $utf8_address if $VERBOSE;
$location = $geocoder-&gt;geocode&#40;$utf8_address&#41;;
ok $location, &#34;Supplied string with utf8 flag&#34;;
warn Dumper $location if $VERBOSE;

__END__
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;08&nbsp;05:00:46&nbsp;2009</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 08 04:23:01 2009, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems that Geo::Coder::Bing requires the address argument to be in
&gt; utf8 *octets*. This is not how perl modules should work, but they should
&gt; always operate on *characters*. The attached test script shows the
&gt; problem. The script does two geolocation attempts with the same string.
&gt; In the first case, the string does not have the utf8 flag, in the second
&gt; case, it has. Only the second case delivers a result. Note that I added
&gt; a test in the middle to show that the two versions of the string are
&gt; equal &#40;is $utf8_address, $address&#41;.
&gt; 
&gt; I guess that the geolocation API expects the arguments to be in utf8. So
&gt; somewhere an
&gt; 
&gt;     encode &#34;utf-8&#34;, $string
&gt; 
&gt; call is probably missing in the Geo::Coder::Bing module.
&gt; 
&gt; Regards,
&gt;     Slaven
</div>
Both cases work for me. I also have a utf-8 test case in the
distribution under xt/author/live.t. Either LWP::UserAgent or URI are
handling this automatically. I just looked at both
Geo::Coder::{Google,Yahoo} and Google has a minimum required version
specified for URI. So I would first try to upgrade URI. If that doesn&#39;t
work, try upgrading libwww-perl. I&#39;m assuming it&#39;s URI and will bump the
min required version of URI tomorrow. Let me know if it doesn&#39;t work for
you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;08&nbsp;05:00:48&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;08&nbsp;08:03:01&nbsp;2009</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 08 05:00:46 2009, GRAY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Jul 08 04:23:01 2009, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; It seems that Geo::Coder::Bing requires the address argument to be in
&gt; &gt; utf8 *octets*. This is not how perl modules should work, but they should
&gt; &gt; always operate on *characters*. The attached test script shows the
&gt; &gt; problem. The script does two geolocation attempts with the same string.
&gt; &gt; In the first case, the string does not have the utf8 flag, in the second
&gt; &gt; case, it has. Only the second case delivers a result. Note that I added
&gt; &gt; a test in the middle to show that the two versions of the string are
&gt; &gt; equal &#40;is $utf8_address, $address&#41;.
&gt; &gt; 
&gt; &gt; I guess that the geolocation API expects the arguments to be in utf8. So
&gt; &gt; somewhere an
&gt; &gt; 
&gt; &gt;     encode &#34;utf-8&#34;, $string
&gt; &gt; 
&gt; &gt; call is probably missing in the Geo::Coder::Bing module.
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt;     Slaven
</div>&gt; 
&gt; Both cases work for me. I also have a utf-8 test case in the
&gt; distribution under xt/author/live.t.
</div>
I see the test, but it does not look right to me. The French address
uses utf8 octets &#40;the first one&#41;, but in Perl script one is supposed to
deal just with characters. There&#39;s no test for using characters without
utf8 flag &#40;which would be iso-8859-1 octets&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Either LWP::UserAgent or URI are
&gt; handling this automatically. I just looked at both
&gt; Geo::Coder::{Google,Yahoo} and Google has a minimum required version
&gt; specified for URI. So I would first try to upgrade URI. If that doesn&#39;t
&gt; work, try upgrading libwww-perl. I&#39;m assuming it&#39;s URI and will bump the
&gt; min required version of URI tomorrow. Let me know if it doesn&#39;t work for
&gt; you.
</div>
I upgraded URI and LWP, but still the first test in my test script fails.

   $ /usr/perl5.8.9@RC2/bin/perl -MLWP\ 9999
   LWP version 9999 required--this is only version 5.828.
   $ /usr/perl5.8.9@RC2/bin/perl -MURI\ 9999
   URI version 9999 required--this is only version 1.38.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;08&nbsp;10:27:35&nbsp;2009</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 08 08:03:01 2009, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Jul 08 05:00:46 2009, GRAY wrote:
<div class="message-stanza open">&gt; &gt; On Wed Jul 08 04:23:01 2009, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; It seems that Geo::Coder::Bing requires the address argument to be in
&gt; &gt; &gt; utf8 *octets*. This is not how perl modules should work, but they
</div></div></div>should
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; always operate on *characters*. The attached test script shows the
&gt; &gt; &gt; problem. The script does two geolocation attempts with the same
</div></div>string.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; In the first case, the string does not have the utf8 flag, in the
</div></div>second
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; case, it has. Only the second case delivers a result. Note that I
</div></div>added
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; a test in the middle to show that the two versions of the string are
&gt; &gt; &gt; equal &#40;is $utf8_address, $address&#41;.
&gt; &gt; &gt; 
&gt; &gt; &gt; I guess that the geolocation API expects the arguments to be in
</div></div>utf8. So
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; somewhere an
&gt; &gt; &gt; 
&gt; &gt; &gt;     encode &#34;utf-8&#34;, $string
&gt; &gt; &gt; 
&gt; &gt; &gt; call is probably missing in the Geo::Coder::Bing module.
&gt; &gt; &gt; 
&gt; &gt; &gt; Regards,
&gt; &gt; &gt;     Slaven
</div>&gt; &gt; 
&gt; &gt; Both cases work for me. I also have a utf-8 test case in the
&gt; &gt; distribution under xt/author/live.t.
</div>&gt; 
&gt; I see the test, but it does not look right to me. The French address
&gt; uses utf8 octets &#40;the first one&#41;, but in Perl script one is supposed to
&gt; deal just with characters. There&#39;s no test for using characters without
&gt; utf8 flag &#40;which would be iso-8859-1 octets&#41;.
&gt; 
<div class="message-stanza open">&gt; &gt; Either LWP::UserAgent or URI are
&gt; &gt; handling this automatically. I just looked at both
&gt; &gt; Geo::Coder::{Google,Yahoo} and Google has a minimum required version
&gt; &gt; specified for URI. So I would first try to upgrade URI. If that doesn&#39;t
&gt; &gt; work, try upgrading libwww-perl. I&#39;m assuming it&#39;s URI and will bump the
&gt; &gt; min required version of URI tomorrow. Let me know if it doesn&#39;t work for
&gt; &gt; you.
</div>&gt; 
&gt; I upgraded URI and LWP, but still the first test in my test script fails.
&gt; 
&gt;    $ /usr/perl5.8.9@RC2/bin/perl -MLWP\ 9999
&gt;    LWP version 9999 required--this is only version 5.828.
&gt;    $ /usr/perl5.8.9@RC2/bin/perl -MURI\ 9999
&gt;    URI version 9999 required--this is only version 1.38.
&gt; 
&gt; Regards,
&gt;     Slaven
</div>
I cut and paste instead of saving your test cases. That explains why the
first test case worked for me.

As latin1 is frequently really winlatin1, I think it&#39;s best if the
individual decode their own data first. It&#39;s consistent with what
Miyagawa has done in Geo::Coder::Google:

    When you&#39;d like to pass non-ascii string as a location, you should
    pass it as either UTF-8 bytes or Unicode flagged string.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;08&nbsp;10:27:36&nbsp;2009</span>
    <span class="description">gray [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;18:12:24&nbsp;2009</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 08 10:27:35 2009, GRAY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Jul 08 08:03:01 2009, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On Wed Jul 08 05:00:46 2009, GRAY wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Wed Jul 08 04:23:01 2009, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; It seems that Geo::Coder::Bing requires the address argument to
</div></div></div></div>be in
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; utf8 *octets*. This is not how perl modules should work, but they
</div></div>&gt; should
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; always operate on *characters*. The attached test script shows the
&gt; &gt; &gt; &gt; problem. The script does two geolocation attempts with the same
</div></div>&gt; string.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; In the first case, the string does not have the utf8 flag, in the
</div></div>&gt; second
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; case, it has. Only the second case delivers a result. Note that I
</div></div>&gt; added
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; a test in the middle to show that the two versions of the string are
&gt; &gt; &gt; &gt; equal &#40;is $utf8_address, $address&#41;.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I guess that the geolocation API expects the arguments to be in
</div></div>&gt; utf8. So
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; somewhere an
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt;     encode &#34;utf-8&#34;, $string
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; call is probably missing in the Geo::Coder::Bing module.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Regards,
&gt; &gt; &gt; &gt;     Slaven
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; Both cases work for me. I also have a utf-8 test case in the
&gt; &gt; &gt; distribution under xt/author/live.t.
</div>&gt; &gt; 
&gt; &gt; I see the test, but it does not look right to me. The French address
&gt; &gt; uses utf8 octets &#40;the first one&#41;, but in Perl script one is supposed to
&gt; &gt; deal just with characters. There&#39;s no test for using characters without
&gt; &gt; utf8 flag &#40;which would be iso-8859-1 octets&#41;.
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; Either LWP::UserAgent or URI are
&gt; &gt; &gt; handling this automatically. I just looked at both
&gt; &gt; &gt; Geo::Coder::{Google,Yahoo} and Google has a minimum required version
&gt; &gt; &gt; specified for URI. So I would first try to upgrade URI. If that
</div></div></div>doesn&#39;t
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; work, try upgrading libwww-perl. I&#39;m assuming it&#39;s URI and will
</div></div>bump the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; min required version of URI tomorrow. Let me know if it doesn&#39;t
</div></div>work for
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; you.
</div>&gt; &gt; 
&gt; &gt; I upgraded URI and LWP, but still the first test in my test script
</div></div>fails.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt;    $ /usr/perl5.8.9@RC2/bin/perl -MLWP\ 9999
&gt; &gt;    LWP version 9999 required--this is only version 5.828.
&gt; &gt;    $ /usr/perl5.8.9@RC2/bin/perl -MURI\ 9999
&gt; &gt;    URI version 9999 required--this is only version 1.38.
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt;     Slaven
</div>&gt; 
&gt; I cut and paste instead of saving your test cases. That explains why the
&gt; first test case worked for me.
&gt; 
&gt; As latin1 is frequently really winlatin1, I think it&#39;s best if the
&gt; individual decode their own data first. It&#39;s consistent with what
&gt; Miyagawa has done in Geo::Coder::Google:
&gt; 
&gt;     When you&#39;d like to pass non-ascii string as a location, you should
&gt;     pass it as either UTF-8 bytes or Unicode flagged string.
</div>
Sorry, I have to disagree. That&#39;s not how utf8 and non-utf8 is supposed
to work in Perl. If two strings report true on an &#34;eq&#34; operation, but
behave differently &#40;because one has the utf8 flag internally and the
other not&#41;, then this is an error.

If Geo::Coder::Google is also doing it like this, then it also has to be
fixed.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;18:12:25&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;27&nbsp;11:50:00&nbsp;2009</span>
    <span class="description">gray [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;12:12:27&nbsp;2009</span>
    <span class="description">gray [...] cpan.org -  Status changed from &#39;rejected&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
