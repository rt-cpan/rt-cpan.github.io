<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #132064 for File-Slurp: how to manipulate &#34;tempXXXXX&#34; if atomic option is true</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #132064 for File-Slurp: how to manipulate &#34;tempXXXXX&#34; if atomic option is true</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/File-Slurp/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/File-Slurp/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/File-Slurp/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/File-Slurp/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-Slurp">File-Slurp CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">132064</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/File-Slurp/Active/">File-Slurp</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">cwhitener [...] gmail.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SVW [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-13126-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13127-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;11:19:31&nbsp;2020</span>
    <span class="description">SVW [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> how to manipulate &#34;tempXXXXX&#34; if atomic option is true</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">File::Slurp version 9999.29

We wanted to use write_file&#40;&#41; to atomically create a file inside a directory. Unfortunately the directory is observed by another daemon process that detects the intermediate &#34;tempXXXXX&#34; file. The daemon process would ignore hidden files for example. Could we change the behaviour in the following way:

If the atomic option is true and if the option values contains at least 5 X characters &#40;for example { atmoic =&gt; &#34;.tempXXXXX&#34; }&#41; then the option value should be passed as is to 


284: &#40;undef, $file_name&#41; = tempfile&#40;$opts-&gt;{atomic}, DIR =&gt; $dir, OPEN =&gt; 0&#41;;
                        }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;11:45:32&nbsp;2020</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2020-03-05 08:19:31, SVW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; File::Slurp version 9999.29
&gt; 
&gt; We wanted to use write_file&#40;&#41; to atomically create a file inside a
&gt; directory. Unfortunately the directory is observed by another daemon
&gt; process that detects the intermediate &#34;tempXXXXX&#34; file. The daemon
&gt; process would ignore hidden files for example. Could we change the
&gt; behaviour in the following way:
&gt; 
&gt; If the atomic option is true and if the option values contains at
&gt; least 5 X characters &#40;for example { atmoic =&gt; &#34;.tempXXXXX&#34; }&#41; then the
&gt; option value should be passed as is to
&gt; 
&gt; 
&gt; 284: &#40;undef, $file_name&#41; = tempfile&#40;$opts-&gt;{atomic}, DIR =&gt; $dir, OPEN
&gt; =&gt; 0&#41;;
&gt;                         }
</div>

I would suggest creating the file in a tempdir and then renaming it to the intended location afterwards.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;11:45:32&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;02:26:16&nbsp;2020</span>
    <span class="description">SVW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Do 05. Mär 2020, 11:45:32, ETHER schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2020-03-05 08:19:31, SVW wrote:
<div class="message-stanza open">&gt; &gt; File::Slurp version 9999.29
&gt; &gt;
&gt; &gt; We wanted to use write_file&#40;&#41; to atomically create a file inside a
&gt; &gt; directory. Unfortunately the directory is observed by another daemon
&gt; &gt; process that detects the intermediate &#34;tempXXXXX&#34; file. The daemon
&gt; &gt; process would ignore hidden files for example. Could we change the
&gt; &gt; behaviour in the following way:
&gt; &gt;
&gt; &gt; If the atomic option is true and if the option values contains at
&gt; &gt; least 5 X characters &#40;for example { atmoic =&gt; &#34;.tempXXXXX&#34; }&#41; then
&gt; &gt; the
&gt; &gt; option value should be passed as is to
&gt; &gt;
&gt; &gt;
&gt; &gt; 284: &#40;undef, $file_name&#41; = tempfile&#40;$opts-&gt;{atomic}, DIR =&gt; $dir,
&gt; &gt; OPEN
&gt; &gt; =&gt; 0&#41;;
&gt; &gt;                         }
</div>&gt; 
&gt; 
&gt; I would suggest creating the file in a tempdir and then renaming it to
&gt; the intended location afterwards.
</div>
How to work around this missing File::Slurp::write_file&#40;&#41; feature is known to us. This leads to additional code complexity and extra testing effort. I would appreciate and accept any decision about the validity of this feature request. Please close the ticket, if the request is rejected.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;11:46:49&nbsp;2020</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2020-03-05 23:26:16, SVW wrote:
n afterwards.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; How to work around this missing File::Slurp::write_file&#40;&#41; feature is
&gt; known to us. This leads to additional code complexity and extra
&gt; testing effort. I would appreciate and accept any decision about the
&gt; validity of this feature request. Please close the ticket, if the
&gt; request is rejected.
</div>

I am not a maintainer of this distribution so I cannot speak to that. I do know that all users are being actively encouraged to switch to other solutions &#40;due to underlying issues that fundamentally cannot be solved&#41;, notably File::Slurper or Path::Tiny.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;14:58:35&nbsp;2020</span>
    <span class="description">cwhitener [...] gmail.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;15:12:07&nbsp;2020</span>
    <span class="description">cwhitener [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Everyone,

Part of the reason that it&#39;s writing to the same directory as the resultant file is due to some potential issues of different directories having differing ACLs on them. If that case happens, the resultant file will end up with different permissions. There are a few other caveats there as well.

Given those caveats, I&#39;m not sure what that would look like. Adding another option or two there might be necessary to give the user the ability to override the default behavior:

{ atomic =&gt; 1, atomic_temp_pattern =&gt; &#39;tempXXXXX&#39;, atomic_temp_dir =&gt; &#39;/foo/bar&#39;, }

Then that gets a bit more to code around in an already complex function.

On the other hand, making it a &#34;hidden&#34; temporary file all the time could be a solution by changing the temp file pattern to &#39;.tempXXXXX&#39; by default. This wouldn&#39;t add any complexity, would be a one character diff in the release and would solve your particular problem without changing behavior for the rest of the world.

Is the latter a viable option that everyone would be happy with?

Thanks,
Chase
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;04:37:49&nbsp;2020</span>
    <span class="description">SVW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Fr 06. Mär 2020, 15:12:07, CAPOEIRAB schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Everyone,
&gt; 
&gt; Part of the reason that it&#39;s writing to the same directory as the
&gt; resultant file is due to some potential issues of different
&gt; directories having differing ACLs on them. If that case happens, the
&gt; resultant file will end up with different permissions. There are a few
&gt; other caveats there as well.
&gt; 
&gt; Given those caveats, I&#39;m not sure what that would look like. Adding
&gt; another option or two there might be necessary to give the user the
&gt; ability to override the default behavior:
&gt; 
&gt; { atomic =&gt; 1, atomic_temp_pattern =&gt; &#39;tempXXXXX&#39;, atomic_temp_dir =&gt;
&gt; &#39;/foo/bar&#39;, }
&gt; 
&gt; Then that gets a bit more to code around in an already complex
&gt; function.
&gt; 
&gt; On the other hand, making it a &#34;hidden&#34; temporary file all the time
&gt; could be a solution by changing the temp file pattern to &#39;.tempXXXXX&#39;
&gt; by default. This wouldn&#39;t add any complexity, would be a one character
&gt; diff in the release and would solve your particular problem without
&gt; changing behavior for the rest of the world.
&gt; 
&gt; Is the latter a viable option that everyone would be happy with?
&gt; 
&gt; Thanks,
&gt; Chase
</div>
We are happy with your &#34;one character diff&#34; solution proposal. Please create a new release as soon as possible.

Thanks,
Sven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;10:34:36&nbsp;2020</span>
    <span class="description">cwhitener [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Everyone,

A release has been cut with the suggested change: <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/CAPOEIRAB/File-Slurp-9999.30">https://metacpan.org/release/CAPOEIRAB/File-Slurp-9999.30</a></span>

Thanks,
Chase
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;10:34:37&nbsp;2020</span>
    <span class="description">cwhitener [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
