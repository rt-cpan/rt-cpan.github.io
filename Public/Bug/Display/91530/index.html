<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91530 for Module-ScanDeps: Missing MIME\types.db from pp-generated code</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91530 for Module-ScanDeps: Missing MIME\types.db from pp-generated code</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Module-ScanDeps/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Module-ScanDeps/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Module-ScanDeps/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Module-ScanDeps/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-ScanDeps">Module-ScanDeps CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91530</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Module-ScanDeps/Active/">Module-ScanDeps</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">RSCHUPP [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
md5159 [...] mclink.it

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-21736-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.12    </td>
  </tr>
  <tr id="CF-21737-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;19&nbsp;19:46:55&nbsp;2013</span>
    <span class="description">md5159 [...] mclink.it -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Missing MIME\types.db from pp-generated code</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 20 Dec 2013 01:46:41 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ric &lt;md5159 [...] mclink.it&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I&#39;ve an issue, for a missing of MIME:Types.db from code generated via pp 
of PAR::Packer.

Development environment is:

    XP SP3 machine within VirtualBox
    Strawberry Perl 5.18.1.1

    PAR::Packer 1.017
    MIME:Lite 3.030


Interpreted code &#40;i.e. code invoked via &#34;perl -w scriptname.pl&#34;&#41; runs 
fine within this environment, so I would exclude issues on the script.
pp compilation is invoked in a very plain way as

    pp -v -o scriptname.exe scriptname.pl


and does not output any warning.

When the executable gets transferred on a &#34;real&#34; environment &#40;an 
independent, XP SP3 &#34;true&#34; box&#41;, program fails with a

    &#34;cannot open type database in MIME\types.db: No such file or directory&#34;


As a matter of fact, if I enter the cache folder within TEMP &#40;where 
pp-compiled scripts expand their contents&#41;, and navigate downwards to 
\inc\lib\MIME, I find 4 modules there &#40;base64.pm, lite.pm, type.pm, 
types.pm&#41;, but no types.db whatsoever.

I&#39;ve also tried to include explicitly MIME:Lite via -M

    pp -M MIME:Lite -v -o scriptname.exe scriptname.pl


and also, specifying source and destination of the file to be included,

    pp -a
    &#34;c:\strawberry\perl\site\lib\MIME\types.db;/inc/lib/MIME/types.db&#34;
    -v -o scriptname.exe scriptname.pl

still, to no extent. In the last form, I&#39;ve also opened the zipped 
executable, and requested file is not where it should be.

Can&#39;t say whether this is an issue or a pitfall on my side; whatever the 
case, any suggestion/workaround is greatly appreciated.

regards
ric
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;20&nbsp;03:24:14&nbsp;2013</span>
    <span class="description">RSCHUPP [...] cpan.org -  Queue changed from PAR-Packer to Module-ScanDeps</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;20&nbsp;03:24:58&nbsp;2013</span>
    <span class="description">RSCHUPP [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;20&nbsp;03:24:59&nbsp;2013</span>
    <span class="description">RSCHUPP [...] cpan.org -  Broken in 1.12 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;20&nbsp;03:25:36&nbsp;2013</span>
    <span class="description">RSCHUPP [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;21&nbsp;06:52:52&nbsp;2013</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-12-19 19:46:55, md5159@mclink.it wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I&#39;ve an issue, for a missing of MIME:Types.db from code generated via pp 
&gt; of PAR::Packer.
&gt; ...
&gt; Can&#39;t say whether this is an issue or a pitfall on my side; whatever the 
&gt; case, any suggestion/workaround is greatly appreciated.
</div>
Definitely an issue, but it&#39;s complicated. 
If you don&#39;t want to read through my ramblings below, skip to the bottom for a workaround :&#41;

When a pp-packed executable is missing a module or data file, this can usually
be worked around by using pp options -M &#40;for a missing module&#41; or -a &#40;for a plain file&#41;, though to get the latter &#34;right&#34; may need some experimentation
&#40;or insight how some module searches for its data file&#41;.

BTW, even if your workaround works, you might submit a bug report for
Module::ScanDeps &#40;which is used by pp to scan your script for all modules
it uses&#41;. I can usually make the workaround unnecessery by adding another
explicit rule to Module::ScanDeps.

In your case, MIME::Types &#40;it&#39;s not in MIME::Lite, but used by MIME::Lite
under the hood&#41; uses the data file MIME/types.db.
Your idea to use &#34;pp -a ...&#34; to pack this file explicitly is correct,
but can&#39;t work because MIME::Types does the following to open this file:

  open FH, &#34;&lt;:encoding&#40;utf8&#41;&#34;, File::Spec-&gt;catfile&#40;dirname&#40;__FILE__&#41;, &#34;types.db&#34;&#41;
  
This assumes that &#40;when perl parses MIME/Types.pm&#41; __FILE__ is set to the
absolute pathname where MIME/Types.pm was found. This is probably true for
99% of all use cases, but it always breaks in a packed executable.
The reason is that any module is transformed &#40;&#34;filtered&#34;&#41; when it is packed.
The default filter &#40;PodStrip&#41; strips POD from the module. To compensate for that
&#40;so that a die&#40;&#41; or warn&#40;&#41; from inside the module shows the &#34;correct&#34; line number&#41;
it adds &#34;# line N ...&#34; statements. Especially it adds 

# line 1 &#34;MIME/Types.pm&#34;

at the start of the packed MIME/Types.pm. As a side effect this sets 
__FILE__ to &#34;MIME/Types.pm&#34;. So we must use the following options for pp:

  -a &#39;/path/to/your/MIME/types.db;lib/MIME/types.db&#39;

to pack MIME/types.db as a &#34;sibling&#34; of MIME/Types.pm AND suppress 
the application of the PodStrip filter for MIME/Types.pm:

  -F PatchContent=MIME/Types.pm

&#40;or set PAR_VERBATIM=1 in the environment when packing to generally suppress filtering&#41;.

But wait, there&#39;s more :&#40; With the above you will still get

  cannot open type database in /tmp/par-726f646572696368/cache-5be06ead4dff6a6e16c2df7d03b59c0dbf5a8c02/inc/lib/MIME/types.db: No such file or directory

even though this file exists! The reason is the argument &#34;&lt;:encoding&#40;utf8&#41;&#34;
to open&#40;&#41;. It implicitly does &#34;require PerlIO::encoding&#34;. Since this module hasn&#39;t been packed, open&#40;&#41; fails even before actually trying to open the file.
Actually, this is a bug in Module::ScanDeps, it&#39;s supposed to look out for
for patterns like this and infer a dependency on PerlIO and PerlIO::encoding.
I&#39;ve fixed this in Module::ScanDeps, but until its next release the workaround
is to use the pp option

  -M PerlIO::encoding

So the whole workaround is

  pp -a &#34;/path/to/your/MIME/types.db;lib/MIME/types.db&#34; \
     -F PatchContent=MIME/Types.pm \
     -M PerlIO::encoding ...

&#40;use forward slashes even under Windows&#41;

Cheers, Roderich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;21&nbsp;06:52:55&nbsp;2013</span>
    <span class="description">RSCHUPP [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;23&nbsp;09:48:56&nbsp;2013</span>
    <span class="description">md5159 [...] mclink.it -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91530] Missing MIME\types.db from pp-generated code</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Dec 2013 15:48:49 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-ScanDeps [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ric &lt;md5159 [...] mclink.it&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Roderich, for the detailed explanation and the workaround.

Unfortunately, the workaround does not work as expected: despite your 
guidelines, there&#39;s still no trace of the missing types.db, neither 
within the compiled .exe, nor in the cache.

Is there any other chance to force it where it should be?

TIA
ric

On 12/21/2013 12:52 PM, Roderich Schupp via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So the whole workaround is pp -a 
&gt; &#34;/path/to/your/MIME/types.db;lib/MIME/types.db&#34; -F 
&gt; PatchContent=MIME/Types.pm -M PerlIO::encoding ...
&gt; Cheers, Roderich
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;25&nbsp;15:04:31&nbsp;2013</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am 2013-12-23 09:48:56, md5159@mclink.it schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately, the workaround does not work as expected: despite your 
&gt; guidelines, there&#39;s still no trace of the missing types.db, neither 
&gt; within the compiled .exe, nor in the cache.
</div>
Check your -a option for pp. For my Strawberry Perl &#40;installed in C:\strawberry&#41; the following works:

pp -a &#34;C:\strawberry\perl\vendor\lib\MIMEtypes.db;lib/MIME/types.db&#34; ...

Cheers, Roderich
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
