<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30828 for JavaScript: Test failure on 32-bit architectures</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30828 for JavaScript: Test failure on 32-bit architectures</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/JavaScript/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/JavaScript/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/JavaScript/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/JavaScript/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/JavaScript">JavaScript CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30828</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/JavaScript/Active/">JavaScript</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ntyni [...] iki.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-17548-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.04    </td>
  </tr>
  <tr id="CF-17549-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;18&nbsp;15:03:12&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test failure on 32-bit architectures</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

the recently released JavaScript-1.04 &#40;thanks!&#41; is failing tests on
Debian on all 32-bit architectures, including x86. The 64-bit
architectures &#40;amd64, ia64 and alpha&#41; are OK.

The test failure is actually two missing OKs from t/20-bind-class.t,
tests 9 and 10 &#40;the &#34;Check multiple instance methods&#34; block&#41;. There are
no test failures because there&#39;s no check for $@ after the $cx1-&gt;eval&#40;&#41;
call.

I added such a check, and the error string is &#39;o.fone is not a function
at Foo line 103 in 1&#39;. 

Debian currently has JS_VERSION 170. I haven&#39;t tried with other libmozjs
versions yet.

This is perfectly reproducible for me, and I have both 64-bit and a
32-bit installations so it&#39;s easy for me to debug this. I don&#39;t
understand much about the libmozjs internals, though. So far I have
found out that the corresponding js_Invoke&#40;&#41; gets called with different
arguments, but I have no idea yet what&#39;s happening.

Are the tests working for you on a 32-bit host? 

For the record, we&#39;re tracking this as Debian bug #451774,
<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/451774">http://bugs.debian.org/451774</a></span> .

Cheers,
-- 
Niko Tyni
ntyni@iki.fi
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;18&nbsp;15:16:29&nbsp;2007</span>
    <span class="description">claes [...] versed.se -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30828] Test failure on 32-bit architectures </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 18 Nov 2007 21:15:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JavaScript [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claes Jakobsson &lt;claes [...] versed.se&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On 18 nov 2007, at 21.03, ntyni@iki.fi via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the recently released JavaScript-1.04 &#40;thanks!&#41; is failing tests on
&gt; Debian on all 32-bit architectures, including x86. The 64-bit
&gt; architectures &#40;amd64, ia64 and alpha&#41; are OK.
&gt;
&gt; The test failure is actually two missing OKs from t/20-bind-class.t,
&gt; tests 9 and 10 &#40;the &#34;Check multiple instance methods&#34; block&#41;. There  
&gt; are
&gt; no test failures because there&#39;s no check for $@ after the $cx1- 
<div class="message-stanza open">&gt; &gt;eval&#40;&#41;
</div>&gt; call.
&gt;
&gt; I added such a check, and the error string is &#39;o.fone is not a  
&gt; function
&gt; at Foo line 103 in 1&#39;.
&gt;
&gt; Debian currently has JS_VERSION 170. I haven&#39;t tried with other  
&gt; libmozjs
&gt; versions yet.
&gt;
&gt; This is perfectly reproducible for me, and I have both 64-bit and a
&gt; 32-bit installations so it&#39;s easy for me to debug this. I don&#39;t
&gt; understand much about the libmozjs internals, though. So far I have
&gt; found out that the corresponding js_Invoke&#40;&#41; gets called with  
&gt; different
&gt; arguments, but I have no idea yet what&#39;s happening.
&gt;
&gt; Are the tests working for you on a 32-bit host?
</div>
Hm...

I&#39;m developing on Mac OS X 10.5.1 &#40;Darwin 9.1.0&#41; on a Core Duo &#40;32- 
bit&#41; and there are no problems with those tests there against both a  
1.7 and 1.6 release of SM.

I also ran the tests for 1.04 on my Debian 4.0 box &#40;Linux sovereign  
2.6.8-3-686 #1 Tue Dec 5 21:26:38 UTC 2006 i686 GNU/Linux&#41; which is a  
32-bit celeron with a 1.7 release of SM built from source an they all  
passed.

this is truly odd

/claes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;18&nbsp;15:16:30&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;18&nbsp;16:12:21&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30828] Test failure on 32-bit architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 18 Nov 2007 23:12:00 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claes Jakobsson via RT &lt;bug-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] iki.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Nov 18, 2007 at 03:16:31PM -0500, Claes Jakobsson via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m developing on Mac OS X 10.5.1 &#40;Darwin 9.1.0&#41; on a Core Duo &#40;32- 
&gt; bit&#41; and there are no problems with those tests there against both a  
&gt; 1.7 and 1.6 release of SM.
&gt; 
&gt; I also ran the tests for 1.04 on my Debian 4.0 box &#40;Linux sovereign  
&gt; 2.6.8-3-686 #1 Tue Dec 5 21:26:38 UTC 2006 i686 GNU/Linux&#41; which is a  
&gt; 32-bit celeron with a 1.7 release of SM built from source an they all  
&gt; passed.
</div>
FWIW, we&#39;re building with JS_THREADSAFE=1 JS_ENABLE_E4X=1 JS_UTF8=0
since that seems to be what the libmozjs package was compiled with.
Does that match your configuration?

Cheers,
-- 
Niko
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;19&nbsp;15:43:29&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30828] Test failure on 32-bit architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Nov 2007 22:42:40 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claes Jakobsson via RT &lt;bug-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] iki.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Nov 18, 2007 at 03:16:31PM -0500, Claes Jakobsson via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Are the tests working for you on a 32-bit host?
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; this is truly odd
</div>
Update: the difference is that the Debian libmozjs.so is compiled with
MOZILLA_1_8_BRANCH. I can reproduce the problem with stock js-1.7.0.tar.gz
and 

% make -f Makefile.ref JS_THREADSAFE=1 XCFLAGS=-DMOZILLA_1_8_BRANCH=1

The tests succeed when building JavaScript 1.04 with
-DMOZILLA_1_8_BRANCH=1, which changes some things in &lt;mozjs/jsapi.h&gt;.

Now we should just come up with a clean way to integrate this...

Cheers,
-- 
Niko
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;20&nbsp;08:14:00&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30828] Test failure on 32-bit architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 20 Nov 2007 15:13:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claes Jakobsson via RT &lt;bug-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] iki.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Nov 19, 2007 at 10:42:40PM +0200, Niko Tyni wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The tests succeed when building JavaScript 1.04 with
&gt; -DMOZILLA_1_8_BRANCH=1, which changes some things in &lt;mozjs/jsapi.h&gt;.
&gt; 
&gt; Now we should just come up with a clean way to integrate this...
</div>
See also Debian bug #441059, <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/441059">http://bugs.debian.org/441059</a></span> .

Cheers,
-- 
Niko
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;20&nbsp;08:21:20&nbsp;2007</span>
    <span class="description">claes [...] versed.se -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30828] Test failure on 32-bit architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 20 Nov 2007 14:20:49 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JavaScript [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claes Jakobsson &lt;claes [...] versed.se&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hm..

I think the sensible thing would be to interact with pkg-config on  
platforms that has it.

The whole Makefile.PL and build process in JavaScript.pm needs a lot  
of fixing. As of
1.1 I&#39;m actually thinking of bundling JS 1.7 &#40;or later&#41; and use that  
as default unless
otherwise specified.

Do you want commit-bit and fix all debian issues? I think checking if / 
etc/debian_version exists
would be a good entry point for debian configuration things in  
Makefile.pl

Cheers,
Claes

On 20 nov 2007, at 14.14, ntyni@iki.fi via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;       Queue: JavaScript
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=30828">http://rt.cpan.org/Ticket/Display.html?id=30828</a></span> &gt;
&gt;
&gt; On Mon, Nov 19, 2007 at 10:42:40PM +0200, Niko Tyni wrote:
&gt;
<div class="message-stanza open">&gt;&gt; The tests succeed when building JavaScript 1.04 with
&gt;&gt; -DMOZILLA_1_8_BRANCH=1, which changes some things in &lt;mozjs/jsapi.h&gt;.
&gt;&gt;
&gt;&gt; Now we should just come up with a clean way to integrate this...
</div>&gt;
&gt; See also Debian bug #441059, <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/441059">http://bugs.debian.org/441059</a></span> .
&gt;
&gt; Cheers,
&gt; -- 
&gt; Niko
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;22&nbsp;06:03:56&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30828] Test failure on 32-bit architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Nov 2007 13:02:56 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claes Jakobsson via RT &lt;bug-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] iki.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Nov 20, 2007 at 08:21:22AM -0500, Claes Jakobsson via RT wrote:
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think the sensible thing would be to interact with pkg-config on  
&gt; platforms that has it.
</div>
Yeah, at least for finding out the headers and the library paths.
There&#39;s JS_THREADSAFE in there on Debian, but no information about
the other ABI things &#40;JS_UTF8, MOZILLA_1_8_BRANCH&#41;.

I would assume that writing a small C program &#40;autoconf?&#41; to detect the
library ABI things automatically would not be very hard. Of course testing
it on the possible OS and mozjs version combinations is the hard part...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The whole Makefile.PL and build process in JavaScript.pm needs a lot  
&gt; of fixing. As of
&gt; 1.1 I&#39;m actually thinking of bundling JS 1.7 &#40;or later&#41; and use that  
&gt; as default unless
&gt; otherwise specified.
</div>
The bundling sounds overkill to me, but if it&#39;s going to reduce your
support requests... Maybe just state 1.7 is the only one supported?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Do you want commit-bit and fix all debian issues?
</div>
Thanks, but I&#39;m not sure I want to get that involved, given that I&#39;m not
actually using the module myself for anything real. I&#39;m happy to test
out things, though, if you like.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think checking if /etc/debian_version exists
&gt; would be a good entry point for debian configuration things in  
&gt; Makefile.pl
</div>
I&#39;m not sure if derivatives like Ubuntu have it... In general testing
for features and not versions is the way to go, but that makes for
more work again, of course.

Cheers,
-- 
Niko
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
