<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #128950 for Test-Smoke: Branch selected was either not smoked or reported under older branch&#39;s name</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #128950 for Test-Smoke: Branch selected was either not smoked or reported under older branch&#39;s name</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-Smoke/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Smoke">Test-Smoke CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">128950</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-Smoke/Active/">Test-Smoke</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jkeenan [...] pobox.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31598-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31599-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;27&nbsp;16:26:55&nbsp;2019</span>
    <span class="description">jkeenan [...] pobox.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Branch selected was either not smoked or reported under older branch&#39;s name</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 27 Mar 2019 16:26:40 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Smoke [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James E Keenan &lt;jkeenan [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Today on a FreeBSD-11.2 host from which I have been submitting smoke 
tests of the Perl 5 core distribution for at least eight months I had a 
situation where the branch I designated for smoking was not smoked; 
another branch was smoked instead.

When I smoke a branch other than blead I simply type the name of the 
non-blead branch into the first record in &#39;smokecurrent.gitbranch&#39;, 
thereby pushing all other records in that file down one line.

At 14:14 UTC I modified &#39;smokecurrent.gitbranch&#39; to place 
&#39;smoke-me/khw-locale&#39; in the first position.

#####
[p5smoke] $ l smokecurrent.gitbranch
-rw-r--r--  1 jkeenan  jkeenan  2140 Mar 27 14:14 smokecurrent.gitbranch

[p5smoke] $ head -n 5 smokecurrent.gitbranch
blead
smoke-me/jkeenan/ntyni/133928-posix-2nd
blead
smoke-me/jkeenan/ntyni/133928-posix
#####

I then resumed a screen session in which I called &#39;sh 
./smokecurrent.sh&#39;.  This particular smoke configuration is quite 
thorough, so I did not check on its progress for the next 5 hours.  When 
I checked just now, I discovered to my surprise that 
&#39;smoke-me/khw-locale&#39; had not been smoked.  Instead, 
&#39;smoke-me/jkeenan/ntyni/133928-posix-2nd&#39; was smoked -- despite being 
the *third* record in smokecurrent.gitbranch.  &#40;I originally smoked this 
branch on March 16; see <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/82582">http://perl5.test-smoke.org/report/82582</a></span>.  All 
smoke runs between March 16 and March 26 were done on blead.&#41;

I&#39;m attaching a file, 
&#39;febb9d45.freebsd-11.20190327.smokecurrent.reduced.log&#39;, which is 
smokecurrent.log with the data from the individual smoke passes stripped 
out.  &#40;They were all PASS, so the results are not at issue here.&#41;

In that file, note that, as expected, &#39;smoke-me/khw-locale&#39; is the 
branch cited at lines 3, 6, 10 and 16, as expected.  At line 19, 
&#39;febb9d45da2878c49f62aae8212fa4d4c13d883c&#39; is cited as the &#39;patchlevel&#39; 
in the &#39;perl-current/&#39; directory.  Commit febb9d45 was HEAD of the 
&#39;smoke-me/khw-locale&#39; branch at that point in time.  This commit cited 
again at line 29.

However, at line 30 we suddenly see a different, older branch being 
cited:  &#34;Smoking branch smoke-me/jkeenan/ntyni/133928-posix-2nd&#34;.  That 
branch is what gets cited in the web report 
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/83471&#41;">http://perl5.test-smoke.org/report/83471&#41;</a></span>, even though febb9d45 is the 
SHA cited.

Checking on the two repositories which are part of this Test-Smoke rig, 
I see that &#39;git-perl&#39; is in the intended branch but &#39;perl-current&#39; is in 
the non-intended, older branch:

#####
[git-perl] $ gitcurr
smoke-me/khw-locale
[git-perl] $ cd ../perl-current/
[perl-current] $ gitcurr
&#39;smoke-me/jkeenan/ntyni/133928-posix-2nd
#####

&#40;&#39;gitcurr&#39; is an alias for &#39;git branch&#39; grepped for the current branch 
-- that with the asterisk.&#41;

However, when I call &#39;git show --format=fuller&#39; in each of these two 
repositories, I get exactly the same output!  &#40;See attachments.&#41;

Additional data: The name of the requested branch shows up in the *.log 
file for this run.  The name of the non-requested branch shows up in the 
*.jsn, *.log, *.out and *.rpt files for this run.

#####
[smokecurrent] $ grep -l -E &#39;khw&#39; *febb9d45*
logfebb9d45da2878c49f62aae8212fa4d4c13d883c.log
[smokecurrent] $ grep -l -E &#39;ntyni&#39; *febb9d45*
jsnfebb9d45da2878c49f62aae8212fa4d4c13d883c.jsn
logfebb9d45da2878c49f62aae8212fa4d4c13d883c.log
outfebb9d45da2878c49f62aae8212fa4d4c13d883c.out
rptfebb9d45da2878c49f62aae8212fa4d4c13d883c.rpt
#####

It is possible that the branch I requested to be smoked, 
&#39;smoke-me/khw-locale&#39;, was indeed smoked -- but if so it was ultimately 
recorded as being the result of a smoke of the 
&#39;smoke-me/jkeenan/ntyni/133928-posix-2nd&#39; branch.  And it is under the 
latter, non-intended name by which this smoke-test result is catalogued 
at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/search">http://perl5.test-smoke.org/search</a></span>.

So, either I&#39;ve wasted 4+ hours of server time smoking the code of an 
older branch, or I&#39;ve spent 4+ hours testing the correct branch but it&#39;s 
not being reported under that branch&#39;s name.  Which is it?

Can you explain why, starting at line 30 of the log file, the wrong 
branch name is being used?

Thank you very much.
Jim Keenan
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;16&nbsp;21:38:53&nbsp;2019</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 27 16:26:55 2019, jkeenan@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Today on a FreeBSD-11.2 host from which I have been submitting smoke 
&gt; tests of the Perl 5 core distribution for at least eight months I had a 
&gt; situation where the branch I designated for smoking was not smoked; 
&gt; another branch was smoked instead.
&gt; 
&gt; When I smoke a branch other than blead I simply type the name of the 
&gt; non-blead branch into the first record in &#39;smokecurrent.gitbranch&#39;, 
&gt; thereby pushing all other records in that file down one line.
&gt; 
&gt; At 14:14 UTC I modified &#39;smokecurrent.gitbranch&#39; to place 
&gt; &#39;smoke-me/khw-locale&#39; in the first position.
&gt; 
&gt; #####
&gt; [p5smoke] $ l smokecurrent.gitbranch
&gt; -rw-r--r--  1 jkeenan  jkeenan  2140 Mar 27 14:14 smokecurrent.gitbranch
&gt; 
&gt; [p5smoke] $ head -n 5 smokecurrent.gitbranch
&gt; blead
&gt; smoke-me/jkeenan/ntyni/133928-posix-2nd
&gt; blead
&gt; smoke-me/jkeenan/ntyni/133928-posix
&gt; #####
&gt; 
&gt; I then resumed a screen session in which I called &#39;sh 
&gt; ./smokecurrent.sh&#39;.  This particular smoke configuration is quite 
&gt; thorough, so I did not check on its progress for the next 5 hours.  When 
&gt; I checked just now, I discovered to my surprise that 
&gt; &#39;smoke-me/khw-locale&#39; had not been smoked.  Instead, 
&gt; &#39;smoke-me/jkeenan/ntyni/133928-posix-2nd&#39; was smoked -- despite being 
&gt; the *third* record in smokecurrent.gitbranch.  &#40;I originally smoked this 
&gt; branch on March 16; see <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/82582">http://perl5.test-smoke.org/report/82582</a></span>.  All 
&gt; smoke runs between March 16 and March 26 were done on blead.&#41;
&gt; 
&gt; I&#39;m attaching a file, 
&gt; &#39;febb9d45.freebsd-11.20190327.smokecurrent.reduced.log&#39;, which is 
&gt; smokecurrent.log with the data from the individual smoke passes stripped 
&gt; out.  &#40;They were all PASS, so the results are not at issue here.&#41;
&gt; 
&gt; In that file, note that, as expected, &#39;smoke-me/khw-locale&#39; is the 
&gt; branch cited at lines 3, 6, 10 and 16, as expected.  At line 19, 
&gt; &#39;febb9d45da2878c49f62aae8212fa4d4c13d883c&#39; is cited as the &#39;patchlevel&#39; 
&gt; in the &#39;perl-current/&#39; directory.  Commit febb9d45 was HEAD of the 
&gt; &#39;smoke-me/khw-locale&#39; branch at that point in time.  This commit cited 
&gt; again at line 29.
&gt; 
&gt; However, at line 30 we suddenly see a different, older branch being 
&gt; cited:  &#34;Smoking branch smoke-me/jkeenan/ntyni/133928-posix-2nd&#34;.  That 
&gt; branch is what gets cited in the web report 
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/83471&#41;">http://perl5.test-smoke.org/report/83471&#41;</a></span>, even though febb9d45 is the 
&gt; SHA cited.
&gt; 
&gt; Checking on the two repositories which are part of this Test-Smoke rig, 
&gt; I see that &#39;git-perl&#39; is in the intended branch but &#39;perl-current&#39; is in 
&gt; the non-intended, older branch:
&gt; 
&gt; #####
&gt; [git-perl] $ gitcurr
&gt; smoke-me/khw-locale
&gt; [git-perl] $ cd ../perl-current/
&gt; [perl-current] $ gitcurr
&gt; &#39;smoke-me/jkeenan/ntyni/133928-posix-2nd
&gt; #####
&gt; 
&gt; &#40;&#39;gitcurr&#39; is an alias for &#39;git branch&#39; grepped for the current branch 
&gt; -- that with the asterisk.&#41;
&gt; 
&gt; However, when I call &#39;git show --format=fuller&#39; in each of these two 
&gt; repositories, I get exactly the same output!  &#40;See attachments.&#41;
&gt; 
&gt; Additional data: The name of the requested branch shows up in the *.log 
&gt; file for this run.  The name of the non-requested branch shows up in the 
&gt; *.jsn, *.log, *.out and *.rpt files for this run.
&gt; 
&gt; #####
&gt; [smokecurrent] $ grep -l -E &#39;khw&#39; *febb9d45*
&gt; logfebb9d45da2878c49f62aae8212fa4d4c13d883c.log
&gt; [smokecurrent] $ grep -l -E &#39;ntyni&#39; *febb9d45*
&gt; jsnfebb9d45da2878c49f62aae8212fa4d4c13d883c.jsn
&gt; logfebb9d45da2878c49f62aae8212fa4d4c13d883c.log
&gt; outfebb9d45da2878c49f62aae8212fa4d4c13d883c.out
&gt; rptfebb9d45da2878c49f62aae8212fa4d4c13d883c.rpt
&gt; #####
&gt; 
&gt; It is possible that the branch I requested to be smoked, 
&gt; &#39;smoke-me/khw-locale&#39;, was indeed smoked -- but if so it was ultimately 
&gt; recorded as being the result of a smoke of the 
&gt; &#39;smoke-me/jkeenan/ntyni/133928-posix-2nd&#39; branch.  And it is under the 
&gt; latter, non-intended name by which this smoke-test result is catalogued 
&gt; at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/search">http://perl5.test-smoke.org/search</a></span>.
&gt; 
</div>
I had another instance of this problem tonight.  I believe that the branch I intended to smoke &#40;as set in smokecurrent.gitbranch&#41; was actually smoked, but it was reported as a different branch.  See below.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, either I&#39;ve wasted 4+ hours of server time smoking the code of an 
&gt; older branch, or I&#39;ve spent 4+ hours testing the correct branch but it&#39;s 
&gt; not being reported under that branch&#39;s name.  Which is it?
&gt; 
&gt; Can you explain why, starting at line 30 of the log file, the wrong 
&gt; branch name is being used?
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div>
Tonight I intended to smoke this branch: smoke-me/khw-petr

Here is the head of smokecurrent.log.

#####
[2019-05-16 22:10:32+0000] ==&gt; Starting synctree
[2019-05-16 22:10:32+0000] qx[/usr/local/bin/git remote update --prune 2&gt;&#38;1]
[2019-05-16 22:10:36+0000] qx[/usr/local/bin/git checkout smoke-me/khw-petr
[2019-05-16 22:10:36+0000]  2&gt;&#38;1]
Switched to a new branch &#39;smoke-me/khw-petr&#39;
[2019-05-16 22:10:36+0000] qx[/usr/local/bin/git reset --hard origin/smoke-me/khw-petr
[2019-05-16 22:10:36+0000]  2&gt;&#38;1]
[2019-05-16 22:10:36+0000] qx[/usr/local/bin/git clean -dfx 2&gt;&#38;1]
[2019-05-16 22:10:37+0000] qx[/usr/local/bin/git fetch origin 2&gt;&#38;1]
[2019-05-16 22:10:39+0000] qx[/usr/local/bin/git checkout smoke-me/khw-petr
[2019-05-16 22:10:39+0000]  2&gt;&#38;1]
error: Your local changes to the following files would be overwritten by checkout:
    patchlevel.h
Please commit your changes or stash them before you switch branches.
Aborting
[2019-05-16 22:10:39+0000] qx[/usr/local/bin/git reset --hard origin/smoke-me/khw-petr
[2019-05-16 22:10:39+0000]  2&gt;&#38;1]
[2019-05-16 22:10:39+0000] qx[/usr/local/bin/perl5 Porting/make_dot_patch.pl &gt; .patch]
[2019-05-16 22:10:39+0000] /home/jkeenan/p5smoke/perl-current is now up to patchlevel 130031a372ca43b9e664276be0cb4986f39bc432
[2019-05-16 22:10:39+0000] ==&gt; Starting runsmoke
[2019-05-16 22:10:39+0000] [./tssmokeperl.pl] chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
[2019-05-16 22:10:39+0000] Setup alarm: Fri May 17 07:10:39 2019
&#34;x.log&#34; 209L, 12600C                                                          1,1           Top
[2019-05-16 22:10:36+0000] qx[/usr/local/bin/git checkout smoke-me/khw-petr
[2019-05-16 22:10:36+0000] qx[/usr/local/bin/git reset --hard origin/smoke-me/khw-petr
[2019-05-16 22:10:36+0000]  2&gt;&#38;1]
[2019-05-16 22:10:36+0000] qx[/usr/local/bin/git clean -dfx 2&gt;&#38;1]
[2019-05-16 22:10:39+0000]  2&gt;&#38;1]
Please commit your changes or stash them before you switch branches.
[2019-05-16 22:10:39+0000]  2&gt;&#38;1]
[2019-05-16 22:10:39+0000] ==&gt; Starting runsmoke
[2019-05-16 22:10:39+0000] [./tssmokeperl.pl] chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
[2019-05-16 22:10:39+0000] Setup alarm: Fri May 17 07:10:39 2019
[2019-05-16 22:10:39+0000] qx[/usr/local/bin/perl5 -e &#34;require q[/home/jkeenan/p5smoke/perl-current/cpan/Test-Harness/lib/Test/Harness.pm];print Test::Harness-&gt;VERSION&#34; 2&gt;&#38;1]
[2019-05-16 22:10:39+0000] Found: Test::Harness version 3.42.
[2019-05-16 22:10:39+0000] Reading build configurations from /home/jkeenan/p5smoke/perlcurrent.cfg
[2019-05-16 22:10:39+0000] Reading &#39;Policy.sh&#39; from default content &#40;v=1&#41;
[2019-05-16 22:10:39+0000] Running test suite only with &#39;harness&#39;
[2019-05-16 22:10:39+0000] make distclean ...
[2019-05-16 22:10:39+0000] Smoking patch 130031a372ca43b9e664276be0cb4986f39bc432 v5.30.0-RC1-16-g130031a372
[2019-05-16 22:10:39+0000] Smoking branch blead
#####

Note the last two lines above. 30031a372ca43b9e664276be0cb4986f39bc432 is indeed the SHA for HEAD in the smoke-me/khw-petr branch.  But then in the last line it states that we&#39;re smoking &#39;blead&#39;.  And &#39;blead&#39; is what got reported in <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/87533">http://perl5.test-smoke.org/report/87533</a></span>!

If I descend into the perl-current directory, I&#39;m told that the current branch is &#39;blead&#39;.

#####
$ gitcurr
blead
#####

But &#39;git log&#39; starts like this:

#####
commit 130031a372ca43b9e664276be0cb4986f39bc432 &#40;HEAD -&gt; blead, origin/smoke-me/khw-petr&#41;
Author: Karl Williamson &lt;khw@cpan.org&gt;
Date:   Thu May 16 15:47:20 2019 -0600

    [perl #134112] 5.30 regression in Unicode properties defined with splice

#####

So the right SHA, the wrong branch, but the right &#34;branch based on&#34;.

Can you explain what is happening?

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;16&nbsp;21:38:54&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;16&nbsp;21:53:15&nbsp;2019</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 16 21:38:53 2019, JKEENAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Mar 27 16:26:55 2019, jkeenan@pobox.com wrote:
<div class="message-stanza open">&gt; &gt; Today on a FreeBSD-11.2 host from which I have been submitting smoke
&gt; &gt; tests of the Perl 5 core distribution for at least eight months I had
&gt; &gt; a
&gt; &gt; situation where the branch I designated for smoking was not smoked;
&gt; &gt; another branch was smoked instead.
&gt; &gt;
&gt; &gt; When I smoke a branch other than blead I simply type the name of the
&gt; &gt; non-blead branch into the first record in &#39;smokecurrent.gitbranch&#39;,
&gt; &gt; thereby pushing all other records in that file down one line.
&gt; &gt;
&gt; &gt; At 14:14 UTC I modified &#39;smokecurrent.gitbranch&#39; to place
&gt; &gt; &#39;smoke-me/khw-locale&#39; in the first position.
&gt; &gt;
&gt; &gt; #####
&gt; &gt; [p5smoke] $ l smokecurrent.gitbranch
&gt; &gt; -rw-r--r--  1 jkeenan  jkeenan  2140 Mar 27 14:14
&gt; &gt; smokecurrent.gitbranch
&gt; &gt;
&gt; &gt; [p5smoke] $ head -n 5 smokecurrent.gitbranch
&gt; &gt; blead
&gt; &gt; smoke-me/jkeenan/ntyni/133928-posix-2nd
&gt; &gt; blead
&gt; &gt; smoke-me/jkeenan/ntyni/133928-posix
&gt; &gt; #####
&gt; &gt;
&gt; &gt; I then resumed a screen session in which I called &#39;sh
&gt; &gt; ./smokecurrent.sh&#39;.  This particular smoke configuration is quite
&gt; &gt; thorough, so I did not check on its progress for the next 5 hours.
&gt; &gt; When
&gt; &gt; I checked just now, I discovered to my surprise that
&gt; &gt; &#39;smoke-me/khw-locale&#39; had not been smoked.  Instead,
&gt; &gt; &#39;smoke-me/jkeenan/ntyni/133928-posix-2nd&#39; was smoked -- despite being
&gt; &gt; the *third* record in smokecurrent.gitbranch.  &#40;I originally smoked
&gt; &gt; this
&gt; &gt; branch on March 16; see <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/82582">http://perl5.test-smoke.org/report/82582</a></span>.
&gt; &gt; All
&gt; &gt; smoke runs between March 16 and March 26 were done on blead.&#41;
&gt; &gt;
&gt; &gt; I&#39;m attaching a file,
&gt; &gt; &#39;febb9d45.freebsd-11.20190327.smokecurrent.reduced.log&#39;, which is
&gt; &gt; smokecurrent.log with the data from the individual smoke passes
&gt; &gt; stripped
&gt; &gt; out.  &#40;They were all PASS, so the results are not at issue here.&#41;
&gt; &gt;
&gt; &gt; In that file, note that, as expected, &#39;smoke-me/khw-locale&#39; is the
&gt; &gt; branch cited at lines 3, 6, 10 and 16, as expected.  At line 19,
&gt; &gt; &#39;febb9d45da2878c49f62aae8212fa4d4c13d883c&#39; is cited as the
&gt; &gt; &#39;patchlevel&#39;
&gt; &gt; in the &#39;perl-current/&#39; directory.  Commit febb9d45 was HEAD of the
&gt; &gt; &#39;smoke-me/khw-locale&#39; branch at that point in time.  This commit
&gt; &gt; cited
&gt; &gt; again at line 29.
&gt; &gt;
&gt; &gt; However, at line 30 we suddenly see a different, older branch being
&gt; &gt; cited:  &#34;Smoking branch smoke-me/jkeenan/ntyni/133928-posix-2nd&#34;.
&gt; &gt; That
&gt; &gt; branch is what gets cited in the web report
&gt; &gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/83471&#41;">http://perl5.test-smoke.org/report/83471&#41;</a></span>, even though febb9d45 is
&gt; &gt; the
&gt; &gt; SHA cited.
&gt; &gt;
&gt; &gt; Checking on the two repositories which are part of this Test-Smoke
&gt; &gt; rig,
&gt; &gt; I see that &#39;git-perl&#39; is in the intended branch but &#39;perl-current&#39; is
&gt; &gt; in
&gt; &gt; the non-intended, older branch:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; [git-perl] $ gitcurr
&gt; &gt; smoke-me/khw-locale
&gt; &gt; [git-perl] $ cd ../perl-current/
&gt; &gt; [perl-current] $ gitcurr
&gt; &gt; &#39;smoke-me/jkeenan/ntyni/133928-posix-2nd
&gt; &gt; #####
&gt; &gt;
&gt; &gt; &#40;&#39;gitcurr&#39; is an alias for &#39;git branch&#39; grepped for the current
&gt; &gt; branch
&gt; &gt; -- that with the asterisk.&#41;
&gt; &gt;
&gt; &gt; However, when I call &#39;git show --format=fuller&#39; in each of these two
&gt; &gt; repositories, I get exactly the same output!  &#40;See attachments.&#41;
&gt; &gt;
&gt; &gt; Additional data: The name of the requested branch shows up in the
&gt; &gt; *.log
&gt; &gt; file for this run.  The name of the non-requested branch shows up in
&gt; &gt; the
&gt; &gt; *.jsn, *.log, *.out and *.rpt files for this run.
&gt; &gt;
&gt; &gt; #####
&gt; &gt; [smokecurrent] $ grep -l -E &#39;khw&#39; *febb9d45*
&gt; &gt; logfebb9d45da2878c49f62aae8212fa4d4c13d883c.log
&gt; &gt; [smokecurrent] $ grep -l -E &#39;ntyni&#39; *febb9d45*
&gt; &gt; jsnfebb9d45da2878c49f62aae8212fa4d4c13d883c.jsn
&gt; &gt; logfebb9d45da2878c49f62aae8212fa4d4c13d883c.log
&gt; &gt; outfebb9d45da2878c49f62aae8212fa4d4c13d883c.out
&gt; &gt; rptfebb9d45da2878c49f62aae8212fa4d4c13d883c.rpt
&gt; &gt; #####
&gt; &gt;
&gt; &gt; It is possible that the branch I requested to be smoked,
&gt; &gt; &#39;smoke-me/khw-locale&#39;, was indeed smoked -- but if so it was
&gt; &gt; ultimately
&gt; &gt; recorded as being the result of a smoke of the
&gt; &gt; &#39;smoke-me/jkeenan/ntyni/133928-posix-2nd&#39; branch.  And it is under
&gt; &gt; the
&gt; &gt; latter, non-intended name by which this smoke-test result is
&gt; &gt; catalogued
&gt; &gt; at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/search">http://perl5.test-smoke.org/search</a></span>.
&gt; &gt;
</div>&gt; 
&gt; I had another instance of this problem tonight.  I believe that the
&gt; branch I intended to smoke &#40;as set in smokecurrent.gitbranch&#41; was
&gt; actually smoked, but it was reported as a different branch.  See
&gt; below.
&gt; 
<div class="message-stanza open">&gt; &gt; So, either I&#39;ve wasted 4+ hours of server time smoking the code of an
&gt; &gt; older branch, or I&#39;ve spent 4+ hours testing the correct branch but
&gt; &gt; it&#39;s
&gt; &gt; not being reported under that branch&#39;s name.  Which is it?
&gt; &gt;
&gt; &gt; Can you explain why, starting at line 30 of the log file, the wrong
&gt; &gt; branch name is being used?
&gt; &gt;
&gt; &gt; Thank you very much.
&gt; &gt; Jim Keenan
</div>&gt; 
&gt; Tonight I intended to smoke this branch: smoke-me/khw-petr
&gt; 
&gt; Here is the head of smokecurrent.log.
&gt; 
&gt; #####
&gt; [2019-05-16 22:10:32+0000] ==&gt; Starting synctree
&gt; [2019-05-16 22:10:32+0000] qx[/usr/local/bin/git remote update --prune
<div class="message-stanza open">&gt; 2&gt;&#38;1]
</div>&gt; [2019-05-16 22:10:36+0000] qx[/usr/local/bin/git checkout smoke-
&gt; me/khw-petr
&gt; [2019-05-16 22:10:36+0000]  2&gt;&#38;1]
&gt; Switched to a new branch &#39;smoke-me/khw-petr&#39;
&gt; [2019-05-16 22:10:36+0000] qx[/usr/local/bin/git reset --hard
&gt; origin/smoke-me/khw-petr
&gt; [2019-05-16 22:10:36+0000]  2&gt;&#38;1]
&gt; [2019-05-16 22:10:36+0000] qx[/usr/local/bin/git clean -dfx 2&gt;&#38;1]
&gt; [2019-05-16 22:10:37+0000] qx[/usr/local/bin/git fetch origin 2&gt;&#38;1]
&gt; [2019-05-16 22:10:39+0000] qx[/usr/local/bin/git checkout smoke-
&gt; me/khw-petr
&gt; [2019-05-16 22:10:39+0000]  2&gt;&#38;1]
&gt; error: Your local changes to the following files would be overwritten
&gt; by checkout:
&gt;     patchlevel.h
&gt; Please commit your changes or stash them before you switch branches.
&gt; Aborting
&gt; [2019-05-16 22:10:39+0000] qx[/usr/local/bin/git reset --hard
&gt; origin/smoke-me/khw-petr
&gt; [2019-05-16 22:10:39+0000]  2&gt;&#38;1]
&gt; [2019-05-16 22:10:39+0000] qx[/usr/local/bin/perl5
&gt; Porting/make_dot_patch.pl &gt; .patch]
&gt; [2019-05-16 22:10:39+0000] /home/jkeenan/p5smoke/perl-current is now
&gt; up to patchlevel 130031a372ca43b9e664276be0cb4986f39bc432
&gt; [2019-05-16 22:10:39+0000] ==&gt; Starting runsmoke
&gt; [2019-05-16 22:10:39+0000] [./tssmokeperl.pl]
&gt; chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
&gt; [2019-05-16 22:10:39+0000] Setup alarm: Fri May 17 07:10:39 2019
&gt; &#34;x.log&#34; 209L, 12600C
&gt; 1,1           Top
&gt; [2019-05-16 22:10:36+0000] qx[/usr/local/bin/git checkout smoke-
&gt; me/khw-petr
&gt; [2019-05-16 22:10:36+0000] qx[/usr/local/bin/git reset --hard
&gt; origin/smoke-me/khw-petr
&gt; [2019-05-16 22:10:36+0000]  2&gt;&#38;1]
&gt; [2019-05-16 22:10:36+0000] qx[/usr/local/bin/git clean -dfx 2&gt;&#38;1]
&gt; [2019-05-16 22:10:39+0000]  2&gt;&#38;1]
&gt; Please commit your changes or stash them before you switch branches.
&gt; [2019-05-16 22:10:39+0000]  2&gt;&#38;1]
&gt; [2019-05-16 22:10:39+0000] ==&gt; Starting runsmoke
&gt; [2019-05-16 22:10:39+0000] [./tssmokeperl.pl]
&gt; chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
&gt; [2019-05-16 22:10:39+0000] Setup alarm: Fri May 17 07:10:39 2019
&gt; [2019-05-16 22:10:39+0000] qx[/usr/local/bin/perl5 -e &#34;require
&gt; q[/home/jkeenan/p5smoke/perl-current/cpan/Test-
&gt; Harness/lib/Test/Harness.pm];print Test::Harness-&gt;VERSION&#34; 2&gt;&#38;1]
&gt; [2019-05-16 22:10:39+0000] Found: Test::Harness version 3.42.
&gt; [2019-05-16 22:10:39+0000] Reading build configurations from
&gt; /home/jkeenan/p5smoke/perlcurrent.cfg
&gt; [2019-05-16 22:10:39+0000] Reading &#39;Policy.sh&#39; from default content
&gt; &#40;v=1&#41;
&gt; [2019-05-16 22:10:39+0000] Running test suite only with &#39;harness&#39;
&gt; [2019-05-16 22:10:39+0000] make distclean ...
&gt; [2019-05-16 22:10:39+0000] Smoking patch
&gt; 130031a372ca43b9e664276be0cb4986f39bc432 v5.30.0-RC1-16-g130031a372
&gt; [2019-05-16 22:10:39+0000] Smoking branch blead
&gt; #####
&gt; 
&gt; Note the last two lines above. 30031a372ca43b9e664276be0cb4986f39bc432
&gt; is indeed the SHA for HEAD in the smoke-me/khw-petr branch.  But then
&gt; in the last line it states that we&#39;re smoking &#39;blead&#39;.  And &#39;blead&#39; is
&gt; what got reported in <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/87533">http://perl5.test-smoke.org/report/87533</a></span>!
&gt; 
&gt; If I descend into the perl-current directory, I&#39;m told that the
&gt; current branch is &#39;blead&#39;.
&gt; 
&gt; #####
&gt; $ gitcurr
&gt; blead
&gt; #####
&gt; 
&gt; But &#39;git log&#39; starts like this:
&gt; 
&gt; #####
&gt; commit 130031a372ca43b9e664276be0cb4986f39bc432 &#40;HEAD -&gt; blead,
&gt; origin/smoke-me/khw-petr&#41;
&gt; Author: Karl Williamson &lt;khw@cpan.org&gt;
&gt; Date:   Thu May 16 15:47:20 2019 -0600
&gt; 
&gt; [perl #134112] 5.30 regression in Unicode properties defined with
&gt; splice
&gt; 
&gt; #####
&gt; 
&gt; So the right SHA, the wrong branch, but the right &#34;branch based on&#34;.
&gt; 
&gt; Can you explain what is happening?
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div>
And here is the same problem again -- on a completely different machine/OS.

See <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/87530">http://perl5.test-smoke.org/report/87530</a></span>

Note that the SHA reported as having been smoked is 130031a372ca43b9e664276be0cb4986f39bc432 -- the HEAD of the smoke-me/khw-petr branch.  But the *branch* reported as having been smoked is:

smoke-me/tonyc/133958-realloc-errno-success

... which was the most recent non-blead branch smoked on this machine.

#####
$ head -3 smokecurrent.gitbranch 
smoke-me/khw-petr
blead
smoke-me/tonyc/133958-realloc-errno-success
#####

Once again, smokecurrent.log starts out as indicating that &#39;smoke-me/khw-petr&#39; is being smoked, and even lists the correct SHA -- but then it says that &#39;blead&#39; is being smoked.

#####
$ head -30 smokecurrent.log
[2019-05-16 18:13:08-0400] ==&gt; Starting synctree
[2019-05-16 18:13:08-0400] qx[/usr/bin/git remote update --prune 2&gt;&#38;1]
[2019-05-16 18:13:13-0400] qx[/usr/bin/git checkout smoke-me/khw-petr
[2019-05-16 18:13:13-0400]  2&gt;&#38;1]
Switched to a new branch &#39;smoke-me/khw-petr&#39;
[2019-05-16 18:13:13-0400] qx[/usr/bin/git reset --hard origin/smoke-me/khw-petr
[2019-05-16 18:13:13-0400]  2&gt;&#38;1]
[2019-05-16 18:13:13-0400] qx[/usr/bin/git clean -dfx 2&gt;&#38;1]
[2019-05-16 18:13:13-0400] qx[/usr/bin/git fetch origin 2&gt;&#38;1]
[2019-05-16 18:13:14-0400] qx[/usr/bin/git checkout smoke-me/khw-petr
[2019-05-16 18:13:14-0400]  2&gt;&#38;1]
error: Your local changes to the following files would be overwritten by checkout:
        patchlevel.h
Please, commit your changes or stash them before you can switch branches.
Aborting
[2019-05-16 18:13:14-0400] qx[/usr/bin/git reset --hard origin/smoke-me/khw-petr
[2019-05-16 18:13:14-0400]  2&gt;&#38;1]
[2019-05-16 18:13:14-0400] qx[/usr/bin/perl Porting/make_dot_patch.pl &gt; .patch]
[2019-05-16 18:13:14-0400] /home/jkeenan/p5smoke/perl-current is now up to patchlevel 130031a372ca43b9e664276be0cb4986f39bc432
[2019-05-16 18:13:14-0400] ==&gt; Starting runsmoke
[2019-05-16 18:13:14-0400] [./tssmokeperl.pl] chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
[2019-05-16 18:13:14-0400] Setup alarm: Fri May 17 00:13:14 2019
[2019-05-16 18:13:14-0400] qx[/usr/bin/perl -e &#34;require q[/home/jkeenan/p5smoke/perl-current/cpan/Test-Harness/lib/Test/Harness.pm];print Test::Harness-&gt;VERSION&#34; 2&gt;&#38;1]
[2019-05-16 18:13:14-0400] Found: Test::Harness version 3.42.
[2019-05-16 18:13:14-0400] Reading build configurations from /home/jkeenan/p5smoke/perlcurrent.cfg
[2019-05-16 18:13:14-0400] Reading &#39;Policy.sh&#39; from default content &#40;v=1&#41;
[2019-05-16 18:13:14-0400] Running test suite only with &#39;harness&#39;
[2019-05-16 18:13:14-0400] make distclean ...
[2019-05-16 18:13:14-0400] Smoking patch 130031a372ca43b9e664276be0cb4986f39bc432 v5.30.0-RC1-16-g130031a
[2019-05-16 18:13:14-0400] Smoking branch smoke-me/tonyc/133958-realloc-errno-success
#####
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;06&nbsp;09:47:48&nbsp;2019</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;04&nbsp;10:22:11&nbsp;2019</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jul 06 09:47:48 2019, JKEENAN wrote:
[snip]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Another instance of the same problem:  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test">http://perl5.test</a></span>-
&gt; smoke.org/report/90909
&gt; 
&gt; Branch requested for smoking:  smoke-me/jkeenan/haarg/134265-storable
&gt; 
&gt; SHA at HEAD of branch requested for smoking:
&gt; 052bf3ea478f1e981347b34ab49e5a9a1b940707
&gt; 
&gt; #####
&gt; commit 052bf3ea478f1e981347b34ab49e5a9a1b940707 &#40;HEAD -&gt; 134265-
&gt; storable, origin/smoke-me/jkeenan/haarg/134265-storable&#41;
&gt; Author:     Graham Knop &lt;haarg@haarg.org&gt;
&gt; AuthorDate: Sat Apr 20 12:53:06 2019 +0200
&gt; Commit:     James E Keenan &lt;jkeenan@cpan.org&gt;
&gt; CommitDate: Fri Jul 5 08:03:33 2019 -0400
&gt; 
&gt; move Storable CAN_FLOCK computation into XS
&gt; #####
&gt; 
&gt; Branch reported in GUI as being tested:  blead
&gt; 
&gt; #####
&gt; Automated smoke report for branch blead 5.31.2 patch
&gt; 052bf3ea478f1e981347b34ab49e5a9a1b940707 v5.31.1-131-g052bf3ea47
&gt; #####
&gt; 
&gt; This is from my &#39;perl-reporter-05&#39; VM which smoke-tests perl on
&gt; FreeBSD-13.
&gt; 
</div>
Yet another instance of the &#34;correct SHA smoked but branch reported was incorrect&#34; problem:
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/100925">http://perl5.test-smoke.org/report/100925</a></span>

Branch requested for smoking:
#####
$ head -n 1 smokecurrent.gitbranch                                        
smoke-me/jkeenan/lgtm-ae73d7ec2
#####

SHA at HEAD of branch requested for smoking:
commit b957d605cb4a2fe83969f60f8b3da323ff4eaeba

Branch reported as being tested:
smoke-me/jkeenan/niner/gh-14816/niner-blead
#####
Automated smoke report for branch smoke-me/jkeenan/niner/gh-14816/niner-blead 5.31.7 patch b957d605cb4a2fe83969f60f8b3da323ff4eaeba v5.31.6-77-gb957d605cb
#####

In perl-current directory:
#####
$ git log --format=fuller
commit b957d605cb4a2fe83969f60f8b3da323ff4eaeba &#40;HEAD -&gt; smoke-me/jkeenan/niner/gh-14816/niner-blead, origin/smoke-me/jkeenan/lgtm-ae73d7ec2&#41;
Author:     James E Keenan &lt;jkeenan@cpan.org&gt;
AuthorDate: Mon Dec 2 21:50:17 2019 -0500
Commit:     James E Keenan &lt;jkeenan@cpan.org&gt;
CommitDate: Mon Dec 2 22:00:04 2019 -0500

    Local variable &#39;imode&#39; hides a parameter of the same name
#####

Reporting consequences:

<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/100925">http://perl5.test-smoke.org/report/100925</a></span> is reported at:
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/search?selected_osnm=openbsd&#38;report_osnm=openbsd&#38;selected_perl=all">http://perl5.test-smoke.org/search?selected_osnm=openbsd&#38;report_osnm=openbsd&#38;selected_perl=all</a></span>

Arch    Host    OS      Git-id  Branch  Smoke date      Status
amd64   perl-reporter-04        openbsd - 6.4   v5.31.6-77-gb957d605cb  smoke-me/jkeenan/niner/gh-14816/niner-blead     2019-12-03 23:38:37+00  PASS

correct platform, hostname, OS version, Git-id, WRONG branch, correct date, correct results

At Tony Cook&#39;s <span class="clickylink"><a target="new" rel="nofollow" href="http://perl.develop-help.com">http://perl.develop-help.com</a></span>, branch is reported under the requested branch&#39;s name.
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl.develop-help.com/?b=smoke-me%2Fjkeenan%2Flgtm-ae73d7ec2">http://perl.develop-help.com/?b=smoke-me%2Fjkeenan%2Flgtm-ae73d7ec2</a></span>

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;04&nbsp;14:31:21&nbsp;2020</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 04 10:22:11 2019, JKEENAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Jul 06 09:47:48 2019, JKEENAN wrote:
&gt; [snip]
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Another instance of the same problem:  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test">http://perl5.test</a></span>-
&gt; &gt; smoke.org/report/90909
&gt; &gt;
&gt; &gt; Branch requested for smoking:  smoke-me/jkeenan/haarg/134265-storable
&gt; &gt;
&gt; &gt; SHA at HEAD of branch requested for smoking:
&gt; &gt; 052bf3ea478f1e981347b34ab49e5a9a1b940707
&gt; &gt;
&gt; &gt; #####
&gt; &gt; commit 052bf3ea478f1e981347b34ab49e5a9a1b940707 &#40;HEAD -&gt; 134265-
&gt; &gt; storable, origin/smoke-me/jkeenan/haarg/134265-storable&#41;
&gt; &gt; Author:     Graham Knop &lt;haarg@haarg.org&gt;
&gt; &gt; AuthorDate: Sat Apr 20 12:53:06 2019 +0200
&gt; &gt; Commit:     James E Keenan &lt;jkeenan@cpan.org&gt;
&gt; &gt; CommitDate: Fri Jul 5 08:03:33 2019 -0400
&gt; &gt;
&gt; &gt; move Storable CAN_FLOCK computation into XS
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Branch reported in GUI as being tested:  blead
&gt; &gt;
&gt; &gt; #####
&gt; &gt; Automated smoke report for branch blead 5.31.2 patch
&gt; &gt; 052bf3ea478f1e981347b34ab49e5a9a1b940707 v5.31.1-131-g052bf3ea47
&gt; &gt; #####
&gt; &gt;
&gt; &gt; This is from my &#39;perl-reporter-05&#39; VM which smoke-tests perl on
&gt; &gt; FreeBSD-13.
&gt; &gt;
</div>&gt; 
&gt; Yet another instance of the &#34;correct SHA smoked but branch reported
&gt; was incorrect&#34; problem:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/100925">http://perl5.test-smoke.org/report/100925</a></span>
&gt; 
&gt; Branch requested for smoking:
&gt; #####
&gt; $ head -n 1 smokecurrent.gitbranch
&gt; smoke-me/jkeenan/lgtm-ae73d7ec2
&gt; #####
&gt; 
&gt; SHA at HEAD of branch requested for smoking:
&gt; commit b957d605cb4a2fe83969f60f8b3da323ff4eaeba
&gt; 
&gt; Branch reported as being tested:
&gt; smoke-me/jkeenan/niner/gh-14816/niner-blead
&gt; #####
&gt; Automated smoke report for branch smoke-me/jkeenan/niner/gh-
&gt; 14816/niner-blead 5.31.7 patch
&gt; b957d605cb4a2fe83969f60f8b3da323ff4eaeba v5.31.6-77-gb957d605cb
&gt; #####
&gt; 
&gt; In perl-current directory:
&gt; #####
&gt; $ git log --format=fuller
&gt; commit b957d605cb4a2fe83969f60f8b3da323ff4eaeba &#40;HEAD -&gt; smoke-
&gt; me/jkeenan/niner/gh-14816/niner-blead, origin/smoke-me/jkeenan/lgtm-
&gt; ae73d7ec2&#41;
&gt; Author:     James E Keenan &lt;jkeenan@cpan.org&gt;
&gt; AuthorDate: Mon Dec 2 21:50:17 2019 -0500
&gt; Commit:     James E Keenan &lt;jkeenan@cpan.org&gt;
&gt; CommitDate: Mon Dec 2 22:00:04 2019 -0500
&gt; 
&gt; Local variable &#39;imode&#39; hides a parameter of the same name
&gt; #####
&gt; 
&gt; Reporting consequences:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/100925">http://perl5.test-smoke.org/report/100925</a></span> is reported at:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test">http://perl5.test</a></span>-
&gt; smoke.org/search?selected_osnm=openbsd&#38;report_osnm=openbsd&#38;selected_perl=all
&gt; 
&gt; Arch    Host    OS      Git-id  Branch  Smoke date      Status
&gt; amd64   perl-reporter-04        openbsd - 6.4   v5.31.6-77-gb957d605cb
&gt; smoke-me/jkeenan/niner/gh-14816/niner-blead     2019-12-03 23:38:37+00
&gt; PASS
&gt; 
&gt; correct platform, hostname, OS version, Git-id, WRONG branch, correct
&gt; date, correct results
&gt; 
&gt; At Tony Cook&#39;s <span class="clickylink"><a target="new" rel="nofollow" href="http://perl.develop-help.com">http://perl.develop-help.com</a></span>, branch is reported under
&gt; the requested branch&#39;s name.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl.develop-help.com/?b=smoke-me%2Fjkeenan%2Flgtm-ae73d7ec2">http://perl.develop-help.com/?b=smoke-me%2Fjkeenan%2Flgtm-ae73d7ec2</a></span>
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div>
And still another instance of a branch being smoked as intended but reported incorrectly:

#####
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/112544">http://perl5.test-smoke.org/report/112544</a></span>
#####

Above URL starts with:

#####
Automated smoke report for branch blead 5.31.11 patch 8fc4f28f17d7062b4400738f796902b81d39a70c v5.31.10-74-g8fc4f28f17
#####

But SHA 8fc4f28f17d is from the smoke-me/tonyc/17268-yyl_try-recursion-test branch:

#####
commit 8fc4f28f17d7062b4400738f796902b81d39a70c &#40;HEAD -&gt; smoke-me/tonyc/17268-yyl_try-recursion-test, origin/smoke-me/tonyc/17268-yyl_try-recursion-test&#41;
Author:     Tony Cook &lt;tony@develop-help.com&gt;
AuthorDate: Mon Apr 6 15:33:08 2020 +1000
Commit:     Tony Cook &lt;tony@develop-help.com&gt;
CommitDate: Mon Apr 27 11:35:48 2020 +1000
#####

smoke-me/tonyc/17268-yyl_try-recursion-test was the branch I requested:

#####
$ head -2 smokecurrent.gitbranch
smoke-me/tonyc/17268-yyl_try-recursion-test
blead
#####

And this report was correctly filed at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl.develop-help.com/?b=smoke-me%2Ftonyc%2F17268-yyl_try-recursion-test">http://perl.develop-help.com/?b=smoke-me%2Ftonyc%2F17268-yyl_try-recursion-test</a></span>.

Curiously, the same commit was both correctly run and reported in an OpenBSD-6.6 VM which sits on the host on which the above smoke-test was run.

#####
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/112546">http://perl5.test-smoke.org/report/112546</a></span>
#####

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;19&nbsp;07:24:35&nbsp;2020</span>
    <span class="description">abeltje [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After looking at this again, I found a problem with the code:

The &#39;gitbranchfile&#39; mechanism was designed to have 1 line with a single branch-name in it &#40;without \n&#41;, you put in multiple lines with different branches.
For now, I&#39;m not going to change the &#39;single branch name&#39; policy and will only smoke the branch that is on the first line of the file, but I&#39;ve fixed the newline issue.

* I will put this in dev-release 1.77_02

The multi branch smoke is quite hard to solve from within Test::Smoke as it was never designed to work that way, you may have to solve that at a higher level with a shell-script.

Thanks for reporting this issue +
good luck.

an behalf of the TestSmokeTeam,

-- Abe.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;19&nbsp;07:24:36&nbsp;2020</span>
    <span class="description">abeltje [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;19&nbsp;08:00:20&nbsp;2020</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 19 07:24:35 2020, ABELTJE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; After looking at this again, I found a problem with the code:
&gt; 
&gt; The &#39;gitbranchfile&#39; mechanism was designed to have 1 line with a
&gt; single branch-name in it &#40;without \n&#41;, you put in multiple lines with
&gt; different branches.
&gt; For now, I&#39;m not going to change the &#39;single branch name&#39; policy and
&gt; will only smoke the branch that is on the first line of the file, but
&gt; I&#39;ve fixed the newline issue.
</div>
In version 0.029 of lib/Test/Smoke/Syncer/Git.pm, we have this documentation and code:

#####
=head2 $git-&gt;get_git_branch&#40;&#41;

Reads the first line of the file set in B&lt;gitbranchfile&gt; and returns its
value.

=cut

sub get_git_branch {
    my $self = shift;

    return $self-&gt;{gitdfbranch} if !$self-&gt;{gitbranchfile};
    return $self-&gt;{gitdfbranch} if ! -f $self-&gt;{gitbranchfile};

    if &#40;open my $fh, &#39;&lt;&#39;, $self-&gt;{gitbranchfile}&#41; {
        $self-&gt;log_debug&#40;&#34;Reading branch to smoke from: &#39;$self-&gt;{gitbranchfile}&#39;&#34;&#41;;

        my $branch = &lt;$fh&gt;;
        close $fh;
        return $branch;
    }
    $self-&gt;log_warn&#40;&#34;Error opening &#39;$self-&gt;{gitbranchfile}&#39;: $!&#34;&#41;;
    return $self-&gt;{gitdfbranch};
}
#####

I&#39;ve always interpeted the documentation to mean:  &#34;Use the branch cited on the *first* line of gitbranchfile; all other lines in that file will be ignored for the purpose of this smoke-test run.&#34;

For someone who tests a variety of branches and kicks off smoke-test runs manually, not &#40;evidently&#41; being required to keep the file at just one line has generally been very convenient.

$branch should be chomp-ed.  Even if a file has just one record in it, my default assumption is that that file ends in a newline &#40;even if that&#39;s not strictly true in Unix&#41;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; * I will put this in dev-release 1.77_02
&gt; 
&gt; The multi branch smoke is quite hard to solve from within Test::Smoke
&gt; as it was never designed to work that way, you may have to solve that
&gt; at a higher level with a shell-script.
&gt; 
</div>
I&#39;m not sure what you mean by the &#34;multi branch smoke&#34;.  I only smoke one branch at a time.  If, say, I did want to smoke 3 specific branches on a given day, I would handle that at the outermost level of the Test-Smoke world such as &#39;smokecurrent.sh&#39;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for reporting this issue +
&gt; good luck.
&gt; 
&gt; an behalf of the TestSmokeTeam,
&gt; 
&gt; -- Abe.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;19&nbsp;08:00:21&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
