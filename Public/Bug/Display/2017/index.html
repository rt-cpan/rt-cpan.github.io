<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #2017 for MARC-Record: MARC::File::USMARC assumes that fields apper in directory order</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #2017 for MARC-Record: MARC::File::USMARC assumes that fields apper in directory order</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MARC-Record/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MARC-Record/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MARC-Record/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MARC-Record/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MARC-Record">MARC-Record CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">2017</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MARC-Record/Active/">MARC-Record</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
moregan [...] stresscafe.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20332-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.17    </td>
  </tr>
  <tr id="CF-20333-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;31&nbsp;19:01:42&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MARC::File::USMARC assumes that fields apper in directory order</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">MARC::File::USMARC-&gt;decode&#40;&#41; assumes that field data in the body of the record appears in the same order as the directory entries.  That&#39;s not required by the standard, and you will run across records for which the assumption fails.  The consequence of this is that tags get the wrong data.

The standard allows dead space/garbage between fields, too, so the technique of splitting on the end of field character is never guaranteed to produce the correct results.

Thanks to Tim Wentz for pointing out this problem.

A dump of the the first record in the attached example file:

Record: 1
Leader: 00748cam  2200277   4500

Tag  Len Offset
=== ==== ======

001   11      0
005   17     11
008   39     28
010   13     67
020   15     80
040   19     95
043   12    114
050   16    126
082   14    142
092   17    156
035   16    173
035   15    189
035   15    389  *** OFFSET IS OUT OF SEQUENCE ***
100   16    204
245   40    220
260   41    260
300   32    301
490   28    333
651   13    361
852   66    404  *** OFFSET IS OUT OF SEQUENCE ***
995   15    374

Offset Tag data
====== ==================================
     0 0000000001^
    11 20000427061119.0^
    28 690528s1969    nyuab         000 0 eng^
    67   _a68008765^
    80   _a080691100X^
    95   _aDLC_cDLC_dm.c.^
   114   _aNcho---^
   126   _aF1504_b.W43^
   142   _a972.83/05^
   156   _a917.283_bWed^
   173   _a   00000619^
   189   _a0000000013^
   204   _aWeddle, Ken^
   220   _aHonduras in pictures /_cKen Weddle.^
   260   _aNew York,_bSterling Pub. Co._c{1969}^
   301   _a64 p._billus., map._c27 cm.^
   333   _aVisual geography series^
   361   _aHonduras^
   374   _a60_a87_a90^
   389   _a0000000013^
   404   _a87_h917.283_p00099786_t1_b                              _iWed^
   470 END OF RECORD^
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">00748cam  2200277   4500001001100000005001700011008003900028010001300067020001500080040001900095043001200114050001600126082001400142092001700156035001600173035001500189035001500389100001600204245004000220260004100260300003200301490002800333651001300361852006600404995001500374000000000120000427061119.0690528s1969    nyuab         000 0 eng  a68008765  a080691100X  aDLCcDLCdm.c.  aNcho---  aF1504b.W43  a972.83/05  a917.283bWed  a   00000619  a0000000013  aWeddle, Ken  aHonduras in pictures /cKen Weddle.  aNew York,bSterling Pub. Co.c{1969}  a64 p.billus., map.c27 cm.  aVisual geography series  aHonduras  a60a87a90  a0000000013  a87h917.283p00099786t1b                              iWed01060cam  2200277   4500001001100000005001700011008003900028010001700067040002900084050001700113082001000130092001500140035001600155035001500171035001500703100003100186245009800217260003600315300003100351490001800382520023500400650001200635650003300647852006400718995002300680000000000220000427061119.0690506s1968    nyua   j     00010 eng  a68010046 /AC  aDLCcDLCdOCLdm.c.dIVS  aPZ10.H78bIn  a595.7  a595.7bHor  a   00000788  a0000000025  aHornblow, Leonora,d 1920-  aInsects do the strangest things /cby Leonora and Arthur Hornblow ; ill. by Michael K. Frith.  aNew York,bRandom Housec{1968}  a60 p.bcol. illus.c21 cm.  aStep-up books  aDescribes nineteen insects that have peculiar and strange characteristics like the camouflage of the walking stick, the driver ants that prefer people to picnics, and the bugs that row themselves like boats on the water&#39;s surface.  aInsects  aInsectsxHabits and behavior  a92a72a87a75a74  a0000000025  a87h595.7p00098996t1b                              iHor00889cam  2200265   4500001001100000005001700011008003900028010001700067040001300084050001800097082001000115092001100125035001600136035001500152035001500548100001600167245005700183260005800240300002100298520018000319650002000499650002200519852006000563995000700541000000000320000427061119.0690428s1969    nyu    j      000 1 eng  a68011823 /AC  aDLCcDLC  aPZ7.H5347bHo  a{Fic}  aFbHig  a   00000828  a0000000029  aHigdon, Hal  aThe Horse that played center field /cby Hal Higdon.  aNew York, N.Y. :bHolt, Rinehart and Winston,cc1969.  a118 p. ;c22 cm.  aAfter Oscar the horse began playing center field, the New York Goats, worst team in the major leagues, seemed certain to win the World Series, and then--Oscar was horse-naped.  aHorsesxFiction  aBaseballxFiction  a87  a0000000029  a87hFp00101717t1b                              iHig01174cam  2200313   4500001001100000005001700011008003900028010001700067040002400084041001100108050001700119082001000136092001100146035001600157035001500173035001500785100002700188245008500215250001400300260004200314300003300356500007700389520022700466650003300693700002800726852006000800945001600754995001500770000000000420000427061119.0690410c19681967maua   j      000 1 eng  a68015390 /AC  aDLCcDLCdm.c.dSER  aEngger  aPZ7.S829bQe  a{Fic}  aFbSte  a   00000939  a0000000043  aStephan, Hanna,d1902-  aThe Quest.cTranslated by Daphne Machin Goodall. Illustrated by Antony Maitland.  a{1st ed.}  aBoston,bLittle, Brownc{1968, c1967}  aviii, 216 p.billus.c21 cm.  aLondon ed. &#40;Heinemann&#41; published in 1967 under title: The long way home.  aCaptured and adopted by a Russian officer during World War II when he is five years old, a German boy spends the next nine years wandering throughout Asia in an attempt to return home to a mother he only vaguely remembers.  aVoyages and travelsxFiction  aMaitland, Antony,d1935  aJc1n76680  a87a61a88  a0000000043  a87hFp00101784t1b                              iSte00813cam  2200265   4500001001100000005001700011008003900028010001700067040001300084050001900097082001000116092001100126035001600137035001500153035001500472100001600168245005700184250001400241260003000255300003300285520011800318650002100436852006000487995001500457000000000520000427061119.0690505s1969    nyua   j      000 1 eng  a68017524 /AC  aDLCcDLC  aPZ10.3.J77bKo  a{Fic}  aFbJoh  a   00001003  a0000000050  aJones, Liza  aKolo the panda;bstory and pictures,cby Liza Jones.  a{1st ed.}  aNew York,bNortonc{1969}  a{48} p.billus.c21 x 26 cm.  aUnhappy with their life at the zoo, the animals, led by the elephant and the panda, plot and carry out an escape.  aAnimalsxFiction  a68a86a87  a0000000050  a87hFp00101838t1b                              iJon</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;24&nbsp;16:15:16&nbsp;2003</span>
    <span class="description">andy [...] petdance.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed a version or two ago.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;24&nbsp;16:15:17&nbsp;2003</span>
    <span class="description">andy [...] petdance.com -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
