<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13851 for PathTools: abs_path fails if no rights for current directory</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13851 for PathTools: abs_path fails if no rights for current directory</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PathTools">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PathTools">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PathTools">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PathTools">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PathTools">PathTools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13851</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PathTools">PathTools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
baldvin [...] cs.elte.hu

<br />
jkeenan [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
ether [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-24906-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24907-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




abs_path.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/429596/210177/abs_path.patch">
Sun Mar 02 05:56:31 2008 (5.9k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>


perl_abs_path.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/401744/188029/perl_abs_path.patch">
Tue Dec 25 03:48:53 2007 (11.9k) by mschwern [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/401712/188008/perl_abs_path.patch">
Tue Dec 25 00:03:14 2007 (2.6k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>


permissions.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/401501/187886/permissions.t">
Mon Dec 24 05:41:41 2007 (858b) by mschwern [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=13851">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-137780" href="/Public/Bug/Display.html?id=13851#txn-137780">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;25&nbsp;03:40:06&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> abs_path fails if no rights for current directory</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/137780/37947/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/37947">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 594b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Try the following:

chmod 000 .
perl -w -e &#39;use Cwd qw&#40;abs_path&#41;; print abs_path&#40;&#34;/&#34;&#41;, &#34;\n&#34;&#39;

It fails, because abs_path tries to chdir and come back in order to do its job -- however, it cannot come back. The problem is quite interesting for me, since I develop a tool for system administration, and the following common conditions are resulting in failure:
1. the home direcotries are on nfs
2. the user homes of the sysadmins are not readable nor executable for anybody else
3. the nfs is mounted with root_squash.
Now &#34;su&#34;, and there you go with a directory that you cannot chdir back in...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-322356" href="/Public/Bug/Display.html?id=13851#txn-322356">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;25&nbsp;16:13:13&nbsp;2007</span>
    <span class="description">dan.harbin [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dan.harbin [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/322356/147439/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/147439">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 217b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is also a problem for me.
This bug is duplicated in ticket 27294 and bug 4593.

I noticed that this was a problem for XS abs_path and fast_abs_path, but
not _perl_abs_path.  I tested on version 3.05 of pathtools.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-322357" href="/Public/Bug/Display.html?id=13851#txn-322357">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;25&nbsp;16:13:14&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-398810" href="/Public/Bug/Display.html?id=13851#txn-398810">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;08:57:57&nbsp;2007</span>
    <span class="description">kwilliams [...] cpan.org -  Dependency by ticket #30413 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-401487" href="/Public/Bug/Display.html?id=13851#txn-401487">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;24&nbsp;05:26:45&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mschwern [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/401487/187871/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/187871">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 995b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a similar situation.  Dreamhost sets /home 771, so I can&#39;t read
/home but I can cd into it.  This results in abs_path&#40;&#41; &#40;and thus
getcwd&#41; to fail while building perl.

The problem appears to be in _perl_abs_path&#40;&#41;, which is why it only
effects the build before Cwd.xs has been built.  It can be simulated
like so...

~/tmp$ mkdir -p home/username/foo

~/tmp$ chmod 771 home 

~/tmp$ sudo chown root:staff home

~/tmp$ ls home
ls: cannot open directory home: Permission denied

~/tmp$ ls -ld home
drwxrwx--x 3 root staff 102 Dec 24 02:21 home

~/tmp$ cd home/username/foo

~/tmp/home/username/foo$ perl -MCwd -wle &#39;print
Cwd::abs_path&#40;&#34;.&#34;&#41;&#39;/Users/schwern/tmp/home/username/foo

~/tmp/home/username/foo$ perl -MCwd -wle &#39;print Cwd::_perl_abs_path&#40;&#34;.&#34;&#41;&#39;
opendir&#40;./../..&#41;: Permission denied at -e line 1

This is with 5.8.8 and Cwd 3.25, 5.10.0 and Cwd 3.2501.  5.6.2 w/Cwd
2.04 and 5.5.5 w/Cwd 2.01 fail with abs_path&#40;&#41; because it is the same
code as _perl_abs_path&#40;&#41;.  It&#39;s a very old bug.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-401501" href="/Public/Bug/Display.html?id=13851#txn-401501">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;24&nbsp;05:41:38&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/401501/187883/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/187883">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 19b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is a test.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/401501/187886/permissions.t">Download permissions.t</a><br />
<span class="downloadcontenttype">text/x-perl 858b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!./perl -w

BEGIN {
    if &#40;$ENV{PERL_CORE}&#41; {
        chdir &#39;t&#39;;
        @INC = &#39;../lib&#39;;
    }
}
use Cwd;
chdir &#39;t&#39;;

use strict;
use Config;
use File::Spec;
use File::Path;

use lib File::Spec-&gt;catdir&#40;&#39;t&#39;, &#39;lib&#39;&#41;;
require VMS::Filespec if $^O eq &#39;VMS&#39;;

use Test::More tests =&gt; 9;

my $starting_wd = Cwd::abs_path&#40;&#41;;
my $x_but_no_r = &#39;x_but_no_r&#39;;
my $test_dir   = &#39;foo&#39;;
my $test_path  = File::Spec-&gt;catdir&#40;$x_but_no_r, $test_dir&#41;;

ok mkpath&#40;$test_path&#41;;
ok chmod 0100, $x_but_no_r;

ok !opendir&#40;my $dh, $x_but_no_r&#41;, &#34;directory unreadable as desired&#34;;
ok chdir $x_but_no_r,     &#34;  but we can cd into it&#34;;
ok chdir $test_dir;

like Cwd::abs_path&#40;&#34;.&#34;&#41;,       qr{\Q$test_path\E$}, &#39;abs_path&#39;;
like Cwd::_perl_abs_path&#40;&#34;.&#34;&#41;, qr{\Q$test_path\E$}, &#39;abs_path no-XS&#39;;

END {
    chdir $starting_wd;
    ok chmod 0700, $x_but_no_r;
    ok rmtree $x_but_no_r;
}</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-401507" href="/Public/Bug/Display.html?id=13851#txn-401507">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;24&nbsp;07:01:42&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/401507/187892/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/187892">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve figured out the basic problem.  You&#39;re supposed to cheat and run a
setuid executable.  IEEE even recommends it.

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.opengroup.org/onlinepubs/009695399/functions/getcwd.html">http://www.opengroup.org/onlinepubs/009695399/functions/getcwd.html</a></span>
-------------
If a program is operating in a directory where some &#40;grand&#41;parent
directory does not permit reading, getcwd&#40;&#41; may fail, as in most
implementations it must read the directory to determine the name of the
file. This can occur if search, but not read, permission is granted in
an intermediate directory, or if the program is placed in that directory
by some more privileged process &#40;for example, login&#41;. Including the
[EACCES] error condition makes the reporting of the error consistent and
warns the application writer that getcwd&#40;&#41; can fail for reasons beyond
the control of the application writer or user. Some implementations can
avoid this occurrence &#40;for example, by implementing getcwd&#40;&#41; using pwd,
where pwd is a set-user-root process&#41;, thus the error was made optional.
Since this volume of IEEE Std 1003.1-2001 permits the addition of other
errors, this would be a common addition and yet one that applications
could not be expected to deal with without this addition.
-------------

So that pretty much boils down to if the opendir&#40;&#41; fails it should fall
back to _backtick_pwd&#40;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-401712" href="/Public/Bug/Display.html?id=13851#txn-401712">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;25&nbsp;00:03:13&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/401712/188005/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/188005">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 833b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is a fix.  It just calls _backtick_pwd&#40;&#41; if the opendir&#40;&#41;
fails.  This is, alas, a bit Unix centric but then again so are
filesystem permissions.

It might make sense to check the exact errno returned from opendir &#40;ie.
EACCES&#41; or to see if the directory in question is unreadable, but I
don&#39;t think it&#39;s necessary to get too specific and trying the native pwd
on failure seems a good general recovery mechanism.

The fix is still evolving.  In particular I need to check when the cwd
itself is unreadable, I think all the stats in _perl_abs_path&#40;&#41; will be
trouble.

In the process of fixing this I discovered another problem with
_perl_abs_path.  realpath &#40;which is abs_path&#41; should work even when
given a subdir that doesn&#39;t exist and _perl_abs_path doesn&#39;t.  I&#39;ll post
that in another bug, in this test it&#39;s inside a TODO.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/401712/188008/perl_abs_path.patch">Download perl_abs_path.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- t/permissions.t	&#40;/vendor/PathTools&#41;	&#40;revision 41190&#41;
+++ t/permissions.t	&#40;/local/PathTools&#41;	&#40;revision 41190&#41;
@@ -0,0 +1,76 @@
+#!./perl -w
+
+BEGIN {
+    if &#40;$ENV{PERL_CORE}&#41; {
+        chdir &#39;t&#39;;
+        @INC = &#39;../lib&#39;;
+    }
+}
+use Cwd;
+chdir &#39;t&#39;;
+
+use strict;
+use Config;
+use File::Spec;
+use File::Path;
+
+use lib File::Spec-&gt;catdir&#40;&#39;t&#39;, &#39;lib&#39;&#41;;
+require VMS::Filespec if $^O eq &#39;VMS&#39;;
+
+use Test::More;
+
+# Set up the environment.
+my $starting_wd = Cwd::abs_path&#40;&#41;;
+my $x_but_no_r = &#39;x_but_no_r&#39;;
+my $test_dir   = &#39;testdir&#39;;
+my $sub_dir    = &#39;subdir&#39;;
+my $test_path  = File::Spec-&gt;catdir&#40;$x_but_no_r, $test_dir&#41;;
+my $sub_path   = File::Spec-&gt;catdir&#40;$test_path, $sub_dir&#41;;
+
+eval {
+    mkpath&#40;$sub_path&#41;               or die;
+    chmod 0100, $x_but_no_r         or die;
+
+    !opendir&#40;my $dh, $x_but_no_r&#41;   or die;
+    chdir $x_but_no_r               or die;
+    chdir $test_dir                 or die;
+};
+if&#40; $@ &#41; {
+    plan skip_all =&gt; 
+            &#34;restricted permission test environment could not be made&#34;
+}
+else {
+    plan tests =&gt; 8;
+}
+
+
+my %funcs = &#40;
+    abs_path        =&gt; \&#38;Cwd::abs_path,
+    _perl_abs_path  =&gt; \&#38;Cwd::_perl_abs_path,
+&#41;;
+for my $name &#40;sort keys %funcs&#41; {
+    my $func = $funcs{$name};
+
+    like $func-&gt;&#40;&#41;,         qr{\Q$test_path\E$}, &#34;$name w/no args&#34;;
+    like $func-&gt;&#40;$sub_dir&#41;, qr{\Q$sub_path\E$},  &#34;$name w/subdir&#34;;
+    
+    # All but the last component of pathname must exist when realpath&#40;&#41;
+    # is called. -- BSD realpath man page.
+    my $dne_path = File::Spec-&gt;catdir&#40;$test_path, &#34;dne&#34;&#41;;
+    TODO: {
+        local $TODO = &#39;Perl abs_path&#40;&#41; does not work with a bogus sub file&#39;
+            if $name =~ /perl/;
+        like $func-&gt;&#40;&#34;dne&#34;&#41;, qr{\Q$dne_path\E$}, 
+             &#34;$name w/non-existant filename&#34;;
+    }
+
+    my $double_dne = File::Spec-&gt;catdir&#40;&#34;dne&#34;, &#34;sub_dne&#34;&#41;;
+    ok !$func-&gt;&#40;$double_dne&#41;, &#34;$name w/non-existant sub dir&#34;;
+}
+
+
+END {
+    chdir $starting_wd;
+    chmod 0700, $x_but_no_r;
+    rmtree $x_but_no_r;
+}
\ No newline at end of file
--- MANIFEST	&#40;/vendor/PathTools&#41;	&#40;revision 41190&#41;
+++ MANIFEST	&#40;/local/PathTools&#41;	&#40;revision 41190&#41;
@@ -23,6 +23,7 @@
 t/lib/Test/More.pm
 t/lib/Test/Simple.pm
 t/lib/Test/Tutorial.pod
+t/permissions.t
 t/rel2abs2rel.t
 t/Spec.t
 t/taint.t
--- Cwd.pm	&#40;/vendor/PathTools&#41;	&#40;revision 41190&#41;
+++ Cwd.pm	&#40;/local/PathTools&#41;	&#40;revision 41190&#41;
@@ -540,8 +540,8 @@
 	local *PARENT;
 	unless &#40;opendir&#40;PARENT, $dotdots&#41;&#41;
 	{
-	    _carp&#40;&#34;opendir&#40;$dotdots&#41;: $!&#34;&#41;;
-	    return &#39;&#39;;
+	    # probably a permissions issue.  Try the native command.
+	    return File::Spec-&gt;rel2abs&#40; $start, _backtick_pwd&#40;&#41; &#41;;
 	}
 	unless &#40;@cst = stat&#40;$dotdots&#41;&#41;
 	{
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-401744" href="/Public/Bug/Display.html?id=13851#txn-401744">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;25&nbsp;03:48:53&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mschwern [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/401744/188026/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/188026">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 766b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, so that&#39;s not a fix for this problem, it&#39;s a fix for a different
problem.

The XS version of abs_path&#40;&#41; is failing if it has no rights for the
current directory.  Ironicly, the _perl_abs_path&#40;&#41; works.

Anyhow, abs_path&#40;&#41; uses the copy of OpenBSD&#39;s realpath&#40;&#41; in Cwd.xs. 
That&#39;s code over 9 years old.  On a hunch I grabbed the latest version
and slapped it in.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.openbsd.org/cgi-bin/cvsweb/src/lib/libc/stdlib/realpath.c">http://www.openbsd.org/cgi-bin/cvsweb/src/lib/libc/stdlib/realpath.c</a></span>

As it doesn&#39;t use chdir&#40;&#41;, and no gotos, it required a lot less
modification.  This fixes the problem with abs_path&#40;&#41; and probably a
small pile of others.

Since this version of realpath&#40;&#41; is a lot easier to follow than the old
one, I can probably duplicate it in _perl_abs_path&#40;&#41;.  More to come, but
the latest patch is attached.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/401744/188029/perl_abs_path.patch">Download perl_abs_path.patch</a><br />
<span class="downloadcontenttype">text/x-diff 11.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-402605" href="/Public/Bug/Display.html?id=13851#txn-402605">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;27&nbsp;08:49:13&nbsp;2007</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kwilliams [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/402605/188516/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/188516">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 307b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Excellent, I like the way this is going.

I applied the patch and all previous tests pass; for the new t/abs_path.t, tests 1-2 &#38; 9-11 fail, 
`pwd` says &#34;permission denied&#34;.

Weird that they don&#39;t use fchdir&#40;&#41; anymore, I haven&#39;t looked over the new algorithm but I 
thought that would be a part of it.

 -Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-409613" href="/Public/Bug/Display.html?id=13851#txn-409613">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;16&nbsp;21:26:33&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/409613/199742/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/199742">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 280b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Those tests are still failing and I haven&#39;t had the time to look into why.  For the last couple 
releases, there have been some urgent things necessitating other fixes to be pushed out, so I&#39;ve 
just removed t/abs_path.t from the MANIFEST.  If we can get it working, great.

 -Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-429596" href="/Public/Bug/Display.html?id=13851#txn-429596">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;02&nbsp;05:56:31&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/429596/210174/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210174">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 173b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s some improvements to _perl_abs_path&#40;&#41; and another shot at
abs_path.t.  This is a diff against 3.2701.

This fixes _perl_abs_path&#40;&#41; with a filename that doesn&#39;t exist.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/429596/210177/abs_path.patch">Download abs_path.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- t/abs_path.t	&#40;/vendor/PathTools&#41;	&#40;revision 54975&#41;
+++ t/abs_path.t	&#40;/local/PathTools&#41;	&#40;revision 54975&#41;
@@ -0,0 +1,108 @@
+#!./perl -w
+
+BEGIN {
+    if &#40;$ENV{PERL_CORE}&#41; {
+        chdir &#39;t&#39;;
+        @INC = &#39;../lib&#39;;
+    }
+}
+use Cwd;
+chdir &#39;t&#39;;
+
+use strict;
+use Carp;
+use Carp::Heavy;  # because we chdir around later and it won&#39;t be found
+use Config;
+use File::Spec;
+BEGIN { package FS;  our @ISA = qw&#40;File::Spec&#41; }
+use File::Path;
+
+use lib FS-&gt;catdir&#40;&#39;t&#39;, &#39;lib&#39;&#41;;
+require VMS::Filespec if $^O eq &#39;VMS&#39;;
+
+use Test::More;
+
+sub cmp_path {
+    my&#40;$got, $expected, $name&#41; = @_;
+    
+    $expected = File::Spec-&gt;catdir&#40;@$expected&#41; if defined $expected;
+    
+    local $Test::Builder::Level = $Test::Builder::Level + 1;
+    return is lc $got, lc $expected, $name;
+}
+
+# Set up the environment.
+my $starting_wd = Cwd::abs_path&#40;&#41;;
+my $x_but_no_r = &#39;x_but_no_r&#39;;
+my $test_dir   = &#39;testdir&#39;;
+my $sub_dir    = &#39;subdir&#39;;
+my $test_path  = FS-&gt;catdir&#40;$x_but_no_r, $test_dir&#41;;
+my $sub_path   = FS-&gt;catdir&#40;$test_path, $sub_dir&#41;;
+
+my $build_environment = eval {
+    mkpath&#40;$sub_path&#41;               or die;
+    chmod 0100, $x_but_no_r         or die;
+
+    !opendir&#40;my $dh, $x_but_no_r&#41;   or die;
+    chdir $x_but_no_r               or die;
+    chdir $test_dir                 or die;
+};
+END {
+    chdir $starting_wd;
+    chmod 0700, $x_but_no_r;
+    rmtree $x_but_no_r;
+}
+
+if&#40; !$build_environment &#41; {
+    plan skip_all =&gt; 
+            &#34;restricted permission test environment could not be made&#34;
+}
+else {
+    plan &#39;no_plan&#39;;
+}
+
+
+my %funcs = &#40;
+    abs_path        =&gt; \&#38;Cwd::abs_path,
+    _perl_abs_path  =&gt; \&#38;Cwd::_perl_abs_path,
+&#41;;
+for my $name &#40;sort keys %funcs&#41; {
+    my $func = $funcs{$name};
+
+    cmp_path $func-&gt;&#40;&#41;,         [$starting_wd, $test_path], &#34;$name w/no args&#34;;
+    cmp_path $func-&gt;&#40;$sub_dir&#41;, [$starting_wd, $sub_path],  &#34;$name w/subdir&#34;;
+    
+    # All but the last component of pathname must exist when realpath&#40;&#41;
+    # is called. -- BSD realpath man page.
+    my $dne_path = FS-&gt;catdir&#40;$test_path, &#34;dne&#34;&#41;;
+    cmp_path $func-&gt;&#40;&#34;dne&#34;&#41;, [$starting_wd, $dne_path],
+        &#34;$name w/non-existant filename&#34;;
+
+    my $double_dne = FS-&gt;catdir&#40;&#34;dne&#34;, &#34;sub_dne&#34;&#41;;
+    cmp_path $func-&gt;&#40;$double_dne&#41;, undef, &#34;$name w/non-existant sub dir&#34;;
+    
+    ok chdir $starting_wd;
+    cmp_path $func-&gt;&#40;&#34;../t&#34;&#41;,       [$starting_wd];
+    cmp_path $func-&gt;&#40;&#34;../t/../t&#34;&#41;,  [$starting_wd];
+    cmp_path $func-&gt;&#40;&#34;../t/dne&#34;&#41;,   [$starting_wd, &#39;dne&#39;];
+    cmp_path $func-&gt;&#40;&#39;abs_path.t&#39;&#41;, [$starting_wd, &#39;abs_path.t&#39;],
+        &#34;$name works on files&#34;;
+
+    ok chdir $x_but_no_r, &#39;chdir to the unreadable directory&#39;;
+    cmp_path $func-&gt;&#40;&#41;,             [$starting_wd, $x_but_no_r],
+       &#34;$name when cwd unreadable&#34;;
+    ok chdir $test_dir,   &#39;chdir back to the test dir&#39;;
+    
+    cmp_path $func-&gt;&#40;&#34;..&#34;&#41;,           [$starting_wd, $x_but_no_r];
+    
+    TODO: {
+        local $TODO = &#39;_perl_abs_path does not fold .. yet&#39;
+            if $name eq &#39;_perl_abs_path&#39;;
+        
+        cmp_path $func-&gt;&#40;&#34;../$test_dir&#34;&#41;, 
+                 [$starting_wd, $x_but_no_r, $test_dir];
+    }
+    cmp_path $func-&gt;&#40;&#34;/&#34;&#41;,            [&#34;/&#34;];
+    cmp_path $func-&gt;&#40;&#34;/does_not_exist&#34;&#41;,  [&#34;/does_not_exist&#34;];
+    cmp_path $func-&gt;&#40;&#34;/foo/&#34;&#41;,        undef;
+}
--- MANIFEST	&#40;/vendor/PathTools&#41;	&#40;revision 54975&#41;
+++ MANIFEST	&#40;/local/PathTools&#41;	&#40;revision 54975&#41;
@@ -16,16 +16,17 @@
 MANIFEST			This list of files
 META.yml
 ppport.h
+t/abs_path.t
 t/crossplatform.t
 t/cwd.t
 t/Functions.t
 t/lib/Test/Builder.pm
 t/lib/Test/More.pm
 t/lib/Test/Simple.pm
 t/rel2abs2rel.t
 t/Spec.t
 t/taint.t
 t/tmpdir.t
 t/win32.t
--- Cwd.pm	&#40;/vendor/PathTools&#41;	&#40;revision 54975&#41;
+++ Cwd.pm	&#40;/local/PathTools&#41;	&#40;revision 54975&#41;
@@ -498,41 +498,38 @@
 }
 
 
+use File::Basename;
 sub _perl_abs_path
 {
     my $start = @_ ? shift : &#39;.&#39;;
-    my&#40;$dotdots, $cwd, @pst, @cst, $dir, @tst&#41;;
 
-    unless &#40;@cst = stat&#40; $start &#41;&#41;
-    {
-	_carp&#40;&#34;stat&#40;$start&#41;: $!&#34;&#41;;
-	return &#39;&#39;;
+    # The last element of the path is allowed to not exist.
+    my $start_dir  = $start;
+    my $start_file = &#39;&#39;;
+    if&#40; !-e $start_dir or !-d $start_dir &#41; {
+        &#40;$start_file, $start_dir&#41; = fileparse&#40;$start&#41;;
+        $start_file = &#39;&#39; if $start_file eq &#39;.&#39;;
     }
 
-    unless &#40;-d _&#41; {
-        # Make sure we can be invoked on plain files, not just directories.
-        # NOTE that this routine assumes that &#39;/&#39; is the only directory separator.
-	
-        my &#40;$dir, $file&#41; = $start =~ m{^&#40;.*&#41;/&#40;.+&#41;$}
-	    or return cwd&#40;&#41; . &#39;/&#39; . $start;
-	
-	# Can&#39;t use &#34;-l _&#34; here, because the previous stat was a stat&#40;&#41;, not an lstat&#40;&#41;.
 	if &#40;-l $start&#41; {
-	    my $link_target = readlink&#40;$start&#41;;
-	    die &#34;Can&#39;t resolve link $start: $!&#34; unless defined $link_target;
-	    
 	    require File::Spec;
-            $link_target = $dir . &#39;/&#39; . $link_target
-                unless File::Spec-&gt;file_name_is_absolute&#40;$link_target&#41;;
+        my $link_target = readlink&#40; File::Spec-&gt;canonpath&#40;$start&#41; &#41;;
+        die &#34;Can&#39;t resolve link $start: $!&#34; unless defined $link_target;
 	    
 	    return abs_path&#40;$link_target&#41;;
 	}
 	
-	return $dir ? abs_path&#40;$dir&#41; . &#34;/$file&#34; : &#34;/$file&#34;;
+    my&#40;@pst, @cst, @tst&#41;;
+
+    unless &#40;@cst = stat&#40; $start_dir &#41;&#41;
+    {
+	_carp&#40;&#34;stat&#40;$start_dir&#41;: $!&#34;&#41;;
+	return undef;
     }
 
-    $cwd = &#39;&#39;;
-    $dotdots = $start;
+    my $cwd = &#39;&#39;;
+    my $dotdots = $start_dir;
+    my $dir;
     do
     {
 	$dotdots .= &#39;/..&#39;;
@@ -541,7 +538,8 @@
 	unless &#40;opendir&#40;PARENT, $dotdots&#41;&#41;
 	{
 	    # probably a permissions issue.  Try the native command.
-	    return File::Spec-&gt;rel2abs&#40; $start, _backtick_pwd&#40;&#41; &#41;;
+            require File::Spec;
+            return File::Spec-&gt;rel2abs&#40; $start, _backtick_pwd&#40;&#41; &#41;
 	}
 	unless &#40;@cst = stat&#40;$dotdots&#41;&#41;
 	{
@@ -571,8 +569,10 @@
 	$cwd = &#40;defined $dir ? &#34;$dir&#34; : &#34;&#34; &#41; . &#34;/$cwd&#34; ;
 	closedir&#40;PARENT&#41;;
     } while &#40;defined $dir&#41;;
-    chop&#40;$cwd&#41; unless $cwd eq &#39;/&#39;; # drop the trailing /
-    $cwd;
+
+    chop&#40;$cwd&#41; if $cwd ne &#39;/&#39; and !$start_file;
+    $cwd .= &#34;$start_file&#34; if $start_file;
+    return $cwd;
 }
 
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430960" href="/Public/Bug/Display.html?id=13851#txn-430960">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;05&nbsp;23:34:29&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/430960/210893/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210893">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Still not happy on abs_path.t:

t/abs_path....pwd: : Permission denied
Use of uninitialized value in join or string at
/Users/ken/src/PathTools/blib/lib/File/Spec/Unix.pm line 82.
not ok 1 - _perl_abs_path w/no args

#     Failed test &#40;t/abs_path.t at line 72&#41;
#          got: &#39;/&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir&#39;
pwd: : Permission denied
Use of uninitialized value in join or string at
/Users/ken/src/PathTools/blib/lib/File/Spec/Unix.pm line 82.
not ok 2 - _perl_abs_path w/subdir

#     Failed test &#40;t/abs_path.t at line 73&#41;
#          got: &#39;/subdir&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir/subdir&#39;
pwd: : Permission denied
Use of uninitialized value in join or string at
/Users/ken/src/PathTools/blib/lib/File/Spec/Unix.pm line 82.
not ok 3 - _perl_abs_path w/non-existant filename

#     Failed test &#40;t/abs_path.t at line 78&#41;
#          got: &#39;/dne&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir/dne&#39;
stat&#40;dne/&#41;: No such file or directory at t/abs_path.t line 82
ok 4 - _perl_abs_path w/non-existant sub dir
ok 5
ok 6
ok 7
ok 8
ok 9 - _perl_abs_path works on files
ok 10 - chdir to the unreadable directory
ok 11 - _perl_abs_path when cwd unreadable
ok 12 - chdir back to the test dir
ok 13
pwd: : Permission denied
Use of uninitialized value in join or string at
/Users/ken/src/PathTools/blib/lib/File/Spec/Unix.pm line 82.
not ok 14 # TODO _perl_abs_path does not fold .. yet

#     Failed &#40;TODO&#41; test &#40;t/abs_path.t at line 102&#41;
#          got: &#39;/testdir&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir&#39;
ok 15
ok 16
stat&#40;/foo/&#41;: No such file or directory at t/abs_path.t line 107
ok 17
not ok 18 - abs_path w/no args

#     Failed test &#40;t/abs_path.t at line 72&#41;
#          got: &#39;&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir&#39;
not ok 19 - abs_path w/subdir

#     Failed test &#40;t/abs_path.t at line 73&#41;
#          got: &#39;&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir/subdir&#39;
not ok 20 - abs_path w/non-existant filename

#     Failed test &#40;t/abs_path.t at line 78&#41;
#          got: &#39;&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir/dne&#39;
ok 21 - abs_path w/non-existant sub dir
ok 22
ok 23
ok 24
ok 25
ok 26 - abs_path works on files
ok 27 - chdir to the unreadable directory
ok 28 - abs_path when cwd unreadable
ok 29 - chdir back to the test dir
not ok 30

#     Failed test &#40;t/abs_path.t at line 96&#41;
#          got: &#39;&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r&#39;
not ok 31

#     Failed test &#40;t/abs_path.t at line 102&#41;
#          got: &#39;&#39;
#     expected: &#39;/users/ken/src/pathtools/t/x_but_no_r/testdir&#39;
ok 32
ok 33
ok 34
1..34
# Looks like you failed 8 tests of 34.
dubious
        Test returned status 8 &#40;wstat 2048, 0x800&#41;
DIED. FAILED tests 1-3, 18-20, 30-31
        Failed 8/34 tests, 76.47% okay
Failed Test  Stat Wstat Total Fail  List of Failed
-------------------------------------------------------------------------------
t/abs_path.t    8  2048    34    8  1-3 18-20 30-31
Failed 1/1 test scripts. 8/34 subtests failed.
Files=1, Tests=34,  1 wallclock secs &#40; 0.23 cusr +  0.13 csys =  0.36 CPU&#41;
Failed 1/1 test programs. 8/34 subtests failed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-442157" href="/Public/Bug/Display.html?id=13851#txn-442157">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;31&nbsp;21:51:02&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/442157/216782/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/216782">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 385b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Turns out it&#39;s failing because /bin/pwd on OS X fails in this situation too:

% mkdir -p t/x_but_no_r/testdir/subdir
% chmod 100 t/x_but_no_r 
% cd t/x_but_no_r/testdir
% /bin/pwd
pwd: : Permission denied

The built-in zsh command &#39;pwd&#39; succeeds, but of course we can&#39;t use that.  The closest we can 
get is something like the $ENV{PWD} memory we get with Cwd&#39;s chdir&#40;&#41; thingy.

-Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links DeleteLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-535651" href="/Public/Bug/Display.html?id=13851#txn-535651">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;22:17:16&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Dependency by ticket #30413 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1292607" href="/Public/Bug/Display.html?id=13851#txn-1292607">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;20:21:48&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1292607/684862/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684862">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 601b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 31 21:51:02 2008, KWILLIAMS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Turns out it&#39;s failing because /bin/pwd on OS X fails in this
&gt; situation too:
&gt; 
&gt; % mkdir -p t/x_but_no_r/testdir/subdir
&gt;  % chmod 100 t/x_but_no_r
&gt; % cd t/x_but_no_r/testdir
&gt; % /bin/pwd
&gt; pwd: : Permission denied
&gt; 
&gt; The built-in zsh command &#39;pwd&#39; succeeds, but of course we can&#39;t use
&gt; that.  The closest we can
&gt; get is something like the $ENV{PWD} memory we get with Cwd&#39;s chdir&#40;&#41;
&gt; thingy.
&gt; 
&gt; -Ken
</div>
Michael, Ken:

Would it be possible to get an update on the status of the issues discussed in this ticket?

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1294250" href="/Public/Bug/Display.html?id=13851#txn-1294250">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;26&nbsp;18:44:34&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Requestor JKEENAN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1332428" href="/Public/Bug/Display.html?id=13851#txn-1332428">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;01&nbsp;15:38:15&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Cc ETHER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.081519</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
