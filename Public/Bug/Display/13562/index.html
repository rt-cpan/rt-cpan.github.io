<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13562 for CGI-Uploader: Updates to 1.1_1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13562 for CGI-Uploader: Updates to 1.1_1</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=CGI-Uploader">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=CGI-Uploader">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=CGI-Uploader">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=CGI-Uploader">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Uploader">CGI-Uploader CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13562</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=CGI-Uploader">CGI-Uploader</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
william [...] knowmad.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-6046-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-6047-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Uploader.pm.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/135969/37083/Uploader.pm.diff">
Thu Jul 07 03:41:24 2005 (6.6k) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=13562">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135969" href="/Public/Bug/Display.html?id=13562#txn-135969">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;03:41:24&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Updates to 1.1_1</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/135969/37082/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/37082">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hey Mark,

Here&#39;s my tweaks to the dev release of C::U. It&#39;s somewhat extensive but here&#39;s the gist:

* Add support for SQLite
* Add name_scheme support
* Add support for parsing uploaded filename
* Add get_upload_record&#40;&#41; method
* Add more error checking around store_file
* Do not require the third parameter &#40;$ext&#41; to build_loc
* Modifications to cleanup warning messages

I&#39;ve run the tests but many of them fail b/c I&#39;m too tired to setup a DSN. Perhaps you have an environment configured for testing this module and can confirm that all is still working properly. Sorry but I have not added tests for any of the new functionality yet. Let me know what you think. I look forward to making these features part of the stable release as I keep finding more uses for this module.


Thanks,
William

PS: I have written Apache::Test tests which can do upload test verification. Might be something to consider adding to the test suite. I think there are ways to check for A::T being installed or not and skip the tests or allow the user to install and setup A::T. We&#39;d prob need to check that before adding these type of tests to a CPAN module.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135969/37083/Uploader.pm.diff">Download Uploader.pm.diff</a><br />
<span class="downloadcontenttype">text/x-diff 6.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/CGI/Uploader.pm.orig	2005-04-02 13:31:50.000000000 -0500
+++ lib/CGI/Uploader.pm	2005-07-07 03:21:31.000000000 -0400
@@ -12,7 +12,7 @@
 require Exporter;
 use vars qw&#40;$VERSION&#41;;
 
-$VERSION = &#39;1.1_1&#39;;
+$VERSION = &#39;1.1_2&#39;;
 
 =head1 NAME
 
@@ -248,13 +248,17 @@
              regex   =&gt; qr/^simple|md5$/,
              default =&gt; &#39;simple&#39;,
         },
+        name_scheme =&gt; {
+          regex   =&gt; qr/^id|file_name$/,
+          default =&gt; &#39;id&#39;,
+        },
 
 	}&#41;;
 	$in{db_driver} = $in{dbh}-&gt;{Driver}-&gt;{Name};
     # Support PostgreSQL via ODBC
     $in{db_driver} = &#39;Pg&#39; if $in{dbh}-&gt;get_info&#40;17&#41; eq &#39;PostgreSQL&#39;;
-	unless &#40;&#40;$in{db_driver} eq &#39;mysql&#39;&#41; or &#40;$in{db_driver} eq &#39;Pg&#39;&#41;&#41; {
-		die &#34;only mysql and Pg drivers are supported at this time. &#34;;
+	unless &#40;&#40;$in{db_driver} eq &#39;mysql&#39;&#41; or &#40;$in{db_driver} eq &#39;Pg&#39;&#41; or &#40;$in{db_driver} eq &#39;SQLite&#39;&#41;&#41; {
+		die &#34;only mysql and Pg drivers are supported at this time. You are trying to use $in{db_driver}.&#34;;
 	}
 
     unless &#40;$in{query}&#41; {
@@ -655,7 +659,11 @@
             uploaded_mt   =&gt; { type =&gt; SCALAR },
             file_name     =&gt; { type =&gt; SCALAR | GLOBREF },
             shared_meta   =&gt; { type =&gt; HASHREF | UNDEF,    default =&gt; {} },
-            id_to_update  =&gt; { regex =&gt; qr/^\d*$/, optional =&gt; 1 },
+            # This line is causing a warning to be printed to the Apache error
+            # log by Params::Validate if id_to_update is not set; looks like
+            # an error since optional is set - WLM 2005-07-07
+            #id_to_update  =&gt; { regex =&gt; qr/^\d*$/, optional =&gt; 1 },
+            id_to_update  =&gt; { type =&gt; SCALAR | UNDEF, optional =&gt; 1 },
         }&#41;;
 
     my &#40;
@@ -679,7 +687,7 @@
     my $meta = $self-&gt;extract_meta&#40;$tmp_filename,$file_name,$uploaded_mt&#41;;
 
     $shared_meta ||= {};
-    my $all_meta = { %$meta, %$shared_meta };   
+    my $all_meta = { %$meta, %$shared_meta };
 
     my $id;
     # If it&#39;s an update
@@ -694,15 +702,14 @@
         $all_meta,
         $id &#41;;
 
-
     $self-&gt;store_file&#40;$file_field,$id,$meta-&gt;{extension},$tmp_filename&#41;;
 
     my %ids = $self-&gt;create_store_gen_files&#40;
-		file_field      =&gt; $file_field,
-		meta	        =&gt; $all_meta,
-		src_file        =&gt; $tmp_filename,
-		gen_from_id =&gt; $id,
-    &#41;;
+      file_field      =&gt; $file_field,
+      meta	        =&gt; $all_meta,
+      src_file        =&gt; $tmp_filename,
+      gen_from_id =&gt; $id,
+    &#41; || &#40;&#41;;
 
     return &#40;%ids, $file_field.&#39;_id&#39; =&gt; $id&#41;;
 
@@ -863,7 +870,21 @@
     my $uploaded_mt = shift || &#39;&#39;;
 
     
-
+    #   Determine and set the appropriate file system parsing routines for the 
+    #   uploaded path name based upon the HTTP client header information.
+    use HTTP::BrowserDetect;
+    my $client_os = $^O;
+    my $browser = HTTP::BrowserDetect-&gt;new;
+    $client_os = &#39;MSWin32&#39; if $browser-&gt;windows;
+    $client_os = &#39;MacOS&#39; if $browser-&gt;mac;
+    require File::Basename;
+    File::Basename::fileparse_set_fstype&#40;$client_os&#41;;
+    $file_name = File::Basename::fileparse&#40;$file_name,[]&#41;;
+    $file_name =~ s/\s+/_/g;
+
+    ## Extract only the basename of the uploaded file
+    #require File::Basename;
+    #my $file_name = fileparse&#40;$file_name,[]&#41;;
 
    require File::MMagic;	
    my $mm = File::MMagic-&gt;new; 
@@ -913,7 +934,7 @@
    # Now get the image dimensions if it&#39;s an image 
     my &#40;$width,$height&#41; = imgsize&#40;$tmp_filename&#41;;
 
-    return { 
+    return {
         file_name =&gt; $file_name,
         mime_type =&gt; $mt, 
         extension =&gt; $ext,
@@ -937,7 +958,7 @@
 
  - file field name
 
- - A hashref of key/value pairs to be store. Only the key names defined by the
+ - A hashref of key/value pairs to be stored. Only the key names defined by the
    C&lt;up_table_map&gt; in C&lt;new&#40;&#41;&gt; will be used. Other values in the hash will be
    ignored.
 
@@ -999,6 +1020,9 @@
     if &#40;!$is_update &#38;&#38; $self-&gt;{db_driver} eq &#39;mysql&#39;&#41; {
         $id = $DBH-&gt;{&#39;mysql_insertid&#39;};
     }
+    if &#40;!$is_update &#38;&#38; $self-&gt;{db_driver} eq &#39;SQLite&#39;&#41; {
+      $id = $DBH-&gt;func&#40;&#39;last_insert_rowid&#39;&#41;
+    }
 
 	return $id;
 }
@@ -1125,14 +1149,28 @@
     validate_pos&#40;@_,1,1,1,1,1&#41;;
     my $self = shift;
     my &#40;$file_field,$id,$ext,$tmp_file&#41; = @_;
-	assert&#40;$ext, &#39;have extension&#39;&#41;;
-	assert&#40;$id,&#39;have id&#39;&#41;;
-	assert&#40;-f $tmp_file,&#39;tmp file exists&#39;&#41;;
+    assert&#40;$ext, &#39;have extension&#39;&#41;;
+    assert&#40;$id,&#39;have id&#39;&#41;;
+    assert&#40;-f $tmp_file,&#39;tmp file exists&#39;&#41;;
+    assert&#40;-d $self-&gt;{updir_path},&#39;updir_path is a directory&#39;&#41;;
+    assert&#40;-w $self-&gt;{updir_path},&#39;updir_path is writeable&#39;&#41;;
 
-    require File::Copy;	
+    require File::Copy;
     import File::Copy;
-    copy&#40;$tmp_file, File::Spec-&gt;catdir&#40;$self-&gt;{updir_path},$self-&gt;build_loc&#40;$id,$ext&#41;&#41; &#41;
-    || die &#34;Unexpected error occured when uploading the image: $!&#34;;
+    my $method = $self-&gt;{name_scheme};
+    if &#40;$method eq &#39;id&#39;&#41; {
+      my $dest = File::Spec-&gt;catdir&#40;$self-&gt;{updir_path},$self-&gt;build_loc&#40;$id,$ext&#41;&#41;;
+      copy&#40;$tmp_file, $dest &#41;
+      || die &#34;Unexpected error occured when copying the image to $dest: $!. Check your permissions.&#34;;
+    }
+    elsif &#40;$method eq &#39;file_name&#39;&#41; {
+      my $dest = File::Spec-&gt;catdir&#40;$self-&gt;{updir_path},$self-&gt;build_loc&#40;$id&#41;&#41;;
+      copy&#40;$tmp_file, $dest &#41;
+      || die &#34;Unexpected error occured when copying the image to $dest: $!. Check your permissions.&#34;;
+    }
+    else {
+      die &#34;Unknown name_scheme - $method&#34;;
+    }
 
 }
 
@@ -1185,15 +1223,18 @@
 =cut
 
 sub build_loc {
-    validate_pos&#40;@_,1,1,1&#41;;
+    validate_pos&#40;@_,1,1,0&#41;;
     my &#40;$self,$id,$ext&#41; = @_;
 
     my $scheme = $self-&gt;{file_scheme};
+    my $method = $self-&gt;{name_scheme};
 
     my $loc;
     if &#40;$scheme eq &#39;simple&#39;&#41; {
-        $loc = &#34;$id$ext&#34;;
-    }     
+        return &#34;$id$ext&#34; if $method eq &#39;id&#39;;
+        my $meta = $self-&gt;get_upload_record&#40;$id&#41;;
+        return $meta-&gt;{file_name};
+    }
     elsif &#40;$scheme eq &#39;md5&#39;&#41; {
         require Digest::MD5;
         import Digest::MD5 qw/md5_hex/;
@@ -1205,9 +1246,35 @@
             mkpath&#40;$full_path&#41;;
         }
 
-        $loc = &#34;$md5_path/$id$ext&#34;;
+        return &#34;$md5_path/$id$ext&#34; if $method eq &#39;id&#39;;
+        my $meta = $self-&gt;get_upload_record&#40;$id&#41;;
+        return &#34;$md5_path/&#34; . $meta-&gt;{file_name};
     }
 }
+
+
+=head2 get_upload_record&#40;&#41;
+
+ my $upload_data = $self-&gt;get_file_name&#40;$id&#41;;
+
+Returns a hashref of data stored in the uploads database for the requested file id.
+
+=cut
+
+sub get_upload_record {
+  validate_pos&#40;@_,1,1&#41;;
+  my &#40;$self,$id&#41; = @_;
+  my $DBH = $self-&gt;{dbh};
+
+  my @file_fields = $self-&gt;upload_field_names&#40;&#41;;
+
+  my $map = $self-&gt;{up_table_map};
+  my $h = $DBH-&gt;selectrow_hashref&#40;
+    qq!SELECT * FROM ! . $self-&gt;{up_table} .
+    qq! WHERE &#40; $map-&gt;{upload_id} = ! . $DBH-&gt;quote&#40;$id&#41; . qq! &#41;!&#41;;
+}
+
+
 =head2 upload_field_names&#40;&#41;
 
  # As a class method
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135970" href="/Public/Bug/Display.html?id=13562#txn-135970">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;10:21:02&nbsp;2005</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Jul 2005 09:14:33 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-CGI-Uploader [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #13562] Updates to 1.1_1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135970/37104/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/37104">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jul 07, 2005 at 03:41:24AM -0400, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; This message about CGI-Uploader was sent to you by guest &lt;&gt; via rt.cpan.org
&gt; 
&gt; Full context and any attached attachments can be found at:
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=13562">https://rt.cpan.org/Ticket/Display.html?id=13562</a></span> &gt;
&gt; 
&gt; Hey Mark,
&gt; 
&gt; Here&#39;s my tweaks to the dev release of C::U. It&#39;s somewhat extensive but here&#39;s the gist:
&gt; 
&gt; * Add support for SQLite
&gt; * Add name_scheme support
&gt; * Add support for parsing uploaded filename
&gt; * Add get_upload_record&#40;&#41; method
&gt; * Add more error checking around store_file
&gt; * Do not require the third parameter &#40;$ext&#41; to build_loc
&gt; * Modifications to cleanup warning messages
&gt; 
&gt; I&#39;ve run the tests but many of them fail b/c I&#39;m too tired to setup a
&gt; DSN. Perhaps you have an environment configured for testing this
&gt; module and can confirm that all is still working properly. Sorry but I
&gt; have not added tests for any of the new functionality yet. Let me know
&gt; what you think. I look forward to making these features part of the
&gt; stable release as I keep finding more uses for this module.
</div>
Thanks for the contribution William. I&#39;d prefer you send a patch with no
tests than no patch at all!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; PS: I have written Apache::Test tests which can do upload test
&gt; verification. Might be something to consider adding to the test suite.
&gt; I think there are ways to check for A::T being installed or not and
&gt; skip the tests or allow the user to install and setup A::T. We&#39;d prob
&gt; need to check that before adding these type of tests to a CPAN module.
</div>
I would very much like to experiment with Apache test, so please send
that code along as well. I like the idea of using it conditional on
Apache::Test being installed.

My original scheme for testing uploads was a SuperHack. CGI::Upload did
something a little more elegant, but I never merged it. 

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135971" href="/Public/Bug/Display.html?id=13562#txn-135971">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;21:27:20&nbsp;2005</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135972" href="/Public/Bug/Display.html?id=13562#txn-135972">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;21:27:30&nbsp;2005</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135973" href="/Public/Bug/Display.html?id=13562#txn-135973">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;18&nbsp;21:59:55&nbsp;2005</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/135973/46164/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46164">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Thu Jul  7 03:41:24 2005]:  
  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hey Mark,  
&gt;   
&gt; Here&#39;s my tweaks to the dev release of C::U. It&#39;s somewhat extensive  
&gt;    but here&#39;s the gist:  
&gt;   
&gt; * Add support for SQLite  
&gt; * Add name_scheme support  
&gt; * Add support for parsing uploaded filename  
&gt; * Add get_upload_record&#40;&#41; method  
&gt; * Add more error checking around store_file  
&gt; * Do not require the third parameter &#40;$ext&#41; to build_loc  
&gt; * Modifications to cleanup warning messages  
&gt;   
&gt; I&#39;ve run the tests but many of them fail b/c I&#39;m too tired to setup a  
&gt;    DSN. Perhaps you have an environment configured for testing this  
&gt;    module and can confirm that all is still working properly. Sorry  
&gt;    but I have not added tests for any of the new functionality yet.  
&gt;    Let me know what you think. I look forward to making these  
</div>features  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    part of the stable release as I keep finding more uses for this  
&gt;    module.  
</div>  
William,  
  
Thanks again for these contributions.  I&#39;m marking this ticket as 
resolved now because it&#39;s too much to handle through one bug tracking 
ticket. Some of this improvements made it in, some didn&#39;t.  
 
Notably: the test suite has been restructured and uses SQLite by 
default now. It&#39;s easier to add new tests and easier to run the tests 
we have.  
 
You may be interested in merging your changes with the 2.1 release 
which just came out. Besides some bug fixes, I think you&#39;ll like the 
API improvements I made.  &#40;Using darcs may make it easier to keep my 
changes and yours until our trees are sync&#39;ed&#41;.  
 
Let&#39;s chat some more name scheme support either by direct e-mail or 
maybe on the CGI::App list if they&#39;ll let us.  
 
  Mark 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135974" href="/Public/Bug/Display.html?id=13562#txn-135974">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;18&nbsp;21:59:56&nbsp;2005</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.298969</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
