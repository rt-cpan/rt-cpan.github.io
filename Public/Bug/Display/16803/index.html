<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #16803 for MP3-Tag: MP3::Tag can not create valid APIC frames.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #16803 for MP3-Tag: MP3::Tag can not create valid APIC frames.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MP3-Tag/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MP3-Tag/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MP3-Tag/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MP3-Tag/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MP3-Tag">MP3-Tag CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">16803</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MP3-Tag/Active/">MP3-Tag</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mschout [...] gkg.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-21896-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.9702    </td>
  </tr>
  <tr id="CF-21897-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




album_art.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/495238/245091/album_art.jpg">
Fri Aug 08 02:38:18 2008 (50.3k) by rob [...] laddish.net
</a>
</font></li>
</ul>


bug.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/152963/46918/bug.pl">
Fri Dec 30 23:29:51 2005 (672b) by 
</a>
</font></li>
</ul>


cover.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/152964/46921/cover.png">
Fri Dec 30 23:31:47 2005 (272.4k) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;23:22:34&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MP3::Tag can not create valid APIC frames.</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was not able to make MP3::Tag create a tag with an APIC  frame without modifying MP3::Tag sources.  It seems that in MP3::Tag::ID3v2, in as_bin&#40;&#41;, this line is the culprit:

    $flags = chr&#40;128&#41; if $tag_data =~ s/\xFF&#40;?=[\x00\xE0-\xFF]&#41;/\xFF\x00/g; # sync

If I comment that line out, then the problem goes away and I am able to create APIC frames that are valid and can be read by other programs.  If I leave that line in, then the tags that MP3::Tag creates are corrupted and not readable by other programs &#40;such as itunes, xmms, amarok etc&#41;.

I am not sure what that line is supposed to do, but it seems like the sequence of bytes it is looking for in that regex probably are matched in the image data that I am attaching, so its modifying the image data and that results in a corrupted tag.

For now I am just leaving that line commented out so that I can create valid APIC tags with MP3::Tag.

The way I am creating the tag btw is:

$id3v2-&gt;add_frame&#40;&#39;APIC&#39;, chr&#40;0x0&#41;, $mime_type, chr&#40;0x0&#41;, &#39;&#39;, $im_data&#41;;

It would be nice if this could be fixed so that MP3::Tag could attach cover art.

If you need any additional information, please let me know.

Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;23:26:08&nbsp;2005</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oops.  I forgot to log in when I created this ticket.  Hopefully you can
get in touch with me using this comment...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;30&nbsp;18:15:11&nbsp;2005</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 Dec 2005 15:14:25 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Dec 29, 2005 at 11:26:08PM -0500,  via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Full context and any attached attachments can be found at:
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=16803">https://rt.cpan.org/Ticket/Display.html?id=16803</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oops.  I forgot to log in when I created this ticket.  Hopefully you can
&gt; get in touch with me using this comment...
</div>
I need some code sufficient to reproduce your problem.

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;30&nbsp;23:29:51&nbsp;2005</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[nospam-abuse@ilyaz.org - Fri Dec 30 18:
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I need some code sufficient to reproduce your problem.
</div>
Get a mp3 file called foo.mp3 and a cover image called cover.png &#40;in PNG
format.  I used a 300x300 image&#41;.

Run the attached script which will create an ID3v2 tag for the file and
create an APIC frame.

Once done, try to open the foo.mp3 file in either amarok or itunes. 
Neither one will be able to read the tag.  This is sufficient to
reproduce the problem &#40;iTunes and amarok can not read the tag&#41;.

Now, to &#34;fix&#34; it, do the following:

Strip the tag out of foo.mp3 using whatever method you like &#40;I used
id3convert --strip foo.mp3&#41;.  Then comment out the above mentioned line
in ID3v2.pm, and re-run bug.pl on the file.  When bug.pl is finished,
open the file in amarok or itunes again.  This time the tag is read
without any problems &#40;including the cover art&#41; in both amarok and itunes.

I am using: itunes 4.9 on OS X to reproduce this, and amarok 1.3.6
&#40;linked to taglib 1.4 on FreeBSD&#41;.

Note that the problem only happens if attaching an APIC frame.  If you
do not attach an APIC frame then the tag is read properly by iTunes and
taglib/amarok.

In addition, *some* tools *can* read the tags even without the line in
question commented out from ID3v2.pm.  Specifically, the id3info tool
from id3lib seems to have no problems reading the tag.  Also the &#34;eyeD3&#34;
command line tool from the python eyeD3 package seems to be able to read
the tag properly.  So I am not sure about that.  But iTunes and
taglib&#40;amarok&#41; definately CAN NOT read the tags unless the line is
commented out of ID3v2.pm.  So for some reason that line makes it so
that iTunes and taglib can not read the tag.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl
#
# test script demonstrating APIC bug in MP3::Tag::ID3v2
#
# assumed: foo.mp3 is a new mp3 file with no tag.
# assumed: cover.png is a cover image &#40;300x300&#41;.

use strict;
use MP3::Tag;

# create a new tag.
my $mp3 = MP3::Tag-&gt;new&#40;&#39;foo.mp3&#39;&#41;;
$mp3-&gt;new_tag&#40;&#39;ID3v2&#39;&#41;;
my $id3 = $mp3-&gt;{ID3v2};

# add some basic info.
$id3-&gt;add_frame&#40;&#39;TIT2&#39;, &#39;My Title&#39;&#41;;
$id3-&gt;add_frame&#40;&#39;TALB&#39;, &#39;My Album&#39;&#41;;

# read image data.
my $im_data;

{
    open my $fh, &#39;&lt;&#39;, &#39;cover.png&#39;;
    binmode $fh;

    local $/ = undef;

    $im_data = &lt;$fh&gt;;
}

# add APIC frame.
$id3-&gt;add_frame&#40;&#39;APIC&#39;, chr&#40;0x0&#41;, &#39;image/png&#39;, chr&#40;0x0&#41;, &#39;&#39;, $im_data&#41;;

# write out the tag.
$id3-&gt;write_tag;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;30&nbsp;23:31:47&nbsp;2005</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In case it helps, I have attached the cover image I used.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/152964/46921/cover.png">Download cover.png</a><br />
<span class="downloadcontenttype">image/png 272.4k</span>
</div>
<div class="messagebody">
<img alt="cover.png" title="cover.png" src="/Ticket/Attachment/152964/46921/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;05&nbsp;18:43:55&nbsp;2006</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Jan 2006 15:43:04 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Dec 30, 2005 at 11:29:51PM -0500,  via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am using: itunes 4.9 on OS X to reproduce this, and amarok 1.3.6
&gt; &#40;linked to taglib 1.4 on FreeBSD&#41;.
</div>
I tested with itunes 6.0, and it shows the same bug.

  mp3info2 -a &#39;author with y&#34;u&#39; inside&#39; -t &#34;title with y&#34;u&#39; inside&#34; test.mp3

&#40;here y&#34;u&#39; is \xFF\xFB&#41;; if you ask itunes to write this data in the
tag, it produces a broken &#40;=unsyncronized&#41; tag.  If you know any way
to force itunes to read unsyncronized tags, please let me know.

  &#40;Since id3v2.3 is underdefined, I can&#39;t be absolutely sure one gets
  a correct tag from MP3::Tag; again, I would be very interested in
  how other tools treat the tag with data as above.&#41;

Hope this helps,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;10&nbsp;21:14:50&nbsp;2006</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Jan 2006 18:06:40 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Dec 29, 2005 at 11:22:34PM -0500, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; This message about MP3-Tag was sent to you by guest &lt;&gt; via rt.cpan.org
&gt; 
&gt; Full context and any attached attachments can be found at:
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=16803">https://rt.cpan.org/Ticket/Display.html?id=16803</a></span> &gt;
&gt; 
&gt; I was not able to make MP3::Tag create a tag with an APIC  frame without modifying MP3::Tag sources.  It seems that in MP3::Tag::ID3v2, in as_bin&#40;&#41;, this line is the culprit:
</div>
Could you please check whether any one of

  ilyaz.org/software/tmp/empty1.mp3
  ilyaz.org/software/tmp/empty2.mp3

shows author/title tags in ITunes?  It should be &#34;a with &#40;..&#41;&#34; &#34;t with
&#40;..&#41;&#34; correspondingly, here .. is y-diaresis eth:

   ..  |
  \ /  |O
   |   |

&#40;picture assumes fixed-width fonts&#41;.

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;05&nbsp;09:31:33&nbsp;2006</span>
    <span class="description">BORISZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hi,

I just encount the same problem. It looks that itunes &#40;6.0.4&#41; is unable to unsync the tags. 
Since sync is only a backward option for very old players, I wish MP3::Tags has a option to 
disable sync and work with itunes.

empty1.mp3 does not show artist or title.
empty2.mp3 works fine. 

On Di. 10. Jan. 2006, 21:14:50, nospam-abuse@ilyaz.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, Dec 29, 2005 at 11:22:34PM -0500, Guest via RT wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; This message about MP3-Tag was sent to you by guest &lt;&gt; via
</div>&gt; rt.cpan.org
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Full context and any attached attachments can be found at:
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=16803">https://rt.cpan.org/Ticket/Display.html?id=16803</a></span> &gt;
&gt; &gt;
&gt; &gt; I was not able to make MP3::Tag create a tag with an APIC  frame
</div>&gt; without modifying MP3::Tag sources.  It seems that in MP3::Tag::ID3v2,
&gt; in as_bin&#40;&#41;, this line is the culprit:
&gt; 
&gt; Could you please check whether any one of
&gt; 
&gt;   ilyaz.org/software/tmp/empty1.mp3
&gt;   ilyaz.org/software/tmp/empty2.mp3
&gt; 
&gt; shows author/title tags in ITunes?  It should be &#34;a with &#40;..&#41;&#34; &#34;t with
&gt; &#40;..&#41;&#34; correspondingly, here .. is y-diaresis eth:
&gt; 
&gt;    ..  |
&gt;   \ /  |O
&gt;    |   |
&gt; 
&gt; &#40;picture assumes fixed-width fonts&#41;.
&gt; 
&gt; Thanks,
&gt; Ilya
</div>
-- 
Boris 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;05&nbsp;09:31:34&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;05&nbsp;12:14:29&nbsp;2006</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 5 Mar 2006 09:14:14 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Mar 05, 2006 at 09:31:34AM -0500,  via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=16803">http://rt.cpan.org/Ticket/Display.html?id=16803</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just encount the same problem. It looks that itunes &#40;6.0.4&#41; is
&gt; unable to unsync the tags.  Since sync is only a backward option for
&gt; very old players, I wish MP3::Tags has a option to disable sync and
&gt; work with itunes.
</div>
Unsync is unalienable part of ID3v2 spec.  I doubt many players
support non-unsynced MP3s.  Nevertheless, an option is not a big deal.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; empty1.mp3 does not show artist or title.
&gt; empty2.mp3 works fine. 
</div>
Thanks; finally, somebody reported back!

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;21&nbsp;15:23:52&nbsp;2007</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> MSCHOUT [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi again.

It seems that the id3v23_unsync option you added does indeed fix this
problem.  iTunes can read APIC frames added if they were created with
this option set.

However, there is another quirky itunes annoyance that you have to work
around if you embed album art using MP3::Tag.  iTunes apparently will
not recognize any tags that appear after the APIC frame.  The way
MP3::Tag is currently implemented the tags are written in sorted order,
so the APIC tag comes first with basic song information filled in.  
This means iTunes will read the cover art properly, but will not see any
of the other tags &#40;title, album, year track etc&#41;. I applied the
following patch to ID3v2.pm, which pushes the APIC frame to the end of
the tag list instead:

--- ID3v2.pm.bak        2007-03-21 14:14:27.000000000 -0500
+++ ID3v2.pm    2007-03-21 14:16:19.000000000 -0500
@@ -455,7 +455,9 @@

     # in which order should the frames be sorted?
     # with a simple sort the order of frames of one type is the order
of adding them
-    my @frames=sort keys %{$self-&gt;{frames}};
+    # grr APIC must be the last tag for iTunes.
+    my @frames = grep { $_ ne &#39;APIC&#39; } sort keys %{$self-&gt;{frames}};
+    push @frames, &#39;APIC&#39; if exists $self-&gt;{frames}{APIC};

     for my $frameid &#40;@frames&#41; {
            my $frame = $self-&gt;{frames}-&gt;{$frameid};


After applying this patch, itunes reads album art *and* all other tags
correctly.  Hooray!

I found others reporting that the APIC frame must come last here:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.hydrogenaudio.org/forums/lofiversion/index.php/t41777.html">http://www.hydrogenaudio.org/forums/lofiversion/index.php/t41777.html</a></span>
&#40;look for APIC in the page&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;21&nbsp;17:48:29&nbsp;2007</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 21 Mar 2007 14:48:04 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Mar 21, 2007 at 03:23:57PM -0400,  via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, there is another quirky itunes annoyance that you have to work
&gt; around if you embed album art using MP3::Tag.  iTunes apparently will
&gt; not recognize any tags that appear after the APIC frame.
</div>
Could this be related to the size of the frame being not what iTunes
expects?  What is the size written by MP3::Tag, and with iTunes themselves?

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;07&nbsp;13:39:23&nbsp;2007</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 21 17:48:29 2007, nospam-abuse@ilyaz.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed, Mar 21, 2007 at 03:23:57PM -0400,  via RT wrote:
<div class="message-stanza open">&gt; &gt; However, there is another quirky itunes annoyance that you have to work
&gt; &gt; around if you embed album art using MP3::Tag.  iTunes apparently will
&gt; &gt; not recognize any tags that appear after the APIC frame.
</div>&gt; 
&gt; Could this be related to the size of the frame being not what iTunes
&gt; expects?  What is the size written by MP3::Tag, and with iTunes 
&gt; themselves?
</div>
Ilya:

I just looked into this again.  I think whatever was causing this in
iTunes has been fixed in version 7.2.  I am unable to reproduce this
problem under iTunes 7.2, using an unmodified MP3::Tag distribution.

As long as I create the tags without the unsync flag set using MP3::Tag,
iTunes seems to be happy with them now, including the APIC frame
&#40;regardless of its position in the tag&#41;  Hooray!

So I guess this bug can be closed now.

Sorry it took me so long to get back to you on this.

Mike
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;11&nbsp;11:45:07&nbsp;2007</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Jun 2007 08:44:36 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jun 07, 2007 at 01:39:29PM -0400,  via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ilya:
&gt; 
&gt; I just looked into this again.  I think whatever was causing this in
&gt; iTunes has been fixed in version 7.2.  I am unable to reproduce this
&gt; problem under iTunes 7.2, using an unmodified MP3::Tag distribution.
</div>
Drat!  Do you have a machine with older iTunes, so I can understand
what was happening?  Waiting for ALL people to upgrade brings a major
PITA, so if I could put some workaround on my side it may save
somebody a lot of time...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As long as I create the tags without the unsync flag set using MP3::Tag,
&gt; iTunes seems to be happy with them now, including the APIC frame
&gt; &#40;regardless of its position in the tag&#41;  Hooray!
&gt; 
&gt; So I guess this bug can be closed now.
&gt; 
&gt; Sorry it took me so long to get back to you on this.
</div>
A lot of thanks anyway,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;15&nbsp;10:22:19&nbsp;2007</span>
    <span class="description">mschout [...] gkg.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Jun 2007 09:18:56 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MP3-Tag [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael Schout &lt;mschout [...] gkg.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ilya Zakharevich via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Drat!  Do you have a machine with older iTunes, so I can understand
&gt; what was happening?  Waiting for ALL people to upgrade brings a major
&gt; PITA, so if I could put some workaround on my side it may save
&gt; somebody a lot of time...
</div>
Well I downgraded to iTunes 6.0.2 and I can&#39;t seem to reproduce the
problem there at this time either.  So I guess it really does not matter
where in the tag the APIC frame appears.  My guess is that when I was
having that problem before, I failed to create the tags without the
unsync flag set.  As long as I use MP3::Tag with:

MP3::Tag-&gt;config&#40;id3v23_unsync =&gt; 0&#41;;

Then iTunes seems to be happy about everything.  I can&#39;t seem to
reproduce the problem at all as long as the tags do not have the unsync
flag set :&#41;.

Mike
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;16&nbsp;16:27:21&nbsp;2007</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 16 Jun 2007 13:26:26 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;mschout [...] gkg.net via RT&#34; &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jun 15, 2007 at 10:22:25AM -0400, mschout@gkg.net via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well I downgraded to iTunes 6.0.2 and I can&#39;t seem to reproduce the
&gt; problem there at this time either.  So I guess it really does not matter
&gt; where in the tag the APIC frame appears.  My guess is that when I was
&gt; having that problem before, I failed to create the tags without the
&gt; unsync flag set.  As long as I use MP3::Tag with:
&gt; 
&gt; MP3::Tag-&gt;config&#40;id3v23_unsync =&gt; 0&#41;;
&gt; 
&gt; Then iTunes seems to be happy about everything.  I can&#39;t seem to
&gt; reproduce the problem at all as long as the tags do not have the unsync
&gt; flag set :&#41;.
</div>
A lot of helps with your investigations.  Currrently I&#39;m back at my
main development machine, and I plan to release a new version &#40;well,
when I manage to understand XSLT &#40;yes!&#41; so I can quickly pull new
composer-databases from wikipedia... - so maybe not *THAT* quickly&#41;.

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;16&nbsp;21:01:36&nbsp;2007</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 16 Jun 2007 18:01:20 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ilya Zakharevich via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Jun 16, 2007 at 04:27:25PM -0400, Ilya Zakharevich via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A lot of helps with your investigations.
</div>
Oups, it should have been &#34;a lot of thanks for ...&#34;;
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;24&nbsp;21:30:18&nbsp;2008</span>
    <span class="description">rob [...] laddish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rob [...] laddish.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; MP3::Tag-&gt;config&#40;id3v23_unsync =&gt; 0&#41;;
</div>
I also ran into a similar problem. I&#39;m transcoding mp3&#39;s to fit onto a
memory stick for my PSP. [play station portable] Since AFAIK lame.exe
will not preserve mp3 headers, I&#39;m using perl and the excellent mp3::tag
libraries to search through and copy the id3v1 and id3v2 tags.

The problem I see is that while the new mp3 files look ok to windows
vista &#40;and show the proper album art&#41;, it appears corrupted on the PSP.
If I take one of these new files, use explorer properties to change
something simple like artist and save, the update file views correctly
on the PSP.

Once I found this thread and added the above config line, everything
works and the psp album art appears correctly and is no longer corrupted.

Please let me know if there is anything you&#39;d like me to test to help
solve the problem [or if I&#39;ve done something wrong - it wouldn&#39;t be the
first time :&#41; ]

Thanks again for an awesome perl library! I&#39;ve found it immensely useful
in writing scripts to manage my media libraries ....

Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;30&nbsp;18:05:33&nbsp;2008</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Jul 2008 15:05:09 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Rob Laddish via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jul 24, 2008 at 09:30:21PM -0400, Rob Laddish via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MP3-Tag
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=16803">http://rt.cpan.org/Ticket/Display.html?id=16803</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; MP3::Tag-&gt;config&#40;id3v23_unsync =&gt; 0&#41;;
</div>&gt; 
&gt; I also ran into a similar problem. I&#39;m transcoding mp3&#39;s to fit onto a
&gt; memory stick for my PSP. [play station portable] Since AFAIK lame.exe
&gt; will not preserve mp3 headers, I&#39;m using perl and the excellent mp3::tag
&gt; libraries to search through and copy the id3v1 and id3v2 tags.
&gt; 
&gt; The problem I see is that while the new mp3 files look ok to windows
&gt; vista &#40;and show the proper album art&#41;, it appears corrupted on the PSP.
&gt; If I take one of these new files, use explorer properties to change
&gt; something simple like artist and save, the update file views correctly
&gt; on the PSP.
&gt; 
&gt; Once I found this thread and added the above config line, everything
&gt; works and the psp album art appears correctly and is no longer corrupted.
&gt; 
&gt; Please let me know if there is anything you&#39;d like me to test to help
&gt; solve the problem [or if I&#39;ve done something wrong - it wouldn&#39;t be the
&gt; first time :&#41; ]
</div>
Please report this bug to Sony &#40;or whoever does PSP&#41;.

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;08&nbsp;02:38:18&nbsp;2008</span>
    <span class="description">rob [...] laddish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rob [...] laddish.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Ilya,

FYI, I had this crop up again with album art, and noticed the artwork
sometimes shows up as corrupted under windows Vista too. If I use the
unsyc=&gt;0 workaround below, Vista displays the graphic ok again. I&#39;ve
attached a copy of the album art.

It isn&#39;t always a problem under Vista ... since it occurs in both Vista
and the PSP, it implies to me that it is more likely to be a problem
with MP3::Tag.

I&#39;ll look into reporting it to Sony, but don&#39;t they will be as helpful
as you.

Cheers,

Rob

On Wed Jul 30 18:05:33 2008, nospam-abuse@ilyaz.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, Jul 24, 2008 at 09:30:21PM -0400, Rob Laddish via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: MP3-Tag
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=16803">http://rt.cpan.org/Ticket/Display.html?id=16803</a></span> &gt;
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; MP3::Tag-&gt;config&#40;id3v23_unsync =&gt; 0&#41;;
</div>&gt; &gt; 
&gt; &gt; I also ran into a similar problem. I&#39;m transcoding mp3&#39;s to fit onto a
&gt; &gt; memory stick for my PSP. [play station portable] Since AFAIK lame.exe
&gt; &gt; will not preserve mp3 headers, I&#39;m using perl and the excellent mp3::tag
&gt; &gt; libraries to search through and copy the id3v1 and id3v2 tags.
&gt; &gt; 
&gt; &gt; The problem I see is that while the new mp3 files look ok to windows
&gt; &gt; vista &#40;and show the proper album art&#41;, it appears corrupted on the PSP.
&gt; &gt; If I take one of these new files, use explorer properties to change
&gt; &gt; something simple like artist and save, the update file views correctly
&gt; &gt; on the PSP.
&gt; &gt; 
&gt; &gt; Once I found this thread and added the above config line, everything
&gt; &gt; works and the psp album art appears correctly and is no longer
</div></div>corrupted.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; Please let me know if there is anything you&#39;d like me to test to help
&gt; &gt; solve the problem [or if I&#39;ve done something wrong - it wouldn&#39;t be the
&gt; &gt; first time :&#41; ]
</div>&gt; 
&gt; Please report this bug to Sony &#40;or whoever does PSP&#41;.
&gt; 
&gt; Thanks,
&gt; Ilya
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/495238/245091/album_art.jpg">Download album_art.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 50.3k</span>
</div>
<div class="messagebody">
<img alt="album_art.jpg" title="album_art.jpg" src="/Ticket/Attachment/495238/245091/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;08&nbsp;15:02:13&nbsp;2008</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16803] MP3::Tag can not create valid APIC frames.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 8 Aug 2008 12:01:59 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Rob Laddish via RT &lt;bug-MP3-Tag [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Aug 08, 2008 at 02:38:21AM -0400, Rob Laddish via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It isn&#39;t always a problem under Vista ... since it occurs in both Vista
&gt; and the PSP, it implies to me that it is more likely to be a problem
&gt; with MP3::Tag.
</div>
I envy your logical skills.  ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll look into reporting it to Sony, but don&#39;t they will be as helpful
&gt; as you.
</div>
On the other hand, if NOBODY reports this, they will DEFINITELY not
fix PSP...

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
