<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17359 for SVN-Web: Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17359 for SVN-Web: Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=SVN-Web">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=SVN-Web">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=SVN-Web">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=SVN-Web">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SVN-Web">SVN-Web CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17359</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=SVN-Web">SVN-Web</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dietrich.streifert [...] visionet.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-30328-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.43    </td>
  </tr>
  <tr id="CF-30329-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




create<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/161330/50557/create">
Wed Feb 01 06:30:11 2006 (230b) by nik [...] ngo.org.uk
</a>
</font></li>
</ul>


diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/161542/50701/diff">
Wed Feb 01 19:47:01 2006 (780b) by NIKC [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/161539/50694/diff">
Wed Feb 01 18:54:03 2006 (701b) by NIKC [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=17359">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-160506" href="/Public/Bug/Display.html?id=17359#txn-160506">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;10:44:36&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/160506/50034/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50034">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 606b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">We have installed SVN::Web on Solaris 10 x86 &#40;perl v5.8.7&#41; and use it
with mod_perl2 an apache2.

After we have commited a huge number of files to svn &#40;&gt;1000&#41; to a
repository browsing with SVN::Web in this repository leads to huge
memory consumption in httpd &#40;mod_perl2&#41; of up to 300 MByte per process.

So accessing this repository through SVN::Web isn&#39;t usable anymore.
Retrieving RSS-Feeds from the repository leads to a timeout.

I think this is due to the number of repository paths which are held in
a hash.

Any solution on this &#40;beside of just not doing such big commits with svn&#41;?

Best regards...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-160862" href="/Public/Bug/Display.html?id=17359#txn-160862">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;21:15:41&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 31 Jan 2006 02:13:57 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/160862/50316/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50316">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We have installed SVN::Web on Solaris 10 x86 &#40;perl v5.8.7&#41; and use it
&gt; with mod_perl2 an apache2.
&gt; 
&gt; After we have commited a huge number of files to svn &#40;&gt;1000&#41; to a
&gt; repository browsing with SVN::Web in this repository leads to huge
&gt; memory consumption in httpd &#40;mod_perl2&#41; of up to 300 MByte per process.
</div>
Do you mean

a&#41; You&#39;ve got a repository with a large number of files in it, or

b&#41; You have a commit that touched 1000&#39;s of files.

I assume you mean &#40;b&#41;, but I want to be sure.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So accessing this repository through SVN::Web isn&#39;t usable anymore.
&gt; Retrieving RSS-Feeds from the repository leads to a timeout.
&gt; 
&gt; I think this is due to the number of repository paths which are held in
&gt; a hash.
&gt; 
&gt; Any solution on this &#40;beside of just not doing such big commits with svn&#41;?
</div>
Which SVN::Web actions have the problem?  You say SVN::Web::RSS.  I would 
expect SVN::Web::Revision, and probably SVN::Web::Log too.

Does browsing the repository &#40;i.e., just clicking on the links to files and 
directories&#41; work?

If so I can probably whip up a patch that disables path generation after a 
configurable number of paths have been seen.

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-160863" href="/Public/Bug/Display.html?id=17359#txn-160863">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;21:15:42&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-160936" href="/Public/Bug/Display.html?id=17359#txn-160936">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;31&nbsp;02:46:20&nbsp;2006</span>
    <span class="description">dietrich.streifert [...] visionet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 31 Jan 2006 08:45:16 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dietrich Streifert &lt;dietrich.streifert [...] visionet.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/160936/50351/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50351">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Nik!

First of all: Thank you for your fast answer and your really nice work 
on SVN::Web.

Now to your questions:

Answer &#40;b&#41; is true: I commited about 1000 new files to the repository.

And yes the problem is also in SVN::Web::Revision and SVN::Web::Log.

Browsing the repository is no problem.

As I understood by reading your source you generate a hash of the 
touched paths for a specific revision. So I think this path is consuming 
a lot of memory &#40;in my case httpd grows up to 300 MByte&#41;. Every time my 
development team members retrieved the RSS of the revision log of this 
repository it ended up in 3 to 6 running httpd which made the subversion 
server unresponsive.

So as a first measure the patch which has a configurable limit to the 
path generation would be great. I don&#39;t know if this should be 
configurable globaly or per action &#40;class&#41;.

A solution to this would be to have a paging option for SVN::Web::Log 
and SVN::Web::Revision so that even commits with a huge number of paths 
can be browsed. But that may break your code.

Best

nik@ngo.org.uk via RT schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Guest via RT wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; We have installed SVN::Web on Solaris 10 x86 &#40;perl v5.8.7&#41; and use it
&gt;&gt; with mod_perl2 an apache2.
&gt;&gt;
&gt;&gt; After we have commited a huge number of files to svn &#40;&gt;1000&#41; to a
&gt;&gt; repository browsing with SVN::Web in this repository leads to huge
&gt;&gt; memory consumption in httpd &#40;mod_perl2&#41; of up to 300 MByte per process.
&gt;&gt;     
</div>&gt;
&gt; Do you mean
&gt;
&gt; a&#41; You&#39;ve got a repository with a large number of files in it, or
&gt;
&gt; b&#41; You have a commit that touched 1000&#39;s of files.
&gt;
&gt; I assume you mean &#40;b&#41;, but I want to be sure.
&gt;
&gt;   
<div class="message-stanza open">&gt;&gt; So accessing this repository through SVN::Web isn&#39;t usable anymore.
&gt;&gt; Retrieving RSS-Feeds from the repository leads to a timeout.
&gt;&gt;
&gt;&gt; I think this is due to the number of repository paths which are held in
&gt;&gt; a hash.
&gt;&gt;
&gt;&gt; Any solution on this &#40;beside of just not doing such big commits with svn&#41;?
&gt;&gt;     
</div>&gt;
&gt; Which SVN::Web actions have the problem?  You say SVN::Web::RSS.  I would 
&gt; expect SVN::Web::Revision, and probably SVN::Web::Log too.
&gt;
&gt; Does browsing the repository &#40;i.e., just clicking on the links to files and 
&gt; directories&#41; work?
&gt;
&gt; If so I can probably whip up a patch that disables path generation after a 
&gt; configurable number of paths have been seen.
&gt;
&gt; N
&gt;
&gt;   
</div>
-- 
Mit freundlichen GrÃ¼ÃŸen
Dietrich Streifert
Visionet GmbH
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/160936/50352/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50352">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-160938" href="/Public/Bug/Display.html?id=17359#txn-160938">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;31&nbsp;02:52:16&nbsp;2006</span>
    <span class="description">dietrich.streifert [...] visionet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 31 Jan 2006 08:51:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dietrich Streifert &lt;dietrich.streifert [...] visionet.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/160938/50355/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50355">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Nik!

Just to have concrete numbers: In the commit 1640 new files were added 
to the repository.

Best regards.


nik@ngo.org.uk via RT schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Guest via RT wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; We have installed SVN::Web on Solaris 10 x86 &#40;perl v5.8.7&#41; and use it
&gt;&gt; with mod_perl2 an apache2.
&gt;&gt;
&gt;&gt; After we have commited a huge number of files to svn &#40;&gt;1000&#41; to a
&gt;&gt; repository browsing with SVN::Web in this repository leads to huge
&gt;&gt; memory consumption in httpd &#40;mod_perl2&#41; of up to 300 MByte per process.
&gt;&gt;     
</div>&gt;
&gt; Do you mean
&gt;
&gt; a&#41; You&#39;ve got a repository with a large number of files in it, or
&gt;
&gt; b&#41; You have a commit that touched 1000&#39;s of files.
&gt;
&gt; I assume you mean &#40;b&#41;, but I want to be sure.
&gt;
&gt;   
<div class="message-stanza open">&gt;&gt; So accessing this repository through SVN::Web isn&#39;t usable anymore.
&gt;&gt; Retrieving RSS-Feeds from the repository leads to a timeout.
&gt;&gt;
&gt;&gt; I think this is due to the number of repository paths which are held in
&gt;&gt; a hash.
&gt;&gt;
&gt;&gt; Any solution on this &#40;beside of just not doing such big commits with svn&#41;?
&gt;&gt;     
</div>&gt;
&gt; Which SVN::Web actions have the problem?  You say SVN::Web::RSS.  I would 
&gt; expect SVN::Web::Revision, and probably SVN::Web::Log too.
&gt;
&gt; Does browsing the repository &#40;i.e., just clicking on the links to files and 
&gt; directories&#41; work?
&gt;
&gt; If so I can probably whip up a patch that disables path generation after a 
&gt; configurable number of paths have been seen.
&gt;
&gt; N
&gt;
&gt;   
</div>
-- 
Mit freundlichen GrÃ¼ÃŸen
Dietrich Streifert
Visionet GmbH
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/160938/50356/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50356">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161057" href="/Public/Bug/Display.html?id=17359#txn-161057">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;31&nbsp;07:41:45&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 31 Jan 2006 12:07:01 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161057/50395/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50395">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dietrich,

dietrich.streifert@visionet.de via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now to your questions:
&gt; 
&gt; Answer &#40;b&#41; is true: I commited about 1000 new files to the repository.
&gt; 
&gt; And yes the problem is also in SVN::Web::Revision and SVN::Web::Log.
&gt; 
&gt; Browsing the repository is no problem.
</div>
Right, that makes sense.  They all generate lists of changed files.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As I understood by reading your source you generate a hash of the 
&gt; touched paths for a specific revision. So I think this path is consuming 
&gt; a lot of memory &#40;in my case httpd grows up to 300 MByte&#41;. Every time my 
&gt; development team members retrieved the RSS of the revision log of this 
&gt; repository it ended up in 3 to 6 running httpd which made the subversion 
&gt; server unresponsive.
</div>
I&#39;m not sure it&#39;s the hash.  At least, not exactly.  A hash with a few 
thousand small keys and values shouldn&#39;t consume 300MB of memory.  I suspect 
that SVN::Web isn&#39;t using Subversion&#39;s memory management functions 
correctly, so memory&#39;s not being freed as quickly as it should be.  Memory 
usage for these functions should really be O&#40;1&#41;, not O&#40;n&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So as a first measure the patch which has a configurable limit to the 
&gt; path generation would be great. I don&#39;t know if this should be 
&gt; configurable globaly or per action &#40;class&#41;.
</div>
I&#39;ll work on this over the next few days, and I&#39;ll send you a patch to test 
when I&#39;ve got one.

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161330" href="/Public/Bug/Display.html?id=17359#txn-161330">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;06:30:10&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Feb 2006 11:25:39 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/161330/50556/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50556">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dietrich,

dietrich.streifert@visionet.de via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now to your questions:
&gt; 
&gt; Answer &#40;b&#41; is true: I commited about 1000 new files to the repository.
&gt; 
&gt; And yes the problem is also in SVN::Web::Revision and SVN::Web::Log.
&gt; 
&gt; Browsing the repository is no problem.
&gt; 
&gt; As I understood by reading your source you generate a hash of the 
&gt; touched paths for a specific revision. So I think this path is consuming 
&gt; a lot of memory &#40;in my case httpd grows up to 300 MByte&#41;. Every time my 
&gt; development team members retrieved the RSS of the revision log of this 
&gt; repository it ended up in 3 to 6 running httpd which made the subversion 
&gt; server unresponsive.
</div>
I don&#39;t think it&#39;s the number of files that were committed that is the problem.

As a test, I just created a repository and committed 1,729 files to it one 
commit.  Then I configured SVN::Web to browse the repo.  The ::Revision and 
::Log actions are just as snappy as they should be, and memory usage is normal.

Could you confirm that you see the same thing.  To do this:

* Create a repo:

     mkdir /tmp/repo
     svnadmin create /tmp/repo/big-commit

* Checkout the repo

     mkdir /tmp/checkout
     cd /tmp/checkout
     svn checkout file:///tmp/repo/big-commit
     cd big-commit

* Run the attached &#39;create&#39; script in the &#39;big-commit&#39; directory.

     sh create

   This should create 1,700+ files in various subdirectories.

* Do a recursive add of all the directories, and then commit them.

     svn add 1 2 3 4 5 6 7 8 9 10 11 12
     svn commit -m &#39;Big commit for testing&#39;

* Configure SVN::Web to browse the repo.  Something like this in
   config.yaml will do.

     repos:
       big: &#39;/tmp/repos/big-commit&#39;

* Now point your browser at the &#39;big&#39; repo using SVN::Web, and
   verify that you can browse it, and that the ::Revision and ::Log
   actions are as fast as expected.

If you do all that, and things are as fast as expected then it&#39;s not the 
number of files in the commit that&#39;s slowing things down.  There must be 
some other factor in your commit that&#39;s resulting in the slow down.

One other thing -- the testing I&#39;ve just done is with svnweb-server, rather 
than Apache.  If you try the above with Apache and it shows the problem, 
could you try it with svnweb-server, and see if that has a problem too.

If it does then there&#39;s something in your environment that&#39;s not in mine 
that&#39;s causing the problem.

If it doesn&#39;t then it&#39;s something different between Apache and svnweb-server.

Thanks for your help in tracking this down.

N
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161330/50557/create">Download create</a><br />
<span class="downloadcontenttype">text/plain 230b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/bin/sh

for dir in 1 2 3 4 5 6 7 8 9 10 11 12; do
  for subdir in 1 2 3 4 5 6 7 8 9 10 11 12; do
    mkdir -p $dir/$subdir
    for file in 1 2 3 4 5 6 7 8 9 10 11 12; do
      touch $dir/$subdir/file.$file
    done
  done
done
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161393" href="/Public/Bug/Display.html?id=17359#txn-161393">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;10:16:29&nbsp;2006</span>
    <span class="description">dietrich.streifert [...] visionet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Feb 2006 16:15:06 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dietrich Streifert &lt;dietrich.streifert [...] visionet.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/161393/50601/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50601">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Nik!

I tried your test with mod_perl2 and apache2.

I can see the httpd grow up to 120 MByte peak memory usage when 
retrieving the ::Revision and the ::Log.

This is exactly for the test you proposed in a file system repository. 
We use BDB repositories. I&#39;ll do tomorrow some more tests with BDB 
repositories and the test with the svnweb-server.

Maybe in turn you can test this on apache?

Thank you for your help.

Best regards....



nik@ngo.org.uk via RT schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dietrich,
&gt;
&gt; dietrich.streifert@visionet.de via RT wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; Now to your questions:
&gt;&gt;
&gt;&gt; Answer &#40;b&#41; is true: I commited about 1000 new files to the repository.
&gt;&gt;
&gt;&gt; And yes the problem is also in SVN::Web::Revision and SVN::Web::Log.
&gt;&gt;
&gt;&gt; Browsing the repository is no problem.
&gt;&gt;
&gt;&gt; As I understood by reading your source you generate a hash of the 
&gt;&gt; touched paths for a specific revision. So I think this path is consuming 
&gt;&gt; a lot of memory &#40;in my case httpd grows up to 300 MByte&#41;. Every time my 
&gt;&gt; development team members retrieved the RSS of the revision log of this 
&gt;&gt; repository it ended up in 3 to 6 running httpd which made the subversion 
&gt;&gt; server unresponsive.
&gt;&gt;     
</div>&gt;
&gt; I don&#39;t think it&#39;s the number of files that were committed that is the problem.
&gt;
&gt; As a test, I just created a repository and committed 1,729 files to it one 
&gt; commit.  Then I configured SVN::Web to browse the repo.  The ::Revision and 
&gt; ::Log actions are just as snappy as they should be, and memory usage is normal.
&gt;
&gt; Could you confirm that you see the same thing.  To do this:
&gt;
&gt; * Create a repo:
&gt;
&gt;      mkdir /tmp/repo
&gt;      svnadmin create /tmp/repo/big-commit
&gt;
&gt; * Checkout the repo
&gt;
&gt;      mkdir /tmp/checkout
&gt;      cd /tmp/checkout
&gt;      svn checkout file:///tmp/repo/big-commit
&gt;      cd big-commit
&gt;
&gt; * Run the attached &#39;create&#39; script in the &#39;big-commit&#39; directory.
&gt;
&gt;      sh create
&gt;
&gt;    This should create 1,700+ files in various subdirectories.
&gt;
&gt; * Do a recursive add of all the directories, and then commit them.
&gt;
&gt;      svn add 1 2 3 4 5 6 7 8 9 10 11 12
&gt;      svn commit -m &#39;Big commit for testing&#39;
&gt;
&gt; * Configure SVN::Web to browse the repo.  Something like this in
&gt;    config.yaml will do.
&gt;
&gt;      repos:
&gt;        big: &#39;/tmp/repos/big-commit&#39;
&gt;
&gt; * Now point your browser at the &#39;big&#39; repo using SVN::Web, and
&gt;    verify that you can browse it, and that the ::Revision and ::Log
&gt;    actions are as fast as expected.
&gt;
&gt; If you do all that, and things are as fast as expected then it&#39;s not the 
&gt; number of files in the commit that&#39;s slowing things down.  There must be 
&gt; some other factor in your commit that&#39;s resulting in the slow down.
&gt;
&gt; One other thing -- the testing I&#39;ve just done is with svnweb-server, rather 
&gt; than Apache.  If you try the above with Apache and it shows the problem, 
&gt; could you try it with svnweb-server, and see if that has a problem too.
&gt;
&gt; If it does then there&#39;s something in your environment that&#39;s not in mine 
&gt; that&#39;s causing the problem.
&gt;
&gt; If it doesn&#39;t then it&#39;s something different between Apache and svnweb-server.
&gt;
&gt; Thanks for your help in tracking this down.
&gt;
&gt; N
&gt;
&gt;   
&gt; ------------------------------------------------------------------------
&gt;
&gt; #!/bin/sh
&gt;
&gt; for dir in 1 2 3 4 5 6 7 8 9 10 11 12; do
&gt;   for subdir in 1 2 3 4 5 6 7 8 9 10 11 12; do
&gt;     mkdir -p $dir/$subdir
&gt;     for file in 1 2 3 4 5 6 7 8 9 10 11 12; do
&gt;       touch $dir/$subdir/file.$file
&gt;     done
&gt;   done
&gt; done
&gt;   
</div>
-- 
Mit freundlichen GrÃ¼ÃŸen
Dietrich Streifert
Visionet GmbH
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161393/50602/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50602">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161539" href="/Public/Bug/Display.html?id=17359#txn-161539">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;18:54:03&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/161539/50691/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50691">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 232b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think I&#39;ve tracked this down, at least for Revision.pm.  Can you try
the attached patch and let me know if it solves the problem when using
the Revision action.

If that works for you I&#39;ll see if I can use a similar fix for Log.pm
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161539/50694/diff">Download diff</a><br />
<span class="downloadcontenttype">application/octet-stream 701b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161542" href="/Public/Bug/Display.html?id=17359#txn-161542">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;19:47:01&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/161542/50698/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50698">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 112b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch is for Log.pm -- similar problem, similar fix.  Can
you let me know if it solves the problem?
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161542/50701/diff">Download diff</a><br />
<span class="downloadcontenttype">application/octet-stream 780b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161594" href="/Public/Bug/Display.html?id=17359#txn-161594">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;22:23:17&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/161594/50731/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50731">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 292b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 01 19:47:01 2006, NIKC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached patch is for Log.pm -- similar problem, similar fix.  Can
&gt; you let me know if it solves the problem?
</div>
One more thing.  If this does fix Log.pm then it also fixes RSS.pm, as
the RSS functionality is implemented as a subclass of Log.ppm.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161652" href="/Public/Bug/Display.html?id=17359#txn-161652">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;02&nbsp;02:58:50&nbsp;2006</span>
    <span class="description">dietrich.streifert [...] visionet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Feb 2006 08:46:27 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dietrich Streifert &lt;dietrich.streifert [...] visionet.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/161652/50762/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50762">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 846b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes! The patches have solved the problem! Now httpd consumes up to 38 
MByte for the big-commit repository and up to 45 MByte for our 
production repository which was the cause for this issue. I&#39;ve tested 
this for ::Log ::Repository and ::RSS.

That&#39;s OK!

Your patches seem to have speedup browsing for &#34;normal&#34; repositories a 
little bit.

Thanks allot for your work! You should release this patches as soon as 
possible.

Best regards...


 via RT schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Feb 01 19:47:01 2006, NIKC wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; The attached patch is for Log.pm -- similar problem, similar fix.  Can
&gt;&gt; you let me know if it solves the problem?
&gt;&gt;     
</div>&gt;
&gt; One more thing.  If this does fix Log.pm then it also fixes RSS.pm, as
&gt; the RSS functionality is implemented as a subclass of Log.ppm.
&gt;   
</div>
-- 
Mit freundlichen GrÃ¼ÃŸen
Dietrich Streifert
Visionet GmbH
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161652/50764/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50764">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161729" href="/Public/Bug/Display.html?id=17359#txn-161729">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;02&nbsp;05:17:04&nbsp;2006</span>
    <span class="description">dietrich.streifert [...] visionet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Feb 2006 11:06:16 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dietrich Streifert &lt;dietrich.streifert [...] visionet.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161729/50800/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50800">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 876b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve discovered a &#34;commented&#34; section in the log template which creates 
links to the modified paths of a revision through a loop. The problem is 
that at runtime this loop is executed through the templating system, so 
in my case with over 1000 files this leads to a html file with a huge 
number of comments. The browser runs into a timeout and simply stops 
retrieving in the middle of the page.

Maybe this comment should be deleted from the template?

I&#39;ve done this here and now the ::Log browsing is very fast.

A solution would be to implement paging in the log and revision 
template. Then you would page, lets say 50 paths forward, backward.


Best regards....

 via RT schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached patch is for Log.pm -- similar problem, similar fix.  Can
&gt; you let me know if it solves the problem?
&gt;   
</div>
-- 
Mit freundlichen GrÃ¼ÃŸen
Dietrich Streifert
Visionet GmbH
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-161930" href="/Public/Bug/Display.html?id=17359#txn-161930">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;02&nbsp;22:53:32&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17359] Large number of commits &#40;&gt;1000&#41; breaks SVN::Web</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 03 Feb 2006 03:51:04 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/161930/50929/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/50929">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">dietrich.streifert@visionet.de via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes! The patches have solved the problem! Now httpd consumes up to 38 
&gt; MByte for the big-commit repository and up to 45 MByte for our 
&gt; production repository which was the cause for this issue. I&#39;ve tested 
&gt; this for ::Log ::Repository and ::RSS.
&gt; 
&gt; That&#39;s OK!
&gt; 
&gt; Your patches seem to have speedup browsing for &#34;normal&#34; repositories a 
&gt; little bit.
</div>
Good.  I&#39;ve committed the changes.  I need to work on some automated tests 
that warn me if memory usage for any of the actions starts getting 
suspiciously high.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks allot for your work! You should release this patches as soon as 
&gt; possible.
</div>
That&#39;ll be at least another 8 or 9 days.  I&#39;m in the US at the moment, and 
my laptop doesn&#39;t have my GPG keys on it, so I can&#39;t sign the release.  I&#39;ll 
do another release when I get back home though.

You might want to use the changes in revs 775, 777, 778, and 779 in your 
local installation.  Get them from here:

<span class="clickylink"><a target="new" rel="nofollow" href="http://jc.ngo.org.uk/svnweb/jc/log/nik/CPAN/SVN-Web/trunk/">http://jc.ngo.org.uk/svnweb/jc/log/nik/CPAN/SVN-Web/trunk/</a></span>

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-162210" href="/Public/Bug/Display.html?id=17359#txn-162210">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;03&nbsp;23:08:01&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/162210/51089/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/51089">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 115b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">FYI, View.pm has a similar problem.  See
<span class="clickylink"><a target="new" rel="nofollow" href="http://jc.ngo.org.uk/svnweb/jc/revision?rev=780">http://jc.ngo.org.uk/svnweb/jc/revision?rev=780</a></span> for a patch that fixes it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168142" href="/Public/Bug/Display.html?id=17359#txn-168142">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;04:26:16&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.878654</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
