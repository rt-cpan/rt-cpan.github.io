<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #84513 for CSS-Inliner: die&#39;ing because of linked stylesheets</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #84513 for CSS-Inliner: die&#39;ing because of linked stylesheets</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CSS-Inliner/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CSS-Inliner/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CSS-Inliner/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CSS-Inliner/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CSS-Inliner">CSS-Inliner CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">84513</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CSS-Inliner/Active/">CSS-Inliner</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
me [...] justinsimoni.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-229630-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-229631-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;08&nbsp;21:19:36&nbsp;2013</span>
    <span class="description">me [...] justinsimoni.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> die&#39;ing because of linked stylesheets</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Is there a good reason that this module is designed to die&#40;&#41;, if you feed it a string, with a linked stylesheet? If anything, wouldn&#39;t it be best to simply warn&#40;&#41; about that, or even better, deal with it, transparently if there&#39;s a base url, ala: 

    my $inliner = CSS::Inliner-&gt;new&#40;&#41;;
    $inliner-&gt;read&#40;
        {
            html =&gt; $s,
            base_url =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://example.com">http://example.com</a></span>&#39;,
        }
    &#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;23&nbsp;16:59:59&nbsp;2013</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

  Inliner works best for atomic documents, as the workflow is substantially simpler. For example if you provide a document that includes a single stylesheet within the html itself &#40;rather than linked&#41; you&#39;re going through an unambiguous set of behavior.

  This is actually what it was designed for from the ground up. Specifically it was designed to facilitate inlining styles for use with email. In these cases you almost always have all the assets within a single document. There are quite a few people using the tool for this explicit purpose, and to that end it works rather well.

  For remote documents things get dicier because behavior becomes ambiguous. Should it die, or provide a warning, or keep going as if nothings wrong? There is no clear answer on what&#39;s best for everyone.

  Your point below is well taken, and I&#39;d suggest writing a patch to make it behave in such a way, and we&#39;ll see if that ends up being viable or breaks existing implementations in the wild. I think probably we could make it work in a way whereby it afforded itself to more people while die&#39;ing less. In such a case, then yeah, this is a good idea.

-Kevin


On Mon Apr 08 21:19:36 2013, JJSIMONI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a good reason that this module is designed to die&#40;&#41;, if you
&gt;    feed it a string, with a linked stylesheet? If anything, wouldn&#39;t
&gt;    it be best to simply warn&#40;&#41; about that, or even better, deal with
&gt;    it, transparently if there&#39;s a base url, ala:
&gt; 
&gt;     my $inliner = CSS::Inliner-&gt;new&#40;&#41;;
&gt;     $inliner-&gt;read&#40;
&gt;         {
&gt;             html =&gt; $s,
&gt;             base_url =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://example.com">http://example.com</a></span>&#39;,
&gt;         }
&gt;     &#41;;
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;23&nbsp;16:59:59&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;16&nbsp;11:01:19&nbsp;2013</span>
    <span class="description">wonko [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 23 16:59:59 2013, KAMELKEV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; Inliner works best for atomic documents, as the workflow is
&gt; substantially simpler. For example if you provide a document that
&gt; includes a single stylesheet within the html itself &#40;rather than
&gt; linked&#41; you&#39;re going through an unambiguous set of behavior.
</div>
While I agree with the sentiment of this, in practice it can cause real problems. For instance, I have an email which uses a &lt;link&gt; to external google font API to provide a special font for the mailing. If the email is read offline it&#39;s no big deal because the CSS will fall back to a different font.

And the styles in that style sheet don&#39;t need to be inlined because it&#39;s basically just defining a font, not doing anything with the elements of my document.

But CSS::Inliner will die when it can just ignore it and everything would work just fine.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;01&nbsp;18:10:54&nbsp;2013</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Michael,

Ideas for implementation? To take a baseref as he suggests is not exactly hard, but does that actually solve problems for you? I&#39;ve never run into this particular circumstance myself.

I have spent an inordinate amount of time working towards UTF8 support as of late, so the ambiguity here makes it less obvious on how to prioritize that work.

-Kevin

On Mon Sep 16 11:01:19 2013, WONKO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Jul 23 16:59:59 2013, KAMELKEV wrote:
<div class="message-stanza open">&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; Inliner works best for atomic documents, as the workflow is
&gt; &gt; substantially simpler. For example if you provide a document that
&gt; &gt; includes a single stylesheet within the html itself &#40;rather than
&gt; &gt; linked&#41; you&#39;re going through an unambiguous set of behavior.
</div>&gt; 
&gt; While I agree with the sentiment of this, in practice it can cause
&gt; real problems. For instance, I have an email which uses a &lt;link&gt; to
&gt; external google font API to provide a special font for the mailing. If
&gt; the email is read offline it&#39;s no big deal because the CSS will fall
&gt; back to a different font.
&gt; 
&gt; And the styles in that style sheet don&#39;t need to be inlined because
&gt; it&#39;s basically just defining a font, not doing anything with the
&gt; elements of my document.
&gt; 
&gt; But CSS::Inliner will die when it can just ignore it and everything
&gt; would work just fine.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;02&nbsp;22:12:05&nbsp;2013</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">New release posted. We no longer die under this particular circumstance.

The new version supports a relaxed mode which is way more relaxed than the standards mode. Additionally standards mode does not die when it encounters such link tags, but instead will now produce a warning. This probably will get you further.

Moving forward &#40;and I&#39;ll leave this ticket open&#41; we want to report a warning every single time we find a non-expandable stylesheet. If we find an expandable &#40;fully qualified reference&#41; then we will attempt to expand it even though the document was not fetched.

I&#39;m not super excited about passing a &#34;baseref&#34; argument, as I have zero use for this myself. If you can write a comprehensive patch and tests then we can look into what is involved in merging that in.



On Mon Apr 08 21:19:36 2013, JJSIMONI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a good reason that this module is designed to die&#40;&#41;, if you
&gt; feed it a string, with a linked stylesheet? If anything, wouldn&#39;t it
&gt; be best to simply warn&#40;&#41; about that, or even better, deal with it,
&gt; transparently if there&#39;s a base url, ala:
&gt; 
&gt; my $inliner = CSS::Inliner-&gt;new&#40;&#41;;
&gt; $inliner-&gt;read&#40;
&gt;     {
&gt;         html =&gt; $s,
&gt;         base_url =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://example.com">http://example.com</a></span>&#39;,
&gt;     }
&gt; &#41;;
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
