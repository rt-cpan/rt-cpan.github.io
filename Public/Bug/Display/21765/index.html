<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21765 for Parse-RecDescent: chunks vs. repeated rules in RecDescent</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21765 for Parse-RecDescent: chunks vs. repeated rules in RecDescent</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Parse-RecDescent">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Parse-RecDescent">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Parse-RecDescent">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Parse-RecDescent">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Parse-RecDescent">Parse-RecDescent CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21765</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Parse-RecDescent">Parse-RecDescent</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
david.holmes [...] alliancebernstein.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24792-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24793-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




defaultSkip_prints2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104708/defaultSkip_prints2">
Thu Sep 28 13:24:58 2006 (1.2k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


defaultSkip_prints2_stderr.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104709/defaultSkip_prints2_stderr.txt">
Thu Sep 28 13:24:58 2006 (3.8k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


defaultSkip_prints2_stdout.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104710/defaultSkip_prints2_stdout.txt">
Thu Sep 28 13:24:58 2006 (28b) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


fixedReps_prints2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104702/fixedReps_prints2">
Thu Sep 28 13:24:58 2006 (1.3k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


fixedReps_prints2_stderr.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104703/fixedReps_prints2_stderr.txt">
Thu Sep 28 13:24:58 2006 (5k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


fixedReps_prints2_stdout.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104704/fixedReps_prints2_stdout.txt">
Thu Sep 28 13:24:58 2006 (28b) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


limited_chunk_processing_support.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/854524/442332/limited_chunk_processing_support.patch">
Fri Nov 12 12:20:51 2010 (1.6k) by mhhollomon [...] gmail.com
</a>
</font></li>
</ul>


singleRead_prints2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104705/singleRead_prints2">
Thu Sep 28 13:24:58 2006 (1k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


singleRead_prints2_stderr.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104706/singleRead_prints2_stderr.txt">
Thu Sep 28 13:24:58 2006 (5.1k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


singleRead_prints2_stdout.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104707/singleRead_prints2_stdout.txt">
Thu Sep 28 13:24:58 2006 (28b) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


stopsTooSoon<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104699/stopsTooSoon">
Thu Sep 28 13:24:58 2006 (1.3k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


stopsTooSoon_stderr.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104700/stopsTooSoon_stderr.txt">
Thu Sep 28 13:24:58 2006 (3.4k) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>


stopsTooSoon_stdout.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/245284/104701/stopsTooSoon_stdout.txt">
Thu Sep 28 13:24:58 2006 (14b) by david.holmes [...] alliancebernstein.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=21765">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-245284" href="/Public/Bug/Display.html?id=21765#txn-245284">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;28&nbsp;13:24:58&nbsp;2006</span>
    <span class="description">david.holmes [...] alliancebernstein.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> chunks vs. repeated rules in RecDescent</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 28 Sep 2006 13:24:23 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Parse-RecDescent [...] rt.cpan.org&gt;, &lt;damian [...] conway.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Holmes, David M&#34; &lt;david.holmes [...] alliancebernstein.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104698/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/104698">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">An attempt to have RecDescent process a file in chunks apparently
interferes with the expected behavior of a repeated rule.  I&#39;d be
grateful for more-expert opinions on what is going on here.


Motivation
----------

A particular parser built with RecDescent runs slowly when processing a
2MB input file, typically requiring 1.5 hours.  Processing the same
amount of data with the same parser is 18 times faster, requiring only 5
minutes, when the input file is broken into ~10 pieces.  The suggestions
in the FAQ do not apply
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~tbone/Parse-RecDescent-FAQ/FAQ.pm#Parse::RecDes">http://search.cpan.org/~tbone/Parse-RecDescent-FAQ/FAQ.pm#Parse::RecDes</a></span>
cent_is_slow_on_Really_Big_Files._How_can_I_speed_it_up?&#41;.

So I modified a repeated rule in the the parser to read successive
chunks of the input file each time the rule is tried, updating $text
each time.  But this apparently causes the parser to try the rule only
once, rather than repeatedly until it fails to match.


Demonstrating the unexpected behavior
-------------------------------------

The real-world program has been boiled down to a demonstration program
that attempts to process a &#34;report&#34; consisting of an arbitrary number of
&#34;account&#34; records.  The demonstration program reads from a DATA section,
rather than an external file.  Four slightly different versions this
demonstration program are attached to this email, along with the output
they produce on stdout and traces from stderr, as produced commands like
    perl stopsTooSoon  &gt;stopsTooSoon_stdout.txt
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">2&gt;stopsTooSoon_stderr.txt
</div>
The file stopsTooSoon shows the program as I hoped to write it, but
exhibits the unexpected behavior.  The &#34;report&#34; rule asks that the
&#34;account&#34; rule be greedily matched an arbitrary number of times:
     report    : 
                 account&#40;s&#41;
                 ...
The &#34;account&#34; production starts with an action that reads the next line
of input into $text, returning undef after the last one.  I expected
this &#34;account&#34; rule to be matched twice, once for each line of data.
But the output in stopsTooSoon_stdout.txt shows only a single line
output by the print statement.  Consistent with the single output line,
the trace from stopsTooSoon_stderr.txt shows that, after a single
&#34;Matched rule&#34; trace for the &#34;account&#34; rule, the parser returns to
processing the &#34;report&#34; rule.  Instead, I expected the trace to show a
second &#40;and successful&#41; attempt at &#34;Trying rule: [account]&#34; before
returning to the &#34;report&#34; rule.

In an attempt to find a small change that would produced the expected
behavior, I produced three slightly-modified programs, each of which
works as expected, although with accompanying disadvantages for the
programmer.  The programs and their outputs are attached.  Descriptions
of these modified programs follow.



Fixed Repetition factor gives the expected behavior
---------------------------------------------------
A slightly different program works as expected, even though it includes
the $text-reading action.  The only significant difference in
fixedReps_prints2, is the change of the variable repetition to an exact
number:
     report    : 
                 account&#40;2&#41;
                 ...
The corresponding stdout shows the expected 2 lines from the print
statement, and the stderr trace shows the expected 2 attempts at
    Trying rule: [account]

For the real-world program, using an exact number of repetitions
requires counting the number of accounts and using that account in the
grammar specification.  This is workaround I am currently employing.



Reading all the input at once gives the expected behavior
---------------------------------------------------------

For most of our use of RecDescent, we read all the input into a single
variable.  This is done in singleRead_prints2, whose stdout output shows
the expected 2 lines, and whose stderr trace shows multiple attempts at
    Trying rule: [account]

In the real-world, this is acceptable for small input files, but is slow
for larger inputs, as described above under &#34;Motivation&#34;.


Using the default value of &lt;skip&gt; gives the expected behavior
-------------------------------------------------------------

Just in case it helps, I include another change that gives the expected
behavior, which I stumbled across in boiling down the original program:
Although the original grammar used the &lt;skip&gt; directive so that the
grammar could match ends-of-lines, reverting to default &lt;skip&gt; behavior
produces the expected output on stdout and stderr.

I haven&#39;t tried this in the real-world program, and I don&#39;t have a
conjecture about  whether this modification would robustly work around
the issue.  In addition, eschewing matching end-of-lines would change
the language that the parser accepts.



Environment
-----------
All of the attachments come from Windows XP and the following software:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -v
</div>
This is perl, v5.8.4 built for MSWin32-x86-multi-thread
&#40;with 3 registered patches, see perl -V for more detail&#41;

Copyright 1987-2004, Larry Wall

Binary build 810 provided by ActiveState Corp.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span> ActiveState is a division of Sophos. Built
Jun  1 2004 11:52:21 ...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ppm query RecDescent
</div>Querying target 1 &#40;ActivePerl 5.8.4.810&#41;
  1. Parse-RecDescent [1.94] Generate Recursive-Descent Parsers


The behavior is the same under on two unix systems, where &#34;uname -a&#34; and
&#34;perl-v&#34; show

    Linux amarld16.acml.com 2.6.9-22.ELsmp #1 SMP Mon Sep 19 18:32:14
EDT 2005 i686 athlon i386 GNU/Linux
    This is perl, v5.8.5 built for i386-linux-thread-multi

    OSF1 dec050.beehive.com V4.0 1530 alpha
    This is perl, v5.8.0 built for alpha-dec_osf


Desideratum
-----------

By comparing the RD_TRACE files, I started to guess that the different
behavior arises in _parserepeat.  At that point I abandoned digging and
started this plea for help.

What I&#39;d really like is advice on how to make a version of stopsTooSoon
that tries the &#34;account&#34; rule an arbitrary number of times, reads a
chunk of the input on each try, and allows the grammar to recognize
end-of-lines.

Thanks for your time and any help.


David Holmes
David.Holmes@AllianceBernstein.com  212-823-264
AllianceBernstein L.P. 1345 Avenue of the Americas, New York NY 10105

-----------------------------------------
The information contained in this transmission may be privileged and
confidential and is intended only for the use of the person&#40;s&#41; named
above. If you are not the intended recipient, or an employee or agent responsible
for delivering this message to the intended recipient, any review, dissemination,
distribution or duplication of this communication is strictly prohibited. If you are
not the intended recipient, please contact the sender immediately by reply e-mail
and destroy all copies of the original message. Please note that we do not accept
account orders and/or instructions by e-mail, and therefore will not be responsible
for carrying out such orders and/or instructions.  If you, as the intended recipient
of this message, the purpose of which is to inform and update our clients, prospects
and consultants of developments relating to our services and products, would not
like to receive further e-mail correspondence from the sender, please &#34;reply&#34; to the
sender indicating your wishes.  In the U.S.: 1345 Avenue of the Americas, New York,
NY 10105.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104699/stopsTooSoon">Download stopsTooSoon</a><br />
<span class="downloadcontenttype">application/octet-stream 1.3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104700/stopsTooSoon_stderr.txt">Download stopsTooSoon_stderr.txt</a><br />
<span class="downloadcontenttype">text/plain 3.4k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104701/stopsTooSoon_stdout.txt">Download stopsTooSoon_stdout.txt</a><br />
<span class="downloadcontenttype">text/plain 14b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104702/fixedReps_prints2">Download fixedReps_prints2</a><br />
<span class="downloadcontenttype">application/octet-stream 1.3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104703/fixedReps_prints2_stderr.txt">Download fixedReps_prints2_stderr.txt</a><br />
<span class="downloadcontenttype">text/plain 5k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104704/fixedReps_prints2_stdout.txt">Download fixedReps_prints2_stdout.txt</a><br />
<span class="downloadcontenttype">text/plain 28b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104705/singleRead_prints2">Download singleRead_prints2</a><br />
<span class="downloadcontenttype">application/octet-stream 1k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104706/singleRead_prints2_stderr.txt">Download singleRead_prints2_stderr.txt</a><br />
<span class="downloadcontenttype">text/plain 5.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104707/singleRead_prints2_stdout.txt">Download singleRead_prints2_stdout.txt</a><br />
<span class="downloadcontenttype">text/plain 28b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104708/defaultSkip_prints2">Download defaultSkip_prints2</a><br />
<span class="downloadcontenttype">application/octet-stream 1.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104709/defaultSkip_prints2_stderr.txt">Download defaultSkip_prints2_stderr.txt</a><br />
<span class="downloadcontenttype">text/plain 3.8k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/245284/104710/defaultSkip_prints2_stdout.txt">Download defaultSkip_prints2_stdout.txt</a><br />
<span class="downloadcontenttype">text/plain 28b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-854524" href="/Public/Bug/Display.html?id=21765#txn-854524">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;12&nbsp;12:20:51&nbsp;2010</span>
    <span class="description">mhhollomon [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mhhollomon [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/854524/442331/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/442331">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 28 13:24:58 2006, david.holmes@alliancebernstein.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; An attempt to have RecDescent process a file in chunks apparently
&gt; interferes with the expected behavior of a repeated rule.  I&#39;d be
&gt; grateful for more-expert opinions on what is going on here.
&gt; 
&gt; [ awesome report truncated]
</div>
More ancient history ... but this one was interesting ...

The problem is the following line in _parserepeat:

 last if ++$reps &gt;= $min and $prevtextlen == length;

The purpose of this line is to keep a repeated empty production from 
spinning a long time. _parserepeat tries to detect this by checking if 
any text was consumed.

But for the example grammar, this check isn&#39;t good enough.

Consider the first time through the grammar.

$text starts out as &#34;&#34; per the script.
That is the $text that _parserepeat takes the length of for
$prevtextlen. Now _parserepeat calls the parser for the account rule.
the account rule reads in the first line, successfully parsing it and
leaving $text as  -- you guessed it -- &#34;&#34;.

One workaround would be to add a changing amount of spaces to the end
of $text e.g. make your action something like...

{ # get data for next account
  if&#40; $text = &lt;main::DATA&gt;&#41;
  {
    $text .= &#39; &#39; x &#40;&#40;++$mycounter % 10&#41; + 1&#41;; # &lt;=== magic for _parserepeat
    Parse::RecDescent::LineCounter::resync&#40;$thisline&#41;;
  }
  else{ undef;}   # fail this production
}

Since skip is processed just before token recognition, these spaces
won&#39;t be stripped until just before the recognition of the literal
string.

I have attached a patch that co-opts resync in an attempt to give
_parserepeat a little more information about the possiblity of 
changes to $text.

I&#39;m conflicted about this since it is only a drop in the bucket for
what needs to be done to truly handle &#34;chunked&#34; input. So, I&#39;m not sure
if this provides a useful feature or simply gives people another way to
shoot themselves in the foot.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> limited_chunk_processing_support.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/854524/442332/limited_chunk_processing_support.patch">Download limited_chunk_processing_support.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** RecDescent.pm.new	2010-11-12 09:54:42.613262400 -0500
--- RecDescent.pm	2010-11-12 10:03:03.286627900 -0500
*************** sub resync   # &#40;$linecounter&#41;
*** 138,143 ****
--- 138,144 ----
               - Parse::RecDescent::_linecount&#40;${$self-&gt;{text}}&#41;
               + 1;
  
+     $parser-&gt;{&#39;resynccount&#39;} += 1;
      $parser-&gt;{offsetlinenum} += $parser-&gt;{lastlinenum} - $apparently;
      return 1;
  }
*************** sub AUTOLOAD    # &#40;$parser, $text; $line
*** 2861,2866 ****
--- 2862,2868 ----
      $_[0]-&gt;{offsetlinenum} = $_[0]-&gt;{lastlinenum};
      $_[0]-&gt;{fulltext} = $text;
      $_[0]-&gt;{fulltextlen} = length $text;
+     $_[0]-&gt;{resynccount} = 0;
      $_[0]-&gt;{deferred} = [];
      $_[0]-&gt;{errors} = [];
      my @args = @_[3..$#_];
*************** sub _parserepeat&#40;$$$$$$$$$$&#41;    # RETURN
*** 2903,2908 ****
--- 2905,2911 ----
          $_[6]-&gt;at&#40;$text&#41;;    # $_[6] IS $expectation FROM CALLER
          my $_savetext = $text;
          my $prevtextlen = length $text;
+         my $resynccount = $parser-&gt;{&#39;resynccount&#39;};
          my $_tok;
          if &#40;! defined &#40;$_tok = &#38;$prod&#40;$parser,$text,1,$_noactions,$argcode&#41;&#41;&#41;
          {
*************** sub _parserepeat&#40;$$$$$$$$$$&#41;    # RETURN
*** 2910,2916 ****
              last;
          }
          push @tokens, $_tok if defined $_tok;
!         last if ++$reps &gt;= $min and $prevtextlen == length $text;
      }
  
      do { $_[6]-&gt;failed&#40;&#41;; return undef} if $reps&lt;$min;
--- 2913,2919 ----
              last;
          }
          push @tokens, $_tok if defined $_tok;
!         last if ++$reps &gt;= $min and $prevtextlen == length $text and $resynccount == $parser-&gt;{&#39;resynccount&#39;};
      }
  
      do { $_[6]-&gt;failed&#40;&#41;; return undef} if $reps&lt;$min;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-854527" href="/Public/Bug/Display.html?id=21765#txn-854527">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;12&nbsp;12:20:51&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.588599</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
