<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #117838 for Type-Tiny: Bug in coercions for parameterized types</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #117838 for Type-Tiny: Bug in coercions for parameterized types</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Type-Tiny/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Type-Tiny/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Type-Tiny/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Type-Tiny/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Type-Tiny">Type-Tiny CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">117838</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Type-Tiny/Active/">Type-Tiny</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
lyle.kopnicky [...] grantstreet.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-249424-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-249425-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;14&nbsp;14:47:29&nbsp;2016</span>
    <span class="description">lyle.kopnicky [...] grantstreet.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Steve Grazzini &lt;grazzini [...] grantstreet.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug in coercions for parameterized types</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 Sep 2016 11:46:55 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Type-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lyle Kopnicky &lt;lyle.kopnicky [...] grantstreet.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, I&#39;ve run into some unexpected behavior involving coercions from
parameterized types. The attached script demonstrates the problem.

What I&#39;m expecting: ArrayRef[Bullwinkle] should be able to use the coercion
that was added to Bullwinkle. This works with line 22 commented out. But
surprisingly, just calling ArrayRef[Bullwinkle] &#40;by uncommenting line 22&#41;
seems to freeze the coercions as they were before the coercion was added,
even though each time ArrayRef[Bullwinkle] is called, it creates a new
object.

In our code base we have interface definitions for an API, that make use of
type constraints. The interface definitions are used by both the client and
server side. Some of the coercions, however, can only be included in the
server-side code, because they involve accessing server-side data. So we
add coercions as needed on the server side.

This was working fine with the MooseX::Types::Moose library, but we wanted
to switch to Type::Tiny because it has much better error messages. And
because you get the auto-generated coercions for parameterized types.

So, is this something that you consider a bug? Can it be fixed? Or should
we be taking a different approach? Thanks for your help.

-- 
*Lyle Kopnicky, **Perl Software Developer*

*Grant Street Group*Ph: &#40;412&#41; 391-5555, Ext. 6817
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;18&nbsp;08:29:42&nbsp;2017</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-09-14T19:47:29+01:00, lyle.kopnicky@grantstreet.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; even though each time ArrayRef[Bullwinkle] is called, it creates a new
&gt; object.
</div>
It does? Have you checked? It shouldn&#39;t.

perl -MScalar::Util=refaddr -MTypes::Standard=:all -E&#39;my &#40;$x,$y&#41; = map ArrayRef[Int], 1..2; say refaddr&#40;$_&#41; for $x, $y&#39;

Will output the same address twice.

-Toby
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;18&nbsp;08:29:43&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;18&nbsp;08:43:41&nbsp;2017</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">And yeah, basically the situation is this.

When you first create an ArrayRef[Bullwinkle], Type::Tiny calculates how the coercions work on ArrayRef[Bullwinkle] based on the coercions for Bullwinkle.

Making changes to the coercions on Bullwinkle after that would invalidate the coercions for ArrayRef[Bullwinkle].

So that&#39;s why the coercions on Bullwinkle get frozen. And that&#39;s why it&#39;s best to define your coercions as close as possible to where the type itself is defined.

It might be smarter for Bullwinkle to keep track of things that are depending on it like ArrayRef[Bullwinkle], and when a new coercion is added, tell them to update their coercions. I will add that to the wishlist.

For your particular case, instead of adding the coercions at the server side towards the end, and risking trying to add to frozen coercions, you could add them as close as possible to where the type is defined but use:

  # detect whether we&#39;re running on the server
  use constant RUNNING_ON_SERVER =&gt; &#40;$ENV{HOSTNAME} eq &#39;myserver&#39;&#41;;
  
  ...;
  
  my $Bullwinkle = class_type&#40;&#39;Bullwinkle&#39;&#41;;
  $Bullwinkle-&gt;coercion-&gt;add_type_coercions&#40;
    Int, &#39;Bullwinkle-&gt;new&#40;favourite_number=&gt;$_&#41;&#39;
  &#41; if RUNNING_ON_SERVER;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;18&nbsp;08:44:07&nbsp;2017</span>
    <span class="description">perl [...] toby.ink -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;29&nbsp;07:03:42&nbsp;2017</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is probably going to be a rejection.

I don&#39;t think it can be changed without sacrificing inlining of coercions, which is one of the major benefits of Type::Tiny over Moose&#39;s type constraint system.

If you created an attribute, say, with:

   has creatures =&gt; &#40;is =&gt; &#39;rw&#39;, isa =&gt; ArrayRef[Bullwinkle], coerce =&gt; 1&#41;;

This can &#40;if your object system supports it… Moo does&#41; inline the Perl code for coercing integers to Bullwinkles straight into the constructor and accessor.

If you later add a coercion to Bullwinkle, this would require the constructor and accessor to be re-built, and Type::Tiny has no way to signal to the class builder that this must be done.

So yeah, add coercions to types as close as possible to where you define the type.

I&#39;m leaving this on the wishlist for now, but it&#39;s likely to become a reject.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;29&nbsp;07:03:43&nbsp;2017</span>
    <span class="description">perl [...] toby.ink -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;12&nbsp;18:44:07&nbsp;2017</span>
    <span class="description">lyle.kopnicky [...] grantstreet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #117838] Bug in coercions for parameterized types</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 12 Jun 2017 15:38:15 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Type-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lyle Kopnicky &lt;lyle.kopnicky [...] grantstreet.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems to me to be a matter of caching/performance vs. correctness.

When the constraint ArrayRef[Bullwinkle] is constructed, it must be
building a table of what types it can coerce from. It could instead
dynamically ask the Bullwinkle class. So when a value is to be checked for
coercibility, and it sees it&#39;s an array, but an item in the array isn&#39;t a
Bullwinkle, it can ask the Bullwinkle type whether it can coerce that
value, and if so, have it do so.

On Mon, May 29, 2017 at 4:03 AM, Toby Inkster via RT &lt;
bug-Type-Tiny@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=117838">https://rt.cpan.org/Ticket/Display.html?id=117838</a></span> &gt;
&gt;
&gt; This is probably going to be a rejection.
&gt;
&gt; I don&#39;t think it can be changed without sacrificing inlining of coercions,
&gt; which is one of the major benefits of Type::Tiny over Moose&#39;s type
&gt; constraint system.
&gt;
&gt; If you created an attribute, say, with:
&gt;
&gt;    has creatures =&gt; &#40;is =&gt; &#39;rw&#39;, isa =&gt; ArrayRef[Bullwinkle], coerce =&gt; 1&#41;;
&gt;
&gt; This can &#40;if your object system supports it… Moo does&#41; inline the Perl
&gt; code for coercing integers to Bullwinkles straight into the constructor and
&gt; accessor.
&gt;
&gt; If you later add a coercion to Bullwinkle, this would require the
&gt; constructor and accessor to be re-built, and Type::Tiny has no way to
&gt; signal to the class builder that this must be done.
&gt;
&gt; So yeah, add coercions to types as close as possible to where you define
&gt; the type.
&gt;
&gt; I&#39;m leaving this on the wishlist for now, but it&#39;s likely to become a
&gt; reject.
&gt;
</div>


-- 
*Lyle Kopnicky, **Perl Software Developer*

*Grant Street Group*Ph: &#40;412&#41; 391-5555, Ext. 6817
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;12&nbsp;18:44:08&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;18&nbsp;08:47:58&nbsp;2017</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yeah, it doesn&#39;t do that because that&#39;s hella slow.

If you&#39;re coercing an arrayref of numbers into integers, it&#39;s a lot faster to do this:

    my $new = [ map int&#40;$_&#41;, @$old ];

Than this:

    my $new = [ map Int-&gt;coerce&#40;$_&#41;, @$old ];

Because the latter involves sub calls and method lookups and stuff.

This is one of the reasons Type::Tiny is so much faster than Moose&#39;s type constraint system, especially for coercions.

The cost of that is that you can&#39;t add and remove coercions later on, but doing that is something I&#39;d argue is bad form anyway — it causes action-at-a-distance. For example, one class defines a coercion from Str to FileHandle by treating the string as a filename and opening it. Another class expects coercion from Str to FileHandle to be via IO::String.

There&#39;s already stuff in the manual about this:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/distribution/Type-Tiny/lib/Type/Tiny/Manual/Coercions.pod#The-&#40;Lack-of&#41;-Zen-of-Coercions">https://metacpan.org/pod/distribution/Type-Tiny/lib/Type/Tiny/Manual/Coercions.pod#The-&#40;Lack-of&#41;-Zen-of-Coercions</a></span>

This is something I&#39;d rather make it harder for people to do than slow down the library so that people can have bullets to aim at their feet.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;29&nbsp;15:32:24&nbsp;2017</span>
    <span class="description">lyle.kopnicky [...] grantstreet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #117838] Bug in coercions for parameterized types</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 29 Jun 2017 12:24:35 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Type-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lyle Kopnicky &lt;lyle.kopnicky [...] grantstreet.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sounds like a reasonable tradeoff. Thanks for taking a look.

On Sun, Jun 18, 2017 at 5:47 AM, Toby Inkster via RT &lt;
bug-Type-Tiny@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=117838">https://rt.cpan.org/Ticket/Display.html?id=117838</a></span> &gt;
&gt;
&gt; Yeah, it doesn&#39;t do that because that&#39;s hella slow.
&gt;
&gt; If you&#39;re coercing an arrayref of numbers into integers, it&#39;s a lot faster
&gt; to do this:
&gt;
&gt;     my $new = [ map int&#40;$_&#41;, @$old ];
&gt;
&gt; Than this:
&gt;
&gt;     my $new = [ map Int-&gt;coerce&#40;$_&#41;, @$old ];
&gt;
&gt; Because the latter involves sub calls and method lookups and stuff.
&gt;
&gt; This is one of the reasons Type::Tiny is so much faster than Moose&#39;s type
&gt; constraint system, especially for coercions.
&gt;
&gt; The cost of that is that you can&#39;t add and remove coercions later on, but
&gt; doing that is something I&#39;d argue is bad form anyway — it causes
&gt; action-at-a-distance. For example, one class defines a coercion from Str to
&gt; FileHandle by treating the string as a filename and opening it. Another
&gt; class expects coercion from Str to FileHandle to be via IO::String.
&gt;
&gt; There&#39;s already stuff in the manual about this:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/distribution/Type-Tiny/lib/">https://metacpan.org/pod/distribution/Type-Tiny/lib/</a></span>
&gt; Type/Tiny/Manual/Coercions.pod#The-&#40;Lack-of&#41;-Zen-of-Coercions
&gt;
&gt; This is something I&#39;d rather make it harder for people to do than slow
&gt; down the library so that people can have bullets to aim at their feet.
&gt;
</div>


-- 
*Lyle Kopnicky, **Perl Software Developer*

*Grant Street Group*Ph: &#40;412&#41; 391-5555, Ext. 6817
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;05:57:57&nbsp;2018</span>
    <span class="description">perl [...] toby.ink -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
