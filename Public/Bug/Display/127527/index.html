<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127527 for Net-SSLeay: SSLeay CPAN install crash on &#39;ld: cannot find -lz&#39;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127527 for Net-SSLeay: SSLeay CPAN install crash on &#39;ld: cannot find -lz&#39;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127527</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SSLeay/Active/">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
k.vychodsky [...] skynet-systems.cz

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;30&nbsp;04:22:07&nbsp;2018</span>
    <span class="description">k.vychodsky [...] skynet-systems.cz -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SSLeay CPAN install crash on &#39;ld: cannot find -lz&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Oct 2018 08:57:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karel Východský &lt;k.vychodsky [...] skynet-systems.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;m having trouble install SSLeay 1.85 on Debian 9.5 &#40;up to date&#41;. The
error occured while installing NetDisco.
After some investigation I&#39;m using command &#39;cpanm Net:SSLeay::Handle -f
-v&#39; to see what happens. Here&#39;s the end of the output before crash.


...

In file included from /usr/include/openssl/objects.h:916:0,
                 from /usr/include/openssl/evp.h:27,
                 from /usr/include/openssl/x509.h:23,
                 from /usr/include/openssl/ssl.h:50,
                 from SSLeay.xs:167:
/usr/include/openssl/ocsp.h:336:1: note: expected âOCSP_CERTID * {aka
struct ocsp_cert_id_st *}â but argument is of type âconst OCSP_CERTID *
{aka const struct ocsp_cert_id_st *}â
 DECLARE_ASN1_FUNCTIONS&#40;OCSP_CERTID&#41;
 ^
SSLeay.xs:6790:23: warning: passing argument 1 of âi2d_OCSP_CERTIDâ
discards âconstâ qualifier from pointer target type [-Wdiscarded-qualifiers]
       i2d_OCSP_CERTID&#40;OCSP_SINGLERESP_get0_id&#40;sir&#41;,&#38;pi&#41;;
                       ^~~~~~~~~~~~~~~~~~~~~~~
In file included from /usr/include/openssl/objects.h:916:0,
                 from /usr/include/openssl/evp.h:27,
                 from /usr/include/openssl/x509.h:23,
                 from /usr/include/openssl/ssl.h:50,
                 from SSLeay.xs:167:
/usr/include/openssl/ocsp.h:336:1: note: expected âOCSP_CERTID * {aka
struct ocsp_cert_id_st *}â but argument is of type âconst OCSP_CERTID *
{aka const struct ocsp_cert_id_st *}â
 DECLARE_ASN1_FUNCTIONS&#40;OCSP_CERTID&#41;
 ^
rm -f blib/arch/auto/Net/SSLeay/SSLeay.so
x86_64-linux-gnu-gcc  -shared -L/usr -L/usr/lib -L/usr/local/lib
-fstack-protector-strong SSLeay.o  -o
blib/arch/auto/Net/SSLeay/SSLeay.so      \
   -L/usr -L/usr/lib -lssl -lcrypto -lz         \

/usr/bin/ld: cannot find -lz
collect2: error: ld returned 1 exit status
Makefile:497: recipe for target &#39;blib/arch/auto/Net/SSLeay/SSLeay.so&#39; failed
make: *** [blib/arch/auto/Net/SSLeay/SSLeay.so] Error 1
FAIL
! Installing Net::SSLeay::Handle failed. See
/root/.cpanm/work/1540885611.15537/build.log for details. Retry with
--force to force install it.

build.log contains same information as this output.
As I&#39;m not familiar with the process I&#39;m humbly asking for help or
advice - I&#39;m not sure if problem is global or with my configuration. I
can supply any other necessary information if needed.

Best regards,

Karel Vychodsky

-- 
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;13:57:00&nbsp;2018</span>
    <span class="description">hermann [...] jovial.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #127527]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 Nov 2018 10:44:39 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-SSLeay [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Hermann Calabria&#34; &lt;hermann [...] jovial.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I am getting exactly the same error as Karel.  

I’m running on Ubuntu 18.04 LTS with Perlbrew 0.84.  Relevant output from build:

rm -f blib/arch/auto/Net/SSLeay/SSLeay.so
LD_RUN_PATH=&#34;/usr/lib/x86_64-linux-gnu:/lib/x86_64-linux-gnu&#34; cc  -shared -O2 -L         /usr -L/usr/lib -L/usr/local/lib -fstack-protector-strong SSLeay.o  -o blib/arch         /auto/Net/SSLeay/SSLeay.so  \
   -L/usr -L/usr/lib -lssl -lcrypto -lz   \

/usr/bin/ld: cannot find -lz
collect2: error: ld returned 1 exit status
Makefile:496: recipe for target &#39;blib/arch/auto/Net/SSLeay/SSLeay.so&#39; failed
make: *** [blib/arch/auto/Net/SSLeay/SSLeay.so] Error 1

I’ve tried Perl 5.26.2 and 5.28.0 with same error.  I’ve also tried several prior versions of Net::SSLeay as well as pre-release &#40;1.86_xx&#41;.  Same error.

Short of reverting to system Perl and installing libnet-ssleay-perl &#40;1.84-1build1&#41; directly from Ubuntu -- which does install perfectly -- I have no idea what to do next.  

Thanks in advance for any help!
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;13:57:01&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;14:39:29&nbsp;2018</span>
    <span class="description">hermann [...] jovial.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Solved: [rt.cpan.org #127527]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 Nov 2018 11:37:53 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-SSLeay [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Hermann Calabria&#34; &lt;hermann [...] jovial.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi all, an update.  I have a solution to share!

The problem is that OpenSSL must be compiled using same setup as Perl and Perlbrew.  The developers harp on this throughout the documentation, but alas, us application developers are trained to cpanm install Foo::Bar and have it “just work”.  It’s not that simple for modules such as Net::SSLeay that depend on OpenSSL.

So here’s a recipe confirmed to work on Ubuntu 18.04 LTS, Perlbrew 0.84, Perl 5.26.2:

1. Install package dependencies:
   sudo apt install build-essential checkinstall zlib1g-dev -y

2. Create a subdirectory for OpenSSL under Perlbrew:
   mkdir ~/perl5/perlbrew/openssl

3. Download &#38; extract latest LTS OpenSSL into above directory.  To determine latest LTS OpenSSL, go to <span class="clickylink"><a target="new" rel="nofollow" href="https://openssl.org/source/">https://openssl.org/source/</a></span> and find the latest stable version.  As of this writing, the current one is openssl-1.1.1.tar.gz:

   cd ~/perl5/perlbrew/openssl
   wget <span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/source/openssl-1.1.1.tar.gz">https://www.openssl.org/source/openssl-1.1.1.tar.gz</a></span>  [replace with latest LTS version]
   tar -xf openssl-1.1.1.tar.gz
   cd openssl-1.1.1

4. Install and compile. Starting at above directory:
   ./config shared --prefix=$PERLBREW_ROOT/openssl
   make
   make test

5. Install Net::SSLeay using cpanm:
   cpanm install Net::SSLeay
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;21:02:59&nbsp;2018</span>
    <span class="description">chrisn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 14 19:39:29 2018, hermann@jovial.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So here’s a recipe confirmed to work on Ubuntu 18.04 LTS, Perlbrew
&gt; 0.84, Perl 5.26.2:
&gt; 
&gt; 1. Install package dependencies:
&gt;    sudo apt install build-essential checkinstall zlib1g-dev -y
&gt; 
&gt; 2. Create a subdirectory for OpenSSL under Perlbrew:
&gt;    mkdir ~/perl5/perlbrew/openssl
&gt; 
&gt; 3. Download &#38; extract latest LTS OpenSSL into above directory.  To
&gt; determine latest LTS OpenSSL, go to <span class="clickylink"><a target="new" rel="nofollow" href="https://openssl.org/source/">https://openssl.org/source/</a></span> and
&gt; find the latest stable version.  As of this writing, the current one
&gt; is openssl-1.1.1.tar.gz:
&gt; 
&gt; cd ~/perl5/perlbrew/openssl
&gt; wget <span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/source/openssl-1.1.1.tar.gz">https://www.openssl.org/source/openssl-1.1.1.tar.gz</a></span>  [replace
&gt; with latest LTS version]
&gt; tar -xf openssl-1.1.1.tar.gz
&gt; cd openssl-1.1.1
&gt; 
&gt; 4. Install and compile. Starting at above directory:
&gt;    ./config shared --prefix=$PERLBREW_ROOT/openssl
&gt;    make
&gt;    make test
&gt; 
&gt; 5. Install Net::SSLeay using cpanm:
&gt;    cpanm install Net::SSLeay
</div>
The only part of this that&#39;s necessary is the installation of the zlib headers &#40;zlib1g-dev&#41; in step 1: that&#39;s what ld is complaining about when it says &#34;cannot find -lz&#34;. The documentation ought to be clearer on that point, and it&#39;s something we&#39;ll fix when we&#39;ve finished implementing support for OpenSSL 1.1.1 and worked through the backlog of patches on RT.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;21:03:00&nbsp;2018</span>
    <span class="description">chrisn [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
