<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #114976 for PDF-API2: Huge memory consumption in page splitting</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #114976 for PDF-API2: Huge memory consumption in page splitting</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PDF-API2/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-API2">PDF-API2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">114976</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PDF-API2/Active/">PDF-API2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dosio [...] land.it

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24958-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24959-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;01&nbsp;19:14:36&nbsp;2016</span>
    <span class="description">dosio [...] land.it -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Huge memory consumption in page splitting</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Jun 2016 01:14:16 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDF-API2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claudio Dosio &lt;dosio [...] land.it&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In some cases while splitting the PDF in single pages some of the image 
objects therein &#34;explode&#34; in size. An embedded image of about 1MB in the 
PDF can take the entire system to use more than 8GB of ram.

If needed I can provide some PDFs with these cases.

Best regards
Claudio

-- 
Claudio Dosio
Responsabile R&#38;S Software


LAND S.r.l.
Via di Affogalasino, 40
00148 ROMA RM
Telefono +39 06 657481.1
Fax +39 06 657481.264
Web <span class="clickylink"><a target="new" rel="nofollow" href="http://www.land.it">http://www.land.it</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://www.securepaper.it">http://www.securepaper.it</a></span>

Il contenuto di questa e-mail e&#39; rivolto unicamente alle persone cui e&#39; indirizzato, e puo&#39; contenere informazioni la cui  riservatezza e&#39; tutelata. Come prescritto dal Garante per la Privacy con Deliberazione n.13 dell&#39;1.03.2007, si informa che il messaggio inoltrato non e&#39; di natura personale e che le risposte potranno essere conosciute nell&#39;organizzazione di appartenenza del mittente.
Sono vietati la riproduzione e l&#39;uso di questa e-mail in mancanza di autorizzazione del destinatario.
Se avete ricevuto questo e-mail per errore, vogliate cortesemente contattarci immediatamente per telefono al numero +39 06 6574811, al fax numero +39 06 657481264 o per e-mail all&#39;indirizzo info@land.it
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;16:26:54&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 01 19:14:36 2016, dosio@land.it wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In some cases while splitting the PDF in single pages some of the image 
&gt; objects therein &#34;explode&#34; in size. An embedded image of about 1MB in the 
&gt; PDF can take the entire system to use more than 8GB of ram.
&gt; 
&gt; If needed I can provide some PDFs with these cases.
</div>
Yes, I&#39;ll need some sample PDFs and example code to troubleshoot this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;16:26:54&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;16:26:55&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;22&nbsp;07:47:27&nbsp;2016</span>
    <span class="description">dosio [...] land.it -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #114976] Huge memory consumption in page splitting</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 22 Oct 2016 13:46:25 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDF-API2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claudio Dosio &lt;dosio [...] land.it&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,
attached is one of the PDFs that create the problem. I cannot send the 
other ones as they contain customer private data. The problem mainly 
occurs when at least one of the images in the PDF comes from a scanner 
or MFC device. Probably the PDFs in that case have something weird in 
their structure but they can be opened without problems with Acrobat 
Reader or similar tools, which makes it hard to explain to somebody that 
their PDF has problems.

One of the work arounds I found is to convert the incoming PDF via 
pdfopt, pdftk or ghostscript but that takes time and does not always 
guarantee the result.

What I would need if the bug cannot be easily fixed is to have some 
error from the PDF::API2 library that I can use to return an error 
condition upstream, while now what seems to happen is that the perl 
continues to run even if the page has not been fully split but any 
exec/system command that tries to run an external command returns a out 
of memory condition from the external command itself.

Please let me know if I can be of any help for you to solve the problem.

Best regards
Claudio

On 21/10/2016 22:26, Steve Simms via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114976">https://rt.cpan.org/Ticket/Display.html?id=114976</a></span> &gt;
&gt;
&gt; On Wed Jun 01 19:14:36 2016, dosio@land.it wrote:
<div class="message-stanza open">&gt;&gt; In some cases while splitting the PDF in single pages some of the image
&gt;&gt; objects therein &#34;explode&#34; in size. An embedded image of about 1MB in the
&gt;&gt; PDF can take the entire system to use more than 8GB of ram.
&gt;&gt;
&gt;&gt; If needed I can provide some PDFs with these cases.
</div>&gt; Yes, I&#39;ll need some sample PDFs and example code to troubleshoot this.
&gt;
</div>

-- 
Claudio Dosio
Responsabile R&#38;S Software



LAND S.r.l.
Via di Affogalasino, 40
00148 ROMA RM
Telefono +39 06 657481.1
Fax +39 06 657481.264
Web <span class="clickylink"><a target="new" rel="nofollow" href="http://www.land.it">http://www.land.it</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://www.securepaper.it">http://www.securepaper.it</a></span>

Il contenuto di questa e-mail e&#39; rivolto unicamente alle persone cui e&#39; indirizzato, e puo&#39; contenere informazioni la cui  riservatezza e&#39; tutelata. Come prescritto dal Garante per la Privacy con Deliberazione n.13 dell&#39;1.03.2007, si informa che il messaggio inoltrato non e&#39; di natura personale e che le risposte potranno essere conosciute nell&#39;organizzazione di appartenenza del mittente.
Sono vietati la riproduzione e l&#39;uso di questa e-mail in mancanza di autorizzazione del destinatario.
Se avete ricevuto questo e-mail per errore, vogliate cortesemente contattarci immediatamente per telefono al numero +39 06 6574811, al fax numero +39 06 657481264 o per e-mail all&#39;indirizzo info@land.it
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;22&nbsp;07:47:29&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;19:07:58&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Can you give me some example code that demonstrates the problem, please?  I just tried a simple script to import the pages individually to another PDF, and didn&#39;t run into any problems.


On Sat Oct 22 07:47:27 2016, dosio@land.it wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; attached is one of the PDFs that create the problem. I cannot send the 
&gt; other ones as they contain customer private data. The problem mainly 
&gt; occurs when at least one of the images in the PDF comes from a scanner 
&gt; or MFC device. Probably the PDFs in that case have something weird in 
&gt; their structure but they can be opened without problems with Acrobat 
&gt; Reader or similar tools, which makes it hard to explain to somebody that 
&gt; their PDF has problems.
&gt; 
&gt; One of the work arounds I found is to convert the incoming PDF via 
&gt; pdfopt, pdftk or ghostscript but that takes time and does not always 
&gt; guarantee the result.
&gt; 
&gt; What I would need if the bug cannot be easily fixed is to have some 
&gt; error from the PDF::API2 library that I can use to return an error 
&gt; condition upstream, while now what seems to happen is that the perl 
&gt; continues to run even if the page has not been fully split but any 
&gt; exec/system command that tries to run an external command returns a out 
&gt; of memory condition from the external command itself.
&gt; 
&gt; Please let me know if I can be of any help for you to solve the problem.
&gt; 
&gt; Best regards
&gt; Claudio
&gt; 
&gt; On 21/10/2016 22:26, Steve Simms via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114976">https://rt.cpan.org/Ticket/Display.html?id=114976</a></span> &gt;
&gt; &gt;
&gt; &gt; On Wed Jun 01 19:14:36 2016, dosio@land.it wrote:
<div class="message-stanza open">&gt; &gt;&gt; In some cases while splitting the PDF in single pages some of the image
&gt; &gt;&gt; objects therein &#34;explode&#34; in size. An embedded image of about 1MB in the
&gt; &gt;&gt; PDF can take the entire system to use more than 8GB of ram.
&gt; &gt;&gt;
&gt; &gt;&gt; If needed I can provide some PDFs with these cases.
</div>&gt; &gt; Yes, I&#39;ll need some sample PDFs and example code to troubleshoot this.
&gt; &gt;
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;19:08:14&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;09&nbsp;10:42:22&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I came across a file that was showing similar symptoms to what you reported, and fixed a few bugs.  Please try out either the latest code at GitHub or developer&#39;s release 2.030_001 to see if it&#39;s fixed for you as well.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;09&nbsp;10:42:23&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;14:18:13&nbsp;2016</span>
    <span class="description">dosio [...] land.it -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #114976] Huge memory consumption in page splitting</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Nov 2016 20:17:49 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDF-API2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claudio Dosio &lt;dosio [...] land.it&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The fix solves the problem on some PDF but not on all. I have tried a 
setup with a 1.2MB PDF on a VM that has 4 GB of ram and it cannot manage 
to split the document, going in out of memory. Unluckly I cannot give 
you the document that produces that behaviour since it contains private 
data.

Below is the code I use to split and process the pages:

         $inPdf = PDF::API2-&gt;open&#40;&#34;$tempDirname/$inPdfFilename&#34;&#41;;
         $numOfPages = $inPdf-&gt;pages;

         while &#40; $pageNum &lt;= $numOfPages &#41; {

                 my $outPdf = PDF::API2-&gt;new&#40;-file =&gt; 
&#34;$tempDirname/${inPdfFilename}_${pageNum}&#34;&#41;;

                 my $xo   = $outPdf-&gt;importPageIntoForm&#40; $inPdf, $pageNum &#41;;
                 my $page = $outPdf-&gt;page;
                 my $p7m  = &#39;&#39;;

                 $page-&gt;mediabox&#40; $configParams-&gt;{&#39;pdfPageW&#39;}, 
$configParams-&gt;{&#39;pdfPageH&#39;} &#41;;

                 my $gfx = $page-&gt;gfx;
                 $gfx-&gt;formimage&#40; $xo, 0, 0, 1 &#41;;
                 $outPdf-&gt;save&#40;&#41;;

                 if &#40;isToGlyph&#40;$pageNum,$configParams&#41;&#41; # It is actually 
a configuration parameter which is true
                 {
                        .... Does some actions on the split pages &#40;copy, 
compress, etc&#41; ....
                 }
                 $pageNum++;
         }

This code actually goes in out of memory before the IF statement


Many thanks for your help

Claudio


Il 09/11/2016 16:42, Steve Simms via RT ha scritto:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114976">https://rt.cpan.org/Ticket/Display.html?id=114976</a></span> &gt;
&gt;
&gt; I came across a file that was showing similar symptoms to what you reported, and fixed a few bugs.  Please try out either the latest code at GitHub or developer&#39;s release 2.030_001 to see if it&#39;s fixed for you as well.
&gt;
</div>
-- 
Claudio Dosio
Responsabile R&#38;S Software


LAND S.r.l.
Via di Affogalasino, 40
00148 ROMA RM
Telefono +39 06 657481.1
Fax +39 06 657481.264
Web <span class="clickylink"><a target="new" rel="nofollow" href="http://www.land.it">http://www.land.it</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://www.securepaper.it">http://www.securepaper.it</a></span>

Il contenuto di questa e-mail e&#39; rivolto unicamente alle persone cui e&#39; indirizzato, e puo&#39; contenere informazioni la cui  riservatezza e&#39; tutelata. Come prescritto dal Garante per la Privacy con Deliberazione n.13 dell&#39;1.03.2007, si informa che il messaggio inoltrato non e&#39; di natura personale e che le risposte potranno essere conosciute nell&#39;organizzazione di appartenenza del mittente.
Sono vietati la riproduzione e l&#39;uso di questa e-mail in mancanza di autorizzazione del destinatario.
Se avete ricevuto questo e-mail per errore, vogliate cortesemente contattarci immediatamente per telefono al numero +39 06 6574811, al fax numero +39 06 657481264 o per e-mail all&#39;indirizzo info@land.it
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;02&nbsp;19:21:05&nbsp;2017</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">PDF::API2 2.032 &#40;just released&#41; includes memory-related improvements that may help in this case.

Since I&#39;m not able to reproduce this issue, I&#39;m going to close this ticket.  Feel free to create a new one if you have a file you can share &#40;you can also send me a file privately, which I&#39;ll use solely to track down this issue&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;02&nbsp;19:21:06&nbsp;2017</span>
    <span class="description">steve [...] deefs.net -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
