<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #52757 for DBD-Oracle: File descriptor leak with DBD-Oracle</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #52757 for DBD-Oracle: File descriptor leak with DBD-Oracle</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-Oracle">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-Oracle">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-Oracle">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-Oracle">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/pythian/DBD-Oracle/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Oracle">DBD-Oracle CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">52757</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-Oracle">DBD-Oracle</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
brookepb [...] mchsi.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10192-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10193-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<ul>
<li>
1.25</li>
<li>
1.25-withoutworldwriteables</li>
<li>
1.25_brokentar</li>
<li>
1.26</li>
</ul>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




lsof.out<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/760177/393147/lsof.out">
Thu Apr 08 13:30:57 2010 (27.1k) by brookepb [...] gmail.com
</a>
</font></li>
</ul>


valgrind_op.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/760177/393146/valgrind_op.txt">
Thu Apr 08 13:30:52 2010 (284.3k) by brookepb [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=52757">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-706425" href="/Public/Bug/Display.html?id=52757#txn-706425">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;14&nbsp;10:42:52&nbsp;2009</span>
    <span class="description">brookepb [...] mchsi.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> File descriptor leak with DBD-Oracle</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 14 Dec 2009 09:12:00 -0600 &#40;CST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> brookepb [...] mchsi.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/706425/364351/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/364351">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Description:
There appears to be a file descriptor leak for every oracle connection &#40;even when using ora_dbh_share&#41; when using DBD-Oracle in perl scripts using threads, threads::shared.  

To recreate the problem:
1&#41; at start of a minimal perl script, using the libs noted above along with DBD::Oracle.
print STDERR &#34;Pre oracle connection open files:&#34; . `ls -l /proc/$$/fd/ | wc -l` . &#34;\n&#34;;
2&#41; open a new database connection 
3&#41; check open file descriptor count 
print STDERR &#34;open oracle connection open files:&#34; . `ls -l /proc/$$/fd/ | wc -l` . &#34;\n&#34;;
3&#41; disconnect the connection
print STDERR &#34;Post oracle connection open files:&#34; . `ls -l /proc/$$/fd/ | wc -l` . &#34;\n&#34;;

One file descriptor remains open, at least on my machine after every call.  In a single threaded application this is not an issue but in one that spawns thousands of threads which use Oracle, the maximum number of open filehandles available to the user account running the program is quickly exceeded and it is unable to complete.  I had hoped that using ora_dbh_share would solve the problem but no beans.

System:
Linux myhost 2.6.18-128.1.1.el5 #1 SMP Mon Jan 26 13:58:24 EST 2009 x86_64 x86_64 x86_64 GNU/Linux
Perl: 5.10.0
DBD-Oracle: $DBD::Oracle::VERSION = &#39;1.23&#39;;

I apologize if I missed this bug in those listed on CPAN

Thanks,

bpb
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-759887" href="/Public/Bug/Display.html?id=52757#txn-759887">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;08&nbsp;03:34:54&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/759887/392983/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/392983">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 14 10:42:52 2009, brookepb@mchsi.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Description:
&gt; There appears to be a file descriptor leak for every oracle connection
&gt;    &#40;even when using ora_dbh_share&#41; when using DBD-Oracle in perl
&gt;    scripts using threads, threads::shared.
&gt; 
&gt; To recreate the problem:
&gt; 1&#41; at start of a minimal perl script, using the libs noted above along
&gt;    with DBD::Oracle.
&gt; print STDERR &#34;Pre oracle connection open files:&#34; . `ls -l /proc/$$/fd/
&gt;    | wc -l` . &#34;\n&#34;;
&gt; 2&#41; open a new database connection
&gt; 3&#41; check open file descriptor count
&gt; print STDERR &#34;open oracle connection open files:&#34; . `ls -l
&gt;    /proc/$$/fd/ | wc -l` . &#34;\n&#34;;
&gt; 3&#41; disconnect the connection
&gt; print STDERR &#34;Post oracle connection open files:&#34; . `ls -l
&gt;    /proc/$$/fd/ | wc -l` . &#34;\n&#34;;
&gt; 
&gt; One file descriptor remains open, at least on my machine after every
&gt;    call.  In a single threaded application this is not an issue but in
&gt;    one that spawns thousands of threads which use Oracle, the maximum
&gt;    number of open filehandles available to the user account running
&gt;    the program is quickly exceeded and it is unable to complete.  I
&gt;    had hoped that using ora_dbh_share would solve the problem but no
&gt;    beans.
&gt; 
&gt; System:
&gt; Linux myhost 2.6.18-128.1.1.el5 #1 SMP Mon Jan 26 13:58:24 EST 2009
&gt;    x86_64 x86_64 x86_64 GNU/Linux
&gt; Perl: 5.10.0
&gt; DBD-Oracle: $DBD::Oracle::VERSION = &#39;1.23&#39;;
&gt; 
&gt; I apologize if I missed this bug in those listed on CPAN
&gt; 
&gt; Thanks,
&gt; 
&gt; bpb
</div>
I don&#39;t see any fd leaks here.

Since you are on Linux it would be nice to find out what this file
descriptor is. You can something like this:

valgrind --track-fds=yes perl myscript.pl

where myscript.pl prints out $$ &#40;PID&#41;, connects and sleeps for say 60s.

in another terminal run sudo lsof &gt; lsof.out after the connection.

Now when the program exits valgrind should show you the leaked fds and
you can compare those to what lsof says by looking for the fds open for
the pid you printed and we should find out which file or socket is open.

You may not have lsof and valgrind installed already.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-759890" href="/Public/Bug/Display.html?id=52757#txn-759890">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;08&nbsp;03:34:56&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-760177" href="/Public/Bug/Display.html?id=52757#txn-760177">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;08&nbsp;13:30:48&nbsp;2010</span>
    <span class="description">brookepb [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52757] File descriptor leak with DBD-Oracle</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 Apr 2010 12:29:42 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brooke Peterson-Burch &lt;brookepb [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/760177/393145/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/393145">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Martin,

I apologize for having to run my tests on an active work system where
I do not have administrative rights so its not all that you hoped for.
 I couldn&#39;t run lsof as a super user but it and valgrind were present
on the system.  I&#39;ve attached the valgrind and lsof output as separate
files and below I show the file descriptor counts as described in the
original bug listing.

Test output to give you a feel for what I tried:

valgrind --track-fds=yes ./TstOpenFileDescriptorIssue.pl 2&gt; valgrind_op.txt
#Test opening and closing connections 5 times w/out starting a thread
Pre test open files:10
Post test open files:11

#All thread creation tests create and join 1 threads each.
#Test thread creation with no open oracle connections
Pre test open files:11
Post test open files:11

#Test opening and closing an oracle connection in each thread
Pre test open files:11
Post test open files:12

#Test having an open oracle connection before creating threads which
do not open additional connections.
Pre test open files:12
Post test open files:14

#Test combination of an open oracle connect, and having each thread
open and close a connection
Pre test open files:12
Post test open files:15

Check lsof now!
Final settled open files before terminating script:13

Completed testing


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
From: &#34;Martin J Evans via RT&#34; &lt;bug-DBD-Oracle@rt.cpan.org&gt;
To: brookepb@mchsi.com
Sent: Thursday, April 8, 2010 2:34:56 AM GMT -06:00 US/Canada Central
Subject: [rt.cpan.org #52757] File descriptor leak with DBD-Oracle

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52757">https://rt.cpan.org/Ticket/Display.html?id=52757</a></span> &gt;

On Mon Dec 14 10:42:52 2009, brookepb@mchsi.com wrote:
<div class="message-stanza open">&gt; Description:
&gt; There appears to be a file descriptor leak for every oracle connection
&gt;    &#40;even when using ora_dbh_share&#41; when using DBD-Oracle in perl
&gt;    scripts using threads, threads::shared.
&gt;
&gt; To recreate the problem:
&gt; 1&#41; at start of a minimal perl script, using the libs noted above along
&gt;    with DBD::Oracle.
&gt; print STDERR &#34;Pre oracle connection open files:&#34; . `ls -l /proc/$$/fd/
&gt;    | wc -l` . &#34;\n&#34;;
&gt; 2&#41; open a new database connection
&gt; 3&#41; check open file descriptor count
&gt; print STDERR &#34;open oracle connection open files:&#34; . `ls -l
&gt;    /proc/$$/fd/ | wc -l` . &#34;\n&#34;;
&gt; 3&#41; disconnect the connection
&gt; print STDERR &#34;Post oracle connection open files:&#34; . `ls -l
&gt;    /proc/$$/fd/ | wc -l` . &#34;\n&#34;;
&gt;
&gt; One file descriptor remains open, at least on my machine after every
&gt;    call.  In a single threaded application this is not an issue but in
&gt;    one that spawns thousands of threads which use Oracle, the maximum
&gt;    number of open filehandles available to the user account running
&gt;    the program is quickly exceeded and it is unable to complete.  I
&gt;    had hoped that using ora_dbh_share would solve the problem but no
&gt;    beans.
&gt;
&gt; System:
&gt; Linux myhost 2.6.18-128.1.1.el5 #1 SMP Mon Jan 26 13:58:24 EST 2009
&gt;    x86_64 x86_64 x86_64 GNU/Linux
&gt; Perl: 5.10.0
&gt; DBD-Oracle: $DBD::Oracle::VERSION = &#39;1.23&#39;;
&gt;
&gt; I apologize if I missed this bug in those listed on CPAN
&gt;
&gt; Thanks,
&gt;
&gt; bpb
</div>
I don&#39;t see any fd leaks here.

Since you are on Linux it would be nice to find out what this file
descriptor is. You can something like this:

valgrind --track-fds=yes perl myscript.pl

where myscript.pl prints out $$ &#40;PID&#41;, connects and sleeps for say 60s.

in another terminal run sudo lsof &gt; lsof.out after the connection.

Now when the program exits valgrind should show you the leaked fds and
you can compare those to what lsof says by looking for the fds open for
the pid you printed and we should find out which file or socket is open.

You may not have lsof and valgrind installed already.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/760177/393146/valgrind_op.txt">Download valgrind_op.txt</a><br />
<span class="downloadcontenttype">text/plain 284.3k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/760177/393147/lsof.out">Download lsof.out</a><br />
<span class="downloadcontenttype">application/octet-stream 27.1k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-767249" href="/Public/Bug/Display.html?id=52757#txn-767249">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;23&nbsp;12:21:45&nbsp;2010</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/767249/396991/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/396991">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 185b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe the latest &#39;trunk&#39; version of DBD::Oracle have fixed this

please give this code base a try

<span class="clickylink"><a target="new" rel="nofollow" href="http://svn.perl.org/modules/dbd-oracle/trunk">http://svn.perl.org/modules/dbd-oracle/trunk</a></span>

and see if that fixes your problem. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-767252" href="/Public/Bug/Display.html?id=52757#txn-767252">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;23&nbsp;12:21:47&nbsp;2010</span>
    <span class="description">champoux [...] pythian.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-872091" href="/Public/Bug/Display.html?id=52757#txn-872091">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;21&nbsp;19:03:39&nbsp;2010</span>
    <span class="description">champoux [...] pythian.com -  Fixed in 1.25 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-872092" href="/Public/Bug/Display.html?id=52757#txn-872092">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;21&nbsp;19:03:40&nbsp;2010</span>
    <span class="description">champoux [...] pythian.com -  Fixed in 1.25-withoutworldwriteables added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-872093" href="/Public/Bug/Display.html?id=52757#txn-872093">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;21&nbsp;19:03:40&nbsp;2010</span>
    <span class="description">champoux [...] pythian.com -  Fixed in 1.25_brokentar added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-872094" href="/Public/Bug/Display.html?id=52757#txn-872094">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;21&nbsp;19:03:40&nbsp;2010</span>
    <span class="description">champoux [...] pythian.com -  Fixed in 1.26 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.494689</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
