<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #1352 for TimeDate: TimeDate parsing lpd log files</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #1352 for TimeDate: TimeDate parsing lpd log files</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/TimeDate/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/TimeDate/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/TimeDate/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/TimeDate/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/TimeDate">TimeDate CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">1352</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/TimeDate/Active/">TimeDate</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">GBARR [...] CPAN.ORG
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
yan [...] seiner.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-33566-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33567-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;05:55:52&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TimeDate parsing lpd log files</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am using timedate to parse lpd-generated log files.  lpd uses a &#39;-&#39; to separate its time and date values.  Also, I had a problem with parsing the new millenium two digit years.

This patch takes care of both:

*** TimeDate-1.1301/lib/Date/Parse.pm   Thu Jun  6 14:12:58 2002
--- TimeDate-1.1301-ys/lib/Date/Parse.pm        Sun Jun 16 12:22:43 2002
***************
*** 88,94 ****
    $dtstr =~ s#&#40;$daypat&#41;\s*&#40;den\s&#41;?# #o;
    # Time: 12:00 or 12:00:00 with optional am/pm
    
!   if &#40;$dtstr =~ s/&#40;?:^|\s&#41;&#40;\d{4}&#41;&#40;[-:]?&#41;&#40;\d\d?&#41;\2&#40;\d\d?&#41;&#40;?:[Tt ]&#40;\d\d?&#41;&#40;?:&#40;[-:]?&#41;&#40;\d\d?&#41;&#40;?:\6&#40;\d\d?&#41;&#40;?:[.,]\d+&#41;?&#41;?&#41;?&#41;?\b/ /&#41; {
      &#40;$year,$month,$day,$hh,$mm,$ss&#41; = &#40;$1,$3-1,$4,$5,$7,$8&#41;;
    }
    else {
--- 88,94 ----
    $dtstr =~ s#&#40;$daypat&#41;\s*&#40;den\s&#41;?# #o;
    # Time: 12:00 or 12:00:00 with optional am/pm
    
!   if &#40;$dtstr =~ s/&#40;?:^|\s&#41;&#40;\d{4}&#41;&#40;[-:]?&#41;&#40;\d\d?&#41;\2&#40;\d\d?&#41;&#40;?:[Tt -]&#40;\d\d?&#41;&#40;?:&#40;[-:]?&#41;&#40;\d\d?&#41;&#40;?:\6&#40;\d\d?&#41;&#40;?:[.,]\d+&#41;?&#41;?&#41;?&#41;?\b/ /&#41; {
      &#40;$year,$month,$day,$hh,$mm,$ss&#41; = &#40;$1,$3-1,$4,$5,$7,$8&#41;;
    }
    else {
***************
*** 184,189 ****
--- 184,190 ----
    }
  
    $year -= 1900 if defined $year &#38;&#38; $year &gt; 1900;
+   $year += 100 if defined $year &#38;&#38; $year &lt; 50;
  
    $zone += 3600 if defined $zone &#38;&#38; $dst;


Thanks,

--Yan
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;06&nbsp;04:14:48&nbsp;2002</span>
    <span class="description">GBARR [...] CPAN.ORG -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;06&nbsp;04:14:51&nbsp;2002</span>
    <span class="description">GBARR [...] CPAN.ORG -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;06&nbsp;04:16:32&nbsp;2002</span>
    <span class="description">GBARR [...] CPAN.ORG -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Can you provide some sample dates for testing.

I dont like the $year += 100 if &lt; 50. That has potential to break
any script that is currently using TimeDate to parse dates from
before 1950. Although this is not going to be common, it is a
possability that someone is doing it
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;06&nbsp;06:41:19&nbsp;2002</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yan Seiner</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[Sorry if you got my earlier note and this is a repost.  CPAN&#39;s RT is
set up differently from mine; it does not appear to automatically post
emailed responses.]

Yup.  The problem is that if you have a year with 02, it will be parsed
as 1902 and not 2002, which is a much more likely scenario.  Basically,
the parser must make an assumption about the century when it&#39;s only
given the last two digits of the year.  I&#39;ve changed the assumption, is
all.  I&#39;ve since resolved the problem by using RE parsing on input to
standardize my dates before they go to the parser.  The other
possibility is to pass to the parser an optional format string when
handling off-the-wall formats.  Hylafax, for example, uses a weird date
format:

06/08/02 19:31  SEND    00000114        ttyI6   50      &#34;&#34;     
yan@cardinalengineering.com     &#34;3226021&#34;       &#34;LOWCOUNTRYLANDCENTER&#34; 
2314    1       0:31          0:13    &#34;&#34;
06/08/02 19:35  SEND    00000116        ttyI7   51      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2314    6       2:00          1:46    &#34;&#34;
06/08/02 19:44  SEND    00000118        ttyI6   52      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2314    1       0:41          0:27    &#34;&#34;
02/08/02 20:25  SEND    00000120        ttyI7   53      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2315    1       0:33          0:19    &#34;&#34;
02/09/02 05:52  SEND    00000122        ttyI6   54      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2315    2       1:12          0:54    &#34;&#34;                &#34;&#34;

You really have to look at a series of dates to figure out which is yy,
mm, and dd.  No way a parser can make that call.  Knowing that this is
US software, I&#39;d guess it&#39;s mm/dd/yy, but you really have to look to be
sure.

For the other item, here&#39;s the output of lpd log files:

cardinal jim 1149 3 2002-02-26-10:37:21.141 2002-02-26-10:37:40.000
smbprn.000798.9evHfX aphrodite.cardinal.lan
cardinal jim 1150 1 2002-02-26-10:37:35.042 2002-02-26-10:38:02.000
smbprn.000799.5FEI4I aphrodite.cardinal.lan
cardinal jim 1219 1 2002-02-26-15:16:50.244 2002-02-26-15:16:52.000
smbprn.000810.J5wnVi aphrodite.cardinal.lan
cardinal jim 1220 1 2002-02-26-15:32:53.831 2002-02-26-15:32:56.000
smbprn.000814.MFfzsB aphrodite.cardinal.lan
cardinal jim 1221 1 2002-02-26-15:35:59.887 2002-02-26-15:36:02.000
smbprn.000817.EmxbXB aphrodite.cardinal.lan

The dates are as lpd feeds them to the various filters - af, if, and of

And here&#39;s my version of lpd &#40;AFAIK, the date format has not changed in
a long time&#41;:

[root@aphrodite /root]# lpd -V
LPRng-3.7.4, Copyright 1988-2000 Patrick Powell, &lt;papowell@lprng.com&gt;

--Yan
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;06&nbsp;22:40:28&nbsp;2002</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yan Seiner</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[Sorry if you got my earlier note and this is a repost.  CPAN&#39;s RT is
set up differently from mine; it does not appear to automatically post
emailed responses.]

Yup.  The problem is that if you have a year with 02, it will be parsed
as 1902 and not 2002, which is a much more likely scenario.  Basically,
the parser must make an assumption about the century when it&#39;s only
given the last two digits of the year.  I&#39;ve changed the assumption, is
all.  I&#39;ve since resolved the problem by using RE parsing on input to
standardize my dates before they go to the parser.  The other
possibility is to pass to the parser an optional format string when
handling off-the-wall formats.  Hylafax, for example, uses a weird date
format:

06/08/02 19:31  SEND    00000114        ttyI6   50      &#34;&#34;     
yan@cardinalengineering.com     &#34;3226021&#34;       &#34;LOWCOUNTRYLANDCENTER&#34; 
2314    1       0:31          0:13    &#34;&#34;
06/08/02 19:35  SEND    00000116        ttyI7   51      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2314    6       2:00          1:46    &#34;&#34;
06/08/02 19:44  SEND    00000118        ttyI6   52      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2314    1       0:41          0:27    &#34;&#34;
02/08/02 20:25  SEND    00000120        ttyI7   53      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2315    1       0:33          0:19    &#34;&#34;
02/09/02 05:52  SEND    00000122        ttyI6   54      &#34;&#34;     
yan@cardinalengineering.com     &#34;322.6021&#34;      &#34;LOWCOUNTRYLANDCENTER&#34; 
2315    2       1:12          0:54    &#34;&#34;                &#34;&#34;

You really have to look at a series of dates to figure out which is yy,
mm, and dd.  No way a parser can make that call.  Knowing that this is
US software, I&#39;d guess it&#39;s mm/dd/yy, but you really have to look to be
sure.

For the other item, here&#39;s the output of lpd log files:

cardinal jim 1149 3 2002-02-26-10:37:21.141 2002-02-26-10:37:40.000
smbprn.000798.9evHfX aphrodite.cardinal.lan
cardinal jim 1150 1 2002-02-26-10:37:35.042 2002-02-26-10:38:02.000
smbprn.000799.5FEI4I aphrodite.cardinal.lan
cardinal jim 1219 1 2002-02-26-15:16:50.244 2002-02-26-15:16:52.000
smbprn.000810.J5wnVi aphrodite.cardinal.lan
cardinal jim 1220 1 2002-02-26-15:32:53.831 2002-02-26-15:32:56.000
smbprn.000814.MFfzsB aphrodite.cardinal.lan
cardinal jim 1221 1 2002-02-26-15:35:59.887 2002-02-26-15:36:02.000
smbprn.000817.EmxbXB aphrodite.cardinal.lan

The dates are as lpd feeds them to the various filters - af, if, and of

And here&#39;s my version of lpd &#40;AFAIK, the date format has not changed in
a long time&#41;:

[root@aphrodite /root]# lpd -V
LPRng-3.7.4, Copyright 1988-2000 Patrick Powell, &lt;papowell@lprng.com&gt;

--Yan
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;19&nbsp;11:55:09&nbsp;2004</span>
    <span class="description">GBARR [...] CPAN.ORG -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
