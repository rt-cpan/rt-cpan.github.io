<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #123229 for Date-Manip: Date::Manip fails to load when /etc/localtime is &#34;Factory&#34; timezone</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #123229 for Date-Manip: Date::Manip fails to load when /etc/localtime is &#34;Factory&#34; timezone</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Date-Manip">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Date-Manip">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Date-Manip">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Date-Manip">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Date-Manip">Date-Manip CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">123229</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Date-Manip">Date-Manip</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45268-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45269-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=123229">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1751598" href="/Public/Bug/Display.html?id=123229#txn-1751598">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;09&nbsp;17:04:04&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Date::Manip fails to load when /etc/localtime is &#34;Factory&#34; timezone</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1751598/942369/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/942369">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza">I&#39;m not sure if this is in Date-Manips territory or not, but I&#39;ve been working around this issue for a while and was wondering if somewhere closer to the problem is appropriate.<br>

<br>

Upon completing a fresh stock install of Gentoo from installation media, the /etc/localtime is a copy of /usr/share/zoneinfo/Factory&nbsp; which I believe is built from this file : <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/eggert/tz/blob/master/factory">https://github.com/eggert/tz/blob/master/factory</a></span><br>

<br>

And this file is provided by upstream for this purpose.<br>

<br>

And /etc/timezone does not exist.<br>

<br>

This causes Date-Manip to cease working in entirety, and causes lots of things that only try to load it to see if its installed or not to also fail.<br>

<br>

perl -MDate::Manip -e1<br>

ERROR: Date::Manip unable to determine Time Zone.<br>

ERROR LOADING MODULE: Date::Manip::DM6 at &lt;&gt;/Date/Manip.pm line 35.<br>

Compilation failed in require.<br>

BEGIN failed--compilation aborted.<br>

<br>

But its of my opinion that &quot;hey, user hasn&#39;t configured their timezone&quot; is not good grounds for not being able to build packages.<br>

<br>

So I&#39;ve just been working around the problem by setting TZ=UTC inside the build chain code, and deferring the &quot;Hey, you probably should set your timezone&quot; problem to somewhere else.<br>

<br>

If there could be a better solution for this problem closer to where it appears, that&#39;d be awesome :)<br>

<br>

--&nbsp;<br>

- CPAN kentnl@cpan.org<br>

- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1751917" href="/Public/Bug/Display.html?id=123229#txn-1751917">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;13:12:19&nbsp;2017</span>
    <span class="description">sbeck [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1751917/942545/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/942545">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have some mixed feelings concerning this.

On one hand, I&#39;m asking myself &#34;if a module cannot be loaded in a way that is usable, should it be loadable?&#34;  A great deal of Date::Manip&#39;s functionality depends on on the timezone being determined.  So much so that I&#39;ve got that assumption built in a lot of places.

One solution would be to track down every one of those places and add an
   if timezone isn&#39;t determined
      do the right thing
   else
      do something else &#40;probably set an error code&#41;
   endif

However, that assumption is made often enough that I am really adverse to doing that.

Instead, I&#39;m considering the alternate solution of using &#39;GMT&#39; as the default timezone.  If a timezone cannot be determined, you&#39;ll still get an error message

   ERROR: Date::Manip unable to determine Time Zone.  Using GMT for all operations.

but then continuing.  That would be enough to solve your problem.

However, on a secondary note, I really would like to be able to figure out the timezone.  If there are ANY other methods for determining the timezone on Gentoo that are available at the time this is happening during your build, let me know and I can add them.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1751918" href="/Public/Bug/Display.html?id=123229#txn-1751918">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;13:12:20&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1751920" href="/Public/Bug/Display.html?id=123229#txn-1751920">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;13:28:49&nbsp;2017</span>
    <span class="description">sbeck [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1751920/942547/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/942547">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 378b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve decided that making GMT the default timezone is safe, and very unlikely to interfere with anything &#40;the only backward incompatible change is that where previously Date::Manip couldn&#39;t load, now it can, and will even function, but without knowing the local timezone&#41;.  That seems like a pretty safe change.

It&#39;ll be in the next release &#40;due out the beginning of December&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1751922" href="/Public/Bug/Display.html?id=123229#txn-1751922">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;13:35:36&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1751922/942549/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/942549">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza"><p>
	On 2017-10-13 06:12:19, SBECK wrote:<br>

	&gt; I have some mixed feelings concerning this.<br>

	&gt;<br>

	&gt; On one hand, I&#39;m asking myself &quot;if a module cannot be loaded in a way<br>

	&gt; that is usable, should it be loadable?&quot; A great deal of Date::Manip&#39;s<br>

	&gt; functionality depends on on the timezone being determined. So much so<br>

	&gt; that I&#39;ve got that assumption built in a lot of places.<br>

	&gt;<br>

	&gt; One solution would be to track down every one of those places and add<br>

	&gt; an<br>

	&gt; if timezone isn&#39;t determined<br>

	&gt; do the right thing<br>

	&gt; else<br>

	&gt; do something else (probably set an error code)<br>

	&gt; endif<br>

	&gt;<br>

	&gt; However, that assumption is made often enough that I am really adverse<br>

	&gt; to doing that.<br>

	&gt;<br>

	&gt; Instead, I&#39;m considering the alternate solution of using &#39;GMT&#39; as the<br>

	&gt; default timezone. If a timezone cannot be determined, you&#39;ll still<br>

	&gt; get an error message<br>

	&gt;<br>

	&gt; ERROR: Date::Manip unable to determine Time Zone. Using GMT for all<br>

	&gt; operations.<br>

	&gt;<br>

	&gt; but then continuing. That would be enough to solve your problem.<br>

	&gt;<br>

	&gt; However, on a secondary note, I really would like to be able to figure<br>

	&gt; out the timezone. If there are ANY other methods for determining the<br>

	&gt; timezone on Gentoo that are available at the time this is happening<br>

	&gt; during your build, let me know and I can add them.<br>

	<br>

	The tricky part is at this stage, there *is* no &quot;timezone&quot; other than the factory one.<br>

	<br>

	And being a &quot;You have to do everything manually&quot; distribution, setting the timezone is a manual step documented in the install guide.</p>

<p>
	<span class="clickylink"><a target="new" rel="nofollow" href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Full/Installation#Timezone">https://wiki.gentoo.org/wiki/Handbook:AMD64/Full/Installation#Timezone</a></span><br>

	<br>

	I agree that everyone *should* set this, and even if they do *half* these steps, ( eg: making the /etc/timezone file, but failing the --configure&nbsp; step ), then Date::Manip will function as intended ( I discovered this in testing it on a different box because borking my localtime wasn&#39;t enough on its own, I had to bork that file and nuke /etc/timezone )<br>

	<br>

	So for most people Date::Manip is already doing more than enough.<br>

	<br>

	Its just for whatever reason when I set up my testing chroot, I missed this step, and I didn&#39;t even *notice* it was broken for *weeks* until Date::Manip started failing when I test-installed it :)</p>

<p>
	So I&#39;ve just left it as-is because I figure if I can make that mistake, somebody else can.</p>

<p>
	And with a little bit of poking, I found other people have had similar issues:<br>

	<br>

	<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.gentoo.org/30129#c1">https://bugs.gentoo.org/30129#c1</a></span><br>

	<br>

	But yes, I agree, &quot;pretend its GMT&quot; is a sensible alternative to breaking IMO, because that&#39;s the behaviour the Factory Zone does for everything else, the only discriminator being the &quot;-&quot; on the TZ code.<br>

	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1751930" href="/Public/Bug/Display.html?id=123229#txn-1751930">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;14:31:01&nbsp;2017</span>
    <span class="description">sbeck [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.294349</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
