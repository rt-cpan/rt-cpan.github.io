<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #16026 for Spoon: oodles of apache log warnings</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #16026 for Spoon: oodles of apache log warnings</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Spoon/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Spoon/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Spoon/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Spoon/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Spoon">Spoon CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">16026</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Spoon/Active/">Spoon</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
djh [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-29390-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.23    </td>
  </tr>
  <tr id="CF-29391-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;04:49:50&nbsp;2005</span>
    <span class="description">djh [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> oodles of apache log warnings</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I set up a kwiki and am seeing lots of warnings in my Apache log when I refresh the home page. This makes it very difficult to use the log. The problem is also seen by other users. The messages look like this:

[Thu Nov 17 13:01:46 2005] index.cgi: \t&#40;in cleanup&#41; Can&#39;t call method
&#34;unhook&#34; on an undefined value
at /usr/lib/perl5/site_perl/5.8.6/Spoon/Hub.pm line 109 during global
destruction.
[Thu Nov 17 13:01:46 2005] index.cgi:
at /usr/lib/perl5/site_perl/5.8.6/Spoon/Base.pm line 110
[Thu Nov 17 13:01:46 2005] index.cgi: \tSpoon::Base::__ANON__&#40;&#39;Can\\&#39;t
call method &#34;unhook&#34; on an undefined value at /usr/lib...&#39;&#41; called
at /usr/lib/perl5/site_perl/5.8.6/Spoon/Hub.pm line 109
[Thu Nov 17 13:01:46 2005] index.cgi:
\tSpoon::Hub::remove_hooks&#40;&#39;Kwiki::Hub=HASH&#40;0x848af48&#41;&#39;&#41; called
at /usr/lib/perl5/site_perl/5.8.6/Spoon/Hub.pm line 119
[Thu Nov 17 13:01:46 2005] index.cgi:
\tSpoon::Hub::DESTROY&#40;&#39;Kwiki::Hub=HASH&#40;0x848af48&#41;&#39;&#41; called
at /srv/www/kwiki/index.cgi line 0
[Thu Nov 17 13:01:46 2005] index.cgi: \teval {...} called
at /srv/www/kwiki/index.cgi line 0


<span class="clickylink"><a target="new" rel="nofollow" href="http://www.kwiki.org/?BugReports">http://www.kwiki.org/?BugReports</a></span> says:

Kwiki plugins that add hooks, e.g. `Kwiki::Archive::Rcs 0.15` and
`Kwiki:: PagePrivacy 0.10`, cause the following errors to appear in my
Apache error log:

[error] index.cgi: \t&#40;in cleanup&#41; Can&#39;t call method &#34;unhook&#34; on an undefined value at /usr/pkg/lib/perl5/site_perl/5.8.6/Spoon/Hub.pm line 109 during global destruction., referer: <span class="clickylink"><a target="new" rel="nofollow" href="http://wiki.example.com/">http://wiki.example.com/</a></span>

Removing those plugins from the kwiki makes these errors go away. The
plugins still work as expected, meaning the hooks are active when
index.cgi is executed, but it appears these errors are generated when
the index.cgi script is cleaning up after itself.

When using thttpd, the errors go to the browser instead, making this a
user-visible bug.

Workaround: After doing a `wiki -update`, manually change the first line
of `index.cgi` to:

#!/usr/bin/perl


I don&#39;t like that solution much &#40;i.e. removing -w from the first line&#41;
so I thought I&#39;d dig a little deeper. A little delving shows me that
$self-&gt;all_hooks is returning an ARRAY with three undef elements in
Spoon::Hub::remove_hooks:

sub remove_hooks {
    my $hooks = $self-&gt;all_hooks;
    while &#40;@$hooks&#41; {
        pop&#40;@$hooks&#41;-&gt;unhook;
    }
}

I changed the code to:

sub remove_hooks {
    my $hooks = $self-&gt;all_hooks;
    while &#40;@$hooks&#41; {
        my $hook = pop @$hooks;
        $hook-&gt;unhook if $hook;
    }
}

This fixes the problem and does not break the install tests.

HTH, Dave

Oh, SuSE 9.3 on a regular Intel box
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
