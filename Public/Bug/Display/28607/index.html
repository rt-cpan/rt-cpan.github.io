<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #28607 for Data-Dumper: Data::Dumper::Dumper is not dumping utf8 strings as latin1/8bit instead of utf8</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #28607 for Data-Dumper: Data::Dumper::Dumper is not dumping utf8 strings as latin1/8bit instead of utf8</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Data-Dumper/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Data-Dumper/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Data-Dumper/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Data-Dumper/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://rt.perl.org/perlbug/">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Data-Dumper">Data-Dumper CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">28607</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Data-Dumper/Active/">Data-Dumper</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
martini [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-9006-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.12_02    </td>
  </tr>
  <tr id="CF-9007-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;01&nbsp;05:55:10&nbsp;2007</span>
    <span class="description">me+cpan [...] bogen.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Data::Dumper::Dumper is not dumping utf8 strings as latin1/8bit
 instead of utf8</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Data::Dumper::Dumper is not dumping utf8 strings as latin1/8bit instead
of utf8.

How to reproduce:
&lt;script1&gt;
#!/usr/bin/perl -w
use strict;
use utf8;
use Encode;
use Data::Dumper;

my $I = {A =&gt; &#39;ü&#39;};
if &#40;Encode::is_utf8&#40;$I-&gt;{A}&#41;&#41; {
    print &#34;It is utf8.\n&#34;;
}
print Data::Dumper::Dumper&#40;$I&#41;;
&lt;/script1&gt;

The output is:

me@madrid:~&gt; ./ut.pl 
It is utf8.
$VAR1 = {
          &#39;A&#39; =&gt; &#34;\x{fc}&#34;
        };
me@madrid:~&gt; 

\x{fc} is the 8bit/latin1 sign. :-&#40; This should be \x{00C3}\x{00BC}.

Feedback would be fine!

Many thanks,

 -Martini
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;18:48:10&nbsp;2007</span>
    <span class="description">me+bitcard [...] bogen.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> martini [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Any News? Any feedback?

 -Martin


On Wed Aug 01 05:55:10 2007, MARTINI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Data::Dumper::Dumper is not dumping utf8 strings as latin1/8bit instead
&gt; of utf8.
&gt; 
&gt; How to reproduce:
&gt; &lt;script1&gt;
&gt; #!/usr/bin/perl -w
&gt; use strict;
&gt; use utf8;
&gt; use Encode;
&gt; use Data::Dumper;
&gt; 
&gt; my $I = {A =&gt; &#39;ü&#39;};
&gt; if &#40;Encode::is_utf8&#40;$I-&gt;{A}&#41;&#41; {
&gt;     print &#34;It is utf8.\n&#34;;
&gt; }
&gt; print Data::Dumper::Dumper&#40;$I&#41;;
&gt; &lt;/script1&gt;
&gt; 
&gt; The output is:
&gt; 
&gt; me@madrid:~&gt; ./ut.pl 
&gt; It is utf8.
&gt; $VAR1 = {
&gt;           &#39;A&#39; =&gt; &#34;\x{fc}&#34;
&gt;         };
&gt; me@madrid:~&gt; 
&gt; 
&gt; \x{fc} is the 8bit/latin1 sign. :-&#40; This should be \x{00C3}\x{00BC}.
&gt; 
&gt; Feedback would be fine!
&gt; 
&gt; Many thanks,
&gt; 
&gt;  -Martini
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;18:48:12&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;25&nbsp;08:13:13&nbsp;2007</span>
    <span class="description">EDAVIS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> EDAVIS [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m not the DD maintainer but I&#39;d guess the following:

The output of Data::Dumper must depend on your locale settings.  If it
needs to output, say, LATIN SMALL LETTER U WITH DIAERESIS &#40;U+00FC&#41;, then
if the terminal expects Latin-1 output it needs to output the Latin-1
byte sequence.  Obviously if the terminal is only capable of
understanding Latin-1 then it would be malformed output to produce UTF-8.

Similarly, if the terminal is configured for UTF-8 &#40;e.g.
LC_ALL=en.UTF-8&#41; then it would be malformed output to produce Latin-1
character sequences.

So, what are your locale environment variables set for?

% set | grep LC
% set | grep LANG
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;25&nbsp;08:42:26&nbsp;2007</span>
    <span class="description">me+bitcard [...] bogen.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> martini [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi EDAVIS,

On Tue Dec 25 08:13:13 2007, EDAVIS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not the DD maintainer but I&#39;d guess the following:
&gt; 
&gt; The output of Data::Dumper must depend on your locale settings.  If it
&gt; needs to output, say, LATIN SMALL LETTER U WITH DIAERESIS &#40;U+00FC&#41;, then
&gt; if the terminal expects Latin-1 output it needs to output the Latin-1
&gt; byte sequence.  Obviously if the terminal is only capable of
&gt; understanding Latin-1 then it would be malformed output to produce UTF-8.
&gt; 
&gt; Similarly, if the terminal is configured for UTF-8 &#40;e.g.
&gt; LC_ALL=en.UTF-8&#41; then it would be malformed output to produce Latin-1
&gt; character sequences.
&gt; 
&gt; So, what are your locale environment variables set for?
&gt; 
&gt; % set | grep LC
&gt; % set | grep LANG
</div>
This is the output:

me@madrid:~&gt; set | grep LC
MAILCHECK=60
me@lancelot:~&gt; set | grep LANG
LANG=de_DE.UTF-8
me@madrid:~&gt; 


It&#39;s perl 5.8.8

me@madrid:~&gt; perl --version

This is perl, v5.8.8 built for i586-linux-thread-multi

Copyright 1987-2006, Larry Wall
[...]

So the coniguration looks ok or? 

Many thanks,

 -Martin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;19&nbsp;10:33:59&nbsp;2010</span>
    <span class="description">Bernhard.Schmalhofer [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bernhard.Schmalhofer [...] gmx.de</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mi 01. Aug 2007, 05:55:10, MARTINI schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Data::Dumper::Dumper is not dumping utf8 strings as latin1/8bit instead
&gt; of utf8.
&gt; 
&gt; How to reproduce:
&gt; &lt;script1&gt;
&gt; #!/usr/bin/perl -w
&gt; use strict;
&gt; use utf8;
&gt; use Encode;
&gt; use Data::Dumper;
&gt; 
&gt; my $I = {A =&gt; &#39;ü&#39;};
&gt; if &#40;Encode::is_utf8&#40;$I-&gt;{A}&#41;&#41; {
&gt;     print &#34;It is utf8.\n&#34;;
&gt; }
&gt; print Data::Dumper::Dumper&#40;$I&#41;;
&gt; &lt;/script1&gt;
&gt; 
&gt; The output is:
&gt; 
&gt; me@madrid:~&gt; ./ut.pl 
&gt; It is utf8.
&gt; $VAR1 = {
&gt;           &#39;A&#39; =&gt; &#34;\x{fc}&#34;
&gt;         };
&gt; me@madrid:~&gt; 
&gt; 
&gt; \x{fc} is the 8bit/latin1 sign. :-&#40; This should be \x{00C3}\x{00BC}.
&gt; 
</div>
Hi Martin,

I think that Data::Dumper does the right thing. Data::Dumper creates
Perl-code, and quotes wide characters in strings with the \x notation.
The code point for &#39;ü&#39; is U+00FC, encoded in UTF-8 it is the two bytes
0xC3 and 0xBC. The \x notation is encoding agnostic and used the
codepoint. Therefore &#34;\{fc}&#34; is the same thing as an &#39;ü&#39;.

Here is some sample code:


#!/usr/bin/perl

use strict;
use warnings;
use utf8;

use Encode;
use Data::Dumper;
use DBI;

# print Unicode
binmode STDOUT, &#39;:utf8&#39;;

my $I = {A =&gt; &#39;ü&#39;};
if &#40;Encode::is_utf8&#40;$I-&gt;{A}&#41;&#41; {
    print &#34;It is utf8.\n&#34;;
}
print Data::Dumper::Dumper&#40;$I&#41;;

if &#40; &#34;\x{00FC}&#34; eq &#34;\x{FC}&#34; &#41; {
    print &#34;an ü is an ü\n&#34;;
}

if &#40; &#39;ü&#39; eq &#34;\x{FC}&#34; &#41; {
    print &#34;an ü is still an ü\n&#34;;
}

if &#40; &#39;ü&#39; eq &#34;\x{00FC}&#34; &#41; {
    print &#34;an ü is still an ü\n&#34;;
}

# latin1 string with two characters
my $c3_bc = pack &#39;W2&#39;, 0xc3,0xbc;
print &#34;&#39;$c3_bc&#39;:&#34; . DBI::data_string_desc&#40; $c3_bc &#41;, &#34;\n&#34;;

# Unicode string with two characters
my $decoded_c3_bc = Encode::decode_utf8&#40; $c3_bc &#41;;
print &#34;&#39;$decoded_c3_bc&#39;:&#34;, DBI::data_string_desc&#40; $decoded_c3_bc &#41;, &#34;\n&#34;;

print Dumper&#40; $c3_bc, $decoded_c3_bc &#41;, &#34;\n&#34;;

# a two character string is never equal to a single character string
if &#40; $c3_bc eq $decoded_c3_bc &#41; {
    print &#34;now I&#39;m confused\n&#34;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;04&nbsp;10:25:58&nbsp;2011</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> EDAVIS [...] cpan.org, Bernhard.Schmalhofer [...] gmx.de</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I am marking this bug as rejected since Bernhard&#39;s explanation seems 
reasonable to me. &#40;I am not *really* the DD maintainer either, but I seem 
to be the only one who tends to the bug list on rt.cpan.org. It is 
maintained by p5p.&#41;

Martin, this is intended as any kind of disrespect. We are thankful for 
bug reports. If you disagree with my closing this ticket, then, by all 
means, feel free to reopen the ticket with a simple reply.

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;04&nbsp;10:25:59&nbsp;2011</span>
    <span class="description">smueller [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
