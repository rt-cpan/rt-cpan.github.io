<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43582 for WWW-Mechanize-Plugin-JavaScript: several mechanize + javascript bugs</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43582 for WWW-Mechanize-Plugin-JavaScript: several mechanize + javascript bugs</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=WWW-Mechanize-Plugin-JavaScript">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=WWW-Mechanize-Plugin-JavaScript">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=WWW-Mechanize-Plugin-JavaScript">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=WWW-Mechanize-Plugin-JavaScript">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-Mechanize-Plugin-JavaScript">WWW-Mechanize-Plugin-JavaScript CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43582</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=WWW-Mechanize-Plugin-JavaScript">WWW-Mechanize-Plugin-JavaScript</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
radimre [...] freemail.hu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-219704-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-219705-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=43582">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-569459" href="/Public/Bug/Display.html?id=43582#txn-569459">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;24&nbsp;12:27:15&nbsp;2009</span>
    <span class="description">radimre [...] freemail.hu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> several mechanize + javascript bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Feb 2009 17:55:49 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-WWW-Mechanize-Plugin-JavaScript [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Imre Rad &lt;radimre [...] freemail.hu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/569459/287148/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/287148">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

thanks for the latest bugfix, here are the next ones:

teszt2.pl:
#!/usr/bin/perl

use warnings;
use strict;
use WWW::Mechanize;

  
  my $mech = WWW::Mechanize-&gt;new&#40;&#41;;
  $mech-&gt;use_plugin&#40;&#39;JavaScript&#39;&#41;;
  $mech-&gt;get&#40;&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt.htm">http://localhost/je/teszt.htm</a></span>&#34;&#41;;


# perl teszt2.pl
SyntaxError: Expected statement or function declaration but found &#39;&lt;!--
wind&#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt.js">http://localhost/je/teszt.js</a></span>, line 1.

the failing web page is the following:
teszt.htm:
&lt;html&gt;
&lt;head&gt;
&lt;script type=&#34;text/javascript&#34; src=&#34;teszt.js&#34;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;

teszt.js:
&lt;!--
window.alert&#40;&#34;hello wrodl&#34;&#41;;
//--&gt;

i  know  this syntax is probably incorrect as comments are used in the
external  file  not  in the embedded html code within the script tags,
but  i  ran into this bug while developing a script for a real website
and also decent browsers can deal with this syntax.



teszt3.pl:
#!/usr/bin/perl

use warnings;
use strict;
use WWW::Mechanize;

  
  my $mech = WWW::Mechanize-&gt;new&#40;&#41;;
  $mech-&gt;use_plugin&#40;&#39;JavaScript&#39;&#41;;
  $mech-&gt;get&#40;&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt2.htm">http://localhost/je/teszt2.htm</a></span>&#34;&#41;;
  

# perl teszt3.pl
TypeError: undefined has no properties, not even one named length at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt2.htm">http://localhost/je/teszt2.htm</a></span>, line 7.

teszt2.htm is basicly the standard dreamweaver generated mm_preload function:
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=windows-1250&#34;&gt;
&lt;script language=&#34;JavaScript&#34; type=&#34;text/JavaScript&#34;&gt;
&lt;!--
function MM_preloadImages&#40;&#41; { //v3.0
  var d=document; if&#40;d.images&#41;{ if&#40;!d.MM_p&#41; d.MM_p=new Array&#40;&#41;;
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for&#40;i=0; i&lt;a.length; i++&#41;
    if &#40;a[i].indexOf&#40;&#34;#&#34;&#41;!=0&#41;{ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}
//--&gt;
&lt;/script&gt;
&lt;/head&gt;
&lt;body onLoad=&#34;MM_preloadImages&#40;&#39;pic1.gif&#39;,&#39;pic2.gif&#39;&#41;&#34; &gt; 
&lt;/body&gt;
&lt;/html&gt;


3rd:
&lt;script&gt;
&lt;!--
window.alert&#40;&#34;foobar&#34;&#41;;
--&gt;
&lt;/script&gt;

SyntaxError: Expected expression but found &#39;&gt;
&#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt3.htm">http://localhost/je/teszt3.htm</a></span>, line 4.

if i close the comment block with //--&gt; in line 4, error disappears.



I am using v0.08. I can send you several more bug reports if yuo want :&#41;
Are you going to add frames support one day? It would kick ass.


best regards
imre rad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571097" href="/Public/Bug/Display.html?id=43582#txn-571097">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;27&nbsp;18:53:19&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/571097/288077/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288077">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 24 12:27:15 2009, radimre@freemail.hu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; thanks for the latest bugfix, here are the next ones:
&gt; 
&gt; ...
&gt; 
&gt; teszt.js:
&gt; &lt;!--
&gt; window.alert&#40;&#34;hello wrodl&#34;&#41;;
&gt; //--&gt;
&gt; 
&gt; i  know  this syntax is probably incorrect as comments are used in the
&gt; external  file  not  in the embedded html code within the script tags,
&gt; but  i  ran into this bug while developing a script for a real website
&gt; and also decent browsers can deal with this syntax.
&gt; 
</div>
I can update it to strip HTML comments from external scripts as well as internal easily 
enough.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; ...
&gt; teszt2.htm is basicly the standard dreamweaver generated mm_preload
&gt; function:
&gt; &lt;html&gt;
&gt; &lt;head&gt;
&gt; &lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=windows-
&gt; 1250&#34;&gt;
&gt; &lt;script language=&#34;JavaScript&#34; type=&#34;text/JavaScript&#34;&gt;
&gt; &lt;!--
&gt; function MM_preloadImages&#40;&#41; { //v3.0
&gt;   var d=document; if&#40;d.images&#41;{ if&#40;!d.MM_p&#41; d.MM_p=new Array&#40;&#41;;
&gt;     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for&#40;i=0;
</div>
That MM_preloadImages.arguments is really weird &#40;and ECMAScript makes no mention of 
such usage&#41;. â€˜argumentsâ€™ is usually a function-scoped variable &#40;i.e., *inside* the function&#41;. 
Accessing it as a property of the function itself doesnâ€™t make much sense, since it is not clear 
what would happen in the case of a recursive function. Anyway, I thought the oddities and 
inconsistencies of JavaScript 1.0 were gone by now. :-&#41;

Supporting this will be a little difficult. I will have to think about it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; i&lt;a.length; i++&#41;
&gt;     if &#40;a[i].indexOf&#40;&#34;#&#34;&#41;!=0&#41;{ d.MM_p[j]=new Image;
&gt; d.MM_p[j++].src=a[i];}}
&gt; }
&gt; //--&gt;
&gt; &lt;/script&gt;
&gt; &lt;/head&gt;
&gt; &lt;body onLoad=&#34;MM_preloadImages&#40;&#39;pic1.gif&#39;,&#39;pic2.gif&#39;&#41;&#34; &gt;
&gt; &lt;/body&gt;
&gt; &lt;/html&gt;
&gt; 
&gt; 
&gt; 3rd:
&gt; &lt;script&gt;
&gt; &lt;!--
&gt; window.alert&#40;&#34;foobar&#34;&#41;;
&gt; --&gt;
&gt; &lt;/script&gt;
&gt; 
&gt; SyntaxError: Expected expression but found &#39;&gt;
&gt; &#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt3.htm">http://localhost/je/teszt3.htm</a></span>, line 4.
&gt; 
&gt; if i close the comment block with //--&gt; in line 4, error disappears.
</div>
The only time I ever tried --&gt; Netscape couldnâ€™t handle it. That was 10 years ago. Ever since 
then, Iâ€™ve *always* used //--&gt;, and I assumed everyone else did the same. It seems that Iâ€™d 
better bring myself up to date. :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; 
&gt; I am using v0.08. I can send you several more bug reports if yuo want
&gt; :&#41;
</div>
Please do.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are you going to add frames support one day? It would kick ass.
</div>
Hmm, I thought I had already done so in 0.006. There are probably bugs stopping it from 
working for you. Actually, Iâ€™ve just realized I forgot to document the frame features &#40;look at 
the new docs for WWW::Mechanize::Plugin::DOM::Window, and also 
HTML::DOM::Element::Frame&#41;. &#40;You can get the window object with $mech-&gt;plugin&#40;&#39;DOM&#39;&#41;-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;window.&#41;
</div>
I have released a new version with the two HTML comment-related bugs fixed 
&#40;CPAN/authors/id/S/SP/SPROUT/WWW-Mechanize-Plugin-JavaScript-0.009.tar.gz&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571098" href="/Public/Bug/Display.html?id=43582#txn-571098">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;27&nbsp;18:53:20&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571358" href="/Public/Bug/Display.html?id=43582#txn-571358">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;28&nbsp;12:28:31&nbsp;2009</span>
    <span class="description">radimre [...] freemail.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43582] several mechanize + javascript bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Feb 2009 17:56:22 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Father Chrysostomos via RT &lt;bug-WWW-Mechanize-Plugin-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Imre Rad &lt;radimre [...] freemail.hu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/571358/288198/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288198">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">hi, thanks for the recent bugfixes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Supporting this will be a little difficult. I will have to think about it.
</div>
in my opinion, if you really want this extension to be working, you
need to make it deal with these commonly used popular scripts.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm, I thought I had already done so in 0.006. There are probably bugs stopping it from
</div>
Indeed, my bad that i didnt notice it. Its design is nice, but it is
buggy though, here is a simple test case:

index.html
&lt;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 4.01 Frameset//EN&#34; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/html4/frameset.dtd">http://www.w3.org/TR/html4/frameset.dtd</a></span>&#34;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;A simple frameset document&lt;/TITLE&gt;
&lt;/HEAD&gt;
  &lt;FRAMESET rows=&#34;100, 200&#34;&gt;
      &lt;FRAME name=&#34;frame1&#34; src=&#34;frame1.html&#34;&gt;
      &lt;FRAME name=&#34;frame2&#34; src=&#34;frame2.html&#34;&gt;
  &lt;/FRAMESET&gt;
&lt;/HTML&gt;

frame1.html:
&lt;HTML&gt;&lt;HEAD&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;form name=&#34;testform&#34; method=&#34;get&#34; action=&#34;test.htm&#34;&gt;
&lt;input type=&#34;text&#34; name=&#34;changeme&#34; value=&#34;defaultvalue&#34;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;


frame2.html:
&lt;HTML&gt;&lt;HEAD&gt;&lt;/HEAD&gt;&lt;BODY&gt;

&lt;a href=&#34;javascript:parent.frames[0].document.testform.changeme.value=&#39;lofasz&#39;;parent.frames[0].document.testform.submit&#40;&#41;;&#34;&gt;click here to submit another frame&#39;s form&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;

teszt5.pl:
#!/usr/bin/perl

use warnings;
use strict;
use Data::Dumper;
use WWW::Mechanize;

  
  my $mech = WWW::Mechanize-&gt;new&#40;&#41;;
  $mech-&gt;use_plugin&#40;&#39;JavaScript&#39;&#41;;
  $mech-&gt;get&#40;&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/frames/">http://localhost/je/frames/</a></span>&#34;&#41;;
  my $window = $mech-&gt;plugin&#40;&#39;DOM&#39;&#41;-&gt;window-&gt;[1];  
  if&#40;!$window&#41; { 
    print STDERR &#34;We dont have the 2nd frame!\n&#34;;
  }
  my $mech2 = $window-&gt;mech;  
  
  my $button = $mech2-&gt;find_link&#40; text_regex =&gt; qr/click here/i &#41;;
  if&#40;!$button&#41; {
    print STDERR &#34;cant find the button!\n&#34;;
        exit;
  }
  
  #ok we got it, follow
  $mech2-&gt;follow_link&#40; text_regex =&gt; qr/click here/i &#41;;


and the error is:
# perl teszt5.pl
ReferenceError: The variable parent has not been declared at line 1.


Another issue, it seems its impossible to click a standalone input
button:
&lt;input type=&#34;button&#34; name=&#34;testbutton&#34; value=&#34;submit form in another frame&#34; onClick=&#34;parent.frames[0].document.testform.changeme.value=&#39;lofasz&#39;;parent.frames[0].document.testform.submit&#40;&#41;;&#34;&gt;
find_link/find_all_links/find_all_inputs/current_form&#40;&#41;-&gt;find_input
nothing can find it. As you can see it doesnt even have an id, and in
some real life situations, it doesnt even have a name.
Am i supposed to do something with evaled javacsript like?:
$mech-&gt;plugin&#40;&#39;JavaScript&#39;&#41;-&gt;eval&#40;&#34;document.getElementByTagName&#40;&#39;input&#39;&#41;[0].click&#40;&#41;;&#34;&#41;;


best regards
Imre Rad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-572556" href="/Public/Bug/Display.html?id=43582#txn-572556">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;03&nbsp;15:06:15&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/572556/288899/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288899">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 28 12:28:31 2009, radimre@freemail.hu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; hi, thanks for the recent bugfixes.
&gt; 
<div class="message-stanza open">&gt; &gt; Supporting this will be a little difficult. I will have to think
</div>&gt; about it.
&gt; 
&gt; in my opinion, if you really want this extension to be working, you
&gt; need to make it deal with these commonly used popular scripts.
</div>
Iâ€™ve released a new version of JE &#40;CPAN/authors/id/S/SP/SPROUT/JE-0.031.tar.gz&#41; that does 
just this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Hmm, I thought I had already done so in 0.006. There are probably
</div>&gt; bugs stopping it from
&gt; 
&gt; Indeed, my bad that i didnt notice it. Its design is nice, but it is
&gt; buggy though, here is a simple test case:
&gt; ...
&gt; ReferenceError: The variable parent has not been declared at line 1.
</div>
Well, I seem to have forgotten the â€˜parentâ€™ variableâ€”obviously an important feature :-&#41;. Iâ€™ll 
try to get to it within the next few days.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; Another issue, it seems its impossible to click a standalone input
&gt; button:
</div>
I presume you mean one that is not inside a form.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;input type=&#34;button&#34; name=&#34;testbutton&#34; value=&#34;submit form in another
&gt; frame&#34;
&gt; 
</div>onClick=&#34;parent.frames[0].document.testform.changeme.value=&#39;lofasz&#39;;parent.frames[0].doc
ument.testform.submit&#40;&#41;;&#34;&gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; find_link/find_all_links/find_all_inputs/current_form&#40;&#41;-&gt;find_input
&gt; nothing can find it. As you can see it doesnt even have an id, and in
&gt; some real life situations, it doesnt even have a name.
</div>
This I believe is a Mech limitation. Iâ€™ll have to look at it and find a workaround.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Am i supposed to do something with evaled javacsript like?:
&gt; $mech-&gt;plugin&#40;&#39;JavaScript&#39;&#41;-
<div class="message-stanza open">&gt; &gt;eval&#40;&#34;document.getElementByTagName&#40;&#39;input&#39;&#41;[0].click&#40;&#41;;&#34;&#41;;
</div></div>
That will work &#40;as long as you add an â€˜sâ€™ to â€˜Elementâ€™&#41;, as will:

$mech-&gt;plugin&#40;&#34;DOM&#34;&#41;-&gt;tree-&gt;find&#40;&#39;input&#39;&#41;-&gt;click;

The latter should be faster.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573578" href="/Public/Bug/Display.html?id=43582#txn-573578">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;16:24:31&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/573578/289530/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289530">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 03 15:06:15 2009, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Feb 28 12:28:31 2009, radimre@freemail.hu wrote:
<div class="message-stanza open">&gt; &gt; Indeed, my bad that i didnt notice it. Its design is nice, but it is
&gt; &gt; buggy though, here is a simple test case:
&gt; &gt; ...
&gt; &gt; ReferenceError: The variable parent has not been declared at line 1.
</div>&gt; 
&gt; Well, I seem to have forgotten the â€˜parentâ€™ variableâ€”obviously an
&gt; important feature :-&#41;. Iâ€™ll
&gt; try to get to it within the next few days.
</div>
CPAN/authors/id/S/SP/SPROUT/WWW-Mechanize-Plugin-JavaScript-0.009a.tar.gz

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt;
&gt; &gt; Another issue, it seems its impossible to click a standalone input
&gt; &gt; button:
</div>&gt; 
&gt; I presume you mean one that is not inside a form.
&gt; 
<div class="message-stanza open">&gt; &gt; &lt;input type=&#34;button&#34; name=&#34;testbutton&#34; value=&#34;submit form in another
&gt; &gt; frame&#34;
&gt; &gt;
</div>&gt; 
</div>onClick=&#34;parent.frames[0].document.testform.changeme.value=&#39;lofasz&#39;;parent.frames[0].doc
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ument.testform.submit&#40;&#41;;&#34;&gt;
<div class="message-stanza open">&gt; &gt; find_link/find_all_links/find_all_inputs/current_form&#40;&#41;-&gt;find_input
&gt; &gt; nothing can find it. As you can see it doesnt even have an id, and
</div>&gt; in
<div class="message-stanza open">&gt; &gt; some real life situations, it doesnt even have a name.
</div>&gt; 
&gt; This I believe is a Mech limitation. Iâ€™ll have to look at it and find
&gt; a workaround.
&gt; 
</div>
The problem is that find_all_inputs looks in the currently selected form, and is documented 
that way.

Iâ€™ve been thinking of writing a subclass of Mech, called WWW::Scripter, so that Iâ€™ll have more 
freedom in designing the interface &#40;among other reasons&#41;. So we could have direct access to 
the DOM, like this:

$s = new WWW::Scripter;
...
$s-&gt;document-&gt;find&#40;&#39;input&#39;&#41;-&gt;click&#40;&#41;;

&#40;â€˜findâ€™ is a method inherited from HTML::Element, which is far more convenient that the W3C 
DOM equivalent.&#41;

That still doesnâ€™t directly address the issue you brought up. Do you have any ideas as to how 
the interface should work &#40;for accessing buttons&#41;?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574325" href="/Public/Bug/Display.html?id=43582#txn-574325">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;05:39:10&nbsp;2009</span>
    <span class="description">radimre [...] freemail.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43582] several mechanize + javascript bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 7 Mar 2009 11:38:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Father Chrysostomos via RT &lt;bug-WWW-Mechanize-Plugin-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Imre Rad &lt;radimre [...] freemail.hu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/574325/289987/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289987">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; CPAN/authors/id/S/SP/SPROUT/WWW-Mechanize-Plugin-JavaScript-0.009a.tar.gz
</div>
I upgraded to 0.009a &#40;and also JE to 0.31&#41; but the latest test about
the parent variable is still failing:
# perl teszt5.pl
ReferenceError: The variable parent has not been declared at line 1.

Also, the Dreamweavers image swapper function is still failing:
# perl teszt3.pl
ReferenceError: The variable Image has not been declared at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/">http://localhost/je/</a></span>
teszt2.htm, line 9.

Are you going to add support for Image objects to JE?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $s = new WWW::Scripter;
&gt; ...
</div>$s-&gt;&gt;document-&gt;find&#40;&#39;input&#39;&#41;-&gt;click&#40;&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;â€˜findâ€™ is a method inherited from HTML::Element, which is far more convenient that the W3C
&gt; DOM equivalent.&#41;
&gt; That still doesnâ€™t directly address the issue you brought up. Do you have any ideas as to how
&gt; the interface should work &#40;for accessing buttons&#41;?
</div>
Most of the websites are using standard forms only, which are
completly supported by WWW::Mechanize. There are some tricky ones,
like having an input button without form, or a simple pushme image
with on onClick event, and I think finding them using the DOM tree is
fine. I guess other users might ask you in the future adding support
for fireing onmouseover/onmouseout events.

best regards,
Imre Rad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-576448" href="/Public/Bug/Display.html?id=43582#txn-576448">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;16:26:30&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/576448/291225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/291225">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 07 05:39:10 2009, radimre@freemail.hu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
<div class="message-stanza open">&gt; &gt; CPAN/authors/id/S/SP/SPROUT/WWW-Mechanize-Plugin-JavaScript-
</div>&gt; 0.009a.tar.gz
&gt; 
&gt; I upgraded to 0.009a &#40;and also JE to 0.31&#41; but the latest test about
&gt; the parent variable is still failing:
&gt; # perl teszt5.pl
&gt; ReferenceError: The variable parent has not been declared at line 1.
</div>
Oops! I forgot to add it to the list of methods that JS can access. I have just uploaded a new 
version:

CPAN/authors/id/S/SP/SPROUT/WWW-Mechanize-Plugin-JavaScript-0.009c.tar.gz

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Also, the Dreamweavers image swapper function is still failing:
&gt; # perl teszt3.pl
&gt; ReferenceError: The variable Image has not been declared at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/">http://localhost/je/</a></span>
&gt; teszt2.htm, line 9.
&gt; 
&gt; Are you going to add support for Image objects to JE?
</div>
I plan to. Right now Iâ€™m not sure where it fits in with the rest of the modules, but for now 
you can use this workaround &#40;untested&#41;:

$mech-&gt;use_plugin&#40;&#39;JavaScript&#39; =&gt; init =&gt; sub { shift-&gt;eval&#40;&#39;
 function Image&#40;&#41; {
  var i = document.createElement&#40;&#34;img&#34;&#41;;
  0 in arguments &#38;&#38; i.setAttribute&#40;&#34;width&#34;,arguments[0]&#41;
  1 in arguments &#38;&#38; i.setAttribute&#40;&#34;height&#34;,arguments[1]&#41;
  return i
 }
&#39;&#41;; } &#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-583717" href="/Public/Bug/Display.html?id=43582#txn-583717">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;27&nbsp;08:02:40&nbsp;2009</span>
    <span class="description">radimre [...] freemail.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43582] several mechanize + javascript bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 27 Mar 2009 13:02:03 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Father Chrysostomos via RT &lt;bug-WWW-Mechanize-Plugin-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Imre Rad &lt;radimre [...] freemail.hu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/583717/295084/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/295084">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">hello, thanks for the fixes. Here is a next issue of 0.009c:

Error: Undefined subroutine &#38;WWW::Mechanize::Plugin::JavaScript::JE::_unescape called at C:/Perl/site/lib/JE/Object/Function.pm line 433.

it is caused by the default google analytics code:
&lt;script type=&#34;text/javascript&#34;&gt;
var gaJsHost = &#40;&#40;&#34;https:&#34; == document.location.protocol&#41; ? &#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://ssl">https://ssl</a></span>.&#34; : &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www">http://www</a></span>.&#34;&#41;; document.write&#40;unescape&#40;&#34;%3Cscript src=&#39;&#34; + gaJsHost + &#34;google-analytics.com/ga.js&#39; type=&#39;text/javascript&#39;%3E%3C/script%3E&#34;&#41;&#41;;
&lt;/script&gt;

I also got some other undefined subroutine issues, but i didnt trace
the source js:
Error: Undefined subroutine &#38;WWW::Mechanize::Plugin::JavaScript::JE::_encodeURIComponent called at C:/Perl/site/lib/JE/Object/Function.pm line 433.

best regards
imre rad


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43582">https://rt.cpan.org/Ticket/Display.html?id=43582</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Mar 07 05:39:10 2009, radimre@freemail.hu wrote:
<div class="message-stanza open">&gt;&gt; Hi,
&gt;&gt; 
<div class="message-stanza open">&gt;&gt; &gt; CPAN/authors/id/S/SP/SPROUT/WWW-Mechanize-Plugin-JavaScript-
</div>&gt;&gt; 0.009a.tar.gz
&gt;&gt; 
&gt;&gt; I upgraded to 0.009a &#40;and also JE to 0.31&#41; but the latest test about
&gt;&gt; the parent variable is still failing:
&gt;&gt; # perl teszt5.pl
&gt;&gt; ReferenceError: The variable parent has not been declared at line 1.
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oops! I forgot to add it to the list of methods that JS can access. I have just uploaded a new
&gt; version:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; CPAN/authors/id/S/SP/SPROUT/WWW-Mechanize-Plugin-JavaScript-0.009c.tar.gz
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; 
&gt;&gt; Also, the Dreamweavers image swapper function is still failing:
&gt;&gt; # perl teszt3.pl
&gt;&gt; ReferenceError: The variable Image has not been declared at
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/">http://localhost/je/</a></span>
&gt;&gt; teszt2.htm, line 9.
&gt;&gt; 
&gt;&gt; Are you going to add support for Image objects to JE?
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I plan to. Right now Iâ€™m not sure where it fits in with the rest of the modules, but for now
&gt; you can use this workaround &#40;untested&#41;:
</div>
$mech-&gt;&gt;use_plugin&#40;&#39;JavaScript&#39; =&gt; init =&gt; sub { shift-&gt;eval&#40;&#39;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  function Image&#40;&#41; {
&gt;   var i = document.createElement&#40;&#34;img&#34;&#41;;
&gt;   0 in arguments &#38;&#38; i.setAttribute&#40;&#34;width&#34;,arguments[0]&#41;
&gt;   1 in arguments &#38;&#38; i.setAttribute&#40;&#34;height&#34;,arguments[1]&#41;
&gt;   return i
&gt;  }
&gt; &#39;&#41;; } &#41;;
</div>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  _____________ NOD32 3925 &#40;20090311&#41; Inform?ci? _____________
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Az ?zenetet a NOD32 antivirus system megvizsg?lta.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nod32.hu">http://www.nod32.hu</a></span>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-584051" href="/Public/Bug/Display.html?id=43582#txn-584051">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;28&nbsp;14:22:41&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/584051/295301/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/295301">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 551b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 27 08:02:40 2009, radimre@freemail.hu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; hello, thanks for the fixes. Here is a next issue of 0.009c:
&gt; 
&gt; Error: Undefined subroutine
&gt;    &#38;WWW::Mechanize::Plugin::JavaScript::JE::_unescape called at
&gt;    C:/Perl/site/lib/JE/Object/Function.pm line 433.
&gt; 
</div>
Oh no, this is coming back to haunt me! I ran into this problem before, but I couldnâ€™t reproduce 
it the last time I tried. It has to do with what package â€˜requireâ€™ causes the code to run in. 
Different perl version behave differently.

Iâ€™ll try to fix this soon....
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-585567" href="/Public/Bug/Display.html?id=43582#txn-585567">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;01&nbsp;17:02:13&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/585567/296063/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/296063">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 28 14:22:41 2009, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Mar 27 08:02:40 2009, radimre@freemail.hu wrote:
<div class="message-stanza open">&gt; &gt; hello, thanks for the fixes. Here is a next issue of 0.009c:
&gt; &gt;
&gt; &gt; Error: Undefined subroutine
&gt; &gt;    &#38;WWW::Mechanize::Plugin::JavaScript::JE::_unescape called at
&gt; &gt;    C:/Perl/site/lib/JE/Object/Function.pm line 433.
&gt; &gt;
</div>&gt; 
&gt; Oh no, this is coming back to haunt me! I ran into this problem
&gt; before, but I couldnâ€™t reproduce
&gt; it the last time I tried. It has to do with what package â€˜requireâ€™
&gt; causes the code to run in.
&gt; Different perl version behave differently.
&gt; 
&gt; Iâ€™ll try to fix this soon....
</div>
CPAN/authors/id/S/SP/SPROUT/JE-0.032.tar.gz

Actually, this was a problem with subclassing &#40;and overriding the â€˜propâ€™ method, which the JE 
backend does&#41; and JEâ€™s autoload feature, which tries to run code in the â€˜calling packageâ€™. The 
calling package turned out to be the subclass, rather than the code calling the method to 
begin with.

What Iâ€™ve done to the escape functions is a workaround. Iâ€™ve also put a caveat in JE::Objectâ€™s 
docs. I donâ€™t have a clean solution for it right now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-586885" href="/Public/Bug/Display.html?id=43582#txn-586885">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;04&nbsp;08:40:32&nbsp;2009</span>
    <span class="description">radimre [...] freemail.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43582] several mechanize + javascript bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 4 Apr 2009 14:40:08 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Father Chrysostomos via RT &lt;bug-WWW-Mechanize-Plugin-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Imre Rad &lt;radimre [...] freemail.hu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/586885/296905/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/296905">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually, this was a problem with subclassing &#40;and overriding the â€˜propâ€™ method, which the JE
&gt; backend does&#41; and JEâ€™s autoload feature, which tries to run code in the â€˜calling packageâ€™. The
&gt; calling package turned out to be the subclass, rather than the code calling the method to
&gt; begin with.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What Iâ€™ve done to the escape functions is a workaround. Iâ€™ve also put a caveat in JE::Objectâ€™s
&gt; docs. I donâ€™t have a clean solution for it right now.
</div>

Nice work! I got an easy-to-fix bug this time, it seems you are trying
to parse LWP&#39;s error message if fetching the remote javascript code
fails:

couldn&#39;t get script <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>: 500 Can&#39;t connect to
www.google-analytics.com:80 &#40;connect: timeout&#41; at C:/Perl/site/lib/WWW/Mechanize
/Plugin/DOM.pm line 140
SyntaxError: Expected semicolon, &#39;}&#39; or end of line but found &#39; Can&#39;t con&#39; at ht
tp://www.google-analytics.com/ga.js, line 1.


I also got another real life shit, about comments again. The following
javascript snipplet with incorrect syntax is parsed by browsers, but
not by JE:
&lt;script type=&#34;text/javascript&#34;&gt;
var win2;
&lt;!--
function other&#40;&#41;
{
    window.alert&#40;&#34;foobar&#34;&#41;;
}
//--&gt;
&lt;/script&gt;

The error is:
SyntaxError: Expected statement or function declaration but found &#39;&lt;!--
func&#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt9.html">http://localhost/je/teszt9.html</a></span>, line 3.

It would be nice of you if your parser was a bit less strict in this
case, for eg you could turn this error into a warning and continue
parsing to make it more robust.


This time I also have a feature request:
it would be nice if one could filter the external &#40;not-embedded&#41;
javascripts to load, for example with a callback. So I could blacklist
google analytics, which drops some random errors, like

TypeError: undefined has no properties, not even one named length at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>, line 5.
Argument &#34;undefined&#34; isn&#39;t numeric in delete at C:/Perl/site/lib/WWW/Mechanize/Plugin/DOM/Window.pm line 106.

and some other times it works like a charm. Filtering out unneccessary
scripts would also make script faster.


WWW::Mechanize has a follow_link method. According to its docs:
&#34;Returns the result of the GET method &#40;an HTTP::Response object&#41; if a
link was found. If the page has no links, or the specified link
couldn&#39;t be found, returns undef.&#34;

If I call follow_link on a href=&#34;javascript:...&#34; link, it will return
undef, thou it executed the script correctly. Do you think you could
return a simple true value? Since most ppl use this method for
checking the existency of the link and clicking it in the same time
anyway... like this:
if&#40;!$mech-&gt;follow_link&#40;url_regex =&gt; qw/javascript:write.../&#41;&#41; {
   print STDERR &#34;Link not found!\n&#34;;
   exit;
}


The site i am trying to write the Mech script for, is using the stuff
called &#34;WICK: Web Input Completion Kit&#34;. It has the following
javascript lines at the end:

for &#40;x=0;x&lt;collection.length;x++&#41; {
collection[x] = collection[x].replace&#40;/\,/gi,&#39;&#39;&#41;;
}//

I have no idea what this collection is, but my firefox doesnt report
an error in its console unlike JE:
ReferenceError: The variable collection has not been declared at
<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/wick.js">http://localhost/je/wick.js</a></span>, line 483.


Thanks for all your help.


best regards
imre
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-586946" href="/Public/Bug/Display.html?id=43582#txn-586946">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;04&nbsp;13:01:07&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/586946/296934/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/296934">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 04 08:40:32 2009, radimre@freemail.hu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Actually, this was a problem with subclassing &#40;and overriding the
</div>&gt; â€˜propâ€™ method, which the JE
<div class="message-stanza open">&gt; &gt; backend does&#41; and JEâ€™s autoload feature, which tries to run code in
</div>&gt; the â€˜calling packageâ€™. The
<div class="message-stanza open">&gt; &gt; calling package turned out to be the subclass, rather than the code
</div>&gt; calling the method to
<div class="message-stanza open">&gt; &gt; begin with.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; What Iâ€™ve done to the escape functions is a workaround. Iâ€™ve also
</div>&gt; put a caveat in JE::Objectâ€™s
<div class="message-stanza open">&gt; &gt; docs. I donâ€™t have a clean solution for it right now.
</div>&gt; 
&gt; 
&gt; Nice work! I got an easy-to-fix bug this time, it seems you are trying
&gt; to parse LWP&#39;s error message if fetching the remote javascript code
&gt; fails:
&gt; 
&gt; couldn&#39;t get script <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>: 500 Can&#39;t
&gt; connect to
&gt; www.google-analytics.com:80 &#40;connect: timeout&#41; at
&gt; C:/Perl/site/lib/WWW/Mechanize
&gt; /Plugin/DOM.pm line 140
</div>
Thatâ€™s a Windows file path. I didnâ€™t know JE worked on Windows.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; SyntaxError: Expected semicolon, &#39;}&#39; or end of line but found &#39; Can&#39;t
&gt; con&#39; at ht
&gt; tp://www.google-analytics.com/ga.js, line 1.
</div>
What do real browsers do in such cases?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I also got another real life shit, about comments again. The following
&gt; javascript snipplet with incorrect syntax is parsed by browsers, but
&gt; not by JE:
&gt; &lt;script type=&#34;text/javascript&#34;&gt;
&gt; var win2;
&gt; &lt;!--
&gt; function other&#40;&#41;
&gt; {
&gt;     window.alert&#40;&#34;foobar&#34;&#41;;
&gt; }
&gt; //--&gt;
&gt; &lt;/script&gt;
&gt; 
&gt; The error is:
&gt; SyntaxError: Expected statement or function declaration but found
&gt; &#39;&lt;!--
&gt; func&#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt9.html">http://localhost/je/teszt9.html</a></span>, line 3.
&gt; 
&gt; It would be nice of you if your parser was a bit less strict in this
&gt; case, for eg you could turn this error into a warning and continue
&gt; parsing to make it more robust.
</div>
This is going to be a tough one, but Iâ€™m willing to tackle it. It is difficult becauseÂ â€˜x &lt;!-- yâ€™ is 
perfectly valid, as is â€˜x --&gt; yâ€™, so itâ€™s hard to filter them out. Unfortunately, ECMA provides 
no guidelines in this regard.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; This time I also have a feature request:
&gt; it would be nice if one could filter the external &#40;not-embedded&#41;
&gt; javascripts to load, for example with a callback. So I could blacklist
&gt; google analytics, which drops some random errors, like
&gt; 
&gt; TypeError: undefined has no properties, not even one named length at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>, line 5.
&gt; Argument &#34;undefined&#34; isn&#39;t numeric in delete at
&gt; C:/Perl/site/lib/WWW/Mechanize/Plugin/DOM/Window.pm line 106.
&gt; 
&gt; and some other times it works like a charm. Filtering out unneccessary
&gt; scripts would also make script faster.
</div>
I think you can already use LWP handlers &#40;untested&#41;:

$mech-&gt;set_my_handler&#40;
Â Â Â Â request_send =&gt; sub { return new HTTP::Response 200 &#41; },
Â Â Â Â m_host =&gt; &#39;www.google-analytics.com&#39;
&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; WWW::Mechanize has a follow_link method. According to its docs:
&gt; &#34;Returns the result of the GET method &#40;an HTTP::Response object&#41; if a
&gt; link was found. If the page has no links, or the specified link
&gt; couldn&#39;t be found, returns undef.&#34;
&gt; 
&gt; If I call follow_link on a href=&#34;javascript:...&#34; link, it will return
&gt; undef, thou it executed the script correctly. Do you think you could
&gt; return a simple true value? Since most ppl use this method for
&gt; checking the existency of the link and clicking it in the same time
&gt; anyway... like this:
&gt; if&#40;!$mech-&gt;follow_link&#40;url_regex =&gt; qw/javascript:write.../&#41;&#41; {
&gt;    print STDERR &#34;Link not found!\n&#34;;
&gt;    exit;
&gt; }
</div>
I really would like to deprecate this experimental Mechanize and its plugins. Right now Iâ€™m 
working on getting WWW::Scripter &#40;the replacement&#41; to pass the tests. I hope to have it done 
in a few days. Iâ€™ll make WWW::Scripter work like that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The site i am trying to write the Mech script for, is using the stuff
&gt; called &#34;WICK: Web Input Completion Kit&#34;. It has the following
&gt; javascript lines at the end:
&gt; 
&gt; for &#40;x=0;x&lt;collection.length;x++&#41; {
&gt; collection[x] = collection[x].replace&#40;/\,/gi,&#39;&#39;&#41;;
&gt; }//
&gt; 
&gt; I have no idea what this collection is, but my firefox doesnt report
&gt; an error in its console unlike JE:
&gt; ReferenceError: The variable collection has not been declared at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/wick.js">http://localhost/je/wick.js</a></span>, line 483.
</div>
Iâ€™m afraid Iâ€™m clueless about this one.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587072" href="/Public/Bug/Display.html?id=43582#txn-587072">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;04&nbsp;22:57:49&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/587072/297008/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297008">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 04 13:01:07 2009, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Apr 04 08:40:32 2009, radimre@freemail.hu wrote:
<div class="message-stanza open">&gt; &gt; I also got another real life [...], about comments again. The
</div>&gt; following
<div class="message-stanza open">&gt; &gt; javascript snipplet with incorrect syntax is parsed by browsers, but
&gt; &gt; not by JE:
&gt; &gt; &lt;script type=&#34;text/javascript&#34;&gt;
&gt; &gt; var win2;
&gt; &gt; &lt;!--
&gt; &gt; function other&#40;&#41;
&gt; &gt; {
&gt; &gt;     window.alert&#40;&#34;foobar&#34;&#41;;
&gt; &gt; }
&gt; &gt; //--&gt;
&gt; &gt; &lt;/script&gt;
&gt; &gt;
&gt; &gt; The error is:
&gt; &gt; SyntaxError: Expected statement or function declaration but found
&gt; &gt; &#39;&lt;!--
&gt; &gt; func&#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost/je/teszt9.html">http://localhost/je/teszt9.html</a></span>, line 3.
&gt; &gt;
&gt; &gt; It would be nice of you if your parser was a bit less strict in this
&gt; &gt; case, for eg you could turn this error into a warning and continue
&gt; &gt; parsing to make it more robust.
</div>&gt; 
&gt; This is going to be a tough one, but Iâ€™m willing to tackle it. It is
&gt; difficult becauseÂ â€˜x &lt;!-- yâ€™ is
&gt; perfectly valid, as is â€˜x --&gt; yâ€™, so itâ€™s hard to filter them out.
&gt; Unfortunately, ECMA provides
&gt; no guidelines in this regard.
</div>
OK, I tried the following snippet in a couple of browsers and they both show 0 when they 
should be showing â€˜trueâ€™:

&lt;script&gt;
a = 0; b = 1
c = a&lt;!--b
document.write&#40;c&#41;
&lt;/script&gt;

That means they are not standards-compliant. In your case, the script should definitely be 
fixed. If that is not possible, I suggest a workaround:

$mech-&gt;set_my_handler&#40;
    response_done =&gt; sub {
        my $response = shift;
        ${ $response-&gt;content_ref } =~ s/&lt;!--|--&gt;//g;
    },
    m_path_match =&gt; qr/\.js\z/
&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587097" href="/Public/Bug/Display.html?id=43582#txn-587097">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;06:03:41&nbsp;2009</span>
    <span class="description">radimre [...] freemail.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43582] several mechanize + javascript bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 5 Apr 2009 12:03:08 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Father Chrysostomos via RT &lt;bug-WWW-Mechanize-Plugin-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Imre Rad &lt;radimre [...] freemail.hu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/587097/297020/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297020">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; couldn&#39;t get script <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>: 500 Can&#39;t
&gt;&gt; connect to
&gt;&gt; www.google-analytics.com:80 &#40;connect: timeout&#41; at
&gt;&gt; C:/Perl/site/lib/WWW/Mechanize
&gt;&gt; /Plugin/DOM.pm line 140
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thatâ€™s a Windows file path. I didnâ€™t know JE worked on Windows.
</div>
Yes it is, and yes it does. Installing it is not even painful.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; SyntaxError: Expected semicolon, &#39;}&#39; or end of line but found &#39; Can&#39;t
&gt;&gt; con&#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>, line 1.
</div>&gt; What do real browsers do in such cases?
</div>
I think its nothing what they can do, shit happens, some files can not
be loaded some times.
I recommend checking the response code, if its not 200, then fire a
Warning message and skip parsing the error text :&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; for &#40;x=0;x&lt;collection.length;x++&#41; {
&gt;&gt; collection[x] = collection[x].replace&#40;/\,/gi,&#39;&#39;&#41;;
&gt;&gt; }//
</div>&gt; Iâ€™m afraid Iâ€™m clueless about this one.
</div>
You are right, I hurried off reporting this one, it seems situation is
more complex, I need some further investigation.


The site I am trying to script has one of its javascript codes
obfuscated, I guess by a commercial one. It would be nice if you could
take a look at the code, since your JE engine interprets its completly
wrong. I changed the eval&#40;$&#41; at the end to window.alert, so I can see
a correct javascript code in the browser, while JE output is something
really weird:
justifycenter border=&#34;0&#34; cellpadding=&#34;0&#34; cellspac
src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;isRichText= border=&#34;0&#34;
cellpadding=&#34;0&#34; cellspac
src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;f border=&#34;0&#34;
cellpadding=&#34;0&#34; cellspac
src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;a border=&#34;0&#34;
cellpadding=&#34;0&#34; cellspac
src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;l border=&#34;0&#34;
cellpadding=&#34;0&#34; cellspac src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/        

I think traceing this down might make JE more robust. If you want to
deal with this, I send you the script.



best regards,
Imre
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587337" href="/Public/Bug/Display.html?id=43582#txn-587337">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;20:45:48&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/587337/297196/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297196">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Iâ€™ve gone and released WWW::Scripter very hastily:

CPAN/authors/id/S/SP/SPROUT/WWW-Scripter-0.001.tar.gz
CPAN/authors/id/S/SP/SPROUT/WWW-Scripter-Plugin-JavaScript-0.001.tar.gz
CPAN/authors/id/S/SP/SPROUT/WWW-Scripter-Plugin-Ajax-0.01.tar.gz

Concerning the Image object, your request regarding follow_link, and the parsing of error 
responses as scripts, these are supposedly fixed in WWW::Scripter. Iâ€™ve not tested them yet.

Concerning triggering mouse events upon click&#40;&#41;, there are too many variations as to how it 
could be done. Iâ€™ll leave it to the user to call trigger_event himself in whichever order he 
prefers. &#40;Also, I use mouse events to evade robots.&#41;

I am going to mark this ticket as resolved. I also plan to release a new WMPJS with 
deprecation notices all over the place. &#40;WWW::Scripter is *so* much cleaner than the tangled 
mess Iâ€™ve created with Mechanize!&#41;

Please switch over to Scripter and see whether it works for you.

On Sun Apr 05 06:03:41 2009, radimre@freemail.hu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; couldn&#39;t get script <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>: 500 Can&#39;t
&gt; &gt;&gt; connect to
&gt; &gt;&gt; www.google-analytics.com:80 &#40;connect: timeout&#41; at
&gt; &gt;&gt; C:/Perl/site/lib/WWW/Mechanize
&gt; &gt;&gt; /Plugin/DOM.pm line 140
</div></div>&gt; 
<div class="message-stanza open">&gt; &gt; Thatâ€™s a Windows file path. I didnâ€™t know JE worked on Windows.
</div>&gt; 
&gt; Yes it is, and yes it does. Installing it is not even painful.
</div>
Iâ€™m not so sure thatâ€™s a good thing to here. Iâ€™m always looking for every excuse to get people 
to stop using Windoze. :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; SyntaxError: Expected semicolon, &#39;}&#39; or end of line but found &#39; Can&#39;t
&gt; &gt;&gt; con&#39; at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.google-analytics.com/ga.js">http://www.google-analytics.com/ga.js</a></span>, line 1.
</div>&gt; &gt; What do real browsers do in such cases?
</div>&gt; 
&gt; I think its nothing what they can do, shit happens, some files can not
&gt; be loaded some times.
&gt; I recommend checking the response code, if its not 200, then fire a
&gt; Warning message and skip parsing the error text :&#41;
</div>
I checked Safari. It adds a warning to the console and then pretends the file is empty, which 
is more or less equivalent to what you suggest.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; for &#40;x=0;x&lt;collection.length;x++&#41; {
&gt; &gt;&gt; collection[x] = collection[x].replace&#40;/\,/gi,&#39;&#39;&#41;;
&gt; &gt;&gt; }//
</div>&gt; &gt; Iâ€™m afraid Iâ€™m clueless about this one.
</div>&gt; 
&gt; You are right, I hurried off reporting this one, it seems situation is
&gt; more complex, I need some further investigation.
&gt; 
&gt; 
&gt; The site I am trying to script has one of its javascript codes
&gt; obfuscated, I guess by a commercial one. It would be nice if you could
&gt; take a look at the code, since your JE engine interprets its completly
&gt; wrong. I changed the eval&#40;$&#41; at the end to window.alert, so I can see
&gt; a correct javascript code in the browser, while JE output is something
&gt; really weird:
&gt; justifycenter border=&#34;0&#34; cellpadding=&#34;0&#34; cellspac
&gt; src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;isRichText= border=&#34;0&#34;
&gt; cellpadding=&#34;0&#34; cellspac
&gt; src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;f border=&#34;0&#34;
&gt; cellpadding=&#34;0&#34; cellspac
&gt; src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;a border=&#34;0&#34;
&gt; cellpadding=&#34;0&#34; cellspac
&gt; src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/td&gt;&#39;;strx+=&#39;&lt;l border=&#34;0&#34;
&gt; cellpadding=&#34;0&#34; cellspac src=&#34;images/content/corner_lt=&#34;&#34;&gt;&lt;/        
&gt; 
&gt; I think traceing this down might make JE more robust. If you want to
&gt; deal with this, I send you the script.
</div>
I really donâ€™t think Iâ€™ll have time to sift through obfuscated code. I was only able to release 
WWW::Scripter because I need it for a project Iâ€™m working on &#40;part of real life&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587339" href="/Public/Bug/Display.html?id=43582#txn-587339">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;20:45:50&nbsp;2009</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.797453</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
