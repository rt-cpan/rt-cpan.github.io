<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53759 for Config-General: Single-value arrays not properly converted from data structure to config syntax to data structure</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53759 for Config-General: Single-value arrays not properly converted from data structure to config syntax to data structure</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Config-General">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Config-General">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Config-General">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Config-General">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Config-General">Config-General CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53759</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Config-General">Config-General</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">tlinden [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
STOCKS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-7696-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.44    </td>
  </tr>
  <tr id="CF-7697-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




force-array-2.46.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/759979/393052/force-array-2.46.patch">
Thu Apr 08 06:32:26 2010 (6.2k) by tlinden [...] cpan.org
</a>
</font></li>
</ul>


single_value_array.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/720950/372259/single_value_array.t">
Sun Jan 17 00:04:49 2010 (622b) by STOCKS [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=53759">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-720950" href="/Public/Bug/Display.html?id=53759#txn-720950">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;17&nbsp;00:04:49&nbsp;2010</span>
    <span class="description">STOCKS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Single-value arrays not properly converted from data structure to
 config syntax to data structure</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/720950/372258/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/372258">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">If we start out with some data structure that contains a single-value 
array:

    { something =&gt; [ &#39;singlearrayvalue&#39; ] }

Then convert this to a Config::General string using save_string&#40;&#41;

    something    singlearrayvalue

And then convert back to data structure using -String we will get:

    { something =&gt; &#39;singlearrayvalue&#39; }

The single array value is converted to a Scalar.

The key issue here appears to be that there is no way to specify a 
single value array in the Config::General syntax, or if there is, it is 
not documented and does not convert back properly using save_string&#40;&#41;. I 
have attached a test file to exemplify the issue.

I am using Config::General syntax to store configuration for some 
modules. Some of these modules require options to be passed in as an 
arrayref, even if there is only one configuration option. For example:  
Cache::Memcached::Fast-&gt;new&#40;{ servers =&gt; [ &#39;127.0.0.1:11211&#39; ] }&#41;.

It appears the -DefaultConfig option can be used to work around this 
issue but it seems like somewhat of a hack which _could_ cause issues in 
the future.

I&#39;m not sure the best way to solve this problem, but it appears 
something like the following would work:

&lt;block&gt;
  hashkey     [ &#39;singlevaluearray&#39; ]
&lt;/block&gt;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> single_value_array.t</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/720950/372259/single_value_array.t">Download single_value_array.t</a><br />
<span class="downloadcontenttype">text/x-perl 622b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl 

use strict;
use warnings;
use Config::General;
use Data::Dumper;
use Test::More tests =&gt; 1;
use Test::Deep;

my $conf = Config::General-&gt;new;

my $orig_data_struct = {
    block =&gt; { hashkey =&gt; [ &#39;singlearrayvalue&#39; ], },
};

# Convert data structure to config syntax string
my $config_string = $conf-&gt;save_string&#40;$orig_data_struct&#41;;

# Convert config syntax string back to data structure
my $new_data_struct = 
   { Config::General-&gt;new&#40; -String =&gt; $config_string &#41;-&gt;getall };

is_deeply&#40; $orig_data_struct, $new_data_struct,
    &#39;Convert single array value from data struct to config and back works&#39; &#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-756407" href="/Public/Bug/Display.html?id=53759#txn-756407">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;31&nbsp;07:14:56&nbsp;2010</span>
    <span class="description">tlinden [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-756408" href="/Public/Bug/Display.html?id=53759#txn-756408">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;31&nbsp;07:17:00&nbsp;2010</span>
    <span class="description">tlinden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/756408/391118/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/391118">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 270b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t think this is a good idea. If I need such a feature &#40;which is
often the case&#41;, I do it this way:

hosts = alba, codey, spock, lucile

and use split&#40;&#41; in my code to get an array from this. Also this looks
more like a list to the user who may edit the config file.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-756410" href="/Public/Bug/Display.html?id=53759#txn-756410">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;31&nbsp;07:17:04&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-758894" href="/Public/Bug/Display.html?id=53759#txn-758894">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;06&nbsp;04:08:55&nbsp;2010</span>
    <span class="description">tlinden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/758894/392463/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/392463">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 172b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Case closed. Btw this could even break existing code if implemented this
way, e.g. someone using [] in their config would get an array instead of
the expected scalar. Nope.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-758896" href="/Public/Bug/Display.html?id=53759#txn-758896">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;06&nbsp;04:08:56&nbsp;2010</span>
    <span class="description">tlinden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-759706" href="/Public/Bug/Display.html?id=53759#txn-759706">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;07&nbsp;17:52:54&nbsp;2010</span>
    <span class="description">robert.stockdale [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53759] Single-value arrays not properly converted  from data structure to config syntax to data structure</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Apr 2010 17:52:19 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-General [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Stockdale &lt;robert.stockdale [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/759706/392896/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/392896">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 879b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Right, so as I mentioned in my original post this probably wasn&#39;t the best
solution, but I was just trying to get some discussion started...

It seems kind of broken that the conversion methods produce different output
than the source if you convert back. A POD update to note this caveat would
be nice at the very least.

Lastly, your workaround sounds OK, but I&#39;m not a huge fan of copying and
pasting code every time I need to do this. I was hoping there might be some
elegant solution here...

On Tue, Apr 6, 2010 at 4:08 AM, T. Linden via RT &lt;
bug-Config-General@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53759">https://rt.cpan.org/Ticket/Display.html?id=53759</a></span> &gt;
&gt;
&gt; Case closed. Btw this could even break existing code if implemented this
&gt; way, e.g. someone using [] in their config would get an array instead of
&gt; the expected scalar. Nope.
&gt;
</div>


-- 
Bob Stockdale
robert.stockdale@gmail.com
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/759706/392897/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/392897">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-759709" href="/Public/Bug/Display.html?id=53759#txn-759709">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;07&nbsp;17:52:56&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-759979" href="/Public/Bug/Display.html?id=53759#txn-759979">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;08&nbsp;06:32:26&nbsp;2010</span>
    <span class="description">tlinden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/759979/393051/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/393051">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 167b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, I see your point. What if we add a parameter which controls such a
feature? I added such an option &#40;using the [] scheme&#41;. Check out the
attached patch &#40;to 2.46&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> force-array-2.46.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/759979/393052/force-array-2.46.patch">Download force-array-2.46.patch</a><br />
<span class="downloadcontenttype">text/x-diff 6.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rc Config-General-2.46/Changelog Config-General-2.47/Changelog
*** Config-General-2.46/Changelog	Thu Apr  8 11:24:22 2010
--- Config-General-2.47/Changelog	Thu Apr  8 12:28:34 2010
***************
*** 1,3 ****
--- 1,8 ----
+ 2.47
+ 	- fixed rt.cpan.org#53759 by adding new option -ForceArray.
+ 	  when enabled a single config value enclosed in [] will become
+ 	  an array forcefully.
+ 
  2.46
  	- fixed rt.cpan.org#56370: there was a sort&#40;&#41; call in _store&#40;&#41;
  	  left, which lead to sorted arrays even if -SaveSorted were
diff -rc Config-General-2.46/General.pm Config-General-2.47/General.pm
*** Config-General-2.46/General.pm	Thu Apr  8 11:20:51 2010
--- Config-General-2.47/General.pm	Thu Apr  8 12:23:52 2010
***************
*** 32,38 ****
  use Carp;
  use Exporter;
  
! $Config::General::VERSION = 2.46;
  
  use vars  qw&#40;@ISA @EXPORT_OK&#41;;
  use base qw&#40;Exporter&#41;;
--- 32,38 ----
  use Carp;
  use Exporter;
  
! $Config::General::VERSION = 2.47;
  
  use vars  qw&#40;@ISA @EXPORT_OK&#41;;
  use base qw&#40;Exporter&#41;;
***************
*** 86,92 ****
  	      parsed                =&gt; 0,       # internal state stuff for variable interpolation
  	      files                 =&gt; {},      # which files we have read, if any
  	      UTF8                  =&gt; 0,
! 	      SaveSorted            =&gt; 0
  	     };
  
    # create the class instance
--- 86,93 ----
  	      parsed                =&gt; 0,       # internal state stuff for variable interpolation
  	      files                 =&gt; {},      # which files we have read, if any
  	      UTF8                  =&gt; 0,
! 	      SaveSorted            =&gt; 0,
!               ForceArray            =&gt; 0        # force single value array if value enclosed in []
  	     };
  
    # create the class instance
***************
*** 864,876 ****
  	  }
  	}
  	else {
! 	  # standard config option, insert key/value pair into node
! 	  $config-&gt;{$option} = $this-&gt;_parse_value&#40;$config, $option, $value&#41;;
  
! 	  if &#40;$this-&gt;{InterPolateVars}&#41; {
! 	    # save pair on local stack
! 	    $config-&gt;{__stack}-&gt;{$option} = $config-&gt;{$option};
! 	  }
  	}
        }
      }
--- 865,883 ----
  	  }
  	}
  	else {
!           if&#40;$this-&gt;{ForceArray} &#38;&#38; $value =~ /^\[\s*&#40;.+?&#41;\s*\]$/&#41; {
!             # force single value array entry
!             push @{$config-&gt;{$option}}, $this-&gt;_parse_value&#40;$config, $option, $1&#41;;
!           }
!           else {
! 	    # standard config option, insert key/value pair into node
! 	    $config-&gt;{$option} = $this-&gt;_parse_value&#40;$config, $option, $value&#41;;
  
! 	    if &#40;$this-&gt;{InterPolateVars}&#41; {
! 	      # save pair on local stack
! 	      $config-&gt;{__stack}-&gt;{$option} = $config-&gt;{$option};
! 	    }
!           }
  	}
        }
      }
***************
*** 1201,1212 ****
  
    foreach my $entry &#40; $this-&gt;{SaveSorted} ? sort keys %$config : keys %$config &#41; {
      if &#40;ref&#40;$config-&gt;{$entry}&#41; eq &#39;ARRAY&#39;&#41; {
!       foreach my $line &#40; $this-&gt;{SaveSorted} ? sort @{$config-&gt;{$entry}} : @{$config-&gt;{$entry}} &#41; {
!         if &#40;ref&#40;$line&#41; eq &#39;HASH&#39;&#41; {
!           $config_string .= $this-&gt;_write_hash&#40;$level, $entry, $line&#41;;
!         }
!         else {
!           $config_string .= $this-&gt;_write_scalar&#40;$level, $entry, $line&#41;;
          }
        }
      }
--- 1208,1225 ----
  
    foreach my $entry &#40; $this-&gt;{SaveSorted} ? sort keys %$config : keys %$config &#41; {
      if &#40;ref&#40;$config-&gt;{$entry}&#41; eq &#39;ARRAY&#39;&#41; {
!       if&#40; $this-&gt;{ForceArray} &#38;&#38; scalar @{$config-&gt;{$entry}} == 1 &#38;&#38; ! ref&#40;$config-&gt;{$entry}-&gt;[0]&#41; &#41; {
!         # a single value array forced to stay as array
!         $config_string .= $this-&gt;_write_scalar&#40;$level, $entry, &#39;[&#39; . $config-&gt;{$entry}-&gt;[0] . &#39;]&#39;&#41;;
!       }
!       else {
!         foreach my $line &#40; $this-&gt;{SaveSorted} ? sort @{$config-&gt;{$entry}} : @{$config-&gt;{$entry}} &#41; {
!           if &#40;ref&#40;$line&#41; eq &#39;HASH&#39;&#41; {
!             $config_string .= $this-&gt;_write_hash&#40;$level, $entry, $line&#41;;
!           }
!           else {
!             $config_string .= $this-&gt;_write_scalar&#40;$level, $entry, $line&#41;;
!           }
          }
        }
      }
***************
*** 2154,2160 ****
  
  
  
! =head1 IDENTICAL OPTIONS
  
  You may have more than one line of the same option with different values.
  
--- 2167,2173 ----
  
  
  
! =head1 IDENTICAL OPTIONS &#40;ARRAYS&#41;
  
  You may have more than one line of the same option with different values.
  
***************
*** 2229,2235 ****
--- 2242,2257 ----
  If turned off, Config::General will complain about multiple occurring options
  with identical names!
  
+ =head2 FORCE SINGLE VALUE ARRAYS
+ 
+ You may also force a single config line to get parsed into an array by
+ turning on the option B&lt;-ForceArray&gt; on and by surrounding the value of the
+ config entry by []. Example:
+ 
+  hostlist = [ foo.bar ]
  
+ Will be a singlevalue array entry if the option is turned on. If you want
+ it to remain to be an array you have to turn on B&lt;-ForceArray&gt; suring save too.
  
  =head1 LONG LINES
  
***************
*** 2510,2516 ****
  
  =head1 VERSION
  
! 2.46
  
  =cut
  
--- 2532,2538 ----
  
  =head1 VERSION
  
! 2.47
  
  =cut
  
diff -rc Config-General-2.46/t/run.t Config-General-2.47/t/run.t
*** Config-General-2.46/t/run.t	Thu Apr  8 11:23:14 2010
--- Config-General-2.47/t/run.t	Thu Apr  8 12:27:19 2010
***************
*** 8,14 ****
  
  
  use Data::Dumper;
! use Test::More tests =&gt; 61;
  #use Test::More qw&#40;no_plan&#41;;
  
  # ahem, we deliver the test code with a local copy of
--- 8,14 ----
  
  
  use Data::Dumper;
! use Test::More tests =&gt; 63;
  #use Test::More qw&#40;no_plan&#41;;
  
  # ahem, we deliver the test code with a local copy of
***************
*** 702,704 ****
--- 702,715 ----
  $cfg51  =  new Config::General&#40; -ConfigFile =&gt; &#34;t/cfg.51.out&#34;, -InterPolateVars =&gt; 1 &#41;;
  my %hash51new = $cfg51-&gt;getall&#40;&#41;;
  is_deeply&#40;\%hash51, \%hash51new, &#34;compare saved config containing escaped chars&#34;&#41;;
+ 
+ 
+ # check if forced single value arrays remain
+ my $cfg52  = new Config::General&#40; -String =&gt; &#34;habeas = [ corpus ]&#34;, -ForceArray =&gt; 1&#41;;
+ my %hash52 = $cfg52-&gt;getall&#40;&#41;;
+ my @array52 = qw&#40;corpus&#41;;
+ is_deeply&#40;$hash52{habeas}, \@array52, &#34;check -ForceArray single value arrays&#34;&#41;;
+ $cfg52-&gt;save_file&#40;&#34;t/cfg.52.out&#34;&#41;;
+ $cfg52 = new Config::General&#40; -ConfigFile =&gt; &#34;t/cfg.52.out&#34;, -ForceArray =&gt; 1&#41;;
+ my %hash52new = $cfg52-&gt;getall&#40;&#41;;
+ is_deeply&#40;\%hash52new, \%hash52, &#34;check -ForceArray single value arrays during save&#40;&#41;&#34;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-760327" href="/Public/Bug/Display.html?id=53759#txn-760327">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;08&nbsp;20:22:07&nbsp;2010</span>
    <span class="description">robert.stockdale [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53759] Single-value arrays not properly converted  from data structure to config syntax to data structure</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 Apr 2010 20:21:50 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-General [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Stockdale &lt;robert.stockdale [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/760327/393239/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/393239">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 855b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This looks great! It will definitely solve my issue and it will also not
break any existing code so it looks like a win all around.

I did notice a few small typos in the pod:

&#34;...into an array by turning on the option B&lt;-ForceArray&gt; on...&#34;

    - too many &#39;on&#39;s

&#34;...remain to be an array you have to turn on B&lt;-ForceArray&gt; suring save
too.&#34;

    - suring -&gt; during

Other than that it looks great! Thanks so much!

Any idea when I can expect a release?

Thanks again,
-Bob



On Thu, Apr 8, 2010 at 6:32 AM, T. Linden via RT &lt;
bug-Config-General@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53759">https://rt.cpan.org/Ticket/Display.html?id=53759</a></span> &gt;
&gt;
&gt; Well, I see your point. What if we add a parameter which controls such a
&gt; feature? I added such an option &#40;using the [] scheme&#41;. Check out the
&gt; attached patch &#40;to 2.46&#41;.
&gt;
</div>


-- 
Bob Stockdale
robert.stockdale@gmail.com
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/760327/393240/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/393240">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-760589" href="/Public/Bug/Display.html?id=53759#txn-760589">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;09&nbsp;09:44:45&nbsp;2010</span>
    <span class="description">tlinden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/760589/393378/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/393378">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 29b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, added it to version 2.48.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-760591" href="/Public/Bug/Display.html?id=53759#txn-760591">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;09&nbsp;09:44:47&nbsp;2010</span>
    <span class="description">tlinden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.522958</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
