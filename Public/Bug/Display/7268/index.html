<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #7268 for WWW-Mechanize: grep_inputs&#40;&#41; and grep_submits&#40;&#41; methods</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #7268 for WWW-Mechanize: grep_inputs&#40;&#41; and grep_submits&#40;&#41; methods</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/WWW-Mechanize/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/libwww-perl/WWW-Mechanize/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-Mechanize">WWW-Mechanize CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">7268</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">deleted</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/WWW-Mechanize/Active/">WWW-Mechanize</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
moregan [...] flr.follett.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-36214-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36215-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;05&nbsp;17:51:29&nbsp;2004</span>
    <span class="description">moregan [...] flr.follett.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> grep_inputs&#40;&#41; and grep_submits&#40;&#41; methods</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-www-mechanize [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> moregan [...] flr.follett.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Aug 2004 16:00:34 -0500</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">



Ideas for consideration, two methods:  grep_inputs&#40;&#41; and grep_submits&#40;&#41;.
I&#39;m not certain at the moment whether they would fit better in
WWW::Mechanize or in a new WWW::Mechanize::Form class.  They really are
form methods rather than agent methods.  &#40;Ditto for submits&#40;&#41; below,
trivially derived from grep_inputs.&#41;  If this progresses past the idea
stage then we can talk about getting some tests written.

Mike O&#39;Regan


=head2 grep_inputs&#40; %$properties &#41;
=head2 grep_submits&#40; %$properties &#41;

grep_inputs&#40;&#41; returns an array of all the input controls in the
current form whose properties match all of the regexes in $properties.
The controls returned are all descended from HTML::Form::Input.

If $properties is undef or empty then all inputs will be
returned.

If there is no current page, there is no form on the current
page, or there are no submit controls in the current form
then the return will be an empty array.

    # get all text controls whose names begin with &#34;customer&#34;
    my @customer_text_inputs =
        $mech-&gt;grep_inputs&#40; {
            type =&gt; qr/^&#40;text|textedit&#41;$/
            name =&gt; qr/^customer/
        }
    &#41;;

grep_submits&#40;&#41; does the same thing as grep_inputs&#40;&#41; except that
it only returns controls that are submit controls, ignoring
other types of input controls like text and checkboxes.

=cut

sub grep_inputs {
    my $self = shift;
    my $properties = shift;

    my @found;

    my $form = $self-&gt;current_form&#40;&#41;;
    if &#40; $form &#41; {
        my @inputs = $form-&gt;inputs&#40;&#41;;
        @found = _grep_hashes&#40; \@inputs, $properties &#41;;
    }

    return @found;
}

sub grep_submits {
    my $self = shift;
    my $properties = shift || {};

    $properties-&gt;{type} = qr/^&#40;submit|image&#41;$/;  # submits only
    my @found = $self-&gt;grep_inputs&#40; $properties &#41;;

    return @found;
}

#
# search an array of hashrefs, returning an array of the incoming
# hashrefs that match *all* the pattern in $patterns.
sub _grep_hashes {
    my $hashes = shift;
    my $patterns = shift || {};

    my @found;

    if &#40; ! %$patterns &#41; {
        # nothing to match on, so return them all
        @found = @$hashes;
    }
    else {
        foreach my $hash &#40; @$hashes &#41; {

            # check every pattern for a match on the current hash
            my $matchesEverything = 1;
            foreach my $patternKey &#40; keys %$patterns &#41; {
                $matchesEverything = 0 unless exists $hash-&gt;{$patternKey}
&#38;&#38; $hash-&gt;{$patternKey} =~ $patterns-&gt;{$patternKey};
                last if !$matchesEverything;
            }

            push @found, $hash if $matchesEverything;
        }
    }

    return @found;
}



=head2 submits&#40;&#41;

my @submit_buttons = $mech-&gt;submits&#40;&#41;;

Returns an array of all the submit controls in the current form.
Submit controls are of type &#39;submit&#39; and &#39;image&#39;.  The controls
are all descended from HTML::Form::Input.

If there is no current page, there is no form on the current
page, or there are no submit controls in the current form
then the return will be an empty array.

=cut

sub submits {
    my $self = shift;

    my @found;

    my $form = $self-&gt;current_form&#40;&#41;;
    if &#40; $form &#41; {
        my @inputs = $form-&gt;inputs&#40;&#41;;
        @found = $self-&gt;grep_inputs&#40; { type =&gt; qr/^&#40;submit|image&#41;$/ } &#41;;  #
submits only
    }

    return @found;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;20&nbsp;23:29:10&nbsp;2004</span>
    <span class="description">MARKSTOS [...] cpan.org -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;06:36:34&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I agree that these are interesting extensions, but also that they are
form methods and not agent methods. 

Consider submitting them as extensions to HTML::Form, or publishing a
module with mix-in methods for HTML::Form &#40;or even WWW::Mechanize, if
you prefer&#41; that adds them. 

I think it&#39;s best to keep the core of Mech simple, and use a plugin
system to distribute the maintenance load. 

I recommend this ticket be considered &#34;resolved&#34;, or moved to the
HTML::Form queue. 

However, it would be nice to collect these Mech wishes which are most
appropriate as plugins on a wiki. 

   Mark

On Thu Aug 05 17:51:29 2004, moregan@flr.follett.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  
&gt; 
&gt; Ideas for consideration, two methods:  grep_inputs&#40;&#41; and grep_submits&#40;&#41;.
&gt; I&#39;m not certain at the moment whether they would fit better in
&gt; WWW::Mechanize or in a new WWW::Mechanize::Form class.  They really are
&gt; form methods rather than agent methods.  &#40;Ditto for submits&#40;&#41; below,
&gt; trivially derived from grep_inputs.&#41;  If this progresses past the idea
&gt; stage then we can talk about getting some tests written.
&gt; 
&gt; Mike O&#39;Regan
&gt; 
&gt; 
&gt; =head2 grep_inputs&#40; %$properties &#41;
&gt; =head2 grep_submits&#40; %$properties &#41;
&gt; 
&gt; grep_inputs&#40;&#41; returns an array of all the input controls in the
&gt; current form whose properties match all of the regexes in $properties.
&gt; The controls returned are all descended from HTML::Form::Input.
&gt; 
&gt; If $properties is undef or empty then all inputs will be
&gt; returned.
&gt; 
&gt; If there is no current page, there is no form on the current
&gt; page, or there are no submit controls in the current form
&gt; then the return will be an empty array.
&gt; 
&gt;     # get all text controls whose names begin with &#34;customer&#34;
&gt;     my @customer_text_inputs =
&gt;         $mech-&gt;grep_inputs&#40; {
&gt;             type =&gt; qr/^&#40;text|textedit&#41;$/
&gt;             name =&gt; qr/^customer/
&gt;         }
&gt;     &#41;;
&gt; 
&gt; grep_submits&#40;&#41; does the same thing as grep_inputs&#40;&#41; except that
&gt; it only returns controls that are submit controls, ignoring
&gt; other types of input controls like text and checkboxes.
&gt; 
&gt; =cut
&gt; 
&gt; sub grep_inputs {
&gt;     my $self = shift;
&gt;     my $properties = shift;
&gt; 
&gt;     my @found;
&gt; 
&gt;     my $form = $self-&gt;current_form&#40;&#41;;
&gt;     if &#40; $form &#41; {
&gt;         my @inputs = $form-&gt;inputs&#40;&#41;;
&gt;         @found = _grep_hashes&#40; \@inputs, $properties &#41;;
&gt;     }
&gt; 
&gt;     return @found;
&gt; }
&gt; 
&gt; sub grep_submits {
&gt;     my $self = shift;
&gt;     my $properties = shift || {};
&gt; 
&gt;     $properties-&gt;{type} = qr/^&#40;submit|image&#41;$/;  # submits only
&gt;     my @found = $self-&gt;grep_inputs&#40; $properties &#41;;
&gt; 
&gt;     return @found;
&gt; }
&gt; 
&gt; #
&gt; # search an array of hashrefs, returning an array of the incoming
&gt; # hashrefs that match *all* the pattern in $patterns.
&gt; sub _grep_hashes {
&gt;     my $hashes = shift;
&gt;     my $patterns = shift || {};
&gt; 
&gt;     my @found;
&gt; 
&gt;     if &#40; ! %$patterns &#41; {
&gt;         # nothing to match on, so return them all
&gt;         @found = @$hashes;
&gt;     }
&gt;     else {
&gt;         foreach my $hash &#40; @$hashes &#41; {
&gt; 
&gt;             # check every pattern for a match on the current hash
&gt;             my $matchesEverything = 1;
&gt;             foreach my $patternKey &#40; keys %$patterns &#41; {
&gt;                 $matchesEverything = 0 unless exists $hash-&gt;{$patternKey}
&gt; &#38;&#38; $hash-&gt;{$patternKey} =~ $patterns-&gt;{$patternKey};
&gt;                 last if !$matchesEverything;
&gt;             }
&gt; 
&gt;             push @found, $hash if $matchesEverything;
&gt;         }
&gt;     }
&gt; 
&gt;     return @found;
&gt; }
&gt; 
&gt; 
&gt; 
&gt; =head2 submits&#40;&#41;
&gt; 
&gt; my @submit_buttons = $mech-&gt;submits&#40;&#41;;
&gt; 
&gt; Returns an array of all the submit controls in the current form.
&gt; Submit controls are of type &#39;submit&#39; and &#39;image&#39;.  The controls
&gt; are all descended from HTML::Form::Input.
&gt; 
&gt; If there is no current page, there is no form on the current
&gt; page, or there are no submit controls in the current form
&gt; then the return will be an empty array.
&gt; 
&gt; =cut
&gt; 
&gt; sub submits {
&gt;     my $self = shift;
&gt; 
&gt;     my @found;
&gt; 
&gt;     my $form = $self-&gt;current_form&#40;&#41;;
&gt;     if &#40; $form &#41; {
&gt;         my @inputs = $form-&gt;inputs&#40;&#41;;
&gt;         @found = $self-&gt;grep_inputs&#40; { type =&gt; qr/^&#40;submit|image&#41;$/ }
</div>&#41;;  #
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; submits only
&gt;     }
&gt; 
&gt;     return @found;
&gt; }
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;06:36:35&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;11:02:15&nbsp;2006</span>
    <span class="description">PETDANCE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">No, I wanted these in here.  I specifically asked Mike to give them to me.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;30&nbsp;01:07:59&nbsp;2007</span>
    <span class="description">PETDANCE [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
