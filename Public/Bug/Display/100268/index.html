<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #100268 for ExtUtils-MakeMaker: t/unicode.t fails if Locale::Encode is not available: Wide character in print</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #100268 for ExtUtils-MakeMaker: t/unicode.t fails if Locale::Encode is not available: Wide character in print</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=ExtUtils-MakeMaker">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=ExtUtils-MakeMaker">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=ExtUtils-MakeMaker">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=ExtUtils-MakeMaker">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-MakeMaker">ExtUtils-MakeMaker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">100268</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">30 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=ExtUtils-MakeMaker">ExtUtils-MakeMaker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ETJ [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
7.02    </td>
  </tr>
  <tr id="CF-12495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
7.05_03    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Write-UTF-8-encoded-chunk-if-Locale-Encode-is-not-av.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1431837/761010/0001-Write-UTF-8-encoded-chunk-if-Locale-Encode-is-not-av.patch">
Tue Nov 11 08:37:45 2014 (1k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=100268">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1431834" href="/Public/Bug/Display.html?id=100268#txn-1431834">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;08:36:24&nbsp;2014</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/unicode.t fails if Locale::Encode is not available: Wide
 character in print</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1431834/761005/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/761005">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Since EU::MM 7.00, Locale::Encode module is bundled &#40;is that necessary, will it become a core module?&#41;. If I unbundle the module and remove it from the system as it&#39;s optional everywhere in the EU::MM, t/unicode.t from 7.02 fails:

$ prove -l -v t/unicode.t
t/unicode.t .. 
1..9
ok 1 - setup
ok 2 - chdir&#39;d to Problem-Module
# Locale env vars: LANG=en_US.UTF-8
not ok 3 - no warning
ok 4 - utf8 abstract

#   Failed test &#39;no warning&#39;
#   at t/unicode.t line 49.
#          got: &#39;3&#39;
#     expected: &#39;0&#39;
# Wide character in print at /home/test/fedora/perl-ExtUtils-MakeMaker/ExtUtils-MakeMaker-7.02/lib/ExtUtils/MakeMaker.pm line 1202.
# Wide character in print at /home/test/fedora/perl-ExtUtils-MakeMaker/ExtUtils-MakeMaker-7.02/lib/ExtUtils/MakeMaker.pm line 1202.
# Wide character in print at /home/test/fedora/perl-ExtUtils-MakeMaker/ExtUtils-MakeMaker-7.02/lib/ExtUtils/MakeMaker.pm line 1202.
ok 5 - Exit code of make == 0
[...]

The line 1202 is the print in this code:

    unlink&#40;$finalname, &#34;MakeMaker.tmp&#34;, $Is_VMS ? &#39;Descrip.MMS&#39; : &#40;&#41;&#41;;
    open&#40;my $fh,&#34;&gt;&#34;, &#34;MakeMaker.tmp&#34;&#41;
        or die &#34;Unable to open MakeMaker.tmp: $!&#34;;
    binmode $fh, &#39;:encoding&#40;locale&#41;&#39; if $CAN_DECODE;

    for my $chunk &#40;@{$self-&gt;{RESULT}}&#41; {
        my $to_write = &#34;$chunk\n&#34;;
        if &#40;!$CAN_DECODE &#38;&#38; $] &gt; 5.008&#41; {
            utf8::encode $to_write;
        }
        print $fh &#34;$chunk\n&#34;
            or die &#34;Can&#39;t write to MakeMaker.tmp: $!&#34;;
    }

The fix is to print the $to_write instead of the $chunk. It looks like an overlooking because this branch happens only Locale::Encode is not available.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1431837" href="/Public/Bug/Display.html?id=100268#txn-1431837">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;08:37:45&nbsp;2014</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1431837/761009/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/761009">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 247b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Ãšt 11.lis.2014 08:36:24, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The fix is to print the $to_write instead of the $chunk. It looks like
&gt; an overlooking because this branch happens only Locale::Encode is not
&gt; available.
</div>
Attached patch implements it.

-- Petr
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Write-UTF-8-encoded-chunk-if-Locale-Encode-is-not-av.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1431837/761010/0001-Write-UTF-8-encoded-chunk-if-Locale-Encode-is-not-av.patch">Download 0001-Write-UTF-8-encoded-chunk-if-Locale-Encode-is-not-av.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 079898d941daec04fe277f850fe571a3b8b18fde Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Tue, 11 Nov 2014 14:30:08 +0100
Subject: [PATCH] Write UTF-8-encoded chunk if Locale::Encode is not available
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

CPAN RT#100268

Signed-off-by: Petr PÃƒÂ­saÃ…Â™ &lt;ppisar@redhat.com&gt;
---
 lib/ExtUtils/MakeMaker.pm | 4 ++--
 1 file changed, 2 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/lib/ExtUtils/MakeMaker.pm b/lib/ExtUtils/MakeMaker.pm
index 028925b..8dfdc47 100644
--- a/lib/ExtUtils/MakeMaker.pm
+++ b/lib/ExtUtils/MakeMaker.pm
@@ -1175,11 +1175,11 @@ sub flush {
     binmode $fh, &#39;:encoding&#40;locale&#41;&#39; if $CAN_DECODE;
 
     for my $chunk &#40;@{$self-&gt;{RESULT}}&#41; {
-        my $to_write = &#34;$chunk\n&#34;;
+        my $to_write = &#34;$chunk&#34;;
         if &#40;!$CAN_DECODE &#38;&#38; $] &gt; 5.008&#41; {
             utf8::encode $to_write;
         }
-        print $fh &#34;$chunk\n&#34;
+        print $fh &#34;$to_write\n&#34;
             or die &#34;Can&#39;t write to MakeMaker.tmp: $!&#34;;
     }
 
-- 
1.9.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1431844" href="/Public/Bug/Display.html?id=100268#txn-1431844">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;09:01:20&nbsp;2014</span>
    <span class="description">BINGOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1431844/761015/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/761015">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 708b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 11 08:37:45 2014, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dne Ãšt 11.lis.2014 08:36:24, ppisar napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; The fix is to print the $to_write instead of the $chunk. It looks like
&gt; &gt; an overlooking because this branch happens only Locale::Encode is not
&gt; &gt; available.
</div>&gt; 
&gt; Attached patch implements it.
&gt; 
&gt; -- Petr
&gt;
</div>
By &#34;bundled&#34; do you mean that it is included as ExtUtils::MakeMaker::Locale?

As distinct from included in the bundled/ directory of the distribution?

Are you saying that you have removed ExtUtils::MakeMaker::Locale? or that you removed Encode::Locale?

The latter will have no difference &#40;my entire testing environment doesn&#39;t have Encode::Locale on perls from
v5.20.1 all the way back to v5.6.2&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1431845" href="/Public/Bug/Display.html?id=100268#txn-1431845">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;09:01:21&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1431892" href="/Public/Bug/Display.html?id=100268#txn-1431892">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;13:58:05&nbsp;2014</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #100268] t/unicode.t fails if Locale::Encode is not available: Wide character in print</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Nov 2014 15:22:35 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> BINGOS via RT &lt;bug-ExtUtils-MakeMaker [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1431892/761047/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/761047">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 831b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Nov 11, 2014 at 09:01:21AM -0500, BINGOS via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=100268">https://rt.cpan.org/Ticket/Display.html?id=100268</a></span> &gt;
&gt; 
&gt; By &#34;bundled&#34; do you mean that it is included as ExtUtils::MakeMaker::Locale?
&gt;
</div>Yes. I removed the ExtUtils::MakeMaker::Locale as it is a word-by-word copy of
Encode::Locale from Encode-Locale-1.03. Of course I changed the other code to
attempt to load the Encode::Locale instead of ExtUtils::MakeMaker::Locale.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As distinct from included in the bundled/ directory of the distribution?
&gt;
</div>There is no Locale.pm in the bundled directory. However if you ask, yes,
I prune this directory too.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are you saying that you have removed ExtUtils::MakeMaker::Locale? or that
&gt; you removed Encode::Locale?
&gt;
</div>Both of them. Based on the $CAN_DECODE boolean, I got impression that the
feature is optional.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1431892/761048/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 213b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1434972" href="/Public/Bug/Display.html?id=100268#txn-1434972">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;19&nbsp;19:39:08&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1434972/762787/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/762787">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 280b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">If the Perl installation can&#39;t encode UTF-8, it doesn&#39;t try. This means wide characters can end up attempting to get printed. It seems you&#39;ve carefully disabled EUMM&#39;s UTF-8 encoding capability, then reported a &#34;bug&#34; that it&#39;s then not doing UTF-8 encoding.

Did I miss something?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1435092" href="/Public/Bug/Display.html?id=100268#txn-1435092">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;01:55:41&nbsp;2014</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #100268] t/unicode.t fails if Locale::Encode is not available: Wide character in print</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Nov 2014 07:55:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ed J via RT &lt;bug-ExtUtils-MakeMaker [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1435092/762867/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/762867">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Nov 19, 2014 at 07:39:09PM -0500, Ed J via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If the Perl installation can&#39;t encode UTF-8, it doesn&#39;t try.
</div>
The Encode::Locale is not about &#34;can&#39;t encode UTF-8&#34;. It&#39;s about ability to
set encoding of a handle according to current locale. The code I quoted in my
original post does the recoding if Encode::Locale is not available
&#40;utf8::encode $to_write;&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This means wide characters can end up attempting to get printed.
</div>
Yes, because there is a bug in the code I quoted in my original post and
a fix is available in the patch I sent. Without the patch, the &#34;utf8::encode
$to_write;&#34; line is completly pointless because the $to_write is never used.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems you&#39;ve carefully disabled EUMM&#39;s UTF-8 encoding capability, then
&gt; reported a &#34;bug&#34; that it&#39;s then not doing UTF-8 encoding.
&gt; 
</div>I disabled the Encode::Locale presence because all the usages are properly
handled as optional, yet the test suite cannot cope with the missing feature.

That was point of my subquestion why do you handle the Encode::Locale in the
library as optional while the test suite does not. And whether this
inconsistent status is just temporary, or you want to ship EU::MM with bundled
Encode::Locale library &#40;travested as EU::MM::Locale&#41; within the perl in the
future. &#40;Because from maintanance point of view, bundling is really bad
practise.&#41;

In my opinion you should either apply the patch and keep handling the
Encode::Locale as optional, or you should handle Encode::Locale as hard
dependency and then you can remove all the !$CAN_DECODE branches and
coditions.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1435092/762868/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 213b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1445122" href="/Public/Bug/Display.html?id=100268#txn-1445122">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;21&nbsp;23:10:11&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">30 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1445122/768332/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/768332">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 335b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A fix has been applied with commit adf284c. Thanks for reporting the bug.

If you deliberately delete part of the distribution, you can&#39;t really blame the maintainers if it doesn&#39;t work properly anymore. It&#39;s not being treated as &#34;optional&#34;, EUMM is simply robustly maintaining what functionality it can even in a degraded environment.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1445125" href="/Public/Bug/Display.html?id=100268#txn-1445125">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;21&nbsp;23:10:18&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1445126" href="/Public/Bug/Display.html?id=100268#txn-1445126">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;21&nbsp;23:10:18&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1445941" href="/Public/Bug/Display.html?id=100268#txn-1445941">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;17:16:51&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1445941/768762/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/768762">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 34b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing since released in 7.05_03.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1445944" href="/Public/Bug/Display.html?id=100268#txn-1445944">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;17:16:53&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1445946" href="/Public/Bug/Display.html?id=100268#txn-1445946">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;17:16:59&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Fixed in 7.05_03 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.708962</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
