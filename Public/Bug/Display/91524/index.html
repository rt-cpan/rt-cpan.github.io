<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91524 for Socket: [PATCH] Win32: missing inet_pton/ntop</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91524 for Socket: [PATCH] Win32: missing inet_pton/ntop</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Socket/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Socket/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Socket/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Socket/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Socket">Socket CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91524</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Socket/Active/">Socket</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
carsten.dehning [...] scai.fraunhofer.de

<br />
dolmen [...] cpan.org

<br />
GTANEZA [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29154-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.018    </td>
  </tr>
  <tr id="CF-29155-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;19&nbsp;13:18:06&nbsp;2013</span>
    <span class="description">carsten.dehning [...] scai.fraunhofer.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MS Windows port, missing functionality</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Dec 2013 19:17:51 +0100 &#40;CET&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carsten Dehning &lt;carsten.dehning [...] scai.fraunhofer.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Paul Evans,

I am currently extending a multi platform software package &#40;Unix/Linux/Windows, C/C++ and Perl&#41; 
from IPv4 to IPv6 &#40;dual stack mode&#41;. The C-world is fine since I can easily handle the differences
between the Unix and Windows world. 

However there are some issues with the Socket module on the Perl side.
As expected, with MS Windows some POSIX calls are missing in the MS winsock libraries or have at
least different names, e.g.:

   inet_ntop&#40;&#41; == InetNtopA&#40;&#41;
   <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/de-de/library/windows/desktop/cc805843&#40;v=vs.85&#41;.aspx">http://msdn.microsoft.com/de-de/library/windows/desktop/cc805843&#40;v=vs.85&#41;.aspx</a></span>

   inet_pton&#40;&#41; == InetPtonA&#40;&#41;
   <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/de-de/library/windows/desktop/cc805844&#40;v=vs.85&#41;.aspx">http://msdn.microsoft.com/de-de/library/windows/desktop/cc805844&#40;v=vs.85&#41;.aspx</a></span>

Furthermore these functions became first available under Vista. 

My workaround for XP &#40;still some customers :-&#40;&#40;&#41; is the use of

   WSAStringToAddress&#40;&#41;
   <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/de-de/library/windows/desktop/ms742214&#40;v=vs.85&#41;.aspx">http://msdn.microsoft.com/de-de/library/windows/desktop/ms742214&#40;v=vs.85&#41;.aspx</a></span>

   WSAAddressToString&#40;&#41;
   <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/de-de/library/windows/desktop/ms741516&#40;v=vs.85&#41;.aspx">http://msdn.microsoft.com/de-de/library/windows/desktop/ms741516&#40;v=vs.85&#41;.aspx</a></span>

Both are available since Window 2000.

In the Perl Socket module the XS functions inet_ntop&#40;&#41; and inet_pton&#40;&#41; are not implemented for Windows
since the Makefile.PL sub check_for&#40;&#41; cannot find them - which is correct and not a bug.
I should mention that I use Active State Perl, version 5.18, which is build with MINGW.

Would it be possible for you to implement these functions also for Windows?

My way in the C-world is e.g &#40;USOCKADDR is a union to wrap IPv6 &#38; IPv4&#41;.

   #ifdef _WIN32
      DWORD len = countof&#40;str&#41;;
      WSAAddressToStringA&#40;&#38;&#40;usockaddr.saddr&#41;,sizeof&#40;USOCKADDR&#41;,NULL,str,&#38;len&#41;;
   #else
      inet_ntop&#40;usockaddr.af,&#38;usockaddr,str,sizeof&#40;str&#41;&#41;;
   #endif
  
I believe a similar #ifdef would be possible in the Socket.xs

   #ifdef _WIN32
      // addr must have the proper AF assigned
      DWORD len = countof&#40;str&#41;;
      WSAAddressToStringA&#40;&#38;addr,sizeof&#40;addr&#41;,NULL,str,&#38;len&#41;;
   #else
      inet_ntop&#40;af, &#38;addr, str, sizeof str&#41;;
   #endif

The major work then seems to be the modification of the checks in Makefile.PL to account for the
Windows specialities. On the other hand it would be a major advantage for all Perl users to have 
platform independent POSIX calls also working under Windows.

Another option would be to add the WSA calls to the Socket.pm &#40;only implemented with the Windows version&#41;
and then I can easily switch between POSIX and the WSA calls inside the Perl code.

Right now I cannot implement IPv6 perl under Windows since both, POSIX and WSA, are missing.

With best regards

Carsten Dehning
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;23:20:13&nbsp;2013</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 19 13:18:06 2013, carsten.dehning@scai.fraunhofer.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I believe a similar #ifdef would be possible in the Socket.xs
&gt; 
&gt; #ifdef _WIN32
&gt;    // addr must have the proper AF assigned
&gt;    DWORD len = countof&#40;str&#41;;
&gt;    WSAAddressToStringA&#40;&#38;addr,sizeof&#40;addr&#41;,NULL,str,&#38;len&#41;;
&gt; #else
&gt;    inet_ntop&#40;af, &#38;addr, str, sizeof str&#41;;
&gt; #endif
</div>
Well, not having a Windows box I&#39;ve no way to test it, even to know if this actually compiles, but find attached an attempt at a patch to hopefully implement it. At the very least, I know it still compiles around it on Linux.

Let me know if that solves the problem, and if so I&#39;ll call it 2.013_001 and see what the smokers think.

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt91524-a1.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;Socket.xs&#39;
--- Socket.xs	2013-12-19 03:39:23 +0000
+++ Socket.xs	2013-12-30 04:14:34 +0000
@@ -51,6 +51,14 @@
 # include &lt;ws2tcpip.h&gt;
 #endif
 
+#ifdef _WIN32
+/* MSWin32 provides WSAAddressToStringA&#40;&#41; and WSAStringToAddressA&#40;&#41;, which do
+ * similar things to inet_ntop and inet_pton that we can use those
+ */
+# define HAS_INETNTOP
+# define HAS_INETPTON
+#endif
+
 #ifdef NETWARE
 NETDB_DEFINE_CONTEXT
 NETINET_DEFINE_CONTEXT
@@ -956,7 +964,32 @@
 #endif
 		      &#34;Socket::inet_ntop&#34;, af&#41;;
 	}
-
+#ifdef _WIN32
+	switch&#40;af&#41; {
+	  case AF_INET: {
+	    DWORD slen = sizeof str;
+	    struct sockaddr_in sockaddr;
+
+	    sockaddr.sin_family = AF_INET;
+	    sockaddr.sin_port   = 0;
+	    Copy&#40;ip_address, &#38;sockaddr.sin_addr, addrlen, char&#41;;
+
+	    WSAAddressToStringA&#40;&#38;sockaddr, sizeof sockaddr, NULL, &#38;str, &#38;slen&#41;;
+	  } break;
+#ifdef AF_INET6
+	  case AF_INET6: {
+	    DWORD slen = sizeof str;
+	    struct sockaddr_in6 sockaddr;
+
+	    sockaddr.sin6_family = AF_INET6;
+	    sockaddr.sin6_port   = 0;
+	    Copy&#40;ip_address, &#38;sockaddr.sin6_addr, addrlen, char&#41;;
+
+	    WSAAddressToStringA&#40;&#38;sockaddr, sizeof sockaddr, NULL, &#38;str, &#38;slen&#41;;
+	  } break;
+#endif
+	}
+#else
 	if&#40;addrlen &lt; sizeof&#40;addr&#41;&#41; {
 	    Copy&#40;ip_address, &#38;addr, addrlen, char&#41;;
 	    Zero&#40;&#40;&#40;char*&#41;&#38;addr&#41; + addrlen, sizeof&#40;addr&#41; - addrlen, char&#41;;
@@ -964,7 +997,9 @@
 	else {
 	    Copy&#40;ip_address, &#38;addr, sizeof addr, char&#41;;
 	}
+
 	inet_ntop&#40;af, &#38;addr, str, sizeof str&#41;;
+#endif
 
 	ST&#40;0&#41; = sv_2mortal&#40;newSVpvn&#40;str, strlen&#40;str&#41;&#41;&#41;;
 #else
@@ -1003,7 +1038,32 @@
 #endif
 		      &#34;Socket::inet_pton&#34;, af&#41;;
 	}
+#ifdef _WIN32
+	switch&#40;af&#41; {
+	  case AF_INET: {
+	    struct sockaddr_in sockaddr;
+	    DWORD alen = sizeof sockaddr;
+
+	    ok = !WSAStringToAddressA&#40;host, af, NULL, &#38;sockaddr, &#38;alen&#41;;
+	    if &#40;ok&#41; {
+		Copy&#40;&#38;sockaddr.sin_addr, &#38;ip_address, alen, char&#41;;
+	    }
+	  } break;
+#ifdef AF_INET6
+	  case AF_INET6: {
+	    struct sockaddr_in6 sockaddr;
+	    DWORD alen = sizeof sockaddr;
+
+	    ok = !WSAStringToAddressA&#40;host, af, NULL, &#38;sockaddr, &#38;alen&#41;;
+	    if &#40;ok&#41; {
+		Copy&#40;&#38;sockaddr.sin6_addr, &#38;ip_address, alen, char&#41;;
+	    }
+	  } break;
+#endif
+	}
+#else
 	ok = &#40;*host != &#39;\0&#39;&#41; &#38;&#38; inet_pton&#40;af, host, &#38;ip_address&#41;;
+#endif
 
 	ST&#40;0&#41; = sv_newmortal&#40;&#41;;
 	if &#40;ok&#41; {

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;23:20:14&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;30&nbsp;11:21:08&nbsp;2013</span>
    <span class="description">carsten.dehning [...] scai.fraunhofer.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91524] MS Windows port, missing functionality</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 30 Dec 2013 17:20:47 +0100 &#40;CET&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carsten Dehning &lt;carsten.dehning [...] scai.fraunhofer.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Paul,

thank you so much for your immediate response. I appreciate your support. Thank you for the smart idea to #define within the .xs module.

Since my MINGW patch.exe crashes &#40;I don&#39;t care :-&#41; &#41;, please find attached the complete Socket.xs module. 
I did some minor additional changes to avoid MINGW-gcc complaints and to avoid the return of a hostname filled with stack-junk. Remove the croak&#40;&#41; calls &#40;I just used them for testing with junk arguments&#41;.

I think you know exactly what to do. It&#39;s working nice :-&#41; ...on my Win7 laptop. 

I&#39;ll be back in the institute next week and then I&#39;ll do the other platforms &#40;XP/Vista/HP-UX/SGI-IRIX/AIX4+5/Linux Intel/Itanium etc....&#41;

During the last week I found some time to find out the reasons why inet_xxx&#40;&#41; is missing under Windows. I removed my Active State Perl and installed Strawberry Perl ... same issue :-&#40;. By the way, Active state is far more complete compared to Strawberry Perl.

Both, Active State and Strawberry are based on MINGW, and in fact the incomplete MINGW header &lt;ws2tcpip.h&gt; causes the trouble.

I saw this quite old MINGW ticket &#40;summer 2012&#41; ...

<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/mingw/bugs/1641/">http://sourceforge.net/p/mingw/bugs/1641/</a></span>

and got an association and may cite Larry Wall: &#34;The three principal virtues of a programmer are Laziness, .....&#34;

Nevertheless, the implementation via the WSA stuff is the best solution, since it will also work under XP &#40;test that next week&#41;.

I wish you a happy new year

Carsten
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;Socket.xs&#39;
--- Socket.xs   2013-12-19 03:39:23 +0000
+++ Socket.xs   2013-12-30 04:14:34 +0000
@@ -51,6 +51,14 @@
 # include &lt;ws2tcpip.h&gt;
 #endif
 
+#ifdef _WIN32
+/* MSWin32 provides WSAAddressToStringA&#40;&#41; and WSAStringToAddressA&#40;&#41;, which do
+ * similar things to inet_ntop and inet_pton that we can use those
+ */
+# define HAS_INETNTOP
+# define HAS_INETPTON
+#endif
+
 #ifdef NETWARE
 NETDB_DEFINE_CONTEXT
 NETINET_DEFINE_CONTEXT
@@ -956,7 +964,32 @@
 #endif
                      &#34;Socket::inet_ntop&#34;, af&#41;;
        }
-
+#ifdef _WIN32
+       switch&#40;af&#41; {
+         case AF_INET: {
+           DWORD slen = sizeof str;
+           struct sockaddr_in sockaddr;
+
+           sockaddr.sin_family = AF_INET;
+           sockaddr.sin_port   = 0;
+           Copy&#40;ip_address, &#38;sockaddr.sin_addr, addrlen, char&#41;;
+
+           WSAAddressToStringA&#40;&#38;sockaddr, sizeof sockaddr, NULL, &#38;str, &#38;slen&#41;;
+         } break;
+#ifdef AF_INET6
+         case AF_INET6: {
+           DWORD slen = sizeof str;
+           struct sockaddr_in6 sockaddr;
+
+           sockaddr.sin6_family = AF_INET6;
+           sockaddr.sin6_port   = 0;
+           Copy&#40;ip_address, &#38;sockaddr.sin6_addr, addrlen, char&#41;;
+
+           WSAAddressToStringA&#40;&#38;sockaddr, sizeof sockaddr, NULL, &#38;str, &#38;slen&#41;;
+         } break;
+#endif
+       }
+#else
        if&#40;addrlen &lt; sizeof&#40;addr&#41;&#41; {
            Copy&#40;ip_address, &#38;addr, addrlen, char&#41;;
            Zero&#40;&#40;&#40;char*&#41;&#38;addr&#41; + addrlen, sizeof&#40;addr&#41; - addrlen, char&#41;;
@@ -964,7 +997,9 @@
        else {
            Copy&#40;ip_address, &#38;addr, sizeof addr, char&#41;;
        }
+
        inet_ntop&#40;af, &#38;addr, str, sizeof str&#41;;
+#endif
 
        ST&#40;0&#41; = sv_2mortal&#40;newSVpvn&#40;str, strlen&#40;str&#41;&#41;&#41;;
 #else
@@ -1003,7 +1038,32 @@
 #endif
                      &#34;Socket::inet_pton&#34;, af&#41;;
        }
+#ifdef _WIN32
+       switch&#40;af&#41; {
+         case AF_INET: {
+           struct sockaddr_in sockaddr;
+           DWORD alen = sizeof sockaddr;
+
+           ok = !WSAStringToAddressA&#40;host, af, NULL, &#38;sockaddr, &#38;alen&#41;;
+           if &#40;ok&#41; {
+               Copy&#40;&#38;sockaddr.sin_addr, &#38;ip_address, alen, char&#41;;
+           }
+         } break;
+#ifdef AF_INET6
+         case AF_INET6: {
+           struct sockaddr_in6 sockaddr;
+           DWORD alen = sizeof sockaddr;
+
+           ok = !WSAStringToAddressA&#40;host, af, NULL, &#38;sockaddr, &#38;alen&#41;;
+           if &#40;ok&#41; {
+               Copy&#40;&#38;sockaddr.sin6_addr, &#38;ip_address, alen, char&#41;;
+           }
+         } break;
+#endif
+       }
+#else
        ok = &#40;*host != &#39;\0&#39;&#41; &#38;&#38; inet_pton&#40;af, host, &#38;ip_address&#41;;
+#endif
 
        ST&#40;0&#41; = sv_newmortal&#40;&#41;;
        if &#40;ok&#41; {
</div></div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;31&nbsp;19:13:56&nbsp;2014</span>
    <span class="description">JDB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Dec 29 23:20:13 2013, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Let me know if that solves the problem, and if so I&#39;ll call it
&gt; 2.013_001 and see what the smokers think.
</div>
I just tried the patch myself.  It required defining HAS_GETADDRINFO, which seems to be undefined on Windows for historical reasons &#40;it is only supported on Windows 2000 and later, but Perl is only supported on 2000+ anymore anyways, so that reason is no longer valid&#41;.

But I also had to set the scope id to 0:

            sockaddr.sin6_scope_id = 0;

before calling WSAAddressToStringA&#40;&#41; with an IPv6 address.  Let me know if you need a patch; the required change should be obvious in hindsight.

Cheers,
-Jan

PS: Is there a reason the source is not on Github or some other public repo?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;08:04:59&nbsp;2014</span>
    <span class="description">carsten.dehning [...] scai.fraunhofer.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91524] MS Windows port, missing functionality</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 1 Apr 2014 14:04:45 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carsten Dehning &lt;carsten.dehning [...] scai.fraunhofer.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Jan,

in my last email you&#39;ll find attached a complete Socket.xs module &#40;not just the patch&#41;, with some minor additional fixes to avoid gcc and Visual C compiler complaints. This works nice.

The reason for my request is to have a Perl code without separating Unix and Windows 2000, XP, Vista, 7 .... and without doing some extra checks and find out whether inet_ntop or inet_pton are available or not.
IPv6 came up first under XP &#40;which might disappear soon&#41;, therefore a Sockets-module without inet_ntop etc. &#40;the current situation&#41; is OK for Windows 2000 and less. For me personally Windows XP would be the oldest platform.

With best regards

Carsten Dehning
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;29&nbsp;11:20:26&nbsp;2014</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please also see comments that I just added on #84600:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84600#txn-1437445">https://rt.cpan.org/Ticket/Display.html?id=84600#txn-1437445</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:31:29&nbsp;2015</span>
    <span class="description">GTANEZA [...] cpan.org - Ticket #102695:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IO-Socket-IP module does not compile correctly/ fails tests on
 Windows</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I have been trying to get the IO-Socket-IP module compile correctly on the Windows platform. We need to add support for IPV6 for Perl 5.14.4. 

IO-Socket-IP module compiles and passes IPV6 tests on Linux x64 without any issues. 


Please see attached screenshots.

I tried different Windows OS. Windows Server 2008 R2, Windows 7, Windows 8 with both Visual Studio 8 and Visual Studio 10.

Enabled inet_ntop and inet_pton in config.VC64 config but i still get &#39;Vendor has not defined Socket macro&#39; error when running IO-Socket-IP module tests.

When compiling the updated Socket module; i see inet_ntop and inet_pton undefined &#40;see attached screenshot&#41;


I see that there was a fix that was required to get this module working with Strawberry Perl :

<span class="clickylink"><a target="new" rel="nofollow" href="http://vinsworldcom.blogspot.com/2012/08/ipv6-in-perl-on-windows_20.html">http://vinsworldcom.blogspot.com/2012/08/ipv6-in-perl-on-windows_20.html</a></span>


We most likely need a fix for standard Perl distribution to make this work on Windows. 
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Screen_Shot_2015-03-04_at_3.20.28_PM.png</td>
  </tr>
</table>

<div class="messagebody">
<img alt="Screen_Shot_2015-03-04_at_3.20.28_PM.png" title="Screen_Shot_2015-03-04_at_3.20.28_PM.png" src="/Ticket/Attachment/1472359/784009/" /></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Screen_Shot_2015-03-04_at_3.21.29_PM.png</td>
  </tr>
</table>

<div class="messagebody">
<img alt="Screen_Shot_2015-03-04_at_3.21.29_PM.png" title="Screen_Shot_2015-03-04_at_3.21.29_PM.png" src="/Ticket/Attachment/1472359/784010/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:50:05&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk - Ticket #102695:  Subject changed from &#39; IO-Socket-IP module does not compile correctly/ fails tests on Windows&#39; to &#39;IO-Socket-IP module does not compile correctly/ fails tests on Windows&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:50:05&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk - Ticket #102695:  Queue changed from IO-Socket-IP to Socket</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:50:54&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk - Ticket #102695:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 11 12:31:29 2015, GTANEZA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Enabled inet_ntop and inet_pton in config.VC64 config but i still get
&gt; &#39;Vendor has not defined Socket macro&#39; error when running IO-Socket-IP
&gt; module tests.
&gt; 
&gt; When compiling the updated Socket module; i see inet_ntop and
&gt; inet_pton undefined &#40;see attached screenshot&#41;
</div>
At this point it&#39;s a Socket bug, not IO-Socket-IP.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:50:54&nbsp;2015</span>
    <span class="description">The RT System itself - Ticket #102695:  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:52:28&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk - Ticket #102695:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Also, seems to be a duplicate of

  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91524">https://rt.cpan.org/Ticket/Display.html?id=91524</a></span>

Please continue there instead.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:52:40&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk - Ticket #102695:  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;12:53:23&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So what is the latest progress here?

I don&#39;t have any way to test anything Windowsy, so I&#39;m 100% relying on other people to supply some sort of patch to fix things.

Does such a patch exist yet that I can apply?

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;16:32:46&nbsp;2015</span>
    <span class="description">ether [...] cpan.org - Ticket #102695:  Merged into ticket #91524</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;16:32:46&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Merged into ticket #91524</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;06:00:01&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I indepdently rewrote this patch, I didn&#39;t know this ticket exists. This patch uses WSAStringToAddress which is available in windows 95 and newer &#40;really only 2000 and newer matter, native inet_pton is only on Vista and up, which is unacceptable since 2K and XP are supported. I thought of using RtlIpv4AddressToStringA from ntdll.dll but that supposedly XP and up. II didn&#39;t check a Win2K ntdll.dll to see if it is undocumented but implemented, but it doesn&#39;t matter since WSAStringToAddress works. The code is public domain &#40;I guess&#41; from SO <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/13731243/what-is-the-windows-xp-equivalent-of-inet-pton-or-inetpton">http://stackoverflow.com/questions/13731243/what-is-the-windows-xp-equivalent-of-inet-pton-or-inetpton</a></span> .
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-add-inet_pton-and-inet_ntop-on-Win32.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From fea867ad5a0d94d4f06bc3a8e2a5fbd587efdb95 Mon Sep 17 00:00:00 2001
From: bulk88 &lt;bulk88@hotmail.com&gt;
Date: Sat, 18 Apr 2015 11:44:25 +0200
Subject: [PATCH] add inet_pton and inet_ntop on Win32

Vista and up have inet_pton and inet_ntop, exported from ws2_32.dll. XP
and 2000 dont. So implement the 2 using the old fashioned way &#40;and most
portable on Win32 way&#41;.
---
 Socket.xs |   52 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 files changed, 52 insertions&#40;+&#41;, 0 deletions&#40;-&#41;

diff --git a/Socket.xs b/Socket.xs
index 60f5754..f37fcc4 100644
--- a/Socket.xs
+++ b/Socket.xs
@@ -51,6 +51,58 @@
 # include &lt;ws2tcpip.h&gt;
 #endif
 
+#ifdef WIN32
+int inet_pton&#40;int af, const char *src, void *dst&#41;
+{
+  struct sockaddr_storage ss;
+  int size = sizeof&#40;ss&#41;;
+  char src_copy[INET6_ADDRSTRLEN+1];
+
+  ZeroMemory&#40;&#38;ss, sizeof&#40;ss&#41;&#41;;
+  /* stupid non-const API */
+  strncpy &#40;src_copy, src, INET6_ADDRSTRLEN+1&#41;;
+  src_copy[INET6_ADDRSTRLEN] = 0;
+
+  if &#40;WSAStringToAddress&#40;src_copy, af, NULL, &#40;struct sockaddr *&#41;&#38;ss, &#38;size&#41; == 0&#41; {
+    switch&#40;af&#41; {
+      case AF_INET:
+    *&#40;struct in_addr *&#41;dst = &#40;&#40;struct sockaddr_in *&#41;&#38;ss&#41;-&gt;sin_addr;
+    return 1;
+      case AF_INET6:
+    *&#40;struct in6_addr *&#41;dst = &#40;&#40;struct sockaddr_in6 *&#41;&#38;ss&#41;-&gt;sin6_addr;
+    return 1;
+    }
+  }
+  return 0;
+}
+
+const char *inet_ntop&#40;int af, const void *src, char *dst, socklen_t size&#41;
+{
+  struct sockaddr_storage ss;
+  unsigned long s = size;
+
+  ZeroMemory&#40;&#38;ss, sizeof&#40;ss&#41;&#41;;
+  ss.ss_family = af;
+
+  switch&#40;af&#41; {
+    case AF_INET:
+      &#40;&#40;struct sockaddr_in *&#41;&#38;ss&#41;-&gt;sin_addr = *&#40;struct in_addr *&#41;src;
+      break;
+    case AF_INET6:
+      &#40;&#40;struct sockaddr_in6 *&#41;&#38;ss&#41;-&gt;sin6_addr = *&#40;struct in6_addr *&#41;src;
+      break;
+    default:
+      return NULL;
+  }
+  /* cannot direclty use &#38;size because of strict aliasing rules */
+  return &#40;WSAAddressToString&#40;&#40;struct sockaddr *&#41;&#38;ss, sizeof&#40;ss&#41;, NULL, dst, &#38;s&#41; == 0&#41;?
+          dst : NULL;
+}
+
+#define HAS_INETPTON
+#define HAS_INETNTOP
+#endif
+
 #ifdef NETWARE
 NETDB_DEFINE_CONTEXT
 NETINET_DEFINE_CONTEXT
-- 
1.7.9.msysgit.0

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;06:03:03&nbsp;2015</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">@LeoNerd,<br>

<br>

Bul88 and I are currently in Berlin for the QA Hackathon and are available for testing on 3 Windows platforms.<br>

<br>

--&nbsp;<br>

Olivier Mengu&eacute; - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span> - <span class="clickylink"><a target="new" rel="nofollow" href="https://gratipay.com/dolmen/">https://gratipay.com/dolmen/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;07:06:35&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 18 06:03:03 2015, DOLMEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; @LeoNerd,
&gt; 
&gt; Bul88 and I are currently in Berlin for the QA Hackathon and are
&gt; available for
&gt; testing on 3 Windows platforms.
</div>
Ah excellent - if you can let me know if this works on those, then I can apply it.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;14:58:01&nbsp;2015</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">Le 2015-04-18 13:06:35, PEVANS a &eacute;crit&nbsp;:<br>

<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ah excellent - if you can let me know if this works on those, then I<br>

&gt; can apply it.<br>
</div><br>

The patch above by BULKDD above is verified.<br>

We are on IRC, #perl-qa<br>

<br>

--&nbsp;<br>

Olivier Mengu&eacute; - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span> - <span class="clickylink"><a target="new" rel="nofollow" href="https://gratipay.com/dolmen/">https://gratipay.com/dolmen/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;19&nbsp;04:46:40&nbsp;2015</span>
    <span class="description">dolmen [...] cpan.org -  Requestor DOLMEN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;19&nbsp;04:48:20&nbsp;2015</span>
    <span class="description">dolmen [...] cpan.org -  Subject changed from &#39;MS Windows port, missing functionality&#39; to &#39;[PATCH] Win32: missing inet_pton/ntop&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;19&nbsp;04:48:21&nbsp;2015</span>
    <span class="description">dolmen [...] cpan.org -  Broken in 2.018 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;16:24:33&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks; patch applied. Uploaded to CPAN as a devel release of 2.018_001 to see if the smokers like it. Presuming all is happy, I&#39;ll call it 2.019.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;16:24:34&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;07:46:08&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 27 16:24:33 2015, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks; patch applied. Uploaded to CPAN as a devel release of
&gt; 2.018_001 to see if the smokers like it. Presuming all is happy, I&#39;ll
&gt; call it 2.019.
</div>

There is a bug in the above code, fix below

int inet_pton&#40;int af, const char *src, void *dst&#41;
{
  struct sockaddr_storage ss;
  int size = sizeof&#40;ss&#41;;
  char src_copy[INET6_ADDRSTRLEN+1];

  ZeroMemory&#40;&#38;ss, sizeof&#40;ss&#41;&#41;;
  /* stupid non-const API */
  strncpy&#40;src_copy, src, INET6_ADDRSTRLEN+1&#41;;
  src_copy[INET6_ADDRSTRLEN] = 0;

  if &#40;WSAStringToAddress&#40;src_copy, af, NULL, &#40;struct sockaddr *&#41;&#38;ss, &#38;size&#41; != 0&#41;
    return 0;

  switch&#40;af&#41; {
    case AF_INET:
      *&#40;struct in_addr *&#41;dst = &#40;&#40;struct sockaddr_in *&#41;&#38;ss&#41;-&gt;sin_addr;
      return 1;
    case AF_INET6:
      *&#40;struct in6_addr *&#41;dst = &#40;&#40;struct sockaddr_in6 *&#41;&#38;ss&#41;-&gt;sin6_addr;
      return 1;
    default: &lt;&lt;missing
      return 0; &lt;&lt;missing
  }
}

Visual C reports

d:\smoke\perl\blead\build\cpan\socket\socket.xs&#40;77&#41; : warning C4715: &#39;inet_pton&#39; : not all control paths return a value
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;07:46:20&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;18&nbsp;11:44:43&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 22 07:46:08 2015, BULKDD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Visual C reports
&gt; 
&gt; d:\smoke\perl\blead\build\cpan\socket\socket.xs&#40;77&#41; : warning C4715:
&gt; &#39;inet_pton&#39; : not all control paths return a value
</div>
I believe this has now been fixed by the other patch; in RT107058

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;18&nbsp;11:44:49&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;18&nbsp;11:44:57&nbsp;2015</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;rejected&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
