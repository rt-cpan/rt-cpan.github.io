<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42474 for Digest-SHA: Encoding different from shaXXXsum and other sha tools</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42474 for Digest-SHA: Encoding different from shaXXXsum and other sha tools</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Digest-SHA/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-SHA">Digest-SHA CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42474</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">5 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Digest-SHA/Active/">Digest-SHA</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
business2008 [...] rodneybeede.com.NOSPAM

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-11544-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
5.47    </td>
  </tr>
  <tr id="CF-11545-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;17:13:13&nbsp;2009</span>
    <span class="description">business2008 [...] rodneybeede.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Encoding different from shaXXXsum and other sha tools</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When I encode any data &#40;binary or text&#41; with the Perl Digest::SHA library the 
result is different than any results I get when using Linux&#39;s shaXXXsum 
command or the Java MessageDigest library.

Windows XP 64-bit w/SP2

ActiveState Perl v5.10.0 built for MSWin32-x86-multi-thread
Binary build 1004 [287188] provided by ActiveState <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span>
Built Sep  3 2008 13:16:37

Digest::SHA 5.47


Example sha256sum command

echo test|sha256sum
f2ca1bb6c7e907d06dafe4687e579fce76b37e4e93b7605022da52e6ccc26fd2


Example Perl script that does not result in the expected above hash:




use strict;
use Digest::SHA qw&#40;sha256 sha256_hex sha256_base64 hmac_sha256 
hmac_sha256_hex hmac_sha256_base64
        sha512 sha512_hex sha512_base64 hmac_sha512 hmac_sha512_hex 
hmac_sha512_base64
&#41;;


use constant SAMPLE =&gt; &#34;test&#34;;

#       from Linux shaXXXsum command
use constant EXPECTED_sha256sum =&gt; 
&#34;f2ca1bb6c7e907d06dafe4687e579fce76b37e4e93b7605022da52e6ccc26fd2&#34;;

use constant EXPECTED_sha512sum =&gt; 
&#34;0e3e75234abc68f4378a86b3f4b32a198ba301845b0cd6e50106e874345700cc6663a86c1ea1
25dc5e92be17c98f9a0f85ca9d5f595db2012f7cc3571945c123&#34;;


# Prepare the output file

print &#34;\n&#34;;
print &#34;sha256&#40;\$data, ...&#41;               \t&#34; . sha256&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;sha256_hex&#40;\$data, ...&#41;           \t&#34; . sha256_hex&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;sha256_base64&#40;\$data, ...&#41;        \t&#34; . sha256_base64&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;hmac_sha256&#40;\$data, ...&#41;          \t&#34; . hmac_sha256&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;hmac_sha256_hex&#40;\$data, ...&#41;      \t&#34; . hmac_sha256_hex&#40;SAMPLE&#41; . 
&#34;\n&#34;;
print &#34;hmac_sha256_base64&#40;\$data, ...&#41;   \t&#34; . hmac_sha256_base64&#40;SAMPLE&#41; . 
&#34;\n&#34;;
print &#34;\n&#34;;
print &#34;EXPECTED:                         \t&#34; . EXPECTED_sha256sum . &#34;\n&#34;;
print &#34;\n&#34;;


print &#34;\n&#34;;
print &#34;sha512&#40;\$data, ...&#41;               \t&#34; . sha512&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;sha512_hex&#40;\$data, ...&#41;           \t&#34; . sha512_hex&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;sha512_base64&#40;\$data, ...&#41;        \t&#34; . sha512_base64&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;hmac_sha512&#40;\$data, ...&#41;          \t&#34; . hmac_sha512&#40;SAMPLE&#41; . &#34;\n&#34;;
print &#34;hmac_sha512_hex&#40;\$data, ...&#41;      \t&#34; . hmac_sha512_hex&#40;SAMPLE&#41; . 
&#34;\n&#34;;
print &#34;hmac_sha512_base64&#40;\$data, ...&#41;   \t&#34; . hmac_sha512_base64&#40;SAMPLE&#41; . 
&#34;\n&#34;;
print &#34;\n&#34;;
print &#34;EXPECTED:                         \t&#34; . EXPECTED_sha512sum . &#34;\n&#34;;
print &#34;\n&#34;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;18:01:46&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;18:02:36&nbsp;2009</span>
    <span class="description">business2008 [...] rodneybeede.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So the problem with my example Perl was that I ran the command &#34;echo 
test|sha256sum&#34; which sent the text &#34;test\n&#34;.  Running &#34;echo -n 
test|sha256sum&#34; showed the expected results in the Perl module.

However the Perl module documentation should stress this point:

Calling  $digest-&gt;addfile&#40;&#34;/path/to/some/file&#34;&#41;;  results in the file 
being opened by the module in ASCII mode.  Thus one MUST not use this 
method if the content is binary.  Instead you should open the file 
before making the addfile call like:

open&#40;FILE_HANDLE, &#34;&lt;&#34;, &#34;/path/to/some/file&#34;&#41; || die&#40;&#34;$!\n&#34;&#41;;
binmode FILE_HANDLE;
$digest-&gt;addfile&#40;FILE_HANDLE&#41;;
close&#40;FILE_HANDLE&#41;;


It&#39;d be nice if the addfile&#40;&#41; call just defaulted to binmode or had a 
second optional parameter to specify binmode.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;18:13:16&nbsp;2009</span>
    <span class="description">business2008 [...] rodneybeede.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I finally found where in the documentation it says addfile&#40;&#41; can take an 
optional mode.


I strongly recommend adding an example of the addfile&#40;&#41; mode option to 
the SYNOPSIS.  This will save future people like me from making this 
mistake.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;18:13:35&nbsp;2009</span>
    <span class="description">business2008 [...] rodneybeede.com -  Severity Critical changed to Normal</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;18:19:16&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">5 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Your test case is incorrect: the &#34;echo&#34; command attaches a newline at
the end unless suppressed by the &#34;-n&#34; option.

Also, the &#34;addfile&#34; method uses ASCII mode by default so that text files
won&#39;t trigger digest mismatches between DOS and Unix.  You are incorrect
in assuming that &#34;addfile&#34; doesn&#39;t have an optional parameter to specify
binary mode: the documentation clearly spells this out &#40;ref. &#34;b&#34; option&#41;.

In future, if you have problems getting things to work out, you might
first try sending out some emails to make sure you haven&#39;t overlooked
something simple.  This saves everyone time in the long run.

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;18:19:17&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;17&nbsp;02:58:58&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;17&nbsp;03:07:00&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The status of this ticket has been changed to &#34;rejected&#34;: the
discrepancy cited by the requester reflects a problem with his test case
rather than a problem with the Digest::SHA module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;17&nbsp;03:07:01&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
