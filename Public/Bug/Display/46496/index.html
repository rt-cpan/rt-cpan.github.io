<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #46496 for Net-BGP: Bug in Update.pm with empty NLRI and attributes</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #46496 for Net-BGP: Bug in Update.pm with empty NLRI and attributes</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-BGP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-BGP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-BGP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-BGP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-BGP">Net-BGP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">46496</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">1 hour (60 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-BGP/Active/">Net-BGP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">kbrint [...] rufus.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
olivier.montanuy [...] m4x.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-22306-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.12</li>
<li>
0.10</li>
</ul>
    </td>
  </tr>
  <tr id="CF-22307-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.13    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;29&nbsp;16:00:12&nbsp;2009</span>
    <span class="description">olivier.montanuy [...] m4x.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug in Update.pm with empty NLRI and attributes</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">BGP Update messages with Withdrawn prefix but empty Attributes and NLRI
will cause the Net::BGP to tear down the BGP session.

Consequence: the BGP session is restarted whenever some routes are
withdrawn without any new route announced, that happen within a few
minutes on a typical BGP session with Internet full routing.

The initial announce of 300k routes causes CPU load on both server and
routers.

Cause: Update.pm _decode_path_attributes checks that mandatory BGP
attributes are present, and of course that cannot work when the
attribute list is empty. So a BGP error is reported even though the
BGP message is perfectly valid.

Note: the bug is present in all versions of the lib, but may not cause
any trouble in older versions that did not check mandatory BGP attributes.


Quick fix: check that $length is above zero before calling
_decode_path_attributes and _decode_nlri

I don&#39;t provide a patch because I&#39;m not sure this is the right way to do
fix the bug, since I only use a little part of the API. 
But with that fix, the BGP sessions can last several hours without problems.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;29&nbsp;18:08:21&nbsp;2009</span>
    <span class="description">kbrint [...] rufus.net -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;09:39:40&nbsp;2009</span>
    <span class="description">guillaume.lambert-geek [...] laposte.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> guillaume.lambert-geek [...] laposte.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello gentlemen

I would like to add some precisions on this topic.

I have taken a quick look at all versions of Net::BGP since 0.08 and it
seems confirmed that they are all suffering from the bug. However, only
versions above 0.10 &#40;included&#41; seem to cause the BGP session to tear
down &#40; provided of course that when instantiating the Net::BGP process,
you didn&#39;t put in your notification callback function some commands to
explicitly do it &#41;

As meant by Olivier, the bug can easily be corrected by adding a little
control line in the _decode_message function before calling 
_decode_path_attributes . See details below.

sub _decode_message
{

    …
   
    if &#40; $length &gt; &#40;length&#40;$buffer&#41; - $offset&#41; &#41; {
        Net::BGP::Notification-&gt;throw&#40;
            ErrorCode    =&gt; BGP_ERROR_CODE_UPDATE_MESSAGE,
            ErrorSubCode =&gt; BGP_ERROR_SUBCODE_MALFORMED_ATTR_LIST
        &#41;;
    }

    # update message without any NLRI - dont check attributes
    if&#40; $length &lt;= 0&#41; return;

    $this-&gt;_decode_path_attributes&#40;substr&#40;$buffer, $offset, $length&#41;&#41;;
    $offset += $length; 

   …
}

But in my opinion, the most interesting issue that was raised here is
why only versions above 0.10 were actually causing the BGP session to
tear down. The answer is maybe in the fact that since version 0.10 a new
function called throw was added to the Net::BGP::Notification package:

sub throw {
    my $class = shift;
    my $notif = $class-&gt;new&#40;@_&#41;;
    die $notif;
}

Before version 0.10, everytime NetBGP detected an error, it was
instantiating directly a new Notification and nothing else particular
was done:

 $error = new Net::BGP::Notification&#40;
                ErrorCode    =&gt; BGP_ERROR_CODE_UPDATE_MESSAGE,
                ErrorSubCode =&gt; BGP_ERROR_SUBCODE_BAD_ATTR_LENGTH,
                ErrorData    =&gt; $error_data
            &#41;;

Since version 0.10, this code has been replaced by a call to this new
throw function:

    Net::BGP::Notification-&gt;throw&#40;
                ErrorCode    =&gt; BGP_ERROR_CODE_UPDATE_MESSAGE,
                ErrorSubCode =&gt; BGP_ERROR_SUBCODE_BAD_ATTR_LENGTH,
                ErrorData    =&gt; $error_data
            &#41;;

Which creates of course a new Notification to be instantiated but also
requests the current process to die, causing the BGP session to tear down.

I think that it is a little bit too strict for a BGP listener. As far as
I am concerned, the behaviour to adopt in that case should be
configurable by the user if Net::BGP intends to answer any specifics
purposes. For example, a typical use case of a BGP listener developped
with Net::BGP could be a BGP implementation validation tool that need to
be error-proof. 

Hope thise helps

Best Regards
Guillaume





Le Ven. Mai. 29 16:00:12 2009, Skewell a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BGP Update messages with Withdrawn prefix but empty Attributes and NLRI
&gt; will cause the Net::BGP to tear down the BGP session.
&gt; 
&gt; Consequence: the BGP session is restarted whenever some routes are
&gt; withdrawn without any new route announced, that happen within a few
&gt; minutes on a typical BGP session with Internet full routing.
&gt; 
&gt; The initial announce of 300k routes causes CPU load on both server and
&gt; routers.
&gt; 
&gt; Cause: Update.pm _decode_path_attributes checks that mandatory BGP
&gt; attributes are present, and of course that cannot work when the
&gt; attribute list is empty. So a BGP error is reported even though the
&gt; BGP message is perfectly valid.
&gt; 
&gt; Note: the bug is present in all versions of the lib, but may not cause
&gt; any trouble in older versions that did not check mandatory BGP attributes.
&gt; 
&gt; 
&gt; Quick fix: check that $length is above zero before calling
&gt; _decode_path_attributes and _decode_nlri
&gt; 
&gt; I don&#39;t provide a patch because I&#39;m not sure this is the right way to do
&gt; fix the bug, since I only use a little part of the API. 
&gt; But with that fix, the BGP sessions can last several hours without
</div>problems.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;09:39:41&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;15&nbsp;22:53:18&nbsp;2009</span>
    <span class="description">kbrint [...] rufus.net -  Correspondence added</span>
    <span class="time-taken">60 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Bug in Update.pm with empty NLRI and attributes</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> guillaume.lambert-geek [...] laposte.net, elisa.jasinska [...] ams-ix.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the bug reports.  Net::BGP v0.13 addresses this problem..  I&#39;ve just uploaded it 
to CPAN.  Please test and let me know if you find any problems.

Gillaume, I plan to add a special callback for the notification error in the next revision.  Stay 
tuned.

Thanks for your feedback.

  kevin

On Fri May 29 16:00:12 2009, Skewell wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BGP Update messages with Withdrawn prefix but empty Attributes and NLRI
&gt; will cause the Net::BGP to tear down the BGP session.
&gt; 
&gt; Consequence: the BGP session is restarted whenever some routes are
&gt; withdrawn without any new route announced, that happen within a few
&gt; minutes on a typical BGP session with Internet full routing.
&gt; 
&gt; The initial announce of 300k routes causes CPU load on both server and
&gt; routers.
&gt; 
&gt; Cause: Update.pm _decode_path_attributes checks that mandatory BGP
&gt; attributes are present, and of course that cannot work when the
&gt; attribute list is empty. So a BGP error is reported even though the
&gt; BGP message is perfectly valid.
&gt; 
&gt; Note: the bug is present in all versions of the lib, but may not cause
&gt; any trouble in older versions that did not check mandatory BGP attributes.
&gt; 
&gt; 
&gt; Quick fix: check that $length is above zero before calling
&gt; _decode_path_attributes and _decode_nlri
&gt; 
&gt; I don&#39;t provide a patch because I&#39;m not sure this is the right way to do
&gt; fix the bug, since I only use a little part of the API. 
&gt; But with that fix, the BGP sessions can last several hours without problems.
&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;15&nbsp;22:53:21&nbsp;2009</span>
    <span class="description">kbrint [...] rufus.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;28&nbsp;09:20:13&nbsp;2009</span>
    <span class="description">olivier.montanuy [...] m4x.org -  Broken in 0.10 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;28&nbsp;09:20:14&nbsp;2009</span>
    <span class="description">olivier.montanuy [...] m4x.org -  Fixed in 0.13 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;28&nbsp;09:34:49&nbsp;2009</span>
    <span class="description">olivier.montanuy [...] orange-ftgroup.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #46496] Re: Bug in Update.pm with empty NLRI and attributes - FIXED</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Jul 2009 15:34:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-BGP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;olivier.montanuy [...] orange-ftgroup.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just tested that 0.13 works fine with a 7200 and 324k Internet routes.
The 7200 announced all, then withdrew all routes, then re-announced them all. 
The BGP session did not fail, and the prefixes were learnt correctly.

Thanks a lot for the bug fix

 Olivier Montanuy


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Message d&#39;origine-----
&gt; De : kevin brintnall via RT [mailto:bug-Net-BGP@rt.cpan.org] 
&gt; Envoyé : jeudi 16 juillet 2009 04:53
&gt; À : olivier.montanuy@m4x.org
&gt; Objet : [rt.cpan.org #46496] Re: Bug in Update.pm with empty 
&gt; NLRI and attributes 
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46496">https://rt.cpan.org/Ticket/Display.html?id=46496</a></span> &gt;
&gt; 
&gt; Thank you for the bug reports.  Net::BGP v0.13 addresses this 
&gt; problem..  I&#39;ve just uploaded it to CPAN.  Please test and 
&gt; let me know if you find any problems.
&gt; 
&gt; Gillaume, I plan to add a special callback for the 
&gt; notification error in the next revision.  Stay tuned.
&gt; 
&gt; Thanks for your feedback.
&gt; 
&gt;   kevin
&gt; 
&gt; On Fri May 29 16:00:12 2009, Skewell wrote:
<div class="message-stanza open">&gt; &gt; BGP Update messages with Withdrawn prefix but empty Attributes and 
&gt; &gt; NLRI will cause the Net::BGP to tear down the BGP session.
&gt; &gt; 
&gt; &gt; Consequence: the BGP session is restarted whenever some routes are 
&gt; &gt; withdrawn without any new route announced, that happen within a few 
&gt; &gt; minutes on a typical BGP session with Internet full routing.
&gt; &gt; 
&gt; &gt; The initial announce of 300k routes causes CPU load on both 
</div>&gt; server and 
<div class="message-stanza open">&gt; &gt; routers.
&gt; &gt; 
&gt; &gt; Cause: Update.pm _decode_path_attributes checks that mandatory BGP 
&gt; &gt; attributes are present, and of course that cannot work when the 
&gt; &gt; attribute list is empty. So a BGP error is reported even though the 
&gt; &gt; BGP message is perfectly valid.
&gt; &gt; 
&gt; &gt; Note: the bug is present in all versions of the lib, but 
</div>&gt; may not cause 
<div class="message-stanza open">&gt; &gt; any trouble in older versions that did not check mandatory 
</div>&gt; BGP attributes.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; 
&gt; &gt; Quick fix: check that $length is above zero before calling 
&gt; &gt; _decode_path_attributes and _decode_nlri
&gt; &gt; 
&gt; &gt; I don&#39;t provide a patch because I&#39;m not sure this is the 
</div>&gt; right way to 
<div class="message-stanza open">&gt; &gt; do fix the bug, since I only use a little part of the API.
&gt; &gt; But with that fix, the BGP sessions can last several hours 
</div>&gt; without problems.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
</div>&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;28&nbsp;09:34:50&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;24&nbsp;11:46:29&nbsp;2009</span>
    <span class="description">kbrint [...] rufus.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;25&nbsp;14:13:23&nbsp;2009</span>
    <span class="description">omontanuy [...] orange.fr -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46496] Resolved: Bug in Update.pm with empty NLRI and attributes</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 Aug 2009 20:12:36 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-BGP [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Olivier Montanuy &lt;omontanuy [...] orange.fr&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">kevin brintnall via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46496">https://rt.cpan.org/Ticket/Display.html?id=46496</a></span> &gt;
&gt;
&gt; According to our records, your request has been resolved. If you have any
&gt; further questions or concerns, please respond to this message
</div>I don&#39;t understand this message, since I indicated one month ago that 
the bug was resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;25&nbsp;14:13:23&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;25&nbsp;15:17:35&nbsp;2009</span>
    <span class="description">kbrint [...] rufus.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Every email reply re-opens the ticket.  Please do not reply.  Marking
resolved again.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;25&nbsp;15:17:36&nbsp;2009</span>
    <span class="description">kbrint [...] rufus.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
