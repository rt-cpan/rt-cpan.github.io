<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #123749 for Perl-Tidy: Problem with promises</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #123749 for Perl-Tidy: Problem with promises</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Perl-Tidy">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Perl-Tidy">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Perl-Tidy">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Perl-Tidy">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Tidy">Perl-Tidy CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">123749</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Perl-Tidy">Perl-Tidy</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sri [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25260-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25261-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=123749">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1759853" href="/Public/Bug/Display.html?id=123749#txn-1759853">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;26&nbsp;08:25:09&nbsp;2017</span>
    <span class="description">sri [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem with promises</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1759853/947127/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947127">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The Mojolicious project has recently adopted promises and many of our users will soon be using them. Sadly it appears that perltidy can&#39;t handle the most commonly used -&gt;then constructs without making a bit of a mess.

    get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;sub {
      my $mojo = shift;
      say $mojo-&gt;res-&gt;code;
      return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
    }&#41;-&gt;then&#40;sub {
      my $cpan = shift;
      say $cpan-&gt;res-&gt;code;
    }&#41;-&gt;catch&#40;sub {
      my $err = shift;
      warn &#34;Something went wrong: $err&#34;;
    }&#41;-&gt;wait;

becomes

    get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
      sub {
        my $mojo = shift;
        say $mojo-&gt;res-&gt;code;
        return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
      }
      &#41;-&gt;then&#40;
      sub {
        my $cpan = shift;
        say $cpan-&gt;res-&gt;code;
      }
      &#41;-&gt;catch&#40;
      sub {
        my $err = shift;
        warn &#34;Something went wrong: $err&#34;;
      }
      &#41;-&gt;wait;

The project .perltidyrc is fairly unspectacular. We&#39;ve tried finding options that make the result a little better, but failed so far.

    <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kraih/mojo/blob/master/.perltidyrc">https://github.com/kraih/mojo/blob/master/.perltidyrc</a></span>

This is the result i would have expected.

    get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
      sub {
         my $mojo = shift;
        say $mojo-&gt;res-&gt;code;
        return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
      }
    &#41;-&gt;then&#40;
      sub {
        my $cpan = shift;
        say $cpan-&gt;res-&gt;code;
      }
    &#41;-&gt;catch&#40;
      sub {
        my $err = shift;
        warn &#34;Something went wrong: $err&#34;;
      }
    &#41;-&gt;wait;

Many in the community would prefer a result like the first example, which i realize might be close to impossible. Any improvements to formatting constructs like this would be greatly appreciated.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760006" href="/Public/Bug/Display.html?id=123749#txn-1760006">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;27&nbsp;05:53:37&nbsp;2017</span>
    <span class="description">JHTHORSEN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760006/947206/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947206">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 122b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">+1 on this. Would really like support for &#34;-&gt;then&#40;sub {&#34;, but any improvement from the current situation would be awesome!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760007" href="/Public/Bug/Display.html?id=123749#txn-1760007">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;27&nbsp;05:53:38&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760010" href="/Public/Bug/Display.html?id=123749#txn-1760010">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;27&nbsp;05:57:31&nbsp;2017</span>
    <span class="description">mramberg [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760010/947209/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947209">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 83b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Would really like to see support for this compact handling of callbacks in general.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760034" href="/Public/Bug/Display.html?id=123749#txn-1760034">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;27&nbsp;11:03:00&nbsp;2017</span>
    <span class="description">s7078hancock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #123749] Problem with promises</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Nov 2017 08:01:38 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Tidy [...] rt.cpan.org&#34; &lt;bug-Perl-Tidy [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;s7078hancock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760034/947224/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947224">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think I can fix this. There are two issues.  The first issue has to do
with manipulating the &#34;continuation indentation&#34; of lines, and the second
has to do with compacting the code.

FIRST ISSUE: In perltidy there are two types of indentation, structural
indentation specified by &#34;i=n1&#34; and continuation indentation specified by
&#34;ci=n2&#34;, where n1 and n2 are the number of spaces.  Structural indentation
is controlled by the nesting depth of braces and parens, and continuation
indentation is used to add spaces to the latter parts of a line when a line
broken because it exceeds the specified maximum line length.  N1 and n2 may
be any values, but it is recommended that n2 be about half of n1 to avoid
problems in complex code.

The default parameters are n1=4 and and n2=2 and give:

get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
    sub {
        my $mojo = shift;
        say $mojo-&gt;res-&gt;code;
        return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
    }
  &#41;-&gt;then&#40;
    sub {
        my $cpan = shift;
        say $cpan-&gt;res-&gt;code;
    }
  &#41;-&gt;catch&#40;
    sub {
        my $err = shift;
        warn &#34;Something went wrong: $err&#34;;
    }
  &#41;-&gt;wait;

[I don&#39;t know if my leading spaces will be correct in the email, but you
can reproduce this by turning off your default parameters with perltidy
-npro].

It looks like the snippet which was sent used n1=n2=2, and the equality of
these values causes the closing braces and parens to line up.  A
programming fix for this is to remove continuation indentation for lines of
the form &#34;&#41;-&gt;then&#40;&#34;.  I looked at the perltidy source code and saw that it
is actually supposed to be doing this but it is not because of a minor bug.
This bug will be corrected in the next release, currently scheduled for
early January.  With the corrected code the snippet will look okay for any
choice of n2.  For n1=2 it will be:

get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
  sub {
    my $mojo = shift;
    say $mojo-&gt;res-&gt;code;
    return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
  }
&#41;-&gt;then&#40;
  sub {
    my $cpan = shift;
    say $cpan-&gt;res-&gt;code;
  }
&#41;-&gt;catch&#40;
  sub {
    my $err = shift;
    warn &#34;Something went wrong: $err&#34;;
  }
&#41;-&gt;wait;

SECOND ISSUE: The second point is that some programmers prefer vertically
compact code and some  don&#39;t.  There are some vertical tightness flags in
perltidy which give some flexibility, but they do not work for this type of
code.  Programming this type of formatting is surprisingly tricky, but I
believe I can make a patch to handle this particular type of code.  If so,
it will be controlled by the existing vertical tightness flags.  I will try
to get this in the next release and will post a note here if I do.

It would help if someone could give me a link to a representative source of
this type of coding to use for testing.
Steve


On Sun, Nov 26, 2017 at 5:25 AM, Sebastian Riedel via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sun Nov 26 08:25:09 2017: Request 123749 was acted upon.
&gt; Transaction: Ticket created by SRI
&gt;        Queue: Perl-Tidy
&gt;      Subject: Problem with promises
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: sri@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt;
&gt;
&gt; The Mojolicious project has recently adopted promises and many of our
&gt; users will soon be using them. Sadly it appears that perltidy can&#39;t handle
&gt; the most commonly used -&gt;then constructs without making a bit of a mess.
&gt;
&gt;     get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;sub {
&gt;       my $mojo = shift;
&gt;       say $mojo-&gt;res-&gt;code;
&gt;       return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt;     }&#41;-&gt;then&#40;sub {
&gt;       my $cpan = shift;
&gt;       say $cpan-&gt;res-&gt;code;
&gt;     }&#41;-&gt;catch&#40;sub {
&gt;       my $err = shift;
&gt;       warn &#34;Something went wrong: $err&#34;;
&gt;     }&#41;-&gt;wait;
&gt;
&gt; becomes
&gt;
&gt;     get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
&gt;       sub {
&gt;         my $mojo = shift;
&gt;         say $mojo-&gt;res-&gt;code;
&gt;         return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt;       }
&gt;       &#41;-&gt;then&#40;
&gt;       sub {
&gt;         my $cpan = shift;
&gt;         say $cpan-&gt;res-&gt;code;
&gt;       }
&gt;       &#41;-&gt;catch&#40;
&gt;       sub {
&gt;         my $err = shift;
&gt;         warn &#34;Something went wrong: $err&#34;;
&gt;       }
&gt;       &#41;-&gt;wait;
&gt;
&gt; The project .perltidyrc is fairly unspectacular. We&#39;ve tried finding
&gt; options that make the result a little better, but failed so far.
&gt;
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kraih/mojo/blob/master/.perltidyrc">https://github.com/kraih/mojo/blob/master/.perltidyrc</a></span>
&gt;
&gt; This is the result i would have expected.
&gt;
&gt;     get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
&gt;       sub {
&gt;          my $mojo = shift;
&gt;         say $mojo-&gt;res-&gt;code;
&gt;         return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt;       }
&gt;     &#41;-&gt;then&#40;
&gt;       sub {
&gt;         my $cpan = shift;
&gt;         say $cpan-&gt;res-&gt;code;
&gt;       }
&gt;     &#41;-&gt;catch&#40;
&gt;       sub {
&gt;         my $err = shift;
&gt;         warn &#34;Something went wrong: $err&#34;;
&gt;       }
&gt;     &#41;-&gt;wait;
&gt;
&gt; Many in the community would prefer a result like the first example, which
&gt; i realize might be close to impossible. Any improvements to formatting
&gt; constructs like this would be greatly appreciated.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760034/947225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947225">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760837" href="/Public/Bug/Display.html?id=123749#txn-1760837">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;02&nbsp;08:23:47&nbsp;2017</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760837/947665/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947665">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think I can fix this. There are two issues.  The first issue has to do
&gt; with manipulating the &#34;continuation indentation&#34; of lines, and the second
&gt; has to do with compacting the code.
</div>
Thank you, can&#39;t wait for the next release!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It would help if someone could give me a link to a representative source of
&gt; this type of coding to use for testing.
</div>
This is a little tricky right now. Since all Mojolicious code is required to run
through perltidy we use workarounds without method chains in actual code,
like this:

    my $promise  = Mojo::Promise-&gt;new;
    my $promise2 = $promise-&gt;then&#40;
      sub {
        ...
      }
    &#41;;
    $promise2-&gt;catch&#40;
      sub {
      ...
      }
    &#41;;

Aside from the case that started all of this, and which has some more variations
in the Mojo::Promise documentation &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org/perldoc/Mojo/Promise#SYNOPSIS&#41;">http://mojolicious.org/perldoc/Mojo/Promise#SYNOPSIS&#41;</a></span>,
there are four more cases i can think of right now:

    # First: two closures
    $promise-&gt;then&#40;sub {
      my @value = @_;
      say &#34;The result is $value[0]&#34;;
      return @value;
    },
    sub {
      my @reason = @_;
      warn &#34;Something went wrong: $reason[0]&#34;;
      return @reason;
    }&#41;;

    # Second: mixed arguments
    $promise-&gt;then&#40;
      undef,
      sub {
        my @reason = @_;
        warn &#34;Something went wrong: $reason[0]&#34;;
        return @reason;
      }
    &#41;;

    # Third: mixed arguments with fat comma
    $e-&gt;on&#40;test =&gt; sub {
      my &#40;$e, $foo&#41; = @_;
      say $foo;
    }&#41;;

    # Fourth: mixed arguments with multiple fat commas
    $e-&gt;on&#40;
      test =&gt; sub {
        my &#40;$e, $foo&#41; = @_;
        say $foo;
      },
      test2 =&gt; sub {
        my &#40;$e, $bar&#41; = @_;
        say $bar;
      }
    &#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760839" href="/Public/Bug/Display.html?id=123749#txn-1760839">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;02&nbsp;08:35:12&nbsp;2017</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760839/947667/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947667">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 651b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # First: two closures
&gt; $promise-&gt;then&#40;sub {
&gt;   my @value = @_;
&gt;   say &#34;The result is $value[0]&#34;;
&gt;   return @value;
&gt; },
&gt; sub {
&gt;   my @reason = @_;
&gt;   warn &#34;Something went wrong: $reason[0]&#34;;
&gt;   return @reason;
&gt; }&#41;;
</div>
Honestly, i&#39;m not even sure if this is the right way to present this kind
of code.

    $promise-&gt;then&#40;
      sub {
        my @value = @_;
        say &#34;The result is $value[0]&#34;;
        return @value;
      },
      sub {
        my @reason = @_;
        warn &#34;Something went wrong: $reason[0]&#34;;
        return @reason;
      }
    &#41;;

While i do like vertical tightness a lot, it does feel more correct
formatted this way.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760861" href="/Public/Bug/Display.html?id=123749#txn-1760861">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;02&nbsp;13:08:24&nbsp;2017</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760861/947675/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947675">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 302b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I looked at the perltidy source code and saw that it
&gt; is actually supposed to be doing this but it is not because of a minor bug.
&gt; This bug will be corrected in the next release, currently scheduled for
&gt; early January.
</div>
Is the code publicly available somewhere? GitHub? I&#39;d really like to test it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760878" href="/Public/Bug/Display.html?id=123749#txn-1760878">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;02&nbsp;17:34:36&nbsp;2017</span>
    <span class="description">s7078hancock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #123749] Problem with promises</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 2 Dec 2017 14:34:25 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Tidy [...] rt.cpan.org&#34; &lt;bug-Perl-Tidy [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;s7078hancock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760878/947686/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947686">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m afraid not. But I can move the release date up to Dec 14 to get it out
sooner. I think I&#39;m done coding and just have to run a lot more tests.  I&#39;m
using the Promises
code for testing, and Perl/TK code is also good for testing. There is a new
flag to control the &#34;tightness&#34; of chained method calls which I am
tentatively calling
&#39;method-chain-tightness&#39; for lack of a better word.

mct=0 default &#40;least tight; &#41;-&gt;then&#40; on single line

mct=2 tight:  &#41;-&gt;then&#40; joins with previous } and following anonymous sub

mct=1 follows example of input file

The default setting of least tight looks pretty good on all code I&#39;ve
tested so far. The tighter calls with mct=2
look good in simple cases such as Example 1 below but run into trouble with
complex code, such as when a method takes more than one anonymous sub as
argument as in Example 2 below.  It&#39;s hard to fix that.
So the tight version is probably only useful when working with a certain
limited type of chained method calls.

The flag value mct=1 follows the input line breaks and might be useful for
someone who wants more control.

Also, the separate closing and opening &#34;tightnesses&#34; can be individually
controlled if desired.


EXAMPLE 1 with default, mct=0

get&#40; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39; &#41;-&gt;then&#40;
    sub {
        my $mojo = shift;
        say $mojo-&gt;res-&gt;code;
        return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
    }
&#41;-&gt;then&#40;
    sub {
        my $cpan = shift;
        say $cpan-&gt;res-&gt;code;
    }
&#41;-&gt;catch&#40;
    sub {
        my $err = shift;
        warn &#34;Something went wrong: $err&#34;;
    }
&#41;-&gt;wait;

EXAMPLE 1 with perltidy -mct=2

get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40; sub {
        my $mojo = shift;
        say $mojo-&gt;res-&gt;code;
        return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
} &#41;-&gt;then&#40; sub {
        my $cpan = shift;
        say $cpan-&gt;res-&gt;code;
} &#41;-&gt;catch&#40; sub {
        my $err = shift;
        warn &#34;Something went wrong: $err&#34;;
} &#41;-&gt;wait;

Example 2 with default parameters:

fetch_it&#40;
    &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=opensearch&#38;format=json&#38;search=">http://en.wikipedia.org/w/api.php?action=opensearch&#38;format=json&#38;search=</a></span>
&#39;
      . url_encode&#40; $ARGV[0] &#41; &#41;-&gt;then&#40;
    sub {
        my $data = shift;
        collect&#40;
            map {
                fetch_it&#40;
&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;">http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;</a></span>
                      . url_encode&#40;$_&#41;
                      . &#39;&#38;prop=info&#38;inprop=url&#39; &#41;
            } @{ $data-&gt;[1] }
        &#41;;
    },
    sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; }
&#41;-&gt;then&#40;
    sub {
        $cv-&gt;send&#40;
            map {
                &#40; values %{ $_-&gt;[0]-&gt;{&#39;query&#39;}-&gt;{&#39;pages&#39;} }
&#41;[0]-&gt;{&#39;fullurl&#39;}
            } @_
        &#41;;
    },
    sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; }
&#41;;


Example2 with perltidy -mct=2

fetch_it&#40;
    &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=opensearch&#38;format=json&#38;search=">http://en.wikipedia.org/w/api.php?action=opensearch&#38;format=json&#38;search=</a></span>
&#39;
      . url_encode&#40; $ARGV[0] &#41; &#41;-&gt;then&#40; sub {
        my $data = shift;
        collect&#40;
            map {
                fetch_it&#40;
&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;">http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;</a></span>
                      . url_encode&#40;$_&#41;
                      . &#39;&#38;prop=info&#38;inprop=url&#39; &#41;
            } @{ $data-&gt;[1] }
        &#41;;
      },
    sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; } &#41;-&gt;then&#40; sub {
        $cv-&gt;send&#40;
            map {
                &#40; values %{ $_-&gt;[0]-&gt;{&#39;query&#39;}-&gt;{&#39;pages&#39;} }
&#41;[0]-&gt;{&#39;fullurl&#39;}
            } @_
        &#41;;
    },
    sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; } &#41;;

Steve

On Sat, Dec 2, 2017 at 10:08 AM, Sebastian Riedel via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Perl-Tidy
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt;
<div class="message-stanza open">&gt; &gt; I looked at the perltidy source code and saw that it
&gt; &gt; is actually supposed to be doing this but it is not because of a minor
</div>&gt; bug.
<div class="message-stanza open">&gt; &gt; This bug will be corrected in the next release, currently scheduled for
&gt; &gt; early January.
</div>&gt;
&gt; Is the code publicly available somewhere? GitHub? I&#39;d really like to test
&gt; it.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760878/947687/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947687">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1760881" href="/Public/Bug/Display.html?id=123749#txn-1760881">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;02&nbsp;17:53:27&nbsp;2017</span>
    <span class="description">s7078hancock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #123749] Problem with promises</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 2 Dec 2017 14:53:16 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Tidy [...] rt.cpan.org&#34; &lt;bug-Perl-Tidy [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;s7078hancock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760881/947691/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947691">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Some extra line breaks found their way into the last snippet of my email.
It isn&#39;t quite that bad.
Steve

On Sat, Dec 2, 2017 at 2:34 PM, Steven Hancock via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Perl-Tidy
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt;
&gt; I&#39;m afraid not. But I can move the release date up to Dec 14 to get it out
&gt; sooner. I think I&#39;m done coding and just have to run a lot more tests.  I&#39;m
&gt; using the Promises
&gt; code for testing, and Perl/TK code is also good for testing. There is a new
&gt; flag to control the &#34;tightness&#34; of chained method calls which I am
&gt; tentatively calling
&gt; &#39;method-chain-tightness&#39; for lack of a better word.
&gt;
&gt; mct=0 default &#40;least tight; &#41;-&gt;then&#40; on single line
&gt;
&gt; mct=2 tight:  &#41;-&gt;then&#40; joins with previous } and following anonymous sub
&gt;
&gt; mct=1 follows example of input file
&gt;
&gt; The default setting of least tight looks pretty good on all code I&#39;ve
&gt; tested so far. The tighter calls with mct=2
&gt; look good in simple cases such as Example 1 below but run into trouble with
&gt; complex code, such as when a method takes more than one anonymous sub as
&gt; argument as in Example 2 below.  It&#39;s hard to fix that.
&gt; So the tight version is probably only useful when working with a certain
&gt; limited type of chained method calls.
&gt;
&gt; The flag value mct=1 follows the input line breaks and might be useful for
&gt; someone who wants more control.
&gt;
&gt; Also, the separate closing and opening &#34;tightnesses&#34; can be individually
&gt; controlled if desired.
&gt;
&gt;
&gt; EXAMPLE 1 with default, mct=0
&gt;
&gt; get&#40; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39; &#41;-&gt;then&#40;
&gt;     sub {
&gt;         my $mojo = shift;
&gt;         say $mojo-&gt;res-&gt;code;
&gt;         return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt;     }
&gt; &#41;-&gt;then&#40;
&gt;     sub {
&gt;         my $cpan = shift;
&gt;         say $cpan-&gt;res-&gt;code;
&gt;     }
&gt; &#41;-&gt;catch&#40;
&gt;     sub {
&gt;         my $err = shift;
&gt;         warn &#34;Something went wrong: $err&#34;;
&gt;     }
&gt; &#41;-&gt;wait;
&gt;
&gt; EXAMPLE 1 with perltidy -mct=2
&gt;
&gt; get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40; sub {
&gt;         my $mojo = shift;
&gt;         say $mojo-&gt;res-&gt;code;
&gt;         return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt; } &#41;-&gt;then&#40; sub {
&gt;         my $cpan = shift;
&gt;         say $cpan-&gt;res-&gt;code;
&gt; } &#41;-&gt;catch&#40; sub {
&gt;         my $err = shift;
&gt;         warn &#34;Something went wrong: $err&#34;;
&gt; } &#41;-&gt;wait;
&gt;
&gt; Example 2 with default parameters:
&gt;
&gt; fetch_it&#40;
&gt;     &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=opensearch&#38;">http://en.wikipedia.org/w/api.php?action=opensearch&#38;</a></span>
&gt; format=json&#38;search=
&gt; &#39;
&gt;       . url_encode&#40; $ARGV[0] &#41; &#41;-&gt;then&#40;
&gt;     sub {
&gt;         my $data = shift;
&gt;         collect&#40;
&gt;             map {
&gt;                 fetch_it&#40;
&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;">http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;</a></span>
&gt;                       . url_encode&#40;$_&#41;
&gt;                       . &#39;&#38;prop=info&#38;inprop=url&#39; &#41;
&gt;             } @{ $data-&gt;[1] }
&gt;         &#41;;
&gt;     },
&gt;     sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; }
&gt; &#41;-&gt;then&#40;
&gt;     sub {
&gt;         $cv-&gt;send&#40;
&gt;             map {
&gt;                 &#40; values %{ $_-&gt;[0]-&gt;{&#39;query&#39;}-&gt;{&#39;pages&#39;} }
&gt; &#41;[0]-&gt;{&#39;fullurl&#39;}
&gt;             } @_
&gt;         &#41;;
&gt;     },
&gt;     sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; }
&gt; &#41;;
&gt;
&gt;
&gt; Example2 with perltidy -mct=2
&gt;
&gt; fetch_it&#40;
&gt;     &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=opensearch&#38;">http://en.wikipedia.org/w/api.php?action=opensearch&#38;</a></span>
&gt; format=json&#38;search=
&gt; &#39;
&gt;       . url_encode&#40; $ARGV[0] &#41; &#41;-&gt;then&#40; sub {
&gt;         my $data = shift;
&gt;         collect&#40;
&gt;             map {
&gt;                 fetch_it&#40;
&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;">http://en.wikipedia.org/w/api.php?action=query&#38;format=json&#38;titles=&#39;</a></span>
&gt;                       . url_encode&#40;$_&#41;
&gt;                       . &#39;&#38;prop=info&#38;inprop=url&#39; &#41;
&gt;             } @{ $data-&gt;[1] }
&gt;         &#41;;
&gt;       },
&gt;     sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; } &#41;-&gt;then&#40; sub {
&gt;         $cv-&gt;send&#40;
&gt;             map {
&gt;                 &#40; values %{ $_-&gt;[0]-&gt;{&#39;query&#39;}-&gt;{&#39;pages&#39;} }
&gt; &#41;[0]-&gt;{&#39;fullurl&#39;}
&gt;             } @_
&gt;         &#41;;
&gt;     },
&gt;     sub { $cv-&gt;croak&#40;&#39;ERROR&#39;&#41; } &#41;;
&gt;
&gt; Steve
&gt;
&gt; On Sat, Dec 2, 2017 at 10:08 AM, Sebastian Riedel via RT &lt;
&gt; bug-Perl-Tidy@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt;        Queue: Perl-Tidy
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; I looked at the perltidy source code and saw that it
&gt; &gt; &gt; is actually supposed to be doing this but it is not because of a minor
</div>&gt; &gt; bug.
<div class="message-stanza open">&gt; &gt; &gt; This bug will be corrected in the next release, currently scheduled for
&gt; &gt; &gt; early January.
</div>&gt; &gt;
&gt; &gt; Is the code publicly available somewhere? GitHub? I&#39;d really like to test
&gt; &gt; it.
&gt; &gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1760881/947692/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/947692">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1762171" href="/Public/Bug/Display.html?id=123749#txn-1762171">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;14&nbsp;09:42:10&nbsp;2017</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1762171/948365/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/948365">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 769b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Version 20171214 has a fix to remove continuation indentation at lines
such as &#39;&#41;-&gt;then&#40;&#39;.  This will help make the structure clearer in most cases.
For example:

# perltidy -i=2 -ci=2
get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
  sub {
    my $mojo = shift;
    say $mojo-&gt;res-&gt;code;
    return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
  }
&#41;-&gt;then&#40;
  sub {
    my $cpan = shift;
    say $cpan-&gt;res-&gt;code;
  }
&#41;-&gt;catch&#40;
  sub {
    my $err = shift;
    warn &#34;Something went wrong: $err&#34;;
  }
&#41;-&gt;wait;

A new flag to make compact coding turns out to be straightforward but must to be 
postponed to the next release because it requires some reorganization of perltidy to 
allow another pass through the source code to do it correctly in all cases.  
I hope to release it in about two months.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1762202" href="/Public/Bug/Display.html?id=123749#txn-1762202">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;14&nbsp;13:49:44&nbsp;2017</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1762202/948385/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/948385">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 561b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Version 20171214 has a fix to remove continuation indentation at lines
&gt; such as &#39;&#41;-&gt;then&#40;&#39;.  This will help make the structure clearer in most
&gt; cases.
&gt; For example:
&gt; 
&gt; # perltidy -i=2 -ci=2
&gt; get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40;
&gt;   sub {
&gt;     my $mojo = shift;
&gt;     say $mojo-&gt;res-&gt;code;
&gt;     return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt;   }
&gt; &#41;-&gt;then&#40;
&gt;   sub {
&gt;     my $cpan = shift;
&gt;     say $cpan-&gt;res-&gt;code;
&gt;   }
&gt; &#41;-&gt;catch&#40;
&gt;   sub {
&gt;     my $err = shift;
&gt;     warn &#34;Something went wrong: $err&#34;;
&gt;   }
&gt; &#41;-&gt;wait;
</div>
Thank you, very much appreciated!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1763788" href="/Public/Bug/Display.html?id=123749#txn-1763788">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;31&nbsp;10:54:49&nbsp;2017</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1763788/949213/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949213">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 479b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Use the flag -wn &#40;--weld-nested_containers&#41; in version 20180101. For example:

# perltidy -wn
get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40; sub {
    my $mojo = shift;
    say $mojo-&gt;res-&gt;code;
    return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
} &#41;-&gt;then&#40; sub {
    my $cpan = shift;
    say $cpan-&gt;res-&gt;code;
} &#41;-&gt;catch&#40; sub {
    my $err = shift;
    warn &#34;Something went wrong: $err&#34;;
} &#41;-&gt;wait;

This flag should handle all variations in a reasonable way. The man page has more information.
Steve
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1763790" href="/Public/Bug/Display.html?id=123749#txn-1763790">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;31&nbsp;10:54:50&nbsp;2017</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1764178" href="/Public/Bug/Display.html?id=123749#txn-1764178">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;03&nbsp;08:14:47&nbsp;2018</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764178/949429/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949429">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 872b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am So 31. Dez 2017, 10:54:49, SHANCOCK schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Use the flag -wn &#40;--weld-nested_containers&#41; in version 20180101. For
&gt; example:
&gt; 
&gt; # perltidy -wn
&gt; get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40; sub {
&gt;     my $mojo = shift;
&gt;     say $mojo-&gt;res-&gt;code;
&gt;     return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt; } &#41;-&gt;then&#40; sub {
&gt;     my $cpan = shift;
&gt;     say $cpan-&gt;res-&gt;code;
&gt; } &#41;-&gt;catch&#40; sub {
&gt;     my $err = shift;
&gt;     warn &#34;Something went wrong: $err&#34;;
&gt; } &#41;-&gt;wait;
&gt; 
&gt; This flag should handle all variations in a reasonable way. The man
&gt; page has more information.
&gt; Steve
</div>
I ran perltidy with the new -wn flag against all of Mojolicious, and it appears we&#39;ve stumbled over a bug.

    <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kraih/mojo/commit/b815d5666f2b255e2914363d05fc6c80f2ccd9aa#diff-8a580e4a5afea12ec1e70217519b306aL208">https://github.com/kraih/mojo/commit/b815d5666f2b255e2914363d05fc6c80f2ccd9aa#diff-8a580e4a5afea12ec1e70217519b306aL208</a></span>

It now completely removes the indentation from such continuation lines.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1764180" href="/Public/Bug/Display.html?id=123749#txn-1764180">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;03&nbsp;08:14:51&nbsp;2018</span>
    <span class="description">sri [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1764181" href="/Public/Bug/Display.html?id=123749#txn-1764181">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;03&nbsp;09:14:51&nbsp;2018</span>
    <span class="description">s7078hancock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #123749] Problem with promises</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Jan 2018 06:14:20 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Tidy [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;s7078hancock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764181/949432/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949432">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sebastian, I&#39;m not quite following you, can you clarify this?
Steve

On Wed, Jan 3, 2018 at 5:14 AM, Sebastian Riedel via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Perl-Tidy
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt;
&gt; Am So 31. Dez 2017, 10:54:49, SHANCOCK schrieb:
<div class="message-stanza open">&gt; &gt; Use the flag -wn &#40;--weld-nested_containers&#41; in version 20180101. For
&gt; &gt; example:
&gt; &gt;
&gt; &gt; # perltidy -wn
&gt; &gt; get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://mojolicious.org">http://mojolicious.org</a></span>&#39;&#41;-&gt;then&#40; sub {
&gt; &gt;     my $mojo = shift;
&gt; &gt;     say $mojo-&gt;res-&gt;code;
&gt; &gt;     return get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org">http://metacpan.org</a></span>&#39;&#41;;
&gt; &gt; } &#41;-&gt;then&#40; sub {
&gt; &gt;     my $cpan = shift;
&gt; &gt;     say $cpan-&gt;res-&gt;code;
&gt; &gt; } &#41;-&gt;catch&#40; sub {
&gt; &gt;     my $err = shift;
&gt; &gt;     warn &#34;Something went wrong: $err&#34;;
&gt; &gt; } &#41;-&gt;wait;
&gt; &gt;
&gt; &gt; This flag should handle all variations in a reasonable way. The man
&gt; &gt; page has more information.
&gt; &gt; Steve
</div>&gt;
&gt; I ran perltidy with the new -wn flag against all of Mojolicious, and it
&gt; appears we&#39;ve stumbled over a bug.
&gt;
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kraih/mojo/commit/b815d5666f2b255e2914363d05fc6c">https://github.com/kraih/mojo/commit/b815d5666f2b255e2914363d05fc6c</a></span>
&gt; 80f2ccd9aa#diff-8a580e4a5afea12ec1e70217519b306aL208
&gt;
&gt; It now completely removes the indentation from such continuation lines.
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764181/949433/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949433">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1764312" href="/Public/Bug/Display.html?id=123749#txn-1764312">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;03&nbsp;20:43:23&nbsp;2018</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764312/949525/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949525">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 250b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sebastian, I&#39;m not quite following you, can you clarify this?
</div>
I can&#39;t imagine it&#39;s supposed to generate these two lines without any indentation.

    $headers-&gt;from_hash&#40;
    {&#39;X-Test&#39; =&gt; [23, 24], &#39;X-Test2&#39; =&gt; &#39;foo&#39;, Connection =&gt; [&#39;a&#39;, &#39;b&#39;]}&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1764325" href="/Public/Bug/Display.html?id=123749#txn-1764325">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;03&nbsp;21:32:29&nbsp;2018</span>
    <span class="description">s7078hancock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #123749] Problem with promises</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Jan 2018 18:32:20 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Tidy [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;s7078hancock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764325/949534/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949534">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, I see. This is a glitch in which the -wn logic is in conflict with
logic which tries to keep long one-line blocks, such as
{&#39;X-Test&#39; =&gt; [23, 24], &#39;X-Test2&#39; =&gt; &#39;foo&#39;, Connection =&gt; [&#39;a&#39;, &#39;b&#39;]}. I
also noticed it in testing too and will work out
a fix. It generally only happens with two lines of code.

If you do not use -iob &#40;--ignore-old-breakpoints&#41; and the inner block is
broken in the input to perltidy in any way, such as

$headers-&gt;from_hash&#40;
    {&#39;X-Test&#39; =&gt; [23, 24], &#39;X-Test2&#39; =&gt; &#39;foo&#39;,
Connection =&gt; [&#39;a&#39;, &#39;b&#39;]}&#41;

They the block will stay broken with -wn and you will get:

perltidy -wn
$headers-&gt;from_hash&#40; {
    &#39;X-Test&#39;   =&gt; [ 23,  24 ],
    &#39;X-Test2&#39;  =&gt; &#39;foo&#39;,
    Connection =&gt; [ &#39;a&#39;, &#39;b&#39; ]
} &#41;

And this result is stable.  However, if you don&#39;t let perltidy see old
breakpoints it will try to form the one line block
and give the first result.

The fix will be to ignore the one-line block rule when the block is part of
a weld.
Steve


On Wed, Jan 3, 2018 at 5:43 PM, Sebastian Riedel via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Perl-Tidy
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt;
<div class="message-stanza open">&gt; &gt; Sebastian, I&#39;m not quite following you, can you clarify this?
</div>&gt;
&gt; I can&#39;t imagine it&#39;s supposed to generate these two lines without any
&gt; indentation.
&gt;
&gt;     $headers-&gt;from_hash&#40;
&gt;     {&#39;X-Test&#39; =&gt; [23, 24], &#39;X-Test2&#39; =&gt; &#39;foo&#39;, Connection =&gt; [&#39;a&#39;, &#39;b&#39;]}&#41;;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764325/949535/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949535">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1764330" href="/Public/Bug/Display.html?id=123749#txn-1764330">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;03&nbsp;21:44:43&nbsp;2018</span>
    <span class="description">s7078hancock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #123749] Problem with promises</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Jan 2018 18:44:33 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Tidy [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;s7078hancock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764330/949541/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949541">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The fix for this was trivial and it will be in the next release.
Steve

On Wed, Jan 3, 2018 at 6:32 PM, Steven Hancock via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Perl-Tidy
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt;
&gt; OK, I see. This is a glitch in which the -wn logic is in conflict with
&gt; logic which tries to keep long one-line blocks, such as
&gt; {&#39;X-Test&#39; =&gt; [23, 24], &#39;X-Test2&#39; =&gt; &#39;foo&#39;, Connection =&gt; [&#39;a&#39;, &#39;b&#39;]}. I
&gt; also noticed it in testing too and will work out
&gt; a fix. It generally only happens with two lines of code.
&gt;
&gt; If you do not use -iob &#40;--ignore-old-breakpoints&#41; and the inner block is
&gt; broken in the input to perltidy in any way, such as
&gt;
&gt; $headers-&gt;from_hash&#40;
&gt;     {&#39;X-Test&#39; =&gt; [23, 24], &#39;X-Test2&#39; =&gt; &#39;foo&#39;,
&gt; Connection =&gt; [&#39;a&#39;, &#39;b&#39;]}&#41;
&gt;
&gt; They the block will stay broken with -wn and you will get:
&gt;
&gt; perltidy -wn
&gt; $headers-&gt;from_hash&#40; {
&gt;     &#39;X-Test&#39;   =&gt; [ 23,  24 ],
&gt;     &#39;X-Test2&#39;  =&gt; &#39;foo&#39;,
&gt;     Connection =&gt; [ &#39;a&#39;, &#39;b&#39; ]
&gt; } &#41;
&gt;
&gt; And this result is stable.  However, if you don&#39;t let perltidy see old
&gt; breakpoints it will try to form the one line block
&gt; and give the first result.
&gt;
&gt; The fix will be to ignore the one-line block rule when the block is part of
&gt; a weld.
&gt; Steve
&gt;
&gt;
&gt; On Wed, Jan 3, 2018 at 5:43 PM, Sebastian Riedel via RT &lt;
&gt; bug-Perl-Tidy@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt;        Queue: Perl-Tidy
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=123749">https://rt.cpan.org/Ticket/Display.html?id=123749</a></span> &gt;
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; Sebastian, I&#39;m not quite following you, can you clarify this?
</div>&gt; &gt;
&gt; &gt; I can&#39;t imagine it&#39;s supposed to generate these two lines without any
&gt; &gt; indentation.
&gt; &gt;
&gt; &gt;     $headers-&gt;from_hash&#40;
&gt; &gt;     {&#39;X-Test&#39; =&gt; [23, 24], &#39;X-Test2&#39; =&gt; &#39;foo&#39;, Connection =&gt; [&#39;a&#39;,
</div>&gt; &#39;b&#39;]}&#41;;
<div class="message-stanza open">&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1764330/949542/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949542">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771813" href="/Public/Bug/Display.html?id=123749#txn-1771813">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;14:44:55&nbsp;2018</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1771813/953435/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/953435">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 52b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The -wn option has been improved in version 20180219
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771815" href="/Public/Bug/Display.html?id=123749#txn-1771815">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;14:44:55&nbsp;2018</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.965078</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
