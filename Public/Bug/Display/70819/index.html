<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70819 for DBD-Oracle: AL32UTF8 Strings Should be Decoded, not just Flagged utf8</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70819 for DBD-Oracle: AL32UTF8 Strings Should be Decoded, not just Flagged utf8</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/pythian/DBD-Oracle/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Oracle">DBD-Oracle CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70819</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-Oracle/Active/">DBD-Oracle</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dwheeler [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10192-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10193-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;16:31:08&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> AL32UTF8 Strings Should be Decoded, not just Flagged utf8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 Sep 2011 13:30:55 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The DBD::Oracle docs state:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Any data returned from Oracle to DBD::Oracle in the AL32UTF8 character set will be marked as UTF-8 to ensure correct handling by Perl.
&gt; 
&gt; For Oracle to return data in the AL32UTF8 character set the NLS_LANG or NLS_NCHAR environment variable must be set as described in the previous section.
</div>
I&#39;ve recently written an app that connects to an Oracle 9 server with code like this:

    BEGIN {
        $ENV{NLS_LANG} = &#39;AMERICAN_AMERICA.AL32UTF8&#39;;
    }

    my $dbh = DBI-&gt;connect&#40;&#34;dbi:Oracle:$sid&#34;, $username, $password, {
        RaiseError =&gt; 1,
        PrintError =&gt; 0,
        AutoCommit =&gt; 0,
    }&#41;;

With this pattern, I text data fetched from the database does in fact have the utf8 flag enabled on the appropriate values. However, not all text data returned from the database is in fact UTF-8. So yes, I&#39;ve told DBD::Oracle that the data should be UTF-8, but Oracle itself sometimes has other opinions.

The upshot is that I can end up with text values with the utf8 flag enabled but that contain invalid UTF-8. I suspect that this is because DBD::Oracle simply turns on that flag, rather than using Perl&#39;s Unicode API to *decode* the text.

In other words, I think that DBD::Oracle does the equivalent of this in C:

    Encode::_utf8_on&#40;$value&#41;;

When what it should be doing is something like this:

    $value = Encode::decode&#40;&#39;UTF-8&#39;, $value, Encode::FB_CROAK&#41;;

This would ensure that the data was, in fact, UTF-8, and would die if it was not. It also would be better because Perl&#39;s internal representation, known as &#34;utf8&#34;, is not the same as UTF-8 &#40;it&#39;s more relaxed about what it considers UTF-8&#41;.

More details on Unicode gotchas are cataloged here:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/6162484/why-does-modern-perl-avoid-utf-8-by-default/6163129#6163129">http://stackoverflow.com/questions/6162484/why-does-modern-perl-avoid-utf-8-by-default/6163129#6163129</a></span>

FWIW, I&#39;m currently working around this bug by turning off the utf8 flag and decoding myself:

    my @encodings = map { find_encoding $_ } qw&#40;utf-8 cp1252 iso-8859-1&#41;;

    if &#40;defined $value&#41; {
        # DBD::Oracle turns on utf8 without validating.
        Encode::_utf8_off&#40;$value&#41;;

          # We need to decode the value.
          my $found = 0;
          for my $enc &#40;@encodings&#41; {
              local $@;
              eval { $value = $enc-&gt;decode&#40;$value, Encode::FB_CROAK&#41; };
              next if $@;
              $found = 1;
              last;
          }
          die &#34;Cannot decode $value&#34; unless $found;
    }

Fortunately our strings are broken in particular ways &#40;encoded as CP1252 or latin-1 when not properly UTF-8&#41; so this is fine for me. But I do think that naïvely turning on the utf8 flag is not the proper way to handle UTF-8 values fetched from the database.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;17:09:19&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

On Thu Sep 08 16:31:08 2011, DWHEELER wrote:
[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In other words, I think that DBD::Oracle does the equivalent of this
&gt;    in C:
&gt; 
&gt;     Encode::_utf8_on&#40;$value&#41;;
&gt; 
&gt; When what it should be doing is something like this:
&gt; 
&gt;     $value = Encode::decode&#40;&#39;UTF-8&#39;, $value, Encode::FB_CROAK&#41;;
</div>
Gotcha. At first read, it makes sense. I began to look at the code that
seems to be doing that &#40;around line 454 of Oracle.xs&#41;, but I&#39;ll need
more coffee and sacrifices to the dark gods before I have a clear view
of what to do. I&#39;ll try to keep the CR ticket updated with my findings.
Wish me luck. :-&#41;

`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;17:09:20&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;04:29:47&nbsp;2011</span>
    <span class="description">Tim.Bunce [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70819] AL32UTF8 Strings Should be Decoded, not just Flagged utf8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 9 Sep 2011 09:29:23 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pythian Remote DBA via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Sep 08, 2011 at 05:09:19PM -0400, Pythian Remote DBA via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Sep 08 16:31:08 2011, DWHEELER wrote:
&gt; [...]
<div class="message-stanza open">&gt; &gt; In other words, I think that DBD::Oracle does the equivalent of this
&gt; &gt;    in C:
&gt; &gt;     Encode::_utf8_on&#40;$value&#41;;
&gt; &gt; When what it should be doing is something like this:
&gt; &gt;     $value = Encode::decode&#40;&#39;UTF-8&#39;, $value, Encode::FB_CROAK&#41;;
</div>&gt; 
&gt; Gotcha. At first read, it makes sense. I began to look at the code that
&gt; seems to be doing that &#40;around line 454 of Oracle.xs&#41;, but I&#39;ll need
&gt; more coffee and sacrifices to the dark gods before I have a clear view
&gt; of what to do. I&#39;ll try to keep the CR ticket updated with my findings.
&gt; Wish me luck. :-&#41;
</div>
I&#39;m a little skeptical about this issue.

Firstly the performance impact will be very high.
Secondly the bytes in a AL32UTF8 character string stored in Oracle
should be valid and if it&#39;s not then it&#39;s Oracle&#39;s fault.

It seems like you&#39;re asking DBD::Oracle, and all it&#39;s users, to
do checking that Oracle should have done itself.

I&#39;d like to see a test case that reproduces the problem first.

Tim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;06:15:20&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 08 17:09:19 2011, PYTHIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi David,
&gt; 
&gt; On Thu Sep 08 16:31:08 2011, DWHEELER wrote:
&gt; [...]
<div class="message-stanza open">&gt; &gt; In other words, I think that DBD::Oracle does the equivalent of this
&gt; &gt;    in C:
&gt; &gt; 
&gt; &gt;     Encode::_utf8_on&#40;$value&#41;;
&gt; &gt; 
&gt; &gt; When what it should be doing is something like this:
&gt; &gt; 
&gt; &gt;     $value = Encode::decode&#40;&#39;UTF-8&#39;, $value, Encode::FB_CROAK&#41;;
</div>&gt; 
&gt; Gotcha. At first read, it makes sense. I began to look at the code 
</div>that
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; seems to be doing that &#40;around line 454 of Oracle.xs&#41;, but I&#39;ll need
&gt; more coffee and sacrifices to the dark gods before I have a clear view
&gt; of what to do. I&#39;ll try to keep the CR ticket updated with my 
</div>findings.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wish me luck. :-&#41;
&gt; 
&gt; `/anick
</div>
Yanick,

Just for your information, DBD::Oracle already decodes the data from 
Oracle in some cases as in oci8.c &#40;example from oci_error_err&#41;:

        if &#40;CSFORM_IMPLIES_UTF8&#40;SQLCS_IMPLICIT&#41;&#41; {
#ifdef sv_utf8_decode
        sv_utf8_decode&#40;errstr_sv&#41;;
#else
        SvUTF8_on&#40;errstr_sv&#41;;
#endif
        }

Without the above, I could not get unicode error messages back from 
Oracle.

However, as you can see, CSFORM_IMPLIES_UTF8 needs to be true and Perl 
needs to be new enough to have sv_utf8_decode or it falls back on the 
old behaviour of SvUTF8_on.

Perhaps some data is retrieved which is missing the above. e.g., 
fetch_func_varfield, ora_blob_read_mb_piece, 
ora_blob_read_piece,fetch_log etc seem to only call SvUTF8_on.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;09:50:02&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70819] AL32UTF8 Strings Should be Decoded, not just Flagged utf8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 09 Sep 2011 09:49:50 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;champoux [...] pythian.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Gentlemen,

     Martin =&gt; thanks for the pointers.

     Tim =&gt; thanks for the inputs. And yeah, testcases will be written 
before the code is changed. And everything will be passed through the 
dbi-dev mailing list for feedback as well, as this has all the hallmarks 
of a joyful an of worm. :-&#41;

Joy,
`/anick

--
The best compliment you could give Pythian for our service is a referral.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;11:17:17&nbsp;2011</span>
    <span class="description">Tim.Bunce [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70819] AL32UTF8 Strings Should be Decoded, not just Flagged utf8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 9 Sep 2011 16:16:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pythian Remote DBA via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Sep 09, 2011 at 09:50:03AM -0400, Pythian Remote DBA via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;      Tim =&gt; thanks for the inputs. And yeah, testcases will be written 
&gt; before the code is changed.
</div>
Just to clarify, I&#39;m looking for Dave to demonstrate a way to get an
invalid UTF-8 encoding into Oracle that isn&#39;t an Oracle bug.

Without that I don&#39;t think this is a DBD::Oracle &#39;bug&#39;.

Even with it, I&#39;d view the request as &#34;provide a way to optionally
enable expensive encoding checks on everything read from the db just in
case the db gets it wrong sometimes&#34;.

Tim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;12:07:52&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70819] AL32UTF8 Strings Should be Decoded, not just Flagged utf8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 9 Sep 2011 09:07:39 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sep 9, 2011, at 8:17 AM, Tim Bunce via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Just to clarify, I&#39;m looking for Dave to demonstrate a way to get an
&gt; invalid UTF-8 encoding into Oracle that isn&#39;t an Oracle bug.
</div>
Who&#39;s Dave?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Without that I don&#39;t think this is a DBD::Oracle &#39;bug&#39;.
</div>
I agree that Oracle should be responsible for verifying the character encoding. The fact that I have access to a database with broken data in it at $work has created no end of annoyances. Alas, I don&#39;t know what combination of poor code, encoding selections, and database upgrades led to this sad state of affairs. I assure you, that such is the case here.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Even with it, I&#39;d view the request as &#34;provide a way to optionally
&gt; enable expensive encoding checks on everything read from the db just in
&gt; case the db gets it wrong sometimes&#34;.
</div>
Well, the other reason I bring this up is because utf8 != UTF-8. IIUC correctly &#40;and that&#39;s highly questionable&#41;, Perl&#39;s internal representation is a more lax version of UTF-8. If so, then ideally when sending data *to* the database, it should be *encoded* as UTF-8 rather than utf8.

Truth to tell, though, there&#39;s a rather important conversation to be had about encoding and the DBI that should take place on the dbi-dev list. Here&#39;s the relevant DBD::Pg thread for context:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbd.pg/2011/07/msg603.html">http://www.nntp.perl.org/group/perl.dbd.pg/2011/07/msg603.html</a></span>

Ideally we&#39;d get tchrist involved, as he knows better than anyone where the unicode bodies are interred.

Should I start a thread on dbi-dev?

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;14:38:30&nbsp;2011</span>
    <span class="description">Tim.Bunce [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70819] AL32UTF8 Strings Should be Decoded, not just Flagged utf8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 9 Sep 2011 19:38:06 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> David Wheeler via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Sep 09, 2011 at 12:07:53PM -0400, David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Who&#39;s Dave?
</div>
Oops. Sorry David.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, the other reason I bring this up is because utf8 != UTF-8. IIUC
&gt; correctly &#40;and that&#39;s highly questionable&#41;, Perl&#39;s internal
&gt; representation is a more lax version of UTF-8. If so, then ideally
&gt; when sending data *to* the database, it should be *encoded* as UTF-8
&gt; rather than utf8.
</div>
Creating a codepoint that&#39;s invalid UTF-8 is pretty unlikely.
Certainly not worth the cost of encoding *by default*.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Truth to tell, though, there&#39;s a rather important conversation to be
&gt; had about encoding and the DBI that should take place on the dbi-dev
&gt; list. Here&#39;s the relevant DBD::Pg thread for context:
&gt; 
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbd.pg/2011/07/msg603.html">http://www.nntp.perl.org/group/perl.dbd.pg/2011/07/msg603.html</a></span>
</div>
I&#39;ve skimmed it. Thanks.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ideally we&#39;d get tchrist involved, as he knows better than anyone
&gt; where the unicode bodies are interred.
</div>
Let&#39;s not. I don&#39;t see any need at the moment.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Should I start a thread on dbi-dev?
</div>
Yeap! That would be great. Thanks.

Tim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;14:43:44&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70819] AL32UTF8 Strings Should be Decoded, not just Flagged utf8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 9 Sep 2011 11:43:33 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sep 9, 2011, at 11:38 AM, Tim Bunce via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Who&#39;s Dave?
</div>&gt; 
&gt; Oops. Sorry David.
</div>
Oh, okay. I didn&#39;t think Rolsky was on this thread, but one never knows &#40;he&#39;s on a big DBD::Pg Unicode bug thread&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Creating a codepoint that&#39;s invalid UTF-8 is pretty unlikely.
&gt; Certainly not worth the cost of encoding *by default*.
</div>
And yet that&#39;s exactly what I ran into. I can send some example strings pulled directly from Oracle.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Ideally we&#39;d get tchrist involved, as he knows better than anyone
&gt;&gt; where the unicode bodies are interred.
</div>&gt; 
&gt; Let&#39;s not. I don&#39;t see any need at the moment.
</div>
Okay. Maybe if questions of details came up.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Should I start a thread on dbi-dev?
</div>&gt; 
&gt; Yeap! That would be great. Thanks.
</div>
Okay.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;03&nbsp;12:33:40&nbsp;2014</span>
    <span class="description">bergner [...] cs.umu.se -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bergner [...] cs.umu.se</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m curious to know what became of this. I&#39;m seeing the following strange UTF-8 behaviour on Oracle 11.2 and 12 on Linux x86_64, terminal encoding is set to UTF-8. Setup is pretty much equivalent on 11.2 vs. 12 except version number in Oracle paths.

  LC_CTYPE=en_US.UTF-8
  LANG=en_US.UTF-8
  NLS_LANG=.AL32UTF8
  ORACLE_SID=ORADB1
  ORACLE_BASE=/opt/oracle/app/oracle
  ORACLE_HOME=/opt/oracle/app/oracle/product/12cR1
  LD_LIBRARY_PATH=/opt/oracle/app/oracle/product/12cR1/lib

I&#39;ve tried it with the following Perl, DBI, DBD::Oracle combination. Same results on all of them.

  Perl 5.10.1 + DBI 1.609 + DBD::Oracle 1.56
  Perl 5.18.4 + DBI 1.630 + DBD::Oracle 1.68
  Perl 5.18.4 + DBI 1.630 + DBD::Oracle 1.75_2

Database NLS parameters as follows:

  NLS_CHARACTERSET       AL32UTF8
  NLS_NCHAR_CHARACTERSET UTF8

On the Oracle 12c system NLS_NCHAR_CHARACTERSET is set to AL16UTF16 but it really shouldn&#39;t matter since I&#39;m only using regular VARCHAR2.

Create a simple table in sqlplus and insert one row. I do not have any corrupt data in the database. The value here is some cut&#39;n&#39;paste from <span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Thai_alphabet">http://en.wikipedia.org/wiki/Thai_alphabet</a></span> in case it gets mangled here.

  CREATE TABLE utf8test &#40;id INTEGER PRIMARY KEY NOT NULL, str VARCHAR2&#40;100&#41;&#41;;
  INSERT INTO utf8test VALUES &#40;1, &#39;อักษรไทย&#39;&#41;;
  COMMIT;

Now back to Perl where I can use the following trivial script &#40;lets call it dbiselect.pl&#41;:

  #!/usr/bin/perl
  use DBI;
  #use Encode;
  $dbh=DBI-&gt;connect&#40;&#34;dbi:Oracle:ORADB1&#34;, &#34;someuser&#34;, &#34;somepassword&#34;, { RaiseError=&gt;1 }&#41;;
  foreach my $col &#40;$dbh-&gt;selectrow_array&#40;$ARGV[0]&#41;&#41; {
  #    Encode::_utf8_off&#40;$col&#41;;
      print utf8::is_utf8&#40;$col&#41;?&#34;utf\n&#34;:&#34;bin\n&#34;;
      print $col;
      print &#34;\n&#34;;
  }
  $dbh-&gt;disconnect&#40;&#41;;

Running this with ./dbiselect.pl &#34;select str from utf8test where id=1&#34; yields:

  utf
  Wide character in print at ./dbiselect line 9.
  อักษรไทย

The &#34;Wide character in print&#34; warning is obviously not good. It will happen if UTF variables are serialzed without encoding them properly first to some binary representation &#40;like a UTF-8 octet stream&#41;. I&#39;m not using binmode&#40;STDOUT, &#39;:utf8&#39;&#41; to autmatically encode, hence it will complain about wide characters in print. If I explicitly do a print Encode::encode&#40;&#34;UTF-8&#34;, $col&#41;; or use binmode in the above script I end up with double UTF-8 encoded data and broken output.

If I uncomment the use Encode; and Encode::_utf8_off&#40;$col&#41; lines I get correct output.

  bin
  อักษรไทย

For comparison purposes, the same test script on DB2 + DBD::DB2 produces the final result with having to fudge the UTF flag with Encode::_utf8_off&#40;$col&#41;.

My conclusion is that the data I get back from DBD::Oracle has an internal representation that is a UTF-8 encoded octet stream, but the Perl UTF flag is set. This is an erroneous state. It should either be a UTF-8 encoded octet stream and flagged as binary, or be a UTF-X string and flagged as UTF such that when encoded to UTF-8 produces the correct octet stream.

Please advice and let me know if you find flaws in my reasoning.

Kind regards, 

Marcus
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;10:37:11&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 03 12:33:40 2014, bergner wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m curious to know what became of this. I&#39;m seeing the following
&gt; strange UTF-8 behaviour on Oracle 11.2 and 12 on Linux x86_64,
&gt; terminal encoding is set to UTF-8. Setup is pretty much equivalent on
&gt; 11.2 vs. 12 except version number in Oracle paths.
&gt; 
&gt; LC_CTYPE=en_US.UTF-8
&gt; LANG=en_US.UTF-8
&gt; NLS_LANG=.AL32UTF8
&gt; ORACLE_SID=ORADB1
&gt; ORACLE_BASE=/opt/oracle/app/oracle
&gt; ORACLE_HOME=/opt/oracle/app/oracle/product/12cR1
&gt; LD_LIBRARY_PATH=/opt/oracle/app/oracle/product/12cR1/lib
&gt; 
&gt; I&#39;ve tried it with the following Perl, DBI, DBD::Oracle combination.
&gt; Same results on all of them.
&gt; 
&gt; Perl 5.10.1 + DBI 1.609 + DBD::Oracle 1.56
&gt; Perl 5.18.4 + DBI 1.630 + DBD::Oracle 1.68
&gt; Perl 5.18.4 + DBI 1.630 + DBD::Oracle 1.75_2
&gt; 
&gt; Database NLS parameters as follows:
&gt; 
&gt; NLS_CHARACTERSET       AL32UTF8
&gt; NLS_NCHAR_CHARACTERSET UTF8
&gt; 
&gt; On the Oracle 12c system NLS_NCHAR_CHARACTERSET is set to AL16UTF16
&gt; but it really shouldn&#39;t matter since I&#39;m only using regular VARCHAR2.
&gt; 
&gt; Create a simple table in sqlplus and insert one row. I do not have any
&gt; corrupt data in the database. The value here is some cut&#39;n&#39;paste from
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Thai_alphabet">http://en.wikipedia.org/wiki/Thai_alphabet</a></span> in case it gets mangled
&gt; here.
&gt; 
&gt; CREATE TABLE utf8test &#40;id INTEGER PRIMARY KEY NOT NULL, str
&gt; VARCHAR2&#40;100&#41;&#41;;
&gt; INSERT INTO utf8test VALUES &#40;1, &#39;อักษรไทย&#39;&#41;;
&gt; COMMIT;
&gt; 
&gt; Now back to Perl where I can use the following trivial script &#40;lets
&gt; call it dbiselect.pl&#41;:
&gt; 
&gt; #!/usr/bin/perl
&gt; use DBI;
&gt; #use Encode;
&gt; $dbh=DBI-&gt;connect&#40;&#34;dbi:Oracle:ORADB1&#34;, &#34;someuser&#34;, &#34;somepassword&#34;, {
&gt; RaiseError=&gt;1 }&#41;;
&gt; foreach my $col &#40;$dbh-&gt;selectrow_array&#40;$ARGV[0]&#41;&#41; {
&gt; #    Encode::_utf8_off&#40;$col&#41;;
&gt;     print utf8::is_utf8&#40;$col&#41;?&#34;utf\n&#34;:&#34;bin\n&#34;;
&gt;     print $col;
&gt;     print &#34;\n&#34;;
&gt; }
&gt; $dbh-&gt;disconnect&#40;&#41;;
&gt; 
&gt; Running this with ./dbiselect.pl &#34;select str from utf8test where id=1&#34;
&gt; yields:
&gt; 
&gt; utf
&gt; Wide character in print at ./dbiselect line 9.
&gt; อักษรไทย
&gt; 
&gt; The &#34;Wide character in print&#34; warning is obviously not good. It will
&gt; happen if UTF variables are serialzed without encoding them properly
&gt; first to some binary representation &#40;like a UTF-8 octet stream&#41;. I&#39;m
&gt; not using binmode&#40;STDOUT, &#39;:utf8&#39;&#41; to autmatically encode, hence it
&gt; will complain about wide characters in print. If I explicitly do a
&gt; print Encode::encode&#40;&#34;UTF-8&#34;, $col&#41;; or use binmode in the above
&gt; script I end up with double UTF-8 encoded data and broken output.
&gt; 
&gt; If I uncomment the use Encode; and Encode::_utf8_off&#40;$col&#41; lines I get
&gt; correct output.
&gt; 
&gt; bin
&gt; อักษรไทย
&gt; 
&gt; For comparison purposes, the same test script on DB2 + DBD::DB2
&gt; produces the final result with having to fudge the UTF flag with
&gt; Encode::_utf8_off&#40;$col&#41;.
&gt; 
&gt; My conclusion is that the data I get back from DBD::Oracle has an
&gt; internal representation that is a UTF-8 encoded octet stream, but the
&gt; Perl UTF flag is set. This is an erroneous state. It should either be
&gt; a UTF-8 encoded octet stream and flagged as binary, or be a UTF-X
&gt; string and flagged as UTF such that when encoded to UTF-8 produces the
&gt; correct octet stream.
&gt; 
&gt; Please advice and let me know if you find flaws in my reasoning.
&gt; 
&gt; Kind regards,
&gt; 
&gt; Marcus
</div>
This works perfectly for me:

#!/usr/bin/perl
  use DBI;
  binmode&#40;STDOUT, &#34;:encoding&#40;UTF-8&#41;&#34;&#41;;   # &lt;------------ you need this to avoid wide chr warnings
  #use Encode;
  # see ora_charset and ora_ncharset I added to the connect:
  $dbh=DBI-&gt;connect&#40;&#34;dbi:Oracle:bet01d.bet.org:1521/bet01d&#34;, &#34;bet&#34;, &#34;b3t&#34;, { RaiseError=&gt;1,  ora_charset =&gt; &#39;AL32UTF8&#39;, ora_ncharset =&gt; &#39;AL32UTF8&#39;}&#41;;
  foreach my $col &#40;$dbh-&gt;selectrow_array&#40;&#39;select str from utf8test where id=1&#39;&#41;&#41; {
  #    Encode::_utf8_off&#40;$col&#41;;
      print utf8::is_utf8&#40;$col&#41;?&#34;utf\n&#34;:&#34;bin\n&#34;;
      print $col;
      print &#34;\n&#34;;
  }
  $dbh-&gt;disconnect&#40;&#41;;


$ perl xx.pl &#34;select str from utf8test where id=1&#34;
utf
อักษรไทย

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;10:42:08&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m closing this for multiple reasons:

1. no effective input in 8 years.
2. it was always questionable as to whether it was a bug or not
3. we&#39;ve moved to github.

By all means open an issue on hithub if it is still a problem.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;10:42:09&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
