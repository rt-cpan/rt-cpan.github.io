<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #129486 for Math-Clipper: blead and perl 5.30 cause the test suite to fail on Free BSD and Open BSD</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #129486 for Math-Clipper: blead and perl 5.30 cause the test suite to fail on Free BSD and Open BSD</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Math-Clipper">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Math-Clipper">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Math-Clipper">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Math-Clipper">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Clipper">Math-Clipper CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">129486</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Math-Clipper">Math-Clipper</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
khw [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
jkeenan [...] cpan.org

<br />
smueller [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-234424-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-234425-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.29    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=129486">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1847530" href="/Public/Bug/Display.html?id=129486#txn-1847530">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;08&nbsp;13:21:32&nbsp;2019</span>
    <span class="description">khw [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> smueller [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> blead and perl 5.30 cause the test suite to fail on Free BSD and
 Open BSD</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1847530/992792/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/992792">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A work around was added to Math-Clipper in May 2018 for a bug in the pow&#40;&#41; function on Free BSD machines.  It turns out that Open BSD is also affected.  The work around involves these two lines from Clipper.pm

        # brings behavior of FreeBSD + clang systems into harmony with others
        $scale_vector[$ci] = 0.0 + sprintf&#40;&#34;%.0f&#34;,$scale_vector[$ci]&#41;;

&#40;If the comment had been clearer, it would have saved us some debugging time, though maybe the author didn&#39;t fully understand the situation&#41;

It turns out that the earlier exponentiation 

      10**&#40;-$max_exp + &#40;$intspecs{$opts{bits}}-&gt;{maxdigits} - 1&#41;&#41;;

returns a slightly too large value when the exponent there evaluates to 29.  &#40;This is regular double precision; I havent tested with long doubles&#41;

And it turns out that this statement turns,  underneath the hood, into a call of the library routine pow&#40;10,29&#41;, and that is buggy on these platforms.  The &#39;harmonizing&#39; line executes a sprintf which stringifies this wrong value, and adding it to zero causes perl to parse that string, and converted the wrong value into the right one.  That is, it did so, until we fixed it to parse the string correctly, retaining the wrong value, causing the suite to fail.

I have no idea what the extent of the pow bug is.  It could be just these two values, or it could be lots of inputs cause failures.

So what to do about this.  We have tested our fix of string parsing with many different values, and it works better than what was there before, which fails miserably on many.  Hence, we aren&#39;t going to revert our change.  It likely fixes bugs with other inputs that your suite doesn&#39;t happen to check.

perl is not going to furnish a pow&#40;&#41; function to override broken ones on those few platforms that have failures.

What could you do?  For one, the call to _floor is asymmetric with regards to positive vs negative values.  I think it should truncate towards zero.  As it is, -2.000000000...0000001 gets changed to -3.  I think that should be changed.  Either a different function, such as rint&#40;&#41; should be used, or perhaps easier is to take the floor of the absolute value, and then change the sign back to negative if needed.  Doing that causes the test suite to pass, and the workaround there now wouldn&#39;t be necessary in any perl version.  

A less enticing option would be to replace the exponentiation with a loop that multiplies 10 by itself n times.  But Math::Clipper shouldn&#39;t have to write its own pow&#40;&#41; equivalent for a bug on one platform.  &#40;Although the &#39;harmonizing&#39; line is kinda doing that&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1847534" href="/Public/Bug/Display.html?id=129486#txn-1847534">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;08&nbsp;13:37:06&nbsp;2019</span>
    <span class="description">khw [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1847534/992796/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/992796">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 118b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I forgot to include a link to the ticket I filed on Free BSD

<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=237800">https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=237800</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1847564" href="/Public/Bug/Display.html?id=129486#txn-1847564">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;08&nbsp;15:58:19&nbsp;2019</span>
    <span class="description">khw [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1847564/992811/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/992811">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 405b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 08 11:37:06 2019, khw wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I forgot to include a link to the ticket I filed on Free BSD
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=237800">https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=237800</a></span>
</div>
And it looks like they are not going to fix this, as the results are within their view of tolerances.  Tony Cook looked at the C standard and did not find any language as to acceptable precision in the return of these sorts of functions.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1847581" href="/Public/Bug/Display.html?id=129486#txn-1847581">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;08&nbsp;16:53:32&nbsp;2019</span>
    <span class="description">SHELDRAKE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1847581/992824/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/992824">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 42b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ll take a look. Thanks for the analysis.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1847582" href="/Public/Bug/Display.html?id=129486#txn-1847582">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;08&nbsp;16:53:33&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1848062" href="/Public/Bug/Display.html?id=129486#txn-1848062">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;10&nbsp;08:44:47&nbsp;2019</span>
    <span class="description">jkeenan [...] cpan.org -  Cc JKEENAN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1848289" href="/Public/Bug/Display.html?id=129486#txn-1848289">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;11&nbsp;20:19:45&nbsp;2019</span>
    <span class="description">SHELDRAKE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1848289/993207/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/993207">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 665b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Math::Clipper 1.28 up on CPAN now hopefully fixes this.

Tests pass on FreeBSD 11.2, perl 5.29.10 and perl-blead.

I took the &#34;less enticing option&#34; and used a loop to do the exponentiation, because it&#39;s dead simple, and because I don&#39;t want to explore &#40;again&#41; new mysteries that might come up with floor&#40;&#41; here.

I think the loop has the advantage that if the scale factor calculated is an integer and fits within an IV, it should come out as a scalar holding an IV, since all the numbers in the calculation probably start out as IVs. So most scale factor calculations &gt; 1 become immune to float imprecision, while the same loop handles floats for scales &lt; 1.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1848292" href="/Public/Bug/Display.html?id=129486#txn-1848292">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;11&nbsp;20:43:39&nbsp;2019</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1848292/993210/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/993210">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 453b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 11 20:19:45 2019, SHELDRAKE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Math::Clipper 1.28 up on CPAN now hopefully fixes this.
&gt; 
&gt; Tests pass on FreeBSD 11.2, perl 5.29.10 and perl-blead.
&gt; 
</div>
$ ./bin/perl -Ilib -v | head -2 | tail -1; uname -mrs; ./bin/perl -MMath::Clipper -E &#39;say q|hello world|;&#39;
This is perl 5, version 30, subversion 0 &#40;v5.30.0-RC1-3-g12e248a19e&#41; built for amd64-freebsd-thread-multi
FreeBSD 11.2-STABLE amd64
hello world

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1848711" href="/Public/Bug/Display.html?id=129486#txn-1848711">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;13&nbsp;23:20:21&nbsp;2019</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1848711/993471/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/993471">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 599b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 11 20:43:39 2019, JKEENAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat May 11 20:19:45 2019, SHELDRAKE wrote:
<div class="message-stanza open">&gt; &gt; Math::Clipper 1.28 up on CPAN now hopefully fixes this.
&gt; &gt;
&gt; &gt; Tests pass on FreeBSD 11.2, perl 5.29.10 and perl-blead.
&gt; &gt;
</div>&gt; 
&gt; $ ./bin/perl -Ilib -v | head -2 | tail -1; uname -mrs; ./bin/perl
&gt; -MMath::Clipper -E &#39;say q|hello world|;&#39;
&gt; This is perl 5, version 30, subversion 0 &#40;v5.30.0-RC1-3-g12e248a19e&#41;
&gt; built for amd64-freebsd-thread-multi
&gt; FreeBSD 11.2-STABLE amd64
&gt; hello world
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div>
I have also been able to install Math::Clipper on OpenBSD-6.4 threaded.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1849860" href="/Public/Bug/Display.html?id=129486#txn-1849860">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;22&nbsp;15:04:04&nbsp;2019</span>
    <span class="description">khw [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> jkeenan [...] cpan.org, smueller [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #129486] blead and perl 5.30 cause the test suite to fail on Free BSD and Open BSD</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 May 2019 13:02:47 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Clipper [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karl Williamson &lt;khw [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1849860/994137/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/994137">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 5/11/19 6:19 PM, Michael E. Sheldrake via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=129486">https://rt.cpan.org/Ticket/Display.html?id=129486</a></span> &gt;
&gt; 
&gt; Math::Clipper 1.28 up on CPAN now hopefully fixes this.
&gt; 
&gt; Tests pass on FreeBSD 11.2, perl 5.29.10 and perl-blead.
&gt; 
&gt; I took the &#34;less enticing option&#34; and used a loop to do the exponentiation, because it&#39;s dead simple, and because I don&#39;t want to explore &#40;again&#41; new mysteries that might come up with floor&#40;&#41; here.
&gt; 
&gt; I think the loop has the advantage that if the scale factor calculated is an integer and fits within an IV, it should come out as a scalar holding an IV, since all the numbers in the calculation probably start out as IVs. So most scale factor calculations &gt; 1 become immune to float imprecision, while the same loop handles floats for scales &lt; 1.
&gt; 
&gt; 
</div>
Something I forgot to say was that several people questioned that the 
test was too restrictive in expecting that the final digit will be 
exact, and that off-by-one errors should be expected.

Several referred to this paper:
<span class="clickylink"><a target="new" rel="nofollow" href="https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html</a></span>

Indeed, someone wrote a program that did a similar loop, and got errors 
in the final digit, depending on the exact nature of the loop.  Indeed, 
the way I would have written it had that error.  And that way would be 
to take the floor of the square root of the exponent, and then do x = 
x*x that many times.  Then take the square root of the undone part, and 
using the original value repeat the initial process and then multiply 
those results, and repeat until the whole exponent is gotten.  This 
minimizes multiplications.  Every operation introduces some error.

But, on this person&#39;s platform that led to an off-by-one error in the 
final digit.  Other schemes that used more multiplications didn&#39;t have 
this error.

The bottom line is that its complicated
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1859970" href="/Public/Bug/Display.html?id=129486#txn-1859970">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;14&nbsp;13:50:16&nbsp;2019</span>
    <span class="description">SHELDRAKE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1859970/998948/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/998948">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 907b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the additional notes. Will take those into account next time this needs to be reconsidered. Closing this because the fixes are testing well, and it should be more sound than it was.

I do expect to be able to round-trip coordinate data in and out of Clipper&#39;s C structures without the process changing last digits. This really is important when you do multiple Clipper operations, making several round trips.

I also wanted to be really flexible with what kind of numerical data the integerize function would accept - a mix of floats, integers and even numbers-as-strings. If it weren&#39;t for that approach - if we could assume that all the  Perl scalars coming in were doubles, or all were integers - the whole integerize approach could be more streamlined.

So I agree, it&#39;s complicated - for the reasons you pointed to and more. Thanks to all for all the investigations that went on around this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1859973" href="/Public/Bug/Display.html?id=129486#txn-1859973">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;14&nbsp;13:50:17&nbsp;2019</span>
    <span class="description">SHELDRAKE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1859975" href="/Public/Bug/Display.html?id=129486#txn-1859975">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;14&nbsp;13:50:18&nbsp;2019</span>
    <span class="description">SHELDRAKE [...] cpan.org -  Fixed in 1.29 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.589542</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
