<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #125912 for Config-General: Retain association of left hand block and right hand block.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #125912 for Config-General: Retain association of left hand block and right hand block.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Config-General">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Config-General">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Config-General">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Config-General">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Config-General">Config-General CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">125912</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Config-General">Config-General</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">tlinden [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
himynameisnolan [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-7696-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.63    </td>
  </tr>
  <tr id="CF-7697-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




General.pm.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1797404/966646/General.pm.patch">
Wed Jul 25 13:43:40 2018 (5.9k) by himynameisnolan [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=125912">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1797099" href="/Public/Bug/Display.html?id=125912#txn-1797099">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;23&nbsp;12:10:42&nbsp;2018</span>
    <span class="description">himynameisnolan [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Retain association of left hand block and right hand block.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1797099/966484/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/966484">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 903b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I wasn&#39;t able to find a way to retain the association of a left hand block name and right hand block parameters. For example, given the following two distinct code snippets, the resultant data structure would be the same:

Snippet 1:
&lt;Foo &#34;bar&#34;&gt;
Blah Blah
&lt;/Foo&gt;

Snippet 2:
&lt;Foo&gt;
    &lt;Bar&gt;
        Blah Blah
    &lt;/Bar&gt;
&lt;/Foo&gt;

The returned data structure would be something like:
$VAR1= {
    &#39;Foo&#39; =&gt; {
        &#39;Bar&#39; =&gt; {
            &#39;Blah&#39; =&gt; &#39;Blah&#39;,
        },
    },
};

From an Apache standpoint, there&#39;s a significant difference in meaning that is lost when examining the data structure. Is Bar supposed to be parameters that are associated with the Foo section? Or are Foo and Bar completely distinct sections?

If we had a way to retain the association between block names, and block parameters when examining the resulting data structure, that would be very helpful.

Thank you,

Nolan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1797121" href="/Public/Bug/Display.html?id=125912#txn-1797121">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;23&nbsp;13:31:49&nbsp;2018</span>
    <span class="description">himynameisnolan [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1797121/966496/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/966496">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I made a quick fix for this, which is just to add another new&#40;&#41; option called:
-NormalizeBlockName.

It behaves the same way as NormalizeBlock, but it&#39;s for BlockNames specifically. This lets me attach a subref which can prefix the blockname distinctly from blocks.

Code Snippet:
        if&#40;$this-&gt;{NormalizeBlock}&#41; {
          $block = $this-&gt;{NormalizeBlock}&#40;$block&#41;;
        }
        if&#40;$this-&gt;{NormalizeBlockName}&#41; {
          if &#40;defined $blockname&#41; {
            $blockname = $this-&gt;{NormalizeBlockName}&#40;$blockname&#41;;
            if&#40;$blockname eq &#34;&#34;&#41; {
              # if, after normalization no blockname is left, remove it
              $blockname = undef;
            }
          }
        }
Also added a default to the my $self={} declaration at the top of the file:

              NormalizeBlock        =&gt; 0,
              NormalizeBlockName    =&gt; 0,

If something like this could be added to the official package, that&#39;d be nice. I&#39;m currently using my own custom fork of the package and it feels so dirty.

Thanks,

Nolan

On Mon Jul 23 12:10:42 2018, himynameisnolan@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; I wasn&#39;t able to find a way to retain the association of a left hand
&gt; block name and right hand block parameters. For example, given the
&gt; following two distinct code snippets, the resultant data structure
&gt; would be the same:
&gt; 
&gt; Snippet 1:
&gt; &lt;Foo &#34;bar&#34;&gt;
&gt; Blah Blah
&gt; &lt;/Foo&gt;
&gt; 
&gt; Snippet 2:
&gt; &lt;Foo&gt;
&gt;     &lt;Bar&gt;
&gt;         Blah Blah
&gt;     &lt;/Bar&gt;
&gt; &lt;/Foo&gt;
&gt; 
&gt; The returned data structure would be something like:
&gt; $VAR1= {
&gt;     &#39;Foo&#39; =&gt; {
&gt;         &#39;Bar&#39; =&gt; {
&gt;             &#39;Blah&#39; =&gt; &#39;Blah&#39;,
&gt;         },
&gt;     },
&gt; };
&gt; 
&gt; From an Apache standpoint, there&#39;s a significant difference in meaning
&gt; that is lost when examining the data structure. Is Bar supposed to be
&gt; parameters that are associated with the Foo section? Or are Foo and
&gt; Bar completely distinct sections?
&gt; 
&gt; If we had a way to retain the association between block names, and
&gt; block parameters when examining the resulting data structure, that
&gt; would be very helpful.
&gt; 
&gt; Thank you,
&gt; 
&gt; Nolan
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1797188" href="/Public/Bug/Display.html?id=125912#txn-1797188">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;24&nbsp;08:50:24&nbsp;2018</span>
    <span class="description">tlinden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1797188/966525/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/966525">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 198b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Nolan,

On Mon Jul 23 13:31:49 2018, himynameisnolan@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I made a quick fix for this
</div>
Can you please provide a patch file, you code snippet seems to be incomplete.


Thanks,
Tom
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1797189" href="/Public/Bug/Display.html?id=125912#txn-1797189">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;24&nbsp;08:50:24&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1797404" href="/Public/Bug/Display.html?id=125912#txn-1797404">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;25&nbsp;13:43:40&nbsp;2018</span>
    <span class="description">himynameisnolan [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1797404/966645/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/966645">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Thanks so much for getting back to me Tom. I&#39;ve attached a patch file. There are a few other things I included in the patch that I think would be cool to get in, if you wanted to review them and make a decision.

An overview:
I&#39;ve attempted to provide options that allow the data structure to be more predictably organized for easier programmatic traversal:

-ForceBlockName
    *Ensures that blocks are always stored with a left-hand and right-hand value. If
    there is no right-hand value, the right-hand value key will simply be undefined.
    Example:

        Markup 1:

            &lt;Foo &#34;bar&#34;&gt;
                Blah Blah
            &lt;/Foo&gt;

        Would produce this data structure:

            $VAR1= {
                &#39;Foo&#39; =&gt; {
                    &#39;Bar&#39; =&gt; {
                        &#39;Blah&#39; =&gt; &#39;Blah&#39;,
                    },
                },
            };

        Markup 2:

            &lt;Foo&gt;
                &lt;Bar&gt;
                    Blah Blah
                &lt;/Bar&gt;
            &lt;/Foo&gt;

        Would produce this data structure:

            $VAR1= {
                &#39;Foo&#39; =&gt; {
                    undef =&gt; {
                        &#39;Bar&#39; =&gt; {
                            undef =&gt; {
                                 &#39;Blah&#39; =&gt; &#39;Blah&#39;,
                            },
                        },
                    },
                },
            };

        This way, you could create a map that leads directly the the option value using
        the keys of the structure which would look like this:

            my @map=&#40;&#39;Foo&#39;, undef, &#39;Bar&#39;, undef&#39;, &#39;Blah&#39;&#41;;

        This predictable structure allow us to maintain the association of the block
        and any provided block name.

        Provided the last key points to an option value, you can use all elements in the
        map &#40;minus the last one&#41; to create a list of key/value pairs for every layer of
        block context, where the key is the block, and the value is the block name:

            use Tie::DxHash;
            my $sections={};
            tie %{$sections}, &#34;Tie::DxHash&#34;;
            %{$sections}=@map;

        You could then use each key/value pair to programmatically evaluate the
        meaning of every block.

-ForceValueArray
    *Forces single VALUES to be stored in an array. I took out the syntax requirement
    &#40;enclosing the option value in square brackets in the config file&#41;, because I feel
    the point of this option is to allow the programmer to always expect option values
    to be stored in an array &#40;rather than sometimes being an array and sometimes
    being a hash&#41; when programmatically traversing the data structure. I don&#39;t think
    arbitrary requirements should be placed on the manager of the config file
    &#40;who might not be affiliated with the programmer&#41; to facilitate this.

-ForceBlockArray
   *Forces single BLOCKS to be stored in an array. This is the same idea as
   ForceValueArray, but it applies specifically to the storage of blocks.

    In the current release of Config::General, arrays will be generated in the hash
    structure if there are duplicate elements, but arrays will not be generated if there
    is only one element.

    For example, two VirtualHost blocks for two distinct users on a shared IP address:

        &lt;VirtualHost 192.168.1.10:80&gt;
            ServerName example-a.com
            DocumentRoot /home/a/public_html
        &lt;/VirtualHost&gt;

        &lt;VirtualHost 192.168.1.10:80&gt;
            ServerName example-b.com
            DocumentRoot /home/b/public_html
        &lt;/VirtualHost&gt;

    ...Create a data structure that looks like this:

        $VAR1 = {
            &#39;VirtualHost&#39; =&gt; {
                &#39;192.168.1.10:80&#39; =&gt; [    #Array of Hashes
                    {
                        &#39;ServerName&#39; =&gt; &#39;example-a.com&#39;,
                        &#39;DocumentRoot&#39; =&gt; &#39;/home/a/public_html&#39;,
                    },
                    {
                        &#39;ServerName&#39; =&gt; &#39;example-b.com&#39;,
                        &#39;DocumentRoot&#39; =&gt; &#39;/home/b/public_html&#39;,
                    },
                ],
            },
        };

    Whereas a single VirtualHost block for a single user on a dedicated IP address...:

        &lt;VirtualHost 192.168.1.120:80&gt;
            ServerName example-c.com
            DocumentRoot /home/c/public_html
        &lt;/VirtualHost&gt;

    ...Produces a data structure that looks like this:

        $VAR1 = {
            &#39;VirtualHost&#39; =&gt; {
                &#39;192.168.1.10:80&#39; =&gt; {    #No array
                    &#39;ServerName&#39; =&gt; &#39;example-c.com&#39;,
                    &#39;DocumentRoot&#39; =&gt; &#39;/home/c/public_html&#39;,
                },
            },
        };

    This variation in the data&#39;s internal structure makes it difficult to
    programmatically traverse the structure... ForceBlockArray would
    ensure that the programmer can expect all elements contained in
    a block will be found in the array that is directly following the block:

    The dedicated IP example:

        &lt;VirtualHost 192.168.1.120:80&gt;
            ServerName example-c.com
            DocumentRoot /home/c/public_html
        &lt;/VirtualHost&gt;

    ...Would then produce a structure that looks like this:

        $VAR1 = {
            &#39;VirtualHost&#39; =&gt; {
                &#39;192.168.1.10:80&#39; =&gt; {
                    [                               #For an array
                        &#39;ServerName&#39; =&gt; &#39;example-c.com&#39;,
                        &#39;DocumentRoot&#39; =&gt; &#39;/home/c/public_html&#39;,
                    ],
                },
            },
        };

-NormalizeBlockName
    *This is just another way to provide distinction between blocks and block names.

    Example:

        -NormalizeBlock =&gt; sub { my $x = shift; $x =~ s/^/BLOCK:/; $x; }
        -NormalizeBlockName =&gt; sub { my $x = shift; $x =~ s/^/BLOCKNAME:/; $x; }
        -NormalizeOption =&gt; sub { my $x = shift; $x =~ s/^/OPTION:/; $x; }
        -NormalizeValue =&gt; sub { my $x = shift; $x =~ s/^/BLOCKVALUE:/; $x; }

I&#39;ve attached the .patch file with all my changes.


On Tue Jul 24 08:50:24 2018, TLINDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello Nolan,
&gt; 
&gt; On Mon Jul 23 13:31:49 2018, himynameisnolan@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; I made a quick fix for this
</div>&gt; 
&gt; Can you please provide a patch file, you code snippet seems to be
&gt; incomplete.
&gt; 
&gt; 
&gt; Thanks,
&gt; Tom
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> General.pm.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1797404/966646/General.pm.patch">Download General.pm.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- orig/General.pm	2018-07-25 10:06:25.147883737 -0600
+++ new/General.pm	2018-07-25 10:20:43.594506937 -0600
@@ -89,10 +89,13 @@
               files                 =&gt; {},      # which files we have read, if any
               UTF8                  =&gt; 0,
               SaveSorted            =&gt; 0,
-              ForceArray            =&gt; 0,       # force single value array if value enclosed in []
+              ForceValueArray       =&gt; 0,       # force values to be stored in an array
+              ForceBlockArray       =&gt; 0,       # force block contents to be stored in an array
+              ForceBlockName        =&gt; 0,       # force undefined block name if no block name is provided.
               AllowSingleQuoteInterpolation =&gt; 0,
               NoEscape              =&gt; 0,
               NormalizeBlock        =&gt; 0,
+              NormalizeBlockName    =&gt; 0,
               NormalizeOption       =&gt; 0,
               NormalizeValue        =&gt; 0,
               Plug                  =&gt; {},
@@ -900,7 +903,7 @@
       $option = $this-&gt;{NormalizeOption}&#40;$option&#41;;
     }

-    if &#40;$value &#38;&#38; $value =~ /^&#34;/ &#38;&#38; $value =~ /&#34;$/&#41; {
+    if &#40;defined $value &#38;&#38; $value =~ /^&#34;/ &#38;&#38; $value =~ /&#34;$/&#41; {
       $value =~ s/^&#34;//;                                    # remove leading and trailing &#34;
       $value =~ s/&#34;$//;
     }
@@ -920,8 +923,10 @@
         }
         if&#40;$this-&gt;{NormalizeBlock}&#41; {
           $block = $this-&gt;{NormalizeBlock}&#40;$block&#41;;
+        }
+        if&#40;$this-&gt;{NormalizeBlockName}&#41; {
           if &#40;defined $blockname&#41; {
-            $blockname = $this-&gt;{NormalizeBlock}&#40;$blockname&#41;;
+            $blockname = $this-&gt;{NormalizeBlockName}&#40;$blockname&#41;;
             if&#40;$blockname eq &#34;&#34;&#41; {
               # if, after normalization no blockname is left, remove it
               $blockname = undef;
@@ -988,9 +993,12 @@
           }
         }
         else {
-          if&#40;$this-&gt;{ForceArray} &#38;&#38; defined $value &#38;&#38; $value =~ /^\[\s*&#40;.+?&#41;\s*\]$/&#41; {
+          if&#40;$this-&gt;{ForceValueArray}&#41; {
+            if&#40;defined $value&#41; {
+              &#40;$value&#41; = $value =~ /^&#40;?&gt;\[\s*+&#41;?&#40;.+?&#41;&#40;?&gt;\s*+\]&#41;?$/;
+            }
             # force single value array entry
-            push @{$config-&gt;{$option}}, $this-&gt;_parse_value&#40;$config, $option, $1&#41;;
+            push @{$config-&gt;{$option}}, $this-&gt;_parse_value&#40;$config, $option, $value&#41;;
           }
           else {
             # standard config option, insert key/value pair into node
@@ -1014,7 +1022,7 @@
         push @newcontent, $_;       # push onto new content stack
       }
       else {                        # calling myself recursively, end of $block reached, $block_level is 0
-        if &#40;defined $blockname&#41; {
+        if &#40;defined $blockname or $this-&gt;{ForceBlockName}&#41; {
           # a named block, make it a hashref inside a hash within the current node

           if &#40;! exists $config-&gt;{$block}&#41; {
@@ -1070,7 +1078,12 @@
               $tmphash-&gt;{__stack} = $this-&gt;_copy&#40;$config-&gt;{__stack}&#41;;
             }

-            $config-&gt;{$block}-&gt;{$blockname} = $this-&gt;_parse&#40;$tmphash, \@newcontent&#41;;
+            if &#40;$this-&gt;{ForceBlockArray}&#41; {
+              push @{$config-&gt;{$block}-&gt;{$blockname}}, $this-&gt;_parse&#40;$tmphash, \@newcontent&#41;;
+            }
+            else {
+              $config-&gt;{$block}-&gt;{$blockname} = $this-&gt;_parse&#40;$tmphash, \@newcontent&#41;;
+            }
           }
         }
         else {
@@ -1124,7 +1137,12 @@
               $tmphash-&gt;{__stack} = $this-&gt;_copy&#40;$config-&gt;{__stack}&#41;;
             }

-            $config-&gt;{$block} = $this-&gt;_parse&#40;$tmphash, \@newcontent&#41;;
+            if &#40;$this-&gt;{ForceBlockArray}&#41; {
+              push @{$config-&gt;{$block}}, $this-&gt;_parse&#40;$tmphash, \@newcontent&#41;;
+            }
+            else {
+              $config-&gt;{$block} = $this-&gt;_parse&#40;$tmphash, \@newcontent&#41;;
+            }
           }
         }
         undef $blockname;
@@ -1346,18 +1364,12 @@
     }

     if &#40;ref&#40;$config-&gt;{$entry}&#41; eq &#39;ARRAY&#39;&#41; {
-      if&#40; $this-&gt;{ForceArray} &#38;&#38; scalar @{$config-&gt;{$entry}} == 1 &#38;&#38; ! ref&#40;$config-&gt;{$entry}-&gt;[0]&#41; &#41; {
-        # a single value array forced to stay as array
-        $config_string .= $this-&gt;_write_scalar&#40;$level, $entry, &#39;[&#39; . $config-&gt;{$entry}-&gt;[0] . &#39;]&#39;&#41;;
-      }
-      else {
-        foreach my $line &#40; $this-&gt;{SaveSorted} ? sort @{$config-&gt;{$entry}} : @{$config-&gt;{$entry}} &#41; {
-          if &#40;ref&#40;$line&#41; eq &#39;HASH&#39;&#41; {
-            $config_string .= $this-&gt;_write_hash&#40;$level, $entry, $line&#41;;
-          }
-          else {
-            $config_string .= $this-&gt;_write_scalar&#40;$level, $entry, $line&#41;;
-          }
+      foreach my $line &#40; $this-&gt;{SaveSorted} ? sort @{$config-&gt;{$entry}} : @{$config-&gt;{$entry}} &#41; {
+        if &#40;ref&#40;$line&#41; eq &#39;HASH&#39;&#41; {
+          $config_string .= $this-&gt;_write_hash&#40;$level, $entry, $line&#41;;
+        }
+        else {
+          $config_string .= $this-&gt;_write_scalar&#40;$level, $entry, $line&#41;;
         }
       }
     }
@@ -2103,6 +2115,10 @@

 This removes trailing whitespaces of block names.

+=item B&lt;-NormalizeBlockName&gt;
+
+Same as B&lt;-NormalizeBlock&gt; but applied on block names only.
+
 =item B&lt;-NormalizeOption&gt;

 Same as B&lt;-NormalizeBlock&gt; but applied on options only.
@@ -2472,13 +2488,24 @@
 =head2 FORCE SINGLE VALUE ARRAYS

 You may also force a single config line to get parsed into an array by
-turning on the option B&lt;-ForceArray&gt; and by surrounding the value of the
-config entry by []. Example:
+turning on the option B&lt;-ForceValueArray&gt;. Example:

- hostlist = [ foo.bar ]
+ hostlist = foo.bar

 Will be a singlevalue array entry if the option is turned on. If you want
-it to remain to be an array you have to turn on B&lt;-ForceArray&gt; during save too.
+it to remain to be an array you have to turn on B&lt;-ForceValueArray&gt; during save too.
+
+=head2 FORCE SINGLE BLOCK ARRAYS
+
+You may also force a single config block to get parsed into an array by
+turning on the option B&lt;-ForceBlockArray&gt;. Example:
+
+ &lt;VirtualHost 192.168.1.10:80&gt;
+    ServerName localhost.com
+    DocumentRoot /usr/local/apache/htdocs
+&lt;/VirtualHost&gt;
+
+Will be a singleblock array entry if the option is turned on.

 =head1 LONG LINES

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1797540" href="/Public/Bug/Display.html?id=125912#txn-1797540">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;27&nbsp;04:15:54&nbsp;2018</span>
    <span class="description">tlinden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1797540/966707/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/966707">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 88b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">No, sorry. One patch for one issue. Also, those other changes would break existing code.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.456602</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
