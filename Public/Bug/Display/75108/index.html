<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75108 for Class-Mixer: Expand on C3-style usage?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75108 for Class-Mixer: Expand on C3-style usage?</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Class-Mixer/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Class-Mixer/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Class-Mixer/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Class-Mixer/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Class-Mixer">Class-Mixer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75108</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Class-Mixer/Active/">Class-Mixer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mst [...] shadowcat.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-242520-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-242521-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;00:36:31&nbsp;2012</span>
    <span class="description">mst [...] shadowcat.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Expand on C3-style usage?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 18 Feb 2012 05:36:16 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bugs-Class-Mixer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt S Trout &lt;mst [...] shadowcat.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">DBIx::Class &#40;ab&#41;uses C3 MRO to do components that need to end up sensibly
ordered in what turns out to be a pretty nice way &#40;were I to do it again,
I&#39;d probably do roles, but it does work well as is&#41;.

I see that you have ::C3 in your see also, but it strikes me that given
&#34;use mro &#39;c3&#39;;&#34; is now a core feature, it might be worth expanding on why
this is better than it.

&#40;I&#39;m not intending to use your module right now ... but I can entirely
see why it might be useful to people, and think it&#39;s worth expanding a
bit more on the &#34;why&#34; to make that more obvious&#41;

-- 
Matt S Trout - Shadowcat Systems - Perl consulting with a commit bit and a clue

<span class="clickylink"><a target="new" rel="nofollow" href="http://shadowcat.co.uk/blog/matt-s-trout/">http://shadowcat.co.uk/blog/matt-s-trout/</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/shadowcat_mst/">http://twitter.com/shadowcat_mst/</a></span>

Email me now on mst &#40;at&#41; shadowcat.co.uk and let&#39;s chat about how our Catalyst
commercial support, training and consultancy packages could help your team.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;00:52:19&nbsp;2012</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Why use Class::C3?  

mro was not in perl-5.6, and I started developing the module on that
version, so I was intending to be backward compatible that far.

I suppose I should use MRO::Compat instead.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;00:52:20&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;01:10:53&nbsp;2012</span>
    <span class="description">mst [...] shadowcat.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75108] Expand on C3-style usage?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 18 Feb 2012 06:10:34 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> John Williams via RT &lt;bug-Class-Mixer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt S Trout &lt;mst [...] shadowcat.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Feb 18, 2012 at 12:52:19AM -0500, John Williams via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75108">https://rt.cpan.org/Ticket/Display.html?id=75108</a></span> &gt;
&gt; 
&gt; Why use Class::C3?  
&gt; 
&gt; mro was not in perl-5.6, and I started developing the module on that
&gt; version, so I was intending to be backward compatible that far.
&gt; 
&gt; I suppose I should use MRO::Compat instead.
</div>
I&#39;m not suggesting *you* should use Class::C3 necessarily.

I am saying you should explain more about how Class::Mixer usage compares
to the way Class::C3::Componentised based stuff like DBIx::Class works
because that would probably help people understand why they might want to
use Class::Mixer.

I only support 5.8.1+ though, unsure if C3 will do 5.6

-- 
Matt S Trout - Shadowcat Systems - Perl consulting with a commit bit and a clue

<span class="clickylink"><a target="new" rel="nofollow" href="http://shadowcat.co.uk/blog/matt-s-trout/">http://shadowcat.co.uk/blog/matt-s-trout/</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/shadowcat_mst/">http://twitter.com/shadowcat_mst/</a></span>

Email me now on mst &#40;at&#41; shadowcat.co.uk and let&#39;s chat about how our Catalyst
commercial support, training and consultancy packages could help your team.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;02:37:09&nbsp;2012</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the pointer to Class::C3::Componentised.  I had not noticed
that module before, and I can see the similarities.

How does this sound?
Am I correct in saying that Componentised has good support for run-time
mixins?


=head1 Comparison with Class::C3::Componentised

Class::C3::Componentised is used in DBIx::Class similarly to Class::Mixer
to implement the same sorts of mixin behaviors.  The difference is 
exemplified by this quote from DBIx::Class::Component, 

&#34;The order in which is you load the components may be very important, 
depending on the component. If you are not sure, then read the docs 
for the components you are using and see if they mention anything about 
the order in which you should load them.&#34;

With Class::Mixer, the user never has to deal with the complexities of
component order.  Component ordering requirements are both documented
and *enforced* by the inheritance rules in each component.  So when
building his application class, he can list the desired component modules 
in any order, and let Class::Mixer put them in a correctly functioning
order.

On the other hand, Class::Mixer has no support for run-time mixins, 
like Class::C3::Componentised-&gt;load_components.  The class is considered
closed after an object is instantiated from it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;04:03:47&nbsp;2012</span>
    <span class="description">mst [...] shadowcat.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75108] Expand on C3-style usage?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 18 Feb 2012 08:58:55 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> John Williams via RT &lt;bug-Class-Mixer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt S Trout &lt;mst [...] shadowcat.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Feb 18, 2012 at 02:37:09AM -0500, John Williams via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75108">https://rt.cpan.org/Ticket/Display.html?id=75108</a></span> &gt;
&gt; 
&gt; Thanks for the pointer to Class::C3::Componentised.  I had not noticed
&gt; that module before, and I can see the similarities.
&gt; 
&gt; How does this sound?
</div>
Not quite right.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Am I correct in saying that Componentised has good support for run-time
&gt; mixins?
</div>
Not exactly, but. See below. 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; =head1 Comparison with Class::C3::Componentised
&gt; 
&gt; Class::C3::Componentised is used in DBIx::Class similarly to Class::Mixer
&gt; to implement the same sorts of mixin behaviors.  The difference is 
&gt; exemplified by this quote from DBIx::Class::Component, 
&gt; 
&gt; &#34;The order in which is you load the components may be very important, 
&gt; depending on the component. If you are not sure, then read the docs 
&gt; for the components you are using and see if they mention anything about 
&gt; the order in which you should load them.&#34;
&gt;
&gt; With Class::Mixer, the user never has to deal with the complexities of
&gt; component order.  Component ordering requirements are both documented
&gt; and *enforced* by the inheritance rules in each component.  So when
&gt; building his application class, he can list the desired component modules 
&gt; in any order, and let Class::Mixer put them in a correctly functioning
&gt; order.
</div>
Within reason, C3 does this. Specifically, it provides your &#39;before&#39;
functionality. The diamond inheritance resolution will cause it to die&#40;&#41;
if you supply an order that can&#39;t be resolved to a sensible call order.

However, ordering can still matter because of components that wrap
behaviour - consider two components, one that adds logging to a method,
and one that adds an authentication check. Which one ends up first will
decide whether methods that don&#39;t pass the check still trigger the logging.

I don&#39;t believe Mixer fixes that either though.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On the other hand, Class::Mixer has no support for run-time mixins, 
&gt; like Class::C3::Componentised-&gt;load_components.  The class is considered
&gt; closed after an object is instantiated from it.
</div>
load_components is nothing to do with &#34;run time mixins&#34;. it&#39;s just a fancy
way of populating @ISA. 

inject_base can be used to generate a class at runtime though, which is
generally the usual approach to doing this sort of thing &#40;systems that
provide run-time mixins generally create a new class that inherits from
the current one, apply the mixin to that, and rebless the object into it&#41;

-- 
Matt S Trout - Shadowcat Systems - Perl consulting with a commit bit and a clue

<span class="clickylink"><a target="new" rel="nofollow" href="http://shadowcat.co.uk/blog/matt-s-trout/">http://shadowcat.co.uk/blog/matt-s-trout/</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/shadowcat_mst/">http://twitter.com/shadowcat_mst/</a></span>

Email me now on mst &#40;at&#41; shadowcat.co.uk and let&#39;s chat about how our Catalyst
commercial support, training and consultancy packages could help your team.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;20:14:58&nbsp;2012</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, ordering can still matter because of components that wrap
&gt; behaviour - consider two components, one that adds logging to a method,
&gt; and one that adds an authentication check. Which one ends up first will
&gt; decide whether methods that don&#39;t pass the check still trigger the
</div>logging.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I don&#39;t believe Mixer fixes that either though.
</div>
Actually that is exactly the problem Mixer is trying to solve.  If they
weren&#39;t wrapping behaviors, I could just use Traits.  As long as one of
the modules is aware of the existence of the other, they can declare a
constraint to be sure they are put in the right order.

If logging should be first in the call order, it declares
&#34;before=&gt;Authentication&#34; with an optional clause if needed, or if
authentication was written later, it could declare &#34;after=&gt;Logging&#34;,
which assumes optional.

Logging could also be an abstract base class, and any class which
declares &#34;isa=&gt;Logging&#34; will be kept together with logging in the
inheritance chain.

In my structured wiki, the less essential classes usually declare their
rules in relation to more essential classes, such as Storage and IO.  So
for example, the Security class declares &#34;before=&gt;Storage,
requires=&gt;Session&#34; because it must be invoked before things are read or
written, and it needs a session but doesn&#39;t share any methods with it. 
Session declares &#34;after=&gt;IO&#34; because it needs IO to do process cookies
and arguments before it can work. The Index and RCS classes both declare
&#34;before=&gt;Storage&#34; but they don&#39;t care which of them runs first.


Maybe that&#39;s the kind of explanation I need?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;14:18:50&nbsp;2012</span>
    <span class="description">mst [...] shadowcat.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75108] Expand on C3-style usage?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 19 Feb 2012 19:12:26 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> John Williams via RT &lt;bug-Class-Mixer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt S Trout &lt;mst [...] shadowcat.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Feb 18, 2012 at 08:14:59PM -0500, John Williams via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75108">https://rt.cpan.org/Ticket/Display.html?id=75108</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; However, ordering can still matter because of components that wrap
&gt; &gt; behaviour - consider two components, one that adds logging to a method,
&gt; &gt; and one that adds an authentication check. Which one ends up first will
&gt; &gt; decide whether methods that don&#39;t pass the check still trigger the
</div>&gt; logging.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; I don&#39;t believe Mixer fixes that either though.
</div>&gt; 
&gt; Actually that is exactly the problem Mixer is trying to solve.  If they
&gt; weren&#39;t wrapping behaviors, I could just use Traits.  As long as one of
&gt; the modules is aware of the existence of the other, they can declare a
&gt; constraint to be sure they are put in the right order.
&gt; 
&gt; If logging should be first in the call order, it declares
&gt; &#34;before=&gt;Authentication&#34; with an optional clause if needed, or if
&gt; authentication was written later, it could declare &#34;after=&gt;Logging&#34;,
&gt; which assumes optional.
</div>
That allows the classes to specify which one they believe should be first.

isa in C3 handles before in that case, as I say, although not optional-ness.

I&#39;m talking about situations where the user wants to be able to choose
which happens first.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Logging could also be an abstract base class, and any class which
&gt; declares &#34;isa=&gt;Logging&#34; will be kept together with logging in the
&gt; inheritance chain.
&gt; 
&gt; In my structured wiki, the less essential classes usually declare their
&gt; rules in relation to more essential classes, such as Storage and IO.  So
&gt; for example, the Security class declares &#34;before=&gt;Storage,
&gt; requires=&gt;Session&#34; because it must be invoked before things are read or
&gt; written, and it needs a session but doesn&#39;t share any methods with it. 
&gt; Session declares &#34;after=&gt;IO&#34; because it needs IO to do process cookies
&gt; and arguments before it can work. The Index and RCS classes both declare
&gt; &#34;before=&gt;Storage&#34; but they don&#39;t care which of them runs first.
&gt; 
&gt; 
&gt; Maybe that&#39;s the kind of explanation I need?
</div>
Modulo the clarification I made above about what I was talking about, yes
I think it is.

This last reply of yours makes it much much more clear to me what you&#39;re
achieving with Mixer and I think a section of the docs describing those
examples would be a very good idea - it&#39;s taken me from &#34;I&#39;m never going
to use this&#34; to &#34;I&#39;m probably never going to use this but I&#39;m definitely
remembering it exists to steal ideas from if I run into these use cases&#34;.

So if you add that, and try and summarise my explanations of C3 to indicate
more clearly the subset of Mixer&#39;s features that &#34;use mro &#39;c3&#39;;&#34; provides
&#40;I&#39;ll happily proofread that bit&#41; I think you&#39;d have a much better set of
documentation.

Thanks for keeping discussing this, it&#39;s been bloody interesting.

-- 
Matt S Trout - Shadowcat Systems - Perl consulting with a commit bit and a clue

<span class="clickylink"><a target="new" rel="nofollow" href="http://shadowcat.co.uk/blog/matt-s-trout/">http://shadowcat.co.uk/blog/matt-s-trout/</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/shadowcat_mst/">http://twitter.com/shadowcat_mst/</a></span>

Email me now on mst &#40;at&#41; shadowcat.co.uk and let&#39;s chat about how our Catalyst
commercial support, training and consultancy packages could help your team.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;26&nbsp;21:14:18&nbsp;2012</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was busy last week, but here &#40;attached&#41; is the full updated documentation.

I&#39;ve indicated in the &#39;before&#39; section that it is exactly like &#39;use
base&#39; with c3, and included the examples we discussed.

If you want to edit or comment, feel free.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> class-mixer.pod</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=pod

=head1 NAME

Class::Mixer - Arrange class hierarchy based on dependency rules

=head1 SYNOPSIS

    package Base;
    use Class::Mixer;
    sub x { &#39;Base::x&#39; }

    package Main;
    use Class::Mixer before =&gt; &#39;Base&#39;;
    sub x { &#39;Main::x&#39; }

    my $obj = Main-&gt;new&#40;&#41;;
    print &#34;@Main::ISA\n&#34;;  # prints &#34;Base Class::Mixer&#34;

    package Mixin;
    use Class::Mixer before =&gt; &#39;Base&#39;, after =&gt; &#39;Main&#39;;
    sub x { &#39;Mixin::x&#39; }

    package NewMain; 
    use Class::Mixer isa =&gt; &#39;Main&#39;, requires =&gt; &#39;Mixin&#39;;
    sub x { &#39;NewMain::x&#39; }
 
    my $obj = NewMain-&gt;new&#40;&#41;;
    print &#34;@NewMain::ISA\n&#34;;  # prints &#34;Main Mixin Base Class::Mixer&#34;

=head1 DESCRIPTION

This module is designed to solve a problem which occurs when using inheritance
to mixin behaviors into a class hierarchy.  The dependencies between a 
number of mixin modules may be complex. When different components wrap the same
behavior, they often need to be in a specific order in the call chain, 
making it tricky to get the base classes to inherit in the right order.  

Then if you have a class Main which gets the inheritance right, and you want
to add a class Mixin which needs to go in the middle of the 
inheritance, you cannot simply do C&lt;package NewMain; use base qw&#40;Main Mixin&#41;;&gt;
because Mixin will be put at the end of the inheritance chain.

Also, if you have a class Foo::Better which enhances the Foo behavior,
the same problem occurs trying to mixin Foo::Better.  And it is even worse
if some classes have done C&lt;use base &#39;Foo&#39;;&gt; to try to enforce the correct
hierarchy.

This module solves these problems by implementing a dependency-based hierarchy.
You declare the relations between the classes, and an order of inheritance
which will support those relations is determined automatically.

For example, if you have a Logging component and an Authentication component,
the Logging needs to be called first, because if Authentication fails, it will
never be called at all.  In the Logging class, one can declare the Mixer rule
C&lt;&lt; before=&gt;&#39;Authentication&#39;, optional=&gt;&#39;Authentication&#39; &gt;&gt;, so that if Authentication
is in the class hierarchy, Logging will be placed before it, but it will not
complain if it is not there.  Alternatively, one could place the rule
C&lt;&lt; after=&gt;&#39;Logging&#39; &gt;&gt; in the Authentication class to achieve the same result.

Logging could also be an abstract base class, and any class which declares
C&lt;&lt; isa=&gt;&#39;Logging&#39; &gt;&gt; will be kept together with Logging in the inheritance chain.
This allows rules to refer to behavior classes without needing to know
exactly which behavior class will actually be used.

In my own usage, in a structured wiki project, less essential classes usually
declare their rules in relation to more essential classes, such as Storage
and IO.  So for example, the Security class declares C&lt;&lt; before=&gt;&#39;Storage&#39; &gt;&gt;
because it must be invoked before records are stored or retrieved, and also
C&lt;&lt; requires=&gt;&#39;Session&#39; &gt;&gt; because it needs a session but does not share any
behavior methods with it.  Session declares C&lt;&lt; after=&gt;&#39;IO&#39; &gt;&gt; because it needs IO
to process cookies and arguments before it can work.  The Index and Revision
classes both declare C&lt;&lt; before=&gt;&#39;Storage&#39; &gt;&gt; but they do not care which of them
runs first.

Class::Mixer combines functions from base and Class::C3 to do its job.
It will C&lt;require&gt; the given classes &#40;unless optional&#41; similar to C&lt;use base&gt;.
And it attempts to force c3 semantices, so you should
do C&lt;&lt; $self-&gt;method::next &gt;&gt; instead of C&lt;SUPER&gt; for inheritance.

=head1 Inheritance rules

When you design your classes, instead of doing C&lt;use base&gt; or C&lt;our @ISA&gt;,
do something like the following:

    package Example;
    use Class::Mixer before =&gt; &#39;BaseClass&#39;, &#39;OtherClass&#39;,
                     after =&gt; &#39;SoAndSoClass&#39;,
                     isa =&gt; &#39;PreviousExample&#39;,
                     requires =&gt; &#39;OtherBehavior&#39;,
                     optional =&gt; &#39;OtherClass&#39;;

The Class::Mixer class provides a basic new&#40;&#41; method, which will call init&#40;&#41;, 
which your classes can override.

The actual inheritance is computed for a class the first time new&#40;&#41; is called.

The inheritance rules are described here:


=head2 B&lt;before&gt;

The &#39;before&#39; rule means this package must occur before some other
class in the method dispatch order, which means that if they both define
the same method, this class will be invoked before the other.
In the inheritance hierarchy, this class should be a descendant of the other.

This is exactly the same as what you would get if you did C&lt;use base&gt;
instead.  Which you can, and Class::Mixer will notice and use it.

If no rule type is given &#40;e.g. C&lt;use Class::Mixer &#39;BaseClass&#39;;&gt; &#41;
then the before rule is assumed.

=head2 B&lt;after&gt;

The &#39;after&#39; rule means this package must occur after some other
class in the method dispatch order.
The other class will usually be a descendant of this one.
This is best if used rarely, but it is nice when it is necessary.

It is essentially the same as doing C&lt;&lt; before =&gt; &#39;this&#39;, optional =&gt; &#39;this&#39; &gt;&gt;
in the other class.

=head2 B&lt;isa&gt;

The &#39;isa&#39; rule establishes a very strong isa relationship between classes.
All the classes are related by C&lt;@ISA&gt;, of course, but this &#39;isa&#39; means that
the particular behaviors implements by the classes are the same, and that
this one enhances the other.  

The classes are kept together as close as possible in the computed hierarchy,
and all rules which were applied to the other class will be applied to this
class as well.

=head2 B&lt;requires&gt;

The &#39;requires&#39; rule says that this class needs the behavior from some other
class, but the inheritance order is not important.  Usually this is because
the two classes do not share any methods.

=head2 B&lt;optional&gt;

The &#39;optional&#39; rule doesn&#39;t affect the class hierarchy.  It simply makes
the class not complain if the other class is not there.  

This is useful when we want to say, &#34;I do not really need this other class,
but IF someone else does, I should be before &#40;or after&#41; the other class.&#34;

=head1 Why not Traits?

Traits are complementary to inheritance, and do not address situations where
one module needs to extend another by extending/wrapping/inheriting 
the same method.  Traits are more concerned with properly adding new
methods to a class, while Class::Mixer tries to solve some problems
with complex mixin-style inheritance trees.

For example, I have a C&lt;write&gt; method, and several optional behaviors
which happen when C&lt;write&gt; is called, such as an Index behavior and
an VersionControl behavior.  These will both override the C&lt;write&gt; method
and call the parent method before or after they do what they need to do.
But this violates the flattening property of traits.  
The C&lt;write&gt; method in Index and VersionControl are not conflicting; 
they need to inherit, perhaps in a specific order, so that
both with be called.

It may be that what I am actually describing is event-based, because write
is the event, and the behaviors are various things which need to happen
when that event occurs.  None of the event systems I have looked at have
contraints to allow ordering the behaviors relative to each other, so
even if I setup an event model, I would still need the solution which
Class::Mixer provides.

=head1 Comparison with Class::C3::Componentised

Class::C3::Componentised is used in DBIx::Class similarly to Class::Mixer
to implement the same sorts of mixin behaviors.  The difference is 
exemplified by this quote from DBIx::Class::Component, 

&#34;The order in which is you load the components may be very important, 
depending on the component. If you are not sure, then read the docs 
for the components you are using and see if they mention anything about 
the order in which you should load them.&#34;

With Class::Mixer, the user never has to deal with the complexities of
component order.  Component ordering requirements are both documented
and *enforced* by the inheritance rules in each component.  So when
building his application class, he can list the desired component modules 
in any order, and let Class::Mixer put them in a correctly functioning order.

On the other hand, Class::Mixer has no way to override the
rules in the subclasses, so if the user decided he really wanted 
Authentication to happen before Logging, he would have to change the
rules in the subclasses in order to make that happen.

=head1 BUGS and TODO

Probably.

&#34;optional&#34; isn&#39;t fully implemented yet.

TODO?: implement a &#39;nota&#39; rule, to prevent someone from putting this
class in the same hierarchy as another.

=head1 SEE ALSO

L&lt;Class::C3&gt;

L&lt;Class::C3::Componentised&gt;

L&lt;base&gt;

The snide comments in L&lt;mixin&gt; probably apply to this module as well.

=head1 AUTHOR

John Williams, E&lt;lt&gt;smailliw@gmail.comE&lt;gt&gt;

Thanks to Matt S Trout for help clarifying the documentation.

=head1 COPYRIGHT AND LICENCE

Copyright &#40;c&#41; 2009 by John Williams

This library is free software; you can redistribute it and/or modify it 
under the same terms as Perl itself.

=cut

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;27&nbsp;12:25:59&nbsp;2015</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;27&nbsp;12:26:04&nbsp;2015</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Status changed from &#39;deleted&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;27&nbsp;12:26:07&nbsp;2015</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;27&nbsp;12:26:30&nbsp;2015</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Status changed from &#39;deleted&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;13&nbsp;21:53:10&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;13&nbsp;21:53:15&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;deleted&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;13&nbsp;21:53:41&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
