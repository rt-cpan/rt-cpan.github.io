<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57248 for PDF-API2: Cyrillic letters</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57248 for PDF-API2: Cyrillic letters</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PDF-API2/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-API2">PDF-API2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57248</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PDF-API2/Active/">PDF-API2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kuzvesov [...] list.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-24958-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.73    </td>
  </tr>
  <tr id="CF-24959-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;06&nbsp;02:28:32&nbsp;2010</span>
    <span class="description">kuzvesov [...] list.ru -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Cyrillic letters</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">1. The following Cyrillic glyphs &#40;names according to http://
www.adobe.com/
devnet/font/pdfs/5013.Cyrillic_Font_Spec.pdf&#41;

  afii10047 &#40;uppercase &#39;Э&#39;&#41;
  afii10049 &#40;uppercase &#39;Я&#39;&#41;
  afii10095 &#40;lowercase &#39;э&#39;&#41;

are not displayed when using TrueType fonts.
I tried different encodings &#40;CP1251, UTF8&#41; with the same result.

2. When using core fonts, all the cyrillics are displayed overlapping 
each other with CP1251 encoding, and are not displayed at all with UTF8 
encoding.

Perl version v5.10.1 built for MSWin32-x86-multi-thread
Binary build 1007 [291969] provided by ActiveState
Operating system Windows Vista Home Premium, Service Pack 1 &#40;ver. 
6.0.6001&#41;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test-utf8.pdf</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
  use locale;
  use POSIX;
  use PDF::Report;

  my $encoding = &#39;cp1251&#39;;

  POSIX::setlocale&#40;$encoding&#41;
    or die &#39;cannot set locale&#39;;

  my $pdf = new PDF::API2&#40;  &#41;;
  $pdf-&gt;mediabox&#40; &#39;A4&#39; &#41;;

  my $page = $pdf-&gt;page&#40;&#41;;
  my $txt = $page-&gt;text;

  my $font = $pdf-&gt;ttfont&#40;&#39;Times.ttf&#39;, &#39;-encode&#39; =&gt; $encoding &#41;;
  my $fontsize = 12;
  $txt-&gt;font&#40;$font,$fontsize&#41;;
  $txt-&gt;translate&#40;10,700&#41;;
  $txt-&gt;text&#40;&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;&#41;;
  $txt-&gt;translate&#40;10,650&#41;;
  $txt-&gt;text&#40;&#34;abcdefghijklmnopqrstuvwxyz&#34;&#41;;
  $txt-&gt;translate&#40;10,600&#41;;
  $txt-&gt;text&#40;&#34;àáâãäå¸æçèéêëìíîïðñòóôõö÷øùüûúýþÿ&#34;&#41;;
  $txt-&gt;translate&#40;10,550&#41;;
  $txt-&gt;text&#40;&#34;ÀÁÂÃÄÅ¨ÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÛÚÝÞß&#34;&#41;;

  my $font = $pdf-&gt;corefont&#40;&#39;Times&#39;, &#39;-encode&#39; =&gt; $encoding &#41;;
  my $fontsize = 12;
  $txt-&gt;font&#40;$font,$fontsize&#41;;
  $txt-&gt;translate&#40;10,400&#41;;
  $txt-&gt;text&#40;&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;&#41;;
  $txt-&gt;translate&#40;10,350&#41;;
  $txt-&gt;text&#40;&#34;abcdefghijklmnopqrstuvwxyz&#34;&#41;;
  $txt-&gt;translate&#40;10,300&#41;;
  $txt-&gt;text&#40;&#34;àáâãäå¸æçèéêëìíîïðñòóôõö÷øùüûúýþÿ&#34;&#41;;
  $txt-&gt;translate&#40;10,250&#41;;
  $txt-&gt;text&#40;&#34;ÀÁÂÃÄÅ¨ÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÛÚÝÞß&#34;&#41;;

  my $font = $pdf-&gt;corefont&#40;&#39;Times&#39;, &#39;-encode&#39; =&gt; $encoding &#41;;
  my $fontsize = 12;
  $txt-&gt;font&#40;$font,$fontsize&#41;;
  $txt-&gt;translate&#40;10,750&#41;;
  $txt-&gt;text&#40;&#34;Using true type font:&#34;&#41;;
  $txt-&gt;translate&#40;10,450&#41;;
  $txt-&gt;text&#40;&#34;Using core font:&#34;&#41;;

  $pdf-&gt;saveas&#40; &#39;test.pdf&#39; &#41;;</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test-cp1251.pdf</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;16:40:45&nbsp;2016</span>
    <span class="description">philperry [...] hvc.rr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #57248]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 15 Feb 2016 16:40:51 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDF-API2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Phil M Perry &lt;philperry [...] hvc.rr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I modified the example text file to display x40 through xFF for both 
TrueType and Core fonts. I ran it for CP1251 &#40;Cyrillic&#41;, CP1252 &#40;Latin 
1&#41;, CP1253 &#40;Greek&#41;, and CP1254 &#40;Turkish&#41;. This is Windows XP SP3, 
PDF::API2 2.025, Adobe Reader 11.0.08. All four character sets have some 
variety of MS &#34;Smart Quotes&#34; in the x80 - x9F range. I have not yet 
tried UTF-8 encoded text.

In all cases, the TTF displays perfectly, even the unassigned characters 
in the Smart Quotes range. The three Cyrillic characters reported 
missing in the original bug report are present and in the right place. 
All the CoreFont displays have problems with the Smart Quotes unassigned 
characters still displaying the empty box, but evidently having a 
near-zero width &#40;so that the following character mostly overprints it&#41;.

Core Font only problems:
CP1251: All Cyrillic and possibly some other characters print correctly, 
but apparently have about 33% width and are overprinted by following 
characters.
CP1252: The unassigned characters in the Smart Quotes range get 
overprinted, but the rest of the Latin-1 characters look OK.
CP1253: The Greek letters behave just like the Cyrillic letters in 1251.
CP1254: The Turkish letters behave just like the Latin-1 letters in 1252.

The bottom line is that TTF looks OK from here &#40;at least for CP125x 
encoding&#41;, but Core Fonts have trouble with unassigned &#40;&#34;box&#34;&#41; 
characters and non-Latin characters, where the characters look OK, but 
the text location is not advanced far enough and we get overprinting. 
Perhaps the font data &#40;especially character width&#41; isn&#39;t being read 
correctly? Since it works for &#40;e.g.&#41; CP1252, it seems odd that it would 
fail for non-Latin sets &#40;note that Turkish is Latin&#41;. That would imply 
that the font files themselves are defective or non-standard in some way.

To add a comment to this thread, just email bug-PDF-API2 [at] 
rt.cpan.org with subject line [rt.cpan.org #57248]. Note 1 space between 
org and #, and the [ ] around the whole subject. Nothing else. If you 
don&#39;t follow this format carefully, you will end up creating a new bug 
report! HTML formatting within the body does not work.
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;16:40:45&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;22&nbsp;11:34:33&nbsp;2019</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">1: TTF does not appear to be missing any characters, including the three listed, when I tested it.

2: The overlap of characters is because the width listed in PDF::API2::Resource::Font::CoreFont::[fontname].pm&#39;s &#34;missingwidth&#34; value of 250, which is as little as a quarter of what is needed. Only the standard Latin-1 glyphs, and their widths, are listed. Everything else is &#34;missing&#34;. Possibly this could be fixed by extending the [fontname].pm glyph and width tables, but that will be quite a bit of work.

3: Core fonts do not support UTF-8 -- only single byte encodings at this time. UTF-8 support for core and Type1 fonts would certainly be desirable, but I don&#39;t know if it&#39;s feasible to add it.

I think the best resolution of this is to switch to TTF &#40;ttfont&#41; rather than using core fonts.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
