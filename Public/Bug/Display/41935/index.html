<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #41935 for CPAN-Site: CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found outside the normal locations</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #41935 for CPAN-Site: CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found outside the normal locations</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CPAN-Site/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CPAN-Site/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CPAN-Site/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CPAN-Site/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CPAN-Site">CPAN-Site CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">41935</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CPAN-Site/Active/">CPAN-Site</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
matisse [...] spamcop.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-8220-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.23    </td>
  </tr>
  <tr id="CF-8221-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




CPAN-Site-0.24.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/548086/275760/CPAN-Site-0.24.tar.gz">
Mon Dec 29 04:04:56 2008 (65.3k) by Mark [...] Overmeer.net
</a>
</font></li>
</ul>


CPAN-Site-Index.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/551194/277657/CPAN-Site-Index.t">
Wed Jan 07 10:49:17 2009 (4.2k) by matisse [...] spamcop.net
</a>
</font></li>
</ul>


Distro-With-Packages-Outside-lib.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/551194/277654/Distro-With-Packages-Outside-lib.tar.gz">
Wed Jan 07 10:49:17 2009 (561b) by matisse [...] spamcop.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;14:36:58&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages
 found outside the normal locations</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found
outside the normal locations. For example, it will register packages
found in a distributions &#34;inc/&#34; directory.

Example:

PPI-1.203 contains:

PPI-1.203/inc/File/Remove.pm

and inspect_entry&#40;&#41; will register that package as belonging to PPI-1.203.

I think the problem is that inspect_entry&#40;&#41; has the following code,
which only checks package_on_usual_location&#40;&#41; in one case, but not in
the other:

#---------------- Index.pm 0.23 205-225 --------------------------
      while&#40;$out_buf =~ s/^&#40;[^\n]*&#41;\n//&#41;
      {
         local $_ = $1;
         $file &#38;&#38; $file =~ m/\.pm$/ or next;

         if&#40; m/^\s* package \s* &#40;&#40;?:\w+\:\:&#41;*\w+&#41; \s* ;/x &#41;
         {  $package = $1;
            warn &#34;package=$package\n&#34; if $debug;
            register $package, undef, $dist;
         }
         elsif&#40; m/^ &#40;?:use\s+version\s*;\s*&#41;?
                 &#40;?:our&#41;? \s* \$ &#40;?: \w+\:\:&#41;* VERSION \s* \= \s* &#40;.*&#41;/x &#41;
         {  local $VERSION;  # destroyed by eval
            $version = eval &#34;my \$v = $1&#34;;
            $version = $version-&gt;numify if ref $version;
            warn &#34;version=$version\n&#34;   if $debug;

            register $package, $version, $dist
               if $package &#38;&#38; package_on_usual_location $file;
         }
      }
#------------------------------------end snip-----------------

I am creating a unit test for this and will post it and a fix here as
soon as I can, but because I need to get permission from the legal
department for the post-back this may not be until some time in January.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;29&nbsp;04:04:55&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41935] CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found outside the normal locations</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Dec 2008 10:04:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [081224 19:36]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Dec 24 14:36:58 2008: Request 41935 was acted upon.
&gt; Transaction: Ticket created by MATISSE
&gt;        Queue: CPAN-Site
&gt;      Subject: CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages
&gt; 
&gt; 
&gt; CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found
&gt; outside the normal locations. For example, it will register packages
&gt; found in a distributions &#34;inc/&#34; directory.
</div>
Great :&#40;
For me, CPAN::Site has quite a low priority, so I fix fast and break
easy.  Of course, adding many regression tests would make it into a
much better module... but the concept is quite flawed in the first
place.  CPAN6 is the future.

I think the better fix is to move the &#34;usual_location&#34; test to before
any attempts for regexes.

    $out_buf .= $in_buf;
    while&#40;$out_buf =~ s/^&#40;[^\n]*&#41;\n//&#41;
    {
        local $_ = $1;
 -      $file &#38;&#38; $file =~ m/\.pm$/ or next;
 +      $file &#38;&#38; $file =~ m/\.pm$/ &#38;&#38; package_on_usual_location $file
 +         or next;

This is the fix I will release now.
But I think it should go much higher up...


   $out_buf .= $in_buf;
   unless&#40;$file &#38;&#38; $file =~ m/\.pm$/ &#38;&#38; package_on_usual_location $file&#41;
   {   $out_buf =~ s/.*\n//;    # purge whole lines
       next;
   }
   
   while&#40;$out_buf =~ s/^&#40;[^\n]*&#41;\n//&#41;
   {
       local $_ = $1;
 -     $file &#38;&#38; $file =~ m/\.pm$/ or next;

Or even further up.  See $inspect_this_file
in the attached pre-release.

But the only real solution is to use Archive::Tar for the whole
procedure.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/548086/275760/CPAN-Site-0.24.tar.gz">Download CPAN-Site-0.24.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gunzip 65.3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;29&nbsp;04:04:57&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;29&nbsp;14:28:18&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 29 04:04:55 2008, Mark@Overmeer.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ... Of course, adding many regression tests would make it into a
&gt; much better module...
</div>
I have created a regression test for this issue, and as soon as I get
clearance from  the legal folks at work I will upload it &#40;I have agreed
to get permission first for all open-source releases I make.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;... but the concept is quite flawed in the first
&gt; place.  CPAN6 is the future.
</div>
That is probably true but, CPAN::Site is what we have now.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think the better fix is to move the &#34;usual_location&#34; test to before
&gt; any attempts for regexes.
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is the fix I will release now.
&gt; But I think it should go much higher up...
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Or even further up.  See $inspect_this_file
&gt; in the attached pre-release.
</div>
I agree that checking higher up is better.

I ran my new regression tests on the pre-release version and it passed.

Suggestions:

Change the variable name from: $inspect_this_file
to a more &#34;boolean-sounding&#34; name:
  $file_is_candidate_for_registration

and also change line 212 from &#34;next;&#34; to &#34;next BLOCK;&#34;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But the only real solution is to use Archive::Tar for the whole
&gt; procedure.
</div>
That is also more or less true - I think that is the basis of the ticket
brian d foy opened:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=40301">https://rt.cpan.org/Ticket/Display.html?id=40301</a></span> 

I have used CPAN::Site at three different companies now to help maintain
private CPAN repositories where we want two important things:

1. Have only specific versions of public modules available, not the
whole CPAN. We occasionally add/upgrade modules.

2. Add our own locally created modules to the repository.

It&#39;s possible that CPAN6 will make this much easier, but that is far in
the future.

I wonder if there is enough interest from enough people/companies to
create a solid framework for creating and maintaining private CPAN repos
behind a company firewall. Different companies have different needs. The
Java world has a dependency manager called  Ivy
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tls.cena.fr/products/ivy/&#41;">http://www.tls.cena.fr/products/ivy/&#41;</a></span> which supports &#34;chaining&#34;
repositories.

Anyway, the fix for this ticket seems good to me and I will send you my
regression tests as soon as I get clearance.

Thanks for the work of maintaining this distribution - I know how much
of a pain in the ass it can be :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;30&nbsp;05:38:22&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41935] CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found outside the normal locations</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Dec 2008 11:38:04 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [081229 19:28]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: CPAN-Site
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=41935">https://rt.cpan.org/Ticket/Display.html?id=41935</a></span> &gt;
<div class="message-stanza open">&gt; &gt; place.  CPAN6 is the future.
</div>&gt; That is probably true but, CPAN::Site is what we have now.
</div>
True.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Change the variable name from: $inspect_this_file
&gt; to a more &#34;boolean-sounding&#34; name:
&gt;   $file_is_candidate_for_registration
</div>
I cannot see any other value than a boolean related to that name.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and also change line 212 from &#34;next;&#34; to &#34;next BLOCK;&#34;
</div>
Yes, not need but more readible.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s possible that CPAN6 will make this much easier, but that is far in
&gt; the future.
</div>
Hopefully not too far... but I have so much to do before it works:
all the building bricks are not present either :&#40;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tls.cena.fr/products/ivy/&#41;">http://www.tls.cena.fr/products/ivy/&#41;</a></span> which supports &#34;chaining&#34;
&gt; repositories.
</div>
CPAN6 has chaining, sub-setting and composition of archives.  &#40;one
archive can be mirrored in multiple repositories&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway, the fix for this ticket seems good to me and I will send you my
&gt; regression tests as soon as I get clearance.
</div>
ok.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the work of maintaining this distribution - I know how much
&gt; of a pain in the ass it can be :-&#41;
</div>
I always like it when people contribute.  IMO, you should only
publish modules if you maintain them... there are so many unmaintained
modules on CPAN, its a horror.  You&#39;re contributions are very helpful
to other people.

I have just release 0.24.  The regression-tests can be added later.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;10:49:17&nbsp;2009</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am attaching a new version of the unit tests for CPAN::Site::Index and
a small tarball that is used by a new test.

The file CPAN-Site-Index.t replaces  t/CPAN-Site-Index.t

The tarball should be added as:
t/test_data/Distro-With-Packages-Outside-lib.tar.gz
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/551194/277654/Distro-With-Packages-Outside-lib.tar.gz">Download Distro-With-Packages-Outside-lib.tar.gz</a><br />
<span class="downloadcontenttype">application/x-tar 561b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl
use warnings;
use strict;

# CPAN-Site-Index.t - unit tests for CPAN::Site::Index
#-------------------------------------------------------------------------------
use strict;
use warnings;
use FindBin qw&#40;$Bin&#41;;
use Test::More tests =&gt; 53;

use_ok&#40;&#39;CPAN::Site::Index&#39;&#41;
    || BAIL_OUT&#40;&#39;Failed to compiled module CPAN::Site::Index&#39;&#41;;

test_inspect_entry_for_distro_with_strange_data&#40;&#41;;
test_inspect_entry_for_distro_with_packages_that_should_not_be_registered&#40;&#41;;

exit;

#-------------------------------------------------------------------------------

sub test_inspect_entry_for_distro_with_strange_data {
    my $distro_to_test = &#39;Text-PDF-0.29a.tar.gz&#39;;
    my %want_packages  = &#40;
        &#39;Text::PDF::Array&#39;           =&gt; undef,
        &#39;Text::PDF::Bool&#39;            =&gt; undef,
        &#39;Text::PDF::Dict&#39;            =&gt; undef,
        &#39;Text::PDF::File&#39;            =&gt; &#39;0.27&#39;,
        &#39;Text::PDF::Filter&#39;          =&gt; undef,
        &#39;Text::PDF::ASCII85Decode&#39;   =&gt; undef,
        &#39;Text::PDF::RunLengthDecode&#39; =&gt; undef,
        &#39;Text::PDF::ASCIIHexDecode&#39;  =&gt; undef,
        &#39;Text::PDF::FlateDecode&#39;     =&gt; undef,
        &#39;Text::PDF::LZWDecode&#39;       =&gt; undef,
        &#39;Text::PDF::Name&#39;            =&gt; undef,
        &#39;Text::PDF::Null&#39;            =&gt; undef,
        &#39;Text::PDF::Number&#39;          =&gt; undef,
        &#39;Text::PDF::Objind&#39;          =&gt; undef,
        &#39;Text::PDF::Page&#39;            =&gt; undef,
        &#39;Text::PDF::Pages&#39;           =&gt; undef,
        &#39;Text::PDF::SFont&#39;           =&gt; undef,
        &#39;Text::PDF::String&#39;          =&gt; undef,
        &#39;Text::PDF::TTFont&#39;          =&gt; undef,
        &#39;Text::PDF::TTIOString&#39;      =&gt; undef,
        &#39;Text::PDF::TTFont0&#39;         =&gt; undef,
        &#39;Text::PDF::Utils&#39;           =&gt; undef,
        &#39;Text::PDF&#39;                  =&gt; &#39;0.29&#39;,
    &#41;;
    _test_inspect_entry_for_distro&#40; $distro_to_test, \%want_packages &#41;;
}

sub test_inspect_entry_for_distro_with_packages_that_should_not_be_registered {
    my $distro_to_test = &#39;Distro-With-Packages-Outside-lib.tar.gz&#39;;
    my %want_packages  = &#40;
        &#39;TopOfDistro&#39; =&gt; &#39;0.01&#39;,
        &#39;InsideLib&#39;   =&gt; &#39;0.01&#39;,
    &#41;;
    _test_inspect_entry_for_distro&#40; $distro_to_test, \%want_packages &#41;;
}

sub _test_inspect_entry_for_distro {
    my $distro        = shift;
    my $want_packages = shift;

    # inspect_entry&#40;&#41; relies upon a global variable $topdir which
    # we is declared with &#39;our&#39; in Index.pm so we can set it here for testing.
    $CPAN::Site::Index::topdir = &#34;$Bin/test_data&#34;;

    # inspect_entry is called in Index.pm using File::Find
    #   find { wanted =&gt; \&#38;inspect_entry, no_chdir =&gt; 1 }, $topdir;
    # so we set two variables that File::Find normally sets:
    $File::Find::name = &#34;$CPAN::Site::Index::topdir/$distro&#34;;
    $File::Find::dir  = $CPAN::Site::Index::topdir;
    note&#40;&#34;Checking $File::Find::name in $File::Find::dir&#34;&#41;;

    $CPAN::Site::Index::findpkgs = {};
    CPAN::Site::Index::inspect_entry&#40;&#41;;

    my @missing_pkgs = &#40;&#41;;
    foreach my $want_pkg &#40; sort keys %{$want_packages} &#41; {
        my $have_package = exists $CPAN::Site::Index::findpkgs-&gt;{$want_pkg};
        ok&#40; $have_package, &#34;Found package &#39;$want_pkg&#39; in tarball.&#34; &#41;
            || push @missing_pkgs, $want_pkg;
    SKIP: {
            skip&#40; &#34;Didn&#39;t find &#39;$want_pkg&#39;, no point in testing VERSION&#34;, 1 &#41;
                unless $have_package;
            my $have_version = $CPAN::Site::Index::findpkgs-&gt;{$want_pkg}-&gt;[0];
            my $want_version = $want_packages-&gt;{$want_pkg};
            is&#40; $have_version, $want_version,
                &#34;Got expected version of $want_pkg&#34; &#41;;
        }
    }
    if &#40;@missing_pkgs&#41; {
        diag&#40;
            &#34;Missing packages: @missing_pkgs\n\n&#34;,
            &#39;Packages found: &#39;,
            explain&#40;$CPAN::Site::Index::findpkgs&#41;
        &#41;;
    }

    my @unexpected_packages = &#40;&#41;;
    foreach my $got_package &#40; sort keys %{$CPAN::Site::Index::findpkgs} &#41; {
        if &#40; not exists $want_packages-&gt;{$got_package} &#41; {
            push @unexpected_packages, $got_package;
        }
    }
    is&#40; scalar @unexpected_packages,
        0, &#34;No unexpected packages found in $distro&#34; &#41;
        || diag&#40;
        &#34;Got unexpected packages in distro &#39;$distro&#39;:\n\t&#34;,
        join&#40; &#34;\n\t&#34;, @unexpected_packages &#41;,
        &#41;;

    #diag Test::More::explain&#40;$CPAN::Site::Index::findpkgs&#41;;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;04:01:21&nbsp;2009</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41935] CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found outside the normal locations</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 21 Jan 2009 10:01:01 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [090107 15:49]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: CPAN-Site
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=41935">https://rt.cpan.org/Ticket/Display.html?id=41935</a></span> &gt;
&gt; 
&gt; I am attaching a new version of the unit tests for CPAN::Site::Index and
&gt; a small tarball that is used by a new test.
&gt; 
&gt; The file CPAN-Site-Index.t replaces  t/CPAN-Site-Index.t
&gt; 
&gt; The tarball should be added as:
&gt; t/test_data/Distro-With-Packages-Outside-lib.tar.gz
</div>
I would have preferred this second test in a seperate script.  But...
have released it anyway.

Released as 0.25
-- 
Thank you very much for your effort!

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;04:26:56&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixed
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;04:26:57&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;07:37:57&nbsp;2009</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41935] CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found outside the normal locations</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 3 Feb 2009 13:13:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [090107 15:49]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: CPAN-Site
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=41935">https://rt.cpan.org/Ticket/Display.html?id=41935</a></span> &gt;
&gt; 
&gt; I am attaching a new version of the unit tests for CPAN::Site::Index and
&gt; a small tarball that is used by a new test.
</div>
CPAN-testers report this problem:  &#40;on Windows&#41;
   <span class="clickylink"><a target="new" rel="nofollow" href="http://nntp.x.perl.org/group/perl.cpan.testers/3161212">http://nntp.x.perl.org/group/perl.cpan.testers/3161212</a></span>
You may have an idea how to fix this.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;07:37:59&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;12:10:00&nbsp;2009</span>
    <span class="description">matisse [...] matisse.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41935] CPAN::Site::Index::inspect_entry&#40;&#41; will register some packages found outside the normal locations</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 3 Feb 2009 09:09:33 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN-Site [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matisse Enzer &lt;matisse [...] matisse.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Feb 3, 2009, at 4:37 AM, Mark Overmeer via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=41935">https://rt.cpan.org/Ticket/Display.html?id=41935</a></span> &gt;
&gt;
&gt; * Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [090107 15:49]:
<div class="message-stanza open">&gt;&gt;       Queue: CPAN-Site
&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=41935">https://rt.cpan.org/Ticket/Display.html?id=41935</a></span> &gt;
&gt;&gt;
&gt;&gt; I am attaching a new version of the unit tests for  
&gt;&gt; CPAN::Site::Index and
&gt;&gt; a small tarball that is used by a new test.
</div>&gt;
&gt; CPAN-testers report this problem:  &#40;on Windows&#41;
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://nntp.x.perl.org/group/perl.cpan.testers/3161212">http://nntp.x.perl.org/group/perl.cpan.testers/3161212</a></span>
&gt; You may have an idea how to fix this.
</div>
I don&#39;t have a Windows system to test on, but, the first thing I&#39;d  
like to understand is why the &#34;No such file or directory&#34; message:

    t/CPAN-Site-Index....&#39;S:/bin/dev/perl/cpan/build/CPAN-Site-0.25- 
kISQ7E/t/test_data/Text-PDF-0.29a.tar.gz&#39;.gz: No such file or directory

For one thing, &#34;.gz&#34; appears twice in that message. That seems to be  
just a problem with the error message itself - notice the single  
quoted path:

   &#39;S:/bin/dev/perl/cpan/build/CPAN-Site-0.25-kISQ7E/t/test_data/Text- 
PDF-0.29a.tar.gz&#39;

Maybe Windows is adding an extra .gz to the path?

-Matisse
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;06&nbsp;18:18:51&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Report on old code; problem possible disappeared.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;06&nbsp;18:18:52&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
