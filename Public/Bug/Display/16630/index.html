<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #16630 for Net-DNS: Net::DNS::Resolver::Recurse issues lots of IMHO unnecessary DNS requests.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #16630 for Net-DNS: Net::DNS::Resolver::Recurse issues lots of IMHO unnecessary DNS requests.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-DNS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-DNS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-DNS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-DNS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">16630</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-DNS">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">OLAF [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
210726 [...] rt.noris.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.55    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




PGP.sig<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/152067/46442/PGP.sig">
Thu Dec 22 09:20:17 2005 (227b) by JEB [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/152065/46435/PGP.sig">
Thu Dec 22 08:36:11 2005 (227b) by JEB [...] cpan.org
</a>
</font></li>
</ul>


test-rr.debug<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/152059/46291/test-rr.debug">
Tue Dec 20 07:45:31 2005 (61.8k) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=16630">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152059" href="/Public/Bug/Display.html?id=16630#txn-152059">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;20&nbsp;07:45:31&nbsp;2005</span>
    <span class="description">FANY [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::DNS::Resolver::Recurse issues lots of IMHO unnecessary DNS
 requests.</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/152059/46290/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46290">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When trying to find out why our monitoring system occasionally
gets timeouts when trying to resolve NS records using
Net::DNS::Resolver::Recurse version 515 from Net::DNS 0.55
&#40;that is, the resolving process sometimes seems to take about
a minute&#41;, I noticed that Net::DNS::Resolver::Recurse issues
a lot of IMHO unneccessary queries, e.g. it needs 18 queries
for resolving &#40;the A RRset for&#41; www.noris.de where 6 should
be sufficient, cmp. the debug output attached, which I
created using the following script:

| #!/usr/bin/perl -w
|
| use strict;
|
| use Net::DNS::Resolver::Recurse;
|
| my $res = Net::DNS::Resolver::Recurse-&gt;new or die;
| $res-&gt;hints&#40;&#39;198.41.0.4&#39;&#41;;
| $res-&gt;debug&#40;1&#41;;
| $res-&gt;query_dorecursion&#40;&#39;www.noris.de&#39;&#41;;

The problem is as follows:

In its answer to request #2, c.de.net tells the module that dns{1,2,3}.noris.net are authoritative for noris.net, but does
not provide IP addresses for this servers in the additional
section.

So Net::DNS::Resolver::Recurse tries to find out these IP
addresses itself, which it does in a very unefficient manner:

* It first tries to look up an AAAA RRset for dns1.noris.net,
  even though our machine does not have IPv6 connectivity anyway.

* When it learns from answer #5 that there is no AAAA record
  for dns1.noris.net, it starts to look up the A RRset for
  that server. Although it should already know from answer #4
  that dns.noris.{de,net,ch} are authoritative for noris.net,
  it starts over at d.root-servers.net to find that out again
  &#40;requests #6 and #7&#41;.

* After finding out the &#40;A&#41;ddress for dns1.noris.net it does
  the same &#40;first resolving the AAAA RRset, then the A RRset&#41;
  for dns{2,3}.noris.net, issuing ten further DNS queries &#40;#8
  to #17&#41;.  Why does it do that anyway?  IMHO the knowledge
  of the address of dns1.noris.net should be sufficient to
  send query #18 and thus determine the requested answer.

Please let me know whether you intend to optimize this in the
near future yourself, or if you&#39;d appreciate a patch for it,
because if neither nor, I&#39;d probably have to switch back to
my own resolver library.

Regards,
fany
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/152059/46291/test-rr.debug">Download test-rr.debug</a><br />
<span class="downloadcontenttype">application/octet-stream 61.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152060" href="/Public/Bug/Display.html?id=16630#txn-152060">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;20&nbsp;08:01:08&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152061" href="/Public/Bug/Display.html?id=16630#txn-152061">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;20&nbsp;08:01:08&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/152061/46292/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46292">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 536b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[FANY - Tue Dec 20 07:45:31 2005]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please let me know whether you intend to optimize this in the
&gt; near future yourself, or if you&#39;d appreciate a patch for it,
&gt; because if neither nor, I&#39;d probably have to switch back to
&gt; my own resolver library.
&gt; 
</div>

I&#39;ll have a crack at this soon.

I am not planning on doing a major rewrite of this code since but I&#39;ll see how we can gain 
withouth needing to maintain a &#34;cache&#34;.

I hope to have something by end of year. If you have patches available allready I&#39;d like to 
have a look,

--Olaf
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152062" href="/Public/Bug/Display.html?id=16630#txn-152062">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;21&nbsp;03:42:38&nbsp;2005</span>
    <span class="description">FANY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/152062/46359/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46359">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 191b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Olaf,

thanks for your quick reply!

[OLAF - Tue Dec 20 08:01:08 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you have patches available allready I&#39;d like to have a look,
</div>
Sorry, I haven&#39;t written one yet.

Regards,
fany
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152063" href="/Public/Bug/Display.html?id=16630#txn-152063">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;06:44:17&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/152063/46429/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46429">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[FANY - Tue Dec 20 07:45:31 2005]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * It first tries to look up an AAAA RRset for dns1.noris.net,
&gt;   even though our machine does not have IPv6 connectivity anyway.
</div>
Intermediary result:

This patch below is trivial and will help you with the above. The code will not do AAAA 
queries if there is no V6 support. Where V6 support is defined as having Socket6 and 
IO::Socket::INET6 installed.

If you have those two modules and you do not have V6 transport then you are toast. The only 
option you have then is to set $Net::DNS::Resolver::Base::has_inet6=0;


--Olaf

=========================================================
==========
--- lib/Net/DNS/Resolver/Recurse.pm     &#40;revision 545&#41;
+++ lib/Net/DNS/Resolver/Recurse.pm     &#40;working copy&#41;
@@ -165,16 +165,19 @@
     foreach my $ns &#40;keys %{ $known_authorities }&#41; {
       if &#40;!@{ $known_authorities-&gt;{$ns} }&#41; {
         print &#34;;; _dorecursion&#40;&#41; Manual lookup for authority [$ns]\n&#34; if $self-&gt;{&#39;debug&#39;};
-        my $auth_packet =
-           $self-&gt;_dorecursion
-           &#40;$self-&gt;make_query_packet&#40;$ns,&#34;AAAA&#34;&#41;,  # packet
-            &#34;.&#34;,               # known_zone
-            $self-&gt;{&#39;hints&#39;},  # known_authorities
-            $depth+1&#41;;         # depth
+        my $auth_packet;
        my @ans;
-       @ans = $auth_packet-&gt;answer if $auth_packet;
+
+       if &#40;$Net::DNS::Resolver::Base::has_inet6&#41;{
+           $auth_packet =
+               $self-&gt;_dorecursion
+               &#40;$self-&gt;make_query_packet&#40;$ns,&#34;AAAA&#34;&#41;,  # packet
+                &#34;.&#34;,               # known_zone
+                $self-&gt;{&#39;hints&#39;},  # known_authorities
+                $depth+1&#41;;         # depth
+           @ans = $auth_packet-&gt;answer if $auth_packet;
+       }
 
-
        $auth_packet =
            $self-&gt;_dorecursion
            &#40;$self-&gt;make_query_packet&#40;$ns,&#34;A&#34;&#41;,  # packet
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152064" href="/Public/Bug/Display.html?id=16630#txn-152064">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;07:31:15&nbsp;2005</span>
    <span class="description">FANY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> 210726 [...] rt.noris.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/152064/46432/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46432">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[OLAF - Thu Dec 22 06:44:17 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This patch below is trivial and will help you with the above.
&gt; The code will not do AAAA queries if there is no V6 support.
</div>
Thanks a lot so far!  That is already half the battle for us and
should significantly lower the probability of getting timeouts
again.

BTW, another fact I haven&#39;t mentioned yet:  These timeouts
usually occur when at least one of the relevant nameservers is
not reachable, because in this case several retries are sent to
that server in a row before falling back to another server at
the same level, e.g.:

;; _dorecursion&#40;&#41; depth=[3] known_zone=[.]
;; _dorecursion&#40;&#41; cutting deck of &#40;13&#41; authorities...
;; _dorecursion&#40;&#41; Trying nameserver [198.32.64.12]
;; send_udp&#40;198.32.64.12:53&#41;
;; send_udp&#40;198.32.64.12:53&#41;
;; send_udp&#40;198.32.64.12:53&#41;
;; send_udp&#40;198.32.64.12:53&#41;
;; _dorecursion&#40;&#41; Trying nameserver [192.203.230.10]
;; send_udp&#40;192.203.230.10:53&#41;
;; answer from 192.203.230.10:53 : 501 bytes

That, of course, can cost many seconds.  I think it&#39;d be better
to send retries alternately to each available server.

Regards,
fany
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152065" href="/Public/Bug/Display.html?id=16630#txn-152065">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;08:36:10&nbsp;2005</span>
    <span class="description">olaf [...] dacht.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Olaf M. Kolkman&#34; &lt;olaf [...] dacht.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16630] Net::DNS::Resolver::Recurse issues lots of IMHO unnecessary DNS requests. </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Dec 2005 14:35:12 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/152065/46434/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46434">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Dec 22, 2005, at 13:31 , via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; Thanks a lot so far!  That is already half the battle for us and
&gt; should significantly lower the probability of getting timeouts
&gt; again.
&gt;
</div>
In fact.. it turns out that it can be done a little more elegant. But  
let me
first continue with the other parts.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BTW, another fact I haven&#39;t mentioned yet:  These timeouts
&gt; usually occur when at least one of the relevant nameservers is
&gt; not reachable, because in this case several retries are sent to
&gt; that server in a row before falling back to another server at
&gt; the same level, e.g.:
</div>

As an aside...

Don;t you guys have a caching forwarder available somewhere in your
infrastructure that does the work for you? &#40;the one from /etc/ 
resolv.conf ?&#41; Net::DNS::Resolver
will automagically fire queries to those servers.

I like hacking the Recursive resolver in perl but you will never get the
speed that you would get if you would let your local resolver figure  
stuff out.

Besides you will have the benefit of caching, which sort of saves the  
Internet.

--Olaf

------------------------------------------------------
Ik dacht net... heel even maar.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/152065/46435/PGP.sig">Download PGP.sig</a><br />
<span class="downloadcontenttype">application/pgp-signature 227b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152066" href="/Public/Bug/Display.html?id=16630#txn-152066">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;09:00:01&nbsp;2005</span>
    <span class="description">FANY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> fany [...] noris.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/152066/46439/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46439">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 424b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[olaf@dacht.net - Thu Dec 22 08:36:10 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Don;t you guys have a caching forwarder available somewhere in your
&gt; infrastructure that does the work for you?
</div>
Of course we have.  For our domain monitoring, however, I cannot use
caching &#40;at least not up to the normal TTLs&#41;, because its main purpose
is to notice quickly if there&#39;s any problem regarding the delegation of
one of the domains being monitored.

Regards,
fany
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152067" href="/Public/Bug/Display.html?id=16630#txn-152067">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;09:20:17&nbsp;2005</span>
    <span class="description">olaf [...] dacht.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Olaf M. Kolkman&#34; &lt;olaf [...] dacht.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16630] Net::DNS::Resolver::Recurse issues lots of IMHO unnecessary DNS requests. </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Dec 2005 15:19:31 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/152067/46441/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46441">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 662b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Of course we have.  For our domain monitoring, however, I cannot use
&gt; caching &#40;at least not up to the normal TTLs&#41;, because its main purpose
&gt; is to notice quickly if there&#39;s any problem regarding the  
&gt; delegation of
&gt; one of the domains being monitored.
&gt;
</div>
But in that case you have a list of authoritative nameservers that  
provide the delegation and you do not need the whole recursion do you?

Anyway, I am working on it... I may have to build a somewhat more  
persistent and intelligent cache for the Recurse method itself. Still  
investigating.

--Olaf



------------------------------------------------------
Ik dacht net... heel even maar.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/152067/46442/PGP.sig">Download PGP.sig</a><br />
<span class="downloadcontenttype">application/pgp-signature 227b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-152068" href="/Public/Bug/Display.html?id=16630#txn-152068">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;09:58:10&nbsp;2005</span>
    <span class="description">FANY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> fany [...] noris.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/152068/46447/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46447">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 619b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[olaf@dacht.net - Thu Dec 22 09:20:17 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; For our domain monitoring, however, I cannot use
&gt; &gt; caching &#40;at least not up to the normal TTLs&#41;, because its main
&gt; &gt; purpose is to notice quickly if there&#39;s any problem regarding the
&gt; &gt; delegation of one of the domains being monitored.
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But in that case you have a list of authoritative nameservers that
&gt; provide the delegation and you do not need the whole recursion do you?
</div>
I&#39;d like to be able to detect problems at any level of the
delegation hierarchy, e.g. the nameservers for the TLD may
fail or the NIC might let expire one of the domains.

Regards,
fany
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-187434" href="/Public/Bug/Display.html?id=16630#txn-187434">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;18&nbsp;05:29:54&nbsp;2006</span>
    <span class="description">OLAF [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-218294" href="/Public/Bug/Display.html?id=16630#txn-218294">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;04&nbsp;03:25:44&nbsp;2006</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/218294/88336/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/88336">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 152b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
A status update

I have not found any time to work on this issue yet. It involves some code overhaul and I am 
somewhat conservative with that.

--Olaf
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-403074" href="/Public/Bug/Display.html?id=16630#txn-403074">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;28&nbsp;11:53:06&nbsp;2007</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1397633" href="/Public/Bug/Display.html?id=16630#txn-1397633">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;12&nbsp;09:29:52&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1397633/742036/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/742036">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 82b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">0.79 implements a glue cache which greatly reduces the total number of queries.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1397634" href="/Public/Bug/Display.html?id=16630#txn-1397634">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;12&nbsp;09:29:53&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1408410" href="/Public/Bug/Display.html?id=16630#txn-1408410">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;08:11:46&nbsp;2014</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.734678</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
