<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78449 for Net-Server: </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78449 for Net-Server: </h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Server/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Server/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Server/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Server/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Server">Net-Server CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78449</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Server/Active/">Net-Server</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
VKHERA [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23138-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.006    </td>
  </tr>
  <tr id="CF-23139-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;11:04:43&nbsp;2012</span>
    <span class="description">VKHERA [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On a server without IPv6 enabled &#40;FreeBSD 8.2 in this case&#41; Net::Server will not start a 
server because it attempts to bind to the IPv6 address if it finds the supported 
modules.  The changelog for 2.006 indicates this is a specifically handled case, but it 
seems not.


[mmstaging]~% perl -e &#39;use base qw&#40;Net::Server&#41;; main-&gt;run&#40;host =&gt; &#34;localhost&#34;&#41;&#39; 
2012/07/18-10:57:51 main &#40;type Net::Server&#41; starting! pid&#40;36856&#41;
Resolved [localhost]:20203 to [::1]:20203, IPv6
Resolved [localhost]:20203 to [127.0.0.1]:20203, IPv4
Binding to TCP port 20203 on host ::1 with IPv6
2012/07/18-10:57:51 Can&#39;t connect to TCP port 20203 on ::1 [Protocol not 
supported]
  at line 67 in file /usr/local/lib/perl5/site_perl/5.14.2/Net/Server/Proto/TCP.pm
2012/07/18-10:57:51 Server closing!

&#34;localhost&#34; resolves to just 127.0.0.1, nothing else.  I do not know how it is finding 
&#34;:;1&#34; above:

[mmstaging]~% host localhost
localhost.m1e.net has address 127.0.0.1


Workaround is to explicitly request IPv4 for now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;11:41:34&nbsp;2012</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m not quite sure what the best behavior is in this case - you have DNS
answering for IPv6 for the name &#34;localhost&#34; and you have the Socket6
libraries installed but you don&#39;t have IPv6 enabled.

Seems like if you don&#39;t have IPv6 enabled then DNS shouldn&#39;t be
resolving that name either - seems a little broken to have one but not
the other &#40;they are two different systems DNS vs local protocols - but
by using a non-address hostname both systems have to get used&#41;.  By
passing a name instead of an address you are asking Net::Server to
resolve the name - which in this case resulted in an IPv4 address and an
IPv6 address - which was resolved using IPv6 libraries on the system.

You are the first I&#39;ve heard from with this particular problem &#40;all of
the libraries+DNS but IPv6 not actually enabled&#41;.

About the closest I could see us coming to fixing your particular
problem is allowing for a warn without a die if a hostname resolved to
both ipv4 and ipv6 and you are on a system &#40;like the bsds&#41; that tend to
have sysctl bind-ipv6-only=1, but the ipv6 could not be bound.  Do you
have a fast way to check if ipv6 is enabled on bsd without actually
attempting to bind a port?

Up until 2.005, I had adopted the behavior of not binding ipv6 unless
asked.  However, slow as it may be, the world is migrating towards ipv6
and we have people using Net::Server that only have ipv6 addresses on
their hosts.  They and others raised very good points that if you are
passing in a hostname &#40;not a ipv4 or a ipv6 address&#41;, it should bind to
what is returned by the hostname lookup - so if your hostname lookup
returns ipv6, it should try and bind it.

There are plenty of arguments to be had on both sides of the issue.

Paul

On Wed Jul 18 11:04:43 2012, VKHERA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On a server without IPv6 enabled &#40;FreeBSD 8.2 in this case&#41;
&gt; Net::Server will not start a
&gt; server because it attempts to bind to the IPv6 address if it finds the
&gt; supported
&gt; modules.  The changelog for 2.006 indicates this is a specifically
&gt; handled case, but it
&gt; seems not.
&gt; 
&gt; 
&gt; [mmstaging]~% perl -e &#39;use base qw&#40;Net::Server&#41;; main-&gt;run&#40;host =&gt;
&gt; &#34;localhost&#34;&#41;&#39;
&gt; 2012/07/18-10:57:51 main &#40;type Net::Server&#41; starting! pid&#40;36856&#41;
&gt; Resolved [localhost]:20203 to [::1]:20203, IPv6
&gt; Resolved [localhost]:20203 to [127.0.0.1]:20203, IPv4
&gt; Binding to TCP port 20203 on host ::1 with IPv6
&gt; 2012/07/18-10:57:51 Can&#39;t connect to TCP port 20203 on ::1 [Protocol
&gt; not
&gt; supported]
&gt;   at line 67 in file
&gt; /usr/local/lib/perl5/site_perl/5.14.2/Net/Server/Proto/TCP.pm
&gt; 2012/07/18-10:57:51 Server closing!
&gt; 
&gt; &#34;localhost&#34; resolves to just 127.0.0.1, nothing else.  I do not know
&gt; how it is finding
&gt; &#34;:;1&#34; above:
&gt; 
&gt; [mmstaging]~% host localhost
&gt; localhost.m1e.net has address 127.0.0.1
&gt; 
&gt; 
&gt; Workaround is to explicitly request IPv4 for now.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;11:41:34&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;11:55:12&nbsp;2012</span>
    <span class="description">VKHERA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My DNS does *not* return IPv6.  There seems to be some shortcut in the perl resolver 
that is giving back an IPv6 address for localhost.

If I run the above perl one-liner using the machines hostname, it does not find any 
IPv6 address, and thus only binds to the IPv4 it was given by DNS.

I will dig further to see why perl gets an IPv6 address when my resolver doesn&#39;t give it 
one.


[mmstaging]~% dig localhost

; &lt;&lt;&gt;&gt; DiG 9.6.-ESV-R3 &lt;&lt;&gt;&gt; localhost
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 63943
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 0

;; QUESTION SECTION:
;localhost.                     IN      A

;; ANSWER SECTION:
localhost.              3600    IN      A       127.0.0.1

;; AUTHORITY SECTION:
localhost.              3600    IN      NS      localhost.

;; Query time: 0 msec
;; SERVER: 192.168.97.97#53&#40;192.168.97.97&#41;
;; WHEN: Wed Jul 18 11:53:50 2012
;; MSG SIZE  rcvd: 57
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;09:32:30&nbsp;2012</span>
    <span class="description">VKHERA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, I figured it out.

getaddrinfo&#40;3&#41; references /etc/hosts &#40;as per default nsswitch.conf&#41; and in there is hiding 
an IPv6 address for localhost.  This is on both FreeBSD 8 and 9, and CentOS 6.3.

So by default on these systems, you will always get an IPv6 address for localhost 
regardless of DNS configuration and regardless of whether IPv6 is enabled.

I don&#39;t know of a good solution other than disabling files for host lookups, or removing 
the IPv6 localhost from the hosts file.  My solution is to just enable IPv6 on my hosts as I 
update them and since my new ISP offers it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;03:12:10&nbsp;2013</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Though not necessarily resolved for this particular computer setup, it
does seem like a rare enough setup and the overhead in trying to
determine this is costly, and there are plenty of ways to specify the
real ports/ipv combinations, I am going to mark this as resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;03:12:11&nbsp;2013</span>
    <span class="description">paul [...] seamons.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;08:18:33&nbsp;2013</span>
    <span class="description">VKHERA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I hardly would call the default setup of CentOS 6 and FreeBSD 8 and 9 as &#34;rare&#34;. But go 
ahead and leave this closed. I have worked around it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;08:18:34&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
