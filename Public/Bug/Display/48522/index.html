<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #48522 for HTML-Element-Extended: Problem in  HTML::ElementTable</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #48522 for HTML-Element-Extended: Problem in  HTML::ElementTable</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=HTML-Element-Extended">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=HTML-Element-Extended">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=HTML-Element-Extended">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=HTML-Element-Extended">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTML-Element-Extended">HTML-Element-Extended CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">48522</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=HTML-Element-Extended">HTML-Element-Extended</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MSISK [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KWittrock [...] web.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-15600-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-15601-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




demopage.html<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/644917/329919/demopage.html">
Fri Aug 07 13:35:27 2009 (2.7k) by KWittrock [...] web.de
</a>
</font></li>
</ul>


errdemo.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/644917/329920/errdemo.pl">
Fri Aug 07 13:35:27 2009 (639b) by KWittrock [...] web.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=48522">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-644917" href="/Public/Bug/Display.html?id=48522#txn-644917">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;07&nbsp;13:35:27&nbsp;2009</span>
    <span class="description">KWittrock [...] web.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem in  HTML::ElementTable</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 Aug 2009 19:33:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-HTML-Element-Extended [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;K. Wittrock&#34; &lt;KWittrock [...] web.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/644917/329918/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/329918">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 765b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached script demonstrates two problems with method as_text of  HTML::ElementTable:

In the last col of the 2nd row, a blank is inserted in the middle of the text. Firefox an Internet Explorer display this text intact. So IMHO the HTML code of this cell should be considered as unusual, though either correct or tolerable.

In the following rows, as_text&#40;&#41; apparently ignores the &lt;br&gt; tags, thus loosing the newlines of multiline text. This makes extraction of info unneccessarily complicated &#40;and sometimes impossible&#41;. 

Please contact me if you like to look at the original web page. Then I will send you a script to fetch this page with WWW::Mechanize.

I work with Windows XP SP3, perl v5.8.8 and HTML::ElementTable 1.17.

Kind regards

Klaus Wittrock
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/644917/329919/demopage.html">Download demopage.html</a><br />
<span class="downloadcontenttype">text/html 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza">                            <div>
                            
                    
                        0 - 7 Uhr
                    
                  <b>OrtsgesprÃ¤ch</b>  <b>FerngesprÃ¤ch</b>  <b>Alle Mobilfu<span style="font-size: 0.005em;"> </span>nknetze *</b>    
                                  <a href="/anbieter/3u-telecom/call-by-call/2713/"><b>01078</b></a><br>Call by Call<br><span>Minute: 0,51 Ct.<br>Takt: 60/60  <br><a href="/anbieter/3u-telecom/">01078</a><br>
                                <br>      </span>
                              
                                  <a href="/anbieter/3u-telecom/call-by-call/2713/"><b>01078</b></a><br>Call by Call<br><span>Minute: 0,51 Ct.<br>Takt: 60/60  <br><a href="/anbieter/3u-telecom/">01078</a><br>
                                <br>      </span>
                              
                                  <a href="/anbieter/centel/call-by-call/1101/"><b>0900531</b></a><br>Call by Call<br><span>Minute: 6,80 Ct.<br>Takt: 60/60  <br><a href="/anbieter/centel/"> 0900531</a><br>
                                <br>      </span>
                                
                                <a href="http://max.i12.de/www/delivery/ck.php?bannerid=1945" target="_blank">
</a>
<br>
  <a href="/anbieter/tele2/call-by-call/4122/"><b>01013</b></a><br>Call-by-Call<br><span>Minute: 0,97 Ct.<br>Takt: 60/60  <br><a href="/anbieter/tele2/">01013</a><br>
                                <br>      </span>
                              
                                  <a href="/anbieter/01073/01073/4143/"><b>01073</b></a><br>01073<br><span>Minute: 0,60 Ct.<br>Takt: 60/60  <br><a href="/anbieter/01073/">01073</a><br>
                                <br>      </span>
                              
                                  <a href="/anbieter/01073/01073/4143/"><b>01073</b></a><br>01073<br><span>Minute: 6,90 Ct.<br>Takt: 60/60  <br><a href="/anbieter/01073/">01073</a><br>
                                <br>      </span>
                               </div>



</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/644917/329920/errdemo.pl">Download errdemo.pl</a><br />
<span class="downloadcontenttype">text/x-perl 639b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;

use HTML::TreeBuilder;
use HTML::ElementTable;

my $file_name = &#39;demopage.html&#39;;
my $root = HTML::TreeBuilder-&gt;new_from_file&#40;$file_name&#41;;

	my $tbl = $root-&gt;find&#40;&#39;table&#39;&#41;;
	my $eltbl = HTML::ElementTable-&gt;new_from_tree&#40;$tbl&#41;;
	my @tbl_rows;
	foreach &#40;0 .. $eltbl-&gt;maxrow&#40;&#41;&#41; {
		push @tbl_rows, $eltbl-&gt;row&#40;$_&#41;;
	}
	printrow&#40;$_&#41; foreach @tbl_rows;

sub printrow{
	my $zeil_ref = shift;   # Type is HTML::ElementTable::RowGlob
	my @zeile = map&#40;{ $_ || &#39;&#39;} $zeil_ref-&gt;as_text&#40;&#41;&#41;;
	print &#34;\nRow: @zeile\n&#34;;
	print &#34;Cells of this row:\n&#34;;
	print &#34;   $_\n&#34; foreach @zeile;
}
$root-&gt;delete&#40;&#41;;
	</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-788800" href="/Public/Bug/Display.html?id=48522#txn-788800">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;09&nbsp;12:13:26&nbsp;2010</span>
    <span class="description">MSISK [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-788812" href="/Public/Bug/Display.html?id=48522#txn-788812">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;09&nbsp;12:18:57&nbsp;2010</span>
    <span class="description">MSISK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/788812/408717/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/408717">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 821b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Klaus,

Technically this is a problem with HTML::Element. This class is a 
subclass of that, and is where the as_text&#40;&#41; method is implemented.

If you take a look at the code for HTML::Element, you&#39;ll see that the 
implementation is pretty simple. Adding a clause that detects BR tags 
and inserts a newline would be trivial. Perhaps it could be made 
dependent on a parameter that is passed into the as_text&#40;&#41; call.

I could override the as_text&#40;&#41; method in my class, but the intention is 
for my extended classes to be fully compatible &#40;therefore embeddable&#41; 
with traditional HTML::Element objects. If a traverse of any sort is 
begun at a top-level element that is not aware of my modifications, my 
features are not invoked. &#40;the traverse, or as_text&#40;&#41;, etc, are not 
called on a per-element basis&#41;.

Cheers,
Matt
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-788814" href="/Public/Bug/Display.html?id=48522#txn-788814">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;09&nbsp;12:18:57&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-788815" href="/Public/Bug/Display.html?id=48522#txn-788815">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;09&nbsp;12:18:57&nbsp;2010</span>
    <span class="description">MSISK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-790083" href="/Public/Bug/Display.html?id=48522#txn-790083">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;12&nbsp;07:51:09&nbsp;2010</span>
    <span class="description">KWittrock [...] web.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48522] Problem in  HTML::ElementTable</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 12 Jun 2010 10:50:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-HTML-Element-Extended [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;K. Wittrock&#34; &lt;KWittrock [...] web.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/790083/409408/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/409408">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Matt,

thank you for your detailed explaination about the BR bug in as_text&#40;&#41;.

MSISK via RT schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48522">https://rt.cpan.org/Ticket/Display.html?id=48522</a></span> &gt;
&gt; 
&gt; Hi Klaus,
&gt; 
&gt; Technically this is a problem with HTML::Element. This class is a 
&gt; subclass of that, and is where the as_text&#40;&#41; method is implemented.
</div>
I think that it is always first choice to fix a bug at the place where it is caused. So it will be best that I issue a bug report for HTML::Element on this matter.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; If you take a look at the code for HTML::Element, you&#39;ll see that the 
&gt; implementation is pretty simple. Adding a clause that detects BR tags 
&gt; and inserts a newline would be trivial.
</div>
That&#39;s only half of the story. Newlines in the HTML code are cosmetics that enhance the readability of the code for the programmer. They don&#39;t affect the visual appearence of text and hence should be replaced by blanks within as_text&#40;&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Perhaps it could be made 
&gt; dependent on a parameter that is passed into the as_text&#40;&#41; call.
</div>
Ok, some people may have a different view on the meaning of text in HTML documents.

Kind regards

Klaus
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-790085" href="/Public/Bug/Display.html?id=48522#txn-790085">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;12&nbsp;07:51:12&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-971755" href="/Public/Bug/Display.html?id=48522#txn-971755">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;29&nbsp;12:19:50&nbsp;2011</span>
    <span class="description">MSISK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/971755/505706/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/505706">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 110b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">thought this one was already closed; Klause feel free to contact me with 
your discoveries with HTML::Element.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-971757" href="/Public/Bug/Display.html?id=48522#txn-971757">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;29&nbsp;12:19:50&nbsp;2011</span>
    <span class="description">MSISK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-972971" href="/Public/Bug/Display.html?id=48522#txn-972971">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;01&nbsp;07:57:16&nbsp;2011</span>
    <span class="description">KWittrock [...] web.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48522] Problem in  HTML::ElementTable</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 01 Sep 2011 13:57:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-HTML-Element-Extended [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;K. Wittrock&#34; &lt;KWittrock [...] web.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/972971/506344/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/506344">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">

Am 29.08.2011 18:19, schrieb MSISK via RT:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48522">https://rt.cpan.org/Ticket/Display.html?id=48522</a></span>&gt;
&gt;
&gt; thought this one was already closed; Klause feel free to contact me with
&gt; your discoveries with HTML::Element.
&gt;
</div>I didn&#39;t really get what you expect me to provide in my reply. I will try my very best.

The cells of the HTML table contains info about call-by-call telephone connections. These cells are organized as multiline text, separated by &lt;br&gt; tags. Row 1 &#40;normally the 1st row, sometimes the 2nd, that&#39;s no problem&#41; contains the CbC number, a series of digits. Since I get the text of the row as a single line string, I&#39;m in trouble when row 2 starts with digits. When this happens, I can often get the CbC number from row 5. In rare cases I have to insert the CbC number manually.

Also extracting all needed info at once from the single line string makes the regex rather complex. A multi line string would make the extraction more robust against changes in the layout of the cells.

I looked at sub as_text in HTML::Element. My feeling is that there should be some code like &#34;if the current $pile[0] is a &lt;br&gt; tag, shift it off, add a newline to $text and skip the rest of this iteration&#34;. Please tell me if you would like me to check this out. And also tell me if I didn&#39;t reply as you expected.

By the way, I don&#39;t understand the beginning of the loop:
         if &#40; !defined&#40; $pile[0] &#41; &#41; {    # undef!
                                          # no-op
         }
Wouldn&#39;t enter this an infinite loop?

Kind regards

Klaus
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-972973" href="/Public/Bug/Display.html?id=48522#txn-972973">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;01&nbsp;07:57:17&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-973057" href="/Public/Bug/Display.html?id=48522#txn-973057">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;01&nbsp;12:43:03&nbsp;2011</span>
    <span class="description">MSISK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/973057/506408/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/506408">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 748b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Klaus,

I think you have two options if I&#39;m understanding your goal correctly.

1&#41; Use HTML::TableExtract to parse the HTML. By default, this module 
will convert &lt;br&gt; tags into newlines. &#40;you can also use this module in 
&#39;TREE&#39; mode in order to get an HTML::Element structure rather than raw 
text, if that&#39;s what you really want&#41;.

2&#41; If you have an HTML::Element structure, you can use the format&#40;&#41; 
method rather than as_text&#40;&#41;. By default, this uses HTML::FormatText to 
convert the HTML into text and &#34;does the right thing&#34; including the 
conversion of &lt;br&gt; tags into newlines. In the original script you 
provided, you can simply replace the call to as_text&#40;&#41; with format&#40;&#41;.

Please let me know if either of these work for you.

Cheers,
Matt
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-973378" href="/Public/Bug/Display.html?id=48522#txn-973378">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;07:52:33&nbsp;2011</span>
    <span class="description">KWittrock [...] web.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48522] Problem in  HTML::ElementTable</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 02 Sep 2011 13:52:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-HTML-Element-Extended [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;K. Wittrock&#34; &lt;KWittrock [...] web.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/973378/506594/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/506594">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Matt,

ActivePerl doesn&#39;t offer HTML::FormatText in its ppm repository. So I installed HTML::FormatText::WithLinks - and it works. Method format&#40;&#41; returns the multiline texts of the cells as multiline strings, exactly as I need.

Thank you very much for your kind help.

Klaus


Am 01.09.2011 18:43, schrieb MSISK via RT:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48522">https://rt.cpan.org/Ticket/Display.html?id=48522</a></span>&gt;
&gt;
&gt; Klaus,
&gt;
&gt; I think you have two options if I&#39;m understanding your goal correctly.
&gt;
&gt; 1&#41; Use HTML::TableExtract to parse the HTML. By default, this module
&gt; will convert&lt;br&gt;  tags into newlines. &#40;you can also use this module in
&gt; &#39;TREE&#39; mode in order to get an HTML::Element structure rather than raw
&gt; text, if that&#39;s what you really want&#41;.
&gt;
&gt; 2&#41; If you have an HTML::Element structure, you can use the format&#40;&#41;
&gt; method rather than as_text&#40;&#41;. By default, this uses HTML::FormatText to
&gt; convert the HTML into text and &#34;does the right thing&#34; including the
&gt; conversion of&lt;br&gt;  tags into newlines. In the original script you
&gt; provided, you can simply replace the call to as_text&#40;&#41; with format&#40;&#41;.
&gt;
&gt; Please let me know if either of these work for you.
&gt;
&gt; Cheers,
&gt; Matt
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-974663" href="/Public/Bug/Display.html?id=48522#txn-974663">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;14:49:22&nbsp;2011</span>
    <span class="description">MSISK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/974663/507225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/507225">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 62b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Resolved with workaround, using format&#40;&#41; rather than as_text&#40;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-974665" href="/Public/Bug/Display.html?id=48522#txn-974665">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;14:49:23&nbsp;2011</span>
    <span class="description">MSISK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.544596</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
