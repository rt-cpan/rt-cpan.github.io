<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #8262 for DateTime-Cron-Simple: Not a bug ...</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #8262 for DateTime-Cron-Simple: Not a bug ...</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DateTime-Cron-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DateTime-Cron-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DateTime-Cron-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DateTime-Cron-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DateTime-Cron-Simple">DateTime-Cron-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">8262</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DateTime-Cron-Simple/Active/">DateTime-Cron-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
alansyoungiii [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-9792-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-9793-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;05&nbsp;16:50:56&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Not a bug ...</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I had an implementation mostly written when I found your cron program.  I ripped out my cron parsing routine and condensed and used yours.

I&#39;m just submitting my code for your consideration.  Please feel free to incorporate whatever you want.

Alan
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">##############################################
## Copyright &#40;c&#41; 2002-2004 - Brendan Fagan
##
## This package borrows *heavily* from the
## ParseCron package found on
## CPAN and copyrighted by the above named
##
## If you&#39;re wondering why I reinvented the
## wheel, I already had most of this done
## when I found the Cron::Simple package
## and I needed something that wasn&#39;t
## dependent on any other module.
##
## Alan Young &#40;aka HarleyPig&#41;
##############################################
package ParseCron;

use strict;
use vars qw&#40; $VERSION &#41;;

$VERSION = &#39;0.01&#39;;

sub new {
  my &#40; $class, $cron &#41; = @_;

  my $self = {
    &#39;elements&#39; =&gt; [qw&#40; minute hour dom month dow &#41;],
  };
  
  bless $self, ref $class || $class;

  $self-&gt;cron&#40; $cron &#41; if $cron;

  return $self;
} 

sub cron {
  $_[0]-&gt;{&#39;cron&#39;} = $_[1];
  $_[0]-&gt;_parse;
}

# expecting array of elements same as $self-&gt;{&#39;elements&#39;}
sub now {
  my &#40; $self, @now &#41; = @_;

  my %now; @now{@{$self-&gt;{&#39;elements&#39;}}} = @now || &#40; localtime &#41;[1..4,6];

  for my $element &#40; @{$self-&gt;{&#39;elements&#39;}} &#41; {
    return undef unless $self-&gt;{$element}-&gt;{$now{$element}};
  }

  return 1;
}

# expects a reference to an array of cron strings
# returns a reference to an array of cron strings that validate

sub check_array {
  my &#40; $self, $crons &#41; = @_;

  return undef unless ref $crons eq &#39;ARRAY&#39;;

  my @now;

  for my $n &#40; @$crons &#41; {
    $self-&gt;cron&#40; $n &#41;;
    push @now, $n if $self-&gt;now;
  }

  return \@now;
}

sub _parse {
  my $self = shift;

  # This supports names in month and dow
  my %equiv = &#40;
    &#39;month&#39; =&gt; {
      &#39;jan&#39; =&gt; 0,
      &#39;feb&#39; =&gt; 1,
      &#39;mar&#39; =&gt; 2,
      &#39;apr&#39; =&gt; 3,
      &#39;may&#39; =&gt; 4,
      &#39;jun&#39; =&gt; 5,
      &#39;jul&#39; =&gt; 6,
      &#39;aug&#39; =&gt; 7,
      &#39;sep&#39; =&gt; 8,
      &#39;oct&#39; =&gt; 9,
      &#39;nov&#39; =&gt; 10,
      &#39;dec&#39; =&gt; 11,
    },

    &#39;dow&#39; =&gt; {
      &#39;sun&#39; =&gt; 0,
      &#39;mon&#39; =&gt; 1,
      &#39;tue&#39; =&gt; 2,
      &#39;wed&#39; =&gt; 3,
      &#39;thu&#39; =&gt; 4,
      &#39;fri&#39; =&gt; 5,
      &#39;sat&#39; =&gt; 6,
    },
  &#41;;

  my %elements; @elements{@{$self-&gt;{&#39;elements&#39;}}} = split /\s+/, $self-&gt;{&#39;cron&#39;};
  my %ranges; @ranges{@{$self-&gt;{&#39;elements&#39;}}} = qw&#40; 59 23 31 11 6 &#41;;

  for my $element &#40; @{$self-&gt;{&#39;elements&#39;}} &#41; {
    $self-&gt;{$element}-&gt;{$_} = undef for 0 .. $ranges{$element};

    # This allows for case insensitivity and long or short names in
    # month and dow
    $elements{$element} =~ s!&#40;[^\d,/-]{3}&#41;&#40;?:[^\d,/-]*&#41;?!$equiv{$element}{lc $1}!gi
      if grep { /$element/ } keys %equiv;

    for my $entry &#40; split /,/, $elements{$element} &#41; {
      my &#40; $num, $interval &#41; = split /\//, $entry;
      my &#40; $num1, $num2 &#41; = split /\-/, $num;
  
      $num2 ||= $num1 eq &#39;*&#39; ? $ranges{$element} : $num1;
      $num1 = 0 if $num1 eq &#39;*&#39;;
      $interval ||= 1;
  
      for &#40; my $i = $num1 ; $i &lt;= $num2 ; $i = $i + $interval &#41; {
        $self-&gt;{$element}-&gt;{$i} = 1;
      }
    }
  }
}

1;
__END__
=pod

=head1 NAME

ParseCron - Parse a cron entry and check against a time

=head1 SYNOPSIS

  use ParseCron

  $c = ParseCron-&gt;new&#40; $cron &#41;;

  if &#40; $c-&gt;now &#41; {
    # perform some timed operation
  }

  $c-&gt;cron&#40; $newcron &#41;;

=head1 DESCRIPTION

ParseCron checks a crontab entry against a date to see if it matches the given date.

A cron entry follows the cron format from crontab&#40;5&#41;.

=head1 EXAMPLE

  use ParseCron;

  my $c = ParseCron-&gt;new&#40;&#39;0-59/2 10,12 * * 5&#39;&#41;;

  if &#40; $c-&gt;now &#41; {
    # perform whatever operation is needed
  }

  # Check another cron entry
  $c-&gt;cron&#40;&#39;* * 1 * 0&#39;&#41;;

  if&#40; $c-&gt;now &#41; {
    # perform next operation
  }

  my $crons = [ #entries ];

  my @now = $c-&gt;check_array&#40; $crons &#41;;

  for my $now &#40; @now &#41; {
    # perform operations
  }

=head1 CHANGES

Please see the CHANGES file in the module distribution.

=head1 TO-DO

 - currently does not handle ! and &gt; or &lt; in cron entries
 - better code implementation

=head1 AUTHOR 

Brendan Fagan &lt;suburbanantihero &#40;at&#41; yahoo &#40;dot&#41; com&gt;. Comments, bug reports, patches and flames are appreciated. 

=head1 COPYRIGHT

Copyright &#40;c&#41; 2004 - Brendan Fagan

=cut

</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
