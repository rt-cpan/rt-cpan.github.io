<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33559 for Win32-SerialPort: block length error</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33559 for Win32-SerialPort: block length error</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Win32-SerialPort/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Win32-SerialPort/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Win32-SerialPort/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Win32-SerialPort/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Win32-SerialPort">Win32-SerialPort CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33559</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Win32-SerialPort/Active/">Win32-SerialPort</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wsvries [...] xs4all.nl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-35762-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-35763-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;25&nbsp;04:55:28&nbsp;2008</span>
    <span class="description">wsvries [...] xs4all.nl -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> block length error </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Feb 2008 10:54:29 +0100 &#40;CET&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-SerialPort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Wim de Vries&#34; &lt;wsvries [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
WinXP, SP2, Perl v5.8.8,Win32-serialport 0.19
&#40;Have seen the same problem as I have raised once on mailing lists but
there was no answer.&#41;

I try to get some bytes from an USB device &#40;COM7&#41;.
I got the following error:
&#34;invalid COMMPROP block length= 66 &#34;
so I changed the lines &#40;line 661 in commport.pm&#41;.
Original is 64 , I made it 66
if &#40;&#40;$CP_Length &gt; 66&#41; and &#40;$self-&gt;{&#34;_TYPE&#34;} == PST_RS232&#41;&#41; {
        carp &#34;invalid COMMPROP block length= $CP_Length&#34;;
        undef $self;
        return;
Now it works, but sometimes WinXP goes completely down. Can that be caused
by the change I made?
Thanks,
Wim de Vries
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;25&nbsp;19:06:56&nbsp;2008</span>
    <span class="description">Bbirthisel [...] aol.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33559] block length error  </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Feb 2008 19:06:10 EST</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-SerialPort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bbirthisel [...] aol.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Wim,

In a message dated 2/25/2008 4:55:46 AM Eastern Standard Time, 
bug-Win32-SerialPort@rt.cpan.org writes:


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Feb 25 04:55:28 2008: Request 33559 was acted upon.
&gt; Transaction: Ticket created by wsvries@xs4all.nl
&gt;        Queue: Win32-SerialPort
&gt;      Subject: block length error
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: wsvries@xs4all.nl
&gt;       Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33559">http://rt.cpan.org/Ticket/Display.html?id=33559</a></span> &gt;
&gt; 
&gt; 
&gt; Hi,
&gt; WinXP, SP2, Perl v5.8.8,Win32-serialport 0.19
&gt; &#40;Have seen the same problem as I have raised once on mailing lists but
&gt; there was no answer.&#41;
</div>
I don&#39;t recall seeing it. But it may have come at avery busy time.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I try to get some bytes from an USB device &#40;COM7&#41;.
&gt; I got the following error:
&gt; &#34;invalid COMMPROP block length= 66 &#34;
&gt; so I changed the lines &#40;line 661 in commport.pm&#41;.
&gt; Original is 64 , I made it 66
&gt; if &#40;&#40;$CP_Length &gt; 66&#41; and &#40;$self-&gt;{&#34;_TYPE&#34;} == PST_RS232&#41;&#41; {
&gt;         carp &#34;invalid COMMPROP block length= $CP_Length&#34;;
&gt;         undef $self;
&gt;         return;
</div>
This is a leftover error message from the early days of Windows 95. I left 
the message even though I didn&#39;t expect to see it again after developers learned 
how to write drivers for the W95++ driver model. One of the factors in that 
driver setup was a device-specific length for the data structure passed to the 
API. Essentially, all &#34;regular&#34; RS-232 devices used a 64 byte long structure. 
Modems used a longer one &#40;that varied with the feature set - but the perl 
module can interpret the proper length for that type by reading the API and 
extracting the length&#41;.

Developers who had only used MS-DOS &#40;or Windows 3.x&#41; drivers had an initial 
learning curve for the much more complicated &#40;but also more robust&#41; serial 
drivers. So I saw several of these errors in the early days &#40;and they were all 
flawed drivers or similar issues&#41;. I suspect that may me at work here as well if 
it only happens on COM7 &#40;or other ports above 4&#41;. Are there any special 
features associated with this USB device?.  If the COMMPROP structure is really 66 
bytes, it is not a PST_RS232 no matter what it reports.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now it works, but sometimes WinXP goes completely down. Can that be caused
&gt; by the change I made?
&gt; Thanks,
&gt; Wim de Vries
</div>
One of the things that distinguishes Win32API::Commport from most other perl 
modules is its extensive use of &#40;nearly&#41; raw API calls and packed data 
structures &#40;via the Win32::API module&#41;. Plus the fact it is talking to a real 
hardware driver using those calls. It is the latter factor that explains the crash. 
Since the serial driver handles hardware interrupts and device buffers, it runs 
with Operating System privileges rather than just User privileges. So issuing 
an API call with a different length than the OS expects can cause very odd 
results.

Is there some way to test the devices with one of the &#34;traditional&#34; serial 
ports? Or is there something about the devices that prevents that sort of test?

-bill


**************
Ideas to please picky eaters. Watch video on AOL Living.
   
   
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://living.aol.com/video/how-to-please-your-picky-eater/rachel-campos-duffy/2050827?NCID=aolcmp00300000002598&#41;">http://living.aol.com/video/how-to-please-your-picky-eater/rachel-campos-duffy/2050827?NCID=aolcmp00300000002598&#41;</a></span>
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;25&nbsp;19:06:58&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;23&nbsp;00:05:04&nbsp;2008</span>
    <span class="description">steve [...] affinitydevices.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> steve [...] affinitydevices.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sir,

To follow up on the previous gentlemen&#39;s post, I am observing the same
problem and it is with a Cygnal/SI Labs CP2102 device.  It is a USB to
Serial converter.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are there any special features associated with this USB device?.
&gt; If the COMMPROP structure is really 66bytes, it is not a PST_RS232 no
&gt; matter what it reports.
</div> 
There are &#34;some&#34; special features to this device, but come in the way of
software that allows you to set certain values for the device. &#40;PID,
VID, Serial#, Vendor String, Etc&#41;  But all in all, it is a USB to serial
converter.

I can use the software with other USB to Serial devices, such as the
Keyspan USA-19HS, but not wit this CP2102.

I modified the the check to 66, as the previous poster did, and it
passed the startup sequence but would not pass communication.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there some way to test the devices with one of the &#34;traditional&#34;
&gt; serial
&gt; ports? Or is there something about the devices that prevents that sort
&gt; of test?
&gt; 
&gt; -bill
</div>
I would be more than willing to perform any tests to help solve this.  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;03&nbsp;09:09:48&nbsp;2010</span>
    <span class="description">wcbirthisel [...] alum.mit.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a couple of USB serial ports which don&#39;t exhibit this problem
which are based on FDTI and Prolific chips. Can anyone confirm if this
is still an issue?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;03&nbsp;09:09:49&nbsp;2010</span>
    <span class="description">wcbirthisel [...] alum.mit.edu -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;07&nbsp;12:54:46&nbsp;2010</span>
    <span class="description">RBS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We have also seen this issue with USB serial devices, both commercially 
available and proprietary to our customers. We just hack the module to 
have 66 instead of 64 in the test for this error.

I happens on any assigned COM port number; I just bumped in to it again on 
COM4, for instance, so assigned numbers &gt;= COM10 doesn&#39;t seem to be the 
cause.

I recommend tweaking this check to 66 or skipping it on kernels after 
Win95/Win98.

Many thanks for the great module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;07&nbsp;12:54:48&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;07&nbsp;14:18:32&nbsp;2010</span>
    <span class="description">Bbirthisel [...] aol.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33559] block length error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 May 2010 14:18:14 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-SerialPort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bill Birthisel &lt;bbirthisel [...] aol.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ll consider what to do about it. I need to do a little research.
I&#39;ve never come across a device that returned 66. Both of the USB
devices I have work normally.

Originally, all serial devices returned a sizeof&#40;COMMPROP&#41; = 64 unless
they included a modem and used a much larger structure &#40;the 64 byte
COMMPROP plus a bunch of modem properties appended to the end&#41;. In the
early days of the module, the size check was recommended &#40;by Microsoft&#41;
so that someone who allocated just enough memory would not get burned by
an overrun. I always allocated extra to cover the maximum expected from
a modem. However, the check did serve to identify some problems with
badly coded drivers when people we learning how to write W95 and above
drivers. However, I have not received a valid report of that sort for a
long time.

My first intuition is to skip the check unless debugging is active. I
don&#39;t know if that is the best approach.

Technically, this is a third-party-driver bug rather than a module bug.
I just read a value passed to me and check it for sanity. Is there
actually something encoded in the data structure in the extra bytes? Or
is it just the count that is the problem?

-bill

On Fri, 2010-05-07 at 12:54 -0400, RBS via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: Win32-SerialPort
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=33559">https://rt.cpan.org/Ticket/Display.html?id=33559</a></span> &gt;
&gt; 
&gt; We have also seen this issue with USB serial devices, both commercially 
&gt; available and proprietary to our customers. We just hack the module to 
&gt; have 66 instead of 64 in the test for this error.
&gt; 
&gt; I happens on any assigned COM port number; I just bumped in to it again on 
&gt; COM4, for instance, so assigned numbers &gt;= COM10 doesn&#39;t seem to be the 
&gt; cause.
&gt; 
&gt; I recommend tweaking this check to 66 or skipping it on kernels after 
&gt; Win95/Win98.
&gt; 
&gt; Many thanks for the great module.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;12:08:26&nbsp;2011</span>
    <span class="description">RBS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 07 14:18:32 2010, Bbirthisel@aol.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My first intuition is to skip the check unless debugging is active. I
&gt; don&#39;t know if that is the best approach.
&gt; 
&gt; Technically, this is a third-party-driver bug rather than a module
&gt; bug.
</div>
I can&#39;t assume it&#39;s a driver bug because it seems like drivers with 
extra capabilities should be able to use a larger structure, but it 
could be. I&#39;d have to dig in to this structure and its intended usage to 
decide either way, but since I can&#39;t get the driver modified, it&#39;s a 
moot point to me.

Anyway, some combination of making this check debug only or loosening it 
to &gt; 66 would address the few known failures caused by the check. Does 
your research show that this check is still necessary?

- Barrie
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;22:20:31&nbsp;2011</span>
    <span class="description">Bbirthisel [...] aol.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33559] block length error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Mar 2011 22:20:12 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-SerialPort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bill Birthisel &lt;bbirthisel [...] aol.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 2011-03-30 at 12:08 -0400, RBS via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: Win32-SerialPort
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=33559">https://rt.cpan.org/Ticket/Display.html?id=33559</a></span> &gt;
&gt; 
&gt; On Fri May 07 14:18:32 2010, Bbirthisel@aol.com wrote:
<div class="message-stanza open">&gt; &gt; My first intuition is to skip the check unless debugging is active. I
&gt; &gt; don&#39;t know if that is the best approach.
&gt; &gt; 
&gt; &gt; Technically, this is a third-party-driver bug rather than a module
&gt; &gt; bug.
</div>&gt; 
&gt; I can&#39;t assume it&#39;s a driver bug because it seems like drivers with 
&gt; extra capabilities should be able to use a larger structure, but it 
&gt; could be. I&#39;d have to dig in to this structure and its intended usage to 
&gt; decide either way, but since I can&#39;t get the driver modified, it&#39;s a 
&gt; moot point to me.
</div>
Oh, I have no problem calling it a driver bug. The following MSDN
posting was refreshed March 10, 2001:

        <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/aa363189%28v=vs.85">http://msdn.microsoft.com/en-us/library/aa363189%28v=vs.85</a></span>%
        29.aspx
        
That is the same structure that SerialPort expects - and it is still 64
bytes long &#40;for PST_RS232 devices&#41;.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway, some combination of making this check debug only or loosening it 
&gt; to &gt; 66 would address the few known failures caused by the check. Does 
&gt; your research show that this check is still necessary?
</div>
I don&#39;t know what to propose as a workaround. Clearly there are a few
devices with this problem - but I don&#39;t have any of them and I can&#39;t
duplicate the problem. Some of the history suggests ignoring the check
would be fine. But you also reported an occasional hard crash and I
don&#39;t want to make those any easier. I did notice that Win CE seemed to
use a slightly different COMMPROP structure. And even $MS has been known
to introduce driver bugs &#40;some of the parity settings were just plain
flaky in NT4 with default drivers even though the same code worked fine
with other OS versions&#41;.

At this point, I don&#39;t have any other changes pending for the SerialPort
modules. I think the risk of adverse side effects may outweigh a change
that at best would benefit only a small number of devices. Since it is
easy enough for you to disable the check if you are confident it works
in your case - I&#39;m inclined to leave the code alone at this time.

-bill
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
