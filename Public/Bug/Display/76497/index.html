<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #76497 for DateTime-Format-Human-Duration: Controlling which units are used</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #76497 for DateTime-Format-Human-Duration: Controlling which units are used</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DateTime-Format-Human-Duration/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DateTime-Format-Human-Duration/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DateTime-Format-Human-Duration/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DateTime-Format-Human-Duration/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DateTime-Format-Human-Duration">DateTime-Format-Human-Duration CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">76497</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DateTime-Format-Human-Duration/Active/">DateTime-Format-Human-Duration</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
stratman [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
webmaster [...] simplemood.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-223150-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.0.3    </td>
  </tr>
  <tr id="CF-223151-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;11&nbsp;13:50:36&nbsp;2012</span>
    <span class="description">stratman [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> webmaster [...] simplemood.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Controlling which units are used</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m currently using some crude workarounds elsewhere to achieve this, but perhaps it would be 
useful to be able to control which units are used in the formatted strings.

Two specific scenarios to consider:
* Resolution: the max number of units to use. e.g. &#39;1y 2mo 23d 14h&#39; with a resolution of 2 would 
yield &#39;1y 2mo&#39;
* smallest unit: e.g. with a smallest unit of &#39;month&#39; &#39;1y 2mo 23d&#39; becomes &#39;1y 2mo&#39;

My first reaction is to add these as options that can be passed to format_duration&#40;&#41; and 
format_duration_between&#40;&#41;

Any thoughts or opposition?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;12&nbsp;05:03:47&nbsp;2012</span>
    <span class="description">au [...] hcsd.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> au [...] hcsd.de</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

this is my suggestion... The appended patch adds two standard arguments: &#39;units&#39; and &#39;precision&#39;:

The argument &#39;units&#39; allows to specify which units will be passed to DateTime::Format&#39;s in_unit&#40;&#41; method. Example:

my $fmt = DateTime::Format::Human::Duration-&gt;new&#40;&#41;;
my $d = DateTime::Duration-&gt;new&#40;...&#41;;

my $s = $fmt-&gt;format_duration&#40;$d, &#39;units&#39; =&gt; [qw/years months days/] &#41;;

$s now is a string that includes years, months, and days only.

&#39;precision&#39; keeps the given or default units but removes all units above the given time resolution. So if you want to 
see the duration in minute resolution only &#40;no seconds and nanoseconds&#41;:

$fmt-&gt;format_duration&#40;$d, &#39;precision&#39; =&gt; &#39;days&#39;&#41;;

$s is now &#39;1 year, 7 months, 2 weeks, and 2 days&#39;.

I&#39;ve also added some documentation &#40;POD&#41;. See there for more details. Or take a look at the code.

Stephan

Am Mi 11. Apr 2012, 13:50:36, MSTRAT schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m currently using some crude workarounds elsewhere to achieve this,
&gt; but perhaps it would be
&gt; useful to be able to control which units are used in the formatted
&gt; strings.
&gt; 
&gt; Two specific scenarios to consider:
&gt; * Resolution: the max number of units to use. e.g. &#39;1y 2mo 23d 14h&#39;
&gt; with a resolution of 2 would
&gt; yield &#39;1y 2mo&#39;
&gt; * smallest unit: e.g. with a smallest unit of &#39;month&#39; &#39;1y 2mo 23d&#39;
&gt; becomes &#39;1y 2mo&#39;
&gt; 
&gt; My first reaction is to add these as options that can be passed to
&gt; format_duration&#40;&#41; and
&gt; format_duration_between&#40;&#41;
&gt; 
&gt; Any thoughts or opposition?
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> units_and_precision.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -u --recursive DateTime/Format/Human/Duration.pm /home/austest/dev/SMF/lib/DateTime/Format/Human/Duration.pm
--- DateTime/Format/Human/Duration.pm	2012-07-05 15:36:12.000000000 +0200
+++ /home/austest/dev/SMF/lib/DateTime/Format/Human/Duration.pm	2012-07-12 10:53:09.691591209 +0200
@@ -6,6 +6,21 @@
 
 our $VERSION = &#39;0.51&#39;;
 
+use constant {
+	PLMAP =&gt; {
+		&#39;years&#39;       =&gt; [ &#39;year&#39;, &#39;years&#39; ], 
+		&#39;months&#39;      =&gt; [ &#39;month&#39;, &#39;months&#39; ],
+		&#39;weeks&#39;       =&gt; [ &#39;week&#39;, &#39;weeks&#39; ],
+		&#39;days&#39;        =&gt; [ &#39;day&#39;, &#39;days&#39; ],
+		&#39;hours&#39;       =&gt; [ &#39;hour&#39;, &#39;hours&#39; ],
+		&#39;minutes&#39;     =&gt; [ &#39;minute&#39;, &#39;minutes&#39; ],
+		&#39;seconds&#39;     =&gt; [ &#39;second&#39;, &#39;seconds&#39; ], 
+		&#39;nanoseconds&#39; =&gt; [ &#39;nanosecond&#39;, &#39;nanoseconds&#39; ],
+	},
+};
+
+use Carp qw/croak/;
+
 sub new {
     bless { &#39;locale_cache&#39; =&gt; {} }, &#39;DateTime::Format::Human::Duration&#39;;  
 }
@@ -23,8 +38,19 @@
 
 sub format_duration {
     my &#40;$span, $duration, %args&#41; = @_;
+    
+    my @units = $args{&#39;units&#39;} ? @{ $args{&#39;units&#39;} } : qw&#40;years months weeks days hours minutes seconds nanoseconds&#41;;
+    
+    if &#40;$args{&#39;precision&#39;}&#41; {
+	    # Reduce time resolution to requested precision
+    	for &#40;my $i = 0; $i &lt; scalar&#40;@units&#41;; $i++&#41; {
+    		next unless &#40;$units[$i] eq $args{&#39;precision&#39;}&#41;;
+    		splice&#40;@units, $i + 1&#41;;
+    	}
+    	croak&#40;&#39;Useless precision&#39;&#41; unless &#40;@units&#41;;
+    }
 
-    my @raw = $duration-&gt;in_units&#40; qw&#40;years months weeks days hours minutes seconds nanoseconds&#41; &#41;; 
+    my @raw = $duration-&gt;in_units&#40; @units &#41;; 
     my @n = map { abs&#40;$_&#41; } @raw; # no negative numbers
     my $say = &#39;&#39;;
     
@@ -86,17 +112,12 @@
 
     # reorder @n use if appropriate for locale
     # @n has been pass through abs&#40;&#41; so that its never negative
-    my @parts = grep { $_ } &#40;
-        $n[0] ? &#40; $n[0]. &#39; &#39; . &#40;$n[0] == 1 ? $setup-&gt;{&#39;year&#39;}   : $setup-&gt;{&#39;years&#39;}&#41;&#41; : &#39;&#39;,  
-        $n[1] ? &#40; $n[1] . &#39; &#39; .&#40;$n[1] == 1 ? $setup-&gt;{&#39;month&#39;}  : $setup-&gt;{&#39;months&#39;}&#41;&#41; : &#39;&#39;,
-        $n[2] ? &#40; $n[2] . &#39; &#39; .&#40;$n[2] == 1 ? $setup-&gt;{&#39;week&#39;}   : $setup-&gt;{&#39;weeks&#39;}&#41;&#41; : &#39;&#39;,
-        $n[3] ? &#40; $n[3] . &#39; &#39; .&#40;$n[3] == 1 ? $setup-&gt;{&#39;day&#39;}    : $setup-&gt;{&#39;days&#39;}&#41;&#41; : &#39;&#39;,
-        $n[4] ? &#40; $n[4] . &#39; &#39; .&#40;$n[4] == 1 ? $setup-&gt;{&#39;hour&#39;}   : $setup-&gt;{&#39;hours&#39;}&#41;&#41; : &#39;&#39;, 
-        $n[5] ? &#40; $n[5] . &#39; &#39; .&#40;$n[5] == 1 ? $setup-&gt;{&#39;minute&#39;} : $setup-&gt;{&#39;minutes&#39;}&#41;&#41; : &#39;&#39;, 
-        $n[6] ? &#40; $n[6] . &#39; &#39; .&#40;$n[6] == 1 ? $setup-&gt;{&#39;second&#39;} : $setup-&gt;{&#39;seconds&#39;}&#41;&#41; : &#39;&#39;,  
-        $n[7] ? &#40; $n[7] . &#39; &#39; .&#40;$n[7] == 1 ? $setup-&gt;{&#39;nanosecond&#39;} : $setup-&gt;{&#39;nanoseconds&#39;}&#41;&#41; : &#39;&#39;,   
-    &#41;;
-
+    my @parts;
+    for &#40;my $i = 0; $i &lt; scalar&#40;@units&#41;; $i++&#41; {
+    	next unless &#40;$n[$i]&#41;;
+    	push&#40;@parts, $n[$i] . &#39; &#39; . $setup-&gt;{ PLMAP-&gt;{ $units[$i] }-&gt;[ $n[$i] == 1 ? 0 : 1 ] }&#41;;
+    }
+    
     my $no_time = exists $args{&#39;no_time&#39;} ? $args{&#39;no_time&#39;} : $setup-&gt;{&#39;no_time&#39;};
     return $no_time if !@parts;
 
@@ -192,6 +213,40 @@
 
 =back
 
+=item 3 Time Resolution and Units
+
+=over 4
+
+=item * Units
+
+Specify units to format duration with. Arguments will be passed to DateTime::Format&#39;s in_unit&#40;&#41; method.
+
+Example:
+
+    my $fmt = DateTime::Format::Human::Duration-&gt;new&#40;&#41;;
+    my $d = DateTime::Duration-&gt;new&#40;...&#41;;
+  
+    my $s = $fmt-&gt;format_duration&#40;$d, &#39;units&#39; =&gt; [qw/years months days/] &#41;;
+    # $s == &#39;1 year, 7 months, and 16 days&#39;
+
+=item * precision
+
+By default, the duration will be formatted using nanosecond resolution. Resolution can be reduced by passing
+&#39;years&#39;, &#39;months&#39;, &#39;weeks&#39;, &#39;days&#39;, &#39;hours&#39;, &#39;minutes&#39;, or &#39;seconds&#39; to the &#39;precision&#39; argument.
+
+Example:
+
+    my $fmt = DateTime::Format::Human::Duration-&gt;new&#40;&#41;;
+    my $d = DateTime::Duration-&gt;new&#40;...&#41;;
+  
+    my $a = $fmt-&gt;format_duration&#40;$d&#41;;
+    # $a == &#39;1 year, 7 months, 2 weeks, 2 days, 9 hours, 43 minutes, and 15 seconds&#39;
+  
+    my $b = $fmt-&gt;format_duration&#40;$d, &#39;precision&#39; =&gt; &#39;days&#39;&#41;;
+    # $b == &#39;1 year, 7 months, 2 weeks, and 2 days&#39;
+
+=back
+
 If duration is baseless &#40;IE ambiguouse&#41; then &#39;past&#39; and &#39;future&#39; is used based on if $dur-&gt;in_units has negatives or not.
 
 Also by nature it&#39;s not split into type groups:
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;12&nbsp;05:03:52&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;31&nbsp;14:52:06&nbsp;2012</span>
    <span class="description">stratman [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, that&#39;s great.  I&#39;ve incorporated both arguments, along with some other related changes.

Should be resolved in 0.60 now.   Thanks again.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;31&nbsp;14:52:09&nbsp;2012</span>
    <span class="description">stratman [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
