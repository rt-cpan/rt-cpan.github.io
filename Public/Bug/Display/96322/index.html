<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #96322 for Finance-InteractiveBrokers-SWIG: Upgrading perl from 5.18.2 to 5.20.0 results in &#39;Bizarre copy...&#39; error</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #96322 for Finance-InteractiveBrokers-SWIG: Upgrading perl from 5.18.2 to 5.20.0 results in &#39;Bizarre copy...&#39; error</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Finance-InteractiveBrokers-SWIG/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Finance-InteractiveBrokers-SWIG/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Finance-InteractiveBrokers-SWIG/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Finance-InteractiveBrokers-SWIG/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Finance-InteractiveBrokers-SWIG">Finance-InteractiveBrokers-SWIG CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">96322</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">1 hour (60 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Finance-InteractiveBrokers-SWIG/Active/">Finance-InteractiveBrokers-SWIG</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">INFIDEL [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gdg [...] zplane.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-236860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-236861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;07&nbsp;21:14:56&nbsp;2014</span>
    <span class="description">gdg [...] zplane.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Upgrading perl from 5.18.2 to 5.20.0 results in &#39;Bizarre copy...&#39; error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 7 Jun 2014 19:14:40 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Finance-InteractiveBrokers-SWIG via RT &lt;bug-Finance-InteractiveBrokers-SWIG [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello again Jason,

Apologies for tapping your shoulder yet again, but this looks like a show
stopper, at least for anyone using perl 5.20:

After upgrading from perl 5.18.2 to 5.20.0, calling eConnect&#40;&#41; consistently
produces the following error:

    Bizarre copy of UNKNOWN in scalar assignment at
        /[blah blah]/Finance/InteractiveBrokers/SWIG.pm line 206.

F:IB versions in use are API 0.04,  SWIG 0.12.

I&#39;m sure this is related to the perl version upgrade, as it did not occur
prior to the upgrade, only after; nothing in my code changed and I did not
rebuild any of your modules.

&#40;The perl upgrade was done as a result of a general Arch repo synch that I
did earlier today, so quite a few other packages got upgraded along with
perl.&#41;

After doing some homework reading up on this error &#40;though honestly not
entirely understanding what I read&#41; it seemed that one possibility is that
5.20.0 perl was built with options that are incompatible with the options
used when building the module. So, out of superstition, I tried rebuilding
both F::IB::API and F::IB::SWIG after the general system upgrade.  No help.

Downgrading back to 5.18.2 restored previous &#40;normal&#41; behavior, but I do not
know &#40;yet!&#41; what else in my system may break as a result of using a now out
of date perl, so this is only a temporary fix. 

Let me know what other info you may need, gdb-ing, etc.

Glenn
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;10&nbsp;10:17:07&nbsp;2014</span>
    <span class="description">INFIDEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I haven&#39;t had time to set up and to reproduce this yet, but from skimming, there appears to be an issue &#40;possibly SWIG-related&#41; due to an internal code change between perl 5.10 and perl 5.12:
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/swig/patches/264/">http://sourceforge.net/p/swig/patches/264/</a></span>

More info:
<span class="clickylink"><a target="new" rel="nofollow" href="http://subversion.1072662.n5.nabble.com/PATCH-perl-bindings-Bizarre-copy-of-UNKNOWN-in-subroutine-td38024.html">http://subversion.1072662.n5.nabble.com/PATCH-perl-bindings-Bizarre-copy-of-UNKNOWN-in-subroutine-td38024.html</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/swig/patches/264/">http://sourceforge.net/p/swig/patches/264/</a></span>

Two things:
* An integer argument is apparently being interpreted as a pointer in SWIG itself, which is reportedly patched in 2.04 &#40;untested&#41;.
* Since the 5.10-&gt;5.12 switch happened well before 5.18-&gt;5.20, I suspect there is also potential for library incompatibility if you do the following:
** Compile F::IB::SWIG with one version of Perl
** Change perl versions, and expect the libraries to work with a different version.  Due to compilation arguments, and the extensive interrogation of perl &#40;exe&#41; settings I have to do during build time in this module, if your distro is compiling perls differently, this probably can&#39;t be helped in any reasonable fashion.

I&#39;ll try to get a working test case and possible patch for this Real Soon Now&#40;tm&#41;, but for the meantime, here&#39;s some suggestions:
* Staying on perl 5.18.x
* Recompiling F::IB::SWIG against the upgraded perl version.
* Testing with SWIG 2.04 &#40;also would need a recompile.&#41;  Doing this separately from the above would be more informative.

If you find useful info from the above, please update this ticket.

Also, &#39;perlbrew&#39; might be useful for generating local binaries in a deterministic fashion &#40;instead of relying on distro-built binaries&#41;, as well as running prod code on a known-to-be-compatible set of software versions, while testing version changes in a staging env.

P.S. World Cup is starting, so a fix for this may take a bit...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;10&nbsp;10:17:08&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;10&nbsp;10:17:08&nbsp;2014</span>
    <span class="description">INFIDEL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;10&nbsp;10:17:08&nbsp;2014</span>
    <span class="description">INFIDEL [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;10&nbsp;18:15:24&nbsp;2014</span>
    <span class="description">gdg [...] zplane.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96322] Upgrading perl from 5.18.2 to 5.20.0 results in &#39;Bizarre copy...&#39; error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Jun 2014 16:15:05 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jason McManus via RT &lt;bug-Finance-InteractiveBrokers-SWIG [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jason,

Jason McManus via RT &lt;bug-Finance-InteractiveBrokers-SWIG@rt.cpan.org&gt; [2014-06-10 10:17:08 -0400]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96322">https://rt.cpan.org/Ticket/Display.html?id=96322</a></span> &gt;
&gt; 
&gt; I haven&#39;t had time to set up and to reproduce this yet, but from skimming,
&gt; there appears to be an issue &#40;possibly SWIG-related&#41; due to an internal
&gt; code change between perl 5.10 and perl 5.12:
&gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/swig/patches/264/">http://sourceforge.net/p/swig/patches/264/</a></span>
&gt; 
&gt; [ ... ]
&gt; 
</div>
That patch was applied to SWIG 2.0.4; I have 3.0.2, so suspect it is unrelated,
unless its a regression.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; * Since the 5.10-&gt;5.12 switch happened well before 5.18-&gt;5.20, I suspect
&gt;   there is also potential for library incompatibility if you do the
&gt;   following:
&gt;
&gt;     ** Compile F::IB::SWIG with one version of Perl
&gt;     ** Change perl versions, and expect the libraries to work with a
&gt;        different version.  Due to compilation arguments, and the extensive
&gt;        interrogation of perl &#40;exe&#41; settings I have to do during build time
&gt;        in this module, if your distro is compiling perls differently,
&gt;        this probably can&#39;t be helped in any reasonable fashion.
&gt; 
</div>
Yes, that was what I took away from my short background reading too, and I
did try rebuilding both F::IB::SWIG and F::IB::API via CPAN under 5.20.0
before filing the ticket.  No change in observed fault behavior. The fault
was seen under perl 5.20.0 with the libraries built under both 5.18.2 and
under 5.20.0.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I&#39;ll try to get a working test case and possible patch for this Real Soon
&gt; Now&#40;tm&#41; [ ...]
&gt;
&gt; If you find useful info from the above, please update this ticket.
</div>
See attached minimal example. Let me know if you&#39;re able to reproduce the
problem using that.  Was able to narrow it down to some sort of peculiar
interaction with an open filehandle &#40;!&#41;.  See attached minimal example.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; P.S. World Cup is starting, so a fix for this may take a bit...
&gt;
</div>
No problem, Jason, enjoy!  Again, I really appreciate your responsiveness.
I&#39;m ok with downgrading to 5.18.2 so far, no problems seen against other
perl-based tools.

Regards,

Glenn
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;10&nbsp;18:15:24&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;15&nbsp;02:34:20&nbsp;2014</span>
    <span class="description">INFIDEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Shot in the dark here, as I can&#39;t reproduce this.

Can you try unpacking a clean F::IB::SWIG 0.12 distro, dropping in the attached replacement Makefile.swig, building under perl 5.20.0, and seeing if the &#39;Bizarre copy&#39; error recurs?

If the drop-in copy doesn&#39;t help, can you attach:
* your full &#39;perl -V&#39; output for 5.18.x and 5.20.0
* the output of the &#34;make&#34; step of &#34;perl Makefile.PL;make;make test&#34; for both 5.18.x and 5.20.0
* the output of &#39;file IBAPI.so&#39; &#40;the unix file&#40;1&#41; command&#41; for built libraries under both 5.18.x and 5.20.0

Thanks, -J
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Makefile.swig</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;15&nbsp;10:15:48&nbsp;2014</span>
    <span class="description">gdg [...] zplane.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96322] Upgrading perl from 5.18.2 to 5.20.0 results in &#39;Bizarre copy...&#39; error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 Jun 2014 08:15:26 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jason McManus via RT &lt;bug-Finance-InteractiveBrokers-SWIG [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jason McManus via RT &lt;bug-Finance-InteractiveBrokers-SWIG@rt.cpan.org&gt; [2014-06-15 02:34:20 -0400]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96322">https://rt.cpan.org/Ticket/Display.html?id=96322</a></span> &gt;
&gt; 
&gt; Shot in the dark here, as I can&#39;t reproduce this.
&gt; 
&gt; Can you try unpacking a clean F::IB::SWIG 0.12 distro, dropping in the attached replacement Makefile.swig, building under perl 5.20.0, and seeing if the &#39;Bizarre copy&#39; error recurs?
&gt; 
&gt; If the drop-in copy doesn&#39;t help, can you attach:
&gt; * your full &#39;perl -V&#39; output for 5.18.x and 5.20.0
&gt; * the output of the &#34;make&#34; step of &#34;perl Makefile.PL;make;make test&#34; for both 5.18.x and 5.20.0
&gt; * the output of &#39;file IBAPI.so&#39; &#40;the unix file&#40;1&#41; command&#41; for built libraries under both 5.18.x and 5.20.0
&gt; 
</div>
First of all, thanks for taking a break from World Cup to work on this! :&#41;
Much appreciated. 

Before doing the above experiments though, I need to ask for a little quick
help to ensure that when I report the results back to you I wind up giving you
reliable information and not getting myself confused and wasting your &#40;and my&#41;
time.

Specifically, I want to perform these experiments in a way which is extremely
anal with regard to precisely which directory SWIG.pm &#40;and its associated
IBAPI.so&#41; is being &#34;use&#34;d from when I execute the minimal example under the
various experimental combinations &#40;original vs. modified Makefile.swig, and
the two perl versions.&#41; With all those variations, there are a lot of ways to
make mistakes.  I added some barfage at the top of the example to report
the paths from @INC and also to report the value of $INC{[blah blah]/SWIG.pm}
so I can see unambiguously which one is being use-ed, that&#39;s the easy part.

But what I&#39;d also like to do -- and this is where I need some help -- is
completely segregate the install trees for SWIG based on the experimental
condition, i.e. one for 5.18.2, one for 5.20.0, and then perhaps subtrees
&#40;or separate trees&#41; for switching between the original Makefile.swig and the
modified one that you supplied. Doing it this way will be less error prone
than overwriting the install directory contents each time I switch perl
versions.  So my question is this: When doing the &#34;make install&#34;, how can
I specify the *full path* of the installation directory, so that when running
the minimal example for a particular experimental case, I can simply prepend
the desired SWIG installation directory at the front of @INC in order to get
it to use the intended SWIG.pm version?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;15&nbsp;13:21:39&nbsp;2014</span>
    <span class="description">gdg [...] zplane.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96322] Upgrading perl from 5.18.2 to 5.20.0 results in &#39;Bizarre copy...&#39; error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 Jun 2014 11:21:20 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jason McManus via RT &lt;bug-Finance-InteractiveBrokers-SWIG [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jason,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96322">https://rt.cpan.org/Ticket/Display.html?id=96322</a></span> &gt;
&gt; 
</div>
Update: After playing with your updated Makefile.swig and finding that it
seemed to &#34;fix&#34; the problem, I went back and tried to reproduce the fault
behavior using the original Makefile.swig, just to be sure the difference
between the original and updated Makefile.swig was really responsible for
the fix.  But after manually rebuilding/reinstalling SWIG using the original
Makefile.swig... it wouldn&#39;t fail!  So the Makefile.swig actually has nothing
to do with the problem.

After a few additional hours of fiddling around, here&#39;s what I&#39;ve concluded
as to the real source of the problem:

When I had originally rebuilt SWIG after upgrading my perl version to 5.20.0
&#40;prior to filing the ticket&#41; I used CPAN, as follows:

  1.  Removed all extant ~/.cpan/build/F::IB::SWIG-0.12-* dirs, just to be safe.

  2.  Then, from CPAN commandline:
        get     F::IB::SWIG     # Completed normally
        make    F::IB::SWIG     # Completed normally
        test    F::IB::SWIG     # Completed normally, all tests passed
        install F::IB::SWIG     # Reports &#34;F::IB::SWIG is up to date &#40;0.12&#41;&#34;
  
In the &#34;install&#34; step, I assumed that the message &#34;SWIG is up to date&#34; meant
that after the &#34;install&#34; just performed, SWIG was &#34;now up to date&#34;.  But
evidently what it really meant was that it [mistakenly] determined that the
installed SWIG components were *already* up to date &#40;relative to version 0.12&#41;
and therefore CPAN would not perform any of the installation steps which would
have [correctly] overwritten the existing SWIG.pm and IBAPI.so in the
installation tree.

This explains why my app failed under 5.20.0, even though I had rebuilt and
&#34;reinstalled&#34; SWIG after the upgrade to 5.20.0. The CPAN &#34;install&#34; had done
nothing, so my app was still use-ing the versions built months ago under 5.18.2.

One could guess that the underlying problem is that either CPAN somehow tried
&#40;and failed&#41; to outsmart the modification-time based dependencies in the
F::IB Makefile, or the Makefile dependencies themselves are faulty in some
way.  It seems to me that it cannot be right that that CPAN &#34;install&#34; command
should wind up as a no-op under the condition that it had just rebuilt IBAPI.so.
It&#39;s modification time relative to the installed version should have triggered
an unconditional overwrite.

Btw, I reproduced the above CPAN sequence several times from scratch, just
before sending this message, just to be sure I wasn&#39;t imagining it or
misinterpreting what had gone on. But the no-op behavior was identical each
time, as verified by the extant SWIG.pm and IBAPI.so files in the installation
tree being untouched after the &#34;install&#34; command &#40;no change to their creation
or modification times&#41;.  So I am quite sure this is the source of the problem.

In case you want to try to reproduce this behavior from within CPAN, I attached
my CPAN config file &#40;&#34;MyConfig.pm&#34;&#41;, in case it might somehow be implicated.
Also attached is a script &#40;&#34;setlocperl&#34;&#41; which I source prior to running CPAN,
to set up the environment appropriately.  It is somewhat non-standard in the
sense that it sets things up for user-based installation tree &#40;i.e. installs
into /home/XXX/locperl&#41; rather than system-based paths, so possibly this could
also be implicated.

Anyway, let me know if you need any additional info in tracking down the
install issue, and once again thanks for your time on this.

Regards,

Glenn
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;15&nbsp;19:00:48&nbsp;2014</span>
    <span class="description">INFIDEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">60 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ah, this makes sense; so perl 5.20.0 was running against the library built by 5.18.2, leading to binary incompatibility.

The &#39;cpan&#39; executable isn&#39;t something I can control, and it only does a rudimentary $Module::VERSION check against the installed primary perl module &#40;F::IB::SWIG.pm in this case, which would still report 0.12 in both cases&#41;, instead of a full &#39;make&#39;-like mtime check.   It has a &#34;force install&#34; command though, which would overwrite the installed modules.

Incidentally, there&#39;s a few different tools for localized perl installations you may want to look into:
* local::lib &#40;installs modules to a user directory&#41;
* perlbrew &#40;allows multiple perl version installations outside of system perl&#41;
* App::cpanminus &#40;a &#39;cpan&#39; replacement, tends to be a bit faster ime&#41;

I still may release a 0.13 F::IB::SWIG with the replacement Makefile.swig in a bit, as I noticed during this the FILE_OFFSET_BITS and LARGEFILE_SOURCE defines were not being carried forward when building the IBAPI-supplied code, but for now, it looks like this is sorted.

Cheers.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;15&nbsp;19:00:49&nbsp;2014</span>
    <span class="description">INFIDEL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;16&nbsp;19:20:32&nbsp;2014</span>
    <span class="description">gdg [...] zplane.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96322] Upgrading perl from 5.18.2 to 5.20.0 results in &#39;Bizarre copy...&#39; error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jun 2014 17:20:15 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jason McManus via RT &lt;bug-Finance-InteractiveBrokers-SWIG [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jason McManus via RT &lt;bug-Finance-InteractiveBrokers-SWIG@rt.cpan.org&gt; [2014-06-15 19:00:48 -0400]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96322">https://rt.cpan.org/Ticket/Display.html?id=96322</a></span> &gt;
&gt; 
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Ah, this makes sense; so perl 5.20.0 was running against the library built
&gt; by 5.18.2, leading to binary incompatibility.
&gt; 
</div>
Yep.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; The &#39;cpan&#39; executable isn&#39;t something I can control, and it only does a
&gt; rudimentary $Module::VERSION check against the installed primary perl
&gt; module &#40;F::IB::SWIG.pm in this case, which would still report 0.12 in both
&gt; cases&#41;, instead of a full &#39;make&#39;-like mtime check.
&gt;
</div>
I realize cpan isn&#39;t your responsibility at all, I just mentioned about it
and supplied the config files in case you wanted to investigate whether the
no-op-ness of the cpan install was somehow related to your Makefile itself
&#40;as I had assumed was the case&#41;. But from what you say above, cpan doesn&#39;t
simply run &#34;make install&#34; using the module makefile, it just looks at the
version number of the installed module and makes a &#34;lite&#34;  &#40;and often wrong&#41;
guess based only on that as to whether to run &#34;make install&#34; or not.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; It has a &#34;force install&#34; command though, which would overwrite the
&gt; installed modules.
&gt;
</div>
Yep, ironically, I knew about that but the reported message about &#34;is up to
date&#34; fooled me into thinking that the install had in fact occurred, so I
didn&#39;t even think about trying to force it. I assumed &#40;wrongly&#41; that the cpan
&#34;install&#34; command had executed &#34;make install&#34; on the module Makefile and
was simply reporting &#40;after completion&#41; that it was now up to date.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Incidentally, there&#39;s a few different tools for localized perl installations
&gt; you may want to look into:
&gt; * local::lib &#40;installs modules to a user directory&#41;
&gt;
</div>
This is that I used to do the install of cpan itself and then to create a user
directory for the install tree. Seems to work pretty well.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; * perlbrew &#40;allows multiple perl version installations outside of system perl&#41;
&gt;
</div>
Ja, you mentioned this earlier, I&#39;ll check it out sometime. Could definitely
come in handy when trying to diagnose problems like this one.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; * App::cpanminus &#40;a &#39;cpan&#39; replacement, tends to be a bit faster ime&#41;
&gt; 
</div>
Ah, that one I have to certainly check out because CPAN has been a constant
source of annoyance for me.  Seems to me it introduces more complications than
simply doing the build by hand, and it&#39;s not particularly well documented
either, imo.  So perhaps the &#34;minus&#34; version will be a welcome reduction in
fussiness, thanks for mentioning it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I still may release a 0.13 F::IB::SWIG with the replacement Makefile.swig in
&gt; a bit, as I noticed during this the FILE_OFFSET_BITS and LARGEFILE_SOURCE
&gt; defines were not being carried forward when building the IBAPI-supplied code,
&gt; but for now, it looks like this is sorted.
</div>
Indeed, and thanks again for your time, Jason.

Regards,

Glenn
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
