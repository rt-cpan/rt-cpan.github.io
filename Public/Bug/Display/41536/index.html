<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #41536 for YAML-Tiny: Compatibility with Ruby&#39;s yaml module &#40;array-in-hash indentation&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #41536 for YAML-Tiny: Compatibility with Ruby&#39;s yaml module &#40;array-in-hash indentation&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=YAML-Tiny">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=YAML-Tiny">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=YAML-Tiny">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=YAML-Tiny">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/YAML-Tiny">YAML-Tiny CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">41536</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=YAML-Tiny">YAML-Tiny</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
paul.clifford [...] bbc.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-39260-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39261-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




array_no_preceding_space.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/541563/272145/array_no_preceding_space.diff">
Mon Dec 08 11:20:22 2008 (1.5k) by paul.clifford [...] bbc.co.uk
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/541488/272088/array_no_preceding_space.diff">
Mon Dec 08 07:31:48 2008 (1k) by paul.clifford [...] bbc.co.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=41536">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-541488" href="/Public/Bug/Display.html?id=41536#txn-541488">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;08&nbsp;07:31:48&nbsp;2008</span>
    <span class="description">paul.clifford [...] bbc.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Compatibility with Ruby&#39;s yaml module</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 08 Dec 2008 12:30:13 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-YAML-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Clifford &lt;paul.clifford [...] bbc.co.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/541488/272087/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/272087">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ruby&#39;s yaml module uses &#34;- &#34; as the indent for list items:

$ ruby -ryaml -e &#39;print YAML.dump&#40;{&#34;a&#34; =&gt; [42], &#34;b&#34; =&gt; [42]}&#41;&#39;
---
a:
- 42
b:
- 42


YAML::Tiny can&#39;t parse this because it assumes that the indent level is 
only determined by the number of leading spaces:

$ perl -MYAML::Tiny -e &#39;YAML::Tiny::Load&#40;&#34;--- \na: \n- 42\nb: \n- 42\n&#34;&#41;&#39;
YAML::Tiny does not support the line &#39;b: &#39; at 
/usr/lib/perl5/vendor_perl/5.10.0/YAML/Tiny.pm line 236.


On the other hand, YAML::Syck does recognise it:

$ perl -MYAML::Syck -e &#39;Load&#40;&#34;--- \na: \n- 42\nb: \n- 42\n&#34;&#41;&#39;
&#40;no output&#41;


Here&#39;s a patch to YAML-Tiny-1.34_01 which fixes the problem.  There&#39;s a 
similar bug in the YAML library so the new test uses noyamlpm:
   <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=25945">http://rt.cpan.org/Public/Bug/Display.html?id=25945</a></span>

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bbc.co.uk/">http://www.bbc.co.uk/</a></span>
This e-mail &#40;and any attachments&#41; is confidential and may contain personal views which are not the views of the BBC unless specifically stated.
If you have received it in error, please delete it from your system.
Do not use, copy or disclose the information in any way nor act in reliance on it and notify the sender immediately.
Please note that the BBC monitors e-mails sent or received.
Further communication will signify your consent to this.
                                        
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/541488/272088/array_no_preceding_space.diff">Download array_no_preceding_space.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/YAML/Tiny.pm b/lib/YAML/Tiny.pm
index df903c8..e03403f 100644
--- a/lib/YAML/Tiny.pm
+++ b/lib/YAML/Tiny.pm
@@ -190,8 +190,8 @@ sub _read_array {
 		}
 
 		# Check the indent level
-		$lines-&gt;[0] =~ /^&#40;\s*&#41;/;
-		if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] &#41; {
+		$lines-&gt;[0] =~ /^&#40;\s*&#41;&#40;-?&#41;/;
+		if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] or $2 ne &#39;-&#39; &#41; {
 			return 1;
 		} elsif &#40; length&#40;$1&#41; &gt; $indent-&gt;[-1] &#41; {
 			die &#34;Hash line over-indented&#34;;
diff --git a/t/02_basic.t b/t/02_basic.t
index 994be4e..03675a7 100644
--- a/t/02_basic.t
+++ b/t/02_basic.t
@@ -10,7 +10,7 @@ BEGIN {
 
 use File::Spec::Functions &#39;:ALL&#39;;
 use t::lib::Test;
-use Test::More tests&#40;30&#41;;
+use Test::More tests&#40;31&#41;;
 use YAML::Tiny;
 
 
@@ -129,6 +129,20 @@ END_YAML
 	&#39;array_in_hash&#39;,
 &#41;;
 
+# Array inside a hash, with no leading spaces
+yaml_ok&#40;
+   &lt;&lt;&#39;END_YAML&#39;,
+---
+a:
+- 42
+b:
+- 42
+END_YAML
+   [ { a =&gt; [ 42 ], b =&gt; [ 42 ] } ],
+   &#39;array_in_hash&#39;,
+   noyamlpm =&gt; 1,
+&#41;;
+
 # Simple hash inside a hash with an undef
 yaml_ok&#40;
 	&lt;&lt;&#39;END_YAML&#39;,
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-541510" href="/Public/Bug/Display.html?id=41536#txn-541510">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;08&nbsp;08:45:45&nbsp;2008</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41536] Compatibility with Ruby&#39;s yaml module</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 9 Dec 2008 00:45:31 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-YAML-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Adam Kennedy&#34; &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/541510/272103/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/272103">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the patch.

Is this only a problem at the root level, or in nested stuff as well?

If so, can we add some extra tests to make sure we cover the nested cases?

Adam K

2008/12/8 Paul Clifford via RT &lt;bug-YAML-Tiny@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Dec 08 07:31:48 2008: Request 41536 was acted upon.
&gt; Transaction: Ticket created by paul.clifford@bbc.co.uk
&gt;       Queue: YAML-Tiny
&gt;     Subject: Compatibility with Ruby&#39;s yaml module
&gt;   Broken in: &#40;no value&#41;
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: paul.clifford@bbc.co.uk
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=41536">http://rt.cpan.org/Ticket/Display.html?id=41536</a></span> &gt;
&gt;
&gt;
&gt; Ruby&#39;s yaml module uses &#34;- &#34; as the indent for list items:
&gt;
&gt; $ ruby -ryaml -e &#39;print YAML.dump&#40;{&#34;a&#34; =&gt; [42], &#34;b&#34; =&gt; [42]}&#41;&#39;
&gt; ---
&gt; a:
&gt; - 42
&gt; b:
&gt; - 42
&gt;
&gt;
&gt; YAML::Tiny can&#39;t parse this because it assumes that the indent level is
&gt; only determined by the number of leading spaces:
&gt;
&gt; $ perl -MYAML::Tiny -e &#39;YAML::Tiny::Load&#40;&#34;--- \na: \n- 42\nb: \n- 42\n&#34;&#41;&#39;
&gt; YAML::Tiny does not support the line &#39;b: &#39; at
&gt; /usr/lib/perl5/vendor_perl/5.10.0/YAML/Tiny.pm line 236.
&gt;
&gt;
&gt; On the other hand, YAML::Syck does recognise it:
&gt;
&gt; $ perl -MYAML::Syck -e &#39;Load&#40;&#34;--- \na: \n- 42\nb: \n- 42\n&#34;&#41;&#39;
&gt; &#40;no output&#41;
&gt;
&gt;
&gt; Here&#39;s a patch to YAML-Tiny-1.34_01 which fixes the problem.  There&#39;s a
&gt; similar bug in the YAML library so the new test uses noyamlpm:
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=25945">http://rt.cpan.org/Public/Bug/Display.html?id=25945</a></span>
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bbc.co.uk/">http://www.bbc.co.uk/</a></span>
&gt; This e-mail &#40;and any attachments&#41; is confidential and may contain personal views which are not the views of the BBC unless specifically stated.
&gt; If you have received it in error, please delete it from your system.
&gt; Do not use, copy or disclose the information in any way nor act in reliance on it and notify the sender immediately.
&gt; Please note that the BBC monitors e-mails sent or received.
&gt; Further communication will signify your consent to this.
&gt;
&gt;
&gt;
&gt; diff --git a/lib/YAML/Tiny.pm b/lib/YAML/Tiny.pm
&gt; index df903c8..e03403f 100644
&gt; --- a/lib/YAML/Tiny.pm
&gt; +++ b/lib/YAML/Tiny.pm
&gt; @@ -190,8 +190,8 @@ sub _read_array {
&gt;                }
&gt;
&gt;                # Check the indent level
&gt; -               $lines-&gt;[0] =~ /^&#40;\s*&#41;/;
&gt; -               if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] &#41; {
&gt; +               $lines-&gt;[0] =~ /^&#40;\s*&#41;&#40;-?&#41;/;
&gt; +               if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] or $2 ne &#39;-&#39; &#41; {
&gt;                        return 1;
&gt;                } elsif &#40; length&#40;$1&#41; &gt; $indent-&gt;[-1] &#41; {
&gt;                        die &#34;Hash line over-indented&#34;;
&gt; diff --git a/t/02_basic.t b/t/02_basic.t
&gt; index 994be4e..03675a7 100644
&gt; --- a/t/02_basic.t
&gt; +++ b/t/02_basic.t
&gt; @@ -10,7 +10,7 @@ BEGIN {
&gt;
&gt;  use File::Spec::Functions &#39;:ALL&#39;;
&gt;  use t::lib::Test;
&gt; -use Test::More tests&#40;30&#41;;
&gt; +use Test::More tests&#40;31&#41;;
&gt;  use YAML::Tiny;
&gt;
&gt;
&gt; @@ -129,6 +129,20 @@ END_YAML
&gt;        &#39;array_in_hash&#39;,
&gt;  &#41;;
&gt;
&gt; +# Array inside a hash, with no leading spaces
&gt; +yaml_ok&#40;
&gt; +   &lt;&lt;&#39;END_YAML&#39;,
&gt; +---
&gt; +a:
&gt; +- 42
&gt; +b:
&gt; +- 42
&gt; +END_YAML
&gt; +   [ { a =&gt; [ 42 ], b =&gt; [ 42 ] } ],
&gt; +   &#39;array_in_hash&#39;,
&gt; +   noyamlpm =&gt; 1,
&gt; +&#41;;
&gt; +
&gt;  # Simple hash inside a hash with an undef
&gt;  yaml_ok&#40;
&gt;        &lt;&lt;&#39;END_YAML&#39;,
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-541511" href="/Public/Bug/Display.html?id=41536#txn-541511">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;08&nbsp;08:45:47&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-541563" href="/Public/Bug/Display.html?id=41536#txn-541563">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;08&nbsp;11:20:22&nbsp;2008</span>
    <span class="description">paul.clifford [...] bbc.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41536] Compatibility with Ruby&#39;s yaml module</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 08 Dec 2008 16:19:59 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-YAML-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Clifford &lt;paul.clifford [...] bbc.co.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/541563/272144/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/272144">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Adam Kennedy via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is this only a problem at the root level, or in nested stuff as well?
&gt; 
&gt; If so, can we add some extra tests to make sure we cover the nested cases?
</div>
It affects arrays at all levels.  I&#39;ve added a couple more tests for 
some nesting scenarios, and given them unique names which I forgot in 
the first patch.

There&#39;s still a problem with arrays nested within arrays, eg:

$ ruby -ryaml -e &#39;p YAML.dump&#40;[[10]]&#41;&#39;
&#34;--- \n- - 10\n&#34;

$ perl -MYAML::Tiny -MData::Dumper -e &#39;print 
Dumper&#40;YAML::Tiny::Load&#40;&#34;--- \n- - 10\n&#34;&#41;&#41;&#39;
$VAR1 = [
           &#39;- 10&#39;
         ];

$ perl -MYAML::Syck -MData::Dumper -e &#39;print Dumper&#40;Load&#40;&#34;--- \n- - 10\n&#34;&#41;&#41;&#39;
$VAR1 = [
           [
             &#39;10&#39;
           ]
         ];

However, this looks like a more complicated fix and doesn&#39;t affect any 
of the data I&#39;m currently using, so I&#39;d prefer to look at it in a 
different bug if that&#39;s okay?

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bbc.co.uk/">http://www.bbc.co.uk/</a></span>
This e-mail &#40;and any attachments&#41; is confidential and may contain personal views which are not the views of the BBC unless specifically stated.
If you have received it in error, please delete it from your system.
Do not use, copy or disclose the information in any way nor act in reliance on it and notify the sender immediately.
Please note that the BBC monitors e-mails sent or received.
Further communication will signify your consent to this.
                                        
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/541563/272145/array_no_preceding_space.diff">Download array_no_preceding_space.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/YAML/Tiny.pm b/lib/YAML/Tiny.pm
index df903c8..e03403f 100644
--- a/lib/YAML/Tiny.pm
+++ b/lib/YAML/Tiny.pm
@@ -190,8 +190,8 @@ sub _read_array {
 		}
 
 		# Check the indent level
-		$lines-&gt;[0] =~ /^&#40;\s*&#41;/;
-		if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] &#41; {
+		$lines-&gt;[0] =~ /^&#40;\s*&#41;&#40;-?&#41;/;
+		if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] or $2 ne &#39;-&#39; &#41; {
 			return 1;
 		} elsif &#40; length&#40;$1&#41; &gt; $indent-&gt;[-1] &#41; {
 			die &#34;Hash line over-indented&#34;;
diff --git a/t/02_basic.t b/t/02_basic.t
index 994be4e..0e5b624 100644
--- a/t/02_basic.t
+++ b/t/02_basic.t
@@ -10,7 +10,7 @@ BEGIN {
 
 use File::Spec::Functions &#39;:ALL&#39;;
 use t::lib::Test;
-use Test::More tests&#40;30&#41;;
+use Test::More tests&#40;33&#41;;
 use YAML::Tiny;
 
 
@@ -129,6 +129,55 @@ END_YAML
 	&#39;array_in_hash&#39;,
 &#41;;
 
+# Arrays inside a hash, with no leading space for the &#34;-&#34; indicator
+yaml_ok&#40;
+   &lt;&lt;&#39;END_YAML&#39;,
+---
+a:
+- 42
+b:
+- 84
+END_YAML
+   [ { a =&gt; [ 42 ], b =&gt; [ 84 ] } ],
+   &#39;no_array_indent1&#39;,
+   noyamlpm =&gt; 1,
+&#41;;
+
+# Arrays inside a nested hash, with no leading space for the &#34;-&#34; indicator
+yaml_ok&#40;
+   &lt;&lt;&#39;END_YAML&#39;,
+---
+a:
+  aa:
+  - 42
+  ab:
+  -
+  - &#34;test&#34;
+b: 10
+END_YAML
+   [ { a =&gt; { aa =&gt; [ 42 ], ab =&gt; [ undef, &#34;test&#34; ] }, b =&gt; 10 } ],
+   &#39;no_array_indent2&#39;,
+   noyamlpm =&gt; 1,
+&#41;;
+
+# Nested arrays within hashes, with no leading space for the &#34;-&#34; indicator
+yaml_ok&#40;
+   &lt;&lt;&#39;END_YAML&#39;,
+---
+a:
+- aa:
+  - 42
+  ab:
+  -
+  - &#34;test&#34;
+b:
+- 10
+END_YAML
+   [ { a =&gt; [ { aa =&gt; [ 42 ], ab =&gt; [ undef, &#34;test&#34; ] } ], b =&gt; [ 10 ] } ],
+   &#39;no_array_indent3&#39;,
+   noyamlpm =&gt; 1,
+&#41;;
+
 # Simple hash inside a hash with an undef
 yaml_ok&#40;
 	&lt;&lt;&#39;END_YAML&#39;,
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-541712" href="/Public/Bug/Display.html?id=41536#txn-541712">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;08&nbsp;18:38:42&nbsp;2008</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41536] Compatibility with Ruby&#39;s yaml module</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 9 Dec 2008 10:38:29 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-YAML-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Adam Kennedy&#34; &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/541712/272238/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/272238">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, we&#39;ll treat it as separate.

Adam K

2008/12/9 Paul Clifford via RT &lt;bug-YAML-Tiny@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: YAML-Tiny
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=41536">http://rt.cpan.org/Ticket/Display.html?id=41536</a></span> &gt;
&gt;
&gt; Adam Kennedy via RT wrote:
<div class="message-stanza open">&gt;&gt; Is this only a problem at the root level, or in nested stuff as well?
&gt;&gt;
&gt;&gt; If so, can we add some extra tests to make sure we cover the nested cases?
</div>&gt;
&gt; It affects arrays at all levels.  I&#39;ve added a couple more tests for
&gt; some nesting scenarios, and given them unique names which I forgot in
&gt; the first patch.
&gt;
&gt; There&#39;s still a problem with arrays nested within arrays, eg:
&gt;
&gt; $ ruby -ryaml -e &#39;p YAML.dump&#40;[[10]]&#41;&#39;
&gt; &#34;--- \n- - 10\n&#34;
&gt;
&gt; $ perl -MYAML::Tiny -MData::Dumper -e &#39;print
&gt; Dumper&#40;YAML::Tiny::Load&#40;&#34;--- \n- - 10\n&#34;&#41;&#41;&#39;
&gt; $VAR1 = [
&gt;           &#39;- 10&#39;
&gt;         ];
&gt;
&gt; $ perl -MYAML::Syck -MData::Dumper -e &#39;print Dumper&#40;Load&#40;&#34;--- \n- - 10\n&#34;&#41;&#41;&#39;
&gt; $VAR1 = [
&gt;           [
&gt;             &#39;10&#39;
&gt;           ]
&gt;         ];
&gt;
&gt; However, this looks like a more complicated fix and doesn&#39;t affect any
&gt; of the data I&#39;m currently using, so I&#39;d prefer to look at it in a
&gt; different bug if that&#39;s okay?
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bbc.co.uk/">http://www.bbc.co.uk/</a></span>
&gt; This e-mail &#40;and any attachments&#41; is confidential and may contain personal views which are not the views of the BBC unless specifically stated.
&gt; If you have received it in error, please delete it from your system.
&gt; Do not use, copy or disclose the information in any way nor act in reliance on it and notify the sender immediately.
&gt; Please note that the BBC monitors e-mails sent or received.
&gt; Further communication will signify your consent to this.
&gt;
&gt;
&gt;
&gt; diff --git a/lib/YAML/Tiny.pm b/lib/YAML/Tiny.pm
&gt; index df903c8..e03403f 100644
&gt; --- a/lib/YAML/Tiny.pm
&gt; +++ b/lib/YAML/Tiny.pm
&gt; @@ -190,8 +190,8 @@ sub _read_array {
&gt;                }
&gt;
&gt;                # Check the indent level
&gt; -               $lines-&gt;[0] =~ /^&#40;\s*&#41;/;
&gt; -               if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] &#41; {
&gt; +               $lines-&gt;[0] =~ /^&#40;\s*&#41;&#40;-?&#41;/;
&gt; +               if &#40; length&#40;$1&#41; &lt; $indent-&gt;[-1] or $2 ne &#39;-&#39; &#41; {
&gt;                        return 1;
&gt;                } elsif &#40; length&#40;$1&#41; &gt; $indent-&gt;[-1] &#41; {
&gt;                        die &#34;Hash line over-indented&#34;;
&gt; diff --git a/t/02_basic.t b/t/02_basic.t
&gt; index 994be4e..0e5b624 100644
&gt; --- a/t/02_basic.t
&gt; +++ b/t/02_basic.t
&gt; @@ -10,7 +10,7 @@ BEGIN {
&gt;
&gt;  use File::Spec::Functions &#39;:ALL&#39;;
&gt;  use t::lib::Test;
&gt; -use Test::More tests&#40;30&#41;;
&gt; +use Test::More tests&#40;33&#41;;
&gt;  use YAML::Tiny;
&gt;
&gt;
&gt; @@ -129,6 +129,55 @@ END_YAML
&gt;        &#39;array_in_hash&#39;,
&gt;  &#41;;
&gt;
&gt; +# Arrays inside a hash, with no leading space for the &#34;-&#34; indicator
&gt; +yaml_ok&#40;
&gt; +   &lt;&lt;&#39;END_YAML&#39;,
&gt; +---
&gt; +a:
&gt; +- 42
&gt; +b:
&gt; +- 84
&gt; +END_YAML
&gt; +   [ { a =&gt; [ 42 ], b =&gt; [ 84 ] } ],
&gt; +   &#39;no_array_indent1&#39;,
&gt; +   noyamlpm =&gt; 1,
&gt; +&#41;;
&gt; +
&gt; +# Arrays inside a nested hash, with no leading space for the &#34;-&#34; indicator
&gt; +yaml_ok&#40;
&gt; +   &lt;&lt;&#39;END_YAML&#39;,
&gt; +---
&gt; +a:
&gt; +  aa:
&gt; +  - 42
&gt; +  ab:
&gt; +  -
&gt; +  - &#34;test&#34;
&gt; +b: 10
&gt; +END_YAML
&gt; +   [ { a =&gt; { aa =&gt; [ 42 ], ab =&gt; [ undef, &#34;test&#34; ] }, b =&gt; 10 } ],
&gt; +   &#39;no_array_indent2&#39;,
&gt; +   noyamlpm =&gt; 1,
&gt; +&#41;;
&gt; +
&gt; +# Nested arrays within hashes, with no leading space for the &#34;-&#34; indicator
&gt; +yaml_ok&#40;
&gt; +   &lt;&lt;&#39;END_YAML&#39;,
&gt; +---
&gt; +a:
&gt; +- aa:
&gt; +  - 42
&gt; +  ab:
&gt; +  -
&gt; +  - &#34;test&#34;
&gt; +b:
&gt; +- 10
&gt; +END_YAML
&gt; +   [ { a =&gt; [ { aa =&gt; [ 42 ], ab =&gt; [ undef, &#34;test&#34; ] } ], b =&gt; [ 10 ] } ],
&gt; +   &#39;no_array_indent3&#39;,
&gt; +   noyamlpm =&gt; 1,
&gt; +&#41;;
&gt; +
&gt;  # Simple hash inside a hash with an undef
&gt;  yaml_ok&#40;
&gt;        &lt;&lt;&#39;END_YAML&#39;,
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1279054" href="/Public/Bug/Display.html?id=41536#txn-1279054">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;25&nbsp;06:08:25&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Subject changed from &#39;Compatibility with Ruby&#39;s yaml module&#39; to &#39;Compatibility with Ruby&#39;s yaml module &#40;array-in-hash indentation&#41;&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1279055" href="/Public/Bug/Display.html?id=41536#txn-1279055">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;25&nbsp;06:08:25&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.519456</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
