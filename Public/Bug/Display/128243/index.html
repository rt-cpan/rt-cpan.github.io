<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #128243 for File-Touch: File:Touch &#38; make</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #128243 for File-Touch: File:Touch &#38; make</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/File-Touch/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/File-Touch/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/File-Touch/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/File-Touch/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-Touch">File-Touch CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">128243</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/File-Touch/Active/">File-Touch</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
BIGFOOT [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13208-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13209-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;14&nbsp;14:48:36&nbsp;2019</span>
    <span class="description">BIGFOOT [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> File:Touch &#38; make</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In creating a script that is required to prevent a make from happening by &#34;touching&#34; a file AFTER another process has updated dependency I noticed that using File::Touch does not give the intended result.  Moreover it appears that the file system actually maintains greater granularity of time for modification of files.  Consider these two files:

[rlauer@ip-10-1-4-191 lambda]&#40;cpanfile&#41;$ stat Lambda
  File: ‘Lambda’
  Size: 759             Blocks: 8          IO Block: 4096   regular file
Device: ca01h/51713d    Inode: 718847      Links: 1
Access: &#40;0664/-rw-rw-r--&#41;  Uid: &#40;  501/  rlauer&#41;   Gid: &#40;  501/  rlauer&#41;
Access: 2019-01-14 14:32:58.000000000 -0500
Modify: 2019-01-14 14:32:58.000000000 -0500
Change: 2019-01-14 14:32:58.278280121 -0500
 Birth: -

[rlauer@ip-10-1-4-191 lambda]&#40;cpanfile&#41;$ stat runtime_layer_arn
  File: ‘runtime_layer_arn’
  Size: 61              Blocks: 8          IO Block: 4096   regular file
Device: ca01h/51713d    Inode: 718761      Links: 1
Access: &#40;0664/-rw-rw-r--&#41;  Uid: &#40;  501/  rlauer&#41;   Gid: &#40;  501/  rlauer&#41;
Access: 2019-01-14 14:32:58.274280108 -0500
Modify: 2019-01-14 14:32:58.274280108 -0500
Change: 2019-01-14 14:32:58.274280108 -0500
 Birth: -

Note that Lambda was actually touched by File::Touch AFTER runtime_layer_arn...

It appears to me that File::Touch granularity cannot be relied upon for make operations.  Perhaps not a bug, but an implementation anomaly?  Modification of file attributes vs actual modification or access by the file system?  If my analysis is correct than perhaps a note in documentation might be warranted that the granularity may not match actual file system operations and therefore mod/access times do not reflect the actual time but a truncated to the second time.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;29&nbsp;09:33:46&nbsp;2019</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2019-01-14 14:48:36, BIGFOOT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In creating a script that is required to prevent a make from happening
&gt; by &#34;touching&#34; a file AFTER another process has updated dependency I
&gt; noticed that using File::Touch does not give the intended result.
&gt; Moreover it appears that the file system actually maintains greater
&gt; granularity of time for modification of files.  Consider these two
&gt; files:
&gt; 
&gt; [rlauer@ip-10-1-4-191 lambda]&#40;cpanfile&#41;$ stat Lambda
&gt;   File: ‘Lambda’
&gt;   Size: 759             Blocks: 8          IO Block: 4096   regular
&gt; file
&gt; Device: ca01h/51713d    Inode: 718847      Links: 1
&gt; Access: &#40;0664/-rw-rw-r--&#41;  Uid: &#40;  501/  rlauer&#41;   Gid: &#40;  501/
&gt; rlauer&#41;
&gt; Access: 2019-01-14 14:32:58.000000000 -0500
&gt; Modify: 2019-01-14 14:32:58.000000000 -0500
&gt; Change: 2019-01-14 14:32:58.278280121 -0500
&gt;  Birth: -
&gt; 
&gt; [rlauer@ip-10-1-4-191 lambda]&#40;cpanfile&#41;$ stat runtime_layer_arn
&gt;   File: ‘runtime_layer_arn’
&gt;   Size: 61              Blocks: 8          IO Block: 4096   regular
&gt; file
&gt; Device: ca01h/51713d    Inode: 718761      Links: 1
&gt; Access: &#40;0664/-rw-rw-r--&#41;  Uid: &#40;  501/  rlauer&#41;   Gid: &#40;  501/
&gt; rlauer&#41;
&gt; Access: 2019-01-14 14:32:58.274280108 -0500
&gt; Modify: 2019-01-14 14:32:58.274280108 -0500
&gt; Change: 2019-01-14 14:32:58.274280108 -0500
&gt;  Birth: -
&gt; 
&gt; Note that Lambda was actually touched by File::Touch AFTER
&gt; runtime_layer_arn...
&gt; 
&gt; It appears to me that File::Touch granularity cannot be relied upon
&gt; for make operations.  Perhaps not a bug, but an implementation
&gt; anomaly?  Modification of file attributes vs actual modification or
&gt; access by the file system?  If my analysis is correct than perhaps a
&gt; note in documentation might be warranted that the granularity may not
&gt; match actual file system operations and therefore mod/access times do
&gt; not reflect the actual time but a truncated to the second time.
</div>
Standard perl&#39;s utime&#40;&#41; cannot do sub-second granularity, except if called with an explicit undef for both atime and mtime arguments. In this case the current timestamp is used automatically, and it seems that in this case sub-second granularity is used &#40;checked on a Ubuntu 16.04 system&#41;.

Another possibility is to use the high resolution utime&#40;&#41; from Time::HiRes. It seems that it&#39;s enough to do the following change:

diff --git i/lib/File/Touch.pm w/lib/File/Touch.pm
index b71b0c1..41f63e4 100644
--- i/lib/File/Touch.pm
+++ w/lib/File/Touch.pm
@@ -12,6 +12,7 @@ use Carp;
 use IO::File;
 use File::stat;
 use Fcntl;
+use Time::HiRes qw&#40;time utime&#41;;
 
 my $SYSOPEN_MODE = O_WRONLY|O_CREAT;
 eval {

Checking with

    perl -Ilib -MFile::Touch -e &#39;touch&#40;&#34;/tmp/bla&#34;&#41;; system&#40;&#34;stat /tmp/bla&#34;&#41;&#39;

shows that atime+mtime are now with high resolution.

&#40;If someone needs a formal PR, then I can do one&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;29&nbsp;09:33:47&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;03:40:58&nbsp;2020</span>
    <span class="description">SVW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Fr 29. Nov 2019, 09:33:46, SREZIC schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2019-01-14 14:48:36, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; In creating a script that is required to prevent a make from
&gt; &gt; happening
&gt; &gt; by &#34;touching&#34; a file AFTER another process has updated dependency I
&gt; &gt; noticed that using File::Touch does not give the intended result.
&gt; &gt; Moreover it appears that the file system actually maintains greater
&gt; &gt; granularity of time for modification of files.  Consider these two
&gt; &gt; files:
&gt; &gt;
&gt; &gt; [rlauer@ip-10-1-4-191 lambda]&#40;cpanfile&#41;$ stat Lambda
&gt; &gt;   File: ‘Lambda’
&gt; &gt;   Size: 759             Blocks: 8          IO Block: 4096   regular
&gt; &gt; file
&gt; &gt; Device: ca01h/51713d    Inode: 718847      Links: 1
&gt; &gt; Access: &#40;0664/-rw-rw-r--&#41;  Uid: &#40;  501/  rlauer&#41;   Gid: &#40;  501/
&gt; &gt; rlauer&#41;
&gt; &gt; Access: 2019-01-14 14:32:58.000000000 -0500
&gt; &gt; Modify: 2019-01-14 14:32:58.000000000 -0500
&gt; &gt; Change: 2019-01-14 14:32:58.278280121 -0500
&gt; &gt;  Birth: -
&gt; &gt;
&gt; &gt; [rlauer@ip-10-1-4-191 lambda]&#40;cpanfile&#41;$ stat runtime_layer_arn
&gt; &gt;   File: ‘runtime_layer_arn’
&gt; &gt;   Size: 61              Blocks: 8          IO Block: 4096   regular
&gt; &gt; file
&gt; &gt; Device: ca01h/51713d    Inode: 718761      Links: 1
&gt; &gt; Access: &#40;0664/-rw-rw-r--&#41;  Uid: &#40;  501/  rlauer&#41;   Gid: &#40;  501/
&gt; &gt; rlauer&#41;
&gt; &gt; Access: 2019-01-14 14:32:58.274280108 -0500
&gt; &gt; Modify: 2019-01-14 14:32:58.274280108 -0500
&gt; &gt; Change: 2019-01-14 14:32:58.274280108 -0500
&gt; &gt;  Birth: -
&gt; &gt;
&gt; &gt; Note that Lambda was actually touched by File::Touch AFTER
&gt; &gt; runtime_layer_arn...
&gt; &gt;
&gt; &gt; It appears to me that File::Touch granularity cannot be relied upon
&gt; &gt; for make operations.  Perhaps not a bug, but an implementation
&gt; &gt; anomaly?  Modification of file attributes vs actual modification or
&gt; &gt; access by the file system?  If my analysis is correct than perhaps a
&gt; &gt; note in documentation might be warranted that the granularity may not
&gt; &gt; match actual file system operations and therefore mod/access times do
&gt; &gt; not reflect the actual time but a truncated to the second time.
</div>&gt; 
&gt; Standard perl&#39;s utime&#40;&#41; cannot do sub-second granularity, except if
&gt; called with an explicit undef for both atime and mtime arguments. In
&gt; this case the current timestamp is used automatically, and it seems
&gt; that in this case sub-second granularity is used &#40;checked on a Ubuntu
&gt; 16.04 system&#41;.
&gt; 
&gt; Another possibility is to use the high resolution utime&#40;&#41; from
&gt; Time::HiRes. It seems that it&#39;s enough to do the following change:
&gt; 
&gt; diff --git i/lib/File/Touch.pm w/lib/File/Touch.pm
&gt; index b71b0c1..41f63e4 100644
&gt; --- i/lib/File/Touch.pm
&gt; +++ w/lib/File/Touch.pm
&gt; @@ -12,6 +12,7 @@ use Carp;
&gt;  use IO::File;
&gt;  use File::stat;
&gt;  use Fcntl;
&gt; +use Time::HiRes qw&#40;time utime&#41;;
&gt; 
&gt; my $SYSOPEN_MODE = O_WRONLY|O_CREAT;
&gt; eval {
&gt; 
&gt; Checking with
&gt; 
&gt; perl -Ilib -MFile::Touch -e &#39;touch&#40;&#34;/tmp/bla&#34;&#41;; system&#40;&#34;stat
&gt; /tmp/bla&#34;&#41;&#39;
&gt; 
&gt; shows that atime+mtime are now with high resolution.
&gt; 
&gt; &#40;If someone needs a formal PR, then I can do one&#41;
</div>
I guess PR means Pre-Release. I don&#39;t know the difference between a &#34;formal PR&#34; and an official new release of this module, but I would appreciate a new release.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
