<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34560 for IO-Compress-Zlib: Test failure on Solaris</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34560 for IO-Compress-Zlib: Test failure on Solaris</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Compress-Zlib">IO-Compress-Zlib CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34560</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Compress-Zlib/Active/">IO-Compress-Zlib</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
robin-bitcard [...] robinbowes.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-38616-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.008    </td>
  </tr>
  <tr id="CF-38617-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;30&nbsp;20:01:32&nbsp;2008</span>
    <span class="description">robin-bitcard [...] robinbowes.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test failure on Solaris</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m trying to build IO::Compress::Zlib on Solaris &#40;SXCE b83a i386&#41;:

SunOS nas02 5.11 snv_83 i86pc i386 i86pc

I&#39;m using perl 5.8.8 from the Sun coolstack project.

Installation failed through CPAN so I grabbed the tarball and tried
installing manually.

make test fails with the following errors:

t/105oneshot-zip-only.............4/146 
#     Failed test &#40;t/105oneshot-zip-only.t at line 81&#41;
#          got: &#39;603462246&#39;
#     expected: &#39;603460446&#39;
t/105oneshot-zip-only.............15/146 
#     Failed test &#40;t/105oneshot-zip-only.t at line 91&#41;
#          got: &#39;603462247&#39;
#     expected: &#39;603460447&#39;
t/105oneshot-zip-only.............48/146 
#     Failed test &#40;t/105oneshot-zip-only.t at line 121&#41;
#     &#39;603462250&#39;
#         &lt;=
#     &#39;603460450&#39;

#     Failed test &#40;t/105oneshot-zip-only.t at line 133&#41;
#     &#39;603462250&#39;
#         &lt;=
#     &#39;603460450&#39;
# Looks like you failed 4 tests of 146.
t/105oneshot-zip-only............. Dubious, test returned 4 &#40;wstat 1024,
0x400&#41;
 Failed 4/146 subtests 


Looking at the tests that are failing, they all seem to be related to
file times:

81: is $hdr-&gt;{Time}&gt;&gt;1, $mtime&gt;&gt;1, &#34;  Time is ok&#34;;
91: is $hdr-&gt;{Time} &gt;&gt; 1, $mtime &gt;&gt; 1, &#34;  Time is ok&#34;;
121: cmp_ok $hdr-&gt;{Time} &gt;&gt; 1, &#39;&lt;=&#39;, $after &gt;&gt; 1, &#34;  Time is ok&#34;;
133: cmp_ok $hdr-&gt;{Time} &gt;&gt; 1, &#39;&lt;=&#39;, $after &gt;&gt; 1, &#34;  Time is ok&#34;;

The same thing works fine on Fedora 8.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;31&nbsp;06:51:36&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> pmqs [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Mar 30 20:01:32 2008, robinbowes wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m trying to build IO::Compress::Zlib on Solaris &#40;SXCE b83a i386&#41;:
&gt; 
&gt; SunOS nas02 5.11 snv_83 i86pc i386 i86pc
&gt; 
&gt; I&#39;m using perl 5.8.8 from the Sun coolstack project.
&gt; 
&gt; Installation failed through CPAN so I grabbed the tarball and tried
&gt; installing manually.
&gt; 
&gt; make test fails with the following errors:
&gt; 
&gt; t/105oneshot-zip-only.............4/146 
&gt; #     Failed test &#40;t/105oneshot-zip-only.t at line 81&#41;
&gt; #          got: &#39;603462246&#39;
&gt; #     expected: &#39;603460446&#39;
&gt; t/105oneshot-zip-only.............15/146 
&gt; #     Failed test &#40;t/105oneshot-zip-only.t at line 91&#41;
&gt; #          got: &#39;603462247&#39;
&gt; #     expected: &#39;603460447&#39;
&gt; t/105oneshot-zip-only.............48/146 
&gt; #     Failed test &#40;t/105oneshot-zip-only.t at line 121&#41;
&gt; #     &#39;603462250&#39;
&gt; #         &lt;=
&gt; #     &#39;603460450&#39;
&gt; 
&gt; #     Failed test &#40;t/105oneshot-zip-only.t at line 133&#41;
&gt; #     &#39;603462250&#39;
&gt; #         &lt;=
&gt; #     &#39;603460450&#39;
&gt; # Looks like you failed 4 tests of 146.
&gt; t/105oneshot-zip-only............. Dubious, test returned 4 &#40;wstat 
</div>1024,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 0x400&#41;
&gt;  Failed 4/146 subtests 
&gt; 
&gt; 
&gt; Looking at the tests that are failing, they all seem to be related to
&gt; file times:
&gt; 
&gt; 81: is $hdr-&gt;{Time}&gt;&gt;1, $mtime&gt;&gt;1, &#34;  Time is ok&#34;;
&gt; 91: is $hdr-&gt;{Time} &gt;&gt; 1, $mtime &gt;&gt; 1, &#34;  Time is ok&#34;;
&gt; 121: cmp_ok $hdr-&gt;{Time} &gt;&gt; 1, &#39;&lt;=&#39;, $after &gt;&gt; 1, &#34;  Time is ok&#34;;
&gt; 133: cmp_ok $hdr-&gt;{Time} &gt;&gt; 1, &#39;&lt;=&#39;, $after &gt;&gt; 1, &#34;  Time is ok&#34;;
&gt; 
&gt; The same thing works fine on Fedora 8.
</div>
And it works fine &#40;for me&#41; on Solaris 10 Sparc &#38; x86.

You are correct in your analysis - all the failing tests are related to 
the modification time field in a zip header. For some reason you seem 
to be having an out by exactly 200 seconds in each of those test.

I&#39;ve enclosed a small script that simulates what the code does. Can you 
run it and send me the results please?

Paul
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

use strict;
use warnings;

sub _unixToDosTime    # Archive::Zip::Member
{
	my $time_t = shift;

    # TODO - add something to cope with unix time &lt; 1980 
	my &#40; $sec, $min, $hour, $mday, $mon, $year &#41; = localtime&#40;$time_t&#41;;
	my $dt = 0;
	$dt += &#40; $sec &gt;&gt; 1 &#41;;
	$dt += &#40; $min &lt;&lt; 5 &#41;;
	$dt += &#40; $hour &lt;&lt; 11 &#41;;
	$dt += &#40; $mday &lt;&lt; 16 &#41;;
	$dt += &#40; &#40; $mon + 1 &#41; &lt;&lt; 21 &#41;;
	$dt += &#40; &#40; $year - 80 &#41; &lt;&lt; 25 &#41;;
	return $dt;
}

sub _dosToUnixTime
{
    #use Time::Local &#39;timelocal_nocheck&#39;;
    use Time::Local &#39;timelocal&#39;;

	my $dt = shift;

	my $year = &#40; &#40; $dt &gt;&gt; 25 &#41; &#38; 0x7f &#41; + 80;
	my $mon  = &#40; &#40; $dt &gt;&gt; 21 &#41; &#38; 0x0f &#41; - 1;
	my $mday = &#40; &#40; $dt &gt;&gt; 16 &#41; &#38; 0x1f &#41;;

	my $hour = &#40; &#40; $dt &gt;&gt; 11 &#41; &#38; 0x1f &#41;;
	my $min  = &#40; &#40; $dt &gt;&gt; 5 &#41; &#38; 0x3f &#41;;
	my $sec  = &#40; &#40; $dt &lt;&lt; 1 &#41; &#38; 0x3e &#41;;

	# catch errors
	my $time_t =
	  eval { timelocal&#40; $sec, $min, $hour, $mday, $mon, $year &#41;; };
	return 0 
        if $@;
	return $time_t;
}

my $now = time;
my $dosTime = _unixToDosTime&#40;$now&#41;;
my $unix = _dosToUnixTime&#40;$dosTime&#41;;
my $delta = $now - $unix;

my $packed = pack &#34;V&#34;, $dosTime;
my $unpacked = unpack &#34;V&#34;, $packed;
my $unix1 = _dosToUnixTime&#40;$unpacked&#41;;
my $delta1 = $now - $unix1;

print &lt;&lt;EOM;
Now   $now
DOS   $dosTime
Unix  $unix
Delta $delta

Packed
Unix  $unix1
Delta $delta1
EOM
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;31&nbsp;06:51:41&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;31&nbsp;16:17:53&nbsp;2008</span>
    <span class="description">robin-bitcard [...] robinbowes.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> robin-bitcard [...] robinbowes.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 31 06:51:36 2008, PMQS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I&#39;ve enclosed a small script that simulates what the code does. Can you 
&gt; run it and send me the results please?
</div>
Sure:

# perl time.pl 
Now   1206994543
DOS   947890677
Unix  1206994542
Delta 1

Packed
Unix  1206994542
Delta 1


Same script on Fedora 8:

$ perl time.pl
Now   1206994637
DOS   947890728
Unix  1206994636
Delta 1

Packed
Unix  1206994636
Delta 1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;31&nbsp;16:54:03&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 31 16:17:53 2008, robinbowes wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Mar 31 06:51:36 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; I&#39;ve enclosed a small script that simulates what the code does. Can you 
&gt; &gt; run it and send me the results please?
</div>&gt; 
&gt; Sure:
&gt; 
&gt; # perl time.pl 
&gt; Now   1206994543
&gt; DOS   947890677
&gt; Unix  1206994542
&gt; Delta 1
&gt; 
&gt; Packed
&gt; Unix  1206994542
&gt; Delta 1
&gt; 
&gt; 
&gt; Same script on Fedora 8:
&gt; 
&gt; $ perl time.pl
&gt; Now   1206994637
&gt; DOS   947890728
&gt; Unix  1206994636
&gt; Delta 1
&gt; 
&gt; Packed
&gt; Unix  1206994636
&gt; Delta 1
</div>

Thanks, that worked perfectly. I&#39;ve enclosed another variant. Can you
try running it please?

Paul
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

use strict;
use warnings;

sub _unixToDosTime    # Archive::Zip::Member
{
	my $time_t = shift;

    # TODO - add something to cope with unix time &lt; 1980 
	my &#40; $sec, $min, $hour, $mday, $mon, $year &#41; = localtime&#40;$time_t&#41;;
	my $dt = 0;
	$dt += &#40; $sec &gt;&gt; 1 &#41;;
	$dt += &#40; $min &lt;&lt; 5 &#41;;
	$dt += &#40; $hour &lt;&lt; 11 &#41;;
	$dt += &#40; $mday &lt;&lt; 16 &#41;;
	$dt += &#40; &#40; $mon + 1 &#41; &lt;&lt; 21 &#41;;
	$dt += &#40; &#40; $year - 80 &#41; &lt;&lt; 25 &#41;;
	return $dt;
}

sub _dosToUnixTime
{
    #use Time::Local &#39;timelocal_nocheck&#39;;
    use Time::Local &#39;timelocal&#39;;

	my $dt = shift;

	my $year = &#40; &#40; $dt &gt;&gt; 25 &#41; &#38; 0x7f &#41; + 80;
	my $mon  = &#40; &#40; $dt &gt;&gt; 21 &#41; &#38; 0x0f &#41; - 1;
	my $mday = &#40; &#40; $dt &gt;&gt; 16 &#41; &#38; 0x1f &#41;;

	my $hour = &#40; &#40; $dt &gt;&gt; 11 &#41; &#38; 0x1f &#41;;
	my $min  = &#40; &#40; $dt &gt;&gt; 5 &#41; &#38; 0x3f &#41;;
	my $sec  = &#40; &#40; $dt &lt;&lt; 1 &#41; &#38; 0x3e &#41;;

	# catch errors
	my $time_t =
	  eval { timelocal&#40; $sec, $min, $hour, $mday, $mon, $year &#41;; };
	return 0 
        if $@;
	return $time_t;
}

sub writeFile
{
    my&#40;$filename, @strings&#41; = @_ ;
    1 while unlink $filename ;
    open &#40;F, &#34;&gt;$filename&#34;&#41; 
        or die &#34;Cannot open $filename: $!\n&#34; ;
    binmode F;
    foreach &#40;@strings&#41; {
        no warnings ;
        print F $_ ;
    }
    close F ;
}

sub readFile
{
    my $f = shift ;


    open &#40;F, &#34;&lt;$f&#34;&#41; 
        or die &#34;Cannot open $f: $!\n&#34; ;
    binmode F;
    local $/;
    my $string = &lt;F&gt; ;	
    close F ;

    return $string ;
}



my $tempFile = &#34;/tmp/paul123&#34;;

my $now = time;
my $dosTime = _unixToDosTime&#40;$now&#41;;
writeFile&#40;$tempFile, $dosTime&#41;;
my $unix = readFile&#40;$tempFile&#41;;
$unix = _dosToUnixTime&#40;$dosTime&#41;;
my $delta = $now - $unix;

my $packed = pack &#34;V&#34;, $dosTime;
writeFile&#40;$tempFile, $packed&#41;;
my $got = readFile&#40;$tempFile&#41;;
my $unpacked = unpack &#34;V&#34;, $got;
my $unix1 = _dosToUnixTime&#40;$unpacked&#41;;
my $delta1 = $now - $unix1;

print &lt;&lt;EOM;
Now   $now
DOS   $dosTime
Unix  $unix
Delta $delta

Packed
Unix  $unix1
Delta $delta1
EOM
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;04:55:26&nbsp;2008</span>
    <span class="description">robin-bitcard [...] robinbowes.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> robin-bitcard [...] robinbowes.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 31 16:54:03 2008, PMQS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks, that worked perfectly. I&#39;ve enclosed another variant. Can you
&gt; try running it please?
</div>
Of course:

# perl time2.pl 
Now   1207040093
DOS   947998426
Unix  1207040092
Delta 1

Packed
Unix  1207040092
Delta 1

And on Fedora 8:

$ perl time2.pl
Now   1207040118
DOS   947998441
Unix  1207040118
Delta 0

Packed
Unix  1207040118
Delta 0

R.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;05:19:41&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 01 04:55:26 2008, robinbowes wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Mar 31 16:54:03 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; Thanks, that worked perfectly. I&#39;ve enclosed another variant. Can you
&gt; &gt; try running it please?
</div>&gt; 
&gt; Of course:
&gt; 
&gt; # perl time2.pl 
&gt; Now   1207040093
&gt; DOS   947998426
&gt; Unix  1207040092
&gt; Delta 1
&gt; 
&gt; Packed
&gt; Unix  1207040092
&gt; Delta 1
&gt; 
&gt; And on Fedora 8:
&gt; 
&gt; $ perl time2.pl
&gt; Now   1207040118
&gt; DOS   947998441
&gt; Unix  1207040118
&gt; Delta 0
&gt; 
&gt; Packed
&gt; Unix  1207040118
&gt; Delta 0
</div>
Thanks again, but that worked properly as well. So it doesn&#39;t help track
down the problem.

Did you run the script using the same account, with the same version of
perl and on the same disk as when you tried building IO::Compress::Zlib?

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;08:55:37&nbsp;2008</span>
    <span class="description">robin-bitcard [...] robinbowes.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> robin-bitcard [...] robinbowes.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 01 05:19:41 2008, PMQS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks again, but that worked properly as well. So it doesn&#39;t help track
&gt; down the problem.
&gt; 
&gt; Did you run the script using the same account, with the same version of
&gt; perl and on the same disk as when you tried building IO::Compress::Zlib?
</div>
Yes, I did.
Hmmm, not sure what&#39;s going on but I just tried again and the tests
completed successfully. I have successfully installed via CPAN.

Looks like something screwy with my system.

Sorry to have bothered you.

R.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;09:13:21&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 01 08:55:37 2008, robinbowes wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Apr 01 05:19:41 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; Thanks again, but that worked properly as well. So it doesn&#39;t help track
&gt; &gt; down the problem.
&gt; &gt; 
&gt; &gt; Did you run the script using the same account, with the same version of
&gt; &gt; perl and on the same disk as when you tried building IO::Compress::Zlib?
</div>&gt; 
&gt; Yes, I did.
&gt; Hmmm, not sure what&#39;s going on but I just tried again and the tests
&gt; completed successfully. I have successfully installed via CPAN.
&gt; 
&gt; Looks like something screwy with my system.
&gt; 
&gt; Sorry to have bothered you.
</div>
No problem. I&#39;ll close this ticket then.

Drop me a line if you trip over it again. 

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;09:17:07&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
