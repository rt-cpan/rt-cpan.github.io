<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63686 for Catalyst-Controller-DBIC-API: Two improvements</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63686 for Catalyst-Controller-DBIC-API: Two improvements</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Catalyst-Controller-DBIC-API">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Catalyst-Controller-DBIC-API">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Catalyst-Controller-DBIC-API">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Catalyst-Controller-DBIC-API">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Controller-DBIC-API">Catalyst-Controller-DBIC-API CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63686</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Catalyst-Controller-DBIC-API">Catalyst-Controller-DBIC-API</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">abraxxa [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cub.uanic [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-222710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-222711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.002004    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Added-possibility-to-tweak-resultset-class-after-sea.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/865186/447968/0001-Added-possibility-to-tweak-resultset-class-after-sea.patch">
Mon Dec 06 18:51:22 2010 (4.2k) by cub.uanic [...] gmail.com
</a>
</font></li>
</ul>


0002-Added-support-for-tweaking-where-to-store-response-i.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/865186/447967/0002-Added-support-for-tweaking-where-to-store-response-i.patch">
Mon Dec 06 18:51:22 2010 (6.6k) by cub.uanic [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=63686">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-865186" href="/Public/Bug/Display.html?id=63686#txn-865186">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;06&nbsp;18:51:22&nbsp;2010</span>
    <span class="description">cub.uanic [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Two improvements</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/865186/447966/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/447966">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 693b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Two improvements

First patch add possibility to tweak resultset class after search was
made. This could be needed, because with
DBIx::Class::ResultClass::HashRefInflator it&#39;s not possible to access
row-level data and methods in row_format_output&#40;&#41;. Model class can have
some method to generate custom data, and it will be not accessible
without one more query to DB per each row.

Second patch is about adding support for tweaking place in stash, where
response should be stored. Sources for ::REST and ::RPC both have
&#39;stash_key&#39; config option, but this is only place I can see it. Seems,
this option is not really used, and &#39;response&#39; value is hard-coded. This
patch make this configurable.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0002-Added-support-for-tweaking-where-to-store-response-i.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/865186/447967/0002-Added-support-for-tweaking-where-to-store-response-i.patch">Download 0002-Added-support-for-tweaking-where-to-store-response-i.patch</a><br />
<span class="downloadcontenttype">text/x-diff 6.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 478925eb3219d0e2043cf53f6877f61e868bd8db Mon Sep 17 00:00:00 2001
From: Oleg Kostyuk &lt;cub.uanic@gmail.com&gt;
Date: Tue, 7 Dec 2010 01:28:08 +0200
Subject: [PATCH] Added support for tweaking where to store response in stash

---
 lib/Catalyst/Controller/DBIC/API.pm                |   28 +++++++++++--------
 .../Controller/DBIC/API/StaticArguments.pm         |    8 +++++
 2 files changed, 24 insertions&#40;+&#41;, 12 deletions&#40;-&#41;

diff --git a/lib/Catalyst/Controller/DBIC/API.pm b/lib/Catalyst/Controller/DBIC/API.pm
index 2753a74..2a72e28 100644
--- a/lib/Catalyst/Controller/DBIC/API.pm
+++ b/lib/Catalyst/Controller/DBIC/API.pm
@@ -332,7 +332,7 @@ sub object_lookup
 
 list&#39;s steps are broken up into three distinct methods: L&lt;/list_munge_parameters&gt;, L&lt;/list_perform_search&gt;, and L&lt;/list_format_output&gt;.
 
-The goal of this method is to call -&gt;search&#40;&#41; on the current_result_set, change resultset class of the result &#40;if needed&#41;, and return it in $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root}. Please see the individual methods for more details on what actual processing takes place.
+The goal of this method is to call -&gt;search&#40;&#41; on the current_result_set, change resultset class of the result &#40;if needed&#41;, and return it in $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{$self-&gt;data_root}. Please see the individual methods for more details on what actual processing takes place.
 
 If the L&lt;/select&gt; config param is defined then the hashes will contain only those columns, otherwise all columns in the object will be returned. L&lt;/select&gt; of course supports the function/procedure calling semantics that L&lt;DBIx::Class::ResultSet/select&gt;. In order to have proper column names in the result, provide arguments in L&lt;/as&gt; &#40;which also follows L&lt;DBIx::Class::ResultSet/as&gt; semantics. Similarly L&lt;/count&gt;, L&lt;/page&gt;, L&lt;/grouped_by&gt; and L&lt;/ordered_by&gt; affect the maximum number of rows returned as well as the ordering and grouping. Note that if select, count, ordered_by or grouped_by request parameters are present then these will override the values set on the class with select becoming bound by the select_exposes attribute.
 
@@ -446,7 +446,7 @@ sub list_format_output
             $output-&gt;{$self-&gt;total_entries_arg} = $c-&gt;req-&gt;search_total_entries + 0;
         }
 
-        $c-&gt;stash-&gt;{response} = $output;
+        $c-&gt;stash-&gt;{$self-&gt;stash_key} = $output;
     }
     catch
     {
@@ -487,7 +487,7 @@ sub item
     }
     else
     {
-        $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;item_root} = $self-&gt;each_object_inflate&#40;$c, $c-&gt;req-&gt;get_object&#40;0&#41;-&gt;[0]&#41;;
+        $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{$self-&gt;item_root} = $self-&gt;each_object_inflate&#40;$c, $c-&gt;req-&gt;get_object&#40;0&#41;-&gt;[0]&#41;;
     }
 }
 
@@ -858,25 +858,25 @@ sub end :Private
     # Check for errors caught elsewhere
     if &#40; $c-&gt;res-&gt;status and $c-&gt;res-&gt;status != 200 &#41; {
         $default_status = $c-&gt;res-&gt;status;
-        $c-&gt;stash-&gt;{response}-&gt;{success} = $self-&gt;use_json_boolean ? JSON::Any::false : &#39;false&#39;;
+        $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{success} = $self-&gt;use_json_boolean ? JSON::Any::false : &#39;false&#39;;
     } elsif &#40;$self-&gt;get_errors&#40;$c&#41;&#41; {
-        $c-&gt;stash-&gt;{response}-&gt;{messages} = $self-&gt;get_errors&#40;$c&#41;;
-        $c-&gt;stash-&gt;{response}-&gt;{success} = $self-&gt;use_json_boolean ? JSON::Any::false : &#39;false&#39;;
+        $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{messages} = $self-&gt;get_errors&#40;$c&#41;;
+        $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{success} = $self-&gt;use_json_boolean ? JSON::Any::false : &#39;false&#39;;
         $default_status = 400;
     } else {
-        $c-&gt;stash-&gt;{response}-&gt;{success} = $self-&gt;use_json_boolean ? JSON::Any::true : &#39;true&#39;;
+        $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{success} = $self-&gt;use_json_boolean ? JSON::Any::true : &#39;true&#39;;
         $default_status = 200;
     }
 
     unless &#40;$default_status == 200&#41;
     {
-        delete $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root};
+        delete $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{$self-&gt;data_root};
     }
     elsif&#40;$self-&gt;return_object &#38;&#38; $c-&gt;req-&gt;has_objects&#41;
     {
         my $returned_objects = [];
         push&#40;@$returned_objects, $self-&gt;each_object_inflate&#40;$c, $_&#41;&#41; for map { $_-&gt;[0] } $c-&gt;req-&gt;all_objects;
-        $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root} = scalar&#40;@$returned_objects&#41; &gt; 1 ? $returned_objects : $returned_objects-&gt;[0];
+        $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{$self-&gt;data_root} = scalar&#40;@$returned_objects&#41; &gt; 1 ? $returned_objects : $returned_objects-&gt;[0];
     }
 
     $c-&gt;res-&gt;status&#40; $default_status || 200 &#41;;
@@ -986,9 +986,13 @@ Whatever you would pass to $c-&gt;model to get a resultset for this class. MyAppDB:
 
 Desired resultset class after accessing your model. MyAppDB::ResultSet::Track for example. By default, it&#39;s DBIx::Class::ResultClass::HashRefInflator. Set to empty string to leave resultset class without change.
 
+=head3 stash_key
+
+Controls where in stash request_data should be stored, and defaults to &#39;response&#39;.
+
 =head3 data_root
 
-By default, the response data is serialized into $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root} and data_root defaults to &#39;list&#39; to preserve backwards compatibility. This is now configuable to meet the needs of the consuming client.
+By default, the response data is serialized into $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{$self-&gt;data_root} and data_root defaults to &#39;list&#39; to preserve backwards compatibility. This is now configuable to meet the needs of the consuming client.
 
 =head3 use_json_boolean
 
@@ -1101,8 +1105,8 @@ For example if you wanted create to return the JSON for the newly created object
     $self-&gt;next::method&#40;$c&#41;;
 
     if &#40;$c-&gt;req-&gt;has_objects&#41; {
-      # $c-&gt;stash-&gt;{response} will be serialized in the end action
-      $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root} = [ map { { $_-&gt;get_inflated_columns } } &#40;$c-&gt;req-&gt;all_objects&#41; ] ;
+      # $c-&gt;stash-&gt;{$self-&gt;stash_key} will be serialized in the end action
+      $c-&gt;stash-&gt;{$self-&gt;stash_key}-&gt;{$self-&gt;data_root} = [ map { { $_-&gt;get_inflated_columns } } &#40;$c-&gt;req-&gt;all_objects&#41; ] ;
     }
   }
 
diff --git a/lib/Catalyst/Controller/DBIC/API/StaticArguments.pm b/lib/Catalyst/Controller/DBIC/API/StaticArguments.pm
index 71e8730..280e92a 100644
--- a/lib/Catalyst/Controller/DBIC/API/StaticArguments.pm
+++ b/lib/Catalyst/Controller/DBIC/API/StaticArguments.pm
@@ -122,6 +122,14 @@ prefetch_arg controls how to reference &#39;prefetch&#39; in the the request_data
 
 has &#39;prefetch_arg&#39; =&gt; &#40; is =&gt; &#39;ro&#39;, isa =&gt; Str, default =&gt; &#39;list_prefetch&#39; &#41;;
 
+=attribute_public stash_key is: ro, isa: Str, default: &#39;response&#39;
+
+stash_key controls where in stash request_data should be stored
+
+=cut
+
+has &#39;stash_key&#39; =&gt; &#40; is =&gt; &#39;ro&#39;, isa =&gt; Str, default =&gt; &#39;response&#39;&#41;;
+
 =attribute_public data_root is: ro, isa: Str, default: &#39;list&#39;
 
 data_root controls how to reference where the data is in the the request_data
-- 
1.7.2.3

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Added-possibility-to-tweak-resultset-class-after-sea.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/865186/447968/0001-Added-possibility-to-tweak-resultset-class-after-sea.patch">Download 0001-Added-possibility-to-tweak-resultset-class-after-sea.patch</a><br />
<span class="downloadcontenttype">text/x-diff 4.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From b383bfd5f73193974031aecf5d3517b6ea104e0b Mon Sep 17 00:00:00 2001
From: Oleg Kostyuk &lt;cub.uanic@gmail.com&gt;
Date: Tue, 7 Dec 2010 01:08:59 +0200
Subject: [PATCH] Added possibility to tweak resultset class after searching

---
 lib/Catalyst/Controller/DBIC/API.pm                |    9 +++++++--
 .../Controller/DBIC/API/StoredResultSource.pm      |    8 ++++++++
 2 files changed, 15 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/lib/Catalyst/Controller/DBIC/API.pm b/lib/Catalyst/Controller/DBIC/API.pm
index bfd5024..2753a74 100644
--- a/lib/Catalyst/Controller/DBIC/API.pm
+++ b/lib/Catalyst/Controller/DBIC/API.pm
@@ -30,6 +30,7 @@ __PACKAGE__-&gt;config&#40;&#41;;
   __PACKAGE__-&gt;config
     &#40; action =&gt; { setup =&gt; { PathPart =&gt; &#39;artist&#39;, Chained =&gt; &#39;/api/rpc/rpc_base&#39; } }, # define parent chain action and partpath
       class            =&gt; &#39;MyAppDB::Artist&#39;,
+      result_class     =&gt; &#39;MyAppDB::ResultSet::Artist&#39;,
       create_requires  =&gt; [&#39;name&#39;, &#39;age&#39;],
       create_allows    =&gt; [&#39;nickname&#39;],
       update_allows    =&gt; [&#39;name&#39;, &#39;age&#39;, &#39;nickname&#39;],
@@ -331,7 +332,7 @@ sub object_lookup
 
 list&#39;s steps are broken up into three distinct methods: L&lt;/list_munge_parameters&gt;, L&lt;/list_perform_search&gt;, and L&lt;/list_format_output&gt;.
 
-The goal of this method is to call -&gt;search&#40;&#41; on the current_result_set, HashRefInflator the result, and return it in $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root}. Please see the individual methods for more details on what actual processing takes place.
+The goal of this method is to call -&gt;search&#40;&#41; on the current_result_set, change resultset class of the result &#40;if needed&#41;, and return it in $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root}. Please see the individual methods for more details on what actual processing takes place.
 
 If the L&lt;/select&gt; config param is defined then the hashes will contain only those columns, otherwise all columns in the object will be returned. L&lt;/select&gt; of course supports the function/procedure calling semantics that L&lt;DBIx::Class::ResultSet/select&gt;. In order to have proper column names in the result, provide arguments in L&lt;/as&gt; &#40;which also follows L&lt;DBIx::Class::ResultSet/as&gt; semantics. Similarly L&lt;/count&gt;, L&lt;/page&gt;, L&lt;/grouped_by&gt; and L&lt;/ordered_by&gt; affect the maximum number of rows returned as well as the ordering and grouping. Note that if select, count, ordered_by or grouped_by request parameters are present then these will override the values set on the class with select becoming bound by the select_exposes attribute.
 
@@ -426,7 +427,7 @@ sub list_format_output
     my &#40;$self, $c&#41; = @_;
 
     my $rs = $c-&gt;req-&gt;current_result_set-&gt;search;
-    $rs-&gt;result_class&#40;&#39;DBIx::Class::ResultClass::HashRefInflator&#39;&#41;;
+    $rs-&gt;result_class&#40;$self-&gt;result_class&#41; if $self-&gt;result_class;
 
     try
     {
@@ -981,6 +982,10 @@ Below are explanations for various configuration parameters. Please see L&lt;Cataly
 
 Whatever you would pass to $c-&gt;model to get a resultset for this class. MyAppDB::Track for example.
 
+=head3 resultset_class
+
+Desired resultset class after accessing your model. MyAppDB::ResultSet::Track for example. By default, it&#39;s DBIx::Class::ResultClass::HashRefInflator. Set to empty string to leave resultset class without change.
+
 =head3 data_root
 
 By default, the response data is serialized into $c-&gt;stash-&gt;{response}-&gt;{$self-&gt;data_root} and data_root defaults to &#39;list&#39; to preserve backwards compatibility. This is now configuable to meet the needs of the consuming client.
diff --git a/lib/Catalyst/Controller/DBIC/API/StoredResultSource.pm b/lib/Catalyst/Controller/DBIC/API/StoredResultSource.pm
index dc8859b..5d81b39 100644
--- a/lib/Catalyst/Controller/DBIC/API/StoredResultSource.pm
+++ b/lib/Catalyst/Controller/DBIC/API/StoredResultSource.pm
@@ -17,6 +17,14 @@ class is the name of the class that is the model for this controller
 
 has &#39;class&#39; =&gt; &#40; is =&gt; &#39;ro&#39;, isa =&gt; Str, writer =&gt; &#39;_set_class&#39; &#41;;
 
+=attribute_public result_class is: ro, isa: Str
+
+result_class is the name of the resultset class that is the model for this controller
+
+=cut
+
+has &#39;result_class&#39; =&gt; &#40; is =&gt; &#39;ro&#39;, isa =&gt; Str, default =&gt; &#39;DBIx::Class::ResultClass::HashRefInflator&#39; &#41;;
+
 =attribute_public stored_result_source is: ro, isa: L&lt;Catalyst::Controller::DBIC::API::Types/ResultSource&gt;
 
 This is the result source for the controller
-- 
1.7.2.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-865554" href="/Public/Bug/Display.html?id=63686#txn-865554">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;07&nbsp;13:41:12&nbsp;2010</span>
    <span class="description">abraxxa [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-868685" href="/Public/Bug/Display.html?id=63686#txn-868685">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;14&nbsp;12:50:53&nbsp;2010</span>
    <span class="description">abraxxa [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/868685/449897/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/449897">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 527b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">About the &#39;stash_key&#39; patch:
This is a leftover from the 1.x versions before nperez rewrote DBIC::API.
Do you think it really makes sense to make this configurable?

About the other one, I quite like it!
nperez and I where discussing how to make the output formatting more
flexible for weeks but didn&#39;t come up with a really great solution.
The main problems was how to stringify inflated objects like DateTime
columns.
If you have an example for a custom result class which can be used for
that I&#39;ll gladly add it to the docs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-868688" href="/Public/Bug/Display.html?id=63686#txn-868688">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;14&nbsp;12:50:54&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-868697" href="/Public/Bug/Display.html?id=63686#txn-868697">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;14&nbsp;13:11:15&nbsp;2010</span>
    <span class="description">cub.uanic [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/868697/449906/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/449906">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 715b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">About the &#39;stash_key&#39; patch:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Do you think it really makes sense to make this configurable?
</div>Why not? I want to use C:C:DBIC::API instead of C:C:REST, and part of
serialization will be done via existing view, with existing templates. I
don&#39;t see why change of all templates could be better that this simple
patch :&#41;


About &#39;tweak resultset class&#39; patch:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you have an example for a custom result class which
&gt; can be used for that I&#39;ll gladly add it to the docs.
</div>Sorry, I don&#39;t have example. I just used:
  ......
  &#39;result_class&#39; =&gt; &#39;&#39;,
  ......
and so I was able to leave result set class as is, and call row methods.
And in general about docs: English is not native for me, so I&#39;m not best
source of docs :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-869166" href="/Public/Bug/Display.html?id=63686#txn-869166">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;15&nbsp;07:07:46&nbsp;2010</span>
    <span class="description">abraxxa [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/869166/450134/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/450134">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 349b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Are you on irc?
I&#39;d prefer to discuss this in #catalyst as others might have an opinion
or other helpful input on this too.
DBIC::API uses Catalyst::Action::Serialize internally so it&#39;s the same
controller option and DBIC::API doesn&#39;t need to create the attribute.
A doc patch linking to Catalyst::Action::Serialize plus your changes
should be fine.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-869169" href="/Public/Bug/Display.html?id=63686#txn-869169">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;15&nbsp;08:03:49&nbsp;2010</span>
    <span class="description">cub.uanic [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/869169/450137/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/450137">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 152b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, but seems I will not have free time on this and next week, at
least. Feel free to not wait for me and decide the best route on your own.

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-881580" href="/Public/Bug/Display.html?id=63686#txn-881580">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;14&nbsp;07:37:43&nbsp;2011</span>
    <span class="description">abraxxa [...] cpan.org -  Fixed in 2.002004 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-881581" href="/Public/Bug/Display.html?id=63686#txn-881581">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;14&nbsp;07:37:48&nbsp;2011</span>
    <span class="description">abraxxa [...] cpan.org -  Fixed in 2.002003 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-982394" href="/Public/Bug/Display.html?id=63686#txn-982394">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;28&nbsp;03:40:06&nbsp;2011</span>
    <span class="description">abraxxa [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/982394/511518/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/511518">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 48b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">forgot to close the RT after releasing 2.002004.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-982397" href="/Public/Bug/Display.html?id=63686#txn-982397">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;28&nbsp;03:40:08&nbsp;2011</span>
    <span class="description">abraxxa [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.523612</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
