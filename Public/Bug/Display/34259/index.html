<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34259 for Encode: Utf8 flag on after decoding 100% ASCII data</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34259 for Encode: Utf8 flag on after decoding 100% ASCII data</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Encode">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Encode">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Encode">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Encode">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Encode">Encode CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34259</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Encode">Encode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MSCHILLI [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
pali [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-12062-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.24    </td>
  </tr>
  <tr id="CF-12063-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.94    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Remove-misleading-documentation-about-UTF8-flag.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1750280/941552/0001-Remove-misleading-documentation-about-UTF8-flag.patch">
Fri Sep 29 08:41:16 2017 (1.8k) by pali [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=34259">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-437203" href="/Public/Bug/Display.html?id=34259#txn-437203">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;19&nbsp;17:29:36&nbsp;2008</span>
    <span class="description">MSCHILLI [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Utf8 flag on after decoding 100% ASCII data</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/437203/214065/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/214065">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 666b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Dan,

thanks for Encode, it&#39;s a great module! My collegue Richard Russo has
found a case where Encode decodes 100% ASCII data and subsequently sets
the utf8 flag:

    my $string = &#34;191501885&#34;;

    my $id = decode_utf8&#40; $string &#41;;
    print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;

    $id = decode &#40; &#34;utf8&#34;, $string &#41;;
    print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;

yields

    191501885 1
    191501885 1

while according to the documentation, strings that are 100% ascii
shouldn&#39;t have the utf8 flag on after they&#39;re utf8-decoded. Note that
the string contains a 100% ASCII string and not a number.

Would be great if you could take a look -- thanks!

-- Mike
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458639" href="/Public/Bug/Display.html?id=34259#txn-458639">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;07&nbsp;16:24:19&nbsp;2008</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/458639/225569/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225569">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1002b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I consider the behavior natural.  Consider the case below.

while&#40;&lt;&gt;&#41;{
  my $utf8 = decode_utf8&#40;$_&#41;;
  # ....
}

The subsequent code must be written conditionally if decode_utf8
conditionally sets the flag.

Dan the Encode Maintainer

On Wed Mar 19 17:29:36 2008, MSCHILLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Dan,
&gt; 
&gt; thanks for Encode, it&#39;s a great module! My collegue Richard Russo has
&gt; found a case where Encode decodes 100% ASCII data and subsequently sets
&gt; the utf8 flag:
&gt; 
&gt;     my $string = &#34;191501885&#34;;
&gt; 
&gt;     my $id = decode_utf8&#40; $string &#41;;
&gt;     print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;
&gt; 
&gt;     $id = decode &#40; &#34;utf8&#34;, $string &#41;;
&gt;     print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;
&gt; 
&gt; yields
&gt; 
&gt;     191501885 1
&gt;     191501885 1
&gt; 
&gt; while according to the documentation, strings that are 100% ascii
&gt; shouldn&#39;t have the utf8 flag on after they&#39;re utf8-decoded. Note that
&gt; the string contains a 100% ASCII string and not a number.
&gt; 
&gt; Would be great if you could take a look -- thanks!
&gt; 
&gt; -- Mike
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458640" href="/Public/Bug/Display.html?id=34259#txn-458640">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;07&nbsp;16:24:22&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458642" href="/Public/Bug/Display.html?id=34259#txn-458642">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;07&nbsp;16:24:23&nbsp;2008</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-461557" href="/Public/Bug/Display.html?id=34259#txn-461557">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;14&nbsp;23:31:57&nbsp;2008</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/461557/227095/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/227095">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I consider the behavior natural.  Consider the case below.
&gt; 
&gt; while&#40;&lt;&gt;&#41;{
&gt;   my $utf8 = decode_utf8&#40;$_&#41;;
&gt;   # ....
&gt; }
&gt; 
&gt; The subsequent code must be written conditionally if decode_utf8
&gt; conditionally sets the flag.
</div>
Sorry to be a pain, but this is complete garbage! The Encode
documentation even goes into great detail to explain this. Look at the
&#34;The UTF8 flag&#34; section:
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dankogai/Encode-2.25/Encode.pm">http://search.cpan.org/~dankogai/Encode-2.25/Encode.pm</a></span>

---
Goal #1:

    Old byte-oriented programs should not spontaneously break on the old
byte-oriented data they used to work on.

Goal #2:

    Old byte-oriented programs should magically start working on the new
character-oriented data when appropriate.

Goal #3:

    Programs should run just as fast in the new character-oriented mode
as in the old byte-oriented mode.

...
# When you decode, the resulting UTF8 flag is on unless you can
unambiguously represent data. Here is the definition of dis-ambiguity. 

After $utf8 = decode&#40;&#39;foo&#39;, $octet&#41;;,

When $octet is...   The UTF8 flag in $utf8 is
  ---------------------------------------------
  In ASCII only &#40;or EBCDIC only&#41;            OFF
..

As you see, there is one exception, In ASCII. That way you can assume
Goal #1. And with Encode Goal #2 is assumed but you still have to be
careful in such cases mentioned in CAVEAT paragraphs.
---

So this bug is actually a bug. The data is ASCII only, so the UTF8
should be OFF after the decode.

And fixing this bug should NOT be changing the documentation. This slows
down the case where there is ASCII only data.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-461558" href="/Public/Bug/Display.html?id=34259#txn-461558">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;14&nbsp;23:31:58&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-461561" href="/Public/Bug/Display.html?id=34259#txn-461561">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;14&nbsp;23:45:53&nbsp;2008</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/461561/227098/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/227098">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I consider the behavior natural.  Consider the case below.
&gt; 
&gt; while&#40;&lt;&gt;&#41;{
&gt;   my $utf8 = decode_utf8&#40;$_&#41;;
&gt;   # ....
&gt; }
&gt; 
&gt; The subsequent code must be written conditionally if decode_utf8
&gt; conditionally sets the flag.
</div>
I might add that this is not true either, there should be no need for
conditional code at all, the whole point is that programs don&#39;t need to
look at the UTF8 flag.

If you have a string that&#39;s pure ASCII and has the UTF8 flag ON, then
you can at any time join it with a string with the UTF8 flag that is ON,
and it will be promoted just fine.

my $asciistr = &#34;hello&#34;; # UTF8 flag OFF
my $utf8octets1 = &#34;hello&#34;; # UTF8 flag OFF
my $utf8octets2 = &#34;\342\230\272&#34;; # UTF8 flag OFF

my $perlstr1 = decode_utf8&#40;$utf8octets1&#41; # UTF8 flag OFF
my $perlstr2 = decode_utf8&#40;$utf8octets2&#41; # UTF8 flag ON

my $perlstr3 = &#34;\x{263a}&#34;; # UTF8 flag ON

my $result1 = $perlstr1 . $perlstr2; # UTF8 flag ON
my $result2 = $perlstr1 . $asciistr; # UTF8 flag OFF

All works just fine. 

The point is that if you work with data, even if it&#39;s incoming utf-8
data that you decode_utf8&#40;&#41; to create a &#34;perl string&#34;, then if that data
was only ASCII data, it&#39;s a perl string with the UTF8 flag OFF and you
get all the &#34;fast&#34; performance of octets.

Only if you use non-ASCII chars do you actually pay the performance cost
of perl strings with the UTF8 flag being on.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-481406" href="/Public/Bug/Display.html?id=34259#txn-481406">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;01&nbsp;16:09:09&nbsp;2008</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/481406/237865/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/237865">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That one is tough to cope with because in encode &#40;whatever -&gt; utf8&#41;, transcoder is set so 
that it only complains the first byte that is malformed while decode &#40;utf8 -&gt; whatever&#41; 
complains the whole unicode.  The problem is that the transcoder is shared with other 
encodings so fixing this may break other encodings.

I&#39;ll leave this ticket open till I come up with something better.

Dan the Encode Maintainer

On Wed May 14 23:45:53 2008, ROBM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I consider the behavior natural.  Consider the case below.
&gt; &gt; 
&gt; &gt; while&#40;&lt;&gt;&#41;{
&gt; &gt;   my $utf8 = decode_utf8&#40;$_&#41;;
&gt; &gt;   # ....
&gt; &gt; }
&gt; &gt; 
&gt; &gt; The subsequent code must be written conditionally if decode_utf8
&gt; &gt; conditionally sets the flag.
</div>&gt; 
&gt; I might add that this is not true either, there should be no need for
&gt; conditional code at all, the whole point is that programs don&#39;t need to
&gt; look at the UTF8 flag.
&gt; 
&gt; If you have a string that&#39;s pure ASCII and has the UTF8 flag ON, then
&gt; you can at any time join it with a string with the UTF8 flag that is ON,
&gt; and it will be promoted just fine.
&gt; 
&gt; my $asciistr = &#34;hello&#34;; # UTF8 flag OFF
&gt; my $utf8octets1 = &#34;hello&#34;; # UTF8 flag OFF
&gt; my $utf8octets2 = &#34;\342\230\272&#34;; # UTF8 flag OFF
&gt; 
&gt; my $perlstr1 = decode_utf8&#40;$utf8octets1&#41; # UTF8 flag OFF
&gt; my $perlstr2 = decode_utf8&#40;$utf8octets2&#41; # UTF8 flag ON
&gt; 
&gt; my $perlstr3 = &#34;\x{263a}&#34;; # UTF8 flag ON
&gt; 
&gt; my $result1 = $perlstr1 . $perlstr2; # UTF8 flag ON
&gt; my $result2 = $perlstr1 . $asciistr; # UTF8 flag OFF
&gt; 
&gt; All works just fine. 
&gt; 
&gt; The point is that if you work with data, even if it&#39;s incoming utf-8
&gt; data that you decode_utf8&#40;&#41; to create a &#34;perl string&#34;, then if that data
&gt; was only ASCII data, it&#39;s a perl string with the UTF8 flag OFF and you
&gt; get all the &#34;fast&#34; performance of octets.
&gt; 
&gt; Only if you use non-ASCII chars do you actually pay the performance cost
&gt; of perl strings with the UTF8 flag being on.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-495063" href="/Public/Bug/Display.html?id=34259#txn-495063">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;19:54:53&nbsp;2008</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/495063/245049/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/245049">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 812b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 01 16:09:09 2008, DANKOGAI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That one is tough to cope with because in encode &#40;whatever -&gt; utf8&#41;,
&gt; transcoder is set so
&gt; that it only complains the first byte that is malformed while decode
&gt; &#40;utf8 -&gt; whatever&#41;
&gt; complains the whole unicode.  The problem is that the transcoder is
&gt; shared with other
&gt; encodings so fixing this may break other encodings.
</div>
I would have thought the solution is to keep some &#34;found_non_ascii&#34;
&#40;default 0&#41; kind of flag in the transcoder when converting whatever -&gt;
utf8. If during the coversion you find a non-ascii output char &#40;eg
codepoint &gt;=0x80&#41;, you set the flag. At the end of the conversion, you
set the perl utf-8 flag on the string to on/off based on the
&#34;found_non_ascii&#34; flag?

Of course, I don&#39;t know the code, so I might be speaking rubbish...

Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-557585" href="/Public/Bug/Display.html?id=34259#txn-557585">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;17:22:03&nbsp;2009</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/557585/281336/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/281336">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 838b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Document added in 2.27.  See also #41163.

Dan the Encode Maintainer

On Wed Mar 19 17:29:36 2008, MSCHILLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Dan,
&gt; 
&gt; thanks for Encode, it&#39;s a great module! My collegue Richard Russo has
&gt; found a case where Encode decodes 100% ASCII data and subsequently sets
&gt; the utf8 flag:
&gt; 
&gt;     my $string = &#34;191501885&#34;;
&gt; 
&gt;     my $id = decode_utf8&#40; $string &#41;;
&gt;     print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;
&gt; 
&gt;     $id = decode &#40; &#34;utf8&#34;, $string &#41;;
&gt;     print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;
&gt; 
&gt; yields
&gt; 
&gt;     191501885 1
&gt;     191501885 1
&gt; 
&gt; while according to the documentation, strings that are 100% ascii
&gt; shouldn&#39;t have the utf8 flag on after they&#39;re utf8-decoded. Note that
&gt; the string contains a 100% ASCII string and not a number.
&gt; 
&gt; Would be great if you could take a look -- thanks!
&gt; 
&gt; -- Mike
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-557600" href="/Public/Bug/Display.html?id=34259#txn-557600">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;17:22:31&nbsp;2009</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-557730" href="/Public/Bug/Display.html?id=34259#txn-557730">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;20:06:04&nbsp;2009</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/557730/281447/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/281447">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 702b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 21 17:22:03 2009, DANKOGAI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Document added in 2.27.  See also #41163.
&gt; 
&gt; Dan the Encode Maintainer
</div>
This hasn&#39;t been resolved at all.

Doing a diff -ru between 2.26 and 2.27 shows nothing in the changed in
the documentation about this problem. In fact there&#39;s no mention of bug
34259 anywhere.

Worse, the documentation for Encode still clearly states that decoding
ASCII only data will return a perl string with the utf-8 flag OFF. Read
this section:

<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dankogai/Encode/Encode.pm#The_UTF8_flag">http://search.cpan.org/~dankogai/Encode/Encode.pm#The_UTF8_flag</a></span>

But when you test it, clearly still doesn&#39;t do what it says:

$ perl -le &#39;use Encode; print $Encode::VERSION; print
Encode::is_utf8&#40;decode_utf8&#40;&#34;blah&#34;&#41;&#41;;&#39;
2.27
1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-557731" href="/Public/Bug/Display.html?id=34259#txn-557731">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;21&nbsp;20:06:05&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-754911" href="/Public/Bug/Display.html?id=34259#txn-754911">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;29&nbsp;03:39:19&nbsp;2010</span>
    <span class="description">bryce2 [...] obviously.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bryce2 [...] obviously.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/754911/390313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/390313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 188b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just spent hours on this.  As of Perl 5.10.1, this bug is still present:
&lt;code&gt;
perl -le &#39;use Encode; print $Encode::VERSION; print
Encode::is_utf8&#40;decode_utf8&#40;&#34;blah&#34;&#41;&#41;;&#39;
2.23
1
&lt;/code&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-953203" href="/Public/Bug/Display.html?id=34259#txn-953203">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;01:15:48&nbsp;2011</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/953203/495780/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/495780">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 972b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looks like you just forgot to &#34;use utf8&#34;.  For compatibility&#39;s sake, Perl takes all scripts written 
in ISO-8859-1 unless you say &#34;use utf8&#34;.

perldoc perluniintro for details

Dan the Encode Maintainer


On Wed Mar 19 17:29:36 2008, MSCHILLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Dan,
&gt; 
&gt; thanks for Encode, it&#39;s a great module! My collegue Richard Russo has
&gt; found a case where Encode decodes 100% ASCII data and subsequently sets
&gt; the utf8 flag:
&gt; 
&gt;     my $string = &#34;191501885&#34;;
&gt; 
&gt;     my $id = decode_utf8&#40; $string &#41;;
&gt;     print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;
&gt; 
&gt;     $id = decode &#40; &#34;utf8&#34;, $string &#41;;
&gt;     print &#34;$id &#34; , Encode::is_utf8&#40;$id&#41;, &#34;\n&#34;;
&gt; 
&gt; yields
&gt; 
&gt;     191501885 1
&gt;     191501885 1
&gt; 
&gt; while according to the documentation, strings that are 100% ascii
&gt; shouldn&#39;t have the utf8 flag on after they&#39;re utf8-decoded. Note that
&gt; the string contains a 100% ASCII string and not a number.
&gt; 
&gt; Would be great if you could take a look -- thanks!
&gt; 
&gt; -- Mike
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-953205" href="/Public/Bug/Display.html?id=34259#txn-953205">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;01:15:52&nbsp;2011</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-953391" href="/Public/Bug/Display.html?id=34259#txn-953391">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;10:41:55&nbsp;2011</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/953391/495899/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/495899">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 438b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 07 01:15:48 2011, DANKOGAI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Looks like you just forgot to &#34;use utf8&#34;.  For compatibility&#39;s sake,
&gt; Perl takes all scripts written in ISO-8859-1 unless you say &#34;use utf8&#34;.
</div>
Sorry, this doesn&#39;t make any sense in this context. &#34;use utf8&#34; is
irrelevant if your program uses plain ASCII strings, as the snippets of
code presented in this bug all do.

The problem is that Encode isn&#39;t behaving according to its documentation.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-953393" href="/Public/Bug/Display.html?id=34259#txn-953393">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;10:41:56&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-999096" href="/Public/Bug/Display.html?id=34259#txn-999096">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;12&nbsp;17:32:33&nbsp;2011</span>
    <span class="description">chansen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/999096/520353/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/520353">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 645b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">There are three possible solutions to this:
1&#41; Change all encodings to keep track of whether or not a code point above 
   U+007F has been decoded and SvUTF8_&#40;?on|off&#41; accordingly
2&#41; Change Encode::decode&#40;&#41; to scan decoded strings for code points above 
   U+007F and SvUTF8_off if no code points are above U+007F
3&#41; Change documentation

1 or 2 isn&#39;t beneficial to me since most of my data contain Basic Latin and 
Latin-1 Supplement characters &#40;Swedish&#41;, with occasional Miscellaneous Symbols
and General Punctuation.

The question is if it&#39;s worth the overhead, even English texts makes more 
and more use of General Punctuation.

--
chansen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-999250" href="/Public/Bug/Display.html?id=34259#txn-999250">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;12&nbsp;21:32:47&nbsp;2011</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> chansen [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/999250/520469/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/520469">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 12 17:32:33 2011, CHANSEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There are three possible solutions to this:
&gt; 1&#41; Change all encodings to keep track of whether or not a code point
&gt; above
&gt;    U+007F has been decoded and SvUTF8_&#40;?on|off&#41; accordingly
&gt; 2&#41; Change Encode::decode&#40;&#41; to scan decoded strings for code points
&gt; above
&gt;    U+007F and SvUTF8_off if no code points are above U+007F
&gt; 3&#41; Change documentation
</div>
I would recommend changing the documentation and possibly removing the whole section on 
the UTF8 flag altogether.

The UTF8 flag is internal to Perl, or at least it is meant to be. All this discussion about it has 
led to much misunderstanding and chagrin over the years. The way itâ€™s supposed to be is: A 
string is a string is a string. Previously the max char was 255. Now itâ€™s higher.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 1 or 2 isn&#39;t beneficial to me since most of my data contain Basic
&gt; Latin and
&gt; Latin-1 Supplement characters &#40;Swedish&#41;, with occasional Miscellaneous
&gt; Symbols
&gt; and General Punctuation.
&gt; 
&gt; The question is if it&#39;s worth the overhead, even English texts makes
&gt; more
&gt; and more use of General Punctuation.
&gt; 
&gt; --
&gt; chansen
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1161573" href="/Public/Bug/Display.html?id=34259#txn-1161573">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;03&nbsp;10:28:20&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1161573/610723/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/610723">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hm. Not sure here.

Modules like MIME::Base64 and Digest::SHA &#40;newer versions&#41; die with
error if see a string with utf8 bit set. &#40;that looks correct as those
functions are defined only for bytes, not for characters&#41;.

People obviously need to control utf8 bit.

On Sun Nov 13 06:32:47 2011, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Nov 12 17:32:33 2011, CHANSEN wrote:
<div class="message-stanza open">&gt; &gt; There are three possible solutions to this:
&gt; &gt; 1&#41; Change all encodings to keep track of whether or not a code point
&gt; &gt; above
&gt; &gt;    U+007F has been decoded and SvUTF8_&#40;?on|off&#41; accordingly
&gt; &gt; 2&#41; Change Encode::decode&#40;&#41; to scan decoded strings for code points
&gt; &gt; above
&gt; &gt;    U+007F and SvUTF8_off if no code points are above U+007F
&gt; &gt; 3&#41; Change documentation
</div>&gt; 
&gt; I would recommend changing the documentation and possibly removing the
&gt; whole section on
&gt; the UTF8 flag altogether.
&gt; 
&gt; The UTF8 flag is internal to Perl, or at least it is meant to be. All
&gt; this discussion about it has
&gt; led to much misunderstanding and chagrin over the years. The way itâ€™s
&gt; supposed to be is: A
&gt; string is a string is a string. Previously the max char was 255. Now
&gt; itâ€™s higher.
&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; 1 or 2 isn&#39;t beneficial to me since most of my data contain Basic
&gt; &gt; Latin and
&gt; &gt; Latin-1 Supplement characters &#40;Swedish&#41;, with occasional
</div>&gt; Miscellaneous
<div class="message-stanza open">&gt; &gt; Symbols
&gt; &gt; and General Punctuation.
&gt; &gt;
&gt; &gt; The question is if it&#39;s worth the overhead, even English texts makes
&gt; &gt; more
&gt; &gt; and more use of General Punctuation.
&gt; &gt;
&gt; &gt; --
&gt; &gt; chansen
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1249334" href="/Public/Bug/Display.html?id=34259#txn-1249334">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;14&nbsp;11:43:52&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> victor [...] vsespb.ru</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1249334/660981/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/660981">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Modules like MIME::Base64 and Digest::SHA &#40;newer versions&#41; die with error if see a string with utf8 bit set.
</div>
ignore this, this is just wrong

On Thu Jan 03 19:28:20 2013, vsespb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hm. Not sure here.
&gt; 
&gt; Modules like MIME::Base64 and Digest::SHA &#40;newer versions&#41; die with
&gt; error if see a string with utf8 bit set. &#40;that looks correct as those
&gt; functions are defined only for bytes, not for characters&#41;.
&gt; 
&gt; People obviously need to control utf8 bit.
&gt; 
&gt; On Sun Nov 13 06:32:47 2011, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; On Sat Nov 12 17:32:33 2011, CHANSEN wrote:
<div class="message-stanza open">&gt; &gt; &gt; There are three possible solutions to this:
&gt; &gt; &gt; 1&#41; Change all encodings to keep track of whether or not a code point
&gt; &gt; &gt; above
&gt; &gt; &gt;    U+007F has been decoded and SvUTF8_&#40;?on|off&#41; accordingly
&gt; &gt; &gt; 2&#41; Change Encode::decode&#40;&#41; to scan decoded strings for code points
&gt; &gt; &gt; above
&gt; &gt; &gt;    U+007F and SvUTF8_off if no code points are above U+007F
&gt; &gt; &gt; 3&#41; Change documentation
</div>&gt; &gt; 
&gt; &gt; I would recommend changing the documentation and possibly removing the
&gt; &gt; whole section on
&gt; &gt; the UTF8 flag altogether.
&gt; &gt; 
&gt; &gt; The UTF8 flag is internal to Perl, or at least it is meant to be. All
&gt; &gt; this discussion about it has
&gt; &gt; led to much misunderstanding and chagrin over the years. The way itâ€™s
&gt; &gt; supposed to be is: A
&gt; &gt; string is a string is a string. Previously the max char was 255. Now
&gt; &gt; itâ€™s higher.
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; 1 or 2 isn&#39;t beneficial to me since most of my data contain Basic
&gt; &gt; &gt; Latin and
&gt; &gt; &gt; Latin-1 Supplement characters &#40;Swedish&#41;, with occasional
</div>&gt; &gt; Miscellaneous
<div class="message-stanza open">&gt; &gt; &gt; Symbols
&gt; &gt; &gt; and General Punctuation.
&gt; &gt; &gt;
&gt; &gt; &gt; The question is if it&#39;s worth the overhead, even English texts makes
&gt; &gt; &gt; more
&gt; &gt; &gt; and more use of General Punctuation.
&gt; &gt; &gt;
&gt; &gt; &gt; --
&gt; &gt; &gt; chansen
</div>&gt; &gt; 
&gt; &gt; 
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1250626" href="/Public/Bug/Display.html?id=34259#txn-1250626">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;18&nbsp;07:37:17&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> victor [...] vsespb.ru</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1250626/661710/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/661710">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 15 07:31:57 2008, ROBM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ---
&gt; Goal #1:
&gt; 
&gt;     Old byte-oriented programs should not spontaneously break on the old
&gt; byte-oriented data they used to work on.
&gt; 
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As you see, there is one exception, In ASCII. That way you can assume
&gt; Goal #1. And with Encode Goal #2 is assumed but you still have to be
&gt; careful in such cases mentioned in CAVEAT paragraphs.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So this bug is actually a bug. The data is ASCII only, so the UTF8
&gt; should be OFF after the decode.
&gt; 
&gt; And fixing this bug should NOT be changing the documentation. This slows
&gt; down the case where there is ASCII only data.
</div>
I think point about Goal #1 is invalid here. ASCII data can get utf-8 flag, for example, when splitting non-ASCII string &#40;with flag on&#41; to ASCII and non-ASCII parts. ASCII part will have utf8 bit on.

Also, &#34;Old byte-oriented&#34; programs never deal with decode&#40;&#41; and with any Unicode data, so they are not affected.

So, IMHO documentation about ASCII flag behaviour should be dropped &#40;however it&#39;s better add notice to CAVEATS&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1708841" href="/Public/Bug/Display.html?id=34259#txn-1708841">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;04&nbsp;15:06:43&nbsp;2017</span>
    <span class="description">pali [...] cpan.org -  Cc PALI added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1708852" href="/Public/Bug/Display.html?id=34259#txn-1708852">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;04&nbsp;15:13:51&nbsp;2017</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1708852/918079/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/918079">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sob Nov 12 21:32:47 2011, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Nov 12 17:32:33 2011, CHANSEN wrote:
<div class="message-stanza open">&gt; &gt; There are three possible solutions to this:
&gt; &gt; 1&#41; Change all encodings to keep track of whether or not a code point
&gt; &gt; above
&gt; &gt;    U+007F has been decoded and SvUTF8_&#40;?on|off&#41; accordingly
&gt; &gt; 2&#41; Change Encode::decode&#40;&#41; to scan decoded strings for code points
&gt; &gt; above
&gt; &gt;    U+007F and SvUTF8_off if no code points are above U+007F
&gt; &gt; 3&#41; Change documentation
</div>&gt; 
&gt; I would recommend changing the documentation and possibly removing the
&gt; whole section on
&gt; the UTF8 flag altogether.
</div>
I&#39;m for removing documentation for whole section &#34;The UTF8 flag&#34;. Just &#34;This UTF8 flag is not visible in Perl scripts...&#34; does not have to be removed and could be moved to section &#34;Messing with Perl&#39;s Internals&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The UTF8 flag is internal to Perl, or at least it is meant to be. All
&gt; this discussion about it has
&gt; led to much misunderstanding and chagrin over the years. The way itâ€™s
&gt; supposed to be is: A
&gt; string is a string is a string. Previously the max char was 255. Now
&gt; itâ€™s higher.
</div>
+1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1749540" href="/Public/Bug/Display.html?id=34259#txn-1749540">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;23&nbsp;15:18:17&nbsp;2017</span>
    <span class="description">will [...] summercat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #34259] +1 on retaining current behaviour</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 Sep 2017 12:17:51 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Encode [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Will Storey &lt;will [...] summercat.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1749540/941120/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/941120">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 296b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think the current behaviour makes sense. For one thing, it can help check
whether you&#39;ve decoded. It is just generally simpler to understand as well.

I&#39;m in favour of updating the documentation. We could remove everything in
the section after &#34;When you decode, the resulting UTF8 flag is on&#34;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1750280" href="/Public/Bug/Display.html?id=34259#txn-1750280">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;29&nbsp;08:41:16&nbsp;2017</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1750280/941551/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/941551">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 38b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">See proposed change in the attachment.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Remove-misleading-documentation-about-UTF8-flag.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1750280/941552/0001-Remove-misleading-documentation-about-UTF8-flag.patch">Download 0001-Remove-misleading-documentation-about-UTF8-flag.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 1116e0fc2c195e2135e9353d90bdfcfa228e9fbf Mon Sep 17 00:00:00 2001
From: Pali &lt;pali@cpan.org&gt;
Date: Fri, 29 Sep 2017 14:39:36 +0200
Subject: [PATCH] Remove misleading documentation about UTF8 flag

---
 Encode.pm | 27 ---------------------------
 1 file changed, 27 deletions&#40;-&#41;

diff --git a/Encode.pm b/Encode.pm
index 6ed4a77..faf1f58 100644
--- a/Encode.pm
+++ b/Encode.pm
@@ -822,38 +822,11 @@ different kinds of strings and string-operations in Perl: one a
 byte-oriented mode  for when the internal UTF8 flag is off, and the other a
 character-oriented mode for when the internal UTF8 flag is on.
 
-Here is how C&lt;Encode&gt; handles the UTF8 flag.
-
-=over 2
-
-=item *
-
-When you I&lt;encode&gt;, the resulting UTF8 flag is always B&lt;off&gt;.
-
-=item *
-
-When you I&lt;decode&gt;, the resulting UTF8 flag is B&lt;on&gt;--I&lt;unless&gt; you can
-unambiguously represent data.  Here is what we mean by &#34;unambiguously&#34;.
-After C&lt;$str = decode&#40;&#34;foo&#34;, $octet&#41;&gt;,
-
-  When $octet is...    The UTF8 flag in $str is
-  ---------------------------------------------
-  In ASCII only &#40;or EBCDIC only&#41;            OFF
-  In ISO-8859-1                              ON
-  In any other Encoding                      ON
-  ---------------------------------------------
-
-As you see, there is one exception: in ASCII.  That way you can assume
-Goal #1.  And with C&lt;Encode&gt;, Goal #2 is assumed but you still have to be
-careful in the cases mentioned in the B&lt;CAVEAT&gt; paragraphs above.
-
 This UTF8 flag is not visible in Perl scripts, exactly for the same reason
 you cannot &#40;or rather, you I&lt;don&#39;t have to&gt;&#41; see whether a scalar contains
 a string, an integer, or a floating-point number.   But you can still peek
 and poke these if you will.  See the next section.
 
-=back
-
 =head2 Messing with Perl&#39;s Internals
 
 The following API uses parts of Perl&#39;s internals in the current
-- 
2.11.0

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1753457" href="/Public/Bug/Display.html?id=34259#txn-1753457">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;18:16:54&nbsp;2017</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1753457/943421/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/943421">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 96b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Pia Sep 29 08:41:16 2017, PALI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; See proposed change in the attachment.
</div>
Any comments?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1765048" href="/Public/Bug/Display.html?id=34259#txn-1765048">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;09&nbsp;14:45:37&nbsp;2018</span>
    <span class="description">pali [...] cpan.org -  Fixed in 2.94 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1765049" href="/Public/Bug/Display.html?id=34259#txn-1765049">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;09&nbsp;14:46:14&nbsp;2018</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1765049/949903/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949903">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 34b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch was included in Encode 2.94.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1765876" href="/Public/Bug/Display.html?id=34259#txn-1765876">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;15&nbsp;23:33:57&nbsp;2018</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.10235</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
