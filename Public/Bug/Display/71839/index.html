<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71839 for XML-Twig: Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71839 for XML-Twig: Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Twig/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Twig">XML-Twig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71839</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Twig/Active/">XML-Twig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ambrus [...] math.bme.hu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37682-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37683-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;11:18:46&nbsp;2011</span>
    <span class="description">ambrus [...] math.bme.hu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 21 Oct 2011 17:18:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zsb√°n Ambrus &lt;ambrus [...] math.bme.hu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I&#39;d like to ask you to add a way in XML::Twig for the user to have
more control over HTML parsing with HTML::TreeBuilder.

I&#39;d like to parse some HTML to an XML::Twig, but want to unset the
ignore_unknown option of HTML::TreeBuilder.  There seems no easy way
to do this, because I never get to touch the TreeBuilder object if I
use the parse_html method of Twig, and the parse_html method does some
arcane fixups on the TreeBuilder object that I can&#39;t just emulate the
whole proceduce in user code.

Thus, it would be useful if XML::Twig had some interface for using
HTML::TreeBuilder that&#39;s more general than the parse_html method.

I&#39;m not sure how this interface should look like, but here&#39;s an idea.
First, I&#39;d call an object method of a Twig that constructs a
HTML::TreeBuilder object preset with the default options for later use
of this Twig.  I would then call the parse_content or parse_file
method on the TreeBuilder, and possibly any other changes before or
after the parse.  Then I call a second method of the Twig which loads
the tree from the TreeBuilder to the Twig.

I&#39;d like to ask for your opinion on whether such an interface would
make sense.  If yes, I might try to write a patch for it &#40;but I don&#39;t
promise anything&#41;.

I am using XML::Twig version 3.39, whose configuration information I
attach to the bottom.  &#40;Btw, why does that printout not include the
version number of Twig itself?&#41;

Ambrus


-----------

Configuration:

perl: 5.014002
OS: linux - x86_64-linux

required
  XML::Parser              :             2.41
  expat                    : &lt;no version information found&gt;

Strongly Recommended
  Scalar::Util             :             1.23 &#40;for improved memory management&#41;
  Encode                   :          2.42_01 &#40;for encoding conversions&#41;

Modules providing additional features
  XML::XPathEngine         :  &lt;not available&gt; &#40;to use XML::Twig::XPath&#41;
  XML::XPath               :             1.13 &#40;to use XML::Twig::XPath
if Tree::XPathEngine not available&#41;
  LWP                      :             6.02 &#40;for the parseurl method&#41;
  HTML::TreeBuilder        :              4.2 &#40;to use parse_html and
parsefile_html&#41;
  HTML::Entities::Numbered :  &lt;not available&gt; &#40;to allow parsing of
HTML containing named entities&#41;
  HTML::Tidy               :  &lt;not available&gt; &#40;to use parse_html and
parsefile_html with the use_tidy option&#41;
  HTML::Entities           :             3.69 &#40;for the html_encode filter&#41;
  Tie::IxHash              :  &lt;not available&gt; &#40;for the keep_atts_order option&#41;
  Text::Wrap               :        2009.0305 &#40;to use the &#34;wrapped&#34;
option for pretty_print&#41;

Modules used only by the auto tests
  Test                     :          1.25_02
  Test::Pod                :             1.45
  XML::Simple              :  &lt;not available&gt;
  XML::Handler::YAWriter   :  &lt;not available&gt;
  XML::SAX::Writer         :  &lt;not available&gt;
  XML::Filter::BufferText  :  &lt;not available&gt;
  IO::Scalar               :  &lt;not available&gt;


Please add this information to bug reports &#40;you can run
t/zz_dump_config.t to get it&#41;

if you are upgrading the module from a previous version, make sure you read the
Changes file for bug fixes, new features and the occasional
COMPATIBILITY WARNING

1..1
ok 1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;11:27:36&nbsp;2011</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71839] Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 21 Oct 2011 17:27:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

That&#39;s a good idea. I have to think about the interface. Probably allow 
passing a HTML::TreeBuilder object to the constructor. The object could 
be constructed by an XML::Twig class method, then modified by the user 
and passed to XML::Twig::new.

Let me think about it some more, or have a try at it if you want.

And adding the version of XML::Twig to t/zz_config.t is a good idea, 
I&#39;ll add it.

Thanks a lot.

-- 
mirod

On 10/21/2011 05:18 PM, ambrus@math.bme.hu via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Oct 21 11:18:46 2011: Request 71839 was acted upon.
&gt; Transaction: Ticket created by ambrus@math.bme.hu
&gt;         Queue: XML-Twig
&gt;       Subject: Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: ambrus@math.bme.hu
&gt;        Status: new
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71839">https://rt.cpan.org/Ticket/Display.html?id=71839</a></span>&gt;
&gt;
&gt;
&gt; Hello,
&gt;
&gt; I&#39;d like to ask you to add a way in XML::Twig for the user to have
&gt; more control over HTML parsing with HTML::TreeBuilder.
&gt;
&gt; I&#39;d like to parse some HTML to an XML::Twig, but want to unset the
&gt; ignore_unknown option of HTML::TreeBuilder.  There seems no easy way
&gt; to do this, because I never get to touch the TreeBuilder object if I
&gt; use the parse_html method of Twig, and the parse_html method does some
&gt; arcane fixups on the TreeBuilder object that I can&#39;t just emulate the
&gt; whole proceduce in user code.
&gt;
&gt; Thus, it would be useful if XML::Twig had some interface for using
&gt; HTML::TreeBuilder that&#39;s more general than the parse_html method.
&gt;
&gt; I&#39;m not sure how this interface should look like, but here&#39;s an idea.
&gt; First, I&#39;d call an object method of a Twig that constructs a
&gt; HTML::TreeBuilder object preset with the default options for later use
&gt; of this Twig.  I would then call the parse_content or parse_file
&gt; method on the TreeBuilder, and possibly any other changes before or
&gt; after the parse.  Then I call a second method of the Twig which loads
&gt; the tree from the TreeBuilder to the Twig.
&gt;
&gt; I&#39;d like to ask for your opinion on whether such an interface would
&gt; make sense.  If yes, I might try to write a patch for it &#40;but I don&#39;t
&gt; promise anything&#41;.
&gt;
&gt; I am using XML::Twig version 3.39, whose configuration information I
&gt; attach to the bottom.  &#40;Btw, why does that printout not include the
&gt; version number of Twig itself?&#41;
&gt;
&gt; Ambrus
&gt;
&gt;
&gt; -----------
&gt;
&gt; Configuration:
&gt;
&gt; perl: 5.014002
&gt; OS: linux - x86_64-linux
&gt;
&gt; required
&gt;    XML::Parser              :             2.41
&gt;    expat                    :&lt;no version information found&gt;
&gt;
&gt; Strongly Recommended
&gt;    Scalar::Util             :             1.23 &#40;for improved memory management&#41;
&gt;    Encode                   :          2.42_01 &#40;for encoding conversions&#41;
&gt;
&gt; Modules providing additional features
&gt;    XML::XPathEngine         :&lt;not available&gt;  &#40;to use XML::Twig::XPath&#41;
&gt;    XML::XPath               :             1.13 &#40;to use XML::Twig::XPath
&gt; if Tree::XPathEngine not available&#41;
&gt;    LWP                      :             6.02 &#40;for the parseurl method&#41;
&gt;    HTML::TreeBuilder        :              4.2 &#40;to use parse_html and
&gt; parsefile_html&#41;
&gt;    HTML::Entities::Numbered :&lt;not available&gt;  &#40;to allow parsing of
&gt; HTML containing named entities&#41;
&gt;    HTML::Tidy               :&lt;not available&gt;  &#40;to use parse_html and
&gt; parsefile_html with the use_tidy option&#41;
&gt;    HTML::Entities           :             3.69 &#40;for the html_encode filter&#41;
&gt;    Tie::IxHash              :&lt;not available&gt;  &#40;for the keep_atts_order option&#41;
&gt;    Text::Wrap               :        2009.0305 &#40;to use the &#34;wrapped&#34;
&gt; option for pretty_print&#41;
&gt;
&gt; Modules used only by the auto tests
&gt;    Test                     :          1.25_02
&gt;    Test::Pod                :             1.45
&gt;    XML::Simple              :&lt;not available&gt;
&gt;    XML::Handler::YAWriter   :&lt;not available&gt;
&gt;    XML::SAX::Writer         :&lt;not available&gt;
&gt;    XML::Filter::BufferText  :&lt;not available&gt;
&gt;    IO::Scalar               :&lt;not available&gt;
&gt;
&gt;
&gt; Please add this information to bug reports &#40;you can run
&gt; t/zz_dump_config.t to get it&#41;
&gt;
&gt; if you are upgrading the module from a previous version, make sure you read the
&gt; Changes file for bug fixes, new features and the occasional
&gt; COMPATIBILITY WARNING
&gt;
&gt; 1..1
&gt; ok 1
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;11:27:37&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;10:13:36&nbsp;2011</span>
    <span class="description">ambrus [...] math.bme.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71839] Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Nov 2011 16:12:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zsb√°n Ambrus &lt;ambrus [...] math.bme.hu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Oct 21, 2011 at 5:27 PM, xmltwig@gmail.com via RT
&lt;bug-XML-Twig@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71839">https://rt.cpan.org/Ticket/Display.html?id=71839</a></span> &gt;
</div>
As I&#39;d like to write a patch for this, let me ask a few questions.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Probably allow
&gt; passing a HTML::TreeBuilder object to the constructor. The object could
&gt; be constructed by an XML::Twig class method, then modified by the user
&gt; and passed to XML::Twig::new.
</div>
I&#39;m not sure I like that idea.  In the future, you could want some
Twig constructor options that affect parsing with the HTML parser, and
that need to be used at the time you construct the HTML parser.
Though I&#39;m more thinking of parse options that affect XML and HTML
parsing the same way, it turns out that in fact you already have a
constructor option TidyOptions doing this.  Thus it would make more
sense if you created the TreeBuilder object after constructing the
Twig, with an extra method call.

Other questions.  In XML-Twig-3.39/Twig_pm.slow line 898 &#40;in the
_html2xml function&#41;, is there a point to calling $tree-&gt;delete a
second time?

What&#39;s the status of parsing with XML::Tidy?  I haven&#39;t tried whether
it works, and it seems documented only halfway.  Are there at least
some tests for it so if I install XML::Tidy I can be sure I don&#39;t
break the logic accidentally?

Ambrus
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;09:01:34&nbsp;2011</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71839] Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Nov 2011 15:00:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 11/16/2011 04:13 PM, ambrus@math.bme.hu via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: XML-Twig
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71839">https://rt.cpan.org/Ticket/Display.html?id=71839</a></span>&gt;
&gt;
&gt; On Fri, Oct 21, 2011 at 5:27 PM, xmltwig@gmail.com via RT
&gt; &lt;bug-XML-Twig@rt.cpan.org&gt;  wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71839">https://rt.cpan.org/Ticket/Display.html?id=71839</a></span>&gt;
</div>&gt;
&gt; As I&#39;d like to write a patch for this, let me ask a few questions.
&gt;
<div class="message-stanza open">&gt;&gt;   Probably allow
&gt;&gt; passing a HTML::TreeBuilder object to the constructor. The object could
&gt;&gt; be constructed by an XML::Twig class method, then modified by the user
&gt;&gt; and passed to XML::Twig::new.
</div>&gt;
&gt; I&#39;m not sure I like that idea.  In the future, you could want some
&gt; Twig constructor options that affect parsing with the HTML parser, and
&gt; that need to be used at the time you construct the HTML parser.
&gt; Though I&#39;m more thinking of parse options that affect XML and HTML
&gt; parsing the same way, it turns out that in fact you already have a
&gt; constructor option TidyOptions doing this.  Thus it would make more
&gt; sense if you created the TreeBuilder object after constructing the
&gt; Twig, with an extra method call.
</div>
OK, go for it. As it is the way the HTML conversion is designed works 
for me, but as you have different requirements, as long as the existing 
way works and the tests still pass, then go for it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Other questions.  In XML-Twig-3.39/Twig_pm.slow line 898 &#40;in the
&gt; _html2xml function&#41;, is there a point to calling $tree-&gt;delete a
&gt; second time?
</div>
Apparently not. I removed it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What&#39;s the status of parsing with XML::Tidy?  I haven&#39;t tried whether
&gt; it works, and it seems documented only halfway.  Are there at least
&gt; some tests for it so if I install XML::Tidy I can be sure I don&#39;t
&gt; break the logic accidentally?
</div>
It&#39;s HTML::Tidy, not XML::Tidy.

The tests are in t/test_3_36.t and in t/test_memory.t I tend to use 
HTML::Tidy. I tend to use HTML::Tidy to convert to XHTML these days, as 
in a few case the output is more faithful to the original HTML than with 
HTML::TreeBuilder, so it is used, if not properly documented. I&#39;ll go 
back to the docs and see if I can improve them.

Thanks

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;16:22:16&nbsp;2011</span>
    <span class="description">ambrus [...] math.bme.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71839] Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Nov 2011 22:21:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zsb√°n Ambrus &lt;ambrus [...] math.bme.hu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was wondering if I could use XML::LibXML as a third HTML parser for
Twig.  I got this.

$ perl -we &#39;use XML::LibXML; my $pa = XML::LibXML-&gt;new&#40;recover =&gt; 1&#41;;
my $tr = $pa-&gt;load_html&#40;string =&gt; &#34;&lt;.m/&gt;&#34;&#41;; my $xm = $tr-&gt;toString&#40;0&#41;;
print $xm, &#34;\n&#34;;&#39;
HTML parser error : Tag .m invalid
&lt;.m/&gt;
   ^
&lt;?xml version=&#34;1.0&#34; standalone=&#34;yes&#34;?&gt;
&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD HTML 4.0 Transitional//EN&#34;
&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/REC-html40/loose.dtd">http://www.w3.org/TR/REC-html40/loose.dtd</a></span>&#34;&gt;
&lt;html&gt;&lt;body&gt;&lt;.m/&gt;&lt;/body&gt;&lt;/html&gt;

$

Turns out, XML::LibXML outputs an invalid element name, so I can&#39;t
parse the output as XML.  ARGH!

I&#39;ve got deja vu: I just fixed a similar error with HTML::Tree and
invalid attribute names
&#40;&#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=71805">https://rt.cpan.org/Public/Bug/Display.html?id=71805</a></span>&#34;&#41;.  But in this
case, the bug is likely inside C code, so I can&#39;t fix it so easily.

I wonder, how can one work this around?

Ambrus
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;07:28:00&nbsp;2011</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71839] Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Nov 2011 13:27:14 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 11/17/2011 10:22 PM, ambrus@math.bme.hu via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: XML-Twig
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71839">https://rt.cpan.org/Ticket/Display.html?id=71839</a></span>&gt;
&gt;
&gt; I was wondering if I could use XML::LibXML as a third HTML parser for
&gt; Twig.  I got this.
&gt;
&gt; $ perl -we &#39;use XML::LibXML; my $pa = XML::LibXML-&gt;new&#40;recover =&gt;  1&#41;;
&gt; my $tr = $pa-&gt;load_html&#40;string =&gt;  &#34;&lt;.m/&gt;&#34;&#41;; my $xm = $tr-&gt;toString&#40;0&#41;;
&gt; print $xm, &#34;\n&#34;;&#39;
&gt; HTML parser error : Tag .m invalid
&gt; &lt;.m/&gt;
&gt;     ^
&gt; &lt;?xml version=&#34;1.0&#34; standalone=&#34;yes&#34;?&gt;
&gt; &lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD HTML 4.0 Transitional//EN&#34;
&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/REC-html40/loose.dtd">http://www.w3.org/TR/REC-html40/loose.dtd</a></span>&#34;&gt;
&gt; &lt;html&gt;&lt;body&gt;&lt;.m/&gt;&lt;/body&gt;&lt;/html&gt;
&gt;
&gt; $
&gt;
&gt; Turns out, XML::LibXML outputs an invalid element name, so I can&#39;t
&gt; parse the output as XML.  ARGH!
&gt;
&gt; I&#39;ve got deja vu: I just fixed a similar error with HTML::Tree and
&gt; invalid attribute names
&gt; &#40;&#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=71805">https://rt.cpan.org/Public/Bug/Display.html?id=71805</a></span>&#34;&#41;.  But in this
&gt; case, the bug is likely inside C code, so I can&#39;t fix it so easily.
&gt;
&gt; I wonder, how can one work this around?
</div>
Sorry it took me so long to answer, there seems to be even more problems 
than I thought with HTML::TreeBuilder, and I am trying to fix them.

When I tested HTML to XML conversion, a few years ago, I found that, at 
least at the time, XML::LibXML did not deal very well with real-world 
HTML, so I did not look further into it.

I am aware of the problems with HTML::TreeBuilder conversion to XHTML. 
Generally speaking, as_XML does not seem to be the most developed 
feature of the module. And dying when finding something invalid in the 
HTML is quite the opposite of what I am looking for in an HTML parsing 
module.

There is also the problem that HTML::Parser has not been updated for HTML5.

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;08:05:12&nbsp;2011</span>
    <span class="description">ambrus [...] math.bme.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71839] Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Nov 2011 14:04:31 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zsb√°n Ambrus &lt;ambrus [...] math.bme.hu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Nov 21, 2011 at 1:28 PM, xmltwig@gmail.com via RT
&lt;bug-XML-Twig@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When I tested HTML to XML conversion, a few years ago, I found that, at
&gt; least at the time, XML::LibXML did not deal very well with real-world
&gt; HTML, so I did not look further into it.
</div>
I have also looked a bit more at XML::LibXML.  I&#39;ve decided I&#39;ll
probably ignore it for now, and will use either HTML::Tree or
HTML::Tidy for HTML parsing.  I&#39;ve sent them a bug report about this
one bug I&#39;ve mentioned to you though:
&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=649189">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=649189</a></span>&#34; .  &#40;I won&#39;t
completely forget about libxml2 though.  If I ever want to do XML
mangling with perl not involved, I&#39;ll certainly check it out how good
their documentation is.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry it took me so long to answer, there seems to be even more problems
&gt; than I thought with HTML::TreeBuilder, and I am trying to fix them.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And dying when finding something invalid in the
&gt; HTML is quite the opposite of what I am looking for in an HTML parsing
&gt; module.
</div>
Apply the patch from
&#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=71805">https://rt.cpan.org/Public/Bug/Display.html?id=71805</a></span>&#34; first then.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is also the problem that HTML::Parser has not been updated for HTML5.
</div>
True, but XML::LibXML and HTML::Tidy has also not been updated.  One
tricky part of HTML5 parsing is that HTML::Parser would have to be
aware of the encoding of the document to know what data-* attribute
names are valid.

Ambrus
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;08:07:32&nbsp;2011</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71839] Wishlist: more control over parse_html &#40;using HTML::TreeBuilder&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Nov 2011 14:06:48 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 11/17/2011 10:22 PM, ambrus@math.bme.hu via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: XML-Twig
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71839">https://rt.cpan.org/Ticket/Display.html?id=71839</a></span>&gt;
&gt;
&gt; I was wondering if I could use XML::LibXML as a third HTML parser for
&gt; Twig.  I got this.
&gt;
&gt; $ perl -we &#39;use XML::LibXML; my $pa = XML::LibXML-&gt;new&#40;recover =&gt;  1&#41;;
&gt; my $tr = $pa-&gt;load_html&#40;string =&gt;  &#34;&lt;.m/&gt;&#34;&#41;; my $xm = $tr-&gt;toString&#40;0&#41;;
&gt; print $xm, &#34;\n&#34;;&#39;
&gt; HTML parser error : Tag .m invalid
&gt; &lt;.m/&gt;
&gt;     ^
&gt; &lt;?xml version=&#34;1.0&#34; standalone=&#34;yes&#34;?&gt;
&gt; &lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD HTML 4.0 Transitional//EN&#34;
&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/REC-html40/loose.dtd">http://www.w3.org/TR/REC-html40/loose.dtd</a></span>&#34;&gt;
&gt; &lt;html&gt;&lt;body&gt;&lt;.m/&gt;&lt;/body&gt;&lt;/html&gt;
&gt;
&gt; $
&gt;
&gt; Turns out, XML::LibXML outputs an invalid element name, so I can&#39;t
&gt; parse the output as XML.  ARGH!
&gt;
&gt; I&#39;ve got deja vu: I just fixed a similar error with HTML::Tree and
&gt; invalid attribute names
&gt; &#40;&#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=71805">https://rt.cpan.org/Public/Bug/Display.html?id=71805</a></span>&#34;&#41;.  But in this
&gt; case, the bug is likely inside C code, so I can&#39;t fix it so easily.
&gt;
&gt; I wonder, how can one work this around?
</div>
Sorry it took me so long to answer, there seems to be even more problems 
than I thought with HTML::TreeBuilder, and I am trying to fix them.

When I tested HTML to XML conversion, a few years ago, I found that, at 
least at the time, XML::LibXML did not deal very well with real-world 
HTML, so I did not look further into it.

I am aware of the problems with HTML::TreeBuilder conversion to XHTML. 
Generally speaking, as_XML does not seem to be the most developed 
feature of the module. And dying when finding something invalid in the 
HTML is quite the opposite of what I am looking for in an HTML parsing 
module.

There is also the problem that HTML::Parser has not been updated for HTML5.

-- 
mirod
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
