<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #66292 for DBIx-ProcedureCall: Add support for DBD::ODBC</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #66292 for DBIx-ProcedureCall: Add support for DBD::ODBC</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-ProcedureCall/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-ProcedureCall/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-ProcedureCall/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-ProcedureCall/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-ProcedureCall">DBIx-ProcedureCall CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">66292</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-ProcedureCall/Active/">DBIx-ProcedureCall</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">thilo [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bohica [...] ntlworld.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-10646-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10647-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;01&nbsp;10:29:51&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add support for DBD::ODBC</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Thilo,

I&#39;d like to add support for DBD::ODBC to DBIx::ProcedureCall however,
the current way you identify the module to load to provide database
specific support uses get_info&#40;17&#41; = database name. ODBC is not a
database specific interface so database name could be &#34;Microsoft SQL
Server&#34;, &#34;Microsoft Access&#34;, &#34;Oracle&#34;, &#34;MySQL&#34;, &#34;Postgres&#34; etc. I&#39;m not
going to write one for each database as ODBC provides a database
independent way of calling procedures.

I&#39;m suggesting changing the logic in DBIx::ProcedureCall so that if no
DBIx::ProcedureCall::XX can be found when get_info returns XX, it tries
again with $dbh-&gt;{Driver}-&gt;{Name} which will return ODBC. This would
allow me to provide an ODBC shim for DBIx::ProcedureCall.

The only problem is that if someone uses Oracle under DBD::ODBC your
get_info will still return Oracle which will load
DBIx::ProcedureCall::Oracle and then do the wrong thing for more complex
calls &#40;e.g., try and use ORA_RSET attribute for a cursor&#41;. I&#39;m not sure
this is a big issue as most people going to Oracle will use DBD::Oracle
and not DBD::ODBC but some mechanism of allowing someone to pick
database name or DBI driver name would work.

If you are happy with this I&#39;ll submit some patches for ODBC support but
it might be better if you address the addition to pick the module via
driver name after database name.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;01&nbsp;18:28:14&nbsp;2011</span>
    <span class="description">thilo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m suggesting changing the logic in DBIx::ProcedureCall so that if no
&gt; DBIx::ProcedureCall::XX can be found when get_info returns XX, it tries
&gt; again with $dbh-&gt;{Driver}-&gt;{Name} which will return ODBC. This would
&gt; allow me to provide an ODBC shim for DBIx::ProcedureCall.
&gt; 
&gt; The only problem is that if someone uses Oracle under DBD::ODBC your
&gt; get_info will still return Oracle which will load
&gt; DBIx::ProcedureCall::Oracle and then do the wrong thing 
</div>
How about ignoring get_info altogether and just looking at
$dbh-&gt;{Driver}-&gt;{Name}? If that works, you would be getting the ODBC
shim even if connecting to Oracle via ODBC. 
I&#39;m traveling right now, so cannot check, but do you know what the
Driver-&gt;Name is as returned by DBD::Oracle and DBD::Postgres?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;01&nbsp;18:28:14&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;01&nbsp;18:28:14&nbsp;2011</span>
    <span class="description">thilo [...] cpan.org -  Given to THILO</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;02&nbsp;04:39:25&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 01 18:28:14 2011, THILO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I&#39;m suggesting changing the logic in DBIx::ProcedureCall so that if no
&gt; &gt; DBIx::ProcedureCall::XX can be found when get_info returns XX, it tries
&gt; &gt; again with $dbh-&gt;{Driver}-&gt;{Name} which will return ODBC. This would
&gt; &gt; allow me to provide an ODBC shim for DBIx::ProcedureCall.
&gt; &gt; 
&gt; &gt; The only problem is that if someone uses Oracle under DBD::ODBC your
&gt; &gt; get_info will still return Oracle which will load
&gt; &gt; DBIx::ProcedureCall::Oracle and then do the wrong thing 
</div>&gt; 
&gt; How about ignoring get_info altogether and just looking at
&gt; $dbh-&gt;{Driver}-&gt;{Name}? If that works, you would be getting the ODBC
&gt; shim even if connecting to Oracle via ODBC. 
&gt; I&#39;m traveling right now, so cannot check, but do you know what the
&gt; Driver-&gt;Name is as returned by DBD::Oracle and DBD::Postgres?
</div>
You could get rid of the get_info and just use $dbh-&gt;{Driver}-&gt;{Name}
but the code I attach does not do that - it simply falls back on the
driver name if the get_info does not work. DBD::Pg reports &#34;Pg&#34; for the
driver name so the Postgres.pm would need renaming to Pg.pm.

BTW, I think the Postgres.pm was probably based on the Oracle.pm and the
__close looks wrong to me in that it references DBD::Oracle::ORA_RSET.
Some people won&#39;t even have DBD::Oracle.

I do not use Mercurial and most of the files are additions anyway so I
just tarred up the files I changed which are:

README - mention ODBC
ProcedureCall.pm - add {Driver}-&gt;{Name} logic

New files:

t/odbc.t - 
ProcedureCall/ODBC.pm

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.tgz</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;02&nbsp;10:20:19&nbsp;2011</span>
    <span class="description">thilo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You could get rid of the get_info and just use $dbh-&gt;{Driver}-&gt;{Name}
&gt; but the code I attach does not do that - it simply falls back on the
&gt; driver name if the get_info does not work.
</div>
I think I&#39;ll change the code to use just $dbh-&gt;{Driver}-&gt;{Name}.
That seems cleaner.
It also aligns the module names with the DBD names.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; DBD::Pg reports &#34;Pg&#34; for the
&gt; driver name so the Postgres.pm would need renaming to Pg.pm.
</div>
:-&#40;
Renaming the module should not be a problem, though...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BTW, I think the Postgres.pm was probably based on the Oracle.pm and the
&gt; __close looks wrong to me in that it references DBD::Oracle::ORA_RSET.
&gt; Some people won&#39;t even have DBD::Oracle.
</div>
That does look like a bug.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I do not use Mercurial and most of the files are additions anyway so I
&gt; just tarred up the files I changed 
</div>
Thanks for the contribution.
I committed the patches into a new branch &#34;odbc&#34; and will merge it into
the next release. 
Is this urgent for you? I&#39;d like to set up an ODBC test environment on
my machine as well first.

<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/thiloplanz/dbix-procedurecall/changeset/83a713ea4fe9">https://bitbucket.org/thiloplanz/dbix-procedurecall/changeset/83a713ea4fe9</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;02&nbsp;10:51:38&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 02 10:20:19 2011, THILO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; You could get rid of the get_info and just use $dbh-&gt;{Driver}-&gt;
</div></div>{Name}
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; but the code I attach does not do that - it simply falls back on the
&gt; &gt; driver name if the get_info does not work.
</div>&gt; 
&gt; I think I&#39;ll change the code to use just $dbh-&gt;{Driver}-&gt;{Name}.
&gt; That seems cleaner.
&gt; It also aligns the module names with the DBD names.
</div>
Fair enough - I just didn&#39;t want to step on your toes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; DBD::Pg reports &#34;Pg&#34; for the
&gt; &gt; driver name so the Postgres.pm would need renaming to Pg.pm.
</div>&gt; 
&gt; :-&#40;
&gt; Renaming the module should not be a problem, though...
&gt; 
<div class="message-stanza open">&gt; &gt; BTW, I think the Postgres.pm was probably based on the Oracle.pm and 
</div></div>the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; __close looks wrong to me in that it references 
</div></div>DBD::Oracle::ORA_RSET.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Some people won&#39;t even have DBD::Oracle.
</div>&gt; 
&gt; That does look like a bug.
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; I do not use Mercurial and most of the files are additions anyway so 
</div></div>I
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; just tarred up the files I changed 
</div>&gt; 
&gt; Thanks for the contribution.
&gt; I committed the patches into a new branch &#34;odbc&#34; and will merge it 
</div>into
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the next release. 
&gt; Is this urgent for you? I&#39;d like to set up an ODBC test environment on
&gt; my machine as well first.
</div>
No, it is not urgent at all. To be honest, I was really using it with 
DBD::Oracle but as I maintain DBD::ODBC I thought it would be nice to 
add ODBC support.

To set up ODBC I&#39;d get unixODBC &#40;dev and bin packages, or build it 
yourself&#41;. The odbc.t is only testing to MS SQL Server which people 
mostly use freeTDS to access from non-Windows platforms. I didn&#39;t use 
freeTDS as my company writes its own MS SQL Server ODBC Driver.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/thiloplanz/dbix-">https://bitbucket.org/thiloplanz/dbix-</a></span>
</div>procedurecall/changeset/83a713ea4fe9

There are two issues which I forgot to document in the ODBC.pm:

1. you should not call a procedure which issues a select right now as 
this adds the result-set to the statement handle the procedure was 
called on and DBIx::ProcedureCall has no way currently of returning it - 
as far as I could see.

If someone was to use :fetch I could code it to fetch the result on the 
sth the procedure was run on but another problem is that a procedure can 
contain multiple selects.

2. output parameters are not available from most ODBC drivers until the 
procedure has finished and you usually have to call SQLMoreResults 
repeatedly until it returns SQL_NO_MORE_DATA. This should not really 
matter so long as you don&#39;t do &#40;1&#41;.

I may send you an amended ODBC.pm for this.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;02&nbsp;11:13:50&nbsp;2011</span>
    <span class="description">thilo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; BTW, I think the Postgres.pm was probably based on the Oracle.pm and 
</div></div>&gt; the
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; __close looks wrong to me in that it references 
</div></div>&gt; DBD::Oracle::ORA_RSET.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Some people won&#39;t even have DBD::Oracle.
</div>&gt; &gt; 
&gt; &gt; That does look like a bug.
</div></div>
This is &#40;un&#41;dead code, it should never be called &#40;and it would always fail&#41;.
__close is used to close a refcursor &#40;:cursor&#41;, which does not work with
Postgresql anyway &#40;they only have :table, and :fetch is built on top of
table functions as well&#41;.
I&#39;ll delete __close.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There are two issues which I forgot to document in the ODBC.pm:
</div>
Yeah, it seems the way result sets are returned from the procedure is
quite different from how Oracle does it.

It would be nice if we could come up with a good spec for making
:fetch work in a meaningful way.

I&#39;ll read up on ODBC...

What can you return from a stored procedure ?
  - a return value &#40;for a function&#41;
  - OUT parameters
  - one or more &#40;!&#41; result sets
  - potentially all of the above at the same time

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 1. you should not call a procedure which issues a select right now as 
&gt; this adds the result-set to the statement handle the procedure was 
&gt; called on and DBIx::ProcedureCall has no way currently of returning it - 
&gt; as far as I could see.
&gt; 
&gt; If someone was to use :fetch I could code it to fetch the result on the 
&gt; sth the procedure was run on but another problem is that a procedure can 
&gt; contain multiple selects.
</div>
The preferred interface would be to offer :fetch for everything that
returns a single result set.
Returning the :fetch&#39;d result set in addition to another return value of
a procedure seems tricky, as do multiple result sets &#40;for this we may
need a :multi_fetch or :fetch[[[]]]&#41;. OUT parameters
should work.

If for complex cases :fetch does not work well, there could be other
return strategies, just like we have :cursor for Oracle. In these modes,
ProcedureCall just passes the statement from DBI back to the application
and it has to figure out what to do with it. This is not the preferred
way, but for really complex procedure with multiple result sets and
return values it may be necessary. 

I&#39;d just want :fetch to work for &#34;normal&#34; cases.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;02&nbsp;11:51:58&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 02 11:13:50 2011, THILO wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; There are two issues which I forgot to document in the ODBC.pm:
</div>&gt; 
&gt; Yeah, it seems the way result sets are returned from the procedure is
&gt; quite different from how Oracle does it.
&gt; 
&gt; It would be nice if we could come up with a good spec for making
&gt; :fetch work in a meaningful way.
&gt; 
&gt; I&#39;ll read up on ODBC...
&gt; 
&gt; What can you return from a stored procedure ?
&gt;   - a return value &#40;for a function&#41;
</div>
there are no functions only procedures which return a value &#40;your 
definition of a function&#41; and procedures which don&#39;t return a value.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   - OUT parameters
</div>
yes

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   - one or more &#40;!&#41; result sets
</div>
oh yes. It works like this:

create procedure fred @outval integer OUT as
begin
set @outval = 2;
select a from table_a;
select b,c from table_b;
end

$s = $h-&gt;prepare&#40;q/{call fred&#40;?&#41;}/&#41;;
$s-&gt;bind_param_inout&#40;1, \my $out, 100;
$s-&gt;execute;
# $out out param not set yet
  do {
     my $rs = $sth-&gt;fetchall_arrayref
     # do stuff here with $rs
  } while &#40;$sth-&gt;{odbc_more_results}&#41;;
# $out out param should be ok now

The procedure can also contain inserts/updates/deletes but DBD::ODBC 
skips those in odbc_more_results when it spots there are no resultant 
columns.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   - potentially all of the above at the same time
</div>
yes
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; 1. you should not call a procedure which issues a select right now 
</div></div>as 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; this adds the result-set to the statement handle the procedure was 
&gt; &gt; called on and DBIx::ProcedureCall has no way currently of returning 
</div></div>it - 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; as far as I could see.
&gt; &gt; 
&gt; &gt; If someone was to use :fetch I could code it to fetch the result on 
</div></div>the 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; sth the procedure was run on but another problem is that a procedure 
</div></div>can 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; contain multiple selects.
</div>&gt; 
&gt; The preferred interface would be to offer :fetch for everything that
&gt; returns a single result set.
</div>
You don&#39;t know there is a single result-set.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Returning the :fetch&#39;d result set in addition to another return value 
</div>of
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a procedure seems tricky, as do multiple result sets &#40;for this we may
&gt; need a :multi_fetch or :fetch[[[]]]&#41;. OUT parameters
&gt; should work.
</div>
Multiple result-sets could be catered with:

while &#40;my $rs = myproc:fetch&#40;args&#41;;
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If for complex cases :fetch does not work well, there could be other
&gt; return strategies, just like we have :cursor for Oracle. In these 
</div>modes,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ProcedureCall just passes the statement from DBI back to the 
</div>application
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and it has to figure out what to do with it. This is not the preferred
&gt; way, but for really complex procedure with multiple result sets and
&gt; return values it may be necessary. 
</div>
Personally, I think &#34;cursor&#34; in Oracle is closer to how ODBC does it 
except instead of returning a NEW cursor you actually get the same sth 
the procedure was called on/

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I&#39;d just want :fetch to work for &#34;normal&#34; cases.
</div>
ok but I&#39;m not sure what a normal case is.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;02&nbsp;18:41:48&nbsp;2011</span>
    <span class="description">thilo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; there are no functions only procedures which return a value &#40;your 
&gt; definition of a function&#41; and procedures which don&#39;t return a value.
</div>
Is that a different mechanism from OUT parameters?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The preferred interface would be to offer :fetch for everything that
&gt; &gt; returns a single result set.
</div>&gt; 
&gt; You don&#39;t know there is a single result-set.
</div>
Why not?
If the procedure has a single select it will always return a single
result set, no?
The whole point of these :annotations is to give ProcedureCall some
extra information &#40;that cannot be determined by the module, but that the
user knows&#41; about how to handle the function.

If you specify nothing, it will have to do some default behaviour
&#40;maybe just support OUT parameters&#41;, but for the sample you gave with
the two result sets, I think I&#39;d like to use say :fetch[[[]]]
to get an array with two results, each of them an array of rows.

For really complex cases &#40;or large data that needs to be streamed&#41;,
we&#39;d have to return the statement handle directly and leave it to the
application to handle it.

Maybe call it :handle

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I&#39;d just want :fetch to work for &#34;normal&#34; cases.
</div>&gt; 
&gt; ok but I&#39;m not sure what a normal case is.
</div>
Naive definition of normal: a procedure that contains a single select
and returns a single result set &#40;of reasonably small size&#41;. For those,
the same :fetch we have now should work well. Plus OUT parameters.

Extended &#34;normal&#34; case &#40;needs some new :fetch types&#41;: Returns multiple
result sets, which can be turned into array-of-fetches.

For those cases, it should not be necessary for application code to
touch the statement handle.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;03&nbsp;05:02:34&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 02 18:41:48 2011, THILO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; there are no functions only procedures which return a value &#40;your 
&gt; &gt; definition of a function&#41; and procedures which don&#39;t return a value.
</div>&gt; 
&gt; Is that a different mechanism from OUT parameters?
</div>
no.

{? call myproc&#40;?&#41;}

bind_param_inout&#40;1, \my $procreturn&#41;;
bind_param_inout&#40;1, \my $outparam&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; The preferred interface would be to offer :fetch for everything 
</div></div>that
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; returns a single result set.
</div>&gt; &gt; 
&gt; &gt; You don&#39;t know there is a single result-set.
</div>&gt; 
&gt; Why not?
&gt; If the procedure has a single select it will always return a single
&gt; result set, no?
</div>
What I meant was you cannot examine the procedure via ODBC to know 
whether you are going to 0 or more result-sets.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The whole point of these :annotations is to give ProcedureCall some
&gt; extra information &#40;that cannot be determined by the module, but that 
</div>the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; user knows&#41; about how to handle the function.
</div>
In that case, that is fine - if a user know it returns N result-sets. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you specify nothing, it will have to do some default behaviour
&gt; &#40;maybe just support OUT parameters&#41;, but for the sample you gave with
&gt; the two result sets, I think I&#39;d like to use say :fetch[[[]]]
&gt; to get an array with two results, each of them an array of rows.
</div>
You could do that but you&#39;ll have to change
DBIx::ProcedureCall::DRIVER to return the prepared/executed sth and 
DBIx::ProcedureCall::__fetch and the callers to pass the original sth 
instead of the thing you get back as the function return value as the 
&#34;fetch&#34; at the moment seems to use the function return value.

Also DBIx::ProcedureCall::__run_procedure would need changing to support 
fetch as a procedure which does not return a value &#40;as in a function&#41; 
can still produce result-sets.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For really complex cases &#40;or large data that needs to be streamed&#41;,
&gt; we&#39;d have to return the statement handle directly and leave it to the
&gt; application to handle it.
</div>
yup
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe call it :handle
</div>
ok
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; I&#39;d just want :fetch to work for &#34;normal&#34; cases.
</div>&gt; &gt; 
&gt; &gt; ok but I&#39;m not sure what a normal case is.
</div>&gt; 
&gt; Naive definition of normal: a procedure that contains a single select
&gt; and returns a single result set &#40;of reasonably small size&#41;. For those,
&gt; the same :fetch we have now should work well. Plus OUT parameters.
</div>
with the alterations I outline above.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Extended &#34;normal&#34; case &#40;needs some new :fetch types&#41;: Returns multiple
&gt; result sets, which can be turned into array-of-fetches.
</div>
ok
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For those cases, it should not be necessary for application code to
&gt; touch the statement handle.
&gt; 
&gt; 
</div>
agreed.

Attached a new ODBC.pm and ProcedureCall.pm hacked &#40;and it is a hack 
simply to demonstrate&#41; to make a simple  single select in a procedure 
work &#40;it changes sub arguments so it will break Oracle.pm/Postgres.pm as 
it stands&#41;. Also I only tested it briefly using CLI which fails for 
procedure returning a result-set but not returning like a function 
because of:

        # any fetch implies function
        if &#40; grep /^fetch/,  keys %attr &#41; {
                $attr{&#39;function&#39;} = 1;
                $attr{&#39;fetch&#39;} = 1;
        }

in DBIx::ProcedureCall::run.

Also, to properly support output parameters in procedures that may 
return result-sets the ODBC.pm would need to repeatedly call 
odbc_more_results. I didn&#39;t do anything about this because it depends on 
whether you are fetching or not and fetching from a procedure cannot 
happen right now.

create procedure drop_me_4 @ival int as
select @ival;

perl   -Iblib/lib -Iblib/arch -MDBIx::ProcedureCall::CLI -e &#39;function&#39; 
&#39;drop_me_4:fetch[[]]&#39; 1
executed function &#39;drop_me_4:fetch[[]]&#39;. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">------ result -----------
$VAR1 = [
          [
            &#39;1&#39;
          ]
        ];
1 rows returned 
------------------------

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ODBC.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># Shamelessly copied from DBIx::ProcedureCall::Oracle and then support
# for named parameters, boolean and cursors removed.
package DBIx::ProcedureCall::ODBC;

use strict;
use warnings;

use Carp qw&#40;croak&#41;;

our $VERSION = &#39;0.10&#39;;

our $ORA22905;

sub __run_procedure{
	shift;
	my $dbh = shift;
	my $name = shift;
	my $attr = shift;
	my $params;

	# if there is one more arg and it is a hashref, then we use named parameters
	if &#40;@_ == 1 and ref $_[0] eq &#39;HASH&#39;&#41; {
        croak&#40;__PACKAGE__ . &#34; does not support named parameters&#34;&#41;;
	}
	# otherwise they are positional parameters
	my $sql = &#34;{call $name&#34;;
	if &#40;@_&#41;{
        $sql .= &#39;&#40;&#39; . join &#40;&#39;,&#39; , map &#40;{ &#39;?&#39;} @_  &#41;&#41; . &#39;&#41;&#39;;
	}
	$sql .= &#39;}&#39;;
	# prepare
	$sql = $attr-&gt;{cached} ? $dbh-&gt;prepare_cached&#40;$sql&#41;
		: $dbh-&gt;prepare&#40;$sql&#41;;
	# bind
	DBIx::ProcedureCall::__bind_params&#40;$sql, 1, \@_&#41;;
	# execute
	$sql-&gt;execute;
}

sub __run_function{
	shift;
	my $dbh = shift;
	my $name = shift;
	my $attr = shift;
	my $params;

#####	# any fetch implies cursor &#40;unless it is a table function&#41;
#####	if &#40;$attr-&gt;{&#39;fetch&#39;}&#41; {
#####        croak&#40;__PACKAGE__ . &#39; does not support the returning of a cursor&#39;&#41;;
#####	}
	# if there is one more arg and it is a hashref , then we use with named parameters
	if &#40;@_ == 1 and ref $_[0] eq &#39;HASH&#39;&#41; {
        croak&#40;__PACKAGE__ . &#34; does not support named parameters&#34;&#41;;
	}
	# otherwise they are positional parameters

	my $sql;

    $sql = &#34;{? = call $name&#34;;
    if &#40;@_&#41;{
        $sql .= &#39;&#40;&#39; . join &#40;&#39;,&#39; , map &#40;{ &#39;?&#39;} @_  &#41;&#41; . &#39;&#41;&#39;;
    }
    $sql .= &#39;}&#39;;

	# prepare
	$sql = $attr-&gt;{cached} ? $dbh-&gt;prepare_cached&#40;$sql&#41;
		: $dbh-&gt;prepare&#40;$sql&#41;;

	# bind
	my $i = 1;
	my $r;

    $sql-&gt;bind_param_inout&#40;$i++, \$r, 100&#41;;
    DBIx::ProcedureCall::__bind_params&#40;$sql, $i, \@_&#41;;

	$sql-&gt;execute;
	return &#40;$sql, $r&#41;;
}


sub __close{
	shift;
	my $sth = shift;
    # there is nothing to close as ODBC does not support returning cursors
    # like DBD::Oracle does
}



1;
__END__


=head1 NAME

DBIx::ProcedureCall::ODBC - ODBC driver for DBIx::ProcedureCall

=head1 DESCRIPTION

This is an internal module used by DBIx::ProcedureCall. You do not need
to access it directly. However, you should read the following
documentation, because it explains how to use DBIx::ProcedureCall
with ODBC databases.

=head2 Procedures and functions

DBIx::ProcedureCall needs to know if you are about to call a function
or a procedure &#40;because the SQL is different&#41;.  You have to make sure
you call the wrapper subroutines in the right context &#40;or you can
optionally declare the correct type, see below&#41;

You have to call procedures in void context.

	# works
	dbms_random_initialize&#40;$conn, 12345&#41;;
	# fails
	print dbms_random_initialize&#40;$conn, 12345&#41;;

You have to call functions in non-void context.

	# works
	print sysdate&#40;$conn&#41;;
	# fails
	sysdate&#40;$conn&#41;;

If you try to call a function as a procedure, you will get
a database error.

If you do not want to rely on this mechanism, you can
declare the correct type using the attributes :procedure
and :function:

	use DBIx::ProcedureCall qw[
		sysdate:function
		dbms_random.initialize:procedure
		];

If you use these attributes, the calling context will be
ignored and the call will be dispatched according to
your declaration.

NOTE: in ODBC there are no functions as such. Everything is a procedure
but some procedures return a value and others do not. You should class
ODBC procedures which return a value as &#34;functions&#34; in DBIx::ProcedureCall
and ODBC procedures which do not return a value as &#34;procedures&#34;.

=head2 Returning result sets

This package does not support returning result-sets like DBD::Oracle
does with a reference cursor.

=head2 Named Parameters

This package does not support named parameters.

=head1 SEE ALSO

L&lt;DBIx::ProcedureCall&gt; for information about this module that is not
ODBC-specific.

L&lt;DBD::ODBC&gt;

=head1 AUTHOR

Martin J Evans, E&lt;lt&gt;mjevans@cpan.orgE&lt;gt&gt;

=head1 COPYRIGHT AND LICENSE

Copyright 2011 by Martin J. Evans

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.

=cut


</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ProcedureCall.pm</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;10:16:15&nbsp;2011</span>
    <span class="description">thilo [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
