<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #41618 for CPANPLUS-Dist-Gentoo: Build Dependancies can become Unresolvable due to Name Confusion</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #41618 for CPANPLUS-Dist-Gentoo: Build Dependancies can become Unresolvable due to Name Confusion</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CPANPLUS-Dist-Gentoo/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CPANPLUS-Dist-Gentoo/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CPANPLUS-Dist-Gentoo/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CPANPLUS-Dist-Gentoo/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CPANPLUS-Dist-Gentoo">CPANPLUS-Dist-Gentoo CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">41618</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CPANPLUS-Dist-Gentoo/Active/">CPANPLUS-Dist-Gentoo</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kentfredric [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-222232-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.04    </td>
  </tr>
  <tr id="CF-222233-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.05    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;10&nbsp;23:50:27&nbsp;2008</span>
    <span class="description">http://oid.fox.geek.nz/kent.fredric -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Build Dependancies can become Unresolvable due to Name Confusion</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was testing 0.04 by using it to generate its own ebuild, however, this
arose a sequential problem. 

1.  The Generated DEPENDS list is as follows, of which none exist: 
DEPEND=&#34;dev-lang/perl
|| &#40; perl-core/CPANPLUS dev-perl/CPANPLUS perl-gcpan/CPANPLUS
perl-gcpanp/CPANPLUS &#41;
|| &#40; perl-core/File-Path dev-perl/File-Path perl-gcpan/File-Path
perl-gcpanp/File-Path &#41;
|| &#40; perl-core/PathTools dev-perl/PathTools perl-gcpan/PathTools
perl-gcpanp/PathTools &#41;
|| &#40; perl-core/IPC-Cmd dev-perl/IPC-Cmd perl-gcpan/IPC-Cmd
perl-gcpanp/IPC-Cmd &#41;&#34;

So Naturally, one decides to recursively generate the dependancies to
satisfy the condition. &#40; Its not needed for this ebuild directly,
because its already installing fine with only &#39;DEPEND=&#34;&#34;&#39;, but for other
ebuilds ? &#41; 

Now the first invocation to generate CPANPLUS  resulted in the following: 

[ERROR] 256 -- aborting

[ERROR] Error&#40;s&#41; in metadata for &#39;perl-gcpanp/CPANPLUS-0.84&#39;:
 &lt;snip&gt;
    invalid atom: &#39;&gt;=perl-core/IPC-Cmd-0.40_1&#39;

[ERROR] Unable to create a new distribution object for &#39;CPANPLUS&#39; --
cannot continue

Which is, as it says, invalid. 

Generating and installing IPC::Cmd, and then regenerating CPANPLUS, made
it emit a valid atom &#40; Without Installing, it continues to fail&#41;. 
&#40; I know its already in core, but this is still permitted behavior &#41; 

Eventually, following the dependency branch, you end up with this. &#40; Run
through s/_/ /g to make it readable &#41;

Key:
* Generated
** Generated, and all deps are already shown elsewhere on this graph
+ Available in Gentoo, not traversed
@ Available in overlay, not traversed
! Not Available, Cant be generated.
&#40;-&#41; cant be installed because of file collision with perl
&#40;+&#41; like -, but there exists a virtual to circumvent this &#40;
virtual/perl-Module-Name&#41;
&#40;!&#41; Cant be installed due to a problem in children


*&#40;!&#41;CPANPLUS-Dist-Gentoo:             
|-*&#40;!&#41;CPANPLUS:                       
|_|-*&#40;!&#41;Archive::Extract:              
|_|__|-*&#40;!&#41;File::Path:                 
|_|__|___|-!PathTools
|_|__|
|_|__|-!PathTools
|_|__|-*IPC::Cmd
|_|__|___|-+Locale::Maketext::Simple
|_|__|___|-*Module::Load::Conditional
|_|__|___|____|-+Locale::Maketext::Simple
|_|__|___|____|-*Module::Load
|_|__|___|____|_____|-+Test::Simple
|_|__|___|____|
|_|__|___|____|-*Params::Check
|_|__|___|____|_____|-+Locale::Maketext::Simple
|_|__|___|____|_____|-+Test::Simple
|_|__|___|____|
|_|__|___|____|-+Test::Simple
|_|__|___|____|-+version
|_|__|___|
|_|__|___|-**Params::Check
|_|__|___|-+Test::Simple
|_|__|
|_|__|-+Locale::Maketext::Simple
|_|__|-**Module::Load::Conditional
|_|__|-**Params::Check
|_|__|-+Test::Simple
|_|
|_|-+Archive::Tar
|_|-+Digest::MD5
|_|-*&#40;!&#41;File::Fetch
|_|__|-**&#40;!&#41;File::Path
|_|__|-!PathTools
|_|__|-**IPC::Cmd
|_|__|-+Locale::Maketext::Simple
|_|__|-**Module::Load::Conditional
|_|__|-**Params::Check
|_|__|-+Test::Simple
|_|
|_|-+IO::Zlib
|_|-**IPC::Cmd
|_|-+Locale::Maketext::Simple
|_|-*&#40;!&#41;Log::Message
|_|__|-!PathTools
|_|__|-+Locale::Maketext::Simple
|_|__|-**Module::Load
|_|__|-**Params::Check
|_|__|-+Test::Simple
|_|
|_|-@&#40;+&#41;Module::CoreList
|_|-**Module::Load
|_|-**Module::Load::Conditional
|_|-*Module::Loaded
|_|__|-+Test::Simple
|_|
|_|_+Module::Signature
|_|-*Object::Accessor
|_|__|-**Params::Check
|_|__|-+Test::Simple
|_|
|_|-+Package-Constants
|_|-**Params::Check
|_|-+Storable
|_|-*&#40;!&#41;Term::UI
|_|__|-+Locale::Maketext::Simple
|_|__|-*&#40;!&#41;Log::Message::Simple
|_|__|___|-**&#40;!&#41;Log::Message
|_|__|
|_|__|-**Params::Check
|_|__|-+Test::Simple
|_|
|_|-+Test::Harness
|_|-+Test::Simple
|_|-+version
|
|-**&#40;!&#41;File::Path
|-!PathTools
|-**IPC::Cmd


The problem here is mostly PathTools is not a module name,
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~smueller/PathTools-3.29/">http://search.cpan.org/~smueller/PathTools-3.29/</a></span>

And that cpan2dist refuses to fetch PathTools as-is

[MSG] Checking if source files are up to date
[MSG] Retrieving /root/.cpanplus/sourcefiles.2.18.stored
[MSG] No &#39;/root/.cpanplus/custom-sources&#39; dir, skipping custom sources
[ERROR] &#39;PathTools&#39; does not contain an author part

[ERROR] Cannot find &#39;PathTools&#39; in the module tree

And, that when given a link to the actual file:
ie, cpan2dist $params
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/CPAN/authors/id/S/SM/SMUELLER/PathTools-3.29.tar.gz">http://search.cpan.org/CPAN/authors/id/S/SM/SMUELLER/PathTools-3.29.tar.gz</a></span>
It behaves as it should, downloads the file, and makes an ebuild.
However, its the wrong ebuild.

It for some reason creates perl-gcpan/File-Spec-3.29.ebuild, which makes
reasonable sense, and is already in portage,
and I&#39;m guessing this is not the only package that behaves this way.

SUMMARY OF MY ERATIC RANTINGS:

1&#41; When forcefully generating PathTools &#40; somehow &#41;, it should have some
way of emitting a properly named ebuild.
2&#41; Alternatively, there should be some way to create correct DEPENDS
strings that depend on the right modules. Granted this is looking to be
like a dark art because there&#39;s a great degree of inconsistency at
present how gentoo deals with bundle/distribution/modules. &#40; Its getting
better, but not perfect &#41;

Other Things that cropped up in diagnosis of this problem:
1&#41; There should be a way to depend on virtuals, if present, here&#39;s the
present list in the main line:
virtual/perl-Archive-Tar
virtual/perl-CGI
virtual/perl-Class-ISA
virtual/perl-Compress-Raw-Zlib
virtual/perl-Compress-Zlib
virtual/perl-DB_File
virtual/perl-Digest-MD5
virtual/perl-Digest-SHA
virtual/perl-ExtUtils-CBuilder
virtual/perl-ExtUtils-ParseXS
virtual/perl-File-Spec
virtual/perl-File-Temp
virtual/perl-Getopt-Long
virtual/perl-IO
virtual/perl-IO-Compress-Base
virtual/perl-IO-Compress-Zlib
virtual/perl-IO-Zlib
virtual/perl-Locale-Maketext-Simple
virtual/perl-MIME-Base64
virtual/perl-Math-BigInt
virtual/perl-Math-BigInt-FastCalc
virtual/perl-Memoize
virtual/perl-Module-Build
virtual/perl-Module-Pluggable
virtual/perl-Pod-Escapes
virtual/perl-Pod-Simple
virtual/perl-PodParser
virtual/perl-Safe
virtual/perl-Scalar-List-Utils
virtual/perl-Storable
virtual/perl-Sys-Syslog
virtual/perl-Term-ANSIColor
virtual/perl-Test
virtual/perl-Test-Harness
virtual/perl-Test-Simple
virtual/perl-Text-Balanced
virtual/perl-Time-HiRes
virtual/perl-Time-Local
virtual/perl-Time-Piece
virtual/perl-digest-base
virtual/perl-libnet
virtual/perl-locale-maketext
virtual/perl-net-ping
virtual/perl-version

These are file-less meta-packages, which are generally used to handle
the &#34;did this module suddenly move to core&#34; scenarios.

2&#41; There appears to be a bit of dependency leak, stuff directly
depending on stuff that it doesn&#39;t need to depend on directly because
its children do that for it. I can&#39;t tell if this is for certain
however, its likely to be upstreams fault.


SOLUTIONS?

The most simple way to solve most of this problem, IMO, would be a
mapping file of some sort, that is consulted as an override.

A Config structure like this that could be loaded from a file and eval&#39;d
should likely cover most uses. 

my $config = {
    PathTools =&gt; [

        #
        [ 0.0, 3.20, &#39;&gt;=perl-core/File-Spec-%v&#39; ],

        #
        [ 3.20, 99.99, &#39;&gt;=dev-lang/perl-5.10&#39; ]
    ],
    &#39;Module::CoreList&#39; =&gt; [

        #
        [ 0.0, 99.99, &#39;virtual/perl-Module-CoreList&#39; ],
    ],
    &#39;Foo::Bar&#39; =&gt; &#34;perl-gcpanp/pants&#34;
};
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;12&nbsp;09:06:25&nbsp;2008</span>
    <span class="description">vpit [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi.

First, I&#39;m truly impressed by the length of this report. Kudos!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem here is mostly PathTools is not a module name,
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~smueller/PathTools-3.29/">http://search.cpan.org/~smueller/PathTools-3.29/</a></span>
</div>
Well, actually the problem is that in portage the relevant package is
named File-Spec, when it should really be PathTools. It makes more sense
to name the ebuilds from the distribution than from the module, since a
dist may bundle several modules &#40;and in our case PathTools contains Cwd
too&#41;, but since it&#39;s its name, so be it.

That&#39;s why there was from the beginning a list of &#34;gentooisms&#34; in the
code that map the Perl distribution names to their portage counterpart
&#40;when they differ&#41;. But I didn&#39;t use this list at the proper place, and
it had no impact on the generated ebuilds - hence the bug. This should
be fixed in git &#40;see
<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl/modules/CPANPLUS-Dist-Gentoo.git&#41;">http://git.profvince.com/?p=perl/modules/CPANPLUS-Dist-Gentoo.git&#41;</a></span>.

Ideally, this list should be amendable by the end-user through some
configuration file.

This should answer the two first issues of your summary.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1&#41; There should be a way to depend on virtuals, if present, here&#39;s the
&gt; present list in the main line:
&gt;
&gt; [...]
&gt; 
&gt; These are file-less meta-packages, which are generally used to handle
&gt; the &#34;did this module suddenly move to core&#34; scenarios.
</div>
I think the current solution I use should cover those cases, as it lists
all the possible categories in which the package could be located
&#40;perl-core, dev-perl, perl-gcpan, perl-gcpanp&#41; - whether the relevant
atoms really exist or not - and let emerge DTRT when its time comes.
It&#39;s a little crude, but it saves me from trying to search into the
portage tree for the real current name, which as you say could break
ebuilds when packages move from one category from another. I agree that
could be saved for packages that have a virtual, but it would still be
needed for those which haven&#39;t.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; There appears to be a bit of dependency leak, stuff directly
&gt; depending on stuff that it doesn&#39;t need to depend on directly because
&gt; its children do that for it. I can&#39;t tell if this is for certain
&gt; however, its likely to be upstreams fault.
</div>
If dist A depends on B v1, and C depends on A and on B v2, we need to
explictely state the B dependency in both A and C. That&#39;s why every
dependency advertised by the dist will result in a dependency in the
ebuilds, and only those. If you have examples where perl and portage
deps differ, I&#39;d be happy to investigate a fix.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; SOLUTIONS?
&gt; 
&gt; The most simple way to solve most of this problem, IMO, would be a
&gt; mapping file of some sort, that is consulted as an override.
&gt; 
&gt; A Config structure like this that could be loaded from a file and eval&#39;d
&gt; should likely cover most uses. 
&gt; 
&gt; my $config = {
&gt;     PathTools =&gt; [
&gt; 
&gt;         #
&gt;         [ 0.0, 3.20, &#39;&gt;=perl-core/File-Spec-%v&#39; ],
&gt; 
&gt;         #
&gt;         [ 3.20, 99.99, &#39;&gt;=dev-lang/perl-5.10&#39; ]
</div>
This ain&#39;t right, because PathTools modules &#40;File::Spec and Cwd&#41; are
dual-lived, which means that although they are bundled with perl,
updates may be released through CPAN. And other modules may righteously
depend on versions greater than the one installed with perl, so we
should always explicitely depend on File-Spec.

I know I often employ brute-force strategies, but I&#39;d like to first have
something that works before trying to be smart. I think g-cpan is sort
of borked because it tried too hard at this. I hope this doesn&#39;t
disappoint you. :&#41;

Many thanks again,

Vincent.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;12&nbsp;09:06:26&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;13&nbsp;00:45:45&nbsp;2008</span>
    <span class="description">kentfredric [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kentfredric [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 12 09:06:25 2008, VPIT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, actually the problem is that in portage the relevant package is
&gt; named File-Spec, when it should really be PathTools. It makes more
</div>sense to name the ebuilds from the distribution than from the module,
since a dist may bundle several modules &#40;and in our case PathTools
contains Cwd too&#41;, but since it&#39;s its name, so be it.

Sure, but the problem here is that, even tho gentoo already has
File-Spec, the cpan2dist + your extension combination tells me it does
not know what I am talking about when I ask it to create &#34;PathTools&#34;. 

The only way I could trick it into understanding was giving it the
absolute URI of the right Tar.Gz file, which it then downloaded,
unpacked, and then decided to ignore me and create File-Spec instead. 

So the problem is that the tool itself creates dependancies pointing to
PathTools, but it itself generates the PathTools dep wrongly. 


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think the current solution I use should cover those cases, as it lists
&gt; all the possible categories in which the package could be located
&gt; &#40;perl-core, dev-perl, perl-gcpan, perl-gcpanp&#41; - whether the relevant
&gt; atoms really exist or not - and let emerge DTRT when its time comes.
&gt; It&#39;s a little crude, but it saves me from trying to search into the
&gt; portage tree for the real current name, which as you say could break
&gt; ebuilds when packages move from one category from another. I agree that
&gt; could be saved for packages that have a virtual, but it would still be
&gt; needed for those which haven&#39;t.
</div>
There are extra fun things here when packages get moved into the primary
perl ebuild. For instance, for perls &lt; 5.8, depending on the
Module::Build was fine, but when perl 5.10 started hit the tree, the
perl ebuild now contained Module::Build in such a configuration that
Module::Build was no longer installable. 

I some cases, this is a combination of 2 packages sporting the same file
in the same location, in conjunction with the COLLISION_PROTECT mechanism. 

Likewise, After manually hacking all the ebuilds depends above to DTRT,
when I finally got to installing the CPANPLUS package i had generated,
it bombed on me, simply for the fact it attempts to install scripts in
/usr/bin which are already provided by the perl-5.10 ebuild.

Back to the Module::Build problem, an easy way to solve this problem  is
the creation of virtual/perl-Module-Build and migrating old packages to
this new virtual instead of the new, in essence, depending on
functionality, not specific files. When 5.10 finally hits gentoo I would
imagine either of these 2 structures occuring. 

1. This requires changing every package that ever used module::build. 

package-&gt; || &#40; 
----&gt;  virtual/perl-Module-Build 
---------------&gt; perl-core/Module-Build
----&gt;  &gt;=perl-5.10 
&#41;

or 2, simply stating that the virtualised functionality known as
Module-Build can be provided by 1 of 2 sources, which only needs one
file change. 

virtual/perl-Module-Build  ||&#40; &gt;=perl-5.10  perl-core/Module-Build &#41;

Obviously, this problem spurns from the integration of modules into the
perl core package, but with no system metadata explaining which modules
are provided by the core ebuild and which ones are accessories. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 2&#41; There appears to be a bit of dependency leak, stuff directly
&gt; &gt; depending on stuff that it doesn&#39;t need to depend on directly because
&gt; &gt; its children do that for it. I can&#39;t tell if this is for certain
&gt; &gt; however, its likely to be upstreams fault.
</div>&gt; 
&gt; If dist A depends on B v1, and C depends on A and on B v2, we need to
&gt; explictely state the B dependency in both A and C. That&#39;s why every
&gt; dependency advertised by the dist will result in a dependency in the
&gt; ebuilds, and only those. If you have examples where perl and portage
&gt; deps differ, I&#39;d be happy to investigate a fix.
</div>
You don&#39;t need to propagate dependencies recursively, this done at
runtime by portage. 

Sure, If A *directly* uses B v1 and C directly uses B v2 and C depends
A, then and only then do you need to state this.

C
\--B1
\--A
___\--B2

However, this is a concept of direct dependencies, any given ebuild only
needs to specify the explicit set of ebuilds it directly uses, and rely
on its own dependencies to likewise keep track of themself. 

But Noted, this doesn&#39;t appear to be actually a problem, I looked
through the source of many items and they do appear to be actually
directly using the different dependencies as shown in the above graph,
Its just a bit weird for me as this model doesn&#39;t appear &#34;normal&#34; in
some other situations. 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; SOLUTIONS?
&gt; &gt; 
&gt; &gt; The most simple way to solve most of this problem, IMO, would be a
&gt; &gt; mapping file of some sort, that is consulted as an override.
&gt; &gt; 
&gt; &gt; A Config structure like this that could be loaded from a file and eval&#39;d
&gt; &gt; should likely cover most uses. 
&gt; &gt; 
&gt; &gt; my $config = {
&gt; &gt;     PathTools =&gt; [
&gt; &gt; 
&gt; &gt;         #
&gt; &gt;         [ 0.0, 3.20, &#39;&gt;=perl-core/File-Spec-%v&#39; ],
&gt; &gt; 
&gt; &gt;         #
&gt; &gt;         [ 3.20, 99.99, &#39;&gt;=dev-lang/perl-5.10&#39; ]
</div>&gt; 
&gt; This ain&#39;t right, because PathTools modules &#40;File::Spec and Cwd&#41; are
&gt; dual-lived, which means that although they are bundled with perl,
&gt; updates may be released through CPAN. And other modules may righteously
&gt; depend on versions greater than the one installed with perl, so we
&gt; should always explicitely depend on File-Spec.
</div>
Yeah, this was not necessarily an actual valid version map, I just made
something Up on the fly for the point of an example. 

But being able to map modules directly to saying &#34;perl provides this&#34; is
somewhat necessary under gentoo, due to the aforementioned collision
safety mechanism. Its fine to have a dual-lifer with non-colliding
files, but when you have colliding files, it doesn&#39;t like it because it
loses the &#39;ebuild has known files&#39; association that guarantees a sane
system. &#40; /me remembers a case where a mysql build failed and tried to
replace /usr/bin/test with its test-suite, really nasty &#41; 


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I know I often employ brute-force strategies, but I&#39;d like to first have
&gt; something that works before trying to be smart. I think g-cpan is sort
&gt; of borked because it tried too hard at this. I hope this doesn&#39;t
&gt; disappoint you. :&#41;
</div>
g-cpan was good for some things, just sometimes it guessed wrong and
assumed stuff didn&#39;t exist when it did, and made gross assumptions about
where things were and how your system was configured &#40; very non-paludis
friendly &#41;. It worked ok with being given Distro&#39; names, which
cpan2dist&#39;s implementation just goes &#34;eh what? PathTools? there is no
associated author with that! die!&#34; 

Configuration may be harder for new users, but id rather tell it exactly
what to do, and take a while to do it, and have it work, then give it a
general idea, have it not work, and being without a sufficient
bludgeoning tool to force it to. 

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Many thanks again,
&gt; 
&gt; Vincent.
</div>
Thanks for the ever attentive response :&#41; 

Kent. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;14&nbsp;11:13:06&nbsp;2008</span>
    <span class="description">vpit [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sure, but the problem here is that, even tho gentoo already has
&gt; File-Spec, the cpan2dist + your extension combination tells me it does
&gt; not know what I am talking about when I ask it to create &#34;PathTools&#34;.
&gt; 
&gt; The only way I could trick it into understanding was giving it the
&gt; absolute URI of the right Tar.Gz file, which it then downloaded,
&gt; unpacked, and then decided to ignore me and create File-Spec instead. 
</div>
That&#39;s because distributions aren&#39;t indexed on CPAN, but modules are.
Any CPAN author can upload any distribution that contains any module,
but the modules are only indexed if the author is recognized as
authoritative. If you want to install by distribution name, you must
provide its fully qualified name, which includes the author and the
version &#40;e.g. SMUELLER/PathTools-3.29.tar.gz&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So the problem is that the tool itself creates dependancies pointing to
&gt; PathTools, but it itself generates the PathTools dep wrongly.
</div>
Creating ebuild dependencies to &#34;PathTools&#34; instead of &#34;File-Spec&#34; was
indeed a bug, which I fixed. I don&#39;t see how that&#39;s related with the way
CPAN handles distributions and modules.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There are extra fun things here when packages get moved into the primary
&gt; perl ebuild. For instance, for perls &lt; 5.8, depending on the
&gt; Module::Build was fine, but when perl 5.10 started hit the tree, the
&gt; perl ebuild now contained Module::Build in such a configuration that
&gt; Module::Build was no longer installable. 
&gt; 
&gt; I some cases, this is a combination of 2 packages sporting the same file
&gt; in the same location, in conjunction with the COLLISION_PROTECT
</div>mechanism. 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Likewise, After manually hacking all the ebuilds depends above to DTRT,
&gt; when I finally got to installing the CPANPLUS package i had generated,
&gt; it bombed on me, simply for the fact it attempts to install scripts in
&gt; /usr/bin which are already provided by the perl-5.10 ebuild.
</div>
Right, this can happen. But CPANPLUS &#40;and hence /usr/bin/cpanp&#41; is meant
to be able to be updated from CPAN. The main perl ebuild shouldn&#39;t hold
any authority on it.

So what should be the preferred way to handle this? In the current
state, it&#39;s possible to use the footer dist-option in those cases to
specialize the install target &#40;or whatever other trick&#41;. I&#39;m not sure if
that could reliably be automated.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Back to the Module::Build problem, an easy way to solve this problem  is
&gt; the creation of virtual/perl-Module-Build and migrating old packages to
&gt; this new virtual instead of the new, in essence, depending on
&gt; functionality, not specific files. When 5.10 finally hits gentoo I would
&gt; imagine either of these 2 structures occuring. 
&gt; 
&gt; 1. This requires changing every package that ever used module::build. 
&gt; 
&gt; package-&gt; || &#40; 
&gt; ----&gt;  virtual/perl-Module-Build 
&gt; ---------------&gt; perl-core/Module-Build
&gt; ----&gt;  &gt;=perl-5.10 
&gt; &#41;
&gt; 
&gt; or 2, simply stating that the virtualised functionality known as
&gt; Module-Build can be provided by 1 of 2 sources, which only needs one
&gt; file change. 
&gt; 
&gt; virtual/perl-Module-Build  ||&#40; &gt;=perl-5.10  perl-core/Module-Build &#41;
&gt; 
&gt; Obviously, this problem spurns from the integration of modules into the
&gt; perl core package, but with no system metadata explaining which modules
&gt; are provided by the core ebuild and which ones are accessories.
</div>
Isn&#39;t that exactly the role of the virtual to handle the &#34;is perl &gt;=
5.10&#34; discussion?

Would just depending on a virtual in this case &#40;instead of on a normal
dep&#41; be enough to solve this at my level?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You don&#39;t need to propagate dependencies recursively, this done at
&gt; runtime by portage. 
&gt; 
&gt; Sure, If A *directly* uses B v1 and C directly uses B v2 and C depends
&gt; A, then and only then do you need to state this.
&gt; 
&gt; C
&gt; \--B1
&gt; \--A
&gt; ___\--B2
&gt; 
&gt; However, this is a concept of direct dependencies, any given ebuild only
&gt; needs to specify the explicit set of ebuilds it directly uses, and rely
&gt; on its own dependencies to likewise keep track of themself. 
&gt; 
&gt; But Noted, this doesn&#39;t appear to be actually a problem, I looked
&gt; through the source of many items and they do appear to be actually
&gt; directly using the different dependencies as shown in the above graph,
&gt; Its just a bit weird for me as this model doesn&#39;t appear &#34;normal&#34; in
&gt; some other situations.
</div>
The generated ebuilds should exactly state the direct dependencies
listed by the module author. I can&#39;t do much besides this. I won&#39;t look
up in the ebuild dep tree to remove apparently redundant dependencies.
One little change and all the ebuilds would have to be rewritten.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; g-cpan was good for some things, just sometimes it guessed wrong and
&gt; assumed stuff didn&#39;t exist when it did, and made gross assumptions about
&gt; where things were and how your system was configured &#40; very non-paludis
&gt; friendly &#41;. It worked ok with being given Distro&#39; names, which
&gt; cpan2dist&#39;s implementation just goes &#34;eh what? PathTools? there is no
&gt; associated author with that! die!&#34;
</div>
And that&#39;s the sane thing to do. It&#39;s the way the cpan and cpanp
command-line tools handle it. The magic g-cpan uses to go around this is
deemed to break in many cases.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;14&nbsp;13:26:42&nbsp;2008</span>
    <span class="description">kentfredric [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kentfredric [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Dec 14 11:13:06 2008, VPIT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That&#39;s because distributions aren&#39;t indexed on CPAN, but modules are.
&gt; Any CPAN author can upload any distribution that contains any module,
&gt; but the modules are only indexed if the author is recognized as
&gt; authoritative. If you want to install by distribution name, you must
&gt; provide its fully qualified name, which includes the author and the
&gt; version &#40;e.g. SMUELLER/PathTools-3.29.tar.gz&#41;.
</div>
Ah.  I figured there was an easy way to somehow resolve whatever the
&#34;latest&#34; realse of a given distribution was resolved as.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Creating ebuild dependencies to &#34;PathTools&#34; instead of &#34;File-Spec&#34; was
&gt; indeed a bug, which I fixed. I don&#39;t see how that&#39;s related with the way
&gt; CPAN handles distributions and modules.
</div>
Cool. Not really related I guess then :&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Right, this can happen. But CPANPLUS &#40;and hence /usr/bin/cpanp&#41; is meant
&gt; to be able to be updated from CPAN. The main perl ebuild shouldn&#39;t hold
&gt; any authority on it.
&gt; 
&gt; So what should be the preferred way to handle this? In the current
&gt; state, it&#39;s possible to use the footer dist-option in those cases to
&gt; specialize the install target &#40;or whatever other trick&#41;. I&#39;m not sure if
&gt; that could reliably be automated.
</div>
The annoying thing is primarily how collision protect works. Its rather
naive and doesn&#39;t actually test package ownership of the files at
install time.
All it does is check the filesystem before the final copy phase for
files that might be replaced and then dies if those files exist and are
not owned by the previous version of the same package &#40;in the same slot
at that&#41;, in essence:

@collisions = &#40;&#41;;
for my $file &#40; @files_to_install &#41;{
  next if&#40; ! -f $file &#41;;
  next if&#40; grep { $_ == $file }, @previous_versions_files_same_slot &#41;;
  push @collsions , $file;
}
die sprintf&#40; &#34;cant merge, collisions: %s\n&#34;, join&#40;&#34;,\n&#34;, @collisions &#41;&#41;
 if @collisions;

Emerge generally spends a lot of time here reverse looking up which
package is recorded as creating that file&#40; if any &#41;
to help the user diagnose the problem &#40; its very resource intensive,
which is why its not used at runtime as the main rule &#41;.

For this reason, if any given module happened to be installed manually
by a user&#40;outside of portage&#41;, upon using an ebuild to
merge that same module collision protect would generally kick in and
tell the user there was a bunch of files that already existed
and ask them to solve the problem.

&#40; Its generally accepted 2 ebuilds in portage installing the exact same
file is an error/bug ,
and if its not resolvable, they mark blockers on the packages to stop it
trying back at the dependacy resolution phase. &#41;

Its generally gentoo being cautious and assuming the average install
application cant be relied upon to provide a complete &#40; and safe &#41;
deinstallation phase later, which leaves cruft and security risks lying
around, which is the whole reason I&#39;m more or less using ebuilds
instead of just directly installing into the filesystem with CPAN, I
like the atomicity of it all.

What I&#39;ve been doing for things at present that are problematic, or
provided by something else already in-system, is using the
--ignore / --ignorelist feature to progressively weed out problem
dependacies, but I don&#39;t feel justified using that as the solution
everywhere,
it just feels dirty making gross assumptions as to what is and what
isn&#39;t available. Granted its conceptually impossible at present to
just make this up at present automatically without epic develop overhead.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Isn&#39;t that exactly the role of the virtual to handle the &#34;is perl &gt;=
&gt; 5.10&#34; discussion?
&gt; 
&gt; Would just depending on a virtual in this case &#40;instead of on a normal
&gt; dep&#41; be enough to solve this at my level?
&gt; 
</div>
You could just add a virtual depend on every module line, but that would
be behaviourally limited, as it assumes things about the ability for
virtuals to solve the problem. Having seen the already exhaustive list
of search places, it can only go on so far before it becomes a problem &#40;
im really hoping its stopped growing if you did add virtuals, but can&#39;t
be certain. &#41;,  it might solve the problem in some cases, but in other
cases, there are situations where virtuals are needed but nobodys&#39;
created them yet.

To me, it would be more futuresafe to have a &#34;Do Instead&#34; file of sorts,
which can be used to add custom rules based on known patterns, sort of
like the gentoosims hash, just with enough flexibility to add more atom
parts, or multiple atom parts, and let the person using the script
decide which dependency trick works the best, and possibly provide a
sample substitution file with a list of &#34;common problems&#34; in it.

Also, The ordering of the rules however is somewhat important. For instance,

|| &#40; perl-core/Module-Build virtual/perl-Module-Build 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;=dev-lang/perl-5.10 &#41;
</div>
Is bad, &#40; I can&#39;t explain why right now :&#40; , its experiential, it
doesn&#39;t like it , you end up trying to pull Module-Build and having it
die on depend collision , It might be repository priority oriented, but
I haven&#39;t worked out the reason yet &#41;

|| &#40; virtual/perl-Module-Build perl-core/Module-Build &#41;

Is however much better, and a simple

virtual/perl-Module-Build

is better again, so if/when deciding how to implement a substition
system, making it flexible enough for the writers of substitutive rules
to create them in safe ways.

This solution saves you from having to fix the real problem, but makes
solving the problem on a case-by-case basis easy for users.

Hope this is of use,

--Kent. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;25&nbsp;19:33:30&nbsp;2009</span>
    <span class="description">vpit [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As I said on IRC, portage is no longer happy with DEPENDs that look like
&#34;|| &#40; cat1/foo ... cat$n/foo &#41;&#34; with any of the cat$x/foo not actually
existing in the portage tree.

This forced me to change the dependency logic to this : when generating
DEPEND for a dist, all the portage trees are scanned &#40;this means
PORTDIR, PORTDIR_OVERLAY, and the overlay passed to cpan2dist - in this
order&#41; for a corresponding package whose name may have been relinked
through the gentooisms &#40;and with a sufficient version if needed,
otherwise it searches further&#41; in the categories &#39;virtual&#39;, &#39;perl-core&#39;,
&#39;dev-perl&#39;, &#39;perl-gcpan&#39; and &#39;perl-gcpanp&#39; - in this order. I preferred
the old dynamic solution of letting portage sort out which package to
pull &#40;asserting that the perl-gcpanp was always present&#41;, but there was
no other solution.

As a result of this, the deps are now much cleaner, but also much more
sensible to category changes. An idea to overcome this would be to, when
an ebuild is regenerated and that the version didn&#39;t change, to parse
the old ebuild&#39;s deps and to compare them with the new ones - if they&#39;re
different, the new ebuild would be generated with a -r&#40;$n+1&#41; suffix.

About virtuals not doing what they are expected to do, I don&#39;t think
it&#39;s my job to do something about it. It&#39;s their role to assert that a
given dist is installed ; and if they fail at doing this, then the
problem should be addressed at their level. Adding up piles of
workarounds is always deemed to collapse. Same goes for dual-lifed
modules : the main perl ebuild has no reason to keep ownership on them,
and this should be fixed there.

Module::Build may indeed need some special handling, as CPANPLUS doesn&#39;t
add it to the dependency list. Problems may arise on fresh gentoo
systems where it&#39;s not installed yet.

There are a few other fixes beyond 0.05 that are ready into git. If you
have some spare time to test, I&#39;d be very happy to hear some feedback
from you or any other gentoo people.

Vincent.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;14&nbsp;06:53:59&nbsp;2009</span>
    <span class="description">vpit [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;14&nbsp;06:54:05&nbsp;2009</span>
    <span class="description">vpit [...] cpan.org -  Fixed in 0.05 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
