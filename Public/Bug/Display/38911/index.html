<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38911 for Image-ExifTool: Casio MakerNotes get damaged by exiftool</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38911 for Image-ExifTool: Casio MakerNotes get damaged by exiftool</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Image-ExifTool/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Image-ExifTool/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Image-ExifTool/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Image-ExifTool/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Image-ExifTool">Image-ExifTool CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38911</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">2.5 hours (150 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Image-ExifTool/Active/">Image-ExifTool</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">EXIFTOOL [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
es186 [...] fen-net.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16626-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16627-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
7.50    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;08:50:12&nbsp;2008</span>
    <span class="description">es186 [...] fen-net.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Casio MakerNotes get damaged by exiftool</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Sep 2008 14:49:39 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Image-ExifTool [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ronald &lt;es186 [...] fen-net.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

I tried to use exiftool to correct the time of some images and
noticed the following problem when trying to correct a wrong
correction:

$ exiftool  -AllDates+=&#39;0:0:1 23:58:18&#39; *.jpg
   12 image files updated

$ exiftool  -AllDates-=&#39;1:0:0 0:0:0&#39; *.jpg
Error: [minor] Bad MakerNotes directory pointer for FirmwareDate - zl_2008_001.jpg
Error: [minor] Bad MakerNotes directory pointer for FirmwareDate - zl_2008_002.jpg
[...]

    0 image files updated
   12 files weren&#39;t updated due to errors


I&#39;ve tried version 7.30 &#40;from Debian Unstable&#41; and 7.41.

Perl: This is perl, v5.10.0 built for i486-linux-gnu-thread-multi
OS: Linux defiant 2.6.25.5 #2 PREEMPT Mon Jun 9 18:35:40 CEST 2008 i686 GNU/Linux


Below is a diff of the data displayed before/after the first exiftool
command to correct the time/date.



Thanks for your &#40;nevertheless&#41; great Program!
                                           Ronald




$exiftool -all -s zl_2008_014.jpg_original &gt;before
$exiftool -all -s zl_2008_014.jpg &gt;after
$diff -u before after

--- before      2008-09-02 14:42:51.000000000 +0200
+++ after       2008-09-02 14:43:47.000000000 +0200
@@ -1,8 +1,8 @@
 ExifToolVersion                 : 7.30
-FileName                        : zl_2008_014.jpg_original
+FileName                        : zl_2008_014.jpg
 Directory                       : .
 FileSize                        : 4 MB
-FileModifyDate                  : 2008:08:14 11:41:16
+FileModifyDate                  : 2008:09:02 14:43:28
 FileType                        : JPEG
 MIMEType                        : image/jpeg
 ExifByteOrder                   : Big-endian &#40;Motorola, MM&#41;
@@ -13,14 +13,14 @@
 YResolution                     : 72
 ResolutionUnit                  : inches
 Software                        : 1.00
-ModifyDate                      : 2008:08:14 11:41:16
+ModifyDate                      : 2009:08:15 11:39:34
 YCbCrPositioning                : Centered
 ExposureTime                    : 1/10
 FNumber                         : 2.8
 ExposureProgram                 : Program AE
 ExifVersion                     : 0221
-DateTimeOriginal                : 2008:08:14 11:41:16
-CreateDate                      : 2008:08:14 11:41:16
+DateTimeOriginal                : 2009:08:15 11:39:34
+CreateDate                      : 2009:08:15 11:39:34
 ComponentsConfiguration         : YCbCr
 CompressedBitsPerPixel          : 5.005767013
 ExposureCompensation            : 0
@@ -31,18 +31,17 @@
 FocalLength                     : 7.9 mm
 PreviewImageSize                : 320x240
 PreviewImageLength              : 19744
-PreviewImageStart               : 6364
-FirmwareDate                    : 2006:02:13 10:42
+PreviewImageStart               : 9480
+Warning                         : Bad MakerNotes directory pointer for FirmwareDate
 WhiteBalanceBias                : 381 376
 WhiteBalance                    : Unknown &#40;17&#41;
-AFPointPosition                 : 50% 50%
 ObjectDistance                  : 0.133 m
 FlashDistance                   : 0
 RecordMode                      : Program AE
 SelfTimer                       : Off
 Quality                         : Fine
 FocusMode                       : Single-Area Auto Focus
-HometownCity                    : Berlin
+HometownCity                    : 0602
 BestShotMode                    : Off
 AutoISO                         : On
 ISO                             : 200
@@ -71,7 +70,7 @@
 OffsetSchema                    : 4102
 Padding                         : &#40;Binary data 2060 bytes, use -b option to extract&#41;
 Compression                     : JPEG &#40;old-style&#41;
-ThumbnailOffset                 : 26286
+ThumbnailOffset                 : 6542
 ThumbnailLength                 : 3447
 Subject                         : ZL_2008
 LastKeywordXMP                  : ZL_2008
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;09:26:25&nbsp;2008</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ronald,

Thanks for this bug report.

Do you have a copy of the original file that you could email me?  &#40;phil at owl.phy.queensu.ca&#41;

If not, do you know the Casio camera model?

        - Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;09:26:27&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;11:55:38&nbsp;2008</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the sample.

The problem is caused because the image has been edited with some other software that adds 
a padding block of 2060 bytes before the maker notes and fails to properly update the 
makernotes offsets for this change.  When reading this image, exiftool automatically corrects 
the invalid offsets, but unfortunately when writing it tries to maintain the invalid offsets and 
runs into trouble because some of the values go negative.  I am currently trying to figure out 
what can be done about this.  At the very least, I will put in a check for this error condition 
when writing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;11&nbsp;09:24:02&nbsp;2008</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">150 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have just released exiftool 7.42 which addresses this problem.  The behaviour of 7.42 is 
now:

1&#41; Without options, exiftool gives the following error message when writing a file with this 
problem:

    &#34;Error: [minor] MakerNotes offsets may be incorrect &#40;fix or ignore?&#41;&#34;

2&#41; The error may be ignored by writing with the -m option, which is effectively the previous 
behaviour but you run the chance of further corrupting the makernotes as before.  With this, 
you get the following warning:

    &#34;Warning: MakerNotes offsets may be incorrect &#40;ignored&#41;&#34;

3&#41; If you write with the -F option, exiftool attempts to fix the problem, and the offsets are 
corrected with this warning:

    &#34;Warning: Fixed incorrect MakerNotes offsets&#34;

I say &#34;attempts&#34; because there may be other types of corruption which exiftool can not 
properly repair, but in the case of your images this seems to work fine.

Please let me know if you have any further problems.

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;11&nbsp;09:24:07&nbsp;2008</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Given to EXIFTOOL</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;27&nbsp;09:20:14&nbsp;2008</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;27&nbsp;09:20:54&nbsp;2008</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Fixed in 7.50 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
