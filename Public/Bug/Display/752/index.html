<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #752 for Text-Balanced: Calling a subroutine with a heredoc as a parameter breaks Text::Balanced::extract_multiple.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #752 for Text-Balanced: Calling a subroutine with a heredoc as a parameter breaks Text::Balanced::extract_multiple.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Text-Balanced/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Text-Balanced/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Text-Balanced/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Text-Balanced/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-Balanced">Text-Balanced CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">752</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Text-Balanced/Active/">Text-Balanced</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
harleypig [...] harleypig.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-31764-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31765-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;17&nbsp;14:22:06&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Calling a subroutine with a heredoc as a parameter breaks
    Text::Balanced::extract_multiple.</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Calling a subroutine with a heredoc as a parameter breaks Text::Balanced::extract_multiple.  &#40;see simplified.pm for example&#41;

I discovered this while trying to make Filter::Simple work for some modules I have and am trying to condense a little.

The actual error message is in the _success module when there is a &#39;FILLET&#39; &#40;beginning at line 69&#41;.  It looks like what is being attempted in this algorithm is the heredoc is to be excised while leaving any additional text on the same line after the heredoc begin alone.

The problem I see here is that the algorithm is attempting to do this from a fragment of the original text with numbers relating to the full text.

  my $extra = substr&#40;$res[0], $extrapos-$startlen, $extralen, &#34;\n&#34;&#41;;

The values in $extrapos, $startlen and $extralen are all relative to the original text.  The only one that matters though is $extrapos, which in my example code is 92, but in $res[0] is 0.  Either $res[0] needs to be changed to $$textref or &#39;$extrapos-$startlen&#39; needs to be changed to $startlen.  I think.

I haven&#39;t had the chance to fully analyze everything that would be affected by any of this.  So I apologize if I&#39;ve missed something incredibly stoopid.  If I can be of further assistance please feel free to contact me.

Check attached file &#39;explain.txt&#39; for system information.

Alan Young
harleypig@harleypig.com
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;22&nbsp;23:17:00&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Manura</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This problem is described in perlbug #25154 
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs6.perl.org/rt3/Ticket/Display.html?id=25154&#41;">http://bugs6.perl.org/rt3/Ticket/Display.html?id=25154&#41;</a></span>.  The patch is 
also part of the larger patch given in perlbug #25157 
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs6.perl.org/rt3/Ticket/Display.html?id=25157&#41;">http://bugs6.perl.org/rt3/Ticket/Display.html?id=25157&#41;</a></span>.

This patch replaces $extrapos-$startlen with $extrapos-$oppos, where 
$oppos is set to $_[6].  So, if $$textref is

  &lt;&lt;TEXT + 123;
1
TEXT

and pos&#40;$$textref&#41; is initially 0, then $extrapos would be 8, $startlen 
would be 2, $oppos would be 2, and $res[0] would be

&lt;&lt;TEXT + 123;
1
TEXT

In this case, the patch has no effect.  substr&#40;$res[0], $extrapos-
$oppos, $extralen&#41; refers to &#34; + 123;\n&#34;, which is the fillet to be 
moved.

However, if pos&#40;$$textref&#41; is initially 2, then $extrapos would be 8, 
$startlen would be 0, and $oppos would be 2.  As seen, $startlen should 
be replaced with $oppos.

I don&#39;t believe it would be correct to simply repleace $res[0] with 
$$textref.  $res[0] is the first return argument of _succeed&#40;&#41;, which 
is therefore the first return argument of match_quotelike&#40;&#41;, which 
under list context should be the extracted string, not the whole 
string.  ughh...that&#39;s a lot to think about.

-davidm

[guest - Mon Jun 17 14:22:06 2002]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Calling a subroutine with a heredoc as a parameter breaks
&gt;    Text::Balanced::extract_multiple.  &#40;see simplified.pm for example&#41;
&gt; 
&gt; I discovered this while trying to make Filter::Simple work for some
&gt;    modules I have and am trying to condense a little.
&gt; 
&gt; The actual error message is in the _success module when there is a
&gt;    &#39;FILLET&#39; &#40;beginning at line 69&#41;.  It looks like what is being
&gt;    attempted in this algorithm is the heredoc is to be excised while
&gt;    leaving any additional text on the same line after the heredoc
&gt;    begin alone.
&gt; 
&gt; The problem I see here is that the algorithm is attempting to do this
&gt;    from a fragment of the original text with numbers relating to the
&gt;    full text.
&gt; 
&gt;   my $extra = substr&#40;$res[0], $extrapos-$startlen, $extralen, &#34;\n&#34;&#41;;
&gt; 
&gt; The values in $extrapos, $startlen and $extralen are all relative to
&gt;    the original text.  The only one that matters though is $extrapos,
&gt;    which in my example code is 92, but in $res[0] is 0.  Either
&gt;    $res[0] needs to be changed to $$textref or &#39;$extrapos-$startlen&#39;
&gt;    needs to be changed to $startlen.  I think.
&gt; 
&gt; I haven&#39;t had the chance to fully analyze everything that would be
&gt;    affected by any of this.  So I apologize if I&#39;ve missed something
&gt;    incredibly stoopid.  If I can be of further assistance please feel
&gt;    free to contact me.
&gt; 
&gt; Check attached file &#39;explain.txt&#39; for system information.
&gt; 
&gt; Alan Young
&gt; harleypig@harleypig.com
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;03&nbsp;08:28:52&nbsp;2015</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 22 23:17:00 2004, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This problem is described in perlbug #25154 
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs6.perl.org/rt3/Ticket/Display.html?id=25154&#41;">http://bugs6.perl.org/rt3/Ticket/Display.html?id=25154&#41;</a></span>.  The patch is 
&gt; also part of the larger patch given in perlbug #25157 
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs6.perl.org/rt3/Ticket/Display.html?id=25157&#41;">http://bugs6.perl.org/rt3/Ticket/Display.html?id=25157&#41;</a></span>.
&gt; 
</div>
The patch in rt.perl.org#25157 was applied to blead long ago, and is also therefore in Text::Balanced on CPAN since it is currently in sync with blead. So this should be fixed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;03&nbsp;08:28:52&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;03&nbsp;08:28:54&nbsp;2015</span>
    <span class="description">shay [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
