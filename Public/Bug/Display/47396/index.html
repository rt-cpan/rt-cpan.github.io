<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #47396 for ExtUtils-MakeMaker: expanding $&#40;PREFIX&#41; in Makefile</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #47396 for ExtUtils-MakeMaker: expanding $&#40;PREFIX&#41; in Makefile</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-MakeMaker">ExtUtils-MakeMaker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">47396</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-MakeMaker/Active/">ExtUtils-MakeMaker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;27&nbsp;20:51:35&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 28 Jun 2009 10:51:04 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If I&#39;m not mistaken past versions of MakeMaker generated stuff like

    INSTALLMAN3DIR = $&#40;PERLPREFIX&#41;/share/man/man3

whereas in 6.52 it&#39;s locked down as

    INSTALLMAN3DIR = /usr/share/man/man3

The use of $&#40;PREFIX&#41; in the format allowed the prefix to be overridden
in later make commands.  Debian &#34;cdbs&#34; for instance had been using

    make install PREFIX=/some/dir/usr

This was presumably only from when DESTDIR wasn&#39;t available, but for
compatibility with anyone else still doing the same it could be helpful
for MakeMaker to keep the former calculated style.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;28&nbsp;00:16:42&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 28 Jun 2009 00:16:17 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Kevin Ryde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I&#39;m not mistaken past versions of MakeMaker generated stuff like
&gt; 
&gt;     INSTALLMAN3DIR = $&#40;PERLPREFIX&#41;/share/man/man3
&gt; 
&gt; whereas in 6.52 it&#39;s locked down as
&gt; 
&gt;     INSTALLMAN3DIR = /usr/share/man/man3
&gt; 
&gt; The use of $&#40;PREFIX&#41; in the format allowed the prefix to be overridden
&gt; in later make commands.  Debian &#34;cdbs&#34; for instance had been using
&gt; 
&gt;     make install PREFIX=/some/dir/usr
&gt; 
&gt; This was presumably only from when DESTDIR wasn&#39;t available, but for
&gt; compatibility with anyone else still doing the same it could be helpful
&gt; for MakeMaker to keep the former calculated style.
</div>
I hear what you&#39;re saying.  In theory this could be fixed, but I&#39;d have to
plow up the prefixification code again and risk new breakage.  But PREFIIX
doesn&#39;t actually work.  Its broken by design.  You might get all sorts of
funny outcomes by using PREFIX.  See <span class="clickylink"><a target="new" rel="nofollow" href="http://schwern.org/talks/PREFIX/">http://schwern.org/talks/PREFIX/</a></span> for an
explanation.  Particularly slides 7-10.

Though it worked ok for packaging, it didn&#39;t work for anything else.  So I&#39;m
disinclined to put any more work into it.  Sorry.

Use DESTDIR.  Its been six years since it was added.  Debian already has a new
enough MakeMaker.


-- 
Whip me, beat me, make my code compatible with VMS!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;28&nbsp;00:16:42&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;19:20:20&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Jul 2009 09:18:46 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Michael G Schwern via RT&#34; &lt;bug-ExtUtils-MakeMaker@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; But PREFIIX doesn&#39;t actually work.  Its broken by design.
</div>
Well, of course it&#39;s supposed to be simply the /usr part of /usr/lib
etc.  It&#39;s only programs which spray stuff outside a single tree that
get themselves into trouble &#40;like perl on msdos or whatever I suppose!
:-&#41;.

I think overriding a prefix at the &#34;make install&#34; stage is fairly
traditional &#40;not just with perl&#41;, even if not a fantastically great
idea.  If you already detect the prefix on paths in %Config it could be
well worth propagating that to the makefile.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;20:35:12&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Jul 2009 19:34:49 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Kevin Ryde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Michael G Schwern via RT&#34; &lt;bug-ExtUtils-MakeMaker@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt;&gt; But PREFIIX doesn&#39;t actually work.  Its broken by design.
</div>&gt; 
&gt; Well, of course it&#39;s supposed to be simply the /usr part of /usr/lib
&gt; etc.  It&#39;s only programs which spray stuff outside a single tree that
&gt; get themselves into trouble &#40;like perl on msdos or whatever I suppose!
&gt; :-&#41;.
</div>
Yes, its *supposed* to be simple.  But stretch that across nine years of Perl
releases, three different major operating systems &#40;Unix, Windows, VMS&#41;,
countless OS variants, different filesystems, at least a half dozen flavors of
make, different shells, different path syntax and vendors doing lord knows
what to Perl installs and it becomes very, very, very not simple.

Debian has done this in the recent past, IIRC it had to do with the /usr/lib
/usr/share split, and OS X currently does this putting things in /Library and
/usr/local with a siteprefix of /usr/local.

Oh, don&#39;t forget to make it work on VMS.   &lt;--- not a joke


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think overriding a prefix at the &#34;make install&#34; stage is fairly
&gt; traditional &#40;not just with perl&#41;, even if not a fantastically great
&gt; idea.  If you already detect the prefix on paths in %Config it could be
&gt; well worth propagating that to the makefile.
</div>
I agree, its very traditional.  That&#39;s not much of an argument, just a
statement.  And it doesn&#39;t fix the problem&#40;s&#41;.

Add to the mix that Perl does not have one prefix but four.  PERLPREFIX for
core modules, SITEPREFIX for locally installed modules and VENDORPREFIX for
vendor packaged modules.  PREFIX is a fiction to simplify the problem of
installing a single module.  The multiple prefixes were put in place to
accommodate, amongst other things, Debian&#39;s layout.

So, when someone writes:

    perl Makefile.PL
    make
    make test
    make install PREFIX=/some/dir

How does Makefile.PL know in advance to prefix all the INSTALL directories
with PREFIX and not PERL/SITE/VENDORPREFIX?  That&#39;s the essential problem.

You can tell it you&#39;re going to use a single PREFIX like so:

    perl Makefile.PL PREFIX=/usr
    make
    make test
    make install PREFIX=/some/other/dir

And then it will know and that will work.

Its complicated and it sucks and its way too late to change.  The essential
problem is trying to encode a dynamic situation into a static file &#40;the
Makefile&#41; which is why we made Module::Build.


-- 
The past has a vote, but not a veto.
    -- Mordecai M. Kaplan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;18:34:56&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 08 Jul 2009 08:34:23 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Michael G Schwern via RT&#34; &lt;bug-ExtUtils-MakeMaker@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;     perl Makefile.PL
&gt;     make
&gt;     make test
&gt;     make install PREFIX=/some/dir
&gt;
&gt; How does Makefile.PL know in advance to prefix all the INSTALL directories
&gt; with PREFIX and not PERL/SITE/VENDORPREFIX?  That&#39;s the essential problem.
</div>
Oh, err, umm, yeah.  You&#39;d be tempted to have a single set of install
dirs just using PREFIX, then default PREFIX from among perl/site/vendor.
I suppose what you say about the structure or the &#34;../../Library&#34; bits
being inconsistent among the three defeats that :-&#40;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     perl Makefile.PL PREFIX=/usr
&gt;     make
&gt;     make test
&gt;     make install PREFIX=/some/other/dir
&gt;
&gt; And then it will know and that will work.
</div>
Perhaps that&#39;s close enough.

&#40;Personally I&#39;ve always found the perl/site/vendor distinction and the
triplicated set of directories to be fairly impenetrable :-&#41;, beyond
that only 1 of the 3 at various times did something like I thought I
wanted!&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;19:24:26&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Jul 2009 16:23:51 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Kevin Ryde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;     perl Makefile.PL PREFIX=/usr
&gt;&gt;     make
&gt;&gt;     make test
&gt;&gt;     make install PREFIX=/some/other/dir
&gt;&gt;
&gt;&gt; And then it will know and that will work.
</div>&gt; 
&gt; Perhaps that&#39;s close enough.
&gt; 
&gt; &#40;Personally I&#39;ve always found the perl/site/vendor distinction and the
&gt; triplicated set of directories to be fairly impenetrable :-&#41;, beyond
&gt; that only 1 of the 3 at various times did something like I thought I
&gt; wanted!&#41;
</div>
Part of the problem is the whole philosophy is never fully explained.  Part of
it is that until 5.12 the default look up order is wrong.

Its pretty simple.  Think of it like MacPorts or fink which doesn&#39;t control
the entire operating system.  You effectively have three managers working at
the same time.  You have the user installing things by hand.  You have the
package manager.  And then there&#39;s the operating system.

In a flat layout they&#39;ll stomp all over each other.  You might install an
upgraded program from MacPorts and then have the next OS upgrade downgrade it
again.  The user might install the latest version from a tarball and then
MacPorts installs an older version on top of it next upgrade.

&#34;site&#34; is what gets installed by the user, like /usr/local.

&#34;vendor&#34; is what gets installed by the package manager. /opt/local for
MacPorts, /sw for fink.

&#34;core&#34; is what originally shipped with the operating system &#40;or in Perl&#39;s case
with Perl itself&#41;, like /usr.

You look in /usr/local first, then /opt/local, then /usr.  In fact, that&#39;s how
my PATH is set up.  Unfortunately Perl itself incorrectly puts &#34;core&#34; first.
Fortunately Debian &#40;and I think Redhat now&#41; fixes that.  And 5.12 will finally
fix it.

Packagers should be setting INSTALLDIRS=vendor.  The CPAN shell should be
using INSTALLDIRS=site.  Nothing should be using perl/core.  The broken lookup
order complicates this because upgrades to dual-life CPAN modules have to go
into core else they&#39;re not found.


-- 
You know what the chain of command is? It&#39;s the chain I go get and beat you
with &#39;til you understand who&#39;s in ruttin&#39; command here.
        -- Jayne Cobb, &#34;Firefly&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;13&nbsp;21:25:53&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jul 2009 11:25:19 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Michael G Schwern via RT&#34; &lt;bug-ExtUtils-MakeMaker@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &#34;site&#34; is what gets installed by the user, like /usr/local.
&gt;
&gt; &#34;vendor&#34; is what gets installed by the package manager. /opt/local for
&gt; MacPorts, /sw for fink.
</div>
Ah, well those two are probably the confusing bits.  As an ordinary user
I&#39;d probably be happy not to know, initially, there was a &#34;vendor&#34;
directories choice :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately Perl itself incorrectly puts &#34;core&#34; first.
&gt; Fortunately Debian &#40;and I think Redhat now&#41; fixes that.
&gt; And 5.12 will finally fix it.
</div>
I suppose if it had been the right way around there&#39;d have been very
little call for INSTALLDIRS=core, which would have just about wound it
right back to &#34;site&#34; alone &#40;with &#34;vendor&#34; semi-hidden away&#41;, driven off
a default or specified $prefix.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;14&nbsp;01:11:25&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jul 2009 22:11:02 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Kevin Ryde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Michael G Schwern via RT&#34; &lt;bug-ExtUtils-MakeMaker@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt;&gt; &#34;site&#34; is what gets installed by the user, like /usr/local.
&gt;&gt;
&gt;&gt; &#34;vendor&#34; is what gets installed by the package manager. /opt/local for
&gt;&gt; MacPorts, /sw for fink.
</div>&gt; 
&gt; Ah, well those two are probably the confusing bits.  As an ordinary user
&gt; I&#39;d probably be happy not to know, initially, there was a &#34;vendor&#34;
&gt; directories choice :-&#41;
</div>
Yes.  Perl, by default, doesn&#39;t have a &#34;vendor prefix&#34; at all leaving it
effectively just &#34;site&#34; and &#34;core&#34;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Unfortunately Perl itself incorrectly puts &#34;core&#34; first.
&gt;&gt; Fortunately Debian &#40;and I think Redhat now&#41; fixes that.
&gt;&gt; And 5.12 will finally fix it.
</div>&gt; 
&gt; I suppose if it had been the right way around there&#39;d have been very
&gt; little call for INSTALLDIRS=core, which would have just about wound it
&gt; right back to &#34;site&#34; alone &#40;with &#34;vendor&#34; semi-hidden away&#41;, driven off
&gt; a default or specified $prefix.
</div>
Exactly.  Joe User would just use INSTALLDIRS=site, the CPAN shell would
default to it.  The &#34;core&#34; library files shipped with Perl would never change,
new versions from CPAN would overlay them in &#34;site&#34;.  Vendors would hard code
&#34;INSTALLDIRS=vendor&#34; in their package generators and be done with it.


-- 
If at first you don&#39;t succeed--you fail.
        -- &#34;Portal&#34; demo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;05:45:51&nbsp;2009</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jun 27 20:51:35 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I&#39;m not mistaken past versions of MakeMaker generated stuff like
&gt; 
&gt;     INSTALLMAN3DIR = $&#40;PERLPREFIX&#41;/share/man/man3
&gt; 
&gt; whereas in 6.52 it&#39;s locked down as
&gt; 
&gt;     INSTALLMAN3DIR = /usr/share/man/man3
</div>
FYI, <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/545904">http://bugs.debian.org/545904</a></span> is about this. 

Turns out we&#39;ve been carrying a Debian-specific patch to
ExtUtils::MM_Unix::prefixify since 2001 or so to enable overriding
PREFIX at install time. I assume it worked for Kevin until now because
of this.

I accidentally dropped the patch in my preliminary 5.10.1 packages,
which made about 250 packages in the Debian archive fail to build in my
tests.

I think we should get rid of the Debian patch and change all our
packages to use DESTDIR, but that&#39;s going to take some time, so I&#39;ll
reinstate it for now and start pushing a transition.

I&#39;m attaching a current version of the patch for reference.

Michael, many thanks for your work. Much appreciated.
-- 
Niko Tyni
ntyni@debian.org
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 5d783c396b6900ae049a3d0c4af1099813dcb222 Mon Sep 17 00:00:00 2001
From: Niko Tyni &lt;ntyni@debian.org&gt;
Date: Tue, 15 Sep 2009 08:12:18 +0300
Subject: [PATCH] reinstate Debian change to ExtUtils::MakeMaker for now to allow overriding PREFIX at installation time again. &#40;Closes: #545904&#41;

---
 lib/ExtUtils/MM_Unix.pm |    3 +--
 1 files changed, 1 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/lib/ExtUtils/MM_Unix.pm b/lib/ExtUtils/MM_Unix.pm
index 33a27ff..c3504b6 100644
--- a/lib/ExtUtils/MM_Unix.pm
+++ b/lib/ExtUtils/MM_Unix.pm
@@ -2963,8 +2963,7 @@ sub prefixify {
     print STDERR &#34;  prefixify $var =&gt; $path\n&#34; if $Verbose &gt;= 2;
     print STDERR &#34;    from $sprefix to $rprefix\n&#34; if $Verbose &gt;= 2;
 
-    if&#40; $self-&gt;{ARGS}{PREFIX} &#38;&#38;
-        $path !~ s{^\Q$sprefix\E\b}{$rprefix}s &#41; 
+    if&#40; $path !~ s{^\Q$sprefix\E\b}{$rprefix}s &#38;&#38; $self-&gt;{ARGS}{PREFIX} &#41;
     {
 
         print STDERR &#34;    cannot prefix, using default.\n&#34; if $Verbose &gt;= 2;
-- 
1.6.3.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;04:33:58&nbsp;2009</span>
    <span class="description">dmacks [...] netspace.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2009 03:56:58 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Macks &lt;dmacks [...] netspace.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">What was the earliest released version that contains support for
DESTDIR? I manage systems with perl back to 5.8.1, which corelist says
comes with ExtUtils::MakeMaker 6.17. Presently I have build scripts
that use the PREFIX approach, easy enough for me to convert them to
the modern DESTDIR approach. However, will I be able to use a single
build script even for systems that old, or do I need to keep a legacy
set of PREFIX-based build scripts for some of my older perls?

dan

-- 
Daniel Macks
dmacks@netspace.org
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.netspace.org/~dmacks">http://www.netspace.org/~dmacks</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;23:45:34&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2009 20:44:43 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">dmacks@netspace.org via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What was the earliest released version that contains support for
&gt; DESTDIR? I manage systems with perl back to 5.8.1, which corelist says
&gt; comes with ExtUtils::MakeMaker 6.17. Presently I have build scripts
&gt; that use the PREFIX approach, easy enough for me to convert them to
&gt; the modern DESTDIR approach. However, will I be able to use a single
&gt; build script even for systems that old, or do I need to keep a legacy
&gt; set of PREFIX-based build scripts for some of my older perls?
</div>
A quick look through the public Changes file shows 6.06_01 with some DESTDIR
related bug fixes in 6.10_08.  So 6.17 is fine.

And, of course, if for some reason it won&#39;t work with those older versions,
ExtUtils::MakeMaker is updatable from CPAN.


-- 
...they shared one last kiss that left a bitter yet sweet taste in her
mouth--kind of like throwing up after eating a junior mint.
    -- Dishonorable Mention, 2005 Bulwer-Lytton Fiction Contest
           by Tami Farmer
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;20&nbsp;21:10:46&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47396] expanding $&#40;PREFIX&#41; in Makefile</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Sep 2009 11:09:54 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> dmacks [...] netspace.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;dmacks@netspace.org via RT&#34; &lt;bug-ExtUtils-MakeMaker@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; What was the earliest released version that contains support for
&gt; DESTDIR? I manage systems with perl back to 5.8.1,
</div>
5.8 was the guess for cdbs, I think, and far enough back to go for it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;20&nbsp;00:43:09&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing this up, PREFIX is beyond saving.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;20&nbsp;00:43:11&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
