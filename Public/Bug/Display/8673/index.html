<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #8673 for WWW-Mechanize: New features: input_has_label&#40;&#41; and other HTML-tree methods</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #8673 for WWW-Mechanize: New features: input_has_label&#40;&#41; and other HTML-tree methods</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/WWW-Mechanize/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/libwww-perl/WWW-Mechanize/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-Mechanize">WWW-Mechanize CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">8673</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/WWW-Mechanize/Active/">WWW-Mechanize</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dom [...] idealx.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36214-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36215-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;13:59:50&nbsp;2004</span>
    <span class="description">dom [...] idealx.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Nov 2004 20:01:00 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dominique Quatravaux &lt;dom [...] idealx.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-www-mechanize [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> New features: input_has_label&#40;&#41; and other HTML-tree methods</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Dear Mechanists,

Enclosed is a quite jumbo&#39;ed patch &#40;1800+ lines!&#41; to WWW::Mechanize
that purports to add some of the &#34;technical-free&#34; features I&#39;ve been
raving about on the developper list. The &#34;Changes&#34; file &#40;near the top
of the patch&#41; details the added methods, allow me to outline a few of
them:

~    * input_has_label&#40;&#41;: the most important one, allows the programmer
~      to match input widgets using their nearby text labels in the
~      HTML source in a wide variety of situations. Labels may be in
~      the same paragraph as the form controls, or they may be &lt;h3&gt;
~      titles, or they may be in the same HTML table line etc - look at
~      t/html-tree.t to see how robust the heuristics is. The following
~      code &#40;excerpt from the POD&#41; tells the Mech to click on whatever
~      button is labeled &#34;I want no spam&#34; in a technical-free fashion
~      &#40;that is, no need to &#34;view source...&#34; in the browser or count
~      widgets anymore in order to implement that&#41;:

~    map { my $input = $_;
~          $input-&gt;value&#40;$mech-&gt;input_has_label&#40;$input, qr/I want no
spam/i&#41;&#41; }
~        &#40;$mech-&gt;forms-&gt;[0]-&gt;inputs&#41;;

~    * -&gt;node_of_form&#40;&#41; and -&gt;nodes_of_input&#40;&#41;: starting from the
~      HTML::Form::Input objects, one can get back at their position in
~      the HTML parse tree. Quite handy to get additional contextual
~      info about the widgets that the parser in HTML::Form might
~      neglect to remember;
~    * -&gt;text_node_at&#40;&#41;: likewise, starting from a given string offset
~      in the plain-text version of the current page, one can get back
~      at the corresponding HTML node. The converse &#40;from tree to text&#41;
~      is also possible using -&gt;textify_tree&#40;&#41;. The programmer can now
~      mix and match regex-based and tree-based methods to check the
~      contents of those HTML documents!

Please let me know what you think of it all. Pursuant to Andy&#39;s recent
advice, I have done my best to ensure that this patch is ready for
immediate inclusion in a Mech release &#40;docs, tests, no tabs :-&#41; but of
course I&#39;m prepared to deal with modification requests and resubmit.

Best regards,

- --
Dominique QUATRAVAUX                           Ing√©nieur senior
01 44 42 00 08                                 IDEALX

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 &#40;GNU/Linux&#41;
Comment: Using GnuPG with Thunderbird - <span class="clickylink"><a target="new" rel="nofollow" href="http://enigmail.mozdev.org">http://enigmail.mozdev.org</a></span>

iD8DBQFBrMNsMJAKAU3mjcsRAsBiAJ0SMKFdMnqUnxUvgkTfXMiQuJ5/nQCdG4Mz
zlZcOiArJ2FemblOR2dtpEQ=
=qOeq
-----END PGP SIGNATURE-----
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;21:59:53&nbsp;2004</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Dec 2004 21:40:10 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;dom [...] idealx.com via RT&#34; &lt;bug-WWW-Mechanize [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Andy Lester &lt;andy [...] petdance.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #8673] New features: input_has_label&#40;&#41; and other HTML-tree methods</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Nov 30, 2004 at 01:59:53PM -0500, dom@idealx.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Enclosed is a quite jumbo&#39;ed patch &#40;1800+ lines!&#41; to WWW::Mechanize
&gt; that purports to add some of the &#34;technical-free&#34; features I&#39;ve been
&gt; raving about on the developper list. The &#34;Changes&#34; file &#40;near the top
&gt; of the patch&#41; details the added methods, allow me to outline a few of
&gt; them:
&gt; 
&gt; ~    * input_has_label&#40;&#41;: the most important one, allows the programmer
&gt; ~      to match input widgets using their nearby text labels in the
&gt; ~      HTML source in a wide variety of situations. Labels may be in
&gt; ~      the same paragraph as the form controls, or they may be &lt;h3&gt;
&gt; ~      titles, or they may be in the same HTML table line etc - look at
&gt; ~      t/html-tree.t to see how robust the heuristics is. The following
&gt; ~      code &#40;excerpt from the POD&#41; tells the Mech to click on whatever
&gt; ~      button is labeled &#34;I want no spam&#34; in a technical-free fashion
&gt; ~      &#40;that is, no need to &#34;view source...&#34; in the browser or count
&gt; ~      widgets anymore in order to implement that&#41;:
&gt; 
&gt; ~    map { my $input = $_;
&gt; ~          $input-&gt;value&#40;$mech-&gt;input_has_label&#40;$input, qr/I want no
&gt; spam/i&#41;&#41; }
&gt; ~        &#40;$mech-&gt;forms-&gt;[0]-&gt;inputs&#41;;
</div>
Dominique,

The input_has_label&#40;&#41; function does look really cool. I want to play
with it some more to try it out,, but I expect that I would like to see
it in Mech.

 From what I can tell, the rest of the other functions mostly serve to
support this one method, and not very interdependent on Mech. They mostly
seem to deal with HTML::TreeBuilder and HTML::Form objects. 

Have you thought about splitting off this functionality into into it&#39;s
own module? It seems like it would be interesting to other HTML parsing
tools besides Mech. 

I visualize an input_has_label&#40;&#41; function in Mech that is a thin wrapper
around another module which does most of the work. 

This would have some advantages for you, I think: You can work on the
code independently of Mech, with your own release schedule. People who
want to use your logic for other purposes besides Mech will be inclined
to contribute. 

The rest of Mech is mostly very high level wrappers around other things:
LWP::UserAgent, HTML::Form and WWW::Mechanize::Link. The reason people
prefer to use it over LWP directly is that it has a simpler, easy to use
interface. 

So, besides that I think it has some benefits for you, I also think it
may be more in line with the existing design of Mech to keep most of
this code elsewhere. 

If people want to use your more advanced methods, they can always access
the module directly to use them.

What do you think? Andy?

    Mark
 
-- 
<span class="clickylink"><a target="new" rel="nofollow" href="http://mark.stosberg.com/">http://mark.stosberg.com/</a></span> 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;07:59:57&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 30 13:59:50 2004, dom@idealx.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----BEGIN PGP SIGNED MESSAGE-----
&gt; Hash: SHA1
&gt; 
&gt; Dear Mechanists,
&gt; 
&gt; Enclosed is a quite jumbo&#39;ed patch &#40;1800+ lines!&#41; to WWW::Mechanize
&gt; that purports to add some of the &#34;technical-free&#34; features I&#39;ve been
&gt; raving about on the developper list. The &#34;Changes&#34; file &#40;near the top
&gt; of the patch&#41; details the added methods, allow me to outline a few of
&gt; them:
&gt; 
&gt; ~    * input_has_label&#40;&#41;: the most important one, allows the programmer
&gt; ~      to match input widgets using their nearby text labels in the
&gt; ~      HTML source in a wide variety of situations. Labels may be in
&gt; ~      the same paragraph as the form controls, or they may be &lt;h3&gt;
&gt; ~      titles, or they may be in the same HTML table line etc - look at
&gt; ~      t/html-tree.t to see how robust the heuristics is. The following
&gt; ~      code &#40;excerpt from the POD&#41; tells the Mech to click on whatever
&gt; ~      button is labeled &#34;I want no spam&#34; in a technical-free fashion
&gt; ~      &#40;that is, no need to &#34;view source...&#34; in the browser or count
&gt; ~      widgets anymore in order to implement that&#41;:
&gt; 
&gt; ~    map { my $input = $_;
&gt; ~          $input-&gt;value&#40;$mech-&gt;input_has_label&#40;$input, qr/I want no
&gt; spam/i&#41;&#41; }
&gt; ~        &#40;$mech-&gt;forms-&gt;[0]-&gt;inputs&#41;;
&gt; 
&gt; ~    * -&gt;node_of_form&#40;&#41; and -&gt;nodes_of_input&#40;&#41;: starting from the
&gt; ~      HTML::Form::Input objects, one can get back at their position in
&gt; ~      the HTML parse tree. Quite handy to get additional contextual
&gt; ~      info about the widgets that the parser in HTML::Form might
&gt; ~      neglect to remember;
&gt; ~    * -&gt;text_node_at&#40;&#41;: likewise, starting from a given string offset
&gt; ~      in the plain-text version of the current page, one can get back
&gt; ~      at the corresponding HTML node. The converse &#40;from tree to text&#41;
&gt; ~      is also possible using -&gt;textify_tree&#40;&#41;. The programmer can now
&gt; ~      mix and match regex-based and tree-based methods to check the
&gt; ~      contents of those HTML documents!
&gt; 
&gt; Please let me know what you think of it all. Pursuant to Andy&#39;s recent
&gt; advice, I have done my best to ensure that this patch is ready for
&gt; immediate inclusion in a Mech release &#40;docs, tests, no tabs :-&#41; but of
&gt; course I&#39;m prepared to deal with modification requests and resubmit.
</div>
Dominique,

Please publish this work as a plugin. Let us know if you have an
questoins about how to do that. A few Mech plugins have already been
published as examples. 

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;07:59:58&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;19&nbsp;08:42:05&nbsp;2006</span>
    <span class="description">PETDANCE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
