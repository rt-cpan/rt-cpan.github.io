<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #107592 for Mail-IMAPClient: avoid showing credentials via debug&#40;&#41; unless Showcredentials&#40;&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #107592 for Mail-IMAPClient: avoid showing credentials via debug&#40;&#41; unless Showcredentials&#40;&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Mail-IMAPClient">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Mail-IMAPClient">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Mail-IMAPClient">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Mail-IMAPClient">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-IMAPClient">Mail-IMAPClient CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">107592</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Mail-IMAPClient">Mail-IMAPClient</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">PLOBBES [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gilles.lamiral [...] laposte.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-19960-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19961-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
3.38    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=107592">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542462" href="/Public/Bug/Display.html?id=107592#txn-1542462">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;19:50:34&nbsp;2015</span>
    <span class="description">gilles.lamiral [...] laposte.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Using Showcredentials&#40;&#41; to avoid showing credentials in debug mode.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Oct 2015 01:50:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gilles LAMIRAL &lt;gilles.lamiral [...] laposte.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1542462/823530/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/823530">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Phil,

I&#39;m often scared to see --debugimap output from imapsync with the big
caveat to reveal credentials published on the net via a mailing-list
archive, or even to myself only.

This is a small patch in sub _send_line&#40;&#41; to avoid showing credentials
in Debug&#40;1&#41; mode, for the classical LOGIN authentication.
I saw you added Showcredentials and started to use it in sub _record&#40;&#41;
so I used it and copied your code as a model.

Thanks in advance to include this or any better code/idea to
implement a way to mask credentials in debug mode.


Basically the change is only this:

my $debug ;
if &#40; !$self-&gt;Showcredentials &#38;&#38; $string =~ /^&#40;\d+\s+LOGIN\s+&#41;.*/ &#41; {
$debug = &#34;$1 XXXXXXXX XXXXXXXX_Showcredentials_is_off&#34; ;
}else{
$debug = $string ;
}

$self-&gt;_debug&#40;&#34;Sending: $debug&#34;&#41;;

Here is the whole sub _send_line&#40;&#41; function patched from Mail::IMAPClient 3.37:

# _send_line handles literal data and supports the Prewritemethod
sub _send_line {
     my &#40; $self, $string, $suppress &#41; = @_;

     $string =~ s/$CR?$LF?$/$CRLF/o
       unless $suppress;

     # handle case where string contains a literal
     if &#40; $string =~ s/^&#40;[^$LF\{]*\{\d+\}$CRLF&#41;&#40;?=.&#41;//o &#41; {
         my $first = $1;
         $self-&gt;_debug&#40;&#34;Sending literal: $first\tthen: $string&#34;&#41;;
         $self-&gt;_send_line&#40;$first&#41; or return undef;

         # look for &#34;$tag NO&#34; or &#34;+ ...&#34;
         my $code = $self-&gt;_get_response&#40; $self-&gt;Count, &#39;+&#39; &#41; or return undef;
         return undef unless $code eq &#39;+&#39;;
     }

     # non-literal part continues...
     if &#40; my $prew = $self-&gt;Prewritemethod &#41; {
         $string = $prew-&gt;&#40; $self, $string &#41;;
     }

     my $debug ;
     if &#40; !$self-&gt;Showcredentials &#38;&#38; $string =~ /^&#40;\d+\s+LOGIN\s+&#41;.*/ &#41; {
         $debug = &#34;$1 XXXXXXXX XXXXXXXX_Showcredentials_is_off&#34; ;
     }else{
         $debug =  $string ;
     }

     $self-&gt;_debug&#40;&#34;Sending: $debug&#34;&#41;;
     unless &#40; $self-&gt;IsConnected &#41; {
         $self-&gt;LastError&#40;&#34;NO not connected&#34;&#41;;
         return undef;
     }

     $self-&gt;_send_bytes&#40; \$string &#41;;
}



-- 
Au revoir,                             09 51 84 42 42
Gilles Lamiral. France, Baulon &#40;35580&#41; 06 20 79 76 06
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1544549" href="/Public/Bug/Display.html?id=107592#txn-1544549">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;12&nbsp;23:51:57&nbsp;2015</span>
    <span class="description">PLOBBES [...] cpan.org -  Subject changed from &#39;Using Showcredentials&#40;&#41; to avoid showing credentials in debug mode.&#39; to &#39;avoid showing credentials via debug&#40;&#41; unless Showcredentials&#40;&#41;&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1544550" href="/Public/Bug/Display.html?id=107592#txn-1544550">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;12&nbsp;23:51:58&nbsp;2015</span>
    <span class="description">PLOBBES [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1544551" href="/Public/Bug/Display.html?id=107592#txn-1544551">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;12&nbsp;23:51:59&nbsp;2015</span>
    <span class="description">PLOBBES [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1544553" href="/Public/Bug/Display.html?id=107592#txn-1544553">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;12&nbsp;23:52:00&nbsp;2015</span>
    <span class="description">PLOBBES [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1579876" href="/Public/Bug/Display.html?id=107592#txn-1579876">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;00:56:37&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1579876/843862/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/843862">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m toying around with a patch that looks like the following.  Thoughts?

diff --git a/lib/Mail/IMAPClient.pm b/lib/Mail/IMAPClient.pm
index 737f35c..6d731b6 100644
--- a/lib/Mail/IMAPClient.pm
+++ b/lib/Mail/IMAPClient.pm
@@ -1476,7 +1476,14 @@ sub _send_line {
     # handle case where string contains a literal
     if &#40; $string =~ s/^&#40;[^$LF\{]*\{\d+\}$CRLF&#41;&#40;?=.&#41;//o &#41; {
         my $first = $1;
-        $self-&gt;_debug&#40;&#34;Sending literal: $first\tthen: $string&#34;&#41;;
+        if &#40; $self-&gt;Debug &#41; {
+            my $dat;
+            if &#40; $self-&gt;IsConnected and !$self-&gt;IsAuthenticated and !$self-&gt;Showcredentials &#41; {
+                my $len = length&#40;$string&#41;;
+                $dat = &#34;[NotAuth: Showcredentials is OFF] strlen&#40;$len&#41;&#34;;
+            }
+            $self-&gt;_debug&#40; &#34;Sending literal: $first\tthen: &#34;, defined $dat ? $dat : $string &#41;;
+        }
         $self-&gt;_send_line&#40;$first&#41; or return undef;
 
         # look for &#34;$tag NO&#34; or &#34;+ ...&#34;
@@ -1489,7 +1496,15 @@ sub _send_line {
         $string = $prew-&gt;&#40; $self, $string &#41;;
     }
 
-    $self-&gt;_debug&#40;&#34;Sending: $string&#34;&#41;;
+    if &#40; $self-&gt;Debug &#41; {
+        my $dat;
+        if &#40; $self-&gt;IsConnected and !$self-&gt;IsAuthenticated and !$self-&gt;Showcredentials &#41; {
+            my $len = length&#40;$string&#41;;
+            $dat = &#34;[NotAuth: Showcredentials is OFF] strlen&#40;$len&#41;&#34;;
+        }
+        $self-&gt;_debug&#40;&#34;Sending: &#34;, defined $dat ? $dat : $string &#41;;
+    }
+
     unless &#40; $self-&gt;IsConnected &#41; {
         $self-&gt;LastError&#40;&#34;NO not connected&#34;&#41;;
         return undef;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580080" href="/Public/Bug/Display.html?id=107592#txn-1580080">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;13:09:04&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580080/844014/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844014">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 710b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The following commit was made to support this change &#40;slightly different from what I proposed earlier&#41;:

commit 5a86ddbb786a2759bab42bdeb4e83f3c10b44f2f
Author: Phil Pearl &#40;Lobbes&#41; &lt;phil@perkpartners.com&gt;
Date:   Mon Jan 4 18:04:13 2016 +0000

    - rt.cpan.org#107592: redact credentials via debug if !Showcredentials
      - added new internal method _redact_line&#40;&#41; to support this


Note, I added new internal method _redact_line&#40;&#41; to support this and if you were ambitious you could use Mail::IMAPClient as a base class and override that method to take more control over what is logged via debug in that case but as it is right now, it deals with quoted and literal use cases so I hope it&#39;s &#34;good enough&#34;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580083" href="/Public/Bug/Display.html?id=107592#txn-1580083">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;13:09:05&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580197" href="/Public/Bug/Display.html?id=107592#txn-1580197">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;19:07:18&nbsp;2016</span>
    <span class="description">gilles.lamiral [...] laposte.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107592] avoid showing credentials via debug&#40;&#41; unless Showcredentials&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 5 Jan 2016 01:06:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gilles LAMIRAL &lt;gilles.lamiral [...] laposte.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580197/844092/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844092">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 370b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Phil,

&#34;Showcredentials is OFF&#34; is ok to me,
but &#34;NotAuth&#34;, brackets [] and strlen&#40;$len&#41; are not.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m toying around with a patch that looks like the following.  Thoughts?
&gt;
&gt; +                $dat = &#34;[NotAuth: Showcredentials is OFF] strlen&#40;$len&#41;&#34;;
</div>

-- 
Au revoir,                             09 51 84 42 42
Gilles Lamiral. France, Baulon &#40;35580&#41; 06 20 79 76 06
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580210" href="/Public/Bug/Display.html?id=107592#txn-1580210">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;19:40:20&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580210/844103/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844103">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 04 19:07:18 2016, gilles.lamiral@laposte.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Phil,
&gt; 
&gt; &#34;Showcredentials is OFF&#34; is ok to me,
&gt; but &#34;NotAuth&#34;, brackets [] and strlen&#40;$len&#41; are not.
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;m toying around with a patch that looks like the following.  Thoughts?
&gt; &gt;
&gt; &gt; +                $dat = &#34;[NotAuth: Showcredentials is OFF] strlen&#40;$len&#41;&#34;;
</div>&gt; 
&gt; 
</div>

At the moment, here&#39;s what it looks like &#40;Note the line with &#39;Redact&#39; where a LOGIN occurred&#41;:

Started at Tue Jan  5 00:38:45 2016
Using Mail::IMAPClient version 3.38_04 on perl 5.018002
Connecting with IO::Socket::INET PeerAddr localhost PeerPort 143 Proto tcp Timeout 600 Debug a
Connected to localhost
Read:   * OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE STARTTLS AUTH=PLAIN] Dovecot &#40;Ubuntu&#41; ready.
Sending: [Redact: Count=1 Showcredentials=OFF]
Sent 32 bytes
Read:   1 OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS SPECIAL-USE BINARY MOVE QUOTA] Logged in
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580329" href="/Public/Bug/Display.html?id=107592#txn-1580329">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;05&nbsp;03:39:05&nbsp;2016</span>
    <span class="description">gilles.lamiral [...] laposte.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107592] avoid showing credentials via debug&#40;&#41; unless Showcredentials&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 5 Jan 2016 09:38:44 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gilles LAMIRAL &lt;gilles.lamiral [...] laposte.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580329/844168/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844168">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 870b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Phil,

What I have in mind is that the really important thing is to hide the password,
while still showing real IMAP debugging, the goal of debugging IMAP is to help debugging IMAP.
We&#39;re doing too much with some meta info like [Redact: Count=1 Showcredentials=OFF]
inside the IMAP session output. This meta info should go outside the IMAP trace.

So I&#39;m not satisfied with &#34;Sending: &#34; followed by something that is not sent at all.
I&#39;d prefer see &#34;LOGIN username PASS_MASKED&#34; or &#34;LOGIN username XXX&#34; or anything else
meaningful as long as only the password is changed.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Read:   * OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE STARTTLS AUTH=PLAIN] Dovecot &#40;Ubuntu&#41; ready.
&gt; Sending: [Redact: Count=1 Showcredentials=OFF]
</div>  

-- 
Au revoir,                             09 51 84 42 42
Gilles Lamiral. France, Baulon &#40;35580&#41; 06 20 79 76 06
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580779" href="/Public/Bug/Display.html?id=107592#txn-1580779">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;06&nbsp;01:17:16&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580779/844443/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844443">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 05 03:39:05 2016, gilles.lamiral@laposte.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Phil,
&gt; 
&gt; What I have in mind is that the really important thing is to hide the
&gt; password,
</div>
Agreed, but this is a little tricky...

Consider:
a. 1 LOGIN username password
b. 1 LOGIN username {#}  &#40;password sent as a literal&#41;
c. 1 LOGIN {#}           &#40;user, then password both sent as literals&#41;
d. 1 AUTH PLAIN          &#40;password sent as part of a base64 encoded word&#41;

Regardless, my latest change now does things like:

* Case a.
Sending: 1 LOGIN imaptest [Redact: Count=1 Showcredentials=OFF]
Sent 32 bytes

* Case b.
Sending literal: 1 LOGIN imaptest2 {7}
        then: [Redact: Count=1 Showcredentials=OFF]
Sending: 1 LOGIN imaptest2 {7}
Sent 23 bytes
Read:   + OK
Sending: [Redact: Count=1 Showcredentials=OFF]
Sent 9 bytes

* Case c.
Sending literal: 1 LOGIN {9}
        then: [Redact: Count=1 Showcredentials=OFF]
Sending: 1 LOGIN {9}
Sent 13 bytes
Read:   + OK
Sending: [Redact: Count=1 Showcredentials=OFF]
Sent 31 bytes

* Case d.
Sending: 1 AUTHENTICATE PLAIN
Sent 22 bytes
Read:   +
Sending: [Redact: Count=1 Showcredentials=OFF]
Sent 34 bytes

Better?  Acceptable?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580890" href="/Public/Bug/Display.html?id=107592#txn-1580890">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;06&nbsp;08:26:00&nbsp;2016</span>
    <span class="description">gilles.lamiral [...] laposte.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107592] avoid showing credentials via debug&#40;&#41; unless Showcredentials&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 6 Jan 2016 14:25:35 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gilles LAMIRAL &lt;gilles.lamiral [...] laposte.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580890/844507/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844507">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Phil,

Ah yes, many cases to think, sorry.
What you&#39;ve done is pretty good! I stop complaining.

Thanks Phil!

On 06/01/2016 07:17, Phil Pearl &#40;Lobbes&#41; via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107592">https://rt.cpan.org/Ticket/Display.html?id=107592</a></span> &gt;
&gt;
&gt; On Tue Jan 05 03:39:05 2016, gilles.lamiral@laposte.net wrote:
<div class="message-stanza open">&gt;&gt; Hi Phil,
&gt;&gt;
&gt;&gt; What I have in mind is that the really important thing is to hide the
&gt;&gt; password,
</div>&gt;
&gt; Agreed, but this is a little tricky...
&gt;
&gt; Consider:
&gt; a. 1 LOGIN username password
&gt; b. 1 LOGIN username {#}  &#40;password sent as a literal&#41;
&gt; c. 1 LOGIN {#}           &#40;user, then password both sent as literals&#41;
&gt; d. 1 AUTH PLAIN          &#40;password sent as part of a base64 encoded word&#41;
&gt;
&gt; Regardless, my latest change now does things like:
&gt;
&gt; * Case a.
&gt; Sending: 1 LOGIN imaptest [Redact: Count=1 Showcredentials=OFF]
&gt; Sent 32 bytes
&gt;
&gt; * Case b.
&gt; Sending literal: 1 LOGIN imaptest2 {7}
&gt;          then: [Redact: Count=1 Showcredentials=OFF]
&gt; Sending: 1 LOGIN imaptest2 {7}
&gt; Sent 23 bytes
&gt; Read:   + OK
&gt; Sending: [Redact: Count=1 Showcredentials=OFF]
&gt; Sent 9 bytes
&gt;
&gt; * Case c.
&gt; Sending literal: 1 LOGIN {9}
&gt;          then: [Redact: Count=1 Showcredentials=OFF]
&gt; Sending: 1 LOGIN {9}
&gt; Sent 13 bytes
&gt; Read:   + OK
&gt; Sending: [Redact: Count=1 Showcredentials=OFF]
&gt; Sent 31 bytes
&gt;
&gt; * Case d.
&gt; Sending: 1 AUTHENTICATE PLAIN
&gt; Sent 22 bytes
&gt; Read:   +
&gt; Sending: [Redact: Count=1 Showcredentials=OFF]
&gt; Sent 34 bytes
&gt;
&gt; Better?  Acceptable?
&gt;
</div>
-- 
Au revoir,                             09 51 84 42 42
Gilles Lamiral. France, Baulon &#40;35580&#41; 06 20 79 76 06
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1593233" href="/Public/Bug/Display.html?id=107592#txn-1593233">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;09&nbsp;21:18:07&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Fixed in 3.38 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1593234" href="/Public/Bug/Display.html?id=107592#txn-1593234">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;09&nbsp;21:18:08&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1593234/851974/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/851974">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 94b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~plobbes/Mail-IMAPClient-3.38/">http://search.cpan.org/~plobbes/Mail-IMAPClient-3.38/</a></span> is out and include the fix for this bug.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1593237" href="/Public/Bug/Display.html?id=107592#txn-1593237">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;09&nbsp;21:18:14&nbsp;2016</span>
    <span class="description">PLOBBES [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.008592</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
