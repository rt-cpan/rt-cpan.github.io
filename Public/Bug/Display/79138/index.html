<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79138 for Perl-Critic: RequireArgUnpacking confused by @_ in finally{}</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79138 for Perl-Critic: RequireArgUnpacking confused by @_ in finally{}</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Perl-Critic">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Perl-Critic">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Perl-Critic">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Perl-Critic">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/Perl-Critic/Perl-Critic/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Critic">Perl-Critic CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79138</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Perl-Critic">Perl-Critic</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jffry [...] posteo.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25198-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25199-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=79138">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1111949" href="/Public/Bug/Display.html?id=79138#txn-1111949">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;12:48:51&nbsp;2012</span>
    <span class="description">jffry [...] posteo.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RequireArgUnpacking confused by @_ in finally{}</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Aug 2012 18:48:43 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Ratcliffe &lt;jeffrey.ratcliffe [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1111949/584768/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/584768">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 423b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">For the code below, P::C complains

Always unpack @_ first at line 7, column 1.  See page 178 of PBP.  &#40;Severity: 4&#41;

If you comment out the print and unless in finally{}, then the error disappears.

#!/usr/bin/perl

use strict;
use warnings;
use Try::Tiny;

sub my_method {
 my &#40; $self &#41; = @_;

 try {
  sub_which_could_fail&#40;&#41;;
 }
 catch {
  deal_with_error&#40;&#41;;
 }
 finally {
  print &#39;No error&#39; unless &#40;@_&#41;;
 };
 return;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112036" href="/Public/Bug/Display.html?id=79138#txn-1112036">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;16:44:13&nbsp;2012</span>
    <span class="description">jeff [...] imaginative-software.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79138] RequireArgUnpacking confused by @_ in finally{}</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Aug 2012 13:43:57 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Thalhammer &lt;jeff [...] imaginative-software.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1112036/584822/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/584822">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 61b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yup, that&#39;s a bug.  Thanks for bringing it to our attention.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112039" href="/Public/Bug/Display.html?id=79138#txn-1112039">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;16:44:14&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112121" href="/Public/Bug/Display.html?id=79138#txn-1112121">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;21:26:01&nbsp;2012</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1112121/584866/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/584866">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Coupla thoughts:

First, it seems to me that the use of finally&#40;&#41; is not directly related
to what perlcritic is doing. My evidence: the script

#!/usr/bin/perl

use strict;
use warnings;
use Try::Tiny;

sub my_method {
 my &#40; $self &#41; = @_;

# try {
#  sub_which_could_fail&#40;&#41;;
# }
# catch {
#  deal_with_error&#40;&#41;;
# }
# finally {
  print &#39;No error&#39; unless &#40;@_&#41;;
# };
 return;
}

&#40;with everything commented out _but_ the offending line, and in
particular the whole try/catch/finally thing&#41; produces exactly the same
error.

Second, the line number reported is, strictly speaking, wrong; it ought
to be line 16, since the @_ in the finally&#40;&#41; block &#40;in the original
example&#41; has nothing to do with the @_ in the subroutine at large. I
have not looked at programming this change, though my knee-jerk is that
I&#39;m not smart enough to do it -- at least, not without building into
Perl::Critic an intimate knowledge of how Try::Tiny works. I may be
wrong, though, since setting

short_subroutine_statements     = 3

suppresses the error.

Third, it appears to me that Damien does not address uses of @_ to
discover the number of arguments. It also seems to me that this is what
the ticket is really about. The policy actually has some code to allow
checking the number of arguments, though at this point the only things
allowed are &#39;@_ == $something&#39;, &#39;$something == @_&#39;, &#39;@_ != $something&#39;,
and &#39;$something != @_&#39;. Maybe it should have more?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112541" href="/Public/Bug/Display.html?id=79138#txn-1112541">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;23&nbsp;23:27:23&nbsp;2012</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1112541/585137/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/585137">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 562b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Based on my third thought above &#40;that the real problem is that the logic
to allow testing the size of the argument list is not comprehensive
enough&#41;, I have committed some changes that may help.

I have added the other comparison operators &#40;the original only covered
&#39;$something == @_&#39;, &#39;@_ == $something&#39;, $something != @_, and &#39;@_ !=
$something&#39;&#41;, plus Boolean operators, plus logic to handle suffix
conditionals.

The .run file has an added test, though the test does not cover the
Cartesian product of all the possibilities.

The commit is SVN revision 4151.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112544" href="/Public/Bug/Display.html?id=79138#txn-1112544">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;23&nbsp;23:27:24&nbsp;2012</span>
    <span class="description">wyant [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112581" href="/Public/Bug/Display.html?id=79138#txn-1112581">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;24&nbsp;00:49:38&nbsp;2012</span>
    <span class="description">jeff [...] imaginative-software.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79138] RequireArgUnpacking confused by @_ in finally{}</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Aug 2012 21:49:25 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Thalhammer &lt;jeff [...] imaginative-software.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1112581/585163/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/585163">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 820b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Aug 23, 2012, at 8:27 PM, Tom Wyant via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Based on my third thought above &#40;that the real problem is that the logic
&gt; to allow testing the size of the argument list is not comprehensive
&gt; enough&#41;, I have committed some changes that may help.
</div>
I understood the problem differently.  The argument to finally is a code ref that is given some arguments when invoked.  Basically, it is a subroutine declaration within a subroutine declaration.  But PPI doesn&#39;t see it that way, because it doesn&#39;t see the &#39;sub&#39; keyword.  So the policy sees the @_ inside the finally block as the arguments that were passed to the enclosing named subroutine.  But they aren&#39;t.

So strictly speaking, the sample code is fully compliant.  Within the finally &#34;subroutine&#34;, @_ is handled immediately.  Does that make sense?

-Jeff
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1112581/585164/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/585164">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112584" href="/Public/Bug/Display.html?id=79138#txn-1112584">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;24&nbsp;00:49:40&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1112731" href="/Public/Bug/Display.html?id=79138#txn-1112731">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;24&nbsp;09:50:38&nbsp;2012</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1112731/585267/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/585267">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 24 00:49:38 2012, jeff@imaginative-software.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On Aug 23, 2012, at 8:27 PM, Tom Wyant via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Based on my third thought above &#40;that the real problem is that the
</div>&gt;    logic
<div class="message-stanza open">&gt; &gt; to allow testing the size of the argument list is not comprehensive
&gt; &gt; enough&#41;, I have committed some changes that may help.
</div>&gt; 
&gt; I understood the problem differently.  The argument to finally is a
&gt;    code ref that is given some arguments when invoked.  Basically, it
&gt;    is a subroutine declaration within a subroutine declaration.  But
&gt;    PPI doesn&#39;t see it that way, because it doesn&#39;t see the &#39;sub&#39;
&gt;    keyword.  So the policy sees the @_ inside the finally block as the
&gt;    arguments that were passed to the enclosing named subroutine.  But
&gt;    they aren&#39;t.
&gt; 
&gt; So strictly speaking, the sample code is fully compliant.  Within the
&gt;    finally &#34;subroutine&#34;, @_ is handled immediately.  Does that make
&gt;    sense?
</div>
You are right that the @_ in the finally&#40;&#41; block is not the same as the
@_ at the top of the sub. And Perl::Critic seems to be dimly aware of
this, as shown by the fact that I have to run -noprof to duplicate the
error, apparently because my .perlcriticrc has
&#39;short_subroutine_statements = 3&#39;.

But when I run Perl::Critic 1.18 against

sub my_method {
    print &#39;No error&#39; unless &#40;@_&#41;;
    return;
}

which I believe to be structurally equivalent to the original poster&#39;s
code, I get

$ perlcritic --single ArgUnpacking -noprof fubar.pl
Always unpack @_ first at line 1, column 1.  See page 178 of PBP. 
&#40;Severity: 4&#41;

Do you get something different? Or is there something wrong with my example?

I think the error is because &#39;unless&#40; @_ &#41;&#39; is neither an assignment nor
a shift. I suspect that the error could also &#40;in this specific case&#41; be
suppressed by &#39;allow_delegation_to = unless&#39;, but I have not investigated.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.424254</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
