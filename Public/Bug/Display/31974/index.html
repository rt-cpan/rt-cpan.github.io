<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #31974 for mod_perl: Apache2::RequestRec misparses URI</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #31974 for mod_perl: Apache2::RequestRec misparses URI</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=mod_perl">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=mod_perl">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=mod_perl">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=mod_perl">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/mod_perl">mod_perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">31974</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=mod_perl">mod_perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
CHLIGE [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-21786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.0.1    </td>
  </tr>
  <tr id="CF-21787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Form.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/403135/188788/Form.pm">
Fri Dec 28 16:43:51 2007 (3.8k) by CHLIGE [...] cpan.org
</a>
</font></li>
</ul>


Reserve.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/403135/188791/Reserve.pm">
Fri Dec 28 16:43:51 2007 (4.6k) by CHLIGE [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=31974">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-403135" href="/Public/Bug/Display.html?id=31974#txn-403135">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;28&nbsp;16:43:50&nbsp;2007</span>
    <span class="description">CHLIGE [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Apache2::RequestRec misparses URI</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/403135/188785/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/188785">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m using mod_perl v2.0.1 &#40;from FC4 rpm&#41; and using the
Apache2::RequestRec-&gt;uri truncates the URI for /nmr/admin and only for
/nmr/admin &#40;i.e. /nmr/admi and /nmr/admin2 are fine&#41;.  

I have gone through my Apache configuration files and I cannot find a
redirector or URL rewriting statement.  Attached is the code for the
modules involved.

[gchlip2@anabaena Apps]$ perl -v

This is perl, v5.8.6 built for i386-linux-thread-multi

Copyright 1987-2004, Larry Wall

Perl may be copied only under the terms of either the Artistic License
or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using `man perl&#39; or `perldoc perl&#39;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.

[gchlip2@anabaena Apps]$ uname -a
Linux anabaena 2.6.13-1.1526_FC4 #1 Wed Sep 28 19:15:10 EDT 2005 i686
i686 i386 GNU/Linux
[root@anabaena httpd]# httpd -v
Server version: Apache/2.0.54
Server built:   Sep  2 2005 11:54:18

From httpd/error_log

[Fri Dec 28 15:17:09 2007] [notice] Apache/2.0.54 &#40;Fedora&#41; configured --
resuming normal operations
Rec Object: Apache2::RequestRec Got URI: /nmr/main For location: /nmr
Unparsed URI: /nmr/main at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/main For location: /nmr
Unparsed URI: /nmr/main at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /admin For location: /nmr
Unparsed URI: /nmr/admin at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/selfadmin For location:
/nmr Unparsed URI: /nmr/selfadmin at
/usr/local/http-apps/perl/Apps/Reserve.pm line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/selfadmin For location:
/nmr Unparsed URI: /nmr/selfadmin at
/usr/local/http-apps/perl/Apps/Reserve.pm line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/mydata For location: /nmr
Unparsed URI: /nmr/mydata at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/mydata For location: /nmr
Unparsed URI: /nmr/mydata at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/logout For location: /nmr
Unparsed URI: /nmr/logout at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/logout For location: /nmr
Unparsed URI: /nmr/logout at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/admin2 For location: /nmr
Unparsed URI: /nmr/admin2 at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.
Rec Object: Apache2::RequestRec Got URI: /nmr/admi For location: /nmr
Unparsed URI: /nmr/admi at /usr/local/http-apps/perl/Apps/Reserve.pm
line 38.


[gchlip2@anabaena conf]$ ls
htpasswd  httpd.conf  httpd.conf.bak  httpd.conf.default  httpd.conf.old
 httpd-lab.conf  magic  ssl.crt  ssl.key  workers.properties
[gchlip2@anabaena conf]$ pwd
/etc/httpd/conf
[gchlip2@anabaena conf]$ grep Rewrite *
grep: ssl.crt: Permission denied
grep: ssl.key: Permission denied
[gchlip2@anabaena conf]$ cd ../conf.d
[gchlip2@anabaena conf.d]$ grep Rewrite *
grep: README: Permission denied
grep: ssl.conf.rpmnew: Permission denied
[gchlip2@anabaena conf.d]$ 
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Form.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/403135/188788/Form.pm">Download Form.pm</a><br />
<span class="downloadcontenttype">text/x-perl 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Apps::Reserve::Form;

our @ISA = qw&#40;Apps::Object&#41;;

use strict vars;
use Apps::Reserve::User;
use Apache2::Const qw&#40;:common&#41;;
use Apps::Reserve::Form::main;
use Apps::Reserve::Form::selfadmin;
use Apps::Reserve::Form::mydata;
use Apps::Reserve::Form::logout;
use Apps::Reserve::Form::admin;

sub new {
	my $self = {};
	my $class = shift;
	if &#40; $class eq &#39;Apps::Reserve::Form&#39; &#41; {
		if &#40; $_[0]-&gt;getMod ne &#39;&#39;&#41; {
			$class .= &#39;::&#39; . lc&#40;$_[0]-&gt;getMod&#41;;
		} else {
			$class .= &#39;::main&#39;;
		}
	}
	bless $self, $class;
	$self-&gt;_init&#40;@_&#41;;
	return $self;
}


sub _init {
	my $self = shift;
	$self-&gt;app&#40;shift&#41;;
	return;
}	

sub user {
	my $self = shift;
	return $self-&gt;app-&gt;user;
}

sub login {
	my $self = shift;
	my $cgi = $self-&gt;cgi;
        my $user = Apps::Reserve::User-&gt;new&#40;$self-&gt;dbh, $cgi-&gt;param&#40;&#39;username&#39;&#41;&#41;;
        
        if &#40; $user-&gt;checkPassword&#40;$cgi-&gt;param&#40;&#39;passwd&#39;&#41;&#41; &gt; 0 &#41; {
                $self-&gt;session-&gt;param&#40;&#39;user&#39;,$user-&gt;id&#41;;
		$self-&gt;req-&gt;user&#40;$user-&gt;id&#41;;
		$self-&gt;req-&gt;headers_out-&gt;set&#40;&#39;Location&#39; =&gt; $self-&gt;req-&gt;location&#41;;
                return REDIRECT;
        } else {
                my $message;
                if &#40; $cgi-&gt;param&#40;&#39;username&#39;&#41; ne &#39;&#39; &#41; {
                        $message = $cgi-&gt;font&#40;{-color=&gt;&#39;red&#39;}, $cgi-&gt;b&#40;&#39;Login Failed&#39;&#41;&#41;;
                }
                $self-&gt;req-&gt;print&#40;$self-&gt;header&#41;;
		$self-&gt;req-&gt;print&#40;$cgi-&gt;start_form&#40;&#41;, $cgi-&gt;table&#40;{-align=&gt;&#39;center&#39;}, 
			$cgi-&gt;Tr&#40;[ 
                        	$cgi-&gt;td&#40;{-colspan=&gt;2, -align=&gt;&#39;center&#39;}, $message&#41;,
                        	$cgi-&gt;td&#40;[&#39;Email Address: &#39;, $cgi-&gt;textfield&#40;-name=&gt;&#39;username&#39;, -value=&gt;$cgi-&gt;param&#40;&#39;username&#39;&#41;&#41;]&#41;,
                        	$cgi-&gt;td&#40;[&#39;Password: &#39;, $cgi-&gt;password_field&#40;-name=&gt;&#39;passwd&#39;, -value=&gt;&#39;&#39;&#41;]&#41;,
                       		$cgi-&gt;td&#40;{-colspan=&gt;2, -align=&gt;&#39;center&#39;},$cgi-&gt;submit&#40;-name=&gt;&#39;action&#39;, -value=&gt;&#39;Login&#39;&#41;&#41;,
                        	$cgi-&gt;td&#40;{-colspan=&gt;2, -align=&gt;&#39;center&#39;},&#39;&lt;A HREF=&#34;selfadmin?form=reset&#34;&gt;Reset Password&lt;/A&gt;&#39;&#41; ]&#41;&#41;,

                        $cgi-&gt;end_form&#41;;
		$self-&gt;req-&gt;print&#40; $self-&gt;footer &#41;;
		return OK;
        }
}

sub header {
	my $self = shift;
	my $cgi = $self-&gt;cgi;
	my $title = &#40; @_ ? shift : &#39;Reservation system&#39;&#41;;

	my @output;
	open HEADER, $self-&gt;config&#40;&#39;header&#39;&#41;;
	my $menu = $self-&gt;menu;
	while &#40;&lt;HEADER&gt; &#41; {
		$_ =~ s/__RESERVE__/$menu/;
                push @output, $_;
        }
        close HEADER;
	
	return $cgi-&gt;start_html&#40;-title =&gt; $title .  &#39;- Department of Medicinal Chemistry &#38; Pharmacognosy - UIC&#39;,
       		-encoding=&gt;&#39;utf-8&#39;,
        	-style=&gt;{&#39;src&#39;=&gt;[ &#39;/_styles/global.css&#39;, &#39;/_styles/style_nmr.css&#39;] },
        	-meta=&gt;{&#39;keywords&#39; =&gt; &#39;NMR, UIC, College of of Pharmacy, Chicago&#39;,
               	 	&#39;description&#39; =&gt; &#39;Reservation System - Department of Medicinal Chemistry &#38; Pharmacognosy - UIC&#39;}&#41;,
		@output, $cgi-&gt;h2&#40;{-class=&gt;&#39;boxTitle&#39;},$cgi-&gt;b&#40;$title&#41;&#41;;	
}

sub footer {
	my $self = shift;

	open FOOTER, $self-&gt;config&#40;&#39;footer&#39;&#41;;
	my @output = &lt;FOOTER&gt;;
	close FOOTER;
	
	return @output, &#39;&lt;/HTML&gt;&#39;;
}


sub menu {
        my $self = shift;
        my $cgi = $self-&gt;cgi;

        my @items = &#40; &#39;&lt;LI&gt;&lt;A HREF=&#34;main&#34;&gt;Reservation System&lt;/A&gt;&lt;/LI&gt;&#39; &#41;;
        if &#40; $self-&gt;user &#41; {
                my $user = $self-&gt;user;
                push @items, &#39;&lt;LI&gt;&lt;A HREF=&#34;selfadmin&#34;&gt;Update My Account&lt;/A&gt;&lt;/LI&gt;&#39;;
                if &#40; $user-&gt;hasRole&#40;&#39;admin&#39;&#41; &#41; { push @items, &#39;&lt;LI&gt;&lt;A HREF=&#34;admin&#34;&gt;Admin Page&lt;/A&gt;&lt;/LI&gt;&#39;; }
                push @items, &#39;&lt;LI&gt;&lt;A HREF=&#34;logout&#34;&gt;Logout&lt;/A&gt;&lt;/LI&gt;&#39;;        
        }
        return $cgi-&gt;ul&#40; @items &#41;
}

sub app {
	my $self = shift;

	if &#40;ref $_[0]&#41; {
		$self-&gt;{&#39;_app&#39;} = shift;
	}
	return $self-&gt;{&#39;_app&#39;};	
}

sub cgi {
	my $self = shift;
	return $self-&gt;app-&gt;cgi&#40;@_&#41;;
}

sub dbh {
	my $self = shift;
	return $self-&gt;app-&gt;dbh&#40;@_&#41;;
}

sub session {
	my $self = shift;
	return $self-&gt;app-&gt;session&#40;@_&#41;;
}

sub req {
	my $self = shift;
	return $self-&gt;app-&gt;req&#40;@_&#41;;
}

sub config {
	my $self = shift;
	return $self-&gt;req-&gt;dir_config&#40;@_&#41;;
}
1;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Reserve.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/403135/188791/Reserve.pm">Download Reserve.pm</a><br />
<span class="downloadcontenttype">text/x-perl 4.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Apps::Reserve;

use strict vars;
use Apache2::Const qw&#40;:common&#41;;
use CGI;
use CGI::Cookie;
use CGI::Session;
use DBI;

use Apps::Session;
use Apps::Reserve::Form;
use Apps::Reserve::User;

our $VERSION = &#39;0.5&#39;;

sub handler {
	my $r = shift;
		
	if &#40; $r-&gt;location eq $r-&gt;uri &#41; {
		$r-&gt;headers_out-&gt;set&#40;&#39;Location&#39; =&gt; $r-&gt;location . &#39;/&#39;&#41;;
		return REDIRECT;	
	}
	my $self = Apps::Reserve-&gt;new&#40;$r&#41;;
	return OK if $self-&gt;error;

	my $form = Apps::Reserve::Form-&gt;new&#40;$self&#41;;
	if &#40; $form &#41; {
		return $form-&gt;printForm;
	} else {
		$self-&gt;req-&gt;content_type&#40;&#39;text/plain&#39;&#41;;
		return;
	}
}

sub getMod {
	my $self = shift;

	warn &#39;Rec Object: &#39;, ref&#40;$self-&gt;req&#41;, &#39; Got URI: &#39;, $self-&gt;req-&gt;uri, 
		&#39; For location: &#39;, $self-&gt;req-&gt;location, &#39; Unparsed URI: &#39;, $self-&gt;req-&gt;unparsed_uri;

	my $pos = index&#40; $self-&gt;req-&gt;uri, $self-&gt;req-&gt;location&#41;;
	if &#40; $pos &lt; 0 &#41; {
		return;
	} else {
		my $len = length&#40;$self-&gt;req-&gt;location&#41;;
		my $module = $self-&gt;req-&gt;uri;
		substr&#40;$module, $pos, $len&#41; = &#39;&#39;;
		$module =~ s/^\///;
		$module =~ s/\?.+$//;
		return $module;
	}
}

sub new {
	my $self = {};
	bless $self, shift;
	$self-&gt;_init&#40;@_&#41;;
	return $self;
}

sub _init {
	my $self = shift;
	
	$self-&gt;req&#40;shift&#41;;
	$self-&gt;cgi&#40;shift&#41;;
	$self-&gt;dbh&#40;shift&#41;;
	$self-&gt;session&#40;&#41;-&gt;param&#40;&#39;last_req&#39; =&gt; $self-&gt;req-&gt;the_request&#41;;
	
	return;
}	

sub req {
	my $self = shift;
	if &#40; ref $_[0] &#41; {
		$self-&gt;{&#39;_req&#39;} = shift;
	}
	return $self-&gt;{&#39;_req&#39;};
}

sub cgi {
	my $self = shift;
	if &#40; ref $_[0] &#41; {
		$self-&gt;{&#39;_cgi&#39;} = shift;
	}
	if &#40; exists $self-&gt;{&#39;_cgi&#39;} &#41; {
		return $self-&gt;{&#39;_cgi&#39;};
	} else {
		$self-&gt;{&#39;_cgi&#39;} = CGI-&gt;new&#40;$self-&gt;req&#41;;
		if &#40; $self-&gt;req-&gt;unparsed_uri =~ /\?/ &#41; {
			use URI;
			use URI::QueryParam;
			my $uri = URI-&gt;new&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost">http://localhost</a></span>&#39; . $self-&gt;req-&gt;unparsed_uri&#41;;
			my $cgi = $self-&gt;{&#39;_cgi&#39;};
			foreach my $key &#40; $uri-&gt;query_param &#41; {
				$cgi-&gt;param&#40;$key, $uri-&gt;query_param&#40;$key&#41;&#41; if $cgi-&gt;param&#40;$key&#41; eq &#39;&#39;;
			}
		}
		return $self-&gt;{&#39;_cgi&#39;};
	}
	return;
}

sub dbh {
	my $self = shift;
	if &#40; ref $_[0] &#41; {
		$self-&gt;{&#39;_dbh&#39;} = shift;
	}
	if &#40; exists $self-&gt;{&#39;_dbh&#39;} &#41; {
		return $self-&gt;{&#39;_dbh&#39;};
	} else {
		my $dbh = DBI-&gt;connect&#40;$self-&gt;config&#40;&#39;DBI-URL&#39;&#41;, $self-&gt;config&#40;&#39;DBI-User&#39;&#41;, $self-&gt;config&#40;&#39;DBI-Pwd&#39;&#41;&#41; || 
			$self-&gt;add_err&#40;&#34;Connection failed: &#34;, DBI-&gt;errstr&#41;;
		$self-&gt;{&#39;_dbh&#39;} = $dbh;
		return $dbh;
	}
}

sub add_err {
	my $self = shift;
	warn &#40;@_&#41;;
	if &#40; exists $self-&gt;{&#39;_error&#39;} &#41; {
		push @{$self-&gt;{&#39;_error&#39;}}, join&#40;&#39; &#39;,@_&#41;;
	} else {
		$self-&gt;{&#39;_error&#39;} = [ join&#40;&#39; &#39;,@_&#41; ];
	}
	return;
}

sub error {
	my $self = shift;
	if &#40; exists $self-&gt;{&#39;_error&#39;} &#41; {
		my $r = $self-&gt;req;
		$r-&gt;content_type&#40;&#39;text/plain&#39;&#41;;
		$r-&gt;print&#40;join&#40;&#34;\n&#34;,@{$self-&gt;{&#39;_error&#39;}}&#41;, &#34;\n&#34;&#41;;
		return 1;
	} else {
		return;
	}
}
	

sub session {
	my $self = shift;
	my $req = $self-&gt;req;
	my %cookie = CGI::Cookie-&gt;parse&#40;$req-&gt;headers_in-&gt;{&#39;Cookie&#39;}&#41;;

	if &#40; ref $_[0] &#41; {
		$self-&gt;{&#39;_session&#39;} = shift;
	}
	if &#40; exists $self-&gt;{&#39;_session&#39;} &#41; {
		return $self-&gt;{&#39;_session&#39;};
	} else {
		if &#40; exists $cookie{&#39;SESSIONID&#39;} &#41; {
			$self-&gt;{&#39;_session&#39;}  = CGI::Session-&gt;new&#40;&#39;driver:MySQL&#39;, $cookie{&#39;SESSIONID&#39;}-&gt;value, 
				{Handle =&gt; $self-&gt;dbh}&#41;;
		} else {
			$self-&gt;{&#39;_session&#39;} = CGI::Session-&gt;new&#40;&#39;driver:MySQL&#39;, undef, {Handle =&gt; $self-&gt;dbh}&#41;;
			$self-&gt;{&#39;_session&#39;}-&gt;expires&#40;&#39;+1d&#39;&#41;;
			my $cookie = CGI::Cookie-&gt;new&#40;&#39;SESSIONID&#39; =&gt; $self-&gt;{&#39;_session&#39;}-&gt;id&#41;;
			$self-&gt;req-&gt;headers_out-&gt;add&#40;&#39;Set-Cookie&#39; =&gt; $cookie&#41;;
		}
		if &#40; $self-&gt;{&#39;_session&#39;}-&gt;param&#40;&#39;user&#39;&#41; &#41; {
			$self-&gt;req-&gt;user&#40;$self-&gt;{&#39;_session&#39;}-&gt;param&#40;&#39;user&#39;&#41;&#41;;
		}
		return $self-&gt;{&#39;_session&#39;};
	}
}

sub login {
	my $self = shift;

	return;
}
	
sub rc {
	my $self = shift;

	if &#40; @_ &#41; {
		$self-&gt;{&#39;_rc&#39;} = shift;
	}
	if &#40; exists $self-&gt;{&#39;_rc&#39;} &#41; {
		return $self-&gt;{&#39;_rc&#39;};	
	} else {
		return OK;
	}
}

sub user {
	my $self = shift;
	my $dbh = $self-&gt;dbh;
	
	if &#40; exists $self-&gt;{&#39;_user&#39;} &#41; {
		return $self-&gt;{&#39;_user&#39;};
	} elsif &#40; $self-&gt;req-&gt;user &#41; {
		$self-&gt;{&#39;_user&#39;} = Apps::Reserve::User-&gt;new&#40;$dbh, $self-&gt;req-&gt;user&#41;;
		return $self-&gt;{&#39;_user&#39;};
	} else {
		return;	
	}
	return;
}

sub user_list {
	my $self = shift;
	return unless $self-&gt;user-&gt;has_role&#40;&#39;admin&#39;&#41;;
	my @users;
	
	my $sql = &#39;SELECT user FROM users&#39;;
	
	foreach my $id &#40; @{$self-&gt;dbh-&gt;selectcol_arrayref&#40;$sql&#41;} &#41; {
		push @users, Apps::Reserve::User-&gt;new&#40;$self-&gt;dbh, $id&#41;;
	}

	return @users;
}

sub session_list {
	my $self = shift;
	return unless $self-&gt;user-&gt;has_role&#40;&#39;admin&#39;&#41;;
	my @sess;
	
	my $sql = &#39;SELECT id FROM sessions ORDER BY id&#39;;
	
	foreach my $id &#40; @{$self-&gt;dbh-&gt;selectcol_arrayref&#40;$sql&#41;} &#41; {
		push @sess, Apps::Session-&gt;new&#40;$self-&gt;dbh, $id&#41;;
	}

	return @sess;
}

sub app {
	my $self = shift;
	return $self;
}

sub config {
	my $self = shift;
	return $self-&gt;req-&gt;dir_config&#40;@_&#41;;
}

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-403152" href="/Public/Bug/Display.html?id=31974#txn-403152">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;28&nbsp;17:17:12&nbsp;2007</span>
    <span class="description">CHLIGE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> CHLIGE [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/403152/188804/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/188804">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Further analysis of the problem show that the URI is truncated when the
CGI module is created.

   warn $r-&gt;unparsed_uri, &#39;  &#39;, $r-&gt;uri;
   $self-&gt;{&#39;_cgi&#39;} = CGI-&gt;new&#40;$self-&gt;req&#41;;
   warn $r-&gt;unparsed_uri, &#39;  &#39;, $r-&gt;uri;
 

In error_log

/nmr/admin  /nmr/admin at /usr/local/http-apps/perl/Apps/Reserve.pm line 87.
/nmr/admin  /admin at /usr/local/http-apps/perl/Apps/Reserve.pm line 89.


On Fri Dec 28 16:43:50 2007, CHLIGE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m using mod_perl v2.0.1 &#40;from FC4 rpm&#41; and using the
&gt; Apache2::RequestRec-&gt;uri truncates the URI for /nmr/admin and only for
&gt; /nmr/admin &#40;i.e. /nmr/admi and /nmr/admin2 are fine&#41;.  
&gt; 
&gt; I have gone through my Apache configuration files and I cannot find a
&gt; redirector or URL rewriting statement.  Attached is the code for the
&gt; modules involved.
&gt; 
&gt; [gchlip2@anabaena Apps]$ perl -v
&gt; 
&gt; This is perl, v5.8.6 built for i386-linux-thread-multi
&gt; 
&gt; Copyright 1987-2004, Larry Wall
&gt; 
&gt; Perl may be copied only under the terms of either the Artistic License
&gt; or the
&gt; GNU General Public License, which may be found in the Perl 5 source kit.
&gt; 
&gt; Complete documentation for Perl, including FAQ lists, should be found on
&gt; this system using `man perl&#39; or `perldoc perl&#39;.  If you have access to the
&gt; Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.
&gt; 
&gt; [gchlip2@anabaena Apps]$ uname -a
&gt; Linux anabaena 2.6.13-1.1526_FC4 #1 Wed Sep 28 19:15:10 EDT 2005 i686
&gt; i686 i386 GNU/Linux
&gt; [root@anabaena httpd]# httpd -v
&gt; Server version: Apache/2.0.54
&gt; Server built:   Sep  2 2005 11:54:18
&gt; 
&gt; From httpd/error_log
&gt; 
&gt; [Fri Dec 28 15:17:09 2007] [notice] Apache/2.0.54 &#40;Fedora&#41; configured --
&gt; resuming normal operations
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/main For location: /nmr
&gt; Unparsed URI: /nmr/main at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/main For location: /nmr
&gt; Unparsed URI: /nmr/main at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /admin For location: /nmr
&gt; Unparsed URI: /nmr/admin at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/selfadmin For location:
&gt; /nmr Unparsed URI: /nmr/selfadmin at
&gt; /usr/local/http-apps/perl/Apps/Reserve.pm line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/selfadmin For location:
&gt; /nmr Unparsed URI: /nmr/selfadmin at
&gt; /usr/local/http-apps/perl/Apps/Reserve.pm line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/mydata For location: /nmr
&gt; Unparsed URI: /nmr/mydata at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/mydata For location: /nmr
&gt; Unparsed URI: /nmr/mydata at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/logout For location: /nmr
&gt; Unparsed URI: /nmr/logout at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/logout For location: /nmr
&gt; Unparsed URI: /nmr/logout at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/admin2 For location: /nmr
&gt; Unparsed URI: /nmr/admin2 at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; Rec Object: Apache2::RequestRec Got URI: /nmr/admi For location: /nmr
&gt; Unparsed URI: /nmr/admi at /usr/local/http-apps/perl/Apps/Reserve.pm
&gt; line 38.
&gt; 
&gt; 
&gt; [gchlip2@anabaena conf]$ ls
&gt; htpasswd  httpd.conf  httpd.conf.bak  httpd.conf.default  httpd.conf.old
&gt;  httpd-lab.conf  magic  ssl.crt  ssl.key  workers.properties
&gt; [gchlip2@anabaena conf]$ pwd
&gt; /etc/httpd/conf
&gt; [gchlip2@anabaena conf]$ grep Rewrite *
&gt; grep: ssl.crt: Permission denied
&gt; grep: ssl.key: Permission denied
&gt; [gchlip2@anabaena conf]$ cd ../conf.d
&gt; [gchlip2@anabaena conf.d]$ grep Rewrite *
&gt; grep: README: Permission denied
&gt; grep: ssl.conf.rpmnew: Permission denied
&gt; [gchlip2@anabaena conf.d]$ 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-885471" href="/Public/Bug/Display.html?id=31974#txn-885471">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;22&nbsp;21:24:57&nbsp;2011</span>
    <span class="description">PHRED [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/885471/458872/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/458872">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 65b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Can you try this with 2.04, or the 2.05 release candidate in svn?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-885474" href="/Public/Bug/Display.html?id=31974#txn-885474">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;22&nbsp;21:24:58&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.375274</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
