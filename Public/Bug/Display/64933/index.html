<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #64933 for Apache-AuthCookie: CPAN install as root fails at make test</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #64933 for Apache-AuthCookie: CPAN install as root fails at make test</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Apache-AuthCookie/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Apache-AuthCookie/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Apache-AuthCookie/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Apache-AuthCookie/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Apache-AuthCookie">Apache-AuthCookie CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">64933</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Apache-AuthCookie/Active/">Apache-AuthCookie</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
B.Candler [...] pobox.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-1208-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.15    </td>
  </tr>
  <tr id="CF-1209-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;15:48:35&nbsp;2011</span>
    <span class="description">B.Candler [...] pobox.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CPAN install as root fails at make test</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;version actually 3.16. rt doesn&#39;t offer that one yet :-&#41;

Thank you for rapid fix to #64926. However, now a CPAN install fails 
differently when run as root:

--------------------------
$ sudo cpan -i Apache2::AuthCookie
CPAN: Storable loaded ok &#40;v2.20&#41;
Going to read &#39;/home/sysadm/.cpan/Metadata&#39;
  Database was generated on Wed, 19 Jan 2011 19:36:18 GMT
Running install for module &#39;Apache2::AuthCookie&#39;
CPAN: YAML loaded ok &#40;v0.71&#41;
Running make for M/MS/MSCHOUT/Apache-AuthCookie-3.16.tar.gz
CPAN: Digest::SHA loaded ok &#40;v5.48&#41;
CPAN: Compress::Zlib loaded ok &#40;v2.02&#41;
Checksum for /home/sysadm/.cpan/sources/authors/id/M/MS/MSCHOUT/Apache-
AuthCookie-3.16.tar.gz ok
CPAN: Archive::Tar loaded ok &#40;v1.52&#41;
Apache-AuthCookie-3.16
Apache-AuthCookie-3.16/README
Apache-AuthCookie-3.16/Changes
Apache-AuthCookie-3.16/LICENSE
Apache-AuthCookie-3.16/dist.ini
Apache-AuthCookie-3.16/t
Apache-AuthCookie-3.16/t/real.t
Apache-AuthCookie-3.16/META.yml
Apache-AuthCookie-3.16/MANIFEST
Apache-AuthCookie-3.16/t/TEST.PL
Apache-AuthCookie-3.16/SIGNATURE
Apache-AuthCookie-3.16/weaver.ini
Apache-AuthCookie-3.16/Makefile.PL
Apache-AuthCookie-3.16/t/startup.pl
Apache-AuthCookie-3.16/MANIFEST.SKIP
Apache-AuthCookie-3.16/t/signature.t
Apache-AuthCookie-3.16/README.modperl2
Apache-AuthCookie-3.16/t/conf
Apache-AuthCookie-3.16/t/conf/extra.conf.in
Apache-AuthCookie-3.16/t/htdocs/docs
Apache-AuthCookie-3.16/t/htdocs/docs/login.pl
Apache-AuthCookie-3.16/t/htdocs/docs/logout.pl
Apache-AuthCookie-3.16/t/htdocs/docs/index.html
Apache-AuthCookie-3.16/lib/Apache
Apache-AuthCookie-3.16/lib/Apache/AuthCookie.pm
Apache-AuthCookie-3.16/lib/Apache2
Apache-AuthCookie-3.16/lib/Apache2/AuthCookie.pm
Apache-AuthCookie-3.16/t/htdocs/docs/echo_cookie.pl
Apache-AuthCookie-3.16/lib/Apache/AuthCookie
Apache-AuthCookie-3.16/lib/Apache/AuthCookie/Util.pm
Apache-AuthCookie-3.16/lib/Apache/AuthCookie/FAQ.pod
Apache-AuthCookie-3.16/t/Skeleton
Apache-AuthCookie-3.16/t/Skeleton/AuthCookieHandler.pm
Apache-AuthCookie-3.16/t/htdocs/docs/authany
Apache-AuthCookie-3.16/t/htdocs/docs/authany/get_me.html
Apache-AuthCookie-3.16/t/htdocs/docs/authall
Apache-AuthCookie-3.16/t/htdocs/docs/authall/get_me.html
Apache-AuthCookie-3.16/t/htdocs/docs/stimeout
Apache-AuthCookie-3.16/t/htdocs/docs/stimeout/get_me.html
Apache-AuthCookie-3.16/t/htdocs/docs/protected
Apache-AuthCookie-3.16/t/htdocs/docs/protected/get_me.html
Apache-AuthCookie-3.16/t/htdocs/docs/cookiename
Apache-AuthCookie-3.16/t/htdocs/docs/cookiename/get_me.html
Apache-AuthCookie-3.16/t/htdocs/docs/protected/echo_user.pl
Apache-AuthCookie-3.16/t/lib/Sample
Apache-AuthCookie-3.16/t/lib/Sample/AuthCookieHandler.pm.mp2
Apache-AuthCookie-3.16/t/lib/Sample/AuthCookieHandler.pm.mp1
CPAN: File::Temp loaded ok &#40;v0.22&#41;

  CPAN.pm: Going to build M/MS/MSCHOUT/Apache-AuthCookie-3.16.tar.gz

selected t/lib/Sample/AuthCookieHandler.pm.mp2
[   info] generating script t/TEST
Checking if your kit is complete...
Looks good
Writing Makefile for Apache::AuthCookie
cp lib/Apache/AuthCookie/Util.pm blib/lib/Apache/AuthCookie/Util.pm
cp lib/Apache2/AuthCookie.pm blib/lib/Apache2/AuthCookie.pm
cp lib/Apache/AuthCookie.pm blib/lib/Apache/AuthCookie.pm
cp lib/Apache/AuthCookie/FAQ.pod blib/lib/Apache/AuthCookie/FAQ.pod
Manifying blib/man3/Apache::AuthCookie::Util.3pm
Manifying blib/man3/Apache2::AuthCookie.3pm
Manifying blib/man3/Apache::AuthCookie.3pm
Manifying blib/man3/Apache::AuthCookie::FAQ.3pm
  MSCHOUT/Apache-AuthCookie-3.16.tar.gz
  /usr/bin/make -- OK
Running make test
/usr/bin/perl -Iblib/arch -Iblib/lib \
        t/TEST  -clean
[warning] setting ulimit to allow core files
ulimit -c unlimited; /usr/bin/perl /home/sysadm/.cpan/build/Apache-
AuthCookie-3.16-bxAwjI/t/TEST -clean
APACHE_TEST_GROUP= APACHE_TEST_HTTPD= APACHE_TEST_PORT= 
APACHE_TEST_USER= APACHE_TEST_APXS= \
        /usr/bin/perl -Iblib/arch -Iblib/lib \
        t/TEST  -bugreport -verbose=0 
[warning] setting ulimit to allow core files
ulimit -c unlimited; /usr/bin/perl /home/sysadm/.cpan/build/Apache-
AuthCookie-3.16-bxAwjI/t/TEST -bugreport -verbose=0
[  error] Apache cannot spawn child processes as root, therefore the 
test suite must be run as a non-privileged user.
make: *** [run_tests] Error 1
  MSCHOUT/Apache-AuthCookie-3.16.tar.gz
  /usr/bin/make test -- NOT OK
//hint// to see the cpan-testers results for installing this module, 
try:
  reports MSCHOUT/Apache-AuthCookie-3.16.tar.gz
Running make install
  make test had returned bad status, won&#39;t install without force
--------------------------

This error is coming from /usr/local/lib/perl/5.10.1/Apache/TestRun.pm

    if &#40;$user eq &#39;root&#39;&#41; {
        error &#34;Apache cannot spawn child processes as root, therefore 
the test suite must be run as a non-privileged user.&#34;;
        exit_perl&#40;0&#41;;
    }

This is different code to the one which comes with mod_perl2 in 
/usr/lib/perl5/Apache/TestRun.pm

  You are running the test suite under user &#39;root&#39;.
  Apache cannot spawn child processes as &#39;root&#39;, therefore
  we attempt to run the test suite with user &#39;$user&#39; &#40;$uid:$gid&#41;.

That code also skips the test suite if it finds the filesystem 
permissions are unsuitable for running apache as that uid/gid. That 
seems to be a reasonable thing to do, but it looks like the newer 
Apache::TestRun is less forgiving.
 
If I run cpan as a non-root user instead, the tests are OK, but copying 
the files to their final location fails:

--------------------------
...
  /usr/bin/make test -- OK
Running make install
Prepending /home/sysadm/.cpan/build/Apache-AuthCookie-3.16-
3_lFW0/blib/arch /home/sysadm/.cpan/build/Apache-AuthCookie-3.16-
3_lFW0/blib/lib to PERL5LIB for &#39;install&#39;
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
ERROR: Can&#39;t create &#39;/usr/local/man/man3&#39;
Do not have write permissions on &#39;/usr/local/man/man3&#39;
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 at -e line 1
make: *** [pure_site_install] Error 13
  MSCHOUT/Apache-AuthCookie-3.16.tar.gz
  /usr/bin/make install  -- NOT OK
----
  You may have to su to root to install the package
  &#40;Or you may want to run something like
    o conf make_install_make_command &#39;sudo make&#39;
  to raise your permissions.
--------------------------

The o conf option gives a potential workaround, but you have to remember 
to run cpan as a non-root user.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;15:56:10&nbsp;2011</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is an issue with your apache setup and Apache::Test, not
AuthCookie.  You would need to take this up with the maintainer of
Apache::Test
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;15:56:11&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;15:56:11&nbsp;2011</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;16:01:56&nbsp;2011</span>
    <span class="description">B.Candler [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> B.Candler [...] pobox.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Some additional info on versions. According to the log below, it looks 
like there is Apache::Test 1.31 in the base system; Apache::AuthCookie 
has a prerequisite of 1.32; and we actually get 1.34.

...
  CPAN.pm: Going to build M/MS/MSCHOUT/Apache-AuthCookie-3.16.tar.gz

selected t/lib/Sample/AuthCookieHandler.pm.mp2
[   info] generating script t/TEST
Checking if your kit is complete...
Looks good
Warning: prerequisite Apache::Test 1.32 not found. We have 1.31.
Writing Makefile for Apache::AuthCookie

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">---- Unsatisfied dependencies detected during ----
----   MSCHOUT/Apache-AuthCookie-3.16.tar.gz  ----
    Apache::Test [requires]
Shall I follow them and prepend them to the queue
of modules we are processing right now? [yes] 
Running make test
  Delayed until after prerequisites
Running make install
  Delayed until after prerequisites
Running install for module &#39;Apache::Test&#39;
Running make for P/PH/PHRED/Apache-Test-1.34.tar.gz
Fetching with LWP:
  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/CPAN/authors/id/P/PH/PHRED/Apache-Test-1.34.tar.gz">http://www.perl.org/CPAN/authors/id/P/PH/PHRED/Apache-Test-1.34.tar.gz</a></span>
...
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;16:01:56&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;16:36:02&nbsp;2011</span>
    <span class="description">B.Candler [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> B.Candler [...] pobox.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 19 15:56:10 2011, MSCHOUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is an issue with your apache setup and Apache::Test, not
&gt; AuthCookie.  You would need to take this up with the maintainer of
&gt; Apache::Test
</div>
AuthCookie has a dependency on a specific version of Apache::Test. Is 
there a reason for that?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;16:58:34&nbsp;2011</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 19 16:01:56 2011, B.Candler@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Some additional info on versions. According to the log below, it looks 
&gt; like there is Apache::Test 1.31 in the base system; Apache::AuthCookie 
&gt; has a prerequisite of 1.32; and we actually get 1.34.
</div>
This is all correct.

The prerequisite means *AT LEAST* 1.32.  1.34 is the latest at this time.

You need at least 1.32 because 1.31 will not configure properly where
libapreq is not available &#40;such as Ubuntu 10.10&#41;.  I tested this.

The fact that tests do not work as root is because of Apache::Test, not
AuthCookie.

Apache::Test has apparently made a decision to fail the test suite when
you try to run it as root.  I have no idea what if there is a suggested
workaround for that &#40;e.g.: environment variables, command line args to
Makefile.PL&#41; or not.  You would need to ask the Apache::Test guys.

You cannot downgrade to an earlier version of Apache::Test because that
will fail for a different reason &#40;no libapreq causes failure&#41;.

There is nothing I can do about this.  The problem is Apache::Test.

Apache::Test change log has multiple references to running tests as root
including:

1.34:
- Don&#39;t attempt to run the test suite as root. The workarounds needed to
facilitate root testing cause large maintenance costs, and return no
tangible benefits. [Fred Moyer]

1.33:
- <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=54476">https://rt.cpan.org/Public/Bug/Display.html?id=54476</a></span> Fix error where
non root user gets test failure with httpd suexec and mod_fcgid [Peter
&#40;Stig&#41; Edwards]





Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;16:58:35&nbsp;2011</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;17:51:53&nbsp;2011</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Although the problem is in Apache::Test, I&#39;ve released 3.17 just now
that works around this.

If you are running as root, it skips the tests entirely.  3.17 should
work for you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;17:51:54&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;10:24:28&nbsp;2011</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;10:47:59&nbsp;2011</span>
    <span class="description">PHRED [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Michael,

Brian Candler referred me to this RT ticket.  Can you take a look at the way Apache2::Dispatch 
used Apache::Test to run the tests?  Because of several test failures when running Apache::Test 
tests as root, Apache::Test was modified so that the Makefile test target skips the test if root is 
the current user.

The core problem is using Apache::Test as a test dependency as oppose to using it as a 
Makefile.PL prerequisite.  The preferred method is to create a Makefile dependent test target so 
that the tests are skipped if Apache::Test is not installed.

Please let me know how I can be of help here.

- Fred
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;10:48:00&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;11:17:51&nbsp;2011</span>
    <span class="description">mschout [...] gkg.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> PHRED [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64933] CPAN install as root fails at make test</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Jan 2011 10:17:39 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Apache-AuthCookie [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael Schout &lt;mschout [...] gkg.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/20/2011 09:47 AM,  via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Apache-AuthCookie
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=64933">https://rt.cpan.org/Ticket/Display.html?id=64933</a></span> &gt;
&gt; 
&gt; Hi Michael,
&gt; 
&gt; Brian Candler referred me to this RT ticket.  Can you take a look at the way Apache2::Dispatch 
&gt; used Apache::Test to run the tests?  Because of several test failures when running Apache::Test 
&gt; tests as root, Apache::Test was modified so that the Makefile test target skips the test if root is 
&gt; the current user.
</div>
Yes, it skips the tests, but exists with non-zero status, which as far
as &#34;make test&#34; is concerned, is the same thing as if we tried to run
them and failed.  Unless I am missing something, this makes it
impossible to install a modules that uses Apache::Tests via CPAN.pm when
running as root without a some Makefile.PL gymnastics.

I was going to look into fixing this in Apache::Test today, but in the
meantime, I worked around it with this patch in my module:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mschout/apache-authcookie/commit/19eebdb">https://github.com/mschout/apache-authcookie/commit/19eebdb</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The core problem is using Apache::Test as a test dependency as oppose to using it as a 
&gt; Makefile.PL prerequisite.  The preferred method is to create a Makefile dependent test target so 
&gt; that the tests are skipped if Apache::Test is not installed.
</div>
This is precisely what i have done.  But it seems like an awful lot of
Makefile.PL cruft &#40;60 or so lines&#41;.  Shouldn&#39;t Apache::Test add a
Makefile target that exists with zero status if running as root?

Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;11:24:33&nbsp;2011</span>
    <span class="description">fred [...] redhotpenguin.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64933] CPAN install as root fails at make test</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Jan 2011 08:24:23 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Apache-AuthCookie [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Fred Moyer &lt;fred [...] redhotpenguin.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jan 20, 2011 at 8:17 AM, Michael Schout &lt;mschout@gkg.net&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 01/20/2011 09:47 AM,  via RT wrote:
<div class="message-stanza open">&gt;&gt;        Queue: Apache-AuthCookie
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=64933">https://rt.cpan.org/Ticket/Display.html?id=64933</a></span> &gt;
&gt;&gt;
&gt;&gt; Hi Michael,
&gt;&gt;
&gt;&gt; Brian Candler referred me to this RT ticket.  Can you take a look at the way Apache2::Dispatch
&gt;&gt; used Apache::Test to run the tests?  Because of several test failures when running Apache::Test
&gt;&gt; tests as root, Apache::Test was modified so that the Makefile test target skips the test if root is
&gt;&gt; the current user.
</div>&gt;
&gt; Yes, it skips the tests, but exists with non-zero status, which as far
&gt; as &#34;make test&#34; is concerned, is the same thing as if we tried to run
&gt; them and failed.  Unless I am missing something, this makes it
&gt; impossible to install a modules that uses Apache::Tests via CPAN.pm when
&gt; running as root without a some Makefile.PL gymnastics.
</div>
Ah - thanks for the spot.  In my tests, it returned a zero exit
status, but I just tried with Apache::Dispatch as root and it is
returning non-zero, even though the AT code specifies a zero exit
status there.  Let me hack on this today and see if I can get it
resolved.

Thanks for responding here; these changes were meant to avoid more
Makefile.PL gymnastics :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;12:29:23&nbsp;2011</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
