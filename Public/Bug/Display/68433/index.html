<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68433 for AnyEvent-STOMP: Messages after the first fail to be received properly</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68433 for AnyEvent-STOMP: Messages after the first fail to be received properly</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/AnyEvent-STOMP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/AnyEvent-STOMP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/AnyEvent-STOMP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/AnyEvent-STOMP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/AnyEvent-STOMP">AnyEvent-STOMP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68433</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/AnyEvent-STOMP/Active/">AnyEvent-STOMP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
TJC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-235330-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.6    </td>
  </tr>
  <tr id="CF-235331-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;05:13:54&nbsp;2011</span>
    <span class="description">TJC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Messages after the first fail to be received properly</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m connecting to Apache ActiveMQ 5.5.0 with AnyEvent::STOMP.
I&#39;ve already applied the patch for correct content-length on undef 
bodies, as per my previous bug report.

The first MESSAGE to be received will work correctly. All subsequent ones 
will fail.

This appears to be because AE::STOMP is inserting an extra \n in the 
$raw_headers in _receive_frame&#40;&#41;.
So instead of them looking like &#34;MESSAGE\n&#34; it looks like &#34;\nMESSAGE\n&#34;.

Thus, the event is dispatched to the event of type &#34;&#34; rather than 
MESSAGE.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;05:17:13&nbsp;2011</span>
    <span class="description">TJC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My kludge for the time being is to add this to line 257:

            $raw_headers =~ s/^\n//;

But I&#39;m sure there&#39;s a better way. I&#39;m suspicious that maybe you&#39;re not 
reading the correct amount of data in from the previous message, and are 
thus off-by-one, leaving a trailing carriage return?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;05:17:14&nbsp;2011</span>
    <span class="description">TJC [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;16:24:44&nbsp;2011</span>
    <span class="description">OTTERLEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t think it&#39;s related to the send_frame&#40;&#41; issue you posted earlier.  Instead, I suspect this is 
because ActiveMQ is padding the output with additional bytes.  &#40;I pleaded with the STOMP 
protocol folks not to do this, but they refused to listen.&#41;

I&#39;m puzzled as to why you have to trim leading line feeds off $raw_headers.  The regex should 
be ignoring them for you:

$self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/\n*&#40;[^\n].*?&#41;\n\n/s, ...

What happens if you left-anchor the regexp?

$self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/^\n*&#40;[^\n].*?&#41;\n\n/s, ...

Also, if you could provide a dump of the contents of $raw_headers when this happens, I&#39;d 
appreciate it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;16:24:45&nbsp;2011</span>
    <span class="description">OTTERLEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t think it&#39;s related to the send_frame&#40;&#41; issue you posted earlier.  Instead, I suspect this is 
because ActiveMQ is padding the output with additional bytes.  &#40;I pleaded with the STOMP 
protocol folks not to do this, but they refused to listen.&#41;

I&#39;m puzzled as to why you have to trim leading line feeds off $raw_headers.  The regex should 
be ignoring them for you:

$self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/\n*&#40;[^\n].*?&#41;\n\n/s, ...

What happens if you left-anchor the regexp?

$self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/^\n*&#40;[^\n].*?&#41;\n\n/s, ...

Also, if you could provide a dump of the contents of $raw_headers when this happens, I&#39;d 
appreciate it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;21:32:24&nbsp;2011</span>
    <span class="description">TJC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is the output of the raw headers.
I&#39;ve surrounded them with {{{ and }}} so you can tell where the whitespace ends.

In this example, the CONNECTED and first MESSAGE works, but the second MESSAGE does not 
get through to my app. Notice that it has a \n at the start of the headers.


Headers{{{CONNECTED
session:ID:adonai-49241-1306224515617-4:64

}}}
Headers{{{MESSAGE
message-id:ID:adonai-49241-1306224515617-4:65:-1:1:1
destination:/queue/testmail
timestamp:1306287038310
expires:0
content-length:13
priority:4

}}}
Headers{{{
MESSAGE
message-id:ID:adonai-49241-1306224515617-4:65:-1:1:2
destination:/queue/testmail
timestamp:1306287041312
expires:0
content-length:13
priority:4

}}}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;21:34:59&nbsp;2011</span>
    <span class="description">TJC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 24 16:24:45 2011, OTTERLEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/\n*&#40;[^\n].*?&#41;\n\n/s, ...
&gt; 
&gt; What happens if you left-anchor the regexp?
&gt; 
&gt; $self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/^\n*&#40;[^\n].*?&#41;\n\n/s, ...
</div>
Changing the regex doesn&#39;t seem to help - the raw headers are the same as 
before for the messages after the first.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;21:52:49&nbsp;2011</span>
    <span class="description">TJC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 24 21:34:59 2011, TJC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue May 24 16:24:45 2011, OTTERLEY wrote:
<div class="message-stanza open">&gt; &gt; $self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/\n*&#40;[^\n].*?&#41;\n\n/s, ...
&gt; &gt; 
&gt; &gt; What happens if you left-anchor the regexp?
&gt; &gt; 
&gt; &gt; $self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/^\n*&#40;[^\n].*?&#41;\n\n/s, ...
</div>&gt; 
&gt; Changing the regex doesn&#39;t seem to help - the raw headers are the same 
</div>as 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; before for the messages after the first.
</div>

The regex for AnyEvent::Handle there is matching the final line of the 
headers, I think? So changing it won&#39;t effect the first line of the 
headers.

It seems like a new-line is being carried over from the part where the 
code reads the body of the message in.

In my case, I can fix it like so:

                @args = &#40;&#39;chunk&#39; =&gt; $content_length + 2&#41;;

&#40;rather than the original, which is $content_length + 1&#41;

That looks like ActiveMQ is sending an extraneous carriage return after 
the terminating NULL byte to me. Hmm.


An alternative solution is to change the regex that pulls out the 
initial COMMAND line to this:

            if &#40;$raw_headers =~ s/^\n*&#40;.+&#41;\n//&#41; {
                $command = $1;
            }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;21:59:57&nbsp;2011</span>
    <span class="description">OTTERLEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 24 21:52:49 2011, TJC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue May 24 21:34:59 2011, TJC wrote:
<div class="message-stanza open">&gt; &gt; On Tue May 24 16:24:45 2011, OTTERLEY wrote:
<div class="message-stanza open">&gt; &gt; &gt; $self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/\n*&#40;[^\n].*?&#41;\n\n/s, ...
&gt; &gt; &gt; 
&gt; &gt; &gt; What happens if you left-anchor the regexp?
&gt; &gt; &gt; 
&gt; &gt; &gt; $self-&gt;{handle}-&gt;unshift_read&#40;regex =&gt; qr/^\n*&#40;[^\n].*?&#41;\n\n/s, ...
</div>&gt; &gt; 
&gt; &gt; Changing the regex doesn&#39;t seem to help - the raw headers are the same 
</div>&gt; as 
<div class="message-stanza open">&gt; &gt; before for the messages after the first.
</div>&gt; 
&gt; 
&gt; The regex for AnyEvent::Handle there is matching the final line of the 
&gt; headers, I think? So changing it won&#39;t effect the first line of the 
&gt; headers.
</div>
Well, the intent of the regex is:

1&#41; skip any newlines until the first non-LF is encountered, then
2&#41; read and capture all data up till the next \n\n is encountered &#40;i.e., the headers&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That looks like ActiveMQ is sending an extraneous carriage return after 
&gt; the terminating NULL byte to me. Hmm.
</div>
Indeed, it is.  I&#39;m not a fan of the STOMP protocol for that reason.  &#40;Their justification is that 
they wanted to make it easy to interact with via telnet.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; An alternative solution is to change the regex that pulls out the 
&gt; initial COMMAND line to this:
&gt; 
&gt;             if &#40;$raw_headers =~ s/^\n*&#40;.+&#41;\n//&#41; {
&gt;                 $command = $1;
&gt;             }
</div>
That&#39;s an OK workaround, I suppose, but I&#39;d sure like to know why my initial regex is 
defective.  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;22:21:13&nbsp;2011</span>
    <span class="description">TJC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The regex for AnyEvent::Handle there is matching the final line of
</div>&gt; the
<div class="message-stanza open">&gt; &gt; headers, I think? So changing it won&#39;t effect the first line of the
&gt; &gt; headers.
</div>&gt; 
&gt; Well, the intent of the regex is:
&gt; 
&gt; 1&#41; skip any newlines until the first non-LF is encountered, then
&gt; 2&#41; read and capture all data up till the next \n\n is encountered
&gt; &#40;i.e., the headers&#41;
</div>[snip] 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d sure like to know why my initial regex is defective.
</div>
I don&#39;t think the regex is being used in the way you think it is.
The docs for AnyEvent::Handle say that when passing a regex in, it&#39;s used to match the *end* of 
the block of data you want. &#40;If I have read the docs correctly&#41;
Then everything up until that point is sent through, and goes into $raw_headers.

So you can&#39;t skip characters by using that regex, I think. Umm, I could be wrong though.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
