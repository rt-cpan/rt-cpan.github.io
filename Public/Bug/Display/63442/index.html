<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63442 for File-KeePass: File::KeePass group hierarchy bug</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63442 for File-KeePass: File::KeePass group hierarchy bug</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/File-KeePass/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/File-KeePass/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/File-KeePass/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/File-KeePass/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-KeePass">File-KeePass CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63442</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">30 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/File-KeePass/Active/">File-KeePass</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Lester Hightower
(no email address)

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-233724-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.01    </td>
  </tr>
  <tr id="CF-233725-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;29&nbsp;10:55:48&nbsp;2010</span>
    <span class="description">Lester Hightower -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> File::KeePass group hierarchy bug</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">File::KeePass messes up the group hierarchy any time parse_groups&#40;&#41; 
encounters a structure where one moves more than one level &#34;up&#34; in a 
tree. Here is an example:

 - hello
   - world
     - i am sam
 - goodbye

In this case, the group &#34;goodbye&#34; will mistakenly be placed inside of 
the group &#34;hello&#34; instead of at the root level, and all later root 
groups will be place an increasing level deeper. This problem only seems 
to occur if the &#34;move up&#34; is greater than 1 level. I am pretty sure 
there is a mistake inside the conditional &#34;if &#40;$previous_level &gt; 
$level&#41;&#34; in parse_groups&#40;&#41; and I suspect that the issue is with the 
splice&#40;&#41; operation, but I am struggling to grok exactly what that code 
is doing.

It would be great if the original author could have a quick look at it 
as he may see the problem straight away...

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;29&nbsp;11:13:33&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 29 10:55:48 2010, lester.hightower@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; File::KeePass messes up the group hierarchy any time parse_groups&#40;&#41; 
&gt; encounters a structure where one moves more than one level &#34;up&#34; in a 
&gt; tree. Here is an example:
&gt; 
&gt;  - hello
&gt;    - world
&gt;      - i am sam
&gt;  - goodbye
&gt; 
&gt; In this case, the group &#34;goodbye&#34; will mistakenly be placed inside of 
&gt; the group &#34;hello&#34; instead of at the root level, and all later root 
&gt; groups will be place an increasing level deeper. This problem only
&gt; seems to occur if the &#34;move up&#34; is greater than 1 level. I am pretty
&gt; sure there is a mistake inside the conditional &#34;if &#40;$previous_level &gt; 
&gt; $level&#41;&#34; in parse_groups&#40;&#41; and I suspect that the issue is with the 
&gt; splice&#40;&#41; operation, but I am struggling to grok exactly what that code 
&gt; is doing.
&gt; 
&gt; It would be great if the original author could have a quick look at it 
&gt; as he may see the problem straight away...
&gt; 
&gt; Thanks.
</div>

In follow up to this, I _think_ I figured this problem out but would 
sure like the original author to verify it.

My tiny change in parse_groups&#40;&#41;:

&lt; splice @gref, $previous_level, $previous_level - $level, &#40;&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; splice @gref, -1*$previous_level, $previous_level - $level, &#40;&#41;;
</div>
which seems to fix the problem and is the desired behavior _if_ I am 
understanding the structure of @gref correctly.

Sincerely,
Lester Hightower
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;29&nbsp;11:46:05&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[...snip...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In follow up to this, I _think_ I figured this problem out...
</div>[...snip...]


...I spoke too soon.  :&#40;

I&#39;ll try to look into this more later. No time now.

--
Lester
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;23:31:28&nbsp;2010</span>
    <span class="description">Paul Seamons -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63442] File::KeePass group hierarchy bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Dec 2010 21:22:09 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-File-KeePass [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Seamons &lt;paul [...] seamons.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your interest.  I finally took some time tonight and added 
a unit test for your exact problem.  The problem duplicated itself 
exactly.  The @gref acts as a stack of ref pointers to the various 
groups.  When the level is less than the previously stored level we have 
to  unwind the stack.  I&#39;m not exactly sure what I was thinking with 
that particular line.  Here is the replacement line:

                 splice @gref, $level, @gref - $level, &#40;&#41;;

We need to remove any levels above the level that we are moving back to 
- the last code sort of did it in the wrong direction.  This new chunk 
lops off the branches correctly.

I&#39;ve also added the following as part of the unit tests:


# test for correct stack unwinding during the parse_group phase
my $obj2 = File::KeePass-&gt;new;
my $G = $obj2-&gt;add_group&#40;{
     title =&gt; &#39;hello&#39;,
}&#41;;
$G = $obj2-&gt;add_group&#40;{
     title =&gt; &#39;world&#39;,
     group =&gt; $G,
}&#41;;
$G = $obj2-&gt;add_group&#40;{
     title =&gt; &#39;i am sam&#39;,
     group =&gt; $G,
}&#41;;
$G = $obj2-&gt;add_group&#40;{
     title =&gt; &#39;goodbye&#39;,
}&#41;;
$dump = eval { $obj2-&gt;dump_groups };
diag&#40;$dump&#41;;

my $ok = $obj2-&gt;parse_db&#40;$obj2-&gt;gen_db&#40;$pass&#41;, $pass&#41;;
my $dump2 = eval { $obj2-&gt;dump_groups };
#diag&#40;$dump&#41;;
is&#40;$dump, $dump2, &#34;Dumps should match after gen_db-&gt;parse_db&#34;&#41;;

I got started on adding keepass2 files, I may try and get that done and 
out to, but I&#39;ll get this patch out hopefully early next week.  I&#39;ll 
comment more on your other emails soon.

Thanks again.

Paul



On 11/29/2010 09:13 AM, Lester Hightower via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: File-KeePass
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63442">https://rt.cpan.org/Ticket/Display.html?id=63442</a></span>&gt;
&gt;
&gt; On Mon Nov 29 10:55:48 2010, lester.hightower@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; File::KeePass messes up the group hierarchy any time parse_groups&#40;&#41;
&gt;&gt; encounters a structure where one moves more than one level &#34;up&#34; in a
&gt;&gt; tree. Here is an example:
&gt;&gt;
&gt;&gt;   - hello
&gt;&gt;     - world
&gt;&gt;       - i am sam
&gt;&gt;   - goodbye
&gt;&gt;
&gt;&gt; In this case, the group &#34;goodbye&#34; will mistakenly be placed inside of
&gt;&gt; the group &#34;hello&#34; instead of at the root level, and all later root
&gt;&gt; groups will be place an increasing level deeper. This problem only
&gt;&gt; seems to occur if the &#34;move up&#34; is greater than 1 level. I am pretty
&gt;&gt; sure there is a mistake inside the conditional &#34;if &#40;$previous_level&gt;
&gt;&gt; $level&#41;&#34; in parse_groups&#40;&#41; and I suspect that the issue is with the
&gt;&gt; splice&#40;&#41; operation, but I am struggling to grok exactly what that code
&gt;&gt; is doing.
&gt;&gt;
&gt;&gt; It would be great if the original author could have a quick look at it
&gt;&gt; as he may see the problem straight away...
&gt;&gt;
&gt;&gt; Thanks.
</div>&gt;
&gt; In follow up to this, I _think_ I figured this problem out but would
&gt; sure like the original author to verify it.
&gt;
&gt; My tiny change in parse_groups&#40;&#41;:
&gt;
&gt; &lt;  splice @gref, $previous_level, $previous_level - $level, &#40;&#41;;
<div class="message-stanza open">&gt;&gt; splice @gref, -1*$previous_level, $previous_level - $level, &#40;&#41;;
</div>&gt; which seems to fix the problem and is the desired behavior _if_ I am
&gt; understanding the structure of @gref correctly.
&gt;
&gt; Sincerely,
&gt; Lester Hightower
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;23:31:29&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;23:38:56&nbsp;2010</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken">30 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The hierarchy bug is fixed, as is the parsing of dates from the group
entry.  Keepassx did not parse those headers.  The keepass windows code
did.  All I needed to know was which field type indexes matched which
field names.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;23:38:57&nbsp;2010</span>
    <span class="description">paul [...] seamons.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;23:39:22&nbsp;2010</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 03 23:38:56 2010, RHANDOM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The hierarchy bug is fixed, as is the parsing of dates from the group
&gt; entry.  Keepassx did not parse those headers.  The keepass windows code
&gt; did.  All I needed to know was which field type indexes matched which
&gt; field names.
</div>
I forgot to say - 0.02 has been uploaded to cpan.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;23:39:23&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;04&nbsp;10:38:44&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 03 23:38:56 2010, RHANDOM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The hierarchy bug is fixed, as is the parsing of dates from the group
&gt; entry.  Keepassx did not parse those headers.  The keepass windows
&gt; code did.  All I needed to know was which field type indexes matched
&gt; which field names.
</div>
Paul,

I had a chance to test 0.02 this morning and hate to have to report that 
the hierarchy bug is not fixed and the new code actually breaks the 
hierarchy in a worse way &#40;one that I see no easy work-around for&#41;. I am 
going to spend a little time trying to wrap my brain around the code 
again, but I&#39;m still struggling to fully understand the technique you 
are using there. I wish I could share my personal password db with you, 
but obviously can&#39;t...

Try building up this hierarchy:

- personal
  - career
  - finance
    - banking
    - credit
  - health
  - web
    - hosting
    - mail
- Foo

I *think* that type of hierarchy will expose both the old bug and the 
new one -- both 0.01 and 0.02 should parse that hierarchy incorrectly.

Sincerely,

--
Lester
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;04&nbsp;10:51:24&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Dec 04 10:38:44 2010, lester.hightower@gmail.com wrote:
[...snip...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the hierarchy bug is not fixed and the new code actually breaks the 
&gt; hierarchy in a worse way &#40;one that I see no easy work-around for&#41;.
&gt; I am going to spend a little time trying to wrap my brain around the
&gt; code again...
</div>[...snip...]

Paul,

I think I figured it out -- at least this works in my test cases:

&lt; splice @gref, $level, @gref - $level, &#40;&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; splice @gref, -1*&#40;$previous_level-$level&#41;, $previous_level-$level, &#40;&#41;;
</div>
I hope I got this right and that you agree and can ship a v0.03.

Thanks!

Lester
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;06&nbsp;21:50:07&nbsp;2010</span>
    <span class="description">brian [...] bldewolf.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> brian [...] bldewolf.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Dec 04 10:38:44 2010, lester.hightower@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Try building up this hierarchy:
&gt; 
&gt; - personal
&gt;   - career
&gt;   - finance
&gt;     - banking
&gt;     - credit
&gt;   - health
&gt;   - web
&gt;     - hosting
&gt;     - mail
&gt; - Foo
&gt; 
&gt; I *think* that type of hierarchy will expose both the old bug and the 
&gt; new one -- both 0.01 and 0.02 should parse that hierarchy incorrectly.
&gt; 
</div>
I believe the cleanest fix is to change the splice to:
                splice @gref, $level + 1;

When we move down in levels, our goal is to delete any references higher
than the current level.  This line achieves exactly that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;07&nbsp;01:13:19&nbsp;2010</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you again.  Fixed again.  And the logic is even more simplified -
which is usually a good thing.  0.03 is on its way to cpan.

On Mon Dec 06 21:50:07 2010, bldewolf wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Dec 04 10:38:44 2010, lester.hightower@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Try building up this hierarchy:
&gt; &gt; 
&gt; &gt; - personal
&gt; &gt;   - career
&gt; &gt;   - finance
&gt; &gt;     - banking
&gt; &gt;     - credit
&gt; &gt;   - health
&gt; &gt;   - web
&gt; &gt;     - hosting
&gt; &gt;     - mail
&gt; &gt; - Foo
&gt; &gt; 
&gt; &gt; I *think* that type of hierarchy will expose both the old bug and the 
&gt; &gt; new one -- both 0.01 and 0.02 should parse that hierarchy incorrectly.
&gt; &gt; 
</div>&gt; 
&gt; I believe the cleanest fix is to change the splice to:
&gt;                 splice @gref, $level + 1;
&gt; 
&gt; When we move down in levels, our goal is to delete any references higher
&gt; than the current level.  This line achieves exactly that.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;07&nbsp;01:13:20&nbsp;2010</span>
    <span class="description">paul [...] seamons.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;07&nbsp;01:20:56&nbsp;2010</span>
    <span class="description">Paul Seamons -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63442] File::KeePass group hierarchy bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 06 Dec 2010 23:20:43 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-File-KeePass [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Seamons &lt;paul [...] seamons.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That was interesting.  I got your email after sending on to cpan - that 
would&#39;ve saved me 15 minutes of fixing the latest test case.  My fix was 
exactly the same as yours - with some other code removed as well - the 
cases are much more simplified and explained.  Not sure what I was 
thinking the first time.  Since your code suggestion was identical to 
the fix already uploaded, I&#39;ve back ported the Changes to mention your fix.

All of my group use cases to date have had very simple hierarchies.  
Though the submitted hierarchies are simple, it helps to have them as 
unit tests as it quickly exposes the breaking points.

Thank you for your interest and suggestions.

Paul

On 12/06/2010 07:50 PM, Brian De Wolf via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: File-KeePass
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63442">https://rt.cpan.org/Ticket/Display.html?id=63442</a></span>&gt;
&gt;
&gt; On Sat Dec 04 10:38:44 2010, lester.hightower@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; Try building up this hierarchy:
&gt;&gt;
&gt;&gt; - personal
&gt;&gt;    - career
&gt;&gt;    - finance
&gt;&gt;      - banking
&gt;&gt;      - credit
&gt;&gt;    - health
&gt;&gt;    - web
&gt;&gt;      - hosting
&gt;&gt;      - mail
&gt;&gt; - Foo
&gt;&gt;
&gt;&gt; I *think* that type of hierarchy will expose both the old bug and the
&gt;&gt; new one -- both 0.01 and 0.02 should parse that hierarchy incorrectly.
&gt;&gt;
</div>&gt; I believe the cleanest fix is to change the splice to:
&gt;                  splice @gref, $level + 1;
&gt;
&gt; When we move down in levels, our goal is to delete any references higher
&gt; than the current level.  This line achieves exactly that.
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;07&nbsp;01:20:57&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;09:09:07&nbsp;2012</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This was resolved a long long time ago, but I replied the thread thus
reopening it.

We now also have support for keepass2 files.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;09:09:08&nbsp;2012</span>
    <span class="description">paul [...] seamons.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
