<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #112723 for File-NFSLock: Possible RFE for Perl File::NFSLock</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #112723 for File-NFSLock: Possible RFE for Perl File::NFSLock</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/File-NFSLock/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/File-NFSLock/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/File-NFSLock/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/File-NFSLock/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-NFSLock">File-NFSLock CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">112723</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/File-NFSLock/Active/">File-NFSLock</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pandrew [...] nvidia.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12996-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12997-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;05&nbsp;15:08:19&nbsp;2016</span>
    <span class="description">pandrew [...] nvidia.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Possible RFE for Perl File::NFSLock</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 5 Mar 2016 20:08:02 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-NFSLock [...] rt.cpan.org&#34; &lt;bug-File-NFSLock [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Phil Andrew &lt;pandrew [...] nvidia.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, Rob -

Have you considered the possible enhancement to File::NFSLock of including the UID &#40;or full domain name?&#41; of the locker in the *.NFSLock file?

In my usage of this module I would find that to be a useful addition to the lock file...

Perhaps this info is not there thoughtfully, e.g. maybe there are security/privacy considerations that I&#39;m overlooking - if so I&#39;d be interested to hear about them.

Thanks in advance for your response,
+Phil

-----------------------------------------------------------------------------------
This email message is for the sole use of the intended recipient&#40;s&#41; and may contain
confidential information.  Any unauthorized review, use, disclosure or distribution
is prohibited.  If you are not the intended recipient, please contact the sender by
reply email and destroy all copies of the original message.
-----------------------------------------------------------------------------------
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;05&nbsp;18:22:10&nbsp;2016</span>
    <span class="description">bbb [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, it already includes the hostname within the lock_file:

File-NFSLock/lib/File/NFSLock.pm:110:    $HOSTNAME = Sys::Hostname::hostname&#40;&#41;;
File-NFSLock/lib/File/NFSLock.pm:311:  $self-&gt;{lock_line} ||= &#34;$HOSTNAME $self-&gt;{lock_pid} &#34;.time&#40;&#41;.&#34; &#34;.int&#40;rand&#40;&#41;*10000&#41;.&#34;\n&#34;;


We&#39;ve always set the `hostname` to be the fully qualified hostname. Always expanding the hostname to include the fqdn might help reduce chances of conflicting similar hostnames with different suffixes on those system with a short hostname as the system hostname.


And it uses kill 0 to test if the process is running on the same host. It was assumed that the same user would be reading or writing to the same file. But including the UID might help reduce the chances of falsely removing sibling users that still have a live lock that are running on the same machine.

So I think your suggestion is appropriate.

Can you provide a pull request to include both of these improvements, for the FQDN and for the UID?

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/hookbot/File-NFSLock">https://github.com/hookbot/File-NFSLock</a></span>

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;05&nbsp;18:22:10&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;05&nbsp;18:59:14&nbsp;2016</span>
    <span class="description">pandrew [...] nvidia.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #112723] Possible RFE for Perl File::NFSLock</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 5 Mar 2016 23:59:01 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-NFSLock [...] rt.cpan.org&#34; &lt;bug-File-NFSLock [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Phil Andrew &lt;pandrew [...] nvidia.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112723">https://rt.cpan.org/Ticket/Display.html?id=112723</a></span> &gt;

I created a pull request, <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/gedarling/File-NFSLock/pull/1">https://github.com/gedarling/File-NFSLock/pull/1</a></span>

It&#39;s my first time using this feature, so I don&#39;t know if I did it correctly -- I apologize if I did not.

BTW, when I said &#34;or full domain name&#34;, I was actually talking about the fully-qualified username, not hostname &#40;although I do agree that FDQN on the hostname would be useful as well&#41;.  But I guess having both would be redundant, since if you have the FQDN on the hostname, you can assume that the UID is on the same domain as the host...

So going with UID + HOST@FQDN in the lockfile seems eminently reasonable.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Rob Brown via RT [mailto:bug-File-NFSLock@rt.cpan.org] 
Sent: Saturday, March 05, 2016 3:22 PM
To: Phil Andrew
Subject: [rt.cpan.org #112723] Possible RFE for Perl File::NFSLock

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112723">https://rt.cpan.org/Ticket/Display.html?id=112723</a></span> &gt;

Yes, it already includes the hostname within the lock_file:

File-NFSLock/lib/File/NFSLock.pm:110:    $HOSTNAME = Sys::Hostname::hostname&#40;&#41;;
File-NFSLock/lib/File/NFSLock.pm:311:  $self-&gt;{lock_line} ||= &#34;$HOSTNAME $self-&gt;{lock_pid} &#34;.time&#40;&#41;.&#34; &#34;.int&#40;rand&#40;&#41;*10000&#41;.&#34;\n&#34;;


We&#39;ve always set the `hostname` to be the fully qualified hostname. Always expanding the hostname to include the fqdn might help reduce chances of conflicting similar hostnames with different suffixes on those system with a short hostname as the system hostname.


And it uses kill 0 to test if the process is running on the same host. It was assumed that the same user would be reading or writing to the same file. But including the UID might help reduce the chances of falsely removing sibling users that still have a live lock that are running on the same machine.

So I think your suggestion is appropriate.

Can you provide a pull request to include both of these improvements, for the FQDN and for the UID?

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/hookbot/File-NFSLock">https://github.com/hookbot/File-NFSLock</a></span>

Thanks!

-----------------------------------------------------------------------------------
This email message is for the sole use of the intended recipient&#40;s&#41; and may contain
confidential information.  Any unauthorized review, use, disclosure or distribution
is prohibited.  If you are not the intended recipient, please contact the sender by
reply email and destroy all copies of the original message.
-----------------------------------------------------------------------------------
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;05&nbsp;19:14:07&nbsp;2016</span>
    <span class="description">pandrew [...] nvidia.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #112723] Possible RFE for Perl File::NFSLock</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 6 Mar 2016 00:13:55 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-NFSLock [...] rt.cpan.org&#34; &lt;bug-File-NFSLock [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Phil Andrew &lt;pandrew [...] nvidia.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I couldn&#39;t figure out how to create a separate thread to ask you about this.

One other thing I noticed, regarding the &#39;stale_lock_timeout&#39; -- when specifying both non-zero &#39;blocking_timeout&#39; and &#39;stale_lock_timeout&#39;, I expected it to work like this:

    1. If no lockfile, obviously, create lockfile and return SUCCESS
    2. If lockfile exists but it&#39;s older than &#39;stale_lock_timeout&#39;, overwrite lockfile and return SUCCESS
    3. If lockfile exists and for the *entire* duraction of &#39;blocking_timeout&#39; it&#39;s younger than &#39;stale_lock_timeout&#39;, return FAILURE
    4. If lockfile exists and *during the &#39;blocking_timeout&#39; wait* the &#39;stale_lock_timeout&#39; threshold is crossed, overwrite lockfile and return SUCCESS

I think #1, #2, and #3 are the current behavior, but I could not make #4 work as I expected it to...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Phil Andrew 
Sent: Saturday, March 05, 2016 3:59 PM
To: &#39;bug-File-NFSLock@rt.cpan.org&#39;
Subject: RE: [rt.cpan.org #112723] Possible RFE for Perl File::NFSLock

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112723">https://rt.cpan.org/Ticket/Display.html?id=112723</a></span> &gt;

I created a pull request, <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/gedarling/File-NFSLock/pull/1">https://github.com/gedarling/File-NFSLock/pull/1</a></span>

It&#39;s my first time using this feature, so I don&#39;t know if I did it correctly -- I apologize if I did not.

BTW, when I said &#34;or full domain name&#34;, I was actually talking about the fully-qualified username, not hostname &#40;although I do agree that FDQN on the hostname would be useful as well&#41;.  But I guess having both would be redundant, since if you have the FQDN on the hostname, you can assume that the UID is on the same domain as the host...

So going with UID + HOST@FQDN in the lockfile seems eminently reasonable.

<div class="message-stanza open">-----Original Message-----
From: Rob Brown via RT [mailto:bug-File-NFSLock@rt.cpan.org] 
Sent: Saturday, March 05, 2016 3:22 PM
To: Phil Andrew
Subject: [rt.cpan.org #112723] Possible RFE for Perl File::NFSLock

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112723">https://rt.cpan.org/Ticket/Display.html?id=112723</a></span> &gt;

Yes, it already includes the hostname within the lock_file:

File-NFSLock/lib/File/NFSLock.pm:110:    $HOSTNAME = Sys::Hostname::hostname&#40;&#41;;
File-NFSLock/lib/File/NFSLock.pm:311:  $self-&gt;{lock_line} ||= &#34;$HOSTNAME $self-&gt;{lock_pid} &#34;.time&#40;&#41;.&#34; &#34;.int&#40;rand&#40;&#41;*10000&#41;.&#34;\n&#34;;


We&#39;ve always set the `hostname` to be the fully qualified hostname. Always expanding the hostname to include the fqdn might help reduce chances of conflicting similar hostnames with different suffixes on those system with a short hostname as the system hostname.


And it uses kill 0 to test if the process is running on the same host. It was assumed that the same user would be reading or writing to the same file. But including the UID might help reduce the chances of falsely removing sibling users that still have a live lock that are running on the same machine.

So I think your suggestion is appropriate.

Can you provide a pull request to include both of these improvements, for the FQDN and for the UID?

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/hookbot/File-NFSLock">https://github.com/hookbot/File-NFSLock</a></span>

Thanks!

-----------------------------------------------------------------------------------
This email message is for the sole use of the intended recipient&#40;s&#41; and may contain
confidential information.  Any unauthorized review, use, disclosure or distribution
is prohibited.  If you are not the intended recipient, please contact the sender by
reply email and destroy all copies of the original message.
-----------------------------------------------------------------------------------
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
