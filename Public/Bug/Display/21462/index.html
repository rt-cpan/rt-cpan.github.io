<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21462 for Net-MySQL: Problems with MySQL-5.0.21</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21462 for Net-MySQL: Problems with MySQL-5.0.21</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-MySQL/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-MySQL/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-MySQL/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-MySQL/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-MySQL">Net-MySQL CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21462</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-MySQL/Active/">Net-MySQL</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
krisodb [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-22906-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22907-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;13&nbsp;05:19:02&nbsp;2006</span>
    <span class="description">krisodb [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problems with MySQL-5.0.21</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Broken in 0.09, not tested with other versions.
The connection to the database is ok.
Inserting records, retrieving records afterwards is NOK.

Use INET Socket: 10.254.2.253 3306/tcp
Net::MySQL::_get_server_information&#40;&#41;:
3E 00 00 00 0A 35 2E 30 2E 32 31 2D 63 6F 6D 6D  .....5.0.21-comm
75 6E 69 74 79 00 21 00 00 00 6F 54 35 4D 61 21  unity.....oT5Ma.
7B 6E 00 2C A2 30 02 00 00 00 00 00 00 00 00 00  .n.,.0..........
00 00 00 00 00 34 56 34 41 29 46 68 58 5E 50 58  .....4V4A&#41;FhX.PX
46 00                                            F.
Protocol Version: 10
Server Version: 5.0.21-community
Salt: oT5Ma!{n4V4A&#41;FhX^PXF
Net::MySQL::_send_login_message&#40;&#41;:
40 00 00 01 0F A2 00 00 00 00 00 40 08 00 00 00  ................
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00 00 00 00 61 75 74 6F 31 00 14 31 C2 97 43 C9  ....auto1..1..C.
E6 FC BD 68 0C F8 C4 35 0D 43 0D 1D FE 28 2C 74  ...h...5.C...&#40;,t
65 73 74 00                                      est.
Net::MySQL::_request_authentication&#40;&#41;:
01 00 00 02 FE                                   .....
connect database
Net::MySQL::_execute_command&#40;&#41;:
3E 00 00 00 03 0A 20 20 20 20 49 4E 53 45 52 54  ..........INSERT
20 49 4E 54 4F 20 66 6F 6F 20 28 69 64 2C 20 6D  .INTO.foo.&#40;id,.m
65 73 73 61 67 65 29 20 56 41 4C 55 45 53 20 28  essage&#41;.VALUES.&#40;
31 2C 20 27 48 65 6C 6C 6F 20 57 6F 72 6C 64 27  1,.&#39;Hello.World&#39;
29 0A                                            &#41;.
Net::MySQL::_execute_command&#40;&#41;:
16 00 00 03 FF 13 04 23 30 38 53 30 31 42 61 64  ........08S01Bad
20 68 61 6E 64 73 68 61 6B 65                    .handshake
send: Cannot determine peer address at
/usr/lib/perl5/site_perl/5.8.7/Net/MySQL.pm line 293

MySQL is running on Windows XP.
The perl script on linux. Perl version v5.8.7 built for
x86_64-linux-thread-multi.

I was able to install mysql on an other pc, it is working with the same
actions. So the problem is in Net::MySQL.

I&#39;ve captured the packets send to the server I noticed a difference.
For the login message, mysql is sending a different caps: 0fa2 while
Net::MySQL is sending 0da6. This shouldn&#39;t matter I think since the
server is giving the reponse OK.

After this mysql is sending 2 more messages before sending the query&#39;s.
The first one I&#39;m not sure what it is.
Message: 09 00 00 03 47 55 55 4b 56 57 48 4d 00
This is one, if I rerun the script the values will change.

The second one is: &#34;set autocommit=1&#34;

Any chance these messages are needed ? And that&#39;s the reason I get the
bad handshake message ??
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;13&nbsp;07:35:39&nbsp;2006</span>
    <span class="description">krisodb [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> krisodb [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think I figured it out.
In the reply on the login message, there is the byte 0xFE. This means
the password needs to be resend using the old password protocol 10
algorithm.
See also <span class="clickylink"><a target="new" rel="nofollow" href="http://www.redferni.uklinux.net/mysql/MySQL-Protocol.html">http://www.redferni.uklinux.net/mysql/MySQL-Protocol.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;13&nbsp;08:59:42&nbsp;2006</span>
    <span class="description">krisodb [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> krisodb [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The changes in the attached file solve my problem.
What&#39;s added: incase the server replies with the 0xFE, the password is
resend using the old password protocol, using only the first part of the
salt.

On Wed Sep 13 07:35:39 2006, kob wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think I figured it out.
&gt; In the reply on the login message, there is the byte 0xFE. This means
&gt; the password needs to be resend using the old password protocol 10
&gt; algorithm.
&gt; See also <span class="clickylink"><a target="new" rel="nofollow" href="http://www.redferni.uklinux.net/mysql/MySQL-Protocol.html">http://www.redferni.uklinux.net/mysql/MySQL-Protocol.html</a></span>
&gt; 
&gt; 
&gt; 
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;11:34:53&nbsp;2008</span>
    <span class="description">pronovic [...] ieee.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> pronovic [...] ieee.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a similar problem.  

I am running on Windows XP SP2 using ActiveState Perl 5.10.0 &#40;binary
build 1001 from 18-Dec-2007&#41;.  I am connecting to MySQL 5.0.22 running
on RHEL.  I installed Net::MySQL using ActiveState&#39;s ppm tool, which got
me version 0.9. 

The local mysql client works just fine.  However, my Perl script always
fails with a &#34;08S01 Bad Handshake&#34; error, just like described in kob&#39;s
original thread on the MySQL forum:

<span class="clickylink"><a target="new" rel="nofollow" href="http://forums.mysql.com/read.php?51,96826,115443#msg-115443">http://forums.mysql.com/read.php?51,96826,115443#msg-115443</a></span>

The error shows up when executing the first select.

I took the updated MySQL.pm provided by kob &#40;in the previous reply in
this bug thread&#41;, and installed it to C:\Perl\site\lib\Net.  That solved
my problem.

This bug report is over a year old.  Could you please apply kob&#39;s
changes and release a new version of this package -- or at least comment
on this bug to let us know why the changes haven&#39;t been applied?  

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;11:34:56&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
