<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #61671 for Encode: decode_utf8 is not equivalent to decode&#40;&#34;utf8&#34;, ...&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #61671 for Encode: decode_utf8 is not equivalent to decode&#40;&#34;utf8&#34;, ...&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Encode/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Encode/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Encode/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Encode/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Encode">Encode CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">61671</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Encode/Active/">Encode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
info [...] binarus.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-12062-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.40    </td>
  </tr>
  <tr id="CF-12063-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;12:21:00&nbsp;2010</span>
    <span class="description">info [...] binarus.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> decode_utf8 is not equivalent to decode&#40;&#34;utf8&#34;, ...&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

this is on debian lenny, all packages and kernel stock distribution
&#40;dom0 of a XEN environment, but this should not play any role here&#41;.

uname -a gives: Linux fenrir 2.6.26-2-xen-686 #1 SMP Fri Sep 17 00:54:08
UTC 2010 i686 GNU/Linux
perl -v gives: This is perl, v5.10.0 built for i486-linux-gnu-thread-multi

From within the CPAN shell, we have installed the newest &#40;as of the time
of this writing&#41; versions of the following modules:

CGI, CPAN, CPAN::Test::Dummy::Perl5::Build,
CPAN::Test::Dummy::Perl5::Make, CPAN::Test::Dummy::Perl5::Make::Zip,
Encode, FCGI, Module::Signature, Perl, Test::Simple, YAML

The version of Encode is 2.40.

As of the time of this writing, the documentation for the Encode module
states that 

$string = decode_utf8&#40;$octets [, CHECK]&#41;;

is equivalent to

$string = decode&#40;&#34;utf8&#34;, $octets [, CHECK]&#41;.

This is definitely not true. We have a complex web app coded in perl
which has been running flawlessly for years, and which used the first
variant to decode some URL params which are fed into the application by
a HTTP POST request and are encoded in UTF-8.

After upgrading the underlying debian distribution &#40;and thus, perl and
respective modules&#41; from sarge to lenny, the app failed messing up
German umlauts and other international chars. It took us more than two
days of debugging until we came to the idea of &#40;illogically in respect
to the documentation&#41; replacing the first variant by the second one;
from this moment on, the app ran without any flaws again.

Since this was very infuriating, we would like to prevent others from
suffering the same problem the cause of which can&#39;t be deducted by
thinking logically alone, and thus are filing a bug now.

More precise description of setup:

Apache 2.2.9, no default charset configured;
Web page containing a form, whole page encoded as UTF-8 and tagged as
UTF-8 by http headers and http metatags, form with attribute
accept-charset=&#34;UTF-8&#34;;
A perl script, coded in UTF-8 by itself, all files read and written in
UTF-8, including stdin and stdout, and using the CGI module version 3.49
for receiving / decoding the parameters sent by the form submit / POST
request;
Bowser Firefox 3.6 &#40;Mozilla/5.0 &#40;Windows; U; Windows NT 6.0; en-GB;
rv:1.9.2.3&#41; Gecko/20100401 Firefox/3.6.3&#41; or MS IE8;

Problem:

decode_utf8 does not decode the parameter names and values from the POST
request correctly, decode&#40;&#34;utf8&#34;, ...&#41; does. Thus, decode_utf8 and
decode&#40;&#34;utf8&#34;, ...&#41; are not equivalent as stated by the docs.
Furthermore, for our app, it does not make any difference if we use
decode&#40;&#34;utf8&#34;, ...&#41; or decode&#40;&#34;UTF-8&#34;, ...&#41; which also seems like a
contradiction to the docs, but maybe decode&#40;&#34;utf8&#34;, ...&#41; and
decode&#40;&#34;UTF-8&#34;, ...&#41; would give different results in another scenario /
with other octets.

Tagging the problem as important is because of the fact that it took
very much man-power and time to find the cause of the failing of our
app; no matter if the bug is in the docs or in the module, we think it
has to be considered important due to the fact that this special reason
for failing scripts or messed chars is very hard to find.

Thanks,

Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;19:55:20&nbsp;2010</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">See

<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=61456">http://rt.cpan.org/Public/Bug/Display.html?id=61456</a></span>

Dan the Maintainer Thereof

On Sun Sep 26 12:21:00 2010, Binarus wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; this is on debian lenny, all packages and kernel stock distribution
&gt; &#40;dom0 of a XEN environment, but this should not play any role here&#41;.
&gt; 
&gt; uname -a gives: Linux fenrir 2.6.26-2-xen-686 #1 SMP Fri Sep 17 00:54:08
&gt; UTC 2010 i686 GNU/Linux
&gt; perl -v gives: This is perl, v5.10.0 built for i486-linux-gnu-thread-multi
&gt; 
&gt; From within the CPAN shell, we have installed the newest &#40;as of the time
&gt; of this writing&#41; versions of the following modules:
&gt; 
&gt; CGI, CPAN, CPAN::Test::Dummy::Perl5::Build,
&gt; CPAN::Test::Dummy::Perl5::Make, CPAN::Test::Dummy::Perl5::Make::Zip,
&gt; Encode, FCGI, Module::Signature, Perl, Test::Simple, YAML
&gt; 
&gt; The version of Encode is 2.40.
&gt; 
&gt; As of the time of this writing, the documentation for the Encode module
&gt; states that 
&gt; 
&gt; $string = decode_utf8&#40;$octets [, CHECK]&#41;;
&gt; 
&gt; is equivalent to
&gt; 
&gt; $string = decode&#40;&#34;utf8&#34;, $octets [, CHECK]&#41;.
&gt; 
&gt; This is definitely not true. We have a complex web app coded in perl
&gt; which has been running flawlessly for years, and which used the first
&gt; variant to decode some URL params which are fed into the application by
&gt; a HTTP POST request and are encoded in UTF-8.
&gt; 
&gt; After upgrading the underlying debian distribution &#40;and thus, perl and
&gt; respective modules&#41; from sarge to lenny, the app failed messing up
&gt; German umlauts and other international chars. It took us more than two
&gt; days of debugging until we came to the idea of &#40;illogically in respect
&gt; to the documentation&#41; replacing the first variant by the second one;
&gt; from this moment on, the app ran without any flaws again.
&gt; 
&gt; Since this was very infuriating, we would like to prevent others from
&gt; suffering the same problem the cause of which can&#39;t be deducted by
&gt; thinking logically alone, and thus are filing a bug now.
&gt; 
&gt; More precise description of setup:
&gt; 
&gt; Apache 2.2.9, no default charset configured;
&gt; Web page containing a form, whole page encoded as UTF-8 and tagged as
&gt; UTF-8 by http headers and http metatags, form with attribute
&gt; accept-charset=&#34;UTF-8&#34;;
&gt; A perl script, coded in UTF-8 by itself, all files read and written in
&gt; UTF-8, including stdin and stdout, and using the CGI module version 3.49
&gt; for receiving / decoding the parameters sent by the form submit / POST
&gt; request;
&gt; Bowser Firefox 3.6 &#40;Mozilla/5.0 &#40;Windows; U; Windows NT 6.0; en-GB;
&gt; rv:1.9.2.3&#41; Gecko/20100401 Firefox/3.6.3&#41; or MS IE8;
&gt; 
&gt; Problem:
&gt; 
&gt; decode_utf8 does not decode the parameter names and values from the POST
&gt; request correctly, decode&#40;&#34;utf8&#34;, ...&#41; does. Thus, decode_utf8 and
&gt; decode&#40;&#34;utf8&#34;, ...&#41; are not equivalent as stated by the docs.
&gt; Furthermore, for our app, it does not make any difference if we use
&gt; decode&#40;&#34;utf8&#34;, ...&#41; or decode&#40;&#34;UTF-8&#34;, ...&#41; which also seems like a
&gt; contradiction to the docs, but maybe decode&#40;&#34;utf8&#34;, ...&#41; and
&gt; decode&#40;&#34;UTF-8&#34;, ...&#41; would give different results in another scenario /
&gt; with other octets.
&gt; 
&gt; Tagging the problem as important is because of the fact that it took
&gt; very much man-power and time to find the cause of the failing of our
&gt; app; no matter if the bug is in the docs or in the module, we think it
&gt; has to be considered important due to the fact that this special reason
&gt; for failing scripts or messed chars is very hard to find.
&gt; 
&gt; Thanks,
&gt; 
&gt; Peter
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;19:55:22&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;19:55:24&nbsp;2010</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;19:56:48&nbsp;2010</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">See

<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=61456">http://rt.cpan.org/Public/Bug/Display.html?id=61456</a></span>

Dan the Maintainer Thereof

On Sun Sep 26 12:21:00 2010, Binarus wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; this is on debian lenny, all packages and kernel stock distribution
&gt; &#40;dom0 of a XEN environment, but this should not play any role here&#41;.
&gt; 
&gt; uname -a gives: Linux fenrir 2.6.26-2-xen-686 #1 SMP Fri Sep 17 00:54:08
&gt; UTC 2010 i686 GNU/Linux
&gt; perl -v gives: This is perl, v5.10.0 built for i486-linux-gnu-thread-multi
&gt; 
&gt; From within the CPAN shell, we have installed the newest &#40;as of the time
&gt; of this writing&#41; versions of the following modules:
&gt; 
&gt; CGI, CPAN, CPAN::Test::Dummy::Perl5::Build,
&gt; CPAN::Test::Dummy::Perl5::Make, CPAN::Test::Dummy::Perl5::Make::Zip,
&gt; Encode, FCGI, Module::Signature, Perl, Test::Simple, YAML
&gt; 
&gt; The version of Encode is 2.40.
&gt; 
&gt; As of the time of this writing, the documentation for the Encode module
&gt; states that 
&gt; 
&gt; $string = decode_utf8&#40;$octets [, CHECK]&#41;;
&gt; 
&gt; is equivalent to
&gt; 
&gt; $string = decode&#40;&#34;utf8&#34;, $octets [, CHECK]&#41;.
&gt; 
&gt; This is definitely not true. We have a complex web app coded in perl
&gt; which has been running flawlessly for years, and which used the first
&gt; variant to decode some URL params which are fed into the application by
&gt; a HTTP POST request and are encoded in UTF-8.
&gt; 
&gt; After upgrading the underlying debian distribution &#40;and thus, perl and
&gt; respective modules&#41; from sarge to lenny, the app failed messing up
&gt; German umlauts and other international chars. It took us more than two
&gt; days of debugging until we came to the idea of &#40;illogically in respect
&gt; to the documentation&#41; replacing the first variant by the second one;
&gt; from this moment on, the app ran without any flaws again.
&gt; 
&gt; Since this was very infuriating, we would like to prevent others from
&gt; suffering the same problem the cause of which can&#39;t be deducted by
&gt; thinking logically alone, and thus are filing a bug now.
&gt; 
&gt; More precise description of setup:
&gt; 
&gt; Apache 2.2.9, no default charset configured;
&gt; Web page containing a form, whole page encoded as UTF-8 and tagged as
&gt; UTF-8 by http headers and http metatags, form with attribute
&gt; accept-charset=&#34;UTF-8&#34;;
&gt; A perl script, coded in UTF-8 by itself, all files read and written in
&gt; UTF-8, including stdin and stdout, and using the CGI module version 3.49
&gt; for receiving / decoding the parameters sent by the form submit / POST
&gt; request;
&gt; Bowser Firefox 3.6 &#40;Mozilla/5.0 &#40;Windows; U; Windows NT 6.0; en-GB;
&gt; rv:1.9.2.3&#41; Gecko/20100401 Firefox/3.6.3&#41; or MS IE8;
&gt; 
&gt; Problem:
&gt; 
&gt; decode_utf8 does not decode the parameter names and values from the POST
&gt; request correctly, decode&#40;&#34;utf8&#34;, ...&#41; does. Thus, decode_utf8 and
&gt; decode&#40;&#34;utf8&#34;, ...&#41; are not equivalent as stated by the docs.
&gt; Furthermore, for our app, it does not make any difference if we use
&gt; decode&#40;&#34;utf8&#34;, ...&#41; or decode&#40;&#34;UTF-8&#34;, ...&#41; which also seems like a
&gt; contradiction to the docs, but maybe decode&#40;&#34;utf8&#34;, ...&#41; and
&gt; decode&#40;&#34;UTF-8&#34;, ...&#41; would give different results in another scenario /
&gt; with other octets.
&gt; 
&gt; Tagging the problem as important is because of the fact that it took
&gt; very much man-power and time to find the cause of the failing of our
&gt; app; no matter if the bug is in the docs or in the module, we think it
&gt; has to be considered important due to the fact that this special reason
&gt; for failing scripts or messed chars is very hard to find.
&gt; 
&gt; Thanks,
&gt; 
&gt; Peter
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;19:56:49&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;19:58:31&nbsp;2010</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;27&nbsp;03:08:49&nbsp;2010</span>
    <span class="description">info [...] binarus.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> info [...] binarus.de</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Dan,

thank you very much for your answer.

I don&#39;t understand the relationship between the problem described in the
reference you gave and the problem described by me.

No matter which bugs Encode versions before 2.40 is suffering from: The
current version 2.40 still behaves another way than the manual states
&#40;decode_utf8&#40;...&#41; is not equivalent to decode&#40;&#34;utf8&#34;, ...&#41;&#41;.

In previous versions &#40;some time ago&#41;, the equivalence between the two
variants indeed seemed to be there. I can&#39;t tell exactly when the
equivalence was broken; I only can tell that it was there when debian
sarge was current &#40;maybe two or three years ago&#41;.

So I really think that either the Encode manual should be updated, or
there is some bug in the code. Until at least the docs are corrected, it
will be very hard for script authors to come to the idea of avoiding
decode_utf8&#40;...&#41;.

As I think about it: Since decode_utf8&#40;...&#41; does not deliver the same
result as decode&#40;&#34;utf8&#34;, ...&#41; or decode&#40;&#34;UTF-8&#34;, ...&#41;, we can state that
decode_utf8&#40;...&#41; is just buggy. Perhaps it should be removed completely...

To stress it once again: decode_utf8&#40;...&#41; wasn&#39;t able to decode UTF-8
octets correctly. I am absolutely sure that the octets we have tested
were valid UTF-8: at first, they were generated in a carefully crafted
setup and came from Firefox 3.6; second, turning on the error behaviour
in the decode function &#40;CHECK&#41; did not reveal any error; third, using
decode&#40;&#34;utf8&#34;, ...&#41;  or decode&#40;&#34;UTF-8&#34;, ...&#41; worked as expected, and the
same octets suddenly were decoded correctly.

Thanks,

Peter


On Sun Sep 26 19:56:48 2010, DANKOGAI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; See
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=61456">http://rt.cpan.org/Public/Bug/Display.html?id=61456</a></span>
&gt; 
&gt; Dan the Maintainer Thereof
&gt; 
&gt; On Sun Sep 26 12:21:00 2010, Binarus wrote:
<div class="message-stanza open">&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt; this is on debian lenny, all packages and kernel stock distribution
&gt; &gt; &#40;dom0 of a XEN environment, but this should not play any role here&#41;.
&gt; &gt; 
&gt; &gt; uname -a gives: Linux fenrir 2.6.26-2-xen-686 #1 SMP Fri Sep 17 00:54:08
&gt; &gt; UTC 2010 i686 GNU/Linux
&gt; &gt; perl -v gives: This is perl, v5.10.0 built for
</div></div>i486-linux-gnu-thread-multi
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; From within the CPAN shell, we have installed the newest &#40;as of the time
&gt; &gt; of this writing&#41; versions of the following modules:
&gt; &gt; 
&gt; &gt; CGI, CPAN, CPAN::Test::Dummy::Perl5::Build,
&gt; &gt; CPAN::Test::Dummy::Perl5::Make, CPAN::Test::Dummy::Perl5::Make::Zip,
&gt; &gt; Encode, FCGI, Module::Signature, Perl, Test::Simple, YAML
&gt; &gt; 
&gt; &gt; The version of Encode is 2.40.
&gt; &gt; 
&gt; &gt; As of the time of this writing, the documentation for the Encode module
&gt; &gt; states that 
&gt; &gt; 
&gt; &gt; $string = decode_utf8&#40;$octets [, CHECK]&#41;;
&gt; &gt; 
&gt; &gt; is equivalent to
&gt; &gt; 
&gt; &gt; $string = decode&#40;&#34;utf8&#34;, $octets [, CHECK]&#41;.
&gt; &gt; 
&gt; &gt; This is definitely not true. We have a complex web app coded in perl
&gt; &gt; which has been running flawlessly for years, and which used the first
&gt; &gt; variant to decode some URL params which are fed into the application by
&gt; &gt; a HTTP POST request and are encoded in UTF-8.
&gt; &gt; 
&gt; &gt; After upgrading the underlying debian distribution &#40;and thus, perl and
&gt; &gt; respective modules&#41; from sarge to lenny, the app failed messing up
&gt; &gt; German umlauts and other international chars. It took us more than two
&gt; &gt; days of debugging until we came to the idea of &#40;illogically in respect
&gt; &gt; to the documentation&#41; replacing the first variant by the second one;
&gt; &gt; from this moment on, the app ran without any flaws again.
&gt; &gt; 
&gt; &gt; Since this was very infuriating, we would like to prevent others from
&gt; &gt; suffering the same problem the cause of which can&#39;t be deducted by
&gt; &gt; thinking logically alone, and thus are filing a bug now.
&gt; &gt; 
&gt; &gt; More precise description of setup:
&gt; &gt; 
&gt; &gt; Apache 2.2.9, no default charset configured;
&gt; &gt; Web page containing a form, whole page encoded as UTF-8 and tagged as
&gt; &gt; UTF-8 by http headers and http metatags, form with attribute
&gt; &gt; accept-charset=&#34;UTF-8&#34;;
&gt; &gt; A perl script, coded in UTF-8 by itself, all files read and written in
&gt; &gt; UTF-8, including stdin and stdout, and using the CGI module version 3.49
&gt; &gt; for receiving / decoding the parameters sent by the form submit / POST
&gt; &gt; request;
&gt; &gt; Bowser Firefox 3.6 &#40;Mozilla/5.0 &#40;Windows; U; Windows NT 6.0; en-GB;
&gt; &gt; rv:1.9.2.3&#41; Gecko/20100401 Firefox/3.6.3&#41; or MS IE8;
&gt; &gt; 
&gt; &gt; Problem:
&gt; &gt; 
&gt; &gt; decode_utf8 does not decode the parameter names and values from the POST
&gt; &gt; request correctly, decode&#40;&#34;utf8&#34;, ...&#41; does. Thus, decode_utf8 and
&gt; &gt; decode&#40;&#34;utf8&#34;, ...&#41; are not equivalent as stated by the docs.
&gt; &gt; Furthermore, for our app, it does not make any difference if we use
&gt; &gt; decode&#40;&#34;utf8&#34;, ...&#41; or decode&#40;&#34;UTF-8&#34;, ...&#41; which also seems like a
&gt; &gt; contradiction to the docs, but maybe decode&#40;&#34;utf8&#34;, ...&#41; and
&gt; &gt; decode&#40;&#34;UTF-8&#34;, ...&#41; would give different results in another scenario /
&gt; &gt; with other octets.
&gt; &gt; 
&gt; &gt; Tagging the problem as important is because of the fact that it took
&gt; &gt; very much man-power and time to find the cause of the failing of our
&gt; &gt; app; no matter if the bug is in the docs or in the module, we think it
&gt; &gt; has to be considered important due to the fact that this special reason
&gt; &gt; for failing scripts or messed chars is very hard to find.
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt; Peter
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;27&nbsp;03:08:51&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;27&nbsp;06:23:13&nbsp;2010</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please send me a test, then.  decode_utf8&#40;&#41; is now ISOMORPHICALLY IDENTICAL to 
decode&#40;&#39;utf8&#39; …&#41;, which wasn&#39;t till 2.40.  If you don&#39;t believe me, check the source.

Dan the Maintainer Thereof

On Mon Sep 27 03:08:49 2010, Binarus wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Dan,
&gt; 
&gt; thank you very much for your answer.
&gt; 
&gt; I don&#39;t understand the relationship between the problem described in the
&gt; reference you gave and the problem described by me.
&gt; 
&gt; No matter which bugs Encode versions before 2.40 is suffering from: The
&gt; current version 2.40 still behaves another way than the manual states
&gt; &#40;decode_utf8&#40;...&#41; is not equivalent to decode&#40;&#34;utf8&#34;, ...&#41;&#41;.
&gt; 
&gt; In previous versions &#40;some time ago&#41;, the equivalence between the two
&gt; variants indeed seemed to be there. I can&#39;t tell exactly when the
&gt; equivalence was broken; I only can tell that it was there when debian
&gt; sarge was current &#40;maybe two or three years ago&#41;.
&gt; 
&gt; So I really think that either the Encode manual should be updated, or
&gt; there is some bug in the code. Until at least the docs are corrected, it
&gt; will be very hard for script authors to come to the idea of avoiding
&gt; decode_utf8&#40;...&#41;.
&gt; 
&gt; As I think about it: Since decode_utf8&#40;...&#41; does not deliver the same
&gt; result as decode&#40;&#34;utf8&#34;, ...&#41; or decode&#40;&#34;UTF-8&#34;, ...&#41;, we can state that
&gt; decode_utf8&#40;...&#41; is just buggy. Perhaps it should be removed completely...
&gt; 
&gt; To stress it once again: decode_utf8&#40;...&#41; wasn&#39;t able to decode UTF-8
&gt; octets correctly. I am absolutely sure that the octets we have tested
&gt; were valid UTF-8: at first, they were generated in a carefully crafted
&gt; setup and came from Firefox 3.6; second, turning on the error behaviour
&gt; in the decode function &#40;CHECK&#41; did not reveal any error; third, using
&gt; decode&#40;&#34;utf8&#34;, ...&#41;  or decode&#40;&#34;UTF-8&#34;, ...&#41; worked as expected, and the
&gt; same octets suddenly were decoded correctly.
&gt; 
&gt; Thanks,
&gt; 
&gt; Peter
&gt; 
&gt; 
&gt; On Sun Sep 26 19:56:48 2010, DANKOGAI wrote:
<div class="message-stanza open">&gt; &gt; See
&gt; &gt; 
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=61456">http://rt.cpan.org/Public/Bug/Display.html?id=61456</a></span>
&gt; &gt; 
&gt; &gt; Dan the Maintainer Thereof
&gt; &gt; 
&gt; &gt; On Sun Sep 26 12:21:00 2010, Binarus wrote:
<div class="message-stanza open">&gt; &gt; &gt; Hi,
&gt; &gt; &gt; 
&gt; &gt; &gt; this is on debian lenny, all packages and kernel stock distribution
&gt; &gt; &gt; &#40;dom0 of a XEN environment, but this should not play any role here&#41;.
&gt; &gt; &gt; 
&gt; &gt; &gt; uname -a gives: Linux fenrir 2.6.26-2-xen-686 #1 SMP Fri Sep 17 00:54:08
&gt; &gt; &gt; UTC 2010 i686 GNU/Linux
&gt; &gt; &gt; perl -v gives: This is perl, v5.10.0 built for
</div></div>&gt; i486-linux-gnu-thread-multi
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; From within the CPAN shell, we have installed the newest &#40;as of the time
&gt; &gt; &gt; of this writing&#41; versions of the following modules:
&gt; &gt; &gt; 
&gt; &gt; &gt; CGI, CPAN, CPAN::Test::Dummy::Perl5::Build,
&gt; &gt; &gt; CPAN::Test::Dummy::Perl5::Make, CPAN::Test::Dummy::Perl5::Make::Zip,
&gt; &gt; &gt; Encode, FCGI, Module::Signature, Perl, Test::Simple, YAML
&gt; &gt; &gt; 
&gt; &gt; &gt; The version of Encode is 2.40.
&gt; &gt; &gt; 
&gt; &gt; &gt; As of the time of this writing, the documentation for the Encode module
&gt; &gt; &gt; states that 
&gt; &gt; &gt; 
&gt; &gt; &gt; $string = decode_utf8&#40;$octets [, CHECK]&#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; is equivalent to
&gt; &gt; &gt; 
&gt; &gt; &gt; $string = decode&#40;&#34;utf8&#34;, $octets [, CHECK]&#41;.
&gt; &gt; &gt; 
&gt; &gt; &gt; This is definitely not true. We have a complex web app coded in perl
&gt; &gt; &gt; which has been running flawlessly for years, and which used the first
&gt; &gt; &gt; variant to decode some URL params which are fed into the application by
&gt; &gt; &gt; a HTTP POST request and are encoded in UTF-8.
&gt; &gt; &gt; 
&gt; &gt; &gt; After upgrading the underlying debian distribution &#40;and thus, perl and
&gt; &gt; &gt; respective modules&#41; from sarge to lenny, the app failed messing up
&gt; &gt; &gt; German umlauts and other international chars. It took us more than two
&gt; &gt; &gt; days of debugging until we came to the idea of &#40;illogically in respect
&gt; &gt; &gt; to the documentation&#41; replacing the first variant by the second one;
&gt; &gt; &gt; from this moment on, the app ran without any flaws again.
&gt; &gt; &gt; 
&gt; &gt; &gt; Since this was very infuriating, we would like to prevent others from
&gt; &gt; &gt; suffering the same problem the cause of which can&#39;t be deducted by
&gt; &gt; &gt; thinking logically alone, and thus are filing a bug now.
&gt; &gt; &gt; 
&gt; &gt; &gt; More precise description of setup:
&gt; &gt; &gt; 
&gt; &gt; &gt; Apache 2.2.9, no default charset configured;
&gt; &gt; &gt; Web page containing a form, whole page encoded as UTF-8 and tagged as
&gt; &gt; &gt; UTF-8 by http headers and http metatags, form with attribute
&gt; &gt; &gt; accept-charset=&#34;UTF-8&#34;;
&gt; &gt; &gt; A perl script, coded in UTF-8 by itself, all files read and written in
&gt; &gt; &gt; UTF-8, including stdin and stdout, and using the CGI module version 3.49
&gt; &gt; &gt; for receiving / decoding the parameters sent by the form submit / POST
&gt; &gt; &gt; request;
&gt; &gt; &gt; Bowser Firefox 3.6 &#40;Mozilla/5.0 &#40;Windows; U; Windows NT 6.0; en-GB;
&gt; &gt; &gt; rv:1.9.2.3&#41; Gecko/20100401 Firefox/3.6.3&#41; or MS IE8;
&gt; &gt; &gt; 
&gt; &gt; &gt; Problem:
&gt; &gt; &gt; 
&gt; &gt; &gt; decode_utf8 does not decode the parameter names and values from the POST
&gt; &gt; &gt; request correctly, decode&#40;&#34;utf8&#34;, ...&#41; does. Thus, decode_utf8 and
&gt; &gt; &gt; decode&#40;&#34;utf8&#34;, ...&#41; are not equivalent as stated by the docs.
&gt; &gt; &gt; Furthermore, for our app, it does not make any difference if we use
&gt; &gt; &gt; decode&#40;&#34;utf8&#34;, ...&#41; or decode&#40;&#34;UTF-8&#34;, ...&#41; which also seems like a
&gt; &gt; &gt; contradiction to the docs, but maybe decode&#40;&#34;utf8&#34;, ...&#41; and
&gt; &gt; &gt; decode&#40;&#34;UTF-8&#34;, ...&#41; would give different results in another scenario /
&gt; &gt; &gt; with other octets.
&gt; &gt; &gt; 
&gt; &gt; &gt; Tagging the problem as important is because of the fact that it took
&gt; &gt; &gt; very much man-power and time to find the cause of the failing of our
&gt; &gt; &gt; app; no matter if the bug is in the docs or in the module, we think it
&gt; &gt; &gt; has to be considered important due to the fact that this special reason
&gt; &gt; &gt; for failing scripts or messed chars is very hard to find.
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; 
&gt; &gt; &gt; Peter
</div>&gt; &gt; 
&gt; &gt; 
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;27&nbsp;07:49:22&nbsp;2010</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
