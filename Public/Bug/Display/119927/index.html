<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #119927 for Crypt-LE: Crypt::LE bug when using web connection to check certificate expiration</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #119927 for Crypt-LE: Crypt::LE bug when using web connection to check certificate expiration</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Crypt-LE">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Crypt-LE">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Crypt-LE">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Crypt-LE">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-LE">Crypt-LE CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">119927</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Crypt-LE">Crypt-LE</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">LEADER [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
arielgrin [...] outlook.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-263798-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-263799-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.21    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




crt.out<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1701540/913853/crt.out">
Sun Jan 29 20:19:11 2017 (607b) by arielgrin [...] outlook.com
</a>
</font></li>
</ul>


crt.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1701319/913731/crt.pl">
Sat Jan 28 14:05:00 2017 (429b) by LEADER [...] cpan.org
</a>
</font></li>
</ul>


perl.out<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1701540/913854/perl.out">
Sun Jan 29 20:19:11 2017 (2.8k) by arielgrin [...] outlook.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=119927">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1699625" href="/Public/Bug/Display.html?id=119927#txn-1699625">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;20&nbsp;12:51:11&nbsp;2017</span>
    <span class="description">arielgrin [...] outlook.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Crypt::LE bug when using web connection to check certificate expiration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 20 Jan 2017 17:50:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Crypt-LE [...] rt.cpan.org&#34; &lt;bug-Crypt-LE [...] rt.cpan.org&gt;, &#34;leader [...] cpan.org&#34; &lt;leader [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ariel Grin &lt;arielgrin [...] outlook.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1699625/912766/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/912766">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Alexander: I have installed your module Crypt::LE and I&#39;ve managed to authorize my domain and generate my certificate.


I think I found a bug on the way the module checks for certificate expiration when using a web connection instead of the local saved certificate.


It seems as if the web connection check is retrieving one of the Let&#39;s Encrypt certificates, either the Root CA or the Intermediate Certificate. After running the renew command today, January 20th 2017, the remaining days before expiration are 1713, which corresponds to September 29th, 2021 and that is the &#34;Not After&#34; date of both Let&#39;s Encrypt certificates.


If the renew command uses the local certificate, which was issued yesterday, the remaining days before expiration are 89, which is the correct value for my certificate.


I see that there are 2 values at the start of the script, PEER_CRT and CRT_DEPTH that might have something to do with that, as currently the CRT_DEPTH is 3 and PEER_CRT is 1, at least that is what I can see from OpenSSL output when using s_client -showcerts -connect, OpenSSL retrieves 3 certificates and the last one showed is mine, but the script assigns PEER_CRT=4 and CRT_DEPTH=5


OS: Windows 2003 Server SP1

Perl: ActiveState Perl 5.12.4

Crypt::LE: 0.19


Thanks, Ariel.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1699625/912767/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/912767">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1701312" href="/Public/Bug/Display.html?id=119927#txn-1701312">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;28&nbsp;12:21:10&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701312/913722/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/913722">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Ariel,

Thank you for this report and the detailed description of the encountered issue. Please note that the constant you are referring to is not an actual value, but effectively an index in the structure where such value can be found. 

Basically CRT_DEPTH set to 5 does not mean that the 5th certificate in the chain will be checked - it just points out that the depth value is at the index 5th in the returned structure &#40;array in this case&#41;. The script will then take the certificate which has that value as 0 and will return the results based on it. However, there is no strict checking for example whether the subject of the certificate matches our expectations &#40;that might be added later&#41;, so if the server sends something else at depth 0, this might give wrong expiration count indeed.

Could you please provide a domain name to checked this against? You can send it privately if you like via <span class="clickylink"><a target="new" rel="nofollow" href="https://do-know.com/contact.html">https://do-know.com/contact.html</a></span>

If there is indeed a problem with expiration calculations and SSL for the domain is configured correctly, I will look into fixing that as soon as possible.

Best regards,

Alexander.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1701313" href="/Public/Bug/Display.html?id=119927#txn-1701313">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;28&nbsp;12:21:11&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1701316" href="/Public/Bug/Display.html?id=119927#txn-1701316">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;28&nbsp;12:25:10&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1701317" href="/Public/Bug/Display.html?id=119927#txn-1701317">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;28&nbsp;12:25:24&nbsp;2017</span>
    <span class="description">arielgrin [...] outlook.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #119927] Crypt::LE bug when using web connection to check certificate expiration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Jan 2017 17:24:32 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Alexander Yezhov via RT &lt;bug-Crypt-LE [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ariel Grin &lt;arielgrin [...] outlook.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701317/913726/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/913726">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think is a problem related to ActiveState Perl implementation, because I tried it too with Strawberry Perl and it returned the right expiration time. My domain is webmail.brokers.com.ar&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://webmail.brokers.com.ar">http://webmail.brokers.com.ar</a></span>&gt;

Enviado desde mi Móvil LG

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">------ Mensaje original------
Desde: Alexander Yezhov via RT
Fecha: sáb., 28 ene. 2017 2:21 PM
Para: arielgrin@outlook.com;
Cc:
Asunto:[rt.cpan.org #119927] Crypt::LE bug when using web connection to check certificate expiration

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=119927">https://rt.cpan.org/Ticket/Display.html?id=119927</a></span> &gt;

Hello Ariel,

Thank you for this report and the detailed description of the encountered issue. Please note that the constant you are referring to is not an actual value, but effectively an index in the structure where such value can be found.

Basically CRT_DEPTH set to 5 does not mean that the 5th certificate in the chain will be checked - it just points out that the depth value is at the index 5th in the returned structure &#40;array in this case&#41;. The script will then take the certificate which has that value as 0 and will return the results based on it. However, there is no strict checking for example whether the subject of the certificate matches our expectations &#40;that might be added later&#41;, so if the server sends something else at depth 0, this might give wrong expiration count indeed.

Could you please provide a domain name to checked this against? You can send it privately if you like via <span class="clickylink"><a target="new" rel="nofollow" href="https://do-know.com/contact.html">https://do-know.com/contact.html</a></span>

If there is indeed a problem with expiration calculations and SSL for the domain is configured correctly, I will look into fixing that as soon as possible.

Best regards,

Alexander.
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701317/913727/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/913727">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1701319" href="/Public/Bug/Display.html?id=119927#txn-1701319">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;28&nbsp;14:05:00&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701319/913730/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/913730">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 956b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Ariel,

This is interesting indeed. I have just checked how the code would behave with the most recent ActiveState Perl version under Windows and the result was as expected, with the correct output produced. This could be down to some specifics in terms of libraries used, so I have attached a small script to this message, which should allow to see what exactly gets returned in the callbacks. If you could run it &#40;like &#34;perl crt.pl webmail.brokers.com.ar &gt; out.txt&#34;&#41; and send me the output, that could help to pinpoint the issue potentially or at least make the code adapt to this specific system behaviour.

Regards,

Alexander.

On Sat Jan 28 17:25:24 2017, arielgrin@outlook.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think is a problem related to ActiveState Perl implementation,
&gt; because I tried it too with Strawberry Perl and it returned the right
&gt; expiration time. My domain is
&gt; webmail.brokers.com.ar&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://webmail.brokers.com.ar">http://webmail.brokers.com.ar</a></span>&gt;
&gt; 
&gt; Enviado desde mi Móvil LG
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> crt.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701319/913731/crt.pl">Download crt.pl</a><br />
<span class="downloadcontenttype">text/x-perl 429b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use HTTP::Tiny;
use IO::Socket::SSL;
use Net::SSLeay;
use Data::Dumper;
use strict;

die &#34;Please specify the domain&#34; unless $ARGV[0];
print &#34;Versions: $HTTP::Tiny::VERSION / $IO::Socket::SSL::VERSION / $Net::SSLeay::VERSION\n&#34;;
my $probe = HTTP::Tiny-&gt;new&#40; agent =&gt; &#34;Mozilla/5.0&#34;, verify_SSL =&gt; 1, timeout =&gt; 10, SSL_options =&gt; { SSL_verify_callback =&gt; sub { print Dumper&#40;\@_&#41; } } &#41;;
$probe-&gt;head&#40;&#34;https://$ARGV[0]/&#34;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1701540" href="/Public/Bug/Display.html?id=119927#txn-1701540">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;29&nbsp;20:19:11&nbsp;2017</span>
    <span class="description">arielgrin [...] outlook.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #119927] Crypt::LE bug when using web connection to check certificate expiration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 30 Jan 2017 01:18:51 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Crypt-LE [...] rt.cpan.org&#34; &lt;bug-Crypt-LE [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ariel Grin &lt;arielgrin [...] outlook.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701540/913851/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/913851">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Alexander: thank you SO MUCH for your help. I ran the perl script that you sent me and indeed, in my particular setup, the crt chain is retrieved in &#34;reverse&#34; way: Root CA first, then Intermediate and Client CRT at last.


If I understood your explanation correctly, your LE script is not currently checking if the first retrieved certificate is actually the one for the requested domain, it just returns the first certificate it receives. Maybe there is a way to tell the script to choose a specific certificate, in my case that would be the third presented certificate.


I&#39;m attaching the output of the script and also the output of perl -V for my Win2003 Server.


Again, thanks so much for your help. Regards, Ariel.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">________________________________
From: Alexander Yezhov via RT &lt;bug-Crypt-LE@rt.cpan.org&gt;
Sent: Saturday, January 28, 2017 4:05 PM
To: arielgrin@outlook.com
Subject: [rt.cpan.org #119927] Crypt::LE bug when using web connection to check certificate expiration

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=119927">https://rt.cpan.org/Ticket/Display.html?id=119927</a></span> &gt;

Hello Ariel,

This is interesting indeed. I have just checked how the code would behave with the most recent ActiveState Perl version under Windows and the result was as expected, with the correct output produced. This could be down to some specifics in terms of libraries used, so I have attached a small script to this message, which should allow to see what exactly gets returned in the callbacks. If you could run it &#40;like &#34;perl crt.pl webmail.brokers.com.ar &gt; out.txt&#34;&#41; and send me the output, that could help to pinpoint the issue potentially or at least make the code adapt to this specific system behaviour.

Regards,

Alexander.

On Sat Jan 28 17:25:24 2017, arielgrin@outlook.com wrote:
<div class="message-stanza open">&gt; I think is a problem related to ActiveState Perl implementation,
&gt; because I tried it too with Strawberry Perl and it returned the right
&gt; expiration time. My domain is
&gt; webmail.brokers.com.ar&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://webmail.brokers.com.ar">http://webmail.brokers.com.ar</a></span>&gt;
&gt;
&gt; Enviado desde mi Móvil LG
</div></div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701540/913852/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/913852">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.9k</span>
</div>
<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701540/913853/crt.out">Download crt.out</a><br />
<span class="downloadcontenttype">application/octet-stream 607b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701540/913854/perl.out">Download perl.out</a><br />
<span class="downloadcontenttype">application/octet-stream 2.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1701956" href="/Public/Bug/Display.html?id=119927#txn-1701956">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;31&nbsp;14:27:00&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1701956/914082/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/914082">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ariel,

It is not so much about an order the results are seen listed in, but about the structure being returned. In this case the depth is just not there. But it is certainly good to see what is happening - I&#39;ll schedule an update in to account for configurations like this. Thanks for reporting.

Regards,

Alexander.

On Mon Jan 30 01:19:11 2017, arielgrin@outlook.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dear Alexander: thank you SO MUCH for your help. I ran the perl script
&gt; that you sent me and indeed, in my particular setup, the crt chain is
&gt; retrieved in &#34;reverse&#34; way: Root CA first, then Intermediate and
&gt; Client CRT at last.
&gt; 
&gt; 
&gt; If I understood your explanation correctly, your LE script is not
&gt; currently checking if the first retrieved certificate is actually the
&gt; one for the requested domain, it just returns the first certificate it
&gt; receives. Maybe there is a way to tell the script to choose a specific
&gt; certificate, in my case that would be the third presented certificate.
&gt; 
&gt; 
&gt; I&#39;m attaching the output of the script and also the output of perl -V
&gt; for my Win2003 Server.
&gt; 
&gt; 
&gt; Again, thanks so much for your help. Regards, Ariel.
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1719937" href="/Public/Bug/Display.html?id=119927#txn-1719937">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;17&nbsp;15:25:14&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1719937/924563/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/924563">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 351b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ariel,

Just to let you know - the issue with old libraries not reporting certificate depth as expected should be now fixed in version 0.21 &#40;which went to CPAN today, but yet to be indexed&#41;. Later this month there should also be Win32 and Win64 binaries available &#40;ZeroSSL site documentation will be updated accordingly&#41;.

Best regards,

Alexander.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1720158" href="/Public/Bug/Display.html?id=119927#txn-1720158">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;18&nbsp;18:12:15&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1720158/924695/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/924695">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 122b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing as resolved in 0.21. Please let me know if your environment is still experiences the issue &#40;though it should not&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1720160" href="/Public/Bug/Display.html?id=119927#txn-1720160">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;18&nbsp;18:12:16&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1720162" href="/Public/Bug/Display.html?id=119927#txn-1720162">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;18&nbsp;18:12:21&nbsp;2017</span>
    <span class="description">LEADER [...] cpan.org -  Fixed in 0.21 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.620896</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
