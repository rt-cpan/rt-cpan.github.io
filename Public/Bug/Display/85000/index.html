<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #85000 for XML-Compile: XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #85000 for XML-Compile: XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Compile/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Compile/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Compile/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Compile/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Compile">XML-Compile CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">85000</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Compile/Active/">XML-Compile</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jamdavis [...] franklinamerican.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40392-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40393-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.32    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;10:55:52&nbsp;2013</span>
    <span class="description">jamdavis [...] franklinamerican.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 May 2013 09:55:33 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-XML-Compile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James Davis &lt;jamdavis [...] franklinamerican.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is using XML::Compile::Schema::BuiltInFacets v1.32 on 32-bit perl
5.10.1.

It seems to work properly on 64-bit perl 5.16.1, but I suspect it&#39;s the
&#34;64-bit&#34; part that&#39;s important.

For testing, I copied _maybe_big into a separate file and passed it the
following:

  say _maybe_big&#40;undef, {}, &#34;999999.99&#34;&#41;;
  say _maybe_big&#40;undef, {}, &#34;9999999.99&#34;&#41;;

Result:

  999999.99
  NaN

It looks like the first test for [.eE] is succeeding, but the number&#39;s
short enough to not require Math::BigFloat -- so it falls through to the
next if/else and tries to return a Math::BigInt for 9999999.99.  It looks
like changing that second if to an elsif would do the trick, but it&#39;s
likely I haven&#39;t thought this through sufficiently.

perl -V output:
------------------------------
Summary of my perl5 &#40;revision 5 version 10 subversion 1&#41; configuration:

  Platform:
    osname=linux, osvers=2.6.24-28-server,
archname=i486-linux-gnu-thread-multi
    uname=&#39;linux roseapple 2.6.24-28-server #1 smp wed aug 18 21:17:51 utc
2010 i686 gnulinux &#39;
    config_args=&#39;-Dusethreads -Duselargefiles -Dccflags=-DDEBIAN
-Dcccdlflags=-fPIC -Darchname=i486-linux-gnu -Dprefix=/usr
-Dprivlib=/usr/share/perl/5.10 -Darchlib=/usr/lib/perl/5.10
-Dvendorprefix=/usr -Dvendorlib=/usr/share/perl5
-Dvendorarch=/usr/lib/perl5 -Dsiteprefix=/usr/local
-Dsitelib=/usr/local/share/perl/5.10.1
-Dsitearch=/usr/local/lib/perl/5.10.1 -Dman1dir=/usr/share/man/man1
-Dman3dir=/usr/share/man/man3 -Dsiteman1dir=/usr/local/man/man1
-Dsiteman3dir=/usr/local/man/man3 -Dman1ext=1 -Dman3ext=3perl
-Dpager=/usr/bin/sensible-pager -Uafs -Ud_csh -Ud_ualarm -Uusesfio -Uusenm
-DDEBUGGING=-g -Doptimize=-O2 -Duseshrplib -Dlibperl=libperl.so.5.10.1
-Dd_dosuid -des&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=undef, use64bitall=undef, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE -DDEBIAN
-fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include
-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64&#39;,
    optimize=&#39;-O2 -g&#39;,
    cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -DDEBIAN -fno-strict-aliasing
-pipe -fstack-protector -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.4.3&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=4, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39; -fstack-protector -L/usr/local/lib&#39;
    libpth=/usr/local/lib /lib /usr/lib /usr/lib64
    libs=-lgdbm -lgdbm_compat -ldb -ldl -lm -lpthread -lc -lcrypt
    perllibs=-ldl -lm -lpthread -lc -lcrypt
    libc=/lib/libc-2.11.1.so, so=so, useshrplib=true,
libperl=libperl.so.5.10.1
    gnulibc_version=&#39;2.11.1&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E&#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -g -L/usr/local/lib
-fstack-protector&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP
USE_ITHREADS
                        USE_LARGE_FILES USE_PERLIO USE_REENTRANT_API
  Built under linux
  Compiled at Apr 22 2011 18:17:20
  %ENV:
    PERL5LIB=&#34;/home/bna/jamdavis/perl5/lib/perl5&#34;
    PERLDB_OPTS=&#34;windowSize=40&#34;
    PERL_CPANM_OPT=&#34;--local-lib=~/perl5&#34;
  @INC:
    /home/bna/jamdavis/perl5/lib/perl5/i486-linux-gnu-thread-multi
    /home/bna/jamdavis/perl5/lib/perl5
    /etc/perl
    /usr/local/lib/perl/5.10.1
    /usr/local/share/perl/5.10.1
    /usr/lib/perl5
    /usr/share/perl5
    /usr/lib/perl/5.10
    /usr/share/perl/5.10
    /usr/local/lib/site_perl
------------------------------

James Davis

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">______________________________________________________________________
The information contained in and transmitted with this communication is strictly confidential, is intended only for use of the intended recipient, and is the property of Franklin American Mortgage Company. If you are not the intended recipient, you are hereby notified that any use of the information contained in or transmitted with the communication or distribution, dissemination or copying of this communication is strictly prohibited by law. If you have received this communication in error, please immediately return this communication to the Sender and delete the original message and any copy of it in your possession.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;11:45:08&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85000] XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 May 2013 17:44:33 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> James Davis via RT &lt;bug-XML-Compile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* James Davis via RT &#40;bug-XML-Compile@rt.cpan.org&#41; [130502 14:56]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thu May 02 10:55:52 2013: Request 85000 was acted upon.
&gt; Transaction: Ticket created by jamdavis@franklinamerican.com
&gt;        Queue: XML-Compile
&gt;      Subject: XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN
&gt; 5.10.1.
&gt; 
&gt; It seems to work properly on 64-bit perl 5.16.1, but I suspect it&#39;s the
&gt; &#34;64-bit&#34; part that&#39;s important.
&gt; 
&gt; For testing, I copied _maybe_big into a separate file and passed it the
&gt; following:
&gt;   say _maybe_big&#40;undef, {}, &#34;999999.99&#34;&#41;;
&gt;   say _maybe_big&#40;undef, {}, &#34;9999999.99&#34;&#41;;
</div>
Can you tell me what DBL_MAX_DIG and DBL_MAX_EXP &#40;from POSIX&#41; are on
your platform?

The logic seems insufficient.
  sub _maybe_big&#40;$$$&#41;
  { my &#40;$path, $args, $value&#41; = @_;
    ...
    $value =~ s/\s//g;
    if&#40;$value =~ m/[.eE]/&#41;
    {   my $c   = $value;
        my $exp = $c =~ s/[eE][+-]?&#40;\d+&#41;// ? $1 : 0;
        for&#40;$c&#41; { s/\.//; s/^[-+]// }
        return Math::BigFloat-&gt;new&#40;$value&#41;
            if length&#40;$c&#41; &gt; DBL_MAX_DIG || $exp &gt; DBL_MAX_EXP;

The digits befor the &#39;.&#39; should probably be added to $exp.

        my $exp = $c =~ s/[eE][+-]?&#40;\d+&#41;// ? $1 : 0;
        $c =~ /^[-+]?&#40;[0-9]*&#41;/;
        return Math::BigFloat-&gt;new&#40;$value&#41;
            if length&#40;$c&#41; &gt; DBL_MAX_DIG
            || $exp + length&#40;$1&#41; &gt; DBL_MAX_EXP;

What do you think?
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;11:45:08&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;11:59:18&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85000] XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 May 2013 17:58:57 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Overmeer via RT &lt;bug-XML-Compile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Mark Overmeer via RT &#40;bug-XML-Compile@rt.cpan.org&#41; [130502 15:45]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The digits befor the &#39;.&#39; should probably be added to $exp.
&gt; 
&gt;         my $exp = $c =~ s/[eE][+-]?&#40;\d+&#41;// ? $1 : 0;
&gt;         $c =~ /^[-+]?&#40;[0-9]*&#41;/;
&gt;         return Math::BigFloat-&gt;new&#40;$value&#41;
&gt;             if length&#40;$c&#41; &gt; DBL_MAX_DIG
&gt;             || $exp + length&#40;$1&#41; &gt; DBL_MAX_EXP;
</div>
Actually, it is both above AND that the constants are not taken
from POSIX.pm but hardcoded in the file... stupid incompleteness
in the development.

        use POSIX qw/DBL_DIG DBL_MAX_10_EXP/;

        my $exp = $c =~ s/[eE][+-]?&#40;[0-9]+&#41;// ? $1 : 0;
        my $pre = $c =~ /^[-+]?&#40;[0-9]*&#41;/ ? length&#40;$1&#41; : 0;

        return Math::BigFloat-&gt;new&#40;$value&#41;
            if $pre &gt;= DBL_DIG || $pre+$exp &gt;= DBL_MAX_10_EXP;

That&#39;s better.
-- 
Thanks for reporting,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;12:29:41&nbsp;2013</span>
    <span class="description">jamdavis [...] franklinamerican.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85000] XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 May 2013 11:29:25 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Compile [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James Davis &lt;jamdavis [...] franklinamerican.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think the trouble is that the first if block succeeds &#40;it&#39;s a float&#41;, but it&#39;s not big enough to require Math::BigFloat so it leaves the if. Then it moves on to the next if/else that assumes we&#39;re dealing with an integer. 

length&#40;9999999.99&#41; == length&#40;2147483647&#41; 

so it thinks it needs a BigInt, and .99 -&gt; NaN. That&#39;s why I think changing the if&#40;negative&#41;{...}else{...} block to start with an elsif&#40;&#41; would do the trick. 

Also: 


DBL_DIG =&gt; 15 
DBL_MAX_10_EXP =&gt; 308 
INT_MIN =&gt; -2147483648 
INT_MAX =&gt; 2147483647 

-- 
Jim 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----

From: &#34;Mark Overmeer via RT&#34; &lt;bug-XML-Compile@rt.cpan.org&gt; 
To: jamdavis@franklinamerican.com 
Sent: Thursday, May 2, 2013 10:59:18 AM 
Subject: Re: [rt.cpan.org #85000] XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=85000">https://rt.cpan.org/Ticket/Display.html?id=85000</a></span> &gt; 

* Mark Overmeer via RT &#40;bug-XML-Compile@rt.cpan.org&#41; [130502 15:45]: 
<div class="message-stanza open">&gt; The digits befor the &#39;.&#39; should probably be added to $exp. 
&gt; 
&gt; my $exp = $c =~ s/[eE][+-]?&#40;\d+&#41;// ? $1 : 0; 
&gt; $c =~ /^[-+]?&#40;[0-9]*&#41;/; 
&gt; return Math::BigFloat-&gt;new&#40;$value&#41; 
&gt; if length&#40;$c&#41; &gt; DBL_MAX_DIG 
&gt; || $exp + length&#40;$1&#41; &gt; DBL_MAX_EXP; 
</div>
Actually, it is both above AND that the constants are not taken 
from POSIX.pm but hardcoded in the file... stupid incompleteness 
in the development. 

use POSIX qw/DBL_DIG DBL_MAX_10_EXP/; 

my $exp = $c =~ s/[eE][+-]?&#40;[0-9]+&#41;// ? $1 : 0; 
my $pre = $c =~ /^[-+]?&#40;[0-9]*&#41;/ ? length&#40;$1&#41; : 0; 

return Math::BigFloat-&gt;new&#40;$value&#41; 
if $pre &gt;= DBL_DIG || $pre+$exp &gt;= DBL_MAX_10_EXP; 

That&#39;s better. 
-- 
Thanks for reporting, 

MarkOv 

------------------------------------------------------------------------ 
Mark Overmeer MSc MARKOV Solutions 
Mark@Overmeer.net solutions@overmeer.net 
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span> 



<div class="message-stanza open">______________________________________________________________________
The information contained in and transmitted with this communication is strictly confidential, is intended only for use of the intended recipient, and is the property of Franklin American Mortgage Company. If you are not the intended recipient, you are hereby notified that any use of the information contained in or transmitted with the communication or distribution, dissemination or copying of this communication is strictly prohibited by law. If you have received this communication in error, please immediately return this communication to the Sender and delete the original message and any copy of it in your possession.
</div></div></div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;14:43:42&nbsp;2013</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85000] XML::Compile::Schema::BuiltInFacets::_maybe_big reports 9999999.99 as NaN</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 May 2013 20:43:18 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> James Davis via RT &lt;bug-XML-Compile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* James Davis via RT &#40;bug-XML-Compile@rt.cpan.org&#41; [130502 16:29]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: XML-Compile
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=85000">https://rt.cpan.org/Ticket/Display.html?id=85000</a></span> &gt;
&gt; 
&gt; length&#40;9999999.99&#41; == length&#40;2147483647&#41; 
&gt; so it thinks it needs a BigInt, and .99 -&gt; NaN. That&#39;s why I think
&gt; changing the if&#40;negative&#41;{...}else{...} block to start with an elsif&#40;&#41;
&gt; would do the trick.
</div>
Yes, yes, and yes.  Well, three bugs solved in 1 report ;-&#41;
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;25&nbsp;03:19:34&nbsp;2013</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Got solved in 1.32
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;25&nbsp;03:19:35&nbsp;2013</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;25&nbsp;03:19:35&nbsp;2013</span>
    <span class="description">MARKOV [...] cpan.org -  Fixed in 1.32 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
