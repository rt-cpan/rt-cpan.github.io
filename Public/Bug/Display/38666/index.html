<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38666 for XML-LibXML: URI Option Does Not Work</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38666 for XML-LibXML: URI Option Does Not Work</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-LibXML/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML">XML-LibXML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38666</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">1.5 hours (90 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-LibXML/Active/">XML-LibXML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">phish [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dwheeler [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37350-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37351-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;14:24:44&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Eric Glover &lt;eric [...] searchme.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> URI Option Does Not Work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Aug 2008 11:24:22 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-xml-libxml [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Howdy,

This prints an undef:

#!/usr/local/bin/perl -w

use strict;
use warnings;
use feature &#39;:5.10&#39;;
use XML::LibXML;

my $html = &#39;&lt;html&gt;&lt;body&gt;&lt;p&gt;foo&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;;

my $parser = XML::LibXML-&gt;new;
my $doc = $parser-&gt;parse_html_string&#40;$html, { URI =&gt; &#39;http:// 
foo.com/&#39; }&#41;;
say $doc-&gt;baseURI;

Shouldn&#39;t baseURI return &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;">http://foo.com/&#39;</a></span>? Or am I mis-reading the  
docs?

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;23&nbsp;04:04:14&nbsp;2008</span>
    <span class="description">christian.glahn [...] lo-f.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38666] URI Option Does Not Work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 Aug 2008 10:03:55 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Glahn &lt;christian.glahn [...] lo-f.at&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

This appears to be a documentation bug. 

The synopsis suggests a hash reference passed to parse_*string&#40;&#41;
functions. However, if you look at the actual documentation you find
that the function expects a string as the optional second parameter. 

In this case the synopsis is wrong and the function description is
correct. I tested it with your code and it works nicely. 

Another remark: if you know that your input is XHTML &#40;rather than HTML
strict&#41; I suggest that you use the normal parse_string&#40;&#41; function
instead of its html sibling.

Cheers
Christian

On Fri, 2008-08-22 at 14:24 -0400, David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Aug 22 14:24:44 2008: Request 38666 was acted upon.
&gt; Transaction: Ticket created by DWHEELER
&gt;        Queue: XML-LibXML
&gt;      Subject: URI Option Does Not Work
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: dwheeler@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=38666">http://rt.cpan.org/Ticket/Display.html?id=38666</a></span> &gt;
&gt; 
&gt; 
&gt; Howdy,
&gt; 
&gt; This prints an undef:
&gt; 
&gt; #!/usr/local/bin/perl -w
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; use feature &#39;:5.10&#39;;
&gt; use XML::LibXML;
&gt; 
&gt; my $html = &#39;&lt;html&gt;&lt;body&gt;&lt;p&gt;foo&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;;
&gt; 
&gt; my $parser = XML::LibXML-&gt;new;
&gt; my $doc = $parser-&gt;parse_html_string&#40;$html, { URI =&gt; &#39;http:// 
&gt; foo.com/&#39; }&#41;;
&gt; say $doc-&gt;baseURI;
&gt; 
&gt; Shouldn&#39;t baseURI return &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;">http://foo.com/&#39;</a></span>? Or am I mis-reading the  
&gt; docs?
&gt; 
&gt; Thanks,
&gt; 
&gt; David
</div>-- 
Christian Glahn &lt;christian.glahn@lo-f.at&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;23&nbsp;04:04:16&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;23&nbsp;09:48:53&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38666] URI Option Does Not Work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 Aug 2008 06:48:25 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Aug 23, 2008, at 01:04, Christian Glahn via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This appears to be a documentation bug.
&gt;
&gt; The synopsis suggests a hash reference passed to parse_*string&#40;&#41;
&gt; functions. However, if you look at the actual documentation you find
&gt; that the function expects a string as the optional second parameter.
&gt;
&gt; In this case the synopsis is wrong and the function description is
&gt; correct. I tested it with your code and it works nicely.
</div>
I just did this:

my $html = &#39;&lt;html&gt;&lt;body&gt;&lt;p&gt;foo&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;;

my $parser = XML::LibXML-&gt;new;
my $doc = $parser-&gt;parse_html_string&#40;$html, &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;&#41;">http://foo.com/&#39;&#41;</a></span>;
say $doc-&gt;baseURI;

And it still printed an undef.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Another remark: if you know that your input is XHTML &#40;rather than HTML
&gt; strict&#41; I suggest that you use the normal parse_string&#40;&#41; function
&gt; instead of its html sibling.
</div>
This is why I&#39;m passing a hash. I&#39;m parsing arbitrary Web pages that  
will have god knows what kind of HTML in them. So my code actually  
looks like this:

my $parser = XML::LibXML-&gt;new;
my $doc = $parser-&gt;parse_html_string&#40;$html, {
     suppress_errors   =&gt; 1,       # Suppress errors
     suppress_warnings =&gt; 1,       # Suppress warnings
     no_network        =&gt; 1,       # Don&#39;t make network requests.
     recover           =&gt; 1,       # Relaxed parsing for bad HTML.
     URI               =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;">http://foo.com/&#39;</a></span>,
}&#41;;
say $doc-&gt;baseURI;

Which also, BTW, outputs undef. And so does this:

my $doc = $parser-&gt;parse_html_string&#40;$html, &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;">http://foo.com/&#39;</a></span>, {
     suppress_errors   =&gt; 1,       # Suppress errors
     suppress_warnings =&gt; 1,       # Suppress warnings
     no_network        =&gt; 1,       # Don&#39;t make network requests.
     recover           =&gt; 1,       # Relaxed parsing for bad HTML.
}&#41;;
say $doc-&gt;baseURI;

IOW, there is no way I can see to properly set baseURI.

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;24&nbsp;13:38:31&nbsp;2008</span>
    <span class="description">christian.glahn [...] lo-f.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38666] URI Option Does Not Work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 24 Aug 2008 19:38:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Glahn &lt;christian.glahn [...] lo-f.at&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

I dived into the code and found two issues and one of them explains your
problem.

You use the baseURI function. baseURI&#40;&#41; uses libxml2&#39;s xmlGetNodeBase&#40;&#41;
function, which determines the base URL for HTML documents from the base
tag in the documents header. Your document has no header and no base
tag. Hence, the result is correctly undef. 

But there are good news for you: on the document node of your DOM tree
and ONLY for this node, you can call the URI function, which returns the
internal URL that has been set by the parse function. 

Therefore, in line 5  instead of saying $doc-&gt;baseURI; you should say
$doc-&gt;URI;.

Cheers and thanks for the report
Christian


On Sat, 2008-08-23 at 09:48 -0400, David Wheeler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: XML-LibXML
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=38666">http://rt.cpan.org/Ticket/Display.html?id=38666</a></span> &gt;
&gt; 
&gt; On Aug 23, 2008, at 01:04, Christian Glahn via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; This appears to be a documentation bug.
&gt; &gt;
&gt; &gt; The synopsis suggests a hash reference passed to parse_*string&#40;&#41;
&gt; &gt; functions. However, if you look at the actual documentation you find
&gt; &gt; that the function expects a string as the optional second parameter.
&gt; &gt;
&gt; &gt; In this case the synopsis is wrong and the function description is
&gt; &gt; correct. I tested it with your code and it works nicely.
</div>&gt; 
&gt; I just did this:
&gt; 
&gt; my $html = &#39;&lt;html&gt;&lt;body&gt;&lt;p&gt;foo&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;;
&gt; 
&gt; my $parser = XML::LibXML-&gt;new;
&gt; my $doc = $parser-&gt;parse_html_string&#40;$html, &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;&#41;">http://foo.com/&#39;&#41;</a></span>;
&gt; say $doc-&gt;baseURI;
&gt; 
&gt; And it still printed an undef.
&gt; 
<div class="message-stanza open">&gt; &gt; Another remark: if you know that your input is XHTML &#40;rather than HTML
&gt; &gt; strict&#41; I suggest that you use the normal parse_string&#40;&#41; function
&gt; &gt; instead of its html sibling.
</div>&gt; 
&gt; This is why I&#39;m passing a hash. I&#39;m parsing arbitrary Web pages that  
&gt; will have god knows what kind of HTML in them. So my code actually  
&gt; looks like this:
&gt; 
&gt; my $parser = XML::LibXML-&gt;new;
&gt; my $doc = $parser-&gt;parse_html_string&#40;$html, {
&gt;      suppress_errors   =&gt; 1,       # Suppress errors
&gt;      suppress_warnings =&gt; 1,       # Suppress warnings
&gt;      no_network        =&gt; 1,       # Don&#39;t make network requests.
&gt;      recover           =&gt; 1,       # Relaxed parsing for bad HTML.
&gt;      URI               =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;">http://foo.com/&#39;</a></span>,
&gt; }&#41;;
&gt; say $doc-&gt;baseURI;
&gt; 
&gt; Which also, BTW, outputs undef. And so does this:
&gt; 
&gt; my $doc = $parser-&gt;parse_html_string&#40;$html, &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;">http://foo.com/&#39;</a></span>, {
&gt;      suppress_errors   =&gt; 1,       # Suppress errors
&gt;      suppress_warnings =&gt; 1,       # Suppress warnings
&gt;      no_network        =&gt; 1,       # Don&#39;t make network requests.
&gt;      recover           =&gt; 1,       # Relaxed parsing for bad HTML.
&gt; }&#41;;
&gt; say $doc-&gt;baseURI;
&gt; 
&gt; IOW, there is no way I can see to properly set baseURI.
&gt; 
&gt; David
</div>-- 
Christian Glahn &lt;christian.glahn@lo-f.at&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;24&nbsp;13:45:45&nbsp;2008</span>
    <span class="description">phish [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">90 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Problem was that baseURI&#40;&#41; works slightly different for XML and for HTML
documents. To access the URI the has been set during parse time in a
consistent way, one should call the URI&#40;&#41; function on the document root.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;24&nbsp;13:45:47&nbsp;2008</span>
    <span class="description">phish [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;24&nbsp;13:45:48&nbsp;2008</span>
    <span class="description">phish [...] cpan.org -  Given to PHISH</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;25&nbsp;18:53:56&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Eric Glover &lt;eric [...] searchme.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38666] URI Option Does Not Work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Aug 2008 15:53:42 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Aug 24, 2008, at 10:38, Christian Glahn via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I dived into the code and found two issues and one of them explains  
&gt; your
&gt; problem.
</div>
Thank you, Christian.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You use the baseURI function. baseURI&#40;&#41; uses libxml2&#39;s  
&gt; xmlGetNodeBase&#40;&#41;
&gt; function, which determines the base URL for HTML documents from the  
&gt; base
&gt; tag in the documents header. Your document has no header and no base
&gt; tag. Hence, the result is correctly undef.
</div>
Ah, okay, that makes sense.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But there are good news for you: on the document node of your DOM tree
&gt; and ONLY for this node, you can call the URI function, which returns  
&gt; the
&gt; internal URL that has been set by the parse function.
&gt;
&gt; Therefore, in line 5  instead of saying $doc-&gt;baseURI; you should say
&gt; $doc-&gt;URI;.
</div>
Great, this works:

my $parser = XML::LibXML-&gt;new;
my $doc = $parser-&gt;parse_html_string&#40;$html,  { URI =&gt; &#39;http:// 
foo.com/&#39; }&#41;;
say $doc-&gt;URI;

Good, that&#39;s exactly what I need. Any chance of the docs being updated  
to reflect this?

Note that this does not, however &#40;not that I care, but since it&#39;s what  
the docs seem to indicate:

my $parser = XML::LibXML-&gt;new;
my $doc = $parser-&gt;parse_html_string&#40;$html, &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://foo.com/&#39;&#41;">http://foo.com/&#39;&#41;</a></span>;
say $doc-&gt;URI;

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;25&nbsp;18:53:58&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;02&nbsp;15:51:41&nbsp;2008</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe the current documentation does not indicate that 
parse_html_string&#40;$html,$uri&#41; should do something useful &#40;unlike 
parse_html_string&#40;$html,{URI=&gt;$uri}&#41;, which works as expected&#41;.

I have added documentation of $doc-&gt;URI, added a $doc-&gt;setURI method,
and added documentation of $node-&gt;baseURI and $node-&gt;setBaseURI. The 
changes are in the SVN and will appear in 1.67 &#40;to be released soon&#41;.

With this, I&#39;m closing this ticket. Please do not reopen it, unless you 
want to complain about the changes made in SVN.

-- Petr
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;02&nbsp;15:51:43&nbsp;2008</span>
    <span class="description">pajas [...] matfyz.cz -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
