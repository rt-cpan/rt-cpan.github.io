<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43604 for MooseX-Types-Structured: More verbose validation error messages</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43604 for MooseX-Types-Structured: More verbose validation error messages</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MooseX-Types-Structured/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MooseX-Types-Structured/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MooseX-Types-Structured/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MooseX-Types-Structured/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MooseX-Types-Structured">MooseX-Types-Structured CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43604</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MooseX-Types-Structured/Active/">MooseX-Types-Structured</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
spurkis [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
steve.purkis [...] net-a-porter.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-224392-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.07    </td>
  </tr>
  <tr id="CF-224393-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;25&nbsp;08:49:09&nbsp;2009</span>
    <span class="description">steve [...] purkis.ca -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> steve.purkis [...] net-a-porter.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> More verbose validation error messages</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Currently, when validation fails you get error messages like:

died: Attribute &#40;payload&#41; does not pass the type constraint because:
Validation failed for
&#39;MooseX::Types::Structured::Dict[channel,Int,start,Str...]&#39; failed with
value HASH&#40;0x9d19c68&#41; at lib/My/Example/Tele.pm line 190

This doesn&#39;t help you track down *why* validation failed, which would be
really useful for nested data structures, ala:

has payload =&gt;
  &#40;
   is =&gt; &#39;rw&#39;,
   isa =&gt; Dict[
               channel =&gt; Int,
               start   =&gt; Str,
               shows   =&gt; ArrayRef[
                                   Dict[
                                        show_id     =&gt; Int,
                                        show_name   =&gt; Str,
                                        category_id =&gt; Num,
                                       ]
                                  ],
              ],
   required =&gt; 1
  &#41;;

If I mistype &#39;start&#39; =&gt; &#39;starrt&#39; it would be nice to have an error like:

  &#39;Field &#34;start&#34; is missing&#34;&#39;

Or similar.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;16:16:42&nbsp;2009</span>
    <span class="description">jjn1056 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 25 08:49:09 2009, SPURKIS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Currently, when validation fails you get error messages like:
&gt; 
&gt; died: Attribute &#40;payload&#41; does not pass the type constraint because:
&gt; Validation failed for
&gt; &#39;MooseX::Types::Structured::Dict[channel,Int,start,Str...]&#39; failed with
&gt; value HASH&#40;0x9d19c68&#41; at lib/My/Example/Tele.pm line 190
&gt; 
&gt; This doesn&#39;t help you track down *why* validation failed, which would be
&gt; really useful for nested data structures, ala:
&gt; 
&gt; has payload =&gt;
&gt;   &#40;
&gt;    is =&gt; &#39;rw&#39;,
&gt;    isa =&gt; Dict[
&gt;                channel =&gt; Int,
&gt;                start   =&gt; Str,
&gt;                shows   =&gt; ArrayRef[
&gt;                                    Dict[
&gt;                                         show_id     =&gt; Int,
&gt;                                         show_name   =&gt; Str,
&gt;                                         category_id =&gt; Num,
&gt;                                        ]
&gt;                                   ],
&gt;               ],
&gt;    required =&gt; 1
&gt;   &#41;;
&gt; 
&gt; If I mistype &#39;start&#39; =&gt; &#39;starrt&#39; it would be nice to have an error like:
&gt; 
&gt;   &#39;Field &#34;start&#34; is missing&#34;&#39;
&gt; 
&gt; Or similar.
</div>
The latest release &#40;0.08&#41; uses Devel::PartialDump to stringify the
reference you get in the value section of the error message.  It&#39;s a bit
better since you can now at least see what&#39;s getting passed to the type
constraint, but it&#39;s not giving you exact details.  The way the
underlying type constraint system is not going to make this trivial. 
We&#39;ll need some changes to Moose::Meta::TypeConstraint to support this,
I think.  I&#39;ll see if I can find a better way, this also bothers me.  In
the meantime, the message is somewhat better, but I&#39;m going to leave
this ticket open since the real problem isn&#39;t really solved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;16:16:42&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;20:21:43&nbsp;2009</span>
    <span class="description">jjn1056 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jjn1056 [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 06 16:16:42 2009, jjn1056@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Feb 25 08:49:09 2009, SPURKIS wrote:
<div class="message-stanza open">&gt; &gt; Currently, when validation fails you get error messages like:
&gt; &gt; 
&gt; &gt; died: Attribute &#40;payload&#41; does not pass the type constraint because:
&gt; &gt; Validation failed for
&gt; &gt; &#39;MooseX::Types::Structured::Dict[channel,Int,start,Str...]&#39; failed with
&gt; &gt; value HASH&#40;0x9d19c68&#41; at lib/My/Example/Tele.pm line 190
&gt; &gt; 
&gt; &gt; This doesn&#39;t help you track down *why* validation failed, which would be
&gt; &gt; really useful for nested data structures, ala:
&gt; &gt; 
&gt; &gt; has payload =&gt;
&gt; &gt;   &#40;
&gt; &gt;    is =&gt; &#39;rw&#39;,
&gt; &gt;    isa =&gt; Dict[
&gt; &gt;                channel =&gt; Int,
&gt; &gt;                start   =&gt; Str,
&gt; &gt;                shows   =&gt; ArrayRef[
&gt; &gt;                                    Dict[
&gt; &gt;                                         show_id     =&gt; Int,
&gt; &gt;                                         show_name   =&gt; Str,
&gt; &gt;                                         category_id =&gt; Num,
&gt; &gt;                                        ]
&gt; &gt;                                   ],
&gt; &gt;               ],
&gt; &gt;    required =&gt; 1
&gt; &gt;   &#41;;
&gt; &gt; 
&gt; &gt; If I mistype &#39;start&#39; =&gt; &#39;starrt&#39; it would be nice to have an error like:
&gt; &gt; 
&gt; &gt;   &#39;Field &#34;start&#34; is missing&#34;&#39;
&gt; &gt; 
&gt; &gt; Or similar.
</div>&gt; 
&gt; The latest release &#40;0.08&#41; uses Devel::PartialDump to stringify the
&gt; reference you get in the value section of the error message.  It&#39;s a bit
&gt; better since you can now at least see what&#39;s getting passed to the type
&gt; constraint, but it&#39;s not giving you exact details.  The way the
&gt; underlying type constraint system is not going to make this trivial. 
&gt; We&#39;ll need some changes to Moose::Meta::TypeConstraint to support this,
&gt; I think.  I&#39;ll see if I can find a better way, this also bothers me.  In
&gt; the meantime, the message is somewhat better, but I&#39;m going to leave
&gt; this ticket open since the real problem isn&#39;t really solved.
</div>
Just another update to whoever is listening :&#41;

0.10 adds in more details.  It returns the error of the failing internal
error for one level of structure.  For the rest it continues the 0.08
behavior of reporting the entire offending value, so at least you&#39;ll be
able to eyeball it.  It&#39;s still not exactly what this should be, so I&#39;m
continuing to leave this ticket open.  As mentioned in the docs, the
returned error messages are good for debugging, not for user returned
errors, since this will likely and gradually improve.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;06:38:56&nbsp;2009</span>
    <span class="description">steve [...] purkis.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 03 20:21:43 2009, jjn1056@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Just another update to whoever is listening :&#41;
&gt; 
&gt; 0.10 adds in more details.  It returns the error of the failing internal
&gt; error for one level of structure.  For the rest it continues the 0.08
&gt; behavior of reporting the entire offending value, so at least you&#39;ll be
&gt; able to eyeball it.  It&#39;s still not exactly what this should be, so I&#39;m
&gt; continuing to leave this ticket open.  As mentioned in the docs, the
&gt; returned error messages are good for debugging, not for user returned
&gt; errors, since this will likely and gradually improve.
</div>
Sounds like a step in the right direction, thanks.  Most of the
validation errors we&#39;ve had are several levels deep, but this will help
nonetheless!  Will try it out over the next week.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;09&nbsp;16:32:14&nbsp;2010</span>
    <span class="description">rafl [...] debian.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
