<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68510 for DBD-ODBC: DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68510 for DBD-ODBC: DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-ODBC">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-ODBC">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-ODBC">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-ODBC">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68510</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-ODBC">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pedrinho [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.30_7    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=68510">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939932" href="/Public/Bug/Display.html?id=68510#txn-939932">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;27&nbsp;10:24:18&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 27 May 2011 10:24:10 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/939932/488612/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488612">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 298b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">We&#39;ve noticed that low-severity errors &#40;e.g. warnings&#41; don&#39;t seem to trigger
the error handler when using DBD::ODBC.  I can&#39;t find documentation of a
threshold or other thing that would control this.

The same tests running under DBD::Sybase seem to trigger these warnings for
us.

Thanks,

-Peter
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/939932/488613/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488613">with headers</a>
<br />
<span class="downloadcontenttype">text/html 335b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939952" href="/Public/Bug/Display.html?id=68510#txn-939952">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;27&nbsp;11:13:05&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/939952/488628/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488628">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 513b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 27 10:24:18 2011, pedrinho@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We&#39;ve noticed that low-severity errors &#40;e.g. warnings&#41; don&#39;t seem to 
</div>trigger
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the error handler when using DBD::ODBC.  I can&#39;t find documentation of 
</div>a
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; threshold or other thing that would control this.
&gt; 
&gt; The same tests running under DBD::Sybase seem to trigger these 
</div>warnings for
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; us.
&gt; 
&gt; Thanks,
&gt; 
&gt; -Peter
</div>
Which error handler are you using - DBD::ODBC or DBIs?

Have you a small example I can look at?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939955" href="/Public/Bug/Display.html?id=68510#txn-939955">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;27&nbsp;11:13:06&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939956" href="/Public/Bug/Display.html?id=68510#txn-939956">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;27&nbsp;11:38:30&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 27 May 2011 11:38:20 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/939956/488632/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488632">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m using DBD::ODBC&#39;s but I&#39;ve tried the DBI handler - neither seems to fire
&#40;unless I&#39;m doing it wrong.  The DBI documentation for the handlers isn&#39;t as
explicit as I&#39;d like:

use DBI;
use Data::Dumper;
my $sev = $ARGV[0];
if &#40;$#ARGV == -1&#41; {
    print &#34;Usage: need a severity &#40;number between 1 and 20&#41;\n&#34;;
    exit&#40;2&#41;;
}
$dbh = DBI-&gt;connect&#40;&#34;dbi:ODBC:DSN=FOOSERVER;APP=errorout&#34;, &#34;foouser&#34;,
&#34;foopassword&#34;,
            {RaiseError=&gt;1,
            HandleError=&gt;sub {print Dumper&#40;\@_&#41; . &#34;\n&#34;}}&#41;;
$dbh-&gt;do&#40;&#34;raiserror&#40;&#39;This is a test&#39;, $sev, 1&#41;&#34;&#41;


This results in the following:
$ perl ~/tmp/raiserror_simple.pl
Usage: need a severity &#40;number between 1 and 20&#41;
$ perl ~/tmp/raiserror_simple.pl 4
$ perl ~/tmp/raiserror_simple.pl 5
$ perl ~/tmp/raiserror_simple.pl 10
$ perl ~/tmp/raiserror_simple.pl 11
$VAR1 = [
          &#39;DBD::ODBC::db do failed: [unixODBC][FreeTDS][SQL Server]This is a
test &#40;SQL-42000&#41;&#39;,
          bless&#40; {}, &#39;DBI::db&#39; &#41;,
          undef
        ];

The same results happen with the easysoft driver.

Thanks,

-Peter



On Fri, May 27, 2011 at 11:13 AM, Martin J Evans via RT &lt;
bug-DBD-ODBC@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;
&gt; On Fri May 27 10:24:18 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; We&#39;ve noticed that low-severity errors &#40;e.g. warnings&#41; don&#39;t seem to
</div>&gt; trigger
<div class="message-stanza open">&gt; &gt; the error handler when using DBD::ODBC.  I can&#39;t find documentation of
</div>&gt; a
<div class="message-stanza open">&gt; &gt; threshold or other thing that would control this.
&gt; &gt;
&gt; &gt; The same tests running under DBD::Sybase seem to trigger these
</div>&gt; warnings for
<div class="message-stanza open">&gt; &gt; us.
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt;
&gt; &gt; -Peter
</div>&gt;
&gt; Which error handler are you using - DBD::ODBC or DBIs?
&gt;
&gt; Have you a small example I can look at?
&gt;
&gt; Martin
&gt; --
&gt; Martin J. Evans
&gt; Wetherby, UK
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/939956/488633/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488633">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-940002" href="/Public/Bug/Display.html?id=68510#txn-940002">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;27&nbsp;14:45:04&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/940002/488656/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488656">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 27 11:38:30 2011, pedrinho@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m using DBD::ODBC&#39;s but I&#39;ve tried the DBI handler - neither seems
</div>to fire
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;unless I&#39;m doing it wrong.  The DBI documentation for the handlers
</div>isn&#39;t as
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; explicit as I&#39;d like:
&gt; 
&gt; use DBI;
&gt; use Data::Dumper;
&gt; my $sev = $ARGV[0];
&gt; if &#40;$#ARGV == -1&#41; {
&gt;     print &#34;Usage: need a severity &#40;number between 1 and 20&#41;\n&#34;;
&gt;     exit&#40;2&#41;;
&gt; }
&gt; $dbh = DBI-&gt;connect&#40;&#34;dbi:ODBC:DSN=FOOSERVER;APP=errorout&#34;, &#34;foouser&#34;,
&gt; &#34;foopassword&#34;,
&gt;             {RaiseError=&gt;1,
&gt;             HandleError=&gt;sub {print Dumper&#40;\@_&#41; . &#34;\n&#34;}}&#41;;
&gt; $dbh-&gt;do&#40;&#34;raiserror&#40;&#39;This is a test&#39;, $sev, 1&#41;&#34;&#41;
&gt; 
&gt; 
&gt; This results in the following:
&gt; $ perl ~/tmp/raiserror_simple.pl
&gt; Usage: need a severity &#40;number between 1 and 20&#41;
&gt; $ perl ~/tmp/raiserror_simple.pl 4
&gt; $ perl ~/tmp/raiserror_simple.pl 5
&gt; $ perl ~/tmp/raiserror_simple.pl 10
&gt; $ perl ~/tmp/raiserror_simple.pl 11
&gt; $VAR1 = [
&gt;           &#39;DBD::ODBC::db do failed: [unixODBC][FreeTDS][SQL
</div>Server]This is a
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; test &#40;SQL-42000&#41;&#39;,
&gt;           bless&#40; {}, &#39;DBI::db&#39; &#41;,
&gt;           undef
&gt;         ];
&gt; 
&gt; The same results happen with the easysoft driver.
&gt; 
&gt; Thanks,
&gt; 
&gt; -Peter
</div>
Just a quick reply as I&#39;ve not looked at it properly yet.

In you example you are using DBI&#39;s error handler I see.

In ODBC terms numbers less than 11 are SQL_SUCCESS_WITH_INFO returns.
Numbers &gt; 10 are errors and if I take your script as it is then for me
it does not enter the error handler at all but the do fails with:

DBD::ODBC::db do failed: [Microsoft][ODBC SQL Server Driver][SQL
Server]This is a test &#40;SQL-42000&#41; at rt68510.t line 11. &#40;See later&#41;.

I&#39;d expect the error handler to be called at least for errors but
warnings are different in DBI.

Also, for me, your code does not work as it seems to for you. I needed
to set HandleError after connect.

Hopefully, I can find some time to look at this over the weekend.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-940495" href="/Public/Bug/Display.html?id=68510#txn-940495">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;30&nbsp;05:15:02&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/940495/488929/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488929">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 27 14:45:04 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri May 27 11:38:30 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; I&#39;m using DBD::ODBC&#39;s but I&#39;ve tried the DBI handler - neither seems
</div>&gt; to fire
<div class="message-stanza open">&gt; &gt; &#40;unless I&#39;m doing it wrong.  The DBI documentation for the handlers
</div>&gt; isn&#39;t as
<div class="message-stanza open">&gt; &gt; explicit as I&#39;d like:
&gt; &gt; 
&gt; &gt; use DBI;
&gt; &gt; use Data::Dumper;
&gt; &gt; my $sev = $ARGV[0];
&gt; &gt; if &#40;$#ARGV == -1&#41; {
&gt; &gt;     print &#34;Usage: need a severity &#40;number between 1 and 20&#41;\n&#34;;
&gt; &gt;     exit&#40;2&#41;;
&gt; &gt; }
&gt; &gt; $dbh = DBI-&gt;connect&#40;&#34;dbi:ODBC:DSN=FOOSERVER;APP=errorout&#34;, &#34;foouser&#34;,
&gt; &gt; &#34;foopassword&#34;,
&gt; &gt;             {RaiseError=&gt;1,
&gt; &gt;             HandleError=&gt;sub {print Dumper&#40;\@_&#41; . &#34;\n&#34;}}&#41;;
&gt; &gt; $dbh-&gt;do&#40;&#34;raiserror&#40;&#39;This is a test&#39;, $sev, 1&#41;&#34;&#41;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; This results in the following:
&gt; &gt; $ perl ~/tmp/raiserror_simple.pl
&gt; &gt; Usage: need a severity &#40;number between 1 and 20&#41;
&gt; &gt; $ perl ~/tmp/raiserror_simple.pl 4
&gt; &gt; $ perl ~/tmp/raiserror_simple.pl 5
&gt; &gt; $ perl ~/tmp/raiserror_simple.pl 10
&gt; &gt; $ perl ~/tmp/raiserror_simple.pl 11
&gt; &gt; $VAR1 = [
&gt; &gt;           &#39;DBD::ODBC::db do failed: [unixODBC][FreeTDS][SQL
</div>&gt; Server]This is a
<div class="message-stanza open">&gt; &gt; test &#40;SQL-42000&#41;&#39;,
&gt; &gt;           bless&#40; {}, &#39;DBI::db&#39; &#41;,
&gt; &gt;           undef
&gt; &gt;         ];
&gt; &gt; 
&gt; &gt; The same results happen with the easysoft driver.
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt; -Peter
</div>&gt; 
&gt; Just a quick reply as I&#39;ve not looked at it properly yet.
&gt; 
&gt; In you example you are using DBI&#39;s error handler I see.
&gt; 
&gt; In ODBC terms numbers less than 11 are SQL_SUCCESS_WITH_INFO returns.
&gt; Numbers &gt; 10 are errors and if I take your script as it is then for me
&gt; it does not enter the error handler at all but the do fails with:
&gt; 
&gt; DBD::ODBC::db do failed: [Microsoft][ODBC SQL Server Driver][SQL
&gt; Server]This is a test &#40;SQL-42000&#41; at rt68510.t line 11. &#40;See later&#41;.
&gt; 
&gt; I&#39;d expect the error handler to be called at least for errors but
&gt; warnings are different in DBI.
&gt; 
&gt; Also, for me, your code does not work as it seems to for you. I needed
&gt; to set HandleError after connect.
&gt; 
&gt; Hopefully, I can find some time to look at this over the weekend.
&gt; 
&gt; Martin
</div>
It appears DBI does not call its error handler for warnings and when an
ODBC call returns SQL_SUCCESS_WITH_INFO &#40;which it does when raiseerror
is passed &lt; 11&#41; that turns into a warning. Warnings are treated
specially in DBI and you generally detect them by seeing if $h-&gt;err
returns 0 &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#err&#41;">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#err&#41;</a></span>.

If you read <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleError">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleError</a></span> it
says HandleError is called at the same point PrintError or RaiseError
would be called so I&#39;m not surprised DBI does not call the HandleError
routine for warnings.

You can change DBD::ODBC to cause the odbc_err_handler if you change the
following code in dbdimp.c:

Index: dbdimp.c
===================================================================
--- dbdimp.c    &#40;revision 14879&#41;
+++ dbdimp.c    &#40;working copy&#41;
@@ -457,13 +457,15 @@
    else {
       if &#40;ret == SQL_NO_DATA&#41; {
         rows = 0;
-      } else {
-        ret = SQLRowCount&#40;stmt, &#38;rows&#41;;
-        if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
-           dbd_error&#40; dbh, ret, &#34;SQLRowCount failed&#34; &#41;;
-           rows = -1;
-        }
+      } else if &#40;ret != SQL_SUCCESS&#41; {
+       dbd_error2&#40;dbh, ret, &#34;Execute immediate success with info&#34;,
+                  imp_dbh-&gt;henv, imp_dbh-&gt;hdbc, stmt &#41;;
       }
+      ret = SQLRowCount&#40;stmt, &#38;rows&#41;;
+      if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
+       dbd_error&#40; dbh, ret, &#34;SQLRowCount failed&#34; &#41;;
+       rows = -1;
+      }
    }
    ret = SQLFreeHandle&#40;SQL_HANDLE_STMT,stmt&#41;;
    if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {

but you&#39;ll see that although thay causes the ODBC error handler to be
called &#40;and assuming that handler returns 1&#41; it still does not get in
the DBI error handler as it is a warning.

If you want to capture warnings in DBI you can use HandleSetErr - see
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleSetErr">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleSetErr</a></span> which despite
its name is called for warnings too.

So, to summarise. It is possible DBD::ODBC should call its internal
handler when SQLExecDirect returns SQL_SUCCESS_WITH_INFO but there is no
precident in DBI to do so. If I changed it &#40;above code&#41; it may affect
others who have odbc error handlers and do not expect to get
informational/warning states. Whether I change it or not it will make no
difference to DBI&#39;s HandleError as it is only used for errors and not
warnings. Is raiseerror&#40;&lt;11&#41; a warning - I&#39;m afraid it is as
SQLExecDirect will return SQL_SUCCESS_WITH_INFO which is success but
there is something you might want to note. The most portable way of
catching the warning is with HandleSetErr. If you have a problem with
any of this it is probably best submitting a post to the dbi-users list
where other DBD authors and Tim Bunce hang out as they may have an
opinion as to whether something is wrong in DBD::ODBC or DBI.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-941557" href="/Public/Bug/Display.html?id=68510#txn-941557">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;02&nbsp;09:05:33&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/941557/489515/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489515">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon May 30 05:15:02 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri May 27 14:45:04 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Fri May 27 11:38:30 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; I&#39;m using DBD::ODBC&#39;s but I&#39;ve tried the DBI handler - neither 
</div></div></div>seems
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; to fire
<div class="message-stanza open">&gt; &gt; &gt; &#40;unless I&#39;m doing it wrong.  The DBI documentation for the 
</div></div></div>handlers
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; isn&#39;t as
<div class="message-stanza open">&gt; &gt; &gt; explicit as I&#39;d like:
&gt; &gt; &gt; 
&gt; &gt; &gt; use DBI;
&gt; &gt; &gt; use Data::Dumper;
&gt; &gt; &gt; my $sev = $ARGV[0];
&gt; &gt; &gt; if &#40;$#ARGV == -1&#41; {
&gt; &gt; &gt;     print &#34;Usage: need a severity &#40;number between 1 and 20&#41;\n&#34;;
&gt; &gt; &gt;     exit&#40;2&#41;;
&gt; &gt; &gt; }
&gt; &gt; &gt; $dbh = DBI-&gt;connect&#40;&#34;dbi:ODBC:DSN=FOOSERVER;APP=errorout&#34;, 
</div></div></div>&#34;foouser&#34;,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &#34;foopassword&#34;,
&gt; &gt; &gt;             {RaiseError=&gt;1,
&gt; &gt; &gt;             HandleError=&gt;sub {print Dumper&#40;\@_&#41; . &#34;\n&#34;}}&#41;;
&gt; &gt; &gt; $dbh-&gt;do&#40;&#34;raiserror&#40;&#39;This is a test&#39;, $sev, 1&#41;&#34;&#41;
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; This results in the following:
&gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl
&gt; &gt; &gt; Usage: need a severity &#40;number between 1 and 20&#41;
&gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 4
&gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 5
&gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 10
&gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 11
&gt; &gt; &gt; $VAR1 = [
&gt; &gt; &gt;           &#39;DBD::ODBC::db do failed: [unixODBC][FreeTDS][SQL
</div>&gt; &gt; Server]This is a
<div class="message-stanza open">&gt; &gt; &gt; test &#40;SQL-42000&#41;&#39;,
&gt; &gt; &gt;           bless&#40; {}, &#39;DBI::db&#39; &#41;,
&gt; &gt; &gt;           undef
&gt; &gt; &gt;         ];
&gt; &gt; &gt; 
&gt; &gt; &gt; The same results happen with the easysoft driver.
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; 
&gt; &gt; &gt; -Peter
</div>&gt; &gt; 
&gt; &gt; Just a quick reply as I&#39;ve not looked at it properly yet.
&gt; &gt; 
&gt; &gt; In you example you are using DBI&#39;s error handler I see.
&gt; &gt; 
&gt; &gt; In ODBC terms numbers less than 11 are SQL_SUCCESS_WITH_INFO 
</div></div>returns.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Numbers &gt; 10 are errors and if I take your script as it is then for 
</div></div>me
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; it does not enter the error handler at all but the do fails with:
&gt; &gt; 
&gt; &gt; DBD::ODBC::db do failed: [Microsoft][ODBC SQL Server Driver][SQL
&gt; &gt; Server]This is a test &#40;SQL-42000&#41; at rt68510.t line 11. &#40;See later&#41;.
&gt; &gt; 
&gt; &gt; I&#39;d expect the error handler to be called at least for errors but
&gt; &gt; warnings are different in DBI.
&gt; &gt; 
&gt; &gt; Also, for me, your code does not work as it seems to for you. I 
</div></div>needed
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; to set HandleError after connect.
&gt; &gt; 
&gt; &gt; Hopefully, I can find some time to look at this over the weekend.
&gt; &gt; 
&gt; &gt; Martin
</div>&gt; 
&gt; It appears DBI does not call its error handler for warnings and when 
</div>an
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ODBC call returns SQL_SUCCESS_WITH_INFO &#40;which it does when raiseerror
&gt; is passed &lt; 11&#41; that turns into a warning. Warnings are treated
&gt; specially in DBI and you generally detect them by seeing if $h-&gt;err
&gt; returns 0 &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#err&#41;">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#err&#41;</a></span>.
&gt; 
&gt; If you read <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleError">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleError</a></span> 
</div>it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; says HandleError is called at the same point PrintError or RaiseError
&gt; would be called so I&#39;m not surprised DBI does not call the HandleError
&gt; routine for warnings.
&gt; 
&gt; You can change DBD::ODBC to cause the odbc_err_handler if you change 
</div>the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; following code in dbdimp.c:
&gt; 
&gt; Index: dbdimp.c
&gt; ===================================================================
&gt; --- dbdimp.c    &#40;revision 14879&#41;
&gt; +++ dbdimp.c    &#40;working copy&#41;
&gt; @@ -457,13 +457,15 @@
&gt;     else {
&gt;        if &#40;ret == SQL_NO_DATA&#41; {
&gt;          rows = 0;
&gt; -      } else {
&gt; -        ret = SQLRowCount&#40;stmt, &#38;rows&#41;;
&gt; -        if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
&gt; -           dbd_error&#40; dbh, ret, &#34;SQLRowCount failed&#34; &#41;;
&gt; -           rows = -1;
&gt; -        }
&gt; +      } else if &#40;ret != SQL_SUCCESS&#41; {
&gt; +       dbd_error2&#40;dbh, ret, &#34;Execute immediate success with info&#34;,
&gt; +                  imp_dbh-&gt;henv, imp_dbh-&gt;hdbc, stmt &#41;;
&gt;        }
&gt; +      ret = SQLRowCount&#40;stmt, &#38;rows&#41;;
&gt; +      if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
&gt; +       dbd_error&#40; dbh, ret, &#34;SQLRowCount failed&#34; &#41;;
&gt; +       rows = -1;
&gt; +      }
&gt;     }
&gt;     ret = SQLFreeHandle&#40;SQL_HANDLE_STMT,stmt&#41;;
&gt;     if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
&gt; 
&gt; but you&#39;ll see that although thay causes the ODBC error handler to be
&gt; called &#40;and assuming that handler returns 1&#41; it still does not get in
&gt; the DBI error handler as it is a warning.
&gt; 
&gt; If you want to capture warnings in DBI you can use HandleSetErr - see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleSetErr">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleSetErr</a></span> which 
</div>despite
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; its name is called for warnings too.
&gt; 
&gt; So, to summarise. It is possible DBD::ODBC should call its internal
&gt; handler when SQLExecDirect returns SQL_SUCCESS_WITH_INFO but there is 
</div>no
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; precident in DBI to do so. If I changed it &#40;above code&#41; it may affect
&gt; others who have odbc error handlers and do not expect to get
&gt; informational/warning states. Whether I change it or not it will make 
</div>no
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; difference to DBI&#39;s HandleError as it is only used for errors and not
&gt; warnings. Is raiseerror&#40;&lt;11&#41; a warning - I&#39;m afraid it is as
&gt; SQLExecDirect will return SQL_SUCCESS_WITH_INFO which is success but
&gt; there is something you might want to note. The most portable way of
&gt; catching the warning is with HandleSetErr. If you have a problem with
&gt; any of this it is probably best submitting a post to the dbi-users 
</div>list
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; where other DBD authors and Tim Bunce hang out as they may have an
&gt; opinion as to whether something is wrong in DBD::ODBC or DBI.
&gt; 
&gt; Martin
</div>
I am happy to do more on this rt but I need some feedback as to what you 
are trying to achieve and what you think of my comments so far.

If you have moved on and no longer want to pursue this rt could you let 
me know so I can close it.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-941700" href="/Public/Bug/Display.html?id=68510#txn-941700">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;02&nbsp;16:11:44&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Jun 2011 16:11:34 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/941700/489602/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489602">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think that everything you&#39;ve said so far is reasonable.  I&#39;m encouraging
our users to expect to discard messages with severity &lt;= 10 since it seems
that the default behavior in this infrastructure is to install an error
handler that would discard these messages anyway.

If you suspect that it would be generally useful to propagate these messages
I&#39;ll help test that out and provide feedback as well.

-Peter

On Thu, Jun 2, 2011 at 9:05 AM, Martin J Evans via RT &lt;
bug-DBD-ODBC@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;
&gt; On Mon May 30 05:15:02 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Fri May 27 14:45:04 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Fri May 27 11:38:30 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; I&#39;m using DBD::ODBC&#39;s but I&#39;ve tried the DBI handler - neither
</div></div></div>&gt; seems
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; to fire
<div class="message-stanza open">&gt; &gt; &gt; &gt; &#40;unless I&#39;m doing it wrong.  The DBI documentation for the
</div></div></div>&gt; handlers
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; isn&#39;t as
<div class="message-stanza open">&gt; &gt; &gt; &gt; explicit as I&#39;d like:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; use DBI;
&gt; &gt; &gt; &gt; use Data::Dumper;
&gt; &gt; &gt; &gt; my $sev = $ARGV[0];
&gt; &gt; &gt; &gt; if &#40;$#ARGV == -1&#41; {
&gt; &gt; &gt; &gt;     print &#34;Usage: need a severity &#40;number between 1 and 20&#41;\n&#34;;
&gt; &gt; &gt; &gt;     exit&#40;2&#41;;
&gt; &gt; &gt; &gt; }
&gt; &gt; &gt; &gt; $dbh = DBI-&gt;connect&#40;&#34;dbi:ODBC:DSN=FOOSERVER;APP=errorout&#34;,
</div></div></div>&gt; &#34;foouser&#34;,
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; &#34;foopassword&#34;,
&gt; &gt; &gt; &gt;             {RaiseError=&gt;1,
&gt; &gt; &gt; &gt;             HandleError=&gt;sub {print Dumper&#40;\@_&#41; . &#34;\n&#34;}}&#41;;
&gt; &gt; &gt; &gt; $dbh-&gt;do&#40;&#34;raiserror&#40;&#39;This is a test&#39;, $sev, 1&#41;&#34;&#41;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This results in the following:
&gt; &gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl
&gt; &gt; &gt; &gt; Usage: need a severity &#40;number between 1 and 20&#41;
&gt; &gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 4
&gt; &gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 5
&gt; &gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 10
&gt; &gt; &gt; &gt; $ perl ~/tmp/raiserror_simple.pl 11
&gt; &gt; &gt; &gt; $VAR1 = [
&gt; &gt; &gt; &gt;           &#39;DBD::ODBC::db do failed: [unixODBC][FreeTDS][SQL
</div>&gt; &gt; &gt; Server]This is a
<div class="message-stanza open">&gt; &gt; &gt; &gt; test &#40;SQL-42000&#41;&#39;,
&gt; &gt; &gt; &gt;           bless&#40; {}, &#39;DBI::db&#39; &#41;,
&gt; &gt; &gt; &gt;           undef
&gt; &gt; &gt; &gt;         ];
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; The same results happen with the easysoft driver.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Thanks,
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; -Peter
</div>&gt; &gt; &gt;
&gt; &gt; &gt; Just a quick reply as I&#39;ve not looked at it properly yet.
&gt; &gt; &gt;
&gt; &gt; &gt; In you example you are using DBI&#39;s error handler I see.
&gt; &gt; &gt;
&gt; &gt; &gt; In ODBC terms numbers less than 11 are SQL_SUCCESS_WITH_INFO
</div></div>&gt; returns.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Numbers &gt; 10 are errors and if I take your script as it is then for
</div></div>&gt; me
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; it does not enter the error handler at all but the do fails with:
&gt; &gt; &gt;
&gt; &gt; &gt; DBD::ODBC::db do failed: [Microsoft][ODBC SQL Server Driver][SQL
&gt; &gt; &gt; Server]This is a test &#40;SQL-42000&#41; at rt68510.t line 11. &#40;See later&#41;.
&gt; &gt; &gt;
&gt; &gt; &gt; I&#39;d expect the error handler to be called at least for errors but
&gt; &gt; &gt; warnings are different in DBI.
&gt; &gt; &gt;
&gt; &gt; &gt; Also, for me, your code does not work as it seems to for you. I
</div></div>&gt; needed
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; to set HandleError after connect.
&gt; &gt; &gt;
&gt; &gt; &gt; Hopefully, I can find some time to look at this over the weekend.
&gt; &gt; &gt;
&gt; &gt; &gt; Martin
</div>&gt; &gt;
&gt; &gt; It appears DBI does not call its error handler for warnings and when
</div>&gt; an
<div class="message-stanza open">&gt; &gt; ODBC call returns SQL_SUCCESS_WITH_INFO &#40;which it does when raiseerror
&gt; &gt; is passed &lt; 11&#41; that turns into a warning. Warnings are treated
&gt; &gt; specially in DBI and you generally detect them by seeing if $h-&gt;err
&gt; &gt; returns 0 &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#err&#41;">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#err&#41;</a></span>.
&gt; &gt;
&gt; &gt; If you read <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleError">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleError</a></span>
</div>&gt; it
<div class="message-stanza open">&gt; &gt; says HandleError is called at the same point PrintError or RaiseError
&gt; &gt; would be called so I&#39;m not surprised DBI does not call the HandleError
&gt; &gt; routine for warnings.
&gt; &gt;
&gt; &gt; You can change DBD::ODBC to cause the odbc_err_handler if you change
</div>&gt; the
<div class="message-stanza open">&gt; &gt; following code in dbdimp.c:
&gt; &gt;
&gt; &gt; Index: dbdimp.c
&gt; &gt; ===================================================================
&gt; &gt; --- dbdimp.c    &#40;revision 14879&#41;
&gt; &gt; +++ dbdimp.c    &#40;working copy&#41;
&gt; &gt; @@ -457,13 +457,15 @@
&gt; &gt;     else {
&gt; &gt;        if &#40;ret == SQL_NO_DATA&#41; {
&gt; &gt;          rows = 0;
&gt; &gt; -      } else {
&gt; &gt; -        ret = SQLRowCount&#40;stmt, &#38;rows&#41;;
&gt; &gt; -        if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
&gt; &gt; -           dbd_error&#40; dbh, ret, &#34;SQLRowCount failed&#34; &#41;;
&gt; &gt; -           rows = -1;
&gt; &gt; -        }
&gt; &gt; +      } else if &#40;ret != SQL_SUCCESS&#41; {
&gt; &gt; +       dbd_error2&#40;dbh, ret, &#34;Execute immediate success with info&#34;,
&gt; &gt; +                  imp_dbh-&gt;henv, imp_dbh-&gt;hdbc, stmt &#41;;
&gt; &gt;        }
&gt; &gt; +      ret = SQLRowCount&#40;stmt, &#38;rows&#41;;
&gt; &gt; +      if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
&gt; &gt; +       dbd_error&#40; dbh, ret, &#34;SQLRowCount failed&#34; &#41;;
&gt; &gt; +       rows = -1;
&gt; &gt; +      }
&gt; &gt;     }
&gt; &gt;     ret = SQLFreeHandle&#40;SQL_HANDLE_STMT,stmt&#41;;
&gt; &gt;     if &#40;!SQL_SUCCEEDED&#40;ret&#41;&#41; {
&gt; &gt;
&gt; &gt; but you&#39;ll see that although thay causes the ODBC error handler to be
&gt; &gt; called &#40;and assuming that handler returns 1&#41; it still does not get in
&gt; &gt; the DBI error handler as it is a warning.
&gt; &gt;
&gt; &gt; If you want to capture warnings in DBI you can use HandleSetErr - see
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleSetErr">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#HandleSetErr</a></span> which
</div>&gt; despite
<div class="message-stanza open">&gt; &gt; its name is called for warnings too.
&gt; &gt;
&gt; &gt; So, to summarise. It is possible DBD::ODBC should call its internal
&gt; &gt; handler when SQLExecDirect returns SQL_SUCCESS_WITH_INFO but there is
</div>&gt; no
<div class="message-stanza open">&gt; &gt; precident in DBI to do so. If I changed it &#40;above code&#41; it may affect
&gt; &gt; others who have odbc error handlers and do not expect to get
&gt; &gt; informational/warning states. Whether I change it or not it will make
</div>&gt; no
<div class="message-stanza open">&gt; &gt; difference to DBI&#39;s HandleError as it is only used for errors and not
&gt; &gt; warnings. Is raiseerror&#40;&lt;11&#41; a warning - I&#39;m afraid it is as
&gt; &gt; SQLExecDirect will return SQL_SUCCESS_WITH_INFO which is success but
&gt; &gt; there is something you might want to note. The most portable way of
&gt; &gt; catching the warning is with HandleSetErr. If you have a problem with
&gt; &gt; any of this it is probably best submitting a post to the dbi-users
</div>&gt; list
<div class="message-stanza open">&gt; &gt; where other DBD authors and Tim Bunce hang out as they may have an
&gt; &gt; opinion as to whether something is wrong in DBD::ODBC or DBI.
&gt; &gt;
&gt; &gt; Martin
</div>&gt;
&gt; I am happy to do more on this rt but I need some feedback as to what you
&gt; are trying to achieve and what you think of my comments so far.
&gt;
&gt; If you have moved on and no longer want to pursue this rt could you let
&gt; me know so I can close it.
&gt;
&gt; Martin
&gt; --
&gt; Martin J. Evans
&gt; Wetherby, UK
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/941700/489603/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489603">with headers</a>
<br />
<span class="downloadcontenttype">text/html 8.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942120" href="/Public/Bug/Display.html?id=68510#txn-942120">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;03&nbsp;13:51:03&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/942120/489842/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489842">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 02 16:11:44 2011, pedrinho@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think that everything you&#39;ve said so far is reasonable.  I&#39;m encouraging
&gt; our users to expect to discard messages with severity &lt;= 10 since it seems
&gt; that the default behavior in this infrastructure is to install an error
&gt; handler that would discard these messages anyway.
&gt; 
&gt; If you suspect that it would be generally useful to propagate these
</div>messages
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll help test that out and provide feedback as well.
&gt; 
&gt; -Peter
</div>
Did you try the patch I included in this RT?

Looking at this again, my reservation was that it would change the
behaviour of DBD::ODBC to add that patch. However, some other warnings
already go to the odbc_err_handler so at best it is inconsistent and I&#39;m
thinking the bug is really that DBD::ODBC does not report warnings from
SQLExecute/SQLExecDirect full stop. So, I think I&#39;m going to apply the
patch in this RT and would be interested if you could try it out with
the odbc_err_handler then I could make it permanent and do another
development release.

Interestingly someone else just posted to the dbi-users list regarding
get_info and migration from DBD::Sybase to DBD::ODBC - perhaps that was
you or a colleague -
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html">http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html</a></span>.


Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942136" href="/Public/Bug/Display.html?id=68510#txn-942136">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;03&nbsp;14:49:07&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 3 Jun 2011 14:48:57 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/942136/489854/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489854">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ll try this out next week.

The other request is a funny coincidence.  He&#39;s a friend who I know is on a
parallel track at his work.

-Peter

On Fri, Jun 3, 2011 at 1:51 PM, Martin J Evans via RT &lt;
bug-DBD-ODBC@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;
&gt; On Thu Jun 02 16:11:44 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; I think that everything you&#39;ve said so far is reasonable.  I&#39;m
</div>&gt; encouraging
<div class="message-stanza open">&gt; &gt; our users to expect to discard messages with severity &lt;= 10 since it
</div>&gt; seems
<div class="message-stanza open">&gt; &gt; that the default behavior in this infrastructure is to install an error
&gt; &gt; handler that would discard these messages anyway.
&gt; &gt;
&gt; &gt; If you suspect that it would be generally useful to propagate these
</div>&gt; messages
<div class="message-stanza open">&gt; &gt; I&#39;ll help test that out and provide feedback as well.
&gt; &gt;
&gt; &gt; -Peter
</div>&gt;
&gt; Did you try the patch I included in this RT?
&gt;
&gt; Looking at this again, my reservation was that it would change the
&gt; behaviour of DBD::ODBC to add that patch. However, some other warnings
&gt; already go to the odbc_err_handler so at best it is inconsistent and I&#39;m
&gt; thinking the bug is really that DBD::ODBC does not report warnings from
&gt; SQLExecute/SQLExecDirect full stop. So, I think I&#39;m going to apply the
&gt; patch in this RT and would be interested if you could try it out with
&gt; the odbc_err_handler then I could make it permanent and do another
&gt; development release.
&gt;
&gt; Interestingly someone else just posted to the dbi-users list regarding
&gt; get_info and migration from DBD::Sybase to DBD::ODBC - perhaps that was
&gt; you or a colleague -
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html">http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html</a></span>.
&gt;
&gt;
&gt; Martin
&gt; --
&gt; Martin J. Evans
&gt; Wetherby, UK
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/942136/489855/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489855">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942810" href="/Public/Bug/Display.html?id=68510#txn-942810">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;12:07:19&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Jun 2011 12:07:09 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/942810/490190/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490190">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The patch does cause errors to be raised into the odbc_err_handler &#40;tesed on
SQL Server 2008R2 with raiserror&#40;&#39;message&#39;, $sev, 1&#41;&#41;.

I&#39;m not clear on how this should interact with DBI&#39;s HandleError, since with
this patch it seems to remain silent until the severity goes beyond 10.

-Peter

On Fri, Jun 3, 2011 at 1:51 PM, Martin J Evans via RT &lt;
bug-DBD-ODBC@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;
&gt; On Thu Jun 02 16:11:44 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; I think that everything you&#39;ve said so far is reasonable.  I&#39;m
</div>&gt; encouraging
<div class="message-stanza open">&gt; &gt; our users to expect to discard messages with severity &lt;= 10 since it
</div>&gt; seems
<div class="message-stanza open">&gt; &gt; that the default behavior in this infrastructure is to install an error
&gt; &gt; handler that would discard these messages anyway.
&gt; &gt;
&gt; &gt; If you suspect that it would be generally useful to propagate these
</div>&gt; messages
<div class="message-stanza open">&gt; &gt; I&#39;ll help test that out and provide feedback as well.
&gt; &gt;
&gt; &gt; -Peter
</div>&gt;
&gt; Did you try the patch I included in this RT?
&gt;
&gt; Looking at this again, my reservation was that it would change the
&gt; behaviour of DBD::ODBC to add that patch. However, some other warnings
&gt; already go to the odbc_err_handler so at best it is inconsistent and I&#39;m
&gt; thinking the bug is really that DBD::ODBC does not report warnings from
&gt; SQLExecute/SQLExecDirect full stop. So, I think I&#39;m going to apply the
&gt; patch in this RT and would be interested if you could try it out with
&gt; the odbc_err_handler then I could make it permanent and do another
&gt; development release.
&gt;
&gt; Interestingly someone else just posted to the dbi-users list regarding
&gt; get_info and migration from DBD::Sybase to DBD::ODBC - perhaps that was
&gt; you or a colleague -
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html">http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html</a></span>.
&gt;
&gt;
&gt; Martin
&gt; --
&gt; Martin J. Evans
&gt; Wetherby, UK
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/942810/490191/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490191">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942844" href="/Public/Bug/Display.html?id=68510#txn-942844">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;14:16:48&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Jun 2011 14:16:38 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/942844/490220/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490220">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Something interesting in the Sybase-&gt;SQL Server transition:

$dbh-&gt;do&#40;&#34;use tempdb; set statistics io on select top 1 * from
sys.objects&#34;&#41;;

Doesn&#39;t do what we&#39;d expect, which is to return statistics info to the
message handler.  Instead this is the  output via the freetds odbc driver:

$ perl ~/tmp/causerr.pl
$VAR1 = [
          &#39;01000&#39;,
          &#39;[unixODBC][FreeTDS][SQL Server]Changed database context to
\&#39;tempdb\&#39;.&#39;,
          5701
        ];

However this works for Sybase, which makes me think that SQL Server is
simply not providing a message with the info that isn&#39;t being returned.  Any
idea whether this gets signaled somehow?

Thanks,

-Peter



On Mon, Jun 6, 2011 at 12:07 PM, Peter C. Norton &lt;pedrinho@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The patch does cause errors to be raised into the odbc_err_handler &#40;tesed
&gt; on SQL Server 2008R2 with raiserror&#40;&#39;message&#39;, $sev, 1&#41;&#41;.
&gt;
&gt; I&#39;m not clear on how this should interact with DBI&#39;s HandleError, since
&gt; with this patch it seems to remain silent until the severity goes beyond 10.
&gt;
&gt; -Peter
&gt;
&gt;
&gt; On Fri, Jun 3, 2011 at 1:51 PM, Martin J Evans via RT &lt;
&gt; bug-DBD-ODBC@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;&gt;
&gt;&gt; On Thu Jun 02 16:11:44 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; &gt; I think that everything you&#39;ve said so far is reasonable.  I&#39;m
</div>&gt;&gt; encouraging
<div class="message-stanza open">&gt;&gt; &gt; our users to expect to discard messages with severity &lt;= 10 since it
</div>&gt;&gt; seems
<div class="message-stanza open">&gt;&gt; &gt; that the default behavior in this infrastructure is to install an error
&gt;&gt; &gt; handler that would discard these messages anyway.
&gt;&gt; &gt;
&gt;&gt; &gt; If you suspect that it would be generally useful to propagate these
</div>&gt;&gt; messages
<div class="message-stanza open">&gt;&gt; &gt; I&#39;ll help test that out and provide feedback as well.
&gt;&gt; &gt;
&gt;&gt; &gt; -Peter
</div>&gt;&gt;
&gt;&gt; Did you try the patch I included in this RT?
&gt;&gt;
&gt;&gt; Looking at this again, my reservation was that it would change the
&gt;&gt; behaviour of DBD::ODBC to add that patch. However, some other warnings
&gt;&gt; already go to the odbc_err_handler so at best it is inconsistent and I&#39;m
&gt;&gt; thinking the bug is really that DBD::ODBC does not report warnings from
&gt;&gt; SQLExecute/SQLExecDirect full stop. So, I think I&#39;m going to apply the
&gt;&gt; patch in this RT and would be interested if you could try it out with
&gt;&gt; the odbc_err_handler then I could make it permanent and do another
&gt;&gt; development release.
&gt;&gt;
&gt;&gt; Interestingly someone else just posted to the dbi-users list regarding
&gt;&gt; get_info and migration from DBD::Sybase to DBD::ODBC - perhaps that was
&gt;&gt; you or a colleague -
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html">http://www.nntp.perl.org/group/perl.dbi.users/2011/06/msg35864.html</a></span>.
&gt;&gt;
&gt;&gt;
&gt;&gt; Martin
&gt;&gt; --
&gt;&gt; Martin J. Evans
&gt;&gt; Wetherby, UK
&gt;&gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/942844/490221/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490221">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942846" href="/Public/Bug/Display.html?id=68510#txn-942846">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;14:22:36&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/942846/490223/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490223">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 06 12:07:19 2011, pedrinho@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The patch does cause errors to be raised into the odbc_err_handler
</div>&#40;tesed on
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; SQL Server 2008R2 with raiserror&#40;&#39;message&#39;, $sev, 1&#41;&#41;.
&gt; 
&gt; I&#39;m not clear on how this should interact with DBI&#39;s HandleError,
</div>since with
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; this patch it seems to remain silent until the severity goes beyond 10.
&gt; 
&gt; -Peter
</div>
Thanks Peter.

DBD::ODBC&#39;s odbc_err_handler differs from DBI&#39;s. DBD::ODBC&#39;s
odbc_err_handler predates DBI&#39;s but was never removed because people
still use it. DBD::ODBC&#39;s handler is called for errors &#40;SQL_ERROR etc
from ODBC calls which are raised as DBI errors&#41; AND warnings
&#40;SQL_SUCCESS_WITH_INFO from ODBC calls which are raised as DBI warnings
since that is what DBI mandates&#41; which differs from DBI&#39;s handler which
is only called for errors. All the patch does is capture another warning
that was not caught before &#40;which is why I had less of a problem with it&#41;.

Possibly your problem seeing this is that you are using raiseERROR
&#40;which sounds like errors&#41; but in fact error numbers passed to
raiseerror of &lt; 11 cause the ODBC call to return SQL_SUCCESS_WITH_INFO
which is translated to a warning in DBI terms but still causes
DBD::ODBC&#39;s error handler to be called.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942849" href="/Public/Bug/Display.html?id=68510#txn-942849">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;14:25:59&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/942849/490226/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490226">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 978b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 06 14:16:48 2011, pedrinho@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Something interesting in the Sybase-&gt;SQL Server transition:
&gt; 
&gt; $dbh-&gt;do&#40;&#34;use tempdb; set statistics io on select top 1 * from
&gt; sys.objects&#34;&#41;;
&gt; 
&gt; Doesn&#39;t do what we&#39;d expect, which is to return statistics info to the
&gt; message handler.  Instead this is the  output via the freetds odbc
&gt; driver:
&gt; 
&gt; $ perl ~/tmp/causerr.pl
&gt; $VAR1 = [
&gt;           &#39;01000&#39;,
&gt;           &#39;[unixODBC][FreeTDS][SQL Server]Changed database context to
&gt; \&#39;tempdb\&#39;.&#39;,
&gt;           5701
&gt;         ];
&gt; 
&gt; However this works for Sybase, which makes me think that SQL Server is
&gt; simply not providing a message with the info that isn&#39;t being
&gt; returned.  Any
&gt; idea whether this gets signaled somehow?
&gt; 
&gt; Thanks,
&gt; 
&gt; -Peter
</div>
I&#39;d need to see a trace of this to see what is happening. set and export
DBI_TRACE=15=x.log and run the code above then attach the x.log file to
this RT and I&#39;ll take a look.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942854" href="/Public/Bug/Display.html?id=68510#txn-942854">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;14:43:59&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/942854/490231/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490231">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 06 14:25:59 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jun 06 14:16:48 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Something interesting in the Sybase-&gt;SQL Server transition:
&gt; &gt; 
&gt; &gt; $dbh-&gt;do&#40;&#34;use tempdb; set statistics io on select top 1 * from
&gt; &gt; sys.objects&#34;&#41;;
&gt; &gt; 
&gt; &gt; Doesn&#39;t do what we&#39;d expect, which is to return statistics info to the
&gt; &gt; message handler.  Instead this is the  output via the freetds odbc
&gt; &gt; driver:
&gt; &gt; 
&gt; &gt; $ perl ~/tmp/causerr.pl
&gt; &gt; $VAR1 = [
&gt; &gt;           &#39;01000&#39;,
&gt; &gt;           &#39;[unixODBC][FreeTDS][SQL Server]Changed database context to
&gt; &gt; \&#39;tempdb\&#39;.&#39;,
&gt; &gt;           5701
&gt; &gt;         ];
&gt; &gt; 
&gt; &gt; However this works for Sybase, which makes me think that SQL Server is
&gt; &gt; simply not providing a message with the info that isn&#39;t being
&gt; &gt; returned.  Any
&gt; &gt; idea whether this gets signaled somehow?
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt; -Peter
</div>&gt; 
&gt; I&#39;d need to see a trace of this to see what is happening. set and export
&gt; DBI_TRACE=15=x.log and run the code above then attach the x.log file to
&gt; this RT and I&#39;ll take a look.
&gt; 
&gt; Martin
</div>
Actually, I just tried it with the MS SQL Server ODBC driver and it
exhibits the same as freeTDS.

The &#34;set statistics io on select top 1 * from sys.objects&#34; does not
generate SQL_SUCCESS_WITH_INFO. You can test this yourself by separating
the use from the set in 2 different dos.

I will need to play with this more to see why - it may be normal behaviour.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-942864" href="/Public/Bug/Display.html?id=68510#txn-942864">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;15:28:24&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Jun 2011 15:28:13 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/942864/490242/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490242">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, the &#34;use tempdb&#34; was only there to elicit a message for comparison.
It&#39;s possible that neither does &#34;$dbh-&gt;do&#40;&#39;sp_help [sys.objects]&#39;&#41;&#34; for
instance, which does elicit a message on Sybase, though I don&#39;t know if this
is defined behavior or not.

If you don&#39;t need it, I&#39;ll skip the DBI trace, but I&#39;d be interested in
whatever you find regarding the behavior of SQL Server and whether it&#39;s
expected that this will behave so differently.

Thanks,

-Peter

On Mon, Jun 6, 2011 at 2:44 PM, Martin J Evans via RT &lt;
bug-DBD-ODBC@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;
&gt; On Mon Jun 06 14:25:59 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Mon Jun 06 14:16:48 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; Something interesting in the Sybase-&gt;SQL Server transition:
&gt; &gt; &gt;
&gt; &gt; &gt; $dbh-&gt;do&#40;&#34;use tempdb; set statistics io on select top 1 * from
&gt; &gt; &gt; sys.objects&#34;&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; Doesn&#39;t do what we&#39;d expect, which is to return statistics info to the
&gt; &gt; &gt; message handler.  Instead this is the  output via the freetds odbc
&gt; &gt; &gt; driver:
&gt; &gt; &gt;
&gt; &gt; &gt; $ perl ~/tmp/causerr.pl
&gt; &gt; &gt; $VAR1 = [
&gt; &gt; &gt;           &#39;01000&#39;,
&gt; &gt; &gt;           &#39;[unixODBC][FreeTDS][SQL Server]Changed database context to
&gt; &gt; &gt; \&#39;tempdb\&#39;.&#39;,
&gt; &gt; &gt;           5701
&gt; &gt; &gt;         ];
&gt; &gt; &gt;
&gt; &gt; &gt; However this works for Sybase, which makes me think that SQL Server is
&gt; &gt; &gt; simply not providing a message with the info that isn&#39;t being
&gt; &gt; &gt; returned.  Any
&gt; &gt; &gt; idea whether this gets signaled somehow?
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt;
&gt; &gt; &gt; -Peter
</div>&gt; &gt;
&gt; &gt; I&#39;d need to see a trace of this to see what is happening. set and export
&gt; &gt; DBI_TRACE=15=x.log and run the code above then attach the x.log file to
&gt; &gt; this RT and I&#39;ll take a look.
&gt; &gt;
&gt; &gt; Martin
</div>&gt;
&gt; Actually, I just tried it with the MS SQL Server ODBC driver and it
&gt; exhibits the same as freeTDS.
&gt;
&gt; The &#34;set statistics io on select top 1 * from sys.objects&#34; does not
&gt; generate SQL_SUCCESS_WITH_INFO. You can test this yourself by separating
&gt; the use from the set in 2 different dos.
&gt;
&gt; I will need to play with this more to see why - it may be normal behaviour.
&gt;
&gt; Martin
&gt; --
&gt; Martin J. Evans
&gt; Wetherby, UK
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/942864/490243/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490243">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-943528" href="/Public/Bug/Display.html?id=68510#txn-943528">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;08&nbsp;15:36:37&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 8 Jun 2011 15:36:27 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/943528/490568/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490568">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is strange.  So looking at the dbdimp.c, do&#40;&#41; eventually calls
SQLExecDirect, which returns 0 when I run a select with the &#34;set statistics
io on ...&#34;, but if it&#39;s prepared and executed via selectall_arrayref&#40;&#41; it
goes through a completely different code path.

I can&#39;t really determine via looking at DBI and DBD::ODBC source code
exactly what the code path is for selectall_arrayref&#40;&#41; when called like
this:

my $ref = $dbh-&gt;selectall_arrayref&#40;&#34;set statistics io on select top 1 * from
sysusers&#34;&#41;;

but doing this does cause the odbc_err_handler to receive the messages,
apparently SQL_SUCCESS_WITH_INFO, I guess via dbd_st_fetch&#40;&#41;.

I suppose this makes sense, but the data doesn&#39;t come out if I only do a
prepare&#40;&#41;+execute&#40;&#41;+fetch&#40;&#41; all available rows - only then does the trace
show:

    &lt;- fetchrow_array= &#40; &#39;0&#39; &#39;0&#39; &#39;public&#39; &#39;.......    ....Â«3.v#.v@.Ã’Â©.2kÃºU&#39;
undef &#39;Apr 08 2003 09:10AM&#39; &#39;Jul 09 2008 04:19PM&#39; &#39;1&#39; undef &#39;0&#39; undef &#39;0&#39;
&#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;1&#39; &#39;0&#39; &#41; [20 items] row1 at /u/nortonp/tmp/
statistics_in_the_resultset.pl line 14
    -&gt; fetchrow_array for DBD::ODBC::st &#40;DBI::st=HASH&#40;0x720010&#41;~0x71ffb0&#41;
thr#411400
    SQLFetch rc 100
    !!dbd_error2&#40;err_rc=1, what=st_fetch/SQLMoreResults,
handles=&#40;7c18d0,7c1f20,7cff40&#41;
    !SQLError&#40;7c18d0,7c1f20,7cff40&#41; = &#40;01000, 3615, [unixODBC]  ...

etc... so no errors are signaled until the results are fetched and
100/SQL_NO_DATA/SQL_NO_DATA_FOUND is returned and SQLMoreResults at around
line 2833 in my dbdimp.c, followed by another check where
SQL_SUCCESS_WITH_INFO seems to finally be returned.

So it seems like via both easysoft and freetds odbc drivers SQL Server is
simply returning SQL_SUCCEEDED and only if results are SQLFetch&#40;&#41;&#39;d and
SQL_NO_DATA is encountered will the error message be seen.

Does this match what you&#39;re seeing?

-Peter



On Mon, Jun 6, 2011 at 3:28 PM, Peter C. Norton &lt;pedrinho@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, the &#34;use tempdb&#34; was only there to elicit a message for comparison.
&gt; It&#39;s possible that neither does &#34;$dbh-&gt;do&#40;&#39;sp_help [sys.objects]&#39;&#41;&#34; for
&gt; instance, which does elicit a message on Sybase, though I don&#39;t know if this
&gt; is defined behavior or not.
&gt;
&gt; If you don&#39;t need it, I&#39;ll skip the DBI trace, but I&#39;d be interested in
&gt; whatever you find regarding the behavior of SQL Server and whether it&#39;s
&gt; expected that this will behave so differently.
&gt;
&gt; Thanks,
&gt;
&gt; -Peter
&gt;
&gt;
&gt; On Mon, Jun 6, 2011 at 2:44 PM, Martin J Evans via RT &lt;
&gt; bug-DBD-ODBC@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;&gt;
&gt;&gt; On Mon Jun 06 14:25:59 2011, MJEVANS wrote:
<div class="message-stanza open">&gt;&gt; &gt; On Mon Jun 06 14:16:48 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; &gt; &gt; Something interesting in the Sybase-&gt;SQL Server transition:
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; $dbh-&gt;do&#40;&#34;use tempdb; set statistics io on select top 1 * from
&gt;&gt; &gt; &gt; sys.objects&#34;&#41;;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Doesn&#39;t do what we&#39;d expect, which is to return statistics info to the
&gt;&gt; &gt; &gt; message handler.  Instead this is the  output via the freetds odbc
&gt;&gt; &gt; &gt; driver:
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; $ perl ~/tmp/causerr.pl
&gt;&gt; &gt; &gt; $VAR1 = [
&gt;&gt; &gt; &gt;           &#39;01000&#39;,
&gt;&gt; &gt; &gt;           &#39;[unixODBC][FreeTDS][SQL Server]Changed database context to
&gt;&gt; &gt; &gt; \&#39;tempdb\&#39;.&#39;,
&gt;&gt; &gt; &gt;           5701
&gt;&gt; &gt; &gt;         ];
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; However this works for Sybase, which makes me think that SQL Server is
&gt;&gt; &gt; &gt; simply not providing a message with the info that isn&#39;t being
&gt;&gt; &gt; &gt; returned.  Any
&gt;&gt; &gt; &gt; idea whether this gets signaled somehow?
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Thanks,
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; -Peter
</div>&gt;&gt; &gt;
&gt;&gt; &gt; I&#39;d need to see a trace of this to see what is happening. set and export
&gt;&gt; &gt; DBI_TRACE=15=x.log and run the code above then attach the x.log file to
&gt;&gt; &gt; this RT and I&#39;ll take a look.
&gt;&gt; &gt;
&gt;&gt; &gt; Martin
</div>&gt;&gt;
&gt;&gt; Actually, I just tried it with the MS SQL Server ODBC driver and it
&gt;&gt; exhibits the same as freeTDS.
&gt;&gt;
&gt;&gt; The &#34;set statistics io on select top 1 * from sys.objects&#34; does not
&gt;&gt; generate SQL_SUCCESS_WITH_INFO. You can test this yourself by separating
&gt;&gt; the use from the set in 2 different dos.
&gt;&gt;
&gt;&gt; I will need to play with this more to see why - it may be normal
&gt;&gt; behaviour.
&gt;&gt;
&gt;&gt; Martin
&gt;&gt; --
&gt;&gt; Martin J. Evans
&gt;&gt; Wetherby, UK
&gt;&gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/943528/490569/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490569">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-943565" href="/Public/Bug/Display.html?id=68510#txn-943565">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;08&nbsp;19:29:02&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 8 Jun 2011 19:28:50 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/943565/490593/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490593">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">And, the last weirdness: back to your remarking on the inconsistency of the
passing of warnings via the error handler, what can be done to eliminate
that?  Is there a proper way to pass this to the DBI warning string, or to
attach a property to the message so that warnings can be distinguished from
errors?

-Peter

On Wed, Jun 8, 2011 at 3:36 PM, Peter C. Norton &lt;pedrinho@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is strange.  So looking at the dbdimp.c, do&#40;&#41; eventually calls
&gt; SQLExecDirect, which returns 0 when I run a select with the &#34;set statistics
&gt; io on ...&#34;, but if it&#39;s prepared and executed via selectall_arrayref&#40;&#41; it
&gt; goes through a completely different code path.
&gt;
&gt; I can&#39;t really determine via looking at DBI and DBD::ODBC source code
&gt; exactly what the code path is for selectall_arrayref&#40;&#41; when called like
&gt; this:
&gt;
&gt; my $ref = $dbh-&gt;selectall_arrayref&#40;&#34;set statistics io on select top 1 *
&gt; from sysusers&#34;&#41;;
&gt;
&gt; but doing this does cause the odbc_err_handler to receive the messages,
&gt; apparently SQL_SUCCESS_WITH_INFO, I guess via dbd_st_fetch&#40;&#41;.
&gt;
&gt; I suppose this makes sense, but the data doesn&#39;t come out if I only do a
&gt; prepare&#40;&#41;+execute&#40;&#41;+fetch&#40;&#41; all available rows - only then does the trace
&gt; show:
&gt;
&gt;     &lt;- fetchrow_array= &#40; &#39;0&#39; &#39;0&#39; &#39;public&#39; &#39;.......    ....Â«3.v#.v@.Ã’Â©.2kÃºU&#39;
&gt; undef &#39;Apr 08 2003 09:10AM&#39; &#39;Jul 09 2008 04:19PM&#39; &#39;1&#39; undef &#39;0&#39; undef &#39;0&#39;
&gt; &#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;0&#39; &#39;1&#39; &#39;0&#39; &#41; [20 items] row1 at /u/nortonp/tmp/
&gt; statistics_in_the_resultset.pl line 14
&gt;     -&gt; fetchrow_array for DBD::ODBC::st &#40;DBI::st=HASH&#40;0x720010&#41;~0x71ffb0&#41;
&gt; thr#411400
&gt;     SQLFetch rc 100
&gt;     !!dbd_error2&#40;err_rc=1, what=st_fetch/SQLMoreResults,
&gt; handles=&#40;7c18d0,7c1f20,7cff40&#41;
&gt;     !SQLError&#40;7c18d0,7c1f20,7cff40&#41; = &#40;01000, 3615, [unixODBC]  ...
&gt;
&gt; etc... so no errors are signaled until the results are fetched and
&gt; 100/SQL_NO_DATA/SQL_NO_DATA_FOUND is returned and SQLMoreResults at around
&gt; line 2833 in my dbdimp.c, followed by another check where
&gt; SQL_SUCCESS_WITH_INFO seems to finally be returned.
&gt;
&gt; So it seems like via both easysoft and freetds odbc drivers SQL Server is
&gt; simply returning SQL_SUCCEEDED and only if results are SQLFetch&#40;&#41;&#39;d and
&gt; SQL_NO_DATA is encountered will the error message be seen.
&gt;
&gt; Does this match what you&#39;re seeing?
&gt;
&gt; -Peter
&gt;
&gt;
&gt;
&gt;
&gt; On Mon, Jun 6, 2011 at 3:28 PM, Peter C. Norton &lt;pedrinho@gmail.com&gt;wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Yes, the &#34;use tempdb&#34; was only there to elicit a message for comparison.
&gt;&gt; It&#39;s possible that neither does &#34;$dbh-&gt;do&#40;&#39;sp_help [sys.objects]&#39;&#41;&#34; for
&gt;&gt; instance, which does elicit a message on Sybase, though I don&#39;t know if this
&gt;&gt; is defined behavior or not.
&gt;&gt;
&gt;&gt; If you don&#39;t need it, I&#39;ll skip the DBI trace, but I&#39;d be interested in
&gt;&gt; whatever you find regarding the behavior of SQL Server and whether it&#39;s
&gt;&gt; expected that this will behave so differently.
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt;
&gt;&gt; -Peter
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Jun 6, 2011 at 2:44 PM, Martin J Evans via RT &lt;
&gt;&gt; bug-DBD-ODBC@rt.cpan.org&gt; wrote:
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon Jun 06 14:25:59 2011, MJEVANS wrote:
<div class="message-stanza open">&gt;&gt;&gt; &gt; On Mon Jun 06 14:16:48 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt;&gt;&gt; &gt; &gt; Something interesting in the Sybase-&gt;SQL Server transition:
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; $dbh-&gt;do&#40;&#34;use tempdb; set statistics io on select top 1 * from
&gt;&gt;&gt; &gt; &gt; sys.objects&#34;&#41;;
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; Doesn&#39;t do what we&#39;d expect, which is to return statistics info to
</div></div>&gt;&gt;&gt; the
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; &gt; &gt; message handler.  Instead this is the  output via the freetds odbc
&gt;&gt;&gt; &gt; &gt; driver:
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; $ perl ~/tmp/causerr.pl
&gt;&gt;&gt; &gt; &gt; $VAR1 = [
&gt;&gt;&gt; &gt; &gt;           &#39;01000&#39;,
&gt;&gt;&gt; &gt; &gt;           &#39;[unixODBC][FreeTDS][SQL Server]Changed database context to
&gt;&gt;&gt; &gt; &gt; \&#39;tempdb\&#39;.&#39;,
&gt;&gt;&gt; &gt; &gt;           5701
&gt;&gt;&gt; &gt; &gt;         ];
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; However this works for Sybase, which makes me think that SQL Server
</div></div>&gt;&gt;&gt; is
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; &gt; &gt; simply not providing a message with the info that isn&#39;t being
&gt;&gt;&gt; &gt; &gt; returned.  Any
&gt;&gt;&gt; &gt; &gt; idea whether this gets signaled somehow?
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; Thanks,
&gt;&gt;&gt; &gt; &gt;
&gt;&gt;&gt; &gt; &gt; -Peter
</div>&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; I&#39;d need to see a trace of this to see what is happening. set and
</div>&gt;&gt;&gt; export
<div class="message-stanza open">&gt;&gt;&gt; &gt; DBI_TRACE=15=x.log and run the code above then attach the x.log file to
&gt;&gt;&gt; &gt; this RT and I&#39;ll take a look.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Martin
</div>&gt;&gt;&gt;
&gt;&gt;&gt; Actually, I just tried it with the MS SQL Server ODBC driver and it
&gt;&gt;&gt; exhibits the same as freeTDS.
&gt;&gt;&gt;
&gt;&gt;&gt; The &#34;set statistics io on select top 1 * from sys.objects&#34; does not
&gt;&gt;&gt; generate SQL_SUCCESS_WITH_INFO. You can test this yourself by separating
&gt;&gt;&gt; the use from the set in 2 different dos.
&gt;&gt;&gt;
&gt;&gt;&gt; I will need to play with this more to see why - it may be normal
&gt;&gt;&gt; behaviour.
&gt;&gt;&gt;
&gt;&gt;&gt; Martin
&gt;&gt;&gt; --
&gt;&gt;&gt; Martin J. Evans
&gt;&gt;&gt; Wetherby, UK
&gt;&gt;&gt;
</div>&gt;&gt;
&gt;&gt;
</div>&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/943565/490594/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490594">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-943611" href="/Public/Bug/Display.html?id=68510#txn-943611">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;09&nbsp;03:57:26&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/943611/490624/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490624">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 08 19:29:02 2011, pedrinho@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And, the last weirdness: back to your remarking on the inconsistency
&gt; of the
&gt; passing of warnings via the error handler, what can be done to
&gt; eliminate
&gt; that?  Is there a proper way to pass this to the DBI warning string,
&gt; or to
&gt; attach a property to the message so that warnings can be distinguished
&gt; from
&gt; errors?
&gt; 
&gt; -Peter
&gt; 
</div>
The only inconsistency I see is that DBI&#39;s error handler only gets 
called for errors and DBD::ODBC&#39;s gets called for warnings and errors - 
it has been like since before I took over maintainership of DBD::ODBC. 
DBI already defines a mechanism for drivers to report warnings or errors 
with <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#set_err">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#set_err</a></span>. However, 
this should not be confused with <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-">http://search.cpan.org/~timb/DBI-</a></span>
1.616/DBI.pm#Warn. You can catch warnings with 
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#PrintWarn">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#PrintWarn</a></span> and a 
$SIG{__WARN__} handler.

I&#39;m not sure exactly what you are trying to achieve. I strongly suggest 
you are better posting your situation on the dbi-users list as there are 
a lot more people with more knowledge than me on it.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-943614" href="/Public/Bug/Display.html?id=68510#txn-943614">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;09&nbsp;04:20:10&nbsp;2011</span>
    <span class="description">pedrinho [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68510] DBD::ODBC doesn&#39;t pass up warnings &#40;RAISERROR with severity &lt; 10&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 9 Jun 2011 04:19:55 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Peter C. Norton&#34; &lt;pedrinho [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/943614/490628/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490628">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Maybe I&#39;m saying this poorly, the inconsistency &#40;maybe a poor choice of
words&#41; is from the observation that without some severity info it&#39;s not
possible to determine in the error handler whether a message is an error or
a warning.  The dbi warning handler/printer doesn&#39;t seem to be involved at
this point so I&#39;m wondering how to get messages stemming from
SQL_SUCCESS_WITH_INFO there.

Thanks,

-Peter
On Jun 9, 2011 3:57 AM, &#34;Martin J Evans via RT&#34; &lt;bug-DBD-ODBC@rt.cpan.org&gt;
wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68510">https://rt.cpan.org/Ticket/Display.html?id=68510</a></span> &gt;
&gt;
&gt; On Wed Jun 08 19:29:02 2011, pedrinho@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; And, the last weirdness: back to your remarking on the inconsistency
&gt;&gt; of the
&gt;&gt; passing of warnings via the error handler, what can be done to
&gt;&gt; eliminate
&gt;&gt; that? Is there a proper way to pass this to the DBI warning string,
&gt;&gt; or to
&gt;&gt; attach a property to the message so that warnings can be distinguished
&gt;&gt; from
&gt;&gt; errors?
&gt;&gt;
&gt;&gt; -Peter
&gt;&gt;
</div>&gt;
&gt; The only inconsistency I see is that DBI&#39;s error handler only gets
&gt; called for errors and DBD::ODBC&#39;s gets called for warnings and errors -
&gt; it has been like since before I took over maintainership of DBD::ODBC.
&gt; DBI already defines a mechanism for drivers to report warnings or errors
&gt; with <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#set_err">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#set_err</a></span>. However,
&gt; this should not be confused with <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-">http://search.cpan.org/~timb/DBI-</a></span>
&gt; 1.616/DBI.pm#Warn. You can catch warnings with
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/DBI-1.616/DBI.pm#PrintWarn">http://search.cpan.org/~timb/DBI-1.616/DBI.pm#PrintWarn</a></span> and a
&gt; $SIG{__WARN__} handler.
&gt;
&gt; I&#39;m not sure exactly what you are trying to achieve. I strongly suggest
&gt; you are better posting your situation on the dbi-users list as there are
&gt; a lot more people with more knowledge than me on it.
&gt;
&gt; Martin
&gt; --
&gt; Martin J. Evans
&gt; Wetherby, UK
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/943614/490629/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490629">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-943727" href="/Public/Bug/Display.html?id=68510#txn-943727">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;09&nbsp;14:29:44&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/943727/490697/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/490697">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 656b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 09 04:20:10 2011, pedrinho@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe I&#39;m saying this poorly, the inconsistency &#40;maybe a poor choice of
&gt; words&#41; is from the observation that without some severity info it&#39;s not
&gt; possible to determine in the error handler whether a message is an
</div>error or
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a warning.  The dbi warning handler/printer doesn&#39;t seem to be involved at
&gt; this point so I&#39;m wondering how to get messages stemming from
&gt; SQL_SUCCESS_WITH_INFO there.
&gt; 
&gt; Thanks,
&gt; 
&gt; -Peter
</div>
Peter, are you are irc or can use irc so I could talk to you about this
more directly? I hang about on irc.perl.org on the #dbi channel.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-946151" href="/Public/Bug/Display.html?id=68510#txn-946151">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;13:41:47&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-946153" href="/Public/Bug/Display.html?id=68510#txn-946153">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;13:41:47&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Fixed in 1.30_7 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.232821</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
