<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30456 for Catalyst-Action-REST: Debug messages print even with CATALYST_DEBUG is false</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30456 for Catalyst-Action-REST: Debug messages print even with CATALYST_DEBUG is false</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Action-REST">Catalyst-Action-REST CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30456</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-Action-REST/Active/">Catalyst-Action-REST</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">claco [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
claco [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41594-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41595-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;22:39:59&nbsp;2007</span>
    <span class="description">claco [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Debug messages print even with CATALYST_DEBUG is false</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m not sure if this is a bug, or a feature of Catalyst logging. When
testing apps that may have -Debug loaded in test suites, you can still
disable debugging by setting CATALYST_DEBUG=0

When that is set to false, debug logging is supressed, except for the
REST modules. It looks like the proper way to do this from scouring the
Cat source is to check if &#40;$c-&gt;debug&#41; before writing to $c-&gt;log-&gt;debug
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;01&nbsp;19:46:41&nbsp;2008</span>
    <span class="description">claco [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 03 22:39:59 2007, CLACO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not sure if this is a bug, or a feature of Catalyst logging. When
&gt; testing apps that may have -Debug loaded in test suites, you can still
&gt; disable debugging by setting CATALYST_DEBUG=0
&gt; 
&gt; When that is set to false, debug logging is supressed, except for the
&gt; REST modules. It looks like the proper way to do this from scouring the
&gt; Cat source is to check if &#40;$c-&gt;debug&#41; before writing to $c-&gt;log-&gt;debug
</div>
Here&#39;s a patch that updates the log-&gt;debug to check $c-&gt;debug first,
which seems to be the norm now a days. Also fixed an issue with &#39;use
Catalyst::Action::REST&#39; dying becuase of no &#39;use Catalyst&#39;.

Also fixed an undef warning in SerializeBase that usuall crops use wehen
using Catalyst::Test.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== Changelog
==================================================================
--- Changelog	&#40;revision 1116&#41;
+++ Changelog	&#40;local&#41;
@@ -1,3 +1,7 @@
+    Added use Catalyst to REST.pm to make Makefile.PL PREREQ happy
+    All log-&gt;debug lines now check if $c-&gt;debug is enabled
+    Fixed undef warning in SerializeBase
+
 Wed Jul 04 11:17:20 EDT 2007
 	Fixed &#39;default&#39; serializer to set a valid Content-Type: header.  Fixes
 	RT ticket 27949.  Note that behavior has changed -- the default
=== lib/Catalyst/Action/Deserialize/Data/Serializer.pm
==================================================================
--- lib/Catalyst/Action/Deserialize/Data/Serializer.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/Deserialize/Data/Serializer.pm	&#40;local&#41;
@@ -24,7 +24,8 @@
         require $sp
     };
     if &#40;$@&#41; {
-        $c-&gt;log-&gt;debug&#40;&#34;Could not load $serializer, refusing to serialize: $@&#34;&#41;;
+        $c-&gt;log-&gt;debug&#40;&#34;Could not load $serializer, refusing to serialize: $@&#34;&#41;
+            if $c-&gt;debug;
         return 0;
     }
     my $body = $c-&gt;request-&gt;body;
@@ -48,7 +49,8 @@
         $c-&gt;request-&gt;data&#40;$rdata&#41;;
     } else {
         $c-&gt;log-&gt;debug&#40;
-            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;;
+            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;
+                if $c-&gt;debug;
     }
     return 1;
 }
=== lib/Catalyst/Action/Deserialize/JSON.pm
==================================================================
--- lib/Catalyst/Action/Deserialize/JSON.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/Deserialize/JSON.pm	&#40;local&#41;
@@ -33,7 +33,8 @@
         $c-&gt;request-&gt;data&#40;$rdata&#41;;
     } else {
         $c-&gt;log-&gt;debug&#40;
-            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;;
+            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;
+                if $c-&gt;debug;
     }
     return 1;
 }
=== lib/Catalyst/Action/Deserialize/XML/Simple.pm
==================================================================
--- lib/Catalyst/Action/Deserialize/XML/Simple.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/Deserialize/XML/Simple.pm	&#40;local&#41;
@@ -20,7 +20,8 @@
         require XML::Simple;
     };
     if &#40;$@&#41; {
-        $c-&gt;log-&gt;debug&#40;&#34;Could not load XML::Simple, refusing to deserialize: $@&#34;&#41;;
+        $c-&gt;log-&gt;debug&#40;&#34;Could not load XML::Simple, refusing to deserialize: $@&#34;&#41;
+            if $c-&gt;debug;
         return 0;
     }
 
@@ -41,7 +42,8 @@
         }
     } else {
         $c-&gt;log-&gt;debug&#40;
-            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;;
+            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;
+                if $c-&gt;debug;
     }
     return 1;
 }
=== lib/Catalyst/Action/Deserialize/YAML.pm
==================================================================
--- lib/Catalyst/Action/Deserialize/YAML.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/Deserialize/YAML.pm	&#40;local&#41;
@@ -29,7 +29,8 @@
         $c-&gt;request-&gt;data&#40;$rdata&#41;;
     } else {
         $c-&gt;log-&gt;debug&#40;
-            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;;
+            &#39;I would have deserialized, but there was nothing in the body!&#39;&#41;
+                if $c-&gt;debug;
     }
     return 1;
 }
=== lib/Catalyst/Action/REST.pm
==================================================================
--- lib/Catalyst/Action/REST.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/REST.pm	&#40;local&#41;
@@ -11,6 +11,7 @@
 use warnings;
 
 use base &#39;Catalyst::Action&#39;;
+use Catalyst;
 use Class::Inspector;
 use Catalyst::Request::REST;
 use 5.8.1;
=== lib/Catalyst/Action/Serialize/Data/Serializer.pm
==================================================================
--- lib/Catalyst/Action/Serialize/Data/Serializer.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/Serialize/Data/Serializer.pm	&#40;local&#41;
@@ -24,7 +24,8 @@
         require $sp
     };
     if &#40;$@&#41; {
-        $c-&gt;log-&gt;debug&#40;&#34;Could not load $serializer, refusing to serialize: $@&#34;&#41;;
+        $c-&gt;log-&gt;debug&#40;&#34;Could not load $serializer, refusing to serialize: $@&#34;&#41;
+            if $c-&gt;debug;
         return 0;
     }
     my $dso = Data::Serializer-&gt;new&#40; serializer =&gt; $serializer &#41;;
=== lib/Catalyst/Action/Serialize/XML/Simple.pm
==================================================================
--- lib/Catalyst/Action/Serialize/XML/Simple.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/Serialize/XML/Simple.pm	&#40;local&#41;
@@ -20,7 +20,8 @@
         require XML::Simple
     };
     if &#40;$@&#41; {
-        $c-&gt;log-&gt;debug&#40;&#34;Could not load XML::Serializer, refusing to serialize: $@&#34;&#41;;
+        $c-&gt;log-&gt;debug&#40;&#34;Could not load XML::Serializer, refusing to serialize: $@&#34;&#41;
+            if $c-&gt;debug;
         return 0;
     }
     my $xs = XML::Simple-&gt;new&#40;ForceArray =&gt; 0,&#41;;
=== lib/Catalyst/Action/Serialize.pm
==================================================================
--- lib/Catalyst/Action/Serialize.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/Serialize.pm	&#40;local&#41;
@@ -29,15 +29,18 @@
         $controller, $c &#41;;
     unless &#40; defined&#40;$sclass&#41; &#41; {
         if &#40; defined&#40;$content_type&#41; &#41; {
-            $c-&gt;log-&gt;debug&#40;&#34;Could not find a serializer for $content_type&#34;&#41;;
+            $c-&gt;log-&gt;debug&#40;&#34;Could not find a serializer for $content_type&#34;&#41;
+                if $c-&gt;debug;
         } else {
             $c-&gt;log-&gt;debug&#40;
-                &#34;Could not find a serializer for an empty content type&#34;&#41;;
+                &#34;Could not find a serializer for an empty content type&#34;&#41;
+                    if $c-&gt;debug;
         }
         return 1;
     }
     $c-&gt;log-&gt;debug&#40;
-        &#34;Serializing with $sclass&#34; . &#40; $sarg ? &#34; [$sarg]&#34; : &#39;&#39; &#41; &#41;;
+        &#34;Serializing with $sclass&#34; . &#40; $sarg ? &#34; [$sarg]&#34; : &#39;&#39; &#41; &#41;
+            if $c-&gt;debug;
 
     my $rc;
     if &#40; defined&#40;$sarg&#41; &#41; {
=== lib/Catalyst/Action/SerializeBase.pm
==================================================================
--- lib/Catalyst/Action/SerializeBase.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Action/SerializeBase.pm	&#40;local&#41;
@@ -36,7 +36,7 @@
         $self-&gt;_serialize_plugins&#40; \@plugins &#41;;
     }
 
-    my $content_type = $c-&gt;request-&gt;preferred_content_type;
+    my $content_type = $c-&gt;request-&gt;preferred_content_type || &#39;&#39;;
 
     # Finally, we load the class.  If you have a default serializer,
     # and we still don&#39;t have a content-type that exists in the map,
=== lib/Catalyst/Controller/REST.pm
==================================================================
--- lib/Catalyst/Controller/REST.pm	&#40;revision 1116&#41;
+++ lib/Catalyst/Controller/REST.pm	&#40;local&#41;
@@ -351,7 +351,7 @@
     my %p    = validate&#40; @_, { message =&gt; { type =&gt; SCALAR }, }, &#41;;
 
     $c-&gt;response-&gt;status&#40;400&#41;;
-    $c-&gt;log-&gt;debug&#40; &#34;Status Bad Request: &#34; . $p{&#39;message&#39;} &#41;;
+    $c-&gt;log-&gt;debug&#40; &#34;Status Bad Request: &#34; . $p{&#39;message&#39;} &#41; if $c-&gt;debug;
     $self-&gt;_set_entity&#40; $c, { error =&gt; $p{&#39;message&#39;} } &#41;;
     return 1;
 }
@@ -377,7 +377,7 @@
     my %p    = validate&#40; @_, { message =&gt; { type =&gt; SCALAR }, }, &#41;;
 
     $c-&gt;response-&gt;status&#40;404&#41;;
-    $c-&gt;log-&gt;debug&#40; &#34;Status Not Found: &#34; . $p{&#39;message&#39;} &#41;;
+    $c-&gt;log-&gt;debug&#40; &#34;Status Not Found: &#34; . $p{&#39;message&#39;} &#41; if $c-&gt;debug;
     $self-&gt;_set_entity&#40; $c, { error =&gt; $p{&#39;message&#39;} } &#41;;
     return 1;
 }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;01&nbsp;19:46:45&nbsp;2008</span>
    <span class="description">claco [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;04&nbsp;09:48:17&nbsp;2008</span>
    <span class="description">claco [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.60
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;04&nbsp;09:48:22&nbsp;2008</span>
    <span class="description">claco [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;04&nbsp;09:48:24&nbsp;2008</span>
    <span class="description">claco [...] cpan.org -  Given to CLACO</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
