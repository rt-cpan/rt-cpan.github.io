<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #83490 for Glib: options.t fails for non-utf8 locale</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #83490 for Glib: options.t fails for non-utf8 locale</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Glib">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Glib">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Glib">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Glib">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Glib">Glib CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">83490</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Glib">Glib</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">XAOC [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.290    </td>
  </tr>
  <tr id="CF-14787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.301    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




rt83490-skip_options_non_UTF-8_locale.24Jun2013.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1228353/649025/rt83490-skip_options_non_UTF-8_locale.24Jun2013.diff">
Tue Jun 25 14:33:09 2013 (1k) by XAOC [...] cpan.org
</a>
</font></li>
</ul>


rt83490-skip_options_parse_7bit_locale.23Jun2013.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1227740/648666/rt83490-skip_options_parse_7bit_locale.23Jun2013.diff">
Mon Jun 24 02:48:20 2013 (1k) by XAOC [...] cpan.org
</a>
</font></li>
</ul>


rt83490-skip_options_parse_7bit_locale.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1203397/635361/rt83490-skip_options_parse_7bit_locale.diff">
Thu Apr 18 20:07:49 2013 (424b) by XAOC [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=83490">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1183578" href="/Public/Bug/Display.html?id=83490#txn-1183578">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;20&nbsp;17:15:47&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> options.t fails for non-utf8 locale</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1183578/624441/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/624441">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 153b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">See subject. A sample test report using the &#34;C&#34; locale:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/8ac52868-6f76-11e2-9b43-fad0e278d1a1">http://www.cpantesters.org/cpan/report/8ac52868-6f76-11e2-9b43-fad0e278d1a1</a></span>

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187607" href="/Public/Bug/Display.html?id=83490#txn-1187607">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;15:26:44&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1187607/626447/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/626447">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 234b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-02-20 17:15:47, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; See subject. A sample test report using the &#34;C&#34; locale:
&gt;
</div><span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/8ac52868-6f76-11e2-9b43-fad0e278d1a1">http://www.cpantesters.org/cpan/report/8ac52868-6f76-11e2-9b43-fad0e278d1a1</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
</div>
Same problem with 1.291, it seems.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187609" href="/Public/Bug/Display.html?id=83490#txn-1187609">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;15:26:46&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1203396" href="/Public/Bug/Display.html?id=83490#txn-1203396">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;18&nbsp;20:07:01&nbsp;2013</span>
    <span class="description">XAOC [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1203397" href="/Public/Bug/Display.html?id=83490#txn-1203397">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;18&nbsp;20:07:49&nbsp;2013</span>
    <span class="description">XAOC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1203397/635360/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/635360">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 70b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Submitted the attached patch to the GTK-Perl mailing list for comment.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt83490-skip_options_parse_7bit_locale.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1203397/635361/rt83490-skip_options_parse_7bit_locale.diff">Download rt83490-skip_options_parse_7bit_locale.diff</a><br />
<span class="downloadcontenttype">text/x-diff 424b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/t/options.t b/t/options.t
index dc807e0..6ed0458 100644
--- a/t/options.t
+++ b/t/options.t
@@ -156,7 +156,9 @@ my $entries = [
   }
 
   # Test that there is no double-encoding for utf8-encoded strings.
-  {
+SKIP:  {
+    skip&#40;&#34;Can&#39;t test parsing of wide-byte args with 7-bit locale&#34;, 4&#41;
+        if &#40; $ENV{&#34;LANG&#34;} eq &#34;C&#34; || $ENV{&#34;LANG&#34;} eq &#34;POSIX&#34; &#41;;
     @ARGV = qw&#40;-s â¤ â¤&#41;;
     $context -&gt; parse&#40;&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1203464" href="/Public/Bug/Display.html?id=83490#txn-1203464">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;19&nbsp;02:11:50&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1203464/635403/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/635403">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-04-18 20:07:49, XAOC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Submitted the attached patch to the GTK-Perl mailing list for comment.
</div>
Maybe it&#39;s better to use I18N::Langinfo &#40;in perl core since 5.8.0&#41; for checking? After all, it&#39;s probably not only LANG which should be checked, but also LC_ALL. And there are also other values to force a 7bit locale, e.g. by using en_GB.US-ASCII. See below for some examples.

BTW, are there other 7bit locales besides US-ASCII?

$ env LANG=de_DE.ISO8859-1 LC_ALL= perl -MI18N::Langinfo=langinfo,CODESET -e &#39;warn langinfo&#40;CODESET&#41;&#39;
ISO8859-1 at -e line 1.
$ env LANG=de_DE.ISO8859-1 LC_ALL=hr_HR.ISO8859-2 perl -MI18N::Langinfo=langinfo,CODESET -e &#39;warn langinfo&#40;CODESET&#41;&#39;
ISO8859-2 at -e line 1.
$ env LANG=de_DE.ISO8859-1 LC_ALL=C perl -MI18N::Langinfo=langinfo,CODESET -e &#39;warn langinfo&#40;CODESET&#41;&#39;
US-ASCII at -e line 1.
$ env LANG=de_DE.ISO8859-1 LC_ALL=POSIX perl -MI18N::Langinfo=langinfo,CODESET -e &#39;warn langinfo&#40;CODESET&#41;&#39;
US-ASCII at -e line 1.
$ env LANG= LC_ALL= perl -MI18N::Langinfo=langinfo,CODESET -e &#39;warn langinfo&#40;CODESET&#41;&#39; 
US-ASCII at -e line 1.
$ env LANG= LC_ALL=de_DE.UTF-8 perl -MI18N::Langinfo=langinfo,CODESET -e &#39;warn langinfo&#40;CODESET&#41;&#39;
UTF-8 at -e line 1.
$ env LANG= LC_ALL=en_GB.US-ASCII perl -MI18N::Langinfo=langinfo,CODESET -e &#39;warn langinfo&#40;CODESET&#41;&#39;
US-ASCII at -e line 1.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1227298" href="/Public/Bug/Display.html?id=83490#txn-1227298">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;23&nbsp;04:22:04&nbsp;2013</span>
    <span class="description">intrigeri [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #83490] blocking upload to Debian</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Jun 2013 10:21:40 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Glib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> intrigeri &lt;intrigeri [...] debian.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1227298/648438/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/648438">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 139b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

any news on that front?

For what it&#39;s worth, this bug is blocking me from uploading the latest
and greatest Glib to Debian.

Cheers!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1227740" href="/Public/Bug/Display.html?id=83490#txn-1227740">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;24&nbsp;02:48:20&nbsp;2013</span>
    <span class="description">XAOC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1227740/648665/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/648665">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 701b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jun 23 04:22:04 2013, intrigeri@debian.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; any news on that front?
&gt; 
&gt; For what it&#39;s worth, this bug is blocking me from uploading the latest
&gt; and greatest Glib to Debian.
&gt; 
&gt; Cheers!
</div>
Can you try the attached patch?

All of the ISO-8859 code pages are 8-bit, one byte codepages, so I also check for them as well, since the test that&#39;s failing is for multi-byte Unicode characters.

I tested with the following LC_ALL/LANG combinations, as per Slaven&#39;s previous reply;

LANG=de_DE.ISO8859-1 LC_ALL=
LANG=de_DE.ISO8859-1 LC_ALL=hr_HR.ISO8859-2
LANG=de_DE.ISO8859-1 LC_ALL=C
LANG=de_DE.ISO8859-1 LC_ALL=POSIX
LANG= LC_ALL=
LANG= LC_ALL=de_DE.UTF-8
LANG= LC_ALL=en_GB.US-ASCII
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt83490-skip_options_parse_7bit_locale.23Jun2013.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1227740/648666/rt83490-skip_options_parse_7bit_locale.23Jun2013.diff">Download rt83490-skip_options_parse_7bit_locale.23Jun2013.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/t/options.t b/t/options.t
index dc807e0..67fa741 100644
--- a/t/options.t
+++ b/t/options.t
@@ -156,7 +156,21 @@ my $entries = [
   }
 
   # Test that there is no double-encoding for utf8-encoded strings.
-  {
+SKIP:  {
+    my $codeset;
+    # This eval&#40;&#41; was taken from &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/I18N::Langinfo">https://metacpan.org/module/I18N::Langinfo</a></span>&gt;.
+    eval {
+        require I18N::Langinfo;
+        I18N::Langinfo-&gt;import&#40;qw&#40;langinfo CODESET&#41;&#41;;
+        $codeset = langinfo&#40;CODESET&#40;&#41;&#41;; # note the &#40;&#41;
+    };
+    # If there was an error importing I18N::Langinfo, then the &#39;$codeset&#39; test
+    # below will be unreliable; in that case, skip this block of tests.
+    skip&#40;&#34;Can&#39;t test parsing of wide-byte args; I18N::Langinfo unavailable&#34;, 4&#41;
+        if &#40; length&#40;$@&#41; &gt; 0 &#41;;
+    # If LC_ALL/LANG is currently set to a 7-bit locale, also skip these tests.
+    skip&#40;&#34;Can&#39;t test parsing of wide-byte args with 7-bit locale&#34;, 4&#41;
+        if &#40; $codeset eq &#39;US-ASCII&#39; || $codeset =~ /ISO8859/ &#41;;
     @ARGV = qw&#40;-s â¤ â¤&#41;;
     $context -&gt; parse&#40;&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1228353" href="/Public/Bug/Display.html?id=83490#txn-1228353">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;25&nbsp;14:33:09&nbsp;2013</span>
    <span class="description">XAOC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1228353/649024/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/649024">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 998b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I thought about this a bit, and decided the better way to do this is to test for a UTF-8 encoding, instead of trying to cover all of the various non-wide-character encodings, which would be considerable.

Please try the attached patch and let me know if it works.

Thanks,

Brian

You can see skipping with all of the LANG/LC_ALL settings using:

LANG=de_DE.ISO8859-1 LC_ALL= \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
LANG=de_DE.ISO8859-1 LC_ALL=hr_HR.ISO8859-2 \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
LANG=de_DE.ISO8859-1 LC_ALL=C \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
LANG=de_DE.ISO8859-1 LC_ALL=POSIX \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
LANG= LC_ALL= \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
LANG= LC_ALL=de_DE.UTF-8 \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
LANG= LC_ALL=en_GB.US-ASCII \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
LANG= LC_ALL=ISO_10646 \
    prove -v -I blib/lib/ -Iblib/arch/ t/options.t
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt83490-skip_options_non_UTF-8_locale.24Jun2013.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1228353/649025/rt83490-skip_options_non_UTF-8_locale.24Jun2013.diff">Download rt83490-skip_options_non_UTF-8_locale.24Jun2013.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/t/options.t b/t/options.t
index dc807e0..d6fed84 100644
--- a/t/options.t
+++ b/t/options.t
@@ -156,7 +156,22 @@ my $entries = [
   }
 
   # Test that there is no double-encoding for utf8-encoded strings.
-  {
+SKIP:  {
+    my $codeset;
+    # This eval&#40;&#41; was taken from &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/I18N::Langinfo">https://metacpan.org/module/I18N::Langinfo</a></span>&gt;.
+    eval {
+        require I18N::Langinfo;
+        I18N::Langinfo-&gt;import&#40;qw&#40;langinfo CODESET&#41;&#41;;
+        $codeset = langinfo&#40;CODESET&#40;&#41;&#41;; # note the &#40;&#41;
+    };
+    # If there was an error importing I18N::Langinfo, then the &#39;$codeset&#39; test
+    # below will be unreliable; in that case, skip this block of tests.
+    skip&#40;&#34;Can&#39;t check langinfo &#40;LC_ALL/LANG&#41;; I18N::Langinfo unavailable&#34;, 4&#41;
+        if &#40; length&#40;$@&#41; &gt; 0 &#41;;
+    # If LC_ALL/LANG is not some variant of UTF-8 &#40;8-bit, wide characters&#41;,
+    # skip these tests.
+    skip&#40;&#34;Can&#39;t test parsing of wide-byte args &#40;non-UTF-8 locale: $codeset&#41;&#34;, 4&#41;
+        if &#40; $codeset !~ /UTF-8|utf8/i &#41;;
     @ARGV = qw&#40;-s â¤ â¤&#41;;
     $context -&gt; parse&#40;&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1230211" href="/Public/Bug/Display.html?id=83490#txn-1230211">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;30&nbsp;07:01:24&nbsp;2013</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83490] options.t fails for non-utf8 locale</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 30 Jun 2013 13:01:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Glib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Torsten Schoenfeld &lt;kaffeetisch [...] gmx.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1230211/649999/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/649999">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 364b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 25.06.2013 20:33, Brian Manning via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I thought about this a bit, and decided the better way to do this is
&gt; to test for a UTF-8 encoding, instead of trying to cover all of the
&gt; various non-wide-character encodings, which would be considerable.
</div>
Yes, this appears to be the most robust solution.  Patch looks good to me.

Thanks for working on this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233044" href="/Public/Bug/Display.html?id=83490#txn-1233044">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;07&nbsp;02:35:38&nbsp;2013</span>
    <span class="description">XAOC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1233044/651629/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/651629">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 446b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Pushed updated fix with Kevin Ryde&#39;s suggestions in git commit ID 215711b4, and made a stable release of Glib, version 1.301, with all of the appropriate release announcements.  Look for the Glib release tarball to replicate across all of the CPAN mirrors within the next 24 hours, or pick up the Sourceforge copy if you need it right away.

Resolving ticket.  Thanks for the original report, and sorry for the delay in getting the fix out there.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233047" href="/Public/Bug/Display.html?id=83490#txn-1233047">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;07&nbsp;02:35:40&nbsp;2013</span>
    <span class="description">XAOC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233113" href="/Public/Bug/Display.html?id=83490#txn-1233113">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;07&nbsp;10:54:45&nbsp;2013</span>
    <span class="description">XAOC [...] cpan.org -  Fixed in 1.301 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.67749</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
