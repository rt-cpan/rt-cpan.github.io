<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #61507 for XML-LibXML: Memory leak after enabling full recovery and suppressing everything</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #61507 for XML-LibXML: Memory leak after enabling full recovery and suppressing everything</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-LibXML">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-LibXML">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-LibXML">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-LibXML">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML">XML-LibXML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">61507</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-LibXML">XML-LibXML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
chip [...] pobox.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37350-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.70    </td>
  </tr>
  <tr id="CF-37351-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




XML-LibXML-1.7001.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/836653/433412/XML-LibXML-1.7001.diff">
Mon Sep 27 02:39:48 2010 (18.4k) by chip [...] pobox.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=61507">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-833989" href="/Public/Bug/Display.html?id=61507#txn-833989">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;20&nbsp;22:15:19&nbsp;2010</span>
    <span class="description">chip [...] pobox.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Memory leak after enabling full recovery and suppressing everything</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/833989/432000/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/432000">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 617b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">In production code at Topsy &#40;my day job&#41;, I changed many usages of XML::LibXML that looked roughly like:

    my $xml = XML::LibXML-&gt;new&#40;&#41;;
    $parser-&gt;recover&#40;1&#41;;
    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content&#41;;

to:

    my $xml = XML::LibXML-&gt;new&#40;&#41;;
    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content, { recover =&gt; 2, suppress_errors =&gt; 1, suppress_warnings =&gt; 
1 }&#41;;

After this change, the programs in question started leaking memory like a sieve.  After we reverted the change, 
the leak stopped.  This symptom occured with both versions 1.69 and 1.70.

What more detail or diagnostics would you like?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-834052" href="/Public/Bug/Display.html?id=61507#txn-834052">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;21&nbsp;01:50:45&nbsp;2010</span>
    <span class="description">christian.glahn [...] lo-f.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61507] Memory leak after enabling full recovery and suppressing everything </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Sep 2010 07:51:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-XML-LibXML [...] rt.cpan.org&#34; &lt;bug-XML-LibXML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Glahn &lt;christian.glahn [...] lo-f.at&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/834052/432028/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/432028">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Chip,

Thanks for reporting. 

A minimal test case would speed up the process and secure that  related bugs are not reintroduced with a later version. 

There is a special test suite for memory problems in the distribution. Please use this as a reference for providing details and diagnostics through a test case.

Cheers
Christian

On 21 Sep 2010, at 04:15, &#34;Chip Salzenberg via RT&#34; &lt;bug-XML-LibXML@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Sep 20 22:15:19 2010: Request 61507 was acted upon.
&gt; Transaction: Ticket created by CHIPS
&gt;       Queue: XML-LibXML
&gt;     Subject: Memory leak after enabling full recovery and suppressing everything
&gt;   Broken in: 1.70
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: chip@pobox.com
&gt;      Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; 
&gt; 
&gt; In production code at Topsy &#40;my day job&#41;, I changed many usages of XML::LibXML that looked roughly like:
&gt; 
&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt;    $parser-&gt;recover&#40;1&#41;;
&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content&#41;;
&gt; 
&gt; to:
&gt; 
&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content, { recover =&gt; 2, suppress_errors =&gt; 1, suppress_warnings =&gt; 
&gt; 1 }&#41;;
&gt; 
&gt; After this change, the programs in question started leaking memory like a sieve.  After we reverted the change, 
&gt; the leak stopped.  This symptom occured with both versions 1.69 and 1.70.
&gt; 
&gt; What more detail or diagnostics would you like?
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-834055" href="/Public/Bug/Display.html?id=61507#txn-834055">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;21&nbsp;01:50:47&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-835530" href="/Public/Bug/Display.html?id=61507#txn-835530">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;23&nbsp;21:14:05&nbsp;2010</span>
    <span class="description">chip [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61507] Memory leak after enabling full recovery and suppressing everything</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Sep 2010 18:13:47 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chip Salzenberg &lt;chip [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/835530/432820/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/432820">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> I&#39;ve found the leak.  Do you use git or svn?  That would simplify my
patch generation process.

On 9/20/2010 10:50 PM, Christian Glahn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;
&gt; Hi Chip,
&gt;
&gt; Thanks for reporting. 
&gt;
&gt; A minimal test case would speed up the process and secure that  related bugs are not reintroduced with a later version. 
&gt;
&gt; There is a special test suite for memory problems in the distribution. Please use this as a reference for providing details and diagnostics through a test case.
&gt;
&gt; Cheers
&gt; Christian
&gt;
&gt; On 21 Sep 2010, at 04:15, &#34;Chip Salzenberg via RT&#34; &lt;bug-XML-LibXML@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Mon Sep 20 22:15:19 2010: Request 61507 was acted upon.
&gt;&gt; Transaction: Ticket created by CHIPS
&gt;&gt;       Queue: XML-LibXML
&gt;&gt;     Subject: Memory leak after enabling full recovery and suppressing everything
&gt;&gt;   Broken in: 1.70
&gt;&gt;    Severity: &#40;no value&#41;
&gt;&gt;       Owner: Nobody
&gt;&gt;  Requestors: chip@pobox.com
&gt;&gt;      Status: new
&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; In production code at Topsy &#40;my day job&#41;, I changed many usages of XML::LibXML that looked roughly like:
&gt;&gt;
&gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt;&gt;    $parser-&gt;recover&#40;1&#41;;
&gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content&#41;;
&gt;&gt;
&gt;&gt; to:
&gt;&gt;
&gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content, { recover =&gt; 2, suppress_errors =&gt; 1, suppress_warnings =&gt; 
&gt;&gt; 1 }&#41;;
&gt;&gt;
&gt;&gt; After this change, the programs in question started leaking memory like a sieve.  After we reverted the change, 
&gt;&gt; the leak stopped.  This symptom occured with both versions 1.69 and 1.70.
&gt;&gt;
&gt;&gt; What more detail or diagnostics would you like?
&gt;&gt;
</div>&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-836427" href="/Public/Bug/Display.html?id=61507#txn-836427">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;26&nbsp;15:31:51&nbsp;2010</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/836427/433286/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/433286">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

you can use

   svn co svn://axkit.org/XML-LibXML/trunk

&#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/PAJAS/XML-LibXML-1.70/README&#41;">http://cpansearch.perl.org/src/PAJAS/XML-LibXML-1.70/README&#41;</a></span>, but it is readonly. 
Please attach a patch to this thread.

- Petr

On Thu Sep 23 21:14:05 2010, CHIPS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  I&#39;ve found the leak.  Do you use git or svn?  That would simplify my
&gt; patch generation process.
&gt; 
&gt; On 9/20/2010 10:50 PM, Christian Glahn via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;
&gt; &gt; Hi Chip,
&gt; &gt;
&gt; &gt; Thanks for reporting.
&gt; &gt;
&gt; &gt; A minimal test case would speed up the process and secure that
</div>&gt; related bugs are not reintroduced with a later version.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; There is a special test suite for memory problems in the
</div>&gt; distribution. Please use this as a reference for providing details and
&gt; diagnostics through a test case.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Cheers
&gt; &gt; Christian
&gt; &gt;
&gt; &gt; On 21 Sep 2010, at 04:15, &#34;Chip Salzenberg via RT&#34; &lt;bug-XML-
</div>&gt; LibXML@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
<div class="message-stanza open">&gt; &gt;&gt; Mon Sep 20 22:15:19 2010: Request 61507 was acted upon.
&gt; &gt;&gt; Transaction: Ticket created by CHIPS
&gt; &gt;&gt;       Queue: XML-LibXML
&gt; &gt;&gt;     Subject: Memory leak after enabling full recovery and
</div></div>&gt; suppressing everything
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;   Broken in: 1.70
&gt; &gt;&gt;    Severity: &#40;no value&#41;
&gt; &gt;&gt;       Owner: Nobody
&gt; &gt;&gt;  Requestors: chip@pobox.com
&gt; &gt;&gt;      Status: new
&gt; &gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; In production code at Topsy &#40;my day job&#41;, I changed many usages of
</div></div>&gt; XML::LibXML that looked roughly like:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;
&gt; &gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt; &gt;&gt;    $parser-&gt;recover&#40;1&#41;;
&gt; &gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content&#41;;
&gt; &gt;&gt;
&gt; &gt;&gt; to:
&gt; &gt;&gt;
&gt; &gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt; &gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content, { recover =&gt;
</div></div>&gt; 2, suppress_errors =&gt; 1, suppress_warnings =&gt;
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; 1 }&#41;;
&gt; &gt;&gt;
&gt; &gt;&gt; After this change, the programs in question started leaking memory
</div></div>&gt; like a sieve.  After we reverted the change,
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; the leak stopped.  This symptom occured with both versions 1.69 and
</div></div>&gt; 1.70.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;
&gt; &gt;&gt; What more detail or diagnostics would you like?
&gt; &gt;&gt;
</div>&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-836653" href="/Public/Bug/Display.html?id=61507#txn-836653">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;27&nbsp;02:39:47&nbsp;2010</span>
    <span class="description">chip [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61507] Memory leak after enabling full recovery and suppressing everything</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 26 Sep 2010 23:39:19 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chip Salzenberg &lt;chip [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/836653/433411/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/433411">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> OK, here&#39;s the patch.  The basic bug is that REPORT_ERROR and company
can end up dying, which leaves various reference-counted RETVALs
uncollected.  This patch fixes the RETVALs that are SVs, but there are
some other libxml data structure return values that this patch does not fix.

PS: I wasn&#39;t consistent in my tab usage.  Mea culpa


On 9/26/2010 12:31 PM, Petr Pajas via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;
&gt; Hi,
&gt;
&gt; you can use
&gt;
&gt;    svn co svn://axkit.org/XML-LibXML/trunk
&gt;
&gt; &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/PAJAS/XML-LibXML-1.70/README&#41;">http://cpansearch.perl.org/src/PAJAS/XML-LibXML-1.70/README&#41;</a></span>, but it is readonly. 
&gt; Please attach a patch to this thread.
&gt;
&gt; - Petr
&gt;
&gt; On Thu Sep 23 21:14:05 2010, CHIPS wrote:
<div class="message-stanza open">&gt;&gt;  I&#39;ve found the leak.  Do you use git or svn?  That would simplify my
&gt;&gt; patch generation process.
&gt;&gt;
&gt;&gt; On 9/20/2010 10:50 PM, Christian Glahn via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Chip,
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for reporting.
&gt;&gt;&gt;
&gt;&gt;&gt; A minimal test case would speed up the process and secure that
</div>&gt;&gt; related bugs are not reintroduced with a later version.
<div class="message-stanza open">&gt;&gt;&gt; There is a special test suite for memory problems in the
</div>&gt;&gt; distribution. Please use this as a reference for providing details and
&gt;&gt; diagnostics through a test case.
<div class="message-stanza open">&gt;&gt;&gt; Cheers
&gt;&gt;&gt; Christian
&gt;&gt;&gt;
&gt;&gt;&gt; On 21 Sep 2010, at 04:15, &#34;Chip Salzenberg via RT&#34; &lt;bug-XML-
</div>&gt;&gt; LibXML@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt; Mon Sep 20 22:15:19 2010: Request 61507 was acted upon.
&gt;&gt;&gt;&gt; Transaction: Ticket created by CHIPS
&gt;&gt;&gt;&gt;       Queue: XML-LibXML
&gt;&gt;&gt;&gt;     Subject: Memory leak after enabling full recovery and
</div>&gt;&gt; suppressing everything
<div class="message-stanza open">&gt;&gt;&gt;&gt;   Broken in: 1.70
&gt;&gt;&gt;&gt;    Severity: &#40;no value&#41;
&gt;&gt;&gt;&gt;       Owner: Nobody
&gt;&gt;&gt;&gt;  Requestors: chip@pobox.com
&gt;&gt;&gt;&gt;      Status: new
&gt;&gt;&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; In production code at Topsy &#40;my day job&#41;, I changed many usages of
</div>&gt;&gt; XML::LibXML that looked roughly like:
<div class="message-stanza open">&gt;&gt;&gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt;&gt;&gt;&gt;    $parser-&gt;recover&#40;1&#41;;
&gt;&gt;&gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content&#41;;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; to:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt;&gt;&gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content, { recover =&gt;
</div>&gt;&gt; 2, suppress_errors =&gt; 1, suppress_warnings =&gt;
<div class="message-stanza open">&gt;&gt;&gt;&gt; 1 }&#41;;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; After this change, the programs in question started leaking memory
</div>&gt;&gt; like a sieve.  After we reverted the change,
<div class="message-stanza open">&gt;&gt;&gt;&gt; the leak stopped.  This symptom occured with both versions 1.69 and
</div>&gt;&gt; 1.70.
<div class="message-stanza open">&gt;&gt;&gt;&gt; What more detail or diagnostics would you like?
&gt;&gt;&gt;&gt;
</div></div>&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/836653/433412/XML-LibXML-1.7001.diff">Download XML-LibXML-1.7001.diff</a><br />
<span class="downloadcontenttype">text/x-diff 18.4k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-952606" href="/Public/Bug/Display.html?id=61507#txn-952606">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;05&nbsp;09:38:29&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/952606/495461/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/495461">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 27 02:39:47 2010, CHIPS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  OK, here&#39;s the patch.  The basic bug is that REPORT_ERROR and company
&gt; can end up dying, which leaves various reference-counted RETVALs
&gt; uncollected.  This patch fixes the RETVALs that are SVs, but there are
&gt; some other libxml data structure return values that this patch does
&gt; not fix.
&gt; 
&gt; PS: I wasn&#39;t consistent in my tab usage.  Mea culpa
&gt;
</div>
Hi Chip!

Thanks for your patch, but can we also have a test added to it to
t/11memory.t ? See the Mercurial repository at:

<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-libxml/overview">https://bitbucket.org/shlomif/perl-xml-libxml/overview</a></span>

Also, please don&#39;t increment the version in all the .pm files - make the
patch single-purposed.

See the HACKING.txt file there for some information regarding coding
style/etc.

Looking forward to your next patch.

Regards,

-- Shlomi Fish.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On 9/26/2010 12:31 PM, Petr Pajas via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; you can use
&gt; &gt;
&gt; &gt;    svn co svn://axkit.org/XML-LibXML/trunk
&gt; &gt;
&gt; &gt; &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/PAJAS/XML-LibXML-1.70/README&#41;">http://cpansearch.perl.org/src/PAJAS/XML-LibXML-1.70/README&#41;</a></span>,
</div>&gt; but it is readonly.
<div class="message-stanza open">&gt; &gt; Please attach a patch to this thread.
&gt; &gt;
&gt; &gt; - Petr
&gt; &gt;
&gt; &gt; On Thu Sep 23 21:14:05 2010, CHIPS wrote:
<div class="message-stanza open">&gt; &gt;&gt;  I&#39;ve found the leak.  Do you use git or svn?  That would simplify
</div></div>&gt; my
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; patch generation process.
&gt; &gt;&gt;
&gt; &gt;&gt; On 9/20/2010 10:50 PM, Christian Glahn via RT wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Hi Chip,
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Thanks for reporting.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; A minimal test case would speed up the process and secure that
</div>&gt; &gt;&gt; related bugs are not reintroduced with a later version.
<div class="message-stanza open">&gt; &gt;&gt;&gt; There is a special test suite for memory problems in the
</div>&gt; &gt;&gt; distribution. Please use this as a reference for providing details
</div></div>&gt; and
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; diagnostics through a test case.
<div class="message-stanza open">&gt; &gt;&gt;&gt; Cheers
&gt; &gt;&gt;&gt; Christian
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; On 21 Sep 2010, at 04:15, &#34;Chip Salzenberg via RT&#34; &lt;bug-XML-
</div>&gt; &gt;&gt; LibXML@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; Mon Sep 20 22:15:19 2010: Request 61507 was acted upon.
&gt; &gt;&gt;&gt;&gt; Transaction: Ticket created by CHIPS
&gt; &gt;&gt;&gt;&gt;       Queue: XML-LibXML
&gt; &gt;&gt;&gt;&gt;     Subject: Memory leak after enabling full recovery and
</div>&gt; &gt;&gt; suppressing everything
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;   Broken in: 1.70
&gt; &gt;&gt;&gt;&gt;    Severity: &#40;no value&#41;
&gt; &gt;&gt;&gt;&gt;       Owner: Nobody
&gt; &gt;&gt;&gt;&gt;  Requestors: chip@pobox.com
&gt; &gt;&gt;&gt;&gt;      Status: new
&gt; &gt;&gt;&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; In production code at Topsy &#40;my day job&#41;, I changed many usages
</div></div></div>&gt; of
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; XML::LibXML that looked roughly like:
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt; &gt;&gt;&gt;&gt;    $parser-&gt;recover&#40;1&#41;;
&gt; &gt;&gt;&gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content&#41;;
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; to:
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;    my $xml = XML::LibXML-&gt;new&#40;&#41;;
&gt; &gt;&gt;&gt;&gt;    my $dom = $xml-&gt;parse_html_string&#40;$self-&gt;content, { recover =&gt;
</div>&gt; &gt;&gt; 2, suppress_errors =&gt; 1, suppress_warnings =&gt;
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; 1 }&#41;;
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; After this change, the programs in question started leaking
</div></div></div>&gt; memory
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; like a sieve.  After we reverted the change,
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; the leak stopped.  This symptom occured with both versions 1.69
</div></div></div>&gt; and
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; 1.70.
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; What more detail or diagnostics would you like?
&gt; &gt;&gt;&gt;&gt;
</div></div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-952765" href="/Public/Bug/Display.html?id=61507#txn-952765">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;05&nbsp;17:29:02&nbsp;2011</span>
    <span class="description">chip [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61507] Memory leak after enabling full recovery and suppressing everything</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 05 Jul 2011 14:28:40 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chip Salzenberg &lt;chip [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/952765/495548/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/495548">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 927b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/5/2011 6:38 AM, Shlomi Fish via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;
&gt; On Mon Sep 27 02:39:47 2010, CHIPS wrote:
<div class="message-stanza open">&gt;&gt;  OK, here&#39;s the patch.  The basic bug is that REPORT_ERROR and company
&gt;&gt; can end up dying, which leaves various reference-counted RETVALs
&gt;&gt; uncollected.  This patch fixes the RETVALs that are SVs, but there are
&gt;&gt; some other libxml data structure return values that this patch does
&gt;&gt; not fix.
&gt;&gt;
&gt;&gt; PS: I wasn&#39;t consistent in my tab usage.  Mea culpa
</div>&gt; Hi Chip!
&gt;
&gt; Thanks for your patch, but can we also have a test added to it [...]
</div>
No, I&#39;m sorry, I won&#39;t be contributing further.  I&#39;m stuck using
XML::LibXML 1.69 because all subsequent versions have been unusable, and
I expect eventually I&#39;ll be forced to stop using XML::LibXML entirely
due to bit rot.  If you&#39;d be willing to revert back to 1.69 and start
applying patches more carefully, I might consider it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-953708" href="/Public/Bug/Display.html?id=61507#txn-953708">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;07:45:25&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/953708/496060/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/496060">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Chip,

I apologise for the late response.

On Tue Jul 05 17:29:02 2011, CHIPS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 7/5/2011 6:38 AM, Shlomi Fish via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;
&gt; &gt; On Mon Sep 27 02:39:47 2010, CHIPS wrote:
<div class="message-stanza open">&gt; &gt;&gt;  OK, here&#39;s the patch.  The basic bug is that REPORT_ERROR and company
&gt; &gt;&gt; can end up dying, which leaves various reference-counted RETVALs
&gt; &gt;&gt; uncollected.  This patch fixes the RETVALs that are SVs, but there are
&gt; &gt;&gt; some other libxml data structure return values that this patch does
&gt; &gt;&gt; not fix.
&gt; &gt;&gt;
&gt; &gt;&gt; PS: I wasn&#39;t consistent in my tab usage.  Mea culpa
</div>&gt; &gt; Hi Chip!
&gt; &gt;
&gt; &gt; Thanks for your patch, but can we also have a test added to it [...]
</div>&gt; 
&gt; No, I&#39;m sorry, I won&#39;t be contributing further. I&#39;m stuck using
&gt; XML::LibXML 1.69 because all subsequent versions have been unusable, &gt; and
&gt; I expect eventually I&#39;ll be forced to stop using XML::LibXML entirely
&gt; due to bit rot.  
</div>
Can you provide tests in which versions higher than 1.69 fail, and are
being unusable in this respect? 1.70 was released while Petr Pajas was
still the maintainer, and that&#39;s roughly what we started with. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you&#39;d be willing to revert back to 1.69 and start
&gt; applying patches more carefully, I might consider it.
</div>
Well, a lot of work was done since 1.69 in bug fixing, automated tests,
cleanups, documentation, and to a lesser extent - feature additions. We
cannot afford to throw it all away now. If you can take the BitBucket
version as a starting point and proceed from there, that would be the
best solution.

Regards,

-- Shlomi Fish  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-953839" href="/Public/Bug/Display.html?id=61507#txn-953839">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;11:25:12&nbsp;2011</span>
    <span class="description">chip [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61507] Memory leak after enabling full recovery and suppressing everything</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 08 Jul 2011 08:24:48 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chip Salzenberg &lt;chip [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/953839/496140/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/496140">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/8/2011 4:45 AM, Shlomi Fish via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;
&gt; Hi Chip,
&gt;
&gt; I apologise for the late response.
&gt;
&gt; On Tue Jul 05 17:29:02 2011, CHIPS wrote:
<div class="message-stanza open">&gt;&gt; On 7/5/2011 6:38 AM, Shlomi Fish via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon Sep 27 02:39:47 2010, CHIPS wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;  OK, here&#39;s the patch.  The basic bug is that REPORT_ERROR and company
&gt;&gt;&gt;&gt; can end up dying, which leaves various reference-counted RETVALs
&gt;&gt;&gt;&gt; uncollected.  This patch fixes the RETVALs that are SVs, but there are
&gt;&gt;&gt;&gt; some other libxml data structure return values that this patch does
&gt;&gt;&gt;&gt; not fix.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; PS: I wasn&#39;t consistent in my tab usage.  Mea culpa
</div>&gt;&gt;&gt; Hi Chip!
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for your patch, but can we also have a test added to it [...]
</div>&gt;&gt; No, I&#39;m sorry, I won&#39;t be contributing further. I&#39;m stuck using
&gt;&gt; XML::LibXML 1.69 because all subsequent versions have been unusable, &gt; and
&gt;&gt; I expect eventually I&#39;ll be forced to stop using XML::LibXML entirely
&gt;&gt; due to bit rot.  
</div>&gt; Can you provide tests in which versions higher than 1.69 fail, and are
&gt; being unusable in this respect? 1.70 was released while Petr Pajas was
&gt; still the maintainer, and that&#39;s roughly what we started with. 
</div>
If you scrape a lot of pages with 1.70, the failures are mostly memory
leaks, a metric ton of &#39;em - enough that we can&#39;t use it.  I think we
had some crashes too, but I&#39;m vague on that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; If you&#39;d be willing to revert back to 1.69 and start
&gt;&gt; applying patches more carefully, I might consider it.
</div>&gt; Well, a lot of work was done since 1.69 in bug fixing, automated tests,
&gt; cleanups, documentation, and to a lesser extent - feature additions. We
&gt; cannot afford to throw it all away now. If you can take the BitBucket
&gt; version as a starting point and proceed from there, that would be the
&gt; best solution.
</div>
Could you replay your improvements from a base of 1.69 rather than from
1.70+?  Probably not...  Ah well.  Maybe someday I&#39;ll have the spare
time to try again.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-954358" href="/Public/Bug/Display.html?id=61507#txn-954358">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;10&nbsp;16:19:07&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/954358/496411/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/496411">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 08 11:25:12 2011, CHIPS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 7/8/2011 4:45 AM, Shlomi Fish via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;
&gt; &gt; Hi Chip,
&gt; &gt;
&gt; &gt; I apologise for the late response.
&gt; &gt;
&gt; &gt; On Tue Jul 05 17:29:02 2011, CHIPS wrote:
<div class="message-stanza open">&gt; &gt;&gt; On 7/5/2011 6:38 AM, Shlomi Fish via RT wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61507">https://rt.cpan.org/Ticket/Display.html?id=61507</a></span> &gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; On Mon Sep 27 02:39:47 2010, CHIPS wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;  OK, here&#39;s the patch.  The basic bug is that REPORT_ERROR and
</div></div></div></div>&gt; company
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; can end up dying, which leaves various reference-counted RETVALs
&gt; &gt;&gt;&gt;&gt; uncollected.  This patch fixes the RETVALs that are SVs, but
</div></div>&gt; there are
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; some other libxml data structure return values that this patch
</div></div>&gt; does
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; not fix.
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; PS: I wasn&#39;t consistent in my tab usage.  Mea culpa
</div>&gt; &gt;&gt;&gt; Hi Chip!
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Thanks for your patch, but can we also have a test added to it
</div></div>&gt; [...]
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; No, I&#39;m sorry, I won&#39;t be contributing further. I&#39;m stuck using
&gt; &gt;&gt; XML::LibXML 1.69 because all subsequent versions have been
</div></div>&gt; unusable, &gt; and
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; I expect eventually I&#39;ll be forced to stop using XML::LibXML
</div></div>&gt; entirely
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; due to bit rot.
</div>&gt; &gt; Can you provide tests in which versions higher than 1.69 fail, and
</div>&gt; are
<div class="message-stanza open">&gt; &gt; being unusable in this respect? 1.70 was released while Petr Pajas
</div>&gt; was
<div class="message-stanza open">&gt; &gt; still the maintainer, and that&#39;s roughly what we started with.
</div>&gt; 
&gt; If you scrape a lot of pages with 1.70, the failures are mostly memory
&gt; leaks, a metric ton of &#39;em - enough that we can&#39;t use it.  I think we
&gt; had some crashes too, but I&#39;m vague on that.
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; If you&#39;d be willing to revert back to 1.69 and start
&gt; &gt;&gt; applying patches more carefully, I might consider it.
</div>&gt; &gt; Well, a lot of work was done since 1.69 in bug fixing, automated
</div>&gt; tests,
<div class="message-stanza open">&gt; &gt; cleanups, documentation, and to a lesser extent - feature additions.
</div>&gt; We
<div class="message-stanza open">&gt; &gt; cannot afford to throw it all away now. If you can take the
</div>&gt; BitBucket
<div class="message-stanza open">&gt; &gt; version as a starting point and proceed from there, that would be
</div>&gt; the
<div class="message-stanza open">&gt; &gt; best solution.
</div>&gt; 
&gt; Could you replay your improvements from a base of 1.69 rather than
&gt; from
&gt; 1.70+?  Probably not...  Ah well.  Maybe someday I&#39;ll have the spare
&gt; time to try again.
&gt; 
</div>
That would be pretty hard for us because there were many such
improvements. So we&#39;d appreciate a test against an up-to-date XML-LibXML.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-997597" href="/Public/Bug/Display.html?id=61507#txn-997597">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;08&nbsp;17:35:29&nbsp;2011</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/997597/519551/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/519551">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m experiencing a problem with the XML::LibXML test suite that is clearly related to this bug 
report, so rather than create a new one, I&#39;m updating this one.  If you think this requires a 
new bug report, lemme know...

I&#39;ve just build XML::LibXML 1.88 for 5.10.1, 5.12.4, and 5.14.2, on both 32 and 64 bit AIX 6, 
Solaris 10, and RHEL 5, against libxml2-2.7.8.   

The last 2 tests in t/12html.t, which make the API calls that Chip reported as having memory 
leaks, cause the script to fail due to out of memory errors on the 64 bit Solaris 10 and AIX 6 
platforms.   They do NOT fail for any of the 32 bit builds, and they do not fail for 64 bit RHEL 
5.   The errors are identical for all perl versions.

This leads me to conclude that the problem is in libxml2 itself, and NOT in this code.  So, 
yeah -- this bug report needs to be made to the libxml2 folks as well.   

For now, I&#39;ve patched t/12html.t locally and forced it to skip those steps, and I&#39;ll warn my 
users to watch out for using that particular API style.  I don&#39;t know if you want to patch the 
distribution as a work around or not, so I haven&#39;t provided a patch here.

I hope this additional data brings some clarity to the problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1085600" href="/Public/Bug/Display.html?id=61507#txn-1085600">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;31&nbsp;03:19:30&nbsp;2012</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1085600/570551/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/570551">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Philip,

On Tue Nov 08 17:35:29 2011, WPMOORE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m experiencing a problem with the XML::LibXML test suite that is
&gt; clearly related to this bug
&gt; report, so rather than create a new one, I&#39;m updating this one.  If
&gt; you think this requires a
&gt; new bug report, lemme know...
&gt; 
&gt; I&#39;ve just build XML::LibXML 1.88 for 5.10.1, 5.12.4, and 5.14.2, on
&gt; both 32 and 64 bit AIX 6,
&gt; Solaris 10, and RHEL 5, against libxml2-2.7.8.
&gt; 
&gt; The last 2 tests in t/12html.t, which make the API calls that Chip
&gt; reported as having memory
&gt; leaks, cause the script to fail due to out of memory errors on the 64
&gt; bit Solaris 10 and AIX 6
&gt; platforms.   They do NOT fail for any of the 32 bit builds, and they
&gt; do not fail for 64 bit RHEL
&gt; 5.   The errors are identical for all perl versions.
</div>
This sounds like this problem:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=77340">https://rt.cpan.org/Ticket/Display.html?id=77340</a></span>

This was fixed in commit 35fba7a70067f4f9393e26d9d478e761fe65b47d in the
Mercurial repository, and will be released as part of XML-LibXML-1.99
later on. Can you see if on the 64-bit AIX/Solaris platforms, this patch
solves the problem you have encountered?

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.69145</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
