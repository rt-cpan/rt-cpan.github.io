<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #104759 for IO-Socket-SSL: Can&#39;t connect to www.microsoft.com:443 -- certificate verify failed</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #104759 for IO-Socket-SSL: Can&#39;t connect to www.microsoft.com:443 -- certificate verify failed</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=IO-Socket-SSL">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=IO-Socket-SSL">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=IO-Socket-SSL">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=IO-Socket-SSL">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Socket-SSL">IO-Socket-SSL CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">104759</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=IO-Socket-SSL">IO-Socket-SSL</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
GAAS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17228-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17229-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=104759">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1501253" href="/Public/Bug/Display.html?id=104759#txn-1501253">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;28&nbsp;18:04:45&nbsp;2015</span>
    <span class="description">GAAS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Can&#39;t connect to www.microsoft.com:443 -- certificate verify failed</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1501253/799910/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/799910">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza">The following test program demonstrates:<br>

<br>


<div>
	use IO::Socket::SSL; &nbsp; # I&#39;m using 2.015</div>


<div>
	&nbsp;</div>


<div>
	my @hosts = qw(</div>


<div>
	&nbsp; &nbsp; www.apple.com</div>


<div>
	&nbsp; &nbsp; www.microsoft.com</div>


<div>
	);</div>


<div>
	&nbsp;</div>


<div>
	print &quot;1..&quot;, int(@hosts), &quot;\n&quot;;</div>


<div>
	&nbsp;</div>


<div>
	my $testnum = 0;</div>


<div>
	for my $h (@hosts) {</div>


<div>
	&nbsp; &nbsp; print &quot;# $h\n&quot;;</div>


<div>
	&nbsp; &nbsp; my $s = IO::Socket::SSL-&gt;new(<br>
	&nbsp; &nbsp; &nbsp; &nbsp;PeerHost =&gt; $h,</div>


<div>
	&nbsp; &nbsp; &nbsp; &nbsp;PeerPort =&gt; 443,</div>


<div>
	&nbsp; &nbsp; );</div>


<div>
	&nbsp; &nbsp; unless ($s) {</div>


<div>
	&nbsp; &nbsp; &nbsp; &nbsp; print &quot;# error=$!, ssl_error=$SSL_ERROR\n&quot;;</div>


<div>
	&nbsp; &nbsp; &nbsp; &nbsp; print &quot;not &quot; unless $s;</div>


<div>
	&nbsp; &nbsp; }</div>


<div>
	&nbsp; &nbsp; print &quot;ok &quot;, ++$testnum, &quot;\n&quot;;</div>


<div>
	}<br>
	<br>
	when I run it I see:<br>
	<br>
	<div>
		&nbsp; 1..2</div>
	<div>
		&nbsp; # www.apple.com</div>
	<div>
		&nbsp; ok 1</div>
	<div>
		&nbsp; # www.microsoft.com</div>
	<div>
		&nbsp; # error=, ssl_error=SSL connect attempt failed error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed</div>
	<div>
		&nbsp; not ok 2</div>
</div>

<br>

AFAICT this is the same issue as discussed in&nbsp;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/gisle/mozilla-ca/pull/5">https://github.com/gisle/mozilla-ca/pull/5</a></span>. &nbsp;I had Mozilla-CA-20141217 installed above.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1501257" href="/Public/Bug/Display.html?id=104759#txn-1501257">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;28&nbsp;18:10:11&nbsp;2015</span>
    <span class="description">GAAS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1501257/799914/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/799914">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza">... which lead me to&nbsp;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kennethreitz/requests/issues/2455">https://github.com/kennethreitz/requests/issues/2455</a></span> and&nbsp;<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.python.org/issue23476">http://bugs.python.org/issue23476</a></span> and made me try this patch to IO-Socket-SSL:<br>

<br>


<div>
	diff --git a/lib/IO/Socket/SSL.pm b/lib/IO/Socket/SSL.pm</div>


<div>
	index 3118ea8..bae6391 100644</div>


<div>
	--- a/lib/IO/Socket/SSL.pm</div>


<div>
	+++ b/lib/IO/Socket/SSL.pm</div>


<div>
	@@ -2291,6 +2291,10 @@ WARN</div>


<div>
	&nbsp;<span> </span>return IO::Socket::SSL-&gt;error(</div>


<div>
	&nbsp;<span> </span> &nbsp; &nbsp;&quot;Invalid default certificate authority locations&quot;)</div>


<div>
	&nbsp;<span> </span> &nbsp; &nbsp;}</div>


<div>
	+<span> </span> &nbsp; &nbsp;Net::SSLeay::X509_STORE_set_flags(</div>


<div>
	+<span> </span> &nbsp; &nbsp; &nbsp; &nbsp;Net::SSLeay::CTX_get_cert_store($ctx),</div>


<div>
	+<span> </span> &nbsp; &nbsp; &nbsp; &nbsp;Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST(),</div>


<div>
	+<span> </span> &nbsp; &nbsp;) if eval { Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST() };</div>


<div>
	&nbsp;<span> </span>}</div>


<div>
	&nbsp;</div>


<div>
	&nbsp;<span> </span>if ($arg_hash-&gt;{SSL_server}<br>
	<br>
	which fixes this problem if you also fix your&nbsp;Net::SSLeay module to export this constant :-). &nbsp;I&#39;m not so sure this is the right fix, but I hope you find this discovery helpful in some way.</div>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1501267" href="/Public/Bug/Display.html?id=104759#txn-1501267">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;28&nbsp;18:25:19&nbsp;2015</span>
    <span class="description">GAAS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1501267/799922/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/799922">with headers</a>
<br />
<span class="downloadcontenttype">text/html 410b</span>
</div>
<div class="messagebody">
<div class="message-stanza">On Thu May 28 18:10:11 2015, GAAS wrote:<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; which fixes this problem if you also fix your Net::SSLeay module to<br>

&gt; export this&nbsp;constant :-).<br>
</div><br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">#<span>104760 contains the patch I applied Net-SSLeay.</span><br>
</div><br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1501300" href="/Public/Bug/Display.html?id=104759#txn-1501300">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;29&nbsp;01:24:57&nbsp;2015</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1501300/799941/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/799941">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; which fixes this problem if you also fix your Net::SSLeay module to
&gt; export this
&gt; constant :-&#41;. I&#39;m not so sure this is the right fix, but I hope you
&gt; find this
&gt; discovery helpful in some way.
</div>
Yes, this problem occurs a lot in the last time in all languages/tools/lib which use OpenSSL and a recent CA package from Mozilla, i.e. with the 1024 bit CA&#39;s removed. The problem is a long standing bug with OpenSSL and the handling of alternative trust path, more details at <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/27804710/python-urllib2-ssl-error/27826829#27826829">http://stackoverflow.com/questions/27804710/python-urllib2-ssl-error/27826829#27826829</a></span>. I&#39;ve reported the problem already 2012 to OpenSSL :&#40;

One workaround is to use X509_V_FLAG_TRUSTED_FIRST. But this option is only available since OpenSSL 1.02 which was only released 4 month ago &#40;and introduced some other bugs now fixed with 1.02a :&#41; Another workaround is to continue to use the 1024 bit certs, either by using the older Mozilla::CA 20130114, by using the old ca-bundle instead of the new from <span class="clickylink"><a target="new" rel="nofollow" href="http://curl.haxx.se/docs/caextract.html">http://curl.haxx.se/docs/caextract.html</a></span> or by using the distributions CA store which usually includes the older CA certificates too. Debian/Ubuntu patched LWP this way so you will not run into this problem there.

The issue was fixed finally in 02/2015 but only in the newest OpenSSL branch &#40;not 1.0.2x&#41;. So I don&#39;t expect a release in the near future. See <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.openssl.org/Ticket/Display.html?id=3637&#38;user=guest&#38;pass=guest">https://rt.openssl.org/Ticket/Display.html?id=3637&#38;user=guest&#38;pass=guest</a></span>.

I think a good idea is to at least enable the flag by default if it is available &#40;e.g. OpenSSL 1.0.2 and available from Net::SSLeay&#41;. Other then that there is unfortunately not much one can do except to educate users to keep using the 1024 bit CA&#39;s.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1501301" href="/Public/Bug/Display.html?id=104759#txn-1501301">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;29&nbsp;01:24:58&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1501304" href="/Public/Bug/Display.html?id=104759#txn-1501304">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;29&nbsp;02:03:44&nbsp;2015</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1501304/799944/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/799944">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 404b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think a good idea is to at least enable the flag by default if it is
&gt; available &#40;e.g. OpenSSL 1.0.2 and available from Net::SSLeay&#41;.
</div>
The flag will be enabled by default if available, starting with 2.015_005, see <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/noxxi/p5-io-socket-ssl/commit/3ede5be99ebe4f0ae1d82c44caac8a3ff4a46451">https://github.com/noxxi/p5-io-socket-ssl/commit/3ede5be99ebe4f0ae1d82c44caac8a3ff4a46451</a></span>. Since I don&#39;t have OpenSSL 1.02 on my system - can you please check if the code works for you?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1501695" href="/Public/Bug/Display.html?id=104759#txn-1501695">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;30&nbsp;03:33:08&nbsp;2015</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1501695/800176/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/800176">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1019b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; .... Another
&gt; workaround is to continue to use the 1024 bit certs, either by using
&gt; the older Mozilla::CA 20130114, by using the old ca-bundle instead of
&gt; the new from <span class="clickylink"><a target="new" rel="nofollow" href="http://curl.haxx.se/docs/caextract.html">http://curl.haxx.se/docs/caextract.html</a></span> or by using the
&gt; distributions CA store which usually includes the older CA
&gt; certificates too. Debian/Ubuntu patched LWP this way so you will not
&gt; run into this problem there.
</div>
Hi Gisle,
there is a pull request for LWP::Protocol::https which make it use the default
trust store from IO::Socket::SSL. On most systems this means the systems CA
store and only on systems which don&#39;t provide a useful store for OpenSSL it
falls back to Mozilla::CA &#40;like on Windows&#41;. In effect this would be the
behavior Debian/Ubuntu already have know.

This patch would lessen the problem for most systems.
karenetheridge is willing to merge the patch but cannot ship are now version.
But it looks like you could help, see 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/libwww-perl/lwp-protocol-https/pull/15#issuecomment-106954948">https://github.com/libwww-perl/lwp-protocol-https/pull/15#issuecomment-106954948</a></span>

Regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1502917" href="/Public/Bug/Display.html?id=104759#txn-1502917">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;15:05:30&nbsp;2015</span>
    <span class="description">GAAS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1502917/800874/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/800874">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza">On Fri May 29 02:03:44 2015, SULLR wrote:<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;<br>
<div class="message-stanza open">&gt; &gt; I think a good idea is to at least enable the flag by default if it<br>

&gt; &gt; is<br>

&gt; &gt; available (e.g. OpenSSL 1.0.2 and available from Net::SSLeay).<br>
</div>&gt;<br>

&gt; The flag will be enabled by default if available, starting with<br>

&gt; 2.015_005, see <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/noxxi/p5-io-socket-">https://github.com/noxxi/p5-io-socket-</a></span><br>

&gt; ssl/commit/3ede5be99ebe4f0ae1d82c44caac8a3ff4a46451. Since I don&#39;t<br>

&gt; have OpenSSL 1.02 on my system - can you please check if the code<br>

&gt; works for you?<br>
</div><br>

It doesn&#39;t work. &nbsp;The &quot;defined &amp;Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST&quot;-test &nbsp;is always false. &nbsp;I guess because the constant is not autoloaded yet.<br>

<br>

I had to apply the following patch on top of yours to make it work here:<br>

<br>


<div>
	--- a/lib/IO/Socket/SSL.pm</div>


<div>
	+++ b/lib/IO/Socket/SSL.pm</div>


<div>
	@@ -232,7 +232,7 @@ if (!defined &amp;Net::SSLeay::CTX_clear_options) {</div>


<div>
	&nbsp;</div>


<div>
	&nbsp;# Try to work around problems with alternative trust path by default, RT#104759</div>


<div>
	&nbsp;my $DEFAULT_X509_STORE_flags = 0;</div>


<div>
	-if (defined &amp;Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST) {</div>


<div>
	+if (eval { Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST(); }) {</div>


<div>
	&nbsp; &nbsp; &nbsp;$DEFAULT_X509_STORE_flags = Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST();</div>


<div>
	&nbsp;}</div>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1502928" href="/Public/Bug/Display.html?id=104759#txn-1502928">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;15:36:13&nbsp;2015</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1502928/800881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/800881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 445b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; It doesn&#39;t work. The &#34;defined
&gt; &#38;Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST&#34;-test is
&gt; always false. I guess because the constant is not autoloaded yet.
</div>
2.015_006 should do it then hopefully:

 my $DEFAULT_X509_STORE_flags = 0;
-if &#40;defined &#38;Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST&#41; {
-    $DEFAULT_X509_STORE_flags = Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST&#40;&#41;;
-}
+eval { $DEFAULT_X509_STORE_flags |= Net::SSLeay::X509_V_FLAG_TRUSTED_FIRST&#40;&#41; };
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1502944" href="/Public/Bug/Display.html?id=104759#txn-1502944">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;16:21:47&nbsp;2015</span>
    <span class="description">GAAS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1502944/800894/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/800894">with headers</a>
<br />
<span class="downloadcontenttype">text/html 51b</span>
</div>
<div class="messagebody">
<div class="message-stanza">I&#39;ve now verified that this patch works for me.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1502954" href="/Public/Bug/Display.html?id=104759#txn-1502954">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;16:41:38&nbsp;2015</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1502954/800900/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/800900">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 146b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Di 02. Jun 2015, 16:21:47, GAAS schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve now verified that this patch works for me.
</div>
Thanks for testing. This is now released as 2.016.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1502957" href="/Public/Bug/Display.html?id=104759#txn-1502957">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;16:41:46&nbsp;2015</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.580667</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
