<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #101382 for Net-LDAP-SimpleServer: Enhancement request: allow binding using user accounts in the data store</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #101382 for Net-LDAP-SimpleServer: Enhancement request: allow binding using user accounts in the data store</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-LDAP-SimpleServer">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-LDAP-SimpleServer">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-LDAP-SimpleServer">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-LDAP-SimpleServer">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-LDAP-SimpleServer">Net-LDAP-SimpleServer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">101382</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-LDAP-SimpleServer">Net-LDAP-SimpleServer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">RUSSOZ [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ipuleston [...] SonicWALL.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-235170-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.0.17</li>
<li>
0.0.18</li>
<li>
0.0.19</li>
</ul>
    </td>
  </tr>
  <tr id="CF-235171-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.0.20    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




add-user-pwds.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1450578/771382/add-user-pwds.patch">
Wed Jan 07 13:26:11 2015 (7.5k) by http://facebook-openid.appspot.com/ian.puleston.5
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=101382">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1450578" href="/Public/Bug/Display.html?id=101382#txn-1450578">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;13:26:11&nbsp;2015</span>
    <span class="description">http://facebook-openid.appspot.com/ian.puleston.5 -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net-LDAP-SimpleServer</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1450578/771381/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/771381">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am using Net::LDAP::SimpleServer as a back-end server for testing of an LDAP client, and one of the features of the latter that I need to test is a fairly common one: authenticating users by trying to bind using their DN/password. That is not currently supported by this module but can be quite easily added and is I think a useful feature to have here, so this is an enhancement request to add it, with a patch for that.

This patch enables binding using the DN/password of any entry in the data store that has objectClass &#39;person&#39; and a userPassword attribute that is either plain text or an MD5 hash &#40;in the standard &#34;MD5:hash-value&#34; format&#41; in addition to allowing binding with the root_dn/root_pw.

Additionally, the patch adds a new option to control how userPassword attributes are returned in search replies:

&#39;user_pwds&#39; - whether user passwords can be read in search replies &#40;&#39;readable&#39;, &#39;not-readable&#39; or &#39;hashed-md5&#39;&#41;. &#39;hashed-md5&#39; causes plain-text passwords in the data file to be returned as MD5 hashes &#40;&#34;MD5:hash-value&#34;&#41; in the search results &#40;not needed if the passwords in the data file are already MD5 hashes&#41;.

Note that since, as per its documentation, this module is not intended as a &#34;real&#34; LDAP server, this patch is not trying to be secure with user passwords in any way, but rather to emulate what real LDAP servers do in binds and in searches for user entries.

The patch is attached - note that it requires the patch from issue 101365 &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=101365&#41;">https://rt.cpan.org/Public/Bug/Display.html?id=101365&#41;</a></span> to be applied first.

To apply the patch during installation, after unpacking Net-LDAP-SimpleServer-0.0.17.tar.gz, cd into the Net-LDAP-SimpleServer-0.0.17 directory and type:

- patch -p1 &lt;path-to-it&gt;/add-srch-scope.patch &#40;see issue 101365&#41;
- patch -p1 &lt;path-to-it&gt;/add-user-pwds.patch

Then continue the install as normal. 
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> add-user-pwds.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1450578/771382/add-user-pwds.patch">Download add-user-pwds.patch</a><br />
<span class="downloadcontenttype">text/x-diff 7.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Naur Net-LDAP-SimpleServer-0.0.17-2/lib/Net/LDAP/SimpleServer/ProtocolHandler.pm Net-LDAP-SimpleServer-0.0.17/lib/Net/LDAP/SimpleServer/ProtocolHandler.pm
--- Net-LDAP-SimpleServer-0.0.17-2/lib/Net/LDAP/SimpleServer/ProtocolHandler.pm	2015-01-06 18:07:15.196343689 -0800
+++ Net-LDAP-SimpleServer-0.0.17/lib/Net/LDAP/SimpleServer/ProtocolHandler.pm	2015-01-06 18:31:07.110218401 -0800
@@ -9,7 +9,7 @@
 
 use Net::LDAP::Server;
 use base &#39;Net::LDAP::Server&#39;;
-use fields qw&#40;store root_dn root_pw allow_anon&#41;;
+use fields qw&#40;store root_dn root_pw allow_anon user_pwds&#41;;
 
 use Carp;
 use Net::LDAP::LDIF;
@@ -56,7 +56,9 @@
     $self-&gt;{root_dn}    = $canon_dn;
     $self-&gt;{root_pw}    = $params-&gt;{root_pw};
     $self-&gt;{allow_anon} = $params-&gt;{allow_anon};
+    $self-&gt;{user_pwds}  = $params-&gt;{user_pwds};
     chomp&#40; $self-&gt;{root_pw} &#41;;
+    chomp&#40; $self-&gt;{user_pwds} &#41;;
 
     return $self;
 }
@@ -96,17 +98,47 @@
       unless my $binddn = canonical_dn&#40; $request-&gt;{name} &#41;;
 
     #print STDERR qq#binddn is ok &#40;$request-&gt;{name}&#41; =&gt; &#40;$binddn&#41;\n#;
-    #print STDERR qq#handler dn is $self-&gt;{root_dn}\n#;
-    return _make_result&#40;LDAP_INVALID_CREDENTIALS&#41;
-      unless uc&#40;$binddn&#41; eq uc&#40; $self-&gt;{root_dn} &#41;;
-
-    #print STDERR qq{binddn is good\n};
     my $bindpw = $request-&gt;{authentication}-&gt;{simple};
     chomp&#40;$bindpw&#41;;
 
-    #print STDERR qq|comparing &#40;$bindpw&#41; eq &#40;$self-&gt;{root_pw}&#41;\n|;
-    return _make_result&#40;LDAP_INVALID_CREDENTIALS&#41;
-      unless $bindpw eq $self-&gt;{root_pw};
+    if &#40;uc&#40;$binddn&#41; eq uc&#40; $self-&gt;{root_dn} &#41;&#41; {
+        #print STDERR qq#handler dn is $self-&gt;{root_dn}\n#;
+        #print STDERR qq|comparing pwd &#40;$bindpw&#41; eq &#40;$self-&gt;{root_pw}&#41;\n|;
+        return _make_result&#40;LDAP_INVALID_CREDENTIALS&#41;
+          unless $bindpw eq $self-&gt;{root_pw};
+    } else {
+        #print STDERR qq#looking for users with passwords\n#;
+        my $list = $self-&gt;{store}-&gt;list;
+        my $filter = Net::LDAP::Filter-&gt;new&#40;&#34;&#40;&#38;&#40;objectClass=person&#41;&#40;userPassword=*&#41;&#41;&#34;&#41;;
+        my $users = _match&#40; $filter, $list &#41;;
+        my $authed = 0;
+        my $user = _find&#40;$binddn, $users&#41;;
+        if &#40;$user&#41; {
+            #print STDERR qq{found user entry for binddn $binddn\n};
+            my $pwds = _get_attr&#40;$user, &#39;userPassword&#39;&#41;;
+            #print STDERR qq|comparing pwd &#40;$bindpw&#41; with &#40;| . join&#40;&#34;, &#34;, @{$pwds}&#41; . &#34;&#41;\n&#34;;
+            $authed = 1 if &#40;grep { $bindpw eq $_ } @{$pwds}&#41;;
+            if &#40;!$authed&#41; {
+                foreach my $pwd &#40;@{$pwds}&#41; {
+                    if &#40;substr&#40;$pwd, 0, 4&#41; eq &#34;MD5:&#34;&#41; {
+                        use Digest::MD5;
+                        use MIME::Base64;
+                        my $ctx = Digest::MD5-&gt;new;
+                        $ctx-&gt;add&#40;$bindpw&#41;;
+                        my $hashpw = encode_base64&#40;$ctx-&gt;digest,&#39;&#39;&#41;;
+                        #print STDERR qq|comparing MD5 hash &#40;$hashpw&#41; with &#40;| . substr&#40;$pwd, 4&#41; . &#34;&#41;\n&#34;;
+                        if &#40;$hashpw eq substr&#40;$pwd, 4&#41;&#41; {
+                            $authed = 1;
+                            last;
+                        }
+                    }
+                }
+            }
+        }
+        if &#40;!$authed&#41; {
+            return _make_result&#40;LDAP_INVALID_CREDENTIALS&#41;;
+        }
+    }
 
     return $ok;
 }
@@ -118,6 +150,14 @@
     return [ grep { $f-&gt;match&#40;$_&#41; } @{$elems} ];
 }
 
+sub _find {
+    my &#40; $objectName, $elems &#41; = @_;
+
+    my $uc_name = uc&#40;$objectName&#41;;
+    my @objs = grep { uc&#40;$_-&gt;{asn}-&gt;{objectName}&#41; eq $uc_name } @{$elems};
+    return &#40;$#objs &gt;= 0&#41; ? $objs[0] : 0;
+}
+
 sub _in_scope {
     my &#40;$dn, $basedn, $scope&#41; = @_;
 
@@ -144,6 +184,20 @@
     return _in_scope&#40;uc&#40;$elem-&gt;{asn}-&gt;{&#39;objectName&#39;}&#41;, $uc_basedn, $scope&#41;;
 }
 
+sub _get_attr {
+    my &#40; $elem, $type &#41; = @_;
+
+    my $vals = 0;
+    my $attrs = $elem-&gt;{asn}-&gt;{&#39;attributes&#39;};
+    for &#40;my $j = 0; $j &lt;= $#{$attrs}; $j++&#41; {
+        if &#40;uc&#40;$$attrs[$j]-&gt;{type}&#41; eq uc&#40;$type&#41;&#41; {
+            $vals = $$attrs[$j]-&gt;{vals};
+            last;
+        }
+    }
+    return $vals;
+}
+
 sub search {
     my &#40; $self, $request &#41; = @_;
 
@@ -152,7 +206,8 @@
     my @scopes = qw&#40;baseObj oneLevel subTree&#41;;
 
     my $basedn = $request-&gt;{baseObject};
-    my $scope = $scopes[ &#40;defined $request-&gt;{scope} &#38;&#38; $request-&gt;{scope} &lt;= 2&#41; ? $request-&gt;{scope} : 2 ];
+    my $scope = $scopes[ &#40;defined $request-&gt;{scope} &#38;&#38; $request-&gt;{scope} &lt;= 2&#41;
+        ? $request-&gt;{scope} : 2 ];
 
     #print STDERR &#39;=&#39; x 50 . &#34;\n&#34;;
     #print STDERR Dumper&#40;$request&#41;;
@@ -169,6 +224,34 @@
 
     my $res = _match&#40; $request-&gt;{filter}, $list &#41;;
 
+    if &#40;$self-&gt;{user_pwds} ne &#39;readable&#39;&#41; {
+        for &#40;my $i = 0; $i &lt;= $#{$res}; $i++&#41; {
+            my $attrs = $$res[$i]-&gt;{asn}-&gt;{&#39;attributes&#39;};
+            if &#40;$self-&gt;{user_pwds} eq &#39;hashed-md5&#39;&#41; {
+                for &#40;my $j = 0; $j &lt;= $#{$attrs}; $j++&#41; {
+                    if &#40;$$attrs[$j]-&gt;{type} eq &#39;userPassword&#39;&#41; {
+                        use Digest::MD5;
+                        use MIME::Base64;
+                        for &#40;my $k = 0; $k &lt;= $#{$$attrs[$j]-&gt;{vals}}; $k++&#41; {
+                            my $ctx = Digest::MD5-&gt;new;
+                            $ctx-&gt;add&#40;$$attrs[$j]-&gt;{vals}[$k]&#41;;
+                            $$attrs[$j]-&gt;{vals}[$k] = &#34;{MD5}&#34; . encode_base64&#40;$ctx-&gt;digest,&#39;&#39;&#41;;
+                        }
+                    }
+                }
+            } else {
+                # Prune out any userPassword attributes
+                my @pruned_attrs = &#40;&#41;;
+                for &#40;my $j = 0; $j &lt;= $#{$attrs}; $j++&#41; {
+                    push&#40;@pruned_attrs, $$attrs[$j]&#41; if &#40;$$attrs[$j]-&gt;{type} ne &#39;userPassword&#39;&#41;;
+                }
+                if &#40;$#pruned_attrs &lt; $#{$attrs}&#41; {
+                    $$res[$i]-&gt;{asn}-&gt;{&#39;attributes&#39;} = [ @pruned_attrs ];
+                }
+            }
+        }
+    }
+
     #print STDERR Dumper&#40;$res&#41;;
 
     return &#40; _make_result&#40;LDAP_SUCCESS&#41;, @{$res} &#41;;
@@ -218,7 +301,11 @@
 
 =head2 bind&#40; REQUEST &#41;
 
-Handles a bind REQUEST from the LDAP client.
+Handles a bind REQUEST from the LDAP client. Allows binding with the root_dn
+/ root_pw, or with the DN of a user entry in the data store that has
+objectClass &#39;person&#39;. In the latter case the bind password must match a
+&#39;userPassword&#39; attribute of that entry &#40;case-sensitive&#41; with plain text and
+MD5 &#40;&#34;MD5:hash-value&#34;&#41; userPassword attributes supported.
 
 =head2 unbind&#40;&#41;
 
diff -Naur Net-LDAP-SimpleServer-0.0.17-2/lib/Net/LDAP/SimpleServer.pm Net-LDAP-SimpleServer-0.0.17/lib/Net/LDAP/SimpleServer.pm
--- Net-LDAP-SimpleServer-0.0.17-2/lib/Net/LDAP/SimpleServer.pm	2015-01-06 18:07:15.195343685 -0800
+++ Net-LDAP-SimpleServer-0.0.17/lib/Net/LDAP/SimpleServer.pm	2015-01-06 18:31:07.110218401 -0800
@@ -41,7 +41,7 @@
 my $DEFAULT_LOG_FILE    = File::Spec-&gt;catfile&#40; $BASEDIR, &#39;server.log&#39; &#41;;
 
 my @LDAP_PRIVATE_OPTIONS = &#40; &#39;store&#39;, &#39;input&#39;, &#39;output&#39; &#41;;
-my @LDAP_PUBLIC_OPTIONS = &#40; &#39;data_file&#39;, &#39;root_dn&#39;, &#39;root_pw&#39;, &#39;allow_anon&#39; &#41;;
+my @LDAP_PUBLIC_OPTIONS = &#40; &#39;data_file&#39;, &#39;root_dn&#39;, &#39;root_pw&#39;, &#39;allow_anon&#39;, &#39;user_pwds&#39; &#41;;
 
 make_path&#40;$BASEDIR&#41;;
 
@@ -76,6 +76,7 @@
     $v-&gt;{allow_anon} = 1;
     $v-&gt;{root_dn}    = &#39;cn=root&#39;;
     $v-&gt;{data_file}  = $DEFAULT_DATA_FILE if -r $DEFAULT_DATA_FILE;
+    $v-&gt;{user_pwds}  = &#39;not-readable&#39;;
 
     #use Data::Dumper; print STDERR Dumper&#40;$v&#41;;
     return $v;
@@ -227,6 +228,14 @@
 
 allow_anon - whether to allow for anonymous binds
 
+=item *
+
+user_pwds - whether user passwords can be read in search replies
+&#40;&#39;readable&#39;, &#39;not-readable&#39; or &#39;hashed-md5&#39;&#41;. &#39;hashed-md5&#39; causes plain-text
+passwords in the data file to be returned as MD5 hashes &#40;&#34;MD5:hash-value&#34;&#41;
+in the search results &#40;not needed if the passwords in the data file are
+already MD5 hashes&#41;.
+
 =back
 
 =head2 default_values&#40;&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1450605" href="/Public/Bug/Display.html?id=101382#txn-1450605">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;14:40:02&nbsp;2015</span>
    <span class="description">ipuleston [...] SonicWALL.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #101382]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Jan 2015 11:39:53 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Net-LDAP-SimpleServer via RT &lt;bug-Net-LDAP-SimpleServer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ian Puleston &lt;ipuleston [...] SonicWALL.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1450605/771409/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/771409">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 165b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Correction to the patch instructions. That should say:

- patch -p1 &lt;path-to-it/add-srch-scope.patch &#40;see issue 101365&#41;
- patch -p1 &lt;path-to-it/add-user-pwds.patch
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1450605/771410/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/771410">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1450607" href="/Public/Bug/Display.html?id=101382#txn-1450607">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;14:43:09&nbsp;2015</span>
    <span class="description">ipuleston [...] SonicWALL.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #101382]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Jan 2015 11:42:37 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Net-LDAP-SimpleServer via RT &lt;bug-Net-LDAP-SimpleServer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ian Puleston &lt;ipuleston [...] SonicWALL.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1450607/771413/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/771413">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 222b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looks like I forgot to fill in the subject for this issue. It should read as follows, so if someone has access rights to update that please do so:

Enhancement request: allow binding using user accounts in the data store
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1450607/771414/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/771414">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1751306" href="/Public/Bug/Display.html?id=101382#txn-1751306">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;07&nbsp;02:27:54&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1753368" href="/Public/Bug/Display.html?id=101382#txn-1753368">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;00:31:20&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Subject changed from &#39;Net-LDAP-SimpleServer&#39; to &#39;Enhancement request: allow binding using user accounts in the data store&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1753369" href="/Public/Bug/Display.html?id=101382#txn-1753369">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;00:32:04&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1753370" href="/Public/Bug/Display.html?id=101382#txn-1753370">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;00:32:49&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Broken in 0.0.18 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1753371" href="/Public/Bug/Display.html?id=101382#txn-1753371">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;00:32:49&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Broken in 0.0.19 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1755478" href="/Public/Bug/Display.html?id=101382#txn-1755478">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;04&nbsp;05:34:27&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1755478/944558/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/944558">with headers</a>
<br />
<span class="downloadcontenttype">text/html 236b</span>
</div>
<div class="messagebody">
<div class="message-stanza">Hi Ian,<br>

<br>

Thanks (once again) for your suggestions (even if took an eternity for me to respond). The patch was very valuable to guide the implementation, many of the ideas for the code came from it.<br>

<br>

Alexei<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1755481" href="/Public/Bug/Display.html?id=101382#txn-1755481">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;04&nbsp;05:34:28&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1755761" href="/Public/Bug/Display.html?id=101382#txn-1755761">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;06&nbsp;02:29:53&nbsp;2017</span>
    <span class="description">RUSSOZ [...] cpan.org -  Fixed in 0.0.20 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.527329</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
