<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69982 for Net-FTPSSL: Smoke Tester Prompt Issue</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69982 for Net-FTPSSL: Smoke Tester Prompt Issue</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-FTPSSL/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-FTPSSL/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-FTPSSL/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-FTPSSL/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-FTPSSL">Net-FTPSSL CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69982</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-FTPSSL/Active/">Net-FTPSSL</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
BINGOS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-22628-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.18    </td>
  </tr>
  <tr id="CF-22629-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.19    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;09:12:31&nbsp;2011</span>
    <span class="description">BINGOS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">One of the tests asks a question of the user.

Unfortunately this is done in such a way that automated CPAN testers
just &#39;hang&#39; on the question &#40;on my CPAN smokers a timeout hits on 15
minutes of inactivity and the job is killed&#41;.

I would suggest using ExtUtils::MakeMaker&#39;s prompt&#40;&#41; function.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;09:12:56&nbsp;2011</span>
    <span class="description">BINGOS [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;11:38:02&nbsp;2011</span>
    <span class="description">CLEACH [...] cpan.org -  Subject changed from &#40;no value&#41; to &#39;Smoke Tester Prompt Issue&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;11:47:11&nbsp;2011</span>
    <span class="description">CLEACH [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the update &#38; suggestion on how to fix it.  This is the 1st 
I&#39;ve heard of this issue. I thought you just answered &#34;No&#34; to the 
deaper test question.

I&#39;ll look into using the prompt function you suggested with my next 
release.

By the way, as of v0.18, there were 2 types of deaper tests, so there 
are 2 places to ansewr No at.  &#40;Or just return, since No is the 
default.&#41;

Curtis

On Wed Aug 03 09:12:31 2011, BINGOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One of the tests asks a question of the user.
&gt; 
&gt; Unfortunately this is done in such a way that automated CPAN testers
&gt; just &#39;hang&#39; on the question &#40;on my CPAN smokers a timeout hits on 15
&gt; minutes of inactivity and the job is killed&#41;.
&gt; 
&gt; I would suggest using ExtUtils::MakeMaker&#39;s prompt&#40;&#41; function.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;20:50:27&nbsp;2011</span>
    <span class="description">CLEACH [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Turns out I couldn&#39;t use ExtUtils::MakeMaker&#39;s prompt&#40;&#41; function since 
it wouldn&#39;t display the prompts during &#34;make test&#34; for the non-smoke 
testers, so I cloned it into my test code to use diag&#40;&#41; instead of 
print.

Can you please see if the 2 attached test files will allow v0.18 to 
pass your smoke testing without any more issues?

Setting the environment variable PERL_MM_USE_DEFAULT to 1
   or
make test &lt; /dev/null

Both methods should force both test scripts to use their defaults.

If there are any other tests I should be doing to allow smoother 
testing of my module by the smoke testers, please advise &#38; I&#39;ll put it 
into place.

Curtis


On Wed Aug 03 11:47:11 2011, CLEACH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the update &#38; suggestion on how to fix it.  This is the 
</div>1st 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve heard of this issue. I thought you just answered &#34;No&#34; to the 
&gt; deaper test question.
&gt; 
&gt; I&#39;ll look into using the prompt function you suggested with my next 
&gt; release.
&gt; 
&gt; By the way, as of v0.18, there were 2 types of deaper tests, so 
</div>there 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; are 2 places to ansewr No at.  &#40;Or just return, since No is the 
&gt; default.&#41;
&gt; 
&gt; Curtis
&gt; 
&gt; On Wed Aug 03 09:12:31 2011, BINGOS wrote:
<div class="message-stanza open">&gt; &gt; One of the tests asks a question of the user.
&gt; &gt; 
&gt; &gt; Unfortunately this is done in such a way that automated CPAN 
</div></div>testers
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; just &#39;hang&#39; on the question &#40;on my CPAN smokers a timeout hits on 
</div></div>15
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; minutes of inactivity and the job is killed&#41;.
&gt; &gt; 
&gt; &gt; I would suggest using ExtUtils::MakeMaker&#39;s prompt&#40;&#41; function.
</div>&gt; 
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 10-complex.t</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 20-certificate.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># Before `make install&#39; is performed this script should be runnable with
# `make test&#39;. After `make install&#39; it should work as `perl ./t/10-complex.t&#39;

#########################

# Goal here is to give as many success messagse as possible.
# Especially when not all FTP servers support all functions.
# So the logic here can be a bit convoluted.

use strict;
use warnings;

# Uncomment if you need to trace issues with IO::Socket:SSL methods as well.
# Proper values are: debug0, debug1, debug2 &#38; debug3.  3 is the most verbose!
use IO::Socket::SSL qw&#40;debug3&#41;;

use Test::More tests =&gt; 11;   # Also update skipper &#40;one less&#41;
use File::Copy;

my $skipper = 10;

# plan tests =&gt; 10;  # Can&#39;t use due to BEGIN block

BEGIN { use_ok&#40;&#39;Net::FTPSSL&#39;&#41; }    # Test # 1

sleep &#40;1&#41;;  # So test 1 completes before the message prints!

# -----------------------------------------------------------
# This section initializes an unsupported feature to Net::FTPSSL.
# But it&#39;s required in order to implement Client Certificates.
# -----------------------------------------------------------
my %advanced_hash = &#40; SSL_version   =&gt; &#34;SSLv23&#34;,
                      SSL_use_cert  =&gt; 1,
                      SSL_server    =&gt; 0,
                      SSL_key_file  =&gt; &#34;$ENV{HOME}/Certificate/private.pem&#34;,
                      SSL_cert_file =&gt; &#34;$ENV{HOME}/Certificate/pubkey.pem&#34;,
                      SSL_passwd_cb =&gt; sub { return &#40;&#34;my_password&#34;&#41; },
                      Timeout       =&gt; 60 &#41;;
# -----------------------------------------------------------


diag&#40; &#34;\nYou can also perform a certificate test.&#34; &#41;;
diag&#40; &#34;Some information will be required for this test:&#34; &#41;;
diag&#40; &#34;A secure ftp server expecting a client certificate,&#34;&#41;;
diag&#40; &#34;a user, a password and a directory where the user&#34;&#41;;
diag&#40; &#34;has permissions to read and write.&#34; &#41;;
my $more_test = ask_yesno&#40;&#34;Do you want to do a certificate test&#34;&#41;;

SKIP: {
    skip &#40; &#34;Certificate tests skipped for some reason ...&#34;, $skipper &#41; unless $more_test;

    unless &#40;-f $advanced_hash{SSL_key_file} &#38;&#38; -f $advanced_hash{SSL_cert_file} &#41; {
       skip &#40; &#34;Deeper test skipped due to no client certificate defined ...&#34;, $skipper &#41;;
    }

    my&#40; $address, $server, $port, $user, $pass, $dir, $mode, $data, $encrypt_mode, $psv_mode &#41;; 

    $address = ask2&#40;&#34;Server address &#40; host[:port] &#41;&#34;, undef, undef, $ENV{FTPSSL_SERVER}&#41;;
    &#40; $server, $port &#41; = split&#40; /:/, $address &#41;;
    # $port = 21 unless $port;   # Let FTPSSL provide the default port.

    $user = ask2&#40;&#34;\tUser&#34;, &#34;anonymous&#34;, undef, $ENV{FTPSSL_USER}&#41;;

    $pass = ask2&#40;&#34;\tPassword [a space for no password]&#34;, &#34;user\@localhost&#34;, undef, $ENV{FTPSSL_PWD}&#41;;

    $dir = ask2&#40;&#34;\tDirectory&#34;, &#34;&lt;HOME&gt;&#34;, undef, $ENV{FTPSSL_DIR}&#41;;
    $dir = &#34;&#34; if &#40;$dir eq &#34;&lt;HOME&gt;&#34;&#41;;   # Will ask server for it later on.

    $mode = ask&#40;&#34;\tConnection mode &#40;I&#41;mplicit or &#40;E&#41;xplicit.&#34;,
                EXP_CRYPT, &#34;&#40;I|E&#41;&#34;&#41;;

    if &#40; $mode eq CLR_CRYPT &#41; {
       $data = $encrypt_mode = &#34;&#34;;   # Make sure not undef ...
    } else {
       $data = ask&#40;&#34;\tData Connection mode &#40;C&#41;lear or &#40;P&#41;rotected.&#34;,
                   DATA_PROT_PRIVATE, &#34;&#40;C|S|E|P&#41;&#34;&#41;;

       $encrypt_mode = ask&#40;&#34;\tUse &#40;T&#41;LS or &#40;S&#41;SL encryption&#34;, &#34;T&#34;, &#34;&#40;T|S&#41;&#34;&#41;;
    }
    $encrypt_mode = &#40;$encrypt_mode eq &#34;S&#34;&#41; ? 1 : 0;

    $psv_mode = ask&#40;&#34;\tUse &#40;P&#41;ASV or &#40;E&#41;PSV for data connections&#34;, &#34;P&#34;, &#34;&#40;P|E&#41;&#34;&#41;;

    # The main certificate log file ...
    my $log_file = &#34;./t/test_certificate.txt&#34;;

    # -----------------------------------------------------------
    # End of user interaction ...
    # -----------------------------------------------------------

    # Delete test files from previous run
    unlink &#40;$log_file&#41;;

    # So we can save the Debug trace in a file from this test.
    # We don&#39;t use DebugLogFile for this on purpose so that everything
    # written to STDERR is in the log file, including msgs from this test!
    # But doing it this way is very undesireable in a real program!
    open &#40;OLDERR, &#34;&gt;&#38;STDERR&#34;&#41;;
    open &#40;STDERR, &#34;&gt; $log_file&#34;&#41;;

    $advanced_hash{SSL_version} = &#40;$encrypt_mode ? &#34;SSLv23&#34; : &#34;TLSv1&#34;&#41;;

    # My Net::FTPSSL connection options ...
    my %ftps_opts = &#40; Port =&gt; $port, Encryption =&gt; $mode,
                      DataProtLevel =&gt; $data, useSSL =&gt; $encrypt_mode,
                      SSL_Client_Certificate =&gt; \%advanced_hash,
                      Croak =&gt; 1,
                      Timeout =&gt; 121, Debug =&gt; 1, Trace =&gt; 1 &#41;;

    print STDERR &#34;\n**** Starting the Certificate server test ****\n&#34;;

    # Writes logs to STDERR which this script redirects to a file ...
    my $ftp = Net::FTPSSL-&gt;new&#40; $server, \%ftps_opts &#41;;

    isa_ok&#40; $ftp, &#39;Net::FTPSSL&#39;, &#39;Net::FTPSSL object creation&#39; &#41;;

    ok&#40; $ftp-&gt;login &#40;$user, $pass&#41;, &#34;Login to $server&#34; &#41;;

    # Turning off croak now that our environment is correct!
    $ftp-&gt;set_croak &#40;0&#41;;

    if &#40; $psv_mode eq &#34;P&#34; &#41; {
       ok &#40; 1, &#34;Using PASV mode for data connections&#34; &#41;;
    } else {
       my $t = $ftp-&gt;force_epsv &#40;1&#41;;
       $psv_mode = $t ? &#34;1&#34; : &#34;2&#34;;
       $t = $ftp-&gt;force_epsv &#40;2&#41;  unless &#40; $t &#41;;
       ok &#40; $t, &#34;Force Extended Passive Mode &#40;EPSV $psv_mode&#41;&#34; &#41;;
       unless &#40; $t &#41; {
          --$skipper;
          skip &#40; &#34;EPSV not supported, please rerun test using PASV instead!&#34;, $skipper &#41;;
       }
    }

    # Ask for the user&#39;s HOME dir if it&#39;s not provided!
    $dir = $ftp-&gt;pwd &#40;&#41;  unless &#40;$dir&#41;;

    # -------------------------------------------------------------------------
    # Back to processing the real test cases ...
    # -------------------------------------------------------------------------
    ok&#40; $ftp-&gt;cwd&#40; $dir &#41;, &#34;Changed the dir to $dir&#34; &#41;;
    my $pwd = $ftp-&gt;pwd&#40;&#41;;
    ok&#40; defined $pwd, &#34;Getting the directory: &#40;$pwd&#41;&#34; &#41;;
    $dir = $pwd  if &#40;defined $pwd&#41;;     # Convert relative to absolute path.

    my $res = $ftp-&gt;cdup &#40;&#41;;
    $pwd = $ftp-&gt;pwd&#40;&#41;;
    ok &#40; $res, &#34;Going up one level: &#40;$pwd&#41;&#34; &#41;;

    # $res = $ftp-&gt;cwd &#40; $dir &#41;;
    # $pwd = $ftp-&gt;pwd&#40;&#41;;
    # ok &#40; $res, &#34;Returning to proper dir: &#40;$pwd&#41;&#34; &#41;;

    ok&#40; $ftp-&gt;noop&#40;&#41;, &#34;Noop test&#34; &#41;;

    my @lst;
    @lst = $ftp-&gt;nlst &#40;&#41;;
    ok&#40; scalar @lst != 0, &#39;nlst&#40;&#41; command&#39; &#41;;
    print_result &#40;\@lst&#41;;

    @lst = $ftp-&gt;list &#40;&#41;;
    ok&#40; scalar @lst != 0, &#39;list&#40;&#41; command&#39; &#41;;
    print_result &#40;\@lst&#41;;

    # -----------------------------------------
    # Closing the connection ...
    # -----------------------------------------

    ok&#40; $ftp-&gt;quit&#40;&#41;, &#39;quit&#40;&#41; command&#39; &#41;;

    # Free so any context messages will still appear in the log file.
    $ftp = undef;

    # Restore STDERR now that the tests are done!
    open &#40;STDERR, &#34;&gt;&#38;OLDERR&#34;&#41;;
    if &#40;1 == 2&#41; {
       print OLDERR &#34;\n&#34;;   # Perl gives warning if not present!  &#40;Not executed&#41;
    }
}

# =====================================================================
# Start of subroutines ...
# =====================================================================

# Does an automatic shift to upper case for all answers
sub ask {
  my $question = shift;
  my $default  = uc &#40;shift&#41;;
  my $values   = uc &#40;shift&#41;;

  my $answer = uc &#40;prompt &#40;$question, $default, $values&#41;&#41;;

  if &#40; $values &#38;&#38; $answer !~ m/^$values$/ &#41; {
     $answer = $default;   # Change invalid value to default answer!
  }

  # diag &#40;&#34;ANS: [$answer]&#34;&#41;;

  return $answer;
}

# This version doesn&#39;t do an automatic upshift
# Also provides a way to enter &#34;&#34; as a valid value!
# The Alternate Default is from an optional environment variable
sub ask2 {
  my $question = shift;
  my $default  = shift || &#34;&#34;;
  my $values   = shift || &#34;&#34;;
  my $altdef   = shift || $default;

  my $answer = prompt &#40;$question, $altdef, $values&#41;;

  if &#40; $answer =~ m/^\s+$/ &#41; {
     $answer = &#34;&#34;;         # Overriding any defaults ...
  } elsif &#40; $values &#38;&#38; $answer !~ m/^$values$/ &#41; {
     $answer = $altdef;    # Change invalid value to default answer!
  }

  # diag &#40;&#34;ANS2: [$answer]&#34;&#41;;

  return $answer;
}

sub ask_yesno {
  my $question = shift;

  my $answer = prompt &#40;$question, &#34;N&#34;, &#34;&#40;Y|N&#41;&#34;&#41;;

  # diag &#40;&#34;ANS-YN: [$answer]&#34;&#41;;

  return $answer =~ /^y&#40;es&#41;*$/i ? 1 : 0;
}

# Save the results from the list&#40;&#41; &#38; nlst&#40;&#41; calls.
# Remember that STDERR should be redirected to a log file by now.
sub print_result {
   my $lst = shift;

   # Tell the max number of entries you may print out.
   # Just in case the list is huge!
   my $cnt = 5;

   my $max = scalar &#40;@{$lst}&#41;;
   print STDERR &#34;------------- Found $max file&#40;s&#41; -----------------\n&#34;;
   foreach &#40;@{$lst}&#41; {
      if &#40;$cnt &lt;= 0&#41; {
         print STDERR &#34;...\n&#34;;
         print STDERR &#34;&#40;$lst-&gt;[-1]&#41;\n&#34;;
         last;
      }
      print STDERR &#34;&#40;$_&#41;\n&#34;;
      --$cnt;
   }
   print STDERR &#34;-----------------------------------------------\n&#34;;
}


# Based on ExtUtils::MakeMaker::prompt
# &#40;can&#39;t use since &#34;make test&#34; doesn&#39;t display questions!&#41;

sub prompt {
   my &#40;$question, $def, $opts&#41; = &#40;shift, shift, shift&#41;;

   my $isa_tty = -t STDIN &#38;&#38; &#40;-t STDOUT || !&#40;-f STDOUT || -c STDOUT&#41;&#41;;

   my $dispdef = defined $def ? &#34;[$def] &#34; : &#34; &#34;;
   $def = defined $def ? $def : &#34;&#34;;

   if &#40;defined $opts &#38;&#38; $opts !~ m/^\s*$/&#41; {
      diag &#40;&#34;\n$question ? $opts $dispdef&#34;&#41;;
   } else {
      diag &#40;&#34;\n$question ? $dispdef&#34;&#41;;
   }

   my $ans;
   if &#40; $ENV{PERL_MM_USE_DEFAULT} || &#40;!$isa_tty &#38;&#38; eof STDIN&#41;&#41; {
      diag &#40;&#34;$def\n&#34;&#41;;
   } else {
      $ans = &lt;STDIN&gt;;
      chomp &#40;$ans&#41;;
      unless &#40;defined $ans&#41; {
         diag &#40;&#34;\n&#34;&#41;;
      }
   }

   $ans = $def  unless &#40;$ans&#41;;

   return &#40; $ans &#41;;
}


# vim:ft=perl:

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;19&nbsp;22:26:20&nbsp;2011</span>
    <span class="description">CLEACH [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;19&nbsp;22:26:20&nbsp;2011</span>
    <span class="description">CLEACH [...] cpan.org -  Fixed in 0.19 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
