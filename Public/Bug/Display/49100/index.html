<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #49100 for Sys-Syslog: Sys::Syslog crash  a forked process when writing to STDERR</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #49100 for Sys-Syslog: Sys::Syslog crash  a forked process when writing to STDERR</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Sys-Syslog">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Sys-Syslog">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Sys-Syslog">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Sys-Syslog">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sys-Syslog">Sys-Syslog CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">49100</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Sys-Syslog">Sys-Syslog</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
fabrice [...] dulaunoy.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-30616-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30617-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




master.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/654907/335793/master.pl">
Fri Aug 28 12:05:50 2009 (320b) by fabrice [...] dulaunoy.com
</a>
</font></li>
</ul>


sub_fork.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/654907/335790/sub_fork.pl">
Fri Aug 28 12:05:50 2009 (303b) by fabrice [...] dulaunoy.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=49100">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-654907" href="/Public/Bug/Display.html?id=49100#txn-654907">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;28&nbsp;12:05:49&nbsp;2009</span>
    <span class="description">fabrice [...] dulaunoy.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Sys::Syslog crash  a forked process when writing to STDERR</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/654907/335787/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/335787">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 514b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When forking a process and using Sys::Syslog, any output to STDERR in
the child crash the process.
Closing STDERR and re-opening to /dev/null prevent the crash.
Attached 2 files code experiencing the trouble.
The 2 files must be in the same folder.
Start &#39;master.pl&#39; look in the log and the child die when the process
write to STDERR.
Uncommenting line 10 and 11 in sub_fork.pl prevent the crash.
Probably related to perror in the module.
The module Unix::Syslog don&#39;t present the same trouble.

Bests regards.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> sub_fork.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/654907/335790/sub_fork.pl">Download sub_fork.pl</a><br />
<span class="downloadcontenttype">text/x-perl 303b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use Sys::Syslog qw&#40;:standard :macros&#41;;

openlog&#40; &#34;TEST&#34;, &#34;ndelay,pid&#34;, &#34;local7&#34; &#41;;

# close STDERR;
# open STDERR, &#34;&gt;/dev/null&#34;;

while &#40; 1 &#41;
{
    syslog&#40; LOG_INFO, &#39;new loop in forked &#40;$name&#41; at &#39; . time &#41;;
    print STDERR &#34; force error\n&#34;;
    sleep 1;
}
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> master.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/654907/335793/master.pl">Download master.pl</a><br />
<span class="downloadcontenttype">text/x-perl 320b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use IPC::Open3;

use Sys::Syslog qw&#40;:standard :macros&#41;;

openlog&#40; &#34;TEST&#34;, &#34;ndelay,pid&#34;, &#34;local7&#34; &#41;;

my $CMD  = &#39;./sub_fork.pl&#39;;


$SIG{ CHLD } = &#39;IGNORE&#39;;
open3&#40; undef, undef, undef, $CMD &#41;;

while &#40; 1 &#41;
{
    syslog&#40; LOG_INFO, &#39;new loop master at &#39; . time &#41;;
    sleep 1;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-924755" href="/Public/Bug/Display.html?id=49100#txn-924755">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;18&nbsp;09:35:09&nbsp;2011</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #49100] Sys::Syslog crash  a forked process when writing to STDERR </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Apr 2011 15:35:13 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/924755/479816/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/479816">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 822b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Apologies for the long delay before answering.


Fabrice DULAUNOY wrote via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When forking a process and using Sys::Syslog, any output to STDERR in
&gt; the child crash the process.
&gt; Closing STDERR and re-opening to /dev/null prevent the crash.
&gt; Attached 2 files code experiencing the trouble.
&gt; The 2 files must be in the same folder.
&gt; Start &#39;master.pl&#39; look in the log and the child die when the process
&gt; write to STDERR.
&gt; Uncommenting line 10 and 11 in sub_fork.pl prevent the crash.
&gt; Probably related to perror in the module.
&gt; The module Unix::Syslog don&#39;t present the same trouble.
</div>

Allow me to question the use of open3&#40;&#41; with undef filehandles. I  
don&#39;t see how this can work.
Using filehandles, your examples don&#39;t crash here.


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-924758" href="/Public/Bug/Display.html?id=49100#txn-924758">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;18&nbsp;09:35:10&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-925774" href="/Public/Bug/Display.html?id=49100#txn-925774">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;20&nbsp;11:01:49&nbsp;2011</span>
    <span class="description">fabrice [...] dulaunoy.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #49100] Sys::Syslog crash  a forked process when writing to STDERR</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Apr 2011 17:02:44 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> DULAUNOY Fabrice &lt;fabrice [...] dulaunoy.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/925774/480377/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/480377">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 18 Apr 2011 09:35:10 -0400
&#34;SÃ©bastien Aperghis-Tramoni via RT&#34; &lt;bug-Sys-Syslog@rt.cpan.org&gt; wrote:

Mister Aperghis-Tramoni,

The small example was a little &#34;extreme&#34;.

In my code the file-handles &#40; specifically the STDERR &#41; is dynamically allocated. &#40; some fork use the STDERR, some not &#41;

What is strange is that if the STDOUT is undef and I write in STDOUT from the child, the process don&#39;t crash.
But for STDERR it crash.

It is that difference between STDERR and STDOUT that is bothering me.

Best regards 



 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=49100">https://rt.cpan.org/Ticket/Display.html?id=49100</a></span> &gt;
&gt; 
&gt; Hello,
&gt; 
&gt; Apologies for the long delay before answering.
&gt; 
&gt; 
&gt; Fabrice DULAUNOY wrote via RT:
&gt; 
<div class="message-stanza open">&gt; &gt; When forking a process and using Sys::Syslog, any output to STDERR in
&gt; &gt; the child crash the process.
&gt; &gt; Closing STDERR and re-opening to /dev/null prevent the crash.
&gt; &gt; Attached 2 files code experiencing the trouble.
&gt; &gt; The 2 files must be in the same folder.
&gt; &gt; Start &#39;master.pl&#39; look in the log and the child die when the process
&gt; &gt; write to STDERR.
&gt; &gt; Uncommenting line 10 and 11 in sub_fork.pl prevent the crash.
&gt; &gt; Probably related to perror in the module.
&gt; &gt; The module Unix::Syslog don&#39;t present the same trouble.
</div>&gt; 
&gt; 
&gt; Allow me to question the use of open3&#40;&#41; with undef filehandles. I  
&gt; don&#39;t see how this can work.
&gt; Using filehandles, your examples don&#39;t crash here.
&gt; 
&gt; 
&gt; -- 
&gt; SÃ©bastien Aperghis-Tramoni
&gt; 
&gt; Close the world, txEn eht nepO.
&gt; 
&gt; 
</div>

-- 
     +-----------------------------------------------------+
    /             |\      _,,,---,,_                      /|
   /              /,`.-&#39;`&#39;    -.  ;-;;,_                 / |
  /              |,4-  &#41; &#41;-,_. ,\ &#40;  `&#39;-&#39;               /  |
 /             &#39;---&#39;&#39;&#40;_/--&#39;  `-&#39;\_&#41;                    /   |
+-----------------------------------------------------+    |
|                Dulaunoy  Fabrice                    |    |
|                                                     |    |
| e-mail           : fabrice@dulaunoy.com             |    |
|                  : fabrice.dulaunoy@cegeka.be       |    |
|                                                     |    /
| PGP fingerprint  :                                  |   /
| 9DD6 37BA D868 8F26 5283  CFA9 E9B3 49D8 7AC1 7E57  |  /
|               Unix *is* userfriendly.               | /
| It&#39;s just selective which users it is friendly to.  |/
+-----------------------------------------------------+
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-926575" href="/Public/Bug/Display.html?id=49100#txn-926575">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;21&nbsp;19:18:37&nbsp;2011</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #49100] Sys::Syslog crash  a forked process when writing to STDERR</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Apr 2011 01:18:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/926575/480809/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/480809">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 748b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fabrice Dulaunoy wrote via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The small example was a little &#34;extreme&#34;.
&gt;
&gt; In my code the file-handles &#40; specifically the STDERR &#41; is  
&gt; dynamically allocated. &#40; some fork use the STDERR, some not &#41;
&gt;
&gt; What is strange is that if the STDOUT is undef and I write in  
&gt; STDOUT from the child, the process don&#39;t crash.
&gt; But for STDERR it crash.
</div>
I am unable to reproduce this with the various versions of Perl I  
have by hand, using allocated of undef filehandles with open3&#40;&#41;. What  
is your version of Perl?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It is that difference between STDERR and STDOUT that is bothering me.
</div>

There are some well-known differences between these streams WRT tie&#40;&#41; 
ing, for example.


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119898" href="/Public/Bug/Display.html?id=49100#txn-1119898">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;08:25:27&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #49100] Sys::Syslog crash  a forked process when writing to STDERR</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 14 Sep 2012 14:25:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119898/589136/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589136">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 748b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Taking a new look on this ticket, I saw that I can indeed reproduce the problem, but Sys::Syslog can be removed from the equation and the problem still occurs. Which really means that the root cause is because the file handles are all undefined. And indeed, searching on Perl RT reveals the following tickets:

- IPC::Open3 doesn&#39;t vivify an err filehandle
  Â» <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/rt3/Ticket/Display.html?id=31738">https://rt.perl.org/rt3/Ticket/Display.html?id=31738</a></span>

- IPC::Open3 does not auto-create an error handle
  Â» <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/rt3/Ticket/Display.html?id=55570">https://rt.perl.org/rt3/Ticket/Display.html?id=55570</a></span>

The documentation has been updated to reflect that you must explicitly provide a valid file handle for STDERR.
  Â» <span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/IPC/Open3.html">http://perldoc.perl.org/IPC/Open3.html</a></span>


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119901" href="/Public/Bug/Display.html?id=49100#txn-1119901">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;08:27:09&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119902" href="/Public/Bug/Display.html?id=49100#txn-1119902">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;08:27:09&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Broken in 0.22 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119903" href="/Public/Bug/Display.html?id=49100#txn-1119903">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;08:27:09&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Broken in 0.27 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.471023</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
