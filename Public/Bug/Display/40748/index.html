<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40748 for CGI: Needs Test, Patch: when autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40748 for CGI: Needs Test, Patch: when autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/leejo/CGI.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI">CGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40748</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI/Active/">CGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
vindex [...] apartia.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-230860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;11:41:57&nbsp;2008</span>
    <span class="description">vindex [...] apartia.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> when autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works &#40;does nothing&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">after calling autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works &#40;does nothing&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;29&nbsp;23:25:22&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;29&nbsp;23:25:56&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 07 11:41:57 2008, vindex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; after calling autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works &#40;does nothing&#41;
</div>
I agree this sounds like a bug. To proceed, next we&#39;ll need an automated
test which illustrates the bug, and then a patch to fix it. 

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;29&nbsp;23:25:58&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;29&nbsp;23:26:33&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Subject changed from &#39;when autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works &#40;does nothing&#41;&#39; to &#39;Needs Test, Patch: when autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;30&nbsp;15:26:15&nbsp;2009</span>
    <span class="description">BUBAFLUB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I agree this sounds like a bug. To proceed, next we&#39;ll need an automated
&gt; test which illustrates the bug, and then a patch to fix it. 
&gt; 
&gt;    Mark
</div>
I have a series of commits today that make an automated test for this
issue
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/bubaflub/CGI.pm/commit/ce4e3b9e0c6e04251a2dc77539967a8a81b1e0f2">http://github.com/bubaflub/CGI.pm/commit/ce4e3b9e0c6e04251a2dc77539967a8a81b1e0f2</a></span>
is the latest&#41;.  However, I&#39;m not sure what the expected functionality
is: both autoEscape&#40;undef&#41; and autoEscape&#40;0&#41; disable all future direct
invocations of escapeHTML&#40;&#41;.  Is that expected?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;30&nbsp;22:17:32&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Aug 30 15:26:15 2009, BUBAFLUB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;
&gt; &gt; I agree this sounds like a bug. To proceed, next we&#39;ll need an
</div>&gt; automated
<div class="message-stanza open">&gt; &gt; test which illustrates the bug, and then a patch to fix it.
&gt; &gt;
&gt; &gt;    Mark
</div>&gt; 
&gt; I have a series of commits today that make an automated test for this
&gt; issue
&gt;
</div>&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/bubaflub/CGI.pm/commit/ce4e3b9e0c6e04251a2dc77539967a8a81b1e0f2">http://github.com/bubaflub/CGI.pm/commit/ce4e3b9e0c6e04251a2dc77539967a8a81b1e0f2</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; is the latest&#41;.  However, I&#39;m not sure what the expected functionality
&gt; is: both autoEscape&#40;undef&#41; and autoEscape&#40;0&#41; disable all future direct
&gt; invocations of escapeHTML&#40;&#41;.  Is that expected?
</div>
The docs only say: 
&#34;To turn autoescaping off completely, use autoEscape&#40;0&#41;&#34;

But the logical behavior seems to be that this should only set the
default, and that escapeHTML&#40;&#41; could always escapeHTML&#40;&#41; regardless of
this setting. So, that&#39;s my opinion of how this should be patched. The
docs should be clarified as well. 

We run this change by Lincoln to confirm his intent.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;31&nbsp;21:45:54&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">bubaflub,

Does this give you what you need to proceed with the final changes?

On Sun Aug 30 22:17:32 2009, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Aug 30 15:26:15 2009, BUBAFLUB wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; I agree this sounds like a bug. To proceed, next we&#39;ll need an
</div>&gt; &gt; automated
<div class="message-stanza open">&gt; &gt; &gt; test which illustrates the bug, and then a patch to fix it.
&gt; &gt; &gt;
&gt; &gt; &gt;    Mark
</div>&gt; &gt;
&gt; &gt; I have a series of commits today that make an automated test for
</div>&gt; this
<div class="message-stanza open">&gt; &gt; issue
&gt; &gt;
</div>&gt;
</div>&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/bubaflub/CGI.pm/commit/ce4e3b9e0c6e04251a2dc77539967a8a81b1e0f2">http://github.com/bubaflub/CGI.pm/commit/ce4e3b9e0c6e04251a2dc77539967a8a81b1e0f2</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; is the latest&#41;.  However, I&#39;m not sure what the expected
</div>&gt; functionality
<div class="message-stanza open">&gt; &gt; is: both autoEscape&#40;undef&#41; and autoEscape&#40;0&#41; disable all future
</div>&gt; direct
<div class="message-stanza open">&gt; &gt; invocations of escapeHTML&#40;&#41;.  Is that expected?
</div>&gt; 
&gt; The docs only say:
&gt; &#34;To turn autoescaping off completely, use autoEscape&#40;0&#41;&#34;
&gt; 
&gt; But the logical behavior seems to be that this should only set the
&gt; default, and that escapeHTML&#40;&#41; could always escapeHTML&#40;&#41; regardless of
&gt; this setting. So, that&#39;s my opinion of how this should be patched. The
&gt; docs should be clarified as well.
&gt; 
&gt; We run this change by Lincoln to confirm his intent.
&gt; 
&gt;     Mark
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;01&nbsp;12:22:31&nbsp;2009</span>
    <span class="description">BUBAFLUB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Needs Test, Patch: when autoEscape&#40;undef&#41; escapeHTML&#40;&#41; no longer
 works</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just to confirm, the autoEscape&#40;undef&#41; should turn off the auto-escaping
but a direct call to escapeHTML&#40;&#41; should still work, correct?

If so, all I have to do is every time escapeHTML is called internally
&#40;as part of the auto-escaping&#41; check if the flag has been set rather
than &#40;what is done currently&#41; checking inside the escapeHTML function.

On Mon Aug 31 21:45:54 2009, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; bubaflub,
&gt; 
&gt; Does this give you what you need to proceed with the final changes?
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;01&nbsp;12:55:18&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 01 12:22:31 2009, BUBAFLUB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Just to confirm, the autoEscape&#40;undef&#41; should turn off the auto-escaping
&gt; but a direct call to escapeHTML&#40;&#41; should still work, correct?
</div>
Correct.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If so, all I have to do is every time escapeHTML is called internally
&gt; &#40;as part of the auto-escaping&#41; check if the flag has been set rather
&gt; than &#40;what is done currently&#41; checking inside the escapeHTML function.
</div>
Thanks for preparing this patch.

  Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;01&nbsp;16:26:21&nbsp;2009</span>
    <span class="description">BUBAFLUB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t suppose there is any &#34;easier&#34; or more elegant way?  Is there
anyway to distinguish when escapeHTML is being called internally in
CGI.pm and when it&#39;s being called on it&#39;s own?  There are around 30
instances of escapeHTML being called in internal functions.  If not I&#39;ll
just tag every line &#40;that has escapeHTML&#40;&#41; in it&#41; with an if statement
checking if $self-&gt;{&#39;escape&#39;} is set.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; If so, all I have to do is every time escapeHTML is called internally
&gt; &gt; &#40;as part of the auto-escaping&#41; check if the flag has been set rather
&gt; &gt; than &#40;what is done currently&#41; checking inside the escapeHTML function.
</div>&gt; 
&gt; Thanks for preparing this patch.
&gt; 
&gt;   Mark
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;01&nbsp;21:45:11&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 01 16:26:21 2009, BUBAFLUB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t suppose there is any &#34;easier&#34; or more elegant way?  Is there
&gt; anyway to distinguish when escapeHTML is being called internally in
&gt; CGI.pm and when it&#39;s being called on it&#39;s own?  There are around 30
&gt; instances of escapeHTML being called in internal functions.  If not I&#39;ll
&gt; just tag every line &#40;that has escapeHTML&#40;&#41; in it&#41; with an if statement
&gt; checking if $self-&gt;{&#39;escape&#39;} is set.
</div>
So, to clarify, autoescape&#40;&#41; should control whether or not CGI.pm
functions escape internally. Any direct call to escapeHTML should always
escapeHTML, as you would expect. 

If we are on the same page, then perhaps this is another way to approach
it. 

Internal functions could call _maybe_escapeHTML&#40;&#41;.

This logic from escapeHTML would be moved there:

    return $toencode if ref&#40;$self&#41; &#38;&#38; !$self-&gt;{&#39;escape&#39;};

Then, _maybe_escapeHTML&#40;&#41; can a have a little internal code comment
explaining what&#39;s going on. 

To me that seems a little cleaner than adding &#34;if&#34; blocks everywhere we
call escapeHTML&#40;&#41; internally. 

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;02&nbsp;00:48:55&nbsp;2009</span>
    <span class="description">BUBAFLUB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My last two commits fix this as well as add two more tests to make sure
this happens.  I realized I had also clobbered your formatting of that
function &#40;because I didn&#39;t do this work on a branch... whoops&#41;.

<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/bubaflub/CGI.pm/commit/d3015f3626d71267657c4582df5ef7cff0c5c127">http://github.com/bubaflub/CGI.pm/commit/d3015f3626d71267657c4582df5ef7cff0c5c127</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; So, to clarify, autoescape&#40;&#41; should control whether or not CGI.pm
&gt; functions escape internally. Any direct call to escapeHTML should always
&gt; escapeHTML, as you would expect. 
&gt; 
&gt; If we are on the same page, then perhaps this is another way to approach
&gt; it. 
&gt; 
&gt; Internal functions could call _maybe_escapeHTML&#40;&#41;.
&gt; 
&gt; This logic from escapeHTML would be moved there:
&gt; 
&gt;     return $toencode if ref&#40;$self&#41; &#38;&#38; !$self-&gt;{&#39;escape&#39;};
&gt; 
&gt; Then, _maybe_escapeHTML&#40;&#41; can a have a little internal code comment
&gt; explaining what&#39;s going on. 
&gt; 
&gt; To me that seems a little cleaner than adding &#34;if&#34; blocks everywhere we
&gt; call escapeHTML&#40;&#41; internally. 
&gt; 
&gt;    Mark
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;02&nbsp;09:45:30&nbsp;2009</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40748] Needs Test, Patch: when autoscape&#40;undef&#41; escapeHTML&#40;&#41; no longer works</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 2 Sep 2009 09:45:08 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI.pm [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 02 Sep 2009 00:48:56 -0400
&#34;Robert Kuo via RT&#34; &lt;bug-CGI.pm@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: CGI.pm
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=40748">https://rt.cpan.org/Ticket/Display.html?id=40748</a></span> &gt;
&gt; 
&gt; My last two commits fix this as well as add two more tests to make sure
&gt; this happens.  I realized I had also clobbered your formatting of that
&gt; function &#40;because I didn&#39;t do this work on a branch... whoops&#41;.
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/bubaflub/CGI.pm/commit/d3015f3626d71267657c4582df5ef7cff0c5c127">http://github.com/bubaflub/CGI.pm/commit/d3015f3626d71267657c4582df5ef7cff0c5c127</a></span>
</div>
Thanks, and don&#39;t worry about the formatting. I&#39;ll try to get this reviewed
and integrated in the next 48 hours.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;02&nbsp;22:51:42&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, this is now patched in my github repo now. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;03&nbsp;08:28:14&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;09&nbsp;22:07:18&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Thanks, released</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The patch for this ticket has now been released in CGI.pm 3.47, and this
ticket is considered resolved. 

Thanks again for you help to improve CGI.pm!

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;09&nbsp;22:07:19&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;09&nbsp;22:07:19&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;14:29:28&nbsp;2014</span>
    <span class="description">The RT System itself -  Queue changed from CGI.pm to CGI</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
