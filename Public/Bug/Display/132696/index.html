<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #132696 for Curses-UI-Grid: Off-by-one errors in grid-demo.pl and Grid.pm</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #132696 for Curses-UI-Grid: Off-by-one errors in grid-demo.pl and Grid.pm</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Curses-UI-Grid/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Curses-UI-Grid/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Curses-UI-Grid/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Curses-UI-Grid/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Curses-UI-Grid">Curses-UI-Grid CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">132696</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Curses-UI-Grid/Active/">Curses-UI-Grid</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Matthew.Buchanan [...] Mercy.Net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8808-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8809-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;24&nbsp;18:49:16&nbsp;2020</span>
    <span class="description">Matthew.Buchanan [...] Mercy.Net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Off-by-one errors in grid-demo.pl and Grid.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 24 May 2020 22:48:01 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Curses-UI-Grid [...] rt.cpan.org&#34; &lt;bug-Curses-UI-Grid [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Buchanan, Matt&#34; &lt;Matthew.Buchanan [...] Mercy.Net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

There are multiple, related off-by-one errors in grid-demo.pl and 
Grid.pm.  Correcting the errors in grid-demo.pl exposes the error in
Grid.pm.

&#40;1&#41; grid-demo.pl&#39;s Browser demo does not display the last element of 
    @data.  The patch below updates -onnextpage, -onprevpage, and
    fill_data&#40;&#41; to resolve this problem.

&#40;2&#41; After making these corrections to grid-demo.pl, under certain 
    conditions the program will abort with this message:

    Can&#39;t call method &#34;event_onfocus&#34; without a package or object 
    reference at Curses-UI-Grid-0.15/examples/../lib/Curses/UI/Grid.pm
    line 1310.

    The abort occurs when &#40;scalar @data&#41; % $grid-&gt;page_size == 1, so to
    reproduce it one can change the Browser demo grid&#39;s height from 20
    to 10 &#40;for a page size of 8&#41; or run the program on a 24-row terminal
    &#40;actual grid height will be 18, for a page size of 16&#41;.  With 49
    elements in @data, the last page will display one row of data.  To
    trigger the abort, use KEY_DOWN to move from the next-to-last page
    to the last page.

    The problem appears to be that Grid::get_last_row&#40;&#41; stops searching
    one row too early.  The patch below resolves the problem.

These errors occur on multiple Perl versions and operating systems:

Curses-UI-Grid-0.15
Perl 5.24.4 on OpenBSD 6.4
Perl 5.30.2 on AIX 7.2.3.3

Thanks for your attention.

M. B. Buchanan
Mercy Technology Services


diff -ur grid-demo.pl.orig grid-demo.pl
--- grid-demo.pl.orig 2008-05-05 01:18:34.000000000 -0500
+++ grid-demo.pl  2020-05-24 15:02:14.000000000 -0500
@@ -211,7 +211,7 @@

            my $row=$grid-&gt;get_foused_row;
            my $offset=$pgsize*$grid-&gt;page&#40;$pg+1&#41;;
-           if&#40;$offset &lt; $#data&#41; {
+           if&#40;$offset &lt;= $#data&#41; {
                                fill_data&#40;$offset,$pgsize,\@data,$grid &#41;;
            } else { $grid-&gt;page&#40;$pg&#41;;return 0; }
            my $last_row=$grid-&gt;get_foused_row;
@@ -224,7 +224,7 @@
            my &#40;$pgsize,$pg&#41;=&#40;$grid-&gt;page_size,$grid-&gt;page&#41;;
            return 0 unless $pg;
            my $offset=$pgsize*$grid-&gt;page&#40;$pg-1&#41;;
-           if&#40;$offset &lt; $#data&#41; {
+           if&#40;$offset &lt;= $#data&#41; {
                fill_data&#40;$offset,$pgsize,\@data,$grid &#41;;
            } else { $grid-&gt;page&#40;$pg&#41;;return 0;}
            return $grid;
@@ -344,11 +344,11 @@
  my $data=shift;
  my $grid=shift;

-     for my $i &#40;0 .. $limit&#41; {
+     for my $i &#40;0 .. $limit-1&#41; {
            my $row=$grid-&gt;get_row&#40; $grid-&gt;{_rows}[$i+1] &#41;;
          next unless ref&#40;$row&#41;;

-         if&#40;$#{$data} &lt;= $offset+$i&#41; {
+         if&#40;$#{$data} &lt; $offset+$i&#41; {
            $row-&gt;hide;
            $row-&gt;{-focusable}=0;
            next;

diff -ur Grid.pm.orig Grid.pm
--- Grid.pm.orig 2008-06-09 07:56:01.000000000 -0500
+++ Grid.pm  2020-05-24 14:59:40.000000000 -0500
@@ -1355,7 +1355,7 @@
  sub get_last_row {
      my $this = shift;
      my $rows = $this-&gt;_rows;
-     for &#40;my $i = $#{$rows}; $i &gt; 1; $i--&#41; {
+     for &#40;my $i = $#{$rows}; $i &gt; 0; $i--&#41; {
          my $row = $this-&gt;get_row&#40;$rows-&gt;[$i]&#41;;
          return $row  if &#40;$row-&gt;focusable &#38;&#38; ! $this-&gt;hidden&#41;;
      }



This electronic mail and any attached documents are intended solely for the named addressee&#40;s&#41; and contain confidential information. If you are not an addressee, or responsible for delivering this email to an addressee, you have received this email in error and are notified that reading, copying, or disclosing this email is prohibited. If you received this email in error, immediately reply to the sender and delete the message completely from your computer system.
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
