<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70018 for Catalyst-Action-REST: Order of serializer type determination</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70018 for Catalyst-Action-REST: Order of serializer type determination</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-Action-REST/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Action-REST">Catalyst-Action-REST CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70018</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-Action-REST/Active/">Catalyst-Action-REST</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rich.harkins [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-41594-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41595-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;11:39:21&nbsp;2011</span>
    <span class="description">rich.harkins [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Order of serializer type determination</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s possible I may be missing something but I&#39;ve read through all the
RFCs I could find on this topic and this seems to be a requirements bug.

According to the docs and the source code &#40;0.91&#41;, the serializer is
chosen based on the incoming &#40;request&#41; content type at a higher priority
than the Accept header to determine which serializer to use.  In the
case of POST, PUT, etc, the request content-type header will indicate
the content type of the incoming post data, typically,
&#34;application/x-www-form-urlencoded&#34; &#40;RFC 2616 [1]&#41;, not the desired
content type of the returned data.  In essence, it&#39;s unclear whether the
request content-type header should be consulted at all for selecting a
serializer, but certainly it appears that the Accept header should win
over it.

With this in place, it is nearly impossible to request JSON data via
Accept headers via Javascript without using the query string work-around.

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://tools.ietf.org/html/rfc2616#page-124">http://tools.ietf.org/html/rfc2616#page-124</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;11:43:15&nbsp;2011</span>
    <span class="description">jshirley+cpan [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 04 11:39:21 2011, rharkins wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s possible I may be missing something but I&#39;ve read through all the
&gt; RFCs I could find on this topic and this seems to be a requirements bug.
&gt; 
&gt; According to the docs and the source code &#40;0.91&#41;, the serializer is
&gt; chosen based on the incoming &#40;request&#41; content type at a higher priority
&gt; than the Accept header to determine which serializer to use.  In the
&gt; case of POST, PUT, etc, the request content-type header will indicate
&gt; the content type of the incoming post data, typically,
&gt; &#34;application/x-www-form-urlencoded&#34; &#40;RFC 2616 [1]&#41;, not the desired
&gt; content type of the returned data.  In essence, it&#39;s unclear whether the
&gt; request content-type header should be consulted at all for selecting a
&gt; serializer, but certainly it appears that the Accept header should win
&gt; over it.
&gt; 
&gt; With this in place, it is nearly impossible to request JSON data via
&gt; Accept headers via Javascript without using the query string work-around.
&gt; 
&gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="http://tools.ietf.org/html/rfc2616#page-124">http://tools.ietf.org/html/rfc2616#page-124</a></span>
</div>
To better understand, what you are saying is that you do a POST with x-www-form-
urlencoded but wish to have a response of say application/json?

&#40;In this scenario, what I do is have my POST be of content-type: application/json and serialize 
the relevant form data into JSON&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;11:43:17&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;11:48:51&nbsp;2011</span>
    <span class="description">rich.harkins [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70018] Order of serializer type determination</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Aug 2011 11:48:40 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Action-REST [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Rich Harkins &lt;rich.harkins [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is exactly the case.  I don&#39;t know of any stricture in HTTP &#40;or REST&#41;
that would normally compel me to use the same data type between POSTed data
and the desired return data.  I could be wrong here, but the HTTP specs do
not seem to indicate that the request Content-Type should be part of the
serialization decision.  However, I would understand if the
$c-&gt;response-&gt;content_type, if specified, would overrule anything else
&#40;since that would be from the processing of the request&#41;.

Thanks for the prompt reply!
Rich


On Thu, Aug 4, 2011 at 11:43 AM, J. Shirley via RT &lt;
bug-Catalyst-Action-REST@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70018">https://rt.cpan.org/Ticket/Display.html?id=70018</a></span> &gt;
&gt;
&gt; On Thu Aug 04 11:39:21 2011, rharkins wrote:
<div class="message-stanza open">&gt; &gt; It&#39;s possible I may be missing something but I&#39;ve read through all the
&gt; &gt; RFCs I could find on this topic and this seems to be a requirements bug.
&gt; &gt;
&gt; &gt; According to the docs and the source code &#40;0.91&#41;, the serializer is
&gt; &gt; chosen based on the incoming &#40;request&#41; content type at a higher priority
&gt; &gt; than the Accept header to determine which serializer to use.  In the
&gt; &gt; case of POST, PUT, etc, the request content-type header will indicate
&gt; &gt; the content type of the incoming post data, typically,
&gt; &gt; &#34;application/x-www-form-urlencoded&#34; &#40;RFC 2616 [1]&#41;, not the desired
&gt; &gt; content type of the returned data.  In essence, it&#39;s unclear whether the
&gt; &gt; request content-type header should be consulted at all for selecting a
&gt; &gt; serializer, but certainly it appears that the Accept header should win
&gt; &gt; over it.
&gt; &gt;
&gt; &gt; With this in place, it is nearly impossible to request JSON data via
&gt; &gt; Accept headers via Javascript without using the query string work-around.
&gt; &gt;
&gt; &gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="http://tools.ietf.org/html/rfc2616#page-124">http://tools.ietf.org/html/rfc2616#page-124</a></span>
</div>&gt;
&gt; To better understand, what you are saying is that you do a POST with
&gt; x-www-form-
&gt; urlencoded but wish to have a response of say application/json?
&gt;
&gt; &#40;In this scenario, what I do is have my POST be of content-type:
&gt; application/json and serialize
&gt; the relevant form data into JSON&#41;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
