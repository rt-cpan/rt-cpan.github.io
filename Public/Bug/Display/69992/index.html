<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69992 for Sys-Syslog: setlogsock&#40;&#41; and default methods</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69992 for Sys-Syslog: setlogsock&#40;&#41; and default methods</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Sys-Syslog/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Sys-Syslog/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Sys-Syslog/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Sys-Syslog/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sys-Syslog">Sys-Syslog CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69992</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Sys-Syslog/Active/">Sys-Syslog</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ntyni [...] iki.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-30616-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.29    </td>
  </tr>
  <tr id="CF-30617-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.31    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;14:52:48&nbsp;2011</span>
    <span class="description">ntyni [...] iki.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> setlogsock&#40;&#41; and default methods</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Changes to setlogsock&#40;&#41; in 0.28 made the function prepend the
requested socket types to the list of default ones instead of
overriding the default list.

This behaviour is undocumented and makes the test suite unwittingly
test unrelated socket types: for instance, it now claims &#39;tcp&#39; is fully
working even when &#34;syslog/tcp&#34; cannot be resolved and there is no TCP
listener on the system.

It also makes it impossible to spot things like a missing UDP receiver,
as openlog&#40;&#41; will silently fall back to the native logging method.

Please consider the attached patch that reverts this behaviour change
and augments the test suite. The patch context requires the one in
[rt.cpan.org #69986] to be applied, but this should be easily resolvable
should you decide to reject that one.

Thanks for your work on Sys-Syslog,
-- 
Niko Tyni
ntyni@debian.org
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Only-use-the-requested-socket-types-if-setlogsock-is.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 8a3e720a7f84248c86ade7a7898c084b0faec85b Mon Sep 17 00:00:00 2001
From: Niko Tyni &lt;ntyni@debian.org&gt;
Date: Wed, 3 Aug 2011 21:32:19 +0300
Subject: [PATCH] Only use the requested socket types if setlogsock&#40;&#41; is
 called

Changes to setlogsock&#40;&#41; in 0.28 made the function prepend the
requested socket types to the list of default ones instead of
overriding the default list.

This behaviour is undocumented and makes the test suite unwittingly
test unrelated socket types: for instance, it now claims &#39;tcp&#39; is fully
working even when &#34;syslog/tcp&#34; cannot be resolved and there is no TCP
listener on the system.

Restore the 0.27 behaviour of using only the requested socket
type&#40;s&#41; and augment the test suite to cover this.
---
 Syslog.pm  |    2 +-
 t/syslog.t |   14 ++++++++++++++
 2 files changed, 15 insertions&#40;+&#41;, 1 deletions&#40;-&#41;

diff --git a/Syslog.pm b/Syslog.pm
index 4fcedd7..bc6752f 100644
--- a/Syslog.pm
+++ b/Syslog.pm
@@ -314,7 +314,7 @@ sub setlogsock {
 
     for my $sock_type &#40;@sock_types&#41; {
         if &#40; $mechanism{$sock_type}{check}-&gt;&#40;&#41; &#41; {
-            unshift @connectMethods, $sock_type;
+            @connectMethods = &#40; $sock_type &#41;;
             $found = 1;
         }
         else {
diff --git a/t/syslog.t b/t/syslog.t
index ebc1326..90df65d 100644
--- a/t/syslog.t
+++ b/t/syslog.t
@@ -296,3 +296,17 @@ SKIP: {
     ok&#40; !$r, &#34;setlogsock failed correctly when tcp services can&#39;t be resolved&#34;&#41;;
     is&#40; $@, &#39;&#39;, &#34;setlogsock didn&#39;t croak&#34;&#41;;
 }
+
+BEGIN { $tests += 2 }
+SKIP: {
+    my $file = &#34;foobar&#34;;
+    open&#40;TST, &#34;&gt;$file&#34;&#41; or skip &#34;can&#39;t create file &#39;$file&#39;: $!&#34;, 2;
+    close&#40;TST&#41;;
+    eval { $r = setlogsock&#40;&#34;stream&#34;, $file&#41; };
+    skip &#34;can&#39;t test openlog&#40;&#41; failures with a missing stream&#34;, 2 if !$r;
+    unlink $file;
+    $r = eval { openlog&#40;&#39;perl&#39;, &#39;ndelay&#39;, &#39;local0&#39;&#41; };
+    ok&#40; !defined $r, &#34;openlog&#40;&#41; failed correctly with a nonexistent stream&#34;&#41;;
+    like&#40; $@, &#34;/not writable/&#34;, &#34;openlog&#40;&#41; croaked correctly with a nonexistent stream&#34;&#41;;
+} 
+
-- 
1.7.5.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;18&nbsp;08:29:15&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69992] setlogsock&#40;&#41; and default methods </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 18 Aug 2012 14:28:59 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sébastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Niko Tyni wrote via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Changes to setlogsock&#40;&#41; in 0.28 made the function prepend the
&gt; requested socket types to the list of default ones instead of
&gt; overriding the default list.
&gt; 
&gt; This behaviour is undocumented and makes the test suite unwittingly
&gt; test unrelated socket types: for instance, it now claims &#39;tcp&#39; is fully
&gt; working even when &#34;syslog/tcp&#34; cannot be resolved and there is no TCP
&gt; listener on the system.
&gt; 
&gt; It also makes it impossible to spot things like a missing UDP receiver,
&gt; as openlog&#40;&#41; will silently fall back to the native logging method.
&gt; 
&gt; Please consider the attached patch that reverts this behaviour change
&gt; and augments the test suite. The patch context requires the one in
&gt; [rt.cpan.org #69986] to be applied, but this should be easily resolvable
&gt; should you decide to reject that one.
</div>
I couldn&#39;t directly apply this patch because it would have prevented setlogsock&#40;&#41; from working in certain cases, but did adapt it. 

Thanks for reporting this problem, it will be fixed in version 0.31

-- 
Sébastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;18&nbsp;08:29:16&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;26&nbsp;08:19:24&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;26&nbsp;08:19:24&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Fixed in 0.31 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
