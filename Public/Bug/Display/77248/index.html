<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #77248 for Socket: Test 10 in t/getnameinfo.t fails on Solaris 11 due to /etc/hosts format</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #77248 for Socket: Test 10 in t/getnameinfo.t fails on Solaris 11 due to /etc/hosts format</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Socket">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Socket">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Socket">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Socket">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Socket">Socket CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">77248</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Socket">Socket</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ANDYD [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-29154-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.001    </td>
  </tr>
  <tr id="CF-29155-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.015    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




rt77248.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1399340/743022/rt77248.patch">
Fri Aug 15 17:51:08 2014 (1.9k) by leonerd-cpan [...] leonerd.org.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=77248">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1078653" href="/Public/Bug/Display.html?id=77248#txn-1078653">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;16&nbsp;15:32:20&nbsp;2012</span>
    <span class="description">ANDYD [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test 10 in t/getnameinfo.t fails on Solaris 11 due to /etc/hosts
 format</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1078653/567642/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/567642">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a bug report for Socket version 2.001, as distributed with
perl-5.16.0-RC2.

Test 10 in cpan/Socket/t/getnameinfo.t test is failing for Solaris
11/x86 &#40;both on my system and in the smoke reports.&#41;  I think the test
is probably in error.  Here&#39;s what&#39;s happening: My hostname is &#34;HSC030&#34;.

    $ uname -a
    SunOS HSC030 5.11 snv_151a i86pc i386 i86pc

The default Solaris 11 install puts the following lines in /etc/hosts:

    $ grep -v &#39;^#&#39; /etc/hosts
    ::1 HSC030 HSC030.local localhost loghost
    127.0.0.1 HSC030 HSC030.local localhost loghost

Here&#39;s what happens:

    $ ./perl -MTestInit cpan/Socket/t/getnameinfo.t 
    1..14
    ok 1 - $err == 0 for
{family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICHOST|NI_NUMERICSERV
    ok 2 - $err eq &#34;&#34; for
{family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICHOST|NI_NUMERICSERV
    ok 3 - $host is 127.0.0.1 for NH/NS
    ok 4 - $service is 80 for NH/NS
    ok 5 - $host is undef for NIx_NOHOST
    ok 6 - $service is 80 for NS, NIx_NOHOST
    ok 7 - $host is undef for NIx_NOSERV
    ok 8 - $service is 80 for NS, NIx_NOSERV
    ok 9 - $err == 0 for
{family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICSERV
    not ok 10 - $host is localhost for NS
    #   Failed test &#39;$host is localhost for NS&#39;
    #   at cpan/Socket/t/getnameinfo.t line 31.
    #          got: &#39;HSC030&#39;
    #     expected: &#39;localhost&#39;
    ok 11 - $service is 80 for NS
    ok 12 - $err == 0 for
{family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICHOST
    ok 13 - $host is 127.0.0.1 for NH
    ok 14 - $service is 80 for NH
    # Looks like you failed 1 test of 14.

However, if I change the last line in /etc/hosts to just

    127.0.0.1 localhost

then the test passes.  

Hence I think the getnameinfo function is working, but the /etc/hosts
file doesn&#39;t have the exact same structure as the test is expecting.
I don&#39;t know if the Solaris /etc/hosts file is strictly correct or not,
but it is what you get with a default install, so I don&#39;t think the
test suite ought to complain about it.

&#40;This failure is not new -- it&#39;s present in perl-5.14.2 -- but I just
got around to verifying that the /etc/hosts file is indeed as it was
originally set up by Solaris, and the failure isn&#39;t due to my mucking
around with /etc/hosts in some incorrect or misguided way.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1078862" href="/Public/Bug/Display.html?id=77248#txn-1078862">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;11:12:17&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1078862/567741/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/567741">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 16 15:32:20 2012, ANDYD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hence I think the getnameinfo function is working, but the /etc/hosts
&gt; file doesn&#39;t have the exact same structure as the test is expecting.
&gt; I don&#39;t know if the Solaris /etc/hosts file is strictly correct or not,
&gt; but it is what you get with a default install, so I don&#39;t think the
&gt; test suite ought to complain about it.
</div>
So, the test doesn&#39;t hardcode &#34;localhost&#34; but simply compares what getnameinfo&#40;&#41; 
returns as compared the legacy gethostbyaddr&#40;&#41; resolver on the same address:

   24 # Probably &#34;localhost&#34; but we&#39;d better ask the system to be sure
   25 my $expect_host = gethostbyaddr&#40; inet_aton&#40; &#34;127.0.0.1&#34; &#41;, AF_INET &#41;;
   26 defined $expect_host or $expect_host = &#34;127.0.0.1&#34;;
   27 
   28 &#40; $err, $host, $service &#41; = getnameinfo&#40; pack_sockaddr_in&#40; 80, inet_aton&#40; 
&#34;127.0.0.1&#34; &#41; &#41;, NI_NUMERICSERV &#41;;
   29 cmp_ok&#40; $err, &#34;==&#34;, 0, &#39;$err == 0 for 
{family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICSERV&#39; &#41;;
   30 
   31 is&#40; $host, $expect_host, &#34;\$host is $expect_host for NS&#34; &#41;;
   32 is&#40; $service, &#34;80&#34;, &#39;$service is 80 for NS&#39; &#41;;

If these are differing on your host then that suggests the two functions 
actually have different behaviour.

I&#39;m not entirely sure what to suggest in this setup. About the only test that 
would be in any way more robust would be to resolve the address into some name, 
then check the name resolves forward to the right IP address again; or at least 
the IP address was somewhere in the list. Which is starting to feel like an even 
weaker yet more complex test.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1078865" href="/Public/Bug/Display.html?id=77248#txn-1078865">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;11:12:18&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1203454" href="/Public/Bug/Display.html?id=77248#txn-1203454">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;19&nbsp;01:20:08&nbsp;2013</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1203454/635397/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/635397">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 576b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 17 11:12:17 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not entirely sure what to suggest in this setup. About the only
&gt; test that
&gt; would be in any way more robust would be to resolve the address into
&gt; some name,
&gt; then check the name resolves forward to the right IP address again; or
&gt; at least
&gt; the IP address was somewhere in the list. Which is starting to feel
&gt; like an even
&gt; weaker yet more complex test.
</div>
This test has been failing in my core smoke tests on Solaris since it was introduced &#40;in two different VMs&#41;.

A simple skip on Solaris would be an improvement.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1381862" href="/Public/Bug/Display.html?id=77248#txn-1381862">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;02&nbsp;07:49:10&nbsp;2014</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1381862/733697/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/733697">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 418b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I see no promise of getaddrinfo&#40;&#41; and gethostbyaddr&#40;&#41; results agreeing in either the SUS/POSIX spec:

<span class="clickylink"><a target="new" rel="nofollow" href="http://pubs.opengroup.org/onlinepubs/009695399/functions/getaddrinfo.html">http://pubs.opengroup.org/onlinepubs/009695399/functions/getaddrinfo.html</a></span>

or in the Linux

<span class="clickylink"><a target="new" rel="nofollow" href="http://linux.die.net/man/3/getaddrinfo">http://linux.die.net/man/3/getaddrinfo</a></span>

or in the BSD

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.freebsd.org/cgi/man.cgi?query=getaddrinfo&#38;sektion=3">http://www.freebsd.org/cgi/man.cgi?query=getaddrinfo&#38;sektion=3</a></span>

So I think the failing subtest might be just too optimistic/overspecifying, and should be sadly removed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1381911" href="/Public/Bug/Display.html?id=77248#txn-1381911">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;02&nbsp;09:21:28&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1381911/733726/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/733726">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 450b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 02 07:49:10 2014, JHI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I think the failing subtest might be just too
&gt; optimistic/overspecifying, and should be sadly removed.
</div>
:&#40;

That may end up being the only real option. It&#39;s a shame because I keep deleting more and more of the tests because they turn out not to be reliable. It&#39;s hard to come up with a test of a C-library wrapper function without effectively also testing that C library function itself.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1399340" href="/Public/Bug/Display.html?id=77248#txn-1399340">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;15&nbsp;17:51:08&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1399340/743021/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/743021">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 32b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch attached.

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt77248.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1399340/743022/rt77248.patch">Download rt77248.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;t/getnameinfo.t&#39;
--- t/getnameinfo.t	2013-10-28 00:49:08 +0000
+++ t/getnameinfo.t	2014-08-15 21:47:50 +0000
@@ -1,6 +1,6 @@
 use strict;
 use warnings;
-use Test::More tests =&gt; 14;
+use Test::More tests =&gt; 12;
 
 use Socket qw&#40;:addrinfo AF_INET pack_sockaddr_in inet_aton&#41;;
 
@@ -21,26 +21,14 @@
 is&#40; $host, &#34;127.0.0.1&#34;, &#39;$host is undef for NIx_NOSERV&#39; &#41;;
 is&#40; $service, undef, &#39;$service is 80 for NS, NIx_NOSERV&#39; &#41;;
 
-# Probably &#34;localhost&#34; but we&#39;d better ask the system to be sure
-my $expect_host = gethostbyaddr&#40; inet_aton&#40; &#34;127.0.0.1&#34; &#41;, AF_INET &#41;;
-defined $expect_host or $expect_host = &#34;127.0.0.1&#34;;
-
 &#40; $err, $host, $service &#41; = getnameinfo&#40; pack_sockaddr_in&#40; 80, inet_aton&#40; &#34;127.0.0.1&#34; &#41; &#41;, NI_NUMERICSERV &#41;;
 cmp_ok&#40; $err, &#34;==&#34;, 0, &#39;$err == 0 for {family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICSERV&#39; &#41;;
 
-is&#40; $host, $expect_host, &#34;\$host is $expect_host for NS&#34; &#41;;
-is&#40; $service, &#34;80&#34;, &#39;$service is 80 for NS&#39; &#41;;
-
-# Probably &#34;www&#34; but we&#39;d better ask the system to be sure
-my $flags = NI_NUMERICHOST;
-my $expect_service = getservbyport&#40; 80, &#34;tcp&#34; &#41;;
-unless&#40; defined $expect_service &#41; {
-    $expect_service = &#34;80&#34;;
-    $flags |= NI_NUMERICSERV; # don&#39;t seem to have a service name
-}
-
-&#40; $err, $host, $service &#41; = getnameinfo&#40; pack_sockaddr_in&#40; 80, inet_aton&#40; &#34;127.0.0.1&#34; &#41; &#41;, $flags &#41;;
-cmp_ok&#40; $err, &#34;==&#34;, 0, &#39;$err == 0 for {family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICHOST[|NI_NUMERICSERV]&#39; &#41;;
-
-is&#40; $host, &#34;127.0.0.1&#34;, &#39;$host is 127.0.0.1 for NH&#39; &#41;;
-is&#40; $service, $expect_service, &#34;\$service is $expect_service for NH&#34; &#41;;
+# We can&#39;t meaningfully compare &#39;$host&#39; with anything specific, all we can be
+# sure is it&#39;s not empty
+ok&#40; length $host, &#39;$host is nonzero length for NS&#39; &#41;;
+
+&#40; $err, $host, $service &#41; = getnameinfo&#40; pack_sockaddr_in&#40; 80, inet_aton&#40; &#34;127.0.0.1&#34; &#41; &#41;, NI_NUMERICHOST &#41;;
+cmp_ok&#40; $err, &#34;==&#34;, 0, &#39;$err == 0 for {family=AF_INET,port=80,sinaddr=127.0.0.1}/NI_NUMERICHOST&#39; &#41;;
+
+ok&#40; length $service, &#39;$service is nonzero length for NH&#39; &#41;;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1399343" href="/Public/Bug/Display.html?id=77248#txn-1399343">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;15&nbsp;17:51:09&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1400246" href="/Public/Bug/Display.html?id=77248#txn-1400246">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;17&nbsp;08:12:30&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1400246/743387/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/743387">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 34b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Released in 2.015

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1400249" href="/Public/Bug/Display.html?id=77248#txn-1400249">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;17&nbsp;08:12:35&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1400251" href="/Public/Bug/Display.html?id=77248#txn-1400251">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;17&nbsp;08:12:37&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Fixed in 2.015 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.457566</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
