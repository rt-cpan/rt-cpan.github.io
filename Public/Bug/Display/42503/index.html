<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42503 for Test-Weaken: suggest skipping &#34;permanent&#34; objects</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42503 for Test-Weaken: suggest skipping &#34;permanent&#34; objects</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Weaken">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Weaken">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Weaken">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Weaken">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Weaken">Test-Weaken CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42503</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Weaken">Test-Weaken</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jkegl [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45720-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.000000    </td>
  </tr>
  <tr id="CF-45721-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.002000    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




persist.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/560835/283166/persist.pl">
Wed Jan 28 16:34:56 2009 (995b) by user42 [...] zip.com.au
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=42503">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-555713" href="/Public/Bug/Display.html?id=42503#txn-555713">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;18&nbsp;16:18:22&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> suggest skipping &#34;permanent&#34; objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Jan 2009 08:16:35 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/555713/280243/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/280243">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 756b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">In some of my code I end up with what are basically permanent objects,
held in a cache or as constants or whatnot.  It&#39;d be nice if
Test::Weaken::poof allowed for some parts, ie. sub-objects, of the
things probed to not destruct when weakened.  &#40;Unless that works already
and I just failed to understand the docs :-&#41;

I don&#39;t know how such a thing would look.  Maybe nominated objects,
maybe determined only after the poof constructing, in some kind of hook.
Maybe all objects of a given class would be permanent sometimes.  Maybe
poof could automatically notice when an object class uses
Class::Singleton and an object ends up as its singleton instance
&#40;allowing other instances to exist too, even if that&#39;s not the normal
pattern for a singleton class&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-555826" href="/Public/Bug/Display.html?id=42503#txn-555826">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;18&nbsp;22:42:22&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/555826/280313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/280313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 999b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">In array context, poof returns the objects which did not get freed. 
&#40;see the document for details.&#41;  It is, of course, very common for an
object to contain references to &#34;permanent&#34; objects, references that
should not go away even when memory for the main object is free.  All
these &#34;permanent&#34; objects should be in the lists returned by poof&#40;&#41; in
array context.

Using poof&#40;&#41; determine if your scheme for freeing memory is correct does
become more complex in this context.  You have to examine the objects
returned by poof&#40;&#41; to see if only the &#34;right&#34; ones were left unfreed.

On the assumption that I understood the question and that this is
responsive, I&#39;m going to close this ticket.  Feel free to reopen it if I
missed the point.  Also, if you want to discuss alternatives, email me
at the cpan.org address.

I&#39;ll put rereading the Test::Weaken document on my to do list, to see if
I could make things clearer.  Perhaps the document needs a &#34;Tricks&#34;
section, pointing out some of these things.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-555827" href="/Public/Bug/Display.html?id=42503#txn-555827">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;18&nbsp;22:42:23&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-555829" href="/Public/Bug/Display.html?id=42503#txn-555829">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;18&nbsp;22:44:57&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/555829/280315/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/280315">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 166b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Responded, pointing out how to handle &#34;permanent&#34; objects using
Test::Weaken.  In future, I may revise the document to answer this
question directly and more clearly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-555831" href="/Public/Bug/Display.html?id=42503#txn-555831">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;18&nbsp;22:44:58&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-558968" href="/Public/Bug/Display.html?id=42503#txn-558968">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;23&nbsp;19:07:54&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42503] suggest skipping &#34;permanent&#34; objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Jan 2009 09:01:50 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/558968/282148/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/282148">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 677b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42503">https://rt.cpan.org/Ticket/Display.html?id=42503</a></span> &gt;
&gt;
&gt; Perhaps the document needs a &#34;Tricks&#34; section, pointing out some of
&gt; these things.
</div>
Sounds likely.  I&#39;d kinda thought of the array return as only for
diagnostics rather than post-processing.

One thing I struck was that my persistent/external/permanent etc objects
contain sub-part arrayrefs or hashrefs, normally not meant to see the
light of day of course.  Those fragments get included in the unfreed
return.  Identifying them as parts of the &#34;correctly unfreed&#34; seems a
little tedious.  But maybe there&#39;s tricks for that the docs could
mention.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-558969" href="/Public/Bug/Display.html?id=42503#txn-558969">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;23&nbsp;19:07:55&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-559248" href="/Public/Bug/Display.html?id=42503#txn-559248">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;24&nbsp;15:29:56&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/559248/282294/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/282294">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">How about a &#34;filter&#34; argument to poof&#40;&#41;?  Any reference passed to poof
will not count as unfreed.  The filtered reference would be followed
recursively, in the same manner that poof&#40;&#41; currently follows the
reference to its test object -- hashes, array and weak and strong
references would all be followed.  All references found in this
recursion would also be filtered references.  Cycles would be handled
gracefully.

The count returned by poof&#40;&#41; in scalar context will not include
references which were unfreed, but filtered.  Neither will the list of
unfreed references returned in array context.

poof&#40;&#41; will not check that its test object actually refers to any of the
filtered references.  poof&#40;&#41; will also not consider it an error if a
filtered reference is freed.  I believe this behavior follows the
principle of &#34;least surprise&#34;.  Another benefit of this behavior is
that, if multiple references need to be filtered, they can be passed as
a reference to an array of references.

The interface is now complex enough that I&#39;ll allow arguments to be
passed to poof&#40;&#41; as a hash ref.  It will allow the following named
arguments: &#34;constructor&#34;, &#34;destructor&#34; and &#34;filter&#34;.  The value of the
&#34;constructor&#34; and &#34;destructor&#34; named arguments will be coderefs, as
before.  The value of the &#34;filter&#34; named argument will be a reference
which, along with all its referents followed recursively, is to be
excluded from the unfreed counts and lists.  The old interface will
continue to be accepted.

Could you supply test cases?  As with the other bug, I want to use it
for cpantesters, so the test cases shouldn&#39;t rely on non-core modules. 
Just the bare routines are needed, I&#39;ll add my own wrappering.  If you
don&#39;t supply test cases, I&#39;ll create my own, but &#40;again&#41; the advantage
is that if you supply the test cases, we know that I&#39;ve added the
feature that you want, not just my idea of the feature you want.

thanks, jeffrey
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-559250" href="/Public/Bug/Display.html?id=42503#txn-559250">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;24&nbsp;15:31:30&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> New &#34;Tricks&#34; section in documentation</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/559250/282296/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/282296">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 76b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">In 1.001_004, I did add a &#34;Tricks&#34; section to the documentation.  -- jeffrey
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-559252" href="/Public/Bug/Display.html?id=42503#txn-559252">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;24&nbsp;15:31:40&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-560835" href="/Public/Bug/Display.html?id=42503#txn-560835">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;28&nbsp;16:34:56&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42503] suggest skipping &#34;permanent&#34; objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 29 Jan 2009 08:14:19 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/560835/283165/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/283165">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 837b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Could you supply test cases?
</div>
The couple of lines below is the sort of thing I struck.  The filter
option in this case would be a hypothetical based on my idea that all
objects of a certain class persist, instead of nominating them
individually.

I expect both by-class and individual have their use.  I could also
imagine running together a couple of filter conditions.  I guess some
&#34;||&#34;s in a func can do that, though maybe the interface could offer an
easier way.

The dump of @weaken in the code below only seems to show the arrayref
guts of MyGlobal things.  I think I got that from my real code too.  I
wasn&#39;t quite sure why the actual MyGlobal objects didn&#39;t appear in the
&#34;unfreed strong&#34; of $weaken[3].  They&#39;re still in the %cache
&#40;commented-out dump line&#41;.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/560835/283166/persist.pl">Download persist.pl</a><br />
<span class="downloadcontenttype">text/x-perl 995b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-561313" href="/Public/Bug/Display.html?id=42503#txn-561313">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;29&nbsp;14:19:05&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Follow references in permanent objects?</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/561313/283428/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/283428">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 823b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the test cases.  I&#39;ve downloaded the file and will get to
work on this.

There&#39;s an issue about whether I should follow references in a filtered
objects while checking for memory leaks.  That is, a constructor might
take a permanent object and add objects to it.  It&#39;s not 100% clear
whether that counts as memory that should be released.  It certainly
*COULD* cause a memory leak.  On the other hand, such added memory could
be thought of as part of the &#34;permanent&#34; object, to be release when and
if the permanent object is released.

My inclination is to not follow by default, so that by default such
leaks would not be detected.  This seems to obey the principle of &#34;least
surprise&#34;.  I would also add a &#34;follow&#34; argument which allows the user
to follow references in permanent objects for checking purposes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562703" href="/Public/Bug/Display.html?id=42503#txn-562703">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;00:40:13&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> About this feature request and 2.000000 upcoming</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/562703/284153/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/284153">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 573b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Before I add this feature, I&#39;m going to complete the upcoming new major
release 2.000000.  2.000000 will not have this feature, but when I
rewrote the internals of Test::Weaken for it, I had this in mind.  I
factored out the code for finding all the memory objects contained in a
test object.  I also added the named argument format to the new interface.

2.000000 I hope will be on CPAN in a matter of days.  I&#39;ve just uploaded
a developer&#39;s release, 1.003_000, which passes all regression tests,
fixes bug #42903 and has the documentation for 2.000000 in late draft form.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562705" href="/Public/Bug/Display.html?id=42503#txn-562705">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;00:40:37&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-563054" href="/Public/Bug/Display.html?id=42503#txn-563054">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;17:56:04&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42503] Follow references in permanent objects?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 04 Feb 2009 09:53:37 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/563054/284361/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/284361">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 478b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; a constructor might take a permanent object and add objects to it.
</div>
That may be outside the scope of what can easily be tested.  I think
I&#39;ve had situations both where I&#39;ve hung data on another object, and
where the other object keeps it&#39;s own records of things about me.  The
first is a leak if not cleaned up, the second is a matter for the other
object.  But which is which would be nearly indistinguishable.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-563055" href="/Public/Bug/Display.html?id=42503#txn-563055">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;17:56:05&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-570633" href="/Public/Bug/Display.html?id=42503#txn-570633">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;26&nbsp;16:14:31&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/570633/287804/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/287804">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just put a developer&#39;s release on CPAN that fixes this.  It is
2.001_000.  Comments are welcome if you get a chance.  I&#39;m keeping the
bug open, probably until I do an non-developer&#39;s release with the fix.

I named the option &#39;ignore&#39; in keeping with the track/follow/ignore
nomenclature I use in the 2.000000 documentation.  More details of the
interface are in the documentation.

Current plan: another draft of the documentation, then a release
candidate, and, if that&#39;s OK, then release 2.002000,

thanks, jeffrey kegler

On Tue Feb 03 17:56:04 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; a constructor might take a permanent object and add objects to it.
</div>&gt; 
&gt; That may be outside the scope of what can easily be tested.  I think
&gt; I&#39;ve had situations both where I&#39;ve hung data on another object, and
&gt; where the other object keeps it&#39;s own records of things about me.  The
&gt; first is a leak if not cleaned up, the second is a matter for the other
&gt; object.  But which is which would be nearly indistinguishable.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-570835" href="/Public/Bug/Display.html?id=42503#txn-570835">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;27&nbsp;04:30:16&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Broken in 2.000000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-570836" href="/Public/Bug/Display.html?id=42503#txn-570836">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;27&nbsp;04:30:16&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 2.001_000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571115" href="/Public/Bug/Display.html?id=42503#txn-571115">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;27&nbsp;19:35:47&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42503] suggest skipping &#34;permanent&#34; objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Feb 2009 11:34:27 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/571115/288086/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288086">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I named the option &#39;ignore&#39; in keeping with the track/follow/ignore
&gt; nomenclature I use in the 2.000000 documentation.  More details of the
&gt; interface are in the documentation.
</div>
In the docs for ignore you might start with what it&#39;s good for, and then
go on to what it&#39;s not good for :-&#41;.

I think the best thing about an ignore is it doesn&#39;t descend into the
unwanted objects -- which is almost essential for the quite likely case
that they have random array etc sub-parts not easily identifiable in
post-filtering.


As a suggestion, how about also an option like

    ignore_classes =&gt; [ &#39;My::PrintSpoolerSingleton&#39;,
                        &#39;My::PermaType&#39; ]

which would cover basic blessed&#40;&#41;+isa&#40;&#41; ignoring.  Or a single
&#34;ingore_class&#34; if you might have just one to ignore, or accept either a
string name or arrayref in one option.

For symmetry the ignore option could take an array of coderefs to apply
too,

    ignore =&gt; [ \&#38;is_a_global,
                \&#38;is_a_persistent_test_bit,
                \&#38;is_a_coderef_from_a_global_func ]


Incidentally, not sure about the check_ignore&#40;&#41; feature.  Maybe an
example of the type of mistake it keeps you safe from would be clearer.
If an ignore is just a predicate func you&#39;d have to do something pretty
bad to upset the leaks mechanism would you?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571169" href="/Public/Bug/Display.html?id=42503#txn-571169">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;28&nbsp;00:16:27&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/571169/288107/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288107">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 664b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the docs for ignore you might start with what it&#39;s good for, and then
&gt; go on to what it&#39;s not good for :-&#41;.
</div>
Adam Kennedy somehow found the time some months ago to guide me on
writing CPAN documentation, and one of the things he pointed out is it&#39;s
important to focus on readers who are skimming CPAN hastily -- someone
who&#39;s in a hurry and exploring CPAN looking to save himself effort.
  
A skimmer is always asking, &#34;Do I care?&#34;.  If the answer is, &#34;No, you
don&#39;t&#34;, that fact belongs first.

For my stuff, you are a careful reader &#40;and thank you for that&#41;, but I
suspect you also do a lot of skimming in CPAN and other places, so you
may know what I mean.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571171" href="/Public/Bug/Display.html?id=42503#txn-571171">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;28&nbsp;00:24:02&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/571171/288109/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288109">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I thought about the possibility of other, more specific, ignore filters.
 These would have the major advantage of being safer and &#40;probably also&#41;
more efficient than filtering with a closure.  But I don&#39;t think we&#39;re
100% clear yet what are the most useful filters, and I thought it best
to start with the most general option.

Once we start on more specific filters than it&#39;s &#34;What about Boolean
combinations&#34;, etc.  I kn ow on my other module &#40;Parse::Marpa&#41; I&#39;ve
spent days on features I&#39;ve discovered to be useless clutter and backed out.

So, I&#39;m open to these possibilities, but in the short run I want to
think and accumulate experience.

On Fri Feb 27 19:35:47 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; I named the option &#39;ignore&#39; in keeping with the track/follow/ignore
&gt; &gt; nomenclature I use in the 2.000000 documentation.  More details of the
&gt; &gt; interface are in the documentation.
</div>&gt; 
&gt; In the docs for ignore you might start with what it&#39;s good for, and then
&gt; go on to what it&#39;s not good for :-&#41;.
&gt; 
&gt; I think the best thing about an ignore is it doesn&#39;t descend into the
&gt; unwanted objects -- which is almost essential for the quite likely case
&gt; that they have random array etc sub-parts not easily identifiable in
&gt; post-filtering.
&gt; 
&gt; 
&gt; As a suggestion, how about also an option like
&gt; 
&gt;     ignore_classes =&gt; [ &#39;My::PrintSpoolerSingleton&#39;,
&gt;                         &#39;My::PermaType&#39; ]
&gt; 
&gt; which would cover basic blessed&#40;&#41;+isa&#40;&#41; ignoring.  Or a single
&gt; &#34;ingore_class&#34; if you might have just one to ignore, or accept either a
&gt; string name or arrayref in one option.
&gt; 
&gt; For symmetry the ignore option could take an array of coderefs to apply
&gt; too,
&gt; 
&gt;     ignore =&gt; [ \&#38;is_a_global,
&gt;                 \&#38;is_a_persistent_test_bit,
&gt;                 \&#38;is_a_coderef_from_a_global_func ]
&gt; 
&gt; 
&gt; Incidentally, not sure about the check_ignore&#40;&#41; feature.  Maybe an
&gt; example of the type of mistake it keeps you safe from would be clearer.
&gt; If an ignore is just a predicate func you&#39;d have to do something pretty
&gt; bad to upset the leaks mechanism would you?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571173" href="/Public/Bug/Display.html?id=42503#txn-571173">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;28&nbsp;00:35:42&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/571173/288111/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288111">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">As for check_ignore:  The t/ignore.t file in the test suite simulates
some of the possible screw-ups, and tests that check_ignore actually
catches them.

I was pleased to discover that it is harder to screw up from inside a
callback than I feared -- in particular if you follow the &#34;best
practice&#34; of immediately copying the callback&#39;s args, you need to work a
bit to screw things up.  That&#39;s the good news.

The bad news is that if you do screw up, perhaps 50% of the time the
symptom is some mysterious infinite loop, caused by the fact you&#39;ve
confused Test::Weaken about which objects it has already visited and
which it has not.  Debugging the callbacks even with the wrapper isn&#39;t
all that easy, so it&#39;s one of those areas of program where the ancient
art of desk-checking becomes relevant again.

Summing up: the chances of a screw-up are lower than I feared, but the
consequences are so bad that I felt the need to provide check_ignore. 
If I got bug reports about the callbacks I&#39;d need to create something
like it anyway.  Best to be pro-active and give it to the user, I figured.

On Fri Feb 27 19:35:47 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Incidentally, not sure about the check_ignore&#40;&#41; feature.  Maybe an
&gt; example of the type of mistake it keeps you safe from would be clearer.
&gt; If an ignore is just a predicate func you&#39;d have to do something pretty
&gt; bad to upset the leaks mechanism would you?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571679" href="/Public/Bug/Display.html?id=42503#txn-571679">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;01&nbsp;18:23:56&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42503] suggest skipping &#34;permanent&#34; objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 02 Mar 2009 10:21:56 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/571679/288369/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288369">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 400b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; For my stuff, you are a careful reader
</div>
Actually I&#39;m a skimmer really :-&#41;.  Too much words and I start to glaze
over.  Which is why I like fragments of code, or itemized lists, etc. :&#41;

For &#34;Do I care?&#34;, I think, in general, a typical or normal use first
would tell me if I&#39;m interested to read more &#40;about pros and cons or
whatnot&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571681" href="/Public/Bug/Display.html?id=42503#txn-571681">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;01&nbsp;18:35:08&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42503] suggest skipping &#34;permanent&#34; objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 02 Mar 2009 10:33:26 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/571681/288371/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288371">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 692b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I was pleased to discover that it is harder to screw up from inside a
&gt; callback than I feared -- in particular if you follow the &#34;best
&gt; practice&#34; of immediately copying the callback&#39;s args,
</div>
Maybe you could protect internals by copying for the callback, eg.

   my $arg = $self-&gt;{&#39;some_private_stuff};
   &#38;$callback &#40;$arg&#41;;

If the caller stores to $_[0] it only hurts $arg not $self &#40;if I&#39;m not
mistaken&#41;.  There might even be an advantage to do it that way, if the
arg is then a strong ref where internals are only weak, or if the
weakness of the original ref can be propagated to the callback ... or
something like that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-571721" href="/Public/Bug/Display.html?id=42503#txn-571721">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;01&nbsp;20:40:40&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/571721/288397/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/288397">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 288b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Mar 01 18:35:08 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; Maybe you could protect internals by copying for the callback
</div>
That&#39;s a really good idea.  I think I&#39;ll do that before the next
official release.

By the way, I just uploaded a new developer&#39;s release.  Mainly rewrites
to the docs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573666" href="/Public/Bug/Display.html?id=42503#txn-573666">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;21:26:49&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/573666/289582/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289582">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 936b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just uploaded developer&#39;s release 2.001_002.

It incorporates your suggestion of passing the ignore callback a copy of
the probe reference, rather than the real thing.

Since this greatly eases the task the check_ignore static method was
designed for, I redesigned check_ignore.  It now by default does a deep
comparison of the two objects, a much more time-consuming check, but
also a much more thorough one.

It no longer takes an error callback argument -- I decided that if you
wanted to get that complicated, you were better off copying check_ignore
and hacking it -- that would be simpler.

Instead check_ignore takes three new optional arguments.  They are a
maximum error count &#40;to allow multiple error reports but also cut off
infinite loops&#41;, a maximum depth for the deep comparison, and a separate
maximum depth for reporting differences.

There&#39;s a first draft of the documentation with details.

thanks, jeffrey kegler
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574087" href="/Public/Bug/Display.html?id=42503#txn-574087">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;16:55:43&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42503] suggest skipping &#34;permanent&#34; objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 07 Mar 2009 08:54:05 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/574087/289833/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289833">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 800b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; It incorporates your suggestion of passing the ignore callback a copy of
&gt; the probe reference, rather than the real thing.
</div>
In normal circumstances of course anyone modifying their args deserves
what they get.  I suppose it&#39;s nice if tools that are supposed to hunt
down badness protect themselves a bit.  :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Since this greatly eases the task the check_ignore static method was
&gt; designed for, I redesigned check_ignore.  It now by default does a deep
&gt; comparison of the two objects, a much more time-consuming check, but
&gt; also a much more thorough one.
</div>
I&#39;m not sure I&#39;m convinced.  If it were mine I don&#39;t think I&#39;d worry
about it initially ... or leave it in an example script to be copied by
anyone having strange trouble.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574507" href="/Public/Bug/Display.html?id=42503#txn-574507">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;15:08:14&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/574507/290109/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/290109">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I cranked up the thoroughness of check_ignore because after I
incorporated your suggestion of pre-copying the arguments to the ignore
option, almost all of the errors that check_ignore was testing for were
not potential problems any more -- check_ignore in its original form had
been made nearly useless.  So it was either eliminate check_ignore,
clutter the documentation with an almost useless method, or crank up its
power.  I chose the last.

The fact that pre-copying elminates most bugs means the users of
Test::Weaken::check_ignore are now a smaller and more desperate class of
the debugging community, and will want and expect a pretty thorough check.

Looked at another way, I thought it might violate the Principle of Least
Surprise if the user could try out check_ignore and by default easily
get false positives due to lack of depth in the comparison.  Best to
start out thorough and let the user back things off if that&#39;s too much.

The depth of checking can be easily lowered.  One of the arguments to
check_ignore is a limit on the depth to which the before and after
objects will be compared. Since the base pointer counts in the depth,
setting the compare depth to 1, in effect, turns that check off.

As you suggest, I&#39;m not too worried about the interface to check_ignore,
because it&#39;s not tied in with the rest of the package and is very easy
to pull out of the source and hack up any way the user wants.

On Fri Mar 06 16:55:43 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt; Since this greatly eases the task the check_ignore static method was
&gt; &gt; designed for, I redesigned check_ignore.  It now by default does a deep
&gt; &gt; comparison of the two objects, a much more time-consuming check, but
&gt; &gt; also a much more thorough one.
</div>&gt; 
&gt; I&#39;m not sure I&#39;m convinced.  If it were mine I don&#39;t think I&#39;d worry
&gt; about it initially ... or leave it in an example script to be copied by
&gt; anyone having strange trouble.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-576130" href="/Public/Bug/Display.html?id=42503#txn-576130">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;00:41:24&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/576130/291038/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/291038">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 176b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just released 2.001_004 to CPAN.  It address this issue in this
ticket.  It&#39;s a release candidate, and if cpantesters blesses and all
looks good, it will become 2.002000.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-577802" href="/Public/Bug/Display.html?id=42503#txn-577802">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;13:23:57&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 2.002000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-577803" href="/Public/Bug/Display.html?id=42503#txn-577803">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;13:23:57&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 2.001_000 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-577804" href="/Public/Bug/Display.html?id=42503#txn-577804">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;13:26:12&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/577804/291986/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/291986">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 122b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The fix is in 2.002000, which I&#39;ve just released on CPAN.  If all looks
good, in a few days I will mark this bug resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-579426" href="/Public/Bug/Display.html?id=42503#txn-579426">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;17&nbsp;21:32:56&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/579426/292816/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/292816">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 65b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Cpantesters looks fine.  Resolved with official release 2.002000.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-579428" href="/Public/Bug/Display.html?id=42503#txn-579428">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;17&nbsp;21:32:57&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.006858</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
