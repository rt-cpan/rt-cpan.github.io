<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #132866 for Net-IMAP-Client: Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #132866 for Net-IMAP-Client: Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-IMAP-Client">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-IMAP-Client">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-IMAP-Client">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-IMAP-Client">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-IMAP-Client">Net-IMAP-Client CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">132866</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-IMAP-Client">Net-IMAP-Client</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gfb.0x08005bffffff [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-223564-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-223565-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=132866">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903038" href="/Public/Bug/Display.html?id=132866#txn-1903038">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;22&nbsp;15:14:43&nbsp;2020</span>
    <span class="description">gfb.0x08005bffffff [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 22 Jun 2020 18:37:30 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-IMAP-Client [...] rt.cpan.org&#34; &lt;bug-net-imap-client [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guy Boyd &lt;gfb.0x08005bffffff [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1903038/1019783/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1019783">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Apologies for the immediate follow up.

I just discovered with a manual dialog using openssl :

openssl s_client -connect outlook.office365.com:993 -crlf

a001 LOGIN  [ username ] [ password ] 

? LIST &#34;&#34; &#34;*&#34;                              #      get folder-names, succeeds

​? SELECT [ folder-name ]        #      succeeds

#-- response
* FLAGS &#40;\Seen \Answered \Flagged \Deleted \Draft $MDNSent&#41;
* OK [PERMANENTFLAGS &#40;\Seen \Answered \Flagged \Deleted \Draft $MDNSent&#41;] Permanent flags
* OK [UNSEEN 4] Is the first unseen message
* OK [UIDVALIDITY 1309] UIDVALIDITY value
* OK [UIDNEXT 14833] The next unique identifier value
? OK [READ-WRITE] SELECT completed.

# well then. Try SEARCH.

? SEARCH
? BAD Command Argument Error. 12
# Hmm.

? SEARCH UNSEEN
# -- response
* SEARCH 4 6 7 10 14 15 18 20 &#40;......&#41;  # SUCCESS

It would seem that office365 wants arguments supplied yo SEARCH that would seem to be  optional according to
rfc3501,  but are probably buried someplace in the polyglot of extension language in 
rfc5182.

I&#39;m no expert at deep RFC corners &#40; except for abusing project managers with RFC 2119 &#41;,
perhaps I&#39;ve missed something.

In any case I&#39;ll patch my local use case to unconditionally send the required arguments when the server 
is MS outlook.office365.com.

The module maintainer might maybe consider some creeping elegance &#40;or a pod note&#41;
that includes some &#34;office365-ish-extensions&#34; flags if others might find it useful. &#40; Just a suggestion &#41;. 



 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903065" href="/Public/Bug/Display.html?id=132866#txn-1903065">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;22&nbsp;19:21:46&nbsp;2020</span>
    <span class="description">joelz [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132866] Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 22 Jun 2020 13:21:16 -1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guy Boyd via RT &lt;bug-Net-IMAP-Client [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Joel Roth &lt;joelz [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1903065/1019795/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1019795">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 641b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">If I understand correctly, you&#39;re saying you get the
following results when using imap server
outlook.office365.com:

$messages = $imap-&gt;search&#40;&#41;          # does not return expected messages

$messages = $imap-&gt;search&#40;&#39;ALL&#39;&#41;     # does not return expected messages

$messages = $imap-&gt;search&#40;&#39;UNSEEN&#39;&#41;  # returns messages

I&#39;m not sure the first is a problem. The examples for
Net::IMAP::Client always indicate supplying arguments to
search&#40;&#41;.

The second seems strange to me, that outlook does not
support the SEARCH ALL sent by Net::IMAP::Client.

Which additional arguments are needed for search&#40;&#39;ALL&#39;&#41; to work?

Thank you

-- 
Joel Roth
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903066" href="/Public/Bug/Display.html?id=132866#txn-1903066">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;22&nbsp;19:21:46&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903162" href="/Public/Bug/Display.html?id=132866#txn-1903162">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;23&nbsp;17:38:38&nbsp;2020</span>
    <span class="description">gfb.0x08005bffffff [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132866] Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 23 Jun 2020 21:38:24 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-IMAP-Client [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guy Boyd &lt;gfb.0x08005bffffff [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1903162/1019847/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1019847">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, 


On Monday, June 22, 2020, 07:21:50 PM EDT, Joel Roth via RT &lt;bug-net-imap-client@rt.cpan.org&gt; wrote: 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132866">https://rt.cpan.org/Ticket/Display.html?id=132866</a></span> &gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I understand correctly, you&#39;re saying you get the
&gt; following results when using imap server
&gt; outlook.office365.com:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $messages = $imap-&gt;search&#40;&#41;          # does not return expected messages
&gt; $messages = $imap-&gt;search&#40;&#39;ALL&#39;&#41;    # does not return expected messages
&gt; $messages = $imap-&gt;search&#40;&#39;UNSEEN&#39;&#41;  # returns messages
</div>
Thanks for your response. 

Sorry for not being clear. 

I also have additional information that clarifies the problem 

&#40; and a hackish local resolution that seems to be working but it is untested for breakage of the 
original apparently RFC compliant servers &#41;.

1: No SEARCH commands &#40; where the required arguments are supplied &#41;  return any results &#40;other than undef&#41; 
    via Net::IMAP::Client when executed against my  outlook.office365.com session in.
   No &#39;non-argument&#39; attempts were made.

2: When debugging the same IMAP commands with openssl s_client -connect [args]  I discovered initially that
    SEARCH UNSEEN works fine from the openssl interface. 

   Later  I discovered that SEARCH ALL and SEARCH SEEN
   and others also appear to work fine from openssl given the new information under 4: below.

3. $summaries = $imap-&gt;get_summaries&#40;[ @msg_ids ]&#41; was discovered later to &#34;not work&#34; with office365
    &#40;after a local patch of &#39;SEARCH&#39; as described below&#41;.

4:                ** new information** : 

What I eventually discovered after several passes  is that  the office365  apparently does not like the
arguments  to the SEARCH command: &#40;  $charset ||= &#39;UTF-8&#39; &#41; or &#40;or does not like the argument order? untested&#41; 

I agree that this would seem to violate the RFC if it is true. 


 &#40; /root/.cpan/build/Net-IMAP-Client-0.9505-nydr2H/lib/Net/IMAP/Client.pm: &#41; 
# this is the original installation source. I&#39;ve taken a saw to the installed module already: 

in     282 sub search { : 

    285     $charset ||= &#39;UTF-8&#39;;

 and 

    297     $charset = &#34;CHARSET $charset&#34;;

If I remove the charset assertion and send the search on its way , SEARCH starts  working.
Coming at it backwards at it from the pod, I see this:

&#34;Our module is a bit more paranoid and it will actually add charset for both SORT and SEARCH. If $charset is omitted &#40;or undef&#41; the it will default to &#34;UTF-8&#34;, which, supposedly, is supported by all IMAP servers&#34;.

&#40; I&#39;m really trying to resist saying &#34;except $Msoft&#34;&#41; here. 

5:                     ** new information ** 
I was of course sure I was ready to go,

Until  $imap-&gt;get_summaries&#40;&#41; returned undev   &#40; having been passed the required array ref of message ids&#41;. 

From the pod:
# fetch message summaries &#40;actually, a lot more&#41;
       # copy / paste from pod
        my $summaries = $imap-&gt;get_summaries&#40;[ @msg_ids ]&#41;;

I&#39;ll need to supply some follow-up debug output on this &#40;i&#39;m in the middle of a functioning pass with a largish mailbox&#41; 
but the two things I seemed to have discovered are

       5a. office365 apparently does not like the original syntax of the commands that use FETCH.
       I&#39;ll send a DIFF of the original syntax and my hacked result later &#40; a day or so.&#41; 

Here is my hackish diff for send_cmd that appears to help that. I have not gone back to test 
what this breaks on other apparently  RFC compliant  servers, I intent to do that soon.

It appears that adding  braces around $args in $self-&gt;_send_cmd&#40;$cmd, [ $args ] &#41;
at  sub _tell_imap &#40;&#41;  things appear to work as expected.  

&#40;Granted I may have sawed past something in usage that I misunderstood in my haste.&#41; 

&lt;--- hacked
---&gt; original 

diff -C 3 /root/perl5/lib/perl5/Net/IMAP/Client.pm 
           /root/.cpan/build/Net-IMAP-Client-0.9505-nydr2H/lib/Net/IMAP/Client.pm

  sub _tell_imap {
!     my &#40;$self, $cmd, $args, $do_notf &#41; = @_;


      $cmd = uc $cmd;


      my &#40;$lineparts, $ok, $res&#41;;


-       # printf&#40;&#34;%s %s %s\n&#34;, &#34;tell_imap&#40;&#41;&#34;,  $cmd,  Data::Dumper::Dumper &#40;$args&#41;&#41;;
-
-       if&#40;$cmd =~ /FETCH/&#41; {
-               # sleep 3;
-       }
-
    RETRY1: {
!         $self-&gt;_send_cmd&#40;$cmd, [ $args ] &#41;;
          redo RETRY1 if $self-&gt;_reconnect_if_needed;
      }


--- 789,802 ----
  }


  sub _tell_imap {
!     my &#40;$self, $cmd, $args, $do_notf&#41; = @_;


      $cmd = uc $cmd;


      my &#40;$lineparts, $ok, $res&#41;;


    RETRY1: {
!         $self-&gt;_send_cmd&#40;$cmd, $args&#41;;
          redo RETRY1 if $self-&gt;_reconnect_if_needed;
      }

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903231" href="/Public/Bug/Display.html?id=132866#txn-1903231">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;24&nbsp;13:14:49&nbsp;2020</span>
    <span class="description">gfb.0x08005bffffff [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132866] Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Jun 2020 17:14:40 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-IMAP-Client [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guy Boyd &lt;gfb.0x08005bffffff [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1903231/1019884/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1019884">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">DEBUG printf of data immediately before it enters the socket.  The mods shown here are the minimal required brute-force test
to regain search function. This is not IMO an advisable way to implement a patch. 

Summary conclusion on SEARCH is that office365 does not accept the CHARSET UTF-8 assertion and is further oddly picky about white-space
between tokens &#40;apparently&#41;.

Below, Net::IMAP::Client::_send_cmd &#40;&#41; indicates the data written to the socket
towards the server.

1: install module on a fresh virtual machine of similar environment.

Linux cos7x64-node5-codepool 3.10.0-1127.8.2.el7.x86_64 #1 SMP Tue May 12 16:57:42 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
Module  &lt; Net::IMAP::Client      &#40;GANGLION/Net-IMAP-Client-0.9505.tar.gz&#41;
 &gt;&gt; /usr/bin/make install  -- OK

         // test code minus sensitive information.
         $imap-&gt;login ||  die&#40;&#39;Login failed: &#39; . $imap-&gt;last_error&#41;;
         $imap-&gt;select&#40; &#39;ACL&#39; &#41; || die&#40;&#34;$!&#34;&#41;;

         my $messages = $imap-&gt;search&#40;&#39;ALL&#39;&#41;;
         printf&#40;&#34;%s: %s\n&#34;, &#34;Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;&#34; ,  Dumper&#40;$messages&#41;&#41;;


2: Open a session to outlook.office365.com. Dump return value from $imap-&gt;search&#40;&#39;ALL&#39;&#41;.

perl -w imap_test.pl
Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = undef;

3: remove charset assertion

diff /root/perl5/lib/perl5/Net/IMAP/Client.pm /root/.cpan/build/Net-IMAP-Client-0.9505-4FBM27/lib/Net/IMAP/Client.pm
300c300
&lt;       $charset = &#39;&#39;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
perl -w imap_test.pl

Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = undef;

4. Put &#39;charset&#39; back. Add debug.

diff /root/perl5/lib/perl5/Net/IMAP/Client.pm /root/.cpan/build/Net-IMAP-Client-0.9505-4FBM27/lib/Net/IMAP/Client.pm
300c300
&lt;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>681c681
&lt;       my&#40;$__PACKAGE__,$__FILE__,$__LINE__,$__FUNCTION__&#41; = caller&#40;0&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>702d701
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;
707d705
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;

Run test.

perl -w imap_test.pl

Net::IMAP::Client::_send_cmd 800             cmd NIC2 SELECT &#34;ACL&#34;
Net::IMAP::Client::_send_cmd 800             cmd NIC3 UID SEARCH CHARSET UTF-8 ALL
Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = undef;
Net::IMAP::Client::_send_cmd 82 cmd NIC4 LOGOUT

5. Manually remove CHARSET UTF8 ALL immediately prior to socket with a regex.

diff /root/perl5/lib/perl5/Net/IMAP/Client.pm /root/.cpan/build/Net-IMAP-Client-0.9505-4FBM27/lib/Net/IMAP/Client.pm
300c300
&lt;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>681c681
&lt;       my&#40;$__PACKAGE__,$__FILE__,$__LINE__,$__FUNCTION__&#41; = caller&#40;0&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>702,705d701
&lt;               $cmd =~ s/CHARSET//g;
&lt;               $cmd =~ s/UTF-8//g;
&lt;               $cmd =~ s/\+/ /g;
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;
710d705
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;


Retest.

perl -w imap_test.pl

Net::IMAP::Client::_send_cmd 803             cmd NIC2 SELECT &#34;ACL&#34;
Net::IMAP::Client::_send_cmd 803             cmd NIC3 UID SEARCH   ALL
Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = undef;
Net::IMAP::Client::_send_cmd 82               cmd NIC4 LOGOUT

6. Collapse the extra white-space in the data that was written to the socket. Leave one space behind.

$cmd =~ s/\s+ALL/ ALL/g below.

300c300
&lt;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>681c681
&lt;       my&#40;$__PACKAGE__,$__FILE__,$__LINE__,$__FUNCTION__&#41; = caller&#40;0&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>702,705d701
&lt;               $cmd =~ s/CHARSET//g;
&lt;               $cmd =~ s/UTF-8//g;
&lt;               $cmd =~ s/\s+ALL/ ALL/g;
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;
710d705
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;

SUCCESS. This seems to support the conclusion that office365 does not either like extraneous white space,
OR the CHARSET assertion.

perl -w imap_test.pl

Net::IMAP::Client::_send_cmd 803              cmd NIC2 SELECT &#34;ACL&#34;
Net::IMAP::Client::_send_cmd 803              cmd NIC3 UID SEARCH ALL

Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = [
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9
        ];
Net::IMAP::Client::_send_cmd 82 cmd NIC4 LOGOUT

7. Put back CHARSET UTF-8  as a final test.

diff /root/perl5/lib/perl5/Net/IMAP/Client.pm /root/.cpan/build/Net-IMAP-Client-0.9505-4FBM27/lib/Net/IMAP/Client.pm
300c300
&lt;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>681c681
&lt;       my&#40;$__PACKAGE__,$__FILE__,$__LINE__,$__FUNCTION__&#41; = caller&#40;0&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>702,705d701
&lt;               # $cmd =~ s/CHARSET//g;
&lt;               # $cmd =~ s/UTF-8//g;
&lt;               $cmd =~ s/\s+ALL/ ALL/g;
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;
710d705
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;


perl -w imap_test.pl

Result: FAILURE.

Net::IMAP::Client::_send_cmd  803            cmd NIC2 SELECT &#34;ACL&#34;
Net::IMAP::Client::_send_cmd  803            cmd NIC3 UID SEARCH CHARSET UTF-8 ALL
Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = undef;
Net::IMAP::Client::_send_cmd  82              cmd NIC4 LOGOUT


Put back white-space removal.

try a SEEN search.

diff /root/perl5/lib/perl5/Net/IMAP/Client.pm /root/.cpan/build/Net-IMAP-Client-0.9505-4FBM27/lib/Net/IMAP/Client.pm
300c300
&lt;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>681c681
&lt;       my&#40;$__PACKAGE__,$__FILE__,$__LINE__,$__FUNCTION__&#41; = caller&#40;0&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>702,706d701
&lt;               $cmd =~ s/CHARSET//g;
&lt;               $cmd =~ s/UTF-8//g;
&lt;               $cmd =~ s/\s+ALL/ ALL/g;
&lt;               $cmd =~ s/\s+SEEN/ SEEN/g;
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;
711d705
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;


SUCCESS

perl -w imap_test.pl

Net::IMAP::Client::_send_cmd 804 cmd NIC2 SELECT &#34;ACL&#34;
Net::IMAP::Client::_send_cmd 804 cmd NIC3 UID SEARCH SEEN
Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = [
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9
        ];
Net::IMAP::Client::_send_cmd 82 cmd NIC4 LOGOUT
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903234" href="/Public/Bug/Display.html?id=132866#txn-1903234">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;24&nbsp;13:38:09&nbsp;2020</span>
    <span class="description">gfb.0x08005bffffff [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132866] Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Jun 2020 17:37:47 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-IMAP-Client [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guy Boyd &lt;gfb.0x08005bffffff [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1903234/1019886/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1019886">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">With respect to FETCH commands  it would seem that the minimal required brute-force patch to fix SEARCH no also fixes 
FETCH. &#40; for office 365. &#41;

This was unexpected to me, as my own local not-so-minimalist approach to a fix for FETCH
seemed to require more changes than this. Today, with no modifications, commands that use FETCH
work with no further intervention  than reported in the previous message.

 !diff
diff /root/perl5/lib/perl5/Net/IMAP/Client.pm /root/.cpan/build/Net-IMAP-Client-0.9505-4FBM27/lib/Net/IMAP/Client.pm
300c300
&lt;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>681c681
&lt;       my&#40;$__PACKAGE__,$__FILE__,$__LINE__,$__FUNCTION__&#41; = caller&#40;0&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>702,706d701
&lt;               $cmd =~ s/CHARSET//g;
&lt;               $cmd =~ s/UTF-8//g;
&lt;               $cmd =~ s/\s+ALL/ ALL/g;
&lt;               $cmd =~ s/\s+SEEN/ SEEN/g;
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;
711d705
&lt;               printf&#40;&#34;%s %s %s %s\n&#34;, $__FUNCTION__, $__LINE__,  &#39;cmd&#39;, $cmd&#41; if &#40;$cmd !~ /LOGIN/&#41;;

# test code. sensitive info removed 

$imap-&gt;login ||  die&#40;&#39;Login failed: &#39; . $imap-&gt;last_error&#41;;
$imap-&gt;select&#40; &#39;ACL&#39; &#41; || die&#40;&#34;$!&#34;&#41;;

my $messages = $imap-&gt;search&#40;&#39;ALL&#39;&#41;;
printf&#40;&#34;%s: %s\n&#34;, &#34;Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;&#34; ,  Dumper&#40;$messages&#41;&#41;;

my &#40; $summaries &#41;  = $imap-&gt;get_summaries&#40; $messages &#41;;
foreach my $s &#40;@{$summaries}&#41; {
    printf&#40;&#34;%s %s %s\n&#34;, $s-&gt;{uid}, $s-&gt;{date}, $s-&gt;rfc822_size &#41;;
}

Result: SUCCESS:

Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = [
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9
        ];


Net::IMAP::Client::_send_cmd 804          
              cmd NIC4 UID FETCH 1,2,3,4,5,6,7,8,9 &#40;UID FLAGS INTERNALDATE RFC822.SIZE ENVELOPE BODYSTRUCTURE&#41;

1 Thu, 30 Mar 2017 07:13:17 +0000 130872
2 Thu, 30 Mar 2017 07:12:08 +0000 153700
3 Thu, 30 Mar 2017 07:10:49 +0000 118971
4 Thu, 30 Mar 2017 07:09:44 +0000 223423
5 Thu, 30 Mar 2017 07:08:05 +0000 90786
6 Thu, 30 Mar 2017 07:07:04 +0000 128925
7 Thu, 30 Mar 2017 07:05:54 +0000 131248
8 Thu, 30 Mar 2017 07:03:33 +0000 120273
9 Thu, 30 Mar 2017 07:04:44 +0000 120288

Net::IMAP::Client::_send_cmd 82 cmd NIC5 LOGOUT













 On Monday, June 22, 2020, 07:21:50 PM EDT, Joel Roth via RT &lt;bug-net-imap-client@rt.cpan.org&gt; wrote: 
&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132866">https://rt.cpan.org/Ticket/Display.html?id=132866</a></span> &gt;

If I understand correctly, you&#39;re saying you get the
following results when using imap server
outlook.office365.com:

$messages = $imap-&gt;search&#40;&#41;          # does not return expected messages

$messages = $imap-&gt;search&#40;&#39;ALL&#39;&#41;    # does not return expected messages

$messages = $imap-&gt;search&#40;&#39;UNSEEN&#39;&#41;  # returns messages

I&#39;m not sure the first is a problem. The examples for
Net::IMAP::Client always indicate supplying arguments to
search&#40;&#41;.

The second seems strange to me, that outlook does not
support the SEARCH ALL sent by Net::IMAP::Client.

Which additional arguments are needed for search&#40;&#39;ALL&#39;&#41; to work?

Thank you

-- 
Joel Roth
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903240" href="/Public/Bug/Display.html?id=132866#txn-1903240">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;24&nbsp;13:54:51&nbsp;2020</span>
    <span class="description">gfb.0x08005bffffff [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132866] Net-IMAP-Client search&#40;&#41; method fails against outlook.office365.com imap&#40;s&#41; server</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Jun 2020 17:54:42 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-net-imap-client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guy Boyd &lt;gfb.0x08005bffffff [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1903240/1019891/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1019891">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Final simplistic retest with different &#40;formerly working without change&#41; IMAP server &#40;gmail&#41;.

Retest  against GMAIL:  Summary: SUCCESS &#40;no apparent side effects of previous  debug hack
under simplistic test.

# test code
&#39;server&#39; =&gt; &#39;imap.gmail.com&#39;,

$imap-&gt;login ||  die&#40;&#39;Login failed: &#39; . $imap-&gt;last_error&#41;;
$imap-&gt;select&#40; &#39;juniper_spam&#39; &#41; || die&#40;&#34;$!&#34;&#41;;

my $messages = $imap-&gt;search&#40;&#39;ALL&#39;&#41;;

printf&#40;&#34;%s: %s\n&#34;, &#34;Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;&#34; ,  Dumper&#40;$messages&#41;&#41;;
my &#40; $summaries &#41;  = $imap-&gt;get_summaries&#40; $messages &#41;;

foreach my $s &#40;@{$summaries}&#41; {
    printf&#40;&#34;%s %s %s\n&#34;, $s-&gt;{uid}, $s-&gt;{date}, $s-&gt;rfc822_size &#41;;
}

Net::IMAP::Client::_send_cmd 804 cmd NIC2 SELECT &#34;different_folder&#34;

Net::IMAP::Client::_send_cmd 804 cmd NIC3 UID SEARCH ALL

Dumping retval from imap-&gt;search&#40;&#39;ALL&#39;&#41;: $VAR1 = [
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9,
          10,
          11,
      ]
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.452531</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
