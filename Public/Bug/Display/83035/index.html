<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #83035 for DBIx-DBSchema: Tables are returned in hash-key order rather than a stable order</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #83035 for DBIx-DBSchema: Tables are returned in hash-key order rather than a stable order</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-DBSchema">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-DBSchema">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-DBSchema">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-DBSchema">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-DBSchema">DBIx-DBSchema CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">83035</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-DBSchema">DBIx-DBSchema</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ivan-pause [...] 420.am
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tsibley [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
gregoa [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10470-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.40    </td>
  </tr>
  <tr id="CF-10471-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=83035">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175658" href="/Public/Bug/Display.html?id=83035#txn-1175658">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;29&nbsp;14:45:03&nbsp;2013</span>
    <span class="description">tsibley [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tables are returned in hash-key order rather than a stable order</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1175658/620088/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/620088">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 479b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This causes variations in returned schemas when running under perl 5.17.6, 
which randomizes the hash-key ordering much more aggressively.  Just like 
DBIx::DBSchema::Table-&gt;Columns, the DBIx::DBSchema-&gt;Tables method 
shouldn&#39;t rely on the keys&#40;&#41; built-in to return the list of tables.  At 
the very least, it should get a sort&#40;&#41; wrapped around it.  Ideally the 
tables would be sorted by the order in which they were added, like 
columns, but that requires a little more change.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175662" href="/Public/Bug/Display.html?id=83035#txn-1175662">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;29&nbsp;14:45:20&nbsp;2013</span>
    <span class="description">tsibley [...] cpan.org -  Dependency by ticket #82978 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links DeleteLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175668" href="/Public/Bug/Display.html?id=83035#txn-1175668">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;29&nbsp;15:08:09&nbsp;2013</span>
    <span class="description">tsibley [...] cpan.org -  Dependency by ticket #82978 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175670" href="/Public/Bug/Display.html?id=83035#txn-1175670">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;29&nbsp;15:08:09&nbsp;2013</span>
    <span class="description">tsibley [...] cpan.org -  Reference by ticket #82978 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1225130" href="/Public/Bug/Display.html?id=83035#txn-1225130">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;17&nbsp;15:21:24&nbsp;2013</span>
    <span class="description">gregoa [...] cpan.org -  Cc GREGOA added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1319536" href="/Public/Bug/Display.html?id=83035#txn-1319536">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;29&nbsp;18:24:32&nbsp;2014</span>
    <span class="description">ivan-pause [...] 420.am -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1319536/699792/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/699792">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 29 14:45:03 2013, TSIBLEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This causes variations in returned schemas when running under perl 5.17.6, 
&gt; which randomizes the hash-key ordering much more aggressively.  Just like 
&gt; DBIx::DBSchema::Table-&gt;Columns, the DBIx::DBSchema-&gt;Tables method 
&gt; shouldn&#39;t rely on the keys&#40;&#41; built-in to return the list of tables.  At 
&gt; the very least, it should get a sort&#40;&#41; wrapped around it.  Ideally the 
&gt; tables would be sorted by the order in which they were added, like 
&gt; columns, but that requires a little more change.
</div>
I&#39;m not sure I agree completely?

Databases don&#39;t have a concept of &#34;table order&#34;, right?  Tables in Pg or MySQL &#40;etc.&#41; aren&#39;t in any sort of order &#40;creation order or otherwise&#41;, as far as I know.  That&#39;s what we&#39;re trying to model.

So, IOW, perhaps the new hash key randomization is just making more obvious what should have been true all alone, that tables have no inherent ordering?

I&#39;d be interested in more background / hearing why this was a problem.  A now-failing test somewhere in a module that uses DBIx::DBSchema?  That seems to come up a lot with those changes.  Or something more applicable to non-test usage?

-Ivan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1319537" href="/Public/Bug/Display.html?id=83035#txn-1319537">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;29&nbsp;18:24:32&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1319540" href="/Public/Bug/Display.html?id=83035#txn-1319540">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;29&nbsp;18:24:33&nbsp;2014</span>
    <span class="description">ivan-pause [...] 420.am -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1319541" href="/Public/Bug/Display.html?id=83035#txn-1319541">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;29&nbsp;18:24:41&nbsp;2014</span>
    <span class="description">ivan-pause [...] 420.am -  Severity Important changed to Normal</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1319609" href="/Public/Bug/Display.html?id=83035#txn-1319609">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;29&nbsp;20:04:58&nbsp;2014</span>
    <span class="description">tsibley [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83035] Tables are returned in hash-key order rather than a stable order</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Jan 2014 20:04:34 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ivan Kohler via RT &lt;bug-DBIx-DBSchema [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Sibley &lt;tsibley [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1319609/699826/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/699826">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jan 29, 2014 at 06:24:32PM -0500, Ivan Kohler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=83035">https://rt.cpan.org/Ticket/Display.html?id=83035</a></span> &gt;
&gt; 
&gt; On Tue Jan 29 14:45:03 2013, TSIBLEY wrote:
<div class="message-stanza open">&gt; &gt; This causes variations in returned schemas when running under perl 5.17.6, 
&gt; &gt; which randomizes the hash-key ordering much more aggressively.  Just like 
&gt; &gt; DBIx::DBSchema::Table-&gt;Columns, the DBIx::DBSchema-&gt;Tables method 
&gt; &gt; shouldn&#39;t rely on the keys&#40;&#41; built-in to return the list of tables.  At 
&gt; &gt; the very least, it should get a sort&#40;&#41; wrapped around it.  Ideally the 
&gt; &gt; tables would be sorted by the order in which they were added, like 
&gt; &gt; columns, but that requires a little more change.
</div>&gt; 
&gt; I&#39;m not sure I agree completely?
&gt; 
&gt; Databases don&#39;t have a concept of &#34;table order&#34;, right?  Tables in Pg
&gt; or MySQL &#40;etc.&#41; aren&#39;t in any sort of order &#40;creation order or
&gt; otherwise&#41;, as far as I know.  That&#39;s what we&#39;re trying to model.
&gt; 
&gt; So, IOW, perhaps the new hash key randomization is just making more
&gt; obvious what should have been true all alone, that tables have no
&gt; inherent ordering?
</div>
This isn&#39;t about inherent ordering from the database-level.

When I wrote &#34;Ideally tables would be sorted in the order in which they
were added, like columns,&#34; I meant added to the DBIx::DBSchema object
via the constructor, which takes an ordered list.

If you look at the Columns method on ::Table you&#39;ll see that it
preserves the order from the constructor call.  The Tables method could
do the same thing.

On the other hand, you could just wrap the keys&#40;&#41; in a sort&#40;&#41; and be
done with it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d be interested in more background / hearing why this was a problem.
&gt; A now-failing test somewhere in a module that uses DBIx::DBSchema?
&gt; That seems to come up a lot with those changes.  Or something more
&gt; applicable to non-test usage?
</div>
Tests only, IIRC.  That said, as noted in the linked Referred To By
ticket on rt.cpan.org, the DDL generated for a schema object will change
from call to call, and hence table creation order will change.  Creation
order may matter if one table defines a relationship to another.

Thanks for following up!

Thomas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1369089" href="/Public/Bug/Display.html?id=83035#txn-1369089">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;27&nbsp;20:06:09&nbsp;2014</span>
    <span class="description">ivan-pause [...] 420.am -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1369089/726856/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/726856">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 29 20:04:58 2014, TSIBLEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed, Jan 29, 2014 at 06:24:32PM -0500, Ivan Kohler via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=83035">https://rt.cpan.org/Ticket/Display.html?id=83035</a></span> &gt;
&gt; &gt;
&gt; &gt; On Tue Jan 29 14:45:03 2013, TSIBLEY wrote:
<div class="message-stanza open">&gt; &gt; &gt; This causes variations in returned schemas when running under perl
&gt; &gt; &gt; 5.17.6,
&gt; &gt; &gt; which randomizes the hash-key ordering much more aggressively.
&gt; &gt; &gt; Just like
&gt; &gt; &gt; DBIx::DBSchema::Table-&gt;Columns, the DBIx::DBSchema-&gt;Tables method
&gt; &gt; &gt; shouldn&#39;t rely on the keys&#40;&#41; built-in to return the list of tables.
&gt; &gt; &gt; At
&gt; &gt; &gt; the very least, it should get a sort&#40;&#41; wrapped around it.  Ideally
&gt; &gt; &gt; the
&gt; &gt; &gt; tables would be sorted by the order in which they were added, like
&gt; &gt; &gt; columns, but that requires a little more change.
</div>&gt; &gt;
&gt; &gt; I&#39;m not sure I agree completely?
&gt; &gt;
&gt; &gt; Databases don&#39;t have a concept of &#34;table order&#34;, right?  Tables in Pg
&gt; &gt; or MySQL &#40;etc.&#41; aren&#39;t in any sort of order &#40;creation order or
&gt; &gt; otherwise&#41;, as far as I know.  That&#39;s what we&#39;re trying to model.
&gt; &gt;
&gt; &gt; So, IOW, perhaps the new hash key randomization is just making more
&gt; &gt; obvious what should have been true all alone, that tables have no
&gt; &gt; inherent ordering?
</div>&gt; 
&gt; This isn&#39;t about inherent ordering from the database-level.
</div>
I believe it is relevant.  Our objects attempt to model database schemas.  Database schemas don&#39;t have table ordering.  Objects you reverse-engineer from an existing database schema using new_native / new_odbc don&#39;t have any sort of table order.

So I&#39;m not feeling like objects you instantiate yourself, manually in perl code should have some sort of magic &#34;table order&#34; that&#39;s lost when you use those objects to create an actual database.  &#40;as a supported external API&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When I wrote &#34;Ideally tables would be sorted in the order in which
&gt; they
&gt; were added, like columns,&#34; I meant added to the DBIx::DBSchema object
&gt; via the constructor, which takes an ordered list.
</div>
It does, but it makes no promises to preserve that order, and I don&#39;t believe it should for the reasons above.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you look at the Columns method on ::Table you&#39;ll see that it
&gt; preserves the order from the constructor call.
</div>
Column order is part of the actual database schema, though.

You could make an object, use it to create the actual database schema, then reverse engineer that schema, and you would have same order, right?

The same is not true for tables.  You can&#39;t make some table objects, use them to create the actual database schema, then reverse engineer that schema and get the same order back.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The Tables method could do the same thing.
</div>
It could, but I don&#39;t think it should, for the reasons above.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On the other hand, you could just wrap the keys&#40;&#41; in a sort&#40;&#41; and be
&gt; done with it.
</div>
I think the code which uses the -&gt;tables method should do this if it wants tables in a deterministic order.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I&#39;d be interested in more background / hearing why this was a
&gt; &gt; problem.
&gt; &gt; A now-failing test somewhere in a module that uses DBIx::DBSchema?
&gt; &gt; That seems to come up a lot with those changes.  Or something more
&gt; &gt; applicable to non-test usage?
</div>&gt; 
&gt; Tests only, IIRC.  That said, as noted in the linked Referred To By
&gt; ticket on rt.cpan.org, the DDL generated for a schema object will
&gt; change
&gt; from call to call, and hence table creation order will change.
&gt; Creation
&gt; order may matter if one table defines a relationship to another.
</div>
It may, but we should probably solve the actual problem if and when we get to it?

Something similar actually came up with the new Foreign Key support and it was better to do the basic creation/changes first and define relationships next.  Trying to order the table statements didn&#39;t work &#40;easy for a schema to have unsolveable cyclic relationships&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1369224" href="/Public/Bug/Display.html?id=83035#txn-1369224">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;02:34:10&nbsp;2014</span>
    <span class="description">tsibley [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83035] Tables are returned in hash-key order rather than a stable order</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 May 2014 23:33:56 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-DBSchema [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Sibley &lt;tsibley [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1369224/726924/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/726924">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 800b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 05/27/2014 05:06 PM, Ivan Kohler via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Database schemas don&#39;t have table ordering. [...] Column order is
&gt; part of the actual database schema, though.
</div>
Fair enough.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; On the other hand, you could just wrap the keys&#40;&#41; in a sort&#40;&#41; and be
&gt;&gt; done with it.
</div>&gt;
&gt; I think the code which uses the -&gt;tables method should do this if it 
&gt; wants tables in a deterministic order.
</div>
This is what I did, way back when, after all.

It&#39;s still slightly annoying, from a purely pragmatic perspective, that
the generated DDL isn&#39;t deterministic.  Because the schema&#39;s tables
don&#39;t have an inherent order, I don&#39;t see why you shouldn&#39;t arbitrarily
pick one for convenience.  Most databases, when queried for table names,
return them in a stable order because it&#39;s more useful than a random order.

Thomas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1369230" href="/Public/Bug/Display.html?id=83035#txn-1369230">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;02:58:39&nbsp;2014</span>
    <span class="description">ivan-pause [...] 420.am -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.524896</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
