<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13563 for Crypt-GPG: problems with new version of GPG, signature checking, key length etc.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13563 for Crypt-GPG: problems with new version of GPG, signature checking, key length etc.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Crypt-GPG/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Crypt-GPG/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Crypt-GPG/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Crypt-GPG/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-GPG">Crypt-GPG CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13563</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Crypt-GPG/Active/">Crypt-GPG</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">AGUL [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dmorel [...] intradot.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-8442-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.52    </td>
  </tr>
  <tr id="CF-8443-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;05:04:13&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> problems with new version of GPG, signature checking, key length etc.</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The included patch partially addresses various problems encountered with new versions of gpg and Crypt::GPG.
* Incorrect documentation about signature checking : gpg messages are now all uppercase
* Key lengths under 1024k are not available anymore, making many tests fail
* Signature checking fails in the event the trust level is undefined in trustdb
* Decryption fails due to an incorrectly passing the secretkey ID
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;05:05:03&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Of course I forgot the attachment
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Crypt-GPG-1.52.orig/GPG.pm	2005-02-23 10:14:40.000000000 +0100
+++ Crypt-GPG-1.52/GPG.pm	2005-06-29 11:53:29.000000000 +0200
@@ -173,7 +172,7 @@
    last;
       }
       elsif &#40;$2&#41; {
-	if &#40;$2 eq $self-&gt;{SECRETKEY}-&gt;{ID}&#41; {
+        if &#40;$2 eq &#40;$self-&gt;keydb&#40;$self-&gt;{SECRETKEY}&#41;&#41;[0]-&gt;{ID}&#41; { # $self-&gt;{SECRETKEY}-&gt;{ID} is never used
      $in .= &#34;$self-&gt;{PASSPHRASE}\n&#34;;
      pump $h until $out =~ /&#40;GOOD|BAD&#41;_PASSPHRASE/g;
      if &#40;$1 eq &#39;GOOD&#39;&#41; {
@@ -215,7 +213,7 @@
     unless $x =~ /SIG_ID/s;

   my @signatures;
-  $x =~ /SIG_ID \S+ &#40;\S+ \S+&#41;.*&#40;GOOD|BAD&#41;SIG &#40;\S{16}&#41;.*TRUST_&#40;\S+&#41;/sg;
+  $x =~ /SIG_ID \S+ &#40;\S+ \S+&#41;.*&#40;GOOD|BAD&#41;SIG &#40;\S{16}&#41;.*&#40;?:TRUST_&#40;\S+&#41;&#41;?/sg;
   my $signature = {&#39;Validity&#39; =&gt; $2, &#39;KeyID&#39; =&gt; $3,
           &#39;Time&#39; =&gt; $1, &#39;Trusted&#39; =&gt; $4};
   $signature-&gt;{Time} = str2time &#40;$signature-&gt;{Time}&#41;;
@@ -1022,11 +1018,10 @@
 The Crypt::GPG::Signature object can be queried with the following
 methods:

-   $sig-&gt;validity&#40;&#41;;    # &#39;Good&#39;, &#39;BAD&#39;, or &#39;Unknown&#39;
+   $sig-&gt;validity&#40;&#41;;    # &#39;GOOD&#39;, &#39;BAD&#39;, or &#39;UNKNOWN&#39;
    $sig-&gt;keyid&#40;&#41;;       # ID of signing key
    $sig-&gt;time&#40;&#41;;        # Time the signature was made
-   $sig-&gt;trusted&#40;&#41;;     # True or false depending on whether
-                          the signing key is trusted
+   $sig-&gt;trusted&#40;&#41;;     # Signature trust level

 =item B&lt;msginfo&#40;@ciphertext&#41;&gt;

@@ -1076,7 +1076,7 @@

 Creates a new keypair with the parameters specified. The only
 supported B&lt;$keytype&gt; currently is &#39;ELG-E&#39;. B&lt;$keysize&gt; can be any of
-768, 1024, 2048, 3072 or 4096. Returns undef if there was an error,
+1024, 2048, 3072 or 4096. Returns undef if there was an error,
 otherwise returns a filehandle that reports the progress of the key
 generation process similar to the way GnuPG does. The key generation
 is not complete till you read an EOF from the returned filehandle.
diff -ur Crypt-GPG-1.52.orig/README Crypt-GPG-1.52/README
--- Crypt-GPG-1.52.orig/README	2005-02-23 10:13:59.000000000 +0100
+++ Crypt-GPG-1.52/README	2005-06-29 11:54:03.000000000 +0200
@@ -190,7 +190,7 @@

     keygen&#40;$name, $email, $keytype, $keysize, $expire, $passphrase&#41;
       Creates a new keypair with the parameters specified. The only
-      supported $keytype currently is &#39;ELG-E&#39;. $keysize can be any of 768,
+      supported $keytype currently is &#39;ELG-E&#39;. $keysize can be any of
       1024, 2048, 3072 or 4096. Returns undef if there was an error,
       otherwise returns a filehandle that reports the progress of the key
       generation process similar to the way GnuPG does. The key generation
diff -ur Crypt-GPG-1.52.orig/blib/lib/Crypt/GPG.pm Crypt-GPG-1.52/blib/lib/Crypt/GPG.pm
--- Crypt-GPG-1.52.orig/blib/lib/Crypt/GPG.pm	2005-02-23 10:14:40.000000000 +0100
+++ Crypt-GPG-1.52/blib/lib/Crypt/GPG.pm	2005-06-29 11:55:11.000000000 +0200
@@ -1076,7 +1076,7 @@

 Creates a new keypair with the parameters specified. The only
 supported B&lt;$keytype&gt; currently is &#39;ELG-E&#39;. B&lt;$keysize&gt; can be any of
-768, 1024, 2048, 3072 or 4096. Returns undef if there was an error,
+1024, 2048, 3072 or 4096. Returns undef if there was an error,
 otherwise returns a filehandle that reports the progress of the key
 generation process similar to the way GnuPG does. The key generation
 is not complete till you read an EOF from the returned filehandle.
diff -ur Crypt-GPG-1.52.orig/blib/man3/Crypt::GPG.3pm Crypt-GPG-1.52/blib/man3/Crypt::GPG.3pm
--- Crypt-GPG-1.52.orig/blib/man3/Crypt::GPG.3pm	2005-06-29 11:42:04.000000000 +0200
+++ Crypt-GPG-1.52/blib/man3/Crypt::GPG.3pm	2005-06-29 11:55:54.000000000 +0200
@@ -370,7 +370,7 @@
 .IX Item &#34;keygen&#40;$name, $email, $keytype, $keysize, $expire, $passphrase&#41;&#34;
 Creates a new keypair with the parameters specified. The only
 supported \fB$keytype\fR currently is &#39;\s-1ELG\-E\s0&#39;. \fB$keysize\fR can be any of
-768, 1024, 2048, 3072 or 4096. Returns undef if there was an error,
+1024, 2048, 3072 or 4096. Returns undef if there was an error,
 otherwise returns a filehandle that reports the progress of the key
 generation process similar to the way GnuPG does. The key generation
 is not complete till you read an \s-1EOF\s0 from the returned filehandle.
diff -ur Crypt-GPG-1.52.orig/t/01-keygen.t Crypt-GPG-1.52/t/01-keygen.t
--- Crypt-GPG-1.52.orig/t/01-keygen.t	2005-02-23 10:12:55.000000000 +0100
+++ Crypt-GPG-1.52/t/01-keygen.t	2005-06-29 11:58:18.000000000 +0200
@@ -39,7 +39,7 @@

 # Start test loop with different key sizes/types
 ################################################
-for my $bits qw&#40;768 1024 2048&#41; {
+for my $bits qw&#40;1024 2048&#41; {
   for my $type &#40;&#39;ELG-E&#39;&#41; {

     # Generate key pair
diff -ur Crypt-GPG-1.52.orig/t/03-export.t Crypt-GPG-1.52/t/03-export.t
--- Crypt-GPG-1.52.orig/t/03-export.t	2005-02-23 10:12:56.000000000 +0100
+++ Crypt-GPG-1.52/t/03-export.t	2005-06-29 11:58:18.000000000 +0200
@@ -28,7 +28,7 @@

 # Start test loop with different key sizes/types
 ################################################
-for my $bits qw&#40;768 1024 2048&#41; {
+for my $bits qw&#40;1024 2048&#41; {
   for my $type &#40;&#39;ELG-E&#39;&#41; {

     # Export our public key
diff -ur Crypt-GPG-1.52.orig/t/04-encdec.t Crypt-GPG-1.52/t/04-encdec.t
--- Crypt-GPG-1.52.orig/t/04-encdec.t	2005-02-23 10:12:56.000000000 +0100
+++ Crypt-GPG-1.52/t/04-encdec.t	2005-06-29 11:58:18.000000000 +0200
@@ -29,7 +29,7 @@

 # Start test loop with different key sizes/types
 ################################################
-for my $bits qw&#40;768 1024 2048&#41; {
+for my $bits qw&#40;1024 2048&#41; {
   for my $type &#40;&#39;ELG-E&#39;&#41; {

     my &#40;$secretkey&#41; = grep { $_-&gt;{Type} =~ /^sec[^\@]?/ } $gpg-&gt;keyinfo&#40;&#34;A $bits $type&#34;&#41;;
diff -ur Crypt-GPG-1.52.orig/t/05-sigver.t Crypt-GPG-1.52/t/05-sigver.t
--- Crypt-GPG-1.52.orig/t/05-sigver.t	2005-02-23 10:12:57.000000000 +0100
+++ Crypt-GPG-1.52/t/05-sigver.t	2005-06-29 11:58:18.000000000 +0200
@@ -29,7 +29,7 @@

 # Start test loop with different key sizes/types
 ################################################
-for my $bits qw&#40;768 1024 2048&#41; {
+for my $bits qw&#40;1024 2048&#41; {
   for my $type &#40;&#39;ELG-E&#39;&#41; {

     my &#40;$secretkey&#41; = grep { $_-&gt;{Type} =~ /^sec[^\@]?/ } $gpg-&gt;keyinfo&#40;&#34;A $bits $type&#34;&#41;;
diff -ur Crypt-GPG-1.52.orig/t/06-keyops.t Crypt-GPG-1.52/t/06-keyops.t
--- Crypt-GPG-1.52.orig/t/06-keyops.t	2005-02-23 10:12:57.000000000 +0100
+++ Crypt-GPG-1.52/t/06-keyops.t	2005-06-29 11:58:18.000000000 +0200
@@ -36,7 +36,7 @@

 # Start test loop with different key sizes/types
 ################################################
-for my $bits qw&#40;768 1024 2048&#41; {
+for my $bits qw&#40;1024 2048&#41; {
   for my $type &#40;&#39;ELG-E&#39;&#41; {

     my @mykeys = $gpg-&gt;keyinfo&#40;&#34;A $bits $type&#34;&#41;;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;14:03:55&nbsp;2007</span>
    <span class="description">robertojimenoca [...] terra.es -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> robertojimenoca [...] terra.es</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Jue. Jul. 07 05:05:03 2005, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Of course I forgot the attachment
</div>
The patch is already included in latest Crypt::GPG release.
The bug should be closed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;14:03:58&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;10&nbsp;06:20:55&nbsp;2007</span>
    <span class="description">AGUL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">All fixed in 1.61
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;10&nbsp;06:21:27&nbsp;2007</span>
    <span class="description">AGUL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;10&nbsp;06:22:09&nbsp;2007</span>
    <span class="description">AGUL [...] cpan.org -  Given to AGUL</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
