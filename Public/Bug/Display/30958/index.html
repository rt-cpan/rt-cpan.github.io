<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30958 for File-MimeInfo: File::MimeInfo text/plain heuristics broken</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30958 for File-MimeInfo: File::MimeInfo text/plain heuristics broken</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=File-MimeInfo">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=File-MimeInfo">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=File-MimeInfo">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=File-MimeInfo">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/mbeijen/File-MimeInfo/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-MimeInfo">File-MimeInfo CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30958</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=File-MimeInfo">File-MimeInfo</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kas [...] fi.muni.cz

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12968-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.14    </td>
  </tr>
  <tr id="CF-12969-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.12    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=30958">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-386923" href="/Public/Bug/Display.html?id=30958#txn-386923">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;24&nbsp;16:17:28&nbsp;2007</span>
    <span class="description">kas [...] fi.muni.cz -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> File::MimeInfo text/plain heuristics broken</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/386923/177608/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177608">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The heuristics for distinguishing between text/plain and
application/octet-stream in MimeInfo.pm is broken. It works differently
when the file is passed in as a file name, than when the file is passed
in as a filehandle.

The test case:
- create a file which is not UTF-8 encoded but contains only printable
Latin-&lt;n&gt; characters &#40;i.e. not in [\x00-\x1f\x7f] except \t, \r, and \n&#41;:
$ perl -e &#39;open my $fh, &#34;&gt;/tmp/xxx&#34;; print $fh &#34;\xb0\xb1\xb2\xf2&#34;&#39;

$ perl -MFileHandle -MFile::MimeInfo::Magic -e &#39;print
mimetype&#40;&#34;/tmp/xxx&#34;&#41;, &#34;\n&#34;&#39;
text/plain

- so far it is good, however:

$ $ perl -MFileHandle -MFile::MimeInfo::Magic -e &#39;open my $fh, &#34;&lt;&#34;,
&#34;/tmp/xxx&#34;; print mimetype&#40;$fh&#41;, &#34;\n&#34;&#39;
application/octet-stream

- this is incorrect &#40;at least the results should be the same; but I
think text/plain is the correct choice&#41;.

It worked correctly in 0.12, and it is broken in 0.14. The reason is
that 0.14 tries to run &#34;binmode FILE, &#39;:utf8&#39;&#34; when the file is given as
a file name, but not when it is given as a filehandle &#40;which is probably
a good approach, it should not mess with the I/O layer settings of a
someone else&#39;s filehandle&#41;. However, the result is incorrect detection
of plain text files when given as a filehandle.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-387010" href="/Public/Bug/Display.html?id=30958#txn-387010">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;25&nbsp;05:53:33&nbsp;2007</span>
    <span class="description">j.g.karssenberg [...] student.utwente.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #30958] File::MimeInfo text/plain heuristics broken</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 25 Nov 2007 11:52:50 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-File-MimeInfo [...] rt.cpan.org&gt;, &lt;undisclosed-recipients:;&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;j.g.karssenberg [...] student.utwente.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/387010/177650/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177650">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 463b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I do not agree that this is a bug. When a file handle is given through the API I assume that whoever opened the file knows best what the encoding is. When you are handling a utf8 file using non-utf8 binmode probably the rest of your program will also see control characters, not plain text, so the mimetype is a good result. What I can do is to add a recommendation to use binmode utf8 for filehandles in the documentation.

Regards,

Jaap &lt;pardus@cpan.org&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-387011" href="/Public/Bug/Display.html?id=30958#txn-387011">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;25&nbsp;05:53:38&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-387037" href="/Public/Bug/Display.html?id=30958#txn-387037">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;25&nbsp;06:42:39&nbsp;2007</span>
    <span class="description">kas [...] fi.muni.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kas [...] informatics.muni.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/387037/177656/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177656">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 816b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne ne 25.lis.2007 05:53:33, j.g.karssenberg@student.utwente.nl napsal&#40;a&#41;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I do not agree that this is a bug. When a file handle is given through
&gt;    the API I assume that whoever opened the file knows best what the
&gt;    encoding is.
</div>
This is ridiculous: we are inside a module which is designed to _guess_
what the MIME type is. So I don&#39;t think the caller necessarily has to
have any idea of which encoding the filehandle has. I still think tasks
like &#34;what MIME type my STDIN is&#34; are legal tasks which
File::MimeInfo::Magic should be able to perform.

I think the correct solution would be to duplicate the filehandle and
set its own I/O layer using something like

open my $fh, &#34;&lt;&#38;&#34;, $filehandle;
binmode $fh, &#39;:utf8&#39; if $] &gt;= 5.008
... do the magic using [:printable:] or /[\x0-\x1f\x7f]/ ...
close $fh;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-387050" href="/Public/Bug/Display.html?id=30958#txn-387050">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;25&nbsp;07:08:03&nbsp;2007</span>
    <span class="description">j.g.karssenberg [...] student.utwente.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #30958] File::MimeInfo text/plain heuristics broken</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 25 Nov 2007 13:07:45 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-File-MimeInfo [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;j.g.karssenberg [...] student.utwente.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/387050/177661/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177661">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, depends on the use case. E.g. if you take a file from STDIN that can be any type and you want to open it, you should save to a file anyway because external programs also need a file to open. If you read data from STDIN to use internally in your program you usually already have a subset of filetypes that you can handle, if that subset is text based or contains text based types you should think about setting the right encoding. Please keep in mind that the MimeInfo module does not and should not guess character encoding.

I do admit that my use of utf8 is an extension of the actual spec. The spec says to check for ascii control chars and ignore all chars with the high bit set because they are probably ascii. However I wanted to use the perl definition of utf8 chars as a more sophisticated way to do this. If I reverse the behavior to what the spec states both cases in your example would work.

Please provide a detailed use case for a situation where you should not be concerned with char sets where this default method poses a problem. In case of doubt I will reverse behavior to what the spec requires, but at the moment I do not see a direct reason for that.

Regards,

Jaap &lt;pardus@cpan.org&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-387114" href="/Public/Bug/Display.html?id=30958#txn-387114">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;25&nbsp;15:32:46&nbsp;2007</span>
    <span class="description">kas [...] fi.muni.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/387114/177698/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177698">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 890b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne ne 25.lis.2007 07:08:03, j.g.karssenberg@student.utwente.nl napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please provide a detailed use case for a situation where you should
&gt;    not be concerned with char sets where this default method poses a
&gt;    problem. In case of doubt I will reverse behavior to what the spec
&gt;    requires, but at the moment I do not see a direct reason for that.
</div>
I have ran into this problem in the web-based information system, where
I use File::MimeInfo::Magic for guessing the MIME type of uploaded
files. The inner workings of this system give me only a filehandle
&#40;altough a seekable one&#41; to guess the MIME type. When mimetype&#40;&#41; returns
text/*, only then I try to guess the file charset by my own heuristics
&#40;based on what languages and charsets are primarily used in this system,
etc.&#41;. If I get the MIME type of application/octet-stream, I do not try
to do anything else with the file.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-387188" href="/Public/Bug/Display.html?id=30958#txn-387188">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;25&nbsp;20:20:52&nbsp;2007</span>
    <span class="description">j.g.karssenberg [...] student.utwente.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #30958] File::MimeInfo text/plain heuristics broken</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Nov 2007 02:20:29 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-File-MimeInfo [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;j.g.karssenberg [...] student.utwente.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/387188/177733/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177733">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 687b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The correct way of working would be to guess the encoding before you run the default method. Without info on the encoding the result of the default function is not trustworthy anyway. For example you might have an encoding which uses character codes which happen to be control chars in ascii or utf8, in that case the default method does not return text/plain, and you do not try to read it.
 
What you should do is first call magic&#40;&#41; on the file handle, this will return a mimetype or undef. If you get undef, you try to guess the encoding. Only after setting the encoding for the filehandle can you call default&#40;&#41; to check if it is indeed plain text.
 
Regards,
 
Jaap pardus@cpan.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-387222" href="/Public/Bug/Display.html?id=30958#txn-387222">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;04:29:44&nbsp;2007</span>
    <span class="description">kas [...] fi.muni.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kas [...] informatics.muni.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/387222/177758/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177758">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 807b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne ne 25.lis.2007 20:20:52, j.g.karssenberg@student.utwente.nl napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The correct way of working would be to guess the encoding before you
&gt;    run the default method. Without info on the encoding the result of
&gt;    the default function is not trustworthy anyway. For example you
&gt;    might have an encoding which uses character codes which happen to
&gt;    be control chars in ascii or utf8, in that case the default method
&gt;    does not return text/plain, and you do not try to read it.
</div>
Well, I am not aware of any such strange encoding, which is used in real
life &#40;maybe UTF-16, but nobody here uses that&#41;.

The problem is that you do the heuristics anyway, but only when the file
name &#40;and not file handle&#41; is given to mimetype&#40;&#41;. I still think both
should work the same way &#40;as it did in 0.12&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-421883" href="/Public/Bug/Display.html?id=30958#txn-421883">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;04:00:46&nbsp;2008</span>
    <span class="description">pardus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/421883/206063/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/206063">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 62b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Added documentation to warn about this issue, no code changed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-421885" href="/Public/Bug/Display.html?id=30958#txn-421885">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;04:00:48&nbsp;2008</span>
    <span class="description">pardus [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.526469</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
