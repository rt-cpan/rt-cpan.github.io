<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63501 for Term-ShellUI: Request for an API hook into Term::ShellUI&#39;s exit on Ctrl-D</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63501 for Term-ShellUI: Request for an API hook into Term::ShellUI&#39;s exit on Ctrl-D</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Term-ShellUI">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Term-ShellUI">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Term-ShellUI">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Term-ShellUI">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Term-ShellUI">Term-ShellUI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63501</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Term-ShellUI">Term-ShellUI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Lester Hightower
(no email address)

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-39848-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39849-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Term-ShellUI-eof-exit-hooks-patch.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/863870/447298/Term-ShellUI-eof-exit-hooks-patch.diff">
Sat Dec 04 11:29:00 2010 (3k) by Lester Hightower
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/863733/447218/Term-ShellUI-eof-exit-hooks-patch.diff">
Fri Dec 03 21:01:31 2010 (2.8k) by Lester Hightower
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=63501">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862446" href="/Public/Bug/Display.html?id=63501#txn-862446">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;08:38:13&nbsp;2010</span>
    <span class="description">Lester Hightower -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Request for an API hook into Term::ShellUI&#39;s exit on Ctrl-D</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/862446/446467/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446467">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 584b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">My program has functionality to protect the user from accidentally 
exiting without first saving their work if the database has changed. If 
the user types &#34;quit&#34; or &#34;exit&#34; that works fine, but Term::ShellUI exits 
with the press of Ctrl-D without any way &#40;that I can find&#41; for me to hook 
into that process. I&#39;ve looked at the code and it seems that providing an 
API hook into the exit-on-EOF functionality would be pretty easy. Please 
consider adding such a hook, or, if you&#39;d prefer that I code it and send 
a patch, please reply to this bug to that effect and I will be glad to.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-863701" href="/Public/Bug/Display.html?id=63501#txn-863701">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;17:59:56&nbsp;2010</span>
    <span class="description">BRONSON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/863701/447197/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/447197">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 746b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 01 08:38:13 2010, lester.hightower@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My program has functionality to protect the user from accidentally 
&gt; exiting without first saving their work if the database has changed. 
</div>If 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the user types &#34;quit&#34; or &#34;exit&#34; that works fine, but Term::ShellUI 
</div>exits 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; with the press of Ctrl-D without any way &#40;that I can find&#41; for me to 
</div>hook 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; into that process. I&#39;ve looked at the code and it seems that providing 
</div>an 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; API hook into the exit-on-EOF functionality would be pretty easy. 
</div>Please 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; consider adding such a hook, or, if you&#39;d prefer that I code it and 
</div>send 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a patch, please reply to this bug to that effect and I will be glad 
</div>to.

That sounds very useful.  If you code a patch, I&#39;ll happily integrate 
it!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-863703" href="/Public/Bug/Display.html?id=63501#txn-863703">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;17:59:57&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-863733" href="/Public/Bug/Display.html?id=63501#txn-863733">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;21:01:31&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/863733/447217/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/447217">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Dec 01 08:38:13 2010, lester.hightower@gmail.com wrote:
&gt;
<div class="message-stanza open">&gt; &gt; My program has functionality to protect the user from accidentally
&gt; &gt; exiting without first saving their work if the database has 
&gt; &gt; changed.  If the user types &#34;quit&#34; or &#34;exit&#34; that works fine, but
&gt; &gt; Term::ShellUI exits with the press of Ctrl-D without any way &#40;that
&gt; &gt; I can find&#41; for me to hook into that process. I&#39;ve looked at the
&gt; &gt; code and it seems that providing an API hook into the exit-on-EOF
&gt; &gt; functionality would be pretty easy.  Please consider adding such a
&gt; &gt; hook, or, if you&#39;d prefer that I code it and send a patch, please
&gt; &gt; reply to this bug to that effect and I will be glad to.
</div></div>
On Fri Dec 03 17:59:56 2010, BRONSON wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That sounds very useful.  If you code a patch, I&#39;ll happily
&gt; integrate it!
</div>

Scott,

A unified diff of the patch is attached. In addition to the new 
feature, I fixed a few minor POD errors that perldoc was complaining
about. If I did what I intended to do, you should be able to apply
this patch and immediately ship a 0.87 version.

Sincerely,
Lester Hightower
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Term-ShellUI-eof-exit-hooks-patch.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/863733/447218/Term-ShellUI-eof-exit-hooks-patch.diff">Download Term-ShellUI-eof-exit-hooks-patch.diff</a><br />
<span class="downloadcontenttype">text/x-diff 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/share/perl5/Term/ShellUI-orig.pm	2010-12-03 20:13:35.000000000 -0500
+++ /usr/share/perl5/Term/ShellUI.pm	2010-12-03 20:46:42.000000000 -0500
@@ -12,7 +12,7 @@
 use Text::Shellwords::Cursor;
 
 use vars qw&#40;$VERSION&#41;;
-$VERSION = &#39;0.86&#39;;
+$VERSION = &#39;0.87&#39;;
 
 
 =head1 NAME
@@ -858,7 +858,7 @@
     my $OUT = $self-&gt;{&#39;OUT&#39;};
 
 	my $rawline = &#34;&#34;;
-	for&#40;;;&#41; {
+	INPUT_LOOP: for&#40;;;&#41; {
 		my $prompt = $self-&gt;prompt&#40;&#41;;
 		$prompt = $prompt-&gt;[length $rawline ? 1 : 0] if ref $prompt eq &#39;ARRAY&#39;;
 		$prompt = $prompt-&gt;&#40;$self, $rawline&#41; if ref $prompt eq &#39;CODE&#39;;
@@ -866,6 +866,14 @@
 
 		# EOF exits
 		unless&#40;defined $newline&#41; {
+			# If we have eof_exit_hooks let them have a say
+			if &#40;scalar&#40;@{$self-&gt;{eof_exit_hooks}}&#41;&#41; {
+				foreach my $sub &#40;@{$self-&gt;{eof_exit_hooks}}&#41; {
+					if &#40;&#38;$sub&#40;&#41;&#41; {
+						next INPUT_LOOP;
+					}
+				}
+			}
 			print $OUT &#34;\n&#34;;
 			$self-&gt;exit_requested&#40;1&#41;;
 			return undef;
@@ -1047,6 +1055,30 @@
 
 sub exit_requested { return shift-&gt;getset&#40;&#39;done&#39;, shift&#41;; }
 
+=item add_eof_exit_hook&#40;subroutine_reference&#41;
+
+Call this method to add a subroutine as a hook into Term::ShellUI&#39;s
+&#34;exit on EOF&#34; &#40;Ctrl-D&#41; functionality. When a user enters Ctrl-D,
+Term::ShellUI will call each function in this hook list, in order,
+and will exit only if all of them return 0. The first function to
+return a non-zero value will stop further processing of these hooks
+and prevent the program from exiting.
+
+The return value of this method is the placement of the hook routine
+in the hook list &#40;1 is first&#41; or 0 &#40;zero&#41; on failure.
+
+=cut
+
+sub add_eof_exit_hook {
+  my $self=shift @_;
+  my $refcode=shift @_;
+  if &#40;ref&#40;$refcode&#41; eq &#39;CODE&#39;&#41; {
+    push &#40;@{$self-&gt;{eof_exit_hooks}}, $refcode&#41;;
+    return scalar @{$self-&gt;{eof_exit_hooks}};
+  }
+  return 0;
+}
+
 =item get_cname&#40;cname&#41;
 
 This is a tiny utility function that turns the cname &#40;array ref
@@ -1064,13 +1096,15 @@
     return join&#40;&#34; &#34;, @$cname&#41;;
 }
 
-
+=back
 
 =head1 OVERRIDES
 
 These are routines that probably already do the right thing.
 If not, however, they are designed to be overridden.
 
+=over
+
 =item blank_line&#40;&#41;
 
 This routine is called when the user inputs a blank line.
@@ -1112,7 +1146,7 @@
     print STDERR @_;
 }
 
-
+=back
 
 =head1 WRITING A COMPLETION ROUTINE
 
@@ -1216,6 +1250,8 @@
 The following are utility routines that your completion function
 can call.
 
+=over
+
 =item completemsg&#40;msg&#41;
 
 your completion routine should call this to display text onscreen
@@ -1327,12 +1363,16 @@
     return $results;
 }
 
+=back
+
 =head1 INTERNALS
 
 These commands are internal to ShellUI.
 They are documented here only for completeness -- you
 should never need to call them.
 
+=over
+
 =item get_deep_command
 
 Looks up the supplied command line in a command hash.
@@ -2022,4 +2062,12 @@
 
 =cut
 
+=head1 OTHER CONTRIBUTORS
+
+Lester Hightower E&lt;lt&gt;hightowe@cpan.orgE&lt;gt&gt;
+
+=cut
+
+1;
+
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-863735" href="/Public/Bug/Display.html?id=63501#txn-863735">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;03&nbsp;21:04:16&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/863735/447220/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/447220">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 220b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">After rt.cpan.org printed my patch back at me I noticed the double &#34;1;&#34; 
lines at the end... sorry about that. So, apply the patch and remove one 
of those -- no harm in leaving it, but it&#39;s surely not needed.

--
Lester
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-863870" href="/Public/Bug/Display.html?id=63501#txn-863870">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;04&nbsp;11:29:00&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/863870/447297/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/447297">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 158b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Scott,

I found a small bug in my patch this AM. Please accept the attached file 
which fixes that and also removes the duplicate trailing &#34;1;&#34; ...

--
Lester
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Term-ShellUI-eof-exit-hooks-patch.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/863870/447298/Term-ShellUI-eof-exit-hooks-patch.diff">Download Term-ShellUI-eof-exit-hooks-patch.diff</a><br />
<span class="downloadcontenttype">text/x-diff 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- ShellUI-orig.pm	2010-12-03 20:13:35.000000000 -0500
+++ ShellUI.pm	2010-12-04 11:25:51.000000000 -0500
@@ -12,7 +12,7 @@
 use Text::Shellwords::Cursor;
 
 use vars qw&#40;$VERSION&#41;;
-$VERSION = &#39;0.86&#39;;
+$VERSION = &#39;0.87&#39;;
 
 
 =head1 NAME
@@ -839,6 +839,8 @@
     $self-&gt;{OUT} = $self-&gt;{term}-&gt;OUT || \*STDOUT;
     $self-&gt;{prevcmd} = &#34;&#34;;  # cmd to run again if user hits return
 
+    @{$self-&gt;{eof_exit_hooks}} = &#40;&#41;;
+
     return $self;
 }
 
@@ -858,7 +860,7 @@
     my $OUT = $self-&gt;{&#39;OUT&#39;};
 
 	my $rawline = &#34;&#34;;
-	for&#40;;;&#41; {
+	INPUT_LOOP: for&#40;;;&#41; {
 		my $prompt = $self-&gt;prompt&#40;&#41;;
 		$prompt = $prompt-&gt;[length $rawline ? 1 : 0] if ref $prompt eq &#39;ARRAY&#39;;
 		$prompt = $prompt-&gt;&#40;$self, $rawline&#41; if ref $prompt eq &#39;CODE&#39;;
@@ -866,6 +868,14 @@
 
 		# EOF exits
 		unless&#40;defined $newline&#41; {
+			# If we have eof_exit_hooks let them have a say
+			if &#40;scalar&#40;@{$self-&gt;{eof_exit_hooks}}&#41;&#41; {
+				foreach my $sub &#40;@{$self-&gt;{eof_exit_hooks}}&#41; {
+					if &#40;&#38;$sub&#40;&#41;&#41; {
+						next INPUT_LOOP;
+					}
+				}
+			}
 			print $OUT &#34;\n&#34;;
 			$self-&gt;exit_requested&#40;1&#41;;
 			return undef;
@@ -1047,6 +1057,30 @@
 
 sub exit_requested { return shift-&gt;getset&#40;&#39;done&#39;, shift&#41;; }
 
+=item add_eof_exit_hook&#40;subroutine_reference&#41;
+
+Call this method to add a subroutine as a hook into Term::ShellUI&#39;s
+&#34;exit on EOF&#34; &#40;Ctrl-D&#41; functionality. When a user enters Ctrl-D,
+Term::ShellUI will call each function in this hook list, in order,
+and will exit only if all of them return 0. The first function to
+return a non-zero value will stop further processing of these hooks
+and prevent the program from exiting.
+
+The return value of this method is the placement of the hook routine
+in the hook list &#40;1 is first&#41; or 0 &#40;zero&#41; on failure.
+
+=cut
+
+sub add_eof_exit_hook {
+  my $self=shift @_;
+  my $refcode=shift @_;
+  if &#40;ref&#40;$refcode&#41; eq &#39;CODE&#39;&#41; {
+    push &#40;@{$self-&gt;{eof_exit_hooks}}, $refcode&#41;;
+    return scalar @{$self-&gt;{eof_exit_hooks}};
+  }
+  return 0;
+}
+
 =item get_cname&#40;cname&#41;
 
 This is a tiny utility function that turns the cname &#40;array ref
@@ -1064,13 +1098,15 @@
     return join&#40;&#34; &#34;, @$cname&#41;;
 }
 
-
+=back
 
 =head1 OVERRIDES
 
 These are routines that probably already do the right thing.
 If not, however, they are designed to be overridden.
 
+=over
+
 =item blank_line&#40;&#41;
 
 This routine is called when the user inputs a blank line.
@@ -1112,7 +1148,7 @@
     print STDERR @_;
 }
 
-
+=back
 
 =head1 WRITING A COMPLETION ROUTINE
 
@@ -1216,6 +1252,8 @@
 The following are utility routines that your completion function
 can call.
 
+=over
+
 =item completemsg&#40;msg&#41;
 
 your completion routine should call this to display text onscreen
@@ -1327,12 +1365,16 @@
     return $results;
 }
 
+=back
+
 =head1 INTERNALS
 
 These commands are internal to ShellUI.
 They are documented here only for completeness -- you
 should never need to call them.
 
+=over
+
 =item get_deep_command
 
 Looks up the supplied command line in a command hash.
@@ -2022,4 +2064,10 @@
 
 =cut
 
+=head1 OTHER CONTRIBUTORS
+
+Lester Hightower E&lt;lt&gt;hightowe@cpan.orgE&lt;gt&gt;
+
+=cut
+
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-870692" href="/Public/Bug/Display.html?id=63501#txn-870692">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;18&nbsp;09:23:53&nbsp;2010</span>
    <span class="description">Lester Hightower -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lester.hightower [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/870692/450906/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/450906">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 163b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Scott,

Is there a format other than unified diff that you would prefer to get 
this patch in or can I help in any other way to get 0.87 released?

Thanks,

Lester
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-912091" href="/Public/Bug/Display.html?id=63501#txn-912091">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;20&nbsp;04:52:42&nbsp;2011</span>
    <span class="description">BRONSON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/912091/473080/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/473080">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 341b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry Lester, I haven&#39;t been using Perl lately much less Term::ShellUI!

Nice patch, merged.

I also found some time to clean up some things that were bothering me and 
release a 0.9.  It&#39;s now on Github so you can just fork it and go nuts.  
It might be years before I look at this module again.  :&#41;

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bronson/Term-ShellUI">https://github.com/bronson/Term-ShellUI</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-919565" href="/Public/Bug/Display.html?id=63501#txn-919565">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;05&nbsp;18:44:07&nbsp;2011</span>
    <span class="description">hightowe [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/919565/477078/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/477078">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 851b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Mar 20 04:52:42 2011, BRONSON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry Lester, I haven&#39;t been using Perl lately much less 
</div>Term::ShellUI!
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Nice patch, merged.
&gt; 
&gt; I also found some time to clean up some things that were bothering me 
</div>and 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; release a 0.9.  It&#39;s now on Github so you can just fork it and go 
</div>nuts.  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It might be years before I look at this module again.  :&#41;
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bronson/Term-ShellUI">https://github.com/bronson/Term-ShellUI</a></span>
</div>
Scott,

I really like your work in Term::ShellUI. If you truly think that it 
will be years before you would work on this module again, I would not 
mind taking over maintainership of it, either entirely or in addition to 
you. I would personally prefer to not fork the code. I am not sure how 
CPAN/PAUSE handles changing or adding module owners &#40;would need to 
investigate that&#41;, but I am willing if that interests you...

Sincerely,

Lester
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-919568" href="/Public/Bug/Display.html?id=63501#txn-919568">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;05&nbsp;18:49:34&nbsp;2011</span>
    <span class="description">bronson [...] rinspin.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #63501] Request for an API hook into Term::ShellUI&#39;s exit on Ctrl-D</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 5 Apr 2011 15:49:24 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Term-ShellUI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott Bronson &lt;bronson [...] rinspin.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/919568/477081/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/477081">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Lester.  There are a number of cleanups I&#39;d like to make but, since
I don&#39;t have any projects actually using Term::ShellUI right now, it&#39;s
rather hard to find the time.  I&#39;m happy to hand over the reins.

There appears to be a full-on fork in the works with some excellent
features...  Not sure if they&#39;ll be rolled back into a massively
improved Term::ShellUI or if it will just remain a fork.  Hit me up by
email and I&#39;ll get you in touch with the author:
brons_cpan02@rinspin.com


On Tue, Apr 5, 2011 at 3:44 PM, Lester Hightower via RT
&lt;bug-Term-ShellUI@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Â  Â  Â  Queue: Term-ShellUI
&gt; Â Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=63501">https://rt.cpan.org/Ticket/Display.html?id=63501</a></span> &gt;
&gt;
&gt; On Sun Mar 20 04:52:42 2011, BRONSON wrote:
<div class="message-stanza open">&gt;&gt; Sorry Lester, I haven&#39;t been using Perl lately much less
</div>&gt; Term::ShellUI!
<div class="message-stanza open">&gt;&gt;
&gt;&gt; Nice patch, merged.
&gt;&gt;
&gt;&gt; I also found some time to clean up some things that were bothering me
</div>&gt; and
<div class="message-stanza open">&gt;&gt; release a 0.9. Â It&#39;s now on Github so you can just fork it and go
</div>&gt; nuts.
<div class="message-stanza open">&gt;&gt; It might be years before I look at this module again. Â :&#41;
&gt;&gt;
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bronson/Term-ShellUI">https://github.com/bronson/Term-ShellUI</a></span>
</div>&gt;
&gt; Scott,
&gt;
&gt; I really like your work in Term::ShellUI. If you truly think that it
&gt; will be years before you would work on this module again, I would not
&gt; mind taking over maintainership of it, either entirely or in addition to
&gt; you. I would personally prefer to not fork the code. I am not sure how
&gt; CPAN/PAUSE handles changing or adding module owners &#40;would need to
&gt; investigate that&#41;, but I am willing if that interests you...
&gt;
&gt; Sincerely,
&gt;
&gt; Lester
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936219" href="/Public/Bug/Display.html?id=63501#txn-936219">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;21:14:16&nbsp;2011</span>
    <span class="description">BRONSON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/936219/486096/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/486096">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 239b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The new project is now public: Term::CiscoCLI <span class="clickylink"><a target="new" rel="nofollow" href="http://ciscocli.sf.net/">http://ciscocli.sf.net/</a></span>

However, it like there&#39;s enough interest in Term::ShellUI that it will 
stick around for a while yet.  As long as patches are flowing in, I&#39;ll 
keep producing releases.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936221" href="/Public/Bug/Display.html?id=63501#txn-936221">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;21:14:17&nbsp;2011</span>
    <span class="description">BRONSON [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.639305</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
