<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #2326 for WWW-Mechanize: Selecting buttons to click&#40;&#41;: asking for the button name isn&#39;t always sufficient</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #2326 for WWW-Mechanize: Selecting buttons to click&#40;&#41;: asking for the button name isn&#39;t always sufficient</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/WWW-Mechanize/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/WWW-Mechanize/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/libwww-perl/WWW-Mechanize/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-Mechanize">WWW-Mechanize CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">2326</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/WWW-Mechanize/Active/">WWW-Mechanize</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
frag [...] ripco.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-36214-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.38    </td>
  </tr>
  <tr id="CF-36215-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;15:10:00&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Selecting buttons to click&#40;&#41;: asking for the button name isn&#39;t
    always sufficient</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve got a form with two submit buttons; the one that you click
changes the run_mode parameter in the submission.  &#40;This is useful for
CGI::Application.&#41;  Thus, both submit buttons have a name of &#39;mode&#39;,
and different values.

click&#40;&#41; takes the name of a button, but that&#39;s all.  This works fine
if I want to click the first &#39;mode&#39; button, but there&#39;s no means to
press the second button.

The documentation for HTML::Form says that when you&#39;ve got multiple
inputs with the same name, that you should use find_input&#40;name,
form_element_type, index&#41; to get the button:

  my $button = $agent-&gt;{form}-&gt;find_input&#40;&#39;mode&#39;, &#39;submit&#39;, 2&#41;;

and then click that.  Integrating this with WWW::Mechanize, I&#39;ve
hacked up this:

=head2 $agent-&gt;find_input_and_click&#40;$button, $index, $type, $x, $y&#41;;

Searches the form for a specific button, and then clicks it.

The first argument is the name of the button to be clicked.
The second and third arguments allow you to specify the
index number and element type of the desired button.  &#40;If omitted,
they default to &#39;1&#39; and &#39;submit&#39;, respectively.&#41;  The fourth and 
fifth arguments &#40;also optional&#41; specify the &#40;x,y&#41; coordinates of 
the click.

Returns an HTTP::Response object.

=cut

sub find_input_and_click {
    my &#40;$self, $name, $number, $type, $x, $y&#41; = @_;
    for &#40;$x, $y&#41; { $_ = 1 unless defined; }
    $type ||= &#39;submit&#39;;
    $self-&gt;{uri} = $self-&gt;{form}-&gt;uri;
    my $button = $self-&gt;{form}-&gt;find_input&#40;$name, $type, $number&#41;;
    $self-&gt;{req} = $button-&gt;click&#40;$self-&gt;{form}, $x, $y&#41;;
    return $self-&gt;_do_request&#40;&#41;;
}

# N.b.: $number doesn&#39;t get defaulted to 1 in this method, but in
# HTML::Form::find_input&#40;&#41;.

The one big problem can see with this, is that I&#39;d also like to have a &#39;find_input_by_value_and_click&#40;&#41;&#39; &#40;ugh&#41;.  Maybe it&#39;d be better to 
provide simple wrappers to find_input/find_input_by_value from HTML::Form:

  sub find_input {
      my &#40;$self, $name, $type, $number&#41; = @_;
      return $self-&gt;{form}-&gt;find_input&#40;$name, $type, $number&#41;;
  }
  sub find_input_by_value {
      my &#40;$self, $name, $type, $value&#41; = @_;
      return $self-&gt;{form}-&gt;find_input_by_value&#40;$name, $type, $value&#41;;
  }

...and then just expand click&#40;&#41; to take a button ref:

  sub click {
      my &#40;$self, $button, $x, $y&#41; = @_;
      for &#40;$x, $y&#41; { $_ = 1 unless defined; }
      $self-&gt;_push_page_stack&#40;&#41;;
      $self-&gt;{uri} = $self-&gt;{form}-&gt;uri;
      if &#40;$button and ref&#40;$button&#41;
          and ref&#40;$button&#41; eq &#39;HTML::Form::SubmitInput&#39;&#41; {
        $self-&gt;{req} = $button-&gt;click&#40;$self-&gt;{form}, $x, $y&#41;;
      } else {
        $self-&gt;{req} = $self-&gt;{form}-&gt;click&#40;$button, $x, $y&#41;;
      }
      return $self-&gt;_do_request&#40;&#41;;
  }

&#40;Or else have a distinct click_button&#40;&#41; method that only takes the 
button object, leaving the regular click&#40;&#39;button name string&#39;&#41; alone.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;15:14:10&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> frag [...] ripco.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Tue Apr  1 15:10:00 2003]:

   sub click {
       my &#40;$self, $button, $x, $y&#41; = @_;
       for &#40;$x, $y&#41; { $_ = 1 unless defined; }
       $self-&gt;_push_page_stack&#40;&#41;;
       $self-&gt;{uri} = $self-&gt;{form}-&gt;uri;
       if &#40;$button and ref&#40;$button&#41;

# D&#39;oh!:
#           and ref&#40;$button&#41; eq &#39;HTML::Form::SubmitInput&#39;&#41; {
            and $button-&gt;isa&#40;&#39;HTML::Form::SubmitInput&#39;&#41;&#41; {

# ... or even maybe UNIVERSAL::isa&#40;$button, &#39;...&#39;&#41;, in case
#     $button isn&#39;t blessed?  

         $self-&gt;{req} = $button-&gt;click&#40;$self-&gt;{form}, $x, $y&#41;;
       } else {
         $self-&gt;{req} = $self-&gt;{form}-&gt;click&#40;$button, $x, $y&#41;;
       }
       return $self-&gt;_do_request&#40;&#41;;
   }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;13&nbsp;22:00:49&nbsp;2003</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mark [...] summersault.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ll find this feature very useful as well.  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;20&nbsp;21:50:41&nbsp;2003</span>
    <span class="description">andy [...] petdance.com -  Ticket 2326 RefersTo ticket 2281.</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;18&nbsp;21:16:50&nbsp;2004</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;18&nbsp;21:17:30&nbsp;2004</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
