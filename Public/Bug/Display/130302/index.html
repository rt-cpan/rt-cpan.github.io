<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #130302 for Scalar-List-Utils: uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #130302 for Scalar-List-Utils: uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Scalar-List-Utils/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Scalar-List-Utils/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Scalar-List-Utils/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Scalar-List-Utils/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Scalar-List-Utils">Scalar-List-Utils CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">130302</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Scalar-List-Utils/Active/">Scalar-List-Utils</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sisyphus [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-28278-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.51    </td>
  </tr>
  <tr id="CF-28279-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;15&nbsp;00:31:47&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

&#40;I believe the below fix would also have fixed the failing test referred to in <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=134358">https://rt.perl.org/Ticket/Display.html?id=134358</a></span> and <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=130277">https://rt.cpan.org/Ticket/Display.html?id=130277</a></span> without the need to apply the github Issue 78 pull request.&#41; 

The following one-liner should return 2:

C:\&gt;perl -Mblib -MList::Util -le &#34;$n = List::Util::uniqnum&#39;1.73205080756888&#39;, &#39;1.7320508075688772&#39;&#41;; print $n; &#34;

But for perls whose nvtype is double, it returns 1.

This happens because of this line ListUtil.xs:

sv_setpvf&#40;keysv, &#34;%.15&#34; NVgf, SvNV&#40;arg&#41;&#41;;

For reliability on such &#40;nvtype = double&#41; perls the &#34;15&#34; needs to be increased to at least &#34;17&#34;.

When that is done, the one-liner returns the correct value of 2.

However, on perls where nvtype is other than double, the value of &#34;17&#34; is also likely to be insufficient.
For perls whose NV is the extended precision long double, the value needs to be at least &#34;21&#34;.
And for perls whose NV is __float128 or IEEE long double, the value needs to be at least &#34;36&#34;.

A simple fix is to change the offending line to:

sv_setpvf&#40;keysv, &#34;%.36&#34; NVgf, SvNV&#40;arg&#41;&#41;;

and I beleive that will yield correct results irrespective of perl&#39;s nvtype.

Such a solution is, of course, not optimal because it will often be requesting more decimal digits than is actually needed.
A better solution would be to determine the actual minimum value needed &#40;be it 17, 21, or 36&#41; during preprocessing, and install that value into that line of code.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;18&nbsp;08:18:43&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
Attached is a patch &#40;SLU.diff.txt&#41; that:
a&#41; enables t/uniq.t to detect this bug;
b&#41; fixes the bug in an optimal manner.

Cheers,
Rob
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SLU.diff.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Makefile.PL_orig	2019-08-18 11:36:40 +1000
+++ Makefile.PL	2019-08-18 19:57:35 +1000
@@ -7,11 +7,22 @@
 use ExtUtils::MakeMaker;
 my $PERL_CORE = grep { $_ eq &#39;PERL_CORE=1&#39; } @ARGV;
 
+# Determine the correct NV formatting required by uniq&#40;&#41; in ListUtil.xs
+
+my $nvbits;
+
+if&#40;$Config{nvsize} == 8&#41;   { $nvbits =  64 } # double or 8-byte long double
+elsif&#40;length&#40;sqrt 2&#41; &gt; 25&#41; { $nvbits =  128 } # IEEE long double or __float128
+else                       { $nvbits =  80  } # extended precision long double
+
+my $defines = $ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H];
+$defines .= &#34; -DLU_NV_BITS=$nvbits&#34;;
+
 WriteMakefile&#40;
   NAME         =&gt; q[List::Util],
   ABSTRACT     =&gt; q[Common Scalar and List utility subroutines],
   AUTHOR       =&gt; q[Graham Barr &lt;gbarr@cpan.org&gt;],
-  DEFINE       =&gt; &#40;$ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H]&#41;,
+  DEFINE       =&gt; $defines,
   DISTNAME     =&gt; q[Scalar-List-Utils],
   VERSION_FROM =&gt; &#39;lib/List/Util.pm&#39;,
 
--- ListUtil.xs_orig	2019-08-18 11:25:45 +1000
+++ ListUtil.xs	2019-08-18 20:05:59 +1000
@@ -72,6 +72,16 @@
 #define sv_catpvn_flags&#40;b,n,l,f&#41; sv_catpvn&#40;b,n,l&#41;
 #endif
 
+#if   LU_NV_BITS == 64
+#define UNIQ_NV_FORMAT &#34;%.17&#34;
+#elif LU_NV_BITS == 80
+#define UNIQ_NV_FORMAT &#34;%.21&#34;
+#elif LU_NV_BITS == 128
+#define UNIQ_NV_FORMAT &#34;%.36&#34;
+#else
+#error &#34;LU_NV_BITS not set&#34;
+#endif
+
 /* Some platforms have strict exports. And before 5.7.3 cxinc &#40;or Perl_cxinc&#41;
    was not exported. Therefore platforms like win32, VMS etc have problems
    so we redefine it here -- GMB
@@ -1190,7 +1200,7 @@
             else if&#40;SvIOK&#40;arg&#41;&#41;
                 sv_setpvf&#40;keysv, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
             else
-                sv_setpvf&#40;keysv, &#34;%.15&#34; NVgf, SvNV&#40;arg&#41;&#41;;
+                sv_setpvf&#40;keysv, UNIQ_NV_FORMAT NVgf, SvNV&#40;arg&#41;&#41;;
 #ifdef HV_FETCH_EMPTY_HE
             he = &#40;HE*&#41; hv_common&#40;seen, NULL, SvPVX&#40;keysv&#41;, SvCUR&#40;keysv&#41;, 0, HV_FETCH_LVALUE | HV_FETCH_EMPTY_HE, NULL, 0&#41;;
             if &#40;HeVAL&#40;he&#41;&#41;
--- t/uniq.t_orig	2019-08-18 11:03:30 +1000
+++ t/uniq.t	2019-08-18 11:07:46 +1000
@@ -2,8 +2,8 @@
 
 use strict;
 use warnings;
-
-use Test::More tests =&gt; 33;
+use Config; # to determine nvsize
+use Test::More tests =&gt; 35;
 use List::Util qw&#40; uniqnum uniqstr uniq &#41;;
 
 use Tie::Array;
@@ -87,6 +87,57 @@
                &#39;uniqnum distinguishes large floats &#40;stringified&#41;&#39; &#41;;
 }
 
+my &#40;$uniq_count1, $uniq_count2, $equiv&#41;;
+
+if&#40;$Config{nvsize} == 8&#41; {
+  # NV is either &#39;double&#39; or 8-byte &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 1.4142135623730951 == 1.4142135623730954;
+
+  $uniq_count1 = List::Util::uniqnum &#40;1.4142135623730951,
+                                      1.4142135623730954 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;1.4142135623730951&#39;,
+                                     &#39;1.4142135623730954&#39;&#41;;
+}
+
+elsif&#40;length&#40;sqrt&#40;2&#41;&#41; &gt; 25&#41; {
+  # NV is either IEEE &#39;long double&#39; or &#39;__float128&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 1.7320508075688772935274463415058722 == 1.73205080756887729352744634150587224;
+
+  $uniq_count1 = List::Util::uniqnum &#40;1.7320508075688772935274463415058722,
+                                      1.73205080756887729352744634150587224 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;1.7320508075688772935274463415058722&#39;,
+                                     &#39;1.73205080756887729352744634150587224&#39;&#41;;
+}
+
+else {
+  # NV is extended precision &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 2.2360679774997896963 == 2.23606797749978969634;
+
+  $uniq_count1 = List::Util::uniqnum &#40;2.2360679774997896963,
+                                      2.23606797749978969634 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;2.2360679774997896963&#39;,
+                                     &#39;2.23606797749978969634&#39;&#41;;
+}
+
+if&#40;$equiv&#41; {
+  is&#40;$uniq_count1, 1, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 1, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
+else {
+  is&#40;$uniq_count1, 2, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 2, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
 # Hard to know for sure what an Inf is going to be. Lets make one
 my $Inf = 0 + 1E1000;
 my $NaN;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;19&nbsp;00:52:18&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Duh ... can&#39;t believe that I&#39;ve overlooked the case of the DoubleDouble NV, even though it is relatively rare and obscure. I actually find that quite embarrassing :-&#40;

I&#39;ll shortly prepare &#40;and post&#41; another set of patches that include that NV.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;09:33:59&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I see a few problems with this patch.

NVSIZE is already available in XS as the size of NVs.  On newer perls, NVMANTBITS is also available.  You can compute the decimal digits this represents with &#34;2 + int&#40; log10&#40;2&#41; * NVMANTBITS &#41;&#34; or &#34;2 + int&#40; log&#40;2&#41;/log&#40;10&#41;*$Config::Config{nvmantbits} &#41;&#34;.  This may be a better approach than hard coding the values, but you&#39;d still have to fall back to hard coded values.

But I&#39;m not sure if using that length is really the right approach.  Large UV values will still have problems since they will lose precision if converted to floats.

I have a module that provides pure-perl variants of the List::Util functions for use in places where compiling new versions of List::Util isn&#39;t possible, so I&#39;ve had to deal with these same issues.  I&#39;ve written a test to demonstrate what I think the behavior should be, along with an implementation in my module.  The test is here: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/haarg/List-Util-MaybeXS/blob/master/t/uniqnum.t">https://github.com/haarg/List-Util-MaybeXS/blob/master/t/uniqnum.t</a></span>  It hopefully includes enough comments to describe the problems I saw.  It can be run against List::Util by passing the parameter &#39;xs&#39;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;09:34:00&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;23&nbsp;20:44:02&nbsp;2019</span>
    <span class="description">sisyphus359 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;sisyphus [...] cpan.org via RT&#34; &lt;sisyphus [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130302] uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 Aug 2019 19:24:12 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Scalar-List-Utils [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sisyphus &lt;sisyphus359 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Aug 23, 2019 at 10:34 AM sisyphus &lt;sisyphus359@gmail.com&gt; wrote

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll also take a look at the cause of those 7 failures &#40;above&#41;, with a
</div>view to eliminating them.

With additional patching for doubledouble NV types, I&#39;ve now got everything
working fine except for those 7 failures in Graham&#39;s script at
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/haarg/List-Util-MaybeXS/blob/master/t/uniqnum.t">https://github.com/haarg/List-Util-MaybeXS/blob/master/t/uniqnum.t</a></span>  .
It&#39;s only NVs whose size is 8 bytes that are subject to those failures. &#40;No
problems at all with extended precision long double, __float128  or
doubledouble NVs.&#41;

But I&#39;m having trouble envisaging &#40;and locating&#41; the values instrumental in
 the 7 failures.
Are there relevant examples somewhere of List::Util::uniqnum&#40;&#41;  determining
that 2 unique values are the same, or &#40;alternatively&#41; of determining that 2
identical values are different ?

Cheers,
Rob
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;23&nbsp;20:44:04&nbsp;2019</span>
    <span class="description">sisyphus359 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;sisyphus [...] cpan.org via RT&#34; &lt;sisyphus [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130302] uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 Aug 2019 10:34:51 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Scalar-List-Utils [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sisyphus &lt;sisyphus359 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Aug 22, 2019 at 11:34 PM Graham Knop via RT &lt;
bug-Scalar-List-Utils@rt.cpan.org&gt; wrote:
&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=130302">https://rt.cpan.org/Ticket/Display.html?id=130302</a></span> &gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; NVSIZE is already available in XS as the size of NVs.
</div>
I&#39;m guessing that NVSIZE is set to the same value as $Config{nvsize}.
The problem with that value is that, on 64-bit builds of perl, it doesn&#39;t
distinguish between extended precision &#40;80-bit&#41; long doubles and the
128-bit IEEE long doubles.
I know that $Config{longdblkind} is there to help, but it&#39;s only available
on later perl versions &#40;5.22 onwards IIRC&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  You can compute the decimal digits this represents with &#34;2 + int&#40;
</div>log10&#40;2&#41; * NVMANTBITS &#41;&#34; or &#34;2 + int&#40;
log&#40;2&#41;/log&#40;10&#41;*$Config::Config{nvmantbits} &#41;&#34;.

The formula I&#39;ve used to work out how many digits are required is similar
to yours:
1+ceil&#40;P * log&#40;2&#41; / log&#40;10&#41;&#41;
where P is the precision &#40;in bits&#41; of the NV - ie either 53, 64, or 113,
depending upon the type.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On newer perls, NVMANTBITS is also available.
</div>
I didn&#39;t know about NVMANTBITS.
Sadly, even on current perl-5.31.3 it&#39;s incorrect for Windows &#39;long double&#39;
builds that have been compiled by mingw ports of gcc. &#40;It says &#39;52&#39;, though
the correct value is &#39;64&#39;&#41;.
I&#39;ll file a bug report about this - &#39;twould be nice to at least get that
fixed for 5.32.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  This may be a better approach than hard coding the values, but you&#39;d
</div>still have to fall back to hard coded values.

I&#39;m not actually hard coding any values. It&#39;s all handled in the
pre-processing of the XS file.
If the NVSIZE is 8, 17 decimal digits will be requested.
If the NV is an 80-bit long double, 21 digits will be requested.
If it&#39;s neither of those then NVMANTBITS will be 112 and 36 decimal digits
will be requested.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But I&#39;m not sure if using that length is really the right approach.
</div>Large UV values will still have problems since they will lose precision if
converted to floats.

I don&#39;t think my patch will introduce any *new* issues in that regard. All
it&#39;s doing is changing the value of &#34;%.15&#34; in the line:

sv_setpvf&#40;keysv, &#34;%.15&#34; NVgf, SvNV&#40;arg&#41;&#41;;

to either &#34;%.17&#34; or &#34;%.21&#34; or &#34;%.36&#34; - whichever is correct for the
particular type of NV.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have a module that provides pure-perl variants of the List::Util
</div>functions for use in places where compiling new versions of List::Util
isn&#39;t possible, so I&#39;ve had to deal with these same issues.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  I&#39;ve written a test to demonstrate what I think the behavior should be,
</div>along with an implementation in my module.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  The test is here:
</div><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/haarg/List-Util-MaybeXS/blob/master/t/uniqnum.t">https://github.com/haarg/List-Util-MaybeXS/blob/master/t/uniqnum.t</a></span>  It
hopefully includes enough comments to describe the problems I saw.  It can
be run against List::Util by passing the parameter &#39;xs&#39;.

When nvtype is double:
1&#41; your test script fails 89 tests of 181 when run against List-Util-1.52
&#40;tests 1 and 94 onwards&#41;
2&#41; your test script fails 7 tests of 183 when run against my patched
List-Util-1.52 &#40;tests 1, 178-183&#41;

When nvtype is extended precision long double:
1&#41; your test script fails 211 tests of 284 when run against List-Util-1.52
2&#41; your test script fails 0 tests when run against my patched
List-Util-1.52 - presumably partly because the &#40;above mentioned&#41; issue
regarding loss of UV precision does not apply here.

I haven&#39;t yet tested for the __float128 or doubledouble type.

I&#39;m still working on a way of handling the doubledouble. The
stringification of the doubledouble values is flakey and unreliable for
certain values, so I&#39;m putting together a patch that looks instead at the
16 bytes &#40;which will be unique for different values&#41;.
It differs from the original patch only in the way that doubledouble NVs
are handled. All other NVs are still being handled as per the original
patch that I posted.

I&#39;ll also take a look at the cause of those 7 failures &#40;above&#41;, with a view
to eliminating them.

Cheers,
Rob
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;25&nbsp;08:25:33&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok - revised patch &#40;constructed against S-L-U-1.52 is attached.
I&#39;ve changed tack and,for all NV types, I&#39;ve used the actual NV bytes rather than NV values.
There&#39;s some special treatment handed out for the case where nvsize and ivsize are both 8.

With this patch applied, the test suite &#40;including the 2 tests that I added to t/uniq.t&#41; passes, and all of the tests in the script provided by Graham also pass.

On MS Windows 7, I&#39;ve tested 2 builds of perl-5.30.0 - one had an nvtype of double, the other an nvtype of little-endian extended precision &#40;80-bit&#41; long double.

On Ubuntu-18.04, I&#39;ve tested 3 builds of perl-5.31.3 - one had an nvtype of double, the second had an nvtype of little endian extended precision &#40;80-bit&#41; long double, and the third had an nvtype of __float128.

On FreeBSD-12, I&#39;ve also tested 2 builds of perl-5.31.3 - one with an nvtype of double, the other with a little endian extended precision &#40;80-bit&#41; long double.

On a ppc64 big endian box, running Debian wheezy, I&#39;ve tested two builds of perl-5.31.2 - one with an nvtype of double and one with an nvtype of doubledouble.

On the freebsd system, I notice the following warnings during compilation:

#####################################
ListUtil.xs:1250:29: warning: passing &#39;unsigned char [38]&#39; to parameter of type
      &#39;char *&#39; converts between pointers to integer types with different sign
      [-Wpointer-sign]
                    sprintf&#40;buff, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;
                            ^~~~
/usr/include/stdio.h:287:31: note: passing argument to parameter here
int      sprintf&#40;char * __restrict, const char * __restrict, ...&#41;;
                                  ^
ListUtil.xs:1253:29: warning: passing &#39;unsigned char [38]&#39; to parameter of type
      &#39;char *&#39; converts between pointers to integer types with different sign
      [-Wpointer-sign]
                    sprintf&#40;buff, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
                            ^~~~
/usr/include/stdio.h:287:31: note: passing argument to parameter here
int      sprintf&#40;char * __restrict, const char * __restrict, ...&#41;;
                                  ^
ListUtil.xs:1262:33: warning: passing &#39;unsigned char [38]&#39; to parameter of type
      &#39;char *&#39; converts between pointers to integer types with different sign
      [-Wpointer-sign]
                        sprintf&#40;buff, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
                                ^~~~
/usr/include/stdio.h:287:31: note: passing argument to parameter here
int      sprintf&#40;char * __restrict, const char * __restrict, ...&#41;;
                                  ^
ListUtil.xs:1264:33: warning: passing &#39;unsigned char [38]&#39; to parameter of type
      &#39;char *&#39; converts between pointers to integer types with different sign
      [-Wpointer-sign]
                        sprintf&#40;buff, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;...
                                ^~~~
/usr/include/stdio.h:287:31: note: passing argument to parameter here
int      sprintf&#40;char * __restrict, const char * __restrict, ...&#41;;
                                  ^
ListUtil.xs:1272:29: warning: passing &#39;unsigned char [4]&#39; to parameter of type
      &#39;char *&#39; converts between pointers to integer types with different sign
      [-Wpointer-sign]
                    sprintf&#40;tbuff, &#34;%02x&#34;, &#40;&#40;unsigned char*&#41;p&#41;[i]&#41;;
                            ^~~~~
/usr/include/stdio.h:287:31: note: passing argument to parameter here
int      sprintf&#40;char * __restrict, const char * __restrict, ...&#41;;
                                  ^
ListUtil.xs:1273:28: warning: passing &#39;unsigned char [38]&#39; to parameter of type
      &#39;char *&#39; converts between pointers to integer types with different sign
      [-Wpointer-sign]
                    strcat&#40;buff, tbuff&#41;;
                           ^~~~
/usr/include/string.h:77:31: note: passing argument to parameter here
char    *strcat&#40;char * __restrict, const char * __restrict&#41;;
                                 ^
ListUtil.xs:1273:34: warning: passing &#39;unsigned char [4]&#39; to parameter of type
      &#39;const char *&#39; converts between pointers to integer types with different
      sign [-Wpointer-sign]
                    strcat&#40;buff, tbuff&#41;;
                                 ^~~~~
/usr/include/string.h:77:56: note: passing argument to parameter here
char    *strcat&#40;char * __restrict, const char * __restrict&#41;;
##########################################

I should probably try to silence them. The other systems issued no warnings.

I don&#39;t have access to a big endian extended precision &#40;80-bit&#41; long double, and I don&#39;t know at which end of that structure one finds the unused bytes &#40;which I don&#39;t want to access in case they contain some ad hoc non-zero values&#41;.
Consequently, the Makefile.PL might need correcting, depending upon where those bytes are located.

I also don&#39;t have access to the 128-bit IEEE long double, though I would expect no problems there as the __float128 build passed all tests.

Not sure how optimal my C code that populates the buffer is.
An informed critical eye might see room for improvement there.

Cheers,
Rob 
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SLU.diff2.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Makefile.PL_orig	2019-08-24 11:46:15 +1000
+++ Makefile.PL	2019-08-24 18:58:59 +1000
@@ -7,11 +7,37 @@
 use ExtUtils::MakeMaker;
 my $PERL_CORE = grep { $_ eq &#39;PERL_CORE=1&#39; } @ARGV;
 
+
+my $defines = $ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H];
+
+# Determine the correct NV formatting required by uniq&#40;&#41; in ListUtil.xs
+
+if&#40;$Config{nvsize} == 8&#41;   {      # double or 8-byte long double
+ $defines .= &#34; -DUNIQ_LOOP_START=0 -DUNIQ_LOOP_END=8&#34;;
+ $defines .= &#34; -DUNIQ_PREC_LOSS&#34; if $Config{ivsize} &gt;= 8; # precision loss is possible when
+                                                          # IV/UV is converted to NV
+}
+ 
+elsif&#40;length&#40;sqrt 2&#41; &gt; 25&#41; {      # IEEE long double or __float128 or doubledouble
+  $defines .= &#34; -DUNIQ_LOOP_START=0 -DUNIQ_LOOP_END=16&#34;
+}
+
+else {                            # extended precision long double
+ if&#40;$Config{byteorder} =~ /^1234/&#41; {
+   # little endian
+   $defines .= &#34; -DUNIQ_LOOP_START=0 -DUNIQ_LOOP_END=10&#34;;  # exclude unused bytes
+ }
+ else {
+   # big endian
+   $defines .= &#34; -DUNIQ_LOOP_START=6 -DUNIQ_LOOP_END=16&#34;; # exclude unused bytes
+ }
+}
+
 WriteMakefile&#40;
   NAME         =&gt; q[List::Util],
   ABSTRACT     =&gt; q[Common Scalar and List utility subroutines],
   AUTHOR       =&gt; q[Graham Barr &lt;gbarr@cpan.org&gt;],
-  DEFINE       =&gt; &#40;$ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H]&#41;,
+  DEFINE       =&gt; $defines,
   DISTNAME     =&gt; q[Scalar-List-Utils],
   VERSION_FROM =&gt; &#39;lib/List/Util.pm&#39;,
 
--- ListUtil.xs_orig	2019-08-24 11:45:08 +1000
+++ ListUtil.xs	2019-08-25 21:29:37 +1000
@@ -1152,6 +1152,14 @@
     int index;
     SV **args = &#38;PL_stack_base[ax];
     HV *seen;
+    int i;
+    NV nv_arg;
+    void *p = &#38;nv_arg;
+    unsigned char buff[38];
+    unsigned char tbuff[4];
+#ifdef UNIQ_PREC_LOSS
+    int uvstring, ivstring;
+#endif
 
     if&#40;items == 0 || &#40;items == 1 &#38;&#38; !SvGAMAGIC&#40;args[0]&#41; &#38;&#38; SvOK&#40;args[0]&#41;&#41;&#41; {
         /* Optimise for the case of the empty list or a defined nonmagic
@@ -1185,12 +1193,88 @@
 #endif
             }
 
-            if&#40;!SvOK&#40;arg&#41; || SvUOK&#40;arg&#41;&#41;
-                sv_setpvf&#40;keysv, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;
-            else if&#40;SvIOK&#40;arg&#41;&#41;
-                sv_setpvf&#40;keysv, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
-            else
-                sv_setpvf&#40;keysv, &#34;%.15&#34; NVgf, SvNV&#40;arg&#41;&#41;;
+            /* Assign appropriate value to nv_arg */
+
+            if&#40;!SvOK&#40;arg&#41; || SvUOK&#40;arg&#41;&#41; {
+                nv_arg = &#40;NV&#41;SvUV&#40;arg&#41;;
+#ifdef UNIQ_PREC_LOSS
+                uvstring = 1;
+#endif
+            }
+
+            else if&#40;SvIOK&#40;arg&#41;&#41; {
+                nv_arg = &#40;NV&#41;SvIV&#40;arg&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 1;
+#endif
+            }
+
+            else {
+                nv_arg = SvNV&#40;arg&#41;;
+            }
+
+            /* Handle NaN, zeros and Infs */
+
+            if&#40;nv_arg != nv_arg&#41; {
+                sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;NaN&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+                uvstring = 0;
+#endif
+            }
+
+            else if&#40;nv_arg == 0&#41; {
+                sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;0&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+                uvstring = 0;
+#endif
+            }
+
+            else if&#40;nv_arg/nv_arg != 1&#41; {
+                if&#40;nv_arg &lt; 0&#41; sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;-Inf&#34;&#41;;
+                else sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;Inf&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+                uvstring = 0;
+#endif
+            }
+
+            /* Handle all values other than NaN, zeros and Infs */
+
+            else {
+
+                buff[0] = &#39;\0&#39;;
+#ifdef UNIQ_PREC_LOSS
+                if&#40;uvstring&#41;
+                    sprintf&#40;buff, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;
+
+                else if&#40;ivstring&#41;
+                    sprintf&#40;buff, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
+
+                /* Take appropriate action if nv_arg is within IV and UV bounds */
+
+                else if&#40;ceil&#40;nv_arg&#41; == nv_arg
+                        &#38;&#38;   nv_arg  &lt;= 1.8446744073709552e+19
+                        &#38;&#38;   nv_arg  &gt;= -9.2233720368547758e+18 &#41; { 
+
+                    if&#40;nv_arg &lt; 0&#41;
+                        sprintf&#40;buff, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
+                    else
+                        sprintf&#40;buff, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;                       
+                }
+
+                ivstring = 0;
+                uvstring = 0;
+#endif
+
+                for&#40;i = UNIQ_LOOP_START; i &lt; UNIQ_LOOP_END; i++&#41; {
+                    sprintf&#40;tbuff, &#34;%02x&#34;, &#40;&#40;unsigned char*&#41;p&#41;[i]&#41;;
+                    strcat&#40;buff, tbuff&#41;;
+                }
+
+                sv_setpvf&#40;keysv, &#34;%s&#34;, buff&#41;;
+            }
 #ifdef HV_FETCH_EMPTY_HE
             he = &#40;HE*&#41; hv_common&#40;seen, NULL, SvPVX&#40;keysv&#41;, SvCUR&#40;keysv&#41;, 0, HV_FETCH_LVALUE | HV_FETCH_EMPTY_HE, NULL, 0&#41;;
             if &#40;HeVAL&#40;he&#41;&#41;
--- t/uniq.t_orig	2019-08-24 11:46:43 +1000
+++ t/uniq.t	2019-08-25 20:33:59 +1000
@@ -2,8 +2,8 @@
 
 use strict;
 use warnings;
-
-use Test::More tests =&gt; 33;
+use Config; # to determine nvsize
+use Test::More tests =&gt; 35;
 use List::Util qw&#40; uniqnum uniqstr uniq &#41;;
 
 use Tie::Array;
@@ -87,6 +87,76 @@
                &#39;uniqnum distinguishes large floats &#40;stringified&#41;&#39; &#41;;
 }
 
+my &#40;$uniq_count1, $uniq_count2, $equiv&#41;;
+
+if&#40;$Config{nvsize} == 8&#41; {
+  # NV is either &#39;double&#39; or 8-byte &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 1.4142135623730951 == 1.4142135623730954;
+
+  $uniq_count1 = List::Util::uniqnum &#40;1.4142135623730951,
+                                      1.4142135623730954 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;1.4142135623730951&#39;,
+                                     &#39;1.4142135623730954&#39;&#41;;
+}
+
+elsif&#40;length&#40;sqrt&#40;2&#41;&#41; &gt; 25&#41; {
+  # NV is either IEEE &#39;long double&#39; or &#39;__float128&#39; or doubledouble
+
+  if&#40;1 + &#40;2 ** -1074&#41; != 1&#41; {
+    # NV is doubledouble
+
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 1 + &#40;2 ** -1074&#41; == 1 + &#40;2 ** - 1073&#41;;
+
+    $uniq_count1 = List::Util::uniqnum &#40;1 + &#40;2 ** -1074&#41;,
+                                        1 + &#40;2 ** -1073&#41; &#41;;
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 4.0564819207303340847894502572035e31 == 4.0564819207303340847894502572034e31;
+
+    $uniq_count2 = List::Util::uniqnum&#40;&#39;4.0564819207303340847894502572035e31&#39;,
+                                       &#39;4.0564819207303340847894502572034e31&#39;&#41;;
+  }
+
+  else {
+    # NV is either IEEE &#39;long double&#39; or &#39;__float128&#39;
+
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 1.7320508075688772935274463415058722 == 1.73205080756887729352744634150587224;
+
+    $uniq_count1 = List::Util::uniqnum &#40;1.7320508075688772935274463415058722,
+                                        1.73205080756887729352744634150587224 &#41;;
+
+    $uniq_count2 = List::Util::uniqnum&#40;&#39;1.7320508075688772935274463415058722&#39;,
+                                       &#39;1.73205080756887729352744634150587224&#39;&#41;;
+  }
+}
+
+else {
+  # NV is extended precision &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 2.2360679774997896963 == 2.23606797749978969634;
+
+  $uniq_count1 = List::Util::uniqnum &#40;2.2360679774997896963,
+                                      2.23606797749978969634 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;2.2360679774997896963&#39;,
+                                     &#39;2.23606797749978969634&#39;&#41;;
+}
+
+if&#40;$equiv&#41; {
+  is&#40;$uniq_count1, 1, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 1, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
+else {
+  is&#40;$uniq_count1, 2, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 2, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
 # Hard to know for sure what an Inf is going to be. Lets make one
 my $Inf = 0 + 1E1000;
 my $NaN;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;27&nbsp;09:48:16&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I&#39;ve now silenced the warnings I was seeing on FreeBSD.
I&#39;ve also &#40;hopefully&#41; improved the way that the NV&#39;s internal structure is transferred to the string buffer as hex bytes.

For perl-5.20.x and earlier on MS Windows I discovered that the &#39;uniqnum preserves uniqness of full integer range &#40;stringified&#41;&#39; test needs to be skipped because of the bizarre way that infs and nans are stringified on those particular perls.
AFAICT it&#39;s actually not possible to come up with a string that will numify to NaN, though strings that numify to Infs do exist &#40;eg &#39;1e1000&#39;&#41;.

Graham&#39;s script also needs to be skipped for those builds - for the same reason.

I suppose it would be possible to avoid those skips by rewriting the tests such that Inf strings were written differently and testing involving NaN strings was avoided, but I don&#39;t really see that as being a useful exercise.

I eventually found confirmation &#40;at <span class="clickylink"><a target="new" rel="nofollow" href="https://en.wikipedia.org/wiki/Comparison_of_instruction_set_architectures#Endianness&#41;">https://en.wikipedia.org/wiki/Comparison_of_instruction_set_architectures#Endianness&#41;</a></span> that both little and big endian types start at the lowest indexed byte.
This called for a change in the Makefile.PL to the treatment of the 80-bit long double NVs.

Attached is my latest patch - formulated against Scalar-List-Utils-1.52.
I don&#39;t envisage making any further alterations, though that could change if other problems come to light.

Cheers,
Rob
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SLU.diff3.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Makefile.PL_orig	2019-08-24 11:46:15 +1000
+++ Makefile.PL	2019-08-27 23:21:26 +1000
@@ -7,11 +7,30 @@
 use ExtUtils::MakeMaker;
 my $PERL_CORE = grep { $_ eq &#39;PERL_CORE=1&#39; } @ARGV;
 
+
+my $defines = $ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H];
+
+# Determine the correct NV formatting required by uniq&#40;&#41; in ListUtil.xs
+
+if&#40;$Config{nvsize} == 8&#41;   {      # double or 8-byte long double
+ $defines .= &#34; -DUNIQ_LOOP_START=0 -DUNIQ_LOOP_END=8&#34;;
+ $defines .= &#34; -DUNIQ_PREC_LOSS&#34; if $Config{ivsize} &gt;= 8; # precision loss is possible when
+                                                          # IV/UV is converted to NV
+}
+ 
+elsif&#40;length&#40;sqrt 2&#41; &gt; 25&#41; {      # IEEE long double or __float128 or doubledouble
+  $defines .= &#34; -DUNIQ_LOOP_START=0 -DUNIQ_LOOP_END=16&#34;
+}
+
+else {                            # extended precision long double
+  $defines .= &#34; -DUNIQ_LOOP_START=0 -DUNIQ_LOOP_END=10&#34;;  # ignore unused bytes
+}
+
 WriteMakefile&#40;
   NAME         =&gt; q[List::Util],
   ABSTRACT     =&gt; q[Common Scalar and List utility subroutines],
   AUTHOR       =&gt; q[Graham Barr &lt;gbarr@cpan.org&gt;],
-  DEFINE       =&gt; &#40;$ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H]&#41;,
+  DEFINE       =&gt; $defines,
   DISTNAME     =&gt; q[Scalar-List-Utils],
   VERSION_FROM =&gt; &#39;lib/List/Util.pm&#39;,
 
--- ListUtil.xs_orig	2019-08-24 11:45:08 +1000
+++ ListUtil.xs	2019-08-27 23:23:46 +1000
@@ -72,6 +72,19 @@
 #define sv_catpvn_flags&#40;b,n,l,f&#41; sv_catpvn&#40;b,n,l&#41;
 #endif
 
+#ifdef UNIQ_PREC_LOSS
+#define UNIQ_BUFF_SIZE 37                    /* nvsize == 8, ivsize == 8 */
+
+#elif UNIQ_LOOP_END == 8                     /* nvsize == 8, ivsize &lt; 8 **/
+#define UNIQ_BUFF_SIZE 17
+
+#elif UNIQ_LOOP_END - UNIQ_LOOP_START == 10  /* NV is 10 bytes ***********/
+#define UNIQ_BUFF_SIZE 21
+
+#else
+#define UNIQ_BUFF_SIZE 33                    /* NV is 16 bytes ***********/
+#endif
+
 /* Some platforms have strict exports. And before 5.7.3 cxinc &#40;or Perl_cxinc&#41;
    was not exported. Therefore platforms like win32, VMS etc have problems
    so we redefine it here -- GMB
@@ -1152,6 +1165,14 @@
     int index;
     SV **args = &#38;PL_stack_base[ax];
     HV *seen;
+    size_t i;
+    NV nv_arg;
+    void *p = &#38;nv_arg;
+    char s[UNIQ_BUFF_SIZE];
+    char * buff = s;
+#ifdef UNIQ_PREC_LOSS
+    size_t uvstring = 0, ivstring = 0, offset = 0;
+#endif
 
     if&#40;items == 0 || &#40;items == 1 &#38;&#38; !SvGAMAGIC&#40;args[0]&#41; &#38;&#38; SvOK&#40;args[0]&#41;&#41;&#41; {
         /* Optimise for the case of the empty list or a defined nonmagic
@@ -1185,12 +1206,105 @@
 #endif
             }
 
-            if&#40;!SvOK&#40;arg&#41; || SvUOK&#40;arg&#41;&#41;
-                sv_setpvf&#40;keysv, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;
-            else if&#40;SvIOK&#40;arg&#41;&#41;
-                sv_setpvf&#40;keysv, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
-            else
-                sv_setpvf&#40;keysv, &#34;%.15&#34; NVgf, SvNV&#40;arg&#41;&#41;;
+            /* Assign appropriate value to nv_arg */
+
+            if&#40;!SvOK&#40;arg&#41; || SvUOK&#40;arg&#41;&#41; {
+                nv_arg = &#40;NV&#41;SvUV&#40;arg&#41;;
+#ifdef UNIQ_PREC_LOSS
+                uvstring = 1;
+#endif
+            }
+
+            else if&#40;SvIOK&#40;arg&#41;&#41; {
+                nv_arg = &#40;NV&#41;SvIV&#40;arg&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 1;
+#endif
+            }
+
+            else {
+                nv_arg = SvNV&#40;arg&#41;;
+            }
+
+            /* Handle NaN, zeros and Infs */
+
+            if&#40;nv_arg != nv_arg&#41; {
+                sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;NaN&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+                uvstring = 0;
+#endif
+            }
+
+            else if&#40;nv_arg == 0&#41; {
+                sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;0&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+                uvstring = 0;
+#endif
+            }
+
+            else if&#40;nv_arg/nv_arg != 1&#41; {
+                if&#40;nv_arg &lt; 0&#41; sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;-Inf&#34;&#41;;
+                else sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;Inf&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+                uvstring = 0;
+#endif
+            }
+
+            /* Handle all values other than NaN, zeros and Infs */
+
+            else {
+#ifdef UNIQ_PREC_LOSS
+                if&#40;uvstring&#41; {
+                    sprintf&#40;buff, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;
+                    offset = strlen&#40;buff&#41;;
+                }
+
+                else if&#40;ivstring&#41; {
+                    sprintf&#40;buff, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
+                    offset = strlen&#40;buff&#41;;
+                }
+
+                /* Take appropriate action if nv_arg is within IV and UV bounds */
+
+                else if&#40;ceil&#40;nv_arg&#41; == nv_arg
+                        &#38;&#38;   nv_arg  &lt;=  1.8446744073709552e+19
+                        &#38;&#38;   nv_arg  &gt;= -9.2233720368547758e+18 &#41; { 
+
+                    if&#40;nv_arg &lt; 0&#41; {
+                        sprintf&#40;buff, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
+                    }
+                    else {
+                        sprintf&#40;buff, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;
+                    }
+
+                    offset = strlen&#40;buff&#41;;
+                }
+
+                ivstring = 0;
+                uvstring = 0;
+
+                buff += offset;
+
+                for&#40;i = 0; i &lt; 8; i++&#41; {
+                    sprintf&#40;buff, &#34;%02x&#34;, &#40;&#40;unsigned char*&#41;p&#41;[i]&#41;;
+                    buff += 2;
+                }
+
+                buff -= 16 + offset; /* return pointer to original position */
+                offset = 0;
+#else
+                for&#40;i = UNIQ_LOOP_START; i &lt; UNIQ_LOOP_END; i++&#41; {
+                    sprintf&#40;buff, &#34;%02x&#34;, &#40;&#40;unsigned char*&#41;p&#41;[i]&#41;;
+                    buff += 2;
+                }
+
+                buff -= 2 * UNIQ_LOOP_END; /* return pointer to original position */
+#endif
+                sv_setpvf&#40;keysv, &#34;%s&#34;, buff&#41;;
+            }
 #ifdef HV_FETCH_EMPTY_HE
             he = &#40;HE*&#41; hv_common&#40;seen, NULL, SvPVX&#40;keysv&#41;, SvCUR&#40;keysv&#41;, 0, HV_FETCH_LVALUE | HV_FETCH_EMPTY_HE, NULL, 0&#41;;
             if &#40;HeVAL&#40;he&#41;&#41;
--- t/uniq.t_orig	2019-08-24 11:46:43 +1000
+++ t/uniq.t	2019-08-27 19:12:28 +1000
@@ -2,8 +2,8 @@
 
 use strict;
 use warnings;
-
-use Test::More tests =&gt; 33;
+use Config; # to determine nvsize
+use Test::More tests =&gt; 35;
 use List::Util qw&#40; uniqnum uniqstr uniq &#41;;
 
 use Tie::Array;
@@ -87,6 +87,76 @@
                &#39;uniqnum distinguishes large floats &#40;stringified&#41;&#39; &#41;;
 }
 
+my &#40;$uniq_count1, $uniq_count2, $equiv&#41;;
+
+if&#40;$Config{nvsize} == 8&#41; {
+  # NV is either &#39;double&#39; or 8-byte &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 1.4142135623730951 == 1.4142135623730954;
+
+  $uniq_count1 = List::Util::uniqnum &#40;1.4142135623730951,
+                                      1.4142135623730954 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;1.4142135623730951&#39;,
+                                     &#39;1.4142135623730954&#39;&#41;;
+}
+
+elsif&#40;length&#40;sqrt&#40;2&#41;&#41; &gt; 25&#41; {
+  # NV is either IEEE &#39;long double&#39; or &#39;__float128&#39; or doubledouble
+
+  if&#40;1 + &#40;2 ** -1074&#41; != 1&#41; {
+    # NV is doubledouble
+
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 1 + &#40;2 ** -1074&#41; == 1 + &#40;2 ** - 1073&#41;;
+
+    $uniq_count1 = List::Util::uniqnum &#40;1 + &#40;2 ** -1074&#41;,
+                                        1 + &#40;2 ** -1073&#41; &#41;;
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 4.0564819207303340847894502572035e31 == 4.0564819207303340847894502572034e31;
+
+    $uniq_count2 = List::Util::uniqnum&#40;&#39;4.0564819207303340847894502572035e31&#39;,
+                                       &#39;4.0564819207303340847894502572034e31&#39;&#41;;
+  }
+
+  else {
+    # NV is either IEEE &#39;long double&#39; or &#39;__float128&#39;
+
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 1.7320508075688772935274463415058722 == 1.73205080756887729352744634150587224;
+
+    $uniq_count1 = List::Util::uniqnum &#40;1.7320508075688772935274463415058722,
+                                        1.73205080756887729352744634150587224 &#41;;
+
+    $uniq_count2 = List::Util::uniqnum&#40;&#39;1.7320508075688772935274463415058722&#39;,
+                                       &#39;1.73205080756887729352744634150587224&#39;&#41;;
+  }
+}
+
+else {
+  # NV is extended precision &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 2.2360679774997896963 == 2.23606797749978969634;
+
+  $uniq_count1 = List::Util::uniqnum &#40;2.2360679774997896963,
+                                      2.23606797749978969634 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;2.2360679774997896963&#39;,
+                                     &#39;2.23606797749978969634&#39;&#41;;
+}
+
+if&#40;$equiv&#41; {
+  is&#40;$uniq_count1, 1, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 1, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
+else {
+  is&#40;$uniq_count1, 2, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 2, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
 # Hard to know for sure what an Inf is going to be. Lets make one
 my $Inf = 0 + 1E1000;
 my $NaN;
@@ -109,8 +179,13 @@
 
     my @strs = map &#34;$_&#34;, @nums;
 
-    skip&#40; &#34;Perl $] doesn&#39;t stringify UV_MAX right &#40;$maxuint&#41;&#34;, 1 &#41;
-        if $maxuint !~ /\A[0-9]+\z/;
+    if&#40;$maxuint !~ /\A[0-9]+\z/&#41; {
+      skip&#40; &#34;Perl $] doesn&#39;t stringify UV_MAX right &#40;$maxuint&#41;&#34;, 1 &#41;;
+    }
+    elsif&#40;$] &lt; 5.022 &#38;&#38; $^O =~ /MSWin32/i&#41; {
+      skip&#40; &#34;On MS Windows,perl $] stringifies infs and nans into something unusable&#34;, 1 &#41;;
+    }
+        
 
     is_deeply&#40; [ uniqnum @strs, &#34;1.0&#34; ],
                [ @strs ],
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;29&nbsp;07:53:16&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 27 09:48:16 2019, SISYPHUS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t envisage making any further alterations, though that could
&gt; change if other problems come to light.
</div>
Within 5 minutes of posting that I spotted a couple of places in ListUtil.xs where things could be improved.

Latest patch, as against S-L-U.1.52, is attached.
I think this is now in good enough shape for a pull request, which I&#39;ll try to make tomorrow.

Cheers,
Rob
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SLU.diff4.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Makefile.PL_orig	2019-08-28 09:11:02 +1000
+++ Makefile.PL	2019-08-28 11:50:59 +1000
@@ -7,11 +7,30 @@
 use ExtUtils::MakeMaker;
 my $PERL_CORE = grep { $_ eq &#39;PERL_CORE=1&#39; } @ARGV;
 
+
+my $defines = $ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H];
+
+# Determine the correct NV formatting required by uniq&#40;&#41; in ListUtil.xs
+
+if&#40;$Config{nvsize} == 8&#41;   {      # double or 8-byte long double
+ $defines .= &#34; -DUNIQ_LOOP_END=8&#34;;
+ $defines .= &#34; -DUNIQ_PREC_LOSS&#34; if $Config{ivsize} &gt;= 8; # precision loss is possible when
+                                                          # IV/UV is converted to NV
+}
+ 
+elsif&#40;length&#40;sqrt 2&#41; &gt; 25&#41; {      # IEEE long double or __float128 or doubledouble
+  $defines .= &#34; -DUNIQ_LOOP_END=16&#34;
+}
+
+else {                            # extended precision long double &#40;either 12-byte or 16-byte&#41;
+  $defines .= &#34; -DUNIQ_LOOP_END=10&#34;;  # ignore unused bytes
+}
+
 WriteMakefile&#40;
   NAME         =&gt; q[List::Util],
   ABSTRACT     =&gt; q[Common Scalar and List utility subroutines],
   AUTHOR       =&gt; q[Graham Barr &lt;gbarr@cpan.org&gt;],
-  DEFINE       =&gt; &#40;$ENV{PERL_CORE} ? q[-DPERL_EXT] : q[-DPERL_EXT -DUSE_PPPORT_H]&#41;,
+  DEFINE       =&gt; $defines,
   DISTNAME     =&gt; q[Scalar-List-Utils],
   VERSION_FROM =&gt; &#39;lib/List/Util.pm&#39;,
 
--- ListUtil.xs_orig	2019-08-28 09:10:36 +1000
+++ ListUtil.xs	2019-08-28 21:14:28 +1000
@@ -72,6 +72,19 @@
 #define sv_catpvn_flags&#40;b,n,l,f&#41; sv_catpvn&#40;b,n,l&#41;
 #endif
 
+#ifdef UNIQ_PREC_LOSS
+#define UNIQ_BUFF_SIZE 33                    /* nvsize == 8, ivsize == 8 */
+
+#elif UNIQ_LOOP_END == 8                     /* nvsize == 8, ivsize &lt; 8 **/
+#define UNIQ_BUFF_SIZE 17
+
+#elif UNIQ_LOOP_END == 10                    /* NV is 10 bytes ***********/
+#define UNIQ_BUFF_SIZE 21
+
+#else
+#define UNIQ_BUFF_SIZE 33                    /* NV is 16 bytes ***********/
+#endif
+
 /* Some platforms have strict exports. And before 5.7.3 cxinc &#40;or Perl_cxinc&#41;
    was not exported. Therefore platforms like win32, VMS etc have problems
    so we redefine it here -- GMB
@@ -1152,6 +1165,15 @@
     int index;
     SV **args = &#38;PL_stack_base[ax];
     HV *seen;
+    size_t i;
+    NV nv_arg;
+    void *p = &#38;nv_arg;
+    char s[UNIQ_BUFF_SIZE];
+    char * buff = s;
+#ifdef UNIQ_PREC_LOSS
+    size_t ivstring = 0, offset = 0;
+    IV int_arg;
+#endif
 
     if&#40;items == 0 || &#40;items == 1 &#38;&#38; !SvGAMAGIC&#40;args[0]&#41; &#38;&#38; SvOK&#40;args[0]&#41;&#41;&#41; {
         /* Optimise for the case of the empty list or a defined nonmagic
@@ -1185,12 +1207,106 @@
 #endif
             }
 
-            if&#40;!SvOK&#40;arg&#41; || SvUOK&#40;arg&#41;&#41;
-                sv_setpvf&#40;keysv, &#34;%&#34; UVuf, SvUV&#40;arg&#41;&#41;;
-            else if&#40;SvIOK&#40;arg&#41;&#41;
-                sv_setpvf&#40;keysv, &#34;%&#34; IVdf, SvIV&#40;arg&#41;&#41;;
-            else
-                sv_setpvf&#40;keysv, &#34;%.15&#34; NVgf, SvNV&#40;arg&#41;&#41;;
+            /* Assign appropriate value to nv_arg */
+
+            if&#40;!SvOK&#40;arg&#41; || SvUOK&#40;arg&#41;&#41; {
+                nv_arg = &#40;NV&#41;SvUV&#40;arg&#41;;
+#ifdef UNIQ_PREC_LOSS
+                if&#40;SvUV&#40;arg&#41; &gt; 9007199254740992&#41; { /* UV to NV conversion could lose precision */
+                    ivstring = 1;
+                    int_arg = SvIV&#40;arg&#41;; /* SvIV&#40;arg&#41; and SvuV&#40;arg&#41; have the same byte structure *
+                                          * and it&#39;s only the byte structure that interests us   */
+                }
+#endif
+            }
+
+            else if&#40;SvIOK&#40;arg&#41;&#41; {
+                nv_arg = &#40;NV&#41;SvIV&#40;arg&#41;;
+#ifdef UNIQ_PREC_LOSS
+                int_arg = SvIV&#40;arg&#41;;
+                if&#40;int_arg &lt; -4503599627370496&#41;  /* IV to NV conversion could lose precision */
+                    ivstring = 1;
+#endif
+            }
+
+            else {
+                nv_arg = SvNV&#40;arg&#41;;
+            }
+
+            /* Handle NaN, zeros and Infs */
+
+            if&#40;nv_arg != nv_arg&#41; {
+                sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;NaN&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+#endif
+            }
+
+            else if&#40;nv_arg == 0&#41; {
+                sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;0&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+#endif
+            }
+
+            else if&#40;nv_arg/nv_arg != 1&#41; {
+                if&#40;nv_arg &lt; 0&#41; sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;-Inf&#34;&#41;;
+                else sv_setpvf&#40;keysv, &#34;%s&#34;, &#34;Inf&#34;&#41;;
+#ifdef UNIQ_PREC_LOSS
+                ivstring = 0;
+#endif
+            }
+
+            /* Handle all values other than NaN, zeros and Infs */
+
+            else {
+#ifdef UNIQ_PREC_LOSS
+                if&#40;ivstring&#41; { 
+
+                    /* Read the bytes of iv_arg into the string buffer, in hex */
+
+                    sprintf&#40;buff, &#34;%016&#34; UVxf, int_arg&#41;;
+                    buff += 16;
+                    offset = 16;
+                }
+
+
+                /* Take appropriate action if nv_arg holds an integer value    *  
+                 * within the IV and UV range that can lose precision as an NV */
+
+                else if&#40;ceil&#40;nv_arg&#41; == nv_arg
+                        &#38;&#38; &#40;&#40;nv_arg  &lt;=  1.8446744073709552e+19 &#38;&#38; nv_arg &gt; 9007199254740992&#41;
+                             ||
+                            &#40;nv_arg &lt; -4503599627370496 &#38;&#38; nv_arg  &gt;= -9.2233720368547758e+18&#41;&#41; &#41; {
+
+                    int_arg = SvIV&#40;arg&#41;;
+
+                    /* Read the bytes of int_arg into the string buffer, in hex */
+
+                    sprintf&#40;buff, &#34;%016&#34; UVxf, int_arg&#41;;
+                    buff += 16;
+                    offset = 16; /* the buff pointer has been incremented by 16 */
+                }
+
+                ivstring = 0;
+
+                for&#40;i = 0; i &lt; 8; i++&#41; {
+                    sprintf&#40;buff, &#34;%02x&#34;, &#40;&#40;unsigned char*&#41;p&#41;[i]&#41;;
+                    buff += 2;
+                }
+
+                buff -= 16 + offset; /* return pointer to original position */
+                offset = 0;
+#else
+                for&#40;i = 0; i &lt; UNIQ_LOOP_END; i++&#41; {
+                    sprintf&#40;buff, &#34;%02x&#34;, &#40;&#40;unsigned char*&#41;p&#41;[i]&#41;;
+                    buff += 2;
+                }
+
+                buff -= 2 * UNIQ_LOOP_END; /* return pointer to original position */
+#endif
+                sv_setpvf&#40;keysv, &#34;%s&#34;, buff&#41;;
+            }
 #ifdef HV_FETCH_EMPTY_HE
             he = &#40;HE*&#41; hv_common&#40;seen, NULL, SvPVX&#40;keysv&#41;, SvCUR&#40;keysv&#41;, 0, HV_FETCH_LVALUE | HV_FETCH_EMPTY_HE, NULL, 0&#41;;
             if &#40;HeVAL&#40;he&#41;&#41;
--- t/uniq.t_orig	2019-08-28 09:11:41 +1000
+++ t/uniq.t	2019-08-27 19:12:28 +1000
@@ -2,8 +2,8 @@
 
 use strict;
 use warnings;
-
-use Test::More tests =&gt; 33;
+use Config; # to determine nvsize
+use Test::More tests =&gt; 35;
 use List::Util qw&#40; uniqnum uniqstr uniq &#41;;
 
 use Tie::Array;
@@ -87,6 +87,76 @@
                &#39;uniqnum distinguishes large floats &#40;stringified&#41;&#39; &#41;;
 }
 
+my &#40;$uniq_count1, $uniq_count2, $equiv&#41;;
+
+if&#40;$Config{nvsize} == 8&#41; {
+  # NV is either &#39;double&#39; or 8-byte &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 1.4142135623730951 == 1.4142135623730954;
+
+  $uniq_count1 = List::Util::uniqnum &#40;1.4142135623730951,
+                                      1.4142135623730954 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;1.4142135623730951&#39;,
+                                     &#39;1.4142135623730954&#39;&#41;;
+}
+
+elsif&#40;length&#40;sqrt&#40;2&#41;&#41; &gt; 25&#41; {
+  # NV is either IEEE &#39;long double&#39; or &#39;__float128&#39; or doubledouble
+
+  if&#40;1 + &#40;2 ** -1074&#41; != 1&#41; {
+    # NV is doubledouble
+
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 1 + &#40;2 ** -1074&#41; == 1 + &#40;2 ** - 1073&#41;;
+
+    $uniq_count1 = List::Util::uniqnum &#40;1 + &#40;2 ** -1074&#41;,
+                                        1 + &#40;2 ** -1073&#41; &#41;;
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 4.0564819207303340847894502572035e31 == 4.0564819207303340847894502572034e31;
+
+    $uniq_count2 = List::Util::uniqnum&#40;&#39;4.0564819207303340847894502572035e31&#39;,
+                                       &#39;4.0564819207303340847894502572034e31&#39;&#41;;
+  }
+
+  else {
+    # NV is either IEEE &#39;long double&#39; or &#39;__float128&#39;
+
+    # The 2 values should be unequal - but just in case perl is buggy:
+    $equiv = 1 if 1.7320508075688772935274463415058722 == 1.73205080756887729352744634150587224;
+
+    $uniq_count1 = List::Util::uniqnum &#40;1.7320508075688772935274463415058722,
+                                        1.73205080756887729352744634150587224 &#41;;
+
+    $uniq_count2 = List::Util::uniqnum&#40;&#39;1.7320508075688772935274463415058722&#39;,
+                                       &#39;1.73205080756887729352744634150587224&#39;&#41;;
+  }
+}
+
+else {
+  # NV is extended precision &#39;long double&#39;
+
+  # The 2 values should be unequal - but just in case perl is buggy:
+  $equiv = 1 if 2.2360679774997896963 == 2.23606797749978969634;
+
+  $uniq_count1 = List::Util::uniqnum &#40;2.2360679774997896963,
+                                      2.23606797749978969634 &#41;;
+
+  $uniq_count2 = List::Util::uniqnum&#40;&#39;2.2360679774997896963&#39;,
+                                     &#39;2.23606797749978969634&#39;&#41;;
+}
+
+if&#40;$equiv&#41; {
+  is&#40;$uniq_count1, 1, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 1, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
+else {
+  is&#40;$uniq_count1, 2, &#39;uniqnum preserves uniqness of high precision floats&#39;&#41;;
+  is&#40;$uniq_count2, 2, &#39;uniqnum preserves uniqness of high precision floats &#40;stringified&#41;&#39;&#41;;
+}
+
 # Hard to know for sure what an Inf is going to be. Lets make one
 my $Inf = 0 + 1E1000;
 my $NaN;
@@ -109,8 +179,13 @@
 
     my @strs = map &#34;$_&#34;, @nums;
 
-    skip&#40; &#34;Perl $] doesn&#39;t stringify UV_MAX right &#40;$maxuint&#41;&#34;, 1 &#41;
-        if $maxuint !~ /\A[0-9]+\z/;
+    if&#40;$maxuint !~ /\A[0-9]+\z/&#41; {
+      skip&#40; &#34;Perl $] doesn&#39;t stringify UV_MAX right &#40;$maxuint&#41;&#34;, 1 &#41;;
+    }
+    elsif&#40;$] &lt; 5.022 &#38;&#38; $^O =~ /MSWin32/i&#41; {
+      skip&#40; &#34;On MS Windows,perl $] stringifies infs and nans into something unusable&#34;, 1 &#41;;
+    }
+        
 
     is_deeply&#40; [ uniqnum @strs, &#34;1.0&#34; ],
                [ @strs ],
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;30&nbsp;06:30:04&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 27 09:48:16 2019, SISYPHUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; For perl-5.20.x and earlier on MS Windows I discovered that the
&gt; &#39;uniqnum preserves uniqness of full integer range &#40;stringified&#41;&#39; test
&gt; needs to be skipped because of the bizarre way that infs and nans are
&gt; stringified on those particular perls.
&gt; AFAICT it&#39;s actually not possible to come up with a string that will
&gt; numify to NaN, though strings that numify to Infs do exist &#40;eg
&gt; &#39;1e1000&#39;&#41;.
&gt; 
&gt; Graham&#39;s script also needs to be skipped for those builds - for the
&gt; same reason.
</div>
I don&#39;t have a windows machine to test this on right now, but could you test the latest master of List-Util-MaybeXS on those perls?  The script shouldn&#39;t rely on Infs and NaNs being numifiable from strings.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;30&nbsp;10:06:21&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 30 06:30:04 2019, haarg wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The script shouldn&#39;t rely on Infs and NaNs being numifiable from strings.
</div>
But it means that you can&#39;t test the numification of NaN from a string.
I&#39;m not sure that it matters all that much, but it&#39;s something that both scripts were attempting to do.

That aside, I tried a &#34;cpan -fi List::Util::MaybeXS&#34; on my Windows build of x64 perl-5.20.0 where both ivsize and nvsize are 8.
You&#39;ll be pleased to know that List-Util-MaybeXS-1.500003 built and installed just fine, with all tests passing.
In installing that module List::Util was updated from version 1.38 to 1.52, with its t/uniq.t failing one test:

t/uniq.t .............. 1/33 Argument &#34;1.#INF&#34; isn&#39;t numeric in subroutine entry
 at t/uniq.t line 115.
Argument &#34;-1.#IND&#34; isn&#39;t numeric in subroutine entry at t/uniq.t line 115.

#   Failed test &#39;uniqnum preserves uniqness of full integer range &#40;stringified&#41;&#39;

#   at t/uniq.t line 115.
#     Structures begin differing at:
#          $got-&gt;[4] = &#39;9223372036854775807&#39;
#     $expected-&gt;[4] = &#39;-1.#IND&#39;
# Looks like you failed 1 test of 33.
t/uniq.t .............. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;

Things became a little annoying when I tried to build the current git version of List-Util-MaybeXS on the same build of perl:

C:\sisyphusion\list-util-maybexs&gt;perl Makefile.PL
&#39;git&#39; is not recognized as an internal or external command,operable program or batch file.
Can&#39;t locate Distar.pm in @INC &#40;you may need to install the Distar module&#41; &#40;@INC contains: Distar/lib inc C:/_64/perl520_482/site/lib C:/_64/perl520_482/lib .&#41; at ./maint/Makefile.PL.include line 3.
BEGIN failed--compilation aborted at ./maint/Makefile.PL.include line 3.

C:\sisyphusion\list-util-maybexs&gt;cpan -i Distar
Reading &#39;C:\Users\sisyphus\.cpan\Metadata&#39;
  Database was generated on Fri, 30 Aug 2019 12:41:02 GMT
Warning: Cannot install Distar, don&#39;t know what it is.
Try the command

    i /Distar/

to find objects with matching identifiers.

At that point I gave up. I don&#39;t see why the &#39;git&#39; command should need to be found to build a perl module - though I&#39;m certainly quite happy to pursue this further if there&#39;s something to be achieved &#40;&#38;&#38; if you tell me what steps I need to take ;-&#41;

Cheers,
Rob




 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;30&nbsp;10:35:24&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 30 10:06:21 2019, SISYPHUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Aug 30 06:30:04 2019, haarg wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; The script shouldn&#39;t rely on Infs and NaNs being numifiable from
&gt; &gt; strings.
</div>&gt; 
&gt; But it means that you can&#39;t test the numification of NaN from a
&gt; string.
&gt; I&#39;m not sure that it matters all that much, but it&#39;s something that
&gt; both scripts were attempting to do.
</div>
I&#39;ve adjusted the test to avoid doing that where it won&#39;t work.  It wasn&#39;t a behavior I was intentionally relying on.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; That aside, I tried a &#34;cpan -fi List::Util::MaybeXS&#34; on my Windows
&gt; build of x64 perl-5.20.0 where both ivsize and nvsize are 8.
&gt; You&#39;ll be pleased to know that List-Util-MaybeXS-1.500003 built and
&gt; installed just fine, with all tests passing.
&gt; In installing that module List::Util was updated from version 1.38 to
&gt; 1.52, with its t/uniq.t failing one test:
&gt; 
&gt; t/uniq.t .............. 1/33 Argument &#34;1.#INF&#34; isn&#39;t numeric in
&gt; subroutine entry
&gt;  at t/uniq.t line 115.
&gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in subroutine entry at t/uniq.t line
&gt; 115.
&gt; 
&gt; #   Failed test &#39;uniqnum preserves uniqness of full integer range
&gt; &#40;stringified&#41;&#39;
&gt; 
&gt; #   at t/uniq.t line 115.
&gt; #     Structures begin differing at:
&gt; #          $got-&gt;[4] = &#39;9223372036854775807&#39;
&gt; #     $expected-&gt;[4] = &#39;-1.#IND&#39;
&gt; # Looks like you failed 1 test of 33.
&gt; t/uniq.t .............. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
&gt; 
&gt; Things became a little annoying when I tried to build the current git
&gt; version of List-Util-MaybeXS on the same build of perl:
&gt; 
&gt; C:\sisyphusion\list-util-maybexs&gt;perl Makefile.PL
&gt; &#39;git&#39; is not recognized as an internal or external command,operable
&gt; program or batch file.
&gt; Can&#39;t locate Distar.pm in @INC &#40;you may need to install the Distar
&gt; module&#41; &#40;@INC contains: Distar/lib inc C:/_64/perl520_482/site/lib
&gt; C:/_64/perl520_482/lib .&#41; at ./maint/Makefile.PL.include line 3.
&gt; BEGIN failed--compilation aborted at ./maint/Makefile.PL.include line
&gt; 3.
&gt; 
&gt; C:\sisyphusion\list-util-maybexs&gt;cpan -i Distar
&gt; Reading &#39;C:\Users\sisyphus\.cpan\Metadata&#39;
&gt;   Database was generated on Fri, 30 Aug 2019 12:41:02 GMT
&gt; Warning: Cannot install Distar, don&#39;t know what it is.
&gt; Try the command
&gt; 
&gt; i /Distar/
&gt; 
&gt; to find objects with matching identifiers.
&gt; 
&gt; At that point I gave up. I don&#39;t see why the &#39;git&#39; command should need
&gt; to be found to build a perl module - though I&#39;m certainly quite happy
&gt; to pursue this further if there&#39;s something to be achieved &#40;&#38;&#38; if you
&gt; tell me what steps I need to take ;-&#41;
&gt; 
&gt; Cheers,
&gt; Rob
&gt; 
</div>
Distar is the dist authoring tool I&#39;m using, and it is distributed via git.

You shouldn&#39;t need it to run the tests though, since it&#39;s a pure perl module.  You can run the tests using `prove -l t`.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;30&nbsp;11:19:41&nbsp;2019</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Incidentally, with List-Util-1.52 and List-Util-MaybeXS-1.500003 I see the following output:

C:\&gt;perl -MList::Util::MaybeXS=&#34;uniqnum&#34; -le &#34;@x=uniqnum&#40;9223372036854775808, 9.2233720368547758e+18&#41;; print \&#34;@x\&#34;;&#34;
9223372036854775808 9.2233720368547758e+18

This should be reproducible on any perl whose nvsize and ivsize are 8. I believe it&#39;s incorrect &#40;as both values in binary are simply 1 followed by 63 zeroes&#41;, but it&#39;s what List-Util-1.52 produces.

The accurate_uniqnum&#40;&#41; sub provided in the script earlier supplied by Graham recognizes that the 2 values are equivalent.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;31&nbsp;07:24:04&nbsp;2019</span>
    <span class="description">sisyphus359 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;sisyphus [...] cpan.org via RT&#34; &lt;sisyphus [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130302] uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 31 Aug 2019 21:23:29 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Scalar-List-Utils [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sisyphus &lt;sisyphus359 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Graham,

I can get the git version of List::Util::MaybeXS to build by appending the
location of Cygwin&#39;s git.exe to my PATH.

However, on all of those windows versions of perl that stringify infs and
nans as something absurd &#40;ie pre 5.22&#41;, t/uniqnum.t cannot be run:

t/uniqnum.t ........... &#34;use&#34; not allowed in expression at t/uniqnum.t line
94, at end of line
BEGIN not safe after errors--compilation aborted at t/uniqnum.t line 94.
t/uniqnum.t ........... Dubious, test returned 34 &#40;wstat 8704, 0x2200&#41;

Line 94 is:
  use warnings FATAL =&gt; &#39;all&#39;;

Let me know when you&#39;ve fixed that, and I&#39;ll gladly give it another go.

Cheers,
Rob

On Sat, Aug 31, 2019 at 12:35 AM Graham Knop via RT &lt;
bug-Scalar-List-Utils@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=130302">https://rt.cpan.org/Ticket/Display.html?id=130302</a></span> &gt;
&gt;
&gt; On Fri Aug 30 10:06:21 2019, SISYPHUS wrote:
<div class="message-stanza open">&gt; &gt; On Fri Aug 30 06:30:04 2019, haarg wrote:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; The script shouldn&#39;t rely on Infs and NaNs being numifiable from
&gt; &gt; &gt; strings.
</div>&gt; &gt;
&gt; &gt; But it means that you can&#39;t test the numification of NaN from a
&gt; &gt; string.
&gt; &gt; I&#39;m not sure that it matters all that much, but it&#39;s something that
&gt; &gt; both scripts were attempting to do.
</div>&gt;
&gt; I&#39;ve adjusted the test to avoid doing that where it won&#39;t work.  It wasn&#39;t
&gt; a behavior I was intentionally relying on.
&gt;
<div class="message-stanza open">&gt; &gt;
&gt; &gt; That aside, I tried a &#34;cpan -fi List::Util::MaybeXS&#34; on my Windows
&gt; &gt; build of x64 perl-5.20.0 where both ivsize and nvsize are 8.
&gt; &gt; You&#39;ll be pleased to know that List-Util-MaybeXS-1.500003 built and
&gt; &gt; installed just fine, with all tests passing.
&gt; &gt; In installing that module List::Util was updated from version 1.38 to
&gt; &gt; 1.52, with its t/uniq.t failing one test:
&gt; &gt;
&gt; &gt; t/uniq.t .............. 1/33 Argument &#34;1.#INF&#34; isn&#39;t numeric in
&gt; &gt; subroutine entry
&gt; &gt;  at t/uniq.t line 115.
&gt; &gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in subroutine entry at t/uniq.t line
&gt; &gt; 115.
&gt; &gt;
&gt; &gt; #   Failed test &#39;uniqnum preserves uniqness of full integer range
&gt; &gt; &#40;stringified&#41;&#39;
&gt; &gt;
&gt; &gt; #   at t/uniq.t line 115.
&gt; &gt; #     Structures begin differing at:
&gt; &gt; #          $got-&gt;[4] = &#39;9223372036854775807&#39;
&gt; &gt; #     $expected-&gt;[4] = &#39;-1.#IND&#39;
&gt; &gt; # Looks like you failed 1 test of 33.
&gt; &gt; t/uniq.t .............. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
&gt; &gt;
&gt; &gt; Things became a little annoying when I tried to build the current git
&gt; &gt; version of List-Util-MaybeXS on the same build of perl:
&gt; &gt;
&gt; &gt; C:\sisyphusion\list-util-maybexs&gt;perl Makefile.PL
&gt; &gt; &#39;git&#39; is not recognized as an internal or external command,operable
&gt; &gt; program or batch file.
&gt; &gt; Can&#39;t locate Distar.pm in @INC &#40;you may need to install the Distar
&gt; &gt; module&#41; &#40;@INC contains: Distar/lib inc C:/_64/perl520_482/site/lib
&gt; &gt; C:/_64/perl520_482/lib .&#41; at ./maint/Makefile.PL.include line 3.
&gt; &gt; BEGIN failed--compilation aborted at ./maint/Makefile.PL.include line
&gt; &gt; 3.
&gt; &gt;
&gt; &gt; C:\sisyphusion\list-util-maybexs&gt;cpan -i Distar
&gt; &gt; Reading &#39;C:\Users\sisyphus\.cpan\Metadata&#39;
&gt; &gt;   Database was generated on Fri, 30 Aug 2019 12:41:02 GMT
&gt; &gt; Warning: Cannot install Distar, don&#39;t know what it is.
&gt; &gt; Try the command
&gt; &gt;
&gt; &gt; i /Distar/
&gt; &gt;
&gt; &gt; to find objects with matching identifiers.
&gt; &gt;
&gt; &gt; At that point I gave up. I don&#39;t see why the &#39;git&#39; command should need
&gt; &gt; to be found to build a perl module - though I&#39;m certainly quite happy
&gt; &gt; to pursue this further if there&#39;s something to be achieved &#40;&#38;&#38; if you
&gt; &gt; tell me what steps I need to take ;-&#41;
&gt; &gt;
&gt; &gt; Cheers,
&gt; &gt; Rob
&gt; &gt;
</div>&gt;
&gt; Distar is the dist authoring tool I&#39;m using, and it is distributed via git.
&gt;
&gt; You shouldn&#39;t need it to run the tests though, since it&#39;s a pure perl
&gt; module.  You can run the tests using `prove -l t`.
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;31&nbsp;10:08:30&nbsp;2019</span>
    <span class="description">sisyphus359 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;sisyphus [...] cpan.org via RT&#34; &lt;sisyphus [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130302] uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 1 Sep 2019 00:07:43 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Scalar-List-Utils [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sisyphus &lt;sisyphus359 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Taking a punt that removal of the offending &#34;use warnings FATAL =&gt; &#39;all&#39;;&#34;
is a valid fix, all tests then pass on my Windows perl-5.20.0 &#40;nvsize=8,
ivsize=8&#41;.
However, I see multiple warnings during the running of t/uniqnum.t:

......
t/uniq.t .............. ok
t/uniqnum.t ........... Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at
t/uni
qnum.t line 83.
Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
t/uniqnum.t ........... ok
......

Cheers,
Rob

On Sat, Aug 31, 2019 at 9:23 PM sisyphus &lt;sisyphus359@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Graham,
&gt;
&gt; I can get the git version of List::Util::MaybeXS to build by appending the
&gt; location of Cygwin&#39;s git.exe to my PATH.
&gt;
&gt; However, on all of those windows versions of perl that stringify infs and
&gt; nans as something absurd &#40;ie pre 5.22&#41;, t/uniqnum.t cannot be run:
&gt;
&gt; t/uniqnum.t ........... &#34;use&#34; not allowed in expression at t/uniqnum.t
&gt; line 94, at end of line
&gt; BEGIN not safe after errors--compilation aborted at t/uniqnum.t line 94.
&gt; t/uniqnum.t ........... Dubious, test returned 34 &#40;wstat 8704, 0x2200&#41;
&gt;
&gt; Line 94 is:
&gt;   use warnings FATAL =&gt; &#39;all&#39;;
&gt;
&gt; Let me know when you&#39;ve fixed that, and I&#39;ll gladly give it another go.
&gt;
&gt; Cheers,
&gt; Rob
&gt;
&gt; On Sat, Aug 31, 2019 at 12:35 AM Graham Knop via RT &lt;
&gt; bug-Scalar-List-Utils@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=130302">https://rt.cpan.org/Ticket/Display.html?id=130302</a></span> &gt;
&gt;&gt;
&gt;&gt; On Fri Aug 30 10:06:21 2019, SISYPHUS wrote:
<div class="message-stanza open">&gt;&gt; &gt; On Fri Aug 30 06:30:04 2019, haarg wrote:
&gt;&gt; &gt;
<div class="message-stanza open">&gt;&gt; &gt; &gt; The script shouldn&#39;t rely on Infs and NaNs being numifiable from
&gt;&gt; &gt; &gt; strings.
</div>&gt;&gt; &gt;
&gt;&gt; &gt; But it means that you can&#39;t test the numification of NaN from a
&gt;&gt; &gt; string.
&gt;&gt; &gt; I&#39;m not sure that it matters all that much, but it&#39;s something that
&gt;&gt; &gt; both scripts were attempting to do.
</div>&gt;&gt;
&gt;&gt; I&#39;ve adjusted the test to avoid doing that where it won&#39;t work.  It
&gt;&gt; wasn&#39;t a behavior I was intentionally relying on.
&gt;&gt;
<div class="message-stanza open">&gt;&gt; &gt;
&gt;&gt; &gt; That aside, I tried a &#34;cpan -fi List::Util::MaybeXS&#34; on my Windows
&gt;&gt; &gt; build of x64 perl-5.20.0 where both ivsize and nvsize are 8.
&gt;&gt; &gt; You&#39;ll be pleased to know that List-Util-MaybeXS-1.500003 built and
&gt;&gt; &gt; installed just fine, with all tests passing.
&gt;&gt; &gt; In installing that module List::Util was updated from version 1.38 to
&gt;&gt; &gt; 1.52, with its t/uniq.t failing one test:
&gt;&gt; &gt;
&gt;&gt; &gt; t/uniq.t .............. 1/33 Argument &#34;1.#INF&#34; isn&#39;t numeric in
&gt;&gt; &gt; subroutine entry
&gt;&gt; &gt;  at t/uniq.t line 115.
&gt;&gt; &gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in subroutine entry at t/uniq.t line
&gt;&gt; &gt; 115.
&gt;&gt; &gt;
&gt;&gt; &gt; #   Failed test &#39;uniqnum preserves uniqness of full integer range
&gt;&gt; &gt; &#40;stringified&#41;&#39;
&gt;&gt; &gt;
&gt;&gt; &gt; #   at t/uniq.t line 115.
&gt;&gt; &gt; #     Structures begin differing at:
&gt;&gt; &gt; #          $got-&gt;[4] = &#39;9223372036854775807&#39;
&gt;&gt; &gt; #     $expected-&gt;[4] = &#39;-1.#IND&#39;
&gt;&gt; &gt; # Looks like you failed 1 test of 33.
&gt;&gt; &gt; t/uniq.t .............. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
&gt;&gt; &gt;
&gt;&gt; &gt; Things became a little annoying when I tried to build the current git
&gt;&gt; &gt; version of List-Util-MaybeXS on the same build of perl:
&gt;&gt; &gt;
&gt;&gt; &gt; C:\sisyphusion\list-util-maybexs&gt;perl Makefile.PL
&gt;&gt; &gt; &#39;git&#39; is not recognized as an internal or external command,operable
&gt;&gt; &gt; program or batch file.
&gt;&gt; &gt; Can&#39;t locate Distar.pm in @INC &#40;you may need to install the Distar
&gt;&gt; &gt; module&#41; &#40;@INC contains: Distar/lib inc C:/_64/perl520_482/site/lib
&gt;&gt; &gt; C:/_64/perl520_482/lib .&#41; at ./maint/Makefile.PL.include line 3.
&gt;&gt; &gt; BEGIN failed--compilation aborted at ./maint/Makefile.PL.include line
&gt;&gt; &gt; 3.
&gt;&gt; &gt;
&gt;&gt; &gt; C:\sisyphusion\list-util-maybexs&gt;cpan -i Distar
&gt;&gt; &gt; Reading &#39;C:\Users\sisyphus\.cpan\Metadata&#39;
&gt;&gt; &gt;   Database was generated on Fri, 30 Aug 2019 12:41:02 GMT
&gt;&gt; &gt; Warning: Cannot install Distar, don&#39;t know what it is.
&gt;&gt; &gt; Try the command
&gt;&gt; &gt;
&gt;&gt; &gt; i /Distar/
&gt;&gt; &gt;
&gt;&gt; &gt; to find objects with matching identifiers.
&gt;&gt; &gt;
&gt;&gt; &gt; At that point I gave up. I don&#39;t see why the &#39;git&#39; command should need
&gt;&gt; &gt; to be found to build a perl module - though I&#39;m certainly quite happy
&gt;&gt; &gt; to pursue this further if there&#39;s something to be achieved &#40;&#38;&#38; if you
&gt;&gt; &gt; tell me what steps I need to take ;-&#41;
&gt;&gt; &gt;
&gt;&gt; &gt; Cheers,
&gt;&gt; &gt; Rob
&gt;&gt; &gt;
</div>&gt;&gt;
&gt;&gt; Distar is the dist authoring tool I&#39;m using, and it is distributed via
&gt;&gt; git.
&gt;&gt;
&gt;&gt; You shouldn&#39;t need it to run the tests though, since it&#39;s a pure perl
&gt;&gt; module.  You can run the tests using `prove -l t`.
&gt;&gt;
</div>&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;01&nbsp;02:15:33&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Aug 31 10:08:30 2019, sisyphus359@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Taking a punt that removal of the offending &#34;use warnings FATAL =&gt; &#39;all&#39;;&#34;
&gt; is a valid fix, all tests then pass on my Windows perl-5.20.0 &#40;nvsize=8,
&gt; ivsize=8&#41;.
&gt; However, I see multiple warnings during the running of t/uniqnum.t:
&gt; 
&gt; ......
&gt; t/uniq.t .............. ok
&gt; t/uniqnum.t ........... Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at
&gt; t/uni
&gt; qnum.t line 83.
&gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; t/uniqnum.t ........... ok
&gt; ......
&gt; 
&gt; Cheers,
&gt; Rob
&gt; 
</div>
The test should be fixed now.  It&#39;s meant to filter out those strings that can&#39;t be converted to numbers, but I had the order of some things wrong.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;01&nbsp;09:53:00&nbsp;2019</span>
    <span class="description">sisyphus359 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;sisyphus [...] cpan.org via RT&#34; &lt;sisyphus [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130302] uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 1 Sep 2019 23:52:26 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Scalar-List-Utils [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sisyphus &lt;sisyphus359 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Latest git version of List::Util::MaybeXS is looking fine on windows - both
on those versions of perl that stringify infs and nans absurdly, and those
that stringify them sanely.
I also tested my Linux quadmath build of 5.31.3 which was fine.

It doesn&#39;t fare so well on my PowerPC machine where the nvtype is
DoubleDouble, but you&#39;re probably not interested in that &#40;nor would I
assert that there&#39;s any reason you ought to be concerned about it&#41;.

FYI, with that DoubleDouble build of perl-5.31.3 the first test fails:

#   Failed test &#39;correct count of unique numbers&#39;
#   at t/uniqnum.t line 151.
#          got: &#39;187&#39;
#     expected: &#39;184&#39;

and then more tests start failing at:

#   Failed test &#39;Found correct 1e5 in uniqnum output&#39;
#   at t/uniqnum.t line 166.
#          got: 100000
#     expected: -1

#   Failed test &#39;Found correct -1e5 in uniqnum output&#39;
#   at t/uniqnum.t line 166.
#          got: -100000
#     expected: -10

Cheers,
Rob


On Sun, Sep 1, 2019 at 7:55 PM Graham Knop via RT &lt;
bug-Scalar-List-Utils@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=130302">https://rt.cpan.org/Ticket/Display.html?id=130302</a></span> &gt;
&gt;
&gt; On Sat Aug 31 10:08:30 2019, sisyphus359@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Taking a punt that removal of the offending &#34;use warnings FATAL =&gt;
</div>&gt; &#39;all&#39;;&#34;
<div class="message-stanza open">&gt; &gt; is a valid fix, all tests then pass on my Windows perl-5.20.0 &#40;nvsize=8,
&gt; &gt; ivsize=8&#41;.
&gt; &gt; However, I see multiple warnings during the running of t/uniqnum.t:
&gt; &gt;
&gt; &gt; ......
&gt; &gt; t/uniq.t .............. ok
&gt; &gt; t/uniqnum.t ........... Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41;
</div>&gt; at
<div class="message-stanza open">&gt; &gt; t/uni
&gt; &gt; qnum.t line 83.
&gt; &gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#INF&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;-1.#IND&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; Argument &#34;1.#QNAN&#34; isn&#39;t numeric in addition &#40;+&#41; at t/uniqnum.t line 83.
&gt; &gt; t/uniqnum.t ........... ok
&gt; &gt; ......
&gt; &gt;
&gt; &gt; Cheers,
&gt; &gt; Rob
&gt; &gt;
</div>&gt;
&gt; The test should be fixed now.  It&#39;s meant to filter out those strings that
&gt; can&#39;t be converted to numbers, but I had the order of some things wrong.
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;03&nbsp;10:07:13&nbsp;2019</span>
    <span class="description">sisyphus359 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;sisyphus [...] cpan.org via RT&#34; &lt;sisyphus [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130302] uniqnum&#40;&#41; doesn&#39;t handle float strings correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 4 Sep 2019 00:06:38 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Scalar-List-Utils [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sisyphus &lt;sisyphus359 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I probably should mention that I&#39;ve created a pull request:

 <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Dual-Life/Scalar-List-Utils/pull/79">https://github.com/Dual-Life/Scalar-List-Utils/pull/79</a></span>

Cheers,
Rob
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
