<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #19577 for Archive-Tar: extract_file&#40;&#41; drops volume part of extraction path</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #19577 for Archive-Tar: extract_file&#40;&#41; drops volume part of extraction path</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Archive-Tar">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Archive-Tar">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Archive-Tar">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Archive-Tar">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Archive-Tar">Archive-Tar CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">19577</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Archive-Tar">Archive-Tar</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
JDB [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-2526-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.29    </td>
  </tr>
  <tr id="CF-2527-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




vol.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/503172/249996/vol.patch">
Sun Aug 31 04:06:19 2008 (722b) by GAAS [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=19577">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200878" href="/Public/Bug/Display.html?id=19577#txn-200878">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;29&nbsp;13:26:35&nbsp;2006</span>
    <span class="description">JDB [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> extract_file&#40;&#41; drops volume part of extraction path</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/200878/74941/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/74941">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 755b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">extract_file&#40;&#41; uses File::Spec-&gt;splitpath&#40;&#41; to split the extraction 
path into volume, directory and filename, but it ignores the volume 
part when it determines that the path is an absolute local path.

This has no effect on Unix, which doesn&#39;t use volumes, but e.g. on 
Windows this creates a bug whenever the extraction path is absolute,
but not on the current drive.

Here is a patch:

--- Archive/Tar.pm.~1~  Tue May 23 22:20:01 2006
+++ Archive/Tar.pm      Tue May 23 22:20:01 2006
@@ -534,7 +534,7 @@
     my $dir;
     ### is $name an absolute path? ###
     if&#40; File::Spec-&gt;file_name_is_absolute&#40; $dirs &#41; &#41; {
-        $dir = $dirs;
+        $dir = File::Spec-&gt;catpath&#40; $vol, $dirs, &#34;&#34; &#41;;
 
     ### it&#39;s a relative path ###
     } else {
End of Patch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200882" href="/Public/Bug/Display.html?id=19577#txn-200882">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;29&nbsp;13:32:23&nbsp;2006</span>
    <span class="description">JDB [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200883" href="/Public/Bug/Display.html?id=19577#txn-200883">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;29&nbsp;13:43:27&nbsp;2006</span>
    <span class="description">jand [...] ActiveState.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #19577] AutoReply: extract_file&#40;&#41; drops volume part of extraction path </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 May 2006 10:42:49 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Archive-Tar [...] rt.cpan.org&gt;, &lt;JDB [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jan Dubois&#34; &lt;jand [...] activestate.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/200883/74945/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/74945">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 572b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This has no effect on Unix, which doesn&#39;t use volumes, but e.g. on
&gt; Windows this creates a bug whenever the extraction path is absolute,
&gt; but not on the current drive.
&gt; 
&gt; Here is a patch:
</div>[...]

Even with the patch the code doesn&#39;t work correctly for relative paths
on other than the current volume &#40;e.g. &#34;h:relative/path/file&#34;&#41;.  I&#39;m
not sure if this concept of having a current working directory for
each volume exists anywhere besides Windows.

On Windows this could be fixed by calling Cwd::getdcwd&#40;&#41;, but it requires
Cwd version 2.18 or later.

Cheers,
-Jan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200886" href="/Public/Bug/Display.html?id=19577#txn-200886">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;29&nbsp;13:48:39&nbsp;2006</span>
    <span class="description">jand [...] ActiveState.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #19577] AutoReply: extract_file&#40;&#41; drops volume part of extraction path </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 May 2006 10:48:04 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Archive-Tar [...] rt.cpan.org&gt;, &lt;JDB [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jan Dubois&#34; &lt;jand [...] activestate.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/200886/74948/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/74948">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 169b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">BTW, this behavior is broken in 1.29, not fixed in it. I must have
used the wrong listbox when selecting it, but RT doesn&#39;t allow me to
correct this. :&#40;

Cheers,
-Jan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-218416" href="/Public/Bug/Display.html?id=19577#txn-218416">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;04&nbsp;09:01:09&nbsp;2006</span>
    <span class="description">kane [...] cpan.org -  Fixed in 1.29 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-218417" href="/Public/Bug/Display.html?id=19577#txn-218417">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;04&nbsp;09:01:10&nbsp;2006</span>
    <span class="description">kane [...] cpan.org -  Broken in 1.29 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-218986" href="/Public/Bug/Display.html?id=19577#txn-218986">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;05&nbsp;08:41:48&nbsp;2006</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/218986/88849/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/88849">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jan,

On Mon May 29 13:43:27 2006, jand@ActiveState.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; This has no effect on Unix, which doesn&#39;t use volumes, but e.g. on
&gt; &gt; Windows this creates a bug whenever the extraction path is absolute,
&gt; &gt; but not on the current drive.
&gt; &gt; 
&gt; &gt; Here is a patch:
</div>&gt; [...]
&gt; 
&gt; Even with the patch the code doesn&#39;t work correctly for relative paths
&gt; on other than the current volume &#40;e.g. &#34;h:relative/path/file&#34;&#41;.  I&#39;m
&gt; not sure if this concept of having a current working directory for
&gt; each volume exists anywhere besides Windows.
</div>
I&#39;m not sure what hte &#39;best&#39; approach is to this. If a tarfile is packed by using
the full path &#34;h:\a\b&#34;, should the extraction then happen to h:\a\b or to
[current volume]\a\b? Same for the relative paths of course.

If not going for [current volume], there&#39;s a good chance that extraction will
fail, as not everyone has a h: nor do they intend to extract there.

Also, if you would have a test case that demonstrates this behaviour &#40;or even
better, an addition to our .t file&#41;, that&#39;d make verifying the desired behaviour
a lot easier.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Windows this could be fixed by calling Cwd::getdcwd&#40;&#41;, but it requires
&gt; Cwd version 2.18 or later.
</div>
That shouldn&#39;t be too much of a problem i think:
$ corelist -a Cwd
[...]
  5.008004   2.17      
  5.008005   2.19   

So most people should have access to it. And if we go for the [current volume]
solution, getdcwd shouldn&#39;t even be needed.

Awaiting your thoughts,

-- Jos

P.S. sorry for the late reply, but i&#39;ve first secured access to a win32 machine
so i can test any code/ideas you send along on a real environment, rather than
just mentally :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-218989" href="/Public/Bug/Display.html?id=19577#txn-218989">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;05&nbsp;08:41:50&nbsp;2006</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-503172" href="/Public/Bug/Display.html?id=19577#txn-503172">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;31&nbsp;04:06:18&nbsp;2008</span>
    <span class="description">GAAS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/503172/249993/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/249993">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 626b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The reason ActivePerl has this patch is that ppm will extract files with
code that basically does:

    $tar-&gt;extract_file&#40;&#34;foo.pm&#34;, &#34;$ENV{TEMPDIR}/dir/foo.pm&#34;&#41;;

This code fails if $ENV{TEMPDIR} does not point to a directory on the
current volume, since the volume part was chopped off the extraction
path but never put back again.

Attached is a refresh of the patch relative to Archive-Tar-1.39_03 as it
currently appears in ActivePerl.  There is now also an additonal $vol
test in the is_abs&#40;&#41; test; I presume so you can call
$tar-&gt;extract_file&#40;&#34;foo.pm&#34;, &#34;h:foo.pm&#34;&#41; and have it actually copy the
file to the &#34;h:&#34; drive.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/503172/249996/vol.patch">Download vol.patch</a><br />
<span class="downloadcontenttype">text/x-diff 722b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Archive/Tar.pm b/lib/Archive/Tar.pm
index 8f425a4..862e1de 100644
--- a/lib/Archive/Tar.pm
+++ b/lib/Archive/Tar.pm
@@ -610,7 +610,7 @@ sub _extract_file {
 
     my $dir;
     ### is $name an absolute path? ###
-    if&#40; File::Spec-&gt;file_name_is_absolute&#40; $dirs &#41; &#41; {
+    if&#40; $vol || File::Spec-&gt;file_name_is_absolute&#40; $dirs &#41; &#41; {
 
         ### absolute names are not allowed to be in tarballs under
         ### strict mode, so only allow it if a user tells us to do it
@@ -623,7 +623,7 @@ sub _extract_file {
         }
         
         ### user asked us to, it&#39;s fine.
-        $dir = $dirs;
+        $dir = File::Spec-&gt;catpath&#40; $vol, $dirs, &#34;&#34; &#41;;
 
     ### it&#39;s a relative path ###
     } else {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-503173" href="/Public/Bug/Display.html?id=19577#txn-503173">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;31&nbsp;04:06:24&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-505354" href="/Public/Bug/Display.html?id=19577#txn-505354">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;06&nbsp;10:02:17&nbsp;2008</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/505354/251192/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251192">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Aug 31 04:06:18 2008, GAAS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The reason ActivePerl has this patch is that ppm will extract files with
&gt; code that basically does:
&gt; 
&gt;     $tar-&gt;extract_file&#40;&#34;foo.pm&#34;, &#34;$ENV{TEMPDIR}/dir/foo.pm&#34;&#41;;
&gt; 
&gt; This code fails if $ENV{TEMPDIR} does not point to a directory on the
&gt; current volume, since the volume part was chopped off the extraction
&gt; path but never put back again.
&gt; 
&gt; Attached is a refresh of the patch relative to Archive-Tar-1.39_03 as it
&gt; currently appears in ActivePerl.  There is now also an additonal $vol
&gt; test in the is_abs&#40;&#41; test; I presume so you can call
&gt; $tar-&gt;extract_file&#40;&#34;foo.pm&#34;, &#34;h:foo.pm&#34;&#41; and have it actually copy the
&gt; file to the &#34;h:&#34; drive.
</div>
Thanks for the explenation Gisle.

However, this goes against the &#39;rules&#39; of tar, and is a potential vulnerability. The problem is 
quite well explained here:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=30380">http://rt.cpan.org/Ticket/Display.html?id=30380</a></span>

However, if you could modify your patch so that it takes into account the setting of $INSECURE_EXTRACT_MODE &#40;and use that in your own calling code&#41;, then there shouldn&#39;t be 
a problem applying it.

Would that be acceptable?

Cheers,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-505930" href="/Public/Bug/Display.html?id=19577#txn-505930">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;00:45:08&nbsp;2008</span>
    <span class="description">jand [...] ActiveState.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #19577] extract_file&#40;&#41; drops volume part of extraction path </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 7 Sep 2008 21:44:21 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Archive-Tar [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jan Dubois&#34; &lt;jand [...] activestate.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/505930/251510/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251510">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, 06 Sep 2008, Jos Boumans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=19577">http://rt.cpan.org/Ticket/Display.html?id=19577</a></span> &gt;
&gt; 
&gt; On Sun Aug 31 04:06:18 2008, GAAS wrote:
<div class="message-stanza open">&gt; &gt; The reason ActivePerl has this patch is that ppm will extract files with
&gt; &gt; code that basically does:
&gt; &gt;
&gt; &gt;     $tar-&gt;extract_file&#40;&#34;foo.pm&#34;, &#34;$ENV{TEMPDIR}/dir/foo.pm&#34;&#41;;
&gt; &gt;
&gt; &gt; This code fails if $ENV{TEMPDIR} does not point to a directory on the
&gt; &gt; current volume, since the volume part was chopped off the extraction
&gt; &gt; path but never put back again.
&gt; &gt;
&gt; &gt; Attached is a refresh of the patch relative to Archive-Tar-1.39_03 as it
&gt; &gt; currently appears in ActivePerl.  There is now also an additonal $vol
&gt; &gt; test in the is_abs&#40;&#41; test; I presume so you can call
&gt; &gt; $tar-&gt;extract_file&#40;&#34;foo.pm&#34;, &#34;h:foo.pm&#34;&#41; and have it actually copy the
&gt; &gt; file to the &#34;h:&#34; drive.
</div>&gt; 
&gt; Thanks for the explenation Gisle.
&gt; 
&gt; However, this goes against the &#39;rules&#39; of tar, and is a potential
&gt; vulnerability. The problem is quite well explained here:
&gt; 
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=30380">http://rt.cpan.org/Ticket/Display.html?id=30380</a></span>
</div>
I think that is a totally different issue.  Those &#34;rules of tar&#34; try to
prevent paths *stored inside the tarball* to extract to a directory not
under the current directory.

This bug is about the behavior of the 2-argument extract_file&#40;&#41; method.
It already allows you to specify an extraction path that is not under
the current directory.  In fact, you can specify any path you want to.
The problem is just that you are dropping the volume part of this extraction
path.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, if you could modify your patch so that it takes into account
&gt; the setting of $INSECURE_EXTRACT_MODE &#40;and use that in your own
&gt; calling code&#41;, then there shouldn&#39;t be a problem applying it.
&gt; 
&gt; Would that be acceptable?
</div>
I think this is exactly backwards.  Right now you may end up extracting
to a different directory than the one specified as the second argument
in extract_file&#40;&#41;.  Fixing this is not less secure, it is more secure.

Cheers,
-Jan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506029" href="/Public/Bug/Display.html?id=19577#txn-506029">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;08:09:12&nbsp;2008</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/506029/251564/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251564">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 702b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think that is a totally different issue.  Those &#34;rules of tar&#34; try to
&gt; prevent paths *stored inside the tarball* to extract to a directory not
&gt; under the current directory.
&gt; 
&gt; This bug is about the behavior of the 2-argument extract_file&#40;&#41; method.
&gt; It already allows you to specify an extraction path that is not under
&gt; the current directory.  In fact, you can specify any path you want to.
&gt; The problem is just that you are dropping the volume part of this extraction
&gt; path.
</div>
Apparently I&#39;ve misunderstood the nature of the issue; i assumed it was to let
tarballs specify volume names and have those be respected when extracting.

Thanks for explaining, the patch is now in Archive::Tar.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506032" href="/Public/Bug/Display.html?id=19577#txn-506032">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;08:09:15&nbsp;2008</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.611668</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
