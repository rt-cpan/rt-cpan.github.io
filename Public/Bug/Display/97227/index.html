<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #97227 for DateTime-TimeZone: Get &#34;Cannot determine local time zone&#34; when called by irssi script</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #97227 for DateTime-TimeZone: Get &#34;Cannot determine local time zone&#34; when called by irssi script</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DateTime-TimeZone">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DateTime-TimeZone">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DateTime-TimeZone">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DateTime-TimeZone">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/houseabsolute/DateTime-TimeZone/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DateTime-TimeZone">DateTime-TimeZone CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">97227</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DateTime-TimeZone">DateTime-TimeZone</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
beastie [...] tardisi.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-9962-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.70</li>
<li>
1.71</li>
</ul>
    </td>
  </tr>
  <tr id="CF-9963-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.69    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=97227">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1386863" href="/Public/Bug/Display.html?id=97227#txn-1386863">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;14&nbsp;19:26:52&nbsp;2014</span>
    <span class="description">beastie [...] tardisi.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Get &#34;Cannot determine local time zone&#34; when called by irssi script</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1386863/736504/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736504">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">After restarting my irssi today &#40;to update from 9.1-FreeBSD-p9 to 9.1-FreeBSD-p10&#41;, I found that twirssi wouldn&#39;t load in irssi.

It would report &#34;Cannot determine local time zone&#34;.

Using:

  my $tz = DateTime::TimeZone-&gt; new&#40; name =&gt; &#39;local&#39; &#41;;

in simple test script, worked.  But, not when the same is done inside of irssi.  Though it used to work....

I threw in a lot of prints...and saw that from my simple script, it finds /etc/localtime, a sym link.  And, works through:

DateTime::TimeZone::Chicago
DateTime::TimeZone::America::Chicago

And, suceeds.

But, when called from irssi....it continues on with

DateTime::TimeZone::zoneinfo::America::Chicago
etc.

before die&#39;ng.

Eventually, I noted that irssi had been running since its last update and at that time 1.69 was installed.

Working back gradually from:

p5-DateTime-TimeZone-1.71_1
p5-DateTime-TimeZone-1.71
p5-DateTime-TimeZone-1.70

to

p5-DateTime-TimeZone-1.69

Puts 1.69 as the version where things do start working again.

Comparing 1.69 and 1.71_1, the only changes I see are the TimeZone files &#40;2014c -&gt; 2014e&#41;....so I&#39;m lost on what&#39;s different to account for this problem.

Some other versions are:

irssi-0.8.16_1
perl5-5.16.3_11

twirssi.pl v2.6.3
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387324" href="/Public/Bug/Display.html?id=97227#txn-1387324">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;15&nbsp;16:57:01&nbsp;2014</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387324/736734/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736734">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 14 19:26:52 2014, beastie@tardisi.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; After restarting my irssi today &#40;to update from 9.1-FreeBSD-p9 to 9.1-
&gt; FreeBSD-p10&#41;, I found that twirssi wouldn&#39;t load in irssi.
&gt; 
&gt; It would report &#34;Cannot determine local time zone&#34;.
&gt; 
&gt; Using:
&gt; 
&gt; my $tz = DateTime::TimeZone-&gt; new&#40; name =&gt; &#39;local&#39; &#41;;
&gt; 
&gt; in simple test script, worked.  But, not when the same is done inside
&gt; of irssi.  Though it used to work....
&gt; 
&gt; I threw in a lot of prints...and saw that from my simple script, it
&gt; finds /etc/localtime, a sym link.  And, works through:
&gt; 
&gt; DateTime::TimeZone::Chicago
&gt; DateTime::TimeZone::America::Chicago
&gt; 
&gt; And, suceeds.
&gt; 
&gt; But, when called from irssi....it continues on with
&gt; 
&gt; DateTime::TimeZone::zoneinfo::America::Chicago
&gt; etc.
&gt; 
&gt; before die&#39;ng.
&gt; 
&gt; Eventually, I noted that irssi had been running since its last update
&gt; and at that time 1.69 was installed.
&gt; 
&gt; Working back gradually from:
&gt; 
&gt; p5-DateTime-TimeZone-1.71_1
&gt; p5-DateTime-TimeZone-1.71
&gt; p5-DateTime-TimeZone-1.70
&gt; 
&gt; to
&gt; 
&gt; p5-DateTime-TimeZone-1.69
&gt; 
&gt; Puts 1.69 as the version where things do start working again.
&gt; 
&gt; Comparing 1.69 and 1.71_1, the only changes I see are the TimeZone
&gt; files &#40;2014c -&gt; 2014e&#41;....so I&#39;m lost on what&#39;s different to account
&gt; for this problem.
&gt; 
&gt; Some other versions are:
&gt; 
&gt; irssi-0.8.16_1
&gt; perl5-5.16.3_11
&gt; 
&gt; twirssi.pl v2.6.3
</div>
This is pretty odd, since there are really no changes of substance in the local time zone finding code in the past few releases. The last changes were in 1.64.

I strongly suspect that this has nothing to do with this distro and something to do with how irssi sets up the Perl environment. For example, maybe the @INC dirs are not what you expect?

When two identical pieces of code operate differently in two environments I find it&#39;s best to start by examining the environment in great detail.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387325" href="/Public/Bug/Display.html?id=97227#txn-1387325">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;15&nbsp;16:57:01&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387355" href="/Public/Bug/Display.html?id=97227#txn-1387355">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;15&nbsp;18:40:13&nbsp;2014</span>
    <span class="description">beastie [...] tardisi.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> beastie [...] tardisi.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387355/736754/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736754">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 15 16:57:01 2014, DROLSKY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jul 14 19:26:52 2014, beastie@tardisi.com wrote:
<div class="message-stanza open">&gt; &gt; After restarting my irssi today &#40;to update from 9.1-FreeBSD-p9 to
&gt; &gt; 9.1-
&gt; &gt; FreeBSD-p10&#41;, I found that twirssi wouldn&#39;t load in irssi.
&gt; &gt;
&gt; &gt; It would report &#34;Cannot determine local time zone&#34;.
&gt; &gt;
&gt; &gt; Using:
&gt; &gt;
&gt; &gt; my $tz = DateTime::TimeZone-&gt; new&#40; name =&gt; &#39;local&#39; &#41;;
&gt; &gt;
&gt; &gt; in simple test script, worked.  But, not when the same is done inside
&gt; &gt; of irssi.  Though it used to work....
&gt; &gt;
&gt; &gt; I threw in a lot of prints...and saw that from my simple script, it
&gt; &gt; finds /etc/localtime, a sym link.  And, works through:
&gt; &gt;
&gt; &gt; DateTime::TimeZone::Chicago
&gt; &gt; DateTime::TimeZone::America::Chicago
&gt; &gt;
&gt; &gt; And, suceeds.
&gt; &gt;
&gt; &gt; But, when called from irssi....it continues on with
&gt; &gt;
&gt; &gt; DateTime::TimeZone::zoneinfo::America::Chicago
&gt; &gt; etc.
&gt; &gt;
&gt; &gt; before die&#39;ng.
&gt; &gt;
&gt; &gt; Eventually, I noted that irssi had been running since its last update
&gt; &gt; and at that time 1.69 was installed.
&gt; &gt;
&gt; &gt; Working back gradually from:
&gt; &gt;
&gt; &gt; p5-DateTime-TimeZone-1.71_1
&gt; &gt; p5-DateTime-TimeZone-1.71
&gt; &gt; p5-DateTime-TimeZone-1.70
&gt; &gt;
&gt; &gt; to
&gt; &gt;
&gt; &gt; p5-DateTime-TimeZone-1.69
&gt; &gt;
&gt; &gt; Puts 1.69 as the version where things do start working again.
&gt; &gt;
&gt; &gt; Comparing 1.69 and 1.71_1, the only changes I see are the TimeZone
&gt; &gt; files &#40;2014c -&gt; 2014e&#41;....so I&#39;m lost on what&#39;s different to account
&gt; &gt; for this problem.
&gt; &gt;
&gt; &gt; Some other versions are:
&gt; &gt;
&gt; &gt; irssi-0.8.16_1
&gt; &gt; perl5-5.16.3_11
&gt; &gt;
&gt; &gt; twirssi.pl v2.6.3
</div>&gt; 
&gt; This is pretty odd, since there are really no changes of substance in
&gt; the local time zone finding code in the past few releases. The last
&gt; changes were in 1.64.
&gt; 
&gt; I strongly suspect that this has nothing to do with this distro and
&gt; something to do with how irssi sets up the Perl environment. For
&gt; example, maybe the @INC dirs are not what you expect?
&gt; 
&gt; When two identical pieces of code operate differently in two
&gt; environments I find it&#39;s best to start by examining the environment in
&gt; great detail.
</div>
Well, after some thought on how I might see what Perl is like in irssi...

I settled on this q&#38;d script

#!/usr/bin/perl
use Irssi;
use Config qw&#40;myconfig&#41;;
use Data::Dumper;

Irssi::print myconfig&#40;&#41;;
Irssi::print Dumper&#40;@INC&#41;;
Irssi::print Dumper&#40;%ENV&#41;;

loading this and comparing to a similar command line version.

The main difference was @INC inside of irssi is:

$VAR1 = &#39;/home/lchen/.irssi/scripts&#39;;
$VAR2 = &#39;/usr/local/share/irssi/scripts&#39;;
$VAR3 = &#39;/usr/local/lib/perl5/5.16/mach&#39;;
$VAR4 = &#39;/usr/local/lib/perl5/5.16/BSDPAN&#39;;
$VAR5 = &#39;/usr/local/lib/perl5/site_perl/5.16/mach&#39;;
$VAR6 = &#39;/usr/local/lib/perl5/site_perl/5.16&#39;;
$VAR7 = &#39;/usr/local/lib/perl5/5.16&#39;;
$VAR8 = &#39;.&#39;;

While from command line, its:

$VAR1 = &#39;/usr/local/lib/perl5/5.16/BSDPAN&#39;;
$VAR2 = &#39;/usr/local/lib/perl5/site_perl/5.16/mach&#39;;
$VAR3 = &#39;/usr/local/lib/perl5/site_perl/5.16&#39;;
$VAR4 = &#39;/usr/local/lib/perl5/5.16/mach&#39;;
$VAR5 = &#39;/usr/local/lib/perl5/5.16&#39;;
$VAR6 = &#39;.&#39;;

Just a slight difference in ordering, but

Forcing an update locatedb with 1.69 and then 1.71_1, yields only one result:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; locate Chicago.pm
</div>/usr/local/lib/perl5/site_perl/5.16/DateTime/TimeZone/America/Chicago.pm

There were slight environment differences....just 3 insignificant ones -- REMOTE_HOST, SHLVL and WINDOW.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387357" href="/Public/Bug/Display.html?id=97227#txn-1387357">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;15&nbsp;18:57:01&nbsp;2014</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97227] Get &#34;Cannot determine local time zone&#34; when called by irssi script</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 15 Jul 2014 17:56:51 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;beastie [...] tardisi.com via RT&#34; &lt;bug-DateTime-TimeZone [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387357/736756/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736756">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 903b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 15 Jul 2014, beastie@tardisi.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Forcing an update locatedb with 1.69 and then 1.71_1, yields only one result:
&gt;
<div class="message-stanza open">&gt;&gt; locate Chicago.pm
</div>&gt; /usr/local/lib/perl5/site_perl/5.16/DateTime/TimeZone/America/Chicago.pm
&gt;
&gt; There were slight environment differences....just 3 insignificant ones -- REMOTE_HOST, SHLVL and WINDOW.
</div>
I&#39;m a bit stumped. I can&#39;t see how any code changes from 1.69 to 1.71 made 
a difference. I took a look at the FreeBSD ports CVS but they&#39;re not 
applying any patches on top of my code so it&#39;s not that either.

You might try writing to the datetime@perl.org list and asking if anyone 
there has any ideas.


-dave

/*============================================================
<span class="clickylink"><a target="new" rel="nofollow" href="http://VegGuide.org">http://VegGuide.org</a></span>               <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.urth.org">http://blog.urth.org</a></span>
Your guide to all that&#39;s veg      House Absolute&#40;ly Pointless&#41;
============================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387617" href="/Public/Bug/Display.html?id=97227#txn-1387617">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;16&nbsp;11:02:30&nbsp;2014</span>
    <span class="description">beastie [...] tardisi.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> beastie [...] tardisi.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387617/736898/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736898">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 15 18:57:01 2014, autarch@urth.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue, 15 Jul 2014, beastie@tardisi.com via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Forcing an update locatedb with 1.69 and then 1.71_1, yields only one
&gt; &gt; result:
&gt; &gt;
<div class="message-stanza open">&gt; &gt;&gt; locate Chicago.pm
</div>&gt; &gt; /usr/local/lib/perl5/site_perl/5.16/DateTime/TimeZone/America/Chicago.pm
&gt; &gt;
&gt; &gt; There were slight environment differences....just 3 insignificant
&gt; &gt; ones -- REMOTE_HOST, SHLVL and WINDOW.
</div>&gt; 
&gt; I&#39;m a bit stumped. I can&#39;t see how any code changes from 1.69 to 1.71
&gt; made
&gt; a difference. I took a look at the FreeBSD ports CVS but they&#39;re not
&gt; applying any patches on top of my code so it&#39;s not that either.
&gt; 
&gt; You might try writing to the datetime@perl.org list and asking if
&gt; anyone
&gt; there has any ideas.
&gt; 
&gt; 
&gt; -dave
&gt; 
&gt; 
</div>Fiddling around some more....

I updated to 1.71_1 again....still broke.

Tried copying Chicago.pm from 1.69 in....still broke.  Put it back to 1.71.  

Didn&#39;t see how changing the order of DST rules would make a difference....

Thinking about other files that differed between 1.69 and 1.71...

DateTime::TimeZone::OlsonDB::Observance seems to be the culprit?

When I copied in Observance.pm from 1.69, twirssi loads and works again.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387619" href="/Public/Bug/Display.html?id=97227#txn-1387619">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;16&nbsp;11:07:45&nbsp;2014</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97227] Get &#34;Cannot determine local time zone&#34; when called by irssi script</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Jul 2014 10:07:34 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;beastie [...] tardisi.com via RT&#34; &lt;bug-DateTime-TimeZone [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387619/736900/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736900">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 16 Jul 2014, beastie@tardisi.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I updated to 1.71_1 again....still broke.
&gt;
&gt; Tried copying Chicago.pm from 1.69 in....still broke.  Put it back to 1.71.
&gt;
&gt; Didn&#39;t see how changing the order of DST rules would make a difference....
&gt;
&gt; Thinking about other files that differed between 1.69 and 1.71...
&gt;
&gt; DateTime::TimeZone::OlsonDB::Observance seems to be the culprit?
&gt;
&gt; When I copied in Observance.pm from 1.69, twirssi loads and works again.
</div>
That has nothing to do with _finding_ the local time zone, which is where 
things seem to go wrong for you. The Observance code only kicks in when 
&#40;some&#41; time zones are being loaded.

I do wonder whether you actually have the List::AllUtils prereq installed, 
but I thought bsdpan took care of that for you.


-dave

/*============================================================
<span class="clickylink"><a target="new" rel="nofollow" href="http://VegGuide.org">http://VegGuide.org</a></span>               <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.urth.org">http://blog.urth.org</a></span>
Your guide to all that&#39;s veg      House Absolute&#40;ly Pointless&#41;
============================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387661" href="/Public/Bug/Display.html?id=97227#txn-1387661">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;16&nbsp;12:03:49&nbsp;2014</span>
    <span class="description">beastie [...] tardisi.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97227] Get &#34;Cannot determine local time zone&#34; when called by irssi script</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Jul 2014 11:03:32 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DateTime-TimeZone [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> The BSD Dreamer &lt;beastie [...] tardisi.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387661/736928/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736928">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-07-16 10:07, autarch@urth.org via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=97227">https://rt.cpan.org/Ticket/Display.html?id=97227</a></span> &gt;
&gt; 
&gt; On Wed, 16 Jul 2014, beastie@tardisi.com via RT wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; I updated to 1.71_1 again....still broke.
&gt;&gt; 
&gt;&gt; Tried copying Chicago.pm from 1.69 in....still broke.  Put it back to 1.71.
&gt;&gt; 
&gt;&gt; Didn&#39;t see how changing the order of DST rules would make a difference....
&gt;&gt; 
&gt;&gt; Thinking about other files that differed between 1.69 and 1.71...
&gt;&gt; 
&gt;&gt; DateTime::TimeZone::OlsonDB::Observance seems to be the culprit?
&gt;&gt; 
&gt;&gt; When I copied in Observance.pm from 1.69, twirssi loads and works again.
</div>&gt; 
&gt; That has nothing to do with _finding_ the local time zone, which is where
&gt; things seem to go wrong for you. The Observance code only kicks in when
&gt; &#40;some&#41; time zones are being loaded.
&gt; 
&gt; I do wonder whether you actually have the List::AllUtils prereq installed,
&gt; but I thought bsdpan took care of that for you.
&gt; 
</div>
Its installed, because its a BUILD/RUN depend for the port.

I don&#39;t use BSDPAN because it doesn&#39;t support pkgng, which I may need to dig 
into as well someday....
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1402516" href="/Public/Bug/Display.html?id=97227#txn-1402516">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;19:38:25&nbsp;2014</span>
    <span class="description">beastie [...] tardisi.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97227] Get &#34;Cannot determine local time zone&#34; when called by irssi script</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Aug 2014 18:38:07 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DateTime-TimeZone [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> The BSD Dreamer &lt;beastie [...] tardisi.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1402516/744589/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/744589">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-07-16 11:03, The BSD Dreamer wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2014-07-16 10:07, autarch@urth.org via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=97227">https://rt.cpan.org/Ticket/Display.html?id=97227</a></span> &gt;
&gt;&gt; 
&gt;&gt; On Wed, 16 Jul 2014, beastie@tardisi.com via RT wrote:
&gt;&gt; 
<div class="message-stanza open">&gt;&gt;&gt; I updated to 1.71_1 again....still broke.
&gt;&gt;&gt; 
&gt;&gt;&gt; Tried copying Chicago.pm from 1.69 in....still broke.  Put it back to 
&gt;&gt;&gt; 1.71.
&gt;&gt;&gt; 
&gt;&gt;&gt; Didn&#39;t see how changing the order of DST rules would make a difference....
&gt;&gt;&gt; 
&gt;&gt;&gt; Thinking about other files that differed between 1.69 and 1.71...
&gt;&gt;&gt; 
&gt;&gt;&gt; DateTime::TimeZone::OlsonDB::Observance seems to be the culprit?
&gt;&gt;&gt; 
&gt;&gt;&gt; When I copied in Observance.pm from 1.69, twirssi loads and works again.
</div>&gt;&gt; 
&gt;&gt; That has nothing to do with _finding_ the local time zone, which is where
&gt;&gt; things seem to go wrong for you. The Observance code only kicks in when
&gt;&gt; &#40;some&#41; time zones are being loaded.
&gt;&gt; 
&gt;&gt; I do wonder whether you actually have the List::AllUtils prereq installed,
&gt;&gt; but I thought bsdpan took care of that for you.
&gt;&gt; 
</div>&gt; 
&gt; Its installed, because its a BUILD/RUN depend for the port.
&gt; 
&gt; I don&#39;t use BSDPAN because it doesn&#39;t support pkgng, which I may need to dig
&gt; into as well someday....
</div>
Well, I finally decided to really dig into this problem today...and turns out 
the previously noted differences in @INC were the culprit.

irssi is inserting &#34;$HOME/.irssi/scripts&#34;, &#34;$PREFIX/share/issi/scripts&#34; and 
&#34;/usr/local/lib/perl5/5.16/mach&#34; for INC &#40;which perl then fills in with its 
built in&#41;....

&#39;/usr/local/lib/perl5/5.16/BSDPAN&#39;;
&#39;/usr/local/lib/perl5/site_perl/5.16/mach&#39;;
&#39;/usr/local/lib/perl5/site_perl/5.16&#39;;
&#39;/usr/local/lib/perl5/5.16&#39;;
&#39;.&#39;;

Thus causing &#34;/usr/local/lib/perl5/5.16/mach&#34; to get looked in before 
&#34;/usr/local/lib/perl5/site_perl/5.16/mach&#34;.

And, the problem is where Observance.pm switched from using List::Util to 
List::AllUtils after 1.69.... List::AllUtils requires List::Util &gt; 1.31, 
which
is handled by v1.35 being installed in 
&#39;/usr/local/lib/perl5/site_perl/5.16/mach&#39;, to override the version that is 
included with Perl &#40;1.25&#41;.

So, irssi is causing things to fail by causing the base version to get found 
and loaded first instead.

And, the bad thing is that reading through the logs on what its doing....is 
that its trying to determine where Irssi.pm is going to be installed to move 
that directory ahead of the others.

But, Irssi.pm is installed in &#39;/usr/local/lib/perl5/site_perl/5.16/mach&#39;.

Fortunately, there&#39;s a configuration variable to change this....so I did a

/set perl_use_lib /usr/local/lib/perl5/site_perl/5.16/mach
/save

and restarted irssi, and after a false start &#40;reinstall perl modules to clear 
the debugging I had thrown in&#41; everything started working again.

Now to decide where the irssi bug goes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1402563" href="/Public/Bug/Display.html?id=97227#txn-1402563">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;22:18:03&nbsp;2014</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.546198</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
