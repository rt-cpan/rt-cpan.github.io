<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53706 for SVN-Hooks: SVN::Hooks add-on - AddJiraComments</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53706 for SVN-Hooks: SVN::Hooks add-on - AddJiraComments</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SVN-Hooks/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SVN-Hooks/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SVN-Hooks/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SVN-Hooks/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/gnustavo/SVN-Hooks/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/SVN-Hooks">SVN-Hooks CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53706</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SVN-Hooks/Active/">SVN-Hooks</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">GNUSTAVO [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Chris.Rule [...] l-3com.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-223886-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-223887-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;14&nbsp;18:45:01&nbsp;2010</span>
    <span class="description">Chris.Rule [...] l-3com.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jan 2010 17:42:29 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Hooks [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Chris.Rule [...] l-3com.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m using SVN::Hooks version 0.24 to do Jira issue validation and email
notification under perl v5.8.8 on unix. I needed the ability to also add
comments to each Jira issue for each subversion commit.

 

To do this I created a new SVN::Hooks plugin. I&#39;ve included the source
below. The license is the same as for SVN::Hooks.

 

Enjoy.

Chris Rule

 
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;14&nbsp;19:00:22&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jan 2010 22:00:06 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Hooks [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jan 14, 2010 at 9:45 PM, Chris.Rule via RT &lt;
bug-SVN-Hooks@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thu Jan 14 18:45:01 2010: Request 53706 was acted upon.
&gt; Transaction: Ticket created by Chris.Rule@l-3com.com
&gt;       Queue: SVN-Hooks
&gt;     Subject: SVN::Hooks add-on - AddJiraComments
&gt;   Broken in: &#40;no value&#41;
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: Chris.Rule@l-3com.com
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53706">https://rt.cpan.org/Ticket/Display.html?id=53706</a></span> &gt;
&gt;
&gt;
&gt; I&#39;m using SVN::Hooks version 0.24 to do Jira issue validation and email
&gt; notification under perl v5.8.8 on unix. I needed the ability to also add
&gt; comments to each Jira issue for each subversion commit.
&gt;
&gt; To do this I created a new SVN::Hooks plugin. I&#39;ve included the source
&gt; below. The license is the same as for SVN::Hooks.
&gt;
</div>
Hey, Chris. Thanks. It&#39;s cool and gave me some other ideas...

But have you considered the JIRA Subversion
Plugin&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://confluence.atlassian.com/display/JIRAEXT/JIRA+Subversion+plugin">http://confluence.atlassian.com/display/JIRAEXT/JIRA+Subversion+plugin</a></span>&gt;?
It probably does what you want but instead of logging the commits as JIRA
comments it uses another tab in the issue specific for the Subversion logs.
What do you think?

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;14&nbsp;19:00:24&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;14&nbsp;19:08:34&nbsp;2010</span>
    <span class="description">Chris.Rule [...] l-3com.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jan 2010 18:08:12 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Hooks [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Chris.Rule [...] l-3com.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We are already using the subversion plugin, but I can&#39;t figure out a way to get Jira to show me a list of issues that have been worked between two dates &#40;generally some date in the past to now&#41;. By &#34;have been worked&#34; I mean there is code modifications in subversion against the issues.

We are also using Fisheye. In Fisheye I can get a list of files that have been changed between two dates, but I need a list of the issues affected with their summaries. Since the comments are now being added with each commit, I can simply search the comments between dates which Jira does allow. 

Chris Rule

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Gustavo Leite de Mendonça Chaves via RT [mailto:bug-SVN-Hooks@rt.cpan.org] 
Sent: Thursday, January 14, 2010 6:00 PM
To: Chris.Rule@l-3com.com
Subject: Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=53706">http://rt.cpan.org/Ticket/Display.html?id=53706</a></span> &gt;

On Thu, Jan 14, 2010 at 9:45 PM, Chris.Rule via RT &lt;
bug-SVN-Hooks@rt.cpan.org&gt; wrote:

<div class="message-stanza open">&gt; Thu Jan 14 18:45:01 2010: Request 53706 was acted upon.
&gt; Transaction: Ticket created by Chris.Rule@l-3com.com
&gt;       Queue: SVN-Hooks
&gt;     Subject: SVN::Hooks add-on - AddJiraComments
&gt;   Broken in: &#40;no value&#41;
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: Chris.Rule@l-3com.com
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53706">https://rt.cpan.org/Ticket/Display.html?id=53706</a></span> &gt;
&gt;
&gt;
&gt; I&#39;m using SVN::Hooks version 0.24 to do Jira issue validation and email
&gt; notification under perl v5.8.8 on unix. I needed the ability to also add
&gt; comments to each Jira issue for each subversion commit.
&gt;
&gt; To do this I created a new SVN::Hooks plugin. I&#39;ve included the source
&gt; below. The license is the same as for SVN::Hooks.
&gt;
</div>
Hey, Chris. Thanks. It&#39;s cool and gave me some other ideas...

But have you considered the JIRA Subversion
Plugin&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://confluence.atlassian.com/display/JIRAEXT/JIRA+Subversion+plugin">http://confluence.atlassian.com/display/JIRAEXT/JIRA+Subversion+plugin</a></span>&gt;?
It probably does what you want but instead of logging the commits as JIRA
comments it uses another tab in the issue specific for the Subversion logs.
What do you think?

Gustavo.

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;14&nbsp;19:37:05&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jan 2010 22:36:46 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Hooks [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jan 14, 2010 at 10:08 PM, Chris.Rule via RT &lt;
bug-SVN-Hooks@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: SVN-Hooks
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=53706">http://rt.cpan.org/Ticket/Display.html?id=53706</a></span> &gt;
&gt;
&gt; We are already using the subversion plugin, but I can&#39;t figure out a way to
&gt; get Jira to show me a list of issues that have been worked between two dates
&gt; &#40;generally some date in the past to now&#41;. By &#34;have been worked&#34; I mean there
&gt; is code modifications in subversion against the issues.
&gt;
</div>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We are also using Fisheye. In Fisheye I can get a list of files that have
&gt; been changed between two dates, but I need a list of the issues affected
&gt; with their summaries. Since the comments are now being added with each
&gt; commit, I can simply search the comments between dates which Jira does
&gt; allow.
&gt;
</div>
Ah. Got it.

I have a feeling that the two plugins could be merged. Better yet, perhaps I
could extend the CheckJira in a way that would allow you to implement the
functionality you want and more...

I could, for instance, add an argument the the check_one/check_all
functions. They already receive the JIRA::Client object and the
RemoteIssue&#39;s objects. If they also received the SVN::Look object one could
extract all the commit information and use it to add the comments. Something
like this:

CHECK_JIRA&#40;..., check_one =&gt; sub {
    my &#40;$jira, $issue, $svnlook&#41; = @_;
    ... paste here the meat of your post_commit sub...
}&#41;;

In order to allow for the substitutions inside the comment string one could
do tricks with closures.

Besides being more general, there would be a single JIRA::Client object
connecting the hook to JIRA. WIth the two separate plugins there would be
two.

The addition of a third argument to check_one is backward compatible. But
check_all has an unbounded number of parameters. I can think of a few
solutions &#40;inserting a second argument and making an incompatible change,
defining a new option, let the user check the argument type &#40;horror&#41;...&#41; but
no one is perfect.

What do you think of this &#34;extend and embrace&#34; approach? :-&#41;

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;10:17:33&nbsp;2010</span>
    <span class="description">Chris.Rule [...] l-3com.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Jan 2010 09:16:59 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Hooks [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Chris.Rule [...] l-3com.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think merging the two is a very good idea; if nothing else to only have a single JIRA::Client object that has to be defined.

I had implemented this as a post-commit script because at that point I know the commit has happened. I think this functionality would need to stay the same. Wouldn&#39;t want to add a comment to some issues then have later issues cause the commit to be aborted for some reason. Given this, attempting to use the existing check_one or check_all subs may be problematic since these would also be called in the pre-commit script. I wouldn&#39;t want to have to say &#34;if &#40;pre-commit&#41; do something&#34; in the scripts. To easy to do something that I wouldn&#39;t want, forget to add the check, and could break existing scripts.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; In order to allow for the substitutions inside the comment string one could do tricks with closures.
</div>Wow! Something I&#39;ve never run into with Perl. This seems pretty obscure but it might work. Not sure how though.

Sounds like a good thought,
Chris Rule

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Gustavo Leite de Mendonça Chaves via RT [mailto:bug-SVN-Hooks@rt.cpan.org] 
Sent: Thursday, January 14, 2010 6:37 PM
To: Chris.Rule@l-3com.com
Subject: Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53706">https://rt.cpan.org/Ticket/Display.html?id=53706</a></span> &gt;

...

I have a feeling that the two plugins could be merged. Better yet, perhaps I
could extend the CheckJira in a way that would allow you to implement the
functionality you want and more...

I could, for instance, add an argument the the check_one/check_all
functions. They already receive the JIRA::Client object and the
RemoteIssue&#39;s objects. If they also received the SVN::Look object one could
extract all the commit information and use it to add the comments. Something
like this:

CHECK_JIRA&#40;..., check_one =&gt; sub {
    my &#40;$jira, $issue, $svnlook&#41; = @_;
    ... paste here the meat of your post_commit sub...
}&#41;;

In order to allow for the substitutions inside the comment string one could
do tricks with closures.

Besides being more general, there would be a single JIRA::Client object
connecting the hook to JIRA. WIth the two separate plugins there would be
two.

The addition of a third argument to check_one is backward compatible. But
check_all has an unbounded number of parameters. I can think of a few
solutions &#40;inserting a second argument and making an incompatible change,
defining a new option, let the user check the argument type &#40;horror&#41;...&#41; but
no one is perfect.

What do you think of this &#34;extend and embrace&#34; approach? :-&#41;

Gustavo.

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;10:44:32&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Jan 2010 13:44:06 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Hooks [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jan 15, 2010 at 1:17 PM, Chris.Rule via RT &lt;
bug-SVN-Hooks@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: SVN-Hooks
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=53706">http://rt.cpan.org/Ticket/Display.html?id=53706</a></span> &gt;
&gt;
&gt; I think merging the two is a very good idea; if nothing else to only have a
&gt; single JIRA::Client object that has to be defined.
&gt;
&gt; I had implemented this as a post-commit script because at that point I know
&gt; the commit has happened. I think this functionality would need to stay the
&gt; same. Wouldn&#39;t want to add a comment to some issues then have later issues
&gt; cause the commit to be aborted for some reason. Given this, attempting to
&gt; use the existing check_one or check_all subs may be problematic since these
&gt; would also be called in the pre-commit script. I wouldn&#39;t want to have to
&gt; say &#34;if &#40;pre-commit&#41; do something&#34; in the scripts. To easy to do something
&gt; that I wouldn&#39;t want, forget to add the check, and could break existing
&gt; scripts.
&gt;
</div>
Of course! I forgot about the pre/post commit hooks. But this also solves
the problem with modifying the check_all function signature, because I don&#39;t
need to. All I have to do is to add another option to CHECK_JIRA. Perhaps an
options called &#34;post_commit&#34; which would accept a ref to a subroutine with
the following signature: &#40;$jira, $svnlook, @issues&#41;. This soubroutine would
be called during the post_commit phase and not during the pre_commit phase.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;&gt; In order to allow for the substitutions inside the comment string one
</div>&gt; could do tricks with closures.
&gt; Wow! Something I&#39;ve never run into with Perl. This seems pretty obscure but
&gt; it might work. Not sure how though.
&gt;
</div>
A closure is simply a routine defined inside another but which uses a local
variable of the outer routine. In this case I was thinking about something
along these lines:

sub add_comment {
  my &#40;$format&#41; = @_;
  sub closure {
    my &#40;$jira, $svnlook, @issues&#41; = @_;
    ... extract the commit info from $svnlook
    my $comment = $format;
    ... make all substitutions inside $comment
    foreach my $issue &#40;@issues&#41; {
      $jira-&gt;addComment&#40;$issue, $comment&#41;;
    }
  }
  return \&#38;closure;
}

CHECK_JIRA&#40;... post_commit =&gt; add_comment&#40;&#34;Subversion Commit rev {rev} by
{author} on {date}\n{logmessage}&#34;&#41;&#41;;

With add_comment defined in your svn-hooks.conf you can have several
CHECK_JIRA calls, each one specifying a different comment format.

How this seems to you?

I&#39;ll try to release a new version of SVN::Hooks along these lines during the
weekend.

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;12:17:13&nbsp;2010</span>
    <span class="description">Chris.Rule [...] l-3com.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Jan 2010 11:16:50 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Hooks [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Chris.Rule [...] l-3com.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That should work and is definitely more flexible. I think an example would be useful to show how to use it with closure since closure is an advanced perl technique. Unfortunately I don&#39;t seem to have a good enough imagination today to think of what else you would want to do in a post-commit script with Jira besides adding a comment. 

It might also be a good idea to also have a simpler example that shows the svnlook information extraction:

sub add_comment {
    my &#40;$jira, $svnlook, @issues&#41; = @_;

    # Extract useful information into local variables from svnlook.
    my $repo = $svnlook-&gt;repo&#40;&#41;;
    my $rev = $svnlook-&gt;rev&#40;&#41;;
    my $author = $svnlook-&gt;author&#40;&#41;;
    my $logMessage = $svnlook-&gt;log_msg&#40;&#41;;
    my $revdate = $svnlook-&gt;date&#40;&#41;;

    foreach my $issue &#40;@issues&#41; {
      $jira-&gt;addComment&#40;$issue, &#40;&#34;Subversion Commit rev $rev by $author on $date\n$logMessage&#41;;
    }
}

CHECK_JIRA&#40;... post_commit =&gt; \&#38;add_comment&#41;;

I was wondering if there should be some &#34;helper&#34; subs available to do things like make the substitutions or do the addComment, but I think just having examples would be good enough.

Sounds like a plan.
Chris Rule

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Gustavo Leite de Mendonça Chaves via RT [mailto:bug-SVN-Hooks@rt.cpan.org] 
Sent: Friday, January 15, 2010 9:45 AM
To: Chris.Rule@l-3com.com
Subject: Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments

...

Of course! I forgot about the pre/post commit hooks. But this also solves
the problem with modifying the check_all function signature, because I don&#39;t
need to. All I have to do is to add another option to CHECK_JIRA. Perhaps an
options called &#34;post_commit&#34; which would accept a ref to a subroutine with
the following signature: &#40;$jira, $svnlook, @issues&#41;. This soubroutine would
be called during the post_commit phase and not during the pre_commit phase.


<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; In order to allow for the substitutions inside the comment string one
</div>&gt; could do tricks with closures.
&gt; Wow! Something I&#39;ve never run into with Perl. This seems pretty obscure but
&gt; it might work. Not sure how though.
&gt;
</div>
A closure is simply a routine defined inside another but which uses a local
variable of the outer routine. In this case I was thinking about something
along these lines:

sub add_comment {
  my &#40;$format&#41; = @_;
  sub closure {
    my &#40;$jira, $svnlook, @issues&#41; = @_;
    ... extract the commit info from $svnlook
    my $comment = $format;
    ... make all substitutions inside $comment
    foreach my $issue &#40;@issues&#41; {
      $jira-&gt;addComment&#40;$issue, $comment&#41;;
    }
  }
  return \&#38;closure;
}

CHECK_JIRA&#40;... post_commit =&gt; add_comment&#40;&#34;Subversion Commit rev {rev} by
{author} on {date}\n{logmessage}&#34;&#41;&#41;;

With add_comment defined in your svn-hooks.conf you can have several
CHECK_JIRA calls, each one specifying a different comment format.

How this seems to you?

I&#39;ll try to release a new version of SVN::Hooks along these lines during the
weekend.

Gustavo.

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;16&nbsp;17:14:20&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 16 Jan 2010 20:14:02 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Hooks [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Chris, I changed the CheckJira plugin along the lines we discussed this
week. Before uploading it as a new official version I&#39;d like to have your
feedback. Can you implement what you want with it? Is the example in the POD
clear enough? &#40;I made it very short.&#41;

You can just substitute the attached version for the one you already have.

Thanks.

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;17&nbsp;19:46:08&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 17 Jan 2010 22:45:48 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Hooks [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Chris, I noticed a problem with the CheckJira I sent to you yesterday.
Please, use the one attached here instead.

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;19&nbsp;11:04:53&nbsp;2010</span>
    <span class="description">Chris.Rule [...] l-3com.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Jan 2010 10:02:27 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Hooks [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Chris.Rule [...] l-3com.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Gustavo,
Looks like it works.

The only thing I would change in the POD description is to change the perl comment in the add_comment function example.
Instead of:
            # interpolate commit info in the comment

I would expand it to:
            # Substitute keywords in the input comment with calls
            # into the $svnlook reference.

Otherwise it looks great. Neat trick BTW on that substitution code. Would never have thought of that.

Thanks,
Chris Rule

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Gustavo Leite de Mendonça Chaves via RT [mailto:bug-SVN-Hooks@rt.cpan.org] 
Sent: Sunday, January 17, 2010 6:46 PM
To: Chris.Rule@l-3com.com
Subject: Re: [rt.cpan.org #53706] SVN::Hooks add-on - AddJiraComments

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=53706">http://rt.cpan.org/Ticket/Display.html?id=53706</a></span> &gt;

Chris, I noticed a problem with the CheckJira I sent to you yesterday.
Please, use the one attached here instead.

Gustavo.

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;19&nbsp;18:14:15&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;19&nbsp;18:15:23&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Chris, I just uploaded SVN::Hooks 0.25 to PAUSE. It should appear
shortly on CPAN. It contains the changed CheckJira.

Thanks a lot for your cooperation.

Gustavo.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;19&nbsp;18:15:25&nbsp;2010</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
