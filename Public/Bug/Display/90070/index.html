<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #90070 for Set-Object: convenience method @$ resorts -- extremely inefficient should be discouraged or warned about</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #90070 for Set-Object: convenience method @$ resorts -- extremely inefficient should be discouraged or warned about</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Set-Object">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Set-Object">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Set-Object">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Set-Object">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Set-Object">Set-Object CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">90070</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Set-Object">Set-Object</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">RURBAN [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ftobin [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-28620-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-28621-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.34    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




set_object_bug.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1757389/945616/set_object_bug.pl">
Mon Nov 13 07:21:04 2017 (632b) by STARLIGHT [...] cpan.org
</a>
</font></li>
</ul>


set_object_bug.tbz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1756955/945367/set_object_bug.tbz">
Fri Nov 10 10:53:39 2017 (250.5k) by STARLIGHT [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=90070">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1283798" href="/Public/Bug/Display.html?id=90070#txn-1283798">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;05&nbsp;13:54:27&nbsp;2013</span>
    <span class="description">ftobin [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> convenience method @$ resorts -- extremely inefficient should be
 discouraged or warned about</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1283798/680334/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/680334">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The usage of @$set to get the members of a set is extremely slow compared to $set-&gt;members&#40;&#41;.
It appears each time @$ is called, promote&#40;&#41; causes a sort to occur.
I&#39;m not sure of the purpose for this, but it causes extreme inefficiency,
but it ends up being hundreds to thousands of times slower than just $set-&gt;members&#40;&#41;, depending
on the number of elements &#40;even with just a couple hundred elements&#41;.

If the current sorting behavior for @$ needs to be maintained, I recommend being
very clear in the documentation about the efficiency of it compared to $set-&gt;members&#40;&#41;.
As it stands, the documentation, near the top, says that @$ is an alias for $set-&gt;members&#40;&#41;,
which is clearly not true.


#!/usr/bin/perl

use strict;
use warnings;
use Benchmark;
use Set::Object;

my @list = &#40;1..100&#41;;

my $set = Set::Object-&gt;new&#40;@list&#41;;


Benchmark::cmpthese&#40;1000,
                    { &#39;@$set&#39;           =&gt; sub { my $sum = 0;
                                                 foreach &#40;@$set&#41; { $sum += $_ }},
                      &#39;$set-&gt;members&#40;&#41;&#39; =&gt; sub { my $sum = 0;
                                                 foreach &#40;$set-&gt;members&#40;&#41;&#41; { $sum += $_ }}}&#41;;


                   Rate           @$set $set-&gt;members&#40;&#41;
@$set             149/s              --           -100%
$set-&gt;members&#40;&#41; 33333/s          22267%              --
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1301842" href="/Public/Bug/Display.html?id=90070#txn-1301842">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;13&nbsp;21:49:19&nbsp;2013</span>
    <span class="description">RURBAN [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756864" href="/Public/Bug/Display.html?id=90070#txn-1756864">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;07:55:19&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1756864/945310/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945310">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1003b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This issue had been silently patched somewhere between 1.28 and current release. Please consider reflecting that explicitly in changelog, as well as encouraging users to upgrade, because it was actually much worse than this. The described behaviour was sorting the set everytime object was accessed, so taking previous example and repeating a few times:

foreach &#40;@$set&#41; {
    $sum += $_; 
    $sum += $_;
    $sum += $_;
}},

would sort in each&#40;!&#41; of these lines where $_ is used...

In our case, on Set::Object@1.28 using $set-&gt;members&#40;&#41; instead of @{$set} has proven to be over four thousand times faster. This small change reduced online time from 1135s to 0.246s.

Once again, please consider advising your users to upgrade, as there was little reason to upgrade from supposedly stable version which seemed to work just great, until we hit this edge case where the bug reared its ugly head.

Also this issue should be closed, as the problem is non-existent on current &#40;1.35&#41; version of Set::Object.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756865" href="/Public/Bug/Display.html?id=90070#txn-1756865">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;07:55:20&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756868" href="/Public/Bug/Display.html?id=90070#txn-1756868">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;07:55:20&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Fixed in 1.28 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756869" href="/Public/Bug/Display.html?id=90070#txn-1756869">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;07:57:37&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1756869/945313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 96b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">bah, wrong fixed in, the one it &#40;probably&#41; is fixed is 1.33 &#40;which is missing from the selector&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756872" href="/Public/Bug/Display.html?id=90070#txn-1756872">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;07:57:38&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Fixed in 1.34 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756873" href="/Public/Bug/Display.html?id=90070#txn-1756873">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;07:57:38&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Fixed in 1.28 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756901" href="/Public/Bug/Display.html?id=90070#txn-1756901">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;08:54:30&nbsp;2017</span>
    <span class="description">RURBAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1756901/945328/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945328">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 260b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 10 07:57:37 2017, STARLIGHT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; bah, wrong fixed in, the one it &#40;probably&#41; is fixed is 1.33 &#40;which is
&gt; missing from the selector&#41;
</div>
yes, 1.33 fixed the pod to mention this improvement.
the actual fix was with 1.30.

no problem.
-- 
Reini Urban
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756904" href="/Public/Bug/Display.html?id=90070#txn-1756904">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;08:54:31&nbsp;2017</span>
    <span class="description">RURBAN [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756940" href="/Public/Bug/Display.html?id=90070#txn-1756940">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;10:07:15&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756955" href="/Public/Bug/Display.html?id=90070#txn-1756955">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;10&nbsp;10:53:39&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1756955/945366/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945366">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; yes, 1.33 fixed the pod to mention this improvement.
</div>
I am very sorry for reopening this but I was too quick to actually consider this fixed. I upgraded to the newest version &#40;1.35&#41; to check if it fixed the issue &#40;and I&#39;m not talking about fixing pod&#41;. And I assumed it fixed things because I had a bug in my own testing code prepared especially for pasting in this report. Talk about overzealous... Anyhow.

The main point is the dreaded behaviour of sneakily sorting *everytime* an object *returned* from @{$set} is *ACCESSED* remains in the 1.35 still. So its not about the added cost of sort, its the repeated cost of calling promote that hurts. And the time *doubles* everytime such item from @{$set} is used.

I&#39;ve prepared an NYTProf analysis of a simple @{$set} case &#40;set_object_bug.pl&#41; and attached it to the report, but the gist of it can be seen here:

for &#40;1..100&#41; {
    my $x = 0;
    foreach my $item &#40;$lil_set-&gt;members&#40;&#41;&#41; {
    # spent  7.24ms making 100 calls to Set::Object::members, avg 72µs/call
        $x += $item;
        $x += $item;
        $x += $item;
        $x += $item;
        $x += $item;
}
                  
foreach my $item &#40;@{$lil_set}&#41; {
# spent  2.76ms making 100 calls to Set::Object::__ANON__[Set/Object.pm:750], avg 28µs/call
# spent   312µs making 100 calls to Set::Object::TieArray::FETCHSIZE, avg 3µs/call
    $x += $item;
    # spent  54.1s making 100000 calls to Set::Object::TieArray::FETCH, avg 541µs/call
    $x += $item;
    # spent  54.0s making 100000 calls to Set::Object::TieArray::FETCH, avg 540µs/call
    $x += $item;
    # spent  54.0s making 100000 calls to Set::Object::TieArray::FETCH, avg 540µs/call
    $x += $item;
    # spent  54.1s making 100000 calls to Set::Object::TieArray::FETCH, avg 541µs/call
    $x += $item;
    # spent  54.1s making 100000 calls to Set::Object::TieArray::FETCH, avg 541µs/call
    # spent   380ms making 100000 calls to Set::Object::TieArray::FETCHSIZE, avg 4µs/call
}

Please note the number of calls it is causing. The severity is IMHO high here - it will cause &#34;shadow&#34; performance leaks when using the convenience form. Everytime the item is accessed &#40;FETCH&#41;, it will call promote&#40;&#41; which in turn is sorting the set, leading to the cases like we recently had, where the total time spent was reduced from 1136s to 0.236s &#40;!&#41; after changing from @{$some_set} to $some_set-&gt;members&#40;&#41;.

So once again, the problem is not the fact that @{$set} is sorting, the problem is it is sorting everytime its items are accessed in foreach or similar.

Last but not least, let&#39;s see what actually comes out of @{$set} as opposed to $set-&gt;members:

$ cat peek.pl
#!/bin/env perl
use strict; use warnings; use 5.010;
use Set::Object 1.35 qw/set/;
use Devel::Peek;
my $set = set&#40;qw/a/&#41;;
say &#34;\$set-&gt;members form:&#34;;
say Dump&#40;$_&#41; foreach $set-&gt;members&#40;&#41;;
say &#34;\n\n\n\@{\$set} form:&#34;;
print Dump&#40;$_&#41; foreach @{$set};

__END__

$set-&gt;members form:
SV = PV&#40;0x228eb78&#41; at 0x2290b98
  REFCNT = 2
  FLAGS = &#40;POK,pPOK&#41;
  PV = 0x22a9830 &#34;a&#34;\0
  CUR = 1
  LEN = 8


@{$set} form:
SV = PVLV&#40;0x22ef0c0&#41; at 0x23f2910
  REFCNT = 2
  FLAGS = &#40;GMG,SMG,RMG&#41;
  IV = 0
  NV = 0
  PV = 0
  MAGIC = 0x22f5040
    MG_VIRTUAL = &#38;PL_vtbl_packelem
    MG_TYPE = PERL_MAGIC_tiedelem&#40;p&#41;
    MG_FLAGS = 0x02
      REFCOUNTED
    MG_OBJ = 0x243abf0
    SV = RV&#40;0x243ac00&#41; at 0x243abf0
      REFCNT = 2
      FLAGS = &#40;ROK&#41;
      RV = 0x22cdda8
      SV = PVAV&#40;0x2291f40&#41; at 0x22cdda8
        REFCNT = 1
        FLAGS = &#40;OBJECT&#41;
        STASH = 0x234f8c0       &#34;Set::Object::TieArray&#34;
        ARRAY = 0x22d3720
        FILL = 1
        MAX = 1
        ARYLEN = 0x0
        FLAGS = &#40;REAL&#41;
        Elt No. 0
        SV = RV&#40;0x22c8ac8&#41; at 0x22c8ab8
          REFCNT = 1
          FLAGS = &#40;&#41;
        Elt No. 1
        SV = RV&#40;0x22cde30&#41; at 0x22cde20
          REFCNT = 1
          FLAGS = &#40;ROK,WEAKREF&#41;
          RV = 0x2290fa0
          SV = PVMG&#40;0x22d5890&#41; at 0x2290fa0
            REFCNT = 1
            FLAGS = &#40;OBJECT,RMG,IOK,OVERLOAD,pIOK&#41;
            IV = 36500688
            NV = 0
            PV = 0
            MAGIC = 0x243b680
              MG_VIRTUAL = &#38;PL_vtbl_backref
              MG_TYPE = PERL_MAGIC_backref&#40;&lt;&#41;
              MG_FLAGS = 0x02
                REFCOUNTED
              MG_OBJ = 0x23f27d8
              SV = PVAV&#40;0x23f02f0&#41; at 0x23f27d8
                REFCNT = 2
                FLAGS = &#40;&#41;
                ARRAY = 0x22bb0e0
                FILL = 0
                MAX = 3
                ARYLEN = 0x0
                FLAGS = &#40;&#41;
            STASH = 0x22cdc58   &#34;Set::Object&#34;
  TYPE = t
  TARGOFF = 0
  TARGLEN = 0
  TARG = 0x23f2910

We&#39;re using PERL 5.10.1. Maybe the problem is not so severe on newer ones, I don&#39;t have a testing environment prepared to test that, alas.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> set_object_bug.tbz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1756955/945367/set_object_bug.tbz">Download set_object_bug.tbz</a><br />
<span class="downloadcontenttype">application/octet-stream 250.5k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1757389" href="/Public/Bug/Display.html?id=90070#txn-1757389">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;13&nbsp;07:21:03&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1757389/945615/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945615">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 309b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please note the number of calls it is causing.
</div>
One more clarification here, because in current form it may be misleading. When I spoke about number of calls I meant calls to sort, not the actual number of calls. Here&#39;s the profiled code attached for clarity &#40;it is also included in tbz containing nytprof&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> set_object_bug.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1757389/945616/set_object_bug.pl">Download set_object_bug.pl</a><br />
<span class="downloadcontenttype">text/x-perl 632b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/bin/env perl
use strict; use warnings; use 5.010;
use List::Util qw/shuffle/;
use Set::Object 1.35 qw/set/;
my @list = shuffle&#40;1..1000&#41;;

my $lil_set = set&#40;@list&#41;;
for &#40;1..100&#41; {
            my $x = 0;
            foreach my $item &#40;$lil_set-&gt;members&#40;&#41;&#41; {
                $x += $item;
                $x += $item;
                $x += $item;
                $x += $item;
                $x += $item;
            }

            foreach my $item &#40;@{$lil_set}&#41; {
                $x += $item;
                $x += $item;
                $x += $item;
                $x += $item;
                $x += $item;
            }
}
__END__
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1757392" href="/Public/Bug/Display.html?id=90070#txn-1757392">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;13&nbsp;07:24:21&nbsp;2017</span>
    <span class="description">reini.urban [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90070] convenience method @$ resorts -- extremely inefficient should be discouraged or warned about</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Nov 2017 13:24:04 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Set-Object [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Reini Urban &lt;reini.urban [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1757392/945620/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945620">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 527b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Can you please provide a doc patch?

Am 13.11.2017 13:21 schrieb &#34;Bartłomiej Fulanty via RT&#34; &lt;
bug-Set-Object@rt.cpan.org&gt;:

       Queue: Set-Object
 Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90070">https://rt.cpan.org/Ticket/Display.html?id=90070</a></span> &gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please note the number of calls it is causing.
</div>
One more clarification here, because in current form it may be misleading.
When I spoke about number of calls I meant calls to sort, not the actual
number of calls. Here&#39;s the profiled code attached for clarity &#40;it is also
included in tbz containing nytprof&#41;.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1757392/945621/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945621">with headers</a>
<br />
<span class="downloadcontenttype">text/html 985b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1757545" href="/Public/Bug/Display.html?id=90070#txn-1757545">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;14&nbsp;03:53:26&nbsp;2017</span>
    <span class="description">STARLIGHT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1757545/945721/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945721">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 807b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 13 07:24:21 2017, reini.urban@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you please provide a doc patch?
&gt; 
&gt; Am 13.11.2017 13:21 schrieb &#34;Bartłomiej Fulanty via RT&#34; &lt;
&gt; bug-Set-Object@rt.cpan.org&gt;:
&gt; 
&gt;        Queue: Set-Object
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90070">https://rt.cpan.org/Ticket/Display.html?id=90070</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; Please note the number of calls it is causing.
</div>&gt; 
&gt; One more clarification here, because in current form it may be misleading.
&gt; When I spoke about number of calls I meant calls to sort, not the actual
&gt; number of calls. Here&#39;s the profiled code attached for clarity &#40;it is also
&gt; included in tbz containing nytprof&#41;.
</div>
I&#39;ve forked the code on GitHub and will try to provide a pull request. I also looked through module code and want to test an idea for a simple behaviour patch, but nothing solid at the moment.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.518557</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
