<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33965 for Coro: local causes odd behavior</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33965 for Coro: local causes odd behavior</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Coro">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Coro">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Coro">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Coro">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Coro">Coro CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33965</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Coro">Coro</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpan [...] chmrr.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-8142-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.4    </td>
  </tr>
  <tr id="CF-8143-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




local-test.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/432903/211915/local-test.pl">
Mon Mar 10 14:06:45 2008 (748b) by cpan [...] chmrr.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=33965">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-432903" href="/Public/Bug/Display.html?id=33965#txn-432903">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;10&nbsp;14:06:45&nbsp;2008</span>
    <span class="description">cpan [...] chmrr.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> local causes odd behavior</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/432903/211912/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/211912">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 187b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Using &#39;local&#39; in coroutines causes unexpected behavior &#40;see attached&#41;. 
Even if it is not expected to work, a note in the documentation warning
about it would be useful.
  Thanks!
 - Alex
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> local-test.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/432903/211915/local-test.pl">Download local-test.pl</a><br />
<span class="downloadcontenttype">text/x-perl 748b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use Coro;
my %thing = &#40;&#41;;
use vars qw/$thing/;

print &#34;Main, value is @{[$thing || &#39;undef&#39;]} at start\n&#34;;

my $main = $Coro::current;
for my $n &#40;1..4&#41; {
    async {
        warn &#34;$n &#40;before&#41; value is @{[$thing || &#39;undef&#39;]}, expected undef\n&#34;;
        {
            local $thing = $n;
            for my $i &#40;1..3&#41; {
                print &#34;$n &#40;$i&#41; Value is @{[$thing || &#39;undef&#39;]}, expected $n\n&#34;;
                cede;
            }
        }
        warn &#34;$n &#40;after&#41; value is @{[$thing || &#39;undef&#39;]}, expected undef\n&#34;;
        $main-&gt;ready;
    }
}

print &#34;Main, value is @{[$thing || &#39;undef&#39;]} after creating asyncs\n&#34;;

schedule;

print &#34;Main, value is @{[$thing || &#39;undef&#39;]} at end, expected undef\n&#34;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-438284" href="/Public/Bug/Display.html?id=33965#txn-438284">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;19:29:33&nbsp;2008</span>
    <span class="description">MLEHMANN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/438284/214644/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/214644">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 274b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">local works exactly as documented by perl &#40;its a dynamic binding&#41;.

this has nothing to do with coro, as local behaves as expected with or
without coro being used.

please study the perl documentation, especially the part &#34;You really
probably want to be using &#34;my&#34; instead&#34;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-438285" href="/Public/Bug/Display.html?id=33965#txn-438285">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;19:29:35&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-438287" href="/Public/Bug/Display.html?id=33965#txn-438287">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;19:29:36&nbsp;2008</span>
    <span class="description">MLEHMANN [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-438310" href="/Public/Bug/Display.html?id=33965#txn-438310">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;21:00:15&nbsp;2008</span>
    <span class="description">alexmv [...] mit.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33965] local causes odd behavior</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 21 Mar 2008 20:59:13 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Coro [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alex Vandiver &lt;alexmv [...] MIT.EDU&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/438310/214660/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/214660">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1019b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 2008-03-21 at 19:29 -0400, Marc_Lehmann via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; local works exactly as documented by perl &#40;its a dynamic binding&#41;.
</div>
Did even run the test I attached?  It does *not* work exactly as
documented by perl, because perl only has one call stack at once.  Coro
allows multiple call stacks, and thus local&#39;s behavior is less well
defined; &#34;leaving a block&#34; could be construed to incude cede&#39;ing to
other coroutines, which would imply that local&#39;d values would be part of
per-coroutine state, in addition to the call stack.
  Regardless, Coro allows blocks to be exited in an order other than the
order in which they were entered, which can restore the wrong values
from the stack.  In the test I attached, the value of $thing at the end
of the program is 3 -- but, given a different ordering of coroutines
exiting the local&#39;d block, it could be anything between undef and 3.
This is extremely non-intuitive.
  Does this clarify the issue at all?
 - Alex

-- 
Networking -- only one letter away from not working
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-438311" href="/Public/Bug/Display.html?id=33965#txn-438311">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;21:00:17&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-439687" href="/Public/Bug/Display.html?id=33965#txn-439687">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;25&nbsp;14:18:17&nbsp;2008</span>
    <span class="description">schmorp [...] schmorp.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33965] local causes odd behavior</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 Mar 2008 19:16:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;alexmv [...] mit.edu via RT&#34; &lt;bug-Coro [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Lehmann &lt;schmorp [...] schmorp.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/439687/215382/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215382">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Mar 21, 2008 at 09:00:17PM -0400, &#34;alexmv@mit.edu via RT&#34; &lt;bug-Coro@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Did even run the test I attached?
</div>
No, I only read it carefully, is running it necessary to understand your
problem &#40;that would imply that your comments about it were wrong...&#41;?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It does *not* work exactly as
&gt; documented by perl, because perl only has one call stack at once.
</div>
The number and existance of a call stack is irrelevant, as local is
not defined in relation to any call stack, it simply creates a dynamic
binding.

The only stack involved is the one local uses, and there is only one, with
coro, or without, and the behaviour is the same.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Coro allows multiple call stacks, and thus local&#39;s behavior is less well
&gt; defined
</div>
local&#39;s behaviour is well-defined with or without Coro, and it works the
same. The fact that you don&#39;t understand what local does &#40;and likely
confuse it with my&#41; is of little relevance.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;leaving a block&#34; could be construed to incude cede&#39;ing to
&gt; other coroutines
</div>
No, leaving a block means leaving a block. If you &#34;incude&#34; anything that
is only in your mind, Coro neither does that, nor implies that, nor
documents that, nor aims for that: Leaving a block simply means leaving a
block, and nothing else.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; which would imply that local&#39;d values would be part of
&gt; per-coroutine state, in addition to the call stack.
</div>
If you start with obviously wrong statements you can derive anything out
of them, so thats true. If I were the emperor of china...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   Regardless, Coro allows blocks to be exited in an order other than the
&gt; order in which they were entered
</div>
Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; which can restore the wrong values from the stack
</div>
No. It will always restore the correct value. local introduces a _dynamic_
binding, not a lexical one, as you assume.

Please take a good book about perl, which will immediately teach you that
local will _not_ create local variables as you assume, and that you need
to use my for that.

Coro doesn&#39;t change that, you are just more surprised by your lack of
understanding.

Use &#34;my&#34;, that is creating local variables, and works as you expect. local
does something completely different, and what you apparently want cannot
be implemented with it, as it simply isn&#39;t creating any local variable or
scoped binding of any kind. You really want my, and this is completely
independent of Coro.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the test I attached, the value of $thing at the end
&gt; of the program is 3 -- but, given a different ordering of coroutines
&gt; exiting the local&#39;d block, it could be anything between undef and 3.
&gt; This is extremely non-intuitive.
</div>
local is extreemly unintuitive, because beginner programmers usually think
it has something to do with local variables, which it doesn&#39;t have.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   Does this clarify the issue at all?
</div>
Yes, of course, it was completely clear to me before, too: You confuse
local with the notion of local variables, a typical programmers error. You
go farther in confusing the implied stack local uses with any call stack
&#40;which is not the case, and never was, regardless of how many call stacks
are available&#41;.

This is fine &#40;being a typical beginners mistake&#41;, but please fetch yourself a
book that explains the semantics of local vs. my and use my until you
understand what local does. And please stop abusing the bugtracker, I am
certainly more open to discuss this privately and teach you about local when
I do not have to care for the bugtracker.

The bugtracker is not a place to ask programming questions.

-- 
                The choice of a       Deliantra, the free code+content MORPG
      -----==-     _GNU_              <span class="clickylink"><a target="new" rel="nofollow" href="http://www.deliantra.net">http://www.deliantra.net</a></span>
      ----==-- _       generation
      ---==---&#40;_&#41;__  __ ____  __      Marc Lehmann
      --==---/ / _ \/ // /\ \/ /      pcg@goof.com
      -=====/_/_//_/\_,_/ /_/\_\
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-439690" href="/Public/Bug/Display.html?id=33965#txn-439690">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;25&nbsp;14:20:27&nbsp;2008</span>
    <span class="description">MLEHMANN [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-439704" href="/Public/Bug/Display.html?id=33965#txn-439704">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;25&nbsp;16:03:13&nbsp;2008</span>
    <span class="description">alexmv [...] mit.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33965] local causes odd behavior</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 Mar 2008 16:01:42 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Coro [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alex Vandiver &lt;alexmv [...] MIT.EDU&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/439704/215391/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215391">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 573b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 2008-03-25 at 14:18 -0400, Marc Lehmann via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33965">http://rt.cpan.org/Ticket/Display.html?id=33965</a></span> &gt;
&gt; 
&gt; On Fri, Mar 21, 2008 at 09:00:17PM -0400, &#34;alexmv@mit.edu via RT&#34;
&gt; &lt;bug-Coro@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; Did even run the test I attached?
</div>&gt; 
&gt; No, I only read it carefully, is running it necessary to understand
&gt; your
&gt; problem &#40;that would imply that your comments about it were wrong...&#41;?
</div>
Yes.  Go run the code.  There are two errors in it; one is totally
PEBKAC, the other is not.
 - Alex

-- 
Networking -- only one letter away from not working
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-439705" href="/Public/Bug/Display.html?id=33965#txn-439705">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;25&nbsp;16:03:16&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;deleted&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-439859" href="/Public/Bug/Display.html?id=33965#txn-439859">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;26&nbsp;00:03:49&nbsp;2008</span>
    <span class="description">MLEHMANN [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440624" href="/Public/Bug/Display.html?id=33965#txn-440624">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;13:30:48&nbsp;2008</span>
    <span class="description">GLASSER [...] CPAN.ORG -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/440624/215910/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215910">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 284b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Alex&#39;s point seems reasonable.  It seems like Coro should document
explicitly that &#34;cede&#34; and friends need to be thought of just as normal
function calls, not as flow-control operators like &#34;break&#34; or &#34;return&#34;
or &#34;goto&#34;, even though Coro attempts to create a coroutine *abstraction*.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440625" href="/Public/Bug/Display.html?id=33965#txn-440625">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;13:30:49&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;deleted&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440630" href="/Public/Bug/Display.html?id=33965#txn-440630">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;14:06:20&nbsp;2008</span>
    <span class="description">MLEHMANN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/440630/215915/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215915">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 639b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 27 13:30:48 2008, glasser wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Alex&#39;s point seems reasonable. 
</div>
I do not know who yo are but alex needs to learn perl. Obviously, cede
is a function call, and obviously, local&#39;s behaviour is exactly as
documented. I asked kindly not to abuse rt.cpan.org for progrmaming
questions but since you continue to abuse it I will just delete ticket. 

Again, this is NOT a bug of any kind, and discussion of meta-questions
or understanding of what local vs. my does is not done here. This is a
*bug* tracking system that should help fixing *bugs*.

Stop abusing it, that only detracts working people like me from doing
useful workk.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440632" href="/Public/Bug/Display.html?id=33965#txn-440632">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;14:06:22&nbsp;2008</span>
    <span class="description">MLEHMANN [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.645014</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
