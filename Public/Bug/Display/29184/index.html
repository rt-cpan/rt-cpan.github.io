<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #29184 for Games-Tournament-Swiss: scores aren&#39;t recorded properly</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #29184 for Games-Tournament-Swiss: scores aren&#39;t recorded properly</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Games-Tournament-Swiss/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Games-Tournament-Swiss/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Games-Tournament-Swiss/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Games-Tournament-Swiss/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Games-Tournament-Swiss">Games-Tournament-Swiss CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">29184</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Games-Tournament-Swiss/Active/">Games-Tournament-Swiss</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bartolin [...] gmx.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42558-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42559-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




1.yaml<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/359909/162731/1.yaml">
Sun Sep 09 05:09:39 2007 (67b) by bartolin [...] gmx.de
</a>
</font></li>
</ul>


2.yaml<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/359909/162734/2.yaml">
Sun Sep 09 05:09:40 2007 (68b) by bartolin [...] gmx.de
</a>
</font></li>
</ul>


league.yaml<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/359909/162730/league.yaml">
Sun Sep 09 05:09:39 2007 (288b) by bartolin [...] gmx.de
</a>
</font></li>
</ul>


pairtable.yaml.2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/359909/162732/pairtable.yaml.2">
Sun Sep 09 05:09:39 2007 (273b) by bartolin [...] gmx.de
</a>
</font></li>
</ul>


pairtable.yaml.3<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/359909/162733/pairtable.yaml.3">
Sun Sep 09 05:09:40 2007 (361b) by bartolin [...] gmx.de
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/363063/164385/signature.asc">
Tue Sep 18 05:43:22 2007 (189b) by bartolin [...] gmx.de
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/362794/164217/signature.asc">
Mon Sep 17 15:33:03 2007 (189b) by bartolin [...] gmx.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;05&nbsp;06:57:12&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 Sep 2007 12:51:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Games-Tournament-Swiss [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

in the thread about C14 in FIDE.pm [1] I noted an error of script
&#34;pair&#34;, complaining about missing results for players.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No result in round 1 for player 1, player_1 as White at
&gt; /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pair line 126
&gt; No result in round 1 for player 2, player_2 as Black at
&gt; /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pair line 126
&gt; [...]
&gt; No result in round 1 for player 12, player_12 as White at
&gt; /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pair line 126
&gt; No result in round 2 for player 1, player_1 as Black at
&gt; /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pair line 126
&gt; No result in round 2 for player 2, player_2 as White at
&gt; /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pair line 126
&gt; [...]
&gt; No result in round 2 for player 11, player_11 as White at
&gt; /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pair line 126
&gt; No result in round 2 for player 12, player_12 as Black at
&gt; /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pair line 126
</div>
You explained this is related to pair relying on pairing tables
nowadays.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is a warning about the use of pairing tables. They don&#39;t
&gt; give the players&#39; individual results in each round. There is only
&gt; a total score.
</div>
Convincing as this explanation is, I suspect there is another problem
related to this one. [But maybe, it&#39;s not related.]

It seems as if the scores aren&#39;t recorded anymore in the yaml files in
round subdiretories -- at least they aren&#39;t recorded properly.

I guess that due to this, &#34;crosstable&#34; and &#34;pairingtable&#34; don&#39;t
generate correct tables if &#40;$round &gt; 1&#41;. If I insert

  print Dump&#40;$player-&gt;scores&#41;;

in crosstable, directely before the table is printed out, it gives
values like:

  1: ~
  2: Win

If I use on old version of yaml files &#40;generated with
Games::Tournament::Swiss Version 0.05&#41; those lines read:

  1: Win
  2: Win

This corresponds to &#40;or is caused by&#41; missing values for &#34;scores&#34; in
yaml files &#40;like player.yaml&#41;. A player.yaml file generated by version
0.07 &#40;pairingtable -&gt; pairtable2yaml -&gt; pair&#41; reads

  - !!perl/hash:Games::Tournament::Contestant::Swiss
  floater: Up
  floats:
    - ~
    - None
  id: 1
  name: &#39;player_1&#39;
  oldId: 1
  pairingNumber: 1
  preference: !!perl/hash:Games::Tournament::Contestant::Swiss::Preference
    difference: 1
    direction: White
    lastTwo:
      - White
  rating: 2200
  roles:
    - White
  scores:
    1: Draw
  title: ~

while the corresponding lines from a player.yaml file generated with
version 0.05 are:

  - !!perl/hash:Games::Tournament::Contestant::Swiss
  floater: Up
  floats:
    - ~
    - Not
  id: 1
  name: &#39;player_1&#39;
  oldId: 1
  pairingNumber: 1
  preference: !!perl/hash:Games::Tournament::Contestant::Swiss::Preference
    difference: 1
    direction: White
    lastTwo:
      - White
  rating: 2200
  roles:
    - White
  score: 0.5
  scores:
    1: ~
  title: ~

As a result, the method &#34;score&#34; from Contestant.pm seems to be unable
to compute the total scores after two or more rounds, and therefor the
crosstables and pairingtables aren&#39;t correct.

I hope my description of the problem was understandable.

Best regards,

Christian

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=29073">http://rt.cpan.org/Public/Bug/Display.html?id=29073</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;08&nbsp;08:54:48&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 8 Sep 2007 14:54:22 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Games-Tournament-Swiss via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems as if the scores aren&#39;t recorded anymore in the yaml files in
&gt; round subdiretories -- at least they aren&#39;t recorded properly.
&gt; 
&gt; I guess that due to this, &#34;crosstable&#34; and &#34;pairingtable&#34; don&#39;t
&gt; generate correct tables if &#40;$round &gt; 1&#41;.
</div>
I found a &#40;really dirty&#41; workaround for my problem. To fix
pairingtable &#40;which is more important for me&#41; I inserted the following
lines after line 87:

  $player-&gt;{score} += $score{$role};
  for my $xxx &#40;@$players&#41; {
      if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
          $xxx-&gt;{score} = $player-&gt;{score};
      }
   }

and the following lines after line 131 &#40;counted without the above
addition&#41;:

  for my $xxx &#40;@$players&#41; {
      if &#40;$member-&gt;{id} eq $xxx-&gt;{id}&#41; {
          $member-&gt;{score} = $xxx-&gt;{score};
      }
  }

Unfortunately, I&#39;m still not fully understanding how to solve this
problem in a clean way. Therefore I saved the correct score for each
player to $players and copied it back to $members shortly before
printing it out to the pairingtable.

Best regards

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;08&nbsp;08:59:06&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 8 Sep 2007 14:59:00 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Games-Tournament-Swiss via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oops,

* On 2007-09-08 Christian Bartolomaeus &#40;bartolin@gmx.de&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
&gt; I found a &#40;really dirty&#41; workaround for my problem.
</div>
just after sending my mail I saw that my workaround didn&#39;t work
correctly &#40;at least not in all test cases&#41;. The problem seems to be
that the brackets are computed incorrectly. Within the pairingtable
the results are correct but the brackets are not.

Sorry for the noise.

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;08&nbsp;14:23:01&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 8 Sep 2007 20:23:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Games-Tournament-Swiss via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

* On 2007-09-08 Christian Bartolomaeus &#40;bartolin@gmx.de&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
<div class="message-stanza open">&gt; &gt; [...]
&gt; &gt; I found a &#40;really dirty&#41; workaround for my problem.
</div>&gt; 
&gt; just after sending my mail I saw that my workaround didn&#39;t work
&gt; correctly &#40;at least not in all test cases&#41;. The problem seems to be
&gt; that the brackets are computed incorrectly. Within the pairingtable
&gt; the results are correct but the brackets are not.
</div>
inserting the following code after line 87 &#40;pairingtable&#41; and line 90
&#40;crosstable&#41; seems to work better:

  $player-&gt;{score} += $score{$role};
  for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
      if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
          $xxx-&gt;{score} = $player-&gt;{score};
      }
  }

Though it&#39;s definitely a dirty hack, still.

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;04:18:07&nbsp;2007</span>
    <span class="description">drbean [...] freeshell.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Sep 2007 08:17:24 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Bartolomaeus via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Greg Matheson &lt;drbean [...] freeshell.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 05 Sep 2007, Christian Bartolomaeus via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ... &#34;crosstable&#34; and &#34;pairingtable&#34; don&#39;t
&gt; generate correct tables if &#40;$round &gt; 1&#41;.
</div>
If it is only given a pairing table for one particular round,
&#39;crosstable&#39; won&#39;t be able to find scores for individual rounds
&#40;and it needs to have them if it is to make a useful table,
doesn&#39;t it?&#41; 

I don&#39;t think anything can be done about that except
tell the user they need to have the results for individual
rounds and die.

&#39;pairingtable&#39; should be able to do the right thing, if it has
both the pairing table and the results for the previous round.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This corresponds to &#40;or is caused by&#41; missing values for &#34;scores&#34; in
&gt; yaml files &#40;like player.yaml&#41;. A player.yaml file generated by version
&gt; 0.07 &#40;pairingtable -&gt; pairtable2yaml -&gt; pair&#41; reads
</div>
...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   scores:
&gt;     1: Draw
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; while the corresponding lines from a player.yaml file generated with
&gt; version 0.05 are:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   scores:
&gt;     1: ~
</div>
Isn&#39;t it the other way round? The missing score is with version
0.07?

Does this depend on whether you&#39;re using &#39;pair&#39; or &#39;pairstately&#39;
to generate the YAML files?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As a result, the method &#34;score&#34; from Contestant.pm seems to be unable
&gt; to compute the total scores after two or more rounds, and therefor the
&gt; crosstables and pairingtables aren&#39;t correct.
</div>
Perhaps it is a bug in the &#34;score&#34; code.

I don&#39;t have a good grasp of the problem. Can you tell me what
tournament, what round, and how you generated the files? Then I
can try to run pairingtable and crosstable here.

On Sat, 08 Sep 2007, Christian Bartolomaeus via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; inserting the following code after line 87 &#40;pairingtable&#41; and line 90
&gt; &#40;crosstable&#41; seems to work better:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   $player-&gt;{score} += $score{$role};
&gt;   for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
&gt;       if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
&gt;           $xxx-&gt;{score} = $player-&gt;{score};
&gt;       }
&gt;   }
</div>
Doesn&#39;t this replace the old score with the score in the latest
individual round?

It would be good to try and generate a YAML file of cumulative
scores from the pairing table and the results for the round.

I still prefer to regenerate scores from individual round
results, but relying on a pairing table instead of individual
results makes that difficult :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;04:18:28&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;05:09:34&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Sep 2007 11:07:50 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Greg Matheson via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* On 2007-09-09 Greg Matheson via RT &#40;bug-Games-Tournament-Swiss@rt.cpan.org&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
<div class="message-stanza open">&gt; &gt; ... &#34;crosstable&#34; and &#34;pairingtable&#34; don&#39;t
&gt; &gt; generate correct tables if &#40;$round &gt; 1&#41;.
</div>&gt; 
&gt; If it is only given a pairing table for one particular round,
&gt; &#39;crosstable&#39; won&#39;t be able to find scores for individual rounds
&gt; &#40;and it needs to have them if it is to make a useful table,
&gt; doesn&#39;t it?&#41; 
&gt; 
&gt; I don&#39;t think anything can be done about that except
&gt; tell the user they need to have the results for individual
&gt; rounds and die.
</div>
Yes, the results are in the scores/ directory. But somehow crosstable
doesn&#39;t seem to use the results presented there, instead it takes the
results from $tourney -- at least for its output.

64     $tourney = LoadFile &#34;./$round/tourney.yaml&#34;;
[...]
124 my @rankedplayers = $tourney-&gt;rank&#40;@$allRoundPlayers&#41;;
[...]
134 for my $player &#40; @rankedplayers &#41;
[...]
141         my @results = &#40;$player-&gt;id, $player-&gt;name, $player-&gt;rating, $player-&gt;score&#41; or die &#34;$player-&gt;{id}&#39;s results?&#34;;
[...]
145 $place, $player-&gt;id, $player-&gt;name, $player-&gt;rating, $player-&gt;score, @$results

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#39;pairingtable&#39; should be able to do the right thing, if it has
&gt; both the pairing table and the results for the previous round.
</div>
It seems to me, it&#39;s the same problem here: pairingtable takes the
results from $tourney -- which doesn&#39;t have the correct entries.
&#40;tourney.yaml has the same problem as player.yaml -- see my old
description below&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; This corresponds to &#40;or is caused by&#41; missing values for &#34;scores&#34; in
&gt; &gt; yaml files &#40;like player.yaml&#41;. A player.yaml file generated by version
&gt; &gt; 0.07 &#40;pairingtable -&gt; pairtable2yaml -&gt; pair&#41; reads
</div>&gt; 
&gt; ...
<div class="message-stanza open">&gt; &gt;   scores:
&gt; &gt;     1: Draw
</div>&gt; 
<div class="message-stanza open">&gt; &gt; while the corresponding lines from a player.yaml file generated with
&gt; &gt; version 0.05 are:
</div>&gt; 
<div class="message-stanza open">&gt; &gt;   scores:
&gt; &gt;     1: ~
</div>&gt; 
&gt; Isn&#39;t it the other way round? The missing score is with version
&gt; 0.07?
</div>
Oops, you&#39;re right. It&#39;s the other way around.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Does this depend on whether you&#39;re using &#39;pair&#39; or &#39;pairstately&#39;
&gt; to generate the YAML files?
</div>
I use &#39;pair&#39; to get that results. Somehow &#39;pairstately&#39; fails to work:

$&gt; perl pairstately
Use of uninitialized value in concatenation &#40;.&#41; or string at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.  
PLAYER_1, 3 playing White got  in round 1 at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.
Use of uninitialized value in pattern match &#40;m//&#41; at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 120.
Use of uninitialized value in pattern match &#40;m//&#41; at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 120.
Use of uninitialized value in pattern match &#40;m//&#41; at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 120.
Use of uninitialized value in pattern match &#40;m//&#41; at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 120.
Use of uninitialized value in concatenation &#40;.&#41; or string at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 127.
Error: PLAYER_1 3&#39;s result in round 1 is ? at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 127.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; As a result, the method &#34;score&#34; from Contestant.pm seems to be unable
&gt; &gt; to compute the total scores after two or more rounds, and therefor the
&gt; &gt; crosstables and pairingtables aren&#39;t correct.
</div>&gt; 
&gt; Perhaps it is a bug in the &#34;score&#34; code.
&gt; 
&gt; I don&#39;t have a good grasp of the problem. Can you tell me what
&gt; tournament, what round, and how you generated the files? Then I
&gt; can try to run pairingtable and crosstable here.
</div>
It&#39;s again a notional tournament with only for participants. The error
occurs for round 3. I&#39;ll attach league.yaml, scores/1.yaml,
scores/2.yaml and pairtable.yaml for round 2 and round 3. I generated
the files automatically via my web frontend, but I&#39;m pretty sure, that
doesn&#39;t matter. &#39;pairtable.yaml&#39; was created as described in README.

You can see that pairtable.yaml.3 doesn&#39;t have the scores right &#40;at
the bottom&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat, 08 Sep 2007, Christian Bartolomaeus via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; inserting the following code after line 87 &#40;pairingtable&#41; and line 90
&gt; &gt; &#40;crosstable&#41; seems to work better:
</div>&gt; 
<div class="message-stanza open">&gt; &gt;   $player-&gt;{score} += $score{$role};
&gt; &gt;   for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
&gt; &gt;       if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
&gt; &gt;           $xxx-&gt;{score} = $player-&gt;{score};
&gt; &gt;       }
&gt; &gt;   }
</div>&gt; 
&gt; Doesn&#39;t this replace the old score with the score in the latest
&gt; individual round?
</div>
I think, it doesn&#39;t, since this is run within a 

  for my $round &#40; @rounds &#41; {}

construct. And the first line adds the score for the actual round to
the old score -- so the scores are summed up while going through all
rounds.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It would be good to try and generate a YAML file of cumulative
&gt; scores from the pairing table and the results for the round.
&gt; 
&gt; I still prefer to regenerate scores from individual round
&gt; results, but relying on a pairing table instead of individual
&gt; results makes that difficult :-&#41;
</div>
May I ask what made you change the behaviour of &#39;pair&#39; &#40;to rely on
pairing table instead of serialization files&#41; in the first place?

Best regards

Christian
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;07:14:09&nbsp;2007</span>
    <span class="description">drbean [...] freeshell.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Sep 2007 11:11:21 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Bartolomaeus via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Greg Matheson &lt;drbean [...] freeshell.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 09 Sep 2007, Christian Bartolomaeus via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; .. crosstable doesn&#39;t seem to use the results presented there,
&gt; instead it takes the results from $tourney -- at least for its
&gt; output.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 64     $tourney = LoadFile &#34;./$round/tourney.yaml&#34;;
</div>
LIne 76 loads the $round.yaml file, and line 86 gets the result
for the player.

After the collectCards method is called, the data is set up in
$table by the $tourney object.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 124 my @rankedplayers = $tourney-&gt;rank&#40;@$allRoundPlayers&#41;;
&gt; [...]
&gt; 134 for my $player &#40; @rankedplayers &#41;
&gt; [...]
&gt; 141         my @results = &#40;$player-&gt;id, $player-&gt;name, $player-&gt;rating, $player-&gt;score&#41; or die &#34;$player-&gt;{id}&#39;s results?&#34;;
&gt; [...]
&gt; 145 $place, $player-&gt;id, $player-&gt;name, $player-&gt;rating, $player-&gt;score, @$results
</div>
This code is about printing $table.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Does this depend on whether you&#39;re using &#39;pair&#39; or &#39;pairstately&#39;
&gt; &gt; to generate the YAML files?
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I use &#39;pair&#39; to get that results. Somehow &#39;pairstately&#39; fails to work:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $&gt; perl pairstately
&gt; Use of uninitialized value in concatenation &#40;.&#41; or string at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.  
&gt; PLAYER_1, 3 playing White got  in round 1 at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.
</div>
It&#39;s failing to find the result for PLAYER_1 in scores/1.yaml.
Strange that there should be a difference between the 2.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s again a notional tournament with only for participants. The error
&gt; occurs for round 3. I&#39;ll attach league.yaml, scores/1.yaml,
&gt; scores/2.yaml and pairtable.yaml for round 2 and round 3. I generated
&gt; the files automatically via my web frontend, but I&#39;m pretty sure, that
&gt; doesn&#39;t matter. &#39;pairtable.yaml&#39; was created as described in README.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You can see that pairtable.yaml.3 doesn&#39;t have the scores right &#40;at
&gt; the bottom&#41;.
</div>
Strange that it works for me. First I ran &#39;pair&#39; in 1/, then
&#39;pairstately&#39; in 2/ with your league.yaml and scores/1.yaml and
scores/2.yaml. Then I ran crosstable and pairingtable in the top
directory, and copied the output of pairingtable to
pairtable.txt. Then I ran &#39;pairtable2yaml pairtable.txt&#39;

In pairtable.yaml at the bottom:

score:
  1: 1
  2: 0.5
  3: 0
  4: 0.5

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; May I ask what made you change the behaviour of &#39;pair&#39; &#40;to rely on
&gt; pairing table instead of serialization files&#41; in the first place?
</div>
The pairing table is lightweight. It has meaning to the users.
With the score files, that need to be written anyway, it
provides all the information that the serialization files
provide.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;09:00:29&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Sep 2007 15:00:25 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Greg Matheson via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

* On 2007-09-09 Greg Matheson via RT &#40;bug-Games-Tournament-Swiss@rt.cpan.org&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
<div class="message-stanza open">&gt; &gt; .. crosstable doesn&#39;t seem to use the results presented there,
&gt; &gt; instead it takes the results from $tourney -- at least for its
&gt; &gt; output.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; 64     $tourney = LoadFile &#34;./$round/tourney.yaml&#34;;
</div>&gt; 
&gt; LIne 76 loads the $round.yaml file, and line 86 gets the result
&gt; for the player.
</div>
sorry, I guess we spoke about different versions of crosstable. I was
referring to your original script from v0.07. I guess you are
referring to the version with my patch applied.

In the following I will refer to the original version:

Therefore, ...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; LIne 76 loads the $round.yaml file
</div>
this is line 68 in the original version, and

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and line 86 gets the result for the player.
</div>
this is line 78 in the original version.

Right now, we have the results in $results-&gt;{ $player_name }

But it&#39;s only the result of the actual round &#40;since all this happens
within a &#34;for my $round &#40; @rounds &#41; {}&#34;-construct &#40;line 61&#41;.

And somehow I think the values of $results-&gt;{ $player_name } aren&#39;t
transfered to the $tourney object.

Therefore I inserted the code

  $player-&gt;{score} += $score{$role};
  for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
    if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
      $xxx-&gt;{score} = $player-&gt;{score};
    }
  }

to update the $tourney object

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; After the collectCards method is called, the data is set up in
&gt; $table by the $tourney object.
</div>
I tried to insert test lines like

for my $yyy &#40; @{$tourney-&gt;entrants} &#41; {
  if &#40;$yyy-&gt;score&#41; { print &#34;$yyy-&gt;{name}: $yyy-&gt;{score}\n&#34;; }
}

at different points at the code of crosstable. It never returned the
total score for the players, only the score from round 1 &#40;or nothing&#41;.

What is your output when you insert the test lines in crosstable after
line 120 and run the script at different times?

* after pairing the first round and giving results in scores/1.yaml I
  get:

====
                Round 1 Crosstable
-------------------------------------------------------------------------
Rank No  Name       Rating Total 1
1   1   PLAYER_1     2200  1    3:W
2   2   PLAYER_2     2172  0.5  4:D
3   4   PLAYER_4     2060  0.5  2:D
4   3   PLAYER_3     2108  0    1:L
====

* after pairing the second round as well and giving results in scores/2.yaml 
  I get:

====
PLAYER_1: 1
PLAYER_2: 0.5
PLAYER_4: 0.5

                Round 2 Crosstable
-------------------------------------------------------------------------
Rank No  Name       Rating Total 1     2
1   1   PLAYER_1     2200  1    3:W   2:D
2   2   PLAYER_2     2172  0.5  4:D   1:D
3   4   PLAYER_4     2060  0.5  2:D   3:D
4   3   PLAYER_3     2108  0    1:L   4:D
====

But that just seems wrong. The output should have been

====
PLAYER_1: 1.5
PLAYER_2: 1
PLAYER_3: 0.5
PLAYER_4: 1

                Round 2 Crosstable
-------------------------------------------------------------------------
Rank No  Name       Rating Total 1     2
1   1   PLAYER_1     2200  1.5  3:W   2:D
2   2   PLAYER_2     2172  1    4:D   1:D
3   4   PLAYER_4     2060  1    2:D   3:D
4   3   PLAYER_3     2108  0.5  1:L   4:D
====

... as it is after my suggested change &#40;adding the following lines
after line 90&#41;:

  $player-&gt;{score} += $score{$role};
  for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
    if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
      $xxx-&gt;{score} = $player-&gt;{score};
    }
  }

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 124 my @rankedplayers = $tourney-&gt;rank&#40;@$allRoundPlayers&#41;;
&gt; &gt; [...]
&gt; &gt; 134 for my $player &#40; @rankedplayers &#41;
&gt; &gt; [...]
&gt; &gt; 141         my @results = &#40;$player-&gt;id, $player-&gt;name, $player-&gt;rating, $player-&gt;score&#41; or die &#34;$player-&gt;{id}&#39;s results?&#34;;
&gt; &gt; [...]
&gt; &gt; 145 $place, $player-&gt;id, $player-&gt;name, $player-&gt;rating, $player-&gt;score, @$results
</div>&gt; 
&gt; This code is about printing $table.
</div>
Yes, I just wanted to highlight, that the $tourney object somehow
never was updated with the actual results.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Does this depend on whether you&#39;re using &#39;pair&#39; or &#39;pairstately&#39;
&gt; &gt; &gt; to generate the YAML files?
</div></div>&gt; 
<div class="message-stanza open">&gt; &gt; I use &#39;pair&#39; to get that results. Somehow &#39;pairstately&#39; fails to work:
</div>&gt; 
<div class="message-stanza open">&gt; &gt; $&gt; perl pairstately
&gt; &gt; Use of uninitialized value in concatenation &#40;.&#41; or string at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.  
&gt; &gt; PLAYER_1, 3 playing White got  in round 1 at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.
</div>&gt; 
&gt; It&#39;s failing to find the result for PLAYER_1 in scores/1.yaml.
&gt; Strange that there should be a difference between the 2.
</div>
I didn&#39;t compare &#39;pair&#39; and &#39;pairstately&#39;, but a simple diff gives a
lot of differences. Didn&#39;t you modify &#39;pair&#39; quite a lot to rely on
pairing tables?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; It&#39;s again a notional tournament with only for participants. The error
&gt; &gt; occurs for round 3. I&#39;ll attach league.yaml, scores/1.yaml,
&gt; &gt; scores/2.yaml and pairtable.yaml for round 2 and round 3. I generated
&gt; &gt; the files automatically via my web frontend, but I&#39;m pretty sure, that
&gt; &gt; doesn&#39;t matter. &#39;pairtable.yaml&#39; was created as described in README.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; You can see that pairtable.yaml.3 doesn&#39;t have the scores right &#40;at
&gt; &gt; the bottom&#41;.
</div>&gt; 
&gt; Strange that it works for me. First I ran &#39;pair&#39; in 1/, then
&gt; &#39;pairstately&#39; in 2/ with your league.yaml and scores/1.yaml and
&gt; scores/2.yaml. Then I ran crosstable and pairingtable in the top
&gt; directory, and copied the output of pairingtable to
&gt; pairtable.txt. Then I ran &#39;pairtable2yaml pairtable.txt&#39;
</div>
Just to clarify: I did the following to get the results described
above:

1. create league.yaml &#40;in main directory ./&#41;

2. run &#39;pair&#39; &#40;in directory ./1/&#41;

3. create 1.yaml &#40;in directory ./scores&#41;

4. run &#39;crosstable &#40;in directory ./&#41;
   output:
                   Round 1 Crosstable
   -----------------------------------------------------------------
   Rank No  Name       Rating Total 1
   1   1   PLAYER_1     2200  1    3:W
   2   2   PLAYER_2     2172  0.5  4:D
   3   4   PLAYER_4     2060  0.5  2:D
   4   3   PLAYER_3     2108  0    1:L

5. run &#39;pairingtable &#40;in directory ./&#41;
   output:
                   Round 2 Pairing Groups
   -----------------------------------------------------------------
   Place  No  Opponents     Roles     Float Score
   1
          1   3              B             1
   2-3
          2   4              W             0.5
          4   2              B             0.5
   4
          3   1              W             0

6. inserted the output from 5. to &#39;pairingtable.txt&#39; &#40;in directory ./&#41;

7. run &#39;pairtable2yaml&#39; &#40;in directory ./&#41;

8. create directory ./2 and copy &#39;pairtable.yaml&#39; to that directory

9. run &#39;pair&#39; &#40;in directory ./2&#41;

10. create 2.yaml &#40;in directory ./scores&#41;

11. run &#39;crosstable &#40;in directory ./&#41;
    output:
                    Round 1 Crosstable
    -----------------------------------------------------------------
    Rank No  Name       Rating Total 1     2
    1   1   PLAYER_1     2200  1    3:W   2:D
    2   2   PLAYER_2     2172  0.5  4:D   1:D
    3   4   PLAYER_4     2060  0.5  2:D   3:D
    4   3   PLAYER_3     2108  0    1:L   4:D

    which is wrong, since the total scores are the ones from round 1.
  
12. run &#39;pairingtable &#40;in directory ./&#41;
    output:
                    Round 3 Pairing Groups
    -------------------------------------------------------------------------
    Place  No  Opponents     Roles     Float Score
    1
           1   3,2            BB        D   1
    2-3
           2   4,1            WW        U   0.5
           4   2,3            BB        D   0.5
    4
           3   1,4            WW        U   0

    which is wrong again.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In pairtable.yaml at the bottom:
&gt; 
&gt; score:
&gt;   1: 1
&gt;   2: 0.5
&gt;   3: 0
&gt;   4: 0.5
</div>
But after two rounds the output should have been:

score:
  1: 1.5
  2: 1
  3: 0.5
  4: 1

Or am I totally of the track?

Best regards

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;11:27:02&nbsp;2007</span>
    <span class="description">drbean [...] freeshell.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Sep 2007 15:26:36 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Games-Tournament-Swiss [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Greg Matheson &lt;drbean [...] freeshell.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 09 Sep 2007, Christian Bartolomaeus via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; sorry, I guess we spoke about different versions of crosstable. I was
&gt; referring to your original script from v0.07. I guess you are
&gt; referring to the version with my patch applied.
</div>
I had a different version of pairstately. The version in 0.07 is
broken. Line 116 in pairstately:

my $result = $results-&gt;{$n}-&gt;{ $player-&gt;name };

should be

my $result = $results-&gt;{ $player-&gt;name };

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   $player-&gt;{score} += $score{$role};
&gt;   for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
&gt;     if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
&gt;       $xxx-&gt;{score} = $player-&gt;{score};
&gt;     }
&gt;   }
</div>
I think only the first line of that is necessary. Strange that
that should work if $result is undefined.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tried to insert test lines like
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; for my $yyy &#40; @{$tourney-&gt;entrants} &#41; {
&gt;   if &#40;$yyy-&gt;score&#41; { print &#34;$yyy-&gt;{name}: $yyy-&gt;{score}\n&#34;; }
&gt; }
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; at different points at the code of crosstable. It never returned the
&gt; total score for the players, only the score from round 1 &#40;or nothing&#41;.
</div>
It was never finding the scores in 1.yaml.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;                 Round 2 Crosstable
&gt; -------------------------------------------------------------------------
&gt; Rank No  Name       Rating Total 1     2
&gt; 1   1   PLAYER_1     2200  1.5  3:W   2:D
&gt; 2   2   PLAYER_2     2172  1    4:D   1:D
&gt; 3   4   PLAYER_4     2060  1    2:D   3:D
&gt; 4   3   PLAYER_3     2108  0.5  1:L   4:D
&gt; ====
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ... as it is after my suggested change &#40;adding the following lines
&gt; after line 90&#41;:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   $player-&gt;{score} += $score{$role};
&gt;   for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
&gt;     if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
&gt;       $xxx-&gt;{score} = $player-&gt;{score};
&gt;     }
&gt;   }
</div>
I can&#39;t see how that would work.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; Does this depend on whether you&#39;re using &#39;pair&#39; or &#39;pairstately&#39;
&gt; &gt; &gt; &gt; to generate the YAML files?
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; &gt; I use &#39;pair&#39; to get that results. Somehow &#39;pairstately&#39; fails to work:
</div>
&#39;pair&#39; doesn&#39;t read any data from scores/$round.yaml files. It just
depends on the pairing table.

I don&#39;t think you can use pair the same way as pairstately unless
you hack it in some way like you did. I would prefer to keep the
score files out of pair at the moment.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; &gt; $&gt; perl pairstately
&gt; &gt; &gt; Use of uninitialized value in concatenation &#40;.&#41; or string at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.  
&gt; &gt; &gt; PLAYER_1, 3 playing White got  in round 1 at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.
</div>
I think if you make the change above to pairstately, it should
work as before.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;13:53:29&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Sep 2007 19:53:29 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Greg Matheson via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* On 2007-09-09 Greg Matheson via RT &#40;bug-Games-Tournament-Swiss@rt.cpan.org&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
&gt; I had a different version of pairstately. The version in 0.07 is
&gt; broken. Line 116 in pairstately:
&gt; 
&gt; my $result = $results-&gt;{$n}-&gt;{ $player-&gt;name };
&gt; 
&gt; should be
&gt; 
&gt; my $result = $results-&gt;{ $player-&gt;name };
</div>
I will have a look at pairstately later. Thanks for the information.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;   $player-&gt;{score} += $score{$role};
&gt; &gt;   for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
&gt; &gt;     if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
&gt; &gt;       $xxx-&gt;{score} = $player-&gt;{score};
&gt; &gt;     }
&gt; &gt;   }
</div>&gt; 
&gt; I think only the first line of that is necessary.
</div>
Hmm. If I delete the other lines it doesn&#39;t work correctly. The total
score printed out doesn&#39;t fit with the sum of the scores from the
single rounds.

Output for round 1:
                Round 1 Crosstable
-------------------------------------------------------------------------
Rank No  Name       Rating Total 1
1   1   PLAYER_1     2200  1    3:W
2   2   PLAYER_2     2172  0.5  4:D
3   4   PLAYER_4     2060  0.5  2:D
4   3   PLAYER_3     2108  0    1:L

Output for round 2:
                Round 2 Crosstable
-------------------------------------------------------------------------
Rank No  Name       Rating Total 1     2
1   1   PLAYER_1     2200  1    3:W   2:D
2   2   PLAYER_1     2172  0.5  4:D   1:D
3   4   PLAYER_1     2060  0.5  2:D   3:D
4   3   PLAYER_1     2108  0    1:L   4:D

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Strange that that should work if $result is undefined.
</div>
I don&#39;t understand. Why should $result be undefined? We are talking
about &#39;crosstable&#39; here, aren&#39;t we?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I tried to insert test lines like
</div>&gt; 
<div class="message-stanza open">&gt; &gt; for my $yyy &#40; @{$tourney-&gt;entrants} &#41; {
&gt; &gt;   if &#40;$yyy-&gt;score&#41; { print &#34;$yyy-&gt;{name}: $yyy-&gt;{score}\n&#34;; }
&gt; &gt; }
</div>&gt; 
<div class="message-stanza open">&gt; &gt; at different points at the code of crosstable. It never returned the
&gt; &gt; total score for the players, only the score from round 1 &#40;or nothing&#41;.
</div>&gt; 
&gt; It was never finding the scores in 1.yaml.
</div>
Sorry, maybe I didn&#39;t wrote what wanted to express.

I referred to the output of &#39;crosstable&#39;. I just inserted the above
lines to the code of crosstable so that the name and the score of
players are printed to the standard output.

There was nothing written to a file.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;                 Round 2 Crosstable
&gt; &gt; -------------------------------------------------------------------------
&gt; &gt; Rank No  Name       Rating Total 1     2
&gt; &gt; 1   1   PLAYER_1     2200  1.5  3:W   2:D
&gt; &gt; 2   2   PLAYER_2     2172  1    4:D   1:D
&gt; &gt; 3   4   PLAYER_4     2060  1    2:D   3:D
&gt; &gt; 4   3   PLAYER_3     2108  0.5  1:L   4:D
&gt; &gt; ====
</div>&gt; 
<div class="message-stanza open">&gt; &gt; ... as it is after my suggested change &#40;adding the following lines
&gt; &gt; after line 90&#41;:
</div>&gt; 
<div class="message-stanza open">&gt; &gt;   $player-&gt;{score} += $score{$role};
&gt; &gt;   for my $xxx &#40;@{$tourney-&gt;entrants}&#41; {
&gt; &gt;     if &#40;$xxx-&gt;{id} eq $player-&gt;{id}&#41; {
&gt; &gt;       $xxx-&gt;{score} = $player-&gt;{score};
&gt; &gt;     }
&gt; &gt;   }
</div>&gt; 
&gt; I can&#39;t see how that would work.
</div>
Well, for some reason it does work for me.

You say, crosstable works for you, following the steps from my last
post? Then I have to search for a problem with my scripts and files.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Does this depend on whether you&#39;re using &#39;pair&#39; or &#39;pairstately&#39;
&gt; &gt; &gt; &gt; &gt; to generate the YAML files?
</div></div>&gt; 
<div class="message-stanza open">&gt; &gt; &gt; &gt; I use &#39;pair&#39; to get that results. Somehow &#39;pairstately&#39; fails to work:
</div>&gt; 
&gt; &#39;pair&#39; doesn&#39;t read any data from scores/$round.yaml files. It just
&gt; depends on the pairing table.
&gt; 
&gt; I don&#39;t think you can use pair the same way as pairstately unless
&gt; you hack it in some way like you did. I would prefer to keep the
&gt; score files out of pair at the moment.
</div>
Well, but &#39;pair&#39; writes all those files &#40;like tourney.yaml&#41; on which
&#39;crosstable&#39; and &#39;pairingtable&#39; depend.

And I have the impression that &#39;pair&#39; doesn&#39;t write those files
correctly -- at least crosstable isn&#39;t able to compute the total
scores correctly.

Actually, I didn&#39;t hack &#39;pair&#39; at all. I just hacked &#39;crosstable&#39;
and &#39;pairingtable&#39; ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; $&gt; perl pairstately
&gt; &gt; &gt; &gt; Use of uninitialized value in concatenation &#40;.&#41; or string at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.  
&gt; &gt; &gt; &gt; PLAYER_1, 3 playing White got  in round 1 at /opt/perl_modules/Games-Tournament-Swiss-0.07/script_files/pairstately line 117.
</div>&gt; 
&gt; I think if you make the change above to pairstately, it should
&gt; work as before.
</div>
Okay, I will try this.

I&#39;m sorry for the confusion I caused with my bug report. Maybe I
didn&#39;t express my problem properly.

Thanks

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;09&nbsp;14:16:49&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Sep 2007 20:17:00 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Greg Matheson via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* On 2007-09-09 Christian Bartolomaeus &#40;bartolin@gmx.de&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
<div class="message-stanza open">&gt; &gt; I had a different version of pairstately. The version in 0.07 is
&gt; &gt; broken. Line 116 in pairstately:
&gt; &gt; 
&gt; &gt; my $result = $results-&gt;{$n}-&gt;{ $player-&gt;name };
&gt; &gt; 
&gt; &gt; should be
&gt; &gt; 
&gt; &gt; my $result = $results-&gt;{ $player-&gt;name };
</div>&gt; 
&gt; I will have a look at pairstately later. Thanks for the information.
</div>
I can confirm that everything works fine with the fixed &#39;pairstately&#39;.

So my problem obviously was: Pairstately failed to work without the
fix. Therefore I used pair. Somehow the YAML files in the $round/
subdirectory generated by pair aren&#39;t suited for providing
&#39;crosstable&#39; and &#39;pairingtable&#39; the correct informations about the
total scores.

[I think it&#39;s all about the lines like

    scores:
      1: Win
      2: Draw

in the YAML files generated by &#39;pairstately&#39;. As I noted in my
original post, the entries generated by &#39;pair&#39; looked like

    scores:
      1: ~
      2: ~

But there was an additional line in the files generated by &#39;pair&#39;:

    score: 1.5

This line obviously contained the total score for a player, but
&#39;crosstable&#39; and &#39;pairingtable&#39; weren&#39;t able to use that value.]

In the end, I hacked &#39;crosstable&#39; and &#39;pairingtable&#39; to cope with the
output of &#39;pair&#39;. Instead I should have tried to fix &#39;pairstately&#39;,
because &#39;crosstable&#39; and &#39;pairingtable&#39; don&#39;t have problems with the
YAML files generated by &#39;pairstately&#39;.

So if you think, the syntax of the YAML files generated by &#39;pair&#39; is
fine, this bug could be closed.

Thanks

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;15:33:01&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 17 Sep 2007 21:32:34 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Greg Matheson via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I just wanted to point to those failed tests at <span class="clickylink"><a target="new" rel="nofollow" href="http://cpantesters.perl.org/show/Games-Tournament-Swiss.html#Games-Tournament-Swiss-0.08">http://cpantesters.perl.org/show/Games-Tournament-Swiss.html#Games-Tournament-Swiss-0.08</a></span>

If one takes a closer look at the 4th test for version 0.08 there [1],
the output from &#39;make test&#39; contains warnings like

  Variable &#34;$scores&#34; will not stay shared at lib/Games/Tournament.pm
  line 362.

Maybe that&#39;s related to the problem I reported.

Best regards.

Christian

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.cpan.testers/2007/09/msg637308.html">http://www.nntp.perl.org/group/perl.cpan.testers/2007/09/msg637308.html</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/362794/164217/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;18&nbsp;05:05:30&nbsp;2007</span>
    <span class="description">drbean [...] freeshell.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 18 Sep 2007 08:30:19 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Bartolomaeus via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Greg Matheson &lt;drbean [...] freeshell.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 17 Sep 2007, Christian Bartolomaeus via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   Variable &#34;$scores&#34; will not stay shared at lib/Games/Tournament.pm
&gt;   line 362.
</div>
I wondered about that message, which I don&#39;t see. Do you see
it when you run tests?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe that&#39;s related to the problem I reported.
</div>
The problem code has been in there since version 0.03, so it&#39;s
probably not related, but I took it out anyway.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;18&nbsp;05:43:16&nbsp;2007</span>
    <span class="description">bartolin [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29184] scores aren&#39;t recorded properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 18 Sep 2007 11:42:11 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Greg Matheson via RT &lt;bug-Games-Tournament-Swiss [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Bartolomaeus &lt;bartolin [...] gmx.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* On 2007-09-18 Greg Matheson via RT &#40;bug-Games-Tournament-Swiss@rt.cpan.org&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
<div class="message-stanza open">&gt; &gt;   Variable &#34;$scores&#34; will not stay shared at lib/Games/Tournament.pm
&gt; &gt;   line 362.
</div>&gt; 
&gt; I wondered about that message, which I don&#39;t see. Do you see
&gt; it when you run tests?
</div>
No, I don&#39;t. Maybe that&#39;s related to the perl version? I use 5.8.8 and
the failed tests giving message seem to use 5.9.5. [Though I didn&#39;t
check for all tests.] 

Maybe the tests of 5.9.5 are more sophisticated and therefore detect a
problem which the tests of 5.8.5 don&#39;t find? On the other hand I know
next to nothing about making tests with perl.

The only warning messages I get are:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/cc6619....[...]
&gt; No result in round 1 for player 2, Two as Black at t/cc6619.t line 173
&gt; No result in round 1 for player 3, Three as White at t/cc6619.t line 173
&gt; No result in round 1 for player 4, Four as Black at t/cc6619.t line 173
</div>
... and so on. But I guess, you get those messages also.

Best regards

Christian
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/363063/164385/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;00:58:28&nbsp;2009</span>
    <span class="description">DRBEAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">pair seems to work in more recent versions. I am closing this report. Creating a pairing table still relies on YAML serialization files, which is something I would like to get rid of.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;00:58:29&nbsp;2009</span>
    <span class="description">DRBEAN [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
