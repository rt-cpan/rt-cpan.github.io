<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57204 for Tk-Date: [PATCH] Use Tk::DateEntry for date part -- test included</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57204 for Tk-Date: [PATCH] Use Tk::DateEntry for date part -- test included</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk-Date/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk-Date/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk-Date/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk-Date/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk-Date">Tk-Date CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57204</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk-Date/Active/">Tk-Date</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
POSSUM [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33696-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.43    </td>
  </tr>
  <tr id="CF-33697-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;04&nbsp;12:35:07&nbsp;2010</span>
    <span class="description">POSSUM [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Use Tk::DateEntry for date part -- test included</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please find included a patch for Tk::Date to allow the widget to
optionally use Tk::DateEntry for the date portion.

This was documented in the TODO part of the man page, so hopefully this
patch is sufficient for that.

I have included a test case, and I believe I have covered most of the bases.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tk-date-use-dateentry.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Date.pm        |  140 ++++++++++++++++++++++++++++++++++++++++++++++----------
 t/date_entry.t |   39 ++++++++++++++++
 2 files changed, 154 insertions&#40;+&#41;, 25 deletions&#40;-&#41;

diff --git a/Date.pm b/Date.pm
index ac8d652..c96cd4c 100644
--- a/Date.pm
+++ b/Date.pm
@@ -123,6 +123,7 @@ eval {
 ######################################################################
 
 package Tk::Date;
+use strict;
 
 sub MonthOptionmenu {
     require Tk::Optionmenu;
@@ -228,14 +229,28 @@ sub Populate {
     }
 
     # Construction of Date field
+
+    my $datefmt = delete $args-&gt;{-datefmt} || &#34;%2d.%2m.%4y&#34;;
+
     if &#40;$fields ne &#39;time&#39;&#41; {
+	    my $dw = $w-&gt;Frame-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
+	    $w-&gt;Advertise&#40;dateframe =&gt; $dw&#41;;
+    }
+
+    my $use_date_entry = delete $args-&gt;{-use_date_entry};
+    if &#40; $fields ne &#39;time&#39; and $use_date_entry &#41; {
+        # Can&#39;t we use standard POSIX strftime formats instead?
+        $datefmt =~ s/%4y/%Y/g;
+        $datefmt =~ s/%\d&#40;\w&#41;/%$1/g;
+        $args-&gt;{-datefmt} = $datefmt;
+        $w-&gt;_create_date_entry_widget&#40; $w-&gt;Subwidget&#40;&#39;dateframe&#39;&#41;, $args &#41;;
+    }
+    elsif &#40;$fields ne &#39;time&#39;&#41; {
+    my $dw = $w-&gt;Subwidget&#40;&#39;dateframe&#39;&#41;;
 	my %range = &#40;&#39;d&#39; =&gt; [1, 31],
 		     &#39;m&#39; =&gt; [1, 12],
 		    &#41;;
-	my $dw = $w-&gt;Frame-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
-	$w-&gt;Advertise&#40;dateframe =&gt; $dw&#41;;
-	my @datefmt = _fmt_to_array&#40;delete $args-&gt;{-datefmt} || &#34;%2d.%2m.%4y&#34;&#41;;
-
+	my @datefmt = _fmt_to_array&#40;$datefmt&#41;;
 	foreach &#40;@datefmt&#41; {
 	    if &#40;$_ =~ /^%&#40;\d+&#41;?&#40;.&#41;$/&#41; {
 		my&#40;$l, $k&#41; = &#40;$1, $2&#41;;
@@ -303,7 +318,6 @@ sub Populate {
 			  &#41;-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
 	    }
 	}
-
 	if &#40;$editable &#38;&#38; $has_firebutton &#38;&#38; !$allarrows&#41; {
 	    my $f = $dw-&gt;Frame-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
 	    my&#40;$fb1, $fb2&#41;;
@@ -490,28 +504,62 @@ sub Populate {
 				    $Tk::FireButton::HORIZDECBITMAP&#41;;
     }
 
-    $w-&gt;ConfigSpecs
-      &#40;-repeatinterval =&gt; [&#39;METHOD&#39;, &#39;repeatInterval&#39;, &#39;RepeatInterval&#39;, 50],
-       -repeatdelay    =&gt; [&#39;METHOD&#39;, &#39;repeatDelay&#39;,    &#39;RepeatDelay&#39;,   500],
-       -decbitmap      =&gt; [&#39;METHOD&#39;,      &#39;decBitmap&#39;,  &#39;DecBitmap&#39;,
-			   $decbitmap],
-       -incbitmap      =&gt; [&#39;METHOD&#39;,      &#39;incBitmap&#39;,  &#39;IncBitmap&#39;,
-			   $incbitmap],
-       -bell           =&gt; [&#39;METHOD&#39;, &#39;bell&#39;, &#39;Bell&#39;, undef],
-       -background     =&gt; [&#39;DESCENDANTS&#39;, &#39;background&#39;, &#39;Background&#39;, undef],
-       -foreground     =&gt; [&#39;DESCENDANTS&#39;, &#39;foreground&#39;, &#39;Foreground&#39;, undef],
-       -precommand     =&gt; [&#39;CALLBACK&#39;,    &#39;preCommand&#39;, &#39;PreCommand&#39;, undef],
-       -command        =&gt; [&#39;CALLBACK&#39;,    &#39;command&#39;,    &#39;Command&#39;,    undef],
-       -variable       =&gt; [&#39;METHOD&#39;,      &#39;variable&#39;,   &#39;Variable&#39;,   undef],
-       -value          =&gt; [&#39;METHOD&#39;,      &#39;value&#39;,      &#39;Value&#39;,      undef],
-       -innerbg        =&gt; [&#39;SETMETHOD&#39;,   &#39;innerBg&#39;, &#39;InnerBg&#39;,    undef],
-       -innerfg        =&gt; [&#39;SETMETHOD&#39;,   &#39;innerFg&#39;, &#39;InnerFg&#39;,    undef],
-       -state          =&gt; [&#39;METHOD&#39;,      &#39;state&#39;,   &#39;State&#39;,      &#39;normal&#39;],
-      &#41;;
+    $w-&gt;ConfigSpecs&#40;
+        -repeatinterval =&gt; [ &#39;METHOD&#39;, &#39;repeatInterval&#39;, &#39;RepeatInterval&#39;, 50 ],
+        -repeatdelay =&gt; [ &#39;METHOD&#39;, &#39;repeatDelay&#39;, &#39;RepeatDelay&#39;, 500 ],
+        -decbitmap   =&gt; [ &#39;METHOD&#39;, &#39;decBitmap&#39;,   &#39;DecBitmap&#39;,   $decbitmap ],
+        -incbitmap   =&gt; [ &#39;METHOD&#39;, &#39;incBitmap&#39;,   &#39;IncBitmap&#39;,   $incbitmap ],
+        -bell        =&gt; [ &#39;METHOD&#39;, &#39;bell&#39;,        &#39;Bell&#39;,        undef ],
+        -background =&gt; [ &#39;DESCENDANTS&#39;, &#39;background&#39;, &#39;Background&#39;, undef ],
+        -foreground =&gt; [ &#39;DESCENDANTS&#39;, &#39;foreground&#39;, &#39;Foreground&#39;, undef ],
+        -precommand =&gt; [ &#39;CALLBACK&#39;,    &#39;preCommand&#39;, &#39;PreCommand&#39;, undef ],
+        -command    =&gt; [ &#39;CALLBACK&#39;,    &#39;command&#39;,    &#39;Command&#39;,    undef ],
+        -variable   =&gt; [ &#39;METHOD&#39;,      &#39;variable&#39;,   &#39;Variable&#39;,   undef ],
+        -value      =&gt; [ &#39;METHOD&#39;,      &#39;value&#39;,      &#39;Value&#39;,      undef ],
+        -innerbg    =&gt; [ &#39;SETMETHOD&#39;,   &#39;innerBg&#39;,    &#39;InnerBg&#39;,    undef ],
+        -innerfg    =&gt; [ &#39;SETMETHOD&#39;,   &#39;innerFg&#39;,    &#39;InnerFg&#39;,    undef ],
+        -state      =&gt; [ &#39;METHOD&#39;,      &#39;state&#39;,      &#39;State&#39;,      &#39;normal&#39; ],
+        -use_date_entry =&gt;
+            [ &#39;SETMETHOD&#39;, &#39;use_date_entry&#39;, &#39;UseDateEntry&#39;, undef ],
+        -date_entry_args =&gt;
+            [ &#39;SETMETHOD&#39;, &#39;date_entry_args&#39;, &#39;DateEntryArgs&#39;, undef ],
+    &#41;;
 
     $w;
 }
 
+sub _create_date_entry_widget {
+    my &#40; $self, $parent, $args &#41; = @_;
+    my $datefmt    = delete $args-&gt;{-datefmt};
+    my $entry_args = delete $args-&gt;{-date_entry_args};
+    if &#40; not&#40; $entry_args-&gt;{-parser} &#41; &#41; {
+        eval {
+            require POSIX;
+            require POSIX::strptime;
+            1;
+        } or die &#34;Need POSIX and POSIX::strptime installed &#40;$@&#41;&#34;;
+        $entry_args-&gt;{-parsecmd} = sub {
+            my &#40;$str&#41; = @_;
+            my &#40; $sec, $min, $hour, $mday, $mon, $year, $wday, $yday &#41;
+                = POSIX::strptime&#40; $str, $datefmt &#41;;
+            return &#40; $year + 1900, $mon + 1, $mday &#41;;
+        };
+        $entry_args-&gt;{-formatcmd} = sub {
+            my &#40; $y, $m, $d &#41; = @_;
+            my &#40; $S, $M, $H &#41; = &#40;undef&#41; x 3;
+            $m -= 1;
+            $y -= 1900;
+            return POSIX::strftime&#40; $datefmt, $S, $M, $H, $d, $m, $y &#41;;
+        };
+    }
+    $entry_args-&gt;{-textvariable} ||= \$self-&gt;{Var}{date_entry_textvariable};
+
+    my $entry = $parent-&gt;DateEntry&#40;%$entry_args&#41;;
+    $entry-&gt;pack;
+    $self-&gt;Advertise&#40; date_entry =&gt; $entry &#41;;
+    return $entry;
+}
+
 sub value {
     my&#40;$w, $value&#41; = @_;
     my $varfmt = $w-&gt;{Configure}{-varfmt};
@@ -729,6 +777,15 @@ sub get {
 sub get_date {
     my&#40;$w, $key, $defined&#41; = @_;
     my $sw = $w-&gt;{Sub}{$key};
+    if &#40; $key =~ /^&#40;[ymd]&#41;$/ &#41; {
+        if &#40; my $entry = eval { $w-&gt;Subwidget&#40;&#39;date_entry&#39;&#41; } &#41; {
+            my $var   = $entry-&gt;cget&#40;&#39;-textvariable&#39;&#41;;
+            my $parse = $entry-&gt;cget&#40;&#39;-parsecmd&#39;&#41;-&gt;[0];
+            my %parsed;
+            @parsed{qw&#40;y m d&#41;} = $parse-&gt;&#40;${$var}&#41;;
+            return $parsed{$key};
+        }
+    }
     if &#40;Tk::Exists&#40;$sw&#41;&#41; {
 	if &#40;$sw-&gt;isa&#40;&#39;Tk::Entry&#39;&#41; ||
 	    $sw-&gt;isa&#40;&#39;Tk::NumEntry&#39;&#41;&#41; {
@@ -757,6 +814,16 @@ sub set_date {
     my&#40;$w, $key, $value, %args&#41; = @_;
     $value = 0 if !defined $value; # XXX ???
 
+    if &#40; $key =~ /^[ymd]$/ and my $de = eval { $w-&gt;Subwidget&#40;&#39;date_entry&#39;&#41; } &#41; {
+        my $var_ref = $de-&gt;cget&#40;&#39;-textvariable&#39;&#41;;
+        my $format  = $de-&gt;cget&#40;&#39;-formatcmd&#39;&#41;;
+        my $parse   = $de-&gt;cget&#40;&#39;-parsecmd&#39;&#41;-&gt;[0];
+        my %keys;
+        @keys{qw&#40;y m d&#41;} = $parse-&gt;&#40; ${$var_ref} &#41;;
+        $keys{$key} = $value;
+        ${$var_ref} = $_-&gt;&#40; @keys{qw&#40;y m d&#41;} &#41; for @{$format};
+    }
+
     if &#40;$key eq &#39;d&#39;&#41; {
 	if &#40;!$args{-correcting}&#41; {
 	    if &#40;$value &lt; 1&#41; {
@@ -1319,6 +1386,14 @@ arguments: reference of date widget, field specifier, increment value.
 The field specifier is either &#34;date&#34; or &#34;time&#34; or one of &#34;H&#34;, &#34;M&#34;,
 &#34;S&#34;, &#34;d&#34;, &#34;m&#34;, &#34;y&#34; for the possible time and date fields.
 
+=item -date_entry_args
+
+Hashref of args passed to the L&lt;Tk::DateEntry&gt; constructor when
+I&lt;-use_date_entry&gt; is specified.  While every effort has been made to ensure
+compatibility, some options passed this way may be incompatible.  For instance,
+no date formatting options should typically be passed this way, since Tk::Date
+will handle this.  Use I&lt;-datefmt&gt; instead.
+
 =item -datefmt
 
 This is a sprintf/printf-like format string for setting the order and
@@ -1411,6 +1486,13 @@ set only while creating the widget.
 Change label text for choice menu. Defaults to &#39;Select:&#39;. This option
 can be set only while creating the widget.
 
+=item -use_date_entry
+
+Set to a true value &#40;i.e., 1&#41; and Tk::Date will use Tk::DateEntry to display the
+date portion of the widget.  This gives the user a dropdown calendar to select
+the date from.  This can only be set at construction and requires that
+L&lt;Tk::DateEntry&gt;, L&lt;POSIX&gt;, and L&lt;POSIX::strptime&gt; be installed.
+
 =item -value
 
 Sets an initial value for the widget. The argument may be B&lt;unixtime&gt;,
@@ -1472,6 +1554,14 @@ Use the datehash format instead of unixtime:
 	     -varfmt =&gt; &#39;datehash&#39;,
 	    &#41;-&gt;pack;
 
+Use the DateEntry widget for the date
+
+  $top-&gt;Date&#40;
+    -use_date_entry  =&gt; 1,
+    -date_entry_args =&gt; [ -daynames =&gt; [qw&#40;D L Ma Me J V S&#41; ],
+    -value           =&gt; &#39;now&#39;,
+  &#41;-&gt;pack;
+
 =head1 NOTES
 
 Please note that the full set of features only available, if the
@@ -1500,13 +1590,13 @@ feature is disabled for older perl versions.
  - more interactive examples are needed for some design issues &#40;how strong
    signal errors? ...&#41;
  - check date-Function
- - optionally use Tk::DateEntry for the date part
  - -command is not fully implemented
 
 =head1 SEE ALSO
 
 L&lt;Tk|Tk&gt;, L&lt;Tk::NumEntryPlain|Tk::NumEntryPlain&gt;,
-L&lt;Tk::FireButton|Tk::FireButton&gt;, L&lt;POSIX|POSIX&gt;
+L&lt;Tk::DateEntry|Tk::DateEntry&gt;, L&lt;Tk::FireButton|Tk::FireButton&gt;,
+L&lt;POSIX|POSIX&gt;, L&lt;POSIX::strptime|POSIX::strptime&gt;
 
 =head1 AUTHOR
 
diff --git a/t/date_entry.t b/t/date_entry.t
index e69de29..a158ce2 100644
--- a/t/date_entry.t
+++ b/t/date_entry.t
@@ -0,0 +1,39 @@
+#!/usr/bin/perl
+use strict;
+use warnings;
+use Tk;
+
+package Tk::Widget;
+use strict;
+use warnings;
+sub eventGenerate2 {
+    my $w = shift;
+    my $e = shift;
+    $w-&gt;eventGenerate&#40;$e, @_,
+		      &#40;$Tk::VERSION &gt;= 800.016 ? &#40;-warp =&gt; 1&#41; : &#40;&#41;&#41;,
+		     &#41;;
+    if &#40;$main::SLOW&#41; {
+	warn &#34;Event: $e =&gt; $w\n&#34;;
+	$w-&gt;update;
+	sleep $main::SLOW;
+    }
+}
+
+package main;
+use strict;
+use warnings;
+
+use Test::More tests =&gt; 4;
+
+#use Tk::widgets qw&#40;Date&#41;;
+
+my $top = MainWindow-&gt;new;
+my $dw = $top-&gt;Date&#40; -use_date_entry =&gt; 1 &#41;-&gt;pack;
+ok $dw;
+
+$dw = $top-&gt;Date&#40; -use_date_entry =&gt; 1, -value =&gt; &#39;now&#39; &#41;-&gt;pack;
+ok $dw;
+
+my $time = time&#40;&#41;;
+ok $dw-&gt;configure&#40; -value =&gt; $time &#41;;
+is $dw-&gt;get, $time;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;05&nbsp;12:32:10&nbsp;2010</span>
    <span class="description">POSSUM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It turns out there was a minor issue in the patch provided.

The behavior of POSIX::strftime is to supply a $mday &#40;day of month&#41; of
-1 if the supplied one is undefined.  This causes the date to tick back
to the prior month of the specified date.

The problem evidences itself when a widget is created with an empty
value, then populated, i.e., via $widget-&gt;configure&#40;-value =&gt; time&#40;&#41;&#41;; 
In such a case the widget will contain the date as though it were a year
prior.  I have included a test case that demonstrates this issue.

I have remedied this situation by defaulting $mday to 1 in the parsecmd
associated with the DateEntry widget.

Please find included two patch files.  The first,
&#34;tk-date-use-dateentry-2.patch&#34;, is against a working version with my
initial patch already applied.  The second,
&#34;tk-date-use-dateentry-full.patch&#34;, is a patch against the version 0.43
on CPAN.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tk-date-use-dateentry-full.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Date.pm        |  141 ++++++++++++++++++++++++++++++++++++++++++++++----------
 t/date_entry.t |   46 ++++++++++++++++++
 2 files changed, 162 insertions&#40;+&#41;, 25 deletions&#40;-&#41;

diff --git a/Date.pm b/Date.pm
index ac8d652..c9006c0 100644
--- a/Date.pm
+++ b/Date.pm
@@ -123,6 +123,7 @@ eval {
 ######################################################################
 
 package Tk::Date;
+use strict;
 
 sub MonthOptionmenu {
     require Tk::Optionmenu;
@@ -228,14 +229,28 @@ sub Populate {
     }
 
     # Construction of Date field
+
+    my $datefmt = delete $args-&gt;{-datefmt} || &#34;%2d.%2m.%4y&#34;;
+
     if &#40;$fields ne &#39;time&#39;&#41; {
+	    my $dw = $w-&gt;Frame-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
+	    $w-&gt;Advertise&#40;dateframe =&gt; $dw&#41;;
+    }
+
+    my $use_date_entry = delete $args-&gt;{-use_date_entry};
+    if &#40; $fields ne &#39;time&#39; and $use_date_entry &#41; {
+        # Can&#39;t we use standard POSIX strftime formats instead?
+        $datefmt =~ s/%4y/%Y/g;
+        $datefmt =~ s/%\d&#40;\w&#41;/%$1/g;
+        $args-&gt;{-datefmt} = $datefmt;
+        $w-&gt;_create_date_entry_widget&#40; $w-&gt;Subwidget&#40;&#39;dateframe&#39;&#41;, $args &#41;;
+    }
+    elsif &#40;$fields ne &#39;time&#39;&#41; {
+    my $dw = $w-&gt;Subwidget&#40;&#39;dateframe&#39;&#41;;
 	my %range = &#40;&#39;d&#39; =&gt; [1, 31],
 		     &#39;m&#39; =&gt; [1, 12],
 		    &#41;;
-	my $dw = $w-&gt;Frame-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
-	$w-&gt;Advertise&#40;dateframe =&gt; $dw&#41;;
-	my @datefmt = _fmt_to_array&#40;delete $args-&gt;{-datefmt} || &#34;%2d.%2m.%4y&#34;&#41;;
-
+	my @datefmt = _fmt_to_array&#40;$datefmt&#41;;
 	foreach &#40;@datefmt&#41; {
 	    if &#40;$_ =~ /^%&#40;\d+&#41;?&#40;.&#41;$/&#41; {
 		my&#40;$l, $k&#41; = &#40;$1, $2&#41;;
@@ -303,7 +318,6 @@ sub Populate {
 			  &#41;-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
 	    }
 	}
-
 	if &#40;$editable &#38;&#38; $has_firebutton &#38;&#38; !$allarrows&#41; {
 	    my $f = $dw-&gt;Frame-&gt;pack&#40;-side =&gt; &#39;left&#39;&#41;;
 	    my&#40;$fb1, $fb2&#41;;
@@ -490,28 +504,63 @@ sub Populate {
 				    $Tk::FireButton::HORIZDECBITMAP&#41;;
     }
 
-    $w-&gt;ConfigSpecs
-      &#40;-repeatinterval =&gt; [&#39;METHOD&#39;, &#39;repeatInterval&#39;, &#39;RepeatInterval&#39;, 50],
-       -repeatdelay    =&gt; [&#39;METHOD&#39;, &#39;repeatDelay&#39;,    &#39;RepeatDelay&#39;,   500],
-       -decbitmap      =&gt; [&#39;METHOD&#39;,      &#39;decBitmap&#39;,  &#39;DecBitmap&#39;,
-			   $decbitmap],
-       -incbitmap      =&gt; [&#39;METHOD&#39;,      &#39;incBitmap&#39;,  &#39;IncBitmap&#39;,
-			   $incbitmap],
-       -bell           =&gt; [&#39;METHOD&#39;, &#39;bell&#39;, &#39;Bell&#39;, undef],
-       -background     =&gt; [&#39;DESCENDANTS&#39;, &#39;background&#39;, &#39;Background&#39;, undef],
-       -foreground     =&gt; [&#39;DESCENDANTS&#39;, &#39;foreground&#39;, &#39;Foreground&#39;, undef],
-       -precommand     =&gt; [&#39;CALLBACK&#39;,    &#39;preCommand&#39;, &#39;PreCommand&#39;, undef],
-       -command        =&gt; [&#39;CALLBACK&#39;,    &#39;command&#39;,    &#39;Command&#39;,    undef],
-       -variable       =&gt; [&#39;METHOD&#39;,      &#39;variable&#39;,   &#39;Variable&#39;,   undef],
-       -value          =&gt; [&#39;METHOD&#39;,      &#39;value&#39;,      &#39;Value&#39;,      undef],
-       -innerbg        =&gt; [&#39;SETMETHOD&#39;,   &#39;innerBg&#39;, &#39;InnerBg&#39;,    undef],
-       -innerfg        =&gt; [&#39;SETMETHOD&#39;,   &#39;innerFg&#39;, &#39;InnerFg&#39;,    undef],
-       -state          =&gt; [&#39;METHOD&#39;,      &#39;state&#39;,   &#39;State&#39;,      &#39;normal&#39;],
-      &#41;;
+    $w-&gt;ConfigSpecs&#40;
+        -repeatinterval =&gt; [ &#39;METHOD&#39;, &#39;repeatInterval&#39;, &#39;RepeatInterval&#39;, 50 ],
+        -repeatdelay =&gt; [ &#39;METHOD&#39;, &#39;repeatDelay&#39;, &#39;RepeatDelay&#39;, 500 ],
+        -decbitmap   =&gt; [ &#39;METHOD&#39;, &#39;decBitmap&#39;,   &#39;DecBitmap&#39;,   $decbitmap ],
+        -incbitmap   =&gt; [ &#39;METHOD&#39;, &#39;incBitmap&#39;,   &#39;IncBitmap&#39;,   $incbitmap ],
+        -bell        =&gt; [ &#39;METHOD&#39;, &#39;bell&#39;,        &#39;Bell&#39;,        undef ],
+        -background =&gt; [ &#39;DESCENDANTS&#39;, &#39;background&#39;, &#39;Background&#39;, undef ],
+        -foreground =&gt; [ &#39;DESCENDANTS&#39;, &#39;foreground&#39;, &#39;Foreground&#39;, undef ],
+        -precommand =&gt; [ &#39;CALLBACK&#39;,    &#39;preCommand&#39;, &#39;PreCommand&#39;, undef ],
+        -command    =&gt; [ &#39;CALLBACK&#39;,    &#39;command&#39;,    &#39;Command&#39;,    undef ],
+        -variable   =&gt; [ &#39;METHOD&#39;,      &#39;variable&#39;,   &#39;Variable&#39;,   undef ],
+        -value      =&gt; [ &#39;METHOD&#39;,      &#39;value&#39;,      &#39;Value&#39;,      undef ],
+        -innerbg    =&gt; [ &#39;SETMETHOD&#39;,   &#39;innerBg&#39;,    &#39;InnerBg&#39;,    undef ],
+        -innerfg    =&gt; [ &#39;SETMETHOD&#39;,   &#39;innerFg&#39;,    &#39;InnerFg&#39;,    undef ],
+        -state      =&gt; [ &#39;METHOD&#39;,      &#39;state&#39;,      &#39;State&#39;,      &#39;normal&#39; ],
+        -use_date_entry =&gt;
+            [ &#39;SETMETHOD&#39;, &#39;use_date_entry&#39;, &#39;UseDateEntry&#39;, undef ],
+        -date_entry_args =&gt;
+            [ &#39;SETMETHOD&#39;, &#39;date_entry_args&#39;, &#39;DateEntryArgs&#39;, undef ],
+    &#41;;
 
     $w;
 }
 
+sub _create_date_entry_widget {
+    my &#40; $self, $parent, $args &#41; = @_;
+    my $datefmt    = delete $args-&gt;{-datefmt};
+    my $entry_args = delete $args-&gt;{-date_entry_args};
+    if &#40; not&#40; $entry_args-&gt;{-parser} &#41; &#41; {
+        eval {
+            require POSIX;
+            require POSIX::strptime;
+            1;
+        } or die &#34;Need POSIX and POSIX::strptime installed &#40;$@&#41;&#34;;
+        $entry_args-&gt;{-parsecmd} = sub {
+            my &#40;$str&#41; = @_;
+            my &#40; $sec, $min, $hour, $mday, $mon, $year, $wday, $yday &#41;
+                = POSIX::strptime&#40; $str, $datefmt &#41;;
+            $mday ||= 1;
+            return &#40; $year + 1900, $mon + 1, $mday &#41;;
+        };
+        $entry_args-&gt;{-formatcmd} = sub {
+            my &#40; $y, $m, $d &#41; = @_;
+            my &#40; $S, $M, $H &#41; = &#40;undef&#41; x 3;
+            $m -= 1;
+            $y -= 1900;
+            return POSIX::strftime&#40; $datefmt, $S, $M, $H, $d, $m, $y &#41;;
+        };
+    }
+    $entry_args-&gt;{-textvariable} ||= \$self-&gt;{Var}{date_entry_textvariable};
+
+    my $entry = $parent-&gt;DateEntry&#40;%$entry_args&#41;;
+    $entry-&gt;pack;
+    $self-&gt;Advertise&#40; date_entry =&gt; $entry &#41;;
+    return $entry;
+}
+
 sub value {
     my&#40;$w, $value&#41; = @_;
     my $varfmt = $w-&gt;{Configure}{-varfmt};
@@ -729,6 +778,15 @@ sub get {
 sub get_date {
     my&#40;$w, $key, $defined&#41; = @_;
     my $sw = $w-&gt;{Sub}{$key};
+    if &#40; $key =~ /^&#40;[ymd]&#41;$/ &#41; {
+        if &#40; my $entry = eval { $w-&gt;Subwidget&#40;&#39;date_entry&#39;&#41; } &#41; {
+            my $var   = $entry-&gt;cget&#40;&#39;-textvariable&#39;&#41;;
+            my $parse = $entry-&gt;cget&#40;&#39;-parsecmd&#39;&#41;-&gt;[0];
+            my %parsed;
+            @parsed{qw&#40;y m d&#41;} = $parse-&gt;&#40;${$var}&#41;;
+            return $parsed{$key};
+        }
+    }
     if &#40;Tk::Exists&#40;$sw&#41;&#41; {
 	if &#40;$sw-&gt;isa&#40;&#39;Tk::Entry&#39;&#41; ||
 	    $sw-&gt;isa&#40;&#39;Tk::NumEntry&#39;&#41;&#41; {
@@ -757,6 +815,16 @@ sub set_date {
     my&#40;$w, $key, $value, %args&#41; = @_;
     $value = 0 if !defined $value; # XXX ???
 
+    if &#40; $key =~ /^[ymd]$/ and my $de = eval { $w-&gt;Subwidget&#40;&#39;date_entry&#39;&#41; } &#41; {
+        my $var_ref = $de-&gt;cget&#40;&#39;-textvariable&#39;&#41;;
+        my $format  = $de-&gt;cget&#40;&#39;-formatcmd&#39;&#41;;
+        my $parse   = $de-&gt;cget&#40;&#39;-parsecmd&#39;&#41;-&gt;[0];
+        my %keys;
+        @keys{qw&#40;y m d&#41;} = $parse-&gt;&#40; ${$var_ref} &#41;;
+        $keys{$key} = $value;
+        ${$var_ref} = $_-&gt;&#40; @keys{qw&#40;y m d&#41;} &#41; for @{$format};
+    }
+
     if &#40;$key eq &#39;d&#39;&#41; {
 	if &#40;!$args{-correcting}&#41; {
 	    if &#40;$value &lt; 1&#41; {
@@ -1319,6 +1387,14 @@ arguments: reference of date widget, field specifier, increment value.
 The field specifier is either &#34;date&#34; or &#34;time&#34; or one of &#34;H&#34;, &#34;M&#34;,
 &#34;S&#34;, &#34;d&#34;, &#34;m&#34;, &#34;y&#34; for the possible time and date fields.
 
+=item -date_entry_args
+
+Hashref of args passed to the L&lt;Tk::DateEntry&gt; constructor when
+I&lt;-use_date_entry&gt; is specified.  While every effort has been made to ensure
+compatibility, some options passed this way may be incompatible.  For instance,
+no date formatting options should typically be passed this way, since Tk::Date
+will handle this.  Use I&lt;-datefmt&gt; instead.
+
 =item -datefmt
 
 This is a sprintf/printf-like format string for setting the order and
@@ -1411,6 +1487,13 @@ set only while creating the widget.
 Change label text for choice menu. Defaults to &#39;Select:&#39;. This option
 can be set only while creating the widget.
 
+=item -use_date_entry
+
+Set to a true value &#40;i.e., 1&#41; and Tk::Date will use Tk::DateEntry to display the
+date portion of the widget.  This gives the user a dropdown calendar to select
+the date from.  This can only be set at construction and requires that
+L&lt;Tk::DateEntry&gt;, L&lt;POSIX&gt;, and L&lt;POSIX::strptime&gt; be installed.
+
 =item -value
 
 Sets an initial value for the widget. The argument may be B&lt;unixtime&gt;,
@@ -1472,6 +1555,14 @@ Use the datehash format instead of unixtime:
 	     -varfmt =&gt; &#39;datehash&#39;,
 	    &#41;-&gt;pack;
 
+Use the DateEntry widget for the date
+
+  $top-&gt;Date&#40;
+    -use_date_entry  =&gt; 1,
+    -date_entry_args =&gt; [ -daynames =&gt; [qw&#40;D L Ma Me J V S&#41; ],
+    -value           =&gt; &#39;now&#39;,
+  &#41;-&gt;pack;
+
 =head1 NOTES
 
 Please note that the full set of features only available, if the
@@ -1500,13 +1591,13 @@ feature is disabled for older perl versions.
  - more interactive examples are needed for some design issues &#40;how strong
    signal errors? ...&#41;
  - check date-Function
- - optionally use Tk::DateEntry for the date part
  - -command is not fully implemented
 
 =head1 SEE ALSO
 
 L&lt;Tk|Tk&gt;, L&lt;Tk::NumEntryPlain|Tk::NumEntryPlain&gt;,
-L&lt;Tk::FireButton|Tk::FireButton&gt;, L&lt;POSIX|POSIX&gt;
+L&lt;Tk::DateEntry|Tk::DateEntry&gt;, L&lt;Tk::FireButton|Tk::FireButton&gt;,
+L&lt;POSIX|POSIX&gt;, L&lt;POSIX::strptime|POSIX::strptime&gt;
 
 =head1 AUTHOR
 
diff --git a/t/date_entry.t b/t/date_entry.t
new file mode 100644
index 0000000..835f9a2
--- /dev/null
+++ b/t/date_entry.t
@@ -0,0 +1,46 @@
+#!/usr/bin/perl
+use strict;
+use warnings;
+use Tk;
+
+package Tk::Widget;
+use strict;
+use warnings;
+sub eventGenerate2 {
+    my $w = shift;
+    my $e = shift;
+    $w-&gt;eventGenerate&#40;$e, @_,
+		      &#40;$Tk::VERSION &gt;= 800.016 ? &#40;-warp =&gt; 1&#41; : &#40;&#41;&#41;,
+		     &#41;;
+    if &#40;$main::SLOW&#41; {
+	warn &#34;Event: $e =&gt; $w\n&#34;;
+	$w-&gt;update;
+	sleep $main::SLOW;
+    }
+}
+
+package main;
+use strict;
+use warnings;
+
+use Test::More tests =&gt; 7;
+
+#use Tk::widgets qw&#40;Date&#41;;
+
+my $top = MainWindow-&gt;new;
+my $dw = $top-&gt;Date&#40; -use_date_entry =&gt; 1 &#41;-&gt;pack;
+ok $dw;
+
+$dw = $top-&gt;Date&#40; -use_date_entry =&gt; 1, -value =&gt; &#39;now&#39; &#41;-&gt;pack;
+ok $dw;
+
+sleep 1;
+my $time = time&#40;&#41;;
+ok $dw-&gt;configure&#40; -value =&gt; $time &#41;;
+is $dw-&gt;get, $time;
+
+$dw = $top-&gt;Date&#40; -use_date_entry =&gt; 1 &#41;-&gt;pack;
+ok $dw;
+$time = time&#40;&#41;;
+ok $dw-&gt;configure&#40; -value =&gt; $time &#41;;
+is $dw-&gt;get, $time;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tk-date-use-dateentry-2.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Date.pm        |    1 +
 t/date_entry.t |    9 ++++++++-
 2 files changed, 9 insertions&#40;+&#41;, 1 deletions&#40;-&#41;

diff --git a/Date.pm b/Date.pm
index c96cd4c..c9006c0 100644
--- a/Date.pm
+++ b/Date.pm
@@ -542,6 +542,7 @@ sub _create_date_entry_widget {
             my &#40;$str&#41; = @_;
             my &#40; $sec, $min, $hour, $mday, $mon, $year, $wday, $yday &#41;
                 = POSIX::strptime&#40; $str, $datefmt &#41;;
+            $mday ||= 1;
             return &#40; $year + 1900, $mon + 1, $mday &#41;;
         };
         $entry_args-&gt;{-formatcmd} = sub {
diff --git a/t/date_entry.t b/t/date_entry.t
index a158ce2..835f9a2 100644
--- a/t/date_entry.t
+++ b/t/date_entry.t
@@ -23,7 +23,7 @@ package main;
 use strict;
 use warnings;
 
-use Test::More tests =&gt; 4;
+use Test::More tests =&gt; 7;
 
 #use Tk::widgets qw&#40;Date&#41;;
 
@@ -34,6 +34,13 @@ ok $dw;
 $dw = $top-&gt;Date&#40; -use_date_entry =&gt; 1, -value =&gt; &#39;now&#39; &#41;-&gt;pack;
 ok $dw;
 
+sleep 1;
 my $time = time&#40;&#41;;
 ok $dw-&gt;configure&#40; -value =&gt; $time &#41;;
 is $dw-&gt;get, $time;
+
+$dw = $top-&gt;Date&#40; -use_date_entry =&gt; 1 &#41;-&gt;pack;
+ok $dw;
+$time = time&#40;&#41;;
+ok $dw-&gt;configure&#40; -value =&gt; $time &#41;;
+is $dw-&gt;get, $time;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;May&nbsp;05&nbsp;12:32:12&nbsp;2010</span>
    <span class="description">POSSUM [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
