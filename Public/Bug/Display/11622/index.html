<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #11622 for Config-Auto: Compile errors do not propagate</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #11622 for Config-Auto: Compile errors do not propagate</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Config-Auto/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Config-Auto/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Config-Auto/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Config-Auto/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Config-Auto">Config-Auto CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">11622</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Config-Auto/Active/">Config-Auto</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
william [...] knowmad.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-7624-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.11    </td>
  </tr>
  <tr id="CF-7625-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;22&nbsp;13:15:11&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Compile errors do not propagate</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jos,

An issue that I&#39;ve discovered while using Config::Auto with taintmode is that the do&#40;&#41; function returns undef if the file being compiled generates an error. This is also the case for normal perl files that fail to compile due to syntax errors or other problems.

In both cases, Config::Auto simply returns an undef value rather than die&#39;ing with an error. I&#39;ve modified the eval_perl function again to include tests for read and compile errors. These simple tests are based on the example code in `perldoc -f do` &#40;perl 5.8.4&#41; and would have saved me a bit of time yesterday so I hope that you will include them. My preference would be that all of these tests should die if they fail but emitting a warning for the last two would suffice &#40;compile errors should always throw a die&#41;.

In addition to the error checking patch, I&#39;ve made some modifications to the POD which includes a list of the formats &#40;so I don&#39;t have to look in the code or tell others to check the code to see what formats are supported&#41;, a trouble-shooting section, and a revision to the description of the Untaint setting to provide a more accurate explanation of what is being untainted.


Thanks,
William
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Auto.pm	2004-11-10 05:36:26.000000000 -0500
+++ /home/william/work/gaitways/web/Partners/perl5/Config/Auto.pm	2005-02-22 13:06:27.000000000 -0500
@@ -149,7 +150,15 @@
     return undef;
 }
 
-sub eval_perl   { do $_[0]; }
+sub eval_perl   {
+  my $file = shift;
+  &#40;$file&#41; = $file =~ m/^&#40;.*&#41;$/s if $Untaint;
+  my $cfg = do $file;
+  die &#34;Config::Auto couldn&#39;t parse $file: $@&#34; if $@;
+  die &#34;Config::Auto couldn&#39;t do $file: $!&#34;    unless defined $cfg;
+  die &#34;Config::Auto couldn&#39;t run $file&#34;       unless $cfg;
+  return $cfg;
+}
 sub parse_xml   { return XMLin&#40;shift&#41;; }
 sub parse_ini   { tie my %ini, &#39;Config::IniFiles&#39;, &#40;-file=&gt;$_[0]&#41;; return \%ini; }
 sub return_list { open my $fh, shift or die $!; return [&lt;$fh&gt;]; }
@@ -324,6 +333,12 @@
 If you don&#39;t want it ever to detect and execute config files which are made
 up of Perl code, set C&lt;$Config::Auto::DisablePerl = 1&gt;.
 
+When using the perl format, your configuration file will be eval&#39;d using
+do&#40;file&#41;. This will cause taint errors if the filename is not untainted. To
+avoid these warnings, set C&lt;$Config::Auto::Untaint = 1&gt;. This setting will not
+untaint the data in your configuration file and should only be used if you
+trust the source of the filename.
+
 Then the file is parsed and a data structure is returned. Since we&#39;re
 working magic, we have to do the best we can under the circumstances -
 &#34;You rush a miracle man, you get rotten miracles.&#34; &#40;Miracle Max&#41; So
@@ -390,6 +405,43 @@
 C&lt;format&gt;, which forces C&lt;Config::Auto&gt; to interpret the contents of the
 configuration file in the given format without trying to guess.
 
+=head2 Formats
+
+C&lt;Config::Auto&gt; recognizes the following formats:
+
+=over 4
+
+=item * Perl =&gt; perl code
+
+=item * colon  =&gt; colon separated &#40;e.g., key:value&#41;
+
+=item * space  =&gt; space separated &#40;e.g., key value&#41;
+
+=item * equal  =&gt; equal separated &#40;e.g., key=value&#41;
+
+=item * bind   =&gt; bind style &#40;not available&#41;
+
+=item * irssi  =&gt; irssi style &#40;not available&#41;
+
+=item * xml    =&gt; xml &#40;via XML::Simple&#41;
+
+=item * ini    =&gt; .ini format &#40;via Config::IniFiles&#41;
+
+=item * list   =&gt; list &#40;e.g., ??&#41;
+
+=back
+
+
+=head1 TROUBLESHOOTING
+
+=over 4
+
+=item When using a Perl config file, the configuration is borked
+
+Give C&lt;Config::Auto&gt; more hints &#40;e.g., add #!/usr/bin/perl to beginning of
+file&#41; or indicate the format in the parse&#40;&#41; command.
+
+
 =head1 TODO
 
 BIND9 and irssi file format parsers currently don&#39;t exist. It would be
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;10&nbsp;09:16:40&nbsp;2005</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Tue Feb 22 13:15:11 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In addition to the error checking patch, I&#39;ve made some modifications
&gt;    to the POD which includes a list of the formats 
</div>Thanks, applied @11984

For extra browniepoints, test patches are always welcome :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;10&nbsp;09:16:41&nbsp;2005</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
