<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75311 for Test-Harness: Either clear the Unicode air--or make a release-blocker?  &#40;was: Unicode cheatsheet for Perl&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75311 for Test-Harness: Either clear the Unicode air--or make a release-blocker?  &#40;was: Unicode cheatsheet for Perl&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-Harness/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-Harness/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-Harness/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-Harness/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Harness">Test-Harness CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75311</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">deleted</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-Harness/Active/">Test-Harness</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tchrist [...] perl.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31430-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31431-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;25&nbsp;17:30:53&nbsp;2012</span>
    <span class="description">tchrist [...] perl.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Karl Williamson &lt;public [...] khwilliamson.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Perl5 Porters Mailing List &lt;perl5-porters [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Jarkko Hietaniemi &lt;jhi [...] iki.fi&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Christian Hansen &lt;christian.hansen [...] mac.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Either clear the Unicode air--or make a release-blocker?  &#40;was: Unicode cheatsheet for Perl&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 25 Feb 2012 15:28:42 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Leon Timmermans &lt;fawaka [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ricardo Signes &lt;perl.p5p [...] rjbs.manxome.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tom Christiansen &lt;tchrist [...] perl.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Maybe that&#39;s too strong a subject line, but I *really* want to know *exactly*
what we can&#39;t tell people they can use Perl with Unicode in anything but the
most excruciating all all possible ways -- if this is indeed true.

Leon Timmermans &lt;fawaka@gmail.com&gt; on Tue, 21 Feb 2012 09:44:15 +0100 wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not entirely sure what gets fixed by that and what doesn&#39;t, it isn&#39;t
&gt; documented at all. Looking at the source makes me feel it&#39;s a hack IMO, and
&gt; I strongly suspect it is not quite a complete fix: there are just too many
&gt; places that would need to get fixed. I believe the utf8 layer would be the
&gt; right place to do it because that&#39;s the only place that almost all Input
&gt; passes through. Fixing it there fixes it almost everywhere &#40;except sysread I
&gt; suppose, but that can be fixed too&#41;.
</div>
Some folks claim the only &#34;safe&#34; way to use Unicode in Perl is to always make
explicit calls to encode/decode with a bonus FB_CROAK argument.  They claim
that all nine of these perfectly reasonable and common-to-the-99th-percentile 
operations...

    #1.   $ perl -C...
    #2.   $ export PERL_UNICODE=...

    #3.     use utf8;

    #4.     use open qw[ :std :utf8            ];
    #5.     use open qw[ :std :encoding&#40;UTF-8&#41; ];

    #6.     binmode&#40;FH, &#34;:utf8&#34;&#41;;
    #7.     binmode&#40;FH, &#34;:encoding&#40;UTF-8&#41;&#34;&#41;;

    #8.     open&#40;FH,  &#34;&lt; :utf8&#34;,            $path&#41;;
    #9.     open&#40;FH,  &#34;&lt; :encoding&#40;UTF-8&#41;&#34;, $path&#41;;

...are all of them flawed in their not raising exceptions on UTF-8
encoding errors of one sort of another, and that somehow not even...

    #0.     use warnings qw&#40;FATAL utf8&#41;;

...is good enough to fix it.  

I do not know whether these claims are true.  My own tests suggest this may
not be the whole story, because this behaves as I think it should:

  darwin$ perl -C0 -E &#39;say for &#34;caf\xE9&#34;, &#34;stuff&#34;&#39; | 
          perl -CS -Mwarnings=FATAL,utf8 -pe &#39;print &#34;$. &#34;&#39;
  utf8 &#34;\xE9&#34; does not map to Unicode, &lt;&gt; line 1.
  Exit 255

  darwin$ 

Which seems to say that #0 makes at least #1 safe.  Again, I&#39;m fuzzy on what
the perceived problem actually is.  Maybe they&#39;re using autodie or something,
which is known broken. I&#39;m trying to get more info.

I also do not know the precise details of these so-called &#34;security&#34; bugs that
Christian references.  I&#39;ve no reason to disbelieve Christian; I just don&#39;t
know the details myself, nor am I asking that they be splatted all over.

What I do know is that telling people that the only &#34;right&#34; or &#34;safe&#34; or
&#34;acceptable&#34; way to use Unicode in Perl is via myriad exclicit calls to
&#38;Encode::{utf8_,}{en,de}code&#40;..., FB_CROAK&#41; just doesn&#39;t cut it—full stop.

If there&#39;s something so important that it must be done everytime to ensure
correct behavior, then that is too important to be left up to the programmer
to forget to do.  It needs to be done for him.

We should not have to endure five more tedious years of people getting
tonguelashed and flamenagged into writing horribly complicated code
all because something deep down in Perl&#39;s dwimmer is flawed.

I say five years, not one year, because of how long it takes to get vendors
to get themselves updated.  If this is a legit issue, and we push it off till
2013&#39;s v5.18, then it will be a further 2–4 years past that until people can
have reasonable Unicode processing in their vendor Perl.  That puts us into
the 2015–2017 &#40;!&#41; time frame, and... that&#39;s just not acceptable, eh?

By that time, one or both of two things will have happened.  Either untold
zillions of lines of code will have been written that either conform to
this ridiculous amount of monkeywork, entrenching a bad pattern forever, or
else untold zillions of line of code will have been written that ignore it
and are themselves open to the kind of spooky catastrophic failure that
people allude to, thereby rendering all Perl a security hole of Chicken
Little proportion.

Since we won&#39;t let either of those happen, I figure that either 

 —— all #1 .. #9 of my numbered points above are completely safe and
    proper, preferably always but minimally along with the #0 fatalization
 
 —— or else they need to be made so before we dare release v5.16.

Why?  Simple: remove those 9 simple ways to approach implicit Unicode
processing in Perl, and you so gut Perl&#39;s Unicode dwimmer that nobody
save the very most diligent and élite [sic] of Perl gurus will ever dare
use Perl with Unicode.  That would be tragic, maybe disastrous even.

Possibly this is all well known, and I just haven&#39;t been listening.  Maybe
it&#39;s even been fixed, assuming it was ever broken in the first place, which
I&#39;m highly fuzzy on and can neither prove nor disprove with my own meagre
poking at the problem.  If so, I apologize for making much ado about nothing.

I do have notions about what should be happening with encoding layers,
including backwards compatibility concerns versus security concerns;
something along the lines that we&#39;re under no obligation to leave our
backdoors standing open for eternity.  Also, I strongly feel that all
encoding  errors should croak by default.  I hate garbage in files as
things silently fill them with manglings.  Those should croak if you haven&#39;t
explicitly asked to get garbage out.  That shouldn&#39;t be a default.

I&#39;m still troubled that Encode is *not* one of &#34;our&#34; modules, yet a whole lot
of what we do seems dependent on it.  We can&#39;t usefully create new warnings
and classes, errors, encoding names, and exceptions of encodings used in
internally if they don&#39;t sync up with Encode.  But we have and they don&#39;t:
already the utf8 warnings subclasses are broken with Encode.  That makes it
even more important that we get the internal stuff &#34;right&#34;. There&#39;s a bunch
more where that came from, but I&#39;ll save the rest till someone tells me where
we actually stand.

Karl, Leon, and Christian, thank you for your time and insights, both past
and future.  Nothing would please me more than to learn that I&#39;ve had my cage
rattled for nothing, and that these are all non-issues.

--tom

PS: Christian Hansen, if you say your name fast enough, 
                      it rather sounds like my surname. :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;25&nbsp;19:05:29&nbsp;2012</span>
    <span class="description">mschwern [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
