<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75624 for Compress-LZ4: x86_64: decompress&#40;compress&#40;$x&#41;&#41; does not equal $x</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75624 for Compress-LZ4: x86_64: decompress&#40;compress&#40;$x&#41;&#41; does not equal $x</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Compress-LZ4">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Compress-LZ4">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Compress-LZ4">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Compress-LZ4">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Compress-LZ4">Compress-LZ4 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75624</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Compress-LZ4">Compress-LZ4</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
danielqzinn [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-242432-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-242433-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




02_roudtrip.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1047705/547559/02_roudtrip.t">
Thu Mar 08 13:58:27 2012 (485b) by danielqzinn [...] gmail.com
</a>
</font></li>
</ul>


compress.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1047816/547629/compress.pl">
Thu Mar 08 17:36:43 2012 (111b) by danielqzinn [...] gmail.com
</a>
</font></li>
</ul>


environment.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1047705/547558/environment.txt">
Thu Mar 08 13:58:27 2012 (2.5k) by danielqzinn [...] gmail.com
</a>
</font></li>
</ul>


output.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1047705/547557/output.txt">
Thu Mar 08 13:58:27 2012 (642b) by danielqzinn [...] gmail.com
</a>
</font></li>
</ul>


test.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1047705/547556/test.pl">
Thu Mar 08 13:58:27 2012 (200b) by danielqzinn [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=75624">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047705" href="/Public/Bug/Display.html?id=75624#txn-1047705">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;13:58:27&nbsp;2012</span>
    <span class="description">danielqzinn [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> gray [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> decompress&#40;compress&#40;$x&#41;&#41;  does not equal  $x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 08 Mar 2012 10:58:14 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Compress-LZ4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Zinn &lt;danielqzinn [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047705/547555/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/547555">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 365b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Sir or Madam:

Please find attached an example perl script to reproduce the bug.

I am using the current version of Compress::LZ4 from CPAN and the tests
that come with it went through fine. More information about my
environment is attached.

I also attached a .t file that can be used to reproduce the test as part
of the distribution.

Thank you!

   Daniel
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047705/547556/test.pl">Download test.pl</a><br />
<span class="downloadcontenttype">text/x-perl 200b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047705/547557/output.txt">Download output.txt</a><br />
<span class="downloadcontenttype">text/plain 642b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047705/547558/environment.txt">Download environment.txt</a><br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047705/547559/02_roudtrip.t">Download 02_roudtrip.t</a><br />
<span class="downloadcontenttype">text/x-perl 485b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047790" href="/Public/Bug/Display.html?id=75624#txn-1047790">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;17:16:34&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047790/547608/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/547608">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 959b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 08 13:58:27 2012, danielqzinn@gmail.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please find attached an example perl script to reproduce the bug.
&gt; 
&gt; I am using the current version of Compress::LZ4 from CPAN and the tests
&gt; that come with it went through fine. More information about my
&gt; environment is attached.
&gt; 
&gt; I also attached a .t file that can be used to reproduce the test as part
&gt; of the distribution.
</div>
Please verify that this is not a bug in the lz4 c code:
  svn checkout <span class="clickylink"><a target="new" rel="nofollow" href="http://lz4.googlecode.com/svn/trunk/">http://lz4.googlecode.com/svn/trunk/</a></span> lz4
  cd lz4
  make
  ./lz4demo64.exe -c $input_file output
  ./lz4demo64.exe -t output
  ./lz4demo64.exe -d roundtrip $input_file
  diff output roundtrip

  ./lz4demo32.exe -c $input_file output
  ./lz4demo32.exe -t output
  ./lz4demo32.exe -d roundtrip $input_file
  diff output roundtrip

If anything above fails, it&#39;s a problem with the c code and you should 
report it to that project. If the above succeeded, then I&#39;m not sure
what the problem is.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047792" href="/Public/Bug/Display.html?id=75624#txn-1047792">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;17:16:35&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047816" href="/Public/Bug/Display.html?id=75624#txn-1047816">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;17:36:43&nbsp;2012</span>
    <span class="description">danielqzinn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> danielqzinn [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75624] decompress&#40;compress&#40;$x&#41;&#41;  does not equal $x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 08 Mar 2012 14:36:31 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Compress-LZ4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Zinn &lt;danielqzinn [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047816/547628/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/547628">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
The LZ4 binary performs a correct round-trip when run on the file
containing the data that fails the roundtrip under Perl &#40;see first block&#41;.

Best,
   Daniel

PS: When compressing the file with the simple attached Perl program
&#40;compress.pl&#41;, then it produces a different compressed string than what
is inside the file the lz4 binary produces &#40;see second block&#41; -- is that
to be expected?

Cheers,
  Daniel

8&lt;-----------------------------------------------------------------------

q@qew:~/tmp/lz4$ cat test.pl
#!/usr/bin/perl
use Compress::LZ4;

my $in = `cat $0`;
my $dest = decompress&#40;compress&#40;$in&#41;&#41;;
print &#34;=&#34; x 80 .&#34;\n&#34; . $in;
print &#34;=&#34; x 80 .&#34;\n&#34; . $dest;
print &#34;=&#34; x 80 . &#34;\n&#34;;
die unless $in eq $dest;
q@qew:~/tmp/lz4$ ./lz4demo64.exe -c test.pl test.pl.compressed
*** Compression CLI using LZ4 algorithm , by Yann Collet &#40;Mar  8 2012&#41; ***
Compressed 199 bytes into 157 bytes ==&gt; 78.89%
Done in 0.00 s ==&gt; inf MB/s
q@qew:~/tmp/lz4$ ./lz4demo64.exe -t test.pl.compressed
*** Compression CLI using LZ4 algorithm , by Yann Collet &#40;Mar  8 2012&#41; ***
Successfully decoded 199 bytes
Done in 0.00 s ==&gt; inf MB/s
q@qew:~/tmp/lz4$ ./lz4demo64.exe -d test.pl.compressed test.pl.roundtrip
*** Compression CLI using LZ4 algorithm , by Yann Collet &#40;Mar  8 2012&#41; ***
Successfully decoded 199 bytes
Done in 0.00 s ==&gt; inf MB/s
q@qew:~/tmp/lz4$ diff test.pl test.pl.roundtrip
q@qew:~/tmp/lz4$

8&lt;-----------------------------------------------------------------------

q@qew:~/tmp/lz4$ ./compress.pl test.pl &gt; test.pl.compressed_Perl
q@qew:~/tmp/lz4$ diff test.pl.compressed test.pl.compressed_Perl
Binary files test.pl.compressed and test.pl.compressed_Perl differ
q@qew:~/tmp/lz4$ ./lz4demo64.exe -t test.pl.compressed_Perl
*** Compression CLI using LZ4 algorithm , by Yann Collet &#40;Mar  8 2012&#41; ***
Unrecognized header : file cannot be decoded
q@qew:~/tmp/lz4$ ls -la test.pl.compressed*
-rw-rw-r-- 1 q q 157 Mar  8 14:27 test.pl.compressed
-rw-rw-r-- 1 q q 168 Mar  8 14:28 test.pl.compressed_Perl


On 03/08/2012 02:16 PM, gray via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75624">https://rt.cpan.org/Ticket/Display.html?id=75624</a></span> &gt;
&gt; 
&gt; On Thu Mar 08 13:58:27 2012, danielqzinn@gmail.com wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; Please find attached an example perl script to reproduce the bug.
&gt;&gt;
&gt;&gt; I am using the current version of Compress::LZ4 from CPAN and the tests
&gt;&gt; that come with it went through fine. More information about my
&gt;&gt; environment is attached.
&gt;&gt;
&gt;&gt; I also attached a .t file that can be used to reproduce the test as part
&gt;&gt; of the distribution.
</div>&gt; 
&gt; Please verify that this is not a bug in the lz4 c code:
&gt;   svn checkout <span class="clickylink"><a target="new" rel="nofollow" href="http://lz4.googlecode.com/svn/trunk/">http://lz4.googlecode.com/svn/trunk/</a></span> lz4
&gt;   cd lz4
&gt;   make
&gt;   ./lz4demo64.exe -c $input_file output
&gt;   ./lz4demo64.exe -t output
&gt;   ./lz4demo64.exe -d roundtrip $input_file
&gt;   diff output roundtrip
&gt; 
&gt;   ./lz4demo32.exe -c $input_file output
&gt;   ./lz4demo32.exe -t output
&gt;   ./lz4demo32.exe -d roundtrip $input_file
&gt;   diff output roundtrip
&gt; 
&gt; If anything above fails, it&#39;s a problem with the c code and you should 
&gt; report it to that project. If the above succeeded, then I&#39;m not sure
&gt; what the problem is.
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047816/547629/compress.pl">Download compress.pl</a><br />
<span class="downloadcontenttype">text/x-perl 111b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047886" href="/Public/Bug/Display.html?id=75624#txn-1047886">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;22:27:24&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047886/547656/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/547656">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 510b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 08 17:36:43 2012, danielqzinn@gmail.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; PS: When compressing the file with the simple attached Perl program
&gt; &#40;compress.pl&#41;, then it produces a different compressed string than what
&gt; is inside the file the lz4 binary produces &#40;see second block&#41; -- is that
&gt; to be expected?
</div>
Yes. The lz4 compression function does not store the length of the
resulting compressed data in the data itself, so the perl interface must
do that, since the decompression must know the size of the original data.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047888" href="/Public/Bug/Display.html?id=75624#txn-1047888">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;22:46:58&nbsp;2012</span>
    <span class="description">danielqzinn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75624] decompress&#40;compress&#40;$x&#41;&#41;  does not equal $x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 08 Mar 2012 19:46:48 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Compress-LZ4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Zinn &lt;danielqzinn [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047888/547658/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/547658">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 323b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes. The lz4 compression function does not store the length of the
&gt; resulting compressed data in the data itself, so the perl interface must
&gt; do that, since the decompression must know the size of the original data.
</div>
Well, then I don&#39;t have an idea of why lz4 works in general, but not
when called via Compress::LZ4.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047957" href="/Public/Bug/Display.html?id=75624#txn-1047957">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;09&nbsp;01:42:21&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047957/547728/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/547728">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 551b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 08 22:46:58 2012, danielqzinn@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Yes. The lz4 compression function does not store the length of the
&gt; &gt; resulting compressed data in the data itself, so the perl interface must
&gt; &gt; do that, since the decompression must know the size of the original
</div></div>data.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Well, then I don&#39;t have an idea of why lz4 works in general, but not
&gt; when called via Compress::LZ4.
</div>
It might be a case of pointer truncation - sizeof&#40;int&#41; != sizeof&#40;void*&#41;.
I&#39;m going to try emulating x86_64 with qemu and see if I can duplicate
the problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1047959" href="/Public/Bug/Display.html?id=75624#txn-1047959">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;09&nbsp;01:47:07&nbsp;2012</span>
    <span class="description">danielqzinn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75624] decompress&#40;compress&#40;$x&#41;&#41;  does not equal $x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 08 Mar 2012 22:46:56 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Compress-LZ4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Zinn &lt;danielqzinn [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1047959/547730/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/547730">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It might be a case of pointer truncation - sizeof&#40;int&#41; != sizeof&#40;void*&#41;.
&gt; I&#39;m going to try emulating x86_64 with qemu and see if I can duplicate
&gt; the problem.
</div>
I can confirm that the bug does not appear on a 32-bit machine.


Cheers,
  daniel

With latest version from CPAN:




q@polaris:~$ uname -a
Linux polaris 2.6.32-2-686-bigmem #1 SMP Thu Feb 11 04:55:32 UTC 2010
i686 GNU/Linux
q@polaris:~$ ./test.pl
================================================================================
#!/usr/bin/perl
use Compress::LZ4;

my $in = `cat $0`;
my $dest = decompress&#40;compress&#40;$in&#41;&#41;;
print &#34;=&#34; x 80 .&#34;\n&#34; . $in;
print &#34;=&#34; x 80 .&#34;\n&#34; . $dest;
print &#34;=&#34; x 80 . &#34;\n&#34;;
die unless $in eq $dest;
================================================================================
#!/usr/bin/perl
use Compress::LZ4;

my $in = `cat $0`;
my $dest = decompress&#40;compress&#40;$in&#41;&#41;;
print &#34;=&#34; x 80 .&#34;\n&#34; . $in;
print &#34;=&#34; x 80 .&#34;\n&#34; . $dest;
print &#34;=&#34; x 80 . &#34;\n&#34;;
die unless $in eq $dest;
================================================================================
q@polaris:~$ perl -v

This is perl 5, version 12, subversion 4 &#40;v5.12.4&#41; built for
i486-linux-gnu-thread-multi-64int
&#40;with 46 registered patches, see perl -V for more detail&#41;

Copyright 1987-2010, Larry Wall

Perl may be copied only under the terms of either the Artistic License
or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using &#34;man perl&#34; or &#34;perldoc perl&#34;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.

q@polaris:~$
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1049129" href="/Public/Bug/Display.html?id=75624#txn-1049129">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;12&nbsp;03:14:44&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1049129/548447/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/548447">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 465b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 09 01:42:21 2012, GRAY wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It might be a case of pointer truncation - sizeof&#40;int&#41; != sizeof&#40;void*&#41;.
&gt; I&#39;m going to try emulating x86_64 with qemu and see if I can duplicate
&gt; the problem.
</div>
I was able to reproduce this bug with VirtualBox, but I can&#39;t narrow
down the cause. Neither the python interface or the plain C interface
exhibited the problem, so it&#39;s definitely on the perl side. But it must
be something really obscure or really obvious...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1049181" href="/Public/Bug/Display.html?id=75624#txn-1049181">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;12&nbsp;03:16:43&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Subject changed from &#39;decompress&#40;compress&#40;$x&#41;&#41;  does not equal  $x&#39; to &#39;x86_64: decompress&#40;compress&#40;$x&#41;&#41; does not equal $x&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1051591" href="/Public/Bug/Display.html?id=75624#txn-1051591">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;18&nbsp;03:17:38&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1051591/549882/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/549882">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 13b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixed in 0.04
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1051593" href="/Public/Bug/Display.html?id=75624#txn-1051593">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;18&nbsp;03:17:39&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1052346" href="/Public/Bug/Display.html?id=75624#txn-1052346">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;20&nbsp;01:42:19&nbsp;2012</span>
    <span class="description">danielqzinn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75624] x86_64: decompress&#40;compress&#40;$x&#41;&#41; does not equal $x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Mar 2012 22:42:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Compress-LZ4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Zinn &lt;danielqzinn [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1052346/550298/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/550298">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 238b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can confirm that the problem is fixed. Thank you! The only &#40;relevant?&#41;
change I see on github is that you removed  src_len from computing the
dest_len. Is it easy to explain what the problem was? And how you fixed it?

Cheers,
  Daniel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1052348" href="/Public/Bug/Display.html?id=75624#txn-1052348">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;20&nbsp;01:42:20&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1052586" href="/Public/Bug/Display.html?id=75624#txn-1052586">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;20&nbsp;11:12:25&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1052586/550434/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/550434">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 491b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 20 01:42:19 2012, danielqzinn@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can confirm that the problem is fixed. Thank you! The only &#40;relevant?&#41;
&gt; change I see on github is that you removed  src_len from computing the
&gt; dest_len. Is it easy to explain what the problem was? And how you
</div>fixed it?

There is an unknown bug somewhere that didn&#39;t like the amalgamated/unity
build method, so I switched to compiling each c file to an object and
linking together. Look in the Makefile.PL if you&#39;re interested.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1052588" href="/Public/Bug/Display.html?id=75624#txn-1052588">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;20&nbsp;11:12:26&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.719608</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
