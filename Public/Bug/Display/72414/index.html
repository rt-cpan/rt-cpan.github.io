<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #72414 for Pod-Markdown: Verbatim paragraphs not preserved if indentation doesn&#39;t match</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #72414 for Pod-Markdown: Verbatim paragraphs not preserved if indentation doesn&#39;t match</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pod-Markdown/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pod-Markdown/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pod-Markdown/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pod-Markdown/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-Markdown">Pod-Markdown CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">72414</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pod-Markdown/Active/">Pod-Markdown</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
RWSTAUNER [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-229566-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.110730    </td>
  </tr>
  <tr id="CF-229567-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;14&nbsp;10:35:55&nbsp;2011</span>
    <span class="description">RWSTAUNER [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Verbatim paragraphs not preserved if indentation doesn&#39;t match</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Markdown uses 4 spaces or a tab for verbatim blocks.

Pod allows any initial whitespace to indicate a verbatim block.

Since I use 2 spaces for all my indentation,
my paragraphs don&#39;t retain their verbatim-ness from pod to markdown.

Attached patch finds the line with the shortest indentation,
determines the minimum required to upgrade to 4,
and prepends that number of spaces to each line.

If you&#39;re not interested in this module anymore I&#39;d be happy to take
comaint on it.  Either way it would be great if we could get the latest
version of the repo on <span class="clickylink"><a target="new" rel="nofollow" href="http://marcel-maint.github.com/">http://marcel-maint.github.com/</a></span>

Thanks for all your great work!
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pod-markdown-verbatim.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Pod/Markdown.pm b/lib/Pod/Markdown.pm
index c58c282..26eb437 100644
--- a/lib/Pod/Markdown.pm
+++ b/lib/Pod/Markdown.pm
@@ -145,6 +145,24 @@ sub command {
 
 sub verbatim {
     my &#40;$parser, $paragraph&#41; = @_;
+
+    # POD verbatim can start with any number of spaces &#40;or tabs&#41;
+    # markdown should be 4 spaces &#40;or a tab&#41;
+    # so indent any paragraphs so that all lines start with at least 4 spaces
+    my @lines = split /\n/, $paragraph;
+    my $indent = &#39; &#39; x 4;
+    foreach my $line &#40; @lines &#41;{
+        next unless $line =~ m/^&#40; +&#41;/;
+        # find the smallest indentation
+        $indent = $1 if length&#40;$1&#41; &lt; length&#40;$indent&#41;;
+    }
+    if&#40; &#40;my $smallest = length&#40;$indent&#41;&#41; &lt; 4 &#41;{
+        # invert to get what needs to be prepended
+        $indent = &#39; &#39; x &#40;4 - $smallest&#41;;
+        # leave tabs alone
+        $paragraph = join &#34;\n&#34;, map { /^\t/ ? $_ : $indent . $_ } @lines;
+    }
+
     $parser-&gt;_save&#40;$paragraph&#41;;
 }
 
diff --git a/t/verbatim.t b/t/verbatim.t
new file mode 100755
index 0000000..08b1449
--- /dev/null
+++ b/t/verbatim.t
@@ -0,0 +1,91 @@
+#!/usr/bin/env perl
+use warnings;
+use strict;
+use Test::More tests =&gt; 1;
+use Test::Differences;
+use Pod::Markdown;
+
+my $parser = Pod::Markdown-&gt;new;
+$parser-&gt;parse_from_filehandle&#40;\*DATA&#41;;
+my $markdown = $parser-&gt;as_markdown;
+my $expect = &lt;&lt;&#39;EOMARKDOWN&#39;;
+# SYNOPSIS
+
+    # 4 spaces
+    # should come out the same
+
+# TABS
+
+	These tabs
+	can be left alone
+
+# 3 SPACES
+
+    3 spaces should be converted to 4.
+    Here, too
+
+And also
+
+    here.
+
+# MIXED &#40;You don&#39;t really want to do that, though, do you?&#41;
+
+Mixed paragraphs should all get the same indentation added
+to preserve the formatting:
+
+      4 spaces &#40;+ 2 = 6&#41;
+	a tab
+     3 spaces &#40;+ 2 = 5&#41;
+    2 spaces &#40;+ 2 = 4&#41; &#40;the minimum&#41;
+
+# 5 spaces
+
+     Because you can
+     if you want to
+
+# THAT&#39;S ENOUGH
+EOMARKDOWN
+
+1 while chomp $markdown;
+1 while chomp $expect;
+
+eq_or_diff $markdown, $expect, &#34;this file&#39;s POD as markdown&#34;;
+
+__DATA__
+=head1 SYNOPSIS
+
+    # 4 spaces
+    # should come out the same
+
+=head1 TABS
+
+	These tabs
+	can be left alone
+
+=head1 3 SPACES
+
+   3 spaces should be converted to 4.
+   Here, too
+
+And also
+
+   here.
+
+=head1 MIXED &#40;You don&#39;t really want to do that, though, do you?&#41;
+
+Mixed paragraphs should all get the same indentation added
+to preserve the formatting:
+
+    4 spaces &#40;+ 2 = 6&#41;
+	a tab
+   3 spaces &#40;+ 2 = 5&#41;
+  2 spaces &#40;+ 2 = 4&#41; &#40;the minimum&#41;
+
+=head1 5 spaces
+
+     Because you can
+     if you want to
+
+=head1 THAT&#39;S ENOUGH
+
+=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other SystemError even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;14&nbsp;10:35:56&nbsp;2011</span>
    <span class="description">The RT System itself -  System error</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sending the previous mail has failed.  Please contact your admin, they can find more details in the logs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other SystemError odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;14&nbsp;10:35:56&nbsp;2011</span>
    <span class="description">The RT System itself -  System error</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sending the previous mail has failed.  Please contact your admin, they can find more details in the logs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;14&nbsp;10:53:05&nbsp;2011</span>
    <span class="description">RWSTAUNER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just commenting on the ticket since the first email failed.

On Mon Nov 14 08:35:55 2011, RWSTAUNER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Markdown uses 4 spaces or a tab for verbatim blocks.
&gt; 
&gt; Pod allows any initial whitespace to indicate a verbatim block.
&gt; 
&gt; Since I use 2 spaces for all my indentation,
&gt; my paragraphs don&#39;t retain their verbatim-ness from pod to markdown.
&gt; 
&gt; Attached patch finds the line with the shortest indentation,
&gt; determines the minimum required to upgrade to 4,
&gt; and prepends that number of spaces to each line.
&gt; 
&gt; If you&#39;re not interested in this module anymore I&#39;d be happy to take
&gt; comaint on it.  Either way it would be great if we could get the latest
&gt; version of the repo on <span class="clickylink"><a target="new" rel="nofollow" href="http://marcel-maint.github.com/">http://marcel-maint.github.com/</a></span>
&gt; 
&gt; Thanks for all your great work!
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;14&nbsp;10:53:06&nbsp;2011</span>
    <span class="description">RWSTAUNER [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;22:42:47&nbsp;2011</span>
    <span class="description">RWSTAUNER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Received comaint.
applied patch.
released.
pushed new repo to github.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;22:42:48&nbsp;2011</span>
    <span class="description">RWSTAUNER [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
