<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #2718 for Mail-GnuPG: verify&#40;&#41; broken, conceptual problem with MIME::Entity</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #2718 for Mail-GnuPG: verify&#40;&#41; broken, conceptual problem with MIME::Entity</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Mail-GnuPG/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Mail-GnuPG/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Mail-GnuPG/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Mail-GnuPG/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-GnuPG">Mail-GnuPG CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">2718</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Mail-GnuPG/Active/">Mail-GnuPG</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
joern [...] zyn.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-19948-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19949-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Mail-GnuPG.mime.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/299223/135613/Mail-GnuPG.mime.patch">
Sun Mar 18 17:10:32 2007 (602b) by ntyni [...] iki.fi
</a>
</font></li>
</ul>


MIME-tools-5.411-store-encoded.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/81949/9885/MIME-tools-5.411-store-encoded.patch">
Sun Jun 22 16:43:35 2003 (6.7k) by &#34;Marc Beyer&#34; &lt;japh [...] tirwhan.org&gt;
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;01&nbsp;18:10:07&nbsp;2003</span>
    <span class="description">joern [...] zyn.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-GnuPG [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> JÃ¶rn Reder &lt;joern [...] zyn.de&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> verify&#40;&#41; broken, conceptual problem with MIME::Entity</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon,  2 Jun 2003 00:09:52 +0200</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hiho,

after some serious debugging trying to find out why some messages can 
not be verified succesfully with Mail::GnuPG, I found a serious 
conceptual problem with the module &#40;it&#39;s not really a bug in 
Mail::GnuPG, but it makes wrong assumptions&#41;.

MIME::Entity stores all data *decoded*, while the sender calculated the
signature on the content-transfer *encoded* data. So when using 
Mail::GnuPG MIME::Parser first decodes the mail, then 
MIME::Entity-&gt;parts&#40;0&#41;-&gt;as_string - called by Mail::GnuPG - gives a 
re-encoded version, but probably with a different result &#40;in particular
with quoted-printable, which is a pretty ambigious encoding&#41;. It&#39;s not 
possible to reconstruct the original representation once the data was 
passed through MIME::Parser, and thus it&#39;s impossible to verify a 
signature reliably when using MIME::Entity as the data model &#40;which is 
pretty comfortable and desirable&#41;.

So I&#39;m currently working on a patch, which enables handling encoded data
with MIME::Parser, MIME::Entity and MIME::Body, which resolves this 
issue.

Regards,

Joern

-- 
LINUX - Linux Is Not gnU linuX
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/81946/9514/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;13&nbsp;02:19:11&nbsp;2003</span>
    <span class="description">rspier [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;13&nbsp;02:19:11&nbsp;2003</span>
    <span class="description">rspier [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I&#39;m currently working on a patch, which enables handling encoded data
&gt; with MIME::Parser, MIME::Entity and MIME::Body, which resolves this 
&gt; issue.
</div>
I really appreciate this.  Thanks for looking into this.  I did a bunch
of testing before I released the initial version, but apparently I
missed many edge cases.  &#40;At some point, I need to add a test suite.&#41;

I&#39;ve release 0.05 with your patches.

Thanks!

-R
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;22&nbsp;16:43:35&nbsp;2003</span>
    <span class="description">JRED [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: verify&#40;&#41; broken, conceptual problem with MIME::Entity</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> joern [...] zyn.de</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[joern@zyn.de - Sun Jun  1 18:10:07 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I&#39;m currently working on a patch, which enables handling encoded data
&gt; with MIME::Parser, MIME::Entity and MIME::Body, which resolves this 
&gt; issue.
</div>
I created this patch and sent it to the maintainer of MIME-tools. He was
not sure, if he accepts it, because it introduces a non-decoded mode,
which changes the semantics signficantly resp. break some parts of the
module &#40;which are not relevant for our problem of making signature
checking possible&#41;.

Anyway I attach the patch here &#40;for MIME-tools 5.411&#41;, because it&#39;s the
only currently known way to make signature checking with Mail::GnuPG work ;&#41;

The patch adds a new method, which tells MIME::Parser to omit decoding:

  $parser-&gt;dont_decode_bodies&#40;1&#41;;

An entity created with this parser can be passed to Mail::GnuPG-&gt;verify.
MIME::Entity-&gt;print_bodyhandle&#40;&#41; gives the original encoded data, but
you can&#39;t get decoded data from such an entity. You have to decode it
yourself, if you need decoded data from it!

Regards,

Joern
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur MIME-tools-5.411.orig/lib/MIME/Body.pm MIME-tools-5.411/lib/MIME/Body.pm
--- MIME-tools-5.411.orig/lib/MIME/Body.pm	2000-11-04 20:54:46.000000000 +0100
+++ MIME-tools-5.411/lib/MIME/Body.pm	2003-06-02 00:37:39.000000000 +0200
@@ -239,6 +239,23 @@
 
 #------------------------------
 
+=item is_encoded [ONOFF]
+
+I&lt;Instance method.&gt;
+If set to yes, no decoding is applied on output. This flag is set
+by MIME::Parser, if the parser runs in dont_decode&#40;1&#41; mode, so the
+content is handled transparent and completely unmodified.
+
+=cut
+
+sub is_encoded {
+    my &#40;$self, $yesno&#41; = @_;
+    $self-&gt;{MB_IsEncoded} = $yesno if &#40;@_ &gt; 1&#41;;
+    $self-&gt;{MB_IsEncoded};
+}
+
+#------------------------------
+
 =item dup
 
 I&lt;Instance method.&gt;
diff -ur MIME-tools-5.411.orig/lib/MIME/Entity.pm MIME-tools-5.411/lib/MIME/Entity.pm
--- MIME-tools-5.411.orig/lib/MIME/Entity.pm	2000-11-06 12:58:53.000000000 +0100
+++ MIME-tools-5.411/lib/MIME/Entity.pm	2003-06-02 00:40:58.000000000 +0200
@@ -1846,14 +1846,21 @@
     my &#40;$self, $out&#41; = @_;
     $out = wraphandle&#40;$out || select&#41;;             ### get a printable output
 
-    ### Get the encoding, defaulting to &#34;binary&#34; if unsupported:
-    my $encoding = &#40;$self-&gt;head-&gt;mime_encoding || &#39;binary&#39;&#41;;
-    my $decoder = best MIME::Decoder $encoding;
-    $decoder-&gt;head&#40;$self-&gt;head&#41;;      ### associate with head, if any
-
     ### Output the body:
     my $IO = $self-&gt;open&#40;&#34;r&#34;&#41;     || die &#34;open body: $!&#34;;
-    $decoder-&gt;encode&#40;$IO, $out&#41;   || return error &#34;encoding failed&#34;;
+    if &#40; $self-&gt;bodyhandle-&gt;is_encoded &#41; {
+      ### Transparent mode: data is already encoded, so no
+      ### need to encode it again
+      my $buf;
+      $out-&gt;print&#40;$buf&#41; while &#40;$IO-&gt;read&#40;$buf, 2048&#41;&#41;;
+    } else {
+      ### Get the encoding, defaulting to &#34;binary&#34; if unsupported:
+      my $encoding = &#40;$self-&gt;head-&gt;mime_encoding || &#39;binary&#39;&#41;;
+      my $decoder = best MIME::Decoder $encoding;
+      $decoder-&gt;head&#40;$self-&gt;head&#41;;      ### associate with head, if any
+      $decoder-&gt;encode&#40;$IO, $out&#41;   || return error &#34;encoding failed&#34;;
+    }
+ 
     $IO-&gt;close;
     1;
 }
diff -ur MIME-tools-5.411.orig/lib/MIME/Parser.pm MIME-tools-5.411/lib/MIME/Parser.pm
--- MIME-tools-5.411.orig/lib/MIME/Parser.pm	2000-11-12 06:55:11.000000000 +0100
+++ MIME-tools-5.411/lib/MIME/Parser.pm	2003-06-02 23:20:19.000000000 +0200
@@ -471,8 +471,37 @@
 }
 
 
+#------------------------------
+
+=item dont_decode_bodies [YESNO]
+
+I&lt;Instance method.&gt;
+Controls whether the parser should decode entity bodies or not.
+If this is set to a true value &#40;default is false&#41;, all entity bodies
+will be kept as-is in the original content-transfer encoding.
+
+To prevent double encoding on the output side MIME::Body-&gt;is_encoded
+is set, which tells MIME::Body not to encode the data agin, if encoded
+data is requested. This is in particular useful, when it&#39;s importat that
+the content B&lt;must not&gt; be modified, e.g. if you want to calculate
+OpenPGP signatures from it.
+
+B&lt;WARNING&gt;: the semantics change significantly if you parse MIME
+messages with this option set, because MIME::Entity resp. MIME::Body
+*always* see encoded data now, while the default behaviour is
+working with *decoded* data &#40;and encoding it only if you request it&#41;.
+You need to decode the data yourself, if you want to have it decoded.
+
+So use this option only if you exactly know, what you&#39;re doing, and
+that you&#39;re sure, that you really need it ;&#41;
 
+=cut
 
+sub dont_decode_bodies {
+    my &#40;$self, $yesno&#41; = @_;
+    $self-&gt;{MP5_DontDecodeBodies} = $yesno if &#40;@_ &gt; 1&#41;;
+    $self-&gt;{MP5_DontDecodeBodies};
+}
 
 #------------------------------
 #
@@ -781,6 +810,10 @@
 	$ENCODED-&gt;seek&#40;0, 0&#41;;
     }
 
+    ### Open a new bodyhandle for outputting the data:
+    my $body = $self-&gt;new_body_for&#40;$head&#41; || die &#34;$ME: no body\n&#34;; # gotta die
+    $body-&gt;binmode&#40;1&#41; unless textual_type&#40;$ent-&gt;effective_type&#41;;
+
     ### Get a content-decoder to decode this part&#39;s encoding:
     my $encoding = $head-&gt;mime_encoding;
     my $decoder = new MIME::Decoder $encoding;
@@ -790,41 +823,52 @@
 		     &#34;application/octet-stream.&#34;&#41;;  ### as per RFC-2045
 	$ent-&gt;effective_type&#40;&#39;application/octet-stream&#39;&#41;;
 	$decoder = new MIME::Decoder &#39;binary&#39;;
+	$encoding = &#39;binary&#39;;
     }
 
-    ### If desired, sidetrack to troll for UUENCODE:
-    $self-&gt;debug&#40;&#34;extract uuencode? &#34;, $self-&gt;extract_uuencode&#41;;
-    $self-&gt;debug&#40;&#34;encoding?         &#34;, $encoding&#41;;
-    $self-&gt;debug&#40;&#34;effective type?   &#34;, $ent-&gt;effective_type&#41;;
-    if &#40;$self-&gt;extract_uuencode and
-	&#40;$encoding =~ /^&#40;7bit|8bit|binary&#41;\Z/&#41; and
-	&#40;$ent-&gt;effective_type =~ m{^text/plain\Z}&#41;&#41; {
-	
-	### Hunt for it:
-	my $uu_ent = eval { $self-&gt;hunt_for_uuencode&#40;$ENCODED, $ent&#41; };
-	if &#40;$uu_ent&#41; {   ### snark
-	    %$ent = %$uu_ent;
-	    return 1;
-	}	
-	else {           ### boojum
-	    $self-&gt;whine&#40;&#34;while hunting for uuencode: $@&#34;&#41;;
-	    $ENCODED-&gt;seek&#40;0,0&#41;;
-	}
+    ### Data should be stored decoded?
+    if &#40; !$self-&gt;dont_decode_bodies &#41; {
+
+      ### If desired, sidetrack to troll for UUENCODE:
+      $self-&gt;debug&#40;&#34;extract uuencode? &#34;, $self-&gt;extract_uuencode&#41;;
+      $self-&gt;debug&#40;&#34;encoding?         &#34;, $encoding&#41;;
+      $self-&gt;debug&#40;&#34;effective type?   &#34;, $ent-&gt;effective_type&#41;;
+      if &#40;$self-&gt;extract_uuencode and
+	  &#40;$encoding =~ /^&#40;7bit|8bit|binary&#41;\Z/&#41; and
+	  &#40;$ent-&gt;effective_type =~ m{^text/plain\Z}&#41;&#41; {
+
+	  ### Hunt for it:
+	  my $uu_ent = eval { $self-&gt;hunt_for_uuencode&#40;$ENCODED, $ent&#41; };
+	  if &#40;$uu_ent&#41; {   ### snark
+	      %$ent = %$uu_ent;
+	      return 1;
+	  }	
+	  else {           ### boojum
+	      $self-&gt;whine&#40;&#34;while hunting for uuencode: $@&#34;&#41;;
+	      $ENCODED-&gt;seek&#40;0,0&#41;;
+	  }
+      }
+
+      ### Decode and save the body &#40;using the decoder&#41;:
+      my $DECODED = $body-&gt;open&#40;&#34;w&#34;&#41; || die &#34;$ME: body not opened: $!\n&#34;; 
+
+      my $bm = benchmark {
+	  eval { $decoder-&gt;decode&#40;$ENCODED, $DECODED&#41;; }; 
+	  $@ and $self-&gt;error&#40;$@&#41;;
+      };
+      $self-&gt;debug&#40;&#34;t decode: $bm&#34;&#41;;
+
+      $DECODED-&gt;close;
+
+    } else {
+      ### No decoding, copy the data as is into the body object
+      my $HANDLE = $body-&gt;open&#40;&#34;w&#34;&#41; || die &#34;$ME: body not opened: $!\n&#34;; 
+      my $buf;
+      $HANDLE-&gt;print&#40;$buf&#41; while &#40;$ENCODED-&gt;read&#40;$buf, 2048&#41;&#41;;
+      $HANDLE-&gt;close;
+      $body-&gt;is_encoded&#40;1&#41;;
     }
-    
-    ### Open a new bodyhandle for outputting the data:
-    my $body = $self-&gt;new_body_for&#40;$head&#41; || die &#34;$ME: no body\n&#34;; # gotta die
-    $body-&gt;binmode&#40;1&#41; unless textual_type&#40;$ent-&gt;effective_type&#41;;
 
-    ### Decode and save the body &#40;using the decoder&#41;:
-    my $DECODED = $body-&gt;open&#40;&#34;w&#34;&#41; || die &#34;$ME: body not opened: $!\n&#34;; 
-    my $bm = benchmark {
-	eval { $decoder-&gt;decode&#40;$ENCODED, $DECODED&#41;; }; 
-	$@ and $self-&gt;error&#40;$@&#41;;
-    };
-    $self-&gt;debug&#40;&#34;t decode: $bm&#34;&#41;;
-    $DECODED-&gt;close;
-    
     ### Success!  Remember where we put stuff:
     $ent-&gt;bodyhandle&#40;$body&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;18&nbsp;17:10:31&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ntyni [...] iki.fi</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jun 22 16:43:35 2003, JRED wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [joern@zyn.de - Sun Jun  1 18:10:07 2003]:
&gt; 
<div class="message-stanza open">&gt; &gt; So I&#39;m currently working on a patch, which enables handling encoded data
&gt; &gt; with MIME::Parser, MIME::Entity and MIME::Body, which resolves this 
&gt; &gt; issue.
</div>&gt; 
&gt; I created this patch and sent it to the maintainer of MIME-tools. He was
&gt; not sure, if he accepts it, because it introduces a non-decoded mode,
&gt; which changes the semantics signficantly resp. break some parts of the
&gt; module &#40;which are not relevant for our problem of making signature
&gt; checking possible&#41;.
</div>
Hi,

as a heads-up, this patch &#40;or something equivalent&#41; was included in
MIME-tools 5.419, and verifying MIME-encoded messages with Mail::GnuPG
is now working.

For your convenience, I&#39;m attaching a suggested modification to the
Mail::GnuPG documentation to recommended this.

Cheers,
-- 
Niko Tyni
ntyni@iki.fi
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- libmail-gnupg-perl-0.08.orig/GnuPG.pm
+++ libmail-gnupg-perl-0.08/GnuPG.pm
@@ -338,6 +338,12 @@
   The message can either be in RFC compliant-ish multipart/signed
   format, or just a single part ascii armored message.
 
+  Note that MIME-encoded data should be supplied unmodified inside
+  the MIME::Entity input message, otherwise the signature will be 
+  broken. Since MIME-tools version 5.419, this can be achieved with
+  the C&lt;decode_bodies&gt; method of MIME::Parser. See the MIME::Parser
+  documentation for more information.
+
  Output:
   On error:
     Exit code of gpg.  &#40;0 on success&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;05&nbsp;20:31:00&nbsp;2008</span>
    <span class="description">RUZ [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;13&nbsp;21:36:35&nbsp;2010</span>
    <span class="description">DDB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think we&#39;ve done the best we can here; people need to use
decode_bodies&#40;0&#41; option provided by recent versions of MIME::Parser.

Feel free to re-open if you think there is more Mail::GnuPG can/should
do here.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;13&nbsp;21:36:35&nbsp;2010</span>
    <span class="description">DDB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;14&nbsp;15:30:59&nbsp;2010</span>
    <span class="description">DDB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 13 21:36:35 2010, DDB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think we&#39;ve done the best we can here; people need to use
&gt; decode_bodies&#40;0&#41; option provided by recent versions of MIME::Parser.
&gt; 
&gt; Feel free to re-open if you think there is more Mail::GnuPG can/should
&gt; do here.
</div>
Oops. My bad for checking the docs on Debian. It turns out this patch is
not applied yet.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;14&nbsp;15:30:59&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
