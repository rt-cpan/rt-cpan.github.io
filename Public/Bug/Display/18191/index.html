<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #18191 for Pod-DocBook: Patch &#40;1.2&#41;: Correction of =for blocks; Optional title tags</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #18191 for Pod-DocBook: Patch &#40;1.2&#41;: Correction of =for blocks; Optional title tags</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pod-DocBook/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pod-DocBook/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pod-DocBook/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pod-DocBook/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-DocBook">Pod-DocBook CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">18191</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pod-DocBook/Active/">Pod-DocBook</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
PJF [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-26064-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.2    </td>
  </tr>
  <tr id="CF-26065-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;15&nbsp;22:37:57&nbsp;2006</span>
    <span class="description">PJF [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch &#40;1.2&#41;: Correction of =for blocks; Optional title tags</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The following are two e-mails sent to Nandu late last year, and a patch
against Pod-Docbook-1.2 &#40;including documentation and tests&#41; that
corrects the issues discussed.

*** Handling of &#39;=for Docbook&#39; sections ***

G&#39;day Nandu,

Thank-you for the most excellent Pod::DocBook module. It&#39;s saved me
hours of time in wrestling with docbook syntax.  However, I have found
one very small problem in processing.

When processing &#39;=for docbook&#39; constructs, Pod::DocBook will escape SGML
entries before emitting them.  As such, code such as:

        =for docbook &lt;emphasis&gt;This is important&lt;/emphasis&gt;

will be emitted as:

        &#38;lt;emphasis&#38;gt;This is important&#38;lt;emphasis&#38;gt;

This differs from the &#39;=begin docbook&#39; blocks and the current
documentation, which states that for blocks should pass the text through
without modification.

Luckily this solution is easily fixed by having Pod::DocBook look for
&#39;=for&#39; sections before escaping the text.  I&#39;ve attached a unified diff
against Pod::DocBook 1.2 &#40;as found on CPAN&#41; that provides both a test
that demonstrates the problem, and a patch to Pod/DocBook.pm that fixes
it.  Feedback and comments are appreciated.

Once again, thank-you for a fantastic module.

All the very best,

        Paul

*** Supressing title generation ***

G&#39;day Nandu,

I&#39;m writing chapters in POD files that will be converted into DocBook
using make, however I don&#39;t want the title of each chapter to be the
filename, instead I want to embed it into the POD.  Using Pod::DocBook
this should be easy:

        =for docbook &lt;title&gt;My Chapter Title&lt;/title&gt;

However, Pod::DocBook always wishes to emit its own title tags, even if
the title is an empty string.  That means I end up with two titles in
the output, which makes DocBook sad.

The good news is that it was easy to change Pod::DocBook to not emit any
title if an empty title is found.  I&#39;ve attached a patch that includes
these changes as well as the contents of my previous patch that fixes
for block, as well as tests and documentation updates.

Note that we simply test for truth when determining if we should print a
title.  This allows pod2docbook to be called with a &#39;--title=0&#39; option
to indicate that no title should be used.

Any feedback, criticism, or comments are appreciated.

All the very best,

        Paul

-- 
Paul Fenwick &lt;pjf@perltraining.com.au&gt; | <span class="clickylink"><a target="new" rel="nofollow" href="http://perltraining.com.au/">http://perltraining.com.au/</a></span>
Director of Training                   | Ph:  +61 3 9354 6001
Perl Training Australia                | Fax: +61 3 9354 2681
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pod-docbook-for-title.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: pod2docbook
===================================================================
RCS file: /var/cvs/pod-docbook/pod2docbook,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -r1.1.1.1 -r1.2
--- pod2docbook	28 Sep 2005 01:54:19 -0000	1.1.1.1
+++ pod2docbook	28 Sep 2005 02:36:29 -0000	1.2
@@ -88,7 +88,9 @@
 =item [B&lt;--title&gt;=I&lt;title&gt;]
 
 Specifies the document title.  The default is I&lt;infile&gt;, if it is
-supplied, or empty string otherwise.
+supplied, or empty string otherwise.  If the special title of
+C&lt;0&gt; or the empty string is supplied, then title tags will not
+be generated by pod2docbook.
 
 =item [B&lt;--spaces&gt;=I&lt;# spaces per indent level&gt;]
 
Index: lib/Pod/DocBook.pm
===================================================================
RCS file: /var/cvs/pod-docbook/lib/Pod/DocBook.pm,v
retrieving revision 1.1.1.1
retrieving revision 1.4
diff -u -r1.1.1.1 -r1.4
--- lib/Pod/DocBook.pm	28 Sep 2005 01:54:19 -0000	1.1.1.1
+++ lib/Pod/DocBook.pm	28 Sep 2005 02:36:29 -0000	1.4
@@ -56,7 +56,10 @@
     }
 
     else {
-	print $out_fh &#34;&lt;$parser-&gt;{doctype}&gt;&lt;title&gt;$parser-&gt;{title}&lt;/title&gt;\n&#34;;
+    	print $out_fh &#34;&lt;$parser-&gt;{doctype}&gt;&#34;;
+	if &#40;$parser-&gt;{title}&#41; {
+		print $out_fh &#34;&lt;title&gt;$parser-&gt;{title}&lt;/title&gt;\n&#34;;
+	}
     }
 }
 
@@ -89,6 +92,22 @@
 
     $paragraph =~ s/\s+$//s;
     $paragraph = $parser-&gt;interpolate &#40;$paragraph, $line_num&#41;;
+
+    # For blocks must be considered before we escape entries, otherwise
+    # docbook markup will get mangled.
+
+    if &#40;$command eq &#39;for&#39;&#41; {
+	$parser-&gt;_transition &#40;&#39;for&#39;&#41;;
+	if &#40;$paragraph =~ /^&#40;:\S+|docbook&#41;/&#41; {
+	    $paragraph =~ s/$1\s+//;
+	    print $out_fh $paragraph, &#34;\n&#34;;
+	    return;
+	}
+    }
+
+    # Now escape SGML-escape our text, and figure out what to do
+    # with it.
+
     $paragraph = _fix_chars &#40;$paragraph&#41;;
 
     if &#40;$command =~ /^head[1-4]/&#41; {
@@ -105,14 +124,6 @@
 	$parser-&gt;_transition &#40;&#34;end $paragraph&#34;&#41;;
     }
 
-    elsif &#40;$command eq &#39;for&#39;&#41; {
-	$parser-&gt;_transition &#40;&#39;for&#39;&#41;;
-	if &#40;$paragraph =~ /^&#40;:\S+|docbook&#41;/&#41; {
-	    $paragraph =~ s/$1\s+//;
-	    print $out_fh $paragraph, &#34;\n&#34;;
-	}
-    }
-
     elsif &#40;$command eq &#39;over&#39;&#41; {
 	$parser-&gt;_transition &#40;&#39;over&#39;&#41;;
 	push @{$parser-&gt;{&#39;Pod::DocBook::state&#39;}}, &#39;over&#39;;
@@ -1109,7 +1120,8 @@
 
 =item title
 
-This option sets the output document&#39;s title.
+This option sets the output document&#39;s title.  If set to a false
+value then no title will be generated in the output.
 
 =back
 
Index: t/Pod-DocBook.t
===================================================================
RCS file: /var/cvs/pod-docbook/t/Pod-DocBook.t,v
retrieving revision 1.1.1.1
retrieving revision 1.3
diff -u -r1.1.1.1 -r1.3
--- t/Pod-DocBook.t	28 Sep 2005 01:54:19 -0000	1.1.1.1
+++ t/Pod-DocBook.t	28 Sep 2005 02:32:39 -0000	1.3
@@ -5,7 +5,7 @@
 use warnings;
 
 use Test;
-BEGIN { plan tests =&gt; 18 };
+BEGIN { plan tests =&gt; 20 };
 
 use Pod::DocBook;
 ok 1;
@@ -16,7 +16,7 @@
 
 my @samples = qw&#40;head paragraphs indent lists docbook table formatting_codes
 		 e_command e_nested_fc e_unknown_fc e_empty_l e_escape
-		 e_item e_mismatched_end e_no_end e_colspec&#41;;
+		 e_item e_mismatched_end e_no_end e_colspec for&#41;;
 
 foreach my $name &#40;@samples&#41; {
     my $parser = Pod::DocBook-&gt;new &#40;doctype           =&gt; &#39;section&#39;,
@@ -47,6 +47,20 @@
     &#34;t/test-no_header.out differs from t/no_header.sgml&#34;&#41; &#38;&#38;
   unlink &#34;t/test-no_header.out&#34;;
 
+#-----------------------------------------------------------------------
+# test no-title options
+#-----------------------------------------------------------------------
+
+Pod::DocBook-&gt;new &#40;doctype           =&gt; &#39;chapter&#39;,
+		   title             =&gt; &#34;&#34;,
+		   fix_double_quotes =&gt; 1,
+		   header            =&gt; 0,
+		   spaces            =&gt; 2&#41;
+            -&gt;parse_from_file &#40;&#34;t/no_title.pod&#34;, &#34;t/test-no_title.out&#34;&#41;;
+
+ok &#40;check &#40;&#34;t/no_title.sgml&#34;, &#34;t/test-no_title.out&#34;&#41;, 1,
+    &#34;t/test-no_title.out differs from t/no_title.sgml&#34;&#41; &#38;&#38;
+  unlink &#34;t/test-no_title.out&#34;;
 
 sub check
 {
Index: t/for.pod
===================================================================
RCS file: t/for.pod
diff -N t/for.pod
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ t/for.pod	28 Sep 2005 02:05:00 -0000	1.1
@@ -0,0 +1 @@
+=for docbook &lt;emphasis&gt;This is important.&lt;/emphasis&gt;
Index: t/for.sgml
===================================================================
RCS file: t/for.sgml
diff -N t/for.sgml
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ t/for.sgml	28 Sep 2005 02:05:00 -0000	1.1
@@ -0,0 +1,12 @@
+&lt;!DOCTYPE section PUBLIC &#34;-//OASIS//DTD DocBook V4.2//EN&#34;&gt;
+&lt;!--
+     Generated by Pod::DocBook v1.2, using:
+       Digest::MD5 v2.13
+       Pod::Parser v1.13
+       Pod::ParseLink v1.05
+       Text::ParseWords v3.2
+       Text::Wrap v2001.0131
+--&gt;
+&lt;section&gt;&lt;title&gt;for.pod&lt;/title&gt;
+&lt;emphasis&gt;This is important.&lt;/emphasis&gt;
+&lt;/section&gt;
Index: t/no_title.pod
===================================================================
RCS file: t/no_title.pod
diff -N t/no_title.pod
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ t/no_title.pod	28 Sep 2005 02:32:39 -0000	1.1
@@ -0,0 +1,8 @@
+=for docbook &lt;title&gt;An example chapter&lt;/title&gt;
+
+=head1 Once upon a time...
+
+Once upon a time there was a module named Pod::DocBook, it had
+many great adventures and lived happily ever after.
+
+The end.
Index: t/no_title.sgml
===================================================================
RCS file: t/no_title.sgml
diff -N t/no_title.sgml
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ t/no_title.sgml	28 Sep 2005 02:32:39 -0000	1.1
@@ -0,0 +1,19 @@
+&lt;!--
+     Generated by Pod::DocBook v1.2, using:
+       Digest::MD5 v2.13
+       Pod::Parser v1.13
+       Pod::ParseLink v1.05
+       Text::ParseWords v3.2
+       Text::Wrap v2001.0131
+--&gt;
+&lt;chapter&gt;&lt;title&gt;An example chapter&lt;/title&gt;
+  &lt;section id=&#34;ID-ac42dda70ff06e57d9f33c7395669b50&#34;&gt;&lt;title&gt;Once upon a time...&lt;/title&gt;
+    &lt;para&gt;
+      Once upon a time there was a module named Pod::DocBook, it had many
+      great adventures and lived happily ever after.
+    &lt;/para&gt;
+    &lt;para&gt;
+      The end.
+    &lt;/para&gt;
+  &lt;/section&gt;
+&lt;/chapter&gt;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;16&nbsp;02:56:06&nbsp;2006</span>
    <span class="description">PJF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Supplying --title=0 to supress the generation of titles works a treat. 
However, it has an influence on the _make_id&#40;&#41; subroutine which uses
titles to generate &#40;semi-&#41;unique identifiers.

In particular, if --title=0 then all generated pages are considered to
have the _same_ title, meaning that different chapters can end up
producing the same IDs for identically named sections, even though they
should be unique.

I&#39;ve got a patch for this, but it makes me consider that the --title=0
patch may be better implmented by using a separate flag to control the
emitting of titles.  If anyone wants the patch, get in contact with me
directly.

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.modules/50273">http://www.nntp.perl.org/group/perl.modules/50273</a></span> should also be read in
relation to these patches and other patches submitted by me against
Pod::DocBook
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;16&nbsp;02:56:08&nbsp;2006</span>
    <span class="description">PJF [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
