<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #87906 for Perl-Dist-Strawberry: pthreads header problem and Inline::C</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #87906 for Perl-Dist-Strawberry: pthreads header problem and Inline::C</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Perl-Dist-Strawberry">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Perl-Dist-Strawberry">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Perl-Dist-Strawberry">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Perl-Dist-Strawberry">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Dist-Strawberry">Perl-Dist-Strawberry CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">87906</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Perl-Dist-Strawberry">Perl-Dist-Strawberry</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
david.jacobowitz [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
sisyphus1 [...] optusnet.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40214-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40215-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




fails.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1250167/661435/fails.pl">
Fri Aug 16 16:59:15 2013 (844b) by david.jacobowitz [...] gmail.com
</a>
</font></li>
</ul>


works.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1250167/661436/works.pl">
Fri Aug 16 16:59:15 2013 (903b) by david.jacobowitz [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=87906">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1250167" href="/Public/Bug/Display.html?id=87906#txn-1250167">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;16&nbsp;16:59:15&nbsp;2013</span>
    <span class="description">david.jacobowitz [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pthreads header problem and Inline::C</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 Aug 2013 13:58:57 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-perl-dist-strawberry [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Jacobowitz &lt;david.jacobowitz [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1250167/661433/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/661433">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve been trying to build a project that uses Strawberry Perl, Inline::C
and pthreads and ran into some problems compiling on my system on Win32.
&#40;It works fine in Ubuntu&#41;

In particular, it looks like some header file somewhere &#40;I have still to
determine which despite grepping through all the obvious places&#41; does
something along the lines of:

#define PTHREAD_CREATE_JOINABLE 0

but in the pthreads.h in the distribution, there is an enum like this:

enum {
 PTHREAD_CREATE_JOINABLE = 0,
 ...
}

Well, when the preprocessor runs it replaces the macro with 0, and you get

enum { 0 = 0, ... }


on which the compiler of course barfs.


I initially tried solving the problem by putting

undef PTHREAD_CREATE_JOINABLE before I include &lt;pthread.h&gt;. That fixed the
compilation but using threads resulted in segaults.

So now I have
#define PTHREAD_CREATE_JOINABLE PTHREAD_CREATE_JOINABLE

This makes the enum in pthread.h happy and anyone expecting the macro gets
the enum value, which is the same and is also happy.

So far all is working, but who know if this is a correct solution. I spent
a long time not able to figure out the source of these segfaults. Bug is
present in at least 5.16 and 5.18 that I tried.

perl --version:

This is perl 5, version 16, subversion 3 &#40;v5.16.3&#41; built for
MSWin32-x86-multi-thread

OS is Windows 7 32b. gnuwin32 &#34;uname -a&#34; reports:

windows32 DAVIDJ-LT0362 2.6.1 7601 i686-pc Intel unknown MinG


I have attached a working and non-working example perl scripts.
fail.plwill not compile.
work.pl will print messages until stopped.


Regards,
Dave Jacobowitz


PS

A few feature requests:

- package a gdb with SP
- offer an SP built with debugging enabled
- make it so gdb can debug the dlls created by the Inline modules. Adding
-g to Inline =&gt; Config =&gt; CCFLAGS doesn&#39;t do it.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1250167/661434/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/661434">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.5k</span>
</div>
<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1250167/661435/fails.pl">Download fails.pl</a><br />
<span class="downloadcontenttype">text/x-perl 844b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1250167/661436/works.pl">Download works.pl</a><br />
<span class="downloadcontenttype">text/x-perl 903b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293155" href="/Public/Bug/Display.html?id=87906#txn-1293155">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;24&nbsp;17:01:37&nbsp;2013</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1293155/685205/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685205">with headers</a>
<br />
<span class="downloadcontenttype">text/html 524b</span>
</div>
<div class="messagebody">
<div class="message-stanza">I am afraid that trouble is in perl/lib/CORE/threads.h section:<br>

<br>

#ifndef PTHREAD_CREATE_JOINABLE<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">#&nbsp; ifdef OLD_PTHREAD_CREATE_JOINABLE<br>

#&nbsp;&nbsp;&nbsp; define PTHREAD_CREATE_JOINABLE OLD_PTHREAD_CREATE_JOINABLE<br>

#&nbsp; else<br>

#&nbsp;&nbsp;&nbsp; define PTHREAD_CREATE_JOINABLE 0 /* Panic?&nbsp; No, guess. */<br>

#&nbsp; endif<br>
</div>#endif<br>

<br>

If my guess is correct it is more related to perl core than strawberry perl specifically<br>

<br>

--<br>

kmx<br>

<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293156" href="/Public/Bug/Display.html?id=87906#txn-1293156">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;24&nbsp;17:01:37&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293165" href="/Public/Bug/Display.html?id=87906#txn-1293165">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;24&nbsp;17:15:37&nbsp;2013</span>
    <span class="description">kmx [...] cpan.org -  Cc sisyphus1@optusnet.com.au added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293168" href="/Public/Bug/Display.html?id=87906#txn-1293168">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;24&nbsp;17:19:32&nbsp;2013</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1293168/685211/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685211">with headers</a>
<br />
<span class="downloadcontenttype">text/html 164b</span>
</div>
<div class="messagebody">
<div class="message-stanza">I have put into Cc: <span>Sisyphus </span>- the author of Inline::C + AFAIK occasional Strawberry Perl user - he might have a better comment on this issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293195" href="/Public/Bug/Display.html?id=87906#txn-1293195">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;24&nbsp;19:39:14&nbsp;2013</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87906] pthreads header problem and Inline::C</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Nov 2013 11:38:34 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Perl-Dist-Strawberry [...] rt.cpan.org&gt;, &lt;david.jacobowitz [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1293195/685222/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685222">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: kmx via RT
Sent: Monday, November 25, 2013 9:19 AM
To: david.jacobowitz@gmail.com
Cc: sisyphus1@optusnet.com.au
Subject: [rt.cpan.org #87906] pthreads header problem and Inline::C

<div class="message-stanza open">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87906">https://rt.cpan.org/Ticket/Display.html?id=87906</a></span> &gt;
&gt;
&gt; I have put into Cc: Sisyphus - the author of Inline::C + AFAIK occasional
&gt; Strawberry Perl user - he might have a better comment on this issue.
</div>
I don&#39;t have a lot to offer here.
I&#39;m quite sure that kmx has nailed the source of the problem, and one has
only to &#34;#include &lt;pthread.h&gt;&#34; in any Inline::C script &#40;on Windows&#41; to 
strike the error
that David encountered.

I don&#39;t have much experience with pthreads, but I regularly build PDL with
pthreads on Windows, and it works fine.

In the PDL source, they simply do &#40;as David tried&#41;:

#ifdef PTHREAD_CREATE_JOINABLE
#undef  PTHREAD_CREATE_JOINABLE
#endif
#include &lt;pthread.h&gt;

and the comments accompanying that code explain that&#39;s done simply to work
around the problem with CORE/lib/thread.h on Windows. &#40;I don&#39;t know why that
hasn&#39;t worked for David .... something from elsewhere in his code perhaps ?&#41;

The comments also explain that this workaround is only needed for Windows -
the *nix implementations of pthread.h generally use macros instead of enum
to set PTHREAD_CREATE_JOINABLE to 0, so there&#39;s no such problem there.

Thanks for cc&#39;ing, kmx.

As an afterthought, it seems odd that the &#34;#undef PTHREAD_CREATE_JOINABLE&#34; 
failed, but &#34;#define PTHREAD_CREATE_JOINABLE  PTHREAD_CREATE_JOINABLE&#34; 
worked. In this simplistic Inline::C script it makes no difference &#40;apart 
from a re-definition warning during compilation&#41; which construct you use:

#############################
use warnings;
use strict;

use Inline C =&gt; Config =&gt;
  BUILD_NOISY =&gt; 1;

use Inline C =&gt; &lt;&lt;&#39;EOC&#39;;

#undef PTHREAD_CREATE_JOINABLE
/* #define PTHREAD_CREATE_JOINABLE PTHREAD_CREATE_JOINABLE */

#include &lt;pthread.h&gt;

void foo&#40;&#41; {
  printf&#40;&#34;%d\n&#34;, PTHREAD_CREATE_JOINABLE&#41;;
}

EOC

foo&#40;&#41;;
#############################

Cheers,
Rob 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293453" href="/Public/Bug/Display.html?id=87906#txn-1293453">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;25&nbsp;09:41:51&nbsp;2013</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1293453/685376/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685376">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Nov 24 19:39:14 2013, sisyphus1@optusnet.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; -----Original Message----- 
&gt; From: kmx via RT
&gt; Sent: Monday, November 25, 2013 9:19 AM
&gt; To: david.jacobowitz@gmail.com
&gt; Cc: sisyphus1@optusnet.com.au
&gt; Subject: [rt.cpan.org #87906] pthreads header problem and Inline::C
&gt; 
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87906">https://rt.cpan.org/Ticket/Display.html?id=87906</a></span> &gt;
&gt; &gt;
&gt; &gt; I have put into Cc: Sisyphus - the author of Inline::C + AFAIK occasional
&gt; &gt; Strawberry Perl user - he might have a better comment on this issue.
</div></div>
Sorry - when I wrote my reply I didn&#39;t realise that Dave had provided sample scripts. The &#34;works.pl&#34; works fine for me, as expected.
I&#39;ve also grabbed &#34;fails.pl&#34; and inserted the &#34;#undef PTHREAD_CREATE_JOINABLE&#34; immediately before the inclusion of pthread.h.
That script &#40;ie &#34;fails.h&#34;&#41; then runs fine for me ... no segfaults at all !!

Admittedly I don&#39;t have the exact same version of Strawberry as Dave was running. I tried on Strawberry Perls &#40;portable&#41; 5.16.0, and 5.18.0. I also tried it on a mingw.org compiler-built 5.16.0 - again no problems.

Seems odd.
kmx, did you try running &#34;fails.h&#34; &#40;amended as per above&#41; on any of your Strawberry Perl installations ?

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293491" href="/Public/Bug/Display.html?id=87906#txn-1293491">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;25&nbsp;10:19:36&nbsp;2013</span>
    <span class="description">david.jacobowitz [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Sisyphus &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87906] pthreads header problem and Inline::C</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Nov 2013 07:19:16 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Dist-Strawberry [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Jacobowitz &lt;david.jacobowitz [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1293491/685399/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685399">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi guys,

I may have to provide a more complex script to show the problem with the
&#39;undef&#39; solution. I&#39;ll try to get to it today. My project is largish has
five threads, so I&#39;ll have to cut it down for the bug. I should have
submitted something that shows the undef problem in the first place. My bad.


-- dave j



On Mon, Nov 25, 2013 at 6:41 AM, Sisyphus via RT &lt;
bug-Perl-Dist-Strawberry@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87906">https://rt.cpan.org/Ticket/Display.html?id=87906</a></span> &gt;
&gt;
&gt; On Sun Nov 24 19:39:14 2013, sisyphus1@optusnet.com.au wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt; From: kmx via RT
&gt; &gt; Sent: Monday, November 25, 2013 9:19 AM
&gt; &gt; To: david.jacobowitz@gmail.com
&gt; &gt; Cc: sisyphus1@optusnet.com.au
&gt; &gt; Subject: [rt.cpan.org #87906] pthreads header problem and Inline::C
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87906">https://rt.cpan.org/Ticket/Display.html?id=87906</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; I have put into Cc: Sisyphus - the author of Inline::C + AFAIK
</div></div>&gt; occasional
<div class="message-stanza open">&gt; &gt; &gt; Strawberry Perl user - he might have a better comment on this issue.
</div>&gt;
&gt; Sorry - when I wrote my reply I didn&#39;t realise that Dave had provided
&gt; sample scripts. The &#34;works.pl&#34; works fine for me, as expected.
&gt; I&#39;ve also grabbed &#34;fails.pl&#34; and inserted the &#34;#undef
&gt; PTHREAD_CREATE_JOINABLE&#34; immediately before the inclusion of pthread.h.
&gt; That script &#40;ie &#34;fails.h&#34;&#41; then runs fine for me ... no segfaults at all !!
&gt;
&gt; Admittedly I don&#39;t have the exact same version of Strawberry as Dave was
&gt; running. I tried on Strawberry Perls &#40;portable&#41; 5.16.0, and 5.18.0. I also
&gt; tried it on a mingw.org compiler-built 5.16.0 - again no problems.
&gt;
&gt; Seems odd.
&gt; kmx, did you try running &#34;fails.h&#34; &#40;amended as per above&#41; on any of your
&gt; Strawberry Perl installations ?
&gt;
&gt; Cheers,
&gt; Rob
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1293491/685400/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685400">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1294294" href="/Public/Bug/Display.html?id=87906#txn-1294294">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;26&nbsp;22:27:14&nbsp;2013</span>
    <span class="description">david.jacobowitz [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> sisyphus1 [...] optusnet.com.au</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87906] pthreads header problem and Inline::C</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 26 Nov 2013 19:26:43 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Dist-Strawberry [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Jacobowitz &lt;david.jacobowitz [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1294294/685898/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685898">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Well, I can&#39;t reproduce the problem with the #undef solution now, 
either. I&#39;m sorry, guys. If it pops up I&#39;ll append this bug again.

Thanks for Inline::C, Sisyphus. It&#39;s a brilliant.

On 11/25/2013 6:41 AM, Sisyphus via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87906">https://rt.cpan.org/Ticket/Display.html?id=87906</a></span> &gt;
&gt;
&gt; On Sun Nov 24 19:39:14 2013, sisyphus1@optusnet.com.au wrote:
<div class="message-stanza open">&gt;&gt;
&gt;&gt; -----Original Message-----
&gt;&gt; From: kmx via RT
&gt;&gt; Sent: Monday, November 25, 2013 9:19 AM
&gt;&gt; To: david.jacobowitz@gmail.com
&gt;&gt; Cc: sisyphus1@optusnet.com.au
&gt;&gt; Subject: [rt.cpan.org #87906] pthreads header problem and Inline::C
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87906">https://rt.cpan.org/Ticket/Display.html?id=87906</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I have put into Cc: Sisyphus - the author of Inline::C + AFAIK occasional
&gt;&gt;&gt; Strawberry Perl user - he might have a better comment on this issue.
</div></div>&gt; Sorry - when I wrote my reply I didn&#39;t realise that Dave had provided sample scripts. The &#34;works.pl&#34; works fine for me, as expected.
&gt; I&#39;ve also grabbed &#34;fails.pl&#34; and inserted the &#34;#undef PTHREAD_CREATE_JOINABLE&#34; immediately before the inclusion of pthread.h.
&gt; That script &#40;ie &#34;fails.h&#34;&#41; then runs fine for me ... no segfaults at all !!
&gt;
&gt; Admittedly I don&#39;t have the exact same version of Strawberry as Dave was running. I tried on Strawberry Perls &#40;portable&#41; 5.16.0, and 5.18.0. I also tried it on a mingw.org compiler-built 5.16.0 - again no problems.
&gt;
&gt; Seems odd.
&gt; kmx, did you try running &#34;fails.h&#34; &#40;amended as per above&#41; on any of your Strawberry Perl installations ?
&gt;
&gt; Cheers,
&gt; Rob
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1324321" href="/Public/Bug/Display.html?id=87906#txn-1324321">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;09&nbsp;04:08:14&nbsp;2014</span>
    <span class="description">kmx [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.604762</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
