<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #86988 for Tk: Test for system libpng is missing -lz</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #86988 for Tk: Test for system libpng is missing -lz</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">86988</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk/Active/">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
804.031    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
804.031_500    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Tk-804.031-Link-PNG-test-to-zlib.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1236629/653638/Tk-804.031-Link-PNG-test-to-zlib.patch">
Wed Jul 17 04:57:18 2013 (1011b) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;04:41:28&nbsp;2013</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test for system libpng is missing -lz</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">804.031 cannot detect system libpng because the test forget to link against zlib:

system&#40;&#39;pkg-config --exists libpng&#39;&#41;;
if &#40;$? == 0&#41; {
    chomp&#40;$libpng_cflags = `pkg-config --cflags libpng`&#41;;
    chomp&#40;$libpng_libs   = `pkg-config --libs libpng`&#41;;
} else {
    warn &#34;&#39;pkg-config libpng&#39; failed, continue with fallback values for cflags and libs...\n&#34;;
    $libpng_cflags = &#39;-I/usr/local/include&#39;;
    $libpng_libs   = &#39;-lpng -lz -lm&#39;;
}

if &#40;$Tk::MMtry::VERSION ge &#39;4.007&#39; &#38;&#38;
    try_run&#40;&#34;config/has_png.c&#34;,[$libpng_cflags],[$libpng_libs]&#41;&#41;

And config/has_png.c calls zlibVersion&#40;&#41;.

My libpng does not output zlib as build-time dependency:

# pkg-config --libs libpng
-lpng16 

I propose to add &#39;-lz&#39; to the $libpng_libs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;04:57:18&nbsp;2013</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne St 17.čec.2013 04:41:28, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 804.031 cannot detect system libpng because the test forget to link
&gt; against zlib:
</div>
Attached patch implements it.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tk-804.031-Link-PNG-test-to-zlib.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From b486af844498013073000808890fb19917f00823 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Wed, 17 Jul 2013 10:43:28 +0200
Subject: [PATCH] Link PNG test to zlib
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=86988">https://rt.cpan.org/Public/Bug/Display.html?id=86988</a></span>&gt;.

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 PNG/Makefile.PL | 3 ++-
 1 file changed, 2 insertions&#40;+&#41;, 1 deletion&#40;-&#41;

diff --git a/PNG/Makefile.PL b/PNG/Makefile.PL
index dfb40d4..fe6c222 100755
--- a/PNG/Makefile.PL
+++ b/PNG/Makefile.PL
@@ -25,8 +25,9 @@ if &#40;$? == 0&#41; {
 } else {
     warn &#34;&#39;pkg-config libpng&#39; failed, continue with fallback values for cflags and libs...\n&#34;;
     $libpng_cflags = &#39;-I/usr/local/include&#39;;
-    $libpng_libs   = &#39;-lpng -lz -lm&#39;;
+    $libpng_libs   = &#39;-lpng -lm&#39;;
 }
+$libpng_libs .= &#39; -lz&#39;;
 
 if &#40;$Tk::MMtry::VERSION ge &#39;4.007&#39; &#38;&#38;
     try_run&#40;&#34;config/has_png.c&#34;,[$libpng_cflags],[$libpng_libs]&#41;&#41;
-- 
1.8.1.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;09:56:10&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-07-17 04:41:28, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 804.031 cannot detect system libpng because the test forget to link
&gt; against zlib:
&gt; 
&gt; system&#40;&#39;pkg-config --exists libpng&#39;&#41;;
&gt; if &#40;$? == 0&#41; {
&gt;     chomp&#40;$libpng_cflags = `pkg-config --cflags libpng`&#41;;
&gt;     chomp&#40;$libpng_libs   = `pkg-config --libs libpng`&#41;;
&gt; } else {
&gt;     warn &#34;&#39;pkg-config libpng&#39; failed, continue with fallback values
&gt; for cflags and libs...\n&#34;;
&gt;     $libpng_cflags = &#39;-I/usr/local/include&#39;;
&gt;     $libpng_libs   = &#39;-lpng -lz -lm&#39;;
&gt; }
&gt; 
&gt; if &#40;$Tk::MMtry::VERSION ge &#39;4.007&#39; &#38;&#38;
&gt;     try_run&#40;&#34;config/has_png.c&#34;,[$libpng_cflags],[$libpng_libs]&#41;&#41;
&gt; 
&gt; And config/has_png.c calls zlibVersion&#40;&#41;.
&gt; 
&gt; My libpng does not output zlib as build-time dependency:
&gt; 
&gt; # pkg-config --libs libpng
&gt; -lpng16
&gt; 
&gt; I propose to add &#39;-lz&#39; to the $libpng_libs.
</div>
Which system is this? On my debian system, -lz is not listed in the pkg-config output, but things are working nevertheless. On my freebsd system, the output of pkg-config includes -lz:

$ pkg-config --libs libpng
-L/usr/local/lib -lpng -lz -lm  

So it seems to me that the output of pkg-config should include -lz if it&#39;s needed?

Regards,
     Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;09:56:10&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;10:19:57&nbsp;2013</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #86988] Test for system libpng is missing -lz</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Jul 2013 16:19:37 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Slaven_Rezic via RT &lt;bug-Tk [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jul 17, 2013 at 09:56:10AM -0400, Slaven_Rezic via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=86988">https://rt.cpan.org/Ticket/Display.html?id=86988</a></span> &gt;
&gt; 
&gt; On 2013-07-17 04:41:28, ppisar wrote:
<div class="message-stanza open">&gt; &gt; 804.031 cannot detect system libpng because the test forget to link
&gt; &gt; against zlib:
&gt; &gt; 
&gt; &gt; system&#40;&#39;pkg-config --exists libpng&#39;&#41;;
&gt; &gt; if &#40;$? == 0&#41; {
&gt; &gt;     chomp&#40;$libpng_cflags = `pkg-config --cflags libpng`&#41;;
&gt; &gt;     chomp&#40;$libpng_libs   = `pkg-config --libs libpng`&#41;;
&gt; &gt; } else {
&gt; &gt;     warn &#34;&#39;pkg-config libpng&#39; failed, continue with fallback values
&gt; &gt; for cflags and libs...\n&#34;;
&gt; &gt;     $libpng_cflags = &#39;-I/usr/local/include&#39;;
&gt; &gt;     $libpng_libs   = &#39;-lpng -lz -lm&#39;;
&gt; &gt; }
&gt; &gt; 
&gt; &gt; if &#40;$Tk::MMtry::VERSION ge &#39;4.007&#39; &#38;&#38;
&gt; &gt;     try_run&#40;&#34;config/has_png.c&#34;,[$libpng_cflags],[$libpng_libs]&#41;&#41;
&gt; &gt; 
&gt; &gt; And config/has_png.c calls zlibVersion&#40;&#41;.
&gt; &gt; 
&gt; &gt; My libpng does not output zlib as build-time dependency:
&gt; &gt; 
&gt; &gt; # pkg-config --libs libpng
&gt; &gt; -lpng16
&gt; &gt; 
&gt; &gt; I propose to add &#39;-lz&#39; to the $libpng_libs.
</div>&gt; 
&gt; Which system is this?
</div>Fedora 18 and 20.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On my debian system, -lz is not listed in the pkg-config output,
</div>
That&#39;s correct.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; but things are working nevertheless.
</div>
Probably because of opportunistic linker in your distribution. libpng links
itself to libz what can make libz symbols available to the test program.
However this is not portable. If libpng stopped using zlib, then your test
program would miss symbols from libz.

If the test program includes zlib headers and calls functions from lzib, then
it must be linked to libz explictly. Otherwise strict linker will complain
about unresolved zlibVersion symbol.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On my freebsd system, the output of pkg-config includes -lz:
&gt; 
&gt; $ pkg-config --libs libpng -L/usr/local/lib -lpng -lz -lm  
&gt;
</div>Because some linkers require repeating libraries that are needed by already
linked libraries. Sometimes it&#39;s just a dummy fall-back for case when
a library is static but it has dynamic dependenies.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So it seems to me that the output of pkg-config should include -lz if it&#39;s
&gt; needed?
&gt;
</div>Unless libpng uses zlib data structures to pass data between application and
libpng, hence including zlib headers through libpng headers &#40;i.e. #include
&lt;png.h&gt; is enough to use definitions from &lt;zlib.h&gt; without including &lt;zlib.h&gt;
explicitly&#41;, there is no need to link each libpng aplication to libz, thus
pkg-config should not output -lz.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236778/653740/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 230b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;10:27:45&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-07-17 10:19:57, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed, Jul 17, 2013 at 09:56:10AM -0400, Slaven_Rezic via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=86988">https://rt.cpan.org/Ticket/Display.html?id=86988</a></span> &gt;
&gt; &gt;
&gt; &gt; On 2013-07-17 04:41:28, ppisar wrote:
<div class="message-stanza open">&gt; &gt; &gt; 804.031 cannot detect system libpng because the test forget to
</div></div>&gt; link
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; against zlib:
&gt; &gt; &gt;
&gt; &gt; &gt; system&#40;&#39;pkg-config --exists libpng&#39;&#41;;
&gt; &gt; &gt; if &#40;$? == 0&#41; {
&gt; &gt; &gt;     chomp&#40;$libpng_cflags = `pkg-config --cflags libpng`&#41;;
&gt; &gt; &gt;     chomp&#40;$libpng_libs   = `pkg-config --libs libpng`&#41;;
&gt; &gt; &gt; } else {
&gt; &gt; &gt;     warn &#34;&#39;pkg-config libpng&#39; failed, continue with fallback
</div></div>&gt; values
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; for cflags and libs...\n&#34;;
&gt; &gt; &gt;     $libpng_cflags = &#39;-I/usr/local/include&#39;;
&gt; &gt; &gt;     $libpng_libs   = &#39;-lpng -lz -lm&#39;;
&gt; &gt; &gt; }
&gt; &gt; &gt;
&gt; &gt; &gt; if &#40;$Tk::MMtry::VERSION ge &#39;4.007&#39; &#38;&#38;
&gt; &gt; &gt;     try_run&#40;&#34;config/has_png.c&#34;,[$libpng_cflags],[$libpng_libs]&#41;&#41;
&gt; &gt; &gt;
&gt; &gt; &gt; And config/has_png.c calls zlibVersion&#40;&#41;.
&gt; &gt; &gt;
&gt; &gt; &gt; My libpng does not output zlib as build-time dependency:
&gt; &gt; &gt;
&gt; &gt; &gt; # pkg-config --libs libpng
&gt; &gt; &gt; -lpng16
&gt; &gt; &gt;
&gt; &gt; &gt; I propose to add &#39;-lz&#39; to the $libpng_libs.
</div>&gt; &gt;
&gt; &gt; Which system is this?
</div>&gt; Fedora 18 and 20.
&gt; 
<div class="message-stanza open">&gt; &gt; On my debian system, -lz is not listed in the pkg-config output,
</div>&gt; 
&gt; That&#39;s correct.
&gt; 
<div class="message-stanza open">&gt; &gt; but things are working nevertheless.
</div>&gt; 
&gt; Probably because of opportunistic linker in your distribution. libpng
&gt; links
&gt; itself to libz what can make libz symbols available to the test
&gt; program.
&gt; However this is not portable. If libpng stopped using zlib, then your
&gt; test
&gt; program would miss symbols from libz.
&gt; 
&gt; If the test program includes zlib headers and calls functions from
&gt; lzib, then
&gt; it must be linked to libz explictly. Otherwise strict linker will
&gt; complain
&gt; about unresolved zlibVersion symbol.
</div>
So the correct approach would probably be to include also the output of

    pkg-config --cflags zlib
    pkg-config --libs zlib

for linking the test program here &#40;rather than hardcoding &#34;-lz&#34;&#41;?

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;18&nbsp;01:23:02&nbsp;2013</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #86988] Test for system libpng is missing -lz</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Jul 2013 07:22:45 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Slaven_Rezic via RT &lt;bug-Tk [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jul 17, 2013 at 10:27:46AM -0400, Slaven_Rezic via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=86988">https://rt.cpan.org/Ticket/Display.html?id=86988</a></span> &gt;
&gt; 
&gt; So the correct approach would probably be to include also the output of
&gt; 
&gt;     pkg-config --cflags zlib
&gt;     pkg-config --libs zlib
&gt; 
&gt; for linking the test program here &#40;rather than hardcoding &#34;-lz&#34;&#41;?
&gt; 
</div>Yes. Assuming zlib provides pkg-config file.

I thought it doesn&#39;t, but I did a typo probably. I rechecked it now and 
pkg-config knows zlib on my system. So this is the right way.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236946/653839/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 230b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;18&nbsp;09:50:43&nbsp;2013</span>
    <span class="description">dmacks [...] netspace.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #86988] Test for system libpng is missing -lz</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Jul 2013 09:50:21 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Daniel Macks&#34; &lt;dmacks [...] netspace.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On OS X 10.8, I don&#39;t see a zlib.pc &#40;either by searching the filesystem or by using fink&#39;s `pkg-config`&#41; but I do have libz.dylib and zlib.h version 1.2.5. A .pc isn&#39;t supplied until version 1.2.7 &#40;according to <span class="clickylink"><a target="new" rel="nofollow" href="http://www.zlib.net/ChangeLog.txt&#41;">http://www.zlib.net/ChangeLog.txt&#41;</a></span>

dan

 --
Daniel Macks
dmacks@netspace.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;18&nbsp;09:55:33&nbsp;2013</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #86988] Test for system libpng is missing -lz</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Jul 2013 15:55:16 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;dmacks [...] netspace.org via RT&#34; &lt;bug-Tk [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jul 18, 2013 at 09:50:44AM -0400, dmacks@netspace.org via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=86988">https://rt.cpan.org/Ticket/Display.html?id=86988</a></span> &gt;
&gt; 
&gt; On OS X 10.8, I don&#39;t see a zlib.pc &#40;either by searching the filesystem or
&gt; by using fink&#39;s `pkg-config`&#41; but I do have libz.dylib and zlib.h version
&gt; 1.2.5. A .pc isn&#39;t supplied until version 1.2.7 &#40;according to
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.zlib.net/ChangeLog.txt&#41;">http://www.zlib.net/ChangeLog.txt&#41;</a></span>
&gt; 
</div>That&#39;s possible. I have 1.2.7.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1237037/653908/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 230b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;18&nbsp;04:14:45&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-07-17 04:41:28, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 804.031 cannot detect system libpng because the test forget to link
&gt; against zlib:
&gt; 
&gt; system&#40;&#39;pkg-config --exists libpng&#39;&#41;;
&gt; if &#40;$? == 0&#41; {
&gt;     chomp&#40;$libpng_cflags = `pkg-config --cflags libpng`&#41;;
&gt;     chomp&#40;$libpng_libs   = `pkg-config --libs libpng`&#41;;
&gt; } else {
&gt;     warn &#34;&#39;pkg-config libpng&#39; failed, continue with fallback values
&gt; for cflags and libs...\n&#34;;
&gt;     $libpng_cflags = &#39;-I/usr/local/include&#39;;
&gt;     $libpng_libs   = &#39;-lpng -lz -lm&#39;;
&gt; }
&gt; 
&gt; if &#40;$Tk::MMtry::VERSION ge &#39;4.007&#39; &#38;&#38;
&gt;     try_run&#40;&#34;config/has_png.c&#34;,[$libpng_cflags],[$libpng_libs]&#41;&#41;
&gt; 
&gt; And config/has_png.c calls zlibVersion&#40;&#41;.
&gt; 
&gt; My libpng does not output zlib as build-time dependency:
&gt; 
&gt; # pkg-config --libs libpng
&gt;  -lpng16
&gt; 
&gt; I propose to add &#39;-lz&#39; to the $libpng_libs.
</div>
This should work now in 804.031_500. perl Makefile.PL now asks &#34;pkg-config zlib&#34; for information, or if this fails just adds -lz. With this change things are working on my Fedora 20 VM.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;18&nbsp;04:14:46&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;18&nbsp;04:14:46&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Fixed in 804.031_500 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
