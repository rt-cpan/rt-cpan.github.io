<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #124477 for Digest-SHA: VS2017 compilation warnings</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #124477 for Digest-SHA: VS2017 compilation warnings</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Digest-SHA">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Digest-SHA">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Digest-SHA">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Digest-SHA">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-SHA">Digest-SHA CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">124477</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Digest-SHA">Digest-SHA</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">mshelor [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
RANDIR [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-11544-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
6.01    </td>
  </tr>
  <tr id="CF-11545-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
6.02    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




SHA.xs<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1773656/954388/SHA.xs">
Mon Feb 26 18:03:19 2018 (8k) by mshelor [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=124477">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1772008" href="/Public/Bug/Display.html?id=124477#txn-1772008">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;19&nbsp;18:00:04&nbsp;2018</span>
    <span class="description">RANDIR [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> VS2017 compilation warnings</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1772008/953529/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/953529">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 707b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">While building this module under 64-bit version of MS VS2017, I get the following build warnings:

SHA.xs&#40;155&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to &#39;unsigned long&#39;, possible loss of data
SHA.xs&#40;206&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to &#39;unsigned int&#39;, possible loss of data
SHA.xs&#40;215&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to &#39;unsigned long&#39;, possible loss of data
SHA.xs&#40;264&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to &#39;unsigned long&#39;, possible loss of data
SHA.xs&#40;359&#41;: warning C4244: &#39;=&#39;: conversion from &#39;__int64&#39; to &#39;int&#39;, possible loss of data
SHA.xs&#40;377&#41;: warning C4244: &#39;=&#39;: conversion from &#39;__int64&#39; to &#39;int&#39;, possible loss of data
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1773139" href="/Public/Bug/Display.html?id=124477#txn-1773139">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;24&nbsp;19:18:10&nbsp;2018</span>
    <span class="description">mshelor [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1773147" href="/Public/Bug/Display.html?id=124477#txn-1773147">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;24&nbsp;19:29:03&nbsp;2018</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1773147/954118/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/954118">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 19 18:00:04 2018, RANDIR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; While building this module under 64-bit version of MS VS2017, I get
&gt; the following build warnings:
&gt; 
&gt; SHA.xs&#40;155&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &#39;unsigned long&#39;, possible loss of data
&gt; SHA.xs&#40;206&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &#39;unsigned int&#39;, possible loss of data
&gt; SHA.xs&#40;215&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &#39;unsigned long&#39;, possible loss of data
&gt; SHA.xs&#40;264&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &#39;unsigned long&#39;, possible loss of data
&gt; SHA.xs&#40;359&#41;: warning C4244: &#39;=&#39;: conversion from &#39;__int64&#39; to &#39;int&#39;,
&gt; possible loss of data
&gt; SHA.xs&#40;377&#41;: warning C4244: &#39;=&#39;: conversion from &#39;__int64&#39; to &#39;int&#39;,
&gt; possible loss of data
</div>
Yes, that&#39;s understandable.  Thanks for letting me know.

I&#39;ve addressed these warnings in draft version 6.02 by the use of explicit typecasting, which appears to be the only reliable way given that perlapio has a history of changing return-value types &#40;e.g. PerlIO_read went from &#39;int&#39; to &#39;SSize_t&#39;&#41;.

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1773148" href="/Public/Bug/Display.html?id=124477#txn-1773148">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;24&nbsp;19:29:04&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1773656" href="/Public/Bug/Display.html?id=124477#txn-1773656">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;26&nbsp;18:03:19&nbsp;2018</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1773656/954387/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/954387">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 24 19:29:03 2018, MSHELOR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Feb 19 18:00:04 2018, RANDIR wrote:
<div class="message-stanza open">&gt; &gt; While building this module under 64-bit version of MS VS2017, I get
&gt; &gt; the following build warnings:
&gt; &gt;
&gt; &gt; SHA.xs&#40;155&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &gt; &#39;unsigned long&#39;, possible loss of data
&gt; &gt; SHA.xs&#40;206&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &gt; &#39;unsigned int&#39;, possible loss of data
&gt; &gt; SHA.xs&#40;215&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &gt; &#39;unsigned long&#39;, possible loss of data
&gt; &gt; SHA.xs&#40;264&#41;: warning C4267: &#39;function&#39;: conversion from &#39;size_t&#39; to
&gt; &gt; &#39;unsigned long&#39;, possible loss of data
&gt; &gt; SHA.xs&#40;359&#41;: warning C4244: &#39;=&#39;: conversion from &#39;__int64&#39; to &#39;int&#39;,
&gt; &gt; possible loss of data
&gt; &gt; SHA.xs&#40;377&#41;: warning C4244: &#39;=&#39;: conversion from &#39;__int64&#39; to &#39;int&#39;,
&gt; &gt; possible loss of data
</div>&gt; 
&gt; Yes, that&#39;s understandable.  Thanks for letting me know.
&gt; 
&gt; I&#39;ve addressed these warnings in draft version 6.02 by the use of
&gt; explicit typecasting, which appears to be the only reliable way given
&gt; that perlapio has a history of changing return-value types &#40;e.g.
&gt; PerlIO_read went from &#39;int&#39; to &#39;SSize_t&#39;&#41;.
&gt; 
&gt; Mark
</div>
Here&#39;s the updated draft version of SHA.xs if you want to confirm whether it compiles under VS without warnings.

Mark
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SHA.xs</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1773656/954388/SHA.xs">Download SHA.xs</a><br />
<span class="downloadcontenttype">text/x-csrc 8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#define PERL_NO_GET_CONTEXT
#include &#34;EXTERN.h&#34;
#include &#34;perl.h&#34;
#include &#34;XSUB.h&#34;

#ifdef SvPVbyte
	#if PERL_REVISION == 5 &#38;&#38; PERL_VERSION &lt; 8
		#undef SvPVbyte
		#define SvPVbyte&#40;sv, lp&#41; \
			&#40;sv_utf8_downgrade&#40;&#40;sv&#41;, 0&#41;, SvPV&#40;&#40;sv&#41;, &#40;lp&#41;&#41;&#41;
	#endif
#else
	#define SvPVbyte SvPV
#endif

#ifndef dTHX
	#define pTHX_
	#define aTHX_
#endif

#ifndef PerlIO
	#define PerlIO				FILE
	#define PerlIO_read&#40;f, buf, count&#41;	fread&#40;buf, 1, count, f&#41;
#endif

#ifndef sv_derived_from
	#include &#34;src/sdf.c&#34;
#endif

#ifndef Newx
	#define Newx&#40;ptr, num, type&#41;	New&#40;0, ptr, num, type&#41;
	#define Newxz&#40;ptr, num, type&#41;	Newz&#40;0, ptr, num, type&#41;
#endif

#include &#34;src/sha.c&#34;

static const int ix2alg[] =
	{1,1,1,224,224,224,256,256,256,384,384,384,512,512,512,
	512224,512224,512224,512256,512256,512256};

#ifndef INT2PTR
#define INT2PTR&#40;p, i&#41; &#40;p&#41; &#40;i&#41;
#endif

#define MAX_WRITE_SIZE 16384
#define IO_BUFFER_SIZE 4096

static SHA *getSHA&#40;pTHX_ SV *self&#41;
{
	if &#40;!sv_isobject&#40;self&#41; || !sv_derived_from&#40;self, &#34;Digest::SHA&#34;&#41;&#41;
		return&#40;NULL&#41;;
	return INT2PTR&#40;SHA *, SvIV&#40;SvRV&#40;self&#41;&#41;&#41;;
}

MODULE = Digest::SHA		PACKAGE = Digest::SHA

PROTOTYPES: ENABLE

int
shainit&#40;s, alg&#41;
	SHA *	s
	int	alg

void
sharewind&#40;s&#41;
	SHA *	s

unsigned long
shawrite&#40;bitstr, bitcnt, s&#41;
	unsigned char *	bitstr
	unsigned long	bitcnt
	SHA *	s

SV *
newSHA&#40;classname, alg&#41;
	char *	classname
	int 	alg
PREINIT:
	SHA *state;
CODE:
	Newxz&#40;state, 1, SHA&#41;;
	if &#40;!shainit&#40;state, alg&#41;&#41; {
		Safefree&#40;state&#41;;
		XSRETURN_UNDEF;
	}
	RETVAL = newSV&#40;0&#41;;
	sv_setref_pv&#40;RETVAL, classname, &#40;void *&#41; state&#41;;
	SvREADONLY_on&#40;SvRV&#40;RETVAL&#41;&#41;;
OUTPUT:
	RETVAL

SV *
clone&#40;self&#41;
	SV *	self
PREINIT:
	SHA *state;
	SHA *clone;
CODE:
	if &#40;&#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	Newx&#40;clone, 1, SHA&#41;;
	RETVAL = newSV&#40;0&#41;;
	sv_setref_pv&#40;RETVAL, sv_reftype&#40;SvRV&#40;self&#41;, 1&#41;, &#40;void *&#41; clone&#41;;
	SvREADONLY_on&#40;SvRV&#40;RETVAL&#41;&#41;;
	Copy&#40;state, clone, 1, SHA&#41;;
OUTPUT:
	RETVAL

void
DESTROY&#40;s&#41;
	SHA *	s
CODE:
	Safefree&#40;s&#41;;

SV *
sha1&#40;...&#41;
ALIAS:
	Digest::SHA::sha1 = 0
	Digest::SHA::sha1_hex = 1
	Digest::SHA::sha1_base64 = 2
	Digest::SHA::sha224 = 3
	Digest::SHA::sha224_hex = 4
	Digest::SHA::sha224_base64 = 5
	Digest::SHA::sha256 = 6
	Digest::SHA::sha256_hex = 7
	Digest::SHA::sha256_base64 = 8
	Digest::SHA::sha384 = 9
	Digest::SHA::sha384_hex = 10
	Digest::SHA::sha384_base64 = 11
	Digest::SHA::sha512 = 12
	Digest::SHA::sha512_hex = 13
	Digest::SHA::sha512_base64 = 14
	Digest::SHA::sha512224 = 15
	Digest::SHA::sha512224_hex = 16
	Digest::SHA::sha512224_base64 = 17
	Digest::SHA::sha512256 = 18
	Digest::SHA::sha512256_hex = 19
	Digest::SHA::sha512256_base64 = 20
PREINIT:
	int i;
	UCHR *data;
	STRLEN len;
	SHA sha;
	char *result;
CODE:
	if &#40;!shainit&#40;&#38;sha, ix2alg[ix]&#41;&#41;
		XSRETURN_UNDEF;
	for &#40;i = 0; i &lt; items; i++&#41; {
		data = &#40;UCHR *&#41; &#40;SvPVbyte&#40;ST&#40;i&#41;, len&#41;&#41;;
		while &#40;len &gt; MAX_WRITE_SIZE&#41; {
			shawrite&#40;data, MAX_WRITE_SIZE &lt;&lt; 3, &#38;sha&#41;;
			data += MAX_WRITE_SIZE;
			len  -= MAX_WRITE_SIZE;
		}
		shawrite&#40;data, &#40;ULNG&#41; len &lt;&lt; 3, &#38;sha&#41;;
	}
	shafinish&#40;&#38;sha&#41;;
	len = 0;
	if &#40;ix % 3 == 0&#41; {
		result = &#40;char *&#41; shadigest&#40;&#38;sha&#41;;
		len = sha.digestlen;
	}
	else if &#40;ix % 3 == 1&#41;
		result = shahex&#40;&#38;sha&#41;;
	else
		result = shabase64&#40;&#38;sha&#41;;
	RETVAL = newSVpv&#40;result, len&#41;;
OUTPUT:
	RETVAL

SV *
hmac_sha1&#40;...&#41;
ALIAS:
	Digest::SHA::hmac_sha1 = 0
	Digest::SHA::hmac_sha1_hex = 1
	Digest::SHA::hmac_sha1_base64 = 2
	Digest::SHA::hmac_sha224 = 3
	Digest::SHA::hmac_sha224_hex = 4
	Digest::SHA::hmac_sha224_base64 = 5
	Digest::SHA::hmac_sha256 = 6
	Digest::SHA::hmac_sha256_hex = 7
	Digest::SHA::hmac_sha256_base64 = 8
	Digest::SHA::hmac_sha384 = 9
	Digest::SHA::hmac_sha384_hex = 10
	Digest::SHA::hmac_sha384_base64 = 11
	Digest::SHA::hmac_sha512 = 12
	Digest::SHA::hmac_sha512_hex = 13
	Digest::SHA::hmac_sha512_base64 = 14
	Digest::SHA::hmac_sha512224 = 15
	Digest::SHA::hmac_sha512224_hex = 16
	Digest::SHA::hmac_sha512224_base64 = 17
	Digest::SHA::hmac_sha512256 = 18
	Digest::SHA::hmac_sha512256_hex = 19
	Digest::SHA::hmac_sha512256_base64 = 20
PREINIT:
	int i;
	UCHR *key = &#40;UCHR *&#41; &#34;&#34;;
	UCHR *data;
	STRLEN len = 0;
	HMAC hmac;
	char *result;
CODE:
	if &#40;items &gt; 0&#41; {
		key = &#40;UCHR *&#41; &#40;SvPVbyte&#40;ST&#40;items-1&#41;, len&#41;&#41;;
	}
	if &#40;hmacinit&#40;&#38;hmac, ix2alg[ix], key, &#40;UINT&#41; len&#41; == NULL&#41;
		XSRETURN_UNDEF;
	for &#40;i = 0; i &lt; items - 1; i++&#41; {
		data = &#40;UCHR *&#41; &#40;SvPVbyte&#40;ST&#40;i&#41;, len&#41;&#41;;
		while &#40;len &gt; MAX_WRITE_SIZE&#41; {
			hmacwrite&#40;data, MAX_WRITE_SIZE &lt;&lt; 3, &#38;hmac&#41;;
			data += MAX_WRITE_SIZE;
			len  -= MAX_WRITE_SIZE;
		}
		hmacwrite&#40;data, &#40;ULNG&#41; len &lt;&lt; 3, &#38;hmac&#41;;
	}
	hmacfinish&#40;&#38;hmac&#41;;
	len = 0;
	if &#40;ix % 3 == 0&#41; {
		result = &#40;char *&#41; hmacdigest&#40;&#38;hmac&#41;;
		len = hmac.digestlen;
	}
	else if &#40;ix % 3 == 1&#41;
		result = hmachex&#40;&#38;hmac&#41;;
	else
		result = hmacbase64&#40;&#38;hmac&#41;;
	RETVAL = newSVpv&#40;result, len&#41;;
OUTPUT:
	RETVAL

int
hashsize&#40;self&#41;
	SV *	self
ALIAS:
	Digest::SHA::hashsize = 0
	Digest::SHA::algorithm = 1
PREINIT:
	SHA *state;
CODE:
	if &#40;&#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	RETVAL = ix ? state-&gt;alg : &#40;int&#41; &#40;state-&gt;digestlen &lt;&lt; 3&#41;;
OUTPUT:
	RETVAL

void
add&#40;self, ...&#41;
	SV *	self
PREINIT:
	int i;
	UCHR *data;
	STRLEN len;
	SHA *state;
PPCODE:
	if &#40;&#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	for &#40;i = 1; i &lt; items; i++&#41; {
		data = &#40;UCHR *&#41; &#40;SvPVbyte&#40;ST&#40;i&#41;, len&#41;&#41;;
		while &#40;len &gt; MAX_WRITE_SIZE&#41; {
			shawrite&#40;data, MAX_WRITE_SIZE &lt;&lt; 3, state&#41;;
			data += MAX_WRITE_SIZE;
			len  -= MAX_WRITE_SIZE;
		}
		shawrite&#40;data, &#40;ULNG&#41; len &lt;&lt; 3, state&#41;;
	}
	XSRETURN&#40;1&#41;;

SV *
digest&#40;self&#41;
	SV *	self
ALIAS:
	Digest::SHA::digest = 0
	Digest::SHA::hexdigest = 1
	Digest::SHA::b64digest = 2
PREINIT:
	STRLEN len;
	SHA *state;
	char *result;
CODE:
	if &#40;&#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	shafinish&#40;state&#41;;
	len = 0;
	if &#40;ix == 0&#41; {
		result = &#40;char *&#41; shadigest&#40;state&#41;;
		len = state-&gt;digestlen;
	}
	else if &#40;ix == 1&#41;
		result = shahex&#40;state&#41;;
	else
		result = shabase64&#40;state&#41;;
	RETVAL = newSVpv&#40;result, len&#41;;
	sharewind&#40;state&#41;;
OUTPUT:
	RETVAL

SV *
_getstate&#40;self&#41;
	SV *	self
PREINIT:
	SHA *state;
	UCHR buf[256];
	UCHR *ptr = buf;
CODE:
	if &#40;&#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	Copy&#40;digcpy&#40;state&#41;, ptr, state-&gt;alg &lt;= SHA256 ? 32 : 64, UCHR&#41;;
	ptr += state-&gt;alg &lt;= SHA256 ? 32 : 64;
	Copy&#40;state-&gt;block, ptr, state-&gt;alg &lt;= SHA256 ? 64 : 128, UCHR&#41;;
	ptr += state-&gt;alg &lt;= SHA256 ? 64 : 128;
	ptr = w32mem&#40;ptr, state-&gt;blockcnt&#41;;
	ptr = w32mem&#40;ptr, state-&gt;lenhh&#41;;
	ptr = w32mem&#40;ptr, state-&gt;lenhl&#41;;
	ptr = w32mem&#40;ptr, state-&gt;lenlh&#41;;
	ptr = w32mem&#40;ptr, state-&gt;lenll&#41;;
	RETVAL = newSVpv&#40;&#40;char *&#41; buf, &#40;STRLEN&#41; &#40;ptr - buf&#41;&#41;;
OUTPUT:
	RETVAL

void
_putstate&#40;self, packed_state&#41;
	SV *	self
	SV *	packed_state
PREINIT:
	UINT bc;
	STRLEN len;
	SHA *state;
	UCHR *data;
PPCODE:
	if &#40;&#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	data = &#40;UCHR *&#41; SvPV&#40;packed_state, len&#41;;
	if &#40;len != &#40;state-&gt;alg &lt;= SHA256 ? 116U : 212U&#41;&#41;
		XSRETURN_UNDEF;
	data = statecpy&#40;state, data&#41;;
	Copy&#40;data, state-&gt;block, state-&gt;blocksize &gt;&gt; 3, UCHR&#41;;
	data += &#40;state-&gt;blocksize &gt;&gt; 3&#41;;
	bc = memw32&#40;data&#41;, data += 4;
	if &#40;bc &gt;= &#40;state-&gt;alg &lt;= SHA256 ? 512U : 1024U&#41;&#41;
		XSRETURN_UNDEF;
	state-&gt;blockcnt = bc;
	state-&gt;lenhh = memw32&#40;data&#41;, data += 4;
	state-&gt;lenhl = memw32&#40;data&#41;, data += 4;
	state-&gt;lenlh = memw32&#40;data&#41;, data += 4;
	state-&gt;lenll = memw32&#40;data&#41;;
	XSRETURN&#40;1&#41;;

void
_addfilebin&#40;self, f&#41;
	SV *		self
	PerlIO *	f
PREINIT:
	SHA *state;
	int n;
	UCHR in[IO_BUFFER_SIZE];
PPCODE:
	if &#40;!f || &#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	while &#40;&#40;n = &#40;int&#41; PerlIO_read&#40;f, in, sizeof&#40;in&#41;&#41;&#41; &gt; 0&#41;
		shawrite&#40;in, &#40;ULNG&#41; n &lt;&lt; 3, state&#41;;
	XSRETURN&#40;1&#41;;

void
_addfileuniv&#40;self, f&#41;
	SV *		self
	PerlIO *	f
PREINIT:
	UCHR c;
	int n;
	int cr = 0;
	UCHR *src, *dst;
	UCHR in[IO_BUFFER_SIZE+1];
	SHA *state;
PPCODE:
	if &#40;!f || &#40;state = getSHA&#40;aTHX_ self&#41;&#41; == NULL&#41;
		XSRETURN_UNDEF;
	while &#40;&#40;n = &#40;int&#41; PerlIO_read&#40;f, in+1, IO_BUFFER_SIZE&#41;&#41; &gt; 0&#41; {
		for &#40;dst = in, src = in + 1; n; n--&#41; {
			c = *src++;
			if &#40;!cr&#41; {
				if &#40;c == &#39;\015&#39;&#41;
					cr = 1;
				else
					*dst++ = c;
			}
			else {
				if &#40;c == &#39;\015&#39;&#41;
					*dst++ = &#39;\012&#39;;
				else if &#40;c == &#39;\012&#39;&#41; {
					*dst++ = &#39;\012&#39;;
					cr = 0;
				}
				else {
					*dst++ = &#39;\012&#39;;
					*dst++ = c;
					cr = 0;
				}
			}
		}
		shawrite&#40;in, &#40;ULNG&#41; &#40;dst - in&#41; &lt;&lt; 3, state&#41;;
	}
	if &#40;cr&#41; {
		in[0] = &#39;\012&#39;;
		shawrite&#40;in, 1UL &lt;&lt; 3, state&#41;;
	}
	XSRETURN&#40;1&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1779317" href="/Public/Bug/Display.html?id=124477#txn-1779317">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;28&nbsp;17:01:16&nbsp;2018</span>
    <span class="description">mshelor [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1779318" href="/Public/Bug/Display.html?id=124477#txn-1779318">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;28&nbsp;17:01:16&nbsp;2018</span>
    <span class="description">mshelor [...] cpan.org -  Broken in 6.01 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1783180" href="/Public/Bug/Display.html?id=124477#txn-1783180">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;21&nbsp;05:20:06&nbsp;2018</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1783346" href="/Public/Bug/Display.html?id=124477#txn-1783346">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;21&nbsp;19:26:47&nbsp;2018</span>
    <span class="description">mshelor [...] cpan.org -  Fixed in 6.02 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.377181</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
