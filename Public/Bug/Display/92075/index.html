<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #92075 for IO-Socket-IP: Timeout parameter</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #92075 for IO-Socket-IP: Timeout parameter</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Socket-IP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Socket-IP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Socket-IP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Socket-IP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Socket-IP">IO-Socket-IP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">92075</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Socket-IP/Active/">IO-Socket-IP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dagolden [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
oleg [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-234790-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-234791-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.32    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;12&nbsp;10:40:20&nbsp;2014</span>
    <span class="description">dagolden [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Timeout parameter</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The INCOMPATIBILITIES section lists the Timeout as an unsupported parameter.  Can it be added?  If so, that would help the &#34;drop-in&#34; support.  If not, could the rationale for why not be added to the documentation for clarity?

Thanks,
David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;16&nbsp;07:33:02&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 12 10:40:20 2014, DAGOLDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The INCOMPATIBILITIES section lists the Timeout as an unsupported
&gt; parameter.  Can it be added?  If so, that would help the &#34;drop-in&#34;
&gt; support.  If not, could the rationale for why not be added to the
&gt; documentation for clarity?
</div>
Turns out that all the Timeout functionallity itself is implemented by the base IO::Socket class, and thus actually applies to /any/ IO::Socket subclass. It is however not documented there, and instead mentioned briefly in passing in IO::Socket::INET, which doesn&#39;t do anything special to help implement it.

There&#39;s therefore no need for IO::Socket::IP to document or mention it as it&#39;s simply some behaviour inherited from its superclass. I&#39;ve just removed all mention of it instead.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;16&nbsp;07:33:02&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;16&nbsp;07:33:03&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;17&nbsp;04:27:35&nbsp;2014</span>
    <span class="description">oleg [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 16 07:33:02 2014, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Jan 12 10:40:20 2014, DAGOLDEN wrote:
<div class="message-stanza open">&gt; &gt; The INCOMPATIBILITIES section lists the Timeout as an unsupported
&gt; &gt; parameter.  Can it be added?  If so, that would help the &#34;drop-in&#34;
&gt; &gt; support.  If not, could the rationale for why not be added to the
&gt; &gt; documentation for clarity?
</div>&gt; 
&gt; Turns out that all the Timeout functionallity itself is implemented by
&gt; the base IO::Socket class, and thus actually applies to /any/
&gt; IO::Socket subclass. It is however not documented there, and instead
&gt; mentioned briefly in passing in IO::Socket::INET, which doesn&#39;t do
&gt; anything special to help implement it.
&gt; 
&gt; There&#39;s therefore no need for IO::Socket::IP to document or mention it
&gt; as it&#39;s simply some behaviour inherited from its superclass. I&#39;ve just
&gt; removed all mention of it instead.
</div>
This is not totally correct. IO::Socket handles timeout inside connect&#40;&#41; using IO::Select: <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/GBARR/IO-1.25/lib/IO/Socket.pm#L115">https://metacpan.org/source/GBARR/IO-1.25/lib/IO/Socket.pm#L115</a></span>
But IO::Socket::IP overloads this method. So, there is no timeout handling here

Here is a test:
use strict;
use Test::More;
use IO::Socket::INET;
use IO::Socket::IP;
use Time::HiRes;

use constant {
        SLOW_HOST =&gt; &#39;173.194.32.142&#39;, # google.com
        SLOW_PORT =&gt; 81
};

$SIG{ALRM} = sub {
        die &#34;Alarmed\n&#34;;
};

for my $impl &#40;&#39;INET&#39;, &#39;IP&#39;&#41; {
        eval {
                my $start = Time::HiRes::time;
                alarm&#40;10&#41;;
                my $sock = &#34;IO::Socket::$impl&#34;-&gt;new&#40;PeerHost =&gt; SLOW_HOST, PeerPort =&gt; SLOW_PORT, Timeout =&gt; 3&#41;;
                alarm&#40;0&#41;;
                my $end = Time::HiRes::time;
                my $err = $@;
                
                ok&#40;!$sock, &#34;$impl: socket not created&#34;&#41;;
                like&#40;$err, qr/timeout/i, &#34;$impl: proper error&#34;&#41; or diag $err;
                my $duration = $end - $start;
                ok&#40;$duration &gt; 2 &#38;&#38; $duration &lt; 5, &#34;$impl: timed out&#34;&#41;;
                diag $duration;
        };
        
        ok&#40;!$@, &#34;$impl: no exceptions&#34;&#41; or diag $@;
}

done_testing&#40;&#41;;
__END__

which outputs:
ok 1 - INET: socket not created
ok 2 - INET: proper error
ok 3 - INET: timed out
ok 4 - INET: no exceptions
# 3.00477385520935
not ok 5 - IP: no exceptions
1..5

#   Failed test &#39;IP: no exceptions&#39;
#   at timeout.pl line 32.
# Alarmed
# Looks like you failed 1 test of 5.
Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/5 subtests 

Test Summary Report
-------------------
timeout.pl &#40;Wstat: 256 Tests: 5 Failed: 1&#41;
  Failed test:  5
  Non-zero exit status: 1
Files=1, Tests=5, 13 wallclock secs &#40; 0.04 usr  0.00 sys +  0.08 cusr  0.02 csys =  0.14 CPU&#41;
Result: FAIL
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;17&nbsp;04:27:36&nbsp;2014</span>
    <span class="description">oleg [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;11:15:06&nbsp;2014</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ping.

Paul, what are your thoughts on this?  Even un&#40;der&#41;-documented, if we want this to be a drop-in replacement, it needs to match behaviors, and people do rely on timeout &#40;even if it doesn&#39;t always do what they expect&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;11:34:49&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 02 11:15:06 2014, DAGOLDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ping.
&gt; 
&gt; Paul, what are your thoughts on this?  Even un&#40;der&#41;-documented, if we
&gt; want this to be a drop-in replacement, it needs to match behaviors,
&gt; and people do rely on timeout &#40;even if it doesn&#39;t always do what they
&gt; expect&#41;.
</div>
I can easily write some code I can guess is probably correct. I can even go as far as to test it on the platforms I have access to &#40;ie. Linux&#41;.

I won&#39;t be able to write a unit test that the smokers will be able to use, because I can&#39;t reliably create a socket in such a timeout state. It&#39;s not testable.

Ergo I don&#39;t know how to test it, so I&#39;m not sure how to proceed.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;11:38:27&nbsp;2014</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 02 11:34:49 2014, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s not testable.
&gt; 
&gt; Ergo I don&#39;t know how to test it, so I&#39;m not sure how to proceed.
</div>
As much as I love TDD, I think it&#39;s sometimes OK to write code we believe is correct, spot check it, and rely on bug reports from real users.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;11:53:19&nbsp;2014</span>
    <span class="description">oleg [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 02 11:34:49 2014, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Sep 02 11:15:06 2014, DAGOLDEN wrote:
<div class="message-stanza open">&gt; &gt; Ping.
&gt; &gt;
&gt; &gt; Paul, what are your thoughts on this?  Even un&#40;der&#41;-documented, if we
&gt; &gt; want this to be a drop-in replacement, it needs to match behaviors,
&gt; &gt; and people do rely on timeout &#40;even if it doesn&#39;t always do what they
&gt; &gt; expect&#41;.
</div>&gt; 
&gt; I can easily write some code I can guess is probably correct. I can
&gt; even go as far as to test it on the platforms I have access to &#40;ie.
&gt; Linux&#41;.
&gt; 
&gt; I won&#39;t be able to write a unit test that the smokers will be able to
&gt; use, because I can&#39;t reliably create a socket in such a timeout state.
&gt; It&#39;s not testable.
&gt; 
&gt; Ergo I don&#39;t know how to test it, so I&#39;m not sure how to proceed.
</div>
The variant how to create non-connectable socket: <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/a/904609">http://stackoverflow.com/a/904609</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;11:30:41&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So...

Do we have a properly-clear semantic definition of what &#34;Timeout&#34; should actually do here?

I know it&#39;s applying to just the connect&#40;&#41; phase. But what does it mean in practice?

We have /no/ way to apply a timeout to the getaddrinfo&#40;&#41; phase, so if the user is trying to connect by hostname and the &#40;e.g.&#41; DNS resolver takes a long time, that won&#39;t work.

Presuming we manage to resolve a candidate list of addresses to attempt, how should the timeout apply to these? Should it apply separately to each address candidate? Or should it apply just once overall to all of the connect&#40;&#41; calls - if the first one fails due to timeout we&#39;ll just stop there and never try the others..?

If it applies just once overall, surely we should subtract the time that the name resolve operation took from this, so that the timeout effectively applies to the entire resolve+connect operation..?

Or what? I don&#39;t have a clear idea of what the thing should do.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;11:53:13&nbsp;2014</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 05 11:30:41 2014, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Do we have a properly-clear semantic definition of what &#34;Timeout&#34;
&gt; should actually do here?
</div>
I would argue &#34;as close to what IO::Socket::INET does as possible&#34;.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We have /no/ way to apply a timeout to the getaddrinfo&#40;&#41; phase, 
</div>
So let&#39;s not try to do that.  &#40;Though google tells me about getaddrinfo_a in some glibc&#39;s... is that an option if available?&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Presuming we manage to resolve a candidate list of addresses to
&gt; attempt, how should the timeout apply to these?
</div>
I like the idea of it applying once overall, but not including DNS resolution since that&#39;s not under user control.  As long as that&#39;s documented, I think that&#39;s acceptable.

If someone needs more control, they can do the resolution themselves and then call connect per address with whatever timeout they desire.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;12:01:24&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 05 11:53:13 2014, DAGOLDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Sep 05 11:30:41 2014, PEVANS wrote:
<div class="message-stanza open">&gt; &gt; Do we have a properly-clear semantic definition of what &#34;Timeout&#34;
&gt; &gt; should actually do here?
</div>&gt; 
&gt; I would argue &#34;as close to what IO::Socket::INET does as possible&#34;.
</div>
From reading the code, it would appear to be implemented by the &#39;connect&#39; method itself, so it&#39;s applying per address.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; We have /no/ way to apply a timeout to the getaddrinfo&#40;&#41; phase,
</div>&gt; 
&gt; So let&#39;s not try to do that.  &#40;Though google tells me about
&gt; getaddrinfo_a in some glibc&#39;s... is that an option if available?&#41;
</div>
I&#39;m not sure I want support a non-default option for &#34;some Linux boxes&#34; at the cost of every other OS not supporting it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Presuming we manage to resolve a candidate list of addresses to
&gt; &gt; attempt, how should the timeout apply to these?
</div>&gt; 
&gt; I like the idea of it applying once overall, but not including DNS
&gt; resolution since that&#39;s not under user control.  As long as that&#39;s
&gt; documented, I think that&#39;s acceptable.
&gt; 
&gt; If someone needs more control, they can do the resolution themselves
&gt; and then call connect per address with whatever timeout they desire.
</div>
It seems this isn&#39;t what IO::Socket::INET does then.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;12:11:12&nbsp;2014</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #92075] Timeout parameter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 5 Sep 2014 12:10:32 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Socket-IP [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Sep 5, 2014 at 12:01 PM, Paul Evans via RT &lt;
bug-IO-Socket-IP@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; From reading the code, it would appear to be implemented by the &#39;connect&#39;
&gt; method itself, so it&#39;s applying per address.
&gt;
&gt;
</div>Then I suggest doing that.  It wasn&#39;t clear to me in the code since I
didn&#39;t see the loop per address.

David
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;13:44:03&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">See what you think of

  <span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org/release/PEVANS/IO-Socket-IP-0.31_001">http://metacpan.org/release/PEVANS/IO-Socket-IP-0.31_001</a></span>

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;07&nbsp;01:22:00&nbsp;2014</span>
    <span class="description">oleg [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 05 13:44:03 2014, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; See what you think of
&gt; 
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://metacpan.org/release/PEVANS/IO-Socket-IP-0.31_001">http://metacpan.org/release/PEVANS/IO-Socket-IP-0.31_001</a></span>
</div>
The behavior when both Blocking =&gt; 0 and Timeout specified not compatible with IO::Socket::INET:

time perl -Ilib -MIO::Socket::IP -E &#39;IO::Socket::IP-&gt;new&#40;Blocking =&gt; 0, PeerAddr =&gt; &#34;google.com&#34;, PeerPort =&gt; 81, Timeout =&gt; 5&#41; or die $@&#39;

real    0m0.097s
user    0m0.076s
sys     0m0.012s

perl -MIO::Socket::INET -E &#39;IO::Socket::INET-&gt;new&#40;Blocking =&gt; 0, PeerAddr =&gt; &#34;google.com&#34;, PeerPort =&gt; 81, Timeout =&gt; 5&#41; or die $@&#39;
IO::Socket::INET: connect: timeout at -e line 1.

real    0m5.095s                                                 
user    0m0.064s
sys     0m0.020s

As you can see for this case IO::Socket::INET makes blocking connection with timeout. IO::Socket::IP just returns immediately. Don&#39;t know about others but I widely used this behaviour, for example: <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/OLEG/Net-Proxy-Type-0.08/lib/Net/Proxy/Type.pm#L575">https://metacpan.org/source/OLEG/Net-Proxy-Type-0.08/lib/Net/Proxy/Type.pm#L575</a></span>

Looks like typo in the docs:
-This behviour is copied directly form `IO::Socket::INET&#39;; for
+This behviour is copied directly from `IO::Socket::INET&#39;; for

P.S.
Hmm, how can I subscribe to this bug, so I can receive notifications about new messages?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;07&nbsp;01:25:15&nbsp;2014</span>
    <span class="description">oleg [...] cpan.org -  Cc OLEG added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;05:05:38&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Sep 07 01:22:00 2014, OLEG wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The behavior when both Blocking =&gt; 0 and Timeout specified not
&gt; compatible with IO::Socket::INET:
&gt; 
&gt; time perl -Ilib -MIO::Socket::IP -E &#39;IO::Socket::IP-&gt;new&#40;Blocking =&gt;
&gt; 0, PeerAddr =&gt; &#34;google.com&#34;, PeerPort =&gt; 81, Timeout =&gt; 5&#41; or die $@&#39;
&gt; 
&gt; real    0m0.097s
&gt; user    0m0.076s
&gt; sys     0m0.012s
&gt; 
&gt; perl -MIO::Socket::INET -E &#39;IO::Socket::INET-&gt;new&#40;Blocking =&gt; 0,
&gt; PeerAddr =&gt; &#34;google.com&#34;, PeerPort =&gt; 81, Timeout =&gt; 5&#41; or die $@&#39;
&gt; IO::Socket::INET: connect: timeout at -e line 1.
&gt; 
&gt; real    0m5.095s
&gt; user    0m0.064s
&gt; sys     0m0.020s
&gt; 
&gt; As you can see for this case IO::Socket::INET makes blocking
&gt; connection with timeout. IO::Socket::IP just returns immediately.
&gt; Don&#39;t know about others but I widely used this behaviour, for example:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/OLEG/Net-Proxy-Type-">https://metacpan.org/source/OLEG/Net-Proxy-Type-</a></span>
&gt; 0.08/lib/Net/Proxy/Type.pm#L575
</div>
Yes; I see it looks different, but I notice that IO::Socket::INET doesn&#39;t specify the interaction between Blocking and Timeout. Having read the implementation it does look as if that&#39;s an unintended bug - the implementor of timeouts in sub connect having just forgotten about the nonblocking case.

I consider the behaviour in IO::Socket::IP to be more useful - that &#39;Blocking&#39; determines if connect will block or just return immediately; if Timeout is also specified it determines the maximum time that it will block for, if it choses to block at all.

My advice here would be simply not to specify both &#39;Blocking =&gt; 0&#39; and a Timeout - if you want to perform nonblocking IO -after- the connect, you can do that simply by

  my $sock = $class-&gt;new&#40; PeerAddr =&gt; ..., Timeout =&gt; $TIME &#41;
    or die &#34;Cannot connect - $@&#34;;
  $sock-&gt;blocking&#40; 0 &#41;;

which will behave the same for IO::Socket::IP or ::INET

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Looks like typo in the docs:
&gt; -This behviour is copied directly form `IO::Socket::INET&#39;; for
&gt; +This behviour is copied directly from `IO::Socket::INET&#39;; for
</div>
Thanks, fixed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; P.S.
&gt; Hmm, how can I subscribe to this bug, so I can receive notifications
&gt; about new messages?
</div>
Add yourself to the &#39;cc&#39; list

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;05:14:22&nbsp;2014</span>
    <span class="description">oleg [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My advice here would be simply not to specify both &#39;Blocking =&gt; 0&#39; and
&gt; a Timeout - if you want to perform nonblocking IO -after- the connect,
&gt; you can do that simply by
&gt; 
&gt; my $sock = $class-&gt;new&#40; PeerAddr =&gt; ..., Timeout =&gt; $TIME &#41;
&gt;   or die &#34;Cannot connect - $@&#34;;
&gt; $sock-&gt;blocking&#40; 0 &#41;;
&gt; 
</div>
For me IO::Socket::INET&#39;s behavior is more like a feature and not a bug. My vote would be to implement same behavior.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;11:30:33&nbsp;2014</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> oleg [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #92075] Timeout parameter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 8 Sep 2014 11:29:43 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Socket-IP [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m with Paul on the Blocking/Timeout case.  If I say &#34;non-blocking&#34; then I
want it actually non-blocking, not &#34;non-blocking, but only after blocking
to connect&#34;.

David
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;13&nbsp;09:53:25&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is now implemented in 0.32, with documentation explaining the slight difference from ::INET with regards to Blocking =&gt; 0 with Timeout.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;13&nbsp;09:53:26&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;13&nbsp;09:53:26&nbsp;2014</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Fixed in 0.32 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
