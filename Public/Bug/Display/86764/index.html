<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #86764 for POEx-HTTP-Server: &#34;New request while we still have a request&#34; leads to fatal error</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #86764 for POEx-HTTP-Server: &#34;New request while we still have a request&#34; leads to fatal error</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=POEx-HTTP-Server">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=POEx-HTTP-Server">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=POEx-HTTP-Server">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=POEx-HTTP-Server">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/POEx-HTTP-Server">POEx-HTTP-Server CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">86764</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=POEx-HTTP-Server">POEx-HTTP-Server</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dzsbsd [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-236110-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-236111-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=86764">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233189" href="/Public/Bug/Display.html?id=86764#txn-1233189">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;07&nbsp;18:48:48&nbsp;2013</span>
    <span class="description">dzsbsd [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#34;New request while we still have a request&#34; leads to fatal error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 7 Jul 2013 15:48:33 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-POEx-HTTP-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dzs Bsd &lt;dzsbsd [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1233189/651701/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/651701">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Using POEx::HTTP::Server v0.0901 with perl 5.8.8, the logic behind
pending_push&#40;&#41; / pending_next&#40;&#41; seems incomplete because reset_req&#40;&#41; is not
called after the first response completes. As such, the second response
leads to the server dying: &#34;Responding more then once to a request at
POEx/HTTP/Server.pm line 1048&#34;

The problem can be trivially created by sending two pipelined requests on
the same socket connection:

{ printf &#34;GET /one HTTP/1.1\nHost:server\n\nGET /two
HTTP/1.1\nHost:server\n\n&#34;;sleep 1; } | nc server 8080

This demonstration requires a sleep because POEx:HTTP doesn&#39;t itself
respond if the client closes its connection first &#40;which looks to be
another bug for you to fix&#41;.

The following patch seems to correct an obvious part of the &#34;new request&#34;
problem. The warn &#34;New request while we still have a request&#34; could also be
removed.

--- POEx/HTTP/Server.pm
+++ POEx/HTTP/Server.pm
@@ -1369,6 +1369,7 @@
 {
     my&#40; $self &#41; = @_;
     return unless $self-&gt;{pending} and @{ $self-&gt;{pending} };
+    $self-&gt;reset_req;
     if&#40; $self-&gt;{S}{shutdown} or $self-&gt;{S}{closing} &#41; {
         $self-&gt;D&#40; &#34;We are closing down with pending requests&#34; &#41;;
         $self-&gt;pending_reply;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1233189/651702/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/651702">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233278" href="/Public/Bug/Display.html?id=86764#txn-1233278">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;08&nbsp;03:13:07&nbsp;2013</span>
    <span class="description">perl [...] pied.nu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1233278/651771/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/651771">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 07 18:48:48 2013, dzsbsd@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&#34;Responding more then once to a request at
&gt; POEx/HTTP/Server.pm line 1048&#34;
</div>
Unfortunatly, I can&#39;t reproduce this problem.  What&#39;s more, I can&#39;t see how you have this problem due to my code.

Client-&gt;respond sets {once} to 1, Client-&gt;reset_req sets it back to 0.  

So the error message you quote can only appear if Client-&gt;respond is called a second time before Client-&gt;reset_req is called.  Client-&gt;reset_req is called from Client-&gt;input, which is called from 
&#40;in this case&#41; from Client-&gt;pending_next, which is called from Client-&gt;flushed, which happens when the Wheel flushes the response.

I other words, Client-&gt;reset_req is called on a flushed event.  So I strongly suspect your second Client-&gt;respond is not from the second request but from a bug in your code.  Either that or it is a subtle timing issue and my dev server isn&#39;t fast enough to trigger it.  Can you turn on cookie crumbs in your code?  Setting DEBUG to 1 at the top of Server.pm will do so in POEx::HTTP::Server.  In particular, a -&gt;respond can come from multiple sources.   We need to find out where the first and second one is coming from and why.

Either that, or I&#39;m missing something.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This demonstration requires a sleep because POEx:HTTP doesn&#39;t itself
&gt; respond if the client closes its connection first &#40;which looks to be
&gt; another bug for you to fix&#41;.
</div>
This is a feature.  Why send a response over a connection we already know is closed?
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233279" href="/Public/Bug/Display.html?id=86764#txn-1233279">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;08&nbsp;03:13:07&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233721" href="/Public/Bug/Display.html?id=86764#txn-1233721">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;08&nbsp;23:59:58&nbsp;2013</span>
    <span class="description">dzsbsd [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #86764] &#34;New request while we still have a request&#34; leads to fatal error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 8 Jul 2013 20:59:45 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-POEx-HTTP-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dzs Bsd &lt;dzsbsd [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1233721/652024/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/652024">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jul 8, 2013 at 12:13 AM, Philip Gwyn via RT &lt;
bug-POEx-HTTP-Server@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunatly, I can&#39;t reproduce this problem.  What&#39;s more, I can&#39;t see
&gt; how you have this problem due to my code.
&gt;
</div>
If second pipelined request is malformed &#40;eg: where the server would
normally respond &#34;Bad request&#34;&#41;, then it dies as I described. Try this
&#40;with the server configured for &#34;keepalive&#34;&#41;:

{ printf &#34;GET /one HTTP/1.1\nHost:server\n\nBad:Request\n\n&#34;; sleep 1; } |
nc server 8080

I thought it failed with two &#34;good&#34; requests, but I may be mistaken and
cannot reproduce that problem now.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This demonstration requires a sleep because POEx:HTTP doesn&#39;t itself
<div class="message-stanza open">&gt; &gt; respond if the client closes its connection first &#40;which looks to be
&gt; &gt; another bug for you to fix&#41;.
</div>&gt; This is a feature.  Why send a response over a connection we already know
&gt; is closed?
&gt;
</div>
The connection is *half closed*. The client is no longer writing but it is
reading. RFC 2616 doesn&#39;t seem clear on this detail, though the Apache HTTP
server seems to support it. Some load balancer heath checks also use this
&#34;half-close&#34; trick &#40;perhaps because it works with Apache&#41;.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1233721/652025/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/652025">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.9k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1233903" href="/Public/Bug/Display.html?id=86764#txn-1233903">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;09&nbsp;11:33:53&nbsp;2013</span>
    <span class="description">perl [...] pied.nu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1233903/652116/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/652116">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 965b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 08 23:59:58 2013, dzsbsd@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; { printf &#34;GET /one HTTP/1.1\nHost:server\n\nBad:Request\n\n&#34;; sleep 1; } |
&gt; nc server 8080
</div>
Well, there&#39;s your problem; just don&#39;t send bad requests!

Seriously, this is something I can fix, as I can reproduce it.  Thank you for finding this bug.  

Could you test out the following dist to see if it fixes it to your satisfaction.
   <span class="clickylink"><a target="new" rel="nofollow" href="http://pied.nu/Perl/POEx-HTTP-Server-0.0902-rc4.tar.gz">http://pied.nu/Perl/POEx-HTTP-Server-0.0902-rc4.tar.gz</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The connection is *half closed*. The client is no longer writing but it is
&gt; reading. RFC 2616 doesn&#39;t seem clear on this detail, though the Apache HTTP
&gt; server seems to support it. Some load balancer heath checks also use this
&gt; &#34;half-close&#34; trick &#40;perhaps because it works with Apache&#41;.
</div>
OK, now I&#39;m confused.  Did you mean closed as in &#34;TCP connection closed&#34; or as in &#34;HTTP Close: header was sent&#34; ?  In the latter case, yes a response should be sent.  In the former... I don&#39;t see how a response could be sent.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1234390" href="/Public/Bug/Display.html?id=86764#txn-1234390">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;22:47:18&nbsp;2013</span>
    <span class="description">dzsbsd [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #86764] &#34;New request while we still have a request&#34; leads to fatal error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Jul 2013 19:46:57 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-POEx-HTTP-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dzs Bsd &lt;dzsbsd [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1234390/652362/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/652362">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Jul 9, 2013 at 8:33 AM, Philip Gwyn via RT &lt;
bug-POEx-HTTP-Server@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could you test out the following dist to see if it fixes it to your
&gt; satisfaction.
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="http://pied.nu/Perl/POEx-HTTP-Server-0.0902-rc4.tar.gz">http://pied.nu/Perl/POEx-HTTP-Server-0.0902-rc4.tar.gz</a></span>
</div>

Yes, this fixes the crash with my bad pipelined requests. Thanks.



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; OK, now I&#39;m confused.  Did you mean closed as in &#34;TCP connection closed&#34;
&gt; or as in &#34;HTTP Close: header was sent&#34; ?  In the latter case, yes a
&gt; response should be sent.  In the former... I don&#39;t see how a response could
&gt; be sent.
&gt;
</div>
I&#39;m referring to just the TCP connection being half closed, not a HTTP
&#34;Connection&#34; header. Version 0.0902-rc4 does change the behavior so
responses from the following are received reliably. Nice work!

printf &#34;GET /a HTTP/1.1\nHost:localhost\n\nGET /b
HTTP/1.1\nHost:localhost\n\n&#34; | time nc localhost 8080
        5.14 real         0.00 user         0.00 sys

However, the server waits keepalivetimeout seconds &#40;5&#41; before finally
closing its response connection. This wait is unnecessary because the
client closed its request side earlier. The same test with an Apache server
closes immediately after the last response &#40;eg: 0.00 real&#41;.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1234390/652363/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/652363">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1234392" href="/Public/Bug/Display.html?id=86764#txn-1234392">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;23:03:08&nbsp;2013</span>
    <span class="description">perl [...] pied.nu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1234392/652365/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/652365">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 615b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 10 22:47:18 2013, dzsbsd@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m referring to just the TCP connection being half closed, not a HTTP
&gt; &#34;Connection&#34; header. Version 0.0902-rc4 does change the behavior so
&gt; responses from the following are received reliably. Nice work!
</div>
Hahahaha!  Aren&#39;t I a genius!  Uh. now wait.  What I mean is : I have no idea 
&#40;now&#41; what I changed to make this the case.  Maybe I did back when I changed it.

Anyway, glad you like this RC.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, the server waits keepalivetimeout seconds &#40;5&#41; before finally
&gt; closing its response connection.
</div>
Do you know how to detect half closed connections?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1257883" href="/Public/Bug/Display.html?id=86764#txn-1257883">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;03&nbsp;14:55:36&nbsp;2013</span>
    <span class="description">perl [...] pied.nu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1257883/665933/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/665933">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 39b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">At long last, 0.902 is now on the CPAN.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1257885" href="/Public/Bug/Display.html?id=86764#txn-1257885">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;03&nbsp;14:55:37&nbsp;2013</span>
    <span class="description">perl [...] pied.nu -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.476359</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
