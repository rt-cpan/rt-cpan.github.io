<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33811 for XML-LibXML: need for ::Text filter</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33811 for XML-LibXML: need for ::Text filter</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-LibXML">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-LibXML">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-LibXML">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-LibXML">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML">XML-LibXML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33811</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-LibXML">XML-LibXML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MARKOV [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-37350-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.66    </td>
  </tr>
  <tr id="CF-37351-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=33811">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430437" href="/Public/Bug/Display.html?id=33811#txn-430437">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;04&nbsp;16:54:03&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> need for ::Text filter</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/430437/210626/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210626">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 419b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">XML::Compile walks through many XML documents where white-space is
unimportant.  However, now it has to skip over ::Text nodes which are
produced by the XML::LibXML::Parser.

It would be nice to have a
    $node-&gt;getNonTextChilds
and $node-&gt;firstNonTextChild
and $node-&gt;nextNonTextChild

This would reduce the number of expensive Perl &lt;-&gt; library interactions
&#40;speeding-up the application&#41;, and simplify my code a lot. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430451" href="/Public/Bug/Display.html?id=33811#txn-430451">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;04&nbsp;17:15:37&nbsp;2008</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/430451/210638/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210638">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 582b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Ãºt 04.bÅ™e.2008 16:54:03, MARKOV napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; XML::Compile walks through many XML documents where white-space is
&gt; unimportant.  However, now it has to skip over ::Text nodes which are
&gt; produced by the XML::LibXML::Parser.
&gt; 
&gt; It would be nice to have a
&gt;     $node-&gt;getNonTextChilds
&gt; and $node-&gt;firstNonTextChild
&gt; and $node-&gt;nextNonTextChild
&gt; 
&gt; This would reduce the number of expensive Perl &lt;-&gt; library 
</div>interactions
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;speeding-up the application&#41;, and simplify my code a lot. 
</div>
What about using $parser-&gt;keep_blanks&#40;0&#41;; ? Isn&#39;t that what you want 
instead?

-- Petr
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430452" href="/Public/Bug/Display.html?id=33811#txn-430452">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;04&nbsp;17:15:38&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430455" href="/Public/Bug/Display.html?id=33811#txn-430455">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;04&nbsp;17:25:24&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 4 Mar 2008 23:24:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Petr Pajas via RT &lt;bug-XML-LibXML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/430455/210641/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210641">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Petr Pajas via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080304 22:15]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33811">http://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; 
&gt; Dne Ãºt 04.bÅ™e.2008 16:54:03, MARKOV napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; XML::Compile walks through many XML documents where white-space is
&gt; &gt; unimportant.  However, now it has to skip over ::Text nodes which are
&gt; &gt; produced by the XML::LibXML::Parser.
&gt; &gt; 
&gt; &gt; It would be nice to have a
&gt; &gt;     $node-&gt;getNonTextChilds
&gt; &gt; and $node-&gt;firstNonTextChild
&gt; &gt; and $node-&gt;nextNonTextChild
</div>&gt; 
&gt; What about using $parser-&gt;keep_blanks&#40;0&#41;; ? Isn&#39;t that what you want 
&gt; instead?
</div>
I didn&#39;t find that one before.  You&#39;re a genious ;-&#41;
But how does that behave in a &#39;mixed&#39; element?  Can you switch it
on and off at will while walking through the tree?
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430634" href="/Public/Bug/Display.html?id=33811#txn-430634">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;05&nbsp;02:57:39&nbsp;2008</span>
    <span class="description">christian.glahn [...] lo-f.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 05 Mar 2008 08:58:16 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Glahn &lt;christian.glahn [...] lo-f.at&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/430634/210688/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210688">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

On Tue, 2008-03-04 at 17:25 -0500, Mark Overmeer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: XML-LibXML
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33811">http://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; 
&gt; * Petr Pajas via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080304 22:15]:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33811">http://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; &gt; 
&gt; &gt; Dne Ãºt 04.bÅ™e.2008 16:54:03, MARKOV napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; &gt; XML::Compile walks through many XML documents where white-space is
&gt; &gt; &gt; unimportant.  However, now it has to skip over ::Text nodes which are
&gt; &gt; &gt; produced by the XML::LibXML::Parser.
&gt; &gt; &gt; 
&gt; &gt; &gt; It would be nice to have a
&gt; &gt; &gt;     $node-&gt;getNonTextChilds
&gt; &gt; &gt; and $node-&gt;firstNonTextChild
&gt; &gt; &gt; and $node-&gt;nextNonTextChild
</div>&gt; &gt; 
&gt; &gt; What about using $parser-&gt;keep_blanks&#40;0&#41;; ? Isn&#39;t that what you want 
&gt; &gt; instead?
</div>&gt; 
&gt; I didn&#39;t find that one before.  You&#39;re a genious ;-&#41;
&gt; But how does that behave in a &#39;mixed&#39; element?  Can you switch it
&gt; on and off at will while walking through the tree?
</div>
Keep blanks is a parse time option. I.e. the parser removes what is
called by the specs &#34;ignorable whitespace&#34;. The behavior of this feature
may lead to unexpected results &#40;which are conforming the specs&#41;. It also
means that you cannot switch it on or off once the XML has been parsed. 

However, to me the problem sounds a bit like a &#34;tree walker&#34; problem,
which the iterator module tries to address. That would mean that you use
an iterator on XPath results for traversing the DOM data structure
instead of working directly on the DOM. This gives you greater
flexibility than DOM would do alone. 

Therefore, I think that you should have a look at the DOM Iterator specs
at W3.org and the XML::LibXML::Iterator Module. 

Cheers 
Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430796" href="/Public/Bug/Display.html?id=33811#txn-430796">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;05&nbsp;14:24:35&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 Mar 2008 20:00:11 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Glahn via RT &lt;bug-XML-LibXML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/430796/210782/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210782">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Christian Glahn via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080305 07:57]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; It would be nice to have a
&gt; &gt; &gt; &gt;     $node-&gt;getNonTextChilds
&gt; &gt; &gt; &gt; and $node-&gt;firstNonTextChild
&gt; &gt; &gt; &gt; and $node-&gt;nextNonTextChild
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; What about using $parser-&gt;keep_blanks&#40;0&#41;; ? Isn&#39;t that what you want 
&gt; &gt; &gt; instead?
</div></div> 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Keep blanks is a parse time option.
</div>
Then not usable for me.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, to me the problem sounds a bit like a &#34;tree walker&#34; problem,
&gt; which the iterator module tries to address.
&gt; 
&gt; Therefore, I think that you should have a look at the DOM Iterator specs
&gt; at W3.org and the XML::LibXML::Iterator Module. 
</div>
On the moment, I do have an iterator implementation, which is a bit more
suitable for my needs: XML::Compile::Iterator.  However, my point is that
it retrieves a lot more nodes from the library than it needs to, which
is costly.  Every Perl iterator implementation is costly.  So therefore
my request for a simple way to only get the non-text child-nodes.

The only thing I really need is a simplification for
  my @childs = grep { ! $_-&gt;isa&#40;&#39;XML::LibXML::Text&#39;&#41; } $node-&gt;getChilds;
It would reduce the number of objects to be created &#40;and skipped by me&#41;
by half.  But I need this per node, so keep_blanks is apparently no option.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430886" href="/Public/Bug/Display.html?id=33811#txn-430886">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;05&nbsp;18:05:58&nbsp;2008</span>
    <span class="description">christian.glahn [...] lo-f.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 06 Mar 2008 00:06:31 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Glahn &lt;christian.glahn [...] lo-f.at&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/430886/210835/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210835">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Wed, 2008-03-05 at 14:24 -0500, Mark Overmeer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: XML-LibXML
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33811">http://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; 
&gt; * Christian Glahn via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080305 07:57]:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; It would be nice to have a
&gt; &gt; &gt; &gt; &gt;     $node-&gt;getNonTextChilds
&gt; &gt; &gt; &gt; &gt; and $node-&gt;firstNonTextChild
&gt; &gt; &gt; &gt; &gt; and $node-&gt;nextNonTextChild
</div></div>&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; What about using $parser-&gt;keep_blanks&#40;0&#41;; ? Isn&#39;t that what you want 
&gt; &gt; &gt; &gt; instead?
</div></div>&gt;  
<div class="message-stanza open">&gt; &gt; Keep blanks is a parse time option.
</div>&gt; 
&gt; Then not usable for me.
&gt; 
<div class="message-stanza open">&gt; &gt; However, to me the problem sounds a bit like a &#34;tree walker&#34; problem,
&gt; &gt; which the iterator module tries to address.
&gt; &gt; 
&gt; &gt; Therefore, I think that you should have a look at the DOM Iterator specs
&gt; &gt; at W3.org and the XML::LibXML::Iterator Module. 
</div>&gt; 
&gt; On the moment, I do have an iterator implementation, which is a bit more
&gt; suitable for my needs: XML::Compile::Iterator.  However, my point is that
&gt; it retrieves a lot more nodes from the library than it needs to, which
&gt; is costly.  Every Perl iterator implementation is costly.  So therefore
&gt; my request for a simple way to only get the non-text child-nodes.
&gt; 
&gt; The only thing I really need is a simplification for
&gt;   my @childs = grep { ! $_-&gt;isa&#40;&#39;XML::LibXML::Text&#39;&#41; } $node-&gt;getChilds;
&gt; It would reduce the number of objects to be created &#40;and skipped by me&#41;
&gt; by half.  But I need this per node, so keep_blanks is apparently no option.
</div>
you may also try to use the findnodes&#40;&#41; function of XML::LibXML with 
the following expression: 

my @childElements = $node-&gt;findnodes&#40; &#39;*[not&#40;self::text&#40;&#41;&#41;]&#39; &#41;;

this expression removes all text nodes from the child nodes of a 
node, and should be a tiny bit faster than the expression you use, 
because it runs entirely on libxml2 level. However, I did not benchmark it. 

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-430898" href="/Public/Bug/Display.html?id=33811#txn-430898">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;05&nbsp;18:43:11&nbsp;2008</span>
    <span class="description">christian.glahn [...] lo-f.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 06 Mar 2008 00:43:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Glahn &lt;christian.glahn [...] lo-f.at&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/430898/210849/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210849">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I got curious if I produced complete non-sense in my previous reply and 
so benchmark all three options for filtering child elements.

To my own surprise I got the following results:

-----8&lt;-----8&lt;------8&lt;------8&lt;------

$ time perl -MXML::LibXML \
-e &#39;$doc = XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;/a&gt;&#34;&#41;;
@n = grep { !$_-&gt;isa&#40;&#34;XML::LibXML::TextNode&#34;&#41;}
$doc-&gt;documentElement&#40;&#41;-&gt;childNodes&#40;&#41; for &#40;1..100000&#41;;&#39;

real    0m3.762s
user    0m3.752s
sys     0m0.008s

$ time perl -MXML::LibXML \
-e &#39;$doc = XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;/a&gt;&#34;&#41;;
@n = grep { $_-&gt;nodeType != XML_TEXT_NODE }
$doc-&gt;documentElement&#40;&#41;-&gt;childNodes&#40;&#41; for &#40;1..100000&#41;;&#39;

real    0m4.024s
user    0m3.992s
sys     0m0.032s

$ time perl -MXML::LibXML \
-e &#39;$doc = XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;/a&gt;&#34;&#41;;
@n = $doc-&gt;documentElement&#40;&#41;-&gt;findnodes&#40; &#34;*[not&#40;self::text&#40;&#41;&#41;]&#34;&#41; 
for &#40;1..100000&#41;;&#39;

real    0m5.705s
user    0m5.668s
sys     0m0.036s

-----8&lt;-----8&lt;------8&lt;------8&lt;------

In order to be sure I increased the number of child nodes. The result is
the following: 

-----8&lt;-----8&lt;------8&lt;------8&lt;------

$ time perl -MXML::LibXML -e &#39;$doc = XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;/a&gt;&#34;&#41;; @n =
$doc-&gt;documentElement&#40;&#41;-&gt;findnodes&#40; &#34;*[not&#40;self::text&#40;&#41;&#41;]&#34;&#41; for
&#40;1..100000&#41;;&#39;

real    0m9.785s
user    0m9.721s
sys     0m0.060s

$ time perl -MXML::LibXML -e &#39;$doc = XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;  &lt;/a&gt;&#34;&#41;; @n = grep { !
$_-&gt;isa&#40;&#34;XML::LibXML::TextNode&#34;&#41;} $doc-&gt;documentElement&#40;&#41;-&gt;childNodes&#40;&#41;
for &#40;1..100000&#41;;&#39;

real    0m13.276s
user    0m13.197s
sys     0m0.080s

$ time perl -MXML::LibXML -e &#39;$doc = XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;/a&gt;&#34;&#41;; @n = grep { $_-&gt;nodeType !=
XML_TEXT_NODE } $doc-&gt;documentElement&#40;&#41;-&gt;childNodes&#40;&#41; for &#40;1..100000&#41;;&#39;

real    0m14.687s
user    0m14.589s
sys     0m0.100s

-----8&lt;-----8&lt;------8&lt;------8&lt;------

The results mean that on small numbers of child nodes, the XPath
overhead masks its selection performance, while with increasing numbers
of child nodes the library&#39;s XPath engine outperforms perl&#39;s grep.

Christian

On Wed, 2008-03-05 at 18:05 -0500, Christian Glahn via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: XML-LibXML
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33811">http://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; 
&gt; 
&gt; On Wed, 2008-03-05 at 14:24 -0500, Mark Overmeer via RT wrote:
<div class="message-stanza open">&gt; &gt; Queue: XML-LibXML
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33811">http://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; &gt; 
&gt; &gt; * Christian Glahn via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080305 07:57]:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; It would be nice to have a
&gt; &gt; &gt; &gt; &gt; &gt;     $node-&gt;getNonTextChilds
&gt; &gt; &gt; &gt; &gt; &gt; and $node-&gt;firstNonTextChild
&gt; &gt; &gt; &gt; &gt; &gt; and $node-&gt;nextNonTextChild
</div></div>&gt; &gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; What about using $parser-&gt;keep_blanks&#40;0&#41;; ? Isn&#39;t that what you want 
&gt; &gt; &gt; &gt; &gt; instead?
</div></div>&gt; &gt;  
<div class="message-stanza open">&gt; &gt; &gt; Keep blanks is a parse time option.
</div>&gt; &gt; 
&gt; &gt; Then not usable for me.
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; However, to me the problem sounds a bit like a &#34;tree walker&#34; problem,
&gt; &gt; &gt; which the iterator module tries to address.
&gt; &gt; &gt; 
&gt; &gt; &gt; Therefore, I think that you should have a look at the DOM Iterator specs
&gt; &gt; &gt; at W3.org and the XML::LibXML::Iterator Module. 
</div>&gt; &gt; 
&gt; &gt; On the moment, I do have an iterator implementation, which is a bit more
&gt; &gt; suitable for my needs: XML::Compile::Iterator.  However, my point is that
&gt; &gt; it retrieves a lot more nodes from the library than it needs to, which
&gt; &gt; is costly.  Every Perl iterator implementation is costly.  So therefore
&gt; &gt; my request for a simple way to only get the non-text child-nodes.
&gt; &gt; 
&gt; &gt; The only thing I really need is a simplification for
&gt; &gt;   my @childs = grep { ! $_-&gt;isa&#40;&#39;XML::LibXML::Text&#39;&#41; } $node-&gt;getChilds;
&gt; &gt; It would reduce the number of objects to be created &#40;and skipped by me&#41;
&gt; &gt; by half.  But I need this per node, so keep_blanks is apparently no option.
</div>&gt; 
&gt; you may also try to use the findnodes&#40;&#41; function of XML::LibXML with 
&gt; the following expression: 
&gt; 
&gt; my @childElements = $node-&gt;findnodes&#40; &#39;*[not&#40;self::text&#40;&#41;&#41;]&#39; &#41;;
&gt; 
&gt; this expression removes all text nodes from the child nodes of a 
&gt; node, and should be a tiny bit faster than the expression you use, 
&gt; because it runs entirely on libxml2 level. However, I did not benchmark it. 
&gt; 
&gt; Christian
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-431099" href="/Public/Bug/Display.html?id=33811#txn-431099">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;06&nbsp;04:25:23&nbsp;2008</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/431099/210919/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/210919">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 164b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Christian,

what baffles me completely about this is that 
$node-&gt;isa&#40;&#34;XML::LibXML::Text&#34;&#41; seems to be faster than 
$node-&gt;nodeType == XML_LIBXML_TEXT.

-- Petr
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-431303" href="/Public/Bug/Display.html?id=33811#txn-431303">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;06&nbsp;14:00:45&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 6 Mar 2008 19:59:47 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Glahn via RT &lt;bug-XML-LibXML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/431303/211058/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/211058">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Christian Glahn via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080305 23:43]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I got curious if I produced complete non-sense in my previous reply and 
&gt; so benchmark all three options for filtering child elements.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; grep { !$_-&gt;isa&#40;&#34;XML::LibXML::TextNode&#34;&#41;}
&gt; user    0m3.752s
&gt; 
&gt; grep { $_-&gt;nodeType != XML_TEXT_NODE }
&gt; user    0m3.992s
</div>
As Petr already mentioned, the call to nodeType&#40;&#41; is more expensive
than the isa&#40;&#41;.  Probably this is caused by the delay in the XS
layer which creates an SV, where isa&#40;&#41; is a simple lookup.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; @n = $doc-&gt;documentElement&#40;&#41;-&gt;findnodes&#40; &#34;*[not&#40;self::text&#40;&#41;&#41;]&#34;&#41; 
&gt; user    0m5.668s
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In order to be sure I increased the number of child nodes.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $doc-&gt;documentElement&#40;&#41;-&gt;findnodes&#40; &#34;*[not&#40;self::text&#40;&#41;&#41;]&#34;&#41;
&gt; user    0m9.721s
&gt; 
&gt; grep { ! $_-&gt;isa&#40;&#34;XML::LibXML::TextNode&#34;&#41;}
&gt; user    0m13.197s
&gt; 
&gt; grep { $_-&gt;nodeType != &gt; XML_TEXT_NODE }
&gt; user    0m14.589s
&gt; 
&gt; The results mean that on small numbers of child nodes, the XPath
&gt; overhead masks its selection performance, while with increasing numbers
&gt; of child nodes the library&#39;s XPath engine outperforms perl&#39;s grep.
</div>
This is exactly my point: even an expensive xpath expression in the
C library is faster than a simple filter in Perl.  Probably a simple
C expression will gain even more.
But the most important gain is in simpler Perl code.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
drs Mark A.C.J. Overmeer                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-431306" href="/Public/Bug/Display.html?id=33811#txn-431306">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;06&nbsp;14:02:16&nbsp;2008</span>
    <span class="description">christian.glahn [...] lo-f.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 06 Mar 2008 20:02:33 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Glahn &lt;christian.glahn [...] lo-f.at&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/431306/211061/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/211061">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 761b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Petr,

On Thu, 2008-03-06 at 04:25 -0500, Petr Pajas via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: XML-LibXML
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33811">http://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; 
&gt; Hi Christian,
&gt; 
&gt; what baffles me completely about this is that 
&gt; $node-&gt;isa&#40;&#34;XML::LibXML::Text&#34;&#41; seems to be faster than 
&gt; $node-&gt;nodeType == XML_LIBXML_TEXT.
</div>
I was surprised, too. I expected that an integer comparison would be
faster. Maybe someone has a look into the isa&#40;&#41; implementation ;&#41;

By the way, another remark for Mark.

You may speed up the XPath based text node filtering, if you use Petr&#39;s
XML::LibXML::XPathContext class and use the same pre-compiled xpath
statement for each request. This will reduce some of the overhead that
is part of the findnodes&#40;&#41; function.

Christian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-431576" href="/Public/Bug/Display.html?id=33811#txn-431576">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;07&nbsp;10:32:21&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Mar 2008 15:58:20 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Glahn via RT &lt;bug-XML-LibXML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/431576/211195/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/211195">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Christian Glahn via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080306 19:02]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; $node-&gt;isa&#40;&#34;XML::LibXML::Text&#34;&#41; seems to be faster than 
&gt; &gt; $node-&gt;nodeType == XML_LIBXML_TEXT.
</div>&gt; 
&gt; I was surprised, too. I expected that an integer comparison would be
&gt; faster. Maybe someone has a look into the isa&#40;&#41; implementation ;&#41;
&gt; 
&gt; You may speed up the XPath based text node filtering, if you use Petr&#39;s
&gt; XML::LibXML::XPathContext class and use the same pre-compiled xpath
&gt; statement for each request. This will reduce some of the overhead that
&gt; is part of the findnodes&#40;&#41; function.
</div>
99.9% of the coders will only use preformance improvements if they
are easy to use and easy to maintain.  This XPath work-around is quite
tricky.  The requirement to selectively skip text nodes is required in
all document-style XML readers which are schema based.  So: a simple
extension to the interface as requested is useful for many.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-672187" href="/Public/Bug/Display.html?id=33811#txn-672187">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;12:28:45&nbsp;2009</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/672187/345568/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/345568">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, returning to this bug, I wonder that maybe what you actually want is
$node-&gt;getChildrenByTagNameNS. This method is implemented in C, very
fast, exp. when used with wildcards for both local-name and namespace,
see this comparison:

time perl -MXML::LibXML -e &#39;$doc =
XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;findnodes&#40; &#34;*[not&#40;self::text&#40;&#41;&#41;]&#34;&#41;
for &#40;1..100000&#41;;&#39;

real    0m4.669s
user    0m4.632s
sys     0m0.028s
pajas@stain: ~/projects/XML-LibXML-devel/XML-LibXML
$ time perl -MXML::LibXML -e &#39;$doc =
XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;getChildrenByTagNameNS&#40;q&#40;* *&#41;&#41; for
&#40;1..100000&#41;;&#39;

real    0m0.867s
user    0m0.836s
sys     0m0.016s

On the other hand, what you ask for in this ticket is just filter out
text nodes, whereas this method filters out everything but elements
&#40;text nodes, cdata, comments, PIs&#41;.

I&#39;m not actually willing to add exactly the methods you ask for, since
they skip all text nodes &#40;that may or may not contain data&#41;. Next time
somebody will ask for methods that filter out comments, cdata, PIs, etc.
or some specific subset of these.

On the other hand I believe the actual common use case is iterating over
non-blank child nodes, i.e. child nodes that are either of other type
than text or are text nodes containing only white-space. So what about
adding these &#40;non-DOM&#41; methods:

firstNonBlankChild, nextNonBlankSibling and previousNonBlankSibling

Please comment,

-- Petr

Dne pÃ¡ 07.bÅ™e.2008 10:32:21, Mark@Overmeer.net napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Christian Glahn via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080306 19:02]:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; $node-&gt;isa&#40;&#34;XML::LibXML::Text&#34;&#41; seems to be faster than 
&gt; &gt; &gt; $node-&gt;nodeType == XML_LIBXML_TEXT.
</div>&gt; &gt; 
&gt; &gt; I was surprised, too. I expected that an integer comparison would be
&gt; &gt; faster. Maybe someone has a look into the isa&#40;&#41; implementation ;&#41;
&gt; &gt; 
&gt; &gt; You may speed up the XPath based text node filtering, if you use Petr&#39;s
&gt; &gt; XML::LibXML::XPathContext class and use the same pre-compiled xpath
&gt; &gt; statement for each request. This will reduce some of the overhead that
&gt; &gt; is part of the findnodes&#40;&#41; function.
</div>&gt; 
&gt; 99.9% of the coders will only use preformance improvements if they
&gt; are easy to use and easy to maintain.  This XPath work-around is quite
&gt; tricky.  The requirement to selectively skip text nodes is required in
&gt; all document-style XML readers which are schema based.  So: a simple
&gt; extension to the interface as requested is useful for many.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-672313" href="/Public/Bug/Display.html?id=33811#txn-672313">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;17:22:03&nbsp;2009</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/672313/345656/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/345656">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please try the SVN version if you can, possibly providing feedback by
reopening this bug. I added four new convenience methods:
nonBlankChildNodes, firstNonBlankChild, nextNonBlankSibling,
previousNonBlankSibling.

I&#39;m using xmlIsNonBlank to test for &#34;blankness&#34;. It considers empty or
white-space only Text or CDATA nodes as blanks. My first idea was that
CDATA should never be considered blank, but that actually depends on the
model and the parser has a flag to turn CDATA into text nodes, so it
actually makes no sense to make the distinction.

-- p

Dne ne 04.Å™Ã­j.2009 12:28:45, PAJAS napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi, returning to this bug, I wonder that maybe what you actually want is
&gt; $node-&gt;getChildrenByTagNameNS. This method is implemented in C, very
&gt; fast, exp. when used with wildcards for both local-name and namespace,
&gt; see this comparison:
&gt; 
&gt; time perl -MXML::LibXML -e &#39;$doc =
&gt; XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;findnodes&#40; &#34;*[not&#40;self::text&#40;&#41;&#41;]&#34;&#41;
&gt; for &#40;1..100000&#41;;&#39;
&gt; 
&gt; real    0m4.669s
&gt; user    0m4.632s
&gt; sys     0m0.028s
&gt; pajas@stain: ~/projects/XML-LibXML-devel/XML-LibXML
&gt; $ time perl -MXML::LibXML -e &#39;$doc =
&gt; XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;getChildrenByTagNameNS&#40;q&#40;* *&#41;&#41; for
&gt; &#40;1..100000&#41;;&#39;
&gt; 
&gt; real    0m0.867s
&gt; user    0m0.836s
&gt; sys     0m0.016s
&gt; 
&gt; On the other hand, what you ask for in this ticket is just filter out
&gt; text nodes, whereas this method filters out everything but elements
&gt; &#40;text nodes, cdata, comments, PIs&#41;.
&gt; 
&gt; I&#39;m not actually willing to add exactly the methods you ask for, since
&gt; they skip all text nodes &#40;that may or may not contain data&#41;. Next time
&gt; somebody will ask for methods that filter out comments, cdata, PIs, etc.
&gt; or some specific subset of these.
&gt; 
&gt; On the other hand I believe the actual common use case is iterating over
&gt; non-blank child nodes, i.e. child nodes that are either of other type
&gt; than text or are text nodes containing only white-space. So what about
&gt; adding these &#40;non-DOM&#41; methods:
&gt; 
&gt; firstNonBlankChild, nextNonBlankSibling and previousNonBlankSibling
&gt; 
&gt; Please comment,
&gt; 
&gt; -- Petr
&gt; 
&gt; Dne pÃ¡ 07.bÅ™e.2008 10:32:21, Mark@Overmeer.net napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; * Christian Glahn via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [080306 19:02]:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; $node-&gt;isa&#40;&#34;XML::LibXML::Text&#34;&#41; seems to be faster than 
&gt; &gt; &gt; &gt; $node-&gt;nodeType == XML_LIBXML_TEXT.
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; I was surprised, too. I expected that an integer comparison would be
&gt; &gt; &gt; faster. Maybe someone has a look into the isa&#40;&#41; implementation ;&#41;
&gt; &gt; &gt; 
&gt; &gt; &gt; You may speed up the XPath based text node filtering, if you use
</div></div></div>Petr&#39;s
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; XML::LibXML::XPathContext class and use the same pre-compiled xpath
&gt; &gt; &gt; statement for each request. This will reduce some of the overhead that
&gt; &gt; &gt; is part of the findnodes&#40;&#41; function.
</div>&gt; &gt; 
&gt; &gt; 99.9% of the coders will only use preformance improvements if they
&gt; &gt; are easy to use and easy to maintain.  This XPath work-around is quite
&gt; &gt; tricky.  The requirement to selectively skip text nodes is required in
&gt; &gt; all document-style XML readers which are schema based.  So: a simple
&gt; &gt; extension to the interface as requested is useful for many.
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-672316" href="/Public/Bug/Display.html?id=33811#txn-672316">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;17:22:05&nbsp;2009</span>
    <span class="description">pajas [...] matfyz.cz -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-672325" href="/Public/Bug/Display.html?id=33811#txn-672325">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;18:04:13&nbsp;2009</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33811] need for ::Text filter</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 5 Oct 2009 00:03:52 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Petr Pajas via RT &lt;bug-XML-LibXML [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/672325/345670/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/345670">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Petr Pajas via RT &#40;bug-XML-LibXML@rt.cpan.org&#41; [091004 16:28]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=33811">https://rt.cpan.org/Ticket/Display.html?id=33811</a></span> &gt;
&gt; time perl -MXML::LibXML -e &#39;$doc =
&gt; XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;findnodes&#40; &#34;*[not&#40;self::text&#40;&#41;&#41;]&#34;&#41;
&gt; for &#40;1..100000&#41;;&#39;
&gt; 
&gt; real    0m4.669s
&gt; user    0m4.632s
&gt; sys     0m0.028s
</div>
This is over 20% faster than my current
$ time perl -MXML::LibXML -e &#39;$doc =
XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;/a&gt;&#34;&#41;; @n = grep {$_-&gt;isa&#40;&#34;XML::LibXML::Element&#34;&#41;} $doc-&gt;documentElement&#40;&#41;-&gt;childNodes for &#40;1..100000&#41;;&#39;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; pajas@stain: ~/projects/XML-LibXML-devel/XML-LibXML
&gt; $ time perl -MXML::LibXML -e &#39;$doc =
&gt; XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;getChildrenByTagNameNS&#40;q&#40;* *&#41;&#41; for
&gt; &#40;1..100000&#41;;&#39;
&gt; 
&gt; real    0m0.867s
&gt; user    0m0.836s
&gt; sys     0m0.016s
</div>
This is faster, but does not collect any elements in @n. Mistake?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not actually willing to add exactly the methods you ask for, since
&gt; they skip all text nodes &#40;that may or may not contain data&#41;. Next time
&gt; somebody will ask for methods that filter out comments, cdata, PIs, etc.
&gt; or some specific subset of these.
</div>
Yes, this is a sane expectation.  White-space layout however, does have
a special role in XML.  It is the difference between toString&#40;1&#41; and
toString&#40;0&#41;.  Besides, we doe have a switch for it on $parser level:
   $parser-&gt;keep_blanks&#40;0&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On the other hand I believe the actual common use case is iterating over
&gt; non-blank child nodes, i.e. child nodes that are either of other type
&gt; than text or are text nodes containing only white-space. So what about
&gt; adding these &#40;non-DOM&#41; methods:
&gt; 
&gt; firstNonBlankChild, nextNonBlankSibling and previousNonBlankSibling
</div>
For me, I would favor nonBlankChilds&#40;&#41;: as few XS calls as possible.
It would probably save a considerable amount of time.  Based on some
$read_mixed_data parameter, I need to switch between the &#34;take blanks&#34;
and &#34;not take blanks&#34; calls.

But this may be the start of a &#34;method flood&#34; as you expected.

Wouldn&#39;t it be a smart move to add filter options like this:
  $node-&gt;childNodes&#40;XML_NON_BLANK_TEXT|XML_PI|XML_ELEMENT&#41;;
or a more general
  $parser-&gt;nodeFilter&#40;XML_NON_BLANK_TEXT|XML_ELEMENT&#41;;
  $node-&gt;childNodes&#40;&#41;;

Of course, this would impact a lot of methods, which all need to
call the filter before returning elements. Not as &#39;parse-time&#39; option,
but run-time filter. But I expect that quite a lot of programs have
to implement this filtering now by themselves.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-672326" href="/Public/Bug/Display.html?id=33811#txn-672326">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;18:04:13&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-672329" href="/Public/Bug/Display.html?id=33811#txn-672329">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;19:05:36&nbsp;2009</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/672329/345673/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/345673">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne ne 04.Å™Ã­j.2009 18:04:13, Mark@Overmeer.net napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; pajas@stain: ~/projects/XML-LibXML-devel/XML-LibXML
&gt; &gt; $ time perl -MXML::LibXML -e &#39;$doc =
&gt; &gt; XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&gt; &gt; &lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;getChildrenByTagNameNS&#40;q&#40;* *&#41;&#41;
</div>&gt; for
<div class="message-stanza open">&gt; &gt; &#40;1..100000&#41;;&#39;
&gt; &gt;
&gt; &gt; real    0m0.867s
&gt; &gt; user    0m0.836s
&gt; &gt; sys     0m0.016s
</div>&gt; 
&gt; This is faster, but does not collect any elements in @n. Mistake?
</div>

Opps, written q&#40;* *&#41; where I meant qw&#40;* *&#41;, i.e. &#40;&#39;*&#39;,&#39;*&#39;&#41;. The
benchmark should read:

time perl -MXML::LibXML -e &#39;$doc =
XML::LibXML-&gt;new-&gt;parse_string&#40;&#34;&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt; &lt;b&gt;&lt;c/&gt;&lt;/b&gt; &lt;d/&gt;
&lt;/a&gt;&#34;&#41;; @n =$doc-&gt;documentElement&#40;&#41;-&gt;getChildrenByTagNameNS&#40;qw&#40;* *&#41;&#41; for
&#40;1..100000&#41;;&#39;

real    0m2.427s
user    0m2.328s
sys     0m0.044s

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; On the other hand I believe the actual common use case is iterating
</div>&gt; over
<div class="message-stanza open">&gt; &gt; non-blank child nodes, i.e. child nodes that are either of other
</div>&gt; type
<div class="message-stanza open">&gt; &gt; than text or are text nodes containing only white-space. So what
</div>&gt; about
<div class="message-stanza open">&gt; &gt; adding these &#40;non-DOM&#41; methods:
&gt; &gt;
&gt; &gt; firstNonBlankChild, nextNonBlankSibling and previousNonBlankSibling
</div>&gt; 
&gt; For me, I would favor nonBlankChilds&#40;&#41;: as few XS calls as possible.
</div>
yes, I added that one too &#40;as nonBlankChildNodes&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It would probably save a considerable amount of time. 
</div>
It&#39;s in the SVN, benchmark for real. On the above test case I get
similar results to getChildrenByTagNameNS&#40;qw&#40;* *&#41;&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Based on some
&gt; $read_mixed_data parameter, I need to switch between the &#34;take blanks&#34;
&gt; and &#34;not take blanks&#34; calls.
&gt; 
&gt; But this may be the start of a &#34;method flood&#34; as you expected.
&gt; 
&gt; Wouldn&#39;t it be a smart move to add filter options like this:
&gt;   $node-&gt;childNodes&#40;XML_NON_BLANK_TEXT|XML_PI|XML_ELEMENT&#41;;
</div>
Maybe, but this starts to be real ugly. First this modifies/extends a
method defined by the DOM spec which can be extended by some future DOM
spec in a different manner, so it would better be a different method;
2nd it adds another set of constants &#40;the nodetype contsants can&#39;t be
or-ed&#41;, etc. etc. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; or a more general
&gt;   $parser-&gt;nodeFilter&#40;XML_NON_BLANK_TEXT|XML_ELEMENT&#41;;
&gt;   $node-&gt;childNodes&#40;&#41;;
</div>
This won&#39;t work:-&#41; The parser object does not serve as a pool of global
variables to other parts of the interface. Once the DOM tree is built it
has no relation to it. It is just a parser.

And in fact, modifying global behavior in this way is generally a bad
idea since you don&#39;t know what other components of the program may be
using the module and expect it to behave differently.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Of course, this would impact a lot of methods, which all need to
&gt; call the filter before returning elements. 
&gt; Not as &#39;parse-time&#39; option,
&gt; but run-time filter. But I expect that quite a lot of programs have
&gt; to implement this filtering now by themselves.
</div>
Generally, a really bad idea from where I&#39;m standing!

To sum up, something like
$node-&gt;childNodes&#40;XML_NON_BLANK_TEXT|XML_PI|XML_ELEMENT&#41; is possible,
but ugly. As previously discussed, XPath gives cleaner and considerably
more general solution for this kind of problems, esp. when used with
pre-compiled XPath expresions to partly reduce the overhead.

Also, modules like XML::CompactTree::XS can be used to slurp XML data
into Perl data structures for further processing with just one XS call.
Of course. where really optimal preformance is needed, there is probably
nothing that beats writing the whole code in C &#40;and there are solutions
for doing that right from Perl as well&#41;.

-- Petr
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-672332" href="/Public/Bug/Display.html?id=33811#txn-672332">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;19:06:12&nbsp;2009</span>
    <span class="description">pajas [...] matfyz.cz -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.505906</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
