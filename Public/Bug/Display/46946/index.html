<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #46946 for XML-LibXML: Documentation of finish_push is different from behaviour</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #46946 for XML-LibXML: Documentation of finish_push is different from behaviour</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-LibXML/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-LibXML/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML">XML-LibXML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">46946</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-LibXML/Active/">XML-LibXML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
REHSACK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37350-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.69    </td>
  </tr>
  <tr id="CF-37351-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;15&nbsp;05:33:53&nbsp;2009</span>
    <span class="description">REHSACK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Documentation of finish_push is different from behaviour</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I run into a problem with XML::LibXML during trying to parse incoming
packets until they&#39;re completed &#40;multiplexed channels&#41;. There&#39;re some
problems - but the one I&#39;ve found comes from XML::LibXML:

finish_push doesn&#39;t always throws an exception, if an incomplete packet
was &#34;parsed&#34;. The parser is always forced to break on incomplete packets
&#40;&#39;$parser-&gt;recover&#40;0&#41;&#39;&#41;, but sometimes &#40;in attached log in line 31&#41;
under heavy load &#40;one thread&#41; it simply returns undef and throws no
exception.

Best regards,
Jens

PS: I can execute provided test-procs, but our code has been modified
meanwhile to simply check for valid doc and ignores any exception - that
works fine.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> LibXML-demo-snap.log</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> LibXML-demo-snap.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">     37 sub putLine
     38 {
     39     my $self  = shift;
     40     my @lines = @_;
     41 
     42     StdOut&#40; &#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#39; &#41;;
     43 
     44     foreach my $line &#40;@lines&#41;
     45     {
     46         my $err = 0;
     47         my $doc;
     48         unless &#40; $self-&gt;{inpacket} &#41;
     49         {
     50             next if&#40; 0 == length&#40;$line&#41; &#41;;
     51             ++$self-&gt;{inpacket};
     52             $self-&gt;{curmsg} = [];
     53         }
     54 
     55         StdOutf&#40; q{&#39;%s&#39;}, $line &#41;;
     56 
     57         try
     58         {
     59             push&#40; @{ $self-&gt;{curmsg} }, $line &#41;;
     60             $self-&gt;{parser}-&gt;init_push&#40;&#41;;
     61             $self-&gt;{parser}-&gt;push&#40; @{ $self-&gt;{curmsg} } &#41;;
     62             $doc = $self-&gt;{parser}-&gt;finish_push&#40;&#41;;
     63             if&#40; defined&#40; $doc &#41; &#41;
     64             {
     65                 StdOutf&#40; q{doc &#39;%s&#39; ok}, $doc-&gt;documentElement&#40;&#41;-&gt;nodeName&#40;&#41; &#41; ;
     66                 StdOut&#40;&#39;-&#39; x 60&#41;;
     67             }
     68             else
     69             {
     70                 $err = 1;
     71             }
     72         }
     73         catch
     74         { 
     75             $err = 1;
     76         };
     77 
     78         unless &#40;$err&#41;
     79         { 
     80             --$self-&gt;{inpacket};
     81             $self-&gt;parseDoc&#40;$doc&#41; if &#40; defined&#40;$doc&#41; &#41;;
     82         }
     83     }
     84 
     85     StdOut&#40; &#39;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39; &#41;;
     86 
     87     return;
     88 }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;07:26:41&nbsp;2009</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne po 15.čen.2009 05:33:53, REHSACK napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; I run into a problem with XML::LibXML during trying to parse incoming
&gt; packets until they&#39;re completed &#40;multiplexed channels&#41;. There&#39;re some
&gt; problems - but the one I&#39;ve found comes from XML::LibXML:
&gt; 
&gt; finish_push doesn&#39;t always throws an exception, if an incomplete packet
&gt; was &#34;parsed&#34;. The parser is always forced to break on incomplete packets
&gt; &#40;&#39;$parser-&gt;recover&#40;0&#41;&#39;&#41;, but sometimes &#40;in attached log in line 31&#41;
&gt; under heavy load &#40;one thread&#41; it simply returns undef and throws no
&gt; exception.
&gt; 
&gt; Best regards,
&gt; Jens
&gt; 
&gt; PS: I can execute provided test-procs, but our code has been modified
&gt; meanwhile to simply check for valid doc and ignores any exception - that
&gt; works fine.
</div>
Hi, 

thanks for the report. Unfortunatelly, I was not able to reproduce this
bug based on the code you have provided. Can you try to create and post
a complete self-contained test script that simulates the situation in
which you encounter the error?

Also, can you test with the XML::LibXML version now in SVN?

And finally, in the code you sent you do not need to use push parser at
all since you feed all data in a single push&#40;&#41;.

Please comment. Thanks,

-- Petr
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;07:26:42&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;11:47:42&nbsp;2009</span>
    <span class="description">rehsack [...] web.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46946] Documentation of finish_push is different from behaviour</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Sep 2009 15:47:04 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jens Rehsack &lt;rehsack [...] web.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Petr Pajas via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46946">https://rt.cpan.org/Ticket/Display.html?id=46946</a></span> &gt;
&gt; 
&gt; Dne po 15.čen.2009 05:33:53, REHSACK napsal&#40;a&#41;:
<div class="message-stanza open">&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I run into a problem with XML::LibXML during trying to parse incoming
&gt;&gt; packets until they&#39;re completed &#40;multiplexed channels&#41;. There&#39;re some
&gt;&gt; problems - but the one I&#39;ve found comes from XML::LibXML:
&gt;&gt;
&gt;&gt; finish_push doesn&#39;t always throws an exception, if an incomplete packet
&gt;&gt; was &#34;parsed&#34;. The parser is always forced to break on incomplete packets
&gt;&gt; &#40;&#39;$parser-&gt;recover&#40;0&#41;&#39;&#41;, but sometimes &#40;in attached log in line 31&#41;
&gt;&gt; under heavy load &#40;one thread&#41; it simply returns undef and throws no
&gt;&gt; exception.
&gt;&gt;
&gt;&gt; Best regards,
&gt;&gt; Jens
&gt;&gt;
&gt;&gt; PS: I can execute provided test-procs, but our code has been modified
&gt;&gt; meanwhile to simply check for valid doc and ignores any exception - that
&gt;&gt; works fine.
</div>&gt; 
&gt; Hi, 
&gt; 
&gt; thanks for the report. Unfortunatelly, I was not able to reproduce this
&gt; bug based on the code you have provided. Can you try to create and post
&gt; a complete self-contained test script that simulates the situation in
&gt; which you encounter the error?
</div>
No - this is a problem. It&#39;s a closed source project &#40;I already asked for it
before I opened the report&#41;. This happens only under heavy stress &#40;I opened
a lot of clients to one server and let them all send xml messages&#41;. Maybe
you can reproduce it or simply trust me ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, can you test with the XML::LibXML version now in SVN?
</div>
Maybe - but I cannot promise. The project ends Wednesday and with it my
contract ends. After it I might find the time to create a new example to
demonstrate the error &#40;to get a feeling when, take a look between
SQL::Statement 1.20 and the first development releases for 1.21 ^^&#41; and
provide this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And finally, in the code you sent you do not need to use push parser at
&gt; all since you feed all data in a single push&#40;&#41;.
</div>
The code is stripped down. The original code was more complex - but I&#39;ll
take a look if it&#39;s now true.

Best regards,
Jens
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;10:16:41&nbsp;2009</span>
    <span class="description">pajas [...] matfyz.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne pá 25.zář.2009 11:47:42, rehsack@web.de napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Petr Pajas via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46946">https://rt.cpan.org/Ticket/Display.html?id=46946</a></span> &gt;
&gt; &gt; 
&gt; &gt; Dne po 15.čen.2009 05:33:53, REHSACK napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt;&gt; Hi,
&gt; &gt;&gt;
&gt; &gt;&gt; I run into a problem with XML::LibXML during trying to parse incoming
&gt; &gt;&gt; packets until they&#39;re completed &#40;multiplexed channels&#41;. There&#39;re some
&gt; &gt;&gt; problems - but the one I&#39;ve found comes from XML::LibXML:
&gt; &gt;&gt;
&gt; &gt;&gt; finish_push doesn&#39;t always throws an exception, if an incomplete packet
&gt; &gt;&gt; was &#34;parsed&#34;. The parser is always forced to break on incomplete
</div></div></div>packets
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;&gt; &#40;&#39;$parser-&gt;recover&#40;0&#41;&#39;&#41;, but sometimes &#40;in attached log in line 31&#41;
&gt; &gt;&gt; under heavy load &#40;one thread&#41; it simply returns undef and throws no
&gt; &gt;&gt; exception.
&gt; &gt;&gt;
&gt; &gt;&gt; Best regards,
&gt; &gt;&gt; Jens
&gt; &gt;&gt;
&gt; &gt;&gt; PS: I can execute provided test-procs, but our code has been modified
&gt; &gt;&gt; meanwhile to simply check for valid doc and ignores any exception -
</div></div>that
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; works fine.
</div>&gt; &gt; 
&gt; &gt; Hi, 
&gt; &gt; 
&gt; &gt; thanks for the report. Unfortunatelly, I was not able to reproduce this
&gt; &gt; bug based on the code you have provided. Can you try to create and post
&gt; &gt; a complete self-contained test script that simulates the situation in
&gt; &gt; which you encounter the error?
</div>&gt; 
&gt; No - this is a problem. It&#39;s a closed source project &#40;I already asked
</div>for it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; before I opened the report&#41;. This happens only under heavy stress &#40;I
</div>opened
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a lot of clients to one server and let them all send xml messages&#41;. Maybe
&gt; you can reproduce it or simply trust me ;-&#41;
</div>
I do trust you, of course. The thing is that I looked in the finish_push
but found nothing suspicious, so I wanted to be able to reproduce the
bug in order to debug it. I was not asking for a real project code, I
just thought you might create something that just simulates the real
process &#40;may be difficult, but it&#39;s even harder for me: I don&#39;t know the
details of your architecture so I would probably waste hours in vain&#41;. 

Also, since the implementation of finish_push in LibXML.xs is very
simple, maybe you could try stuffing some debug messages in there and
see what happens if you attempt to reproduce the bug in your app &#40;the
debug prints should indicate whether libxml2 reported the document as
well-formed/valid, whether XML::LibXML generate some errors, that got
suppressed for some reason and why, etc.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Also, can you test with the XML::LibXML version now in SVN?
</div>&gt; 
&gt; Maybe - but I cannot promise. The project ends Wednesday and with it my
&gt; contract ends. After it I might find the time to create a new example to
&gt; demonstrate the error &#40;to get a feeling when, take a look between
&gt; SQL::Statement 1.20 and the first development releases for 1.21 ^^&#41; and
&gt; provide this.
</div>
I understand. Anyway, if you do find some time to write some code, it&#39;ll
be very much appreciated.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; And finally, in the code you sent you do not need to use push parser at
&gt; &gt; all since you feed all data in a single push&#40;&#41;.
</div>&gt; 
&gt; The code is stripped down. The original code was more complex - but I&#39;ll
&gt; take a look if it&#39;s now true.
</div>
I see.

best,

-- Petr
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;30&nbsp;11:09:34&nbsp;2009</span>
    <span class="description">rehsack [...] web.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46946] Documentation of finish_push is different from behaviour</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Sep 2009 15:08:25 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-LibXML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jens Rehsack &lt;rehsack [...] web.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Petr Pajas via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46946">https://rt.cpan.org/Ticket/Display.html?id=46946</a></span> &gt;
&gt; 
&gt; Dne pá 25.zář.2009 11:47:42, rehsack@web.de napsal&#40;a&#41;:
<div class="message-stanza open">&gt;&gt; Petr Pajas via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46946">https://rt.cpan.org/Ticket/Display.html?id=46946</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dne po 15.čen.2009 05:33:53, REHSACK napsal&#40;a&#41;:
<div class="message-stanza open">&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I run into a problem with XML::LibXML during trying to parse incoming
&gt;&gt;&gt;&gt; packets until they&#39;re completed &#40;multiplexed channels&#41;. There&#39;re some
&gt;&gt;&gt;&gt; problems - but the one I&#39;ve found comes from XML::LibXML:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; finish_push doesn&#39;t always throws an exception, if an incomplete packet
&gt;&gt;&gt;&gt; was &#34;parsed&#34;. The parser is always forced to break on incomplete
</div></div></div>&gt; packets
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; &#40;&#39;$parser-&gt;recover&#40;0&#41;&#39;&#41;, but sometimes &#40;in attached log in line 31&#41;
&gt;&gt;&gt;&gt; under heavy load &#40;one thread&#41; it simply returns undef and throws no
&gt;&gt;&gt;&gt; exception.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Best regards,
&gt;&gt;&gt;&gt; Jens
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; PS: I can execute provided test-procs, but our code has been modified
&gt;&gt;&gt;&gt; meanwhile to simply check for valid doc and ignores any exception -
</div></div>&gt; that
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; works fine.
</div>&gt;&gt;&gt; Hi, 
&gt;&gt;&gt;
&gt;&gt;&gt; thanks for the report. Unfortunatelly, I was not able to reproduce this
&gt;&gt;&gt; bug based on the code you have provided. Can you try to create and post
&gt;&gt;&gt; a complete self-contained test script that simulates the situation in
&gt;&gt;&gt; which you encounter the error?
</div>&gt;&gt; No - this is a problem. It&#39;s a closed source project &#40;I already asked
</div>&gt; for it
<div class="message-stanza open">&gt;&gt; before I opened the report&#41;. This happens only under heavy stress &#40;I
</div>&gt; opened
<div class="message-stanza open">&gt;&gt; a lot of clients to one server and let them all send xml messages&#41;. Maybe
&gt;&gt; you can reproduce it or simply trust me ;-&#41;
</div>&gt; 
&gt; I do trust you, of course. The thing is that I looked in the finish_push
&gt; but found nothing suspicious, so I wanted to be able to reproduce the
&gt; bug in order to debug it.
</div>
I looked into the code &#40;I usually try to submit patches with error reports&#41;,
but it looked good all the way. I try to create a code sniplet which
reproduces the problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I was not asking for a real project code, I
&gt; just thought you might create something that just simulates the real
&gt; process &#40;may be difficult, but it&#39;s even harder for me: I don&#39;t know the
&gt; details of your architecture so I would probably waste hours in vain&#41;. 
</div>
That&#39;s why I asked for changing the documentation. What I&#39;ve seen is:
eval { $doc = $xml-&gt;finish_push&#40;&#41; };
if&#40; defined&#40; $doc &#41; &#41;
{
  ...
}

worked for sure.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, since the implementation of finish_push in LibXML.xs is very
&gt; simple, maybe you could try stuffing some debug messages in there and
&gt; see what happens if you attempt to reproduce the bug in your app &#40;the
&gt; debug prints should indicate whether libxml2 reported the document as
&gt; well-formed/valid, whether XML::LibXML generate some errors, that got
&gt; suppressed for some reason and why, etc.&#41;
</div>
The project finished today &#40;I&#39;m contract worker&#41;, so this isn&#39;t possible.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Also, can you test with the XML::LibXML version now in SVN?
</div>&gt;&gt; Maybe - but I cannot promise. The project ends Wednesday and with it my
&gt;&gt; contract ends. After it I might find the time to create a new example to
&gt;&gt; demonstrate the error &#40;to get a feeling when, take a look between
&gt;&gt; SQL::Statement 1.20 and the first development releases for 1.21 ^^&#41; and
&gt;&gt; provide this.
</div>&gt; 
&gt; I understand. Anyway, if you do find some time to write some code, it&#39;ll
&gt; be very much appreciated.
</div>
For sure - and as soon as possible, but this could mean several week &#40;my
ToDo-list is long :/&#41;

Best regards,
Jens
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;23&nbsp;12:22:51&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closed as REJECTED due to lack of activity and responsiveness on the
part of the reporter.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;23&nbsp;12:22:51&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
