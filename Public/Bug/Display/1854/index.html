<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #1854 for CGI-Upload: bug with null symbol in filename</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #1854 for CGI-Upload: bug with null symbol in filename</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI-Upload/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI-Upload/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI-Upload/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI-Upload/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Upload">CGI-Upload CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">1854</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">1.7 hours (100 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI-Upload/Active/">CGI-Upload</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ROBAU [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ivan [...] pechorin.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-6040-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.04</li>
<li>
1.05</li>
</ul>
    </td>
  </tr>
  <tr id="CF-6041-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;10:59:15&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bug with null symbol in filename</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">CGI-Upload-1.04, 
Perl 5.6.1 supplied with RedHat 7.3,
RedHat Linux 7.3, kernel 2.4.18

I&#39;ve got an error, client tried to upload file named &#34;D:\029_INV.xls&#34;.
My client uses Windows 98 SE, Internet Explorer 5.0.

Filename contains &#34;\0&#34; - backslash and zero, but these 2 symbols where recognized as 1 symbol with ascii code 0 by the file_name method of CGI::Upload. 
No error or warning messages appeared &#40;script is running with &#34;use strict; use warnings&#34;&#41;

CGI::Upload 1.05 as far as I know does not contain any significant changes.

Server environment: RedHat Linux 7.3, kernel 2.4.18, 
perl 5.6.1, Apache 1.3.27, mod_perl, mod_ssl

I&#39;ll try to fix this bug myself.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;22:40:30&nbsp;2003</span>
    <span class="description">ROBAU [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;22:40:30&nbsp;2003</span>
    <span class="description">ROBAU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your feedback on this module.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve got an error, client tried to upload file named &#34;D:\029_INV.xls&#34;.
&gt; My client uses Windows 98 SE, Internet Explorer 5.0.
&gt; 
&gt; Filename contains &#34;\0&#34; - backslash and zero, but these 2 symbols where
&gt;    recognized as 1 symbol with ascii code 0 by the file_name method of
&gt;    CGI::Upload.
&gt; No error or warning messages appeared &#40;script is running with &#34;use
&gt;    strict; use warnings&#34;&#41;
</div>
The problem here relates to the determination of the client operating 
system and file parsing routines based upon the HTTP request headers.  
From the description of the problem supplied, it appears that the 
parsing of the filename supplied is defaulting to UNIX file parsing 
routines - This may be the result of proxy servers between the client 
and the web server which remove identifying HTTP client information.

The solution for this problem may be to incorporate some sanity check 
for the determination of file parsing routines - I hope to be able to 
incorporate such code into the next version of CGI::Upload.

Regards,
Rob


[guest - Thu Dec  5 10:59:15 2002]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; CGI-Upload-1.04,
&gt; Perl 5.6.1 supplied with RedHat 7.3,
&gt; RedHat Linux 7.3, kernel 2.4.18
&gt; 
&gt; I&#39;ve got an error, client tried to upload file named &#34;D:\029_INV.xls&#34;.
&gt; My client uses Windows 98 SE, Internet Explorer 5.0.
&gt; 
&gt; Filename contains &#34;\0&#34; - backslash and zero, but these 2 symbols where
&gt;    recognized as 1 symbol with ascii code 0 by the file_name method of
&gt;    CGI::Upload.
&gt; No error or warning messages appeared &#40;script is running with &#34;use
&gt;    strict; use warnings&#34;&#41;
&gt; 
&gt; CGI::Upload 1.05 as far as I know does not contain any significant
&gt;    changes.
&gt; 
&gt; Server environment: RedHat Linux 7.3, kernel 2.4.18,
&gt; perl 5.6.1, Apache 1.3.27, mod_perl, mod_ssl
&gt; 
&gt; I&#39;ll try to fix this bug myself.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;22:40:31&nbsp;2003</span>
    <span class="description">ROBAU [...] cpan.org -  Given to ROBAU</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;22:41:55&nbsp;2003</span>
    <span class="description">ROBAU [...] cpan.org -  Severity Critical changed to Important</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;27&nbsp;11:11:31&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bug with null symbol in filename &#40;coderef issue with fs parsing&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> markstos [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[ROBAU - Thu Jan  2 22:40:30 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you for your feedback on this module.
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;ve got an error, client tried to upload file named
</div>&gt;    &#34;D:\029_INV.xls&#34;.
<div class="message-stanza open">&gt; &gt; My client uses Windows 98 SE, Internet Explorer 5.0.
&gt; &gt;
&gt; &gt; Filename contains &#34;\0&#34; - backslash and zero, but these 2 symbols
</div>&gt;    where
<div class="message-stanza open">&gt; &gt;    recognized as 1 symbol with ascii code 0 by the file_name method
</div>&gt;    of
<div class="message-stanza open">&gt; &gt;    CGI::Upload.
&gt; &gt; No error or warning messages appeared &#40;script is running with &#34;use
&gt; &gt;    strict; use warnings&#34;&#41;
</div>&gt; 
&gt; The problem here relates to the determination of the client operating
&gt; system and file parsing routines based upon the HTTP request headers.
&gt; From the description of the problem supplied, it appears that the
&gt; parsing of the filename supplied is defaulting to UNIX file parsing
&gt; routines - This may be the result of proxy servers between the client
&gt; and the web server which remove identifying HTTP client information.
&gt; 
&gt; The solution for this problem may be to incorporate some sanity check
&gt; for the determination of file parsing routines - I hope to be able to
&gt; incorporate such code into the next version of CGI::Upload.
&gt; 
&gt; Regards,
&gt; Rob
</div>
I think the problem with this  is the some kind of syntax bug that that
&#39;binmode&#39; has. Here&#39;s the affected code:

    fileparse_set_fstype&#40;
        sub {
            my $browser = HTTP::BrowserDetect-&gt;new;
            return &#39;MSWin32&#39; if $browser-&gt;windows;
            return &#39;MacOS&#39; if $browser-&gt;mac;
            $^O;
        }
    &#41;;

The use of an anonymous subroutine like this will always return
something like &#39;CODE&#40;X95496&#41;&#39;. Because this is not a recognized, OS
name, it defaults to Unix-style parsing. 

The fix could be something like this:

my $os = $^O;
my $browser = HTTP::BrowserDetect-&gt;new;
$os = &#39;MSWin32&#39; if $browser-&gt;windows;
$os = &#39;MacOS&#39; if $browser-&gt;mac;
fileparse_set_fstype&#40;$os&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;02&nbsp;11:46:21&nbsp;2004</span>
    <span class="description">SZABGAB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gabor [...] pti.co.il</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have uploaded 1.06 that should solve this problem
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;27&nbsp;00:13:46&nbsp;2005</span>
    <span class="description">SZABGAB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">100 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">was solved in 1.06
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;27&nbsp;00:13:46&nbsp;2005</span>
    <span class="description">SZABGAB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
