<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53128 for SQL-Statement: SQL::Dialect::ANSI is not really in INI format</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53128 for SQL-Statement: SQL::Dialect::ANSI is not really in INI format</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=SQL-Statement">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=SQL-Statement">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=SQL-Statement">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=SQL-Statement">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SQL-Statement">SQL-Statement CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53128</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=SQL-Statement">SQL-Statement</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mschwern [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-29588-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.23    </td>
  </tr>
  <tr id="CF-29589-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.24    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Typos-in-the-pod.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/712426/367742/0001-Typos-in-the-pod.patch">
Mon Dec 28 21:41:45 2009 (1k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>


0002-Create-a-role-for-SQL-Dialects-which-allows-for-futu.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/712426/367741/0002-Create-a-role-for-SQL-Dialects-which-allows-for-futu.patch">
Mon Dec 28 21:41:45 2009 (7.3k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=53128">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-711690" href="/Public/Bug/Display.html?id=53128#txn-711690">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;27&nbsp;17:04:09&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SQL::Dialect::ANSI is not really in INI format</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/711690/367322/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367322">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza">Answering a question on stack overflow (<span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/1966716/sqlparse-how-do-i-get-a-list-with-all-reserved-words&#41;">http://stackoverflow.com/questions/1966716/sqlparse-how-do-i-get-a-list-with-all-reserved-words&#41;</a></span> I&nbsp;discovered that SQL::Dialect::ANSI is not in INI&nbsp;format.&nbsp; At least not according to Wikipedia or Config::INI.&nbsp; Granted the INI&nbsp;format isn't particularly well defined, but they all seem to agree that it's &quot;key = value&quot;&nbsp;(or key: value).&nbsp; I can understand why you didn't want to write out &quot;key = 1&quot;&nbsp;over and over again.<br>

<br>

IMO there's two good solutions.&nbsp; 1)&nbsp;Give each SQL::Dialects class a method to return their config as a Perl data structure, then you can use whatever data format you like. &nbsp;This also makes SQL::DIalects independent of SQL::Parser.<br>

<br>

2)&nbsp;Store it as a Perl data structure, unless there's some hidden purpose to storing it as an ini file.&nbsp; This would be best, except in order to retain backwards compatibility you'll have to rewrite get_config() as an ini writer.<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712210" href="/Public/Bug/Display.html?id=53128#txn-712210">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;28&nbsp;08:11:48&nbsp;2009</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/712210/367623/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367623">with headers</a>
<br />
<span class="downloadcontenttype">text/html 364b</span>
</div>
<div class="messagebody">
<div class="message-stanza">A change there would break surely dependent modules, like DBD::Google.<br>

<br>

I&nbsp;agree, the interface to the dialects isn't the best one - but it's in use by derived modules.<br>

Further:&nbsp;ini-style isn't ini-format. It just should describe an easy to understand picture - sorry for the confusion. I&nbsp;will describe better in next release.<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712213" href="/Public/Bug/Display.html?id=53128#txn-712213">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;28&nbsp;08:11:48&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712360" href="/Public/Bug/Display.html?id=53128#txn-712360">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;28&nbsp;16:47:51&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/712360/367695/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367695">with headers</a>
<br />
<span class="downloadcontenttype">text/html 787b</span>
</div>
<div class="messagebody">
<div class="message-stanza">On Mon Dec 28 08:11:48 2009, REHSACK wrote: <br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A change there would break surely dependent modules, like DBD::Google. <br>

&gt;  <br>

&gt; I agree, the interface to the dialects isn't the best one - but it's <br>

&gt; in use by <br>

&gt; derived modules. <br>

&gt; Further: ini-style isn't ini-format. It just should describe an easy <br>

&gt; to <br>

&gt; understand picture - sorry for the confusion. I will describe better <br>

&gt; in next <br>

&gt; release. <br>
</div><br>

Sorry I didn't make it clear, leave get_config() alone and write a new method which returns it as a Perl data structure.&nbsp; That's 100% backwards compatible, and eliminates the need to describe what &quot;ini-style&quot; means and for users to write their own parser for it.<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712370" href="/Public/Bug/Display.html?id=53128#txn-712370">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;28&nbsp;16:52:42&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/712370/367704/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367704">with headers</a>
<br />
<span class="downloadcontenttype">text/html 304b</span>
</div>
<div class="messagebody">
<div class="message-stanza">Oh, I see now, there's no SQL::Dialects superclass so the API is fixed.&nbsp; That's easy enough to fix, dialect()&nbsp;can inject the necessary method if it does not exist.&nbsp; That'll hold things together until subclasses catch up.<br>

<br>

Let me hack up a patch real quick to demonstrate.<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712426" href="/Public/Bug/Display.html?id=53128#txn-712426">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;28&nbsp;21:41:45&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/712426/367740/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367740">with headers</a>
<br />
<span class="downloadcontenttype">text/html 638b</span>
</div>
<div class="messagebody">
<div class="message-stanza">Attached is two patches.&nbsp; The first fixes some typos I noticed in the POD.<br>

<br>

The second adds SQL::Dialects::Role which requires get_config() and injects get_config_as_hash().&nbsp; This lets a dialect do its own parsing of its own data.&nbsp; You also now have a place to document how to write a SQL::Dialects.<br>

<br>

To maintain backwards compatibility, dialects() will inject the role if necessary.<br>

<br>

I also made dialects() handle dialects with multiple words in the name like &quot;SQL::Dialects::ANSI::1999&quot; and cleaned up how SQL::Parser was loading classes.&nbsp; Checking $@ is not safe.<br>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0002-Create-a-role-for-SQL-Dialects-which-allows-for-futu.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/712426/367741/0002-Create-a-role-for-SQL-Dialects-which-allows-for-futu.patch">Download 0002-Create-a-role-for-SQL-Dialects-which-allows-for-futu.patch</a><br />
<span class="downloadcontenttype">text/x-diff 7.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From e91152d6d37d7d7e7be6b23decba928ade263cee Mon Sep 17 00:00:00 2001
From: Michael G. Schwern &lt;schwern@pobox.com&gt;
Date: Mon, 28 Dec 2009 18:35:08 -0800
Subject: [PATCH 2/2] Create a role for SQL::Dialects which allows for future injection of more code.

Currently the role handles the parsing of the not-quite INI format used by SQL::Dialects.

Also refactor loading of classes into a method and don&#39;t use the dangerous method of checking $@
which may be polluted.

Finally, for compatibility with existing SQL::Dialects in the wild, SQL::Parser-&gt;dialect will
inject the role if necessary.
---
 lib/SQL/Dialects/ANSI.pm    |    2 +
 lib/SQL/Dialects/AnyData.pm |    2 +
 lib/SQL/Dialects/CSV.pm     |    2 +
 lib/SQL/Dialects/Role.pm    |  102 +++++++++++++++++++++++++++++++++++++++++++
 lib/SQL/Parser.pm           |   68 ++++++++++++++++------------
 t/dialects.t                |   68 ++++++++++++++++++++++++++++
 6 files changed, 215 insertions&#40;+&#41;, 29 deletions&#40;-&#41;
 create mode 100644 lib/SQL/Dialects/Role.pm
 create mode 100644 t/dialects.t

diff --git a/lib/SQL/Dialects/ANSI.pm b/lib/SQL/Dialects/ANSI.pm
index 91c6033..c27fe3f 100755
--- a/lib/SQL/Dialects/ANSI.pm
+++ b/lib/SQL/Dialects/ANSI.pm
@@ -3,6 +3,8 @@ package SQL::Dialects::ANSI;
 use vars qw&#40;$VERSION&#41;;
 $VERSION = &#39;1.23&#39;;
 
+use SQL::Dialects::Role;
+
 sub get_config
 {
     return &lt;&lt;EOC;
diff --git a/lib/SQL/Dialects/AnyData.pm b/lib/SQL/Dialects/AnyData.pm
index d45acb6..ff9d850 100755
--- a/lib/SQL/Dialects/AnyData.pm
+++ b/lib/SQL/Dialects/AnyData.pm
@@ -3,6 +3,8 @@ package SQL::Dialects::AnyData;
 use vars qw&#40;$VERSION&#41;;
 $VERSION = &#39;1.23&#39;;
 
+use SQL::Dialects::Role;
+
 sub get_config
 {
     return &lt;&lt;EOC;
diff --git a/lib/SQL/Dialects/CSV.pm b/lib/SQL/Dialects/CSV.pm
index 245f022..4cdda43 100755
--- a/lib/SQL/Dialects/CSV.pm
+++ b/lib/SQL/Dialects/CSV.pm
@@ -3,6 +3,8 @@ package SQL::Dialects::CSV;
 use vars qw&#40;$VERSION&#41;;
 $VERSION = &#39;1.23&#39;;
 
+use SQL::Dialects::Role;
+
 sub get_config
 {
     return &lt;&lt;EOC;
diff --git a/lib/SQL/Dialects/Role.pm b/lib/SQL/Dialects/Role.pm
new file mode 100644
index 0000000..0b1998b
--- /dev/null
+++ b/lib/SQL/Dialects/Role.pm
@@ -0,0 +1,102 @@
+package SQL::Dialects::Role;
+
+use strict;
+use warnings;
+
+use base qw&#40;Exporter&#41;;
+our @EXPORT = qw&#40;get_config_as_hash&#41;;
+
+sub get_config_as_hash {
+    my $class = shift;
+
+    my @data = split&#40; m/\n/, $class-&gt;get_config&#40;&#41; &#41;;
+
+    my %config;
+    my $feature;
+    for &#40;@data&#41;
+    {
+        chomp;
+        s/^\s+//;
+        s/\s+$//;
+        next unless $_;
+        if &#40;/^\[&#40;.*&#41;\]$/i&#41;
+        {
+            $feature = lc $1;
+            $feature =~ s/\s+/_/g;
+            next;
+        }
+        my $newopt = uc $_;
+        $newopt =~ s/\s+/ /g;
+        $config{$feature}{$newopt} = 1;
+    }
+
+    return \%config;
+}
+
+
+=head1 NAME
+
+SQL::Dialects::Role - The role of being a SQL::Dialect
+
+=head1 SYNOPSIS
+
+    package My::SQL::Dialect;
+
+    use SQL::Dialects::Role;
+
+    sub get_config {
+        return &lt;&lt;CONFIG;
+    [SECTION]
+    item1
+    item2
+
+    [ANOTHER SECTION]
+    item1
+    item2
+    CONFIG
+    }
+
+=head1 DESCRIPTION
+
+This adds the role of being a SQL::Dialect to your class.
+
+=head2 Requirements
+
+You must implement...
+
+=head3 get_config
+
+    my $config = $class-&gt;get_config;
+
+Returns information about the dialect in an INI-like format.
+
+=head2 Implements
+
+The role implements...
+
+=head3 get_config_as_hash
+
+    my $config = $class-&gt;get_config_as_hash;
+
+Returns the data represented in get_config&#40;&#41; as a hash ref.
+
+Items will be upcased, sections will be lowered.
+
+The example in the SYNOPSIS would come back as...
+
+    {
+        section =&gt; {
+            ITEM1       =&gt; 1,
+            ITEM2       =&gt; 2,
+        },
+        another_section =&gt; {
+            ITEM1       =&gt; 1,
+            ITEM2       =&gt; 2,
+        }
+   }
+
+=head1 SEE ALSO
+
+L&lt;SQL::Parser/dialect&#40;&#41;&gt;
+
+=cut
diff --git a/lib/SQL/Parser.pm b/lib/SQL/Parser.pm
index 121bcf3..904e8c1 100644
--- a/lib/SQL/Parser.pm
+++ b/lib/SQL/Parser.pm
@@ -277,36 +277,47 @@ sub dialect
     return $self-&gt;{dialect} unless $dialect;
     return $self-&gt;{dialect} if &#40; $self-&gt;{dialect_set} &#41;;
     $self-&gt;{opts} = {};
-    my $mod = &#34;SQL/Dialects/$dialect.pm&#34;;
-    undef $@;
-    eval { require &#34;$mod&#34;; } unless &#40; defined&#40; $INC{$mod} &#41; &#41;;
-    return $self-&gt;do_err&#40;$@&#41; if $@;
-    $mod =~ s/\.pm//;
-    $mod =~ s&#34;/&#34;::&#34;g;
-    my @data = split&#40; m/\n/, $mod-&gt;get_config&#40;&#41; &#41;;
-    my $feature;
-
-    for &#40;@data&#41;
-    {
-        chomp;
-        s/^\s+//;
-        s/\s+$//;
-        next unless $_;
-        if &#40;/^\[&#40;.*&#41;\]$/i&#41;
-        {
-            $feature = lc $1;
-            $feature =~ s/\s+/_/g;
-            next;
-        }
-        my $newopt = uc $_;
-        $newopt =~ s/\s+/ /g;
-        $self-&gt;{opts}-&gt;{$feature}-&gt;{$newopt} = 1;
-    }
+    my $mod_class = &#34;SQL::Dialects::$dialect&#34;;
+
+    $self-&gt;_load_class&#40;$mod_class&#41; unless $mod_class-&gt;can&#40;&#34;get_config&#34;&#41;;
+
+    # This is here for backwards comaptibility with existing dialects
+    # before the had the role to add new methods.
+    $self-&gt;_inject_role&#40;&#34;SQL::Dialects::Role&#34;, $mod_class&#41;
+      unless $mod_class-&gt;can&#40;&#34;get_config_as_hash&#34;&#41;;
+
+    $self-&gt;{opts} = $mod_class-&gt;get_config_as_hash;
+
     $self-&gt;create_op_regexen&#40;&#41;;
     $self-&gt;{dialect} = $dialect;
     $self-&gt;{dialect_set}++;
 }
 
+sub _load_class {
+    my $self = shift;
+    my $class = shift;
+
+    my $mod = $class;
+    $mod =~ s{::}{/}g;
+    $mod .= &#34;.pm&#34;;
+
+    local&#40;$!, $@&#41;;
+    eval { require &#34;$mod&#34;; } or $self-&gt;do_err&#40;$@&#41;;
+
+    return 1;
+}
+
+sub _inject_role {
+    my $self = shift;
+    my&#40;$role, $dest&#41; = @_;
+
+    eval qq{
+        package $dest;
+        use $role;
+        1;
+    } or die &#34;Can&#39;t inject $role into $dest: $@&#34;;
+}
+
 sub create_op_regexen
 {
     my &#40;$self&#41; = @_;
@@ -765,10 +776,9 @@ sub LOAD
     my &#40;$package&#41; = $str =~ /^LOAD\s+&#40;.+&#41;$/;
     $str = $package;
     $package =~ s/\?&#40;\d+&#41;\?/$self-&gt;{struct}-&gt;{literals}-&gt;[$1]/g;
-    my $mod = $package . &#39;.pm&#39;;
-    $mod =~ s|::|/|g;
-    eval { require $mod; } unless &#40; defined&#40; $INC{$mod} &#41; &#41;;
-    die &#34;Couldn&#39;t load &#39;$package&#39;: $@\n&#34; if $@;
+
+    $self-&gt;_load_class&#40;$package&#41;;
+
     my %subs = eval &#39;%&#39; . $package . &#39;::&#39;;
 
     for my $sub &#40; keys %subs &#41;
diff --git a/t/dialects.t b/t/dialects.t
new file mode 100644
index 0000000..37af8b2
--- /dev/null
+++ b/t/dialects.t
@@ -0,0 +1,68 @@
+#!/usr/bin/perl
+
+use strict;
+use warnings;
+
+use Test::More tests =&gt; 2;
+
+my $CLASS = &#34;Local::Test::Dialect&#34;;
+
+
+# Test making a dialect
+{
+    package Local::Test::Dialect;
+
+    use SQL::Dialects::Role;
+
+    sub get_config {
+        # There&#39;s some deliberate whitespace abuse in here
+        return &lt;&lt;END;
+  
+[THINGS]
+elephants
+FEELINGS
+stuff
+  
+
+[RESERVED WORDS]
+FOO
+BAR
+BAZ
+
+END
+
+    }
+}
+
+is_deeply $CLASS-&gt;get_config_as_hash, {
+    things      =&gt; {
+        ELEPHANTS       =&gt; 1,
+        FEELINGS        =&gt; 1,
+        STUFF           =&gt; 1,
+    },
+    reserved_words =&gt; {
+        FOO             =&gt; 1,
+        BAR             =&gt; 1,
+        BAZ             =&gt; 1
+    }
+};
+
+
+# Test role injection
+{
+    {
+        package SQL::Dialects::Test::NoRole;
+
+        sub get_config {
+            return &lt;&lt;DONE;
+[FOO]
+bar
+baz
+DONE
+        }
+    }
+
+    use SQL::Parser;
+    my $parser = SQL::Parser-&gt;new;
+    ok eval { $parser-&gt;dialect&#40; &#34;Test::NoRole&#34; &#41;; 1; } or diag $@;
+}
-- 
1.6.5.3

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Typos-in-the-pod.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/712426/367742/0001-Typos-in-the-pod.patch">Download 0001-Typos-in-the-pod.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 24cdbb29203d487e7543c11bc6ece1a005c73999 Mon Sep 17 00:00:00 2001
From: Michael G. Schwern &lt;schwern@pobox.com&gt;
Date: Mon, 28 Dec 2009 18:08:04 -0800
Subject: [PATCH 1/2] Typos in the pod

---
 lib/SQL/Dialects/AnyData.pm |    2 +-
 lib/SQL/Dialects/CSV.pm     |    2 +-
 2 files changed, 2 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/lib/SQL/Dialects/AnyData.pm b/lib/SQL/Dialects/AnyData.pm
index 0e32bd1..d45acb6 100755
--- a/lib/SQL/Dialects/AnyData.pm
+++ b/lib/SQL/Dialects/AnyData.pm
@@ -99,7 +99,7 @@ SQL::Dialects::AnyData
 =head1 SYNOPSIS
 
   use SQL::Dialects::AnyData;
-  $config = SQL::Dialects::ANSI-&gt;get_config&#40;&#41;;
+  $config = SQL::Dialects::AnyData-&gt;get_config&#40;&#41;;
 
 =head1 DESCRIPTION
 
diff --git a/lib/SQL/Dialects/CSV.pm b/lib/SQL/Dialects/CSV.pm
index 5fe7d31..245f022 100755
--- a/lib/SQL/Dialects/CSV.pm
+++ b/lib/SQL/Dialects/CSV.pm
@@ -90,7 +90,7 @@ SQL::Dialects::CSV
 =head1 SYNOPSIS
 
   use SQL::Dialects::CSV;
-  $config = SQL::Dialects::ANSI-&gt;get_config&#40;&#41;;
+  $config = SQL::Dialects::CSV-&gt;get_config&#40;&#41;;
 
 =head1 DESCRIPTION
 
-- 
1.6.5.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712596" href="/Public/Bug/Display.html?id=53128#txn-712596">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;29&nbsp;04:02:02&nbsp;2009</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/712596/367839/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367839">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza">The implementation of a new super class isn't my problem. Thanks for the patch anyway :)<br>

<br>

I&nbsp;have there following problems:<br>

1)&nbsp;Fixed interface by widely using - so interface can't be changed.<br>

2)&nbsp;I&nbsp;cannot simply add a base class which isn't used by the Dialects in the wildlife. Changing public inheritance is the same as changing the interface.<br>

3)&nbsp;You'll never get access to the Dialect instance - it's a private attribute. Why not extending the public interface: that of SQL::Parser?<br>

<br>

<p>Relying on SQL::Dialect::Role returning a hash will lead you in a one way street. SQL::Statement v2.00 will use a Backus-Naur-Form parser, and there you'll never get a hash from the dialects classes. The initial request was:<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a function that gives me a list of all reserved words?<br>
</div><br>

My proposal was:<br>

&gt; How about a method features() in SQL::Parser?</p>

Best regards,<br>

Jens<br>

<br>

PS:<br>

I&nbsp;cannot answer you're post on stackoverflow.com - to much JavaScript sources (and I'm denying everything not hosted on the same host).<br>

We might discuss it here or in IRC&nbsp;(#dbi on perl.org irc server).<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712623" href="/Public/Bug/Display.html?id=53128#txn-712623">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;29&nbsp;04:48:26&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Dan [...] DWright.Org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53128] SQL::Dialect::ANSI is not really in INI format</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Dec 2009 01:48:02 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SQL-Statement [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/712623/367853/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367853">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jens Rehsack via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The implementation of a new super class isn&#39;t my problem. Thanks for the patch
&gt; anyway :&#41;
&gt; 
&gt; I have there following problems:
&gt; 1&#41; Fixed interface by widely using - so interface can&#39;t be changed.
</div>
dialect&#40;&#41; accounts for the missing method by injecting the necessary role. 
$parser-&gt;dialect&#40;&#34;Google&#34;&#41; continues to work, for example.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; I cannot simply add a base class which isn&#39;t used by the Dialects in the
&gt; wildlife. Changing public inheritance is the same as changing the interface.
</div>
It is not a base class, it is a role.  There is no inheritance, its basically 
just injecting a method.  This is kosher in the world of roles.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3&#41; You&#39;ll never get access to the Dialect instance - it&#39;s a private attribute.
</div>
Yes, that&#39;s why I&#39;m making the Dialects stand alone, independent of the Parser.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Why not extending the public interface: that of SQL::Parser?
</div>
Because then the Dialects are coupled to the Parser, since the Parser is the 
only thing which knows how to do anything with the data in the Dialect.

Its more flexible and easier to test them separately.  Other things can then 
use them without having to load up SQL::Parser and all its code.

I&#39;m not personally using this.  I just happened to notice the problem while 
answering the question on SO.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Relying on SQL::Dialect::Role returning a hash will lead you in a one way
&gt; street. SQL::Statement v2.00 will use a Backus-Naur-Form parser, and there
&gt; you&#39;ll never get a hash from the dialects classes.
</div>
I don&#39;t understand how that applies here.  Is the format of get_config&#40;&#41; changing?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The initial request was:
<div class="message-stanza open">&gt;&gt; Is there a function that gives me a list of all reserved words?
</div>&gt; 
&gt; My proposal was:
<div class="message-stanza open">&gt;&gt; How about a method features&#40;&#41; in SQL::Parser?
</div>&gt; 
&gt; Best regards,
&gt; Jens
&gt; 
&gt; PS:
&gt; I cannot answer you&#39;re post on stackoverflow.com - to much JavaScript sources
&gt; &#40;and I&#39;m denying everything not hosted on the same host&#41;.
</div>
That&#39;s a great way to not use a lot of the web.  I&#39;m *pretty sure* they&#39;re not 
an attack site.  Consider whitelisting it.


-- 
If at first you don&#39;t succeed--you fail.
        -- &#34;Portal&#34; demo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-748451" href="/Public/Bug/Display.html?id=53128#txn-748451">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;15&nbsp;17:57:02&nbsp;2010</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/748451/387024/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/387024">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 40b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch applied and delivered in S::S 1.24
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-748454" href="/Public/Bug/Display.html?id=53128#txn-748454">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;15&nbsp;17:57:03&nbsp;2010</span>
    <span class="description">REHSACK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-748458" href="/Public/Bug/Display.html?id=53128#txn-748458">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;15&nbsp;18:00:43&nbsp;2010</span>
    <span class="description">REHSACK [...] cpan.org -  Fixed in 1.24 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.651433</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
