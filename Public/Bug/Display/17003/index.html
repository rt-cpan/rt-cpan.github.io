<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17003 for HTTP-DAV: Allow MKCOL requests to send a request body</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17003 for HTTP-DAV: Allow MKCOL requests to send a request body</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTTP-DAV/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTTP-DAV/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTTP-DAV/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTTP-DAV/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTTP-DAV">HTTP-DAV CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17003</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTTP-DAV/Active/">HTTP-DAV</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpan [...] aithal.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-16318-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16319-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;10&nbsp;10:30:33&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Allow MKCOL requests to send a request body</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached small patch allows for a content string to be passed to the mkcol method. This allows you to create more complex collection resources depending on the nature of your DAV server.

Once patched, you can do the following:

  $d-&gt;mkcol&#40;-url=&gt; $url, -content=&gt;&#39;some content for the server&#39;&#41;;


The patch is against HTTP-DAV-0.31

Tested on:
  This is perl, v5.8.6 built for i586-linux-thread-multi
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- HTTP/DAV.pm.orig	2006-01-10 14:49:38.000000000 +0000
+++ HTTP/DAV.pm	2006-01-10 15:07:12.000000000 +0000
@@ -542,7 +542,7 @@
 # MKCOL
 sub mkcol {
    my&#40;$self,@p&#41; = @_;
-   my &#40;$url&#41; = HTTP::DAV::Utils::rearrange&#40;[&#39;URL&#39;], @p&#41;;
+   my &#40;$url,$content&#41; = HTTP::DAV::Utils::rearrange&#40;[&#39;URL&#39;,&#39;CONTENT&#39;], @p&#41;;
 
    return $self-&gt;err&#40;&#39;ERR_WRONG_ARGS&#39;&#41; if &#40;!defined $url || $url eq &#34;&#34;&#41;;
    return $self-&gt;err&#40;&#39;ERR_NULL_RESOURCE&#39;&#41; unless $self-&gt;get_workingresource&#40;&#41;;
@@ -551,8 +551,8 @@
    my $new_url = $self-&gt;get_absolute_uri&#40;$url&#41;;
    my $resource = $self-&gt;new_resource&#40; -uri =&gt; $new_url &#41;;
 
-   # Make the lock
-   my $resp = $resource-&gt;mkcol&#40;&#41;;
+   # Make the collection
+   my $resp = $resource-&gt;mkcol&#40;$content&#41;;
    if &#40; $resp-&gt;is_success&#40;&#41; &#41; {
       return $self-&gt;ok&#40; &#34;mkcol $new_url&#34;, $new_url &#41;;
    } else {
@@ -1409,7 +1409,7 @@
   $d-&gt;put&#40;&#34;/tmp/index.html&#34;,$uri&#41;;
   $d-&gt;unlock&#40;$uri&#41;;
 
-=item B&lt;mkcol&#40;URL&#41;&gt;
+=item B&lt;mkcol&#40;URL,[CONTENT]&#41;&gt;
 
 make a remote collection &#40;directory&#41;
 
@@ -1422,6 +1422,18 @@
   $d-&gt;mkcol&#40;&#34;/dav_dir/new_dir&#34;&#41;;         # Should succeed
   $d-&gt;mkcol&#40;&#34;/dav_dir/new_dir/xxx/yyy&#34;&#41;; # Should fail
 
+=over 4 
+
+=item C&lt;-url&gt; 
+
+is the remote resource you&#39;d like to create. Mandatory
+
+=item C&lt;-content&gt; 
+
+is the content of the MKCOL request body. The behaviour of this is dependent on the server functionality. In the majority of cases, the content should not be specified. Optional
+
+=back
+
 =item B&lt;move&#40;URL,DEST,[OVERWRITE],[DEPTH]&#41;&gt;
 
 moves one remote resource to another
--- HTTP/DAV/Resource.pm.orig	2006-01-10 14:52:02.000000000 +0000
+++ HTTP/DAV/Resource.pm	2006-01-10 14:53:08.000000000 +0000
@@ -543,7 +543,7 @@
 ###########################################################################
 # Make a collection
 sub mkcol {
-   my &#40;$self&#41; = @_;
+   my &#40;$self, $content&#41; = @_;
 
    # Setup the If: header if it is locked
    my $headers = HTTP::DAV::Headers-&gt;new&#40;&#41;;
@@ -553,6 +553,7 @@
       -method =&gt; &#34;MKCOL&#34;, 
       -uri    =&gt; $self-&gt;get_uri,
       -headers=&gt; $headers,
+      -content=&gt; $content,
        &#41;;
 
    # Handle a multistatus response
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
