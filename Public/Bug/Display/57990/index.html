<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57990 for IPC-Run: Bugfix for memory leak</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57990 for IPC-Run: Bugfix for memory leak</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IPC-Run/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IPC-Run">IPC-Run CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57990</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IPC-Run/Active/">IPC-Run</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
akobernik [...] iponweb.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17362-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17363-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;31&nbsp;06:51:07&nbsp;2010</span>
    <span class="description">akobernik [...] iponweb.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bugfix for memory leak</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 31 May 2010 14:56:27 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IPC-Run [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alexander Kobernik &lt;akobernik [...] iponweb.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Most probably, the ticket is a duplicate of Bug #13660.

Distribution name and version: IPC-Run-0.89
Perl version: v5.10.1 &#40;*&#41; built for i486-linux-gnu-thread-multi
Operating System vendor and version: Linux finland 2.6.32-trunk-686 #1 
SMP Sun Jan 10 06:32:16 UTC 2010 i686 GNU/Linux

How to reproduce the memory leak:

use IPC::Run &#40;&#41;;

while &#40;1&#41; {
     sleep 1;

     my $stdin  = &#39;&#39;;
     my $stdout = &#39;&#39;;
     my $stderr = &#39;&#39;;

     eval { IPC::Run::run&#40; [&#34;ls&#34;], \$stdin, \$stdout, \$stderr &#41; };
     die $@ if $@;
}

Patch:

--- lib/IPC/Run/IO.pm.orig      2010-05-31 14:55:01.000000000 +0400
+++ lib/IPC/Run/IO.pm   2010-05-31 14:55:12.000000000 +0400
@@ -351,6 +351,7 @@
  sub _cleanup { ## Called from Run.pm&#39;s _cleanup
     my $self = shift;
     undef $self-&gt;{FAKE_PIPE};
+   undef $self-&gt;{FILTERS};
  }

&#40;found here: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://download2.3tera.net/oss/files/osm/perl-IPC-Run-0.80-2/IPC-Run-mem-leak.patch&#41;">http://download2.3tera.net/oss/files/osm/perl-IPC-Run-0.80-2/IPC-Run-mem-leak.patch&#41;</a></span>

-- 
Alexander O. Kobernik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;08:48:45&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The internals seem a little dodgy if this is a safe or appropriate thing to do. There&#39;s not 
spectacular documentation on the _cleanup subroutines. 

What I do know is that the patch breaks the test suite ATM....

$&gt;make test               
PERL_DL_NONLAZY=1 /usr/local/cpanel/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; 
&#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/97_meta.t .................. ok   
t/98_pod.t ................... ok   
t/98_pod_coverage.t .......... ok   
t/99_perl_minimum_version.t .. skipped: no minimum perl version could be determined
t/adopt.t .................... skipped: adopt not implemented yet
t/binmode.t .................. ok     
t/bogus.t .................... ok   
t/eintr.t .................... ok   
t/filter.t ................... ok     
t/harness.t .................. ok       
t/io.t ....................... ok     
t/kill_kill.t ................ ok   
t/parallel.t ................. ok   
t/pty.t ...................... # IO::Tty 1.10, IO::Pty 1.10
t/pty.t ...................... ok     
t/pump.t ..................... ok     
t/run.t ...................... 134/268 ack Can&#39;t use an undefined value as a SCALAR reference at 
/Users/toddr/projects/IPC-Run/blib/lib/IPC/Run.pm line 2449.
# Looks like you planned 268 tests but ran 241.
# Looks like your test exited with 9 just after 241.
t/run.t ...................... Dubious, test returned 9 &#40;wstat 2304, 0x900&#41;
Failed 27/268 subtests 
t/signal.t ................... ok   
t/timeout.t .................. 9/26 
#   Failed test at t/timeout.t line 67.
#          got: &#39;ack Can&#39;t use an undefined value as a SCALAR reference at 
/Users/toddr/projects/IPC-Run/blib/lib/IPC/Run.pm line 2449.
# &#39;
#     expected: &#39;&#40;?-xism:IPC::Run: timeout&#41;&#39;

#   Failed test at t/timeout.t line 69.

#   Failed test at t/timeout.t line 70.

#   Failed test at t/timeout.t line 75.
#          got: &#39;0&#39;
#     expected: &#39;&gt;= 1&#39;
t/timeout.t .................. 26/26 # Looks like you failed 4 tests of 26.
t/timeout.t .................. Dubious, test returned 4 &#40;wstat 1024, 0x400&#41;
Failed 4/26 subtests 
t/timer.t .................... ok     
t/utf8.t ..................... ok   
t/win32_compile.t ............ ok   
t/windows_search_path.t ...... ok     

Test Summary Report
-------------------
t/run.t                    &#40;Wstat: 2304 Tests: 241 Failed: 0&#41;
  Non-zero exit status: 9
  Parse errors: Bad plan.  You planned 268 tests but ran 241.
t/timeout.t                &#40;Wstat: 1024 Tests: 26 Failed: 4&#41;
  Failed tests:  19, 21-23
  Non-zero exit status: 4
Files=22, Tests=684, 13 wallclock secs &#40; 0.16 usr  0.07 sys +  1.81 cusr  0.58 csys =  2.62 CPU&#41;
Result: FAIL
Failed 2/22 test programs. 4/684 subtests failed.
make: *** [test_dynamic] Error 255
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;08:48:46&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;08:50:00&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RT7990.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/IPC/Run/IO.pm b/lib/IPC/Run/IO.pm
index cddddb8..9e61972 100644
--- a/lib/IPC/Run/IO.pm
+++ b/lib/IPC/Run/IO.pm
@@ -351,6 +351,7 @@ sub open_pipe {
 sub _cleanup { ## Called from Run.pm&#39;s _cleanup
    my $self = shift;
    undef $self-&gt;{FAKE_PIPE};
+   undef $self-&gt;{FILTERS};
 }
 
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;08:50:02&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;08:50:39&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RT7990.patch.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/IPC/Run/IO.pm b/lib/IPC/Run/IO.pm
index cddddb8..9e61972 100644
--- a/lib/IPC/Run/IO.pm
+++ b/lib/IPC/Run/IO.pm
@@ -351,6 +351,7 @@ sub open_pipe {
 sub _cleanup { ## Called from Run.pm&#39;s _cleanup
    my $self = shift;
    undef $self-&gt;{FAKE_PIPE};
+   undef $self-&gt;{FILTERS};
 }
 
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;08:50:41&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;08&nbsp;20:05:16&nbsp;2012</span>
    <span class="description">tom [...] embt.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tom [...] embt.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">FWIW, this is a solution I&#39;m trying locally and tests do pass.  I tried
the other patch but it seems to prevent rerunning a harness.  I can&#39;t
say for certain if this change is safe, I am not familiar with all of
the IPC::Run internals.

--- a/lib/IPC/Run.pm
+++ b/lib/IPC/Run.pm
@@ -1136,4 +1136,10 @@ sub DESTROY {
    POSIX::close $self-&gt;{DEBUG_FD} if defined $self-&gt;{DEBUG_FD};
    $self-&gt;{DEBUG_FD} = undef;
+
+   for my $kid &#40; @{$self-&gt;{KIDS}} &#41; {
+      for my $op &#40; @{$kid-&gt;{OPS}} &#41; {
+         @{$op-&gt;{FILTERS}} = &#40;&#41;;
+      }
+   }
 }
 
@@ -2656,5 +2662,5 @@ sub _do_kid_and_exit {
       _write $self-&gt;{SYNC_WRITER_FD}, $@;
       ## Avoid DESTROY.
-      POSIX::exit 1;
+      POSIX::_exit 1;
    }
 
@@ -2673,10 +2679,10 @@ sub _do_kid_and_exit {
    $kid-&gt;{VAL} = undef;
 
-   ## Use POSIX::exit to avoid global destruction, since this might
+   ## Use POSIX::_exit to avoid global destruction, since this might
    ## cause DESTROY&#40;&#41; to be called on objects created in the parent
    ## and thus cause double cleanup.  For instance, if DESTROY&#40;&#41; unlinks
    ## a file in the child, we don&#39;t want the parent to suddenly miss
    ## it.
-   POSIX::exit 0;
+   POSIX::_exit 0;
 }
 
@@ -4345,5 +4351,5 @@ The second problem is that Perl&#39;s DESTROY subs and
other on-exit cleanup gets
 run in the child process.  If objects are instantiated in the parent
before the
 child is forked, the the DESTROY will get run once in the parent and
once in
-the child.  When coprocess subs exit, POSIX::exit is called to work
around this,
+the child.  When coprocess subs exit, POSIX::_exit is called to work
around this,
 but it means that objects that are still referred to at that time are not
 cleaned up.  So setting package vars or closure vars to point to
objects that
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;19&nbsp;11:09:21&nbsp;2016</span>
    <span class="description">kb [...] open.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kb [...] open.ch</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Updated the patch for the latest version
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IPC-Run.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixes memory leak &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=57990&#41;">https://rt.cpan.org/Public/Bug/Display.html?id=57990&#41;</a></span>

--- lib/IPC/Run.pm.orig	2014-12-14 08:20:10.000000000 +0100
+++ lib/IPC/Run.pm	2016-12-19 14:24:44.845289506 +0100
@@ -1135,6 +1135,12 @@
    my IPC::Run $self = shift;
    POSIX::close $self-&gt;{DEBUG_FD} if defined $self-&gt;{DEBUG_FD};
    $self-&gt;{DEBUG_FD} = undef;
+
+   for my $kid &#40; @{$self-&gt;{KIDS}} &#41; {
+      for my $op &#40; @{$kid-&gt;{OPS}} &#41; {
+         delete $op-&gt;{FILTERS};
+      }
+   }
 }
 
 ##
@@ -2660,7 +2666,7 @@
    if &#40; $@ &#41; {
       _write $self-&gt;{SYNC_WRITER_FD}, $@;
       ## Avoid DESTROY.
-      POSIX::exit 1;
+      POSIX::_exit 1;
    }
 
    ## We must be executing code in the child, otherwise exec&#40;&#41; would have
@@ -2677,12 +2683,12 @@
    ## this may cause the closure to be cleaned up.  Maybe.
    $kid-&gt;{VAL} = undef;
 
-   ## Use POSIX::exit to avoid global destruction, since this might
+   ## Use POSIX::_exit to avoid global destruction, since this might
    ## cause DESTROY&#40;&#41; to be called on objects created in the parent
    ## and thus cause double cleanup.  For instance, if DESTROY&#40;&#41; unlinks
    ## a file in the child, we don&#39;t want the parent to suddenly miss
    ## it.
-   POSIX::exit 0;
+   POSIX::_exit 0;
 }
 
 =pod
@@ -4349,7 +4355,7 @@
 The second problem is that Perl&#39;s DESTROY subs and other on-exit cleanup gets
 run in the child process.  If objects are instantiated in the parent before the
 child is forked, the DESTROY will get run once in the parent and once in
-the child.  When coprocess subs exit, POSIX::exit is called to work around this,
+the child.  When coprocess subs exit, POSIX::_exit is called to work around this,
 but it means that objects that are still referred to at that time are not
 cleaned up.  So setting package vars or closure vars to point to objects that
 rely on DESTROY to affect things outside the process &#40;files, etc&#41;, will
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;12&nbsp;09:20:40&nbsp;2017</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ticket migrated to github as <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/toddr/IPC-Run/issues/86">https://github.com/toddr/IPC-Run/issues/86</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;12&nbsp;09:20:51&nbsp;2017</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
