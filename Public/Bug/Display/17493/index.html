<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17493 for Glib: Makefile doesn&#39;t work with FreeBSD&#39;s make</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17493 for Glib: Makefile doesn&#39;t work with FreeBSD&#39;s make</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Glib/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Glib/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Glib/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Glib/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Glib">Glib CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17493</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Glib/Active/">Glib</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">kaffeetisch [...] gmx.de
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-14786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.103    </td>
  </tr>
  <tr id="CF-14787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;05&nbsp;14:39:59&nbsp;2006</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;Really broken in 1.104, but rt did not let me specify that value&#41;

When trying to build Glib on a FreeBSD system, I got the error:

Writing Makefile for Glib
&#34;Makefile&#34;, line 1186: Missing dependency operator
&#34;Makefile&#34;, line 1188: Need an operator
&#34;Makefile&#34;, line 1190: Need an operator

The lines in the Makefile are:
ifeq &#40;$&#40;LINKTYPE&#41;, dynamic&#41;
        BLIB_DONE=$&#40;INST_DYNAMIC&#41;
else
        BLIB_DONE=$&#40;INST_STATIC&#41;
endif

and cannot be understand by a non-GNU make. In BSD make it should be
something like
.if ${LINKTYPE} == &#34;dynamic&#34;
...
.else
...
.endif

But probably it&#39;s better to make the condition unnecessary at all.

The installation works fine if I use gmake instead of the default make
&#40;but unfortunately this means I cannot install Glib out-of-the-box from
the CPAN shell&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;14:44:12&nbsp;2006</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Possible fix</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> scott [...] asofyet.org, rwmcfa1 [...] neces.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Somebody submitted a patch for this to the sf.net tracker &#40;which is down
currently&#41;.  I&#39;m attaching it here again.  It seems to fix the problem
for me on FreeBSD 5.4 and doesn&#39;t seem to introduce new problems on
Linux either.

What do you guys think?
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -cr rrr/Glib-1.102/MakeHelper.pm sss/Glib-1.102/MakeHelper.pm
*** rrr/Glib-1.102/MakeHelper.pm	Fri Feb  4 20:38:46 2005
--- sss/Glib-1.102/MakeHelper.pm	Sun Jan 22 14:50:34 2006
***************
*** 373,405 ****
  	# of blib. basically what we need to wait on is the static/dynamic
  	# lib file to be created. the following trick is intended to handle
  	# both of those cases without causing the other to happen.
- 	my $blib_done;
- 	# this is very sloppy, because different makes have different
- 	# conditional syntaxes.
- 	use Config;
- 	if &#40;$Config{make} eq &#39;nmake&#39;&#41; {
- 		warn &#34;loathe nmake.\n&#34;;
- 		$blib_done = &#34;
- !If \&#34;\$&#40;LINKTYPE&#41;\&#34; == \&#34;dynamic\&#34;
- BLIB_DONE=\$&#40;INST_DYNAMIC&#41;
- !ELSE
- BLIB_DONE=\$&#40;INST_STATIC&#41;
- !ENDIF
- &#34;;
- 	} else {
- 		# assuming GNU Make
- 		$blib_done = &#34;
- ifeq &#40;\$&#40;LINKTYPE&#41;, dynamic&#41;
- 	BLIB_DONE=\$&#40;INST_DYNAMIC&#41;
- else
- 	BLIB_DONE=\$&#40;INST_STATIC&#41;
- endif
- &#34;;
- 	}
- 
  &#34;
! BLIB_DONE=
! $blib_done
  
  # documentation stuff
  build/doc.pl :: Makefile @xs_files
--- 373,380 ----
  	# of blib. basically what we need to wait on is the static/dynamic
  	# lib file to be created. the following trick is intended to handle
  	# both of those cases without causing the other to happen.
  &#34;
! BLIB_DONE= linkext
  
  # documentation stuff
  build/doc.pl :: Makefile @xs_files
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;14:44:15&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;11&nbsp;13:09:11&nbsp;2006</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">While the patch makes it possible to use FreeBSD&#39;s make, it doesn&#39;t work
when you use more than one job &#40;make -j x&#41;.  It dies with:

  make: don&#39;t know how to make blib/lib/Glib/GenPod.pm. Stop

The BLIB_DONE hack was supposed to prevent this.  So it looks like we
still need that code.  Can you provide a new patch that adds a new
branch for FreeBSD&#39;s make?  Or do you see a better way?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;13&nbsp;02:45:24&nbsp;2006</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17493]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 13 Feb 2006 08:42:31 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Glib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Torsten Schönfeld via RT&#34; &lt;bug-Glib@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; While the patch makes it possible to use FreeBSD&#39;s make, it doesn&#39;t work
&gt; when you use more than one job &#40;make -j x&#41;.  It dies with:
&gt; 
&gt;   make: don&#39;t know how to make blib/lib/Glib/GenPod.pm. Stop
&gt; 
&gt; The BLIB_DONE hack was supposed to prevent this.  So it looks like we
&gt; still need that code.  Can you provide a new patch that adds a new
&gt; branch for FreeBSD&#39;s make?  Or do you see a better way?
&gt; 
</div>
It seems that dependencies are missing. Adding

$&#40;INST_LIB&#41;/Glib/GenPod.pm $&#40;INST_LIB&#41;/Glib/ParseXSDoc.pm: pm_to_blib

to the Makefile seems to help.

Regards,
        Slaven

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de
  BBBike - route planner for cyclists in Berlin
  WWW version:                           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bbbike.de">http://www.bbbike.de</a></span>
  Perl/Tk version for Unix and Windows:  <span class="clickylink"><a target="new" rel="nofollow" href="http://bbbike.sourceforge.net">http://bbbike.sourceforge.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;13&nbsp;09:52:03&nbsp;2006</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems that dependencies are missing. Adding
&gt; 
&gt; $&#40;INST_LIB&#41;/Glib/GenPod.pm $&#40;INST_LIB&#41;/Glib/ParseXSDoc.pm: pm_to_blib
&gt; 
&gt; to the Makefile seems to help.
</div>
Yes, those dependencies do seem to help.  But unfortunately, I just
discovered that simply using BLIB_DONE=linkext as per the patch causes
the docgen stage[1] to be run multiple times: once during normal
building, and once when you issue &#34;make install&#34;.

Any ideas?

[1] /usr/bin/perl -I blib/lib -I blib/arch -MGlib::GenPod -MGlib \
        -e &#39;add_types &#40;&#34;doctypes&#34;&#41;; ...&#39;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;17:36:45&nbsp;2006</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17493]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 14 Feb 2006 23:33:23 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Glib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Torsten Schönfeld via RT&#34; &lt;bug-Glib@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; It seems that dependencies are missing. Adding
&gt; &gt; 
&gt; &gt; $&#40;INST_LIB&#41;/Glib/GenPod.pm $&#40;INST_LIB&#41;/Glib/ParseXSDoc.pm: pm_to_blib
&gt; &gt; 
&gt; &gt; to the Makefile seems to help.
</div>&gt; 
&gt; Yes, those dependencies do seem to help.  But unfortunately, I just
&gt; discovered that simply using BLIB_DONE=linkext as per the patch causes
&gt; the docgen stage[1] to be run multiple times: once during normal
&gt; building, and once when you issue &#34;make install&#34;.
&gt; 
&gt; Any ideas?
&gt; 
</div>
A very rough idea: the problem seems a makefile construct like this:

docgen: linkext
        touch docgen

linkext: foo

foo:
        touch foo

If you say &#34;make docgen&#34;, then the touch is done, every time,
basically the same problem as in Glib&#39;s makefile.

I succeeded in removing the problem by hacking the generated makefile:
removing the PHONY-ness from the linkext and dynamic targets, and
making linkext and dynamic &#34;touch&#34; files with the same names. But I
doubt this is a nice solution.

Regards,
        Slaven

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de

    tknotes - A knotes clone, written in Perl/Tk.
    <span class="clickylink"><a target="new" rel="nofollow" href="http://ptktools.sourceforge.net/#tknotes">http://ptktools.sourceforge.net/#tknotes</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;14&nbsp;10:21:25&nbsp;2006</span>
    <span class="description">kaffeetisch [...] gmx.de -  Subject changed from &#40;no value&#41; to &#39;Makefile doesn&#39;t work with FreeBSD&#39;s make&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;14&nbsp;10:39:46&nbsp;2006</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems like nobody in the know is able to come up with a generic
solution to this.  So I think we should just add a FreeBSD-specific
branch to the BLIB_DONE thing.  Slaven, what&#39;s the best way to find out
whether FreeBSD&#39;s own make is used?  Does $Config{make} contain anything
useful?

  perl -le&#39;use Config; print $Config{make};&#39;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;16&nbsp;17:42:38&nbsp;2006</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17493] Makefile doesn&#39;t work with FreeBSD&#39;s make</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 16 Apr 2006 22:24:05 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Glib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Torsten Schönfeld via RT&#34; &lt;bug-Glib@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17493">http://rt.cpan.org/Ticket/Display.html?id=17493</a></span> &gt;
&gt; 
&gt; It seems like nobody in the know is able to come up with a generic
&gt; solution to this.  So I think we should just add a FreeBSD-specific
&gt; branch to the BLIB_DONE thing.  Slaven, what&#39;s the best way to find out
&gt; whether FreeBSD&#39;s own make is used?  Does $Config{make} contain anything
&gt; useful?
&gt; 
&gt;   perl -le&#39;use Config; print $Config{make};&#39;
&gt; 
</div>
This returns &#34;make&#34;. GNU make is spelled &#34;gmake&#34; on BSD systems. Well,
nobody can stop a BSD user from using gmake instead of make for
compiling perl modules, and I don&#39;t know of a way to determine whether
BSD make or GNU make is actually used.

BTW, I assume this is not a FreeBSD-only problem, but openbsd and
netbsd have the same problem.

Regards,
        Slaven

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de

    tkruler - Perl/Tk program for measuring screen distances
    <span class="clickylink"><a target="new" rel="nofollow" href="http://ptktools.sourceforge.net/#tkruler">http://ptktools.sourceforge.net/#tkruler</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;23&nbsp;15:50:00&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Apr 16 17:42:38 2006, slaven@rezic.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Torsten Schönfeld via RT&#34; &lt;bug-Glib@rt.cpan.org&gt; writes:
&gt; 
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17493">http://rt.cpan.org/Ticket/Display.html?id=17493</a></span> &gt;
&gt; &gt; 
&gt; &gt; It seems like nobody in the know is able to come up with a generic
&gt; &gt; solution to this.  So I think we should just add a FreeBSD-specific
&gt; &gt; branch to the BLIB_DONE thing.  Slaven, what&#39;s the best way to find out
&gt; &gt; whether FreeBSD&#39;s own make is used?  Does $Config{make} contain anything
&gt; &gt; useful?
&gt; &gt; 
&gt; &gt;   perl -le&#39;use Config; print $Config{make};&#39;
&gt; &gt; 
</div>&gt; 
&gt; This returns &#34;make&#34;. GNU make is spelled &#34;gmake&#34; on BSD systems. Well,
&gt; nobody can stop a BSD user from using gmake instead of make for
&gt; compiling perl modules, and I don&#39;t know of a way to determine whether
&gt; BSD make or GNU make is actually used.
&gt; 
&gt; BTW, I assume this is not a FreeBSD-only problem, but openbsd and
&gt; netbsd have the same problem.
&gt; 
</div>
Please see the attached patch to workaround the problem on BSD systems.
The patch now introduces a third variant for the if-section in the
generated Makefile.

FYI, the only possibility to distinguish between BSD make and GNU make
seems to be the name of the Makefile. GNU make chooses first
GNUmakefile, then Makefile etc. BSD make &#40;at least the version which
comes with FreeBSD 6.1&#41; first chooses BSDmakefile, then Makefile etc.
With this knowledge one could create another way to solve the problem:
just dump generate BSDmakefile and GNUmakefile and let the make tool
decide which file to use.

Regards,
    Slaven
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># 
# 
# To apply this patch:
# STEP 1: Chdir to the source directory.
# STEP 2: Run the &#39;applypatch&#39; program with this patch file as input.
#
# If you do not have &#39;applypatch&#39;, it is part of the &#39;makepatch&#39; package
# that you can fetch from the Comprehensive Perl Archive Network:
# <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.com/CPAN/authors/Johan_Vromans/makepatch-x.y.tar.gz">http://www.perl.com/CPAN/authors/Johan_Vromans/makepatch-x.y.tar.gz</a></span>
# In the above URL, &#39;x&#39; should be 2 or higher.
#
# To apply this patch without the use of &#39;applypatch&#39;:
# STEP 1: Chdir to the source directory.
# STEP 2: Run the &#39;patch&#39; program with this file as input.
#
#### End of Preamble ####

#### Patch data follows ####
diff -up &#39;build/Glib-1.142-8XPuil/MakeHelper.pm&#39; &#39;new.build/Glib-1.142-8XPuil/MakeHelper.pm&#39;
Index: ./MakeHelper.pm
Prereq:  1.36 
--- ./MakeHelper.pm	Tue Oct 17 21:56:32 2006
+++ ./MakeHelper.pm	Tue Jan 23 21:36:29 2007
@@ -385,6 +385,14 @@ BLIB_DONE=\$&#40;INST_DYNAMIC&#41;
 BLIB_DONE=\$&#40;INST_STATIC&#41;
 !ENDIF
 &#34;;
+	} elsif &#40;$^O =~ m{^&#40;freebsd|netbsd|openbsd&#41;$}i&#41; {
+		$blib_done = &#34;
+.if \$&#40;LINKTYPE&#41; == dynamic
+BLIB_DONE=\$&#40;INST_DYNAMIC&#41;
+.else
+BLIB_DONE=\$&#40;INST_STATIC&#41;
+.endif
+&#34;;
 	} else {
 		# assuming GNU Make
 		$blib_done = &#34;
#### End of Patch data ####

#### ApplyPatch data follows ####
# Data version        : 1.0
# Date generated      : Tue Jan 23 21:38:28 2007
# Generated by        : makepatch 2.03
# Recurse directories : Yes
# Excluded files      : &#40;\A|/&#41;.*\~\Z
#                       &#40;\A|/&#41;.*\.a\Z
#                       &#40;\A|/&#41;.*\.bak\Z
#                       &#40;\A|/&#41;.*\.BAK\Z
#                       &#40;\A|/&#41;.*\.elc\Z
#                       &#40;\A|/&#41;.*\.exe\Z
#                       &#40;\A|/&#41;.*\.gz\Z
#                       &#40;\A|/&#41;.*\.ln\Z
#                       &#40;\A|/&#41;.*\.o\Z
#                       &#40;\A|/&#41;.*\.obj\Z
#                       &#40;\A|/&#41;.*\.olb\Z
#                       &#40;\A|/&#41;.*\.old\Z
#                       &#40;\A|/&#41;.*\.orig\Z
#                       &#40;\A|/&#41;.*\.rej\Z
#                       &#40;\A|/&#41;.*\.so\Z
#                       &#40;\A|/&#41;.*\.Z\Z
#                       &#40;\A|/&#41;\.del\-.*\Z
#                       &#40;\A|/&#41;\.make\.state\Z
#                       &#40;\A|/&#41;\.nse_depinfo\Z
#                       &#40;\A|/&#41;core\Z
#                       &#40;\A|/&#41;tags\Z
#                       &#40;\A|/&#41;TAGS\Z
# p &#39;MakeHelper.pm&#39; 15517 1169584589 0100644
#### End of ApplyPatch data ####

#### End of Patch kit [created: Tue Jan 23 21:38:28 2007] ####
#### Patch checksum: 54 1785 41951 ####
#### Checksum: 72 2409 27949 ####
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;25&nbsp;14:46:50&nbsp;2007</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please see the attached patch to workaround the problem on BSD systems.
&gt; The patch now introduces a third variant for the if-section in the
&gt; generated Makefile.
</div>
Thanks!  With this, what happens if someone uses gmake on one of those BSDs?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; FYI, the only possibility to distinguish between BSD make and GNU make
&gt; seems to be the name of the Makefile. GNU make chooses first
&gt; GNUmakefile, then Makefile etc. BSD make &#40;at least the version which
&gt; comes with FreeBSD 6.1&#41; first chooses BSDmakefile, then Makefile etc.
&gt; With this knowledge one could create another way to solve the problem:
&gt; just dump generate BSDmakefile and GNUmakefile and let the make tool
&gt; decide which file to use.
</div>
Hmm, that sounds circuitous.  I can&#39;t help thinking that there got to be
a better way to solve this issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;26&nbsp;02:39:53&nbsp;2007</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> SREZIC [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17493] Makefile doesn&#39;t work with FreeBSD&#39;s make</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 25 Jan 2007 23:16:43 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Glib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Torsten Schönfeld via RT&#34; &lt;bug-Glib@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17493">http://rt.cpan.org/Ticket/Display.html?id=17493</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; Please see the attached patch to workaround the problem on BSD systems.
&gt; &gt; The patch now introduces a third variant for the if-section in the
&gt; &gt; generated Makefile.
</div>&gt; 
&gt; Thanks!  With this, what happens if someone uses gmake on one of
&gt; those BSDs?
</div>
Ka boom! Typically BSD users will use BSD make. It&#39;s the default when
auto-configuring CPAN.pm, it is documented in most READMEs/INSTALLs of
perl modules to use &#34;make; make test; make install&#34;. GNU make is
installed as &#34;gmake&#34; on BSD machines if it is done through a port or
package.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; FYI, the only possibility to distinguish between BSD make and GNU make
&gt; &gt; seems to be the name of the Makefile. GNU make chooses first
&gt; &gt; GNUmakefile, then Makefile etc. BSD make &#40;at least the version which
&gt; &gt; comes with FreeBSD 6.1&#41; first chooses BSDmakefile, then Makefile etc.
&gt; &gt; With this knowledge one could create another way to solve the problem:
&gt; &gt; just dump generate BSDmakefile and GNUmakefile and let the make tool
&gt; &gt; decide which file to use.
</div>&gt; 
&gt; Hmm, that sounds circuitous.  I can&#39;t help thinking that there got to be
&gt; a better way to solve this issue.
</div>
Unfortunately, it seems the case if one really needs the conditions or
other extended make stuff. I found no way of determining within a
Makefile whether BSD make or GNU make is the caller. And I would be
really happy to know if there is a way.

Regards,
        Slaven

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de

    tktimex - time recording tool
    <span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/projects/ptktools/">http://sourceforge.net/projects/ptktools/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;10&nbsp;07:43:16&nbsp;2007</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> scott [...] asofyet.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 26 02:39:53 2007, slaven@rezic.de wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Thanks!  With this, what happens if someone uses gmake on one of
&gt; &gt; those BSDs?
</div>&gt; 
&gt; Ka boom! Typically BSD users will use BSD make. It&#39;s the default when
&gt; auto-configuring CPAN.pm, it is documented in most READMEs/INSTALLs of
&gt; perl modules to use &#34;make; make test; make install&#34;. GNU make is
&gt; installed as &#34;gmake&#34; on BSD machines if it is done through a port or
&gt; package.
</div>
OK, so here&#39;s an update to your patch that checks the environment
variable FORCE_GMAKE on BSDs to decide.  If it&#39;s set to something true,
gmake syntax is used.

Does that make sense?  Is FORCE_GMAKE a good name, or is there some kind
of standard name that&#39;s usually used for this?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;10&nbsp;07:48:48&nbsp;2007</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> scott [...] asofyet.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 10 07:43:16 2007, TSCH wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; OK, so here&#39;s an update to your patch that checks the environment
&gt; variable FORCE_GMAKE on BSDs to decide.  If it&#39;s set to something true,
&gt; gmake syntax is used.
</div>
*Here* it is.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: MakeHelper.pm
===================================================================
RCS file: /cvsroot/gtk2-perl/gtk2-perl-xs/Glib/MakeHelper.pm,v
retrieving revision 1.36
diff -u -d -p -r1.36 MakeHelper.pm
--- MakeHelper.pm	14 Jul 2006 18:43:45 -0000	1.36
+++ MakeHelper.pm	10 Feb 2007 12:31:14 -0000
@@ -374,8 +374,12 @@ sub postamble_docs_full {
 	# lib file to be created. the following trick is intended to handle
 	# both of those cases without causing the other to happen.
 	my $blib_done;
+
 	# this is very sloppy, because different makes have different
-	# conditional syntaxes.
+	# conditional syntaxes.  we support three brands: nmake, BSD make, and
+	# GNU make.  On Windows, we use nmake.  On BSD we use BSD make unless
+	# the environment variable FORCE_GMAKE is set, in which case we use
+	# gmake.  Everywhere else, we use gmake.
 	require Config;
 	if &#40;$Config::Config{make} eq &#39;nmake&#39;&#41; {
 		$blib_done = &#34;
@@ -385,6 +389,14 @@ BLIB_DONE=\$&#40;INST_DYNAMIC&#41;
 BLIB_DONE=\$&#40;INST_STATIC&#41;
 !ENDIF
 &#34;;
+	} elsif &#40;$^O =~ m{^&#40;freebsd|netbsd|openbsd&#41;$}i &#38;&#38; !$ENV{FORCE_GMAKE}&#41; {
+		$blib_done = &#34;
+.if \$&#40;LINKTYPE&#41; == dynamic
+BLIB_DONE=\$&#40;INST_DYNAMIC&#41;
+.else
+BLIB_DONE=\$&#40;INST_STATIC&#41;
+.endif
+&#34;;
 	} else {
 		# assuming GNU Make
 		$blib_done = &#34;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;10&nbsp;07:49:12&nbsp;2007</span>
    <span class="description">kaffeetisch [...] gmx.de -  Given to TSCH</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;24&nbsp;09:16:46&nbsp;2007</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; OK, so here&#39;s an update to your patch that checks the environment
&gt; variable FORCE_GMAKE on BSDs to decide.  If it&#39;s set to something true,
&gt; gmake syntax is used.
</div>
Committed to both branches.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;24&nbsp;09:16:49&nbsp;2007</span>
    <span class="description">kaffeetisch [...] gmx.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
