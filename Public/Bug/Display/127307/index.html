<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127307 for Net-DNS-SEC: [PATCH] load Net::DNS::SEC before using ::libcrypto</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127307 for Net-DNS-SEC: [PATCH] load Net::DNS::SEC before using ::libcrypto</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS-SEC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS-SEC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS-SEC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS-SEC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS-SEC">Net-DNS-SEC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127307</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS-SEC/Active/">Net-DNS-SEC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dam [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22472-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22473-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.11    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;06&nbsp;01:53:49&nbsp;2018</span>
    <span class="description">dam [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dam [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] load Net::DNS::SEC before using ::libcrypto</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In Debian we are currently applying the following patch to
Net-DNS-SEC.
We thought you might be interested in it too.

Description: load Net::DNS::SEC before using ::libcrypto
 As noted in &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/909911">https://bugs.debian.org/909911</a></span>&gt;, loading e.g. Net::DNS::SEC::DSA
 without first loading Net::DNS::SEC fails with
 .
    Died at /usr/lib/x86_64-linux-gnu/perl5/5.26/Net/DNS/SEC/DSA.pm line 51.
 .
 This is not cought by the test suite, because all the tests load
 Net::DNS::SEC when they check their pre-requisites.
 .
 Explicitly loading of Net::DNS::SEC in the affected modules fixes the
 problem.
Author: Damyan Ivanov &lt;dmn@debian.org&gt;
Bug-Debian: <span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/909911">https://bugs.debian.org/909911</a></span>


The patch is tracked in our Git repository at
<span class="clickylink"><a target="new" rel="nofollow" href="https://salsa.debian.org/perl-team/modules/packages/libnet-dns-sec-perl/raw/master/debian/patches/load-Net::DNS::SEC-before-using-::libcrypto.patch">https://salsa.debian.org/perl-team/modules/packages/libnet-dns-sec-perl/raw/master/debian/patches/load-Net::DNS::SEC-before-using-::libcrypto.patch</a></span>

Thanks for considering,
  Damyan Ivanov,
  Debian Perl Group
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;06&nbsp;01:53:51&nbsp;2018</span>
    <span class="description">dam [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s the patch.
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;28&nbsp;19:29:50&nbsp;2018</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Oct 06 01:53:49 2018, DAM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In Debian we are currently applying the following patch to
&gt; Net-DNS-SEC.
</div>
That is a terrible idea

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Description: load Net::DNS::SEC before using ::libcrypto
&gt;  As noted in &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/909911">https://bugs.debian.org/909911</a></span>&gt;, loading e.g.
&gt; Net::DNS::SEC::DSA
&gt;  without first loading Net::DNS::SEC fails with
&gt;  .
&gt;     Died at /usr/lib/x86_64-linux-gnu/perl5/5.26/Net/DNS/SEC/DSA.pm
&gt; line 51.
&gt;  .
&gt;  This is not cought by the test suite, because all the tests load
&gt;  Net::DNS::SEC when they check their pre-requisites.
</div>
The test suite only concerns itself with checking that the OpenSSL interface works as expected.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Explicitly loading of Net::DNS::SEC in the affected modules fixes the
&gt;  problem.
</div>
which it does not.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
As is very clear from the documentation, Net::DNS::SEC is an extension to Net::DNS which houses the cryptographic components required for signing and verification of DNSSEC signatures.

There is no supported use-case which requires these components to be compiled independently of Net::DNS.  It is entirely a matter for Net::DNS to ensure that packages can be loaded as required.

Net::DNS::SEC::DSA, by design, is intended to fail to compile if either
  a&#41; use Net::DNS::SEC is not present in the application,
or
  b&#41; DSA has been disabled in the OpenSSL libcrypto component.

Your proposed change undermines that behaviour, and does not allow an application to be built with the DNSSEC features disabled. Moreover, in the case where the application did use Net::DNS::SEC, the additional use declaration achieves absolutely nothing!

It is absolutely essential that no cryptographic feature remain in the code in the absence of &#34;use Net::DNS::SEC&#34; in the application, and especially when a Perl compiler is used instead of the usual interpreter.
[See the warnings in README and in <span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/source/">https://www.openssl.org/source/</a></span>]

The original PR does not identify any specific failure scenario, version numbers, or any other useful information, so I assume latest versions.

Warnings can be produced if $rrsig-&gt;verify&#40;&#41; is attempted without first declaring &#34;use Net::DNS::SEC&#34;, which IMHO is an unreasonable thing to do, but that should fail in ways a user can understand.

The problem is inside Net::DNS, and a simple solution requires 2 patches:

*** /home/rwf/svn/net-dns/t/65-RRSIG-RSASHA1.t  2018-09-07 09:03:09.447784000 +0100
--- ./65-RRSIG-RSASHA1.t        2018-11-28 23:29:00.215109583 +0000
***************
*** 7,13 ****
  my @prerequisite = qw&#40;
                MIME::Base64
                Time::Local
-               Net::DNS::RR::RRSIG
                Net::DNS::SEC
                &#41;;
  
--- 7,12 ----


*** /home/rwf/svn/net-dns/lib/Net/DNS/RR/RRSIG.pm       2018-09-07 09:03:09.447784000 +0100
--- ./RRSIG.pm  2018-11-28 23:43:40.793424834 +0000
***************
*** 39,44 ****
--- 39,45 ----
  
  use constant EXISTS =&gt; join &#39;&#39;, qw&#40;r e q u i r e&#41;;            # Defeat static analysers and grep
  use constant DNSSEC =&gt; defined&#40; eval join &#39; &#39;, EXISTS, PRIVATE &#41;;
+ use constant ACTIVE =&gt; DNSSEC &#38;&#38; $INC{&#39;Net/DNS/SEC.pm&#39;};      # Discover how we got here
  
  my &#40;$DSA&#41; = grep { DNSSEC &#38;&#38; defined&#40; eval join &#39; &#39;, EXISTS, $_ &#41; } DSA;
  my &#40;$RSA&#41; = grep { DNSSEC &#38;&#38; defined&#40; eval join &#39; &#39;, EXISTS, $_ &#41; } RSA;
***************
*** 308,313 ****
--- 309,316 ----
                $self-&gt;{sigexpiration} = $self-&gt;{siginception} + $self-&gt;{sigval}
                                unless $self-&gt;{sigexpiration};
  
+               croak &#39;missing &#34;use Net::DNS::SEC&#34; declaration&#39; unless ACTIVE;
+ 
                $self-&gt;_CreateSig&#40; $self-&gt;_CreateSigData&#40;$rrsetref&#41;, $private &#41;;
                return $self;
        }
***************
*** 384,389 ****
--- 387,394 ----
                        return 0;
                }
  
+               croak &#39;missing &#34;use Net::DNS::SEC&#34; declaration&#39; unless ACTIVE;
+ 
                $self-&gt;_VerifySig&#40; $self-&gt;_CreateSigData&#40;$rrsetref&#41;, $keyref &#41; || return 0;
  
                # time to do some time checking.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;28&nbsp;19:29:51&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;21&nbsp;14:40:19&nbsp;2018</span>
    <span class="description">fsfs [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Net::DNS::SEC::DSA, by design, is intended to fail to compile if
&gt; either
&gt;   a&#41; use Net::DNS::SEC is not present in the application,
&gt; or
&gt;   b&#41; DSA has been disabled in the OpenSSL libcrypto component.
</div>
so basically you&#39;re saying, running &#34;perl -wc lib/Net/DNS/SEC/DSA.pm&#34; to check for simple syntax errors is not supposed to work for DSA.pm / ECDSA.pm / EdDSA.pm / ECCGOST.pm; this is made even more clear by the error message that was added in 1.11.

Which means Debian should remove the patch and exclude those modules from this kind of automatic testing. Which is what I&#39;m doing now, so I think this ticket can be closed.

Florian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;21&nbsp;14:40:20&nbsp;2018</span>
    <span class="description">fsfs [...] debian.org -  Fixed in 1.11 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;31&nbsp;09:38:46&nbsp;2018</span>
    <span class="description">NLNETLABS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Resolved in 1.11
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;31&nbsp;09:38:47&nbsp;2018</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
