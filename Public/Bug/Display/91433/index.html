<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91433 for XML-LibXML: Typo in Builder.pm</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91433 for XML-LibXML: Typo in Builder.pm</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-LibXML">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-LibXML">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-LibXML">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-LibXML">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML">XML-LibXML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91433</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-LibXML">XML-LibXML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ThB [...] gymel.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37350-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
2.0019</li>
<li>
2.0107</li>
</ul>
    </td>
  </tr>
  <tr id="CF-37351-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test.rdf<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1302630/690183/test.rdf">
Mon Dec 16 17:09:24 2013 (2.2k) by ThB [...] gymel.com
</a>
</font></li>
</ul>


testcase.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1302630/690184/testcase.pl">
Mon Dec 16 17:09:24 2013 (2.5k) by ThB [...] gymel.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=91433">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302223" href="/Public/Bug/Display.html?id=91433#txn-1302223">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;15&nbsp;13:13:48&nbsp;2013</span>
    <span class="description">ThB [...] gymel.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Typo in Builder.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302223/689951/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689951">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 436b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">start_element on a root element gives annoying warnings for uninitialized variables in LibXML.pm at the calls of _setNamespace in setNamespace&#40;&#41; method for XML::LibXML::Element.

Turns out to be a Typo in LibXML::SAX::Builder.pm, line 191: The attribute&#39;s name has to be &#39;LocalName&#39; instead of &#39;Localname&#39;.

BTW the generator in question, which by the comment two lines above &#34;does not set namespaces correctly&#34; is XML::LibXML::SAX ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302236" href="/Public/Bug/Display.html?id=91433#txn-1302236">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;15&nbsp;13:21:54&nbsp;2013</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302236/689954/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689954">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 684b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi THB,

On Sun Dec 15 13:13:48 2013, THB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; start_element on a root element gives annoying warnings for
&gt; uninitialized variables in LibXML.pm at the calls of _setNamespace in
&gt; setNamespace&#40;&#41; method for XML::LibXML::Element.
&gt; 
&gt; Turns out to be a Typo in LibXML::SAX::Builder.pm, line 191: The
&gt; attribute&#39;s name has to be &#39;LocalName&#39; instead of &#39;Localname&#39;.
&gt; 
&gt; BTW the generator in question, which by the comment two lines above
&gt; &#34;does not set namespaces correctly&#34; is XML::LibXML::SAX ...
</div>
It&#39;s hard to understand from your description how to reproduce this bug. Can you provide a reproducing script or more preferably a test script that fails?

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302237" href="/Public/Bug/Display.html?id=91433#txn-1302237">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;15&nbsp;13:21:54&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302286" href="/Public/Bug/Display.html?id=91433#txn-1302286">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;15&nbsp;18:41:23&nbsp;2013</span>
    <span class="description">ThB [...] gymel.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302286/689986/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689986">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 284b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s hard to understand from your description how to reproduce this
&gt; bug. Can you provide a reproducing script or more preferably a test
&gt; script that fails?
</div>
Not easily. But ain&#39;t the typo obvious if you look at &lt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl-xml.sourceforge.net/perl-sax/sax-2.1.html">http://perl-xml.sourceforge.net/perl-sax/sax-2.1.html</a></span> &gt;?

Thomas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302468" href="/Public/Bug/Display.html?id=91433#txn-1302468">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;16&nbsp;06:24:10&nbsp;2013</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302468/690095/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/690095">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 644b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Thomas,

On Sun Dec 15 18:41:23 2013, THB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; It&#39;s hard to understand from your description how to reproduce this
&gt; &gt; bug. Can you provide a reproducing script or more preferably a test
&gt; &gt; script that fails?
</div>&gt; 
&gt; Not easily. But ain&#39;t the typo obvious if you look at &lt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl">http://perl</a></span>-
&gt; xml.sourceforge.net/perl-sax/sax-2.1.html &gt;?
</div>
Please provide such a test script, regardless of how &#34;not easily&#34; it would be &#40;and it shouln&#39;t be too hard because $SIG{__WARN__} can trap warnings. By policy, I don&#39;t fix bugs in XML::LibXML without an accompanying test, whenever possible. Sorry if I&#39;m sounding harsh. 

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302630" href="/Public/Bug/Display.html?id=91433#txn-1302630">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;16&nbsp;17:09:24&nbsp;2013</span>
    <span class="description">ThB [...] gymel.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302630/690182/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/690182">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">All right,

attached test data &#40;test.rdf&#41; and a script &#40;testcase.pl&#41; reproducing the warnings:

An OAI response &#40;processed by the outerSAX handler in the script&#41; may contain one or several OAI:records . Within each record there es an metadata element still in the OAI namespace. Inside this metadata container there is exactly one element belonging to an arbitrary foreign namespace and the subtree it spans shall be captured with an XML::LibXML::SAX::Builder &#40;in order to process it with LibXSLT - not relevant for the test case&#41;. Therefore the outerSAX handler activates the innerSAX handler for bookkeeping which in turn instantiates a fresh Builder whenever it finds itself on the outmost level.

Now each Namespace attribute of the element directly below the OAI:metadata element &#40;i.e. the root node of the document to be constructed&#41; provoces one warning in LibXML.pm, because the namespace prefixes provided to setNamespace&#40;&#41; by start_element&#40;&#41; in Builder.pm are erroneously undef due to the typo in line 191.

Hope this helps &#40;and sorry if I didn&#39;t catch your remark with respect to $SIG{__WARN__}&#41;

Thomas
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.rdf</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302630/690183/test.rdf">Download test.rdf</a><br />
<span class="downloadcontenttype">application/rdf+xml 2.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> testcase.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302630/690184/testcase.pl">Download testcase.pl</a><br />
<span class="downloadcontenttype">text/x-perl 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
use strict;
use warnings;

BEGIN {
  $XML::SAX::ParserPackage = &#34;XML::LibXML::SAX&#34;;
}

use XML::SAX::ParserFactory;

my $metadataHandler = innerSAX-&gt;new&#40;&#41;;
my $oaiHandler = outerSAX-&gt;new&#40;metadataHandler =&gt; $metadataHandler,
                               oaiNS =&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.openarchives.org/OAI/2.0/">http://www.openarchives.org/OAI/2.0/</a></span>&#34;&#41;;

my $parser = XML::SAX::ParserFactory-&gt;parser&#40;Handler =&gt; $oaiHandler&#41;;

$parser-&gt;parse_file&#40;&#34;test.rdf&#34;&#41;;


package outerSAX;
use base qw&#40;XML::SAX::Base&#41;;

sub new {
  my &#40;$class, %opts&#41; = @_;
  my $self = bless \%opts, ref&#40;$class&#41; || $class;
  $self-&gt;set_handler&#40; undef &#41;;
  return $self;
}

sub start_element {
  my &#40;$self, $element&#41; = @_;

  return $self-&gt;SUPER::start_element&#40;$element&#41; unless $element-&gt;{NamespaceURI} eq $self-&gt;{oaiNS};

  if &#40; $element-&gt;{LocalName} eq &#39;metadata&#39; &#41; {
      $self-&gt;{ OLD_Handler } = $self-&gt;get_handler&#40;&#41;;
      $self-&gt;set_handler&#40; $self-&gt;{metadataHandler} &#41;;
    }
  else {
      return $self-&gt;SUPER::start_element&#40;$element&#41;};
}

sub end_element {
  my &#40;$self, $element&#41; = @_;

  return $self-&gt;SUPER::end_element&#40;$element&#41; unless $element-&gt;{NamespaceURI} eq $self-&gt;{oaiNS};

  if &#40; $element-&gt;{LocalName} eq &#39;metadata&#39; &#41; {
      $self-&gt;set_handler&#40; $self-&gt;{OLD_Handler} &#41;;
    }
  else {
      $self-&gt;SUPER::end_element&#40;$element&#41;;
    }
}


package innerSAX;
use base qw&#40;XML::SAX::Base&#41;;
use XML::LibXML::SAX::Builder;

sub new {
  my &#40;$class, %opts&#41; = @_;
  my $self = bless \%opts, ref&#40;$class&#41; || $class;
  $self-&gt;{&#39;tagStack&#39;} = [];
  return $self;
}

sub start_element {
  my &#40;$self, $element&#41; = @_;

  unless &#40; $self-&gt;{&#39;tagStack&#39;}[0] &#41; {
      my $builder = XML::LibXML::SAX::Builder-&gt;new&#40;&#41; or die &#34;cannot instantiate SAX builder&#34;;
      $self-&gt;set_handler&#40;$builder&#41;;
      $self-&gt;SUPER::start_document&#40;&#41;; # i.e. $builder-&gt;start_document&#40;&#41;;
# DEBUG ME: warnings occur here 
      $self-&gt;SUPER::start_element&#40;$element&#41;;
    }
  else {
      $self-&gt;SUPER::start_element&#40;$element&#41;};

  push&#40;@{$self-&gt;{&#39;tagStack&#39;}}, $element-&gt;{Name}&#41;;
}

sub end_element {
  my &#40;$self, $element&#41; = @_;
  $self-&gt;SUPER::end_element&#40;$element&#41;;
  pop &#40;@{$self-&gt;{&#39;tagStack&#39;}}&#41;;

  unless &#40; $self-&gt;{&#39;tagStack&#39;}[0] &#41; {
      my $hdl = $self-&gt;get_handler&#40;&#41;;
      $self-&gt;set_handler&#40;undef&#41;;

# convert fragment to document, do something with it &#40;in real life: XSLT&#41;
      my $fragment = $hdl-&gt;done&#40;&#41;;
      my $child = $fragment-&gt;firstChild&#40;&#41;;
      $child = $child-&gt;nextSibling while $child &#38;&#38; $child-&gt;nodeName eq &#34;#text&#34;;
      my $tempdoc = XML::LibXML::Document-&gt;createDocument&#40;&#41; or die &#34;cannot create new Document&#34;;
      $tempdoc-&gt;addChild&#40;$child&#41; or die &#34;cannot addChild&#34;;
      print $tempdoc-&gt;toString;

    }
}

1;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302827" href="/Public/Bug/Display.html?id=91433#txn-1302827">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;17&nbsp;07:22:11&nbsp;2013</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1302827/690299/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/690299">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 275b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Thomas,

thanks! I was able to convert your testcase into a working test file, and the fix with the test is now part of XML-LibXML-2.0108 which I just uploaded to CPAN.

I&#39;m closing this bug - please let me know if there&#39;s anything else you need.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1302830" href="/Public/Bug/Display.html?id=91433#txn-1302830">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;17&nbsp;07:22:12&nbsp;2013</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.473192</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
