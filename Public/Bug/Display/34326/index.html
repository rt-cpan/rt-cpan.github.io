<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34326 for Finance-Quote: Source for TSX</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34326 for Finance-Quote: Source for TSX</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Finance-Quote">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Finance-Quote">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Finance-Quote">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Finance-Quote">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Finance-Quote">Finance-Quote CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34326</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Finance-Quote">Finance-Quote</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">eco [...] ecocode.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
potyl [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-13576-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13577-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




TSX.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/513207/255594/TSX.pm">
Sat Sep 27 12:31:35 2008 (5.6k) by potyl [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/438110/214544/TSX.pm">
Fri Mar 21 11:26:03 2008 (5.6k) by potyl [...] cpan.org
</a>
</font></li>
</ul>


tsx.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/513207/255597/tsx.t">
Sat Sep 27 12:31:35 2008 (926b) by potyl [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=34326">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-438110" href="/Public/Bug/Display.html?id=34326#txn-438110">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;11:26:03&nbsp;2008</span>
    <span class="description">potyl [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Source for TSX</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/438110/214541/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/214541">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 152b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a source for the Toronto Stock Exchange &#40;TSX&#41;. This source
provides a limited subset of labels but is very fast when multiple
stocks are fetched.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TSX.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/438110/214544/TSX.pm">Download TSX.pm</a><br />
<span class="downloadcontenttype">text/x-perl 5.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
#
#    Copyright &#40;C&#41; 1998, Dj Padzensky &lt;djpadz@padz.net&gt;
#    Copyright &#40;C&#41; 1998, 1999 Linas Vepstas &lt;linas@linas.org&gt;
#    Copyright &#40;C&#41; 2000, Yannick LE NY &lt;y-le-ny@ifrance.com&gt;
#    Copyright &#40;C&#41; 2000, Paul Fenwick &lt;pjf@cpan.org&gt;
#    Copyright &#40;C&#41; 2000, Brent Neal &lt;brentn@users.sourceforge.net&gt;
#    Copyright &#40;C&#41; 2001, Leigh Wedding &lt;leigh.wedding@telstra.com&gt;
#    Copyright &#40;C&#41; 2006, Mika Laari &lt;mika.laari@iki.fi&gt;
#    Copyright &#40;C&#41; 2008, Emmauel Rodriguez &lt;emmanuel.rodriguez@gmail.com&gt;
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    &#40;at your option&#41; any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
#    02111-1307, USA
#
#
# This code derived from the work of Mika Laari in the package
# Finance::Quote::HEX.
#
# This code was developed as part of GnuCash &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnucash.org/">http://www.gnucash.org/</a></span>&gt;

require 5.005;

use strict;

package Finance::Quote::TSX;

use LWP::UserAgent;
use HTML::TableExtract;
use URI;
use URI::QueryParam;
	
use vars qw/$VERSION/;

$VERSION = &#34;1.0&#34;;

# This URL is able to accept up to 10 symbols &#40;QuoteSymbol_1 .. QuoteSymbol_10&#41;
my $TSX_URL = URI-&gt;new&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tsx.com/HttpController?GetPage=QuotesLookupPage&#38;DetailedView=DetailedPrices&#38;Language=en&#38;x=58&#38;y=15&#39;&#41;">http://www.tsx.com/HttpController?GetPage=QuotesLookupPage&#38;DetailedView=DetailedPrices&#38;Language=en&#38;x=58&#38;y=15&#39;&#41;</a></span>;

# The number of symbols that can be fetched at a time per URL
my $BATCH_SIZE = 10;

my @LABELS = qw&#40;name last net p_change volume exchange&#41;;


sub methods {
	return &#40;
		tsx    =&gt; \&#38;tsx,
		canada =&gt; \&#38;tsx,
	&#41;;
}

sub labels {
	return &#40;
		tsx    =&gt; \@LABELS,
		canada =&gt; \@LABELS,
	&#41;;
}


# Toronto Stock Exchange &#40;TSX&#41;
# The TSX provides free delayed quotes through their webpage.
# This module is based on the HEX.pm.
#
# Maintainer of this section is Emmanuel Rodriguiz &lt;emmanuel.rodriguez@gmail.com&gt;.

sub tsx {
	my $quoter = shift;
	my @symbols = @_;
	return unless @symbols;

	my %info = &#40;&#41;;

	# The list of symbols that are requested, this is needed because the URL
	# returns matches for similar symbols
	my %is_wanted = map { &#40;$_ =&gt; 1&#41; } @symbols;
	
	# Fetch the stocks per batch
	while &#40;@symbols&#41; {
		
		# Get the next batch of symbols, must have exactly 10 symbols &#40;pad the rest&#41;
		my @batch = splice @symbols, 0, $BATCH_SIZE;
		push @batch, &#40;&#39;&#39;&#41; x &#40;$BATCH_SIZE - @batch&#41;;
		
		# Build the URL
		my $url = $TSX_URL-&gt;clone;
		my $i = 0;
		foreach my $symbol &#40;@batch&#41; {
			my $field = &#34;QuoteSymbol_&#34; . ++$i;
			$url-&gt;query_param&#40;$field, $symbol&#41;;
		}

		
		# Download the stock information
		my $response = $quoter-&gt;user_agent-&gt;get&#40;$url&#41;;
		unless &#40;$response-&gt;is_success&#41; {
			foreach my $symbol &#40;@batch&#41; {
				$info{$symbol, &#39;success&#39;} = 0;
				$info{$symbol, &#39;errormsg&#39;} = &#34;HTTP session failed&#34;;
			}
			next;
		}
	

		# Extract the stock information
		extract_stock_data&#40;\%is_wanted, \%info, $response-&gt;content&#41;;
	}
	

	# Make sure that all symbols where found
	foreach my $symbol &#40;@symbols&#41; {
		next if exists $info{$symbol, &#39;name&#39;};
		$info{$symbol, &#39;success&#39;} = 0;
		$info{$symbol, &#39;errormsg&#39;} = &#34;Symbol not found&#34;;
	}
	
	return wantarray&#40;&#41; ? %info : \%info;
}


#
# Extracts the stock data from an HTML page.
#
# Returns a list of symbol structs.
#
sub extract_stock_data {

	my &#40;$is_wanted, $info, $content&#41; = @_;

	# The stocks are in &lt;tabel class=&#34;resultsTable&#34;&gt;
	my $parser = HTML::TableExtract-&gt;new&#40;attribs =&gt; { class =&gt; &#39;resultsTable&#39; } &#41;;
	$parser-&gt;parse&#40;$content&#41;;
	
	my &#40;$table&#41; = $parser-&gt;tables;
	return unless defined $table;
	
	my $is_header = 1;
	foreach my $row &#40;$table-&gt;rows&#41; {
		
		# Skip the header
		if &#40;$is_header&#41; {
			$is_header = 0;
			next;
		}

		# Keep the symbol if it&#39;s wanted
		my $symbol = $row-&gt;[0];
		next unless $is_wanted-&gt;{$symbol};


		my $i = 0;
		foreach my $field &#40;@LABELS&#41; {
			$info-&gt;{$symbol, $field} = $row-&gt;[$i++];
		}


		# Cleanup
		$info-&gt;{$symbol, &#39;volume&#39;} =~ s/,//g;
		$info-&gt;{$symbol, &#39;p_change&#39;} =~ s/^[+]//;
		$info-&gt;{$symbol, &#39;net&#39;} =~ s/^[+]//;
		
		$info-&gt;{$symbol, &#39;method&#39;} = &#39;tsx&#39;;
		$info-&gt;{$symbol, &#39;success&#39;} = 1;
	}
}


1;

=head1 NAME

Finance::Quote::TSX	- Obtain quotes from the Toronto Stock Exchange.

=head1 SYNOPSIS

    use Finance::Quote;

    $q = Finance::Quote-&gt;new;

    %stockinfo = $q-&gt;fetch&#40;&#34;tsx&#34;,&#34;NT-T&#34;&#41;;	  # Only query TSX.
    %stockinfo = $q-&gt;fetch&#40;&#34;canada&#34;,&#34;NT&#34;&#41;; # Failover to other sources OK.

=head1 DESCRIPTION

This module obtains information from the Toronto Stock Exchange
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tsx.com/">http://www.tsx.com/</a></span>.

This module is not loaded by default on a Finance::Quote object.
It&#39;s possible to load it explicity by placing &#34;TSX&#34; in the argument
list to Finance::Quote-&gt;new&#40;&#41;.

This module provides both the &#34;tsx&#34; and &#34;toronto&#34; fetch methods.
Please use the &#34;canada&#34; fetch method if you wish to have failover with other
sources for Canadian stocks.  Using the &#34;hex&#34; method will guarantee that your
information only comes from the Toronto Stock Exchange.

=head1 LABELS RETURNED

The following labels are returned by Finance::Quote::HEX:
name, last, net, p_change, volume and exchange.

This module returns less information &#40;labels&#41; than other sources but it&#39;s able
to retrieve them faster because each HTTP request performed can return up to 10
stocks. Thus, if the labels provided by this module are sufficient for your
application then you should give it a try.

=head1 SEE ALSO

Toronto Stock Exchange, <span class="clickylink"><a target="new" rel="nofollow" href="http://www.tsx.com/">http://www.tsx.com/</a></span>

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-513156" href="/Public/Bug/Display.html?id=34326#txn-513156">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;04:07:04&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/513156/255557/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/255557">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 439b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 21 11:26:03 2008, POTYL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s a source for the Toronto Stock Exchange &#40;TSX&#41;. This source
&gt; provides a limited subset of labels but is very fast when multiple
&gt; stocks are fetched.
</div>
Hello Potyl,

Thanks for writing the Toronto Stock Exchange Module of Finance::Quote.
The module will be included once a test script has been written for it.
May be you have the possibility to write this ?

Thanks for your work

-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-513157" href="/Public/Bug/Display.html?id=34326#txn-513157">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;04:07:05&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-513184" href="/Public/Bug/Display.html?id=34326#txn-513184">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;08:52:33&nbsp;2008</span>
    <span class="description">potyl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/513184/255580/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/255580">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 791b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello Potyl,
&gt; 
&gt; Thanks for writing the Toronto Stock Exchange Module of Finance::Quote.
&gt; The module will be included once a test script has been written for it.
&gt; May be you have the possibility to write this ?
&gt; 
&gt; Thanks for your work
</div>
I have some bad news, the TSX page that I was using will be removed the
30th of September 2008. The web site has this warning on top.

ATTENTION WEBSITE VISITORS:

This webpage and all detailed quote pages will be removed from the
tsx.com website on Tuesday, September 30, 2008. For detailed quote
information on all Toronto Stock Exchange and TSX Venture Exchange
securities, please visit our new North American market information
website at www.TMXmoney.com.

I will try to see if I can convert the existing code base to the new URL
and format.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-513207" href="/Public/Bug/Display.html?id=34326#txn-513207">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;12:31:35&nbsp;2008</span>
    <span class="description">potyl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/513207/255591/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/255591">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 79b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I updated the module in order get the new site. I have also create unit
tests.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/513207/255594/TSX.pm">Download TSX.pm</a><br />
<span class="downloadcontenttype">text/x-perl 5.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
#
#    Copyright &#40;C&#41; 1998, Dj Padzensky &lt;djpadz@padz.net&gt;
#    Copyright &#40;C&#41; 1998, 1999 Linas Vepstas &lt;linas@linas.org&gt;
#    Copyright &#40;C&#41; 2000, Yannick LE NY &lt;y-le-ny@ifrance.com&gt;
#    Copyright &#40;C&#41; 2000, Paul Fenwick &lt;pjf@cpan.org&gt;
#    Copyright &#40;C&#41; 2000, Brent Neal &lt;brentn@users.sourceforge.net&gt;
#    Copyright &#40;C&#41; 2001, Leigh Wedding &lt;leigh.wedding@telstra.com&gt;
#    Copyright &#40;C&#41; 2006, Mika Laari &lt;mika.laari@iki.fi&gt;
#    Copyright &#40;C&#41; 2008, Emmauel Rodriguez &lt;potyl@cpan.org&gt;
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    &#40;at your option&#41; any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
#    02111-1307, USA
#
#
# This code derived from the work of Mika Laari in the package
# Finance::Quote::HEX.
#
# This code was developed as part of GnuCash &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnucash.org/">http://www.gnucash.org/</a></span>&gt;

require 5.005;

use strict;

package Finance::Quote::TSX;

use LWP::UserAgent;
use HTML::TableExtract;
use URI;
use URI::QueryParam;
	
use vars qw/$VERSION/;

$VERSION = &#34;1.0&#34;;

# This URL is able to accept up to 10 symbols at a time
my $TSX_URL = URI-&gt;new&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://cxa.marketwatch.com/tsx/en/market/getquote.aspx&#39;&#41;">http://cxa.marketwatch.com/tsx/en/market/getquote.aspx&#39;&#41;</a></span>;

# The number of symbols that can be fetched at a time per URL
my $BATCH_SIZE = 10;

my @LABELS = qw&#40;name last net p_change volume exchange&#41;;


sub methods {
	return &#40;
		tsx    =&gt; \&#38;tsx,
		canada =&gt; \&#38;tsx,
	&#41;;
}

sub labels {
	return &#40;
		tsx    =&gt; \@LABELS,
		canada =&gt; \@LABELS,
	&#41;;
}


# Toronto Stock Exchange &#40;TSX&#41;
# The TSX provides free delayed quotes through their webpage.
# This module is based on HEX.pm.
#
# Maintainer of this section is Emmanuel Rodriguez &lt;potyl@cpan.org&gt;.

sub tsx {
	my $quoter = shift;
	my @symbols = @_;
	return unless @symbols;

	my %info = &#40;&#41;;

	# Fetch the stocks per batch
	while &#40;@symbols&#41; {
		
		# Get the next batch of symbols
		my @batch = splice @symbols, 0, $BATCH_SIZE;
		
		# Build the URL
		my $url = $TSX_URL-&gt;clone;
		$url-&gt;query_param&#40;symb =&gt; join &#39;,&#39;, @batch&#41;;

		# Download the stock information
		my $response = $quoter-&gt;user_agent-&gt;get&#40;$url&#41;;
		unless &#40;$response-&gt;is_success&#41; {
			foreach my $symbol &#40;@batch&#41; {
				$info{$symbol, &#39;success&#39;} = 0;
				$info{$symbol, &#39;errormsg&#39;} = &#34;HTTP session failed&#34;;
			}
			next;
		}

		# Extract the stock information
		extract_stock_data&#40;\%info, $response-&gt;content&#41;;
	}
	

	# Make sure that all symbols where found
	foreach my $symbol &#40;@symbols&#41; {
		next if exists $info{$symbol, &#39;name&#39;};
		$info{$symbol, &#39;success&#39;} = 0;
		$info{$symbol, &#39;errormsg&#39;} = &#34;Symbol not found&#34;;
	}
	
	return wantarray&#40;&#41; ? %info : \%info;
}


#
# Extracts the stock data from an HTML page.
#
# Returns a list of symbol structs.
#
sub extract_stock_data {

	my &#40;$info, $content&#41; = @_;

	# The stocks are in &lt;table class=&#34;data&#34;&gt;
	# NOTE: TSX returns extra symbols who&#39;s names are similar to the symbols that
	#       are going to be fetched. This method will exclude such symbols.
	my $parser = HTML::TableExtract-&gt;new&#40;attribs =&gt; { class =&gt; &#39;data&#39; } &#41;;
	$parser-&gt;parse&#40;$content&#41;;
	
	my &#40;$table&#41; = $parser-&gt;tables;
	return unless defined $table;
	
	my $is_header = 1;
	foreach my $row &#40;$table-&gt;rows&#41; {
		
		# Skip the header
		if &#40;$is_header&#41; {
			$is_header = 0;
			next;
		}

		my $i = 0;
		# The symbol is in the format &#39;BCE-T&#39; &#40;T is the exchange&#41;
		my $symbol = $row-&gt;[$i++];
		if &#40;$symbol =~ s/-&#40;.&#41;$//&#41; {
			$info-&gt;{$symbol, &#39;exchange&#39;} = $1;
		}


		# Parse the other fields
		$info-&gt;{$symbol, &#39;name&#39;} = $row-&gt;[$i++];
		$info-&gt;{$symbol, &#39;last&#39;} = $row-&gt;[$i++];
		# The change is in the format &#39;-0.40 &#40;-0.5%&#41;&#39; &#40;positive numbers have no sign&#41;
		if &#40;$row-&gt;[$i++] =~ /&#40;-?\d+\.\d+&#41; \s+ \&#40;&#40;-?\d+\.\d+&#41;%\&#41;/x&#41; {
			$info-&gt;{$symbol, &#39;net&#39;} = $1;
			$info-&gt;{$symbol, &#39;p_change&#39;} = $2;
		}
		$info-&gt;{$symbol, &#39;volume&#39;} = $row-&gt;[$i++];


		# Cleanup
		$info-&gt;{$symbol, &#39;volume&#39;} =~ s/,//g;
		
		$info-&gt;{$symbol, &#39;method&#39;} = &#39;tsx&#39;;
		$info-&gt;{$symbol, &#39;success&#39;} = 1;
	}
}


1;

=head1 NAME

Finance::Quote::TSX	- Obtain quotes from the Toronto Stock Exchange.

=head1 SYNOPSIS

    use Finance::Quote;

    $q = Finance::Quote-&gt;new;

    %stockinfo = $q-&gt;fetch&#40;&#34;tsx&#34;,&#34;NT-T&#34;&#41;;	  # Only query TSX.
    %stockinfo = $q-&gt;fetch&#40;&#34;canada&#34;,&#34;NT&#34;&#41;;  # Failover to other sources OK.

=head1 DESCRIPTION

This module obtains information from the Toronto Stock Exchange
through the page <span class="clickylink"><a target="new" rel="nofollow" href="http://www.TMXmoney.com/">http://www.TMXmoney.com/</a></span>.

This module is not loaded by default on a Finance::Quote object.
It&#39;s possible to load it explicity by placing &#34;TSX&#34; in the argument
list to Finance::Quote-&gt;new&#40;&#41;.

This module provides both the &#34;tsx&#34; and &#34;toronto&#34; fetch methods.
Please use the &#34;canada&#34; fetch method if you wish to have failover with other
sources for Canadian stocks.  Using the &#34;tsx&#34; method will guarantee that your
information only comes from the Toronto Stock Exchange.

=head1 LABELS RETURNED

The following labels are returned by Finance::Quote::TSX:
name, last, net, p_change, volume and exchange.

This module returns less information &#40;labels&#41; than other sources but it&#39;s able
to retrieve them faster because each HTTP request performed can return up to 10
stocks. Thus, if the labels provided by this module are sufficient for your
application then you should give it a try.

=head1 SEE ALSO

Toronto Stock Exchange, <span class="clickylink"><a target="new" rel="nofollow" href="http://www.TMXmoney.com/">http://www.TMXmoney.com/</a></span>

=cut
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/513207/255597/tsx.t">Download tsx.t</a><br />
<span class="downloadcontenttype">text/x-perl 926b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
use strict;
use Test;
use Data::Dumper;
BEGIN {plan tests =&gt; 26};

use Finance::Quote;

# Test TSX functions.

my $q      = Finance::Quote-&gt;new&#40;&#41;;
my @stocks = &#40;&#34;NT&#34;, &#34;BCE&#34;, &#34;AER&#34;&#41;;

my %regexps = &#40;
	NT  =&gt; qr/\bNortel\b/,
	BCE =&gt; qr/\b&#40;BCE|Bell&#41;\b/,
	AER =&gt; qr/\bAeroplan\b/,
&#41;;


my %quotes = $q-&gt;fetch&#40;&#34;tsx&#34;, @stocks&#41;;
ok&#40;%quotes&#41;;

foreach my $stock &#40;@stocks&#41; {

	my $name = $quotes{$stock, &#34;name&#34;};
	print &#34;#Testing $stock: $name\n&#34;;

	my $regexp = $regexps{$stock};
	ok&#40;$name =~ /$regexp/i&#41;;

	ok&#40;$quotes{$stock, &#34;exchange&#34;} eq &#39;T&#39;&#41;;
	ok&#40;$quotes{$stock, &#34;method&#34;} eq &#39;tsx&#39;&#41;;

	ok&#40;$quotes{$stock, &#34;last&#34;} &gt; 0&#41;;
	ok&#40;$quotes{$stock, &#34;net&#34;} =~ /^-?\d+\.\d+$/&#41;;
	ok&#40;$quotes{$stock, &#34;p_change&#34;} =~ /^-?\d+\.\d+$/&#41;;
	ok&#40;$quotes{$stock, &#34;success&#34;}&#41;;
	ok&#40;$quotes{$stock, &#34;volume&#34;} &gt;= 0&#41;;
}


# Check that a bogus stock returns no-success.
%quotes = $q-&gt;fetch&#40;&#34;tsx&#34;, &#34;BOGUS&#34;&#41;;
ok&#40;! $quotes{&#34;BOGUS&#34;,&#34;success&#34;}&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-513294" href="/Public/Bug/Display.html?id=34326#txn-513294">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;16:13:42&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/513294/255661/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/255661">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 326b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 27 12:31:35 2008, POTYL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I updated the module in order get the new site. I have also create unit
&gt; tests.
</div>
That was fast ;&#41;
Branch tsx was created, test passed OK, so branch is merged into master
for next release.
The tsx.t was modified to use ONLINE_TEST and Test::More.

Thank you for your work !
-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-513297" href="/Public/Bug/Display.html?id=34326#txn-513297">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;16:13:44&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-513299" href="/Public/Bug/Display.html?id=34326#txn-513299">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;16:13:46&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Given to ecocode</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.56159</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
