<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58341 for Test-Simple: Support an is&#40;&#41;-alike test for referential identity of objects</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58341 for Test-Simple: Support an is&#40;&#41;-alike test for referential identity of objects</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Simple">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Simple">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Simple">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Simple">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/Test-More/test-more/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Simple">Test-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58341</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Simple">Test-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
leonerd-cpan [...] leonerd.org.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-31590-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31591-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/792861/410983/signature.asc">
Fri Jun 18 06:22:49 2010 (190b) by leonerd [...] leonerd.org.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=58341">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-789782" href="/Public/Bug/Display.html?id=58341#txn-789782">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;11&nbsp;14:20:35&nbsp;2010</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Support an is&#40;&#41;-alike test for referential identity of objects</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/789782/409219/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/409219">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 621b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi there,

Up until Test::More 0.94 I could use &#40;though, possibly incorrectly ;&#41; &#41;

  is&#40; $e-&gt;string, $str, &#39;$e-&gt;string&#39; &#41;;

to check the referential identity of the object returned by that method.

You reported me a bug that this no longer works on 0.95_01. I&#39;m
currently fixing up my tests.

So far, the best thing I&#39;ve found for referential identity is

  use Scalar::Util qw&#40; refaddr &#41;;
  is&#40; refaddr $e-&gt;string, refaddr $str, &#39;$e-&gt;string&#39; &#41;;

but this doesn&#39;t look very neat.

Perhaps this little piece of magic could be wrapped in e.g.

  is_sameref&#40; $e-&gt;string, $str, &#39;$e-&gt;string&#39; &#41;;

or somesuch?

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-789973" href="/Public/Bug/Display.html?id=58341#txn-789973">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;11&nbsp;19:09:55&nbsp;2010</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58341] Support an is&#40;&#41;-alike test for referential identity of objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 11 Jun 2010 16:09:42 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/789973/409343/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/409343">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2010.6.11 11:20 AM, Paul Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Up until Test::More 0.94 I could use &#40;though, possibly incorrectly ;&#41; &#41;
&gt; 
&gt;   is&#40; $e-&gt;string, $str, &#39;$e-&gt;string&#39; &#41;;
&gt; 
&gt; to check the referential identity of the object returned by that method.
&gt;
&gt; You reported me a bug that this no longer works on 0.95_01. I&#39;m
&gt; currently fixing up my tests.
</div>
If that doesn&#39;t work with 0.95_01 I&#39;m not sure how it ever worked.  It implies
an object that has eq overloaded but not stringification?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So far, the best thing I&#39;ve found for referential identity is
&gt; 
&gt;   use Scalar::Util qw&#40; refaddr &#41;;
&gt;   is&#40; refaddr $e-&gt;string, refaddr $str, &#39;$e-&gt;string&#39; &#41;;
&gt; 
&gt; but this doesn&#39;t look very neat.
&gt; 
&gt; Perhaps this little piece of magic could be wrapped in e.g.
&gt; 
&gt;   is_sameref&#40; $e-&gt;string, $str, &#39;$e-&gt;string&#39; &#41;;
&gt; 
&gt; or somesuch?
</div>
I really doubt it will go into Test::More.  Its fairly trivial and something
that doesn&#39;t come up all that often.  I like to keep Test::More&#39;s interface slim.

Fortunately, you can wrap it up like so:

    use Scalar::Util qw&#40;refaddr&#41;;
    sub is_same {
        my&#40;$have, $want, name&#41; = @_;

        local $Test::Builder::Level = $Test::Builder::Level + 1;
        return is&#40; refaddr $have, refaddr $want &#41;;
    }

Or you can make use of the handy UNIVERSAL::Object::ID module to give your
objects universal unique identifiers.  Then you can write.

    use UNIVERSAL::Object::ID;

    is&#40; $e-&gt;string-&gt;object_id, $str-&gt;object_id &#41;;


-- 
164. There is no such thing as a were-virgin.
    -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
           <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-789976" href="/Public/Bug/Display.html?id=58341#txn-789976">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;11&nbsp;19:09:56&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-792861" href="/Public/Bug/Display.html?id=58341#txn-792861">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;06:22:48&nbsp;2010</span>
    <span class="description">leonerd [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> leonerd-cpan [...] leonerd.org.uk</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58341] Support an is&#40;&#41;-alike test for referential identity of objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Jun 2010 11:22:38 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michael G Schwern via RT &lt;bug-Test-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul LeoNerd Evans &lt;leonerd [...] leonerd.org.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/792861/410982/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/410982">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jun 11, 2010 at 07:09:56PM -0400, Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If that doesn&#39;t work with 0.95_01 I&#39;m not sure how it ever worked.  It implies
&gt; an object that has eq overloaded but not stringification?
</div>
It has stringification, but no eq.

The original report is here

  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57762">https://rt.cpan.org/Ticket/Display.html?id=57762</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I really doubt it will go into Test::More.  Its fairly trivial and something
&gt; that doesn&#39;t come up all that often.  I like to keep Test::More&#39;s interface slim.
</div>
Really? Given we have is&#40;&#41;, isnt&#40;&#41;, like&#40;&#41;, unlike&#40;&#41;, is_deeply&#40;&#41;, ....
adding one more for referential identity isn&#39;t much more.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fortunately, you can wrap it up like so:
&gt; 
&gt;     use Scalar::Util qw&#40;refaddr&#41;;
&gt;     sub is_same {
&gt;         my&#40;$have, $want, name&#41; = @_;
&gt; 
&gt;         local $Test::Builder::Level = $Test::Builder::Level + 1;
&gt;         return is&#40; refaddr $have, refaddr $want &#41;;
&gt;     }
</div>
I&#39;ve found the following behaves sanely:

  use Scalar::Util qw&#40; refaddr &#41;;
  sub identical
  {
     my &#40; $got, $expected, $name &#41; = @_;

     ok&#40; refaddr $got == refaddr $expected, $name &#41; or
        diag&#40; &#34;Expected $got and $expected to refer to the same object&#34; &#41;;
  }

It adds the diagnostic when it fails also, which might be helpful.

I&#39;d be quite happy to write it up properly with tests and docs as a
patch, if you think it might be acceptable..

-- 
Paul &#34;LeoNerd&#34; Evans

leonerd@leonerd.org.uk
ICQ# 4135350       |  Registered Linux# 179460
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.leonerd.org.uk/">http://www.leonerd.org.uk/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/792861/410983/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 190b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-793066" href="/Public/Bug/Display.html?id=58341#txn-793066">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;16:11:52&nbsp;2010</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58341] Support an is&#40;&#41;-alike test for referential identity of objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Jun 2010 13:11:41 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/793066/411113/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/411113">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2010.6.18 3:22 AM, Paul LeoNerd Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri, Jun 11, 2010 at 07:09:56PM -0400, Michael G Schwern via RT wrote:
<div class="message-stanza open">&gt;&gt; If that doesn&#39;t work with 0.95_01 I&#39;m not sure how it ever worked.  It implies
&gt;&gt; an object that has eq overloaded but not stringification?
</div>&gt; 
&gt; It has stringification, but no eq.
&gt; 
&gt; The original report is here
&gt; 
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57762">https://rt.cpan.org/Ticket/Display.html?id=57762</a></span>
</div>
In that case, I don&#39;t understand how this ever tested object equality:

    is&#40; $e-&gt;string, $str, &#39;$e-&gt;string&#39; &#41;;

&lt;= 0.94 that was equivalent to:

    my $have = $e-&gt;string;
    is&#40; &#34;$have&#34;, &#34;$str&#34;, &#39;$e-&gt;string&#39; &#41;;

If $str or $e-&gt;string is string overloaded, that&#39;s testing the string
overloading, not object equality.  So I&#39;m a bit lost.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I really doubt it will go into Test::More.  Its fairly trivial and something
&gt;&gt; that doesn&#39;t come up all that often.  I like to keep Test::More&#39;s interface slim.
</div>&gt; 
&gt; Really? Given we have is&#40;&#41;, isnt&#40;&#41;, like&#40;&#41;, unlike&#40;&#41;, is_deeply&#40;&#41;, ....
&gt; adding one more for referential identity isn&#39;t much more.
</div>
Its always just one more.

I prefer to keep Test::More down to relatively straightforward &#40;you&#39;d be
surprised to find how not straightforward is&#40;&#41; and like&#40;&#41; can get at times&#41;
and broadly useful functions to keep the API slim and the implementation
solid.  String equality, string matching and complex structure equality all
match that.

The other criterion is that the function produce useful diagnostics that would
otherwise be annoying to get.  For example, isnt&#40;&#41; exists because ok&#40; $have ne
$want &#41; doesn&#39;t tell you what $have was when it failed and there&#39;s no easy way
to negate is&#40;&#41;.  &#40;Also it was amusing&#41;

Finally, it has to have interesting corner cases that make it less than
trivial to write.  is&#40;&#41; handles things like undef and object overloading.

An object equality function doesn&#39;t appear to have any of these traits.
That&#39;s my superficial reading of it.  I encourage you to argue otherwise.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Fortunately, you can wrap it up like so:
&gt;&gt;
&gt;&gt;     use Scalar::Util qw&#40;refaddr&#41;;
&gt;&gt;     sub is_same {
&gt;&gt;         my&#40;$have, $want, name&#41; = @_;
&gt;&gt;
&gt;&gt;         local $Test::Builder::Level = $Test::Builder::Level + 1;
&gt;&gt;         return is&#40; refaddr $have, refaddr $want &#41;;
&gt;&gt;     }
</div>&gt; 
&gt; I&#39;ve found the following behaves sanely:
&gt; 
&gt;   use Scalar::Util qw&#40; refaddr &#41;;
&gt;   sub identical
&gt;   {
&gt;      my &#40; $got, $expected, $name &#41; = @_;
&gt; 
&gt;      ok&#40; refaddr $got == refaddr $expected, $name &#41; or
&gt;         diag&#40; &#34;Expected $got and $expected to refer to the same object&#34; &#41;;
&gt;   }
&gt; 
&gt; It adds the diagnostic when it fails also, which might be helpful.
</div>
You want to increment $Test::Builder::Level so the ok&#40;&#41; failure is reported at
the point where identical&#40;&#41; is called instead of ok&#40;&#41;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d be quite happy to write it up properly with tests and docs as a
&gt; patch, if you think it might be acceptable..
</div>
At this point, no, but you can write it up as a module.  There is, imho, an
opportunity to write a test module which covers detailed class and object
tests better than isa_ok, can_ok and new_ok [1] serve.


-- 
I&#39;m pale as Formica, social skills stunted small. But I&#39;m accurate
like a pica, I know the capital of Nepal. I&#39;m the nemesis of error,
dreadful diction fears my skills, more inquisitive than Jim Lehrer,
snottier than Beverly Hills.
    -- I.L.O.P. Secret Rap  <span class="clickylink"><a target="new" rel="nofollow" href="http://goats.com/archive/020830.html">http://goats.com/archive/020830.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-823547" href="/Public/Bug/Display.html?id=58341#txn-823547">#</a>      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;28&nbsp;00:27:56&nbsp;2010</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/823547/426676/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/426676">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 98b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing this out as its unlikely to happen in Test::More and I&#39;m
cleaning up the RT queue.  Sorry.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-823550" href="/Public/Bug/Display.html?id=58341#txn-823550">#</a>      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;28&nbsp;00:27:57&nbsp;2010</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.411348</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
