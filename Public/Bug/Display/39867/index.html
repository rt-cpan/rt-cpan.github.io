<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #39867 for Catalyst-View-XSLT: patch to add a render&#40;&#41; method</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #39867 for Catalyst-View-XSLT: patch to add a render&#40;&#41; method</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-View-XSLT/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-View-XSLT/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-View-XSLT/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-View-XSLT/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-View-XSLT">Catalyst-View-XSLT CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">39867</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-View-XSLT/Active/">Catalyst-View-XSLT</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">janus [...] errornet.de
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
janus [...] errornet.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-38276-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38277-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;14:15:03&nbsp;2008</span>
    <span class="description">janus [...] errornet.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch to add a render&#40;&#41; method</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
as i wanted to use the module also to render various XSL templates for
other uses than putting them out directly to the user i&#39;ve implemented a
render&#40;&#41; method.
It works like what Catalyst::View::TT does.
Besides the code itself i also added the corresponding tests to check
for the new functionality.  The other tests pass to of course.

Would be nice to see something like that merged upstream.

Kind regards,
Simon
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Catalyst-View-XSLT_render-support.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: t/lib/TestApp/root/testRender.xsl
===================================================================
--- t/lib/TestApp/root/testRender.xsl	&#40;revision 0&#41;
+++ t/lib/TestApp/root/testRender.xsl	&#40;revision 0&#41;
@@ -0,0 +1,11 @@
+&lt;xsl:stylesheet 
+	xmlns:xsl=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</a></span>&#34; 
+	version=&#34;1.0&#34;&gt;
+
+	&lt;xsl:output method=&#34;text&#34; /&gt;
+
+	&lt;xsl:template match=&#34;/&#34;&gt;
+			&lt;xsl:value-of select=&#34;dummy-root&#34; /&gt;
+	&lt;/xsl:template&gt;
+
+&lt;/xsl:stylesheet&gt;
Index: t/lib/TestApp.pm
===================================================================
--- t/lib/TestApp.pm	&#40;revision 8506&#41;
+++ t/lib/TestApp.pm	&#40;working copy&#41;
@@ -71,6 +71,16 @@ sub testNoXSLT : Local {
     $c-&gt;stash-&gt;{message} = $message;
 }
 
+sub testRender : Local {
+    my &#40;$self, $c&#41; = @_;
+
+    my $message = $c-&gt;request-&gt;param&#40;&#39;message&#39;&#41; || $c-&gt;config-&gt;{default_message};
+
+    my $out = $c-&gt;view&#40;&#39;XSLT&#39;&#41;-&gt;render&#40;$c, $c-&gt;req-&gt;param&#40;&#39;template&#39;&#41;, {xml =&gt; &#34;&lt;dummy-root&gt;$message&lt;/dummy-root&gt;&#34;}&#41;;
+
+    $c-&gt;stash-&gt;{xml} = &#34;&lt;dummy-root&gt;$out&lt;/dummy-root&gt;&#34;;
+}
+
 sub end : Private {
     my &#40;$self, $c&#41; = @_;
 
Index: t/08testRender.t
===================================================================
--- t/08testRender.t	&#40;revision 0&#41;
+++ t/08testRender.t	&#40;revision 0&#41;
@@ -0,0 +1,21 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 5;
+
+use FindBin;
+use lib &#34;$FindBin::Bin/../lib&#34;;
+use lib &#34;$FindBin::Bin/lib&#34;;
+
+use_ok&#40;&#39;Catalyst::Test&#39;, &#39;TestApp&#39;&#41;;
+
+my $view = &#39;XML::LibXSLT&#39;;
+
+my $response;
+ok&#40;&#40;$response = request&#40;&#34;/testRender?view=$view&#38;template=testRender.xsl&#34;&#41;&#41;-&gt;is_success, &#39;request ok&#39;&#41;;
+is&#40;$response-&gt;content, TestApp-&gt;config-&gt;{default_message}, &#39;message ok&#39;&#41;;
+
+my $message = scalar localtime;
+my $xml = &#34;&lt;dummy-root&gt;$message&lt;/dummy-root&gt;&#34;;
+ok&#40;&#40;$response = request&#40;&#34;/testRender?view=$view&#38;message=$message&#38;template=testRender.xsl&#34;&#41;&#41;-&gt;is_success, &#39;request with message ok&#39;&#41;;
+is&#40;$response-&gt;content, $message, &#39;message ok&#39;&#41;;
+
Index: lib/Catalyst/View/XSLT.pm
===================================================================
--- lib/Catalyst/View/XSLT.pm	&#40;revision 8506&#41;
+++ lib/Catalyst/View/XSLT.pm	&#40;working copy&#41;
@@ -208,11 +208,113 @@ sub new {
 }
 # 
 
+=item render
 
+Renders the template specified via C&lt;&lt; $template &gt;&gt;.
+The template variables are set to C&lt;%$args&gt; if $args is a hashref, or 
+C&lt;&lt; $c-&gt;stash &gt;&gt; otherwise.
+
+=cut
+
+sub render {
+    my &#40; $self, $c, $template, $args &#41; = @_;
+
+    my $output;
+
+    unless &#40; -e $template&#41; {
+        my &#40;$tmplFullPath, $error&#41; = $self-&gt;_searchInIncPath&#40;$c, $template&#41;;
+		
+        if &#40;defined $error&#41; {
+            $c-&gt;error&#40;&#34;Template [$template] does not exists in include path&#34;&#41;;
+            return 0;
+        } else {
+            $template = $tmplFullPath;
+        }
+    }
+
+    my $vars = { 
+        &#40;ref $args eq &#39;HASH&#39; ? %$args : %{ $c-&gt;stash&#40;&#41; }&#41;,
+    };
+
+    unless &#40;exists $vars-&gt;{ xml } &#38;&#38; defined $vars-&gt;{ xml }&#41; {
+        $c-&gt;log-&gt;error&#40; &#39;No xml provided&#39; &#41;;
+        return undef;
+    }
+
+    my $xml = $vars-&gt;{xml};
+
+    # if xml is not string &#40;therefore is a file &#40;what about file descriptors ?!&#41;&#41; 
+    # and is not existsting in the file system
+    if &#40;$xml !~ m/\&lt;/ &#38;&#38; ! -e $xml&#41; {
+        my &#40;$xmlFullPath, $error&#41; = $self-&gt;_searchInIncPath&#40;$c, $xml&#41;;
+		
+        if &#40;defined $error&#41; {
+            $c-&gt;error&#40;&#34;Template [$template] does not exists in include path&#34;&#41;;
+            return undef;
+        } else {
+            $vars-&gt;{xml} = $xmlFullPath;
+        }
+    }
+
+    $c-&gt;log-&gt;debug&#40; qq{Rendering template &#34;$template&#34;} &#41; if $c-&gt;debug;
+
+    if &#40;$isMS&#41; {
+        my $error = &#39;XSLT View for MS Windows is not yet implemented.&#39;;
+        $c-&gt;log-&gt;error&#40;$error&#41;;
+        $c-&gt;error&#40;$error&#41;;
+
+        return undef;
+    }
+    # elsif &#40;$^O eq &#39;linux&#39;&#41; {
+    else {
+
+        # add runtime register_function&#40;s&#41; from stash
+        if &#40;exists $vars-&gt;{additional_register_function} &#38;&#38;
+          ref&#40;$vars-&gt;{additional_register_function}&#41; eq &#39;ARRAY&#39; &#41; {
+            my @additional_subrefs = @{ $vars-&gt;{additional_register_function} };
+            delete $vars-&gt;{additional_register_function};
+
+            unless &#40;ref&#40;$self-&gt;{CONFIG}-&gt;{LibXSLT}-&gt;{register_function}&#41; eq &#39;ARRAY&#39;&#41; {
+                $self-&gt;{CONFIG}-&gt;{LibXSLT}-&gt;{register_function} = [];
+            }
+			
+            unshift&#40;
+              @{ $self-&gt;{CONFIG}-&gt;{LibXSLT}-&gt;{register_function} }, 
+              @additional_subrefs
+            &#41;;
+        }
+
+        my $processor = undef;
+        eval {
+            $processor = $self-&gt;_getProcessor&#40;&#41;-&gt;new&#40;$c, $self-&gt;{CONFIG}-&gt;{LibXSLT}&#41;;		
+        };
+
+        if &#40;$@ &#38;&#38; &#40;! defined $processor&#41;&#41; {
+            $c-&gt;error&#40;&#34;Could not instanciate XSLT processor: $@&#34;&#41;;
+            return undef;
+        } elsif &#40;scalar @{$c-&gt;error}&#41; {
+            return undef;
+        }
+
+        $c-&gt;log-&gt;debug&#40;&#34;Processing...&#34;&#41; if $c-&gt;debug;
+        my &#40;$output, $error&#41; = $processor-&gt;process&#40;$template, $vars&#41;;
+
+        if &#40;$error&#41; {
+            chomp $error;
+            $error = qq{Couldn&#39;t render template &#34;$template&#34;. Error: &#34;$error&#34;};
+            $c-&gt;error&#40;$error&#41;;
+            return undef;
+        } 
+        else {
+            return $output;
+        }
+    }
+}
+
 =item process
 
 Renders the template specified in C&lt;&lt; $c-&gt;stash-&gt;{template} &gt;&gt; or C&lt;&lt;
-$c-&gt;action &gt;&gt;.
+$c-&gt;action &gt;&gt;.  Calls C&lt;&lt; render &gt;&gt; to perform actual rendering.
 Template params are set up from the contents of C&lt;&lt; $c-&gt;stash &gt;&gt;.
 Output is stored in C&lt;&lt; $c-&gt;response-&gt;body &gt;&gt;.
 
@@ -224,8 +326,7 @@ sub process {
     my $template = undef;
     
     if &#40;exists $c-&gt;stash-&gt;{template} &#38;&#38; defined $c-&gt;stash-&gt;{template}&#41; {
-    	$template = $c-&gt;stash-&gt;{template};
-    	delete $c-&gt;stash-&gt;{template};
+    	$template = delete $c-&gt;stash-&gt;{template};
     } else {
     	my $actionName = $c-&gt;action;
     	my $ext = $self-&gt;{CONFIG}-&gt;{&#39;TEMPLATE_EXTENSION&#39;};
@@ -240,95 +341,10 @@ sub process {
         return 0;
     }
 
-	unless &#40;exists $c-&gt;stash-&gt;{ xml } &#38;&#38; defined $c-&gt;stash-&gt;{ xml }&#41; {
-		$c-&gt;log-&gt;error&#40; &#39;No xml provided&#39; &#41;;
-		return 0;
-	}
+    my $output = $self-&gt;render&#40;$c, $template&#41;;
 
-	unless &#40; -e $template&#41; {
-		my &#40;$tmplFullPath, $error&#41; = $self-&gt;_searchInIncPath&#40;$c, $template&#41;;
-		
-		if &#40;defined $error&#41; {
-			$c-&gt;error&#40;&#34;Template [$template] does not exists in include path&#34;&#41;;
-			return 0;
-		} else {
-			$template = $tmplFullPath;
-		}
-	}
+    $c-&gt;response-&gt;body&#40;$output&#41;;
 
-
-	my $xml = $c-&gt;stash-&gt;{xml};
-
-	# if xml is not string &#40;therefore is a file &#40;what about file descriptors ?!&#41;&#41; 
-	# and is not existsting in the file system
-	if &#40;$xml !~ m/\&lt;/ &#38;&#38; ! -e $xml&#41; {
-		
-		my &#40;$xmlFullPath, $error&#41; = $self-&gt;_searchInIncPath&#40;$c, $xml&#41;;
-		
-		if &#40;defined $error&#41; {
-			$c-&gt;error&#40;&#34;Template [$template] does not exists in include path&#34;&#41;;
-			return 0;
-		} else {
-			$c-&gt;stash-&gt;{xml} = $xmlFullPath;
-		}
-	}
-
-    $c-&gt;log-&gt;debug&#40; qq{Rendering template &#34;$template&#34;} &#41; if $c-&gt;debug;
-
-	if &#40;$isMS&#41; {
-
-        my $error = &#39;XSLT View for MS Windows is not yet implemented.&#39;;
-        $c-&gt;log-&gt;error&#40;$error&#41;;
-        $c-&gt;error&#40;$error&#41;;
-   	    return 0;
-	
-	}
-	# elsif &#40;$^O eq &#39;linux&#39;&#41; {
-	else {
-
-		# add runtime register_function&#40;s&#41; from stash
-		if &#40;exists $c-&gt;stash-&gt;{additional_register_function} &#38;&#38;
-			ref&#40;$c-&gt;stash-&gt;{additional_register_function}&#41; eq &#39;ARRAY&#39; &#41; {
-			my @additional_subrefs = @{ $c-&gt;stash-&gt;{additional_register_function} };
-			delete $c-&gt;stash-&gt;{additional_register_function};
-
-			unless &#40;ref&#40;$self-&gt;{CONFIG}-&gt;{LibXSLT}-&gt;{register_function}&#41; eq &#39;ARRAY&#39;&#41; {
-				$self-&gt;{CONFIG}-&gt;{LibXSLT}-&gt;{register_function} = [];
-			}
-			
-			unshift&#40;
-				@{ $self-&gt;{CONFIG}-&gt;{LibXSLT}-&gt;{register_function} }, 
-				@additional_subrefs
-			&#41;;
-		}
-
-		my $processor = undef;
-		eval {
-			$processor = $self-&gt;_getProcessor&#40;&#41;-&gt;new&#40;$c, $self-&gt;{CONFIG}-&gt;{LibXSLT}&#41;;		
-		};
-
-		if &#40;$@ &#38;&#38; &#40;! defined $processor&#41;&#41; {
-			$c-&gt;error&#40;&#34;Could not instanciate XSLT processor: $@&#34;&#41;;
-			return 0;
-		} elsif &#40;scalar @{$c-&gt;error}&#41; {
-			return 0;
-		}
-		
-		$c-&gt;log-&gt;debug&#40;&#34;Processing...&#34;&#41; if $c-&gt;debug;
-		my &#40;$output, $error&#41; = $processor-&gt;process&#40;$c, $template&#41;;
-
-		if &#40;$error&#41; {
-			chomp $error;
-	        $error = qq{Couldn&#39;t render template &#34;$template&#34;. Error: &#34;$error&#34;};
-	        $c-&gt;error&#40;$error&#41;;
-    	    return 0;
-		} 
-		else {
-			$c-&gt;response-&gt;body&#40;$output&#41;;
-		}
-		
-	}
-	
     return 1;
 }
 
Index: lib/Catalyst/View/XSLT/XML/LibXSLT.pm
===================================================================
--- lib/Catalyst/View/XSLT/XML/LibXSLT.pm	&#40;revision 8506&#41;
+++ lib/Catalyst/View/XSLT/XML/LibXSLT.pm	&#40;working copy&#41;
@@ -76,7 +76,7 @@ sub new
 
 sub process {
 
-	my &#40;$self, $c, $template&#41; = @_;
+	my &#40;$self, $template, $args&#41; = @_;
 
 	my &#40;$result, $error&#41; = &#40;&#39;&#39;, undef&#41;;
 
@@ -87,8 +87,7 @@ sub process {
 
 		my 	&#40;$xmlDocument, $xsltStylesheet&#41;;
 	    
-	    my $xml = $c-&gt;stash-&gt;{xml};
-	    delete $c-&gt;stash-&gt;{xml};
+	    my $xml = delete $args-&gt;{xml};
 
 	    if &#40;$xml =~ /\&lt;/&#41; {
 			$xmlDocument = $xmlParser-&gt;parse_string&#40;$xml&#41;;
@@ -104,7 +103,7 @@ sub process {
 
 		my $xsltTransformer = $xsltProcessor-&gt;parse_stylesheet&#40;$xsltStylesheet&#41;;
 
-		my %params = XML::LibXSLT::xpath_to_string&#40; %{$c-&gt;stash} &#41;;
+		my %params = XML::LibXSLT::xpath_to_string&#40; %{$args} &#41;;
 
 		my $results = $xsltTransformer-&gt;transform&#40;$xmlDocument, %params&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;23&nbsp;13:44:07&nbsp;2008</span>
    <span class="description">marting [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Simon,

Feel free to patch/maintain this module.
Don&#39;t hesitate to ask me if you need any asistance!

Cheers
Martin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;23&nbsp;13:44:09&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;25&nbsp;19:23:40&nbsp;2008</span>
    <span class="description">janus [...] errornet.de -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;26&nbsp;03:22:49&nbsp;2008</span>
    <span class="description">janus [...] errornet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Implemented with version 0.05.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;26&nbsp;03:22:51&nbsp;2008</span>
    <span class="description">janus [...] errornet.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
