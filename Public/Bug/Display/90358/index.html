<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #90358 for ServiceNow-Simple: ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #90358 for ServiceNow-Simple: ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ServiceNow-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ServiceNow-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ServiceNow-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ServiceNow-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ServiceNow-Simple">ServiceNow-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">90358</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ServiceNow-Simple/Active/">ServiceNow-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
JSlay [...] tiaa-cref.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-252078-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-252079-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.07    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;08:27:25&nbsp;2013</span>
    <span class="description">JSlay [...] tiaa-cref.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 13:27:01 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-ServiceNow-Simple [...] rt.cpan.org&#34; &lt;bug-ServiceNow-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Slay, Jay&#34; &lt;JSlay [...] tiaa-cref.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am unable to connect to my instance using an http/https proxy.

Using: perl 5, version 16, subversion 2 &#40;v5.16.2&#41; built for MSWin32-x64-multi-thread

Code:
## Get Records
  ##############
my $sn = ServiceNow::Simple-&gt;new&#40;{
      instance        =&gt; &#39;&lt;my_instance&gt;&#39;.
      table           =&gt; &#39;incident&#39;,
      __print_results =&gt; 1,
      }&#41;;

my $results = $sn-&gt;get_records&#40;{ number =&gt; &#39;INC2246419&#39;}&#41;;

Returns:
500 Can&#39;t connect to &lt;my_instance&gt;.service-now.com:443 &#40;Bad hostname&#41; at C:/Perl64/site/lib/ServiceNow/Simple.pm line 207.

If I comment out the following two lines in Simple.pm:

undef&#40;$ENV{HTTP_proxy}&#41;;
undef&#40;$ENV{HTTPS_proxy}&#41;

and explicitly set these in my code to the correct address of my proxy server&#40;s&#41;, I have no issues connecting with the above code.

I have tried setting proxy in the simple.cfg file as well as in the call to new&#40;&#41;, however, it seems that is for a SOAP Endpoint proxy, not an http&#40;s&#41; proxy based on the code in Simple.pm around the following lines:
    if &#40;$self-&gt;{proxy}&#41;
    {
        $args{https} = [ $self-&gt;{proxy} ];
    }

    $self-&gt;{soap} = SOAP::Lite-&gt;proxy&#40;$url, %args&#41;


Regards,


Jay K. Slay
Sr. Engineer - Enterprise Systems Management
TIAA-CREF | Financial Services for the Greater Good

8825 Andrew Carnegie Blvd. F1-02
Charlotte, NC. 28262
C: 803.389.8860
O: 704.988.5401
F: 704.988.3917
jslay@tiaa-cref.org

*************************************************************************
This e-mail may contain confidential or privileged information.
If you are not the intended recipient, please notify the sender immediately and then delete it.

TIAA-CREF
*************************************************************************
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;18&nbsp;04:54:19&nbsp;2013</span>
    <span class="description">gregg [...] bigpond.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90358] ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Nov 2013 20:53:56 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ServiceNow-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Greg George &lt;gregg [...] bigpond.net.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jay,

Thanks for you update.  I have limited access to systems behind a proxy.

If you wouldn&#39;t mind, could you try without any proxy setting and with 
the environment variables undefined.  Our system works with this 
configuration even thought I does not make sense to me.

I see an error in the proxy setting in set_soap so have made a change 
&#40;attached&#41; I would appreciate it if you could also test that.  I will 
also test this tomorrow.

If this fails I will set up options as you describe worked for you.

Other than that do you have any other feedback, other things you would 
like the module to do or other things that could be simpler?

Regards
Greg George


On 15/11/2013 12:27 AM, Slay, Jay via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thu Nov 14 08:27:25 2013: Request 90358 was acted upon.
&gt; Transaction: Ticket created by JSlay@tiaa-cref.org
&gt;         Queue: ServiceNow-Simple
&gt;       Subject: ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: JSlay@tiaa-cref.org
&gt;        Status: new
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90358">https://rt.cpan.org/Ticket/Display.html?id=90358</a></span>&gt;
&gt;
&gt;
&gt; I am unable to connect to my instance using an http/https proxy.
&gt;
&gt; Using: perl 5, version 16, subversion 2 &#40;v5.16.2&#41; built for MSWin32-x64-multi-thread
&gt;
&gt; Code:
&gt; ## Get Records
&gt;    ##############
&gt; my $sn = ServiceNow::Simple-&gt;new&#40;{
&gt;        instance        =&gt;  &#39;&lt;my_instance&gt;&#39;.
&gt;        table           =&gt;  &#39;incident&#39;,
&gt;        __print_results =&gt;  1,
&gt;        }&#41;;
&gt;
&gt; my $results = $sn-&gt;get_records&#40;{ number =&gt;  &#39;INC2246419&#39;}&#41;;
&gt;
&gt; Returns:
&gt; 500 Can&#39;t connect to&lt;my_instance&gt;.service-now.com:443 &#40;Bad hostname&#41; at C:/Perl64/site/lib/ServiceNow/Simple.pm line 207.
&gt;
&gt; If I comment out the following two lines in Simple.pm:
&gt;
&gt; undef&#40;$ENV{HTTP_proxy}&#41;;
&gt; undef&#40;$ENV{HTTPS_proxy}&#41;
&gt;
&gt; and explicitly set these in my code to the correct address of my proxy server&#40;s&#41;, I have no issues connecting with the above code.
&gt;
&gt; I have tried setting proxy in the simple.cfg file as well as in the call to new&#40;&#41;, however, it seems that is for a SOAP Endpoint proxy, not an http&#40;s&#41; proxy based on the code in Simple.pm around the following lines:
&gt;      if &#40;$self-&gt;{proxy}&#41;
&gt;      {
&gt;          $args{https} = [ $self-&gt;{proxy} ];
&gt;      }
&gt;
&gt;      $self-&gt;{soap} = SOAP::Lite-&gt;proxy&#40;$url, %args&#41;
&gt;
&gt;
&gt; Regards,
&gt;
&gt;
&gt; Jay K. Slay
&gt; Sr. Engineer - Enterprise Systems Management
&gt; TIAA-CREF | Financial Services for the Greater Good
&gt;
&gt; 8825 Andrew Carnegie Blvd. F1-02
&gt; Charlotte, NC. 28262
&gt; C: 803.389.8860
&gt; O: 704.988.5401
&gt; F: 704.988.3917
&gt; jslay@tiaa-cref.org
&gt;
&gt; *************************************************************************
&gt; This e-mail may contain confidential or privileged information.
&gt; If you are not the intended recipient, please notify the sender immediately and then delete it.
&gt;
&gt; TIAA-CREF
&gt; *************************************************************************
&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;18&nbsp;04:54:19&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;18&nbsp;15:17:52&nbsp;2013</span>
    <span class="description">JSlay [...] tiaa-cref.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #90358] ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Nov 2013 20:17:36 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-ServiceNow-Simple [...] rt.cpan.org&#34; &lt;bug-ServiceNow-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Slay, Jay&#34; &lt;JSlay [...] tiaa-cref.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Linux &#40;RHEL 5 64 bit&#41;:
Not setting my proxy env vars results in a warning about trying to undef an uninitialized variable:
Use of uninitialized value in undef operator at /usr/lib/perl5/site_perl/5.8.8/ServiceNow/Simple.pm line 572.

You may want to use delete instead of undef if you really don’t want those environment variables in the picture.  Personally, I feel like they should remain as they are the vars used by soap::Lite for proxy communications.  You could simply set them to the value of the proxy key in your call to new &#40;or from your central config file&#41;

Without any proxy variables set anywhere, I get the following:

&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;soap:Envelope soap:encodingStyle=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34; xmlns:soap=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>&#34; xmlns:soapenc=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34; xmlns:xsd=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</a></span>&#34; xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;&gt;&lt;soap:Body&gt;&lt;getRecords xmlns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.service-now.com/">http://www.service-now.com/</a></span>&#34;&gt;&lt;number xsi:type=&#34;xsd:string&#34;&gt;INC2247736&lt;/number&gt;&lt;/getRecords&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;
SOAP::Transport::HTTP::Client::send_receive: HTTP::Response=HASH&#40;0x44288f0&#41;
SOAP::Transport::HTTP::Client::send_receive: 500 Can&#39;t locate object method &#34;new&#34; via package &#34;LWP::Protocol::https::Socket&#34;
Content-Type: text/plain
Client-Date: Mon, 18 Nov 2013 20:07:38 GMT
Client-Warning: Internal response

Can&#39;t locate object method &#34;new&#34; via package &#34;LWP::Protocol::https::Socket&#34; at /usr/lib/perl5/site_perl/5.8.8/LWP/Protocol/http.pm line 31.
SOAP::Deserializer::deserialize: &#40;&#41;
SOAP::Parser::decode: &#40;&#41;
500 Can&#39;t locate object method &#34;new&#34; via package &#34;LWP::Protocol::https::Socket&#34; at /usr/lib/perl5/site_perl/5.8.8/ServiceNow/Simple.pm line 297

This was using the version you sent me earlier.

Once again, if I do keep my ENV vars for HTTP_proxy and HTTPS_proxy by commenting lines 572 and 573, I have no issues.

Regards,

Jay K. Slay
Sr. Engineer - Enterprise Systems Management
TIAA-CREF | Financial Services for the Greater Good 

8825 Andrew Carnegie Blvd. F1-02 
Charlotte, NC. 28262 
C: 803.389.8860 
O: 704.988.5401 
F: 704.988.3917
jslay@tiaa-cref.org 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Greg George via RT [mailto:bug-ServiceNow-Simple@rt.cpan.org] 
Sent: Monday, November 18, 2013 4:54 AM
To: Slay, Jay
Subject: Re: [rt.cpan.org #90358] ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90358">https://rt.cpan.org/Ticket/Display.html?id=90358</a></span> &gt;

Hi Jay,

Thanks for you update.  I have limited access to systems behind a proxy.

If you wouldn&#39;t mind, could you try without any proxy setting and with the environment variables undefined.  Our system works with this configuration even thought I does not make sense to me.

I see an error in the proxy setting in set_soap so have made a change
&#40;attached&#41; I would appreciate it if you could also test that.  I will also test this tomorrow.

If this fails I will set up options as you describe worked for you.

Other than that do you have any other feedback, other things you would like the module to do or other things that could be simpler?

Regards
Greg George


On 15/11/2013 12:27 AM, Slay, Jay via RT wrote:
<div class="message-stanza open">&gt; Thu Nov 14 08:27:25 2013: Request 90358 was acted upon.
&gt; Transaction: Ticket created by JSlay@tiaa-cref.org
&gt;         Queue: ServiceNow-Simple
&gt;       Subject: ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: JSlay@tiaa-cref.org
&gt;        Status: new
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90358">https://rt.cpan.org/Ticket/Display.html?id=90358</a></span>&gt;
&gt;
&gt;
&gt; I am unable to connect to my instance using an http/https proxy.
&gt;
&gt; Using: perl 5, version 16, subversion 2 &#40;v5.16.2&#41; built for 
&gt; MSWin32-x64-multi-thread
&gt;
&gt; Code:
&gt; ## Get Records
&gt;    ##############
&gt; my $sn = ServiceNow::Simple-&gt;new&#40;{
&gt;        instance        =&gt;  &#39;&lt;my_instance&gt;&#39;.
&gt;        table           =&gt;  &#39;incident&#39;,
&gt;        __print_results =&gt;  1,
&gt;        }&#41;;
&gt;
&gt; my $results = $sn-&gt;get_records&#40;{ number =&gt;  &#39;INC2246419&#39;}&#41;;
&gt;
&gt; Returns:
&gt; 500 Can&#39;t connect to&lt;my_instance&gt;.service-now.com:443 &#40;Bad hostname&#41; at C:/Perl64/site/lib/ServiceNow/Simple.pm line 207.
&gt;
&gt; If I comment out the following two lines in Simple.pm:
&gt;
&gt; undef&#40;$ENV{HTTP_proxy}&#41;;
&gt; undef&#40;$ENV{HTTPS_proxy}&#41;
&gt;
&gt; and explicitly set these in my code to the correct address of my proxy server&#40;s&#41;, I have no issues connecting with the above code.
&gt;
&gt; I have tried setting proxy in the simple.cfg file as well as in the call to new&#40;&#41;, however, it seems that is for a SOAP Endpoint proxy, not an http&#40;s&#41; proxy based on the code in Simple.pm around the following lines:
&gt;      if &#40;$self-&gt;{proxy}&#41;
&gt;      {
&gt;          $args{https} = [ $self-&gt;{proxy} ];
&gt;      }
&gt;
&gt;      $self-&gt;{soap} = SOAP::Lite-&gt;proxy&#40;$url, %args&#41;
&gt;
&gt;
&gt; Regards,
&gt;
&gt;
&gt; Jay K. Slay
&gt; Sr. Engineer - Enterprise Systems Management TIAA-CREF | Financial 
&gt; Services for the Greater Good
&gt;
&gt; 8825 Andrew Carnegie Blvd. F1-02
&gt; Charlotte, NC. 28262
&gt; C: 803.389.8860
&gt; O: 704.988.5401
&gt; F: 704.988.3917
&gt; jslay@tiaa-cref.org
&gt;
&gt; **********************************************************************
&gt; *** This e-mail may contain confidential or privileged information.
&gt; If you are not the intended recipient, please notify the sender immediately and then delete it.
&gt;
&gt; TIAA-CREF
&gt; **********************************************************************
&gt; ***
&gt;
&gt;
&gt;
</div>

*************************************************************************
This e-mail may contain confidential or privileged information.
If you are not the intended recipient, please notify the sender immediately and then delete it.

TIAA-CREF
*************************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;19&nbsp;05:03:43&nbsp;2013</span>
    <span class="description">gregg [...] bigpond.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90358] ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Nov 2013 21:03:06 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ServiceNow-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Greg George &lt;gregg [...] bigpond.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jay,

Thanks for your input.
I will digest the data you sent.
 From our environment I get quite different responses, so I need to 
figure out why and how I can cater for both, preferably without the user 
needing to know.  Appreciate your assistance.

Greg

On 19/11/2013 7:17 AM, Slay, Jay via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: ServiceNow-Simple
&gt;   Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90358">https://rt.cpan.org/Ticket/Display.html?id=90358</a></span>&gt;
&gt;
&gt; Hi,
&gt;
&gt; On Linux &#40;RHEL 5 64 bit&#41;:
&gt; Not setting my proxy env vars results in a warning about trying to undef an uninitialized variable:
&gt; Use of uninitialized value in undef operator at /usr/lib/perl5/site_perl/5.8.8/ServiceNow/Simple.pm line 572.
&gt;
&gt; You may want to use delete instead of undef if you really don’t want those environment variables in the picture.  Personally, I feel like they should remain as they are the vars used by soap::Lite for proxy communications.  You could simply set them to the value of the proxy key in your call to new &#40;or from your central config file&#41;
&gt;
&gt; Without any proxy variables set anywhere, I get the following:
&gt;
&gt; &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;soap:Envelope soap:encodingStyle=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34; xmlns:soap=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>&#34; xmlns:soapenc=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/encoding/">http://schemas.xmlsoap.org/soap/encoding/</a></span>&#34; xmlns:xsd=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</a></span>&#34; xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;&gt;&lt;soap:Body&gt;&lt;getRecords xmlns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.service-now.com/">http://www.service-now.com/</a></span>&#34;&gt;&lt;number xsi:type=&#34;xsd:string&#34;&gt;INC2247736&lt;/number&gt;&lt;/getRecords&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;
&gt; SOAP::Transport::HTTP::Client::send_receive: HTTP::Response=HASH&#40;0x44288f0&#41;
&gt; SOAP::Transport::HTTP::Client::send_receive: 500 Can&#39;t locate object method &#34;new&#34; via package &#34;LWP::Protocol::https::Socket&#34;
&gt; Content-Type: text/plain
&gt; Client-Date: Mon, 18 Nov 2013 20:07:38 GMT
&gt; Client-Warning: Internal response
&gt;
&gt; Can&#39;t locate object method &#34;new&#34; via package &#34;LWP::Protocol::https::Socket&#34; at /usr/lib/perl5/site_perl/5.8.8/LWP/Protocol/http.pm line 31.
&gt; SOAP::Deserializer::deserialize: &#40;&#41;
&gt; SOAP::Parser::decode: &#40;&#41;
&gt; 500 Can&#39;t locate object method &#34;new&#34; via package &#34;LWP::Protocol::https::Socket&#34; at /usr/lib/perl5/site_perl/5.8.8/ServiceNow/Simple.pm line 297
&gt;
&gt; This was using the version you sent me earlier.
&gt;
&gt; Once again, if I do keep my ENV vars for HTTP_proxy and HTTPS_proxy by commenting lines 572 and 573, I have no issues.
&gt;
&gt; Regards,
&gt;
&gt; Jay K. Slay
&gt; Sr. Engineer - Enterprise Systems Management
&gt; TIAA-CREF | Financial Services for the Greater Good
&gt;
&gt; 8825 Andrew Carnegie Blvd. F1-02
&gt; Charlotte, NC. 28262
&gt; C: 803.389.8860
&gt; O: 704.988.5401
&gt; F: 704.988.3917
&gt; jslay@tiaa-cref.org
&gt;
&gt; -----Original Message-----
&gt; From: Greg George via RT [mailto:bug-ServiceNow-Simple@rt.cpan.org]
&gt; Sent: Monday, November 18, 2013 4:54 AM
&gt; To: Slay, Jay
&gt; Subject: Re: [rt.cpan.org #90358] ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;
&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90358">https://rt.cpan.org/Ticket/Display.html?id=90358</a></span>&gt;
&gt;
&gt; Hi Jay,
&gt;
&gt; Thanks for you update.  I have limited access to systems behind a proxy.
&gt;
&gt; If you wouldn&#39;t mind, could you try without any proxy setting and with the environment variables undefined.  Our system works with this configuration even thought I does not make sense to me.
&gt;
&gt; I see an error in the proxy setting in set_soap so have made a change
&gt; &#40;attached&#41; I would appreciate it if you could also test that.  I will also test this tomorrow.
&gt;
&gt; If this fails I will set up options as you describe worked for you.
&gt;
&gt; Other than that do you have any other feedback, other things you would like the module to do or other things that could be simpler?
&gt;
&gt; Regards
&gt; Greg George
&gt;
&gt;
&gt; On 15/11/2013 12:27 AM, Slay, Jay via RT wrote:
<div class="message-stanza open">&gt;&gt; Thu Nov 14 08:27:25 2013: Request 90358 was acted upon.
&gt;&gt; Transaction: Ticket created by JSlay@tiaa-cref.org
&gt;&gt;          Queue: ServiceNow-Simple
&gt;&gt;        Subject: ServiceNow::Simple / Unable to connect via HTTPS Proxy Server&#40;s&#41;
&gt;&gt;      Broken in: &#40;no value&#41;
&gt;&gt;       Severity: &#40;no value&#41;
&gt;&gt;          Owner: Nobody
&gt;&gt;     Requestors: JSlay@tiaa-cref.org
&gt;&gt;         Status: new
&gt;&gt;    Ticket&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90358">https://rt.cpan.org/Ticket/Display.html?id=90358</a></span>&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I am unable to connect to my instance using an http/https proxy.
&gt;&gt;
&gt;&gt; Using: perl 5, version 16, subversion 2 &#40;v5.16.2&#41; built for
&gt;&gt; MSWin32-x64-multi-thread
&gt;&gt;
&gt;&gt; Code:
&gt;&gt; ## Get Records
&gt;&gt;     ##############
&gt;&gt; my $sn = ServiceNow::Simple-&gt;new&#40;{
&gt;&gt;         instance        =&gt;   &#39;&lt;my_instance&gt;&#39;.
&gt;&gt;         table           =&gt;   &#39;incident&#39;,
&gt;&gt;         __print_results =&gt;   1,
&gt;&gt;         }&#41;;
&gt;&gt;
&gt;&gt; my $results = $sn-&gt;get_records&#40;{ number =&gt;   &#39;INC2246419&#39;}&#41;;
&gt;&gt;
&gt;&gt; Returns:
&gt;&gt; 500 Can&#39;t connect to&lt;my_instance&gt;.service-now.com:443 &#40;Bad hostname&#41; at C:/Perl64/site/lib/ServiceNow/Simple.pm line 207.
&gt;&gt;
&gt;&gt; If I comment out the following two lines in Simple.pm:
&gt;&gt;
&gt;&gt; undef&#40;$ENV{HTTP_proxy}&#41;;
&gt;&gt; undef&#40;$ENV{HTTPS_proxy}&#41;
&gt;&gt;
&gt;&gt; and explicitly set these in my code to the correct address of my proxy server&#40;s&#41;, I have no issues connecting with the above code.
&gt;&gt;
&gt;&gt; I have tried setting proxy in the simple.cfg file as well as in the call to new&#40;&#41;, however, it seems that is for a SOAP Endpoint proxy, not an http&#40;s&#41; proxy based on the code in Simple.pm around the following lines:
&gt;&gt;       if &#40;$self-&gt;{proxy}&#41;
&gt;&gt;       {
&gt;&gt;           $args{https} = [ $self-&gt;{proxy} ];
&gt;&gt;       }
&gt;&gt;
&gt;&gt;       $self-&gt;{soap} = SOAP::Lite-&gt;proxy&#40;$url, %args&#41;
&gt;&gt;
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt;
&gt;&gt;
&gt;&gt; Jay K. Slay
&gt;&gt; Sr. Engineer - Enterprise Systems Management TIAA-CREF | Financial
&gt;&gt; Services for the Greater Good
&gt;&gt;
&gt;&gt; 8825 Andrew Carnegie Blvd. F1-02
&gt;&gt; Charlotte, NC. 28262
&gt;&gt; C: 803.389.8860
&gt;&gt; O: 704.988.5401
&gt;&gt; F: 704.988.3917
&gt;&gt; jslay@tiaa-cref.org
&gt;&gt;
&gt;&gt; **********************************************************************
&gt;&gt; *** This e-mail may contain confidential or privileged information.
&gt;&gt; If you are not the intended recipient, please notify the sender immediately and then delete it.
&gt;&gt;
&gt;&gt; TIAA-CREF
&gt;&gt; **********************************************************************
&gt;&gt; ***
&gt;&gt;
&gt;&gt;
&gt;&gt;
</div>&gt;
&gt;
&gt; *************************************************************************
&gt; This e-mail may contain confidential or privileged information.
&gt; If you are not the intended recipient, please notify the sender immediately and then delete it.
&gt;
&gt; TIAA-CREF
&gt; *************************************************************************
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;21&nbsp;15:30:18&nbsp;2013</span>
    <span class="description">gng [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;21&nbsp;15:30:18&nbsp;2013</span>
    <span class="description">gng [...] cpan.org -  Fixed in 0.07 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
