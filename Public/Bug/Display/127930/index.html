<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127930 for Amazon-Credentials: t/02-credentials.t fails on some systems</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127930 for Amazon-Credentials: t/02-credentials.t fails on some systems</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Amazon-Credentials/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Amazon-Credentials/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Amazon-Credentials/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Amazon-Credentials/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Amazon-Credentials">Amazon-Credentials CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127930</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Amazon-Credentials/Active/">Amazon-Credentials</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-272080-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.0.7    </td>
  </tr>
  <tr id="CF-272081-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;05&nbsp;16:20:02&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/02-credentials.t fails on some systems</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On my freebsd10 and freebsd11 smokers t/02-credentials.t fails:

...
#   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
#   at t/02-credentials.t line 72.

#   Failed test &#39;refresh_token&#40;&#41;&#39;
#   at t/02-credentials.t line 94.
# Looks like you failed 2 tests of 6.
t/02-credentials.t .. 
Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
Failed 2/6 subtests 
...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;05&nbsp;16:29:34&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmm..yes I saw that..puzzling as the test works on other versions and distros from what I can see in the test reports.  The test attempts to determine if a token has timed out by looking at the token expiration time compared to the current time.  I&#39;ll take a closer look at how my comparisons are being done and why it appears that it is busted only on versions &gt; 5.20.0 and only on freebsd.

Puzzling indeed.


On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t fails:
&gt; 
&gt; ...
&gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; #   at t/02-credentials.t line 72.
&gt; 
&gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; #   at t/02-credentials.t line 94.
&gt; # Looks like you failed 2 tests of 6.
&gt; t/02-credentials.t .. 
&gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; Failed 2/6 subtests 
&gt; ...
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;05&nbsp;16:29:35&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;05&nbsp;17:25:15&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Maybe it&#39;s timezone related? I just tried setting TZ=UTC &#40;originally the freebsd10 system has Europe/Berlin configured&#41;, and now the tests pass...

On 2018-12-05 16:29:34, BIGFOOT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm..yes I saw that..puzzling as the test works on other versions and
&gt; distros from what I can see in the test reports.  The test attempts to
&gt; determine if a token has timed out by looking at the token expiration
&gt; time compared to the current time.  I&#39;ll take a closer look at how my
&gt; comparisons are being done and why it appears that it is busted only
&gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; 
&gt; Puzzling indeed.
&gt; 
&gt; 
&gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t fails:
&gt; &gt;
&gt; &gt; ...
&gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt;
&gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt;  t/02-credentials.t ..
&gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt;  Failed 2/6 subtests
&gt; &gt; ...
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;05&nbsp;22:05:57&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, that&#39;s the working theory - I&#39;ve uploaded a new version 1.0.8 which I believe addresses the root cause - incorrect parsing of the ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this one fares.

On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC &#40;originally
&gt; the freebsd10 system has Europe/Berlin configured&#41;, and now the tests
&gt; pass...
&gt; 
&gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; Hmm..yes I saw that..puzzling as the test works on other versions and
&gt; &gt; distros from what I can see in the test reports.  The test attempts
&gt; &gt; to
&gt; &gt; determine if a token has timed out by looking at the token expiration
&gt; &gt; time compared to the current time.  I&#39;ll take a closer look at how my
&gt; &gt; comparisons are being done and why it appears that it is busted only
&gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt;
&gt; &gt; Puzzling indeed.
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t fails:
&gt; &gt; &gt;
&gt; &gt; &gt; ...
&gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt;
&gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; ...
</div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;01:46:24&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Now it passes on the previously failing freebsd systems &#40;10 + 11&#41;, but it fails now with freebsd 12 + 13. A sample report: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-c1ac4f889b37">http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-c1ac4f889b37</a></span>

On 2018-12-05 22:05:57, BIGFOOT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, that&#39;s the working theory - I&#39;ve uploaded a new version 1.0.8
&gt; which I believe addresses the root cause - incorrect parsing of the
&gt; ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this one fares.
&gt; 
&gt; On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC &#40;originally
&gt; &gt; the freebsd10 system has Europe/Berlin configured&#41;, and now the tests
&gt; &gt; pass...
&gt; &gt;
&gt; &gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; Hmm..yes I saw that..puzzling as the test works on other versions
&gt; &gt; &gt; and
&gt; &gt; &gt; distros from what I can see in the test reports.  The test attempts
&gt; &gt; &gt; to
&gt; &gt; &gt; determine if a token has timed out by looking at the token
&gt; &gt; &gt; expiration
&gt; &gt; &gt; time compared to the current time.  I&#39;ll take a closer look at how
&gt; &gt; &gt; my
&gt; &gt; &gt; comparisons are being done and why it appears that it is busted
&gt; &gt; &gt; only
&gt; &gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt; &gt;
&gt; &gt; &gt; Puzzling indeed.
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t fails:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;11:38:52&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now it passes on the previously failing freebsd systems &#40;10 + 11&#41;, but
&gt; it fails now with freebsd 12 + 13. A sample report:
</div>
Wow, fun stuff.  I&#39;m not sure I necessarily believe that the version of freebsd 12/13 is the issue - but I do not have access to those distros at the moment.  My inclination is that my test is bad?

Oddly though the diagnostics tell me that the expiration date and current time are exactly 5 seconds apart &#40;still exactly within the valid token time window&#41; - which means that when is_token_expired&#40;&#41; did the same conversions the time left should be 5s.  If this were a timing issue I would have expected the diagnostics to tell me the diff between expiration time and current time was &gt; 5 seconds.

# $VAR1 = [
#           &#39;2018-12-06T03:52:14Z&#39;,
#           &#39;2018-12-06T03:47:09Z&#39;
#         ];


...so almost certainly I must be seeing some drift from timegm&#40;&#41;?

Any chance you can run this little snippet in those problem envs?

#!/usr/bin/perl

use strict;
use warnings;

use Time::Local;
use POSIX::strptime qw/strptime/;
use Date::Format;

# notes:
# - expect UTC == GMT, EDT &lt;&gt; UTC
# - UTC is not really time zone, so maybe issue on some platforms, better to use GMT?
# - EDT should not be the same since my ISO8610 is Zulu time...just for sanity

foreach my $tz &#40;qw/UTC GMT EDT/&#41; {
  my $time = time;
  my $iso8610 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%SZ&#34;, $time, $tz&#41;;
  my $timegm = timegm&#40;strptime&#40;$iso8610, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;;

  printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n%s\n&#34;, $tz, $iso8610, $time, $timegm, &#39;-&#39;x60&#41;;
}

...if not I will add some additional diagnostics and a debug flag for testing

On Thu Dec 06 01:46:24 2018, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now it passes on the previously failing freebsd systems &#40;10 + 11&#41;, but
&gt; it fails now with freebsd 12 + 13. A sample report:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-">http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-</a></span>
&gt; c1ac4f889b37
&gt; 
&gt; On 2018-12-05 22:05:57, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; Yes, that&#39;s the working theory - I&#39;ve uploaded a new version 1.0.8
&gt; &gt; which I believe addresses the root cause - incorrect parsing of the
&gt; &gt; ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this one fares.
&gt; &gt;
&gt; &gt; On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC
&gt; &gt; &gt; &#40;originally
&gt; &gt; &gt; the freebsd10 system has Europe/Berlin configured&#41;, and now the
&gt; &gt; &gt; tests
&gt; &gt; &gt; pass...
&gt; &gt; &gt;
&gt; &gt; &gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Hmm..yes I saw that..puzzling as the test works on other versions
&gt; &gt; &gt; &gt; and
&gt; &gt; &gt; &gt; distros from what I can see in the test reports.  The test
&gt; &gt; &gt; &gt; attempts
&gt; &gt; &gt; &gt; to
&gt; &gt; &gt; &gt; determine if a token has timed out by looking at the token
&gt; &gt; &gt; &gt; expiration
&gt; &gt; &gt; &gt; time compared to the current time.  I&#39;ll take a closer look at
&gt; &gt; &gt; &gt; how
&gt; &gt; &gt; &gt; my
&gt; &gt; &gt; &gt; comparisons are being done and why it appears that it is busted
&gt; &gt; &gt; &gt; only
&gt; &gt; &gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Puzzling indeed.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t fails:
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;11:38:53&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Fixed in 1.0.8 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;08&nbsp;09:16:25&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">re-opening issue, still fails on subset of freebsd distros
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;08&nbsp;09:16:26&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;08&nbsp;10:32:10&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-12-06 11:38:52, BIGFOOT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 + 11&#41;,
&gt; &gt; but
&gt; &gt; it fails now with freebsd 12 + 13. A sample report:
</div>&gt; 
&gt; Wow, fun stuff.  I&#39;m not sure I necessarily believe that the version
&gt; of freebsd 12/13 is the issue - but I do not have access to those
&gt; distros at the moment.  My inclination is that my test is bad?
&gt; 
&gt; Oddly though the diagnostics tell me that the expiration date and
&gt; current time are exactly 5 seconds apart &#40;still exactly within the
&gt; valid token time window&#41; - which means that when is_token_expired&#40;&#41;
&gt; did the same conversions the time left should be 5s.  If this were a
&gt; timing issue I would have expected the diagnostics to tell me the diff
&gt; between expiration time and current time was &gt; 5 seconds.
&gt; 
&gt; # $VAR1 = [
&gt; #           &#39;2018-12-06T03:52:14Z&#39;,
&gt; #           &#39;2018-12-06T03:47:09Z&#39;
&gt; #         ];
&gt; 
&gt; 
&gt; ...so almost certainly I must be seeing some drift from timegm&#40;&#41;?
&gt; 
&gt; Any chance you can run this little snippet in those problem envs?
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; 
&gt; use Time::Local;
&gt; use POSIX::strptime qw/strptime/;
&gt; use Date::Format;
&gt; 
&gt; # notes:
&gt; # - expect UTC == GMT, EDT &lt;&gt; UTC
&gt; # - UTC is not really time zone, so maybe issue on some platforms,
&gt; better to use GMT?
&gt; # - EDT should not be the same since my ISO8610 is Zulu time...just
&gt; for sanity
&gt; 
&gt; foreach my $tz &#40;qw/UTC GMT EDT/&#41; {
&gt;   my $time = time;
&gt;   my $iso8610 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%SZ&#34;, $time, $tz&#41;;
&gt;   my $timegm = timegm&#40;strptime&#40;$iso8610, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;;
&gt; 
&gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n%s\n&#34;, $tz,
&gt; $iso8610, $time, $timegm, &#39;-&#39;x60&#41;;
&gt; }
&gt; 
&gt; ...if not I will add some additional diagnostics and a debug flag for
&gt; testing
</div>
The test script surely returns something unexpected on freebsd 12 + 13:

TZ: UTC ISO8601: 2018-12-08T15:30:26Z
time: 1544283026
timegm: 976289426
------------------------------------------------------------
TZ: GMT ISO8601: 2018-12-08T15:30:26Z
time: 1544283026
timegm: 976289426
------------------------------------------------------------
TZ: EDT ISO8601: 2018-12-08T11:30:26Z
time: 1544283026
timegm: 976275026
------------------------------------------------------------


It seems that the year field in the strptime output is broken. Here a working strptime on freebsd 11:

$ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;, strptime&#40;&#34;2018-12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
10,10,10,10,11,118,6,341, at -e line 1.

Here the bad output on freebsd 12:
$ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;, strptime&#40;&#34;2018-12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
10,10,10,10,11,,6,341, at -e line 1.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On Thu Dec 06 01:46:24 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 + 11&#41;,
&gt; &gt; but
&gt; &gt; it fails now with freebsd 12 + 13. A sample report:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-">http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-</a></span>
&gt; &gt; c1ac4f889b37
&gt; &gt;
&gt; &gt; On 2018-12-05 22:05:57, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; Yes, that&#39;s the working theory - I&#39;ve uploaded a new version 1.0.8
&gt; &gt; &gt; which I believe addresses the root cause - incorrect parsing of the
&gt; &gt; &gt; ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this one
&gt; &gt; &gt; fares.
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC
&gt; &gt; &gt; &gt; &#40;originally
&gt; &gt; &gt; &gt; the freebsd10 system has Europe/Berlin configured&#41;, and now the
&gt; &gt; &gt; &gt; tests
&gt; &gt; &gt; &gt; pass...
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Hmm..yes I saw that..puzzling as the test works on other
&gt; &gt; &gt; &gt; &gt; versions
&gt; &gt; &gt; &gt; &gt; and
&gt; &gt; &gt; &gt; &gt; distros from what I can see in the test reports.  The test
&gt; &gt; &gt; &gt; &gt; attempts
&gt; &gt; &gt; &gt; &gt; to
&gt; &gt; &gt; &gt; &gt; determine if a token has timed out by looking at the token
&gt; &gt; &gt; &gt; &gt; expiration
&gt; &gt; &gt; &gt; &gt; time compared to the current time.  I&#39;ll take a closer look at
&gt; &gt; &gt; &gt; &gt; how
&gt; &gt; &gt; &gt; &gt; my
&gt; &gt; &gt; &gt; &gt; comparisons are being done and why it appears that it is busted
&gt; &gt; &gt; &gt; &gt; only
&gt; &gt; &gt; &gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Puzzling indeed.
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t
&gt; &gt; &gt; &gt; &gt; &gt; fails:
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; &gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt; &gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; &gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt; &gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;08&nbsp;10:32:10&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;08&nbsp;10:39:14&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-12-08 10:32:10, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2018-12-06 11:38:52, BIGFOOT wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 + 11&#41;,
&gt; &gt; &gt; but
&gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
</div>&gt; &gt;
&gt; &gt; Wow, fun stuff.  I&#39;m not sure I necessarily believe that the version
&gt; &gt; of freebsd 12/13 is the issue - but I do not have access to those
&gt; &gt; distros at the moment.  My inclination is that my test is bad?
&gt; &gt;
&gt; &gt; Oddly though the diagnostics tell me that the expiration date and
&gt; &gt; current time are exactly 5 seconds apart &#40;still exactly within the
&gt; &gt; valid token time window&#41; - which means that when is_token_expired&#40;&#41;
&gt; &gt; did the same conversions the time left should be 5s.  If this were a
&gt; &gt; timing issue I would have expected the diagnostics to tell me the
&gt; &gt; diff
&gt; &gt; between expiration time and current time was &gt; 5 seconds.
&gt; &gt;
&gt; &gt; # $VAR1 = [
&gt; &gt; #           &#39;2018-12-06T03:52:14Z&#39;,
&gt; &gt; #           &#39;2018-12-06T03:47:09Z&#39;
&gt; &gt; #         ];
&gt; &gt;
&gt; &gt;
&gt; &gt; ...so almost certainly I must be seeing some drift from timegm&#40;&#41;?
&gt; &gt;
&gt; &gt; Any chance you can run this little snippet in those problem envs?
&gt; &gt;
&gt; &gt; #!/usr/bin/perl
&gt; &gt;
&gt; &gt; use strict;
&gt; &gt; use warnings;
&gt; &gt;
&gt; &gt; use Time::Local;
&gt; &gt; use POSIX::strptime qw/strptime/;
&gt; &gt; use Date::Format;
&gt; &gt;
&gt; &gt; # notes:
&gt; &gt; # - expect UTC == GMT, EDT &lt;&gt; UTC
&gt; &gt; # - UTC is not really time zone, so maybe issue on some platforms,
&gt; &gt; better to use GMT?
&gt; &gt; # - EDT should not be the same since my ISO8610 is Zulu time...just
&gt; &gt; for sanity
&gt; &gt;
&gt; &gt; foreach my $tz &#40;qw/UTC GMT EDT/&#41; {
&gt; &gt;   my $time = time;
&gt; &gt;   my $iso8610 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%SZ&#34;, $time, $tz&#41;;
&gt; &gt;   my $timegm = timegm&#40;strptime&#40;$iso8610, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;;
&gt; &gt;
&gt; &gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n%s\n&#34;, $tz,
&gt; &gt; $iso8610, $time, $timegm, &#39;-&#39;x60&#41;;
&gt; &gt; }
&gt; &gt;
&gt; &gt; ...if not I will add some additional diagnostics and a debug flag for
&gt; &gt; testing
</div>&gt; 
&gt; The test script surely returns something unexpected on freebsd 12 +
&gt; 13:
&gt; 
&gt; TZ: UTC ISO8601: 2018-12-08T15:30:26Z
&gt; time: 1544283026
&gt; timegm: 976289426
&gt; ------------------------------------------------------------
&gt; TZ: GMT ISO8601: 2018-12-08T15:30:26Z
&gt; time: 1544283026
&gt; timegm: 976289426
&gt; ------------------------------------------------------------
&gt; TZ: EDT ISO8601: 2018-12-08T11:30:26Z
&gt; time: 1544283026
&gt; timegm: 976275026
&gt; ------------------------------------------------------------
&gt; 
&gt; 
&gt; It seems that the year field in the strptime output is broken. Here a
&gt; working strptime on freebsd 11:
&gt; 
&gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;, strptime&#40;&#34;2018-
&gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; 10,10,10,10,11,118,6,341, at -e line 1.
&gt; 
&gt; Here the bad output on freebsd 12:
&gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;, strptime&#40;&#34;2018-
&gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; 10,10,10,10,11,,6,341, at -e line 1.
&gt; 
</div>
A FreeBSD bug? I tried a C program:

#include &lt;time.h&gt;
#include &lt;stdio.h&gt;

int main&#40;&#41; {
    struct tm tm;
    printf&#40;&#34;ret=%s\n&#34;, strptime&#40;&#34;2018-12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;, &#38;tm&#41;&#41;;
    printf&#40;&#34;year=%d\n&#34;, tm.tm_year&#41;;
}


Output on FreeBSD 11:

ret=&#40;null&#41;
year=118


Output on FreeBSD 12:

ret=&#40;null&#41;
year=0


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt;
&gt; &gt; On Thu Dec 06 01:46:24 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 + 11&#41;,
&gt; &gt; &gt; but
&gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-">http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-</a></span>
&gt; &gt; &gt; c1ac4f889b37
&gt; &gt; &gt;
&gt; &gt; &gt; On 2018-12-05 22:05:57, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Yes, that&#39;s the working theory - I&#39;ve uploaded a new version
&gt; &gt; &gt; &gt; 1.0.8
&gt; &gt; &gt; &gt; which I believe addresses the root cause - incorrect parsing of
&gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this one
&gt; &gt; &gt; &gt; fares.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC
&gt; &gt; &gt; &gt; &gt; &#40;originally
&gt; &gt; &gt; &gt; &gt; the freebsd10 system has Europe/Berlin configured&#41;, and now the
&gt; &gt; &gt; &gt; &gt; tests
&gt; &gt; &gt; &gt; &gt; pass...
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; Hmm..yes I saw that..puzzling as the test works on other
&gt; &gt; &gt; &gt; &gt; &gt; versions
&gt; &gt; &gt; &gt; &gt; &gt; and
&gt; &gt; &gt; &gt; &gt; &gt; distros from what I can see in the test reports.  The test
&gt; &gt; &gt; &gt; &gt; &gt; attempts
&gt; &gt; &gt; &gt; &gt; &gt; to
&gt; &gt; &gt; &gt; &gt; &gt; determine if a token has timed out by looking at the token
&gt; &gt; &gt; &gt; &gt; &gt; expiration
&gt; &gt; &gt; &gt; &gt; &gt; time compared to the current time.  I&#39;ll take a closer look
&gt; &gt; &gt; &gt; &gt; &gt; at
&gt; &gt; &gt; &gt; &gt; &gt; how
&gt; &gt; &gt; &gt; &gt; &gt; my
&gt; &gt; &gt; &gt; &gt; &gt; comparisons are being done and why it appears that it is
&gt; &gt; &gt; &gt; &gt; &gt; busted
&gt; &gt; &gt; &gt; &gt; &gt; only
&gt; &gt; &gt; &gt; &gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; Puzzling indeed.
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t
&gt; &gt; &gt; &gt; &gt; &gt; &gt; fails:
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt; &gt; &gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt; &gt; &gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;08&nbsp;11:03:07&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-12-08 10:39:14, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2018-12-08 10:32:10, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On 2018-12-06 11:38:52, BIGFOOT wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 +
&gt; &gt; &gt; &gt; 11&#41;,
&gt; &gt; &gt; &gt; but
&gt; &gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
</div>&gt; &gt; &gt;
&gt; &gt; &gt; Wow, fun stuff.  I&#39;m not sure I necessarily believe that the
&gt; &gt; &gt; version
&gt; &gt; &gt; of freebsd 12/13 is the issue - but I do not have access to those
&gt; &gt; &gt; distros at the moment.  My inclination is that my test is bad?
&gt; &gt; &gt;
&gt; &gt; &gt; Oddly though the diagnostics tell me that the expiration date and
&gt; &gt; &gt; current time are exactly 5 seconds apart &#40;still exactly within the
&gt; &gt; &gt; valid token time window&#41; - which means that when is_token_expired&#40;&#41;
&gt; &gt; &gt; did the same conversions the time left should be 5s.  If this were
&gt; &gt; &gt; a
&gt; &gt; &gt; timing issue I would have expected the diagnostics to tell me the
&gt; &gt; &gt; diff
&gt; &gt; &gt; between expiration time and current time was &gt; 5 seconds.
&gt; &gt; &gt;
&gt; &gt; &gt; # $VAR1 = [
&gt; &gt; &gt; #           &#39;2018-12-06T03:52:14Z&#39;,
&gt; &gt; &gt; #           &#39;2018-12-06T03:47:09Z&#39;
&gt; &gt; &gt; #         ];
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; ...so almost certainly I must be seeing some drift from timegm&#40;&#41;?
&gt; &gt; &gt;
&gt; &gt; &gt; Any chance you can run this little snippet in those problem envs?
&gt; &gt; &gt;
&gt; &gt; &gt; #!/usr/bin/perl
&gt; &gt; &gt;
&gt; &gt; &gt; use strict;
&gt; &gt; &gt; use warnings;
&gt; &gt; &gt;
&gt; &gt; &gt; use Time::Local;
&gt; &gt; &gt; use POSIX::strptime qw/strptime/;
&gt; &gt; &gt; use Date::Format;
&gt; &gt; &gt;
&gt; &gt; &gt; # notes:
&gt; &gt; &gt; # - expect UTC == GMT, EDT &lt;&gt; UTC
&gt; &gt; &gt; # - UTC is not really time zone, so maybe issue on some platforms,
&gt; &gt; &gt; better to use GMT?
&gt; &gt; &gt; # - EDT should not be the same since my ISO8610 is Zulu time...just
&gt; &gt; &gt; for sanity
&gt; &gt; &gt;
&gt; &gt; &gt; foreach my $tz &#40;qw/UTC GMT EDT/&#41; {
&gt; &gt; &gt;   my $time = time;
&gt; &gt; &gt;   my $iso8610 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%SZ&#34;, $time, $tz&#41;;
&gt; &gt; &gt;   my $timegm = timegm&#40;strptime&#40;$iso8610, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n%s\n&#34;, $tz,
&gt; &gt; &gt; $iso8610, $time, $timegm, &#39;-&#39;x60&#41;;
&gt; &gt; &gt; }
&gt; &gt; &gt;
&gt; &gt; &gt; ...if not I will add some additional diagnostics and a debug flag
&gt; &gt; &gt; for
&gt; &gt; &gt; testing
</div>&gt; &gt;
&gt; &gt; The test script surely returns something unexpected on freebsd 12 +
&gt; &gt; 13:
&gt; &gt;
&gt; &gt; TZ: UTC ISO8601: 2018-12-08T15:30:26Z
&gt; &gt; time: 1544283026
&gt; &gt; timegm: 976289426
&gt; &gt; ------------------------------------------------------------
&gt; &gt; TZ: GMT ISO8601: 2018-12-08T15:30:26Z
&gt; &gt; time: 1544283026
&gt; &gt; timegm: 976289426
&gt; &gt; ------------------------------------------------------------
&gt; &gt; TZ: EDT ISO8601: 2018-12-08T11:30:26Z
&gt; &gt; time: 1544283026
&gt; &gt; timegm: 976275026
&gt; &gt; ------------------------------------------------------------
&gt; &gt;
&gt; &gt;
&gt; &gt; It seems that the year field in the strptime output is broken. Here a
&gt; &gt; working strptime on freebsd 11:
&gt; &gt;
&gt; &gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;, strptime&#40;&#34;2018-
&gt; &gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; &gt; 10,10,10,10,11,118,6,341, at -e line 1.
&gt; &gt;
&gt; &gt; Here the bad output on freebsd 12:
&gt; &gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;, strptime&#40;&#34;2018-
&gt; &gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; &gt; 10,10,10,10,11,,6,341, at -e line 1.
&gt; &gt;
</div>&gt; 
&gt; A FreeBSD bug? I tried a C program:
&gt; 
&gt; #include &lt;time.h&gt;
&gt; #include &lt;stdio.h&gt;
&gt; 
&gt; int main&#40;&#41; {
&gt;     struct tm tm;
&gt;     printf&#40;&#34;ret=%s\n&#34;, strptime&#40;&#34;2018-12-10T10:10:10Z&#34;, &#34;%Y-%m-
&gt; %dT%H:%M:%S%z&#34;, &#38;tm&#41;&#41;;
&gt;     printf&#40;&#34;year=%d\n&#34;, tm.tm_year&#41;;
&gt; }
&gt; 
&gt; 
&gt; Output on FreeBSD 11:
&gt; 
&gt; ret=&#40;null&#41;
&gt; year=118
&gt; 
&gt; 
&gt; Output on FreeBSD 12:
&gt; 
&gt; ret=&#40;null&#41;
&gt; year=0
&gt; 
</div>
Well, reading the strptime and strftime manpages on linux &#38; freebsd I am not sure that &#34;Z&#34; is supposed to be parsed by &#34;%z&#34;. strptime returned NULL in the example c program in both cases, which indicates a parse error. It seems coincidence that the tm contents were already filled correctly on linux and freebsd &lt;= 11. But in freebsd 12 and newer tm-&gt;tm_year is filled later &#40;if I understand <span class="clickylink"><a target="new" rel="nofollow" href="https://svnweb.freebsd.org/base/head/lib/libc/stdtime/strptime.c?view=markup&#38;pathrev=340106">https://svnweb.freebsd.org/base/head/lib/libc/stdtime/strptime.c?view=markup&#38;pathrev=340106</a></span> correctly&#41;, so here the year field is just left zero.

What&#39;s probably safe is to use &#34;+00:00&#34; instead of &#34;Z&#34; here.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; On Thu Dec 06 01:46:24 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 +
&gt; &gt; &gt; &gt; 11&#41;,
&gt; &gt; &gt; &gt; but
&gt; &gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
&gt; &gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-">http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-</a></span>
&gt; &gt; &gt; &gt; c1ac4f889b37
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; On 2018-12-05 22:05:57, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Yes, that&#39;s the working theory - I&#39;ve uploaded a new version
&gt; &gt; &gt; &gt; &gt; 1.0.8
&gt; &gt; &gt; &gt; &gt; which I believe addresses the root cause - incorrect parsing of
&gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this one
&gt; &gt; &gt; &gt; &gt; fares.
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC
&gt; &gt; &gt; &gt; &gt; &gt; &#40;originally
&gt; &gt; &gt; &gt; &gt; &gt; the freebsd10 system has Europe/Berlin configured&#41;, and now
&gt; &gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; &gt; tests
&gt; &gt; &gt; &gt; &gt; &gt; pass...
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; Hmm..yes I saw that..puzzling as the test works on other
&gt; &gt; &gt; &gt; &gt; &gt; &gt; versions
&gt; &gt; &gt; &gt; &gt; &gt; &gt; and
&gt; &gt; &gt; &gt; &gt; &gt; &gt; distros from what I can see in the test reports.  The test
&gt; &gt; &gt; &gt; &gt; &gt; &gt; attempts
&gt; &gt; &gt; &gt; &gt; &gt; &gt; to
&gt; &gt; &gt; &gt; &gt; &gt; &gt; determine if a token has timed out by looking at the token
&gt; &gt; &gt; &gt; &gt; &gt; &gt; expiration
&gt; &gt; &gt; &gt; &gt; &gt; &gt; time compared to the current time.  I&#39;ll take a closer look
&gt; &gt; &gt; &gt; &gt; &gt; &gt; at
&gt; &gt; &gt; &gt; &gt; &gt; &gt; how
&gt; &gt; &gt; &gt; &gt; &gt; &gt; my
&gt; &gt; &gt; &gt; &gt; &gt; &gt; comparisons are being done and why it appears that it is
&gt; &gt; &gt; &gt; &gt; &gt; &gt; busted
&gt; &gt; &gt; &gt; &gt; &gt; &gt; only
&gt; &gt; &gt; &gt; &gt; &gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Puzzling indeed.
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-credentials.t
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; fails:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;08&nbsp;11:53:40&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-12-08 11:03:07, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2018-12-08 10:39:14, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On 2018-12-08 10:32:10, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; On 2018-12-06 11:38:52, BIGFOOT wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 +
&gt; &gt; &gt; &gt; &gt; 11&#41;,
&gt; &gt; &gt; &gt; &gt; but
&gt; &gt; &gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
</div>&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Wow, fun stuff.  I&#39;m not sure I necessarily believe that the
&gt; &gt; &gt; &gt; version
&gt; &gt; &gt; &gt; of freebsd 12/13 is the issue - but I do not have access to those
&gt; &gt; &gt; &gt; distros at the moment.  My inclination is that my test is bad?
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Oddly though the diagnostics tell me that the expiration date and
&gt; &gt; &gt; &gt; current time are exactly 5 seconds apart &#40;still exactly within
&gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; valid token time window&#41; - which means that when
&gt; &gt; &gt; &gt; is_token_expired&#40;&#41;
&gt; &gt; &gt; &gt; did the same conversions the time left should be 5s.  If this
&gt; &gt; &gt; &gt; were
&gt; &gt; &gt; &gt; a
&gt; &gt; &gt; &gt; timing issue I would have expected the diagnostics to tell me the
&gt; &gt; &gt; &gt; diff
&gt; &gt; &gt; &gt; between expiration time and current time was &gt; 5 seconds.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; # $VAR1 = [
&gt; &gt; &gt; &gt; #           &#39;2018-12-06T03:52:14Z&#39;,
&gt; &gt; &gt; &gt; #           &#39;2018-12-06T03:47:09Z&#39;
&gt; &gt; &gt; &gt; #         ];
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; ...so almost certainly I must be seeing some drift from timegm&#40;&#41;?
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Any chance you can run this little snippet in those problem envs?
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; #!/usr/bin/perl
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; use strict;
&gt; &gt; &gt; &gt; use warnings;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; use Time::Local;
&gt; &gt; &gt; &gt; use POSIX::strptime qw/strptime/;
&gt; &gt; &gt; &gt; use Date::Format;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; # notes:
&gt; &gt; &gt; &gt; # - expect UTC == GMT, EDT &lt;&gt; UTC
&gt; &gt; &gt; &gt; # - UTC is not really time zone, so maybe issue on some
&gt; &gt; &gt; &gt; platforms,
&gt; &gt; &gt; &gt; better to use GMT?
&gt; &gt; &gt; &gt; # - EDT should not be the same since my ISO8610 is Zulu
&gt; &gt; &gt; &gt; time...just
&gt; &gt; &gt; &gt; for sanity
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; foreach my $tz &#40;qw/UTC GMT EDT/&#41; {
&gt; &gt; &gt; &gt;   my $time = time;
&gt; &gt; &gt; &gt;   my $iso8610 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%SZ&#34;, $time, $tz&#41;;
&gt; &gt; &gt; &gt;   my $timegm = timegm&#40;strptime&#40;$iso8610, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n%s\n&#34;, $tz,
&gt; &gt; &gt; &gt; $iso8610, $time, $timegm, &#39;-&#39;x60&#41;;
&gt; &gt; &gt; &gt; }
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; ...if not I will add some additional diagnostics and a debug flag
&gt; &gt; &gt; &gt; for
&gt; &gt; &gt; &gt; testing
</div>&gt; &gt; &gt;
&gt; &gt; &gt; The test script surely returns something unexpected on freebsd 12 +
&gt; &gt; &gt; 13:
&gt; &gt; &gt;
&gt; &gt; &gt; TZ: UTC ISO8601: 2018-12-08T15:30:26Z
&gt; &gt; &gt; time: 1544283026
&gt; &gt; &gt; timegm: 976289426
&gt; &gt; &gt; ------------------------------------------------------------
&gt; &gt; &gt; TZ: GMT ISO8601: 2018-12-08T15:30:26Z
&gt; &gt; &gt; time: 1544283026
&gt; &gt; &gt; timegm: 976289426
&gt; &gt; &gt; ------------------------------------------------------------
&gt; &gt; &gt; TZ: EDT ISO8601: 2018-12-08T11:30:26Z
&gt; &gt; &gt; time: 1544283026
&gt; &gt; &gt; timegm: 976275026
&gt; &gt; &gt; ------------------------------------------------------------
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; It seems that the year field in the strptime output is broken. Here
&gt; &gt; &gt; a
&gt; &gt; &gt; working strptime on freebsd 11:
&gt; &gt; &gt;
&gt; &gt; &gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;,
&gt; &gt; &gt; strptime&#40;&#34;2018-
&gt; &gt; &gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; &gt; &gt; 10,10,10,10,11,118,6,341, at -e line 1.
&gt; &gt; &gt;
&gt; &gt; &gt; Here the bad output on freebsd 12:
&gt; &gt; &gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;,
&gt; &gt; &gt; strptime&#40;&#34;2018-
&gt; &gt; &gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; &gt; &gt; 10,10,10,10,11,,6,341, at -e line 1.
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt; A FreeBSD bug? I tried a C program:
&gt; &gt;
&gt; &gt; #include &lt;time.h&gt;
&gt; &gt; #include &lt;stdio.h&gt;
&gt; &gt;
&gt; &gt; int main&#40;&#41; {
&gt; &gt;     struct tm tm;
&gt; &gt;     printf&#40;&#34;ret=%s\n&#34;, strptime&#40;&#34;2018-12-10T10:10:10Z&#34;, &#34;%Y-%m-
&gt; &gt; %dT%H:%M:%S%z&#34;, &#38;tm&#41;&#41;;
&gt; &gt;     printf&#40;&#34;year=%d\n&#34;, tm.tm_year&#41;;
&gt; &gt; }
&gt; &gt;
&gt; &gt;
&gt; &gt; Output on FreeBSD 11:
&gt; &gt;
&gt; &gt; ret=&#40;null&#41;
&gt; &gt; year=118
&gt; &gt;
&gt; &gt;
&gt; &gt; Output on FreeBSD 12:
&gt; &gt;
&gt; &gt; ret=&#40;null&#41;
&gt; &gt; year=0
&gt; &gt;
</div>&gt; 
&gt; Well, reading the strptime and strftime manpages on linux &#38; freebsd I
&gt; am not sure that &#34;Z&#34; is supposed to be parsed by &#34;%z&#34;. strptime
&gt; returned NULL in the example c program in both cases, which indicates
&gt; a parse error. It seems coincidence that the tm contents were already
&gt; filled correctly on linux and freebsd &lt;= 11. But in freebsd 12 and
&gt; newer tm-&gt;tm_year is filled later &#40;if I understand
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://svnweb.freebsd.org/base/head/lib/libc/stdtime/strptime.c?view=markup&#38;pathrev=340106">https://svnweb.freebsd.org/base/head/lib/libc/stdtime/strptime.c?view=markup&#38;pathrev=340106</a></span>
&gt; correctly&#41;, so here the year field is just left zero.
&gt; 
&gt; What&#39;s probably safe is to use &#34;+00:00&#34; instead of &#34;Z&#34; here.
&gt; 
</div>
The CPAN module POSIX::2008 also provides a strptime function, and this one just return undef for %z=Z. %z=+00:00 works:

$ perl5.26.1 -MPOSIX::2008=strptime -e &#39;warn join&#40;&#34;,&#34;, strptime&#40;&#34;2018-10-10T12:34:45+00:00&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;&#39;
45,34,12,10,9,118,3,282,-1 at -e line 1.
$ perl5.26.1 -MPOSIX::2008=strptime -e &#39;warn join&#40;&#34;,&#34;, strptime&#40;&#34;2018-10-10T12:34:45Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;&#39;
Warning: something&#39;s wrong at -e line 1.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; On Thu Dec 06 01:46:24 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 +
&gt; &gt; &gt; &gt; &gt; 11&#41;,
&gt; &gt; &gt; &gt; &gt; but
&gt; &gt; &gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
&gt; &gt; &gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-">http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-9416-</a></span>
&gt; &gt; &gt; &gt; &gt; c1ac4f889b37
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; On 2018-12-05 22:05:57, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; Yes, that&#39;s the working theory - I&#39;ve uploaded a new version
&gt; &gt; &gt; &gt; &gt; &gt; 1.0.8
&gt; &gt; &gt; &gt; &gt; &gt; which I believe addresses the root cause - incorrect parsing
&gt; &gt; &gt; &gt; &gt; &gt; of
&gt; &gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; &gt; ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this one
&gt; &gt; &gt; &gt; &gt; &gt; fares.
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &#40;originally
&gt; &gt; &gt; &gt; &gt; &gt; &gt; the freebsd10 system has Europe/Berlin configured&#41;, and now
&gt; &gt; &gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; &gt; &gt; tests
&gt; &gt; &gt; &gt; &gt; &gt; &gt; pass...
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Hmm..yes I saw that..puzzling as the test works on other
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; versions
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; and
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; distros from what I can see in the test reports.  The
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; test
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; attempts
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; to
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; determine if a token has timed out by looking at the
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; token
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; expiration
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; time compared to the current time.  I&#39;ll take a closer
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; look
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; at
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; how
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; my
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; comparisons are being done and why it appears that it is
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; busted
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; only
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Puzzling indeed.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; credentials.t
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; fails:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;09&nbsp;10:06:59&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks so much for your help and doing that bit of research! It would seem that a compliant ISO8601 time would have a standard way to parse it and my search of something standardized to parse this exact representation has not been successful &#40;no doubt there is something though&#41;.  I think this should do the trick:

sub _iso8601_to_time {
  my $iso8601 = shift;

  $iso8601 =~s/^&#40;.*&#41;Z$/$1\+00:00/;

  return timegm&#40;strptime&#40;$iso8601, &#34;%FT%T%z&#34;&#41;&#41;;
}

uploading a new version 1.0.9

.  This has small requirement of converting and comparing expiration times has bitten me throughout writing this module.  

On Sat Dec 08 11:53:40 2018, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2018-12-08 11:03:07, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On 2018-12-08 10:39:14, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; On 2018-12-08 10:32:10, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; On 2018-12-06 11:38:52, BIGFOOT wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 +
&gt; &gt; &gt; &gt; &gt; &gt; 11&#41;,
&gt; &gt; &gt; &gt; &gt; &gt; but
&gt; &gt; &gt; &gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
</div>&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Wow, fun stuff.  I&#39;m not sure I necessarily believe that the
&gt; &gt; &gt; &gt; &gt; version
&gt; &gt; &gt; &gt; &gt; of freebsd 12/13 is the issue - but I do not have access to
&gt; &gt; &gt; &gt; &gt; those
&gt; &gt; &gt; &gt; &gt; distros at the moment.  My inclination is that my test is bad?
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Oddly though the diagnostics tell me that the expiration date
&gt; &gt; &gt; &gt; &gt; and
&gt; &gt; &gt; &gt; &gt; current time are exactly 5 seconds apart &#40;still exactly within
&gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; valid token time window&#41; - which means that when
&gt; &gt; &gt; &gt; &gt; is_token_expired&#40;&#41;
&gt; &gt; &gt; &gt; &gt; did the same conversions the time left should be 5s.  If this
&gt; &gt; &gt; &gt; &gt; were
&gt; &gt; &gt; &gt; &gt; a
&gt; &gt; &gt; &gt; &gt; timing issue I would have expected the diagnostics to tell me
&gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; diff
&gt; &gt; &gt; &gt; &gt; between expiration time and current time was &gt; 5 seconds.
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; # $VAR1 = [
&gt; &gt; &gt; &gt; &gt; #           &#39;2018-12-06T03:52:14Z&#39;,
&gt; &gt; &gt; &gt; &gt; #           &#39;2018-12-06T03:47:09Z&#39;
&gt; &gt; &gt; &gt; &gt; #         ];
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; ...so almost certainly I must be seeing some drift from
&gt; &gt; &gt; &gt; &gt; timegm&#40;&#41;?
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Any chance you can run this little snippet in those problem
&gt; &gt; &gt; &gt; &gt; envs?
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; #!/usr/bin/perl
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; use strict;
&gt; &gt; &gt; &gt; &gt; use warnings;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; use Time::Local;
&gt; &gt; &gt; &gt; &gt; use POSIX::strptime qw/strptime/;
&gt; &gt; &gt; &gt; &gt; use Date::Format;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; # notes:
&gt; &gt; &gt; &gt; &gt; # - expect UTC == GMT, EDT &lt;&gt; UTC
&gt; &gt; &gt; &gt; &gt; # - UTC is not really time zone, so maybe issue on some
&gt; &gt; &gt; &gt; &gt; platforms,
&gt; &gt; &gt; &gt; &gt; better to use GMT?
&gt; &gt; &gt; &gt; &gt; # - EDT should not be the same since my ISO8610 is Zulu
&gt; &gt; &gt; &gt; &gt; time...just
&gt; &gt; &gt; &gt; &gt; for sanity
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; foreach my $tz &#40;qw/UTC GMT EDT/&#41; {
&gt; &gt; &gt; &gt; &gt;   my $time = time;
&gt; &gt; &gt; &gt; &gt;   my $iso8610 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%SZ&#34;, $time, $tz&#41;;
&gt; &gt; &gt; &gt; &gt;   my $timegm = timegm&#40;strptime&#40;$iso8610, &#34;%Y-%m-
&gt; &gt; &gt; &gt; &gt; %dT%H:%M:%S%z&#34;&#41;&#41;;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n%s\n&#34;, $tz,
&gt; &gt; &gt; &gt; &gt; $iso8610, $time, $timegm, &#39;-&#39;x60&#41;;
&gt; &gt; &gt; &gt; &gt; }
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; ...if not I will add some additional diagnostics and a debug
&gt; &gt; &gt; &gt; &gt; flag
&gt; &gt; &gt; &gt; &gt; for
&gt; &gt; &gt; &gt; &gt; testing
</div>&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; The test script surely returns something unexpected on freebsd 12
&gt; &gt; &gt; &gt; +
&gt; &gt; &gt; &gt; 13:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; TZ: UTC ISO8601: 2018-12-08T15:30:26Z
&gt; &gt; &gt; &gt; time: 1544283026
&gt; &gt; &gt; &gt; timegm: 976289426
&gt; &gt; &gt; &gt; ------------------------------------------------------------
&gt; &gt; &gt; &gt; TZ: GMT ISO8601: 2018-12-08T15:30:26Z
&gt; &gt; &gt; &gt; time: 1544283026
&gt; &gt; &gt; &gt; timegm: 976289426
&gt; &gt; &gt; &gt; ------------------------------------------------------------
&gt; &gt; &gt; &gt; TZ: EDT ISO8601: 2018-12-08T11:30:26Z
&gt; &gt; &gt; &gt; time: 1544283026
&gt; &gt; &gt; &gt; timegm: 976275026
&gt; &gt; &gt; &gt; ------------------------------------------------------------
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; It seems that the year field in the strptime output is broken.
&gt; &gt; &gt; &gt; Here
&gt; &gt; &gt; &gt; a
&gt; &gt; &gt; &gt; working strptime on freebsd 11:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;,
&gt; &gt; &gt; &gt; strptime&#40;&#34;2018-
&gt; &gt; &gt; &gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; &gt; &gt; &gt; 10,10,10,10,11,118,6,341, at -e line 1.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Here the bad output on freebsd 12:
&gt; &gt; &gt; &gt; $ perl -MPOSIX::strptime=strptime -e &#39;warn join &#34;,&#34;,
&gt; &gt; &gt; &gt; strptime&#40;&#34;2018-
&gt; &gt; &gt; &gt; 12-10T10:10:10Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#39;
&gt; &gt; &gt; &gt; 10,10,10,10,11,,6,341, at -e line 1.
&gt; &gt; &gt; &gt;
</div>&gt; &gt; &gt;
&gt; &gt; &gt; A FreeBSD bug? I tried a C program:
&gt; &gt; &gt;
&gt; &gt; &gt; #include &lt;time.h&gt;
&gt; &gt; &gt; #include &lt;stdio.h&gt;
&gt; &gt; &gt;
&gt; &gt; &gt; int main&#40;&#41; {
&gt; &gt; &gt;     struct tm tm;
&gt; &gt; &gt;     printf&#40;&#34;ret=%s\n&#34;, strptime&#40;&#34;2018-12-10T10:10:10Z&#34;, &#34;%Y-%m-
&gt; &gt; &gt; %dT%H:%M:%S%z&#34;, &#38;tm&#41;&#41;;
&gt; &gt; &gt;     printf&#40;&#34;year=%d\n&#34;, tm.tm_year&#41;;
&gt; &gt; &gt; }
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Output on FreeBSD 11:
&gt; &gt; &gt;
&gt; &gt; &gt; ret=&#40;null&#41;
&gt; &gt; &gt; year=118
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Output on FreeBSD 12:
&gt; &gt; &gt;
&gt; &gt; &gt; ret=&#40;null&#41;
&gt; &gt; &gt; year=0
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt; Well, reading the strptime and strftime manpages on linux &#38; freebsd I
&gt; &gt; am not sure that &#34;Z&#34; is supposed to be parsed by &#34;%z&#34;. strptime
&gt; &gt; returned NULL in the example c program in both cases, which indicates
&gt; &gt; a parse error. It seems coincidence that the tm contents were already
&gt; &gt; filled correctly on linux and freebsd &lt;= 11. But in freebsd 12 and
&gt; &gt; newer tm-&gt;tm_year is filled later &#40;if I understand
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://svnweb.freebsd.org/base/head/lib/libc/stdtime/strptime.c?view=markup&#38;pathrev=340106">https://svnweb.freebsd.org/base/head/lib/libc/stdtime/strptime.c?view=markup&#38;pathrev=340106</a></span>
&gt; &gt; correctly&#41;, so here the year field is just left zero.
&gt; &gt;
&gt; &gt; What&#39;s probably safe is to use &#34;+00:00&#34; instead of &#34;Z&#34; here.
&gt; &gt;
</div>&gt; 
&gt; The CPAN module POSIX::2008 also provides a strptime function, and
&gt; this one just return undef for %z=Z. %z=+00:00 works:
&gt; 
&gt; $ perl5.26.1 -MPOSIX::2008=strptime -e &#39;warn join&#40;&#34;,&#34;, strptime&#40;&#34;2018-
&gt; 10-10T12:34:45+00:00&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;&#39;
&gt; 45,34,12,10,9,118,3,282,-1 at -e line 1.
&gt; $ perl5.26.1 -MPOSIX::2008=strptime -e &#39;warn join&#40;&#34;,&#34;, strptime&#40;&#34;2018-
&gt; 10-10T12:34:45Z&#34;, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;&#41;&#39;
&gt; Warning: something&#39;s wrong at -e line 1.
&gt; 
<div class="message-stanza open">&gt; &gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; On Thu Dec 06 01:46:24 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; Now it passes on the previously failing freebsd systems &#40;10 +
&gt; &gt; &gt; &gt; &gt; &gt; 11&#41;,
&gt; &gt; &gt; &gt; &gt; &gt; but
&gt; &gt; &gt; &gt; &gt; &gt; it fails now with freebsd 12 + 13. A sample report:
&gt; &gt; &gt; &gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-">http://www.cpantesters.org/cpan/report/9cf0f234-f921-11e8-</a></span>
&gt; &gt; &gt; &gt; &gt; &gt; 9416-
&gt; &gt; &gt; &gt; &gt; &gt; c1ac4f889b37
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; On 2018-12-05 22:05:57, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; Yes, that&#39;s the working theory - I&#39;ve uploaded a new
&gt; &gt; &gt; &gt; &gt; &gt; &gt; version
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 1.0.8
&gt; &gt; &gt; &gt; &gt; &gt; &gt; which I believe addresses the root cause - incorrect
&gt; &gt; &gt; &gt; &gt; &gt; &gt; parsing
&gt; &gt; &gt; &gt; &gt; &gt; &gt; of
&gt; &gt; &gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; &gt; &gt; ISO8601 date format using strptime&#40;&#41;.  Let&#39;s see how this
&gt; &gt; &gt; &gt; &gt; &gt; &gt; one
&gt; &gt; &gt; &gt; &gt; &gt; &gt; fares.
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; On Wed Dec 05 17:25:15 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Maybe it&#39;s timezone related? I just tried setting TZ=UTC
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &#40;originally
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; the freebsd10 system has Europe/Berlin configured&#41;, and
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; now
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; tests
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; pass...
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On 2018-12-05 16:29:34, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Hmm..yes I saw that..puzzling as the test works on
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; other
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; versions
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; and
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; distros from what I can see in the test reports.  The
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; test
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; attempts
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; to
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; determine if a token has timed out by looking at the
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; token
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; expiration
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; time compared to the current time.  I&#39;ll take a closer
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; look
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; at
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; how
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; my
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; comparisons are being done and why it appears that it
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; is
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; busted
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; only
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; on versions &gt; 5.20.0 and only on freebsd.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Puzzling indeed.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On Wed Dec 05 16:20:02 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On my freebsd10 and freebsd11 smokers t/02-
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; credentials.t
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; fails:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;is_token_expired&#40;&#41; - no?&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 72.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   Failed test &#39;refresh_token&#40;&#41;&#39;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; #   at t/02-credentials.t line 94.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; # Looks like you failed 2 tests of 6.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;  t/02-credentials.t ..
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;  Failed 2/6 subtests
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;11:20:44&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Spun up a freebsd 13.0 server and installed 5.22.4 w/perlbrew...

Looks to me like POSIX::strptime&#40;&#41; is busted on that platform - revealed when TZ &lt;&gt; GMT...replacing with mktime&#40;&#41;

#!/usr/bin/env perl

use strict;
use warnings;

use Time::Local;
use POSIX::strptime qw/strptime/;
use POSIX qw/mktime/;
use Date::Format;

# notes:
# - expect UTC == GMT, EST &lt;&gt; UTC
# - UTC is not really time zone, so maybe issue on some platforms, better to use GMT?
# - EDT should not be the same since my ISO8610 is Zulu time...just for sanity

foreach my $tz &#40;qw/UTC GMT EST/&#41; {
  my $time = time;
  my $iso8610 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S+0000&#34;, $time, $tz&#41;;
  my &#40;$sec, $min, $hour, $mday, $mon, $year&#41; = strptime&#40;$iso8610, &#34;%Y-%m-%dT%H:%M:%S%z&#34;&#41;;

  printf&#40;&#34;s:%s m:%s h:%s day:%s month:%s year:%s\n&#34;, $sec, $min, $hour, $mday, $mon, $year&#41;;

  my $mktime = mktime&#40;$sec, $min, $hour, $mday, $mon, $year&#41;;
  my $timegm = timegm&#40;$sec, $min, $hour, $mday, $mon, $year&#41;;

  printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\nmktime: %d\ntimegm: %d\n%s\n&#34;, $tz, $iso8610, $time, $mktime, $timegm, &#39;-&#39;x60&#41;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;11:22:40&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">...whoops meant to say timegm&#40;&#41; is busted it appears
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;11:22:41&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Fixed in 1.0.9 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;11:22:41&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Fixed in 1.0.8 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;13:41:56&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">strptime&#40;&#41; in freebsd behaves differently than strptime&#40;&#41; in linux.  Consider the output from the script below &#40;both run in a bash shell with TZ=America/New_York at nearly the same moment in time&#41;:

#!/usr/bin/env perl

use strict;
use warnings;

use Time::Local;
use POSIX::strptime qw/strptime/;
use Date::Format;

my $tz = &#39;GMT&#39;;
my $time = time;
my $iso8601 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S $tz&#34;, $time, $tz&#41;;

my @time_gm = strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;

my $timegm = timegm&#40;@time_gm&#41;;

printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n&#34;, $tz, $iso8601, $time, $timegm&#41;;


8&lt;----- freebsd  ----

# ./strptime.pl
TZ: GMT ISO8601: 2018-12-10T18:36:56 GMT
time: 1544467016
timegm: 1544449016

8&lt;----- linux  ----

$ ./strptime.pl
TZ: GMT ISO8601: 2018-12-10T18:36:54 GMT
time: 1544467014
timegm: 1544467014

Conclusion: strptime&#40;&#41; always returns time parsed as local time on freebsd 13.0 &#40;at least&#41;, not sure of all variants. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;15:39:14&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-12-10 13:41:56, BIGFOOT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; strptime&#40;&#41; in freebsd behaves differently than strptime&#40;&#41; in linux.
&gt; Consider the output from the script below &#40;both run in a bash shell
&gt; with TZ=America/New_York at nearly the same moment in time&#41;:
&gt; 
&gt; #!/usr/bin/env perl
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; 
&gt; use Time::Local;
&gt; use POSIX::strptime qw/strptime/;
&gt; use Date::Format;
&gt; 
&gt; my $tz = &#39;GMT&#39;;
&gt; my $time = time;
&gt; my $iso8601 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S $tz&#34;, $time, $tz&#41;;
&gt; 
&gt; my @time_gm = strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
&gt; 
&gt; my $timegm = timegm&#40;@time_gm&#41;;
&gt; 
&gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n&#34;, $tz, $iso8601,
&gt; $time, $timegm&#41;;
&gt; 
&gt; 
&gt; 8&lt;----- freebsd  ----
&gt; 
&gt; # ./strptime.pl
&gt; TZ: GMT ISO8601: 2018-12-10T18:36:56 GMT
&gt; time: 1544467016
&gt; timegm: 1544449016
&gt; 
&gt; 8&lt;----- linux  ----
&gt; 
&gt; $ ./strptime.pl
&gt; TZ: GMT ISO8601: 2018-12-10T18:36:54 GMT
&gt; time: 1544467014
&gt; timegm: 1544467014
&gt; 
&gt; Conclusion: strptime&#40;&#41; always returns time parsed as local time on
&gt; freebsd 13.0 &#40;at least&#41;, not sure of all variants.
</div>
That&#39;s even documented in the strptime&#40;3&#41; manpage:

    The resulting values will be relative to the local time zone.

And I checked down to freebsd 9: it was always this way.

I wonder if it&#39;s better for you to switch to another module, maybe Time::Moment &#40;or even DateTime&#41;. This would avoid all the problems with different OS strptime implementations.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;16:03:44&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, I noted that in the docs as well.  So, one approach is to make sure local time is GMT.  v1.0.10 does just that - I&#39;ve localized %ENV and set it to GMT...tests passed on my 13.0/5.22.4 set up...however you may be correct that avoiding such O/S workarounds may be more prudent.

On Mon Dec 10 15:39:14 2018, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2018-12-10 13:41:56, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; strptime&#40;&#41; in freebsd behaves differently than strptime&#40;&#41; in linux.
&gt; &gt; Consider the output from the script below &#40;both run in a bash shell
&gt; &gt; with TZ=America/New_York at nearly the same moment in time&#41;:
&gt; &gt;
&gt; &gt; #!/usr/bin/env perl
&gt; &gt;
&gt; &gt; use strict;
&gt; &gt; use warnings;
&gt; &gt;
&gt; &gt; use Time::Local;
&gt; &gt; use POSIX::strptime qw/strptime/;
&gt; &gt; use Date::Format;
&gt; &gt;
&gt; &gt; my $tz = &#39;GMT&#39;;
&gt; &gt; my $time = time;
&gt; &gt; my $iso8601 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S $tz&#34;, $time, $tz&#41;;
&gt; &gt;
&gt; &gt; my @time_gm = strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
&gt; &gt;
&gt; &gt; my $timegm = timegm&#40;@time_gm&#41;;
&gt; &gt;
&gt; &gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n&#34;, $tz, $iso8601,
&gt; &gt; $time, $timegm&#41;;
&gt; &gt;
&gt; &gt;
&gt; &gt; 8&lt;----- freebsd  ----
&gt; &gt;
&gt; &gt; # ./strptime.pl
&gt; &gt; TZ: GMT ISO8601: 2018-12-10T18:36:56 GMT
&gt; &gt; time: 1544467016
&gt; &gt; timegm: 1544449016
&gt; &gt;
&gt; &gt; 8&lt;----- linux  ----
&gt; &gt;
&gt; &gt; $ ./strptime.pl
&gt; &gt; TZ: GMT ISO8601: 2018-12-10T18:36:54 GMT
&gt; &gt; time: 1544467014
&gt; &gt; timegm: 1544467014
&gt; &gt;
&gt; &gt; Conclusion: strptime&#40;&#41; always returns time parsed as local time on
&gt; &gt; freebsd 13.0 &#40;at least&#41;, not sure of all variants.
</div>&gt; 
&gt; That&#39;s even documented in the strptime&#40;3&#41; manpage:
&gt; 
&gt; The resulting values will be relative to the local time zone.
&gt; 
&gt; And I checked down to freebsd 9: it was always this way.
&gt; 
&gt; I wonder if it&#39;s better for you to switch to another module, maybe
&gt; Time::Moment &#40;or even DateTime&#41;. This would avoid all the problems
&gt; with different OS strptime implementations.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;17:25:07&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">...or as you suggest use a different module -  perhaps there is a strptime&#40;&#41; that is not ambiquous?  Date::Parse::strptime&#40;&#41;?

I think the horse is officially dead.

8&lt;-------- 
#!/usr/bin/env perl

use strict;
use warnings;

use Time::Local;
use Date::Format;
use POSIX::strptime;
use Date::Parse;

my $tz = &#39;GMT&#39;;
my $time = time;
my $iso8601 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S $tz&#34;, $time, $tz&#41;;

my @date_parse_time_gm = strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
my $date_parse_timegm = timegm&#40;@date_parse_time_gm&#41;;

my @posix_time_gm = POSIX::strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
my $timegm = timegm&#40;@posix_time_gm&#41;;

printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm&#40;POSIX::strptime&#41;: %d\ntimegm&#40;Date::Parse::strptime&#41;: %d\n&#34;, $tz, $iso8601, $time, $timegm, $date_parse_timegm&#41;;

8&lt;-------- 

[root@freebsd ~]# echo $TZ ; date +&#39;%Y-%m-%dT%H:%M:%S %Z&#39;; ./strptime.pl
America/Los_Angeles
2018-12-10T14:21:59 PST
TZ: GMT ISO8601: 2018-12-10T22:21:59 GMT
time: 1544480519
timegm&#40;POSIX::strptime&#41;: 1544451719
timegm&#40;Date::Parse::strptime&#41;: 1544480519



On Mon Dec 10 15:39:14 2018, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2018-12-10 13:41:56, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; strptime&#40;&#41; in freebsd behaves differently than strptime&#40;&#41; in linux.
&gt; &gt; Consider the output from the script below &#40;both run in a bash shell
&gt; &gt; with TZ=America/New_York at nearly the same moment in time&#41;:
&gt; &gt;
&gt; &gt; #!/usr/bin/env perl
&gt; &gt;
&gt; &gt; use strict;
&gt; &gt; use warnings;
&gt; &gt;
&gt; &gt; use Time::Local;
&gt; &gt; use POSIX::strptime qw/strptime/;
&gt; &gt; use Date::Format;
&gt; &gt;
&gt; &gt; my $tz = &#39;GMT&#39;;
&gt; &gt; my $time = time;
&gt; &gt; my $iso8601 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S $tz&#34;, $time, $tz&#41;;
&gt; &gt;
&gt; &gt; my @time_gm = strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
&gt; &gt;
&gt; &gt; my $timegm = timegm&#40;@time_gm&#41;;
&gt; &gt;
&gt; &gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n&#34;, $tz, $iso8601,
&gt; &gt; $time, $timegm&#41;;
&gt; &gt;
&gt; &gt;
&gt; &gt; 8&lt;----- freebsd  ----
&gt; &gt;
&gt; &gt; # ./strptime.pl
&gt; &gt; TZ: GMT ISO8601: 2018-12-10T18:36:56 GMT
&gt; &gt; time: 1544467016
&gt; &gt; timegm: 1544449016
&gt; &gt;
&gt; &gt; 8&lt;----- linux  ----
&gt; &gt;
&gt; &gt; $ ./strptime.pl
&gt; &gt; TZ: GMT ISO8601: 2018-12-10T18:36:54 GMT
&gt; &gt; time: 1544467014
&gt; &gt; timegm: 1544467014
&gt; &gt;
&gt; &gt; Conclusion: strptime&#40;&#41; always returns time parsed as local time on
&gt; &gt; freebsd 13.0 &#40;at least&#41;, not sure of all variants.
</div>&gt; 
&gt; That&#39;s even documented in the strptime&#40;3&#41; manpage:
&gt; 
&gt; The resulting values will be relative to the local time zone.
&gt; 
&gt; And I checked down to freebsd 9: it was always this way.
&gt; 
&gt; I wonder if it&#39;s better for you to switch to another module, maybe
&gt; Time::Moment &#40;or even DateTime&#41;. This would avoid all the problems
&gt; with different OS strptime implementations.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;09:18:24&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixed in version 1.0.10
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;09:18:25&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;09:18:25&nbsp;2018</span>
    <span class="description">BIGFOOT [...] cpan.org -  Fixed in 1.0.9 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;15:26:46&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-12-10 17:25:07, BIGFOOT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ...or as you suggest use a different module -  perhaps there is a
&gt; strptime&#40;&#41; that is not ambiquous?  Date::Parse::strptime&#40;&#41;?
</div>
If it&#39;s just for parsing ISO8601 dates, then I would recommend Time::Moment-&gt;from_string.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I think the horse is officially dead.
&gt; 
&gt; 8&lt;--------
&gt; #!/usr/bin/env perl
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; 
&gt; use Time::Local;
&gt; use Date::Format;
&gt; use POSIX::strptime;
&gt; use Date::Parse;
&gt; 
&gt; my $tz = &#39;GMT&#39;;
&gt; my $time = time;
&gt; my $iso8601 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S $tz&#34;, $time, $tz&#41;;
&gt; 
&gt; my @date_parse_time_gm = strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
&gt; my $date_parse_timegm = timegm&#40;@date_parse_time_gm&#41;;
&gt; 
&gt; my @posix_time_gm = POSIX::strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
&gt; my $timegm = timegm&#40;@posix_time_gm&#41;;
&gt; 
&gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm&#40;POSIX::strptime&#41;:
&gt; %d\ntimegm&#40;Date::Parse::strptime&#41;: %d\n&#34;, $tz, $iso8601, $time,
&gt; $timegm, $date_parse_timegm&#41;;
&gt; 
&gt; 8&lt;--------
&gt; 
&gt; [root@freebsd ~]# echo $TZ ; date +&#39;%Y-%m-%dT%H:%M:%S %Z&#39;;
&gt; ./strptime.pl
&gt; America/Los_Angeles
&gt; 2018-12-10T14:21:59 PST
&gt; TZ: GMT ISO8601: 2018-12-10T22:21:59 GMT
&gt; time: 1544480519
&gt; timegm&#40;POSIX::strptime&#41;: 1544451719
&gt; timegm&#40;Date::Parse::strptime&#41;: 1544480519
&gt; 
&gt; 
&gt; 
&gt; On Mon Dec 10 15:39:14 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On 2018-12-10 13:41:56, BIGFOOT wrote:
<div class="message-stanza open">&gt; &gt; &gt; strptime&#40;&#41; in freebsd behaves differently than strptime&#40;&#41; in linux.
&gt; &gt; &gt; Consider the output from the script below &#40;both run in a bash shell
&gt; &gt; &gt; with TZ=America/New_York at nearly the same moment in time&#41;:
&gt; &gt; &gt;
&gt; &gt; &gt; #!/usr/bin/env perl
&gt; &gt; &gt;
&gt; &gt; &gt; use strict;
&gt; &gt; &gt; use warnings;
&gt; &gt; &gt;
&gt; &gt; &gt; use Time::Local;
&gt; &gt; &gt; use POSIX::strptime qw/strptime/;
&gt; &gt; &gt; use Date::Format;
&gt; &gt; &gt;
&gt; &gt; &gt; my $tz = &#39;GMT&#39;;
&gt; &gt; &gt; my $time = time;
&gt; &gt; &gt; my $iso8601 = time2str&#40;&#34;%Y-%m-%dT%H:%M:%S $tz&#34;, $time, $tz&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; my @time_gm = strptime&#40;$iso8601, &#34;%Y-%m-%dT%H:%M:%S %Z&#34;&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; my $timegm = timegm&#40;@time_gm&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; printf&#40;&#34;TZ: %s ISO8601: %s\ntime: %d\ntimegm: %d\n&#34;, $tz, $iso8601,
&gt; &gt; &gt; $time, $timegm&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; 8&lt;----- freebsd  ----
&gt; &gt; &gt;
&gt; &gt; &gt; # ./strptime.pl
&gt; &gt; &gt; TZ: GMT ISO8601: 2018-12-10T18:36:56 GMT
&gt; &gt; &gt; time: 1544467016
&gt; &gt; &gt; timegm: 1544449016
&gt; &gt; &gt;
&gt; &gt; &gt; 8&lt;----- linux  ----
&gt; &gt; &gt;
&gt; &gt; &gt; $ ./strptime.pl
&gt; &gt; &gt; TZ: GMT ISO8601: 2018-12-10T18:36:54 GMT
&gt; &gt; &gt; time: 1544467014
&gt; &gt; &gt; timegm: 1544467014
&gt; &gt; &gt;
&gt; &gt; &gt; Conclusion: strptime&#40;&#41; always returns time parsed as local time on
&gt; &gt; &gt; freebsd 13.0 &#40;at least&#41;, not sure of all variants.
</div>&gt; &gt;
&gt; &gt; That&#39;s even documented in the strptime&#40;3&#41; manpage:
&gt; &gt;
&gt; &gt; The resulting values will be relative to the local time zone.
&gt; &gt;
&gt; &gt; And I checked down to freebsd 9: it was always this way.
&gt; &gt;
&gt; &gt; I wonder if it&#39;s better for you to switch to another module, maybe
&gt; &gt; Time::Moment &#40;or even DateTime&#41;. This would avoid all the problems
&gt; &gt; with different OS strptime implementations.
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
