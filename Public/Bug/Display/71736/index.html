<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71736 for Win32-InstallShield: Problem with non ASCII characters in ism file</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71736 for Win32-InstallShield: Problem with non ASCII characters in ism file</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Win32-InstallShield/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Win32-InstallShield/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Win32-InstallShield/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Win32-InstallShield/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Win32-InstallShield">Win32-InstallShield CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71736</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Win32-InstallShield/Active/">Win32-InstallShield</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">kbaucom [...] schizoid.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Torsten.Werner [...] assyst.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41082-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41083-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;17&nbsp;08:24:43&nbsp;2011</span>
    <span class="description">Torsten.Werner [...] assyst.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem with non ASCII characters in ism file</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 17 Oct 2011 14:24:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-InstallShield [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Torsten.Werner [...] assyst.de</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
the information to reproduce the bug:

Version of Win32::InstallShield: 0.5
Perl Version: This is perl, v5.10.1 built for MSWin32-x86-multi-thread
OS. Windows 7 prof. German
InstallShield: InstallShield 2011 Hotfix A

The problem:

The ism file contains per default the following line in the ISString 
table:

 &lt;row&gt;&lt;td&gt;IDS_SETUPEXE_EXPIRE_MSG&lt;/td&gt;&lt;td&gt;1031&lt;/td&gt;&lt;td&gt;Diese Setup ist 
gÃ¼ltig bis %s.  Das Setup wird nun 
beendet.&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td/&gt;&lt;td/&gt;&lt;/row&gt;
in hex:

017ba60: 2f74 643e 3c2f 726f 773e 0d0a 0909 3c72  /td&gt;&lt;/row&gt;....&lt;r
017ba70: 6f77 3e3c 7464 3e49 4453 5f53 4554 5550  ow&gt;&lt;td&gt;IDS_SETUP
017ba80: 4558 455f 4558 5049 5245 5f4d 5347 3c2f  EXE_EXPIRE_MSG&lt;/
017ba90: 7464 3e3c 7464 3e31 3033 313c 2f74 643e  td&gt;&lt;td&gt;1031&lt;/td&gt;
017baa0: 3c74 643e 4469 6573 6520 5365 7475 7020  &lt;td&gt;Diese Setup 
017bab0: 6973 7420 67c3 bc6c 7469 6720 6269 7320  ist g..ltig bis 
017bac0: 2573 2e20 2044 6173 2053 6574 7570 2077  %s.  Das Setup w
017bad0: 6972 6420 6e75 6e20 6265 656e 6465 742e  ird nun beendet.
017bae0: 3c2f 7464 3e3c 7464 3e30 3c2f 7464 3e3c  &lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;
017baf0: 7464 2f3e 3c74 642f 3e3c 2f72 6f77 3e0d  td/&gt;&lt;td/&gt;&lt;/row&gt;.
017bb00: 0a09 093c 726f 773e 3c74 643e 4944 535f  ...&lt;row&gt;&lt;td&gt;IDS_ 

There are 2 bytes to be seen for the &#34;LATIN SMALL LETTER U WITH DIAERESIS&#34; 
&#40;code point 00FC in Unicode charts, c3bc in utf-8&#41;.

After saving of the file with a modification of a different enry in the 
ISString table the text has been changed:

017ba70: 6f77 3e3c 7464 3e49 4453 5f53 4554 5550  ow&gt;&lt;td&gt;IDS_SETUP
017ba80: 4558 455f 4558 5049 5245 5f4d 5347 3c2f  EXE_EXPIRE_MSG&lt;/
017ba90: 7464 3e3c 7464 3e31 3033 313c 2f74 643e  td&gt;&lt;td&gt;1031&lt;/td&gt;
017baa0: 3c74 643e 4469 6573 6520 5365 7475 7020  &lt;td&gt;Diese Setup 
017bab0: 6973 7420 67fc 6c74 6967 2062 6973 2025  ist g.ltig bis %
017bac0: 732e 2020 4461 7320 5365 7475 7020 7769  s.  Das Setup wi
017bad0: 7264 206e 756e 2062 6565 6e64 6574 2e3c  rd nun beendet.&lt;
017bae0: 2f74 643e 3c74 643e 303c 2f74 643e 3c74  /td&gt;&lt;td&gt;0&lt;/td&gt;&lt;t
017baf0: 642f 3e3c 7464 2f3e 3c2f 726f 773e 0d0a  d/&gt;&lt;td/&gt;&lt;/row&gt;..
017bb00: 0909 3c72 6f77 3e3c 7464 3e49 4453 5f53  ..&lt;row&gt;&lt;td&gt;IDS_S

The critical character is now encoded with &#34;FC&#34; &#40;perl internal encoding&#41;

Neither InstallShield nor Win32::InstallShield can load this file.

So far as I can see the problem is the save routine. 
When a section is parsed, the content is available in perl internal 
encoding. When the section is not parsed, the content has the original 
format.
It is needed to encode the content for the parsed sections. In the sample 
I encode according the XML header. It works for me:
 
sub save {
        local $_;
        my &#40;$self&#41; = @_;

        my $text = &#39;&#39;;

        my $encoding;
        foreach &#40;@{$self-&gt;{sections}-&gt;{header}}&#41; {
                $encoding=$1 if &#40;/\sencoding=&#34;&#40;[^&#34;]+&#41;&#34;/&#41;;
        }

        foreach my $section &#40;@{$self-&gt;{&#39;order&#39;}}&#41; {
                if&#40;$self-&gt;{&#39;parsed&#39;}{$section}&#41; {
                        # the table has been &#40;possibly&#41; modified, so 
rebuild it
                        if&#40;$section eq &#39;summary&#39;&#41; {
                                $text .= defined&#40;$encoding&#41; ? 
encode&#40;$encoding,$self-&gt;_save_summary&#41; : $self-&gt;_save_summary;
                        } else {
                                $text .= defined&#40;$encoding&#41; ? 
encode&#40;$encoding,$self-&gt;_save_table&#40;$section&#41;&#41; : 
$self-&gt;_save_table&#40;$section&#41;;
                        }
                } else {
                        # when the last table gets modified, we end up 
with an
                        # extra newline
                        if&#40;$section eq &#39;trailer&#39;&#41; {
                                $text =~ s/\n\n$/\n/;
                        }
                        # section wasn&#39;t touched, just spit out the stored 
text
                        $text .= join&#40;&#34;\n&#34;, 
@{$self-&gt;{&#39;sections&#39;}{$section}}&#41; . &#34;\n&#34;;
                }
        }

        return $text;
}


Bye
Torsten

----------------------------------------------------------------------

assyst GmbH
Dr. Ing. Torsten Werner
Product Manager plan.assyst
Max-Planck-Str. 3
85609 Aschheim-Dornach
Germany
Phone:     +49 &#40;0&#41;89 90505-0
Fax:       +49 &#40;0&#41;89 90505-271
E-Mail:    torsten.werner@assyst.de
Internet:  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.assyst.de">http://www.assyst.de</a></span>


Geschäftsführer: Dr. Andreas Seidl
Eingetragen beim Registergericht München HRB 180174
Sitz der Gesellschaft: 85609 Aschheim-Dornach
----------------------------------------------------------------------
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;19:39:36&nbsp;2011</span>
    <span class="description">kbaucom [...] schizoid.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;19:40:58&nbsp;2011</span>
    <span class="description">kbaucom [...] schizoid.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in version 0.6. Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;19:40:59&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;19:40:59&nbsp;2011</span>
    <span class="description">kbaucom [...] schizoid.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
