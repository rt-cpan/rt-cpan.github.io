<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #72869 for Marpa-XS: Error when two empty rules are in a row</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #72869 for Marpa-XS: Error when two empty rules are in a row</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Marpa-XS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Marpa-XS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Marpa-XS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Marpa-XS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Marpa-XS">Marpa-XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">72869</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Marpa-XS/Active/">Marpa-XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jkegl [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tomas.jirotka [...] gooddata.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-238156-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.024000</li>
<li>
0.020000</li>
<li>
0.021_000</li>
<li>
0.022000</li>
<li>
0.023_000</li>
</ul>
    </td>
  </tr>
  <tr id="CF-238157-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<ul>
<li>
0.025_001</li>
<li>
0.026000</li>
</ul>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;01&nbsp;10:25:49&nbsp;2011</span>
    <span class="description">tomas.jirotka [...] gooddata.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Error when two empty rules are in a row</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 1 Dec 2011 16:25:22 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Marpa-XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomáš Jirotka &lt;tomas.jirotka [...] gooddata.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
I have written a small grammar for a language not very different from SQL. I enclose the source code in attachment. There are several optional clauses as can be seen from the figure:

CREATE METRIC id_metric AS SELECT number &#40;BY|empty&#41; &#40;FOR|empty&#41; &#40;WHERE &#40;TRUE|FALSE&#41;|empty&#41; &#40;WITH PF|empty&#41;

Here, &#39;empty&#39; states for the empty string, other lower case words are variables, upper case are keywords. On line 41, there is a rule &#39;TypeDef&#39; -&gt; 4 tokens, but the token &#39;AS&#39; is evaluated as a part of MetricSelect rule. This is the real output

$VAR1 = [
          \[
              &#39;Create&#39;,
              &#39;Metric&#39;,
              &#39;m&#39;,
              [
                &#39;As&#39;,
                &#39;Select&#39;,
                [
                  1
                ],
                undef,
                [
                  &#39;Where&#39;,
                  [
                    &#39;True&#39;
                  ]
                ],
                undef
              ]
            ]
        ];

while I would expect

$VAR1 = [
          \[
              [
                &#39;Create&#39;,
                [
                  &#39;Metric&#39;,
                  &#39;m&#39;,
                  &#39;As&#39;,
                  [
                    &#39;Select&#39;,
                    [
                      1
                    ],
                    undef,
                    undef,
                    [
                      &#39;Where&#39;,
                      [
                        &#39;True&#39;
                      ]
                    ],
                    undef
                  ]
                ]
              ]
            ]
        ];

You may try it. It is important to note that in Marpa::PP this works properly, only XS&#39;s output is wrong. Probably, the problem is in two optional keywords before WHERE.

Versions:
This is perl, v5.10.1 &#40;*&#41; built for i386-linux-thread-multi
XS 0.024000
PP 0.012000


Thank you for producing this nice and useful package!
Tomas






Tomáš Jirotka
Software Engineer

GoodData
Sokolovská 192/79, 186 00, Prague 8
Office:   +420 226 219 421
E-mail:  tomas.jirotka@gooddata.com
Web:     www.gooddata.com
</div></div>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza">Hi,
<div>I have written a small grammar for a language not very different from SQL. I enclose the source code in attachment. There are several optional clauses as can be seen from the figure:</div>
<div><br></div>
<div>CREATE METRIC id_metric AS SELECT number (BY|empty) (FOR|empty) (WHERE (TRUE|FALSE)|empty) (WITH PF|empty)</div>
<div><br></div>
<div>Here, 'empty' states for the empty string, other lower case words are variables, upper case are keywords. On line 41, there is a rule 'TypeDef' -&gt; 4 tokens, but the token 'AS' is evaluated as a part of MetricSelect rule. This is the real output</div>
<div><br></div>
<div><div>$VAR1 = [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \[</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Create',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Metric',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'm',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'As',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Select',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; undef,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Where',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'True'</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; undef</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ];</div></div>
<div><br></div>
<div>while I would expect</div>
<div><br></div>
<div><div>$VAR1 = [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \[</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Create',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Metric',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'm',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'As',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Select',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; undef,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; undef,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Where',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'True'</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; undef</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ];</div></div>
<div><br></div>
<div>You may try it. It is important to note that in Marpa::PP this works properly, only XS's output is wrong. Probably, the problem is in two optional keywords before WHERE.</div>
<div><br></div>
<div>Versions:</div>
<div>This is perl, v5.10.1 (*) built for i386-linux-thread-multi</div>
<div>XS 0.024000</div>
<div>PP 0.012000</div>
<div><br></div>
<div><br></div>
<div>Thank you for producing this nice and useful package!</div>
<div>Tomas</div>
<div><br></div>
<div><br></div>
<div></div>
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza"><div></div>
<div><br></div>
<br>
<br>
<div>
<span><span><div><div><span style="color: rgb(153, 153, 153); font-family: verdana, sans-serif; font-size: 9px; "><b>Tomáš Jirotka</b></span></div><div><div style="text-align: left; font-family: arial; font-size: small; background-color: rgb(255, 255, 255); "><span style="color: rgb(153, 153, 153); font-family: verdana, sans-serif; font-size: 0.3063540090771559em; ">Software Engineer</span></div><div style="font-size: small; font-family: Arial, Verdana, sans-serif; background-color: rgb(255, 255, 255); "><font face="verdana, sans-serif" style="font-family: arial; "><br><span style="color: rgb(153, 153, 153); background-color: rgb(255, 255, 255); font-size: x-small; "><b>GoodData</b></span></font><div style="font-family: arial; "><font face="verdana, sans-serif" style="font-size: 0.3630862329803329em; "><span>Sokolovská 192/79,&nbsp;</span></font><span>186 00, Prague 8</span></div><div style="font-family: arial; "><div><font face="verdana, sans-serif"><span style="background-color: rgb(255, 255, 255); "></span><span style="color: rgb(153, 153, 153); background-color: rgb(255, 255, 255); font-size: x-small; ">Office: &nbsp; +420 226 219 421</span></font></div><div><font face="verdana, sans-serif"><span style="background-color: rgb(255, 255, 255); "></span><span style="color: rgb(153, 153, 153); background-color: rgb(255, 255, 255); font-size: x-small; ">E-mail: &nbsp;<a href="mailto:tomas.jirotka@gooddata.com">tomas.jirotka@gooddata.com</a></span></font></div><div><font face="verdana, sans-serif"><span style="background-color: rgb(255, 255, 255); "></span><span style="color: rgb(153, 153, 153); background-color: rgb(255, 255, 255); font-size: x-small; ">Web: &nbsp; &nbsp; <a href="http://www.gooddata.com">www.gooddata.com</a></span></font></div></div></div></div></div></span></span>
</div>

<br>
</div></div>
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;01&nbsp;12:39:47&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;01&nbsp;12:44:52&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">thanks for the very well-documented bug, which I&#39;ve started work on.  My
current belief is that the problem is in the XS evaluation logic.

By the way, although it is not directly relevent to the bug report, the
tokens&#40;&#41; method is severely deprecated in favor or the read&#40;&#41; method,
and is not documented in either Marpa::XS or Marpa::PP.  However, I do
not believe use of the tokens&#40;&#41; method affects the issue here.

Again, thanks for the bug report, and the kind words about Marpa

-- jeffrey kegler

On Thu Dec 01 10:25:49 2011, tomas.jirotka@gooddata.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; I have written a small grammar for a language not very different from
&gt;    SQL. I enclose the source code in attachment. There are several
&gt;    optional clauses as can be seen from the figure:
&gt; 
&gt; CREATE METRIC id_metric AS SELECT number &#40;BY|empty&#41; &#40;FOR|empty&#41; &#40;WHERE
&gt;    &#40;TRUE|FALSE&#41;|empty&#41; &#40;WITH PF|empty&#41;
&gt; 
&gt; Here, &#39;empty&#39; states for the empty string, other lower case words are
&gt;    variables, upper case are keywords. On line 41, there is a rule
&gt;    &#39;TypeDef&#39; -&gt; 4 tokens, but the token &#39;AS&#39; is evaluated as a part of
&gt;    MetricSelect rule. This is the real output
&gt; 
&gt; $VAR1 = [
&gt;           \[
&gt;               &#39;Create&#39;,
&gt;               &#39;Metric&#39;,
&gt;               &#39;m&#39;,
&gt;               [
&gt;                 &#39;As&#39;,
&gt;                 &#39;Select&#39;,
&gt;                 [
&gt;                   1
&gt;                 ],
&gt;                 undef,
&gt;                 [
&gt;                   &#39;Where&#39;,
&gt;                   [
&gt;                     &#39;True&#39;
&gt;                   ]
&gt;                 ],
&gt;                 undef
&gt;               ]
&gt;             ]
&gt;         ];
&gt; 
&gt; while I would expect
&gt; 
&gt; $VAR1 = [
&gt;           \[
&gt;               [
&gt;                 &#39;Create&#39;,
&gt;                 [
&gt;                   &#39;Metric&#39;,
&gt;                   &#39;m&#39;,
&gt;                   &#39;As&#39;,
&gt;                   [
&gt;                     &#39;Select&#39;,
&gt;                     [
&gt;                       1
&gt;                     ],
&gt;                     undef,
&gt;                     undef,
&gt;                     [
&gt;                       &#39;Where&#39;,
&gt;                       [
&gt;                         &#39;True&#39;
&gt;                       ]
&gt;                     ],
&gt;                     undef
&gt;                   ]
&gt;                 ]
&gt;               ]
&gt;             ]
&gt;         ];
&gt; 
&gt; You may try it. It is important to note that in Marpa::PP this works
&gt;    properly, only XS&#39;s output is wrong. Probably, the problem is in
&gt;    two optional keywords before WHERE.
&gt; 
&gt; Versions:
&gt; This is perl, v5.10.1 &#40;*&#41; built for i386-linux-thread-multi
&gt; XS 0.024000
&gt; PP 0.012000
&gt; 
&gt; 
&gt; Thank you for producing this nice and useful package!
&gt; Tomas
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Tomáš Jirotka
&gt; Software Engineer
&gt; 
&gt; GoodData
&gt; Sokolovská 192/79, 186 00, Prague 8
&gt; Office:   +420 226 219 421
&gt; E-mail:  tomas.jirotka@gooddata.com
&gt; Web:     www.gooddata.com
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;01&nbsp;12:44:53&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;21:31:36&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Broken in 0.024000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;21:42:22&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a fix, which I have just uploaded to CPAN as Marpa-XS-0.025_000.
 I will await cpantesters results on this, then cut an offical release.
 Thanks, Tomas for a very important and well done bug report.  I&#39;ve also
added this problem to Marpa::XS&#39;s test suite as t/jirotka.t.

The problem was in the evaluation logic.  It only occurs under certain
very unusual circumstances, circumstances which it takes a lot of
internal-speak to describe.  Briefly the problems is with nullablss at
the start of a rule &#40;which may be a result of an Marpa-internal rewrite&#41;
when that rule appears in a Leo chain and is not the same as the top
rule.  &#40;Leo chains are an internal mechanism used to keep
right-recursion from going quadratic.&#41;

Many thanks, Tomáš, for nailing down this obscure but nasty little issue
so I could fix it.

-- jeffrey kegler

On Thu Dec 01 12:44:52 2011, JKEGL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; thanks for the very well-documented bug, which I&#39;ve started work on.  My
&gt; current belief is that the problem is in the XS evaluation logic.
&gt; 
&gt; By the way, although it is not directly relevent to the bug report, the
&gt; tokens&#40;&#41; method is severely deprecated in favor or the read&#40;&#41; method,
&gt; and is not documented in either Marpa::XS or Marpa::PP.  However, I do
&gt; not believe use of the tokens&#40;&#41; method affects the issue here.
&gt; 
&gt; Again, thanks for the bug report, and the kind words about Marpa
&gt; 
&gt; -- jeffrey kegler
&gt; 
&gt; On Thu Dec 01 10:25:49 2011, tomas.jirotka@gooddata.com wrote:
<div class="message-stanza open">&gt; &gt; Hi,
&gt; &gt; I have written a small grammar for a language not very different from
&gt; &gt;    SQL. I enclose the source code in attachment. There are several
&gt; &gt;    optional clauses as can be seen from the figure:
&gt; &gt; 
&gt; &gt; CREATE METRIC id_metric AS SELECT number &#40;BY|empty&#41; &#40;FOR|empty&#41; &#40;WHERE
&gt; &gt;    &#40;TRUE|FALSE&#41;|empty&#41; &#40;WITH PF|empty&#41;
&gt; &gt; 
&gt; &gt; Here, &#39;empty&#39; states for the empty string, other lower case words are
&gt; &gt;    variables, upper case are keywords. On line 41, there is a rule
&gt; &gt;    &#39;TypeDef&#39; -&gt; 4 tokens, but the token &#39;AS&#39; is evaluated as a part of
&gt; &gt;    MetricSelect rule. This is the real output
&gt; &gt; 
&gt; &gt; $VAR1 = [
&gt; &gt;           \[
&gt; &gt;               &#39;Create&#39;,
&gt; &gt;               &#39;Metric&#39;,
&gt; &gt;               &#39;m&#39;,
&gt; &gt;               [
&gt; &gt;                 &#39;As&#39;,
&gt; &gt;                 &#39;Select&#39;,
&gt; &gt;                 [
&gt; &gt;                   1
&gt; &gt;                 ],
&gt; &gt;                 undef,
&gt; &gt;                 [
&gt; &gt;                   &#39;Where&#39;,
&gt; &gt;                   [
&gt; &gt;                     &#39;True&#39;
&gt; &gt;                   ]
&gt; &gt;                 ],
&gt; &gt;                 undef
&gt; &gt;               ]
&gt; &gt;             ]
&gt; &gt;         ];
&gt; &gt; 
&gt; &gt; while I would expect
&gt; &gt; 
&gt; &gt; $VAR1 = [
&gt; &gt;           \[
&gt; &gt;               [
&gt; &gt;                 &#39;Create&#39;,
&gt; &gt;                 [
&gt; &gt;                   &#39;Metric&#39;,
&gt; &gt;                   &#39;m&#39;,
&gt; &gt;                   &#39;As&#39;,
&gt; &gt;                   [
&gt; &gt;                     &#39;Select&#39;,
&gt; &gt;                     [
&gt; &gt;                       1
&gt; &gt;                     ],
&gt; &gt;                     undef,
&gt; &gt;                     undef,
&gt; &gt;                     [
&gt; &gt;                       &#39;Where&#39;,
&gt; &gt;                       [
&gt; &gt;                         &#39;True&#39;
&gt; &gt;                       ]
&gt; &gt;                     ],
&gt; &gt;                     undef
&gt; &gt;                   ]
&gt; &gt;                 ]
&gt; &gt;               ]
&gt; &gt;             ]
&gt; &gt;         ];
&gt; &gt; 
&gt; &gt; You may try it. It is important to note that in Marpa::PP this works
&gt; &gt;    properly, only XS&#39;s output is wrong. Probably, the problem is in
&gt; &gt;    two optional keywords before WHERE.
&gt; &gt; 
&gt; &gt; Versions:
&gt; &gt; This is perl, v5.10.1 &#40;*&#41; built for i386-linux-thread-multi
&gt; &gt; XS 0.024000
&gt; &gt; PP 0.012000
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Thank you for producing this nice and useful package!
&gt; &gt; Tomas
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Tomáš Jirotka
&gt; &gt; Software Engineer
&gt; &gt; 
&gt; &gt; GoodData
&gt; &gt; Sokolovská 192/79, 186 00, Prague 8
&gt; &gt; Office:   +420 226 219 421
&gt; &gt; E-mail:  tomas.jirotka@gooddata.com
&gt; &gt; Web:     www.gooddata.com
&gt; &gt; 
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;04&nbsp;19:13:39&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have uploaded a 2nd release candidate: Marpa-XS-0.025_001.  I
accidently left a Modern::Perl dependency in one of the tests, which was
making Marpa-XS-0.025_000 fail on platforms without Modern::Perl.  &#40;I
have nothing against Modern::Perl, btw, it is just that Marpa::XS uses
non-core dependencies only when it has no real alternative.&#41;

The Modern::Perl issue aside, tests for Marpa-XS-0.025_000 looked good,
as do those for Marpa-XS-0.025_001 so far.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;21:30:36&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have just uploaded an official release with this fix:
Marpa-XS-0.026000.  As is my usual practice, I plan to wait 3 days or so
for cpantesters or other feedback before marking this issue resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;21:32:14&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Broken in 0.020000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;21:32:14&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Broken in 0.021_000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;21:32:14&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Broken in 0.022000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;21:32:14&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Broken in 0.023_000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;21:32:14&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 0.025_001 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;21:32:15&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 0.026000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;11&nbsp;01:44:38&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We&#39;ve had a few days of cpantesters results on the offical version, as
well as a total lunar eclipse.  The auguries all looking well, I am
closing this bug as resolved.

Many thanks to Tomáš Jirotka for an excellent bug report.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;11&nbsp;01:44:39&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;11&nbsp;05:13:03&nbsp;2011</span>
    <span class="description">tomas.jirotka [...] gooddata.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72869] Error when two empty rules are in a row</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 11 Dec 2011 11:12:51 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Marpa-XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomáš Jirotka &lt;tomas.jirotka [...] gooddata.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jeffrey, thank you very much for your speedy response and fix of the bug!

Tomáš Jirotka


On Dec 11, 2011, at 7:44 AM, Jeffrey Kegler via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72869">https://rt.cpan.org/Ticket/Display.html?id=72869</a></span> &gt;
&gt; 
&gt; We&#39;ve had a few days of cpantesters results on the offical version, as
&gt; well as a total lunar eclipse.  The auguries all looking well, I am
&gt; closing this bug as resolved.
&gt; 
&gt; Many thanks to Tomáš Jirotka for an excellent bug report.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;11&nbsp;05:13:03&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;20&nbsp;23:20:39&nbsp;2011</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
