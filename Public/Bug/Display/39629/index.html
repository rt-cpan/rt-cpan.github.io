<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #39629 for Compress-Zlib: gzopen fails on Apache::Upload</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #39629 for Compress-Zlib: gzopen fails on Apache::Upload</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Compress-Zlib">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Compress-Zlib">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Compress-Zlib">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Compress-Zlib">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Compress-Zlib">Compress-Zlib CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">39629</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Compress-Zlib">Compress-Zlib</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
~yaph/cpan/pause/{nospam}/08-02-26 [...] rainbow.in-berlin.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-7580-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.003    </td>
  </tr>
  <tr id="CF-7581-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=39629">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-512962" href="/Public/Bug/Display.html?id=39629#txn-512962">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;26&nbsp;09:25:21&nbsp;2008</span>
    <span class="description">~yaph/cpan/pause/{nospam}/08-02-26 [...] rainbow.in-berlin.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> gzopen fails on Apache::Upload</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/512962/255449/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/255449">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 505b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">my $r = Apache-&gt;request;
my $apr = Apache::Request-&gt;new &#40;$r&#41;;
my $upload = $apr-&gt;upload &#40;&#39;logfile&#39;&#41;;
my $fh = $upload-&gt;fh;
my $fhz = gzopen &#40;$fh, &#39;rb&#39;&#41;;

dies in the gzopen with &#34;[Fri Sep 26 12:13:04 2008] [error] Can&#39;t locate
object method &#34;read&#34; via package &#34;Apache::Upload&#34; at
/usr/lib/perl5/vendor_perl/5.8.5/IO/Uncompress/Base.pm line 68.\n at [...]&#34;

this is within mod_perl.
Apache::Request, of which Apache::Upload is a part, is version 1.33.

downgrading to Compress::Zlib 1.42 fixed it for me...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-514061" href="/Public/Bug/Display.html?id=39629#txn-514061">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;06:35:15&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/514061/256139/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/256139">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 702b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 26 09:25:21 2008, RJOOP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; my $r = Apache-&gt;request;
&gt; my $apr = Apache::Request-&gt;new &#40;$r&#41;;
&gt; my $upload = $apr-&gt;upload &#40;&#39;logfile&#39;&#41;;
&gt; my $fh = $upload-&gt;fh;
&gt; my $fhz = gzopen &#40;$fh, &#39;rb&#39;&#41;;
&gt; 
&gt; dies in the gzopen with &#34;[Fri Sep 26 12:13:04 2008] [error] Can&#39;t locate
&gt; object method &#34;read&#34; via package &#34;Apache::Upload&#34; at
&gt; /usr/lib/perl5/vendor_perl/5.8.5/IO/Uncompress/Base.pm line 68.\n at
</div>[...]&#34;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; this is within mod_perl.
&gt; Apache::Request, of which Apache::Upload is a part, is version 1.33.
&gt; 
&gt; downgrading to Compress::Zlib 1.42 fixed it for me...
</div>
Hi Robert, thanks for the bug report. I&#39;ll install mod_perl and have a dig. 

What version of mod_perl are you running?

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-514062" href="/Public/Bug/Display.html?id=39629#txn-514062">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;06:35:16&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-514126" href="/Public/Bug/Display.html?id=39629#txn-514126">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;09:47:52&nbsp;2008</span>
    <span class="description">~yaph/cpan/pause/{nospam}/08-02-26 [...] rainbow.in-berlin.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/514126/256182/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/256182">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 267b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 29 06:35:15 2008, PMQS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What version of mod_perl are you running?
</div>
hi paul, thanks for investigating!

it&#39;s an apache 1.3.37 with mod_perl compiled in which does not provide
this information, but a strings&#40;1&#41; on the binary reveals &#34;mod_perl/1.29&#34;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-514179" href="/Public/Bug/Display.html?id=39629#txn-514179">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;11:13:39&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/514179/256215/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/256215">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 398b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 29 09:47:52 2008, RJOOP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Sep 29 06:35:15 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; What version of mod_perl are you running?
</div>&gt; 
&gt; hi paul, thanks for investigating!
&gt; 
&gt; it&#39;s an apache 1.3.37 with mod_perl compiled in which does not provide
&gt; this information, but a strings&#40;1&#41; on the binary reveals &#34;mod_perl/1.29&#34;.
</div>
OK, thanks. I&#39;ll see if I can reproduce the error with that version.

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-516046" href="/Public/Bug/Display.html?id=39629#txn-516046">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;04&nbsp;12:07:09&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/516046/257322/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/257322">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 29 11:13:39 2008, PMQS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Sep 29 09:47:52 2008, RJOOP wrote:
<div class="message-stanza open">&gt; &gt; On Mon Sep 29 06:35:15 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; &gt; What version of mod_perl are you running?
</div>&gt; &gt; 
&gt; &gt; hi paul, thanks for investigating!
&gt; &gt; 
&gt; &gt; it&#39;s an apache 1.3.37 with mod_perl compiled in which does not provide
&gt; &gt; this information, but a strings&#40;1&#41; on the binary reveals
</div></div>&#34;mod_perl/1.29&#34;.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; OK, thanks. I&#39;ll see if I can reproduce the error with that version.
</div>
I found some time to check into the problem. Turns out it can be
reproduced without using gzopen. For example, this handler is enough to
highlight the issue

sub handler {
  my $r = shift;

  $r-&gt;send_http_header&#40;&#39;text/plain&#39;&#41;;

  my $apr = Apache::Request-&gt;new &#40;$r&#41;;

  my $upload = $apr-&gt;upload;
  my $fh = $upload-&gt;fh;
  my $status = $fh-&gt;read&#40;$buffer, 20&#41;;
}

It will fail on the $fh-&gt;read line.
This is because the filehandle that Apache::Request::upload returns does
not inherit from IO::Handle.

If you add this to the handler 

    @Apache::Upload::ISA = qw&#40;IO::Handle&#41;;

It sorts out the problem.

I&#39;ll report this to the Apache::Reader author.

cheers
Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-516586" href="/Public/Bug/Display.html?id=39629#txn-516586">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;11:37:13&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/516586/257612/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/257612">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Oct 04 12:07:09 2008, PMQS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Sep 29 11:13:39 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; On Mon Sep 29 09:47:52 2008, RJOOP wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Mon Sep 29 06:35:15 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; What version of mod_perl are you running?
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; hi paul, thanks for investigating!
&gt; &gt; &gt; 
&gt; &gt; &gt; it&#39;s an apache 1.3.37 with mod_perl compiled in which does not provide
&gt; &gt; &gt; this information, but a strings&#40;1&#41; on the binary reveals
</div></div>&gt; &#34;mod_perl/1.29&#34;.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; OK, thanks. I&#39;ll see if I can reproduce the error with that version.
</div>&gt; 
&gt; I found some time to check into the problem. Turns out it can be
&gt; reproduced without using gzopen. For example, this handler is enough to
&gt; highlight the issue
&gt; 
&gt; sub handler {
&gt;   my $r = shift;
&gt; 
&gt;   $r-&gt;send_http_header&#40;&#39;text/plain&#39;&#41;;
&gt; 
&gt;   my $apr = Apache::Request-&gt;new &#40;$r&#41;;
&gt; 
&gt;   my $upload = $apr-&gt;upload;
&gt;   my $fh = $upload-&gt;fh;
&gt;   my $status = $fh-&gt;read&#40;$buffer, 20&#41;;
&gt; }
&gt; 
&gt; It will fail on the $fh-&gt;read line.
&gt; This is because the filehandle that Apache::Request::upload returns does
&gt; not inherit from IO::Handle.
&gt; 
&gt; If you add this to the handler 
&gt; 
&gt;     @Apache::Upload::ISA = qw&#40;IO::Handle&#41;;
&gt; 
&gt; It sorts out the problem.
&gt; 
&gt; I&#39;ll report this to the Apache::Reader author.
&gt; 
&gt; cheers
&gt; Paul
&gt; 
</div>
Alternatively, forcing the $fh into a IO::Handle could also help.
Something like this:

    $fh = IO::Handle-&gt;new_from_fd&#40;fileno&#40;$fh&#41;, &#34;r&#34;&#41; unless
UNIVERSAL::isa&#40;$fh, &#34;IO::Handle&#34;&#41;; # or UNIVERSAL::can&#40;$fh, &#34;read&#34;&#41;

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-516823" href="/Public/Bug/Display.html?id=39629#txn-516823">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;03:20:55&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/516823/257773/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/257773">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 06 11:37:13 2008, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Oct 04 12:07:09 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; On Mon Sep 29 11:13:39 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Mon Sep 29 09:47:52 2008, RJOOP wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; On Mon Sep 29 06:35:15 2008, PMQS wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; What version of mod_perl are you running?
</div>&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; hi paul, thanks for investigating!
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; it&#39;s an apache 1.3.37 with mod_perl compiled in which does not 
</div></div></div></div>provide
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; this information, but a strings&#40;1&#41; on the binary reveals
</div></div>&gt; &gt; &#34;mod_perl/1.29&#34;.
<div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; OK, thanks. I&#39;ll see if I can reproduce the error with that 
</div></div></div>version.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; I found some time to check into the problem. Turns out it can be
&gt; &gt; reproduced without using gzopen. For example, this handler is 
</div></div>enough to
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; highlight the issue
&gt; &gt; 
&gt; &gt; sub handler {
&gt; &gt;   my $r = shift;
&gt; &gt; 
&gt; &gt;   $r-&gt;send_http_header&#40;&#39;text/plain&#39;&#41;;
&gt; &gt; 
&gt; &gt;   my $apr = Apache::Request-&gt;new &#40;$r&#41;;
&gt; &gt; 
&gt; &gt;   my $upload = $apr-&gt;upload;
&gt; &gt;   my $fh = $upload-&gt;fh;
&gt; &gt;   my $status = $fh-&gt;read&#40;$buffer, 20&#41;;
&gt; &gt; }
&gt; &gt; 
&gt; &gt; It will fail on the $fh-&gt;read line.
&gt; &gt; This is because the filehandle that Apache::Request::upload returns 
</div></div>does
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; not inherit from IO::Handle.
&gt; &gt; 
&gt; &gt; If you add this to the handler 
&gt; &gt; 
&gt; &gt;     @Apache::Upload::ISA = qw&#40;IO::Handle&#41;;
&gt; &gt; 
&gt; &gt; It sorts out the problem.
&gt; &gt; 
&gt; &gt; I&#39;ll report this to the Apache::Reader author.
&gt; &gt; 
&gt; &gt; cheers
&gt; &gt; Paul
&gt; &gt; 
</div>&gt; 
&gt; Alternatively, forcing the $fh into a IO::Handle could also help.
&gt; Something like this:
&gt; 
&gt;     $fh = IO::Handle-&gt;new_from_fd&#40;fileno&#40;$fh&#41;, &#34;r&#34;&#41; unless
&gt; UNIVERSAL::isa&#40;$fh, &#34;IO::Handle&#34;&#41;; # or UNIVERSAL::can&#40;$fh, &#34;read&#34;&#41;
</div>
Indeed so, and that is the way I would recommend working around the 
problem until it is fixed.

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-517075" href="/Public/Bug/Display.html?id=39629#txn-517075">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;12:39:33&nbsp;2008</span>
    <span class="description">~yaph/cpan/pause/{nospam}/08-02-26 [...] rainbow.in-berlin.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/517075/257960/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/257960">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 177b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">thank you both for shedding light on this!

shall we keep this ticket open till it is resolved one way or another
and to let other people easily find the workaround you suggest?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-517328" href="/Public/Bug/Display.html?id=39629#txn-517328">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;04:42:03&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/517328/258100/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/258100">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 270b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 07 12:39:33 2008, RJOOP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; thank you both for shedding light on this!
&gt; 
&gt; shall we keep this ticket open till it is resolved one way or another
&gt; and to let other people easily find the workaround you suggest?
</div>
I&#39;ll let it stay open for a while. 

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1413342" href="/Public/Bug/Display.html?id=39629#txn-1413342">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;21&nbsp;06:18:01&nbsp;2014</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.59608</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
