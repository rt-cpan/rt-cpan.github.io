<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42097 for version: new use syntax suggestion</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42097 for version: new use syntax suggestion</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/version/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/version/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/version/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/version/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/version">version CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42097</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/version/Active/">version</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kentfredric [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-34940-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.76    </td>
  </tr>
  <tr id="CF-34941-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;02&nbsp;07:21:07&nbsp;2009</span>
    <span class="description">kentfredric [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> new use syntax suggestion</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have proposed a new/alternative notation for injecting version data
into a class file. 

Old: 

use version; 
$VERSION = qv&#40;&#39;1.1.1&#39;&#41;; 


New: 
use version our=&gt;&#39;1.1.1&#39;; 

Attached is the modified version.pm. 

Note, I would usually have applied a patch, but I also ran this through
tidy and tried my best to get it as critic friendly as possible, which
does kind-of result in almost 90% difference anyway. 

Also created a few functions to make the core logic easier to understand. 

-- 
Example Usage: 

use version 0.76 our=&gt;&#39;1.1.1&#39;; 
print $VERSION; # 1.1.1
print qv&#40;&#39;1.1.1&#39;&#41;; # doesn&#39;t work. 


use version 0.76;
print $VERSION; # doesn&#39;t work
print qv&#40;&#39;1.1.1&#39;&#41;; # doesn&#39;t work. 


use version 0.76 &#39;qv&#39;, our=&gt;&#39;1.1.1&#39;; 
print $VERSION; # 1.1.1 
print qv&#40;&#39;1.1.1&#39;&#41;; # 1.1.1
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> version.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl -w
package version;

use 5.006;
use strict;

use vars qw&#40;@ISA $VERSION $CLASS *qv&#41;;

$VERSION = 0.76;

$CLASS = &#39;version&#39;;

eval &#34;use version::vxs $VERSION&#34;;
if &#40;$@&#41; {    # don&#39;t have the XS version installed
    eval &#34;use version::vpp $VERSION&#34;;    # don&#39;t tempt fate
    die &#34;$@&#34; if &#40;$@&#41;;
    push @ISA, &#39;version::vpp&#39;;
    ## no critic &#40; Warnings &#41;
    no warnings;
    *version::qv = \&#38;version::vpp::qv;
    if &#40; $] &gt; 5.009001 &#38;&#38; $] &lt;= 5.010000 &#41; {
        ## no critic &#40; Stricture &#41;
        no strict &#39;refs&#39;;
        *{&#39;version::stringify&#39;} = \*version::vpp::stringify;
        *{&#39;version::&#40;&#34;&#34;&#39;}       = \*version::vpp::stringify;
    }
}
else {    # use XS module
    push @ISA, &#34;version::vxs&#34;;
    ## no critic &#40; Warnings &#41;
    no warnings;
    *version::qv = \&#38;version::vxs::qv;
    if &#40; $] &gt; 5.009001 &#38;&#38; $] &lt;= 5.010000 &#41; {
        ## no critic &#40; Stricture &#41;
        no strict &#39;refs&#39;;
        *{&#39;version::stringify&#39;} = \*version::vxs::stringify;
        *{&#39;version::&#40;&#34;&#34;&#39;}       = \*version::vxs::stringify;
    }
}

#
# version::_inject_version&#40; $version_classname, $target_package, $version_string &#41;;
#
sub _inject_version {
    ## no critic &#40; Stricture &#41;
    my &#40; $class, $package, $version &#41; = @_;
    my $v = bless version::qv&#40;$version&#41;, $class;
    no strict &#39;refs&#39;;
    *{ $package . &#39;::VERSION&#39; } = \$v;
    return $v;
}

#
# version::_has_qv&#40; $package &#41;;
#
sub _has_qv {
    ## no critic &#40; Stricture &#41;
    my &#40;@args&#41;    = @_;
    my &#40;$package&#41; = shift @args;
    no strict &#39;refs&#39;;
    return defined &#38;{ $package . &#39;::qv&#39; };
}

sub _inject_qv {
    ## no critic &#40; Stricture &#41;
    my &#40; $class, $package &#41; = @_;
    no strict &#39;refs&#39;;
    *{ $package . &#39;::qv&#39; } = sub {
        return bless version::qv&#40; shift @_ &#41;, $class;
    };
    return 1;
}

# Preloaded methods go here.
sub import {
    my &#40;@args&#41;    = @_;
    my &#40;$class&#41;   = shift @args;
    my &#40;$callpkg&#41; = caller;

    if &#40; not @args and not _has_qv&#40;$callpkg&#41; &#41; {
        _inject_qv&#40; $class, $callpkg &#41;;
        return;
    }

    for my $i &#40; 0 .. $#args &#41; {
        my $j = $args[$i];
        if &#40; &#34;$j&#34; eq &#39;qv&#39; and not _has_qv&#40;$callpkg&#41; &#41; {
            _inject_qv&#40; $class, $callpkg &#41;;
        }
        if &#40; &#34;$j&#34; eq &#39;our&#39; and defined $args[ $i + 1 ] &#41; {
            _inject_version&#40; $class, $callpkg, $args[ $i + 1 ] &#41;;
        }
    }
    return 1;
}

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;04&nbsp;07:48:24&nbsp;2009</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I appreciate the effort you took on this patch, but I have to reject the
syntax suggested.  I considered just this sort of syntax early in the
development of version.pm, but ultimately rejected it because it was too
magical.  This proposed syntax creates a package global which doesn&#39;t
actually appear in the source code, but rather just gets stuffed into
the class namespace.

The other consideration at this point is that version.pm ships as part
of the Perl 5.10.0 core, so I don&#39;t want to change the API unless it is
to fix a bug.  While I _can_ produce a CPAN release which updates bits
of the core code, I would rather not do so, since it will lead to
unpatched code having different behavior than patched.

Finally, there are a few important modules which rely on complicated
regex scanning to determine a module $VERSION without actually loading
the module, specifically ExtUtils::MakeMaker, Module::Build, and the
PAUSE indexer.  There may be others.  Both M::B and PAUSE have been
upgraded to use version.pm &#34;under the hood&#34; for their version comparison
needs, and I have plans to make EU::MM similarly inclined.

I will take a look at the changes you made to make the code itself tidy
and critic friendly, and apply those if it makes sense.

Thanks for your interest in version.pm, though.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;04&nbsp;07:48:25&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;04&nbsp;07:48:26&nbsp;2009</span>
    <span class="description">jpeacock [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
