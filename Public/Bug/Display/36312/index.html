<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #36312 for CGI: Needs Confirmation: PATCH: Also consider REDIRECT_QUERY_STRING in mod_perl</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #36312 for CGI: Needs Confirmation: PATCH: Also consider REDIRECT_QUERY_STRING in mod_perl</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/leejo/CGI.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI">CGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">36312</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI/Active/">CGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bitcard [...] purplefoot.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-230860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;30&nbsp;18:40:44&nbsp;2008</span>
    <span class="description">bitcard [...] purplefoot.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Potential bug with init function</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So in init there is this code:

      # If method is GET or HEAD, fetch the query from
      # the environment.
      if &#40;$meth=~/^&#40;GET|HEAD&#41;$/&#41; {
          if &#40;$MOD_PERL&#41; {
            $query_string = $self-&gt;r-&gt;args;
          } else {
              $query_string = $ENV{&#39;QUERY_STRING&#39;} if defined
$ENV{&#39;QUERY_STRING&#39;};
              $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
$ENV{&#39;REDIRECT_QUERY_STRING&#39;};
          }
          last METHOD;
      }

Due to internal redirects I was losing the form in mod_perl.  I created
an override library for myself this has this change which fixed the issue:

      # If method is GET or HEAD, fetch the query from
      # the environment.
      if &#40;$meth=~/^&#40;GET|HEAD&#41;$/&#41; {
          if &#40;$MOD_PERL&#41; {
            $query_string = $self-&gt;r-&gt;args;
            $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
$ENV{&#39;REDIRECT_QUERY_STRING&#39;} &#38;&#38; $query_string eq &#39;&#39;;
          } else {
              $query_string = $ENV{&#39;QUERY_STRING&#39;} if defined
$ENV{&#39;QUERY_STRING&#39;};
              $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
$ENV{&#39;REDIRECT_QUERY_STRING&#39;};
          }
          last METHOD;
      }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;16:55:47&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Subject changed from &#39;Potential bug with init function&#39; to &#39;PATCH: Also consider REDIRECT_QUERY_STRING in mod_perl&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;16:58:30&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 30 18:40:44 2008, wetnun wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So in init there is this code:
&gt; 
&gt;       # If method is GET or HEAD, fetch the query from
&gt;       # the environment.
&gt;       if &#40;$meth=~/^&#40;GET|HEAD&#41;$/&#41; {
&gt;           if &#40;$MOD_PERL&#41; {
&gt;             $query_string = $self-&gt;r-&gt;args;
&gt;           } else {
&gt;               $query_string = $ENV{&#39;QUERY_STRING&#39;} if defined
&gt; $ENV{&#39;QUERY_STRING&#39;};
&gt;               $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;};
&gt;           }
&gt;           last METHOD;
&gt;       }
&gt; 
&gt; Due to internal redirects I was losing the form in mod_perl.  I created
&gt; an override library for myself this has this change which fixed the issue:
&gt; 
&gt;       # If method is GET or HEAD, fetch the query from
&gt;       # the environment.
&gt;       if &#40;$meth=~/^&#40;GET|HEAD&#41;$/&#41; {
&gt;           if &#40;$MOD_PERL&#41; {
&gt;             $query_string = $self-&gt;r-&gt;args;
&gt;             $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;} &#38;&#38; $query_string eq &#39;&#39;;
&gt;           } else {
&gt;               $query_string = $ENV{&#39;QUERY_STRING&#39;} if defined
&gt; $ENV{&#39;QUERY_STRING&#39;};
&gt;               $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;};
&gt;           }
&gt;           last METHOD;
&gt;       }
</div>

I have peer-reviewed this patch and recommend that it be accepted.
However, it adds the same line both the &#34;if&#34; and &#34;else&#34; clause. To
reduce code duplication, I would implement the fix by moving this line
from the &#34;else&#34; to below the if/else clause:

$query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
$ENV{&#39;REDIRECT_QUERY_STRING&#39;};
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;16:58:31&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;27&nbsp;00:45:26&nbsp;2009</span>
    <span class="description">jon [...] purplefoot.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #36312] PATCH: Also consider REDIRECT_QUERY_STRING in mod_perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 26 Jul 2009 21:43:59 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI.pm [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jon Stephens &lt;jon [...] purplefoot.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sounds good to me.  :&#41;


MARKSTOS via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=36312">https://rt.cpan.org/Ticket/Display.html?id=36312</a></span> &gt;
&gt;
&gt; On Fri May 30 18:40:44 2008, wetnun wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; So in init there is this code:
&gt;&gt;
&gt;&gt;       # If method is GET or HEAD, fetch the query from
&gt;&gt;       # the environment.
&gt;&gt;       if &#40;$meth=~/^&#40;GET|HEAD&#41;$/&#41; {
&gt;&gt;           if &#40;$MOD_PERL&#41; {
&gt;&gt;             $query_string = $self-&gt;r-&gt;args;
&gt;&gt;           } else {
&gt;&gt;               $query_string = $ENV{&#39;QUERY_STRING&#39;} if defined
&gt;&gt; $ENV{&#39;QUERY_STRING&#39;};
&gt;&gt;               $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt;&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;};
&gt;&gt;           }
&gt;&gt;           last METHOD;
&gt;&gt;       }
&gt;&gt;
&gt;&gt; Due to internal redirects I was losing the form in mod_perl.  I created
&gt;&gt; an override library for myself this has this change which fixed the issue:
&gt;&gt;
&gt;&gt;       # If method is GET or HEAD, fetch the query from
&gt;&gt;       # the environment.
&gt;&gt;       if &#40;$meth=~/^&#40;GET|HEAD&#41;$/&#41; {
&gt;&gt;           if &#40;$MOD_PERL&#41; {
&gt;&gt;             $query_string = $self-&gt;r-&gt;args;
&gt;&gt;             $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt;&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;} &#38;&#38; $query_string eq &#39;&#39;;
&gt;&gt;           } else {
&gt;&gt;               $query_string = $ENV{&#39;QUERY_STRING&#39;} if defined
&gt;&gt; $ENV{&#39;QUERY_STRING&#39;};
&gt;&gt;               $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt;&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;};
&gt;&gt;           }
&gt;&gt;           last METHOD;
&gt;&gt;       }
&gt;&gt;     
</div>&gt;
&gt;
&gt; I have peer-reviewed this patch and recommend that it be accepted.
&gt; However, it adds the same line both the &#34;if&#34; and &#34;else&#34; clause. To
&gt; reduce code duplication, I would implement the fix by moving this line
&gt; from the &#34;else&#34; to below the if/else clause:
&gt;
&gt; $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;};
&gt; ------------------------------------------------------------------------
&gt;
&gt;
&gt; No virus found in this incoming message.
&gt; Checked by AVG - www.avg.com 
&gt; Version: 8.5.375 / Virus Database: 270.13.29/2261 - Release Date: 07/25/09 05:58:00
&gt;
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;31&nbsp;05:23:25&nbsp;2009</span>
    <span class="description">burak [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">25 Tem. 2009 Cmt., 16:58:30 tarihinde, MARKSTOS yazdı:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have peer-reviewed this patch and recommend that it be accepted.
&gt; However, it adds the same line both the &#34;if&#34; and &#34;else&#34; clause. To
&gt; reduce code duplication, I would implement the fix by moving this line
&gt; from the &#34;else&#34; to below the if/else clause:
&gt; 
&gt; $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;};
</div>
I&#39;m not so sure about this. I&#39;ve experienced a similar issue with 
redirects &#40;and it took a while to realise that multiple redirects can 
happen&#41; and can say that this is an apache specific issue and the 
parameter gets &#34;REDIRECT_&#34; prefix everytime a redirect occurs. So, if 
it&#39;s redirected again, it&#39;ll be &#34;REDIRECT_REDIRECT_QUERY_STRING&#34;. The 
code should check for $ENV{ qr/REDIRECT_ .* QUERY_STRING/ } &#40;pseudo 
code&#41; or should not check it at all.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;31&nbsp;09:21:28&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 31 05:23:25 2009, BURAK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 25 Tem. 2009 Cmt., 16:58:30 tarihinde, MARKSTOS yazdı:
&gt; 
<div class="message-stanza open">&gt; &gt; I have peer-reviewed this patch and recommend that it be accepted.
&gt; &gt; However, it adds the same line both the &#34;if&#34; and &#34;else&#34; clause. To
&gt; &gt; reduce code duplication, I would implement the fix by moving this line
&gt; &gt; from the &#34;else&#34; to below the if/else clause:
&gt; &gt; 
&gt; &gt; $query_string ||= $ENV{&#39;REDIRECT_QUERY_STRING&#39;} if defined
&gt; &gt; $ENV{&#39;REDIRECT_QUERY_STRING&#39;};
</div>&gt; 
&gt; I&#39;m not so sure about this. I&#39;ve experienced a similar issue with 
&gt; redirects &#40;and it took a while to realise that multiple redirects can 
&gt; happen&#41; and can say that this is an apache specific issue and the 
&gt; parameter gets &#34;REDIRECT_&#34; prefix everytime a redirect occurs. So, if 
&gt; it&#39;s redirected again, it&#39;ll be &#34;REDIRECT_REDIRECT_QUERY_STRING&#34;. The 
&gt; code should check for $ENV{ qr/REDIRECT_ .* QUERY_STRING/ } &#40;pseudo 
&gt; code&#41; or should not check it at all.
</div>
Thanks for the input. Is there a link to Apache documentation which
confirms this, or is there another way to confirm the REDIRECT_*
behavior? It would be useful to know for example how many redirects it
will do before it gives up. 

  Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;31&nbsp;22:16:59&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Subject changed from &#39;PATCH: Also consider REDIRECT_QUERY_STRING in mod_perl&#39; to &#39;Needs Confirmation: PATCH: Also consider REDIRECT_QUERY_STRING in mod_perl&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;01&nbsp;23:29:51&nbsp;2009</span>
    <span class="description">burak [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">31 Tem. 2009 Cum., 09:21:28 tarihinde, MARKSTOS yazdı:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the input. Is there a link to Apache documentation which
&gt; confirms this, or is there another way to confirm the REDIRECT_*
&gt; behavior? It would be useful to know for example how many redirects it
&gt; will do before it gives up. 
&gt; 
&gt;   Mark
</div>
There is this documentation, but it does not discuss multiple 
redirects: <span class="clickylink"><a target="new" rel="nofollow" href="http://httpd.apache.org/docs/2.0/en/custom-error.html">http://httpd.apache.org/docs/2.0/en/custom-error.html</a></span>

However, it says: &#34;A new batch of environment variables will be 
initialized for use by a script which has been redirected to. Each new 
variable will have the prefix REDIRECT_. REDIRECT_ environment 
variables are created from the CGI environment variables which existed 
prior to the redirect, they are renamed with a REDIRECT_ prefix, ...&#34;.

So, if a redirect occurs %ENV will be renamed to have that prefix. If a 
second redirect occurs, it&#39;ll be REDIRECT_REDIRECT_ and if it&#39;s more 
then we can say &#39;REDIRECT_&#39; x $n :&#41;

I can confirm that two level redirects can happen tho. How deep this 
goes? this I don&#39;t have a clue. Maybe asking in the apache mailing list 
or something will help.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;23&nbsp;21:24:19&nbsp;2013</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I would like to make the CGI and mod_perl symmetric here, but I&#39;m not 
interested in supporting N levels of redirect. 

From reading more of the mod_perl docs, I think the more mod_perl&#39;ish 
thing to be might be to use the &#34;prev&#34; method to get a possible previous 
request object in the redirect cycle. So the proposed code would be 
something like this for mod_perl:

  $query_string = $self-&gt;r-&gt;args || $self-&gt;r-&gt;prev-&gt;args;

Anyone care to test out variations of that under mod_perl, with and 
without redirects in play?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;08:03:56&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This issue has been copied to: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/leejo/CGI.pm/issues/55">https://github.com/leejo/CGI.pm/issues/55</a></span> please take all future correspondence there.
This ticket will remain open but please do not reply here.
This ticket will be closed when the github issue is dealt with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;14:28:02&nbsp;2014</span>
    <span class="description">The RT System itself -  Queue changed from CGI.pm to CGI</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;14&nbsp;14:55:48&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have gone with both solutions here. If under mod_perl2 then we will try to use the -&gt;prev method. Since this is a mod_perl2-ism only, i.e. not mod_perl1.* then i have also added support for getting the query string from the REDIRECT_ env variables, which will support up to 5 redirects.

Will go out in the next release. Thanks!

commit 1079337db6b05beb3c564c980f4262700b571eb9
Author: Lee Johnson &lt;lee@givengain.ch&gt;
Date:   Sat Jun 14 20:48:44 2014 +0200

    resolve #55 [rt.cpan.org #36312] - redirect query string

    handling, specifically with mod_perl2 - use the -&gt;prev method of
    the Apache::RequestUtil object to get at the *previous* request
    object and thus its env variables for getting the query string

    in theory this would support an unlimited number of redirects as
    the next redirect will always pass on the details from the previous
    redirect

    this is mod_perl2 only, i cannot see this in Apache-&gt;request so it
    does not appear to be supported in mod_perl1.*. To get around this
    use the REDIRECT_ env variable for up to 5 redirects, this also
    handles up to 5 redirects when not running under mod perl.

    the logic to get the query string from the ENV has been split into
    its own method to remove duplication, and a test has been added.
    currently there are no tests for mod_perl, Apache, Apache2 use here,
    but i don&#39;t see any tests at all for any parts of the code using
    these modules given i don&#39;t have them installed and all the tests
    currently pass &#40;the Apache/Apache2 modules are runtime requires
    so not hard dependencies&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;14&nbsp;14:55:50&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
