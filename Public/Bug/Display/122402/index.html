<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #122402 for Prty: Ipc.t fails on some systems without diagnostics</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #122402 for Prty: Ipc.t fails on some systems without diagnostics</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Prty/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Prty/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Prty/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Prty/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Prty">Prty CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">122402</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Prty/Active/">Prty</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-264598-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.115    </td>
  </tr>
  <tr id="CF-264599-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;09&nbsp;04:46:06&nbsp;2017</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Ipc.t fails on some systems without diagnostics</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On some of my smoker systems &#40;centos6, debian jessie, freebsd&#41; I see the following failure, without any further diagnostics:

...
t/bin/Prty/Ipc.t ................................ 
Failed 2/4 subtests 
...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;09&nbsp;07:20:01&nbsp;2017</span>
    <span class="description">fs [...] fseitz.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #122402] Ipc.t fails on some systems without diagnostics</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Jul 2017 13:19:46 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prty [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Frank Seitz &lt;fs [...] fseitz.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hallo Slaven,

kannst du mir von einem dieser Systeme die Ausgabe
des folgenden Kommandos senden?

$ prove -v -Ilib t/bin/Prty/Ipc.t

Grüße
Frank

On 07/09/2017 10:46 AM, Slaven_Rezic via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sun Jul 09 04:46:06 2017: Request 122402 was acted upon.
&gt; Transaction: Ticket created by SREZIC
&gt;         Queue: Prty
&gt;       Subject: Ipc.t fails on some systems without diagnostics
&gt;     Broken in: 1.115
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: SREZIC@cpan.org
&gt;        Status: new
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122402">https://rt.cpan.org/Ticket/Display.html?id=122402</a></span> &gt;
&gt;
&gt;
&gt; On some of my smoker systems &#40;centos6, debian jessie, freebsd&#41; I see the following failure, without any further diagnostics:
&gt;
&gt; ...
&gt; t/bin/Prty/Ipc.t ................................
&gt; Failed 2/4 subtests
&gt; ...
</div>
-- 
Dipl.-Inform. Frank Seitz
IT Consultant / {Web, Database, Linux} Developer
Tel: +49-176-78243503, Hauptstr. 32-34, D-25462 Rellingen

Blog: <span class="clickylink"><a target="new" rel="nofollow" href="http://fseitz.de/blog">http://fseitz.de/blog</a></span>
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;09&nbsp;07:20:02&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;09&nbsp;09:33:28&nbsp;2017</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Auf einem CentOS6-System:

$ /opt/perl-5.22.3/bin/prove -v -Ilib t/bin/Prty/Ipc.t  
t/bin/Prty/Ipc.t .. 
1..4
ok 1 - use Prty::Ipc;
ok 2
Failed 2/4 subtests 

Test Summary Report
-------------------
t/bin/Prty/Ipc.t &#40;Wstat: 13 Tests: 2 Failed: 0&#41;
  Non-zero wait status: 13
  Parse errors: Bad plan.  You planned 4 tests but ran 2.
Files=1, Tests=2,  0 wallclock secs &#40; 0.02 usr  0.01 sys +  0.08 cusr  0.04 csys =  0.15 CPU&#41;
Result: FAIL

Signal 13 ist SIGPIPE.

Dummerweise ist es ein Heisenbug: sobald ich versuche, mit strace reinzuschauen, läuft der Test erfolgreich durch.

Vermutlich ein Timing-Problem; eventuell läuft das externe Kommando zu langsam oder zu schnell.

On 2017-07-09 07:20:01, fs@fseitz.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hallo Slaven,
&gt; 
&gt; kannst du mir von einem dieser Systeme die Ausgabe
&gt; des folgenden Kommandos senden?
&gt; 
&gt; $ prove -v -Ilib t/bin/Prty/Ipc.t
&gt; 
&gt; Grüße
&gt; Frank
&gt; 
&gt; On 07/09/2017 10:46 AM, Slaven_Rezic via RT wrote:
<div class="message-stanza open">&gt; &gt; Sun Jul 09 04:46:06 2017: Request 122402 was acted upon.
&gt; &gt; Transaction: Ticket created by SREZIC
&gt; &gt;         Queue: Prty
&gt; &gt;       Subject: Ipc.t fails on some systems without diagnostics
&gt; &gt;     Broken in: 1.115
&gt; &gt;      Severity: &#40;no value&#41;
&gt; &gt;         Owner: Nobody
&gt; &gt;    Requestors: SREZIC@cpan.org
&gt; &gt;        Status: new
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122402">https://rt.cpan.org/Ticket/Display.html?id=122402</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On some of my smoker systems &#40;centos6, debian jessie, freebsd&#41; I see
&gt; &gt; the following failure, without any further diagnostics:
&gt; &gt;
&gt; &gt; ...
&gt; &gt; t/bin/Prty/Ipc.t ................................
&gt; &gt; Failed 2/4 subtests
&gt; &gt; ...
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;09&nbsp;09:36:47&nbsp;2017</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mit strace bekommt man einen Fehler nur, wenn man -f weglässt. Damit sieht man leider nicht, was in den Kindprozessen passiert, aber immerhin. Die letzten Zeilen:

...

13:35:18.882051 fcntl&#40;13, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
13:35:18.882080 fcntl&#40;14, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000022&gt;
13:35:18.882140 rt_sigprocmask&#40;SIG_SETMASK, ~[RTMIN RT_1], [], 8&#41; = 0 &lt;0.000009&gt;
13:35:18.882181 clone&#40;child_stack=0, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f06386a49d0&#41; = 13563 &lt;0.003322&gt;
13:35:18.885560 rt_sigprocmask&#40;SIG_SETMASK, [], NULL, 8&#41; = 0 &lt;0.000010&gt;
13:35:18.885632 close&#40;14&#41;               = 0 &lt;0.000010&gt;
13:35:18.885720 read&#40;13, &#34;&#34;, 8192&#41;      = 0 &lt;0.001494&gt;
13:35:18.887310 close&#40;13&#41;               = 0 &lt;0.000014&gt;
13:35:18.887393 close&#40;3&#41;                = 0 &lt;0.000010&gt;
13:35:18.887445 close&#40;10&#41;               = 0 &lt;0.000010&gt;
13:35:18.887499 close&#40;12&#41;               = 0 &lt;0.000010&gt;
13:35:18.887627 write&#40;4, &#34;Ein Test&#34;, 8&#41; = 8 &lt;0.000025&gt;
13:35:18.887675 close&#40;4&#41;                = 0 &lt;0.000010&gt;
13:35:18.887707 fstat&#40;9, {st_mode=S_IFIFO|0600, st_size=0, ...}&#41; = 0 &lt;0.000010&gt;
13:35:18.887741 read&#40;9, &#34;Ein Test&#34;, 8192&#41; = 8 &lt;0.000129&gt;
13:35:18.887892 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=13563, si_status=0, si_utime=0, si_stime=0} ---
13:35:18.887912 read&#40;9, &#34;&#34;, 8192&#41;       = 0 &lt;0.000010&gt;
13:35:18.887941 close&#40;9&#41;                = 0 &lt;0.000011&gt;
13:35:18.887976 fstat&#40;11, {st_mode=S_IFIFO|0600, st_size=0, ...}&#41; = 0 &lt;0.000010&gt;
13:35:18.888009 read&#40;11, &#34;&#34;, 8192&#41;      = 0 &lt;0.000010&gt;
13:35:18.888041 close&#40;11&#41;               = 0 &lt;0.000010&gt;
13:35:18.888080 wait4&#40;13563, [{WIFEXITED&#40;s&#41; &#38;&#38; WEXITSTATUS&#40;s&#41; == 0}], 0, NULL&#41; = 13563 &lt;0.000013&gt;
13:35:18.888576 write&#40;5, &#34;ok 2\n&#34;, 5&#41;   = 5 &lt;0.000014&gt;
13:35:18.888756 pipe&#40;[3, 4]&#41;            = 0 &lt;0.000013&gt;
13:35:18.888799 ioctl&#40;3, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000010&gt;
13:35:18.888830 lseek&#40;3, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000010&gt;
13:35:18.888859 ioctl&#40;4, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000010&gt;
13:35:18.888888 lseek&#40;4, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000010&gt;
13:35:18.888915 fcntl&#40;3, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
13:35:18.888943 fcntl&#40;4, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
13:35:18.888977 pipe&#40;[9, 10]&#41;           = 0 &lt;0.000012&gt;
13:35:18.889009 ioctl&#40;9, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000010&gt;
13:35:18.889038 lseek&#40;9, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000009&gt;
13:35:18.889067 ioctl&#40;10, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000009&gt;
13:35:18.889095 lseek&#40;10, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000010&gt;
13:35:18.889122 fcntl&#40;9, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
13:35:18.889149 fcntl&#40;10, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
13:35:18.889182 pipe&#40;[11, 12]&#41;          = 0 &lt;0.000011&gt;
13:35:18.889214 ioctl&#40;11, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000009&gt;
13:35:18.889242 lseek&#40;11, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000010&gt;
13:35:18.889270 ioctl&#40;12, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000009&gt;
13:35:18.889298 lseek&#40;12, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000009&gt;
13:35:18.889325 fcntl&#40;11, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
13:35:18.889351 fcntl&#40;12, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
13:35:18.889382 pipe&#40;[13, 14]&#41;          = 0 &lt;0.000011&gt;
13:35:18.889412 ioctl&#40;13, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000010&gt;
13:35:18.889440 lseek&#40;13, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000009&gt;
13:35:18.889468 ioctl&#40;14, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL &#40;Invalid argument&#41; &lt;0.000009&gt;
13:35:18.889496 lseek&#40;14, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41; &lt;0.000009&gt;
13:35:18.889523 fcntl&#40;13, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
13:35:18.889550 fcntl&#40;14, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
13:35:18.889589 rt_sigprocmask&#40;SIG_SETMASK, ~[RTMIN RT_1], [], 8&#41; = 0 &lt;0.000010&gt;
13:35:18.889623 clone&#40;child_stack=0, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f06386a49d0&#41; = 13564 &lt;0.002480&gt;
13:35:18.892175 rt_sigprocmask&#40;SIG_SETMASK, [], NULL, 8&#41; = 0 &lt;0.000011&gt;
13:35:18.892247 close&#40;14&#41;               = 0 &lt;0.000010&gt;
13:35:18.892358 read&#40;13, &#34;&#34;, 8192&#41;      = 0 &lt;0.001207&gt;
13:35:18.893591 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=13564, si_status=1, si_utime=0, si_stime=0} ---
13:35:18.893632 close&#40;13&#41;               = 0 &lt;0.000012&gt;
13:35:18.893707 close&#40;3&#41;                = 0 &lt;0.000011&gt;
13:35:18.893747 close&#40;10&#41;               = 0 &lt;0.000010&gt;
13:35:18.893788 close&#40;12&#41;               = 0 &lt;0.000011&gt;
13:35:18.893912 write&#40;4, &#34;Ein Test&#34;, 8&#41; = -1 EPIPE &#40;Broken pipe&#41; &lt;0.000011&gt;
13:35:18.893959 --- SIGPIPE {si_signo=SIGPIPE, si_code=SI_USER, si_pid=13562, si_uid=1023} ---
13:35:18.895255 +++ killed by SIGPIPE +++


On 2017-07-09 09:33:28, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Auf einem CentOS6-System:
&gt; 
&gt; $ /opt/perl-5.22.3/bin/prove -v -Ilib t/bin/Prty/Ipc.t
&gt; t/bin/Prty/Ipc.t ..
&gt; 1..4
&gt; ok 1 - use Prty::Ipc;
&gt; ok 2
&gt; Failed 2/4 subtests
&gt; 
&gt; Test Summary Report
&gt; -------------------
&gt; t/bin/Prty/Ipc.t &#40;Wstat: 13 Tests: 2 Failed: 0&#41;
&gt;   Non-zero wait status: 13
&gt;   Parse errors: Bad plan.  You planned 4 tests but ran 2.
&gt; Files=1, Tests=2,  0 wallclock secs &#40; 0.02 usr  0.01 sys +  0.08 cusr
&gt; 0.04 csys =  0.15 CPU&#41;
&gt; Result: FAIL
&gt; 
&gt; Signal 13 ist SIGPIPE.
&gt; 
&gt; Dummerweise ist es ein Heisenbug: sobald ich versuche, mit strace
&gt; reinzuschauen, läuft der Test erfolgreich durch.
&gt; 
&gt; Vermutlich ein Timing-Problem; eventuell läuft das externe Kommando zu
&gt; langsam oder zu schnell.
&gt; 
&gt; On 2017-07-09 07:20:01, fs@fseitz.de wrote:
<div class="message-stanza open">&gt; &gt; Hallo Slaven,
&gt; &gt;
&gt; &gt; kannst du mir von einem dieser Systeme die Ausgabe
&gt; &gt; des folgenden Kommandos senden?
&gt; &gt;
&gt; &gt; $ prove -v -Ilib t/bin/Prty/Ipc.t
&gt; &gt;
&gt; &gt; Grüße
&gt; &gt; Frank
&gt; &gt;
&gt; &gt; On 07/09/2017 10:46 AM, Slaven_Rezic via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt; Sun Jul 09 04:46:06 2017: Request 122402 was acted upon.
&gt; &gt; &gt; Transaction: Ticket created by SREZIC
&gt; &gt; &gt;         Queue: Prty
&gt; &gt; &gt;       Subject: Ipc.t fails on some systems without diagnostics
&gt; &gt; &gt;     Broken in: 1.115
&gt; &gt; &gt;      Severity: &#40;no value&#41;
&gt; &gt; &gt;         Owner: Nobody
&gt; &gt; &gt;    Requestors: SREZIC@cpan.org
&gt; &gt; &gt;        Status: new
&gt; &gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122402">https://rt.cpan.org/Ticket/Display.html?id=122402</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On some of my smoker systems &#40;centos6, debian jessie, freebsd&#41; I
&gt; &gt; &gt; see
&gt; &gt; &gt; the following failure, without any further diagnostics:
&gt; &gt; &gt;
&gt; &gt; &gt; ...
&gt; &gt; &gt; t/bin/Prty/Ipc.t ................................
&gt; &gt; &gt; Failed 2/4 subtests
&gt; &gt; &gt; ...
</div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;09&nbsp;09:48:11&nbsp;2017</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Man kann das Problem mit diesem diff nachstellen:

diff --git a/lib/Prty/Ipc.pm b/lib/Prty/Ipc.pm
index c0501c5..364a29b 100644
--- a/lib/Prty/Ipc.pm
+++ b/lib/Prty/Ipc.pm
@@ -76,6 +76,8 @@ sub filter {
         &#41;;
     }

+    sleep 1;
+
     if &#40;defined $in&#41; {
         print W $in;
     }


Damit kann man zusichern, dass sich das externe Kommando schneller beendet als &#34;print W ...&#34; ausgeführt wird. Und in diesem Fall kommt es zum SIGPIPE, weil der print-Befehl &#34;ins Leere&#34; läuft.

On 2017-07-09 09:36:47, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mit strace bekommt man einen Fehler nur, wenn man -f weglässt. Damit
&gt; sieht man leider nicht, was in den Kindprozessen passiert, aber
&gt; immerhin. Die letzten Zeilen:
&gt; 
&gt; ...
&gt; 
&gt; 13:35:18.882051 fcntl&#40;13, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt; 13:35:18.882080 fcntl&#40;14, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000022&gt;
&gt; 13:35:18.882140 rt_sigprocmask&#40;SIG_SETMASK, ~[RTMIN RT_1], [], 8&#41; = 0
&gt; &lt;0.000009&gt;
&gt; 13:35:18.882181 clone&#40;child_stack=0,
&gt; flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD,
&gt; child_tidptr=0x7f06386a49d0&#41; = 13563 &lt;0.003322&gt;
&gt; 13:35:18.885560 rt_sigprocmask&#40;SIG_SETMASK, [], NULL, 8&#41; = 0
&gt; &lt;0.000010&gt;
&gt; 13:35:18.885632 close&#40;14&#41;               = 0 &lt;0.000010&gt;
&gt; 13:35:18.885720 read&#40;13, &#34;&#34;, 8192&#41;      = 0 &lt;0.001494&gt;
&gt; 13:35:18.887310 close&#40;13&#41;               = 0 &lt;0.000014&gt;
&gt; 13:35:18.887393 close&#40;3&#41;                = 0 &lt;0.000010&gt;
&gt; 13:35:18.887445 close&#40;10&#41;               = 0 &lt;0.000010&gt;
&gt; 13:35:18.887499 close&#40;12&#41;               = 0 &lt;0.000010&gt;
&gt; 13:35:18.887627 write&#40;4, &#34;Ein Test&#34;, 8&#41; = 8 &lt;0.000025&gt;
&gt; 13:35:18.887675 close&#40;4&#41;                = 0 &lt;0.000010&gt;
&gt; 13:35:18.887707 fstat&#40;9, {st_mode=S_IFIFO|0600, st_size=0, ...}&#41; = 0
&gt; &lt;0.000010&gt;
&gt; 13:35:18.887741 read&#40;9, &#34;Ein Test&#34;, 8192&#41; = 8 &lt;0.000129&gt;
&gt; 13:35:18.887892 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED,
&gt; si_pid=13563, si_status=0, si_utime=0, si_stime=0} ---
&gt; 13:35:18.887912 read&#40;9, &#34;&#34;, 8192&#41;       = 0 &lt;0.000010&gt;
&gt; 13:35:18.887941 close&#40;9&#41;                = 0 &lt;0.000011&gt;
&gt; 13:35:18.887976 fstat&#40;11, {st_mode=S_IFIFO|0600, st_size=0, ...}&#41; = 0
&gt; &lt;0.000010&gt;
&gt; 13:35:18.888009 read&#40;11, &#34;&#34;, 8192&#41;      = 0 &lt;0.000010&gt;
&gt; 13:35:18.888041 close&#40;11&#41;               = 0 &lt;0.000010&gt;
&gt; 13:35:18.888080 wait4&#40;13563, [{WIFEXITED&#40;s&#41; &#38;&#38; WEXITSTATUS&#40;s&#41; == 0}],
&gt; 0, NULL&#41; = 13563 &lt;0.000013&gt;
&gt; 13:35:18.888576 write&#40;5, &#34;ok 2\n&#34;, 5&#41;   = 5 &lt;0.000014&gt;
&gt; 13:35:18.888756 pipe&#40;[3, 4]&#41;            = 0 &lt;0.000013&gt;
&gt; 13:35:18.888799 ioctl&#40;3, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt; 13:35:18.888830 lseek&#40;3, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000010&gt;
&gt; 13:35:18.888859 ioctl&#40;4, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt; 13:35:18.888888 lseek&#40;4, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000010&gt;
&gt; 13:35:18.888915 fcntl&#40;3, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt; 13:35:18.888943 fcntl&#40;4, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt; 13:35:18.888977 pipe&#40;[9, 10]&#41;           = 0 &lt;0.000012&gt;
&gt; 13:35:18.889009 ioctl&#40;9, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt; 13:35:18.889038 lseek&#40;9, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000009&gt;
&gt; 13:35:18.889067 ioctl&#40;10, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt; 13:35:18.889095 lseek&#40;10, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000010&gt;
&gt; 13:35:18.889122 fcntl&#40;9, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt; 13:35:18.889149 fcntl&#40;10, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt; 13:35:18.889182 pipe&#40;[11, 12]&#41;          = 0 &lt;0.000011&gt;
&gt; 13:35:18.889214 ioctl&#40;11, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt; 13:35:18.889242 lseek&#40;11, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000010&gt;
&gt; 13:35:18.889270 ioctl&#40;12, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt; 13:35:18.889298 lseek&#40;12, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000009&gt;
&gt; 13:35:18.889325 fcntl&#40;11, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt; 13:35:18.889351 fcntl&#40;12, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt; 13:35:18.889382 pipe&#40;[13, 14]&#41;          = 0 &lt;0.000011&gt;
&gt; 13:35:18.889412 ioctl&#40;13, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt; 13:35:18.889440 lseek&#40;13, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000009&gt;
&gt; 13:35:18.889468 ioctl&#40;14, SNDCTL_TMR_TIMEBASE or
&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt; 13:35:18.889496 lseek&#40;14, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt; &lt;0.000009&gt;
&gt; 13:35:18.889523 fcntl&#40;13, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt; 13:35:18.889550 fcntl&#40;14, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt; 13:35:18.889589 rt_sigprocmask&#40;SIG_SETMASK, ~[RTMIN RT_1], [], 8&#41; = 0
&gt; &lt;0.000010&gt;
&gt; 13:35:18.889623 clone&#40;child_stack=0,
&gt; flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD,
&gt; child_tidptr=0x7f06386a49d0&#41; = 13564 &lt;0.002480&gt;
&gt; 13:35:18.892175 rt_sigprocmask&#40;SIG_SETMASK, [], NULL, 8&#41; = 0
&gt; &lt;0.000011&gt;
&gt; 13:35:18.892247 close&#40;14&#41;               = 0 &lt;0.000010&gt;
&gt; 13:35:18.892358 read&#40;13, &#34;&#34;, 8192&#41;      = 0 &lt;0.001207&gt;
&gt; 13:35:18.893591 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED,
&gt; si_pid=13564, si_status=1, si_utime=0, si_stime=0} ---
&gt; 13:35:18.893632 close&#40;13&#41;               = 0 &lt;0.000012&gt;
&gt; 13:35:18.893707 close&#40;3&#41;                = 0 &lt;0.000011&gt;
&gt; 13:35:18.893747 close&#40;10&#41;               = 0 &lt;0.000010&gt;
&gt; 13:35:18.893788 close&#40;12&#41;               = 0 &lt;0.000011&gt;
&gt; 13:35:18.893912 write&#40;4, &#34;Ein Test&#34;, 8&#41; = -1 EPIPE &#40;Broken pipe&#41;
&gt; &lt;0.000011&gt;
&gt; 13:35:18.893959 --- SIGPIPE {si_signo=SIGPIPE, si_code=SI_USER,
&gt; si_pid=13562, si_uid=1023} ---
&gt; 13:35:18.895255 +++ killed by SIGPIPE +++
&gt; 
&gt; 
&gt; On 2017-07-09 09:33:28, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; Auf einem CentOS6-System:
&gt; &gt;
&gt; &gt; $ /opt/perl-5.22.3/bin/prove -v -Ilib t/bin/Prty/Ipc.t
&gt; &gt; t/bin/Prty/Ipc.t ..
&gt; &gt; 1..4
&gt; &gt; ok 1 - use Prty::Ipc;
&gt; &gt; ok 2
&gt; &gt; Failed 2/4 subtests
&gt; &gt;
&gt; &gt; Test Summary Report
&gt; &gt; -------------------
&gt; &gt; t/bin/Prty/Ipc.t &#40;Wstat: 13 Tests: 2 Failed: 0&#41;
&gt; &gt;   Non-zero wait status: 13
&gt; &gt;   Parse errors: Bad plan.  You planned 4 tests but ran 2.
&gt; &gt; Files=1, Tests=2,  0 wallclock secs &#40; 0.02 usr  0.01 sys +  0.08 cusr
&gt; &gt; 0.04 csys =  0.15 CPU&#41;
&gt; &gt; Result: FAIL
&gt; &gt;
&gt; &gt; Signal 13 ist SIGPIPE.
&gt; &gt;
&gt; &gt; Dummerweise ist es ein Heisenbug: sobald ich versuche, mit strace
&gt; &gt; reinzuschauen, läuft der Test erfolgreich durch.
&gt; &gt;
&gt; &gt; Vermutlich ein Timing-Problem; eventuell läuft das externe Kommando
&gt; &gt; zu
&gt; &gt; langsam oder zu schnell.
&gt; &gt;
&gt; &gt; On 2017-07-09 07:20:01, fs@fseitz.de wrote:
<div class="message-stanza open">&gt; &gt; &gt; Hallo Slaven,
&gt; &gt; &gt;
&gt; &gt; &gt; kannst du mir von einem dieser Systeme die Ausgabe
&gt; &gt; &gt; des folgenden Kommandos senden?
&gt; &gt; &gt;
&gt; &gt; &gt; $ prove -v -Ilib t/bin/Prty/Ipc.t
&gt; &gt; &gt;
&gt; &gt; &gt; Grüße
&gt; &gt; &gt; Frank
&gt; &gt; &gt;
&gt; &gt; &gt; On 07/09/2017 10:46 AM, Slaven_Rezic via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Sun Jul 09 04:46:06 2017: Request 122402 was acted upon.
&gt; &gt; &gt; &gt; Transaction: Ticket created by SREZIC
&gt; &gt; &gt; &gt;         Queue: Prty
&gt; &gt; &gt; &gt;       Subject: Ipc.t fails on some systems without diagnostics
&gt; &gt; &gt; &gt;     Broken in: 1.115
&gt; &gt; &gt; &gt;      Severity: &#40;no value&#41;
&gt; &gt; &gt; &gt;         Owner: Nobody
&gt; &gt; &gt; &gt;    Requestors: SREZIC@cpan.org
&gt; &gt; &gt; &gt;        Status: new
&gt; &gt; &gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122402">https://rt.cpan.org/Ticket/Display.html?id=122402</a></span>
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt;
</div>&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; On some of my smoker systems &#40;centos6, debian jessie, freebsd&#41; I
&gt; &gt; &gt; &gt; see
&gt; &gt; &gt; &gt; the following failure, without any further diagnostics:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; ...
&gt; &gt; &gt; &gt; t/bin/Prty/Ipc.t ................................
&gt; &gt; &gt; &gt; Failed 2/4 subtests
&gt; &gt; &gt; &gt; ...
</div></div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;09&nbsp;11:41:41&nbsp;2017</span>
    <span class="description">fs [...] fseitz.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #122402] Ipc.t fails on some systems without diagnostics</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Jul 2017 17:41:23 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Prty [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Frank Seitz &lt;fs [...] fseitz.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hallo Slaven,

verstehe. Das Problem kann ich im Testcode dadurch lösen,
dass ich beim zweiten Testfall &#40;Aufruf von false&#41; keine Daten
mitgebe. Daten mitzugeben ist an der Stelle eigentlich unsinnig,
da false nichts von stdin liest. Bei dem Test geht
es ansich nur um den Exitcode. Vielen Dank für die
genaue Analyse!

Grüße
Frank

On 07/09/2017 03:48 PM, Slaven_Rezic via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: Prty
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122402">https://rt.cpan.org/Ticket/Display.html?id=122402</a></span> &gt;
&gt;
&gt; Man kann das Problem mit diesem diff nachstellen:
&gt;
&gt; diff --git a/lib/Prty/Ipc.pm b/lib/Prty/Ipc.pm
&gt; index c0501c5..364a29b 100644
&gt; --- a/lib/Prty/Ipc.pm
&gt; +++ b/lib/Prty/Ipc.pm
&gt; @@ -76,6 +76,8 @@ sub filter {
&gt;           &#41;;
&gt;       }
&gt;
&gt; +    sleep 1;
&gt; +
&gt;       if &#40;defined $in&#41; {
&gt;           print W $in;
&gt;       }
&gt;
&gt;
&gt; Damit kann man zusichern, dass sich das externe Kommando schneller beendet als &#34;print W ...&#34; ausgeführt wird. Und in diesem Fall kommt es zum SIGPIPE, weil der print-Befehl &#34;ins Leere&#34; läuft.
&gt;
&gt; On 2017-07-09 09:36:47, SREZIC wrote:
<div class="message-stanza open">&gt;&gt; Mit strace bekommt man einen Fehler nur, wenn man -f weglässt. Damit
&gt;&gt; sieht man leider nicht, was in den Kindprozessen passiert, aber
&gt;&gt; immerhin. Die letzten Zeilen:
&gt;&gt;
&gt;&gt; ...
&gt;&gt;
&gt;&gt; 13:35:18.882051 fcntl&#40;13, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt;&gt; 13:35:18.882080 fcntl&#40;14, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000022&gt;
&gt;&gt; 13:35:18.882140 rt_sigprocmask&#40;SIG_SETMASK, ~[RTMIN RT_1], [], 8&#41; = 0
&gt;&gt; &lt;0.000009&gt;
&gt;&gt; 13:35:18.882181 clone&#40;child_stack=0,
&gt;&gt; flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD,
&gt;&gt; child_tidptr=0x7f06386a49d0&#41; = 13563 &lt;0.003322&gt;
&gt;&gt; 13:35:18.885560 rt_sigprocmask&#40;SIG_SETMASK, [], NULL, 8&#41; = 0
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.885632 close&#40;14&#41;               = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.885720 read&#40;13, &#34;&#34;, 8192&#41;      = 0 &lt;0.001494&gt;
&gt;&gt; 13:35:18.887310 close&#40;13&#41;               = 0 &lt;0.000014&gt;
&gt;&gt; 13:35:18.887393 close&#40;3&#41;                = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.887445 close&#40;10&#41;               = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.887499 close&#40;12&#41;               = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.887627 write&#40;4, &#34;Ein Test&#34;, 8&#41; = 8 &lt;0.000025&gt;
&gt;&gt; 13:35:18.887675 close&#40;4&#41;                = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.887707 fstat&#40;9, {st_mode=S_IFIFO|0600, st_size=0, ...}&#41; = 0
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.887741 read&#40;9, &#34;Ein Test&#34;, 8192&#41; = 8 &lt;0.000129&gt;
&gt;&gt; 13:35:18.887892 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED,
&gt;&gt; si_pid=13563, si_status=0, si_utime=0, si_stime=0} ---
&gt;&gt; 13:35:18.887912 read&#40;9, &#34;&#34;, 8192&#41;       = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.887941 close&#40;9&#41;                = 0 &lt;0.000011&gt;
&gt;&gt; 13:35:18.887976 fstat&#40;11, {st_mode=S_IFIFO|0600, st_size=0, ...}&#41; = 0
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.888009 read&#40;11, &#34;&#34;, 8192&#41;      = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.888041 close&#40;11&#41;               = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.888080 wait4&#40;13563, [{WIFEXITED&#40;s&#41; &#38;&#38; WEXITSTATUS&#40;s&#41; == 0}],
&gt;&gt; 0, NULL&#41; = 13563 &lt;0.000013&gt;
&gt;&gt; 13:35:18.888576 write&#40;5, &#34;ok 2\n&#34;, 5&#41;   = 5 &lt;0.000014&gt;
&gt;&gt; 13:35:18.888756 pipe&#40;[3, 4]&#41;            = 0 &lt;0.000013&gt;
&gt;&gt; 13:35:18.888799 ioctl&#40;3, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt;&gt; 13:35:18.888830 lseek&#40;3, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.888859 ioctl&#40;4, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt;&gt; 13:35:18.888888 lseek&#40;4, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.888915 fcntl&#40;3, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.888943 fcntl&#40;4, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.888977 pipe&#40;[9, 10]&#41;           = 0 &lt;0.000012&gt;
&gt;&gt; 13:35:18.889009 ioctl&#40;9, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt;&gt; 13:35:18.889038 lseek&#40;9, 0, SEEK_CUR&#41;   = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889067 ioctl&#40;10, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889095 lseek&#40;10, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.889122 fcntl&#40;9, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt;&gt; 13:35:18.889149 fcntl&#40;10, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt;&gt; 13:35:18.889182 pipe&#40;[11, 12]&#41;          = 0 &lt;0.000011&gt;
&gt;&gt; 13:35:18.889214 ioctl&#40;11, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889242 lseek&#40;11, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.889270 ioctl&#40;12, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889298 lseek&#40;12, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889325 fcntl&#40;11, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.889351 fcntl&#40;12, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt;&gt; 13:35:18.889382 pipe&#40;[13, 14]&#41;          = 0 &lt;0.000011&gt;
&gt;&gt; 13:35:18.889412 ioctl&#40;13, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000010&gt;
&gt;&gt; 13:35:18.889440 lseek&#40;13, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889468 ioctl&#40;14, SNDCTL_TMR_TIMEBASE or
&gt;&gt; SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff77036860&#41; = -1 EINVAL
&gt;&gt; &#40;Invalid argument&#41; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889496 lseek&#40;14, 0, SEEK_CUR&#41;  = -1 ESPIPE &#40;Illegal seek&#41;
&gt;&gt; &lt;0.000009&gt;
&gt;&gt; 13:35:18.889523 fcntl&#40;13, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.889550 fcntl&#40;14, F_SETFD, FD_CLOEXEC&#41; = 0 &lt;0.000009&gt;
&gt;&gt; 13:35:18.889589 rt_sigprocmask&#40;SIG_SETMASK, ~[RTMIN RT_1], [], 8&#41; = 0
&gt;&gt; &lt;0.000010&gt;
&gt;&gt; 13:35:18.889623 clone&#40;child_stack=0,
&gt;&gt; flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD,
&gt;&gt; child_tidptr=0x7f06386a49d0&#41; = 13564 &lt;0.002480&gt;
&gt;&gt; 13:35:18.892175 rt_sigprocmask&#40;SIG_SETMASK, [], NULL, 8&#41; = 0
&gt;&gt; &lt;0.000011&gt;
&gt;&gt; 13:35:18.892247 close&#40;14&#41;               = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.892358 read&#40;13, &#34;&#34;, 8192&#41;      = 0 &lt;0.001207&gt;
&gt;&gt; 13:35:18.893591 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED,
&gt;&gt; si_pid=13564, si_status=1, si_utime=0, si_stime=0} ---
&gt;&gt; 13:35:18.893632 close&#40;13&#41;               = 0 &lt;0.000012&gt;
&gt;&gt; 13:35:18.893707 close&#40;3&#41;                = 0 &lt;0.000011&gt;
&gt;&gt; 13:35:18.893747 close&#40;10&#41;               = 0 &lt;0.000010&gt;
&gt;&gt; 13:35:18.893788 close&#40;12&#41;               = 0 &lt;0.000011&gt;
&gt;&gt; 13:35:18.893912 write&#40;4, &#34;Ein Test&#34;, 8&#41; = -1 EPIPE &#40;Broken pipe&#41;
&gt;&gt; &lt;0.000011&gt;
&gt;&gt; 13:35:18.893959 --- SIGPIPE {si_signo=SIGPIPE, si_code=SI_USER,
&gt;&gt; si_pid=13562, si_uid=1023} ---
&gt;&gt; 13:35:18.895255 +++ killed by SIGPIPE +++
&gt;&gt;
&gt;&gt;
&gt;&gt; On 2017-07-09 09:33:28, SREZIC wrote:
<div class="message-stanza open">&gt;&gt;&gt; Auf einem CentOS6-System:
&gt;&gt;&gt;
&gt;&gt;&gt; $ /opt/perl-5.22.3/bin/prove -v -Ilib t/bin/Prty/Ipc.t
&gt;&gt;&gt; t/bin/Prty/Ipc.t ..
&gt;&gt;&gt; 1..4
&gt;&gt;&gt; ok 1 - use Prty::Ipc;
&gt;&gt;&gt; ok 2
&gt;&gt;&gt; Failed 2/4 subtests
&gt;&gt;&gt;
&gt;&gt;&gt; Test Summary Report
&gt;&gt;&gt; -------------------
&gt;&gt;&gt; t/bin/Prty/Ipc.t &#40;Wstat: 13 Tests: 2 Failed: 0&#41;
&gt;&gt;&gt;    Non-zero wait status: 13
&gt;&gt;&gt;    Parse errors: Bad plan.  You planned 4 tests but ran 2.
&gt;&gt;&gt; Files=1, Tests=2,  0 wallclock secs &#40; 0.02 usr  0.01 sys +  0.08 cusr
&gt;&gt;&gt; 0.04 csys =  0.15 CPU&#41;
&gt;&gt;&gt; Result: FAIL
&gt;&gt;&gt;
&gt;&gt;&gt; Signal 13 ist SIGPIPE.
&gt;&gt;&gt;
&gt;&gt;&gt; Dummerweise ist es ein Heisenbug: sobald ich versuche, mit strace
&gt;&gt;&gt; reinzuschauen, läuft der Test erfolgreich durch.
&gt;&gt;&gt;
&gt;&gt;&gt; Vermutlich ein Timing-Problem; eventuell läuft das externe Kommando
&gt;&gt;&gt; zu
&gt;&gt;&gt; langsam oder zu schnell.
&gt;&gt;&gt;
&gt;&gt;&gt; On 2017-07-09 07:20:01, fs@fseitz.de wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt; Hallo Slaven,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; kannst du mir von einem dieser Systeme die Ausgabe
&gt;&gt;&gt;&gt; des folgenden Kommandos senden?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ prove -v -Ilib t/bin/Prty/Ipc.t
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Grüße
&gt;&gt;&gt;&gt; Frank
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On 07/09/2017 10:46 AM, Slaven_Rezic via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; Sun Jul 09 04:46:06 2017: Request 122402 was acted upon.
&gt;&gt;&gt;&gt;&gt; Transaction: Ticket created by SREZIC
&gt;&gt;&gt;&gt;&gt;          Queue: Prty
&gt;&gt;&gt;&gt;&gt;        Subject: Ipc.t fails on some systems without diagnostics
&gt;&gt;&gt;&gt;&gt;      Broken in: 1.115
&gt;&gt;&gt;&gt;&gt;       Severity: &#40;no value&#41;
&gt;&gt;&gt;&gt;&gt;          Owner: Nobody
&gt;&gt;&gt;&gt;&gt;     Requestors: SREZIC@cpan.org
&gt;&gt;&gt;&gt;&gt;         Status: new
&gt;&gt;&gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122402">https://rt.cpan.org/Ticket/Display.html?id=122402</a></span>
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On some of my smoker systems &#40;centos6, debian jessie, freebsd&#41; I
&gt;&gt;&gt;&gt;&gt; see
&gt;&gt;&gt;&gt;&gt; the following failure, without any further diagnostics:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; ...
&gt;&gt;&gt;&gt;&gt; t/bin/Prty/Ipc.t ................................
&gt;&gt;&gt;&gt;&gt; Failed 2/4 subtests
&gt;&gt;&gt;&gt;&gt; ...
</div></div></div></div></div>
-- 
Dipl.-Inform. Frank Seitz
IT Consultant / {Web, Database, Linux} Developer
Tel: +49-176-78243503, Hauptstr. 32-34, D-25462 Rellingen

Blog: <span class="clickylink"><a target="new" rel="nofollow" href="http://fseitz.de/blog">http://fseitz.de/blog</a></span>
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;01:40:53&nbsp;2017</span>
    <span class="description">FSEITZ [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
