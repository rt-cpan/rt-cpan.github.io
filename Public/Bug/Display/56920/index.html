<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #56920 for DBIx-Class-Journal: Minor fixes for _03 &#40;on Pg 8.1&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #56920 for DBIx-Class-Journal: Minor fixes for _03 &#40;on Pg 8.1&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class-Journal/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class-Journal/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class-Journal/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class-Journal/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class-Journal">DBIx-Class-Journal CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">56920</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class-Journal/Active/">DBIx-Class-Journal</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
OLIVER [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-219970-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.900001_03    </td>
  </tr>
  <tr id="CF-219971-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;25&nbsp;19:02:03&nbsp;2010</span>
    <span class="description">OLIVER [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Minor fixes for _03 &#40;on Pg 8.1&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I have been testing the _03 dev release on a database here runing in
PostgreSQL 8.1 and needed to make some minor changes to your schema
files and also to the code in one or two parts.

You are advised to check this patch - I have changed a use of gmtime to
localtime and you will know more about the side effects of this than me.

I hope this patch helps, and thanks for a great module :-&#41;

regards,
oliver.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 03_fixes_gorwits_01.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Journal.pm DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Journal.pm
--- DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Journal.pm	2010-02-18 16:34:02.000000000 +0000
+++ DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Journal.pm	2010-04-25 23:55:29.000000000 +0100
@@ -71,7 +71,7 @@
 
         my $change = $j-&gt;journal_create_change;
         my $prev = $self-&gt;result_source-&gt;resultset-&gt;find&#40; $self-&gt;ident_condition &#41;;
-        $j-&gt;journal_record_in_history&#40; $prev, audit_change_id =&gt; $change &#41;;
+        $j-&gt;journal_record_in_history&#40; $prev, audit_change_id =&gt; $change-&gt;id &#41;;
     }
 }
 
diff -urN DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Schema/Journal/DB/ChangeLog.pm DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Schema/Journal/DB/ChangeLog.pm
--- DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Schema/Journal/DB/ChangeLog.pm	2010-01-27 09:00:08.000000000 +0000
+++ DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Schema/Journal/DB/ChangeLog.pm	2010-04-25 23:55:54.000000000 +0100
@@ -6,11 +6,12 @@
 __PACKAGE__-&gt;table&#40;&#39;changelog&#39;&#41;;
 
 __PACKAGE__-&gt;add_columns&#40;
-	ID =&gt; {
+	id =&gt; {
 		data_type =&gt; &#39;integer&#39;,
 		is_auto_increment =&gt; 1,
 		is_primary_key =&gt; 1,
 		is_nullable =&gt; 0,
+        sequence =&gt; &#34;changelog_id_seq&#34;,
 	},
 		changeset_id =&gt; {
 		data_type =&gt; &#39;integer&#39;,
@@ -24,7 +25,7 @@
 &#41;;
 
 
-__PACKAGE__-&gt;set_primary_key&#40;&#39;ID&#39;&#41;;
+__PACKAGE__-&gt;set_primary_key&#40;&#39;id&#39;&#41;;
 __PACKAGE__-&gt;add_unique_constraint&#40;&#39;setorder&#39;, [ qw/changeset_id order_in/ ]&#41;;
 __PACKAGE__-&gt;belongs_to&#40;&#39;changeset&#39;, &#39;DBIx::Class::Schema::Journal::DB::ChangeSet&#39;, &#39;changeset_id&#39;&#41;;
 
diff -urN DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Schema/Journal/DB/ChangeSet.pm DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Schema/Journal/DB/ChangeSet.pm
--- DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Schema/Journal/DB/ChangeSet.pm	2010-01-27 09:00:08.000000000 +0000
+++ DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Schema/Journal/DB/ChangeSet.pm	2010-04-25 23:55:54.000000000 +0100
@@ -6,11 +6,12 @@
 __PACKAGE__-&gt;table&#40;&#39;changeset&#39;&#41;;
 
 __PACKAGE__-&gt;add_columns&#40;
-	ID =&gt; {
+	id =&gt; {
 		data_type =&gt; &#39;integer&#39;,
 		is_auto_increment =&gt; 1,
 		is_primary_key =&gt; 1,
 		is_nullable =&gt; 0,
+        sequence =&gt; &#34;changeset_id_seq&#34;,
 	},
 	user_id =&gt; {
 		data_type =&gt; &#39;integer&#39;,
@@ -36,10 +37,10 @@
 	 # import?&#41; to do it and retain backcompat I will.
 	 #
 	 # --fREW, 01-27-2010
-    $self-&gt;set_date&#40;gmtime&#41;;
+    $self-&gt;set_date&#40;scalar localtime&#41;;
     return $self;
 }
 
-__PACKAGE__-&gt;set_primary_key&#40;&#39;ID&#39;&#41;;
+__PACKAGE__-&gt;set_primary_key&#40;&#39;id&#39;&#41;;
 
 1;
diff -urN DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Schema/Journal/DB.pm DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Schema/Journal/DB.pm
--- DBIx-Class-Journal-0.900001_03.orig/lib/DBIx/Class/Schema/Journal/DB.pm	2010-02-18 16:29:05.000000000 +0000
+++ DBIx-Class-Journal-0.900001_03.new/lib/DBIx/Class/Schema/Journal/DB.pm	2010-04-25 23:55:54.000000000 +0100
@@ -38,7 +38,7 @@
 sub journal_create_changeset {
     my &#40; $self, @args &#41; = @_;
 
-    my %changesetdata = &#40; @args, ID =&gt; undef &#41;;
+    my %changesetdata = &#40; @args &#41;;
 
     delete $changesetdata{parent_id} unless $self-&gt;nested_changesets;
 </div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;25&nbsp;20:01:54&nbsp;2010</span>
    <span class="description">OLIVER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Just some more notes as I find things...

The create_id column of *_audit_log should not have the &#39;not null&#39;
constraint - I believe either that or the delete_id are set, so one or
the other will always be null?

It seems when a row is deleted, an entry appears in *_audit_log with a
delete_id but the row data is not stored into *_audit_history. Seeing as
the *_audit_history table contains the previous state of rows before
change, the version on deletion isn&#39;t in there and so is lost. It should
probably be added with the change ID from delete_id.

regards,
oliver.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;25&nbsp;20:01:57&nbsp;2010</span>
    <span class="description">OLIVER [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;26&nbsp;16:33:49&nbsp;2010</span>
    <span class="description">frioux [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, this is &#40;mostly&#41; fixed in the most recent commit.

ID&#39;s are not renamed, please turn on quoting in Pg instead.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;26&nbsp;16:33:52&nbsp;2010</span>
    <span class="description">frioux [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
