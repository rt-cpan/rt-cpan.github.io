<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #104424 for PDL-Graphics-PLplot: Does not work with PLplot 5.11.0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #104424 for PDL-Graphics-PLplot: Does not work with PLplot 5.11.0</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PDL-Graphics-PLplot/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PDL-Graphics-PLplot/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PDL-Graphics-PLplot/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PDL-Graphics-PLplot/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDL-Graphics-PLplot">PDL-Graphics-PLplot CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">104424</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PDL-Graphics-PLplot/Active/">PDL-Graphics-PLplot</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25066-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.67    </td>
  </tr>
  <tr id="CF-25067-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;04:59:15&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Does not work with PLplot 5.11.0</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">PLplot 5.11.0 renamed plplotd library to plplot, thus the Makefile.PL fails to detect the plplot library.

After correcting the name, the t/plplot.t test segfaults just on the first object creation:

$pl = PDL::Graphics::PLplot-&gt;new &#40;DEV =&gt; $dev,
                  FILE =&gt; &#34;test2.$dev&#34;,
                  BACKGROUND =&gt; [255,255,255]&#41;;

Also this simple invocation segfaults:

$ perl -Iblib/{arch,lib} -MPDL -MPDL::Graphics::PLplot -e &#39;PDL::Graphics::PLplot-&gt;new&#40;&#41;&#39;
Program received signal SIGSEGV, Segmentation fault.
0x00007fffecb286fa in plP_state &#40;&#41; from /lib64/libplplot.so.13
&#40;gdb&#41; bt
#0  0x00007fffecb286fa in plP_state &#40;&#41; from /lib64/libplplot.so.13
#1  0x00007fffece33ab2 in pdl_plschr_readdata &#40;__tr=0x1395200&#41; at PLplot.xs:11154
#2  0x00007fffef0f8194 in pdl.ensure_trans &#40;&#41; from /usr/lib64/perl5/vendor_perl/auto/PDL/Core/Core.so
#3  0x00007fffef0f7150 in pdl_make_trans_mutual &#40;&#41; from /usr/lib64/perl5/vendor_perl/auto/PDL/Core/Core.so
#4  0x00007fffecdfdabf in XS_PDL_plschr &#40;my_perl=&lt;optimized out&gt;, cv=&lt;optimized out&gt;&#41; at PLplot.xs:50441
#5  0x00007ffff7ae96ab in Perl_pp_entersub &#40;&#41; from /lib64/libperl.so.5.20
#6  0x00007ffff7ae1f36 in Perl_runops_standard &#40;&#41; from /lib64/libperl.so.5.20
#7  0x00007ffff7a719c0 in perl_run &#40;&#41; from /lib64/libperl.so.5.20
#8  0x0000000000400d79 in main &#40;&#41;

This could be bug in the PLplot itself.

I have plplot-5.11.0, PDL-2.7.0, perl-5.20.2, gcc-5.1.1.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;06:24:37&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Čt 14.Květen.2015 04:59:15, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also this simple invocation segfaults:
&gt; 
&gt; $ perl -Iblib/{arch,lib} -MPDL -MPDL::Graphics::PLplot -e
&gt; &#39;PDL::Graphics::PLplot-&gt;new&#40;&#41;&#39;
&gt; Program received signal SIGSEGV, Segmentation fault.
&gt; 0x00007fffecb286fa in plP_state &#40;&#41; from /lib64/libplplot.so.13
&gt; &#40;gdb&#41; bt
&gt; #0  0x00007fffecb286fa in plP_state &#40;&#41; from /lib64/libplplot.so.13
&gt; #1  0x00007fffece33ab2 in pdl_plschr_readdata &#40;__tr=0x1395200&#41; at
&gt; PLplot.xs:11154
&gt; #2  0x00007fffef0f8194 in pdl.ensure_trans &#40;&#41; from
&gt; /usr/lib64/perl5/vendor_perl/auto/PDL/Core/Core.so
&gt; #3  0x00007fffef0f7150 in pdl_make_trans_mutual &#40;&#41; from
&gt; /usr/lib64/perl5/vendor_perl/auto/PDL/Core/Core.so
&gt; #4  0x00007fffecdfdabf in XS_PDL_plschr &#40;my_perl=&lt;optimized out&gt;,
&gt; cv=&lt;optimized out&gt;&#41; at PLplot.xs:50441
&gt; #5  0x00007ffff7ae96ab in Perl_pp_entersub &#40;&#41; from
&gt; /lib64/libperl.so.5.20
&gt; #6  0x00007ffff7ae1f36 in Perl_runops_standard &#40;&#41; from
&gt; /lib64/libperl.so.5.20
&gt; #7  0x00007ffff7a719c0 in perl_run &#40;&#41; from /lib64/libperl.so.5.20
&gt; #8  0x0000000000400d79 in main &#40;&#41;
&gt; 
&gt; This could be bug in the PLplot itself.
&gt; 
&gt; I have plplot-5.11.0, PDL-2.7.0, perl-5.20.2, gcc-5.1.1.
</div>
If I downgrade plplot to 5.10.0, it does not segfault. Something has changed in the plplot.

So far I isolated the crash to the place when new&#40;&#41; sets CHARSIZE option. If I comment the default CHARSIZE=&gt;1 option out, all tests pass.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;07:19:14&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Čt 14.Květen.2015 06:24:37, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dne Čt 14.Květen.2015 04:59:15, ppisar napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; Also this simple invocation segfaults:
&gt; &gt;
&gt; &gt; $ perl -Iblib/{arch,lib} -MPDL -MPDL::Graphics::PLplot -e
&gt; &gt; &#39;PDL::Graphics::PLplot-&gt;new&#40;&#41;&#39;
&gt; &gt; Program received signal SIGSEGV, Segmentation fault.
&gt; &gt; 0x00007fffecb286fa in plP_state &#40;&#41; from /lib64/libplplot.so.13
&gt; &gt; &#40;gdb&#41; bt
&gt; &gt; #0  0x00007fffecb286fa in plP_state &#40;&#41; from /lib64/libplplot.so.13
&gt; &gt; #1  0x00007fffece33ab2 in pdl_plschr_readdata &#40;__tr=0x1395200&#41; at
&gt; &gt; PLplot.xs:11154
&gt; &gt; #2  0x00007fffef0f8194 in pdl.ensure_trans &#40;&#41; from
&gt; &gt; /usr/lib64/perl5/vendor_perl/auto/PDL/Core/Core.so
&gt; &gt; #3  0x00007fffef0f7150 in pdl_make_trans_mutual &#40;&#41; from
&gt; &gt; /usr/lib64/perl5/vendor_perl/auto/PDL/Core/Core.so
&gt; &gt; #4  0x00007fffecdfdabf in XS_PDL_plschr &#40;my_perl=&lt;optimized out&gt;,
&gt; &gt; cv=&lt;optimized out&gt;&#41; at PLplot.xs:50441
&gt; &gt; #5  0x00007ffff7ae96ab in Perl_pp_entersub &#40;&#41; from
&gt; &gt; /lib64/libperl.so.5.20
&gt; &gt; #6  0x00007ffff7ae1f36 in Perl_runops_standard &#40;&#41; from
&gt; &gt; /lib64/libperl.so.5.20
&gt; &gt; #7  0x00007ffff7a719c0 in perl_run &#40;&#41; from /lib64/libperl.so.5.20
&gt; &gt; #8  0x0000000000400d79 in main &#40;&#41;
&gt; &gt;
&gt; &gt; This could be bug in the PLplot itself.
&gt; &gt;
&gt; &gt; I have plplot-5.11.0, PDL-2.7.0, perl-5.20.2, gcc-5.1.1.
</div>&gt; 
&gt; If I downgrade plplot to 5.10.0, it does not segfault. Something has
&gt; changed in the plplot.
&gt; 
&gt; So far I isolated the crash to the place when new&#40;&#41; sets CHARSIZE
&gt; option. If I comment the default CHARSIZE=&gt;1 option out, all tests
&gt; pass.
</div>
It crashes inside XS_PDL_plschr&#40;&#41; when calling PDL-&gt;make_trans_mutual&#40;&#40;pdl_trans *&#41;__privtrans&#41;. plplot addeded plP_state&#40; PLSTATE_CHR &#41; call at the end of c_plschr&#40;&#41;.

After reading plplot-5.11.0/examples/perl/x02.pl example which itself uses this Perl module, I think the bug is that the CHARSIZE option invokes plschr&#40;&#41; before calling plinit&#40;&#41; in the new&#40;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;08:10:52&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Čt 14.Květen.2015 07:19:14, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; After reading plplot-5.11.0/examples/perl/x02.pl example which itself
&gt; uses this Perl module, I think the bug is that the CHARSIZE option
&gt; invokes plschr&#40;&#41; before calling plinit&#40;&#41; in the new&#40;&#41;.
</div>
I can reproduce the crash with simple C code using the PLplot. I filed PLplot bug report &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/p/plplot/bugs/162/">https://sourceforge.net/p/plplot/bugs/162/</a></span>&gt;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;15:28:28&nbsp;2015</span>
    <span class="description">dhunt [...] ucar.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104424] Does not work with PLplot 5.11.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 May 2015 13:28:10 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDL-Graphics-PLplot [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Doug Hunt &lt;dhunt [...] ucar.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi all:  I&#39;m trying to find time to look at this.

Sorry for the delay,

   Doug Hunt

On 05/14/15 06:10, Petr Pisar via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: PDL-Graphics-PLplot
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104424">https://rt.cpan.org/Ticket/Display.html?id=104424</a></span> &gt;
&gt;
&gt; Dne Čt 14.Květen.2015 07:19:14, ppisar napsal&#40;a&#41;:
<div class="message-stanza open">&gt;&gt; After reading plplot-5.11.0/examples/perl/x02.pl example which itself
&gt;&gt; uses this Perl module, I think the bug is that the CHARSIZE option
&gt;&gt; invokes plschr&#40;&#41; before calling plinit&#40;&#41; in the new&#40;&#41;.
</div>&gt; I can reproduce the crash with simple C code using the PLplot. I filed PLplot bug report &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/p/plplot/bugs/162/">https://sourceforge.net/p/plplot/bugs/162/</a></span>&gt;.
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;15:28:28&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;03:35:31&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104424] Does not work with PLplot 5.11.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2015 09:35:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Douglas Hunt via RT &lt;bug-PDL-Graphics-PLplot [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, May 14, 2015 at 03:28:33PM -0400, Douglas Hunt via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104424">https://rt.cpan.org/Ticket/Display.html?id=104424</a></span> &gt;
&gt; 
&gt; Hi all:  I&#39;m trying to find time to look at this.
&gt; 
</div>Here is proper backward-compatible patch adding support for linking against
plplot-5.11.0. I verified it with plplot-5.10.0 too. The patch solves only the
plplotd to plplot rename. It does not solve the crash.

-- Petr
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From fb95787f2bcaff936e961665782c90becdf69963 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Thu, 14 May 2015 10:31:28 +0200
Subject: [PATCH] Search for plplotd before plplot library
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

PLplot 5.11.0 renamed the library from plplotd to plplot. This patch
checks first for plplotd and then for plplot library because older PLplot
versions could deliver both of them while only the plplotd supported
double precision.

This patch also corrects check for double precission support to use
discoverd linker flags.

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 Makefile.PL | 125 ++++++++++++++++++++++++++++++++++--------------------------
 1 file changed, 70 insertions&#40;+&#41;, 55 deletions&#40;-&#41;

diff --git a/Makefile.PL b/Makefile.PL
index 8e0938e..6072b29 100755
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -28,56 +28,68 @@ if &#40;!$pdl_installed&#41; {
   exit;
 }
 
-#
-## Search for plplot library and include file
-#
-print &#34;\nChecking PDL::Graphics::PLplot...\n&#34;;
-
-unlink &#40;&#34;OPTIONS!&#34;&#41;; # remove file used to communicate with plplot.pd
-
-# on OS-X the library is called libplplotd.dylib, so we
-# use $Config{&#34;so&#34;} to get the extension name
-#
-my $libname = &#34;libplplotd.&#34; . $Config{&#34;so&#34;};
-my $libname_static = &#34;libplplotd.a&#34;;
-my $incname = &#34;plplot.h&#34;;
-my $devnull = File::Spec-&gt;devnull&#40;&#41;; # Portable null device.
-
 # require bad value support.  D. Hunt 10/20/2008
 unless &#40;$PDL::Config{WITH_BADVAL}&#41; {
   buildDummy &#40;&#34;Bad value support required!  &#40;Turn on WITH_BADVAL in perldl.conf&#41;&#34;&#41;;
   return if &#40;caller&#41;; exit;
 }
 
+#
+## Search for plplot library and include file
+#
+print &#34;\nChecking PDL::Graphics::PLplot...\n&#34;;
 
-foreach my $libdir &#40;
-		    $ENV{PLPLOT_LIBDIR},
-		    $PDL::Config{WHERE_PLPLOT_LIBS},
-		    &#39;/usr/local/plplot/lib64&#39;,
-                    &#39;/usr/local/plplot/lib&#39;,
-		    &#39;/usr/local/lib64&#39;,
-		    &#39;/usr/local/lib&#39;,
-		    &#39;/opt/local/lib&#39;,
-		    &#39;/usr/lib64&#39;,
-		    &#39;/usr/lib&#39;,
-		    &#39;/opt/lib64&#39;,
-		    &#39;/opt/lib&#39;,
-		    &#39;/ops/tools/lib&#39;,
-                    &#39;/sw/lib/&#39;,    # default FINK installation
-		                  # Add new library paths here!!
-		    &#41; {
+unlink &#40;&#34;OPTIONS!&#34;&#41;; # remove file used to communicate with plplot.pd
+
+my $libbasename;
+my $libname;
+my $plplot_lib_path;
+
+# PLplot 5.11.0 renamed the library from plplotd to plplot. Search for both of
+# them.
+foreach &#40;&#39;plplotd&#39;, &#39;plplot&#39;&#41; {
+  # on OS-X the library is called libplplot.dylib, so we
+  # use $Config{&#34;so&#34;} to get the extension name
+  #
+  $libbasename = $_;
+  $libname = &#34;lib${libbasename}.&#34; . $Config{&#34;so&#34;};
+  my $libname_static = &#34;lib{$libbasename}.a&#34;;
+  print &#34;Searching for ${libname} library.\n&#34;;
+
+  foreach my $libdir &#40;
+              $ENV{PLPLOT_LIBDIR},
+              $PDL::Config{WHERE_PLPLOT_LIBS},
+              &#39;/usr/local/plplot/lib64&#39;,
+                      &#39;/usr/local/plplot/lib&#39;,
+              &#39;/usr/local/lib64&#39;,
+              &#39;/usr/local/lib&#39;,
+              &#39;/opt/local/lib&#39;,
+              &#39;/usr/lib64&#39;,
+              &#39;/usr/lib&#39;,
+              &#39;/opt/lib64&#39;,
+              &#39;/opt/lib&#39;,
+              &#39;/ops/tools/lib&#39;,
+                      &#39;/sw/lib/&#39;,    # default FINK installation
+                            # Add new library paths here!!
+              &#41; {
+
+    if &#40;-e &#34;$libdir/$libname&#34;&#41; {
+      $plplot_lib_path = $libdir;
+      $ENV{LD_LIBRARY_PATH} .= &#34;:$libdir&#34;;
+      last;
+    } elsif &#40;-e &#34;$libdir/$libname_static&#34;&#41; {
+      $plplot_lib_path = $libdir;
+      $ENV{LD_LIBRARY_PATH} .= &#34;:$libdir&#34;;
+      $libname = $libname_static;
+      last;
+    }
 
-  if &#40;-e &#34;$libdir/$libname&#34;&#41; {
-    $plplot_lib_path = $libdir;
-    $ENV{LD_LIBRARY_PATH} .= &#34;:$libdir&#34;;
-    last;
-  } elsif &#40;-e &#34;$libdir/$libname_static&#34;&#41; {
-    $plplot_lib_path = $libdir;
-    $ENV{LD_LIBRARY_PATH} .= &#34;:$libdir&#34;;
-    $libname = $libname_static;
-    last;
   }
 
+  if &#40;defined $plplot_lib_path&#41; {
+      print &#34;Found in ${plplot_lib_path}.\n&#34;;
+      last;
+  }
 }
 
 unless &#40;defined &#40;$plplot_lib_path&#41;&#41; {
@@ -85,6 +97,9 @@ unless &#40;defined &#40;$plplot_lib_path&#41;&#41; {
   return if &#40;caller&#41;; exit;
 }
 
+my $incname = &#34;plplot.h&#34;;
+my $devnull = File::Spec-&gt;devnull&#40;&#41;; # Portable null device.
+
 foreach my $incdir &#40;
 		    $ENV{PLPLOT_INCDIR},
 		    $PDL::Config{WHERE_PLPLOT_INCLUDE},
@@ -118,24 +133,12 @@ unless &#40;defined &#40;$plplot_include_path&#41;&#41; {
   return if &#40;caller&#41;; exit;
 }
 
-# Test that PLplot was compiled --with-double &#40;IE, a PLFLT is a double&#41;
-my $size = compileAndRun &#40;&#34;$plplot_include_path&#34;, 1, &lt;&lt;&#39;EOC&#39;&#41;;
-#include &lt;plplot.h&gt;
-main &#40;&#41; {  printf  &#40;&#34;%d&#34;, sizeof &#40;PLFLT&#41;&#41;; }
-EOC
-
-unless &#40;$size == 8&#41; {
-  print &#34;          Sizeof&#40;PLFLT&#41; must be 8. PLplot must be compiled --with-double &#40;IE ./configure --with-double&#41;\n&#34;;
-  buildDummy &#40;&#34;Cannot find good set of libraries for linking PLplot, try fiddling perldl.conf\n&#34;&#41;;
-  return if &#40;caller&#41;; exit;
-}
-
 # Try linking with library.  New if blocks should be added if necessary
 my $libs;
 foreach my $l &#40;
-	       &#34;-L$plplot_lib_path -lplplotd -lX11&#34;,
-	       &#34;-L$plplot_lib_path -lplplotd&#34;,
-             &#34;-L$plplot_lib_path -lplplotd -lqsastime -lcsirocsa -lgdi32 -lcomdlg32&#34;,
+	       &#34;-L$plplot_lib_path -l${libbasename} -lX11&#34;,
+	       &#34;-L$plplot_lib_path -l${libbasename}&#34;,
+             &#34;-L$plplot_lib_path -l${libbasename} -lqsastime -lcsirocsa -lgdi32 -lcomdlg32&#34;,
 	       # New lib combinations should be added here!
 	       &#41; {
   if &#40;trylink&#40; &#39;&#39;, &#39;#include &lt;plplot.h&gt;&#39;, &#39;plinit&#40;&#41;;&#39;, &#34;$l $plplot_include_path&#34;&#41;&#41; {
@@ -150,6 +153,18 @@ unless &#40;defined&#40;$libs&#41;&#41; {
   return if &#40;caller&#41;; exit;
 }
 
+# Test that PLplot was compiled --with-double &#40;IE, a PLFLT is a double&#41;
+my $size = compileAndRun &#40;&#34;$plplot_include_path $libs&#34;, 1, &lt;&lt;&#39;EOC&#39;&#41;;
+#include &lt;plplot.h&gt;
+main &#40;&#41; {  printf  &#40;&#34;%d&#34;, sizeof &#40;PLFLT&#41;&#41;; }
+EOC
+
+unless &#40;$size == 8&#41; {
+  print &#34;          Sizeof&#40;PLFLT&#41; must be 8. PLplot must be compiled --with-double &#40;IE ./configure --with-double&#41;\n&#34;;
+  buildDummy &#40;&#34;PLplot was not compiled --with-double, try fiddling perldl.conf\n&#34;&#41;;
+  return if &#40;caller&#41;; exit;
+}
+
 #
 ## Tests for various PLplot features, present in different versions of PLplot
 #
-- 
2.1.0

</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;05:18:43&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104424] Does not work with PLplot 5.11.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2015 11:18:31 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Douglas Hunt via RT &lt;bug-PDL-Graphics-PLplot [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, May 14, 2015 at 03:28:33PM -0400, Douglas Hunt via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104424">https://rt.cpan.org/Ticket/Display.html?id=104424</a></span> &gt;
&gt; 
&gt; Hi all:  I&#39;m trying to find time to look at this.
&gt; 
</div>And here is a workaround for the crash. I tried differnt orderings of calls,
but it looks like some needs to be called before plinit&#40;&#41;, so I applied the
least change.

-- Petr
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 85865109e9b2455bfe2cec8c947dcbab4942f0e9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Fri, 15 May 2015 09:38:15 +0200
Subject: [PATCH] Postpone setting CHARSIZE after initializing plplot
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Since PLplot 5.11.0, calling plschr&#40;&#41; before plinit&#40;&#41; leads to crash.
Reproducer:

$ perl -MPDL -MPDL::Graphics::PLplot -e &#39;PDL::Graphics::PLplot-&gt;new&#40;&#41;&#39;

This patch moves setting CHARSIZE after calling plinit&#40;&#41;.

&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=104424">https://rt.cpan.org/Public/Bug/Display.html?id=104424</a></span>&gt;
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/p/plplot/bugs/162/">https://sourceforge.net/p/plplot/bugs/162/</a></span>&gt;

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 plplot.pd | 11 +++++++++++
 1 file changed, 11 insertions&#40;+&#41;

diff --git a/plplot.pd b/plplot.pd
index 4410604..c3b74e1 100644
--- a/plplot.pd
+++ b/plplot.pd
@@ -1516,6 +1516,14 @@ sub new {
 	      CHARSIZE   =&gt; 1,
 	      @_&#41;;
 
+  # Since PLplot 5.11.0, calling plschr&#40;&#41; before plinit&#40;&#41; cases a crash
+  # &#40;CPAN RT#104424&#41;. Postpone setting CHARSIZE after plinit&#40;&#41;.
+  my %postinit_opts;
+  for my $option &#40;&#39;CHARSIZE&#39;&#41; {
+    if &#40;exists $opts{$option}&#41; {
+      $postinit_opts{$option} = delete $opts{$option};
+    }
+  }
 
   # apply options
   $self-&gt;setparm&#40;%opts&#41;;
@@ -1528,6 +1536,9 @@ sub new {
   plscmap1n &#40;128&#41;;  # set map 1 to 128 colors &#40;should work for devices with 256 colors&#41;
   plinit &#40;&#41;;
 
+  # apply post-plinit options
+  $self-&gt;setparm&#40;%postinit_opts&#41;;
+
   # set page orientation
   plsdiori &#40;$self-&gt;{ORIENTATION}&#41;;
 
-- 
2.1.0

</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;10:55:54&nbsp;2015</span>
    <span class="description">dhunt [...] ucar.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104424] Does not work with PLplot 5.11.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2015 08:55:42 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDL-Graphics-PLplot [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Doug Hunt &lt;dhunt [...] ucar.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks!

--Doug

On 05/15/15 01:35, Petr Pisar via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: PDL-Graphics-PLplot
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104424">https://rt.cpan.org/Ticket/Display.html?id=104424</a></span> &gt;
&gt;
&gt; On Thu, May 14, 2015 at 03:28:33PM -0400, Douglas Hunt via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104424">https://rt.cpan.org/Ticket/Display.html?id=104424</a></span> &gt;
&gt;&gt;
&gt;&gt; Hi all:  I&#39;m trying to find time to look at this.
&gt;&gt;
</div>&gt; Here is proper backward-compatible patch adding support for linking against
&gt; plplot-5.11.0. I verified it with plplot-5.10.0 too. The patch solves only the
&gt; plplotd to plplot rename. It does not solve the crash.
&gt;
&gt; -- Petr
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;17:11:00&nbsp;2015</span>
    <span class="description">dhunt [...] ucar.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104424] Does not work with PLplot 5.11.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2015 15:10:47 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDL-Graphics-PLplot [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Doug Hunt &lt;dhunt [...] ucar.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Petr:  I&#39;ve uploaded a new version of PDL-Graphics-PLplot to PAUSE:

PDL-Graphics-PLplot-0.71.tar.gz

  which incorporates your patch and also defers calling plscrh&#40;&#41; until 
after the call to plinit&#40;&#41;.

I&#39;ve tested this with your combination:

plplot-5.11.0, PDL-2.7.0, perl-5.20.2 on Linux CentOS 6.

I&#39;ve also tested with

perl 5.16.1, PDL 2.4.11 and plplot 5.9.10 on CentOS 6.

Now all tests under PDL-Graphics-PLplot pass.

Best Regards,

   Doug Hunt


On 05/15/15 01:35, Petr Pisar via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: PDL-Graphics-PLplot
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104424">https://rt.cpan.org/Ticket/Display.html?id=104424</a></span> &gt;
&gt;
&gt; On Thu, May 14, 2015 at 03:28:33PM -0400, Douglas Hunt via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104424">https://rt.cpan.org/Ticket/Display.html?id=104424</a></span> &gt;
&gt;&gt;
&gt;&gt; Hi all:  I&#39;m trying to find time to look at this.
&gt;&gt;
</div>&gt; Here is proper backward-compatible patch adding support for linking against
&gt; plplot-5.11.0. I verified it with plplot-5.10.0 too. The patch solves only the
&gt; plplotd to plplot rename. It does not solve the crash.
&gt;
&gt; -- Petr
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;06&nbsp;15:15:46&nbsp;2015</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">There is a typo in the patch: &quot;lib{$libbasename}.a&quot; vs. &quot;lib${libbasename}.a&quot;<br>

<br>

I have included a fix in my patch attached to <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105024">https://rt.cpan.org/Ticket/Display.html?id=105024</a></span>
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
