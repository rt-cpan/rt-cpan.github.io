<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #85781 for Digest-SHA: Concerns about constant-time HMAC comparison</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #85781 for Digest-SHA: Concerns about constant-time HMAC comparison</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Digest-SHA">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Digest-SHA">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Digest-SHA">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Digest-SHA">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-SHA">Digest-SHA CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">85781</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Digest-SHA">Digest-SHA</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dagolden [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-11544-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-11545-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=85781">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219070" href="/Public/Bug/Display.html?id=85781#txn-1219070">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;31&nbsp;23:27:28&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Concerns about constant-time HMAC comparison</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219070/643764/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/643764">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 523b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was recently pointed to String::Compare::ConstantTime and warned about the risks in using Perl&#39;s &#39;eq&#39; operator to compare HMACs.

I would suggest you consider adding an equivalent function -- which I admit is a bit of API bloat -- or at least mention in the documentation that HMACs shouldn&#39;t be compared with eq and suggest some options.

String::Compare::ConstantTime uses XS and is quite fast.  I believe a roughly-comparable pure-perl alternative would be C&lt;&lt; 0 == unpack&#40;&#34;%32C*&#34;, $got ^ $expect&#41; &gt;&gt;.

Regards,
David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219151" href="/Public/Bug/Display.html?id=85781#txn-1219151">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;01&nbsp;11:52:50&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219151/643812/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/643812">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1005b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Your suggestion might indeed be useful as part of a toolkit module for cryptographic application developers.  I would encourage you to pursue that idea, or to collaborate with others who might already be working on such a module.

But realize that timing attacks are just one small slice of the myriad threats that such developers need to be concerned about.  Focusing solely on timing attacks is both insufficient and arbitrary.

Timing attacks can be relevant to any process using secrets &#40;keys&#41;, not just to HMAC algorithms.  More importantly in this case, the timing attacks wouldn&#39;t actually be performed on the HMACs themselves: they are assumed to be public.  Only the keys are hidden.

Note that the HMAC algorithm uses the key exclusively during initialization of the digest context &#40;ref. hmacopen&#41;, which is a very small part of the overall digest computation.  It&#39;s difficult to see how an eavesdropper could obtain any reliable information about the key from timing data on the hmac functions.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219152" href="/Public/Bug/Display.html?id=85781#txn-1219152">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;01&nbsp;11:52:51&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219154" href="/Public/Bug/Display.html?id=85781#txn-1219154">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;01&nbsp;11:52:51&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219270" href="/Public/Bug/Display.html?id=85781#txn-1219270">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;01&nbsp;23:16:16&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85781] Concerns about constant-time HMAC comparison</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 1 Jun 2013 23:15:30 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Digest-SHA [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219270/643877/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/643877">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">As it was explained to me, given an arbitrary &#40;hostile&#41; message,
enough randomly-generated MACs get sent to allow statistical analysis
of the timing.  Because standard &#39;eq&#39; shortcuts once there is a byte
difference, timing analysis reveals the first byte of the correct MAC
for that message -- without knowledge of the key.  Etc. until the
entire MAC for the message is discovered.  A constant-time equality
comparison ensures there&#39;s no way to determine how much of a MAC is
correct and thus no way to use a timing attack to forge a MAC without
the key.

I would assume the usual real-world practicality of such an attack
apply, but it was something that I never considered.  So a little note
along the lines of &#34;hey, when you check the HMAC, don&#39;t use &#39;eq&#39;&#34;
would be enough to help clue in the clueless.  :-&#41;

David


On Sat, Jun 1, 2013 at 11:52 AM, Mark Shelor via RT
&lt;bug-Digest-SHA@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=85781">https://rt.cpan.org/Ticket/Display.html?id=85781</a></span> &gt;
&gt;
&gt; Your suggestion might indeed be useful as part of a toolkit module for cryptographic application developers.  I would encourage you to pursue that idea, or to collaborate with others who might already be working on such a module.
&gt;
&gt; But realize that timing attacks are just one small slice of the myriad threats that such developers need to be concerned about.  Focusing solely on timing attacks is both insufficient and arbitrary.
&gt;
&gt; Timing attacks can be relevant to any process using secrets &#40;keys&#41;, not just to HMAC algorithms.  More importantly in this case, the timing attacks wouldn&#39;t actually be performed on the HMACs themselves: they are assumed to be public.  Only the keys are hidden.
&gt;
&gt; Note that the HMAC algorithm uses the key exclusively during initialization of the digest context &#40;ref. hmacopen&#41;, which is a very small part of the overall digest computation.  It&#39;s difficult to see how an eavesdropper could obtain any reliable information about the key from timing data on the hmac functions.
</div>


-- 
David Golden &lt;dagolden@cpan.org&gt;
Take back your inbox! → <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bunchmail.com/">http://www.bunchmail.com/</a></span>
Twitter/IRC: @xdg
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219311" href="/Public/Bug/Display.html?id=85781#txn-1219311">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;02&nbsp;05:04:37&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219311/643895/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/643895">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Indeed, that&#39;s how one particular variant of a timing attack works.  But discovering a MAC by such a process is useless because--as stated previously--the MAC is already public to begin with.  The goal of the attacker is to discover the *key*, not the MAC.  Without the key, it&#39;s impossible to forge a correct MAC for a given arbitrary message.

When an eavesdropper sees a particular message with corresponding MAC pass over the network, he now knows the correct MAC for that message.  This means that the eavesdropper could now spoof the receiver by sending that same message &#40;and MAC&#41; again.  This is known as a replay attack.  However such attacks are usually foiled by insisting that the message contain a random nonce or sequence number such that all messages to the receiver are guaranteed to be distinct.  Because each message is distinct, each MAC will be distinct as well and therefore can&#39;t be forged without knowledge of the key.

Threat scenarios are varied and complex.  Oftentimes, special protocols need to be employed to combat them.  But this is in the province of the cryptographic application developer, not the digest algorithm implementer.  The sole purpose of Digest::SHA is to implement the FIPS 180-4 algorithms in a complete, compact, efficient, and easy-to-use set of routines accessible to the Perl programmer.

Documenting the myriad threat scenarios relevant to cryptographic application developers is clearly outside the scope of the Digest::SHA module.  Even mentioning particular instances of such threats is irresponsible since it would give the mis-impression that the module also serves as a tutorial to cryptographic application developers, which it clearly is not.  Such tutorials are best left to experts in that area.

Mark


On Sat Jun 01 23:16:16 2013, DAGOLDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As it was explained to me, given an arbitrary &#40;hostile&#41; message,
&gt; enough randomly-generated MACs get sent to allow statistical analysis
&gt; of the timing.  Because standard &#39;eq&#39; shortcuts once there is a byte
&gt; difference, timing analysis reveals the first byte of the correct MAC
&gt; for that message -- without knowledge of the key.  Etc. until the
&gt; entire MAC for the message is discovered.  A constant-time equality
&gt; comparison ensures there&#39;s no way to determine how much of a MAC is
&gt; correct and thus no way to use a timing attack to forge a MAC without
&gt; the key.
&gt; 
&gt; I would assume the usual real-world practicality of such an attack
&gt; apply, but it was something that I never considered.  So a little note
&gt; along the lines of &#34;hey, when you check the HMAC, don&#39;t use &#39;eq&#39;&#34;
&gt; would be enough to help clue in the clueless.  :-&#41;
&gt; 
&gt; David
&gt; 
&gt; 
&gt; On Sat, Jun 1, 2013 at 11:52 AM, Mark Shelor via RT
&gt; &lt;bug-Digest-SHA@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=85781">https://rt.cpan.org/Ticket/Display.html?id=85781</a></span> &gt;
&gt; &gt;
&gt; &gt; Your suggestion might indeed be useful as part of a toolkit module
</div>&gt;    for cryptographic application developers.  I would encourage you to
&gt;    pursue that idea, or to collaborate with others who might already
&gt;    be working on such a module.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; But realize that timing attacks are just one small slice of the
</div>&gt;    myriad threats that such developers need to be concerned about.
&gt;    Focusing solely on timing attacks is both insufficient and
&gt;    arbitrary.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Timing attacks can be relevant to any process using secrets &#40;keys&#41;,
</div>&gt;    not just to HMAC algorithms.  More importantly in this case, the
&gt;    timing attacks wouldn&#39;t actually be performed on the HMACs
&gt;    themselves: they are assumed to be public.  Only the keys are
&gt;    hidden.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Note that the HMAC algorithm uses the key exclusively during
</div>&gt;    initialization of the digest context &#40;ref. hmacopen&#41;, which is a
&gt;    very small part of the overall digest computation.  It&#39;s difficult
&gt;    to see how an eavesdropper could obtain any reliable information
&gt;    about the key from timing data on the hmac functions.
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219416" href="/Public/Bug/Display.html?id=85781#txn-1219416">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;02&nbsp;14:48:29&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85781] Concerns about constant-time HMAC comparison</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 2 Jun 2013 14:47:44 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Digest-SHA [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219416/643942/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/643942">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Jun 2, 2013 at 5:04 AM, Mark Shelor via RT
&lt;bug-Digest-SHA@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Indeed, that&#39;s how one particular variant of a timing attack works.  But discovering a MAC by such a process is useless because--as stated previously--the MAC is already public to begin with.  The goal of the attacker is to discover the *key*, not the MAC.  Without the key, it&#39;s impossible to forge a correct MAC for a given arbitrary message.
</div>
You&#39;ve misunderstood me.  The timing attack doesn&#39;t reveal the key.
It discovers a valid MAC for an arbitrary message *without* knowing
the key.  E.g. for a given message &#40;including nonce value&#41;, create 256
MACs with different first bytes.  Send thousands of those to the
server and recording timing of failure.  1 of those 256 will take
longer because the server checked two bytes of the string to find
inequality instead of just one byte.  Now the first byte of the MAC
for that message is known.  Create 256 MACs with the discovered first
byte and different second bytes.  Send thousands of those.  Again, one
of the 256 will take longer. Repeat until the correct MAC for the
arbitrary message is discovered.

See <span class="clickylink"><a target="new" rel="nofollow" href="http://rdist.root.org/2009/05/28/timing-attack-in-google-keyczar-library/">http://rdist.root.org/2009/05/28/timing-attack-in-google-keyczar-library/</a></span>
for more.

That said, I can respect your position that you don&#39;t want Digest::SHA
to attempt to be a crypto tutorial.  Please feel free to close the
ticket.

Regards,
David

--
David Golden &lt;dagolden@cpan.org&gt;
Take back your inbox! → <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bunchmail.com/">http://www.bunchmail.com/</a></span>
Twitter/IRC: @xdg
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219455" href="/Public/Bug/Display.html?id=85781#txn-1219455">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;02&nbsp;20:12:35&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219455/643964/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/643964">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I see.  Thanks for the clarification.

We nonetheless concur on the main point that such attacks are beyond the scope of Digest::SHA to either handle or document.  However, that fact doesn&#39;t cause your original concern to disappear.  So the question becomes: where and how do you intend to address it?  You might have the basis there for a new and very useful CPAN module.  A daunting task, though.

Mark


On Sun Jun 02 14:48:29 2013, DAGOLDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun, Jun 2, 2013 at 5:04 AM, Mark Shelor via RT
&gt; &lt;bug-Digest-SHA@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; Indeed, that&#39;s how one particular variant of a timing attack works.
</div>&gt;    But discovering a MAC by such a process is useless because--as
&gt;    stated previously--the MAC is already public to begin with.  The
&gt;    goal of the attacker is to discover the *key*, not the MAC.
&gt;    Without the key, it&#39;s impossible to forge a correct MAC for a given
&gt;    arbitrary message.
&gt; 
&gt; You&#39;ve misunderstood me.  The timing attack doesn&#39;t reveal the key.
&gt; It discovers a valid MAC for an arbitrary message *without* knowing
&gt; the key.  E.g. for a given message &#40;including nonce value&#41;, create 256
&gt; MACs with different first bytes.  Send thousands of those to the
&gt; server and recording timing of failure.  1 of those 256 will take
&gt; longer because the server checked two bytes of the string to find
&gt; inequality instead of just one byte.  Now the first byte of the MAC
&gt; for that message is known.  Create 256 MACs with the discovered first
&gt; byte and different second bytes.  Send thousands of those.  Again, one
&gt; of the 256 will take longer. Repeat until the correct MAC for the
&gt; arbitrary message is discovered.
&gt; 
&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="http://rdist.root.org/2009/05/28/timing-attack-in-google-keyczar-">http://rdist.root.org/2009/05/28/timing-attack-in-google-keyczar-</a></span>
&gt;    library/
&gt; for more.
&gt; 
&gt; That said, I can respect your position that you don&#39;t want Digest::SHA
&gt; to attempt to be a crypto tutorial.  Please feel free to close the
&gt; ticket.
&gt; 
&gt; Regards,
&gt; David
&gt; 
&gt; --
&gt; David Golden &lt;dagolden@cpan.org&gt;
&gt; Take back your inbox! → <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bunchmail.com/">http://www.bunchmail.com/</a></span>
&gt; Twitter/IRC: @xdg
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219464" href="/Public/Bug/Display.html?id=85781#txn-1219464">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;02&nbsp;21:13:32&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85781] Concerns about constant-time HMAC comparison</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 2 Jun 2013 21:12:48 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Digest-SHA [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219464/643969/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/643969">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think that String::Compare::ConstantTime does a fair job at
documenting the issues, but what really seems to be needed is a
higher-level crypto library that helps people not shoot themselves in
the foot.  I&#39;m pretty sure I&#39;m not qualified to do an excellent job of
it, but maybe I can start a project and rally participants.  Sort of
the crypto equivalent of the DateTime project.

David


On Sun, Jun 2, 2013 at 8:12 PM, Mark Shelor via RT
&lt;bug-Digest-SHA@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=85781">https://rt.cpan.org/Ticket/Display.html?id=85781</a></span> &gt;
&gt;
&gt; I see.  Thanks for the clarification.
&gt;
&gt; We nonetheless concur on the main point that such attacks are beyond the scope of Digest::SHA to either handle or document.  However, that fact doesn&#39;t cause your original concern to disappear.  So the question becomes: where and how do you intend to address it?  You might have the basis there for a new and very useful CPAN module.  A daunting task, though.
&gt;
&gt; Mark
&gt;
&gt;
&gt; On Sun Jun 02 14:48:29 2013, DAGOLDEN wrote:
<div class="message-stanza open">&gt;&gt; On Sun, Jun 2, 2013 at 5:04 AM, Mark Shelor via RT
&gt;&gt; &lt;bug-Digest-SHA@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt;&gt; &gt; Indeed, that&#39;s how one particular variant of a timing attack works.
</div>&gt;&gt;    But discovering a MAC by such a process is useless because--as
&gt;&gt;    stated previously--the MAC is already public to begin with.  The
&gt;&gt;    goal of the attacker is to discover the *key*, not the MAC.
&gt;&gt;    Without the key, it&#39;s impossible to forge a correct MAC for a given
&gt;&gt;    arbitrary message.
&gt;&gt;
&gt;&gt; You&#39;ve misunderstood me.  The timing attack doesn&#39;t reveal the key.
&gt;&gt; It discovers a valid MAC for an arbitrary message *without* knowing
&gt;&gt; the key.  E.g. for a given message &#40;including nonce value&#41;, create 256
&gt;&gt; MACs with different first bytes.  Send thousands of those to the
&gt;&gt; server and recording timing of failure.  1 of those 256 will take
&gt;&gt; longer because the server checked two bytes of the string to find
&gt;&gt; inequality instead of just one byte.  Now the first byte of the MAC
&gt;&gt; for that message is known.  Create 256 MACs with the discovered first
&gt;&gt; byte and different second bytes.  Send thousands of those.  Again, one
&gt;&gt; of the 256 will take longer. Repeat until the correct MAC for the
&gt;&gt; arbitrary message is discovered.
&gt;&gt;
&gt;&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="http://rdist.root.org/2009/05/28/timing-attack-in-google-keyczar-">http://rdist.root.org/2009/05/28/timing-attack-in-google-keyczar-</a></span>
&gt;&gt;    library/
&gt;&gt; for more.
&gt;&gt;
&gt;&gt; That said, I can respect your position that you don&#39;t want Digest::SHA
&gt;&gt; to attempt to be a crypto tutorial.  Please feel free to close the
&gt;&gt; ticket.
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; David
&gt;&gt;
&gt;&gt; --
&gt;&gt; David Golden &lt;dagolden@cpan.org&gt;
&gt;&gt; Take back your inbox! → <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bunchmail.com/">http://www.bunchmail.com/</a></span>
&gt;&gt; Twitter/IRC: @xdg
</div>&gt;
&gt;
&gt;
</div>


-- 
David Golden &lt;dagolden@cpan.org&gt;
Take back your inbox! → <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bunchmail.com/">http://www.bunchmail.com/</a></span>
Twitter/IRC: @xdg
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.416334</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
