<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68043 for Authen-Passphrase: [PATCH] Adding a feature which implements &#34;hash based key stretching&#34;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68043 for Authen-Passphrase: [PATCH] Adding a feature which implements &#34;hash based key stretching&#34;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Authen-Passphrase/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Authen-Passphrase/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Authen-Passphrase/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Authen-Passphrase/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Authen-Passphrase">Authen-Passphrase CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68043</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Authen-Passphrase/Active/">Authen-Passphrase</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MORIYA [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-39646-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39647-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;09&nbsp;12:34:04&nbsp;2011</span>
    <span class="description">MORIYA [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Adding a feature which implements &#34;hash based key stretching&#34;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

the attached patch tries to add &#34;hash based key stretching&#34; &#40;*1&#41;
optional feature to Authen::Passphrase::SaltedDigest and to change
t/smd5.t and t/ssha.t for verify the feature.

The feature was mentioned in some standard books &#40;*2&#41; and implemented
in several software such as crypt &#40;*3&#41; and WAF &#40;web application
framework&#41; &#40;*4&#41;.  Users of the nice module will can opt for a stronger
way to hash a salted passphrase.

Feel free to adjust accordingly for the next release if you like it.


[A supplementary explanation]

Sorry to be speculation, perhaps you will think that the &#34;optional&#34;
feature should be implemented on the side of an WAF such as
Catalyst::Authentication::Credential::Password.  However, in my opinion,
the it is not the best way.

Let me humbly say, the recent trend is not to depend on WAF for
model-associated procedures but to handle it by home-brew POPO &#40;plain
old perl object&#41;.  In doing so, we will gain more maintainability and
more testability because it POPO model will can be used in both WAF and
others such as CLI &#40;command-line interface&#41; and test scripts.


[Footnotes]

*1&#41; <span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Key_stretching#Hash_based_key_stretching">http://en.wikipedia.org/wiki/Key_stretching#Hash_based_key_stretching</a></span>
*2&#41; &#34;Cryptography Engineering&#34;
    by Niels Ferguson, Bruce Schneier and Tadayoshi Kohno
    &#40;ISBN-13: 978-0470474242&#41;
*3&#41; man 3 crypt
    <span class="clickylink"><a target="new" rel="nofollow" href="http://www.kernel.org/doc/man-pages/online/pages/man3/crypt.3.html">http://www.kernel.org/doc/man-pages/online/pages/man3/crypt.3.html</a></span>
*4&#41; &#34;restful_authentication&#34;, the famous plug-in for Ruby on Rails
    <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/technoweenie/restful-authentication">https://github.com/technoweenie/restful-authentication</a></span>


I appreciate your consideration.

Regards,
-- 
MORIYA Masaki, alias Gardejo
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> add-stretching.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -crN original\lib\Authen\Passphrase\SaltedDigest.pm patched\lib\Authen\Passphrase\SaltedDigest.pm
*** original\lib\Authen\Passphrase\SaltedDigest.pm	Sat Jul 31 03:41:06 2010
--- patched\lib\Authen\Passphrase\SaltedDigest.pm	Tue May 10 01:18:44 2011
***************
*** 151,156 ****
--- 151,161 ----
  
  A passphrase that will be accepted.
  
+ =item B&lt;stretch_count&gt;
+ 
+ A stretching frequency, as a positive integer.  Defaults to the empty
+ integer, yielding a scheme that will be stretched one time.
+ 
  =back
  
  The digest algorithm must be given, and either the hash or the passphrase.
***************
*** 205,216 ****
--- 210,226 ----
  				if exists&#40;$self-&gt;{hash}&#41; ||
  					defined&#40;$passphrase&#41;;
  			$passphrase = $value;
+ 		} elsif&#40;$attr eq &#34;stretch_count&#34;&#41; {
+ 			croak &#34;\&#34;$value\&#34; is not a valid stretch count&#34;
+ 				unless $value == int&#40;$value&#41; &#38;&#38; $value &gt; 0;
+ 			$self-&gt;{stretch_count} = $value;
  		} else {
  			croak &#34;unrecognised attribute `$attr&#39;&#34;;
  		}
  	}
  	croak &#34;algorithm not specified&#34; unless exists $self-&gt;{algorithm};
  	$self-&gt;{salt} = &#34;&#34; unless exists $self-&gt;{salt};
+ 	$self-&gt;{stretch_count} = 1 unless exists $self-&gt;{stretch_count};
  	if&#40;defined $passphrase&#41; {
  		$self-&gt;{hash} = $self-&gt;_hash_of&#40;$passphrase&#41;;
  	} elsif&#40;exists $self-&gt;{hash}&#41; {
***************
*** 248,254 ****
  &#41;;
  
  sub from_rfc2307 {
! 	my&#40;$class, $userpassword&#41; = @_;
  	return $class-&gt;SUPER::from_rfc2307&#40;$userpassword&#41;
  		unless $userpassword =~ /\A\{&#40;[-0-9A-Za-z]+&#41;\}/;
  	my $scheme = uc&#40;$1&#41;;
--- 258,264 ----
  &#41;;
  
  sub from_rfc2307 {
! 	my&#40;$class, $userpassword, $stretch_count&#41; = @_;
  	return $class-&gt;SUPER::from_rfc2307&#40;$userpassword&#41;
  		unless $userpassword =~ /\A\{&#40;[-0-9A-Za-z]+&#41;\}/;
  	my $scheme = uc&#40;$1&#41;;
***************
*** 267,273 ****
--- 277,290 ----
  		if length&#40;$hash_and_salt&#41; &lt; $hash_len;
  	croak &#34;too much hash data for {$scheme}&#34;
  		if !$salt_allowed &#38;&#38; length&#40;$hash_and_salt&#41; &gt; $hash_len;
+ 	if &#40;defined $stretch_count&#41; {
+ 		croak &#34;\&#34;$stretch_count\&#34; is not a valid stretch count&#34;
+ 			unless $stretch_count == int&#40;$stretch_count&#41; &#38;&#38; $stretch_count &gt; 0;
+ 	} else {
+ 		$stretch_count = 1;
+ 	}
  	return $class-&gt;new&#40;algorithm =&gt; $algorithm,
+ 		stretch_count =&gt; $stretch_count,
  		salt =&gt; substr&#40;$hash_and_salt, $hash_len&#41;,
  		hash =&gt; substr&#40;$hash_and_salt, 0, $hash_len&#41;&#41;;
  }
***************
*** 373,381 ****
  	} else {
  		croak &#34;algorithm specifier `$alg&#39; is of an unrecognised type&#34;;
  	}
! 	$ctx-&gt;add&#40;$passphrase&#41;;
! 	$ctx-&gt;add&#40;$self-&gt;{salt}&#41;;
! 	return $ctx-&gt;digest;
  }
  
  sub match {
--- 390,403 ----
  	} else {
  		croak &#34;algorithm specifier `$alg&#39; is of an unrecognised type&#34;;
  	}
! 	my $digest = &#34;&#34;;
! 	foreach my $count &#40;1 .. $self-&gt;{stretch_count}&#41; {
! 		$ctx-&gt;add&#40;$digest&#41;;
! 		$ctx-&gt;add&#40;$passphrase&#41;;
! 		$ctx-&gt;add&#40;$self-&gt;{salt}&#41;;
! 	    $digest = $ctx-&gt;digest;
! 	}
! 	return $digest;
  }
  
  sub match {
diff -crN original\t\smd5.t patched\t\smd5.t
*** original\t\smd5.t	Sat Jul 31 03:41:06 2010
--- patched\t\smd5.t	Tue May 10 01:10:52 2011
***************
*** 1,7 ****
  use warnings;
  use strict;
  
! use Test::More tests =&gt; 81;
  
  use MIME::Base64 2.21 qw&#40;encode_base64&#41;;
  
--- 1,7 ----
  use warnings;
  use strict;
  
! use Test::More tests =&gt; 86;
  
  use MIME::Base64 2.21 qw&#40;encode_base64&#41;;
  
***************
*** 25,38 ****
  is $ppr-&gt;hash_hex, &#34;04bd9d36c5c5497984a2670ed2442f9d&#34;;
  like $ppr-&gt;as_rfc2307, qr/\A\{SMD5\}/;
  
! $ppr = Authen::Passphrase::SaltedDigest
! 		-&gt;new&#40;algorithm =&gt; &#34;MD5&#34;, salt_random =&gt; 13,
! 		      passphrase =&gt; &#34;wibble&#34;&#41;;
! ok $ppr;
! is length&#40;$ppr-&gt;salt&#41;, 13;
! is length&#40;$ppr-&gt;hash&#41;, 16;
! like $ppr-&gt;as_rfc2307, qr/\A\{SMD5\}/;
! ok $ppr-&gt;match&#40;&#34;wibble&#34;&#41;;
  
  my %pprs;
  my $i = 0;
--- 25,40 ----
  is $ppr-&gt;hash_hex, &#34;04bd9d36c5c5497984a2670ed2442f9d&#34;;
  like $ppr-&gt;as_rfc2307, qr/\A\{SMD5\}/;
  
! foreach my $stretch_count &#40;1, 10&#41; {
! 	$ppr = Authen::Passphrase::SaltedDigest
! 			-&gt;new&#40;algorithm =&gt; &#34;MD5&#34;, salt_random =&gt; 13,
! 			      passphrase =&gt; &#34;wibble&#34;, stretch_count =&gt; $stretch_count&#41;;
! 	ok $ppr;
! 	is length&#40;$ppr-&gt;salt&#41;, 13;
! 	is length&#40;$ppr-&gt;hash&#41;, 16;
! 	like $ppr-&gt;as_rfc2307, qr/\A\{SMD5\}/;
! 	ok $ppr-&gt;match&#40;&#34;wibble&#34;&#41;;
! }
  
  my %pprs;
  my $i = 0;
diff -crN original\t\ssha.t patched\t\ssha.t
*** original\t\ssha.t	Sat Jul 31 03:41:06 2010
--- patched\t\ssha.t	Tue May 10 01:28:16 2011
***************
*** 1,7 ****
  use warnings;
  use strict;
  
! use Test::More tests =&gt; 70;
  
  use MIME::Base64 2.21 qw&#40;encode_base64&#41;;
  
--- 1,7 ----
  use warnings;
  use strict;
  
! use Test::More tests =&gt; 80;
  
  use MIME::Base64 2.21 qw&#40;encode_base64&#41;;
  
***************
*** 13,18 ****
--- 13,41 ----
  is $ppr-&gt;algorithm, &#34;SHA-1&#34;;
  is $ppr-&gt;salt_hex, &#34;f5895a0c&#34;;
  is $ppr-&gt;hash_hex, &#34;4aedd0ba6148469d7115f459e3d8706899a67bea&#34;;
+ 
+ my $salt_hex = &#34;112233&#34;;
+ my $hash_hex = &#34;893a490e37b4795e29f7f93f15c9b8d30b25b506&#34;;
+ my $rightphrase = &#34;passphrase&#34;;
+ $ppr = Authen::Passphrase::SaltedDigest
+ 		-&gt;from_rfc2307&#40;&#34;{SSHA}iTpJDje0eV4p9/k/Fcm40wsltQYRIjM=&#34;, 10&#41;;
+ ok $ppr;
+ is $ppr-&gt;salt_hex, $salt_hex;
+ is $ppr-&gt;hash_hex, $hash_hex;
+ ok $ppr-&gt;match&#40;$rightphrase&#41;;
+ 
+ my @options = &#40;{hash_hex =&gt; $hash_hex}, {passphrase =&gt; $rightphrase}&#41;;
+ foreach my $option &#40;@options&#41; {
+ 	my $ppr = Authen::Passphrase::SaltedDigest
+ 			-&gt;new&#40;algorithm =&gt; &#34;SHA-1&#34;,
+ 			      salt_hex =&gt; $salt_hex,
+ 			      %$option,
+ 			      stretch_count =&gt; 10&#41;;
+ 	ok $ppr;
+ 	foreach my $passphrase &#40;$rightphrase, $rightphrase . &#39;blahblahblah&#39;&#41; {
+ 	    ok &#40;$ppr-&gt;match&#40;$passphrase&#41; xor $passphrase ne $rightphrase&#41;;
+ 	}
+ }
  
  my %pprs;
  my $i = 0;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;09&nbsp;12:45:13&nbsp;2011</span>
    <span class="description">MORIYA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m sorry, I made a typo:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the it is not the best way.
</div>I collect it as the below:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; it is not the best way.
</div>
-- 
MORIYA Masaki, alias Gardejo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;09&nbsp;12:45:14&nbsp;2011</span>
    <span class="description">MORIYA [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;09&nbsp;12:52:43&nbsp;2011</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68043] [PATCH] Adding a feature which implements &#34;hash based key stretching&#34;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 May 2011 17:52:31 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> MORIYA Masaki via RT &lt;bug-Authen-Passphrase [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">MORIYA Masaki via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;the attached patch tries to add &#34;hash based key stretching&#34; &#40;*1&#41;
&gt;optional feature to Authen::Passphrase::SaltedDigest
</div>
This stretching scheme, if it is indeed used for passphrase hashing
&#40;which I need to research a bit&#41;, is indeed suitable material for
the Authen::Passphrase suite.  However, I&#39;m not convinced that
A:P:SaltedDigest is the right place for it.  I think it would fit
better as a separate class, since there are many other ways in which
the SaltedDigest scheme can be modified.  This is akin to the way the
multi-block extensions of traditional DES crypt&#40;&#41; are implemented in
separate modules A:P:BigCrypt and A:P:Crypt16 rather than being included
in A:P:DESCrypt.  &#40;Though I did include BSDi&#39;s minor extension in the
latter.&#41;

In any case, your proposed extension to the from_rfc2307 interface is
not acceptable.  The purpose of the RFC 2307 format is to represent
the whole passphrase recogniser in one text string, and the method
interface reflects that.  The stretch count cannot be a separate parameter
that changes the interpretation of an RFC 2307 string; it needs to be
incorporated into the string.  I&#39;ll omit any scheme for doing this until
there&#39;s a de facto standard.

I&#39;ll examine the pages you&#39;ve linked to.  I&#39;ll probably implement the
stretching scheme as a separate class under Authen::Passphrase, with
&#40;initially&#41; no textual format.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;09&nbsp;13:31:00&nbsp;2011</span>
    <span class="description">MORIYA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you very much for prompt and detailed reply.

I am glad that you considered implementing of the stretching scheme
in Authen:Passphrase family.
Then, I was convinced of an interpretation of RFC 2307 by your
explanation.  Please excuse my not having studied.  I learned so much.

Regards,
-- 
MORIYA Masaki, alias Gardejo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;09&nbsp;17:56:00&nbsp;2011</span>
    <span class="description">MORIYA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m sorry to keep pestering you, I&#39;m afraid I was utterly mistaken about
implementation of the said scheme.  To be exact:

package Authen::Passphrase::SaltedAndStretchedDigest; # tentative name
# ... &#40;snip&#41; ...
sub _hash_of {
    # ... &#40;snip&#41; ...
    my $hash_hex = &#34;&#34;;
    my $salt_hex = $self-&gt;salt_hex;
    for &#40;1 .. $self-&gt;{stretch_count}&#41; {
        $ctx-&gt;add&#40;$hash_hex&#41;;
        $ctx-&gt;add&#40;$passphrase&#41;;
        $ctx-&gt;add&#40;$salt_hex&#41;;
        $hash_hex = $ctx-&gt;hexdigest;
    }
    return pack&#40;&#39;H*&#39;, $hash_hex&#41;;
}
# ... &#40;snip&#41; ...

The scheme has been written in other languages &#40;Java, PHP &#40;and Japanese&#41;&#41;
here: <span class="clickylink"><a target="new" rel="nofollow" href="http://neta.ywcafe.net/001184.html">http://neta.ywcafe.net/001184.html</a></span>

In addition, I confirmed the above implementation:

my $ppr = Authen::Passphrase::SaltedAndStretchedDigest-&gt;new&#40;
  passphrase =&gt;
    &#39;mypassword#1234&#39;,
  salt_hex =&gt;
    &#39;93ab3eaaf393e331ac6384185e68062736fc11d24617461a214afafe2e52af89&#39;,
  stretch_count =&gt;
    1000,
&#41;;
is $ppr-&gt;hash_hex,
   &#39;2564c88ee01c69d19354b39807536010759f7cbc1f25811bff20101150b8c841&#39;;

These passed and returned values are same as ones in the linked page. 

Regards,
-- 
MORIYA Masaki, alias Gardejo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;09&nbsp;18:26:03&nbsp;2011</span>
    <span class="description">MORIYA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am really sorry, the missing line in the recent example is:

  algorithm =&gt; &#39;SHA-256&#39;,

From now on, I will be calm during a correspondence.

Regards,
-- 
MORIYA Masaki, alias Gardejo
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;16&nbsp;06:18:40&nbsp;2011</span>
    <span class="description">felix.ostmann [...] thewar.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> felix.ostmann [...] thewar.de</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mo 09. Mai 2011, 18:26:03, MORIYA schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am really sorry, the missing line in the recent example is:
&gt; 
&gt;   algorithm =&gt; &#39;SHA-256&#39;,
&gt; 
&gt; From now on, I will be calm during a correspondence.
&gt; 
&gt; Regards,
</div>
Perhaps the best is to implement Crypt::PBKDF2 or a small own &#40;non
Moose&#41; PBKDF2 implementation ...
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
