<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70469 for Mail-SPF: Issue - Mail::SPF - Parentheses in comments/text et. al.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70469 for Mail-SPF: Issue - Mail::SPF - Parentheses in comments/text et. al.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Mail-SPF/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Mail-SPF/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Mail-SPF/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Mail-SPF/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-SPF">Mail-SPF CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70469</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Mail-SPF/Active/">Mail-SPF</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
d.stussy [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-20120-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20121-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;24&nbsp;18:33:12&nbsp;2011</span>
    <span class="description">d.stussy [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Issue - Mail::SPF - Parentheses in comments/text et. al.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Aug 2011 15:33:01 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-SPF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> d.stussy [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Typical usage &#40;example - Sendmail virtual hosting and MimeDefang&#41;:

  my $spfserver = Mail::SPF::Server-&gt;new&#40;max_void_dns_lookups =&gt; undef,
        hostname =&gt; $SendmailMacros{&#39;if_name&#39;} &#41;;
  my $spfrequest = Mail::SPF::Request-&gt;new&#40;versions=&gt;[1], scope=&gt;&#39;mfrom&#39;,
        identity =&gt; $id, ip_address =&gt; $ip, helo_identity =&gt; $helo&#41;;
  my $r = $spfserver-&gt;process&#40;$spfrequest&#41;;
  my $result = $r-&gt;code;
  my $local  = $r-&gt;local_explanation;
  my $label  = &#40;$sender eq &#34;&lt;&gt;&#34;&#41; ? &#39;helo&#39; : &#39;mailfrom&#39;;
...
 action_insert_header&#40;&#39;Authentication-Results&#39;,$SendmailMacros{&#39;if_name&#39;}.
         &#34;; SPF=$result smtp.$label=$1 &#40;$local&#41;&#34;, 1&#41; if ...;

Result inserted into message &#40;RFC 5451 format&#41;:

Authentication-Results:   example.com; SPF=pass smtp.mailfrom=example.net &#40;example.net: 2001:db8::dead:beef:cafe is authorized to use &#39;sysop@example.net&#39; in &#39;mfrom&#39; identity &#40;mechanism &#39;mx&#39; matched&#41;&#41; 


$r-&gt;local_explanation returns a text string that is meant to be used as a comment for the result.

However, SMTP messages &#40;STD 10: RFC 5321 and 5322&#41; do not allow nested comments.  Parentheses may not appear in comments.  The problem is that &#34;local_explanation&#34; returns parentheses in its string, so when the string is turned into a comment, it causes nested comments in violation of Internet mail standards.

Please, would &#34;local_explanation&#34; be rewritten so that no result returned contains parentheses?  It would also be cleaner not to have the domain queried about repeated in the explanation at the beginning of the string, as it is redundant when quoting the mailbox tested.

Since I&#39;m using the RFC 5451 format for reporting the results, not RFC 4408&#39;s original format of &#34;Received-SPF:&#34; headers, the returned variable received_spf_header has not been checked for similar problems.  I leave that to the author/maintainer to determine.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;24&nbsp;19:58:45&nbsp;2011</span>
    <span class="description">JMEHNLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2011-08-24 18:33:12, d.stussy@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [...]
&gt; Result inserted into message &#40;RFC 5451 format&#41;:
&gt; 
&gt; Authentication-Results:   example.com; SPF=pass
&gt;    smtp.mailfrom=example.net &#40;example.net: 2001:db8::dead:beef:cafe is
&gt;    authorized to use &#39;sysop@example.net&#39; in &#39;mfrom&#39; identity
&gt;    &#40;mechanism &#39;mx&#39; matched&#41;&#41;
&gt; 
&gt; 
&gt; $r-&gt;local_explanation returns a text string that is meant to be used
&gt;    as a comment for the result.
&gt; 
&gt; However, SMTP messages &#40;STD 10: RFC 5321 and 5322&#41; do not allow nested
&gt;    comments.  Parentheses may not appear in comments.
</div>
Not true.

<span class="clickylink"><a target="new" rel="nofollow" href="http://tools.ietf.org/html/rfc5322#section-3.2.2">http://tools.ietf.org/html/rfc5322#section-3.2.2</a></span> :

   ctext           =   %d33-39 /          ; Printable US-ASCII
                       %d42-91 /          ;  characters not including
                       %d93-126 /         ;  &#34;&#40;&#34;, &#34;&#41;&#34;, or &#34;\&#34;
                       obs-ctext

   ccontent        =   ctext / quoted-pair / comment

   comment         =   &#34;&#40;&#34; *&#40;[FWS] ccontent&#41; [FWS] &#34;&#41;&#34;

&lt;comment&gt; may contain &lt;ccontent&gt;, which in turn may be a &lt;comment&gt;.

Agreed?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;24&nbsp;19:58:46&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;24&nbsp;20:13:30&nbsp;2011</span>
    <span class="description">d.stussy [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70469] Issue - Mail::SPF - Parentheses in comments/text et. al.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Aug 2011 17:13:14 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-SPF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> d.stussy [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- On Wed, 8/24/11, Julian Mehnle via RT &lt;bug-Mail-SPF@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2011-08-24 18:33:12, d.stussy@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt; [...]
&gt; &gt; Result inserted into message &#40;RFC 5451 format&#41;:
&gt; &gt; 
&gt; &gt; Authentication-Results:   example.com; SPF=pass
&gt; &gt;    smtp.mailfrom=example.net &#40;example.net: 2001:db8::dead:beef:cafe is
&gt; &gt;    authorized to use &#39;sysop@example.net&#39; in &#39;mfrom&#39; identity
&gt; &gt;    &#40;mechanism &#39;mx&#39; matched&#41;&#41;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; $r-&gt;local_explanation returns a text string that is meant to be used
&gt; &gt;    as a comment for the result.
&gt; &gt; 
&gt; &gt; However, SMTP messages &#40;STD 10: RFC 5321 and 5322&#41; do not allow nested
&gt; &gt;    comments.  Parentheses may not appear in comments.
</div>&gt; 
&gt; Not true.
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://tools.ietf.org/html/rfc5322#section-3.2.2">http://tools.ietf.org/html/rfc5322#section-3.2.2</a></span> :
&gt; 
&gt;    ctext           =   %d33-39 /          ; Printable US-ASCII
&gt;                        %d42-91 /          ;  characters not including
&gt;                        %d93-126 /         ;  &#34;&#40;&#34;, &#34;&#41;&#34;, or &#34;\&#34;
&gt;                        obs-ctext
&gt; 
&gt;    ccontent        =   ctext / quoted-pair / comment
&gt; 
&gt;    comment         =   &#34;&#40;&#34; *&#40;[FWS] ccontent&#41; [FWS] &#34;&#41;&#34;
&gt; 
&gt; &lt;comment&gt; may contain &lt;ccontent&gt;, which in turn may be a &lt;comment&gt;.
&gt; Agreed?
</div>
I missed that.  I was thinking of another situation when I wrote that.  However, [some] nested comments are still confusing when read by humans.  Instead of using parentheses, maybe a dash would be clearer?  In plain language, people generally do not nest parentheses.

Sample:
&#40;2001:db8::dead:beef:cafe is authorized to use &#39;sysop@example.net&#39; in &#39;mfrom&#39; identity - mechanism &#39;mx&#39; matched&#41;

I still think that the domain name prefix of the string should be dropped.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;24&nbsp;20:38:02&nbsp;2011</span>
    <span class="description">JMEHNLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2011-08-24 20:13:30, d.stussy@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I missed that.  I was thinking of another situation when I wrote that.
&gt;    However, [some] nested comments are still confusing when read by
&gt;    humans.  Instead of using parentheses, maybe a dash would be
&gt;    clearer?  In plain language, people generally do not nest
&gt;    parentheses.
&gt; 
&gt; Sample:
&gt; &#40;2001:db8::dead:beef:cafe is authorized to use &#39;sysop@example.net&#39; in
&gt;    &#39;mfrom&#39; identity - mechanism &#39;mx&#39; matched&#41;
&gt; 
&gt; I still think that the domain name prefix of the string should be
&gt;    dropped.
</div>
I don&#39;t think changing the format of the local_explanation string is a
good solution because, whereas your points may have merit, they are
somewhat arbitrary and a matter of taste.  There would soon be someone
else who would rather have double quotes instead of single quotes, etc.

The proper solution is to build an explanation string of your own.  If
you can&#39;t get all the necessary details from the result object &#40;other
than by parsing/dissecting the explanation string, which would be a very
bad idea&#41;, then I&#39;d be happy to add methods to expose them.  Please let
me know what details you need to build your own explanation string.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;01:20:53&nbsp;2012</span>
    <span class="description">JMEHNLE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;30&nbsp;01:20:53&nbsp;2012</span>
    <span class="description">JMEHNLE [...] cpan.org -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
