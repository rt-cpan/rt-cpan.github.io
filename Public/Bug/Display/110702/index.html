<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #110702 for Net-CIDR-Lite: [v0.21] Wrongly finds ip when both ipv6 and ipv4 are used</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #110702 for Net-CIDR-Lite: [v0.21] Wrongly finds ip when both ipv6 and ipv4 are used</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-CIDR-Lite/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-CIDR-Lite/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-CIDR-Lite/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-CIDR-Lite/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-CIDR-Lite">Net-CIDR-Lite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">110702</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-CIDR-Lite/Active/">Net-CIDR-Lite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
fe [...] nginx.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22354-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22355-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;28&nbsp;09:25:10&nbsp;2015</span>
    <span class="description">fe [...] nginx.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [v0.21] Wrongly finds ip when both ipv6 and ipv4 are used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Dec 2015 17:24:53 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-CIDR-Lite [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Fedor Dikarev &lt;fe [...] nginx.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

I&#39;ve made script which analyses auth.log files, compares ip addresses 
based on known whitelist and inform in case login from unknown ip 
address is found.
You could find this script in attachment.

And I found that for some combinations on ipv4 and ipv6 nets 
Net::CIDR::Lite wrongly finds ip address in my whitelist.
Example:
=== wh-debug.json ==
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # Due to some bug in Perl Net::CIDR::Lite IPv6 addresses must be before IPv4 addresses
&gt; { &#34;global&#34;: &#34;2606:7100:1:69::/64&#34; }
&gt;
&gt; { &#34;global&#34;: [ &#34;37.190.0.0/18&#34; ] }
</div>
=== debug.log ==
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; /var/log/auth.log.0.bz2:2015-12-27T11:08:02.196704+00:00 server sshd[92250]: Accepted publickey for user from 37.145.5.60 port 56219 ssh2: RSA b5:e2:85:9c:7b:ca:02:e2:68:8a:09:08:99:04:d2:9c
</div>
=== check log file ===
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl susp_logins.pl -f wh-debug.json -a debug.log
&gt; GOOD GLOBAL: user from 37.145.5.60.
</div>
which is wrong cause 37.145.5.60 doesn&#39;t belong to 37.190.0.0/18.
And if I remove ipv6 addresses from whitelist, everything goes fine:
=== wh-debug.json ===
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; { &#34;global&#34;: [ &#34;37.190.0.0/18&#34; ] }
</div>
=== check log file ===
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl susp_logins.pl -f wh-debug.json -a debug.log
&gt; SUSP: user from 37.145.5.60.
</div>
Strange for me but everything works when I split /18 on two /19:
=== wh-debug.json ===
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # Due to some bug in Perl Net::CIDR::Lite IPv6 addresses must be before IPv4 addresses
&gt; { &#34;global&#34;: &#34;2606:7100:1:69::/64&#34; }
&gt;
&gt; { &#34;global&#34;: [ &#34;37.190.0.0/19&#34;, &#34;37.190.32.0/19&#34; ] }
&gt; # { &#34;global&#34;: [ &#34;37.190.0.0/18&#34; ] }
</div>
=== check log file ===
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl susp_logins.pl -f wh-debug.json -a debug.log
&gt; SUSP: user from 37.145.5.60.
</div>
Versions used:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -MNet::CIDR::Lite -e &#39;CORE::say $Net::CIDR::Lite::VERSION&#39;
&gt; 0.21
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -V
&gt; Summary of my perl5 &#40;revision 5 version 22 subversion 1&#41; configuration:
&gt;
&gt;   Platform:
&gt;     osname=darwin, osvers=15.2.0, archname=darwin-thread-multi-2level
&gt;     uname=&#39;darwin fe-laptop-mb.local 15.2.0 darwin kernel version 15.2.0: fri nov 13 19:56:56 pst 2015; root:xnu-3248.20.55~2release_x86_64 x86_64 &#39;
&gt;     config_args=&#39;-des -Dprefix=/opt/local -Dscriptdir=/opt/local/bin -Dcppflags=-I/opt/local/include -Dccflags=-pipe -Os  -Dldflags=-L/opt/local/lib -Wl,-headerpad_max_install_names  -Dvendorprefix=/opt/local -Dusemultiplicity=y -Dusethreads -Duseshrplib -Dcc=/usr/bin/clang -Dld=env MACOSX_DEPLOYMENT_TARGET=10.11 /usr/bin/clang -Dman1ext=1pm -Dman3ext=3pm -Dman1dir=/opt/local/share/man/man1p -Dman3dir=/opt/local/share/man/man3p -Dsitebin=/opt/local/libexec/perl5.22/sitebin -Dsiteman1dir=/opt/local/share/perl5.22/siteman/man1 -Dsiteman3dir=/opt/local/share/perl5.22/siteman/man3 -Dvendorbin=/opt/local/libexec/perl5.22 -Dvendorman1dir=/opt/local/share/perl5.22/man/man1 -Dvendorman3dir=/opt/local/share/perl5.22/man/man3 -Dpager=/usr/bin/less -sR -Dperlpath=/opt/local/bin/perl5.22 -Dstartperl=#!/opt/local/bin/perl5.22&#39;
&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;     useithreads=define, usemultiplicity=define
&gt;     use64bitint=define, use64bitall=define, uselongdouble=undef
&gt;     usemymalloc=n, bincompat5005=undef
&gt;   Compiler:
&gt;     cc=&#39;/usr/bin/clang&#39;, ccflags =&#39;-pipe -Os  -fno-common -DPERL_DARWIN -I/opt/local/include -fno-strict-aliasing -fstack-protector-strong -I/opt/local/include&#39;,
&gt;     optimize=&#39;-O3&#39;,
&gt;     cppflags=&#39;-I/opt/local/include -pipe -Os  -fno-common -DPERL_DARWIN -I/opt/local/include -fno-strict-aliasing -fstack-protector-strong -I/opt/local/include&#39;
&gt;     ccversion=&#39;&#39;, gccversion=&#39;4.2.1 Compatible Apple LLVM 7.0.2 &#40;clang-700.1.81&#41;&#39;, gccosandvers=&#39;&#39;
&gt;     intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678, doublekind=3
&gt;     d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16, longdblkind=3
&gt;     ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
&gt;     alignbytes=8, prototype=define
&gt;   Linker and Libraries:
&gt;     ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.11 /usr/bin/clang&#39;, ldflags =&#39;-L/opt/local/lib -Wl,-headerpad_max_install_names  -fstack-protector-strong&#39;
&gt;     libpth=/opt/local/lib /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../lib/clang/7.0.2/lib /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib /usr/lib
&gt;     libs=-lpthread -lgdbm -ldbm -ldl -lm -lutil -lc
&gt;     perllibs=-lpthread -ldl -lm -lutil -lc
&gt;     libc=, so=dylib, useshrplib=true, libperl=libperl.dylib
&gt;     gnulibc_version=&#39;&#39;
&gt;   Dynamic Linking:
&gt;     dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;     cccdlflags=&#39; &#39;, lddlflags=&#39;-L/opt/local/lib -Wl,-headerpad_max_install_names  -bundle -undefined dynamic_lookup -fstack-protector-strong&#39;
&gt;
&gt;
&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;   Compile-time options: HAS_TIMES MULTIPLICITY PERLIO_LAYERS
&gt;                         PERL_DONT_CREATE_GVSV
&gt;                         PERL_HASH_FUNC_ONE_AT_A_TIME_HARD
&gt;                         PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP
&gt;                         PERL_NEW_COPY_ON_WRITE PERL_PRESERVE_IVUV
&gt;                         USE_64_BIT_ALL USE_64_BIT_INT USE_ITHREADS
&gt;                         USE_LARGE_FILES USE_LOCALE USE_LOCALE_COLLATE
&gt;                         USE_LOCALE_CTYPE USE_LOCALE_NUMERIC USE_LOCALE_TIME
&gt;                         USE_PERLIO USE_PERL_ATOF USE_REENTRANT_API
&gt;   Built under darwin
&gt;   Compiled at Dec 23 2015 15:06:40
&gt;   @INC:
&gt;     /opt/local/lib/perl5/site_perl/5.22/darwin-thread-multi-2level
&gt;     /opt/local/lib/perl5/site_perl/5.22
&gt;     /opt/local/lib/perl5/vendor_perl/5.22/darwin-thread-multi-2level
&gt;     /opt/local/lib/perl5/vendor_perl/5.22
&gt;     /opt/local/lib/perl5/5.22/darwin-thread-multi-2level
&gt;     /opt/local/lib/perl5/5.22
&gt;     .
</div>


-- 
Fedor Dikarev
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;30&nbsp;17:40:14&nbsp;2015</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">You can currently only specify one or the other format of ipv4 or ipv6 for any one Net::CIDR::Lite object. This should probably be specified in the docs, and probably throw an exception if you mix the formats.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;30&nbsp;17:40:14&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
