<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #128199 for RT-Extension-TimeTracking-Automatic: Extremely large values being generated for TimeWorked</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #128199 for RT-Extension-TimeTracking-Automatic: Extremely large values being generated for TimeWorked</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/RT-Extension-TimeTracking-Automatic/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/RT-Extension-TimeTracking-Automatic/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/RT-Extension-TimeTracking-Automatic/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/RT-Extension-TimeTracking-Automatic/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/RT-Extension-TimeTracking-Automatic">RT-Extension-TimeTracking-Automatic CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">128199</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/RT-Extension-TimeTracking-Automatic/Active/">RT-Extension-TimeTracking-Automatic</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ktm [...] rice.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-265674-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-265675-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;08&nbsp;14:46:37&nbsp;2019</span>
    <span class="description">ktm [...] rice.edu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Extremely large values being generated for TimeWorked</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 8 Jan 2019 13:40:16 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RT-Extension-TimeTracking-Automatic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kenneth Marshall &lt;ktm [...] rice.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Since enabling the extension RT::Extension::TimeTracking::Automatic 
we have had cases of extremely large values of TimeWorked being
generated. The latest case was a brand new ticket that I submitted.
Here is the history:

------------------------------------------------------------
Tue, Jan 8, 2019 12:53:02 PM ktm &#40;Marshall, Kenneth&#41; - Worked 429,715 hours &#40;25,782,899 minutes&#41; 25,782,899 minutes

Tue, Jan 8, 2019 12:52:39 PM The RT System itself - AdminCc aaa &#40;A, A&#41; added

Tue, Jan 8, 2019 12:52:39 PM The RT System itself - Due changed from Not set to Not set

Tue, Jan 8, 2019 12:52:38 PM ktm &#40;Marshall, Kenneth&#41; - Ticket created
Subject:        testing notifications for OTR Fees
Date:   Tue, 8 Jan 2019 12:52:26 -0600
To:     rt@help.rice.edu
From:   &#34;Kenneth Marshall&#34; &lt;ktm@rice.edu&gt;
Download &#40;untitled&#41;
/
with headers

text/plain 44B
This is test. Please ignore.

Regards,
Ken
------------------------------------------------------------

It looks like something may not be being initialized to 0 correctly
or something similar. Needlesstosay it seriously hampers our time
managment processes so anything you can do to help would be appreciated.
Please let me know if you need any addition information or diagnostics?

Regards,
Ken Marshall
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;08&nbsp;17:07:43&nbsp;2019</span>
    <span class="description">ktm [...] rice.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128199] Another example of large updates</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 8 Jan 2019 16:07:19 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in RT-Extension-TimeTracking-Automatic via RT &lt;bug-RT-Extension-TimeTracking-Automatic [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kenneth Marshall &lt;ktm [...] rice.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; It looks like something may not be being initialized to 0 correctly
&gt; or something similar. Needlesstosay it seriously hampers our time
&gt; managment processes so anything you can do to help would be appreciated.
&gt; Please let me know if you need any addition information or diagnostics?
&gt; 
&gt; Regards,
&gt; Ken Marshall
</div>
Hi,

I have looked a little bit further and here is another case where the
timeworked is set incorrectly:

---------------------------------------------------------------------
# Tue, Jan 8, 2019 7:53:18 AM kr &#40;K, H&#41; - Status changed
from &#39;stalled&#39; to &#39;open&#39;

# Tue, Jan 8, 2019 7:53:18 AM kr &#40;K, H&#41; - Worked 429,710
hours &#40;25,782,599 minutes&#41; 25,782,599 minutes

# Thu, Dec 13, 2018 12:54:11 PM kr &#40;K, H&#41; - Status changed
from &#39;open&#39; to &#39;stalled&#39;

# Thu, Dec 13, 2018 12:54:11 PM kr &#40;K, H&#41; - Worked 6 minutes
6 minutes

# Wed, Dec 12, 2018 11:27:28 AM The RT System itself - Outgoing email
recorded [Show]

# Wed, Dec 12, 2018 11:27:27 AM kr &#40;K, H&#41; - Correspondence added [Reply] [Comment] [Forward]
Subject:        RE: [rice.edu #802475] Resolved: Need New Department
Laptop
Date:   Wed, 12 Dec 2018 11:27:15 -0600
To:     &#34;IT Help&#34; &lt;helpdesk@help.rice.edu&gt;
From:   &#34;H K&#34; &lt;kr@rice.edu&gt;
Download &#40;untitled&#41;
/
with headers

text/plain 1.2KiB
Download &#40;untitled&#41;
/
with headers

text/html 3.9KiB

Okay.

 

Sent from my Windows 10 device
---------------------------------------------------------------------

Here are the messages in the logs:

Jan  8 07:53:18 rt2 RT: [10453] Use of uninitialized value in
subtraction &#40;-&#41; at
/opt/rt442/local/plugins/RT-Extension-TimeTracking-Automatic/html/Callbacks/RT-Extension-TimeTracking-Automatic/Ticket/Update.html/BeforeDisplay
line 7.
Jan  8 12:53:02 rt2 RT: [6715] Use of uninitialized value in subtraction
&#40;-&#41; at
/opt/rt442/local/plugins/RT-Extension-TimeTracking-Automatic/html/Callbacks/RT-Extension-TimeTracking-Automatic/Ticket/Update.html/BeforeDisplay
line 7.


Regards,
Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;14&nbsp;10:00:01&nbsp;2019</span>
    <span class="description">ktm [...] rice.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128199] A patch for the problem</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 14 Jan 2019 08:59:49 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in RT-Extension-TimeTracking-Automatic via RT &lt;bug-RT-Extension-TimeTracking-Automatic [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kenneth Marshall &lt;ktm [...] rice.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ---------------------------------------------------------------------
&gt; 
&gt; Here are the messages in the logs:
&gt; 
&gt; Jan  8 07:53:18 rt2 RT: [10453] Use of uninitialized value in
&gt; subtraction &#40;-&#41; at
&gt; /opt/rt442/local/plugins/RT-Extension-TimeTracking-Automatic/html/Callbacks/RT-Extension-TimeTracking-Automatic/Ticket/Update.html/BeforeDisplay
&gt; line 7.
&gt; Jan  8 12:53:02 rt2 RT: [6715] Use of uninitialized value in subtraction
&gt; &#40;-&#41; at
&gt; /opt/rt442/local/plugins/RT-Extension-TimeTracking-Automatic/html/Callbacks/RT-Extension-TimeTracking-Automatic/Ticket/Update.html/BeforeDisplay
&gt; line 7.
&gt; 
&gt; 
&gt; Regards,
&gt; Ken
</div>
Hi,

I have applied the following patch to use a default value of &#39;time&#39; in
the case that the variable is not defined. Here is the diff for the
file:

--- BeforeDisplay.ORIG  2019-01-10 13:53:56.590980382 -0600
+++ BeforeDisplay       2019-01-10 13:53:56.581980493 -0600
@@ -4,6 +4,6 @@
 &lt;/%args&gt;
 &lt;%init&gt;
 my $adjustment = RT-&gt;Config-&gt;Get&#40;&#34;TimeTrackingAdjustment&#34;&#41; || 0;
-my $worked = POSIX::ceil&#40;&#40;time - $$ARGSRef{TimeTrackingAutomatic}&#41;/60&#41; + $adjustment;  # at least 1 minute
+my $worked = POSIX::ceil&#40;&#40;time - &#40;$$ARGSRef{TimeTrackingAutomatic} // time&#41;&#41;/60&#41; + $adjustment;        # at least 1 minute
 $Ticket-&gt;SetTimeWorked&#40; $worked + $Ticket-&gt;TimeWorked &#41;;
 &lt;/%init&gt;

That appears to have fixed the errors and the population of TimeWorked
with ridiculous values.

Regards,
Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;15:48:35&nbsp;2020</span>
    <span class="description">ktm [...] rice.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128199] A patch for the problem</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 8 Jun 2020 14:41:44 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in RT-Extension-TimeTracking-Automatic via RT &lt;bug-RT-Extension-TimeTracking-Automatic [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kenneth Marshall &lt;ktm [...] rice.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; I have applied the following patch to use a default value of &#39;time&#39; in
&gt; the case that the variable is not defined. Here is the diff for the
&gt; file:
&gt; 
&gt; --- BeforeDisplay.ORIG        2019-01-10 13:53:56.590980382 -0600
&gt; +++ BeforeDisplay     2019-01-10 13:53:56.581980493 -0600
&gt; @@ -4,6 +4,6 @@
&gt;  &lt;/%args&gt;
&gt;  &lt;%init&gt;
&gt;  my $adjustment = RT-&gt;Config-&gt;Get&#40;&#34;TimeTrackingAdjustment&#34;&#41; || 0;
&gt; -my $worked = POSIX::ceil&#40;&#40;time - $$ARGSRef{TimeTrackingAutomatic}&#41;/60&#41; + $adjustment;        # at least 1 minute
&gt; +my $worked = POSIX::ceil&#40;&#40;time - &#40;$$ARGSRef{TimeTrackingAutomatic} // time&#41;&#41;/60&#41; + $adjustment;      # at least 1 minute
&gt;  $Ticket-&gt;SetTimeWorked&#40; $worked + $Ticket-&gt;TimeWorked &#41;;
&gt;  &lt;/%init&gt;
&gt; 
&gt; That appears to have fixed the errors and the population of TimeWorked
&gt; with ridiculous values.
&gt; 
&gt; Regards,
&gt; Ken
</div>
Hi Devteam,

I just upgrade RT to 4.4.4 and got burned again by this bug. Could
someone please release a fixed version of this extension. Thank you.

Regards,
Ken
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
