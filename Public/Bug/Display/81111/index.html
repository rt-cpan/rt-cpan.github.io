<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #81111 for DNS-ZoneParse: Add support for SPF records</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #81111 for DNS-ZoneParse: Add support for SPF records</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DNS-ZoneParse">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DNS-ZoneParse">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DNS-ZoneParse">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DNS-ZoneParse">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DNS-ZoneParse">DNS-ZoneParse CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">81111</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DNS-ZoneParse">DNS-ZoneParse</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
hugh [...] davenport.net.nz

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-11678-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.10    </td>
  </tr>
  <tr id="CF-11679-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.10    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




patch-ZoneParse.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1389226/737732/patch-ZoneParse.pm">
Tue Jul 22 06:46:53 2014 (4.5k) by complx-on-cpan [...] opsec.eu
</a>
</font></li>
</ul>


spf.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1141386/600225/spf.patch">
Sun Nov 11 20:22:48 2012 (2.5k) by https://launchpad.net/~hugh-catalyst
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1141383/600220/spf.patch">
Sun Nov 11 20:09:30 2012 (984b) by https://launchpad.net/~hugh-catalyst
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=81111">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1141383" href="/Public/Bug/Display.html?id=81111#txn-1141383">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;11&nbsp;20:09:30&nbsp;2012</span>
    <span class="description">https://launchpad.net/~hugh-catalyst -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add support for SPF records</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1141383/600219/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/600219">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 956b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When a domain contains records of the SPF type &#40;99&#41; as defined by RFC 
4408 [1], the parser responds in the following warning and is not 
included in any output.
 Unparseable line &#40;Unknown record type&#41;
   @ IN SPF &#34;v=spf1 mx -all&#34;

Attached is a patch that allows these SPF records to be used. The only 
verification that they are the correct format is the check of a version 
tag of &#34;v=spf1&#34;. More detail could be given to check whether correct 
mechanisms are used.

This patch has been tested against perl running on debian wheezy, and 
the diff is against the 1.10 source obtained from CPAN.

Also, may be another bug. I would suggest that any records that fail to 
parse should be stored in a separate section in the parser that can&#39;t be 
modified &#40;easily?&#41; and is output when required. This allows new record 
types to still be used in output, while not being able to be manipulated 
&#40;easily..&#41;.

Cheers,

Hugh

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://tools.ietf.org/html/rfc4408">http://tools.ietf.org/html/rfc4408</a></span>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> spf.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1141383/600220/spf.patch">Download spf.patch</a><br />
<span class="downloadcontenttype">text/x-diff 984b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">24c24
&lt;     %dns_generate,
---
&gt;     %dns_generate, %dns_spf,
81a82
&gt;     delete $dns_spf{$self};
108a110
&gt;      : $method eq &#39;spf&#39;      ? $dns_spf{$self}
136a139
&gt; 	    SPF	  =&gt; $dns_spf{$self},
277a281,286
&gt;     foreach my $o &#40; @{ $dns_spf{$self} } &#41; {
&gt;         next unless defined $o;
&gt;         next unless $o-&gt;{&#39;ORIGIN&#39;} eq $process_this_origin;
&gt;         $self-&gt;_escape_chars&#40; $o &#41;;
&gt;         $output .= qq[$o-&gt;{name}	$o-&gt;{ttl} $o-&gt;{class} SPF	&#34;$o-&gt;{text}&#34;\n];
&gt;     }
370a380
&gt;     $dns_spf{$self}       = [];
730a741,754
&gt;         } elsif &#40;
&gt;             /&#40;$valid_name&#41;? \s+
&gt;                 $ttl_cls
&gt;                 SPF \s+
&gt;                 &#40;&#34;v=spf1\s&#40;$valid_quoted_txt_char*&#40;?&lt;!\\&#41;&#34;|$valid_txt_char+&#41;&#41;
&gt;             /ixo
&gt;         &#41; {
&gt;             push @{ $dns_spf{$self} },
&gt;              $self-&gt;_massage&#40; {
&gt;                     name  =&gt; $1,
&gt;                     ttl   =&gt; $2,
&gt;                     class =&gt; $3,
&gt;                     text  =&gt; $4,
&gt;              } &#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1141386" href="/Public/Bug/Display.html?id=81111#txn-1141386">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;11&nbsp;20:22:48&nbsp;2012</span>
    <span class="description">https://launchpad.net/~hugh-catalyst -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1141386/600224/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/600224">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached a unified diff

On Sun Nov 11 20:09:30 2012, <span class="clickylink"><a target="new" rel="nofollow" href="https://launchpad.net/~hugh-catalyst">https://launchpad.net/~hugh-catalyst</a></span> wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When a domain contains records of the SPF type &#40;99&#41; as defined by RFC 
&gt; 4408 [1], the parser responds in the following warning and is not 
&gt; included in any output.
&gt;  Unparseable line &#40;Unknown record type&#41;
&gt;    @ IN SPF &#34;v=spf1 mx -all&#34;
&gt; 
&gt; Attached is a patch that allows these SPF records to be used. The only 
&gt; verification that they are the correct format is the check of a 
</div>version 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; tag of &#34;v=spf1&#34;. More detail could be given to check whether correct 
&gt; mechanisms are used.
&gt; 
&gt; This patch has been tested against perl running on debian wheezy, and 
&gt; the diff is against the 1.10 source obtained from CPAN.
&gt; 
&gt; Also, may be another bug. I would suggest that any records that fail 
</div>to 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; parse should be stored in a separate section in the parser that can&#39;t 
</div>be 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; modified &#40;easily?&#41; and is output when required. This allows new record 
&gt; types to still be used in output, while not being able to be 
</div>manipulated 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;easily..&#41;.
&gt; 
&gt; Cheers,
&gt; 
&gt; Hugh
&gt; 
&gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="http://tools.ietf.org/html/rfc4408">http://tools.ietf.org/html/rfc4408</a></span>
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> spf.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1141386/600225/spf.patch">Download spf.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- a/DNS/ZoneParse.pm	2010-09-30 20:35:33.000000000 +1300
+++ b/DNS/ZoneParse.pm	2012-11-12 14:00:27.227925769 +1300
@@ -21,7 +21,7 @@
 my &#40;
     %dns_id,  %dns_soa, %dns_ns,  %dns_a,     %dns_cname, %dns_mx, %dns_txt,
     %dns_ptr, %dns_a4,  %dns_srv, %dns_hinfo, %dns_rp,    %dns_loc,
-    %dns_generate,
+    %dns_generate, %dns_spf,
     %dns_last_name, %dns_last_origin, %dns_last_class, %dns_last_ttl,
     %dns_found_origins, %unparseable_line_callback, %last_parse_error_count,
 &#41;;
@@ -79,6 +79,7 @@
     delete $dns_loc{$self};
     delete $dns_id{$self};
     delete $dns_generate{$self};
+    delete $dns_spf{$self};
     delete $dns_last_name{$self};
     delete $dns_last_origin{$self};
     delete $dns_last_ttl{$self};
@@ -106,6 +107,7 @@
      : $method eq &#39;rp&#39;       ? $dns_rp{$self}
      : $method eq &#39;loc&#39;      ? $dns_loc{$self}
      : $method eq &#39;generate&#39; ? $dns_generate{$self}
+     : $method eq &#39;spf&#39;      ? $dns_spf{$self}
      : $method eq &#39;zonefile&#39; ? $dns_id{$self}-&gt;{ZoneFile}
      : $method eq &#39;origin&#39;   ? $dns_id{$self}-&gt;{Origin}
      :                         undef;
@@ -134,6 +136,7 @@
             HINFO =&gt; $dns_hinfo{$self},
             RP    =&gt; $dns_rp{$self},
             LOC   =&gt; $dns_loc{$self},
+	    SPF	  =&gt; $dns_spf{$self},
     } &#41;;
 }
 
@@ -275,6 +278,12 @@
         $self-&gt;_escape_chars&#40; $o &#41;;
         $output .= &#34;\$GENERATE $o-&gt;{range}  $o-&gt;{lhs}  $o-&gt;{ttl}  $o-&gt;{class}  $o-&gt;{type}  $o-&gt;{rhs}\n&#34;;
     }
+    foreach my $o &#40; @{ $dns_spf{$self} } &#41; {
+        next unless defined $o;
+        next unless $o-&gt;{&#39;ORIGIN&#39;} eq $process_this_origin;
+        $self-&gt;_escape_chars&#40; $o &#41;;
+        $output .= qq[$o-&gt;{name}	$o-&gt;{ttl} $o-&gt;{class} SPF	&#34;$o-&gt;{text}&#34;\n];
+    }
 
     }
 
@@ -368,6 +377,7 @@
     $dns_rp{$self}        = [];
     $dns_loc{$self}       = [];
     $dns_generate{$self}  = [];
+    $dns_spf{$self}       = [];
     $dns_last_name{$self} = undef;
     $dns_last_origin{$self} = undef;
     $dns_last_ttl{$self} = undef;
@@ -728,6 +738,20 @@
                     rhs    =&gt; $6,
             } &#41;;
 
+        } elsif &#40;
+            /&#40;$valid_name&#41;? \s+
+                $ttl_cls
+                SPF \s+
+                &#40;&#34;v=spf1\s&#40;$valid_quoted_txt_char*&#40;?&lt;!\\&#41;&#34;|$valid_txt_char+&#41;&#41;
+            /ixo
+        &#41; {
+            push @{ $dns_spf{$self} },
+             $self-&gt;_massage&#40; {
+                    name  =&gt; $1,
+                    ttl   =&gt; $2,
+                    class =&gt; $3,
+                    text  =&gt; $4,
+             } &#41;;
         } else {
             die &#34;Unknown record type\n&#34;;
         }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1141389" href="/Public/Bug/Display.html?id=81111#txn-1141389">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;11&nbsp;20:22:49&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1389226" href="/Public/Bug/Display.html?id=81111#txn-1389226">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;06:46:53&nbsp;2014</span>
    <span class="description">complx-on-cpan [...] opsec.eu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add support for SPF records, newer patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1389226/737731/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/737731">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 15b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">See attachment.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch-ZoneParse.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1389226/737732/patch-ZoneParse.pm">Download patch-ZoneParse.pm</a><br />
<span class="downloadcontenttype">text/x-perl 4.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- ../ZoneParse.pm-orig	2014-07-22 09:36:10.000000000 +0200
+++ lib/DNS/ZoneParse.pm	2014-07-22 12:28:32.000000000 +0200
@@ -19,14 +19,18 @@
 
 $VERSION = &#39;1.10&#39;;
 my &#40;
-    %dns_id,  %dns_soa, %dns_ns,  %dns_a,     %dns_cname, %dns_mx, %dns_txt,
+    %dns_id,  %dns_soa, %dns_ns,  %dns_a,     %dns_cname, %dns_mx,
+    %dns_txt, %dns_spf,
     %dns_ptr, %dns_a4,  %dns_srv, %dns_hinfo, %dns_rp,    %dns_loc,
     %dns_generate,
     %dns_last_name, %dns_last_origin, %dns_last_class, %dns_last_ttl,
     %dns_found_origins, %unparseable_line_callback, %last_parse_error_count,
 &#41;;
 
-my %possibly_quoted = map { $_ =&gt; undef } qw/ os cpu text mbox /;
+my %possibly_quoted = map { $_ =&gt; undef } qw/ os cpu text mbox spf /;
+
+# <span class="clickylink"><a target="new" rel="nofollow" href="https://kb.isc.org/article/AA-00356/0/Can-I-have-a-TXT-or-SPF-record-longer-than-255-characters.html">https://kb.isc.org/article/AA-00356/0/Can-I-have-a-TXT-or-SPF-record-longer-than-255-characters.html</a></span>
+my %possibly_multiple = map { $_ =&gt; undef } qw/ text spf /;
 
 sub new {
     my $class = shift;
@@ -71,6 +75,7 @@
     delete $dns_cname{$self};
     delete $dns_mx{$self};
     delete $dns_txt{$self};
+    delete $dns_spf{$self};
     delete $dns_ptr{$self};
     delete $dns_a4{$self};
     delete $dns_srv{$self};
@@ -99,6 +104,7 @@
      : $method eq &#39;cname&#39;    ? $dns_cname{$self}
      : $method eq &#39;mx&#39;       ? $dns_mx{$self}
      : $method eq &#39;txt&#39;      ? $dns_txt{$self}
+     : $method eq &#39;spf&#39;      ? $dns_spf{$self}
      : $method eq &#39;ptr&#39;      ? $dns_ptr{$self}
      : $method eq &#39;aaaa&#39;     ? $dns_a4{$self}
      : $method eq &#39;srv&#39;      ? $dns_srv{$self}
@@ -130,6 +136,7 @@
             MX    =&gt; $dns_mx{$self},
             PTR   =&gt; $dns_ptr{$self},
             TXT   =&gt; $dns_txt{$self},
+            SPF   =&gt; $dns_spf{$self},
             SRV   =&gt; $dns_srv{$self},
             HINFO =&gt; $dns_hinfo{$self},
             RP    =&gt; $dns_rp{$self},
@@ -235,7 +242,21 @@
         next unless defined $o;
         next unless $o-&gt;{&#39;ORIGIN&#39;} eq $process_this_origin;
         $self-&gt;_escape_chars&#40; $o &#41;;
-        $output .= qq[$o-&gt;{name}	$o-&gt;{ttl} $o-&gt;{class} TXT	&#34;$o-&gt;{text}&#34;\n];
+	my $t = $o-&gt;{text};
+	if &#40; length&#40;$t&#41; &gt; 250 &#41; {
+	    $t=join&#40;&#39;&#34; &#34;&#39;,&#40; $t =~ m/.{1,250}/g &#41;&#41;;
+	}
+        $output .= qq[$o-&gt;{name}	$o-&gt;{ttl} $o-&gt;{class}	TXT	&#34;$t&#34;\n];
+    }
+    foreach my $o &#40; @{ $dns_spf{$self} } &#41; {
+        next unless defined $o;
+        next unless $o-&gt;{&#39;ORIGIN&#39;} eq $process_this_origin;
+        $self-&gt;_escape_chars&#40; $o &#41;;
+	my $t = $o-&gt;{spf};
+	if &#40; length&#40;$t&#41; &gt; 250 &#41; {
+	    $t=join&#40;&#39;&#34; &#34;&#39;,&#40; $t =~ m/.{1,250}/g &#41;&#41;;
+	}
+        $output .= qq[$o-&gt;{name}	$o-&gt;{ttl} $o-&gt;{class}	SPF	&#34;$t&#34;\n];
     }
     foreach my $o &#40; @{ $dns_ptr{$self} } &#41; {
         next unless defined $o;
@@ -361,6 +382,7 @@
     $dns_cname{$self}     = [];
     $dns_mx{$self}        = [];
     $dns_txt{$self}       = [];
+    $dns_spf{$self}       = [];
     $dns_ptr{$self}       = [];
     $dns_a4{$self}        = [];
     $dns_srv{$self}       = [];
@@ -614,6 +636,20 @@
                     text  =&gt; $4,
              } &#41;;
         } elsif &#40;
+            /&#40;$valid_name&#41;? \s+
+                $ttl_cls
+                SPF \s+
+                &#40;&#34;$valid_quoted_txt_char*&#40;?&lt;!\\&#41;&#34;|$valid_txt_char+&#41;
+            /ixo
+        &#41; {
+            push @{ $dns_spf{$self} },
+             $self-&gt;_massage&#40; {
+                    name  =&gt; $1,
+                    ttl   =&gt; $2,
+                    class =&gt; $3,
+                    spf   =&gt; $4,
+             } &#41;;
+        } elsif &#40;
             /^\s*\$TTL \s+
                 &#40;$rr_ttl&#41;
             /ixo
@@ -817,9 +853,12 @@
             $record-&gt;{$r} = &#39;&#39;;
             next;
         }
-        if &#40; exists $possibly_quoted{$r} &#41; {
+	if &#40; exists $possibly_quoted{$r} &#41; {
+	    if &#40; exists $possibly_multiple{$r} &#41; {
+		$record-&gt;{$r} =~ s/&#34;\s+&#34;//;
+	    }
             &#40; $record-&gt;{$r} =~ s/^&#34;// &#41; &#38;&#38; &#40; $record-&gt;{$r} =~ s/&#34;$// &#41;;
-        }
+	}
 
         # We return email addresses just as they are in the file... for better
         # or worse &#40;mostly for backwards compatability reasons&#41;.
@@ -1051,7 +1090,7 @@
 If you plan to pass a on_unparseable_line callback but do not wish to specify
 an C&lt;$origin&gt;, pass &#39;undef&#39; as the C&lt;$origin&gt; parameter.
 
-=item a&#40;&#41;, cname&#40;&#41;, srv&#40;&#41;, mx&#40;&#41;, ns&#40;&#41;, ptr&#40;&#41;, txt&#40;&#41;, hinfo&#40;&#41;, rp&#40;&#41;, loc&#40;&#41;
+=item a&#40;&#41;, cname&#40;&#41;, srv&#40;&#41;, mx&#40;&#41;, ns&#40;&#41;, ptr&#40;&#41;, txt&#40;&#41;, spf&#40;&#41;, hinfo&#40;&#41;, rp&#40;&#41;, loc&#40;&#41;
 
 These methods return references to the resource records. For example:
 
@@ -1069,6 +1108,9 @@
 TXT records also have a &#39;text&#39; property representing the record&#39;s &#39;txt-data&#39;
 descriptive text.
 
+SPF records also have a &#39;spf&#39; property representing the record&#39;s &#39;spf-data&#39;
+descriptive text.
+
 HINFO records also have &#39;cpu&#39; and &#39;os&#39; properties.
 
 RP records also have &#39;mbox&#39; and &#39;text&#39; properties.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1792330" href="/Public/Bug/Display.html?id=81111#txn-1792330">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;22&nbsp;04:48:54&nbsp;2018</span>
    <span class="description">complx-on-cpan [...] opsec.eu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1792330/963966/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/963966">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 96b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://tools.ietf.org/html/rfc6686">https://tools.ietf.org/html/rfc6686</a></span> says that SPF records in DNS zones are considered a failure.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.44888</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
