<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #12890 for MailTools: Mail::Mailer open failure w/taint in eval block causes nonintuive behavior</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #12890 for MailTools: Mail::Mailer open failure w/taint in eval block causes nonintuive behavior</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=MailTools">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=MailTools">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=MailTools">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=MailTools">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MailTools">MailTools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">12890</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=MailTools">MailTools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rlucas [...] tercent.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20244-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.67    </td>
  </tr>
  <tr id="CF-20245-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




mailtools.patch.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/131926/35089/mailtools.patch.txt">
Thu May 19 22:53:51 2005 (941b) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=12890">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-131926" href="/Public/Bug/Display.html?id=12890#txn-131926">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;19&nbsp;22:53:51&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Mail::Mailer open failure w/taint in eval block causes nonintuive
 behavior</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/131926/35088/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/35088">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a loop that for each entry, diddles with a database record, does
some external stuff, then sends an email, and writes back to the
database the date of sending.  All this is wrapped in an eval for each
entry, and if any of the stuff fails or dies, it rolls back the database
transaction for that entry and dies.  If it succeeds, it commits and
goes on to the next.  &#40;Fairly vanilla.&#41;

Normally, I just tested that the MIME::Entity send method returns true,
but when I was running some tests under taint, I got a failure due to
insecure path that caused a die in my eval.  For the first iteration of
the loop, this successfully rolled back the database transaction.
However, it then tried to commit!  And it didn&#39;t bomb out of the overall
loop, either!

I spent a while tracking it down to a minimal test case that comes from
the fork and/or eval in Mail::Mailer-&gt;open.  The code below demonstrates the problem on Debian testing w/ 5.8.4, and it is trying
to use sendmail; the key is to make sure that your path is tainted so
that the open call fails.

What happens is that the child from the open &#40;&#34;|-&#34;&#41; dies before the exec
can kill it off, thereby causing the child&#39;s death to be caught in my
eval.  The parent never discovers that the child&#39;s death happens.

I have a patch that seems to work for me with the sendmail version, but
I don&#39;t have a test suite for it.  I&#39;ll send that under separate cover
shortly.

#!/usr/bin/perl -wT
use strict;
use Mail::Mailer;
for &#40;1..3&#41; { 
  eval { 
    my $m = new Mail::Mailer;
    warn &#34;Iteration $_, my PID $$&#34;;
    $m-&gt;open&#40; { To =&gt; &#39;rlucas&#39;, } &#41;; # in real life, we would continue w/sending etc. 
  }; 
  if &#40;$@&#41; { 
    warn &#34;Original error for PID $$ was $@&#34;; 
    die &#34;Died PID $$ trying to send email, here we would roll back a db transaction&#34;; 
  } 
  else { 
    warn &#34;Here PID $$ would commit the db transaction&#34;; 
  } 
} 
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/131926/35089/mailtools.patch.txt">Download mailtools.patch.txt</a><br />
<span class="downloadcontenttype">text/plain 941b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Mailer.pm.bak	2005-05-19 19:18:17.000000000 -0700
+++ Mailer.pm	2005-05-19 19:22:49.000000000 -0700
@@ -266,9 +266,22 @@
     $self-&gt;close;	# just in case;
 
     # Fork and start a mailer
-    &#40;defined&#40;$exe&#41; &#38;&#38; open&#40;$self,&#34;|-&#34;&#41;&#41;
-	|| $self-&gt;exec&#40;$exe, $args, \@to&#41;
-	|| die $!;
+    #&#40;defined&#40;$exe&#41; &#38;&#38; open&#40;$self,&#34;|-&#34;&#41;&#41;
+    #|| $self-&gt;exec&#40;$exe, $args, \@to&#41;
+    #|| die $!;
+    if &#40;my $childpid = open &#40;$self, &#34;|-&#34;&#41; &#41;{
+        # I am the parent
+    }
+    else {
+        # I am the child
+        eval {
+            $self-&gt;exec&#40;$exe, $args, \@to&#41;;
+        };
+        if &#40;$@&#41; {
+            warn &#34;Forked child in &#34; . __PACKAGE__ . &#34; failed with $@&#34;;
+            exit&#40;1&#41;;
+        }
+    }
 
     # Set the headers
     $self-&gt;set_headers&#40;$hdrs&#41;;
@@ -319,6 +332,7 @@
     if &#40;fileno&#40;$self&#41;&#41; {
 	$self-&gt;epilogue;
 	close&#40;$self&#41;
+            or die &#34;Could not close mailer: $!&#34;;
     }
 }
 

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-131927" href="/Public/Bug/Display.html?id=12890#txn-131927">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;12:54:03&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/131927/35225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/35225">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 157b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The patch as submitted will exit&#40;&#41;, which has some nonorthogonal effects
on the parent as certain objects will have their DESTROY&#40;&#41; methods
called, it seems.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-131928" href="/Public/Bug/Display.html?id=12890#txn-131928">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;03&nbsp;03:56:24&nbsp;2005</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/131928/35580/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/35580">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 843b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Tue May 24 12:54:03 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The patch as submitted will exit&#40;&#41;, which has some nonorthogonal effects
&gt; on the parent as certain objects will have their DESTROY&#40;&#41; methods
&gt; called, it seems.
</div>
I only agree for 80% with your evaluation of the problem.  eval&#40;&#41; is
certainly not the solution.

What about this:  &#40;using my coding style&#41;

    use POSIX qw/_exit/;

    ...

    my $child = open $self, &#39;|-&#39;;
    defined $child or die &#34;Failed to send: $!&#34;
                                                                       
        
    if&#40;$child==0&#41;
    {   # Child process will handle sending
        $self-&gt;exec&#40;$exe, $args, \@to&#41;;   # should leave program
        warn $!;    # exec failed
        _exit&#40;1&#41;;   # no DESTROY&#40;&#41;, keep it for parent
    }
                                                                       
        
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-131929" href="/Public/Bug/Display.html?id=12890#txn-131929">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;03&nbsp;15:20:49&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/131929/35613/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/35613">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 773b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[MARKOV - Fri Jun  3 03:56:24 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I only agree for 80% with your evaluation of the problem.  eval&#40;&#41; is
&gt; certainly not the solution.
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     if&#40;$child==0&#41;
&gt;     {   # Child process will handle sending
&gt;         $self-&gt;exec&#40;$exe, $args, \@to&#41;;   # should leave program
&gt;         warn $!;    # exec failed
&gt;         _exit&#40;1&#41;;   # no DESTROY&#40;&#41;, keep it for parent
&gt;     }
</div>
The reason I wrapped the exec in an eval is that the self-&gt;exec call can
die &#40;e.g. under taint mode with an insecure path&#41;.  If it dies, then in
the above, you never get to _exit -- instead, the die propagates out of
Mail::Mailer into the calling code &#40;in the CHILD&#41; and can trip an
enclosing eval.

There was a somewhat helpful PerlMonks thread on this at
<span class="clickylink"><a target="new" rel="nofollow" href="http://perlmonks.org/?node_id=459739">http://perlmonks.org/?node_id=459739</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-131930" href="/Public/Bug/Display.html?id=12890#txn-131930">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;05&nbsp;07:15:07&nbsp;2005</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/131930/35648/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/35648">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 995b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Fri Jun  3 15:20:49 2005]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;     if&#40;$child==0&#41;
&gt; &gt;     {   # Child process will handle sending
&gt; &gt;         $self-&gt;exec&#40;$exe, $args, \@to&#41;;   # should leave program
&gt; &gt;         warn $!;    # exec failed
&gt; &gt;         _exit&#40;1&#41;;   # no DESTROY&#40;&#41;, keep it for parent
&gt; &gt;     }
</div>&gt; 
&gt; The reason I wrapped the exec in an eval is that the self-&gt;exec call can
&gt; die &#40;e.g. under taint mode with an insecure path&#41;.  If it dies, then in
&gt; the above, you never get to _exit -- instead, the die propagates out of
&gt; Mail::Mailer into the calling code &#40;in the CHILD&#41; and can trip an
&gt; enclosing eval.
</div>
Oh, I really hate that tied filehandle object idea.... it looks nice,
but is a horror for treating errors correctly.  So, are you satisfied
with this attempt:

    if&#40;$child==0&#41;
    {   # Child process will handle sending
        eval { $self-&gt;exec&#40;$exe, $args, \@to&#41; }; # should leave program
        warn $@ || $!;    # exec failed
        _exit&#40;1&#41;;         # no DESTROY&#40;&#41;, keep it for parent
    }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-131931" href="/Public/Bug/Display.html?id=12890#txn-131931">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;15&nbsp;16:18:33&nbsp;2005</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/131931/36115/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/36115">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 54b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">No reply, so fix added to next release.  Ticket closed
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-131932" href="/Public/Bug/Display.html?id=12890#txn-131932">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;15&nbsp;16:18:34&nbsp;2005</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.346909</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
