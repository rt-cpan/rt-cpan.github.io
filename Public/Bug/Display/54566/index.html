<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #54566 for Parallel-ForkManager: nowait parameter for start method</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #54566 for Parallel-ForkManager: nowait parameter for start method</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/dluxhu/perl-parallel-forkmanager/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Parallel-ForkManager">Parallel-ForkManager CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">54566</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Parallel-ForkManager/Active/">Parallel-ForkManager</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
fbicknel [...] nc.rr.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-24602-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.7.5    </td>
  </tr>
  <tr id="CF-24603-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;15:01:37&nbsp;2010</span>
    <span class="description">fbicknel [...] nc.rr.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> nowait parameter for start method</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I found that sometimes I don&#39;t want ForkManager to sit around waiting
for child processes to finish so that it might start another.

In these cases, I may wish to return and deal with another queue for
example, which I might submit using a different instance of PM.

It would be nice if there were a mechanism to make -&gt;start return if
there are too many child processes to start a new one.  One method might
be to include a new method, -&gt;start_no_wait for example.  But I found
that if you add a second parameter to -&gt;start &#40;$ident, $nowait&#41;, which
if true would return immediately with a PID, or zero or undef.  The
undef would indicate that there are too many processes running; the
caller should come back later.

I found that a simple mod to -&gt;start would do the trick.  I include the
mod below:


    280 sub start {
    281     my &#40;$s,$identification, $noWait&#41;=@_;
    282     die &#34;Cannot start another process while you are in the child
process&#34; if $s-&gt;{in_child};
    283     if &#40;$noWait&#41; {
    284         my $kid;
    285         # reap as many kids as possible &#40;otherwise they just
hang around and gum up the works&#41;
    286         do {
    287             $kid = $s-&gt;wait_one_child &#40;&#38;WNOHANG&#41;;
    288         } while $kid &gt; 0;
    289         return undef if $s-&gt;{max_proc} &#38;&#38; &#40; keys %{
$s-&gt;{processes} } &#41; &gt;= $s-&gt;{max_proc};
    290     } else {
    291         while &#40;$s-&gt;{max_proc} &#38;&#38; &#40; keys %{ $s-&gt;{processes} } &#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;= $s-&gt;{max_proc}&#41; {
</div>    292             $s-&gt;on_wait;
    293             $s-&gt;wait_one_child&#40;defined $s-&gt;{on_wait_period} ?
&#38;WNOHANG : undef&#41;;
    294         };
    295         $s-&gt;wait_children;
    296     }

My only reservation at this point is that -&gt;on_wait is not called as it
is in the original while loop &#40;which remains intact near line 292
above&#41;.  However, I think that it&#39;s ok in this case, as we&#39;re NOT
waiting, but rather just checking whether any children are finished and
checking to see how many processes are running.  

If we fall through this last return &#40;on line 296 above&#41;, then the next
thing to do is the usual fork.

The calling code would then need to check for undef returned, and if
found can go on about other business.  If something &gt;= 0 is returned,
then we implement the usual behavior.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;15:04:32&nbsp;2010</span>
    <span class="description">fbicknel [...] nc.rr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> fbicknel [...] nc.rr.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s sad that RT does not display the structure of the code.  It&#39;s in
there, but you can&#39;t see it.  If you &#39;reply&#39;, then the indentation is there.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;15:12:44&nbsp;2010</span>
    <span class="description">fbicknel [...] nc.rr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> fbicknel [...] nc.rr.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Apparently you already have a method that incorporates waiting on all
the kids:

-&gt;wait_children

waits on all of &#39;em.
  This reduced my proposed start method code to:

    280 sub start {
    281     my &#40;$s,$identification, $noWait&#41;=@_;
    282     die &#34;Cannot start another process while you are in the child
process&#34; if $s-&gt;{in_child};
    283     if &#40;$noWait&#41; {
    284         # reap as many kids as possible &#40;otherwise they just
hang around and gum up the works&#41;
    285         $s-&gt;wait_children;
    286         return undef if $s-&gt;{max_proc} &#38;&#38; &#40; keys %{
$s-&gt;{processes} } &#41; &gt;= $s-&gt;{max_proc};
    287     } else {
    288         while &#40;$s-&gt;{max_proc} &#38;&#38; &#40; keys %{ $s-&gt;{processes} } &#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;= $s-&gt;{max_proc}&#41; {
</div>    289             $s-&gt;on_wait;
    290             $s-&gt;wait_one_child&#40;defined $s-&gt;{on_wait_period} ?
&#38;WNOHANG : undef&#41;;
    291         };
    292         $s-&gt;wait_children;
    293     }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;21:16:41&nbsp;2010</span>
    <span class="description">dlux [...] dlux.hu -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;21:17:11&nbsp;2010</span>
    <span class="description">dlux [...] dlux.hu -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;21:18:23&nbsp;2010</span>
    <span class="description">dlux [...] dlux.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #54566] nowait parameter for start method</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 16 Feb 2010 02:16:26 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Parallel-ForkManager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Balázs Szabó &lt;dlux [...] dlux.hu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

There are some problems with your idea:

- You cannot really use multiple Parallel::ForkManager instances in the
current code.
- wait_children blocks, so it is not really suitable for inclusion in the
start method.

Cheers,

Balázs

wait_childer blocks

On Mon, Feb 15, 2010 at 20:12, Frank Bicknell via RT &lt;
bug-Parallel-ForkManager@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Parallel-ForkManager
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=54566">https://rt.cpan.org/Ticket/Display.html?id=54566</a></span> &gt;
&gt;
&gt; Apparently you already have a method that incorporates waiting on all
&gt; the kids:
&gt;
&gt; -&gt;wait_children
&gt;
&gt; waits on all of &#39;em.
&gt;  This reduced my proposed start method code to:
&gt;
&gt;    280 sub start {
&gt;    281     my &#40;$s,$identification, $noWait&#41;=@_;
&gt;    282     die &#34;Cannot start another process while you are in the child
&gt; process&#34; if $s-&gt;{in_child};
&gt;    283     if &#40;$noWait&#41; {
&gt;     284         # reap as many kids as possible &#40;otherwise they just
&gt; hang around and gum up the works&#41;
&gt;     285         $s-&gt;wait_children;
&gt;    286         return undef if $s-&gt;{max_proc} &#38;&#38; &#40; keys %{
&gt; $s-&gt;{processes} } &#41; &gt;= $s-&gt;{max_proc};
&gt;     287     } else {
&gt;    288         while &#40;$s-&gt;{max_proc} &#38;&#38; &#40; keys %{ $s-&gt;{processes} } &#41;
<div class="message-stanza open">&gt; &gt;= $s-&gt;{max_proc}&#41; {
</div>&gt;    289             $s-&gt;on_wait;
&gt;    290             $s-&gt;wait_one_child&#40;defined $s-&gt;{on_wait_period} ?
&gt; &#38;WNOHANG : undef&#41;;
&gt;    291         };
&gt;    292         $s-&gt;wait_children;
&gt;    293     }
&gt;
&gt;
</div>

-- 
Balázs Szabó &#40;dLux&#41;
www.dlux.hu

你很好奇
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;21:18:31&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;18&nbsp;11:39:36&nbsp;2010</span>
    <span class="description">dlux [...] dlux.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Actually what you&#39;ve described is the way PFM SHOULD work. If it works otherwise, then let me 
know!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;18&nbsp;11:39:37&nbsp;2010</span>
    <span class="description">dlux [...] dlux.hu -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
