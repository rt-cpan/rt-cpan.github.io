<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #107491 for Net-Amazon-EC2: Authentication failure with IAM role</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #107491 for Net-Amazon-EC2: Authentication failure with IAM role</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Amazon-EC2/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Amazon-EC2/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Amazon-EC2/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Amazon-EC2/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Amazon-EC2">Net-Amazon-EC2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">107491</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">patched</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Amazon-EC2/Active/">Net-Amazon-EC2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ether [...] cpan.org

<br />
sozturk [...] ascllc.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42016-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42017-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;02&nbsp;11:22:41&nbsp;2015</span>
    <span class="description">sozturk [...] ascllc.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Authentication failure with IAM role</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Oct 2015 11:22:30 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Amazon-EC2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Selcuk Ozturk &lt;sozturk [...] ascllc.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When authenticating from an instance with an IAM role if 
signature_version=4 is chosen, authentication fails. From the same 
instance, authentication works if signature_version=2.

Authentication with master access key and secret key succeeds with both 
signature versions.

-- 

-- Selcuk
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;02&nbsp;14:46:18&nbsp;2015</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 02 11:22:41 2015, sozturk@ascllc.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When authenticating from an instance with an IAM role if 
&gt; signature_version=4 is chosen, authentication fails. From the same 
&gt; instance, authentication works if signature_version=2.
&gt; 
&gt; Authentication with master access key and secret key succeeds with both 
&gt; signature versions.
</div>
Thanks for the report - would it be possible to submit a failing test case?  I don&#39;t ever use IAM authentication so its especially difficult for me to design a test case.

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;02&nbsp;14:46:19&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;02&nbsp;14:56:50&nbsp;2015</span>
    <span class="description">sozturk [...] ascllc.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107491] Authentication failure with IAM role</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Oct 2015 14:56:37 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Amazon-EC2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Selcuk Ozturk &lt;sozturk [...] ascllc.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you can explain what you mean by a test case, I might be able to do it.

-- Selcuk

On 10/2/15 2:46 PM, Mark Allen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107491">https://rt.cpan.org/Ticket/Display.html?id=107491</a></span> &gt;
&gt;
&gt; On Fri Oct 02 11:22:41 2015, sozturk@ascllc.net wrote:
<div class="message-stanza open">&gt;&gt; When authenticating from an instance with an IAM role if
&gt;&gt; signature_version=4 is chosen, authentication fails. From the same
&gt;&gt; instance, authentication works if signature_version=2.
&gt;&gt;
&gt;&gt; Authentication with master access key and secret key succeeds with both
&gt;&gt; signature versions.
</div>&gt; Thanks for the report - would it be possible to submit a failing test case?  I don&#39;t ever use IAM authentication so its especially difficult for me to design a test case.
&gt;
&gt; Thanks.
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;02&nbsp;14:59:45&nbsp;2015</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 02 14:56:50 2015, sozturk@ascllc.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you can explain what you mean by a test case, I might be able to do
&gt; it.
</div>
I mean a .t file which has a failing test case for the authentication you discussed - take a look at 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/net-amazon-ec2/blob/master/t/04_live_v4.t">https://github.com/mrallen1/net-amazon-ec2/blob/master/t/04_live_v4.t</a></span>

for inspiration of what this might look like - the test file would be a  a series of operation
that are repeatable so that when I work on this bug I can test a solution until the test 
case&#40;s&#41; pass the test.

Thanks for any help you can provide.

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;02&nbsp;15:52:47&nbsp;2015</span>
    <span class="description">sozturk [...] ascllc.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107491] Authentication failure with IAM role</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Oct 2015 15:52:33 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Amazon-EC2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Selcuk Ozturk &lt;sozturk [...] ascllc.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have pasted a very simple test case at the end of this message. Of 
course, the point is, this test needs to be run on an instance that has 
been launched with an IAM role &#40;as explained here: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html&#41;">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html&#41;</a></span>, 
so Net::Amazon::EC2 can obtain the credentials automatically.

Also, I think the region needs to be the same region where the instance 
is running. I think these role based instance credentials are limited to 
the region they are in. But, I may be wrong on that.

When I run the below test on my instance launched with an IAM role 
allowing all describe type access in us-east-1a, it fails with 
authentication failure. However, if I just change the &#39;signature_version 
= 2&#39;, it passes.

-- Selcuk

On 10/2/15 2:59 PM, Mark Allen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107491">https://rt.cpan.org/Ticket/Display.html?id=107491</a></span> &gt;
&gt;
&gt; On Fri Oct 02 14:56:50 2015, sozturk@ascllc.net wrote:
<div class="message-stanza open">&gt;&gt; If you can explain what you mean by a test case, I might be able to do
&gt;&gt; it.
</div>&gt; I mean a .t file which has a failing test case for the authentication you discussed - take a look at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/net-amazon-ec2/blob/master/t/04_live_v4.t">https://github.com/mrallen1/net-amazon-ec2/blob/master/t/04_live_v4.t</a></span>
&gt;
&gt; for inspiration of what this might look like - the test file would be a  a series of operation
&gt; that are repeatable so that when I work on this bug I can test a solution until the test
&gt; case&#40;s&#41; pass the test.
&gt;
&gt; Thanks for any help you can provide.
&gt;
&gt; Mark
</div>------- cut
use strict;
use blib;
use Test::More;

BEGIN {
       plan tests =&gt; 3;
       use_ok&#40; &#39;Net::Amazon::EC2&#39; &#41;;
};

my $ec2 = eval {
     Net::Amazon::EC2-&gt;new&#40;
         region            =&gt; &#39;us-east-1&#39;,
         ssl               =&gt; 1,
         #debug             =&gt; 1,
         signature_version =&gt; 4,
         return_errors     =&gt; 1,
     &#41;;
};

isa_ok&#40;$ec2, &#39;Net::Amazon::EC2&#39;&#41;;

my $regions = $ec2-&gt;describe_regions&#40;&#41;;
my $seen_region = 0;
if &#40;ref&#40;$regions&#41; eq &#39;Net::Amazon::EC2::Errors&#39;&#41; {
     foreach my $err &#40;@{$regions-&gt;errors}&#41; {
         print $err-&gt;message . &#34;\n&#34;;
     }
     fail&#40;&#34;Describing regions&#34;&#41;;
} else {
     foreach my $region &#40;@{$regions}&#41; {
         if &#40;$region-&gt;region_name eq &#39;us-east-1&#39;&#41; {
             $seen_region = 1;
         }
     }
     ok&#40;$seen_region == 1, &#34;Describing regions&#34;&#41;;
}
------ cut
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;02&nbsp;21:24:02&nbsp;2015</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 02 15:52:47 2015, sozturk@ascllc.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have pasted a very simple test case at the end of this message. Of
&gt; course, the point is, this test needs to be run on an instance that
&gt; has
&gt; been launched with an IAM role &#40;as explained here:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-</a></span>
&gt; amazon-ec2.html&#41;,
&gt; so Net::Amazon::EC2 can obtain the credentials automatically.
&gt; 
&gt; Also, I think the region needs to be the same region where the
&gt; instance
&gt; is running. I think these role based instance credentials are limited
&gt; to
&gt; the region they are in. But, I may be wrong on that.
&gt; 
&gt; When I run the below test on my instance launched with an IAM role
&gt; allowing all describe type access in us-east-1a, it fails with
&gt; authentication failure. However, if I just change the
&gt; &#39;signature_version
&gt; = 2&#39;, it passes.
</div>
Thanks! That&#39;s super helpful.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;30&nbsp;13:48:55&nbsp;2016</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This bug affects of multiple users of `ec2-consistent-snapshot` who would like to use IAM roles in newer regions where only Signature Version 4 is supported

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/alestic/ec2-consistent-snapshot/issues/76">https://github.com/alestic/ec2-consistent-snapshot/issues/76</a></span>

I&#39;ll take a look a the Perl for Net::Amazon::EC2 now to see if anything stands out. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;30&nbsp;14:55:39&nbsp;2016</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I discovered part of the bug, but there is still more to debug. First, the definite bug I found:

&#34;temp_creds&#34; is defined with &#34;lazy =&gt; 1&#34;, so that the values will be looked up when they needed. 

But in _sign_v4, because calling temp_creds, there&#39;s a call to &#34;has_temp_creds&#34; to check if the temp creds *already exist*. Since they don&#39;t, temp_creds is never called. Thus, you can see the resulting request does not contain &#34;X-Amz-Security-Token&#34; when it  should.

I tested this was the issue by removing &#34;lazy =&gt; 1&#34;, which made X-Amz-Security-Token&#34; start appearing in the resulting request as desired. 

But the requests still fail anyway. 

I started to look further, but I&#39;ll stop and ask, why not use AWS::Signature4 for generating the signature? It appears to have solved Signature4/IAM role issue. All this module would have to do is pass it the secret token. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;30&nbsp;15:06:39&nbsp;2016</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 30 14:55:39 2016, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I discovered part of the bug, but there is still more to debug. First,
&gt; the definite bug I found:
&gt; 
&gt; &#34;temp_creds&#34; is defined with &#34;lazy =&gt; 1&#34;, so that the values will be
&gt; looked up when they needed.
&gt; 
&gt; But in _sign_v4, because calling temp_creds, there&#39;s a call to
&gt; &#34;has_temp_creds&#34; to check if the temp creds *already exist*. Since
&gt; they don&#39;t, temp_creds is never called. Thus, you can see the
&gt; resulting request does not contain &#34;X-Amz-Security-Token&#34; when it
&gt; should.
&gt; 
&gt; I tested this was the issue by removing &#34;lazy =&gt; 1&#34;, which made X-Amz-
&gt; Security-Token&#34; start appearing in the resulting request as desired.
&gt; 
&gt; But the requests still fail anyway.
&gt; 
&gt; I started to look further, but I&#39;ll stop and ask, why not use
&gt; AWS::Signature4 for generating the signature? It appears to have
&gt; solved Signature4/IAM role issue. All this module would have to do is
&gt; pass it the secret token.
</div>
Thanks for looking at this issue. Sorry - I obviously had forgotten about it!

Also, thank you for debugging things this far.  I can&#39;t remember why but IIRC when I was working on V4 support either the modules that were currently available on CPAN were not compatible with Moose for some reason or were poorly written or both.  

I have long thought outsourcing the signature work to their own modules would be a nice change but never got around to encapsulating them and making it work.  I would definitely welcome a PR implementing that change though, if you feel like working on it.

If not, I will try to get it done in the next few weeks.

Thanks again!

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;03&nbsp;19:36:51&nbsp;2017</span>
    <span class="description">ether [...] cpan.org -  Requestor ETHER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;28&nbsp;14:33:32&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 30 14:55:39 2016, MARKSTOS wrote:

I have a PR up that I need help testing with

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/net-amazon-ec2/pull/60">https://github.com/mrallen1/net-amazon-ec2/pull/60</a></span>

Since I don&#39;t use IAM roles, it&#39;s a bit difficult for me to directly test this code.

Any testing help on that front would be great.

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;29&nbsp;20:06:15&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 28 14:33:32 2017, mallen wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Dec 30 14:55:39 2016, MARKSTOS wrote:
&gt; 
&gt; I have a PR up that I need help testing with
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/net-amazon-ec2/pull/60">https://github.com/mrallen1/net-amazon-ec2/pull/60</a></span>
&gt; 
&gt; Since I don&#39;t use IAM roles, it&#39;s a bit difficult for me to directly
&gt; test this code.
&gt; 
&gt; Any testing help on that front would be great.
&gt; 
&gt; Thanks.
</div>
OK, I did get a tester and I released 0.35 to CPAN today which I believe fixes this issue.  Please give it a try.

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;29&nbsp;20:06:16&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
