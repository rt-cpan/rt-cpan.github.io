<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #301 for Parse-Nibbler: Patch for Profiler.pm</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #301 for Parse-Nibbler: Patch for Profiler.pm</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Parse-Nibbler/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Parse-Nibbler/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Parse-Nibbler/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Parse-Nibbler/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Parse-Nibbler">Parse-Nibbler CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">301</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Parse-Nibbler/Active/">Parse-Nibbler</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cburton [...] kpmg.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-24762-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24763-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;01:15:10&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch for Profiler.pm</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi there, please find attached a patch for Profiler.pm, which is part of Parse-Nibbler-1.10.tar.gz.   This is my first submitted patch, and I made it with diff -ru &lt;original&gt; &lt;fixed&gt;.  I hope this is cool.

It fixes an issue in Profiler.pm where the code being instrumented under Profiler forces subroutines to return scalars.  This patch changes Profiler so that profiled subroutines can return arrays.

Dist : Parse-Nibbler-1.10.tar.gz
PERL: 5.6
OS : Linux RedHat 7.1

Code that shows the bug

use Profiler;

my @results = &#38;foo&#40;45&#41;;

print &#34;Results are &#34;,Dumper&#40;\@results&#41;,&#34;\n&#34;;

sub foo
{   my @stuff = &#40;1,2,3,4&#41;;

print &#34;Wantarray is &#34;,wantarray,&#34;\n&#34;;

    return @stuff;
}

Should give &#34;Wantarray 1&#34;, and does if &#34;use Profiler;&#34; is removed.  


Kind regards and thankyou for this excellent resource

Craig Burton
Daniel Burton
The Online Assessment Company   theoac.com
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Profiler.pm	Fri Feb 22 16:59:50 2002
+++ Profiler_new.pm	Fri Feb 22 16:59:07 2002
@@ -278,14 +278,16 @@
     {
       __pre_code &#40; $name &#41;;
 
-      my $ret_val;
-      eval{ $ret_val = &#38;$coderef; };
+      my @ret_val;
+      eval{ @ret_val = &#38;$coderef; };
       my $eval_error = $@;
 
       __post_code &#40; $name &#41;;
       die &#40;$eval_error&#41; if &#40;$eval_error&#41;;
 
-      return $ret_val;
+      return @ret_val if wantarray;
+      return $ret_val[0];
+
     };
 
   my $install_string = &#39;*&#39;.$name.&#39; = \&#38;$instrumented_ref; &#39; ;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;10:07:14&nbsp;2002</span>
    <span class="description">email [...] greglondon.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 22 Feb 2002 07:07:06 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Parse-Nibbler [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> email [...] greglondon.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #301] Patch for Profiler.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the bug report.
your patch didn&#39;t get attached,
but with your testcase, I already
see the problem. I&#39;ll fix it
tonight.

Thanks again,
Greg
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;24&nbsp;18:35:53&nbsp;2002</span>
    <span class="description">cburton [...] kpmg.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Burton, Craig&#34; &lt;cburton [...] kpmg.com.au&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-Parse-Nibbler [...] rt.cpan.org&#39;&#34; &lt;bug-Parse-Nibbler [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [cpan #301] Patch for Profiler.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Feb 2002 10:35:04 +1100</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Greg,  I might need to let Jarko know that the bug reporting thing is not
attaching patches...

Thanks for this great utility.  DProf is impossible to use with apache,
mod_perl and other things we have rigged up over here and it wants to
profile all use&#39;d code as well.

I fixed your __instrument subroutine by making $retval into @retval and then
returning @retval or $retval[0] depending on wantarray.

Cheers, craig.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: email@greglondon.com via RT [mailto:bug-Parse-Nibbler@rt.cpan.org]
Sent: Saturday, February 23, 2002 2:07 AM
To: cburton@kpmg.com.au
Subject: Re: [cpan #301] Patch for Profiler.pm




Thanks for the bug report.
your patch didn&#39;t get attached,
but with your testcase, I already
see the problem. I&#39;ll fix it
tonight.

Thanks again,
Greg




**********************************************************************
This email is intended only for the use of the individual or entity
named above and may contain information that is confidential and
privileged. If you are not the intended recipient, you are hereby 
notified that any dissemination, distribution or copying of this 
Email is strictly prohibited. When addressed to our clients, any
opinions or advice contained in this Email are subject to the 
terms and conditions expressed in the governing KPMG client
engagement letter. If you have received this Email in error, please
notify us immediately by return email or telephone +61 2 93357000
and destroy the original message. Thank You. 
**********************************************************************M
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;24&nbsp;20:55:13&nbsp;2002</span>
    <span class="description">email [...] greglondon.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 24 Feb 2002 17:55:06 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Parse-Nibbler [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> email [...] greglondon.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [cpan #301] Patch for Profiler.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Craig,

I took your test case and used it 
to fix my profiler code.

I&#39;ve uploaded the profiler as it&#39;s 
own module on CPAN. you no longer 
have to download Parse::Nibbler
to get it.

it&#39;s called AutoNibbler.pm

Hope this fixes it for you.
lemme know if you have any other problems.

btw, what is the &#34;bug reporting thing&#34;
of which you mention? some feature on CPAN,
I assume. 

Greg



On Sun, 24 February 2002, cburton @ kpmg . com . au via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; 
&gt; Hi Greg,  I might need to let Jarko know that the bug reporting thing is not
&gt; attaching patches...
&gt; 
&gt; Thanks for this great utility.  DProf is impossible to use with apache,
&gt; mod_perl and other things we have rigged up over here and it wants to
&gt; profile all use&#39;d code as well.
&gt; 
&gt; I fixed your __instrument subroutine by making $retval into @retval and then
&gt; returning @retval or $retval[0] depending on wantarray.
&gt; 
&gt; Cheers, craig.
&gt; 
&gt; -----Original Message-----
&gt; From: email@greglondon.com via RT [mailto:bug-Parse-Nibbler@rt.cpan.org]
&gt; Sent: Saturday, February 23, 2002 2:07 AM
&gt; To: cburton@kpmg.com.au
&gt; Subject: Re: [cpan #301] Patch for Profiler.pm
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Thanks for the bug report.
&gt; your patch didn&#39;t get attached,
&gt; but with your testcase, I already
&gt; see the problem. I&#39;ll fix it
&gt; tonight.
&gt; 
&gt; Thanks again,
&gt; Greg
&gt; 
&gt; 
&gt; 
&gt; 
&gt; **********************************************************************
&gt; This email is intended only for the use of the individual or entity
&gt; named above and may contain information that is confidential and
&gt; privileged. If you are not the intended recipient, you are hereby 
&gt; notified that any dissemination, distribution or copying of this 
&gt; Email is strictly prohibited. When addressed to our clients, any
&gt; opinions or advice contained in this Email are subject to the 
&gt; terms and conditions expressed in the governing KPMG client
&gt; engagement letter. If you have received this Email in error, please
&gt; notify us immediately by return email or telephone +61 2 93357000
&gt; and destroy the original message. Thank You. 
&gt; **********************************************************************M
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;24&nbsp;20:57:26&nbsp;2002</span>
    <span class="description">email [...] greglondon.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 24 Feb 2002 17:57:24 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Parse-Nibbler [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> email [...] greglondon.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [cpan #301] Patch for Profiler.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 24 February 2002, cburton @ kpmg . com . au via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Greg,  I might need to let Jarko know that the bug reporting thing is not
&gt; attaching patches...
</div>
sorry, forgot to mention this.
Yes, let Jarko know that attachments
are getting stripped out.

it might be the intended action,
but the fact that it did so without
letting you know is a bad thing.

Greg
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
