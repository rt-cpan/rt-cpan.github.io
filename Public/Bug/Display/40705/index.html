<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40705 for PDF-Table: Fix for PDF generation causing error messages with paid Acrobat versions</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40705 for PDF-Table: Fix for PDF generation causing error messages with paid Acrobat versions</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PDF-Table/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PDF-Table/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PDF-Table/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PDF-Table/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/kamenov/PDF-Table/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-Table">PDF-Table CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40705</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PDF-Table/Active/">PDF-Table</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jbazik [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
haa [...] iki.fi

<br />
MANWAR [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-25026-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.9.3    </td>
  </tr>
  <tr id="CF-25027-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;06&nbsp;03:38:46&nbsp;2008</span>
    <span class="description">http://openid.haa.iki.fi/ -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix for PDF generation causing error messages with paid Acrobat
 versions</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">PDF::Table generates PDF which causes paid Adobe Acrobat sometimes to loudly claim that 
the PDF file is broken even if it works with the free Acrobat Reader and other PDF viewers.

The changes needed to fix this are very small, just ordering PDF commands around a bit:

1&#41; drawing line segments with no matching stroke operation at the end. Acrobat complains 
about the next command happening within unfinished path construction. 
FIX: Only draw the line segments if we&#39;re going to stroke later, not just always draw 
everything and then stroke conditionally.

2&#41; setting color after building drawing path before fill command. Acrobat claims this is a 
syntax error. 
FIX: First set color, then draw path rectangle/line segments, then stroke/fill.

These changes are pretty minor and should not break anything. See attached DIFF for out 
solution. I tried to code using the existing style.

Background: We had trouble with PDF::Table generated output and users of paid Acrobat 7. 
We used Acrobat Pro 9 &#40;free 30 day trial ;-&#41; to debug the issue, the PreFlight PDF Syntax 
check showed the above issues quite clearly.

Info: PDF::Table 0.9.3, Perl 5.8.8, OSX and Linux.

Thanks for a great Perl module!
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-Table-0.9.3-acrobat-syntax-error-fix.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- PDF-Table-0.9.3.original/lib/PDF/Table.pm	2006-12-27 16:44:26.000000000 +0200
+++ PDF-Table-0.9.3/lib/PDF/Table.pm	2008-11-05 16:45:40.000000000 +0200
@@ -462,9 +455,11 @@
 
 			# Draw the top line
 			$cur_y = $table_top_y;
+			# Only create path when we will stroke later -- avoid Acrobat 9.0.0 PreFlight Syntax errors
+			if&#40;$line_w&#41; {
 			$gfx-&gt;move&#40; $xbase , $cur_y &#41;;
 			$gfx-&gt;hline&#40;$xbase + $width &#41;;
-
+			}
 			# Each iteration adds a row to the current page until the page is full 
 			#  or there are no more rows to add
 			while&#40;scalar&#40;@{$data}&#41; and $cur_y-$row_h &gt; $bot_marg&#41;
@@ -598,7 +593,7 @@
 							$col_props-&gt;[$j]-&gt;{&#39;background_color&#39;} || 
 							$background_color &#41; 
 					{
-						$gfx_bg-&gt;rect&#40; $cur_x, $cur_y-$row_h, $calc_column_widths-&gt;[$j], $row_h&#41;;
+						# Set color before drawing -- avoid Acrobat 9.0.0 PreFlight Syntax errors
 						if &#40; $cell_props-&gt;[$row_cnt][$j]-&gt;{&#39;background_color&#39;} &#38;&#38; !$first_row &#41;
 						{
 						    $gfx_bg-&gt;fillcolor&#40;$cell_props-&gt;[$row_cnt][$j]-&gt;{&#39;background_color&#39;}&#41;;
@@ -611,6 +606,7 @@
 						{
 						    $gfx_bg-&gt;fillcolor&#40;$background_color&#41;;
 						}
+						$gfx_bg-&gt;rect&#40; $cur_x, $cur_y-$row_h, $calc_column_widths-&gt;[$j], $row_h&#41;;
 						$gfx_bg-&gt;fill&#40;&#41;;
 					}
 					$cur_x += $calc_column_widths-&gt;[$j];
@@ -618,14 +614,21 @@
 
 				$cur_y -= $row_h;
 				$row_h  = $min_row_h;
+                                # Only create path when we will stroke later -- avoid Acrobat 9.0.0 PreFlight Syntax errors
+                                if &#40;$line_w&#41; { 
 				$gfx-&gt;move&#40;  $xbase , $cur_y &#41;;
 				$gfx-&gt;hline&#40; $xbase + $width &#41;;
+                                }
 				$rows_counter++;
 				$row_cnt++ unless &#40; $first_row &#41;;
 				$first_row = 0;
 			}# End of while&#40;scalar&#40;@{$data}&#41; and $cur_y-$row_h &gt; $bot_marg&#41;
 
 			# Draw vertical lines
+
+                        if&#40;$line_w&#41; { # Only create path when we will stroke later -- avoid Acrobat 9.0.0 PreFlight Syntax errors
+                            # Set color before lines -- avoid Acrobat 9.0.0 PreFlight Syntax errors
+                            $gfx-&gt;fillcolor&#40; $border_color&#41;;
 			$gfx-&gt;move&#40;  $xbase, $table_top_y&#41;;
 			$gfx-&gt;vline&#40; $cur_y &#41;;
 			my $cur_x = $xbase;
@@ -637,8 +640,9 @@
 
 			}
 			# ACTUALLY draw all the lines
-			$gfx-&gt;fillcolor&#40; $border_color&#41;;
-			$gfx-&gt;stroke if $line_w;
+                            $gfx-&gt;stroke;
+                        }# End of if&#40;$line_w&#41;
+
 			$pg_cnt++;
 		}# End of while&#40;scalar&#40;@{$data}&#41;&#41;
 	}# End of if&#40;ref $data eq &#39;ARRAY&#39;&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;02&nbsp;08:01:24&nbsp;2010</span>
    <span class="description">MANWAR [...] cpan.org - Ticket #55137:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patched PDF::Table 0.9.3</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please find attached the patched PDF::Table.pm as mentioned in the Bug
Id: 40705
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-Table.pm</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;17&nbsp;23:58:56&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:01:46&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t have any way to test this, but I understand the problem.  I
changed it so that no gfx calls are made if the stroke width is zero.
It&#39;s essentially what you suggested.  Let me know if that doesn&#39;t
fix it.

The new version is 0.9.4, just uploaded to cpan.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:01:47&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:01:47&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:03:22&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org - Ticket #55137:  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:03:47&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org - Ticket #55137:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.9.4, thanks.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:03:47&nbsp;2011</span>
    <span class="description">The RT System itself - Ticket #55137:  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:03:48&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org - Ticket #55137:  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:04:08&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org - Ticket #55137:  Merged into ticket #40705</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;18&nbsp;00:04:08&nbsp;2011</span>
    <span class="description">jbazik [...] cpan.org -  Merged into ticket #40705</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
