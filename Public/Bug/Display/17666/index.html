<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17666 for Module-Build: Adding SWIG support</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17666 for Module-Build: Adding SWIG support</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Module-Build">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Module-Build">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Module-Build">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Module-Build">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-Build">Module-Build CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17666</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Module-Build">Module-Build</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rocky [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-21558-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.2611    </td>
  </tr>
  <tr id="CF-21559-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Swig-Build.PL<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/165196/52697/Swig-Build.PL">
Wed Feb 15 22:35:12 2006 (8.4k) by Rocky Bernstein
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=17666">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-165196" href="/Public/Bug/Display.html?id=17666#txn-165196">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;15&nbsp;22:35:12&nbsp;2006</span>
    <span class="description">Rocky Bernstein -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Adding SWIG support</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/165196/52694/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/52694">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 742b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Would like SWIG compilation support in added. It is already possible via
Subclassing, but might be better to have this as common code part of the
package. Attached should is what I think is the relevant excerpt from
Device::Cdio that I used. 

One little thing I noticed in this endeavor was that for SWIG
compilation  it is helpful to turn off some gcc warning messages until
such time SWIG is fixed to not cause gcc to emit them. So I changed the
order of applying user cflags &#40;extra_compiler_flags&#41; to come *after* the
cflags that are picked up as part of the Perl configuration. Another
possibility is to add a new option to allow  cflags specified before and
afterwards.

&#40;I am also trying to get some of this in the SWIG documentation.&#41;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Swig-Build.PL</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/165196/52697/Swig-Build.PL">Download Swig-Build.PL</a><br />
<span class="downloadcontenttype">text/x-perl 8.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
use strict;
use warnings;
use Module::Build;
use ExtUtils::PkgConfig;
use Config;

my $code = &lt;&lt;&#39;EOC&#39;;

sub process_swig_files {
    my $self = shift;
    my $p = $self-&gt;{properties};
    return unless $p-&gt;{swig_source};
    my $files_ref = $p-&gt;{swig_source};
    foreach my $file &#40;@$files_ref&#41; {
	$self-&gt;process_swig&#40;$file-&gt;[0], $file-&gt;[1]&#41;;
    }
}

# Check check dependencies for $main_swig_file. These are the
# %includes. If needed, arrange to run swig on $main_swig_file to
# produce a xxx_wrap.c C file.

sub process_swig {
  my &#40;$self, $main_swig_file, $deps_ref&#41; = @_;
  my &#40;$cf, $p&#41; = &#40;$self-&gt;{config}, $self-&gt;{properties}&#41;; # For convenience

  # File name. e.g, perlcdio.swg -&gt; perlcdio_wrap.c
  &#40;my $file_base = $main_swig_file&#41; =~ s/\.[^.]+$//;
  my $c_file = &#34;${file_base}_wrap.c&#34;;

  if &#40;$p-&gt;{swig_installed}&#41; {
      # .swg -&gt; .c
      $self-&gt;add_to_cleanup&#40;$c_file&#41;;
      
      # print &#34;+++ c_file: $c_file, file: $main_swig_file &#34;, `pwd`, &#34;\n&#34;;
      # If any of the swig files that the main swig depends is newer 
      # then rebuild.
      foreach my $depends_on &#40;$main_swig_file, @$deps_ref&#41; {
	  unless &#40;$self-&gt;up_to_date&#40;$depends_on, $c_file&#41;&#41; {
	      $self-&gt;compile_swig&#40;$main_swig_file, $c_file&#41;;
	      # Only need to build $c_file once no matter how many 
	      # includes there are.
	      last;
	  }
      }
  }
  
  # .c -&gt; .o
  my $obj_file = $self-&gt;compile_c&#40;$c_file&#41;;
  $self-&gt;add_to_cleanup&#40;$obj_file&#41;;

  # The .so files don&#39;t go in blib/lib/, they go in blib/arch/auto/.
  # Unfortunately we have to pre-compute the whole path.
  my $archdir;
  {
    my @dirs = File::Spec-&gt;splitdir&#40;$file_base&#41;;
    $archdir = File::Spec-&gt;catdir&#40;$self-&gt;blib,&#39;arch&#39;, @dirs[1..$#dirs]&#41;;
  }
  
  # .o -&gt; .so
  $self-&gt;link_c&#40;$archdir, $file_base, $obj_file&#41;;
}

# Invoke swig with -perl -outdir and other options.
sub compile_swig {
    my &#40;$self, $file, $c_file&#41; = @_;
    my &#40;$cf, $p&#41; = &#40;$self-&gt;{config}, $self-&gt;{properties}&#41;; # For convenience
    
    # File name, minus the suffix
    &#40;my $file_base = $file&#41; =~ s/\.[^.]+$//;
    
    my @swig;
    if &#40;defined&#40;$p-&gt;{swig}&#41;&#41; {
	@swig = $self-&gt;split_like_shell&#40;$p-&gt;{swig}&#41;;
    } else {
	@swig = &#40;&#39;swig&#39;&#41;;
    }
    if &#40;defined&#40;$p-&gt;{swig_flags}&#41;&#41; {
	@swig_flags = $self-&gt;split_like_shell&#40;$p-&gt;{swig_flags}&#41;;
    } else {
	@swig_flags = &#40;&#41;;
    }

    my $blib_lib = File::Spec-&gt;catfile&#40;$self-&gt;blib, &#39;lib&#39;&#41;;

    # print &#34;+++swig -o $c_file -outdir $blib_lib -perl $file\n&#34;;
    $self-&gt;do_system&#40;@swig, &#39;-o&#39;, $c_file, &#39;-outdir&#39;, $blib_lib,
		     &#39;-perl&#39;, @swig_flags, $file&#41;
	or die &#34;error building $c_file file from &#39;$file&#39;&#34;;
    
    return $c_file;
}

# From Base.pm but modified for a SWIG conventions.
# We just pass a $obj_file parameter
# SWIG objects have a get created with _wrap added. For example
# perlcdio.swg produces perlcdio_wrap.c, and perlcdio_wrap.o.
# But the shared object is still perlcdio.so.
# Also we modified the die to report the full file name.
sub link_c {
  my &#40;$self, $to, $file_base, $obj_file&#41; = @_;
  my &#40;$cf, $p&#41; = &#40;$self-&gt;{config}, $self-&gt;{properties}&#41;; # For convenience

  my $lib_file = File::Spec-&gt;catfile&#40;$to, File::Basename::basename&#40;&#34;$file_base.$cf-&gt;{dlext}&#34;&#41;&#41;;

  $self-&gt;add_to_cleanup&#40;$lib_file&#41;;
  my $objects = $p-&gt;{objects} || [];
  
  unless &#40;$self-&gt;up_to_date&#40;[$obj_file, @$objects], $lib_file&#41;&#41; {
    $self-&gt;prelink_c&#40;$to, $file_base&#41; if $self-&gt;need_prelink_c;

    my @linker_flags = $self-&gt;split_like_shell&#40;$p-&gt;{extra_linker_flags}&#41;;
    my @lddlflags = $self-&gt;split_like_shell&#40;$cf-&gt;{lddlflags}&#41;;
    my @shrp = $self-&gt;split_like_shell&#40;$cf-&gt;{shrpenv}&#41;;
    my @ld = $self-&gt;split_like_shell&#40;$cf-&gt;{ld}&#41;;
    $self-&gt;do_system&#40;@shrp, @ld, @lddlflags, @user_libs, &#39;-o&#39;, $lib_file,
		     $obj_file, @$objects, @linker_flags&#41;
      or die &#34;error building $lib_file file from &#39;$obj_file&#39;&#34;;
  }
  
  return $lib_file;
}

# From Base.pm but modified to put package cflags *after* 
# installed c flags so warning-removal will have an effect.

sub compile_c {
  my &#40;$self, $file&#41; = @_;
  my &#40;$cf, $p&#41; = &#40;$self-&gt;{config}, $self-&gt;{properties}&#41;; # For convenience
  
  # File name, minus the suffix
  &#40;my $file_base = $file&#41; =~ s/\.[^.]+$//;
  my $obj_file = &#34;$file_base$cf-&gt;{obj_ext}&#34;;
  $self-&gt;add_to_cleanup&#40;$obj_file&#41;;
  return $obj_file if $self-&gt;up_to_date&#40;$file, $obj_file&#41;;
  
  my @include_dirs = map {&#34;-I$_&#34;} &#40;@{$p-&gt;{include_dirs}},
				   File::Spec-&gt;catdir&#40;$cf-&gt;{installarchlib}, &#39;CORE&#39;&#41;&#41;;
  
  my @extra_compiler_flags = $self-&gt;split_like_shell&#40;$p-&gt;{extra_compiler_flags}&#41;;
  my @cccdlflags = $self-&gt;split_like_shell&#40;$cf-&gt;{cccdlflags}&#41;;
  my @ccflags = $self-&gt;split_like_shell&#40;$cf-&gt;{ccflags}&#41;;
  my @optimize = $self-&gt;split_like_shell&#40;$cf-&gt;{optimize}&#41;;

  # Whoah! There seems to be a bug in gcc 4.1.0 and optimization
  # and swig. I&#39;m not sure who&#39;s at fault. But for now the simplest
  # thing is to turn off all optimization. For the kinds of things that
  # SWIG does - do conversions between parameters and transfers calls
  # I doubt optimization makes much of a difference. But if it does,
  # it can be added back via @extra_compiler_flags.
  my @flags = &#40;@include_dirs, @cccdlflags, &#39;-c&#39;, @ccflags,
	       @extra_compiler_flags, &#41;;
  
  my @cc = $self-&gt;split_like_shell&#40;$cf-&gt;{cc}&#41;;
  
  $self-&gt;do_system&#40;@cc, @flags, &#39;-o&#39;, $obj_file, $file&#41;
    or die &#34;error building $cf-&gt;{obj_ext} file from &#39;$file&#39;&#34;;

  return $obj_file;
}

EOC


sub try_compile {
    my &#40;$c, %args&#41; = @_;

    my $ok = 0;
    my $tmp = &#34;tmp$$&#34;;
    local&#40;*TMPC&#41;;

    my $obj_ext = $Config{obj_ext} || &#34;.o&#34;;
    unlink&#40;&#34;$tmp.c&#34;, &#34;$tmp$obj_ext&#34;&#41;;

    if &#40;open&#40;TMPC, &#34;&gt;&#34;, &#34;$tmp.c&#34;&#41;&#41; {
	print TMPC $c;
	close&#40;TMPC&#41;;

	my $cccmd = $args{cccmd};
	my $errornull;
	my $ccflags = $Config{&#39;ccflags&#39;};
        $ccflags .= &#34; $args{ccflags}&#34; if $args{ccflags};

        if &#40;$args{silent} &#41; {
	    $errornull = &#34;2&gt;/dev/null&#34; unless defined $errornull;
	} else {
	    $errornull = &#39;&#39;;
	}

        $cccmd = &#34;$Config{&#39;cc&#39;} -o $tmp $ccflags $tmp.c $errornull&#34;
	    unless defined $cccmd;

	printf &#34;cccmd = $cccmd\n&#34; if $args{verbose};
	my $res = system&#40;$cccmd&#41;;
	$ok = defined&#40;$res&#41; &#38;&#38; $res == 0;

	if &#40; !$ok &#41; {
	    my $errno = $? &gt;&gt; 8;
	    local $! = $errno;
	    print &#34;
		
*** The test compile of &#39;$tmp.c&#39; failed: status $?
*** &#40;the status means: errno = $errno or &#39;$!&#39;&#41;
*** DO NOT PANIC: this just means that *some* you may get some innocuous
*** compiler warnings.
&#34;;
	}
	unlink&#40;&#34;$tmp.c&#34;&#41;;

    }
    return $ok;
}

sub try_cflags &#40;$&#41; {
    my &#40;$ccflags&#41; = @_;
    my $c_prog = &#34;int main &#40;&#41; { return 0; }\n&#34;;
    print &#34;Checking if $Config{cc} supports \&#34;$ccflags\&#34;...&#34;;
    my $result = try_compile&#40;$c_prog, ccflags=&gt;$ccflags&#41;;
    if &#40;$result&#41; {
	print &#34;yes\n&#34;;
	return &#34; $ccflags&#34;;
    }
    print &#34;no\n&#34;;
    return &#39;&#39;;
	
}

# ...

print &#34;Checking for SWIG...&#34;;
my @swig_version = `swig -version 2&gt;&#38;1`;
my $swig_installed = 0;
if &#40;$?&#41; {
    my $errno = $? &gt;&gt; 8;
    print &#34;
*** I don&#39;t see SWIG installed. I&#39;ll use the SWIG-generated file
*** that comes with the distribution. If you want SWIG, get it
*** from <span class="clickylink"><a target="new" rel="nofollow" href="http://www.swig.org">http://www.swig.org</a></span>
&#34;; 
    print &#34;*** Output was:
	@swig_version
&#34; if @swig_version;
} else {
    $swig_installed = 1;
    print &#34;ok\n&#34;;
}

my $ccflags = $pkgcfg{cflags};

## Swig produces a number of GCC warnings. Turn them off if we can.
$ccflags .= try_cflags&#40;&#34;-Wno-strict-aliasing&#34;&#41;;
$ccflags .= try_cflags&#40;&#34;-Wno-unused-function&#34;&#41;;
$ccflags .= try_cflags&#40;&#34;-Wno-unused-value&#34;&#41;;
$ccflags .= try_cflags&#40;&#34;-Wno-unused-function&#34;&#41;;
$ccflags .= try_cflags&#40;&#34;-Wno-unused-variable&#34;&#41;;

my $ldflags = $pkgcfg{libs};
my $swig_flags=&#39;&#39;;
if &#40;&#39;cygwin&#39; eq $Config{osname} &#38;&#38; 
    $Config{shrpenv} =~ m{\Aenv LD_RUN_PATH=&#40;.*&#41;\Z} &#41; {
    $ldflags .= &#34; -L$1 -lperl&#34;;
    # Should we check the 32-ness?
    $swig_flags = &#39;-DNEED_LONG&#39;;
} elsif &#40;&#39;darwin&#39; eq $Config{osname}&#41; {
    $ldflags .= &#34; -bundle -flat_namespace&#34;;
}

my $class = Module::Build-&gt;subclass&#40; code =&gt; $code &#41;;

my $builder = $class-&gt;new&#40; 
    module_name         =&gt; &#39;Your::Module&#39;,
    add_to_cleanup      =&gt; [ &#39;Your-Module-*&#39;, &#39;tmp*&#39;  ],
    dist_abstract       =&gt; &#39;Description of your module&#39;,
    dist_author         =&gt; &#39;Your Name &lt;you@cpan.org&gt;&#39;,
    dist_version_from   =&gt; &#39;lib/Your/Module.pm&#39;,
    extra_linker_flags  =&gt; $ldflags,
    extra_compiler_flags=&gt; $ccflags,
    swig_flags          =&gt; $swig_flags,
    swig_installed      =&gt; $swig_installed,
    license             =&gt; &#39;perl&#39;,
    requires =&gt; {
        &#39;Test::More&#39;              =&gt; 0,
        &#39;version&#39;                 =&gt; 0,
    },
    swig_source         =&gt; [ [&#39;main-swig-module.swg&#39;, 
			      [&#39;include1.swg&#39;, &#39;include2.swg&#39;]] ],
&#41;;

$builder-&gt;add_build_element&#40;&#39;swig&#39;&#41;;
$builder-&gt;create_build_script&#40;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-165396" href="/Public/Bug/Display.html?id=17666#txn-165396">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;16&nbsp;11:38:11&nbsp;2006</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/165396/52813/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/52813">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 240b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the suggestion and the sample code.  I agree this would be nice if it can be done 
in a nice generic fashion.  We&#39;re about to get our 0.28 release together and we can look at it 
after that, so I&#39;ll keep this ticket open.

 -Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-165397" href="/Public/Bug/Display.html?id=17666#txn-165397">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;16&nbsp;11:38:12&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.301232</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
