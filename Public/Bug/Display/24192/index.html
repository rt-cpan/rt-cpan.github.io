<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24192 for PAR-Packer: Incompatibility with Compress::Zlib 2.003 on some systems</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24192 for PAR-Packer: Incompatibility with Compress::Zlib 2.003 on some systems</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PAR-Packer/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PAR-Packer">PAR-Packer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24192</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PAR-Packer/Active/">PAR-Packer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
matthieu [...] codron.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-41710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.970    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;02&nbsp;17:43:27&nbsp;2007</span>
    <span class="description">matthieu [...] codron.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PAR::Packer fails to build on Mac OSX 10.4.8 with Compress::Zlib
 2.003</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I had a strange trying to build PAR::Packer 0.970 on OSX

$ perl -v

This is perl, v5.8.8 built for darwin-2level

$ uname -a
Darwin ordinateur-de-matthieu-codron.local 8.8.2 Darwin Kernel Version
8.8.2: Thu Sep 28 20:43:26 PDT 2006;
root:xnu-792.14.14.obj~1/RELEASE_I386 i386 i386

Perl is self compiled, installed in /usr/local

$ perl Makefile.PL

perl Makefile.PL
*** Module::AutoInstall version 1.03
*** Checking for Perl dependencies...
[Core Features]
- File::Temp       ...loaded. &#40;0.17 &gt;= 0.05&#41;
- Compress::Zlib   ...loaded. &#40;2.003 &gt;= 1.3&#41;
- Archive::Zip     ...loaded. &#40;1.18 &gt;= 1&#41;
- Module::ScanDeps ...loaded. &#40;0.70 &gt;= 0.7&#41;
- PAR::Dist        ...loaded. &#40;0.21 &gt;= 0.21&#41;
- PAR              ...loaded. &#40;0.970 &gt;= 0.97&#41;
- Getopt::ArgvFile ...loaded. &#40;1.10 &gt;= 1.07&#41;
*** Module::AutoInstall configuration finished.
Checking if your kit is complete...
Looks good
Writing Makefile for the par program
Writing Makefile for PAR::Packer

and then, when I type make:

$ make
[... everything&#39;s fine ..]

perl parlsig.pl ./static ./par 1 30000
./static -I&#34;/Users/matthieu/.cpan/build/PAR-Packer-0.970/inc&#34;
-I&#34;/usr/local/lib/perl5/5.8.8/darwin-2level&#34;
-I&#34;/usr/local/lib/perl5/5.8.8&#34;
-I&#34;/usr/local/lib/perl5/site_perl/5.8.8/darwin-2level&#34;
-I&#34;/usr/local/lib/perl5/site_perl/5.8.8&#34;
-I&#34;/usr/local/lib/perl5/site_perl&#34;
-I&#34;/Users/matthieu/.cpan/build/PAR-Packer-0.970&#34; -I&#34;.&#34; -I../myldr/..
-I../blib/lib -q -B -O../script/parl
 is only avaliable with the XS version at
/usr/local/lib/perl5/site_perl/5.8.8/Compress/Zlib.pm line 9
BEGIN failed--compilation aborted at
/usr/local/lib/perl5/site_perl/5.8.8/Compress/Zlib.pm line 9.
Compilation failed in require at
/usr/local/lib/perl5/site_perl/5.8.8/Archive/Zip.pm line 24.
BEGIN failed--compilation aborted at
/usr/local/lib/perl5/site_perl/5.8.8/Archive/Zip.pm line 24.
Compilation failed in require at -e line 406.
make[1]: *** [../script/parl] Error 255
make: *** [subdirs] Error 2

I tried many thing to make this work, without any luck. Worked finally
when I downgraded Compress::Zlib to 1.42.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;03&nbsp;04:34:21&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Incompatibility with Compress::Zlib 2.003</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This problem has been observed only on CentOS so far. In this context,
your bug report is very valuable because we don&#39;t have to look for
system-specific things any more.

There was some email exchange with the Compress::Zlib maintainer to try
to track down the problem, but so far, to no avail. I *think* it should
be a Compress::Zlib/Scalar::Util problem - but don&#39;t quote me on this.

I can&#39;t currently hunt this bug down since I can&#39;t reproduce it on my
machines.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;03&nbsp;04:34:24&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;03&nbsp;04:34:25&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;03&nbsp;04:38:49&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Subject changed from &#39;PAR::Packer fails to build on Mac OSX 10.4.8 with Compress::Zlib 2.003&#39; to &#39;Incompatibility with Compress::Zlib 2.003 on some systems&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;03&nbsp;04:38:50&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Severity Important changed to Normal</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;06&nbsp;12:09:34&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> MSCHWERN [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 02 17:43:27 2007, mcodron wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; I had a strange trying to build PAR::Packer 0.970 on OSX
</div>
Ditto.  Also 0.973.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  is only avaliable with the XS version at
&gt; /usr/local/lib/perl5/site_perl/5.8.8/Compress/Zlib.pm line 9
</div>
*snip*

The error is actually coming from Scalar::Util.  It means the XS portion
of Scalar::Util failed to load and dualvar will not work.  As
Scalar::Util works fine normally I suspect some sort of @INC
shennanigans in that mysterious ./static script.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tried many thing to make this work, without any luck. Worked finally
&gt; when I downgraded Compress::Zlib to 1.42.
</div>
1.42 works because it did not use Scalar::Util.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;06&nbsp;12:09:36&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;17:05:45&nbsp;2007</span>
    <span class="description">michael.scondo [...] arcor.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> michael.scondo [...] arcor.de</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 03 04:34:21 2007, SMUELLER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This problem has been observed only on CentOS so far. In this context,
&gt; your bug report is very valuable because we don&#39;t have to look for
&gt; system-specific things any more.
&gt; 
&gt; There was some email exchange with the Compress::Zlib maintainer to try
&gt; to track down the problem, but so far, to no avail. I *think* it should
&gt; be a Compress::Zlib/Scalar::Util problem - but don&#39;t quote me on this.
&gt; 
&gt; I can&#39;t currently hunt this bug down since I can&#39;t reproduce it on my
&gt; machines.
</div>
I&#39;m experiencing the same problem.
I&#39;ve installed perl-5.8.8 from source in a linux i386 chroot environment,
built with gcc and ulibc.

The whole chroot environment should be compressed at around 50MB, 
I could upload this to a ftp server and give you a login if you are interested.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;14&nbsp;03:34:14&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Thu Sep 13 17:05:45 2007, misc105 wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m experiencing the same problem.
&gt; I&#39;ve installed perl-5.8.8 from source in a linux i386 chroot
&gt; environment,
&gt; built with gcc and ulibc.
&gt; 
&gt; The whole chroot environment should be compressed at around 50MB,
&gt; I could upload this to a ftp server and give you a login if you are
&gt; interested.
</div>
That sounds great. I&#39;m not sure I&#39;ll find enough time soon, but having a
50MB image which I can use to reproduce the problem would be a great
first step!

If you like, you can send me the URL and a login via email. &#40;my
CPAN/PAUSE user id at cpan.org.&#41;

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;30&nbsp;05:32:25&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mschwern [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve tracked this down to that @INC is being rebuilt incorrectly such
that all the -Is to static are unshifted onto @INC in reverse.  This
results in the non-XS parts of @INC coming before the XS parts so the
non-XS version of Scalar::Util loads.

You can see the messed up @INC by placing

BEGIN {
        printf &#34;In CZlib: %s\n&#34;, join &#34;&#34;, map { &#34;$_\n&#34; } @INC;
}

at the top of Compress::Zlib.


The problem appears to be this in scripts/par.pl.

--- script/par.pl       &#40;revision 54264&#41;
+++ script/par.pl       &#40;local&#41;
@@ -413,11 +413,13 @@
         s   sign_par
         v   verify_par
     &#41;;
+
+    my @add_to_inc;
     while &#40;@ARGV&#41; {
         $ARGV[0] =~ /^-&#40;[AIMOBLbqpiusTv]&#41;&#40;.*&#41;/ or last;
 
         if &#40;$1 eq &#39;I&#39;&#41; {
-            unshift @INC, $2;
+            push @add_to_inc, $2;
         }
         elsif &#40;$1 eq &#39;M&#39;&#41; {
             eval &#34;use $2&#34;;
@@ -455,6 +457,8 @@
             exit;
         }
     }
+
+    unshift @INC, @add_to_inc;
 }
 
 # XXX -- add --par-debug support!


However, that isn&#39;t enough.  For some reason printing out load_me_2 in
main.c is required for it to take effect.  I don&#39;t know why.  Using
strings on static shows that it contains the fixed par.pl.  I&#39;ve tried
all sorts of make clean and patching a brand new tarball.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;17&nbsp;13:36:44&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 30 05:32:25 2008, MSCHWERN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve tracked this down to that @INC is being rebuilt incorrectly such
&gt; that all the -Is to static are unshifted onto @INC in reverse.  This
&gt; results in the non-XS parts of @INC coming before the XS parts so the
&gt; non-XS version of Scalar::Util loads.
&gt; 
&gt; You can see the messed up @INC by placing
&gt; 
&gt; BEGIN {
&gt;         printf &#34;In CZlib: %s\n&#34;, join &#34;&#34;, map { &#34;$_\n&#34; } @INC;
&gt; }
&gt; 
&gt; at the top of Compress::Zlib.
&gt; 
&gt; 
&gt; The problem appears to be this in scripts/par.pl.
&gt; 
&gt; --- script/par.pl       &#40;revision 54264&#41;
&gt; +++ script/par.pl       &#40;local&#41;
&gt; @@ -413,11 +413,13 @@
&gt;          s   sign_par
&gt;          v   verify_par
&gt;      &#41;;
&gt; +
&gt; +    my @add_to_inc;
&gt;      while &#40;@ARGV&#41; {
&gt;          $ARGV[0] =~ /^-&#40;[AIMOBLbqpiusTv]&#41;&#40;.*&#41;/ or last;
&gt;  
&gt;          if &#40;$1 eq &#39;I&#39;&#41; {
&gt; -            unshift @INC, $2;
&gt; +            push @add_to_inc, $2;
&gt;          }
&gt;          elsif &#40;$1 eq &#39;M&#39;&#41; {
&gt;              eval &#34;use $2&#34;;
&gt; @@ -455,6 +457,8 @@
&gt;              exit;
&gt;          }
&gt;      }
&gt; +
&gt; +    unshift @INC, @add_to_inc;
&gt;  }
&gt;  
&gt;  # XXX -- add --par-debug support!
&gt; 
&gt; 
&gt; However, that isn&#39;t enough.  For some reason printing out load_me_2 in
&gt; main.c is required for it to take effect.  I don&#39;t know why.  Using
&gt; strings on static shows that it contains the fixed par.pl.  I&#39;ve tried
&gt; all sorts of make clean and patching a brand new tarball.
</div>
Well, probably you still used the cached version and only by changing
something in main.c the cache got invalidated. I applied your patch,
deleted some of the directories in /var/tmp/par-$USER and now almost all
tests pass.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;18&nbsp;15:03:17&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 30 05:32:25 2008, MSCHWERN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve tracked this down to that @INC is being rebuilt incorrectly such
&gt; that all the -Is to static are unshifted onto @INC in reverse.  This
&gt; results in the non-XS parts of @INC coming before the XS parts so the
&gt; non-XS version of Scalar::Util loads.
&gt; 
&gt; You can see the messed up @INC by placing
&gt; 
&gt; BEGIN {
&gt;         printf &#34;In CZlib: %s\n&#34;, join &#34;&#34;, map { &#34;$_\n&#34; } @INC;
&gt; }
&gt; 
&gt; at the top of Compress::Zlib.
&gt; 
&gt; 
&gt; The problem appears to be this in scripts/par.pl.
&gt; 
&gt; --- script/par.pl       &#40;revision 54264&#41;
&gt; +++ script/par.pl       &#40;local&#41;
&gt; @@ -413,11 +413,13 @@
&gt;          s   sign_par
&gt;          v   verify_par
&gt;      &#41;;
&gt; +
&gt; +    my @add_to_inc;
&gt;      while &#40;@ARGV&#41; {
&gt;          $ARGV[0] =~ /^-&#40;[AIMOBLbqpiusTv]&#41;&#40;.*&#41;/ or last;
&gt;  
&gt;          if &#40;$1 eq &#39;I&#39;&#41; {
&gt; -            unshift @INC, $2;
&gt; +            push @add_to_inc, $2;
&gt;          }
&gt;          elsif &#40;$1 eq &#39;M&#39;&#41; {
&gt;              eval &#34;use $2&#34;;
&gt; @@ -455,6 +457,8 @@
&gt;              exit;
&gt;          }
&gt;      }
&gt; +
&gt; +    unshift @INC, @add_to_inc;
&gt;  }
&gt;  
&gt;  # XXX -- add --par-debug support!
&gt; 
&gt; 
&gt; However, that isn&#39;t enough.  For some reason printing out load_me_2 in
&gt; main.c is required for it to take effect.  I don&#39;t know why.  Using
&gt; strings on static shows that it contains the fixed par.pl.  I&#39;ve tried
&gt; all sorts of make clean and patching a brand new tarball.
</div>

Patch applied as change 584 in par&#39;s subversion repository
<span class="clickylink"><a target="new" rel="nofollow" href="http://svn.openfoundry.org/par/PAR-Packer/trunk">http://svn.openfoundry.org/par/PAR-Packer/trunk</a></span>

&#40;Can somebody close this ticket?&#41;

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;18&nbsp;16:07:03&nbsp;2008</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 18 15:03:17 2008, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Patch applied as change 584 in par&#39;s subversion repository
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.openfoundry.org/par/PAR-Packer/trunk">http://svn.openfoundry.org/par/PAR-Packer/trunk</a></span>
&gt; 
&gt; &#40;Can somebody close this ticket?&#41;
</div>
Hmm, not really. Applying the patch certainly makes sense, but there
were other issues as Schwern pointed out. Are you really, very, entirely
sure that this is just due to an old cache/.o/parl thing? When I talked
to Schwern, he was reasonably sure that he cleaned up everything. If
you&#39;re sure, I&#39;ll close the ticket.

Cheers,
Steffen

P.S.: Thanks for all the work you&#39;ve been putting into this recently.
It&#39;s much appreciated!
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
