<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33880 for Tk: Uninitialized value error in Tk::Menu</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33880 for Tk: Uninitialized value error in Tk::Menu</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33880</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk/Active/">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
matt [...] triclinic.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
DDUMONT [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
804.028    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;07&nbsp;11:37:43&nbsp;2008</span>
    <span class="description">matt [...] triclinic.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Uninitialized value error in Tk::Menu</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Tk::Menu is giving me an error in version 804.028 which it did not in
the previous version, exemplified by the following code:

#-----
#!/usr/bin/perl -w

use Tk;

my $mw = Tk::MainWindow-&gt;new&#40;&#41;;

my $menubar = $mw-&gt;Menu&#40; -type =&gt; &#39;menubar&#39; &#41;;
my $file = $menubar-&gt;Menu&#40;&#41;;
$menubar-&gt;add&#40;
    &#39;cascade&#39;,
    -label =&gt; &#39;File&#39;,
    -menu  =&gt; $file,
&#41;;
$file-&gt;add&#40;
    &#39;command&#39;,
    -label =&gt; &#39;Exit&#39;,
    -command =&gt; sub { $mw-&gt;destroy },
&#41;;
    
$mw-&gt;configure&#40; -menu =&gt; $menubar &#41;;

Tk::MainLoop&#40;&#41;;
#-----

Under 804.027 this worked as expected, but after upgrading to the
perl-Tk-804.028-3 package in Fedora Core 7, it fails to display the
menu, with this error:

Use of uninitialized value in numeric le &#40;&lt;=&#41; at
/usr/lib/perl5/vendor_perl/5.8.8/i386-linux-thread-multi/Tk/Menu.pm line
1041.

I dunno if this is a packaging problem by the Fedora people or a genuine
problem. If you can&#39;t reproduce it I can run it by the Fedora Bugzilla.

Thanks y&#39;all!

-- Matt

P.S. Perl and OS versions:

$ perl -v
Summary of my perl5 &#40;revision 5 version 8 subversion 8&#41; configuration:
  Platform:
    osname=linux, osvers=2.6.20-1.3001.fc6xen,
archname=i386-linux-thread-multi
    uname=&#39;linux xenbuilder4.fedora.phx.redhat.com 2.6.20-1.3001.fc6xen
#1 smp thu aug 9 16:18:42 edt 2007 i686 i686 i386 gnulinux &#39;
    config_args=&#39;-des -Doptimize=-O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
-fasynchronous-unwind-tables -Dversion=5.8.8 -Dmyhostname=localhost
-Dperladmin=root@localhost -Dcc=gcc -Dcf_by=Red Hat, Inc.
-Dinstallprefix=/usr -Dprefix=/usr -Darchname=i386-linux
-Dvendorprefix=/usr -Dsiteprefix=/usr -Duseshrplib -Dusethreads
-Duseithreads -Duselargefiles -Dd_dosuid -Dd_semctl_semun -Di_db
-Ui_ndbm -Di_gdbm -Di_shadow -Di_syslog -Dman3ext=3pm -Duseperlio
-Dinstallusrbinperl=n -Ubincompat5005 -Uversiononly
-Dpager=/usr/bin/less -isr -Dd_gethostent_r_proto -Ud_endhostent_r_proto
-Ud_sethostent_r_proto -Ud_endprotoent_r_proto -Ud_setprotoent_r_proto
-Ud_endservent_r_proto -Ud_setservent_r_proto -Dinc_version_list=5.8.7
5.8.6 5.8.5 -Dscriptdir=/usr/bin&#39;
    hint=recommended, useposix=true, d_sigaction=define
    usethreads=define use5005threads=undef useithreads=define
usemultiplicity=define
    useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
    use64bitint=undef use64bitall=undef uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing
-pipe -Wdeclaration-after-statement -I/usr/local/include
-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -I/usr/include/gdbm&#39;,
    optimize=&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
-fstack-protector --param=ssp-buffer-size=4 -m32 -march=i386
-mtune=generic -fasynchronous-unwind-tables&#39;,
    cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe
-Wdeclaration-after-statement -I/usr/local/include -I/usr/include/gdbm&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.1.2 20070925 &#40;Red Hat 4.1.2-27&#41;&#39;,
gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=4, prototype=define
  Linker and Libraries:
    ld=&#39;gcc&#39;, ldflags =&#39; -L/usr/local/lib&#39;
    libpth=/usr/local/lib /lib /usr/lib
    libs=-lresolv -lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc
    perllibs=-lresolv -lnsl -ldl -lm -lcrypt -lutil -lpthread -lc
    libc=/lib/libc-2.6.so, so=so, useshrplib=true, libperl=libperl.so
    gnulibc_version=&#39;2.6&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E
-Wl,-rpath,/usr/lib/perl5/5.8.8/i386-linux-thread-multi/CORE&#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
-fasynchronous-unwind-tables -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY PERL_IMPLICIT_CONTEXT
                        PERL_MALLOC_WRAP USE_ITHREADS USE_LARGE_FILES
                        USE_PERLIO USE_REENTRANT_API
  Built under linux
  Compiled at Nov 26 2007 14:25:21
  %ENV:
    PERL5LIB=&#34;&#34;
  @INC:
    /usr/lib/perl5/site_perl/5.8.8/i386-linux-thread-multi
    /usr/lib/perl5/site_perl/5.8.7/i386-linux-thread-multi
    /usr/lib/perl5/site_perl/5.8.6/i386-linux-thread-multi
    /usr/lib/perl5/site_perl/5.8.5/i386-linux-thread-multi
    /usr/lib/perl5/site_perl/5.8.8
    /usr/lib/perl5/site_perl/5.8.7
    /usr/lib/perl5/site_perl/5.8.6
    /usr/lib/perl5/site_perl/5.8.5
    /usr/lib/perl5/site_perl
    /usr/lib/perl5/vendor_perl/5.8.8/i386-linux-thread-multi
    /usr/lib/perl5/vendor_perl/5.8.7/i386-linux-thread-multi
    /usr/lib/perl5/vendor_perl/5.8.6/i386-linux-thread-multi
    /usr/lib/perl5/vendor_perl/5.8.5/i386-linux-thread-multi
    /usr/lib/perl5/vendor_perl/5.8.8
    /usr/lib/perl5/vendor_perl/5.8.7
    /usr/lib/perl5/vendor_perl/5.8.6
    /usr/lib/perl5/vendor_perl/5.8.5
    /usr/lib/perl5/vendor_perl
    /usr/lib/perl5/5.8.8/i386-linux-thread-multi
    /usr/lib/perl5/5.8.8
    .

$ uname -a
Linux tomis.med.virginia.edu 2.6.23.15-80.fc7 #1 SMP Sun Feb 10 17:29:10
EST 2008 i686 i686 i386 GNU/Linux
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;07&nbsp;18:29:37&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 07 11:37:43 2008, mattzimm wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tk::Menu is giving me an error in version 804.028 which it did not in
&gt; the previous version, exemplified by the following code:
&gt; 
&gt; #-----
&gt; #!/usr/bin/perl -w
&gt; 
&gt; use Tk;
&gt; 
&gt; my $mw = Tk::MainWindow-&gt;new&#40;&#41;;
&gt; 
&gt; my $menubar = $mw-&gt;Menu&#40; -type =&gt; &#39;menubar&#39; &#41;;
&gt; my $file = $menubar-&gt;Menu&#40;&#41;;
&gt; $menubar-&gt;add&#40;
&gt;     &#39;cascade&#39;,
&gt;     -label =&gt; &#39;File&#39;,
&gt;     -menu  =&gt; $file,
&gt; &#41;;
&gt; $file-&gt;add&#40;
&gt;     &#39;command&#39;,
&gt;     -label =&gt; &#39;Exit&#39;,
&gt;     -command =&gt; sub { $mw-&gt;destroy },
&gt; &#41;;
&gt;     
&gt; $mw-&gt;configure&#40; -menu =&gt; $menubar &#41;;
&gt; 
&gt; Tk::MainLoop&#40;&#41;;
&gt; #-----
&gt; 
&gt; Under 804.027 this worked as expected, but after upgrading to the
&gt; perl-Tk-804.028-3 package in Fedora Core 7, it fails to display the
&gt; menu, with this error:
&gt; 
&gt; Use of uninitialized value in numeric le &#40;&lt;=&#41; at
&gt; /usr/lib/perl5/vendor_perl/5.8.8/i386-linux-thread-multi/Tk/Menu.pm line
&gt; 1041.
&gt; 
&gt; I dunno if this is a packaging problem by the Fedora people or a genuine
&gt; problem. If you can&#39;t reproduce it I can run it by the Fedora Bugzilla.
&gt; 
</div>
I cannot reproduce the problem with your test script on various systems
&#40;FreeBSD 6.2 + perl 5.8.8, Debian Linux + perl 5.8.8, with Tk 804.028&#41;.
So it is possible that it&#39;s a Fedora-specific problem. Is it possible to
see a list of differences between the Tk 804.028 distribution and the
Fedora package, if any? What if you compile Tk yourself, does the
problem persist?

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;07&nbsp;18:29:39&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;12&nbsp;00:07:38&nbsp;2008</span>
    <span class="description">tcallawa [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tcallawa [...] redhat.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 07 18:29:37 2008, SREZIC wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So it is possible that it&#39;s a Fedora-specific problem.
</div>
Yes, it actually is a Fedora specific problem. For the details, see:

<span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=235666">https://bugzilla.redhat.com/show_bug.cgi?id=235666</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;10:35:38&nbsp;2009</span>
    <span class="description">DDUMONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 12 00:07:38 2008, tcallawa@redhat.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Mar 07 18:29:37 2008, SREZIC wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; So it is possible that it&#39;s a Fedora-specific problem.
</div>&gt; 
&gt; Yes, it actually is a Fedora specific problem. For the details, see:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=235666">https://bugzilla.redhat.com/show_bug.cgi?id=235666</a></span>
</div>
Uh ? this bug mentions a segfault. Here, we only have an undef value.

Anyway, I&#39;ve stumbled on the same problem on Mandriva.

The workaround is to call Menu, cascade or MenuItem with &#34;-tearoff =&gt; 0&#34;.


On Mandriva, the undef triggers an exception which is caught in an eval,
then the Menu construction fails. You can get more info on the failure
stack by running the Tk application in Perl debugger:

$ perl -w -d tk.pl~

Loading DB routines from perl5db.pl version 1.3
Editor support available.

Enter h or `h h&#39; for help, or `man perldebug&#39; for more help.

main::&#40;tk.pl~:12&#41;:      $MW = MainWindow-&gt;new;
  DB&lt;1&gt; r
Use of uninitialized value $i in numeric le &#40;&lt;=&#41; at
/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/Tk/Menu.pm
line 1041.
 at /usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/Tk/Menu.pm
line 1041
        Tk::Menu::tkMenuDup&#40;&#39;Tk::Menu=HASH&#40;0x8e7c660&#41;&#39;,
&#39;Tk::Menu=HASH&#40;0x8eb6cb0&#41;&#39;, &#39;menubar&#39;&#41; called at
/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/Tk/Configure.pm line
46
        eval {...} called at
/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/Tk/Configure.pm line
46
        eval {...} called at
/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/Tk/Configure.pm line
46
        Tk::Configure::configure&#40;&#39;Tk::Configure=ARRAY&#40;0x8e7c840&#41;&#39;,
&#39;-menu&#39;, &#39;Tk::Menu=HASH&#40;0x8e7c660&#41;&#39;&#41; called at
/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/Tk/Derived.pm
line 294
        eval {...} called at
/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/Tk/Derived.pm
line 294
        Tk::Derived::configure&#40;&#39;MainWindow=HASH&#40;0x8dc56b8&#41;&#39;, &#39;-menu&#39;,
&#39;Tk::Menu=HASH&#40;0x8e7c660&#41;&#39;&#41; called at tk.pl~ line 22
        main::build_menubar&#40;&#41; called at tk.pl~ line 66
        main::init&#40;&#41; called at tk.pl~ line 13

I&#39;ve no such problem on Debian/Sid. I&#39;ve compared Debian&#39;s and
Mandriva&#39;s Menu.pm and Menu/Item.pm and there&#39;s no difference.

I can only guess that the perl compiled on Mandriva is more strict than
on Debian.

On Mandriva, perl is compiled with:

$ perl -V                                                              
                                    
Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
                                                  
  Platform:                                                            
                                                  
    osname=linux, osvers=2.6.22.18-server-1mdv,
archname=i386-linux-thread-multi                                          
    uname=&#39;linux n2.mandriva.com 2.6.22.18-server-1mdv #1 smp mon feb 11
16:46:24 est 2008 i686 intel&#40;r&#41; xeon&#40;tm&#41; cpu 2.80ghz gnulinux &#39;        
                                                                       
                           
    config_args=&#39;-des -Dinc_version_list=5.8.8 5.8.7 5.8.6 5.8.5 5.8.4
5.8.3 5.8.2 5.8.1 5.8.0 5.6.1 5.6.0 -Darchname=i386-linux -Dcc=gcc
-Doptimize=-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
-fstack-protector --param=ssp-buffer-size=4 -fomit-frame-pointer
-march=i586 -mtune=generic -fasynchronous-unwind-tables -DDEBUGGING=-g
-Dprefix=/usr -Dvendorprefix=/usr -Dsiteprefix=/usr
-Dsitebin=/usr/local/bin -Dsiteman1dir=/usr/local/share/man/man1
-Dsiteman3dir=/usr/local/share/man/man3 -Dman3ext=3pm -Dcf_by=Mandriva
-Dmyhostname=localhost -Dperladmin=root@localhost
-Dcf_email=root@localhost -Dd_dosuid -Ud_csh -Duseshrplib -Duseithreads
-Di_db -Di_ndbm -Di_gdbm&#39;                                              
               
    hint=recommended, useposix=true, d_sigaction=define                
                                                  
    useithreads=define, usemultiplicity=define                         
                                                  
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
                                                 
    use64bitint=undef, use64bitall=undef, uselongdouble=undef          
                                                  
    usemymalloc=n, bincompat5005=undef                                 
                                                  
  Compiler:                                                            
                                                  
    cc=&#39;gcc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing
-pipe -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
-I/usr/include/gdbm&#39;,                                                  
                              
    optimize=&#39;-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
-fstack-protector --param=ssp-buffer-size=4 -fomit-frame-pointer
-march=i586 -mtune=generic -fasynchronous-unwind-tables&#39;,              
                                           
    cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe
-I/usr/local/include -I/usr/include/gdbm&#39;             
    ccversion=&#39;&#39;, gccversion=&#39;4.3.2&#39;, gccosandvers=&#39;&#39;                  
                                                  
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234     
                                                  
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
                                                  
    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8                                        
    alignbytes=4, prototype=define                                     
                                                  
  Linker and Libraries:                                                
                                                  
    ld=&#39;gcc&#39;, ldflags =&#39; -L/usr/local/lib&#39;                             
                                                  
    libpth=/usr/local/lib /lib /usr/lib                                
                                                  
    libs=-lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc       
                                                  
    perllibs=-lnsl -ldl -lm -lcrypt -lutil -lpthread -lc               
                                                  
    libc=/lib/libc-2.8.so, so=so, useshrplib=true, libperl=libperl.so  
                                                  
    gnulibc_version=&#39;2.8&#39;                                              
                                                  
  Dynamic Linking:                                                     
                                                  
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E
-Wl,-rpath,/usr/lib/perl5/5.10.0/i386-linux-thread-multi/CORE&#39;         
                                                                       
                               
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -g -pipe
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -fomit-frame-pointer -march=i586
-mtune=generic -fasynchronous-unwind-tables -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP USE_ITHREADS
                        USE_LARGE_FILES USE_PERLIO USE_REENTRANT_API
  Locally applied patches:
        Mandriva Linux patches
  Built under linux
  Compiled at Sep 18 2008 16:41:00
  @INC:
    /usr/lib/perl5/site_perl/5.10.0/i386-linux-thread-multi
    /usr/lib/perl5/site_perl/5.10.0
    /usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi
    /usr/lib/perl5/vendor_perl/5.10.0
    /usr/lib/perl5/5.10.0/i386-linux-thread-multi
    /usr/lib/perl5/5.10.0
    /usr/lib/perl5/site_perl
    /usr/lib/perl5/vendor_perl/5.8.8
    /usr/lib/perl5/vendor_perl
    .

Hope this helps
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;23&nbsp;09:26:00&nbsp;2009</span>
    <span class="description">DDUMONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve compared Tk.pm and all Tk/**.pm between Mandriva and Debian and
could not see any significant differences &#40;i.e. minor keybindings diff
and one more function in one Debian file&#41;

Furthermore, this patch does suppress the undef warnings, but it does
not suppress the problem:

 --- lib/Tk/Menu.pm~     2009-07-23 13:46:45.000000000 +0200
+++ lib/Tk/Menu.pm      2009-07-23 15:23:20.000000000 +0200
@@ -1038,7 +1038,7 @@
  my $last = $src-&gt;index&#40;&#39;last&#39;&#41;;
  if &#40;$last ne &#39;none&#39;&#41;
   {
-   for &#40;my $i = $src-&gt;cget&#40;&#39;-tearoff&#39;&#41;; $i &lt;= $last; $i++&#41;
+   for &#40;my $i = $src-&gt;cget&#40;&#39;-tearoff&#39;&#41; || 0; $i &lt;= $last; $i++&#41;
     {
      my $type = $src-&gt;type&#40;$i&#41;;
      if &#40;defined $type&#41;

So my previous conclusion &#40;stricter check in Perl&#41; is false.

But the -tearoff=&gt;0 workaround still has an effect, except when calling
cascade with deep structures passed to -menuitems

All the best
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;24&nbsp;08:09:08&nbsp;2009</span>
    <span class="description">DDUMONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> jquelin [...] mandriva.org, Bruno.Cornec [...] hp.com, Guillaume.Rousse [...] inria.fr,
 mohamed.amine.haddad [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Slaven

If you want to check the difference between Mandriva&#39;s Perl/Tk and CPAN
Perl/Tk, the easiest way is to:
- download Mandriva&#39;s SRPM package
 
ftp://fr2.rpmfind.net/linux/Mandriva/devel/cooker/SRPMS//main/release/perl-Tk-804.28.0-12mdv2010.0.src.rpm
- open it with file-roller
- review with kompare the different patches shown by file-roller

I&#39;ve reviewed the patches. Most look fine, they mostly safeguard against
null pointer and stuff like that.

Most but not all.

This patch looks fishy. Some config handling code is commented out.

Jerome, do you know why this code was commented out ?

--- pTk/mTk/generic/tkConfig.c.orig     2008-01-04 18:50:58.000000000 +0100
+++ pTk/mTk/generic/tkConfig.c  2008-01-05 00:15:15.000000000 +0100
@@ -1210,11 +1210,12 @@
      * First, check to see if the object already has the answer cached.
      */
 
-    if &#40;objPtr-&gt;typePtr == &#38;tkOptionObjType&#41; {
-        if &#40;objPtr-&gt;internalRep.twoPtrValue.ptr1 == &#40;VOID *&#41; tablePtr&#41; {
+/*    if &#40;objPtr-&gt;typePtr == &#38;tkOptionObjType&#41; {
+        if &#40;objPtr-&gt;internalRep.twoPtrValue.ptr1 == &#40;VOID *&#41; tablePtr
+         &#38;&#38; objPtr-&gt;internalRep.twoPtrValue.ptr2 != NULL&#41; {
             return &#40;Option *&#41; objPtr-&gt;internalRep.twoPtrValue.ptr2;
         }
-    }
+    }*/
 
     /*
      * The answer isn&#39;t cached.

All the best
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;24&nbsp;08:33:08&nbsp;2009</span>
    <span class="description">grousse [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Ven. Jul. 24 08:09:08 2009, DDUMONT a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello Slaven
&gt; 
&gt; If you want to check the difference between Mandriva&#39;s Perl/Tk and
&gt; CPAN
&gt; Perl/Tk, the easiest way is to:
&gt; - download Mandriva&#39;s SRPM package
&gt; 
&gt;
</div>ftp://fr2.rpmfind.net/linux/Mandriva/devel/cooker/SRPMS//main/release/perl-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tk-804.28.0-12mdv2010.0.src.rpm
&gt; - open it with file-roller
&gt; - review with kompare the different patches shown by file-roller
</div>Actually, the easiest way is to check the patches directly from the
subversion repository:
<span class="clickylink"><a target="new" rel="nofollow" href="http://svn.mandriva.com/cgi-bin/viewvc.cgi/packages/cooker/perl-Tk/current/SOURCES">http://svn.mandriva.com/cgi-bin/viewvc.cgi/packages/cooker/perl-Tk/current/SOURCES</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;24&nbsp;09:06:48&nbsp;2009</span>
    <span class="description">jquelin [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">the patch you are looking for is
<span class="clickylink"><a target="new" rel="nofollow" href="http://svn.mandriva.com/cgi-bin/viewvc.cgi/packages/cooker/perl-Tk/current/SOURCES/perl-Tk-seg.patch?revision=161601&#38;view=markup">http://svn.mandriva.com/cgi-bin/viewvc.cgi/packages/cooker/perl-Tk/current/SOURCES/perl-Tk-seg.patch?revision=161601&#38;view=markup</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;24&nbsp;10:02:41&nbsp;2009</span>
    <span class="description">DDUMONT [...] cpan.org -  Cc DDUMONT added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;24&nbsp;10:03:53&nbsp;2009</span>
    <span class="description">DDUMONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> jquelin [...] mandriva.org, Bruno.Cornec [...] hp.com, Guillaume.Rousse [...] inria.fr</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 24 09:06:48 2009, JQUELIN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the patch you are looking for is
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.mandriva.com/cgi-bin/viewvc.cgi/packages/cooker/perl-">http://svn.mandriva.com/cgi-bin/viewvc.cgi/packages/cooker/perl-</a></span>
&gt; Tk/current/SOURCES/perl-Tk-seg.patch?revision=161601&#38;view=markup
</div>
The log mentions that this patch comes from Fedora. 

And this bug was found and resolved on Fedora:

<span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=431330">https://bugzilla.redhat.com/show_bug.cgi?id=431330</a></span>

Jerome, can you test or apply this solution on Mandriva&#39;s perl-Tk ?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;24&nbsp;10:26:02&nbsp;2009</span>
    <span class="description">jquelin [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">patch updated on mandriva. perl-Tk-804.28.0-13mdv2010.0 on its way for
cooker.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;16&nbsp;15:36:09&nbsp;2009</span>
    <span class="description">SREZIC [...] cpan.org -  Fixed in 804.027 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
