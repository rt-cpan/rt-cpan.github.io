<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #6751 for GDGraph: Make bars displayed at specified x value</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #6751 for GDGraph: Make bars displayed at specified x value</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/GDGraph/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/GDGraph/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/GDGraph/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/GDGraph/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/GDGraph">GDGraph CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>There are plenty of good ideas of what people can do published here on the queue. Turning a patch from the tracker into a pull request is not one of them. In order to get maintainers' attention way more quickier, PR should have at least a sample included. We know it's hard to test images generating software, but it doesn't mean we can not test numbers produced by intermediate algorithms used to generate these images, so either a test or a sample.</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">6751</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/GDGraph/Active/">GDGraph</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">bwarfield [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cantzler [...] uiuc.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-14346-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.43    </td>
  </tr>
  <tr id="CF-14347-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;24&nbsp;21:49:24&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Make bars displayed at specified x value</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is basically what this fix does:

Old bar graph of values &#40;1, 3, 4, 7&#41;, &#40;1, 3, 3, 1&#41; would look like this

|
| ||
| ||
|||||
+----------

After the patch it should look like:

|
|   ||
|   ||
| | ||  |
+----------

I&#39;m basically wondering if a flag can be added somehow to switch between the old functionality and this new one.

Here&#39;s the code change in bars.pm:

         # get coordinates of top and center of bar
-        my &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$i + 1, $value, $ds&#41;;
+#        my &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$i + 1, $value, $ds&#41;;
+        my &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$self-&gt;{_data}-&gt;get_x&#40;$i&#41;, $value, $ds&#41;;
 
Thanks
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /tmp/old/bars.pm       Thu Jun 24 20:35:12 2004
+++ /tmp/new/bars.pm       Thu Jun 24 20:26:19 2004
@@ -251,7 +251,8 @@
             if $self-&gt;{cycle_clrs} &gt; 1;
 
         # get coordinates of top and center of bar
-        my &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$i + 1, $value, $ds&#41;;
+#        my &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$i + 1, $value, $ds&#41;;
+        my &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$self-&gt;{_data}-&gt;get_x&#40;$i&#41;, $value, $ds&#41;;
 
         # calculate left and right of bar
         my &#40;$l, $r&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;07&nbsp;14:54:09&nbsp;2004</span>
    <span class="description">Guest - Ticket #7287:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Adjusted bar width when using numerical axis</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Distribution: RedHat 7.3, package installed via CPAN
Perl version: 5.6.1

This patch includes a better fix from Bug 6751
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/NoAuth/Bug.html?id=6751">http://rt.cpan.org/NoAuth/Bug.html?id=6751</a></span>

If x_tick_number is set, this patch helps draw bars more numerically.

The Problem:
  Try drawing bars on a 600x300 &#40;w x h&#41; image 
  x_values &#40;176,184,192,200,208,216,232,240&#41;
  y_values &#40;  1,  2,  3,  1,  2,  2,  2,  1&#41;
  set &#40;x_min, x_max&#41; = &#40;0, 400&#41;;
  
  The bars will either be one pixel thick or not display at all.
  With an &#40;x_min, x_max&#41; of &#40;0, 1000&#41; bars are rarely displayed


The Fix:
  Before drawing the bars, 
  calculate the minimum difference between the bars.
  x_step is multiplied by this min_diff to correct the bar width.
  
  In the case above, the minimum difference is 8.
  So the bars will be adjusted 4 points left/right.

I&#39;ve tried to preserve this fix from causing any problems for non-numerical graphs, but I have not tested this change with any non-numerical graphs.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- GDGraph-1.43/Graph/bars.pm	Tue Jun 10 19:43:49 2003
+++ /usr/lib/perl5/site_perl/5.6.1/GD/Graph/bars.pm	Sat Aug  7 13:38:52 2004
@@ -232,6 +232,28 @@
 
     my $topvalues = $self-&gt;_top_values;
 
+    # FIX BAR WIDTH
+    my $adj_x_step = $self-&gt;{x_step};
+    
+    if &#40;defined $self-&gt;{x_tick_number}&#41; {
+        my @x_values = $self-&gt;{_data}-&gt;x_values&#40;$ds&#41; or
+            return $self-&gt;_set_error&#40;&#34;Impossible illegal data set: $ds&#34;,
+       	        $self-&gt;{_data}-&gt;error&#41;;
+
+        @x_values = sort { $b &lt;=&gt; $a } @x_values;
+
+        my $min_diff = undef;
+        for &#40;my $i = 1; $i &lt; @x_values; $i++&#41;
+        {
+            my $diff = &#40;$x_values[$i-1] - $x_values[$i]&#41;;
+            $min_diff = $diff if &#40;!&#40;defined $min_diff&#41; ||
+                                  &#40;&#40;$diff &lt; $min_diff&#41; &#38;&#38; &#40;$diff &gt; 0&#41;&#41;&#41;;
+        }
+        
+        $adj_x_step = $adj_x_step * $min_diff;
+    }
+    # END FIX BAR WIDTH
+
     for &#40;my $i = 0; $i &lt; @values; $i++&#41; 
     {
         my $value = $values[$i];
@@ -251,25 +273,31 @@
             if $self-&gt;{cycle_clrs} &gt; 1;
 
         # get coordinates of top and center of bar
-        my &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$i + 1, $value, $ds&#41;;
+        # use x_value if x_tick_number is defined
+        my &#40;$xp, $t&#41;;
+        if &#40;defined $self-&gt;{x_tick_number}&#41; {
+            &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$self-&gt;{_data}-&gt;get_x&#40;$i&#41;, $value, $ds&#41;;
+        } else {
+            &#40;$xp, $t&#41; = $self-&gt;val_to_pixel&#40;$i + 1, $value, $ds&#41;;
+        }
 
         # calculate left and right of bar
         my &#40;$l, $r&#41;;
 
         if &#40;ref $self eq &#39;GD::Graph::mixed&#39; || $self-&gt;{overwrite}&#41;
         {
-            $l = $xp - $self-&gt;{x_step}/2 + $bar_s + 1;
-            $r = $xp + $self-&gt;{x_step}/2 - $bar_s;
+            $l = $xp - $adj_x_step/2 + $bar_s + 1;
+            $r = $xp + $adj_x_step/2 - $bar_s;
         }
         else
         {
             $l = $xp 
-                - $self-&gt;{x_step}/2
-                + &#40;$ds - 1&#41; * $self-&gt;{x_step}/$self-&gt;{_data}-&gt;num_sets
+                - $adj_x_step/2
+                + &#40;$ds - 1&#41; * $adj_x_step/$self-&gt;{_data}-&gt;num_sets
                 + $bar_s + 1;
             $r = $xp 
-                - $self-&gt;{x_step}/2
-                + $ds * $self-&gt;{x_step}/$self-&gt;{_data}-&gt;num_sets
+                - $adj_x_step/2
+                + $ds * $adj_x_step/$self-&gt;{_data}-&gt;num_sets
                 - $bar_s;
         }
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;11&nbsp;19:07:23&nbsp;2006</span>
    <span class="description">bwarfield [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;11&nbsp;19:07:26&nbsp;2006</span>
    <span class="description">bwarfield [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;12&nbsp;00:46:36&nbsp;2006</span>
    <span class="description">bwarfield [...] cpan.org - Ticket #7287:  Merged into ticket #6751</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;12&nbsp;00:46:36&nbsp;2006</span>
    <span class="description">bwarfield [...] cpan.org -  Merged into ticket #6751</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;21&nbsp;16:51:37&nbsp;2013</span>
    <span class="description">RUZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> New GD::Graph co-maintainer and new release on CPAN</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

You recieved this message as you filed a bug report or feature request against GD::Graph module on CPAN.

My name is Ruslan and I&#39;m new co-maintainer of the module. I&#39;ve updated the module to 1.45 with doc changes and released it to CPAN. See distribution status [1].

I have TODO list for several releases, so if your ticket was a patch then turning it into a nice pull request may expedite inclusion :&#41;

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~ruz/GDGraph-1.45/Graph.pm#DISTRIBUTION_STATUS">http://search.cpan.org/~ruz/GDGraph-1.45/Graph.pm#DISTRIBUTION_STATUS</a></span>

-- 
Best regards, Ruslan.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
