<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78377 for Catalyst-Runtime: IIS7 + keepalives causes breakage with 3xx and non-empty response bodies</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78377 for Catalyst-Runtime: IIS7 + keepalives causes breakage with 3xx and non-empty response bodies</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-Runtime/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Runtime">Catalyst-Runtime CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78377</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-Runtime/Active/">Catalyst-Runtime</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">bobtfish [...] bobtfish.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KnowZeroX [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-40040-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
5.90015    </td>
  </tr>
  <tr id="CF-40041-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;14&nbsp;18:46:59&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Content-length error fix</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, so I think I finished investigating the issue with the content 
length. And here are the results of my investigation plus a patch.

Effectively this issue happens when the web server itself issued a 
Document Has Moved and Catalyst issues a Document Has Moved on a 
redirect while Keep-Alive is active.&#40;From my understanding keep-alive 
was deprecated as of HTTP 1.1 but some browsers still use HTTP 1.0 to 
pre-load content on page and achieve more connections&#41;.

So effectively what happens is catalyst calculates the content-length of 
its content not taking into account that the web server such as IIS 
appends its own content prior. This makes the content-length incorrect 
and cut off the buffer at the wrong point on the redirect page. Once 
redirected due to keep-alive the previous buffer that has been cut off 
still remains and again gives you the wrong content-length on the 
landing page.

Anyways, the solution I propose is to add a config option of 
&#34;disable_redirect_html&#34; that will disable catalyst from writing its own 
HTML when the body is missing on redirects and lets the server handle 
the document has moved.

Line 1856 -
        if &#40; !$response-&gt;has_body &#41; {

to

Line 1856 +

        if &#40; !$response-&gt;has_body and !$c-&gt;config-&gt;
{disable_redirect_html} &#41; {

What do you think?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:20&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7000 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7001 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7002 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7003 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7004 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7005 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7006 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7007 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7008 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7009 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7010 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7011 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7012 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7013 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7014 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7015 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7099_01 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7099_02 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7099_03 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.7099_04 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.70_01 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.70_02 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.70_03 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:21&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.71000 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.71001 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80001 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80002 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80003 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80004 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80005 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80006 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80007 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80008 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80009 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.8000_01 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.8000_02 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.8000_03 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.8000_04 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.8000_05 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.8000_06 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.8000_07 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80010 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80011 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80012 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80013 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80014 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80014_01 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80014_02 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80015 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80016 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80017 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80018 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80019 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80020 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80021 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80022 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80023 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80024 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80025 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80026 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80027 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80028 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80029 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80030 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80031 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80032 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.80033 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.89000-TRIAL deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.89001-TRIAL deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.89002-TRIAL deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.89003-TRIAL deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.9000 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90001 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90002 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90003 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90004 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90005 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90006 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90007 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90008-TRIAL deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90009 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90010 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90011 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:24&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90012 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:25&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90013 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:25&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90013-TRIAL deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;05:59:25&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90014 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;06:03:47&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jul 14 18:46:59 2012, KnowZeroX@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ok, so I think I finished investigating the issue with the content 
&gt; length. And here are the results of my investigation plus a patch.
&gt; 
&gt; Effectively this issue happens when the web server itself issued a 
&gt; Document Has Moved and Catalyst issues a Document Has Moved on a 
&gt; redirect while Keep-Alive is active.&#40;From my understanding keep-alive 
&gt; was deprecated as of HTTP 1.1 but some browsers still use HTTP 1.0 to 
&gt; pre-load content on page and achieve more connections&#41;.
</div>
Keepalive is not deprecated? What implies this?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So effectively what happens is catalyst calculates the content-length of 
&gt; its content not taking into account that the web server such as IIS 
&gt; appends its own content prior. This makes the content-length incorrect 
&gt; and cut off the buffer at the wrong point on the redirect page. Once 
&gt; redirected due to keep-alive the previous buffer that has been cut off 
&gt; still remains and again gives you the wrong content-length on the 
&gt; landing page.
</div>
So, what you&#39;re basically suggesting here is that IIS is broken?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyways, the solution I propose is to add a config option of 
&gt; &#34;disable_redirect_html&#34; that will disable catalyst from writing its own 
&gt; HTML when the body is missing on redirects and lets the server handle 
&gt; the document has moved.
&gt; 
&gt; Line 1856 -
&gt;         if &#40; !$response-&gt;has_body &#41; {
&gt; 
&gt; to
&gt; 
&gt; Line 1856 +
&gt; 
&gt;         if &#40; !$response-&gt;has_body and !$c-&gt;config-&gt;
&gt; {disable_redirect_html} &#41; {
&gt; 
&gt; What do you think?
</div>
This, however, does sound like an entirely reasonable way to fix the
issue, if this is needed.

I&#39;m wondering, however, if this should instead be implmented as PSGI
middleware - we already have server detection code, which applies
middleware based upon the server you&#39;re running, and therefore this
would allow you to now even have to configure this setting...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;06:03:50&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;07:11:16&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This, however, does sound like an entirely reasonable way to fix the
&gt; issue, if this is needed.
&gt; 
&gt; I&#39;m wondering, however, if this should instead be implmented as PSGI
&gt; middleware - we already have server detection code, which applies
&gt; middleware based upon the server you&#39;re running, and therefore this
&gt; would allow you to now even have to configure this setting...
</div>

You mean make this setting default on IIS? Sure that would make sense. 
The user would still be able to overwrite it if need be via config 
right?

Also you mentioned this issue effects other servers as well correct?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;07:36:16&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Keepalive is not deprecated? What implies this?
</div>
From my understanding HTTP 1.1 sets up a persistent connection by 
default unless you send a Connection: close to specifically tell it not 
to. 

It is documented in rfc 2616 and rfc2068

That said from my understanding some modern browsers utilize HTTP 1.0 to 
achieve better preloading of content.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, what you&#39;re basically suggesting here is that IIS is broken?
</div>
What happens is IIS injects its own HTML on redirect once it sees the 
Location header. With keep-alive off it is not a problem but once keep-
alive is enabled it cuts off buffer due to incorrect content-length. 
This causes IE9 to hang when dealing with large urls and causes firefox 
to show chunks of fragmented buffer.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;07:48:01&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 15 07:36:16 2012, KnowZeroX@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Keepalive is not deprecated? What implies this?
</div>&gt; 
&gt; From my understanding HTTP 1.1 sets up a persistent connection by 
&gt; default unless you send a Connection: close to specifically tell it not 
&gt; to. 
&gt; 
&gt; It is documented in rfc 2616 and rfc2068
</div>
Right, so keep alive is the default - which is entirely different to it
being deprecated...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That said from my understanding some modern browsers utilize HTTP 1.0 to 
&gt; achieve better preloading of content.
</div>
eh, this doesn&#39;t make any sense?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; So, what you&#39;re basically suggesting here is that IIS is broken?
</div>&gt; 
&gt; What happens is IIS injects its own HTML on redirect once it sees the 
&gt; Location header. With keep-alive off it is not a problem but once keep-
&gt; alive is enabled it cuts off buffer due to incorrect content-length. 
</div>
Right, and this is as IIS is broken!

Ignoring a large chunk of the response from the app is just totally
broken behavior.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;07:49:52&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 15 07:11:16 2012, KnowZeroX@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You mean make this setting default on IIS? Sure that would make sense. 
</div>
No, I mean not have a setting at all.

And have the code in a middleware.

And have that middleware auto-applied in the default set of middlewares
if needed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The user would still be able to overwrite it if need be via config 
&gt; right?
</div>
They could override it by not applying the default middlewares.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also you mentioned this issue effects other servers as well correct?
</div>
I have seen an issue I thought was possibly this with other servers, but
the fact it&#39;s only on redirect implies &#40;to me at least&#41; that you&#39;re
seeing an IIS specific issue here.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;08:04:28&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 15 07:49:52 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Jul 15 07:11:16 2012, KnowZeroX@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt; You mean make this setting default on IIS? Sure that would make 
</div></div>sense. 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; No, I mean not have a setting at all.
&gt; 
&gt; And have the code in a middleware.
&gt; 
&gt; And have that middleware auto-applied in the default set of 
</div>middlewares
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; if needed.
&gt; 
<div class="message-stanza open">&gt; &gt; The user would still be able to overwrite it if need be via config 
&gt; &gt; right?
</div>&gt; 
&gt; They could override it by not applying the default middlewares.
&gt; 
<div class="message-stanza open">&gt; &gt; Also you mentioned this issue effects other servers as well correct?
</div>&gt; 
&gt; I have seen an issue I thought was possibly this with other servers, 
</div>but
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the fact it&#39;s only on redirect implies &#40;to me at least&#41; that you&#39;re
&gt; seeing an IIS specific issue here.
&gt; 
</div>
Ok, I took a look at IIS and apparently its being a little deceiving :/. 
By disabling Keep-Alive setting in IIS it effectively just sends a 
&#34;Connection: close&#34; back which effectively disables persistent 
connection from the client.

In light of this, setting it up as a default middleware makes most 
sense.

Well it effects both the redirect and the page following the redirect. 
So theoretically speaking it is possible for it to effect pages after 
the redirect of say an image, css or JavaScript under certain 
conditions.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;08:15:23&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Right, so keep alive is the default - which is entirely different to 
</div>it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; being deprecated...
</div>
I meant to say the keep-alive setting aka Connection: Keep-Alive but 
yeah don&#39;t mind me I have been looking all night for the issue so lack 
of sleep is having me hickup here and there.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; eh, this doesn&#39;t make any sense?
</div>
I thought so too. But that is what I saw reading around. Though looking 
at it more closely it seems it was like that on winxp or something like 
that due to limitations of 2 http 1.1 connections on IE which was fixed 
in later browsers it seems. So you are right.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ignoring a large chunk of the response from the app is just totally
&gt; broken behavior.
</div>
I guess yeah, IIS persistent connections are broken.

Anyways I am going to go to sleep because I am not thinking straight. 
Will you be able to patch the middleware? or should I write it and 
attach it?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;08:19:38&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78377] Content-length error fix </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 Jul 2012 13:19:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Runtime [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 15 Jul 2012, at 13:15, via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyways I am going to go to sleep because I am not thinking straight. 
&gt; Will you be able to patch the middleware? or should I write it and 
&gt; attach it?
</div>
I think we really want a separate / new middleware for this.

And the chances of me getting time to get to it are low + I have no ability to test it I&#39;m afraid!

Cheers
t0m
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;08:23:38&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 15 08:19:38 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On 15 Jul 2012, at 13:15, via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Anyways I am going to go to sleep because I am not thinking
</div>&gt; straight.
<div class="message-stanza open">&gt; &gt; Will you be able to patch the middleware? or should I write it and
&gt; &gt; attach it?
</div>&gt; 
&gt; I think we really want a separate / new middleware for this.
&gt; 
&gt; And the chances of me getting time to get to it are low + I have no
&gt; ability to test it I&#39;m afraid!
&gt; 
&gt; Cheers
&gt; t0m
&gt; 
</div>
Alright then, I&#39;ll try to write one &lt;strike&gt;tomorrow&lt;/strike&gt; today. 
After I wake up, at this point I don&#39;t trust myself to touch anything 
until I get some sleep lol
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;13:24:02&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok I am done. I decided to make two versions.

IISKeepAliveFix.pm - The IIS keep alive fix which effectively on 30[123] 
response it removes Content-Length, Content-Type headers and sets the body 
content to undefined.

and

IISFix.pm - Includes both the fixed up version of IIS6ScriptNameFix and my 
IISKeepAliveFix in 1.

Personally I think IISFix is the way to go but chose whichever you think 
is best.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IISKeepAliveFix.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Plack::Middleware::IISKeepAliveFix;

use strict;
use parent &#39;Plack::Middleware&#39;;
use Plack::Util;



sub call {
    my&#40;$self, $env&#41; = @_;
      
    if &#40;$env-&gt;{SERVER_SOFTWARE} &#38;&#38; $env-&gt;{SERVER_SOFTWARE} =~ /IIS\/[6-9]\.[0-9]/&#41; {
        # Fixes wrong SCRIPT_NAME and PATH_INFO that IIS sets
        my &#40;$path&#41; = &#40; $env-&gt;{REQUEST_URI} =~ /^&#40;[^?]*&#41;&#40;?:\?.*&#41;?$/s &#41;;
        $path =~ s/#.*$// if defined &#38;&#38; length; # dumb clients sending URI fragments

        my @script_name = split&#40;m!/!, URI::Escape::uri_unescape&#40;$path&#41;&#41;;
        my @path_translated = split&#40;m!/|\\\\?!, $env-&gt;{PATH_TRANSLATED}&#41;;
        my @path_info;

        while &#40;$script_name[$#script_name] eq $path_translated[$#path_translated]&#41; {
            pop&#40;@path_translated&#41;;
            unshift&#40;@path_info, pop&#40;@script_name&#41;&#41;;
        }

        unshift&#40;@path_info, &#39;&#39;, &#39;&#39;&#41;;

        $env-&gt;{PATH_INFO} = join&#40;&#39;/&#39;, @path_info&#41;;
        $env-&gt;{SCRIPT_NAME} = join&#40;&#39;/&#39;, @script_name&#41;;
        
        # Fixes buffer being cut off on redirect when keep-alive is active  
        my $res  = $self-&gt;app-&gt;&#40;$env&#41;;
      
        Plack::Util::response_cb&#40;$res, sub {
            my $res = shift;
            if &#40;$res-&gt;[0] =~ m!^30[123]$! &#41; {
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Length&#39;&#41;;
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Type&#39;&#41;;
                $res-&gt;[2]=undef;
            }

            return;
        }&#41;;
  
    }
}

1;
__END__

=head1 NAME

Plack::Middleware::IISKeepAliveFix - fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 SYNOPSIS

  # in your app.psgi
  use Plack::Builder;

  builder {
    enable &#34;IISKeepAliveFix&#34;;
    $app;
  };

  # Or from the command line
  plackup -s FCGI -e &#39;enable &#34;IISKeepAliveFix&#34;&#39; /path/to/app.psgi

=head1 DESCRIPTION

This middleware fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 AUTHORS

Florian Ragwitz

=cut
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IISFix.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Plack::Middleware::IISFix;

use strict;
use parent &#39;Plack::Middleware&#39;;
use Plack::Util;



sub call {
    my&#40;$self, $env&#41; = @_;
      
    if &#40;$env-&gt;{SERVER_SOFTWARE} &#38;&#38; $env-&gt;{SERVER_SOFTWARE} =~ /IIS\/[6-9]\.[0-9]/&#41; {
        # Fixes wrong SCRIPT_NAME and PATH_INFO that IIS sets
        my &#40;$path&#41; = &#40; $env-&gt;{REQUEST_URI} =~ /^&#40;[^?]*&#41;&#40;?:\?.*&#41;?$/s &#41;;
        $path =~ s/#.*$// if defined &#38;&#38; length; # dumb clients sending URI fragments

        my @script_name = split&#40;m!/!, URI::Escape::uri_unescape&#40;$path&#41;&#41;;
        my @path_translated = split&#40;m!/|\\\\?!, $env-&gt;{PATH_TRANSLATED}&#41;;
        my @path_info;

        while &#40;$script_name[$#script_name] eq $path_translated[$#path_translated]&#41; {
            pop&#40;@path_translated&#41;;
            unshift&#40;@path_info, pop&#40;@script_name&#41;&#41;;
        }

        unshift&#40;@path_info, &#39;&#39;, &#39;&#39;&#41;;

        $env-&gt;{PATH_INFO} = join&#40;&#39;/&#39;, @path_info&#41;;
        $env-&gt;{SCRIPT_NAME} = join&#40;&#39;/&#39;, @script_name&#41;;
        
        # Fixes buffer being cut off on redirect when keep-alive is active  
        my $res  = $self-&gt;app-&gt;&#40;$env&#41;;
      
        Plack::Util::response_cb&#40;$res, sub {
            my $res = shift;
            if &#40;$res-&gt;[0] =~ m!^30[123]$! &#41; {
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Length&#39;&#41;;
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Type&#39;&#41;;
                $res-&gt;[2]=undef;
            }

            return;
        }&#41;;
  
    }
}

1;
__END__

=head1 NAME

Plack::Middleware::IISFix - fixes wrong SCRIPT_NAME and PATH_INFO that IIS sets and fixes buffer being cut off on redirect when keep-alive is active.

=head1 SYNOPSIS

  # in your app.psgi
  use Plack::Builder;

  builder {
    enable &#34;IISFix&#34;;
    $app;
  };

  # Or from the command line
  plackup -s FCGI -e &#39;enable &#34;IISFix&#34;&#39; /path/to/app.psgi

=head1 DESCRIPTION

This middleware fixes wrong C&lt;SCRIPT_NAME&gt; and C&lt;PATH_INFO&gt; set by IIS and fixes buffer being cut off on redirect when keep-alive is active.

=head1 AUTHORS

Florian Ragwitz

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;13:42:23&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 15 13:24:02 2012, KnowZeroX@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Personally I think IISFix is the way to go but chose whichever you think 
&gt; is best.
</div>
Fraid I disagree.

We need to fix IISScriptNameFix in Plack core, as it&#39;s generic.

However the other issue is due the the framework&#39;s default behavior, and
therefore needs fixing in Catalyst.

Anyway, thanks for the code!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;13:46:14&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 15 13:24:02 2012, KnowZeroX@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ok I am done. I decided to make two versions.
&gt; 
&gt; IISKeepAliveFix.pm - The IIS keep alive fix which effectively on 30[123] 
&gt; response it removes Content-Length, Content-Type headers and sets the
</div>body 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; content to undefined.
</div>

looking inside IISKeepAliveFix, I see:

# Fixes wrong SCRIPT_NAME and PATH_INFO that IIS sets
        my &#40;$path&#41; = &#40; $env-&gt;{REQUEST_URI} =~ /^&#40;[^?]*&#41;&#40;?:\?.*&#41;?$/s &#41;;
        $path =~ s/#.*$// if defined &#38;&#38; length; # dumb clients sending
URI fragments

        my @script_name = split&#40;m!/!, URI::Escape::uri_unescape&#40;$path&#41;&#41;;
        my @path_translated = split&#40;m!/|\\\\?!, $env-&gt;{PATH_TRANSLATED}&#41;;
        my @path_info;

which appears to be unexpectedly doing things to the request URI?



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and
&gt; 
&gt; IISFix.pm - Includes both the fixed up version of IIS6ScriptNameFix
</div>and my 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; IISKeepAliveFix in 1.
</div>
and yes - this includes both.

Can I get a middleware which does just the fix for this bug please?

&#40;And test cases would be really good, at least to let people who come
later know what we&#39;re doing, and why....&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;14:20:59&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attaching the iiskeepalivefix.pm, sorry about that I by accident saved 
over iiskeepalivefix.pm the content of iisfix.pm. This is the right 
version. 

I will work on getting the test cases done now.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IISKeepAliveFix.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Plack::Middleware::IISKeepAliveFix;

use strict;
use parent &#39;Plack::Middleware&#39;;
use Plack::Util;



sub call {
    my&#40;$self, $env&#41; = @_;
      
    if &#40;$env-&gt;{SERVER_SOFTWARE} &#38;&#38; $env-&gt;{SERVER_SOFTWARE} =~ /IIS\/[6-9]\.[0-9]/&#41; {
       # Fixes buffer being cut off on redirect when keep-alive is active  
        my $res  = $self-&gt;app-&gt;&#40;$env&#41;;
      
        Plack::Util::response_cb&#40;$res, sub {
            my $res = shift;
            if &#40;$res-&gt;[0] =~ m!^30[123]$! &#41; {
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Length&#39;&#41;;
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Type&#39;&#41;;
                $res-&gt;[2]=undef;
            }

            return;
        }&#41;;
  
    }
}

1;
__END__

=head1 NAME

Plack::Middleware::IISKeepAliveFix - fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 SYNOPSIS

  # in your app.psgi
  use Plack::Builder;

  builder {
    enable &#34;IISKeepAliveFix&#34;;
    $app;
  };

  # Or from the command line
  plackup -s FCGI -e &#39;enable &#34;IISKeepAliveFix&#34;&#39; /path/to/app.psgi

=head1 DESCRIPTION

This middleware fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 AUTHORS

Florian Ragwitz

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;15&nbsp;17:56:36&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok I finished with the test case, to make the test case work I had to make 
a few adjustments so I am including the final versions of everything 
attached here.


iis_keep_alive_fix.t - test case
IISKeepAliveFix.pm - middleware
declare.txt - declaration
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> declare.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use Plack::Middleware::IISKeepAliveFix;

       $psgi_app = Plack::Middleware::Conditional-&gt;wrap&#40;
        $psgi_app,
        builder   =&gt; sub { Plack::Middleware::IISKeepAliveFix-&gt;wrap&#40;$_[0]&#41; },
        condition =&gt; sub {
            my &#40;$env&#41; = @_;
            return unless $env-&gt;{SERVER_SOFTWARE} &#38;&#38; $env-&gt;{SERVER_SOFTWARE} =~ m!IIS\/[6-9]\.[0-9]!;
            
            1;
        },
    &#41;;</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IISKeepAliveFix.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Plack::Middleware::IISKeepAliveFix;

use strict;
use parent &#39;Plack::Middleware&#39;;
use Plack::Util;



sub call {
    my&#40;$self, $env&#41; = @_;
        # Fixes buffer being cut off on redirect when keep-alive is active  
        my $res  = $self-&gt;app-&gt;&#40;$env&#41;;
      
        Plack::Util::response_cb&#40;$res, sub {
            my $res = shift;
            if &#40;$res-&gt;[0] =~ m!^30[123]$! &#41; {
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Length&#39;&#41;;
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Type&#39;&#41;;
                $res-&gt;[2]=[&#39;&#39;];
            }

            return;
        }&#41;;

}

1;
__END__

=head1 NAME

Plack::Middleware::IISKeepAliveFix - fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 SYNOPSIS

  # in your app.psgi
  use Plack::Builder;

  builder {
    enable &#34;IISKeepAliveFix&#34;;
    $app;
  };

  # Or from the command line
  plackup -s FCGI -e &#39;enable &#34;IISKeepAliveFix&#34;&#39; /path/to/app.psgi

=head1 DESCRIPTION

This middleware fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 AUTHORS

Florian Ragwitz

=cut
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> iis_keep_alive_fix.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use Test::More;
use Plack::Test;
use HTTP::Request::Common;

use Plack::Middleware::IISKeepAliveFix;

  
my $app=Plack::Middleware::IISKeepAliveFix-&gt;wrap&#40;
sub {
    my $env = shift;
    
    
    my $location=&#39;/go/?&#39;.join&#40;&#39;|&#39;, &#40;0..1000&#41;&#41;;
      return [ 302, [
        &#39;Content-Type&#39; =&gt; &#39;text/html&#39;,
        &#39;Content-Length&#39; =&gt; 285,
        &#39;Location&#39; =&gt; $location,
      ],[qq~&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</a></span>&#34;&gt;
&lt;html xmlns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a></span>&#34;&gt; 
  &lt;head&gt;
    &lt;title&gt;Moved&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
     &lt;p&gt;This item has moved &lt;a href=&#34;$location&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;~] ];
}&#41;;


test_psgi $app =&gt; sub {
    my $cb = shift;
 
    my $res = $cb-&gt;&#40;GET &#34;/&#34;&#41;;

    ok&#40;!$res-&gt;content&#41;;
    ok&#40;!$res-&gt;content_length&#41;;
    ok&#40;!$res-&gt;content_type&#41;;
};

done_testing;</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;05:47:35&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Awesome! However, I&#39;m sorry if I&#39;m being dumb - but I can&#39;t see which
versions you&#39;ve tested / found the problem with in this ticket.

Can you enlighten me?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;05:54:43&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 16 05:47:35 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Awesome! However, I&#39;m sorry if I&#39;m being dumb - but I can&#39;t see which
&gt; versions you&#39;ve tested / found the problem with in this ticket.
&gt; 
&gt; Can you enlighten me?
</div>
On the first one by accident was the same as IISFix &#40;copy and paste 
error lol&#41;. The second one was good but I couldn&#39;t get it to pass the 
test case because HTTP::Response didn&#39;t like undef body. Also I removed 
the smart code and just moved it to the deceleration.

The final version is this:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Attachment/1099581/578128/IISKeepAliveFix.pm">https://rt.cpan.org/Ticket/Attachment/1099581/578128/IISKeepAliveFix.pm</a></span>

this is the test case:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Attachment/1099581/578129/iis_keep_alive_fix">https://rt.cpan.org/Ticket/Attachment/1099581/578129/iis_keep_alive_fix</a></span>.
t

an this is the suggested method of declaration:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Attachment/1099581/578127/declare.txt">https://rt.cpan.org/Ticket/Attachment/1099581/578127/declare.txt</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;05:56:00&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78377] Content-length error fix </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jul 2012 10:55:45 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Runtime [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 16 Jul 2012, at 10:54, via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Catalyst-Runtime
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78377">https://rt.cpan.org/Ticket/Display.html?id=78377</a></span> &gt;
&gt; 
&gt; On Mon Jul 16 05:47:35 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt;&gt; Awesome! However, I&#39;m sorry if I&#39;m being dumb - but I can&#39;t see which
&gt;&gt; versions you&#39;ve tested / found the problem with in this ticket.
&gt;&gt; 
&gt;&gt; Can you enlighten me?
</div>&gt; 
</div>
&lt;sigh&gt; Sorry - I&#39;m not being clear!

I get it with which versions of the middleware are good.

I meant which version&#40;s&#41; of IIS is this applicable to.. Sorry!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;06:59:08&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 16 05:56:00 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On 16 Jul 2012, at 10:54, via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt;       Queue: Catalyst-Runtime
&gt; &gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78377">https://rt.cpan.org/Ticket/Display.html?id=78377</a></span> &gt;
&gt; &gt; 
&gt; &gt; On Mon Jul 16 05:47:35 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt;&gt; Awesome! However, I&#39;m sorry if I&#39;m being dumb - but I can&#39;t see 
</div></div></div>which
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; versions you&#39;ve tested / found the problem with in this ticket.
&gt; &gt;&gt; 
&gt; &gt;&gt; Can you enlighten me?
</div>&gt; &gt; 
</div>&gt; 
&gt; &lt;sigh&gt; Sorry - I&#39;m not being clear!
&gt; 
&gt; I get it with which versions of the middleware are good.
&gt; 
&gt; I meant which version&#40;s&#41; of IIS is this applicable to.. Sorry!
</div>
At this point I have been able to replicate the issue in IIS7/7.5 let me 
check IIS6 now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;07:13:33&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok I have did a test on IIS6 and IIS6 seems to be unaffected. So at this 
point I will say change it to:

m!IIS\/7\.[0-9]!

Some time later when I have the chance to install Windows 8 Server on my 
test pc I will get back to you on whether IIS8 is still effected or not.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;07:39:12&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok I did one more test an ran into an issue, apparently me changing:

$res-&gt;[2]=undef;

to

$res-&gt;[2]=[&#39;&#39;];

in Line 19 of my middleware is causing unintended issues. But then with it 
being undef there is no way to get the test case working due to 
limitations of HTTP::Response :/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;08:12:17&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am going to have to review the psgi spec again to see what I can do 
around this, I&#39;ll get you a fixed version of both, it and that test case 
by end of today.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;08:29:34&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I found a solution faster then I though, attaching all the stuff.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> declare.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use Plack::Middleware::IISKeepAliveFix;

       $psgi_app = Plack::Middleware::Conditional-&gt;wrap&#40;
        $psgi_app,
        builder   =&gt; sub { Plack::Middleware::IISKeepAliveFix-&gt;wrap&#40;$_[0]&#41; },
        condition =&gt; sub {
            my &#40;$env&#41; = @_;
            return unless $env-&gt;{SERVER_SOFTWARE} &#38;&#38; $env-&gt;{SERVER_SOFTWARE} =~ m!IIS\/7\.[0-9]!;
            
            1;
        },
    &#41;;</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IISKeepAliveFix.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Plack::Middleware::IISKeepAliveFix;

use strict;
use parent &#39;Plack::Middleware&#39;;
use Plack::Util;



sub call {
    my&#40;$self, $env&#41; = @_;
        # Fixes buffer being cut off on redirect when keep-alive is active  
        my $res  = $self-&gt;app-&gt;&#40;$env&#41;;
      
        Plack::Util::response_cb&#40;$res, sub {
            my $res = shift;
            if &#40;$res-&gt;[0] =~ m!^30[123]$! &#41; {
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Length&#39;&#41;;
                Plack::Util::header_remove&#40;$res-&gt;[1], &#39;Content-Type&#39;&#41;;
               return sub{ my $chunk; return unless defined $chunk; return &#39;&#39;; };
            }

            return;
        }&#41;;

}

1;
__END__

=head1 NAME

Plack::Middleware::IISKeepAliveFix - fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 SYNOPSIS

  # in your app.psgi
  use Plack::Builder;

  builder {
    enable &#34;IISKeepAliveFix&#34;;
    $app;
  };

  # Or from the command line
  plackup -s FCGI -e &#39;enable &#34;IISKeepAliveFix&#34;&#39; /path/to/app.psgi

=head1 DESCRIPTION

This middleware fixes buffer being cut off on redirect when keep-alive is active on IIS.

=head1 AUTHORS

Florian Ragwitz

=cut
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> iis_keep_alive_fix.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use Test::More;
use Plack::Test;
use HTTP::Request::Common;
use Plack::Middleware::IISKeepAliveFix;

  
my $app=Plack::Middleware::IISKeepAliveFix-&gt;wrap&#40;
sub {
    my $env = shift;
    
    
    my $location=&#39;/go/?&#39;.join&#40;&#39;|&#39;, &#40;0..1000&#41;&#41;;
      return [ 302, [
        &#39;Content-Type&#39; =&gt; &#39;text/html&#39;,
        &#39;Content-Length&#39; =&gt; 285,
        &#39;Location&#39; =&gt; $location,
      ],[qq~&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</a></span>&#34;&gt;
&lt;html xmlns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a></span>&#34;&gt; 
  &lt;head&gt;
    &lt;title&gt;Moved&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
     &lt;p&gt;This item has moved &lt;a href=&#34;$location&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;~] ];
}&#41;;


test_psgi&#40;app=&gt;$app,client=&gt; sub {
    my $cb = shift;
 
    my $res = $cb-&gt;&#40;GET &#34;/&#34;&#41;;

    ok&#40;!$res-&gt;content&#41;;
    ok&#40;!$res-&gt;content_length&#41;;
    ok&#40;!$res-&gt;content_type&#41;;
    
 
}&#41;;

done_testing;</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:00:32&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:06:22&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/miyagawa/Plack/pull/311">https://github.com/miyagawa/Plack/pull/311</a></span>

<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=catagits/Catalyst-Runtime.git;a=commitdiff;h=201e0a1fbca74dbe62eb5233df7861bcc7a384e9">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=catagits/Catalyst-Runtime.git;a=commitdiff;h=201e0a1fbca74dbe62eb5233df7861bcc7a384e9</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:06:25&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:07:07&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Subject changed from &#39;Content-length error fix&#39; to &#39;IIS7 + keepalives causes breakage with 3xx and non-empty response bodies&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
