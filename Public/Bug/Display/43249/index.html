<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43249 for HTTP-Proxy: cannot install HTTP::Proxy with cpan</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43249 for HTTP-Proxy: cannot install HTTP::Proxy with cpan</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTTP-Proxy/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTTP-Proxy/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTTP-Proxy/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTTP-Proxy/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTTP-Proxy">HTTP-Proxy CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43249</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTTP-Proxy/Active/">HTTP-Proxy</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
legrostdg [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-16366-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16367-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.24    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;13&nbsp;01:13:29&nbsp;2009</span>
    <span class="description">legrostdg [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> cannot install HTTP::Proxy with cpan</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I am running on ArchLinux testing.
Perl version: v5.10.0 built for x86_64-linux-thread-mult

I tried to install HTTP::Proxy with cpan but a lot of tests failed...

Felix

Here is the log:

cpan[6]&gt; install HTTP::Proxy                                           
                                                                     
Running install for module &#39;HTTP::Proxy&#39;
Running Build for B/BO/BOOK/HTTP-Proxy-0.23.tar.gz
  Has already been unwrapped into directory
/root/.cpan/build/HTTP-Proxy-0.23-TSdKVp
  Has already been made
Running Build test
t/00basic...........ok     
t/01pod.............skipped: Test::Pod 1.14 required for testing POD
t/02pod-coverage....skipped: Test::Pod::Coverage 1.04 required for
testing POD coverage
t/05new.............ok     
t/10init............ok   
t/11log.............ok     
t/15accessors.......1/30 maxconn is deprecated, please use
max_connections at t/15accessors.t line 42
maxserve is deprecated, please use max_keep_alive_requests at
t/15accessors.t line 42
t/15accessors.......ok     
t/15deprecated......ok     
t/16stash...........ok   
t/17fstack..........ok     
t/18engine..........ok     
t/20dummy...........ok     
t/20keepalive.......ok     
t/22http............ok   
t/22transparent.....ok   
t/23connect.........ok   
t/23https...........skipped: Can&#39;t make this work with Crypt::SSLeay
t/40push_filters....ok     
t/41filters.........ok   
t/42will_modify.....ok   
t/50hopbyhop........1/28 
#   Failed test &#39;Hop-by-hop Foo&#39;
#   at t/50hopbyhop.t line 38.
#          got: undef
#     expected: &#39;foofoo&#39;

#   Failed test &#39;Hop-by-hop Bar&#39;
#   at t/50hopbyhop.t line 39.
#          got: undef
#     expected: &#39;barbar&#39;

#   Failed test &#39;Connection header removed&#39;
#   at t/50hopbyhop.t line 45.
#          got: &#39;foofoo&#39;
#     expected: undef

#   Failed test &#39;Connection header removed&#39;
#   at t/50hopbyhop.t line 46.
#          got: &#39;barbar&#39;
#     expected: undef

#   Failed test &#39;Hop-by-hop Foo&#39;
#   at t/50hopbyhop.t line 64.
#          got: undef
#     expected: &#39;foofoo&#39;

#   Failed test &#39;Hop-by-hop Bar&#39;
#   at t/50hopbyhop.t line 65.
#          got: undef
#     expected: &#39;barbar&#39;

#   Failed test &#39;Connection header removed&#39;
#   at t/50hopbyhop.t line 71.
#          got: &#39;foofoo&#39;
#     expected: undef

#   Failed test &#39;Connection header removed&#39;
#   at t/50hopbyhop.t line 72.
#          got: &#39;barbar&#39;
#     expected: undef

#   Failed test &#39;Hop-by-hop Foo&#39;
#   at t/50hopbyhop.t line 91.
#          got: undef
#     expected: &#39;foofoo&#39;

#   Failed test &#39;Hop-by-hop Bar&#39;
#   at t/50hopbyhop.t line 92.
#          got: undef
#     expected: &#39;barbar&#39;

#   Failed test &#39;Hop-by-hop Baz&#39;
#   at t/50hopbyhop.t line 93.
#          got: undef
#     expected: &#39;bazbaz&#39;

#   Failed test &#39;Connection header removed&#39;
#   at t/50hopbyhop.t line 99.
#          got: &#39;foofoo&#39;
#     expected: undef

#   Failed test &#39;Connection header removed&#39;
#   at t/50hopbyhop.t line 100.
#          got: &#39;barbar&#39;
#     expected: undef
# Looks like you failed 13 tests of 28.
t/50hopbyhop........ Dubious, test returned 13 &#40;wstat 3328, 0xd00&#41;
 Failed 13/28 subtests 
t/50standard........ok     
t/50via.............ok   
t/51simple..........ok   
t/51simple2.........ok   
t/61simple..........ok     
t/61simple2.........ok   
t/64htmltext........ok     
t/64lines...........ok     
t/64tags............ok     
t/66htmlparser......ok   
t/67complete........ok   
t/67save............ok     
t/71rot13...........ok   
t/90diveintomark....ok     

Test Summary Report
-------------------
t/50hopbyhop    &#40;Wstat: 3328 Tests: 28 Failed: 13&#41;
  Failed tests:  3-4, 8-9, 12-13, 17-18, 21-23, 27-28
  Non-zero exit status: 13
Files=35, Tests=439, 45 wallclock secs &#40; 0.37 usr  0.16 sys + 11.31 cusr
 1.58 csys = 13.42 CPU&#41;
Result: FAIL
Failed 1/35 test programs. 13/439 subtests failed.
  BOOK/HTTP-Proxy-0.23.tar.gz
  ./Build test -- NOT OK
//hint// to see the cpan-testers results for installing this module, try:
  reports BOOK/HTTP-Proxy-0.23.tar.gz
Running Build install
  make test had returned bad status, won&#39;t install without force
Failed during this command:
 BOOK/HTTP-Proxy-0.23.tar.gz                  : make_test NO
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;04:03:28&nbsp;2009</span>
    <span class="description">maurice [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Try this patch.

The %hopbyhop has defines hop-by-hop headers in mixed case. Later a call
to HTTP::Headers::Util::split_header_words&#40;&#41; is called, but that
function returns the keys in all lowercase. That causes comparisons to
fail. The patch just normalizes all the keys to lowercase.

All the tests pass for me on Ubuntu 9.04 Jaunty now with Perl 5.10.0.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/HTTP/Proxy/HeaderFilter/standard.pm.orig	2009-07-21 00:50:20.000000000 -0700
+++ lib/HTTP/Proxy/HeaderFilter/standard.pm	2009-07-21 00:53:15.000000000 -0700
@@ -32,7 +32,7 @@
       if $message-&gt;isa&#40; &#39;HTTP::Request&#39; &#41; &#38;&#38; $self-&gt;proxy-&gt;x_forwarded_for;
 
     # make a list of hop-by-hop headers
-    my %h2h = %hopbyhop;
+    my %h2h = map { lc $_ =&gt; 1 } keys %hopbyhop;
     my $hop = HTTP::Headers-&gt;new&#40;&#41;;
     my $client = HTTP::Headers-&gt;new&#40;&#41;;
     $h2h{ $_-&gt;[0] } = 1
@@ -43,7 +43,7 @@
     $headers-&gt;scan&#40;
         sub {
             my &#40; $k, $v &#41; = @_;
-            if &#40; $h2h{$k} &#41; {
+            if &#40; $h2h{lc $k} &#41; {
                 $hop-&gt;push_header&#40; $k =&gt; $v &#41;;
                 $headers-&gt;remove_header&#40;$k&#41;;
             }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;04:03:29&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;08:59:32&nbsp;2009</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 21 04:03:28 2009, MAURICE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Try this patch.
&gt; 
&gt; The %hopbyhop has defines hop-by-hop headers in mixed case. Later a call
&gt; to HTTP::Headers::Util::split_header_words&#40;&#41; is called, but that
&gt; function returns the keys in all lowercase. That causes comparisons to
&gt; fail. The patch just normalizes all the keys to lowercase.
&gt; 
&gt; All the tests pass for me on Ubuntu 9.04 Jaunty now with Perl 5.10.0.
</div>
Thanks for the fix.

split_header_words&#40;&#41; returns lowercase keys since October 2008,
but I was still using an older version.

Applied, will be in HTTP::Proxy 0.24.

-- BooK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;08:59:33&nbsp;2009</span>
    <span class="description">book [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;18:40:23&nbsp;2009</span>
    <span class="description">book [...] cpan.org -  Fixed in 0.24 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
