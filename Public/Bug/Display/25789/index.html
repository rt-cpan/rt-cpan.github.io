<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #25789 for P4: Allowing Automated CPAN Tests</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #25789 for P4: Allowing Automated CPAN Tests</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/P4/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/P4/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/P4/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/P4/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/P4">P4 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">25789</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/P4/Active/">P4</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
imacat [...] mail.imacat.idv.tw

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-24414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.5313    </td>
  </tr>
  <tr id="CF-24415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;00:49:47&nbsp;2007</span>
    <span class="description">imacat [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Allowing Automated CPAN Tests</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Tony Smith,

    Hi. This is imacat from Taiwan. I&#39;m current acting as a CPAN tester
and running tests for all the uploaded CPAN packages daily.

    It seems that your P4-3.5313 does not allow automated tests.  It
keeps saying &#34;Where is the Perforce API to be found:&#34;, requesting
$apipath and entering an infinite loop if no STDIN is attached and no
answer can be supplied, as when I&#39;m running daily automated tests for
all the uploaded CPAN packages.

    As a CPAN tester testing 40-50 modules per day, I really cannot test
every package and check their input alone. Having such a package that
does not satisfy with an empty answer with a default behavior really
frustrate me as it uses up all my CPU and system resources that I can
contribute to other packages that need more tests.

    Could you please help solving this issue, by stopping to build if
nothing was obtained from STDIN?  Thank you very much. You are greatly
appreciated by the large CPAN family.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;30&nbsp;03:58:05&nbsp;2008</span>
    <span class="description">imacat [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Use prompt&#40;&#41; in Makefile.PL to Allow Automated Tests</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Tony Smith,

    Hi.  This is imacat from Taiwan.  I&#39;m currently helping to run smoke
tests for CPAN modules.  I found that the Makefile.PL of P4-3.5313 goes
into infinite loop if nothing is read from keyboard.  I would suggest
that you use prompt&#40;&#41; instead of directly obtain input from the STDIN,
as suggested in the ExtUtils::MakeMaker document, so that the it won&#39;t
go into infinite loop.

&lt;&lt;ExtUtils::MakeMaker&gt;&gt;
Other Handy Functions
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/perldoc?ExtUtils::MakeMaker#Other_Handy_Functions">http://search.cpan.org/perldoc?ExtUtils::MakeMaker#Other_Handy_Functions</a></span>

    Also, I would suggest you to exit&#40;&#41; with 0 from the Makefile.PL if
the required Perface API fails, as suggested by this article:

&lt;&lt;Notes For CPAN Authors&gt;
&#34;How can I stop getting FAIL reports for missing libraries or other
non-Perl dependencies?&#34;
<span class="clickylink"><a target="new" rel="nofollow" href="http://cpantest.grango.org/wiki/CPANAuthorNotes">http://cpantest.grango.org/wiki/CPANAuthorNotes</a></span>

    I made a simple patch to P4-3.5313, in the hope that it helps. 
Please tell me if you have any question, or if I could be of any help. 
Thank you.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

diff -u -r P4-3.5313.orig/Makefile.PL P4-3.5313/Makefile.PL
- --- P4-3.5313.orig/Makefile.PL	2005-08-16 22:25:19.000000000 +0800
+++ P4-3.5313/Makefile.PL	2008-03-30 15:53:13.000000000 +0800
@@ -125,9 +125,11 @@
 	my $apipath = &#34;&#34;;
 	while&#40; ! defined $apiver &#41;
 	{
- -	    print&#40; &#34;Where is the Perforce API to be found: &#34; &#41;;
- -	    $apipath = &lt;STDIN&gt;;
- -	    $apipath =~ s/\n//;
+	    $apipath = prompt&#40; &#34;Where is the Perforce API to be found:&#34;&#41;;
+	    if &#40;!$apipath&#41; {
+	        print &#34;Cannot continue without the Perface API\n&#34;;
+	        exit 0;
+	    }
 
 	    # Filthy support for ~/ type paths &#40; NOT ~user/ though! &#41;
 	    $apipath =~ s#\~/#$ENV{HOME}/#;
@@ -140,8 +142,7 @@
 	while&#40; !defined&#40; encode_api_version&#40; $apiver &#41; &#41; &#41;
 	{
 	    print&#40; &#34;Unable to determine API version string\n&#34; &#41;;
- -	    print&#40; &#34;Enter API version: &#34; &#41;;
- -	    $apiver = &lt;STDIN&gt;;
+	    $apiver = prompt&#40; &#34;Enter API version:&#34; &#41;;
 	}
 
 	$apiver = encode_api_version&#40; $apiver &#41;;
@@ -187,10 +188,7 @@
 the tests
 
 EOF
- -	print&#40; &#34;Enter the address of your Perforce server: [localhost:1666]: &#34;&#41;;
- -	my $p4port = &lt;STDIN&gt;;
- -	$p4port =~ s/\n//;
- -	$p4port = &#34;localhost:1666&#34; if &#40; $p4port =~ /^$/ &#41;;
+	my $p4port = prompt&#40; &#34;Enter the address of your Perforce server:&#34;, &#34;localhost:1666&#34; &#41;;
 
 	open&#40; IN, &#34;test.pl.skel&#34; &#41; or die&#40; &#34;Can&#39;t open test.pl.skel! &#34;&#41;;
 	open&#40; OUT, &#34;&gt;test.pl&#34; &#41; or die&#40; &#34;Can&#39;t create test.pl&#34; &#41;;
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 &#40;GNU/Linux&#41;

iEYEARECAAYFAkfvRxsACgkQi9gubzC5S1yGEwCgqWwF5bgbxZDCNy0ePIYb9aZk
Rr4An0jqMJHRmxZpFX8QhI954og2ORGN
=1RtC
-----END PGP SIGNATURE-----
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;30&nbsp;03:58:09&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
