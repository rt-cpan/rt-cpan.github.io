<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75405 for Business-Tax-VAT-Validation: VAT validation does not seem to work anymore</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75405 for Business-Tax-VAT-Validation: VAT validation does not seem to work anymore</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Business-Tax-VAT-Validation/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Business-Tax-VAT-Validation/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Business-Tax-VAT-Validation/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Business-Tax-VAT-Validation/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Business-Tax-VAT-Validation">Business-Tax-VAT-Validation CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75405</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Business-Tax-VAT-Validation/Active/">Business-Tax-VAT-Validation</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">bpgn [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bart.heupers [...] xs4all.nl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-4780-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.22    </td>
  </tr>
  <tr id="CF-4781-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;06:22:41&nbsp;2012</span>
    <span class="description">bart.heupers [...] xs4all.nl -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> VAT validation does not seem to work anymore</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The VAT validation did not seem to work any more, probably because the
VIES website changed formatting. 

In our local version I have fixed by changing _is_res_ok with :

sub _is_res_ok {
    my&#40;$self,$res&#41;=@_;
    if &#40;$res=~/^&#40;\d{3}&#41; &#40;.*&#41;/&#41; {
        return $self-&gt;_set_error&#40;$1, $2&#41;
    }
    if &#40;$res =~ /\&gt;\s*No\, invalid VAT number/m&#41; {
        return $self-&gt;_set_error&#40;2, &#34;This VAT number doesn&#39;t exists in
EU database.&#34;&#41;
    } elsif &#40;$res =~ /\&gt;\s*Error\: &#40;.*&#41;$/im&#41; {
        return $self-&gt;_set_error&#40;3, &#34;This VAT number contains errors: &#34;.$1&#41;
    } elsif &#40;$res =~ /Request time-out\. Please re-submit your request
later/m&#41;{
        return $self-&gt;_set_error&#40;17, &#34;Time out connecting to the database&#34;&#41;
    } elsif &#40;$res =~ /\&gt;\s*Member State service unavailable/m&#41; {
        return $self-&gt;_set_error&#40;18, &#34;Member State service unavailable:
Please re-submit your request later.&#34;&#41;
    } elsif &#40;$res =~ /\&gt;\s*&#40;System busy: Too many requests&#41;\. &#40;Please
re-submit your request later\.&#41;/m&#41; {
        return $self-&gt;_set_error&#40;19, &#34;$1: $2&#34;&#41;
    }
    return 1 if $res =~ /\&gt;\s*Yes\, valid VAT number\s*$/m;
    $self-&gt;_set_error&#40;257, &#34;Invalid response, please contact the author
of this module. &#34;.$res&#41;
}

The complete fixed module is attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Validation.pm</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;14:13:01&nbsp;2012</span>
    <span class="description">bpgn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in version 0.23
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;14:13:02&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;14:13:02&nbsp;2012</span>
    <span class="description">bpgn [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;14:13:02&nbsp;2012</span>
    <span class="description">bpgn [...] cpan.org -  Given to BPGN</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;14:15:50&nbsp;2012</span>
    <span class="description">bpn [...] it-dev.be -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75405] VAT validation does not seem to work anymore</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Feb 2012 20:15:25 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Business-Tax-VAT-Validation [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bernard Nauwelaerts &lt;bpn [...] it-dev.be&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">  

Dear Bart, 

Thanks a lot for your report and your submission. 

I
uploaded the fixed version to CPAN, it should be available very soon.


Please note that the regexp matching the &#34;Yes, valid VAT number&#34;
response was also broken, so that I fixed it too. 

Have a nice evening
! 

Best regards, 

Bernard 

On Wed, 29 Feb 2012 06:22:42 -0500, Bart
Heupers via RT wrote: 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Feb 29 06:22:41 2012: Request 75405 was
</div>acted upon.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Transaction: Ticket created by bheupers
&gt; Queue:
</div>Business-Tax-VAT-Validation
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Subject: VAT validation does not seem to
</div>work anymore
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Broken in: 0.22
&gt; Severity: Critical
&gt; Owner: Nobody
&gt;
</div>Requestors: bart.heupers@xs4all.nl [1]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Status: new
&gt; Ticket
</div><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75405">https://rt.cpan.org/Ticket/Display.html?id=75405</a></span> &gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The VAT
</div>validation did not seem to work any more, probably because the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; VIES
</div>website changed formatting. 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; In our local version I have fixed by
</div>changing _is_res_ok with :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; sub _is_res_ok {
&gt; my&#40;$self,$res&#41;=@_;
&gt;
</div>if &#40;$res=~/^&#40;d{3}&#41; &#40;.*&#41;/&#41; {
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; return $self-&gt;_set_error&#40;, &#41;
&gt; }
&gt; if
</div>&#40;$res =~ /&gt;s*No, invalid VAT number/m&#41; {
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; return $self-&gt;_set_error&#40;2,
</div>&#34;This VAT number doesn&#39;t exists in
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; EU database.&#34;&#41;
&gt; } elsif &#40;$res =~
</div>/&gt;s*Error: &#40;.*&#41;$/im&#41; {
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; return $self-&gt;_set_error&#40;3, &#34;This VAT number
</div>contains errors: &#34;.&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; } elsif &#40;$res =~ /Request time-out. Please
</div>re-submit your request
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; later/m&#41;{
&gt; return $self-&gt;_set_error&#40;17, &#34;Time
</div>out connecting to the database&#34;&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; } elsif &#40;$res =~ /&gt;s*Member State
</div>service unavailable/m&#41; {
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; return $self-&gt;_set_error&#40;18, &#34;Member State
</div>service unavailable:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please re-submit your request later.&#34;&#41;
&gt; } elsif
</div>&#40;$res =~ /&gt;s*&#40;System busy: Too many requests&#41;. &#40;Please
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; re-submit your
</div>request later.&#41;/m&#41; {
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; return $self-&gt;_set_error&#40;19, &#34;: &#34;&#41;
&gt; }
&gt; return 1
</div>if $res =~ /&gt;s*Yes, valid VAT numbers*$/m;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $self-&gt;_set_error&#40;257,
</div>&#34;Invalid response, please contact the author
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; of this module. &#34;.$res&#41;
&gt;
</div>}
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The complete fixed module is attached.
</div>
-- 
Bernard
Nauwelaerts
IT Development
Gorges du Loup, 5
B4877 Olne Belgium
Mobile:
+32 477 433 884
E-Mail: bpn@it-development.be

NOTICE
This email was
sent from within the Belgian company IT Development.
This email &#40;and any
attachments or hyperlinks within it&#41; may contain
information that is
confidential, legally privileged or otherwise protected from
disclosure.
If you are not the intended recipient of this email, you are
not entitled to use, disclose, distribute, copy, print, disseminate or
rely on this email in any way. If you have received this email in error,
please notify the sender immediately by telephone or email and destroy
it, and all copies of it.

We have taken steps to ensure that this email
&#40;and any attachments&#41; are free of computer viruses and the like.
However, it is the recipient&#39;s responsibility to ensure that it is
actually virus free. Any emails that you send to us may be monitored for
the purposes of ascertaining whether the communication complies with the
law and our policies.
  

Links:
------
[1]
mailto:bart.heupers@xs4all.nl
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;14:15:51&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;14:37:51&nbsp;2012</span>
    <span class="description">bart.heupers [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75405] VAT validation does not seem to work  anymore</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Feb 2012 20:37:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Business-Tax-VAT-Validation [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Bart Heupers&#34; &lt;Bart.Heupers [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Bernard,

Thanks for notifying me about the regexp that was still wrong. It took me
some time to realize why it seemed to work.

I will wait for 0.23 version to appear on CPAN.

Best regards,

Bart heup

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75405">https://rt.cpan.org/Ticket/Display.html?id=75405</a></span> &gt;
&gt;
&gt;
&gt;
&gt; Dear Bart,
&gt;
&gt; Thanks a lot for your report and your submission.
&gt;
&gt; I
&gt; uploaded the fixed version to CPAN, it should be available very soon.
&gt;
&gt;
&gt; Please note that the regexp matching the &#34;Yes, valid VAT number&#34;
&gt; response was also broken, so that I fixed it too.
&gt;
&gt; Have a nice evening
&gt; !
&gt;
&gt; Best regards,
&gt;
&gt; Bernard
&gt;
&gt; On Wed, 29 Feb 2012 06:22:42 -0500, Bart
&gt; Heupers via RT wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Wed Feb 29 06:22:41 2012: Request 75405 was
</div>&gt; acted upon.
<div class="message-stanza open">&gt;&gt; Transaction: Ticket created by bheupers
&gt;&gt; Queue:
</div>&gt; Business-Tax-VAT-Validation
<div class="message-stanza open">&gt;&gt; Subject: VAT validation does not seem to
</div>&gt; work anymore
<div class="message-stanza open">&gt;&gt; Broken in: 0.22
&gt;&gt; Severity: Critical
&gt;&gt; Owner: Nobody
&gt;&gt;
</div>&gt; Requestors: bart.heupers@xs4all.nl [1]
<div class="message-stanza open">&gt;&gt; Status: new
&gt;&gt; Ticket
</div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75405">https://rt.cpan.org/Ticket/Display.html?id=75405</a></span> &gt;
<div class="message-stanza open">&gt;&gt;
&gt;&gt; The VAT
</div>&gt; validation did not seem to work any more, probably because the
<div class="message-stanza open">&gt;&gt; VIES
</div>&gt; website changed formatting.
<div class="message-stanza open">&gt;&gt;
&gt;&gt; In our local version I have fixed by
</div>&gt; changing _is_res_ok with :
<div class="message-stanza open">&gt;&gt;
&gt;&gt; sub _is_res_ok {
&gt;&gt; my&#40;$self,$res&#41;=@_;
&gt;&gt;
</div>&gt; if &#40;$res=~/^&#40;d{3}&#41; &#40;.*&#41;/&#41; {
<div class="message-stanza open">&gt;&gt; return $self-&gt;_set_error&#40;, &#41;
&gt;&gt; }
&gt;&gt; if
</div>&gt; &#40;$res =~ /&gt;s*No, invalid VAT number/m&#41; {
<div class="message-stanza open">&gt;&gt; return $self-&gt;_set_error&#40;2,
</div>&gt; &#34;This VAT number doesn&#39;t exists in
<div class="message-stanza open">&gt;&gt; EU database.&#34;&#41;
&gt;&gt; } elsif &#40;$res =~
</div>&gt; /&gt;s*Error: &#40;.*&#41;$/im&#41; {
<div class="message-stanza open">&gt;&gt; return $self-&gt;_set_error&#40;3, &#34;This VAT number
</div>&gt; contains errors: &#34;.&#41;
<div class="message-stanza open">&gt;&gt; } elsif &#40;$res =~ /Request time-out. Please
</div>&gt; re-submit your request
<div class="message-stanza open">&gt;&gt; later/m&#41;{
&gt;&gt; return $self-&gt;_set_error&#40;17, &#34;Time
</div>&gt; out connecting to the database&#34;&#41;
<div class="message-stanza open">&gt;&gt; } elsif &#40;$res =~ /&gt;s*Member State
</div>&gt; service unavailable/m&#41; {
<div class="message-stanza open">&gt;&gt; return $self-&gt;_set_error&#40;18, &#34;Member State
</div>&gt; service unavailable:
<div class="message-stanza open">&gt;&gt; Please re-submit your request later.&#34;&#41;
&gt;&gt; } elsif
</div>&gt; &#40;$res =~ /&gt;s*&#40;System busy: Too many requests&#41;. &#40;Please
<div class="message-stanza open">&gt;&gt; re-submit your
</div>&gt; request later.&#41;/m&#41; {
<div class="message-stanza open">&gt;&gt; return $self-&gt;_set_error&#40;19, &#34;: &#34;&#41;
&gt;&gt; }
&gt;&gt; return 1
</div>&gt; if $res =~ /&gt;s*Yes, valid VAT numbers*$/m;
<div class="message-stanza open">&gt;&gt; $self-&gt;_set_error&#40;257,
</div>&gt; &#34;Invalid response, please contact the author
<div class="message-stanza open">&gt;&gt; of this module. &#34;.$res&#41;
&gt;&gt;
</div>&gt; }
<div class="message-stanza open">&gt;&gt;
&gt;&gt; The complete fixed module is attached.
</div>&gt;
&gt; --
&gt; Bernard
&gt; Nauwelaerts
&gt; IT Development
&gt; Gorges du Loup, 5
&gt; B4877 Olne Belgium
&gt; Mobile:
&gt; +32 477 433 884
&gt; E-Mail: bpn@it-development.be
&gt;
&gt; NOTICE
&gt; This email was
&gt; sent from within the Belgian company IT Development.
&gt; This email &#40;and any
&gt; attachments or hyperlinks within it&#41; may contain
&gt; information that is
&gt; confidential, legally privileged or otherwise protected from
&gt; disclosure.
&gt; If you are not the intended recipient of this email, you are
&gt; not entitled to use, disclose, distribute, copy, print, disseminate or
&gt; rely on this email in any way. If you have received this email in error,
&gt; please notify the sender immediately by telephone or email and destroy
&gt; it, and all copies of it.
&gt;
&gt; We have taken steps to ensure that this email
&gt; &#40;and any attachments&#41; are free of computer viruses and the like.
&gt; However, it is the recipient&#39;s responsibility to ensure that it is
&gt; actually virus free. Any emails that you send to us may be monitored for
&gt; the purposes of ascertaining whether the communication complies with the
&gt; law and our policies.
&gt;
&gt;
&gt; Links:
&gt; ------
&gt; [1]
&gt; mailto:bart.heupers@xs4all.nl
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;02&nbsp;07:44:51&nbsp;2012</span>
    <span class="description">henryykt [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> Bart.Heupers [...] xs4all.nl, bpn [...] it-dev.be</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 29 14:13:01 2012, BPGN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fixed in version 0.23
</div>
I find that validation of spanish VAT numbers is still broken in 0.23.

Although in the website all the form parameter names have changed, it 
seems that adding traderName as extra param to the existing post request 
fixes the problem:

        my $req = POST $self-&gt;{baseurl},
        [
            &#39;selectedLanguage&#39;        =&gt; &#39;EN&#39;,
            &#39;ms&#39;                      =&gt; $mscc ,
            &#39;vat&#39;                     =&gt; $vatn ,
            &#39;iso&#39;                     =&gt; $mscc ,
            &#39;traderName&#39;              =&gt; &#39;&#39;
        ];
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;07&nbsp;04:19:16&nbsp;2012</span>
    <span class="description">bpn [...] it-dev.be -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &lt;Bart.Heupers [...] xs4all.nl&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75405] VAT validation does not seem to work anymore</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 07 Mar 2012 10:18:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Business-Tax-VAT-Validation [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bernard Nauwelaerts &lt;bpn [...] it-dev.be&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">  

Dear Henry, 

I have updated the module, but don&#39;t have any valid
spanish VAT number to check if it works as expected. Could you please do
it with
<span class="clickylink"><a target="new" rel="nofollow" href="http://itdev.be/software/PERL/Business-Tax-VAT-Validation/Business-Tax-VAT-Validation-0.24.tar.gz">http://itdev.be/software/PERL/Business-Tax-VAT-Validation/Business-Tax-VAT-Validation-0.24.tar.gz</a></span>
? 

Thank you very much, 

Bernard 

On Fri, 2 Mar 2012 07:44:52 -0500,
Henry Tang via RT wrote: 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75405">https://rt.cpan.org/Ticket/Display.html?id=75405</a></span> &gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On Wed Feb 29
</div>14:13:01 2012, BPGN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Fixed in version 0.23
</div>&gt; I find that
</div>validation of spanish VAT numbers is still broken in 0.23. Although in
the website all the form parameter names have changed, it seems that
adding traderName as extra param to the existing post request fixes the
problem: my $req = POST $self-&gt;{baseurl}, [ &#39;selectedLanguage&#39; =&gt; &#39;EN&#39;,
&#39;ms&#39; =&gt; $mscc , &#39;vat&#39; =&gt; $vatn , &#39;iso&#39; =&gt; $mscc , &#39;traderName&#39; =&gt; &#39;&#39;
];

-- 
Bernard Nauwelaerts
IT Development
Gorges du Loup, 5
B4877 Olne
Belgium
Mobile: +32 477 433 884
E-Mail:
bpn@it-development.be

NOTICE
This email was sent from within the
Belgian company IT Development.
This email &#40;and any attachments or
hyperlinks within it&#41; may contain
information that is confidential,
legally privileged or otherwise protected from disclosure.
If you are
not the intended recipient of this email, you are not entitled to use,
disclose, distribute, copy, print, disseminate or rely on this email in
any way. If you have received this email in error, please notify the
sender immediately by telephone or email and destroy it, and all copies
of it.

We have taken steps to ensure that this email &#40;and any
attachments&#41; are free of computer viruses and the like. However, it is
the recipient&#39;s responsibility to ensure that it is actually virus free.
Any emails that you send to us may be monitored for the purposes of
ascertaining whether the communication complies with the law and our
policies.
  
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;07&nbsp;21:10:02&nbsp;2012</span>
    <span class="description">henryykt [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> bpn [...] it-dev.be</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Bernard,

Yes, 0.24 works! Thank you!

Best regards,

Henry

On Wed Mar 07 04:19:16 2012, bpn@it-dev.be wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; Dear Henry,
&gt; 
&gt; I have updated the module, but don&#39;t have any valid
&gt; spanish VAT number to check if it works as expected. Could you please
&gt; do
&gt; it with
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://itdev.be/software/PERL/Business-Tax-VAT-Validation/Business-">http://itdev.be/software/PERL/Business-Tax-VAT-Validation/Business-</a></span>
&gt; Tax-VAT-Validation-0.24.tar.gz
&gt; ?
&gt; 
&gt; Thank you very much,
&gt; 
&gt; Bernard
&gt; 
&gt; On Fri, 2 Mar 2012 07:44:52 -0500,
&gt; Henry Tang via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt;
</div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75405">https://rt.cpan.org/Ticket/Display.html?id=75405</a></span> &gt;
<div class="message-stanza open">&gt; &gt;
&gt; &gt; On Wed Feb 29
</div>&gt; 14:13:01 2012, BPGN wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; Fixed in version 0.23
</div>&gt; &gt; I find that
</div>&gt; validation of spanish VAT numbers is still broken in 0.23. Although in
&gt; the website all the form parameter names have changed, it seems that
&gt; adding traderName as extra param to the existing post request fixes
&gt; the
&gt; problem: my $req = POST $self-&gt;{baseurl}, [ &#39;selectedLanguage&#39; =&gt;
&gt; &#39;EN&#39;,
&gt; &#39;ms&#39; =&gt; $mscc , &#39;vat&#39; =&gt; $vatn , &#39;iso&#39; =&gt; $mscc , &#39;traderName&#39; =&gt; &#39;&#39;
&gt; ];
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;10:36:56&nbsp;2012</span>
    <span class="description">bpgn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in version 0.24
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;08&nbsp;10:36:57&nbsp;2012</span>
    <span class="description">bpgn [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
