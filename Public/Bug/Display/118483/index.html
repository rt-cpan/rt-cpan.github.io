<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #118483 for Text-ASCIITable: t/03_options.t fails</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #118483 for Text-ASCIITable: t/03_options.t fails</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Text-ASCIITable">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Text-ASCIITable">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Text-ASCIITable">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Text-ASCIITable">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-ASCIITable">Text-ASCIITable CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">118483</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Text-ASCIITable">Text-ASCIITable</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">haakon [...] _NOSPAM_loopback.no
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
emmanuel [...] seyman.fr

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31746-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31747-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Remove-utf8-option.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1692361/908836/0001-Remove-utf8-option.patch">
Thu Dec 22 07:39:27 2016 (3.1k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=118483">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1678228" href="/Public/Bug/Display.html?id=118483#txn-1678228">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;15:10:54&nbsp;2016</span>
    <span class="description">emmanuel [...] seyman.fr -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/03_options.t fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Oct 2016 21:10:37 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-ASCIITable [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Emmanuel Seyman &lt;emmanuel [...] seyman.fr&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1678228/900650/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/900650">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 541b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Fedora 25 and 26, I now get a failure on t/03_options.t .

[manu@kala Text-ASCIITable-0.20]$ prove -Ilib -v t/03_options.t  | tee foo
t/03_options.t .. 
1..6
ok 1
ok 2
ok 3
ok 4
not ok 5
ok 6
Failed 1/6 subtests 

The failure happens on the comparaison between length&#40;$arr[0]&#41;
and $t-&gt;getTableWidth&#40;&#41;.  The first one is equal to 39 while the second
is equal to 37 so the comparaison fails and so dies the test.
On Fedora 24, both are equal to 37 and the tests pass.

Changing the file encoding to UTF-8 doesn&#39;t improve things.

Emmanuel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1685015" href="/Public/Bug/Display.html?id=118483#txn-1685015">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;14:54:54&nbsp;2016</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> DANKOGAI [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1685015/904675/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904675">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-10-23 15:10:54, emmanuel@seyman.fr wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On Fedora 25 and 26, I now get a failure on t/03_options.t .
&gt; 
&gt; [manu@kala Text-ASCIITable-0.20]$ prove -Ilib -v t/03_options.t  | tee foo
&gt; t/03_options.t .. 
&gt; 1..6
&gt; ok 1
&gt; ok 2
&gt; ok 3
&gt; ok 4
&gt; not ok 5
&gt; ok 6
&gt; Failed 1/6 subtests 
&gt; 
&gt; The failure happens on the comparaison between length&#40;$arr[0]&#41;
&gt; and $t-&gt;getTableWidth&#40;&#41;.  The first one is equal to 39 while the second
&gt; is equal to 37 so the comparaison fails and so dies the test.
&gt; On Fedora 24, both are equal to 37 and the tests pass.
&gt; 
&gt; Changing the file encoding to UTF-8 doesn&#39;t improve things.
</div>
It seems that the failure happens with newer Encode.pm &#40;2.87&#41;. Statistical analysis suggests so &#40;theta=-1.0 means: only fail reports&#41;:

****************************************************************
Regression &#39;mod:Encode&#39;
****************************************************************
Name                   Theta          StdErr     T-stat
[0=&#39;const&#39;]           1.0000          0.0000    20771296082507892.00
[1=&#39;eq_2.39&#39;]        -0.0000          0.0000      -3.21
[2=&#39;eq_2.42_01&#39;]             -0.0000          0.0000      -3.21
[3=&#39;eq_2.44_01&#39;]             -0.0000          0.0000      -1.97
[4=&#39;eq_2.49&#39;]        -0.0000          0.0000      -4.05
[5=&#39;eq_2.55&#39;]        -0.0000          0.0000      -3.95
[6=&#39;eq_2.56&#39;]        -0.0000          0.0000      -3.50
[7=&#39;eq_2.57&#39;]        -0.0000          0.0000      -3.96
[8=&#39;eq_2.60&#39;]        -0.0000          0.0000      -4.29
[9=&#39;eq_2.62&#39;]        -0.0000          0.0000      -4.37
[10=&#39;eq_2.63&#39;]       -0.0000          0.0000      -4.03
[11=&#39;eq_2.64&#39;]       -0.0000          0.0000      -3.65
[12=&#39;eq_2.67&#39;]       -0.0000          0.0000      -4.33
[13=&#39;eq_2.68&#39;]       -0.0000          0.0000      -3.16
[14=&#39;eq_2.69&#39;]       -0.0000          0.0000      -3.59
[15=&#39;eq_2.70&#39;]       -0.0000          0.0000      -3.96
[16=&#39;eq_2.72&#39;]       -0.0000          0.0000      -4.26
[17=&#39;eq_2.72_01&#39;]            -0.0000          0.0000      -3.93
[18=&#39;eq_2.73&#39;]       -0.0000          0.0000      -3.01
[19=&#39;eq_2.75&#39;]       -0.0000          0.0000      -3.16
[20=&#39;eq_2.76&#39;]       -0.0000          0.0000      -4.08
[21=&#39;eq_2.78&#39;]       -0.0000          0.0000      -4.28
[22=&#39;eq_2.79&#39;]       -0.0000          0.0000      -3.11
[23=&#39;eq_2.80&#39;]       -0.0000          0.0000      -4.33
[24=&#39;eq_2.80_01&#39;]            -0.0000          0.0000      -4.12
[25=&#39;eq_2.84&#39;]       -0.0000          0.0000      -4.25
[26=&#39;eq_2.86&#39;]       -0.0000          0.0000      -4.49
[27=&#39;eq_2.87&#39;]       -1.0000          0.0000    -16959692232805172.00

R^2= 1.000, N= 226, K= 28
****************************************************************
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1685016" href="/Public/Bug/Display.html?id=118483#txn-1685016">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;14:54:54&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1685212" href="/Public/Bug/Display.html?id=118483#txn-1685212">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;02:28:15&nbsp;2016</span>
    <span class="description">haakon [...] _NOSPAM_loopback.no -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1685212/904773/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904773">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">ma. 21. nov. 2016 14.54.54 skrev SREZIC:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-10-23 15:10:54, emmanuel@seyman.fr wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; On Fedora 25 and 26, I now get a failure on t/03_options.t .
&gt; &gt;
&gt; &gt; [manu@kala Text-ASCIITable-0.20]$ prove -Ilib -v t/03_options.t  |
&gt; &gt; tee foo
&gt; &gt;  t/03_options.t ..
&gt; &gt; 1..6
&gt; &gt; ok 1
&gt; &gt; ok 2
&gt; &gt; ok 3
&gt; &gt; ok 4
&gt; &gt; not ok 5
&gt; &gt; ok 6
&gt; &gt;  Failed 1/6 subtests
&gt; &gt;
&gt; &gt; The failure happens on the comparaison between length&#40;$arr[0]&#41;
&gt; &gt; and $t-&gt;getTableWidth&#40;&#41;.  The first one is equal to 39 while the
&gt; &gt; second
&gt; &gt; is equal to 37 so the comparaison fails and so dies the test.
&gt; &gt; On Fedora 24, both are equal to 37 and the tests pass.
&gt; &gt;
&gt; &gt; Changing the file encoding to UTF-8 doesn&#39;t improve things.
</div>&gt; 
&gt; It seems that the failure happens with newer Encode.pm &#40;2.87&#41;.
&gt; Statistical analysis suggests so &#40;theta=-1.0 means: only fail
&gt; reports&#41;:
&gt; 
&gt; ****************************************************************
&gt; Regression &#39;mod:Encode&#39;
&gt; ****************************************************************
&gt; Name                   Theta          StdErr     T-stat
&gt; [0=&#39;const&#39;]           1.0000          0.0000    20771296082507892.00
&gt; [1=&#39;eq_2.39&#39;]        -0.0000          0.0000      -3.21
&gt; [2=&#39;eq_2.42_01&#39;]             -0.0000          0.0000      -3.21
&gt; [3=&#39;eq_2.44_01&#39;]             -0.0000          0.0000      -1.97
&gt; [4=&#39;eq_2.49&#39;]        -0.0000          0.0000      -4.05
&gt; [5=&#39;eq_2.55&#39;]        -0.0000          0.0000      -3.95
&gt; [6=&#39;eq_2.56&#39;]        -0.0000          0.0000      -3.50
&gt; [7=&#39;eq_2.57&#39;]        -0.0000          0.0000      -3.96
&gt; [8=&#39;eq_2.60&#39;]        -0.0000          0.0000      -4.29
&gt; [9=&#39;eq_2.62&#39;]        -0.0000          0.0000      -4.37
&gt; [10=&#39;eq_2.63&#39;]       -0.0000          0.0000      -4.03
&gt; [11=&#39;eq_2.64&#39;]       -0.0000          0.0000      -3.65
&gt; [12=&#39;eq_2.67&#39;]       -0.0000          0.0000      -4.33
&gt; [13=&#39;eq_2.68&#39;]       -0.0000          0.0000      -3.16
&gt; [14=&#39;eq_2.69&#39;]       -0.0000          0.0000      -3.59
&gt; [15=&#39;eq_2.70&#39;]       -0.0000          0.0000      -3.96
&gt; [16=&#39;eq_2.72&#39;]       -0.0000          0.0000      -4.26
&gt; [17=&#39;eq_2.72_01&#39;]            -0.0000          0.0000      -3.93
&gt; [18=&#39;eq_2.73&#39;]       -0.0000          0.0000      -3.01
&gt; [19=&#39;eq_2.75&#39;]       -0.0000          0.0000      -3.16
&gt; [20=&#39;eq_2.76&#39;]       -0.0000          0.0000      -4.08
&gt; [21=&#39;eq_2.78&#39;]       -0.0000          0.0000      -4.28
&gt; [22=&#39;eq_2.79&#39;]       -0.0000          0.0000      -3.11
&gt; [23=&#39;eq_2.80&#39;]       -0.0000          0.0000      -4.33
&gt; [24=&#39;eq_2.80_01&#39;]            -0.0000          0.0000      -4.12
&gt; [25=&#39;eq_2.84&#39;]       -0.0000          0.0000      -4.25
&gt; [26=&#39;eq_2.86&#39;]       -0.0000          0.0000      -4.49
&gt; [27=&#39;eq_2.87&#39;]       -1.0000          0.0000    -16959692232805172.00
&gt; 
&gt; R^2= 1.000, N= 226, K= 28
&gt; ****************************************************************
</div>

Thank you for the very thorough research! Could you show me a diff between $arr[0] from your two different test setups?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1685214" href="/Public/Bug/Display.html?id=118483#txn-1685214">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;02:28:15&nbsp;2016</span>
    <span class="description">haakon [...] _NOSPAM_loopback.no -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1686579" href="/Public/Bug/Display.html?id=118483#txn-1686579">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;27&nbsp;05:13:07&nbsp;2016</span>
    <span class="description">emmanuel [...] seyman.fr -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118483] t/03_options.t fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 27 Nov 2016 11:12:52 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Hakon Nessjoen via RT &lt;bug-Text-ASCIITable [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Emmanuel Seyman &lt;emmanuel [...] seyman.fr&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1686579/905569/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/905569">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 804b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Hakon Nessjoen via RT [22/11/2016 02:28] :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Thank you for the very thorough research! Could you show me a diff
&gt; between $arr[0] from your two different test setups?
</div>
On a Fedora 24 system with updates &#40;perl 5.22, perl-Encode 2.84&#41;:

$arr[0] = &#39;|  1 | Lunatic-| | H�kon Nessj�en   |&#39;;
length&#40;$arr[0]&#41; = 37;
$t-&gt;getTableWidth&#40;&#41; = 37;

If I convert t/03_options.t to UTF-8, I get:

$arr[0] = &#39;|  1 | Lunatic-| | Håkon Nessjøen   |&#39;;
length&#40;$arr[0]&#41; = 39;
$t-&gt;getTableWidth&#40;&#41; = 37;

On Fedora 26 &#40;perl 5.24, perl-Encode 2.87&#41;, I get:

$arr[0] = &#39;|  1 | Lunatic-| | H�kon Nessj�en     |&#39;;
length&#40;$arr[0]&#41; = 39;
$t-&gt;getTableWidth&#40;&#41; = 37;

Converting t/03_options.t to UTF-8, I get:

$arr[0] = &#39;|  1 | Lunatic-| | Håkon Nessjøen   |&#39;;
length&#40;$arr[0]&#41; = 39;
$t-&gt;getTableWidth&#40;&#41; = 37;

Emmanuel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1692358" href="/Public/Bug/Display.html?id=118483#txn-1692358">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;07:07:17&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1692358/908831/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/908831">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Ne 27.lis.2016 05:13:07, emmanuel@seyman.fr napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fedora 26 &#40;perl 5.24, perl-Encode 2.87&#41;, I get:
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Converting t/03_options.t to UTF-8, I get:
&gt; 
&gt; $arr[0] = &#39;|  1 | Lunatic-| | Håkon Nessjøen   |&#39;;
&gt; length&#40;$arr[0]&#41; = 39;
&gt; $t-&gt;getTableWidth&#40;&#41; = 37;
&gt; 
</div>The length&#40;&#41; value is correct, the getTableWidth&#40;&#41; value is wrong. The &#34;Håkon Nessjøen&#34; text is wrongly padded from right side, there are two additional spaces as can be seen when printing the whole table:

|  1 | Lunatic-| | Håkon Nessjøen     |
|  2 | tesepe    | William Viker    |
|  3 | espen     | Espen Ursin-Holm |
|  4 | bonde     | Martin Mikkelsen |

I think the bug is in Text::ASCIITable::count&#40;&#41; that counts number of characters and it does these last two commands:

  $str = decode&#40;&#34;utf8&#34;, $str&#41; if $self-&gt;{options}{utf8};
  return length&#40;$str&#41;;

In other words it decodes Unicode string again into UTF-8 because $self-&gt;{options}{utf8} is true by default.

The double UTF-8 interpretation can be clearly visible if I change &#34;Håkon Nessjøen&#34; addRow&#40;&#41; argument to &#34;žHåkon Nessjøen&#34;, then the test dies:

 perl -Ilib t/03_options.t 
1..6
ok 1
ok 2
Wide character at /usr/lib64/perl5/vendor_perl/Encode.pm line 212.

The Encode.pm:212 is a line in Encode::decode&#40;&#41; from Encode-2.88 with this code:

$string = $enc-&gt;decode&#40; $octets, $check &#41;;

Now, why does the &#34;ž&#34; character matter? I don&#39;t know. The only difference is that &#34;ž&#34; code point is bigger than 255 while &#34;å&#34; and &#34;ø&#34; are less that 256.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1692361" href="/Public/Bug/Display.html?id=118483#txn-1692361">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;07:39:27&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1692361/908835/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/908835">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 570b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Čt 22.pro.2016 07:07:17, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think the bug is in Text::ASCIITable::count&#40;&#41; that counts number of
&gt; characters and it does these last two commands:
&gt; 
&gt; $str = decode&#40;&#34;utf8&#34;, $str&#41; if $self-&gt;{options}{utf8};
&gt; return length&#40;$str&#41;;
&gt; 
</div>There is t/13_utf8.t test that expects exactly opposite results. It looks like Text::ASCIITable interface expects octet strings on input. I think this is terribly bad idea. Especially in these days.

Attached patch removes the undocumented utf8 feature and changes expectations that all inputs are Unicode strings.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Remove-utf8-option.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1692361/908836/0001-Remove-utf8-option.patch">Download 0001-Remove-utf8-option.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From dcd0d8011eeaf7f74a8f03e3600235303e64f7d7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Thu, 22 Dec 2016 13:12:48 +0100
Subject: [PATCH] Remove utf8 option
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This feature caused test failures since Encode-2.87 because it tried to
reinterpret input strings as UTF-8 octet stream.

It&#39;s application&#39;s responsibility to provide input as Unicode strings.
This how Perl works.

CPAN RT#118483

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 lib/Text/ASCIITable.pm | 2 --
 t/03_options.t         | 3 ++-
 t/13_utf8.t            | 5 +++--
 3 files changed, 5 insertions&#40;+&#41;, 5 deletions&#40;-&#41;

diff --git a/lib/Text/ASCIITable.pm b/lib/Text/ASCIITable.pm
index b630910..c4449e0 100644
--- a/lib/Text/ASCIITable.pm
+++ b/lib/Text/ASCIITable.pm
@@ -88,7 +88,6 @@ sub new {
   $self-&gt;{options}{alignHeadRow} = $self-&gt;{options}{alignHeadRow} || &#39;auto&#39;; # default setting
   $self-&gt;{options}{undef_as} = $self-&gt;{options}{undef_as} || &#39;&#39;; # default setting
   $self-&gt;{options}{chaining} = $self-&gt;{options}{chaining} || 0; # default setting
-  $self-&gt;{options}{utf8} = defined&#40;$self-&gt;{options}{utf8}&#41; ? $self-&gt;{options}{utf8} : 1; # default setting
 
   bless $self;
 
@@ -884,7 +883,6 @@ sub count {
   $str =~ s/&lt;.+?&gt;//g if $self-&gt;{options}{allowHTML};
   $str =~ s/\33\[&#40;\d+&#40;;\d+&#41;?&#41;?[musfwhojBCDHRJK]//g if $self-&gt;{options}{allowANSI}; # maybe i should only have allowed ESC[#;#m and not things not related to
   $str =~ s/\33\&#40;[0B]//g if $self-&gt;{options}{allowANSI};                           # color/bold/underline.. But I want to give people as much room as they need.
-  $str = decode&#40;&#34;utf8&#34;, $str&#41; if $self-&gt;{options}{utf8};
 
   return length&#40;$str&#41;;
 }
diff --git a/t/03_options.t b/t/03_options.t
index d8ef530..162c286 100644
--- a/t/03_options.t
+++ b/t/03_options.t
@@ -2,6 +2,7 @@
 
 BEGIN { $| = 1; print &#34;1..6\n&#34;; }
 END {print &#34;not ok 1\n&#34; unless $loaded;}
+use utf8;
 use Text::ASCIITable;
 $loaded = 1;
 print &#34;ok 1\n&#34;;
@@ -9,7 +10,7 @@ $i=2;
 
 $t = new Text::ASCIITable&#40;{ hide_LastLine =&gt; 1, hide_HeadLine =&gt; 1 }&#41;;
 ok&#40;$t-&gt;setCols&#40;[&#39;id&#39;,&#39;nick&#39;,&#39;name&#39;]&#41;&#41;;
-ok&#40;$t-&gt;addRow&#40;&#39;1&#39;,&#39;Lunatic-|&#39;,&#39;Håkon Nessjøen&#39;&#41;&#41;;
+ok&#40;$t-&gt;addRow&#40;&#39;1&#39;,&#39;Lunatic-|&#39;,&#39;HÃ¥kon NessjÃ¸en&#39;&#41;&#41;;
 $t-&gt;addRow&#40;&#39;2&#39;,&#39;tesepe&#39;,&#39;William Viker&#39;&#41;;
 $t-&gt;addRow&#40;&#39;3&#39;,&#39;espen&#39;,&#39;Espen Ursin-Holm&#39;&#41;;
 $t-&gt;addRow&#40;&#39;4&#39;,&#39;bonde&#39;,&#39;Martin Mikkelsen&#39;&#41;;
diff --git a/t/13_utf8.t b/t/13_utf8.t
index d0ef858..59649f2 100644
--- a/t/13_utf8.t
+++ b/t/13_utf8.t
@@ -2,6 +2,7 @@
 
 BEGIN { $| = 1; print &#34;1..6\n&#34;; }
 END {print &#34;not ok 1\n&#34; unless $loaded;}
+use utf8;
 use Text::ASCIITable;
 $loaded = 1;
 print &#34;ok 1\n&#34;;
@@ -18,9 +19,9 @@ eval {
 };
 if &#40;!$@&#41; {ok&#40;undef&#41;} else {ok&#40;1&#41;}
 @arr = split&#40;/\n/,$content&#41;;
-ok&#40;length&#40;$arr[3]&#41; &lt; length&#40;$arr[4]&#41;?undef:1&#41;;
+ok&#40;length&#40;$arr[3]&#41; == length&#40;$arr[4]&#41;?undef:1&#41;;
 ok&#40;length&#40;$arr[3]&#41; == $t-&gt;getTableWidth&#40;&#41;?undef:1&#41;;
-ok&#40;length&#40;$arr[6]&#41; &gt; $t-&gt;getTableWidth&#40;&#41;?undef:1&#41;;
+ok&#40;length&#40;$arr[6]&#41; == $t-&gt;getTableWidth&#40;&#41;?undef:1&#41;;
 if &#40;scalar&#40;@arr&#41; == 8&#41; {ok&#40;undef&#41;;} else {ok&#40;1&#41;;}
 
 sub ok{print&#40;defined&#40;shift&#41;?&#34;not ok $i\n&#34;:&#34;ok $i\n&#34;&#41;;$i++;}
-- 
2.7.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1694751" href="/Public/Bug/Display.html?id=118483#txn-1694751">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;12:08:48&nbsp;2016</span>
    <span class="description">haakon [...] _NOSPAM_loopback.no -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1694751/910141/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/910141">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 13b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.22
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1694753" href="/Public/Bug/Display.html?id=118483#txn-1694753">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;12:08:59&nbsp;2016</span>
    <span class="description">haakon [...] _NOSPAM_loopback.no -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.38448</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
