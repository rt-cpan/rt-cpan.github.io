<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #39662 for Module-Build: Failing tilde expansion tests</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #39662 for Module-Build: Failing tilde expansion tests</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Module-Build/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Module-Build/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Module-Build/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Module-Build/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-Build">Module-Build CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">39662</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Module-Build/Active/">Module-Build</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ambs [...] cpan.org

<br />
ANIRVAN [...] cpan.org

<br />
rjurney [...] lucision.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-21558-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.30    </td>
  </tr>
  <tr id="CF-21559-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;28&nbsp;17:14:34&nbsp;2008</span>
    <span class="description">ambs [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Failing tilde expansion tests</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello.

Trying to install Module::Build on my mac, used &#39;sudo cpan&#39;, and
&#39;install Module::Build&#39;.

Everything got well. Just failed t/tilde errors &#40;see bellow&#41;.
I have a slight idea about why this happens &#40;one is the root home, the
other is the user doing sudo&#39;s home&#41;.

t/tilde...............ok 1/17                                          
     
#   Failed test at t/tilde.t line 54.
#          got: &#39;/var/root&#39;
#     expected: &#39;/Users/ambs&#39;
t/tilde...............NOK 3/17                                         
     
#   Failed test at t/tilde.t line 56.
#          got: &#39;/var/root/foo&#39;
#     expected: &#39;/Users/ambs/foo&#39;
t/tilde...............ok 5/17                                          
     
#   Failed test at t/tilde.t line 62.
#          got: &#39;/var/root/ foo&#39;
#     expected: &#39;/Users/ambs/ foo&#39;
t/tilde...............NOK 7/17                                         
     
#   Failed test at t/tilde.t line 64.
#          got: &#39;/var/root/fo o&#39;
#     expected: &#39;/Users/ambs/fo o&#39;
t/tilde...............NOK 8/17                                         
     
t/tilde...............NOK 10/17#   Failed test at t/tilde.t line 68.   
     
#          got: &#39;/var/root&#39;
#     expected: &#39;/Users/ambs&#39;

#   Failed test at t/tilde.t line 74.
#          got: &#39;/var/root/lib&#39;
#     expected: &#39;/Users/ambs/lib&#39;

#   Failed test at t/tilde.t line 76.
#          got: &#39;/var/root/html&#39;
#     expected: &#39;/Users/ambs/html&#39;

#   Failed test at t/tilde.t line 77.
#          got: &#39;/var/root/html&#39;
#     expected: &#39;/Users/ambs/html&#39;
t/tilde...............NOK 13/17                                        
     
#   Failed test at t/tilde.t line 80.
#          got: &#39;/var/root/lib&#39;
#     expected: &#39;/Users/ambs/lib&#39;
t/tilde...............NOK 14/17                                        
     
t/tilde...............NOK 15/17#   Failed test at t/tilde.t line 83.   
     
#          got: &#39;/var/root&#39;
#     expected: &#39;/Users/ambs&#39;
t/tilde...............ok 16/17# Looks like you failed 10 tests of 17.  
     
t/tilde...............dubious                                          
     
        Test returned status 10 &#40;wstat 2560, 0xa00&#41;
DIED. FAILED tests 3-4, 7-8, 10-15
        Failed 10/17 tests, 41.18% okay
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;28&nbsp;17:55:11&nbsp;2008</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39662] Failing tilde expansion tests</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 28 Sep 2008 17:54:43 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Build [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Alberto Simões via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Trying to install Module::Build on my mac, used &#39;sudo cpan&#39;, and
&gt; &#39;install Module::Build&#39;.
</div>
Little tip, don&#39;t run cpan as the super user.  Run it as a normal user and
change make_install_make_command and mbuild_install_build_command to run &#34;sudo
make&#34; and &#34;sudo ./Build&#34; respectively.  That way a busted build or test stage
won&#39;t be able to blow away your whole system.

If you rerun the CPAN shell configuration &#40;o conf init&#41; it will walk you
through this process.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Everything got well. Just failed t/tilde errors &#40;see bellow&#41;.
&gt; I have a slight idea about why this happens &#40;one is the root home, the
&gt; other is the user doing sudo&#39;s home&#41;.
</div>
Unix::_detildefy&#40;&#41; is using getpwnam $&gt; rather than $ENV{HOME}.  On my OS X
10.4, sudo sets both $&gt; and $&lt;.  So that&#39;s a problem.

Any reason it&#39;s not just using $ENV{HOME}?  That&#39;s what ~ means, not what&#39;s
hard coded in /etc/passwd.  If $ENV{HOME} isn&#39;t defined, then fall back to
getpwnam&#40;&#41;.

Try this.

--- lib/Module/Build/Platform/Unix.pm   &#40;revision 67091&#41;
+++ lib/Module/Build/Platform/Unix.pm   &#40;local&#41;
@@ -47,7 +47,7 @@
   $value =~ s[^~&#40;\w[-\w]*&#41;?&#40;?=/|$&#41;]   # tilde with optional username
     [$1 ?
      &#40;&#40;getpwnam $1&#41;[7] || &#34;~$1&#34;&#41; :
-     &#40;getpwuid $&gt;&#41;[7]
+     &#40;$ENV{HOME} || &#40;getpwuid $&gt;&#41;[7]&#41;
     ]ex;
   return $value;
 }



-- 
Hating the web since 1994.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;28&nbsp;17:55:13&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;28&nbsp;18:03:52&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yep, r11900 fixes tilde expansion with sudo.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;28&nbsp;18:03:55&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;05:01:40&nbsp;2008</span>
    <span class="description">ambs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39662] Failing tilde expansion tests</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Sep 2008 10:01:12 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Build [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alberto Simoes &lt;ambs [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39662">http://rt.cpan.org/Ticket/Display.html?id=39662</a></span> &gt;
&gt; 
&gt; Alberto Simões via RT wrote:
<div class="message-stanza open">&gt;&gt; Trying to install Module::Build on my mac, used &#39;sudo cpan&#39;, and
&gt;&gt; &#39;install Module::Build&#39;.
</div>&gt; 
&gt; Little tip, don&#39;t run cpan as the super user.  Run it as a normal user and
&gt; change make_install_make_command and mbuild_install_build_command to run &#34;sudo
&gt; make&#34; and &#34;sudo ./Build&#34; respectively.  That way a busted build or test stage
&gt; won&#39;t be able to blow away your whole system.
&gt; 
&gt; If you rerun the CPAN shell configuration &#40;o conf init&#41; it will walk you
&gt; through this process.
</div>
Thanks for the tip ;&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Everything got well. Just failed t/tilde errors &#40;see bellow&#41;.
&gt;&gt; I have a slight idea about why this happens &#40;one is the root home, the
&gt;&gt; other is the user doing sudo&#39;s home&#41;.
</div>&gt; 
&gt; Unix::_detildefy&#40;&#41; is using getpwnam $&gt; rather than $ENV{HOME}.  On my OS X
&gt; 10.4, sudo sets both $&gt; and $&lt;.  So that&#39;s a problem.
&gt; 
&gt; Any reason it&#39;s not just using $ENV{HOME}?  That&#39;s what ~ means, not what&#39;s
&gt; hard coded in /etc/passwd.  If $ENV{HOME} isn&#39;t defined, then fall back to
&gt; getpwnam&#40;&#41;.
&gt; 
&gt; Try this.
&gt; 
&gt; --- lib/Module/Build/Platform/Unix.pm   &#40;revision 67091&#41;
&gt; +++ lib/Module/Build/Platform/Unix.pm   &#40;local&#41;
&gt; @@ -47,7 +47,7 @@
&gt;    $value =~ s[^~&#40;\w[-\w]*&#41;?&#40;?=/|$&#41;]   # tilde with optional username
&gt;      [$1 ?
&gt;       &#40;&#40;getpwnam $1&#41;[7] || &#34;~$1&#34;&#41; :
&gt; -     &#40;getpwuid $&gt;&#41;[7]
&gt; +     &#40;$ENV{HOME} || &#40;getpwuid $&gt;&#41;[7]&#41;
&gt;      ]ex;
&gt;    return $value;
&gt;  }
</div>
Worked smoothly!
0.31 real soon now? :&#41;


-- 
Alberto Simões - Departamento de Informática - Universidade do Minho
                  Campus de Gualtar - 4710-057 Braga - Portugal
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;05:01:42&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;12:05:29&nbsp;2008</span>
    <span class="description">kenahoo [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39662] Failing tilde expansion tests</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Sep 2008 11:05:10 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Build [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ken Williams&#34; &lt;kenahoo [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Sep 28, 2008 at 4:55 PM, Michael G Schwern via RT
&lt;bug-Module-Build@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Any reason it&#39;s not just using $ENV{HOME}?  That&#39;s what ~ means, not what&#39;s
&gt; hard coded in /etc/passwd.
</div>

I don&#39;t think that&#39;s true, from my testing with zsh:

  % HOME=foo echo ~
  /Users/u0048513

 -Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;12:11:01&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 29 12:05:29 2008, kenahoo@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t think that&#39;s true, from my testing with zsh:
&gt; 
&gt;   % HOME=foo echo ~
&gt;   /Users/u0048513
</div>
Never mind, that was of course a flawed test.  Here&#39;s a better one:

  % export HOME=foo
  % echo ~
  foo

 -Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;12:11:05&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;13:46:19&nbsp;2008</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39662] Failing tilde expansion tests</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Sep 2008 13:45:41 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Build [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ken Williams via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Module-Build
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39662">http://rt.cpan.org/Ticket/Display.html?id=39662</a></span> &gt;
&gt; 
&gt; On Mon Sep 29 12:05:29 2008, kenahoo@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; I don&#39;t think that&#39;s true, from my testing with zsh:
&gt;&gt;
&gt;&gt;   % HOME=foo echo ~
&gt;&gt;   /Users/u0048513
</div>&gt; 
&gt; Never mind, that was of course a flawed test.  Here&#39;s a better one:
&gt; 
&gt;   % export HOME=foo
&gt;   % echo ~
&gt;   foo
</div>
Caught me out, too


-- 
54. &#34;Napalm sticks to kids&#34; is *not* a motivational phrase.
    -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
           <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;29&nbsp;13:46:22&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;25&nbsp;13:55:11&nbsp;2008</span>
    <span class="description">ANIRVAN [...] cpan.org - Ticket #40376:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Module::Build t/tilde.t can get confused under sudo, causing test
 to fail</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On my CentOS 5 Linux system, when I run &#34;sudo cpan&#34; to install
Module::Build, the t/tilde.t test fails

This is because sudo transfers over my normal account&#39;s environment
variables to the root account. The behavior is sometimes a good thing
&#40;e.g. I like having my $EDITOR set&#41;, but in this case, it means that my
$HOME is getting passed along as well.

tilde.t figures out what the user&#39;s home directory is by looking at
$HOME &#40;line 40 in Module::Build 0.30&#41;. In this case, stupidly, $HOME
can&#39;t be trusted -- even though MB itself expands ~ correctly.

So when I ran &#34;sudo cpan&#34; to install Module::Build, tilde.t saw
~myusername as the home directory &#40;instead of ~root&#41;, and thought that
all the run_sample test had failed, because they kept returning
&#40;correct&#41; ~root dirs instead of ~anirvan dirs.

I don&#39;t have a solution to this, but since Module::Build itself gets it
right, I suggest either:

- using whatever algorithm MB uses to determine ~ to be used in tilde.t 

- doing a self-test to see if $HOME and the internal &#34;~&#34; expansion are
wrong, and spewing something useful to the user

I&#39;d be happy to help you test any potential fixes. Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;25&nbsp;18:53:58&nbsp;2008</span>
    <span class="description">schwern [...] pobox.com - Ticket #40376:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40376] Module::Build t/tilde.t can get confused under sudo, causing test to fail</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 25 Oct 2008 15:52:58 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Build [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Anirvan Chatterjee via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is because sudo transfers over my normal account&#39;s environment
&gt; variables to the root account. The behavior is sometimes a good thing
&gt; &#40;e.g. I like having my $EDITOR set&#41;, but in this case, it means that my
&gt; $HOME is getting passed along as well.
</div>
What do these do?

    sudo echo ~
    sudo echo $HOME
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;25&nbsp;18:54:00&nbsp;2008</span>
    <span class="description">The RT System itself - Ticket #40376:  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;25&nbsp;22:03:59&nbsp;2008</span>
    <span class="description">ANIRVAN [...] cpan.org - Ticket #40376:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40376] Module::Build t/tilde.t can get confused under sudo, causing test to fail</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 25 Oct 2008 19:03:37 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michael G Schwern via RT &lt;bug-Module-Build [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Anirvan Chatterjee &lt;ANIRVAN [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Oct 25, 2008 at 06:54:00PM -0400, Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What do these do?
</div>
I ran these, and some other tests, trying to see if I could turn up
anything interesting. The only vaguely interesting thing I found is at
the end of this email -- the $USER and $SUDO* environment variables.
Thanks again for looking into this.

% sudo echo ~
/home/my-username

% sudo echo $HOME
/home/my-username

% sudo whoami
root

% sudo perl -e &#39;print &#34;$ENV{HOME}\n&#34;&#39;
/home/my-username

% sudo su
# echo ~
/root
# echo $HOME
/root

% su
# echo ~
/root
# echo $HOME
/root

% su -c &#39;echo ~&#39;
/root
% su -c &#39;echo $HOME&#39;
/root

% sudo env      # uninteresting lines snipped
MAIL=/var/spool/mail/my-username
HOME=/home/my-username
LOGNAME=root
USER=root
SUDO_COMMAND=/bin/env
SUDO_USER=my-username
SUDO_UID=500    # my account&#39;s user ID
SUDO_GID=500    # my account&#39;s group ID

-- 
Anirvan Chatterjee
www.chatterjee.net
www.bookfinder.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;26&nbsp;12:24:03&nbsp;2008</span>
    <span class="description">scratchcomputing [...] gmail.com - Ticket #40376:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40376] Module::Build t/tilde.t can get confused under sudo, causing test to fail</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 26 Oct 2008 09:21:49 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Build [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Eric Wilhelm &lt;scratchcomputing [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># from Anirvan Chatterjee via RT on Saturday 25 October 2008:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;% sudo echo ~
&gt;/home/my-username
&gt;
&gt;% sudo echo $HOME
&gt;/home/my-username
&gt;...
&gt;% su -c &#39;echo ~&#39;
&gt;/root
&gt;% su -c &#39;echo $HOME&#39;
&gt;/root
</div>
Note that the first two don&#39;t say anything about su.  The tilde and 
variable are expanded by the user&#39;s shell before being passed to su.

--Eric
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;21:55:45&nbsp;2008</span>
    <span class="description">rjurney [...] lucision.com - Ticket #40479:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Module tests fail when installing with &#39;sudo&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Oct 2008 21:55:12 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Build [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Russell Jurney &lt;rjurney [...] lucision.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">rjurney@ubuntu:/mnt/osx/al_trunk/iet$ sudo cpan Module::Build
CPAN: Storable loaded ok &#40;v2.15&#41;
Going to read /home/rjurney/.cpan/Metadata
   Database was generated on Tue, 28 Oct 2008 11:26:55 GMT
CPAN: YAML loaded ok &#40;v0.66&#41;
Going to read 17 yaml files from /home/rjurney/.cpan/build/
CPAN: Time::HiRes loaded ok &#40;v1.86&#41;
............................................................................DONE
Restored the state of 17 &#40;in 0.6760 secs&#41;
Running install for module &#39;Module::Build&#39;
Running make for K/KW/KWILLIAMS/Module-Build-0.30.tar.gz
   Has already been unwrapped into directory /home/rjurney/.cpan/build/ 
Module-Build-0.30-h72tBo
   Has already been made
Running make test
/usr/bin/perl Build --makefile_env_macros 1 test
t/basic...............ok
t/compat..............ok
t/destinations........ok
t/ext.................ok
t/extend..............ok
t/files...............ok
t/help................ok
t/install.............ok
t/manifypods..........ok
t/mbyaml..............ok
t/metadata............ok
t/metadata2...........ok
t/moduleinfo..........ok
t/new_from_context....ok
t/notes...............ok
t/par.................ok
t/parents.............ok
t/pod_parser..........ok
t/ppm.................ok
t/runthrough..........ok
t/script_dist.........ok
t/signature...........skipped: $ENV{TEST_SIGNATURE} is not set
t/test_file_exts......ok
t/test_type...........ok
t/test_types..........ok
t/tilde...............1/17
#   Failed test at t/tilde.t line 54.
#          got: &#39;/root&#39;
#     expected: &#39;/home/rjurney&#39;
t/tilde...............4/17
#   Failed test at t/tilde.t line 56.
#          got: &#39;/root/foo&#39;
#     expected: &#39;/home/rjurney/foo&#39;

#   Failed test at t/tilde.t line 62.
#          got: &#39;/root/ foo&#39;
#     expected: &#39;/home/rjurney/ foo&#39;

#   Failed test at t/tilde.t line 64.
#          got: &#39;/root/fo o&#39;
#     expected: &#39;/home/rjurney/fo o&#39;

#   Failed test at t/tilde.t line 68.
#          got: &#39;/root&#39;
#     expected: &#39;/home/rjurney&#39;

#   Failed test at t/tilde.t line 74.
#          got: &#39;/root/lib&#39;
#     expected: &#39;/home/rjurney/lib&#39;

#   Failed test at t/tilde.t line 76.
#          got: &#39;/root/html&#39;
#     expected: &#39;/home/rjurney/html&#39;

#   Failed test at t/tilde.t line 77.
#          got: &#39;/root/html&#39;
#     expected: &#39;/home/rjurney/html&#39;

#   Failed test at t/tilde.t line 80.
#          got: &#39;/root/lib&#39;
#     expected: &#39;/home/rjurney/lib&#39;

#   Failed test at t/tilde.t line 83.
#          got: &#39;/root&#39;
#     expected: &#39;/home/rjurney&#39;
# Looks like you failed 10 tests of 17.
t/tilde............... Dubious, test returned 10 &#40;wstat 2560, 0xa00&#41;
  Failed 10/17 subtests
t/use_tap_harness.....ok
t/versions............ok
t/xs..................ok

Test Summary Report
-------------------
t/tilde           &#40;Wstat: 2560 Tests: 17 Failed: 10&#41;
   Failed tests:  3-4, 7-8, 10-15
   Non-zero exit status: 10
Files=29, Tests=999, 45 wallclock secs &#40; 0.21 usr  0.58 sys + 25.65  
cusr 18.62 csys = 45.06 CPU&#41;
Result: FAIL
Failed 1/29 test programs. 10/999 subtests failed.
make: *** [test] Error 255
   KWILLIAMS/Module-Build-0.30.tar.gz
   /usr/bin/make test -- NOT OK
//hint// to see the cpan-testers results for installing this module,  
try:
   reports KWILLIAMS/Module-Build-0.30.tar.gz
Running make install
   make test had returned bad status, won&#39;t install without force
Stopping: &#39;install&#39; failed for &#39;Module::Build&#39;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;15:08:21&nbsp;2008</span>
    <span class="description">EWILHELM [...] cpan.org - Ticket #40479:  Merged into ticket #39662</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;15:08:22&nbsp;2008</span>
    <span class="description">EWILHELM [...] cpan.org -  Merged into ticket #39662</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;15:10:21&nbsp;2008</span>
    <span class="description">EWILHELM [...] cpan.org - Ticket #40376:  Merged into ticket #39662</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;15:10:21&nbsp;2008</span>
    <span class="description">EWILHELM [...] cpan.org -  Merged into ticket #39662</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;21&nbsp;21:43:20&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
