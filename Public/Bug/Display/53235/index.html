<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53235 for DBD-SQLite: Compatibility with SQLite ICU extension</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53235 for DBD-SQLite: Compatibility with SQLite ICU extension</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-SQLite">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-SQLite">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-SQLite">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-SQLite">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53235</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-SQLite">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bch-4439 [...] gmx.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.27    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=53235">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-713201" href="/Public/Bug/Display.html?id=53235#txn-713201">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;30&nbsp;12:36:45&nbsp;2009</span>
    <span class="description">bch-4439 [...] gmx.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Compatibility with SQLite ICU extension</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/713201/368140/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/368140">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza">Hi. This is a feature request.<br>

<br>

SQLite can be compiled with unicode support via the ICU library: <br>

<br>

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt">http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt</a></span><br>

<span class="clickylink"><a target="new" rel="nofollow" href="http://site.icu-project.org/">http://site.icu-project.org/</a></span><br>

<br>

It would be extremely helpful if DBD-SQLite were compatible with this extension. I think there is only a minor step missing. Here is what I tried.<br>

<br>

For ICU support, you configure SQLite 3.6.20 with CFLAGS=-DSQLITE_ENABLE_ICU and LIBS=-licuio. I tried to see whether DBD-SQLite 1.27 works with the ICU extension and configured it with<br>

<br>

perl Makefile.PL LIBS=&quot;-licuio&quot; CCFLAGS=&quot;-DSQLITE_ENABLE_ICU&quot; PREFIX=/usr/local<br>

<br>

Compilation works, and the resulting Perl module knows the ICU collations, for example,<br>

<br>

SELECT icu_load_collation('de_DE','custom');<br>

<br>

does not give an error. But when you try to use this collation, say,<br>

<br>

CREATE TABLE something ( column VARCHAR(20) COLLATE custom );<br>

<br>

DBD-SQLite says it does not know the collation:<br>

<br>

can't install, unknown collation : custom at /usr/local/lib/perl5/site_perl/5.10.0/i586-linux-thread-multi/DBD/SQLite.pm line 141.<br>

<br>

So it seems although the ICU extension is there and the ICU collation 'de_DE' is known, DBD-SQLite takes control of all requested collations and gives an error because it does not know about the ICU collation.<br>

<br>

I would be most grateful if you could support ICU in a future version. I am also happy to invest some time and try out patches.<br>

<br>

Finally, why might somebody want ICU support? SQLite is only able to sort ASCII strings. Any accented characters are wrongly sorted and there is no unicode or locale support whatsoever (SQLite design choice because they want to keep their library small). Of course, every client is free to add their own collations. So you added support for Perl 'cmp'. In Qt, it is easy to use their unicode localized QString comparison, and so on. But as of today, this is done differently in each client (SQLite design drawback because there is no central server). So your database, well, at least your indices, becomes inconsistent if you access the same database file in different ways, say a Perl DBD-SQLite script to do some data import, versus a Qt frontend to query the data base. Since SQLite already have the ICU extension, that one would be the natural standard for unicode and locale support.<br>

<br>

Thanks for your attention and your help.<br>

<br>

Bernhard<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-713978" href="/Public/Bug/Display.html?id=53235#txn-713978">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;01&nbsp;13:02:35&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/713978/368520/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/368520">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza">Hi. I haven't fully investigated yet, but a quick hack to<br>

sqlite3.c seems to work for me, at least for your sample.<br>

<br>

--- sqlite3.c   (revision 10704)<br>

+++ sqlite3.c   (working copy)<br>

@@ -109521,7 +109521,7 @@<br>

&nbsp;  }<br>

&nbsp;  assert(p);<br>

<br>

-  rc = sqlite3_create_collation_v2(db, zName, SQLITE_UTF16, (void *)pUCollator,<br>

+  rc = sqlite3_create_collation_v2(db, zName, SQLITE_UTF8, (void *)pUCollator,<br>

&nbsp;      icuCollationColl, icuCollationDel<br>

&nbsp;  );<br>

&nbsp;  if( rc!=SQLITE_OK ){<br>

<br>

I don't think this is the best patch (database encoding<br>

should be taken from somewhere, and this is a patch<br>

to the amalgamated source, which should be a patch to<br>

ext/icu/icu.c), but anyway, if this works for you, or<br>

at least helps you create a better patch, please<br>

report this to the sqlite team and ask them to fix.<br>

<br>

Kenichi<br>

<br>

On 2009-Dec-30 Wed 12:36:45, bhell wrote:&nbsp;<br>

<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi. This is a feature request.&nbsp;<br>

&gt;&nbsp;<br>

&gt; SQLite can be compiled with unicode support via the ICU library:&nbsp;<br>

&gt;&nbsp;<br>

&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt&#38;nbsp">http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt&#38;nbsp</a></span>;<br>

&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://site.icu-project.org/&#38;nbsp">http://site.icu-project.org/&#38;nbsp</a></span>;<br>

&gt;&nbsp;<br>

&gt; It would be extremely helpful if DBD-SQLite were compatible with this&nbsp;<br>

&gt; extension. I think there is only a minor step missing. Here is what I&nbsp;<br>

&gt; tried.&nbsp;<br>

&gt;&nbsp;<br>

&gt; For ICU support, you configure SQLite 3.6.20 with CFLAGS=-&nbsp;<br>

&gt; DSQLITE_ENABLE_ICU&nbsp;<br>

&gt; and LIBS=-licuio. I tried to see whether DBD-SQLite 1.27 works with&nbsp;<br>

&gt; the ICU&nbsp;<br>

&gt; extension and configured it with&nbsp;<br>

&gt;&nbsp;<br>

&gt; perl Makefile.PL LIBS=&quot;-licuio&quot; CCFLAGS=&quot;-DSQLITE_ENABLE_ICU&quot;&nbsp;<br>

&gt; PREFIX=/usr/local&nbsp;<br>

&gt;&nbsp;<br>

&gt; Compilation works, and the resulting Perl module knows the ICU&nbsp;<br>

&gt; collations, for&nbsp;<br>

&gt; example,&nbsp;<br>

&gt;&nbsp;<br>

&gt; SELECT icu_load_collation('de_DE','custom');&nbsp;<br>

&gt;&nbsp;<br>

&gt; does not give an error. But when you try to use this collation, say,&nbsp;<br>

&gt;&nbsp;<br>

&gt; CREATE TABLE something ( column VARCHAR(20) COLLATE custom );&nbsp;<br>

&gt;&nbsp;<br>

&gt; DBD-SQLite says it does not know the collation:&nbsp;<br>

&gt;&nbsp;<br>

&gt; can't install, unknown collation : custom at&nbsp;<br>

&gt; /usr/local/lib/perl5/site_perl/5.10.0/i586-linux-thread-&nbsp;<br>

&gt; multi/DBD/SQLite.pm&nbsp;<br>

&gt; line 141.&nbsp;<br>

&gt;&nbsp;<br>

&gt; So it seems although the ICU extension is there and the ICU collation&nbsp;<br>

&gt; 'de_DE'&nbsp;<br>

&gt; is known, DBD-SQLite takes control of all requested collations and&nbsp;<br>

&gt; gives an&nbsp;<br>

&gt; error because it does not know about the ICU collation.&nbsp;<br>

&gt;&nbsp;<br>

&gt; I would be most grateful if you could support ICU in a future version.&nbsp;<br>

&gt; I am&nbsp;<br>

&gt; also happy to invest some time and try out patches.&nbsp;<br>

&gt;&nbsp;<br>

&gt; Finally, why might somebody want ICU support? SQLite is only able to&nbsp;<br>

&gt; sort ASCII&nbsp;<br>

&gt; strings. Any accented characters are wrongly sorted and there is no&nbsp;<br>

&gt; unicode or&nbsp;<br>

&gt; locale support whatsoever (SQLite design choice because they want to&nbsp;<br>

&gt; keep their&nbsp;<br>

&gt; library small). Of course, every client is free to add their own&nbsp;<br>

&gt; collations. So&nbsp;<br>

&gt; you added support for Perl 'cmp'. In Qt, it is easy to use their&nbsp;<br>

&gt; unicode&nbsp;<br>

&gt; localized QString comparison, and so on. But as of today, this is done&nbsp;<br>

&gt; differently in each client (SQLite design drawback because there is no&nbsp;<br>

&gt; central&nbsp;<br>

&gt; server). So your database, well, at least your indices, becomes&nbsp;<br>

&gt; inconsistent if&nbsp;<br>

&gt; you access the same database file in different ways, say a Perl DBD-&nbsp;<br>

&gt; SQLite&nbsp;<br>

&gt; script to do some data import, versus a Qt frontend to query the data&nbsp;<br>

&gt; base.&nbsp;<br>

&gt; Since SQLite already have the ICU extension, that one would be the&nbsp;<br>

&gt; natural&nbsp;<br>

&gt; standard for unicode and locale support.&nbsp;<br>

&gt;&nbsp;<br>

&gt; Thanks for your attention and your help.&nbsp;<br>

&gt;&nbsp;<br>

&gt; Bernhard<br>
</div><br>

<br>

<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-713981" href="/Public/Bug/Display.html?id=53235#txn-713981">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;01&nbsp;13:02:36&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-716876" href="/Public/Bug/Display.html?id=53235#txn-716876">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;15:07:42&nbsp;2010</span>
    <span class="description">bch-4439 [...] gmx.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bch-4439 [...] gmx.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/716876/370026/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/370026">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,&lt;br /&gt;
&lt;br /&gt;
thanks for the patch.&lt;br /&gt;
&lt;br /&gt;
I don&#39;t understand enough about the sqlite internals in order to get what the patch does, but I have tried it, and it does not do the job. Here is what happens:&lt;br /&gt;
&lt;br /&gt;
1&#41; there is no error message anymore when I use &#38;quot;COLLATE custom&#38;quot; in my&#38;nbsp; SQL code&lt;br /&gt;
&lt;br /&gt;
2&#41; sorting is nevertheless wrong when I use the perl client - it simply does not follow the &lt;br /&gt;
selected ICU collation.&lt;br /&gt;
&lt;br /&gt;
With &#40;and without&#41; the suggested patch, the unicode characters are transferred correctly from Perl DBD::SQLite into the SQLite3 database, and when I access that database with the ICU extended sqlite3 client and do some &#38;quot;SELECT * from something ORDER BY somecolumn COLLATE custom&#38;quot;, sorting is indeed correct. &lt;br /&gt;
&lt;br /&gt;
So I conclude: The patch avoids the error message, but it breaks the ICU collation.&lt;br /&gt;
&lt;br /&gt;
Please get back to me if you think I am making a mistake.&lt;br /&gt;
&lt;br /&gt;
Regards,&lt;br /&gt;
&lt;br /&gt;
Bernhard&lt;br /&gt;
&lt;br /&gt;
On Fri Jan 01 13:02:35 2010, ISHIGAKI wrote: &lt;br /&gt;
&#38;gt; Hi. I haven&#39;t fully investigated yet, but a quick hack to &lt;br /&gt;
&#38;gt; sqlite3.c seems to work for me, at least for your sample. &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; --- sqlite3.c &#40;revision 10704&#41; &lt;br /&gt;
&#38;gt; +++ sqlite3.c &#40;working copy&#41; &lt;br /&gt;
&#38;gt; @@ -109521,7 +109521,7 @@ &lt;br /&gt;
&#38;gt; } &lt;br /&gt;
&#38;gt; assert&#40;p&#41;; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; - rc = sqlite3_create_collation_v2&#40;db, zName, SQLITE_UTF16, &#40;void &lt;br /&gt;
&#38;gt; *&#41;pUCollator, &lt;br /&gt;
&#38;gt; + rc = sqlite3_create_collation_v2&#40;db, zName, SQLITE_UTF8, &#40;void &lt;br /&gt;
&#38;gt; *&#41;pUCollator, &lt;br /&gt;
&#38;gt; icuCollationColl, icuCollationDel &lt;br /&gt;
&#38;gt; &#41;; &lt;br /&gt;
&#38;gt; if&#40; rc!=SQLITE_OK &#41;{ &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; I don&#39;t think this is the best patch &#40;database encoding &lt;br /&gt;
&#38;gt; should be taken from somewhere, and this is a patch &lt;br /&gt;
&#38;gt; to the amalgamated source, which should be a patch to &lt;br /&gt;
&#38;gt; ext/icu/icu.c&#41;, but anyway, if this works for you, or &lt;br /&gt;
&#38;gt; at least helps you create a better patch, please &lt;br /&gt;
&#38;gt; report this to the sqlite team and ask them to fix. &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; Kenichi &lt;br /&gt;
&lt;br /&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-784268" href="/Public/Bug/Display.html?id=53235#txn-784268">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;30&nbsp;21:44:55&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/784268/406268/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/406268">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi. It turned out that the sqlite library and DBD::SQLite worked fine 
when we removed a too strict collation_needed check &#40;which didn&#39;t take 
it into account for collations to be added by something other than 
DBD::SQLite&#39;s method&#41;. Fixed and added a test in the trunk. Please 
check it if you still have some tuits and time to spare. Thanks.

Kenichi

On 2009-12-30 Wed 12:36:45, bhell wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi. This is a feature request.
&gt; 
&gt; SQLite can be compiled with unicode support via the ICU library:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt">http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://site.icu-project.org/">http://site.icu-project.org/</a></span>
&gt; 
&gt; It would be extremely helpful if DBD-SQLite were compatible with this
&gt; extension. I think there is only a minor step missing. Here is what I
&gt; tried.
&gt; 
&gt; For ICU support, you configure SQLite 3.6.20 with CFLAGS=-
&gt; DSQLITE_ENABLE_ICU
&gt; and LIBS=-licuio. I tried to see whether DBD-SQLite 1.27 works with
&gt; the ICU
&gt; extension and configured it with
&gt; 
&gt; perl Makefile.PL LIBS=&#34;-licuio&#34; CCFLAGS=&#34;-DSQLITE_ENABLE_ICU&#34;
&gt; PREFIX=/usr/local
&gt; 
&gt; Compilation works, and the resulting Perl module knows the ICU
&gt; collations, for
&gt; example,
&gt; 
&gt; SELECT icu_load_collation&#40;&#39;de_DE&#39;,&#39;custom&#39;&#41;;
&gt; 
&gt; does not give an error. But when you try to use this collation, say,
&gt; 
&gt; CREATE TABLE something &#40; column VARCHAR&#40;20&#41; COLLATE custom &#41;;
&gt; 
&gt; DBD-SQLite says it does not know the collation:
&gt; 
&gt; can&#39;t install, unknown collation : custom at
&gt; /usr/local/lib/perl5/site_perl/5.10.0/i586-linux-thread-
&gt; multi/DBD/SQLite.pm
&gt; line 141.
&gt; 
&gt; So it seems although the ICU extension is there and the ICU collation
&gt; &#39;de_DE&#39;
&gt; is known, DBD-SQLite takes control of all requested collations and
&gt; gives an
&gt; error because it does not know about the ICU collation.
&gt; 
&gt; I would be most grateful if you could support ICU in a future version.
&gt; I am
&gt; also happy to invest some time and try out patches.
&gt; 
&gt; Finally, why might somebody want ICU support? SQLite is only able to
&gt; sort ASCII
&gt; strings. Any accented characters are wrongly sorted and there is no
&gt; unicode or
&gt; locale support whatsoever &#40;SQLite design choice because they want to
&gt; keep their
&gt; library small&#41;. Of course, every client is free to add their own
&gt; collations. So
&gt; you added support for Perl &#39;cmp&#39;. In Qt, it is easy to use their
&gt; unicode
&gt; localized QString comparison, and so on. But as of today, this is done
&gt; differently in each client &#40;SQLite design drawback because there is no
&gt; central
&gt; server&#41;. So your database, well, at least your indices, becomes
&gt; inconsistent if
&gt; you access the same database file in different ways, say a Perl DBD-
&gt; SQLite
&gt; script to do some data import, versus a Qt frontend to query the data
&gt; base.
&gt; Since SQLite already have the ICU extension, that one would be the
&gt; natural
&gt; standard for unicode and locale support.
&gt; 
&gt; Thanks for your attention and your help.
&gt; 
&gt; Bernhard
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-784271" href="/Public/Bug/Display.html?id=53235#txn-784271">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;30&nbsp;21:44:56&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-784335" href="/Public/Bug/Display.html?id=53235#txn-784335">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;31&nbsp;01:38:27&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/784335/406303/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/406303">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">FYI, DBD::SQLite 1.30_03 is out. I close this ticket. If you find 
anything, please reopen this. Thanks.

Kenichi 

On 2010-5-30 Sun 21:44:55, ISHIGAKI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi. It turned out that the sqlite library and DBD::SQLite worked fine 
&gt; when we removed a too strict collation_needed check &#40;which didn&#39;t 
</div>take 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; it into account for collations to be added by something other than 
&gt; DBD::SQLite&#39;s method&#41;. Fixed and added a test in the trunk. Please 
&gt; check it if you still have some tuits and time to spare. Thanks.
&gt; 
&gt; Kenichi
&gt; 
&gt; On 2009-12-30 Wed 12:36:45, bhell wrote:
<div class="message-stanza open">&gt; &gt; Hi. This is a feature request.
&gt; &gt; 
&gt; &gt; SQLite can be compiled with unicode support via the ICU library:
&gt; &gt; 
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt">http://www.sqlite.org/cvstrac/fileview?f=sqlite/ext/icu/README.txt</a></span>
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://site.icu-project.org/">http://site.icu-project.org/</a></span>
&gt; &gt; 
&gt; &gt; It would be extremely helpful if DBD-SQLite were compatible with 
</div></div>this
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; extension. I think there is only a minor step missing. Here is what 
</div></div>I
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; tried.
&gt; &gt; 
&gt; &gt; For ICU support, you configure SQLite 3.6.20 with CFLAGS=-
&gt; &gt; DSQLITE_ENABLE_ICU
&gt; &gt; and LIBS=-licuio. I tried to see whether DBD-SQLite 1.27 works with
&gt; &gt; the ICU
&gt; &gt; extension and configured it with
&gt; &gt; 
&gt; &gt; perl Makefile.PL LIBS=&#34;-licuio&#34; CCFLAGS=&#34;-DSQLITE_ENABLE_ICU&#34;
&gt; &gt; PREFIX=/usr/local
&gt; &gt; 
&gt; &gt; Compilation works, and the resulting Perl module knows the ICU
&gt; &gt; collations, for
&gt; &gt; example,
&gt; &gt; 
&gt; &gt; SELECT icu_load_collation&#40;&#39;de_DE&#39;,&#39;custom&#39;&#41;;
&gt; &gt; 
&gt; &gt; does not give an error. But when you try to use this collation, say,
&gt; &gt; 
&gt; &gt; CREATE TABLE something &#40; column VARCHAR&#40;20&#41; COLLATE custom &#41;;
&gt; &gt; 
&gt; &gt; DBD-SQLite says it does not know the collation:
&gt; &gt; 
&gt; &gt; can&#39;t install, unknown collation : custom at
&gt; &gt; /usr/local/lib/perl5/site_perl/5.10.0/i586-linux-thread-
&gt; &gt; multi/DBD/SQLite.pm
&gt; &gt; line 141.
&gt; &gt; 
&gt; &gt; So it seems although the ICU extension is there and the ICU 
</div></div>collation
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &#39;de_DE&#39;
&gt; &gt; is known, DBD-SQLite takes control of all requested collations and
&gt; &gt; gives an
&gt; &gt; error because it does not know about the ICU collation.
&gt; &gt; 
&gt; &gt; I would be most grateful if you could support ICU in a future 
</div></div>version.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I am
&gt; &gt; also happy to invest some time and try out patches.
&gt; &gt; 
&gt; &gt; Finally, why might somebody want ICU support? SQLite is only able to
&gt; &gt; sort ASCII
&gt; &gt; strings. Any accented characters are wrongly sorted and there is no
&gt; &gt; unicode or
&gt; &gt; locale support whatsoever &#40;SQLite design choice because they want to
&gt; &gt; keep their
&gt; &gt; library small&#41;. Of course, every client is free to add their own
&gt; &gt; collations. So
&gt; &gt; you added support for Perl &#39;cmp&#39;. In Qt, it is easy to use their
&gt; &gt; unicode
&gt; &gt; localized QString comparison, and so on. But as of today, this is 
</div></div>done
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; differently in each client &#40;SQLite design drawback because there is 
</div></div>no
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; central
&gt; &gt; server&#41;. So your database, well, at least your indices, becomes
&gt; &gt; inconsistent if
&gt; &gt; you access the same database file in different ways, say a Perl DBD-
&gt; &gt; SQLite
&gt; &gt; script to do some data import, versus a Qt frontend to query the 
</div></div>data
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; base.
&gt; &gt; Since SQLite already have the ICU extension, that one would be the
&gt; &gt; natural
&gt; &gt; standard for unicode and locale support.
&gt; &gt; 
&gt; &gt; Thanks for your attention and your help.
&gt; &gt; 
&gt; &gt; Bernhard
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-784338" href="/Public/Bug/Display.html?id=53235#txn-784338">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;31&nbsp;01:38:28&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-784339" href="/Public/Bug/Display.html?id=53235#txn-784339">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;31&nbsp;01:38:28&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.490763</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
