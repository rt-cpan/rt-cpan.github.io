<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #81575 for Net-SSLeay: 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #81575 for Net-SSLeay: 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">81575</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">30 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SSLeay/Active/">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MIKEM [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
BOLDRA [...] boldra.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
OLIVER [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.49    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;30&nbsp;07:13:11&nbsp;2012</span>
    <span class="description">BOLDRA [...] boldra.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">t/local/04_basic.t calls Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41; &#40;via
Test::Exception, but this is not the cause&#41;,
Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41; does not return.  

openssl version:
OpenSSL 0.9.8j-fips 07 Jan 2009
&#40;on a very similar host with 0.9.8h the problem is not present&#41;

uname -a:
Linux ivml2171 3.0.42-0.7-default #1 SMP Tue Oct 9 11:58:45 UTC 2012
&#40;a8dc443&#41; x86_64 x86_64 x86_64 GNU/Linux

perl -V:
Summary of my perl5 &#40;revision 5 version 16 subversion 2&#41; configuration:

  Platform:
    osname=linux, osvers=3.0.42-0.7-default,
archname=x86_64-linux-thread-multi
    uname=&#39;linux ivml2171 3.0.42-0.7-default #1 smp tue oct 9 11:58:45
utc 2012 &#40;a8dc443&#41; x86_64 x86_64 x86_64 gnulinux &#39;
    config_args=&#39;-d -Dusethreads&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=define, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing
-pipe -fstack-protector -I/usr/local/include -D_LARGEFILE_SOURCE
-D_FILE_OFFSET_BITS=64&#39;,
    optimize=&#39;-O2&#39;,
    cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe
-fstack-protector -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.3.4 [gcc-4_3-branch revision 152973]&#39;,
gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39; -fstack-protector -L/usr/local/lib&#39;
    libpth=/usr/local/lib /lib/../lib64 /usr/lib/../lib64 /lib /usr/lib
/lib64 /usr/lib64 /usr/local/lib64
    libs=-lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc
-lgdbm_compat
    perllibs=-lnsl -ldl -lm -lcrypt -lutil -lpthread -lc
    libc=/lib/libc-2.11.3.so, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;2.11.3&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E&#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -L/usr/local/lib
-fstack-protector&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options: HAS_TIMES MULTIPLICITY PERLIO_LAYERS
                        PERL_DONT_CREATE_GVSV PERL_IMPLICIT_CONTEXT
                        PERL_MALLOC_WRAP PERL_PRESERVE_IVUV USE_64_BIT_ALL
                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
                        USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE
                        USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF
                        USE_REENTRANT_API
  Built under linux
  Compiled at Nov 23 2012 11:36:38
  @INC:
    /usr/local/lib/perl5/site_perl/5.16.2/x86_64-linux-thread-multi
    /usr/local/lib/perl5/site_perl/5.16.2
    /usr/local/lib/perl5/5.16.2/x86_64-linux-thread-multi
    /usr/local/lib/perl5/5.16.2
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;30&nbsp;07:43:04&nbsp;2012</span>
    <span class="description">BOLDRA [...] boldra.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; openssl version:
&gt; OpenSSL 0.9.8j-fips 07 Jan 2009
&gt; &#40;on a very similar host with 0.9.8h the problem is not present&#41;
</div>
I just noticed that the second host doesn&#39;t have Test::Exception
installed, so the tests weren&#39;t run.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;30&nbsp;07:43:13&nbsp;2012</span>
    <span class="description">BOLDRA [...] boldra.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;01&nbsp;18:02:05&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81575] 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 02 Dec 2012 09:01:45 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,


Hmmm, if Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41; does not return, I suspect 
it is hanging in SSL_library_init, which would indicate a problem with the  
underlying openssl library. I notice it is a FIPS enabled openssl you are 
using?

You can check by running the test under the gdb debugger, waiting for it to 
hang and then getting a stack backtrace. That will help me to understand the 
problem.

Cheers.



On Friday, November 30, 2012 07:13:13 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Nov 30 07:13:11 2012: Request 81575 was acted upon.
&gt; Transaction: Ticket created by BOLDRA
&gt;        Queue: Net-SSLeay
&gt;      Subject: 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl
&gt; 5.16.2&#41; Broken in: 1.49
&gt;     Severity: Important
&gt;        Owner: Nobody
&gt;   Requestors: BOLDRA@boldra.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; 
&gt; 
&gt; t/local/04_basic.t calls Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41; &#40;via
&gt; Test::Exception, but this is not the cause&#41;,
&gt; Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41; does not return.
&gt; 
&gt; openssl version:
&gt; OpenSSL 0.9.8j-fips 07 Jan 2009
&gt; &#40;on a very similar host with 0.9.8h the problem is not present&#41;
&gt; 
&gt; uname -a:
&gt; Linux ivml2171 3.0.42-0.7-default #1 SMP Tue Oct 9 11:58:45 UTC 2012
&gt; &#40;a8dc443&#41; x86_64 x86_64 x86_64 GNU/Linux
&gt; 
&gt; perl -V:
&gt; Summary of my perl5 &#40;revision 5 version 16 subversion 2&#41; configuration:
&gt; 
&gt;   Platform:
&gt;     osname=linux, osvers=3.0.42-0.7-default,
&gt; archname=x86_64-linux-thread-multi
&gt;     uname=&#39;linux ivml2171 3.0.42-0.7-default #1 smp tue oct 9 11:58:45
&gt; utc 2012 &#40;a8dc443&#41; x86_64 x86_64 x86_64 gnulinux &#39;
&gt;     config_args=&#39;-d -Dusethreads&#39;
&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;     useithreads=define, usemultiplicity=define
&gt;     useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
&gt;     use64bitint=define, use64bitall=define, uselongdouble=undef
&gt;     usemymalloc=n, bincompat5005=undef
&gt;   Compiler:
&gt;     cc=&#39;cc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing
&gt; -pipe -fstack-protector -I/usr/local/include -D_LARGEFILE_SOURCE
&gt; -D_FILE_OFFSET_BITS=64&#39;,
&gt;     optimize=&#39;-O2&#39;,
&gt;     cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe
&gt; -fstack-protector -I/usr/local/include&#39;
&gt;     ccversion=&#39;&#39;, gccversion=&#39;4.3.4 [gcc-4_3-branch revision 152973]&#39;,
&gt; gccosandvers=&#39;&#39;
&gt;     intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
&gt;     d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
&gt;     ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
&gt; lseeksize=8
&gt;     alignbytes=8, prototype=define
&gt;   Linker and Libraries:
&gt;     ld=&#39;cc&#39;, ldflags =&#39; -fstack-protector -L/usr/local/lib&#39;
&gt;     libpth=/usr/local/lib /lib/../lib64 /usr/lib/../lib64 /lib /usr/lib
&gt; /lib64 /usr/lib64 /usr/local/lib64
&gt;     libs=-lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc
&gt; -lgdbm_compat
&gt;     perllibs=-lnsl -ldl -lm -lcrypt -lutil -lpthread -lc
&gt;     libc=/lib/libc-2.11.3.so, so=so, useshrplib=false, libperl=libperl.a
&gt;     gnulibc_version=&#39;2.11.3&#39;
&gt;   Dynamic Linking:
&gt;     dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E&#39;
&gt;     cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -L/usr/local/lib
&gt; -fstack-protector&#39;
&gt; 
&gt; 
&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;   Compile-time options: HAS_TIMES MULTIPLICITY PERLIO_LAYERS
&gt;                         PERL_DONT_CREATE_GVSV PERL_IMPLICIT_CONTEXT
&gt;                         PERL_MALLOC_WRAP PERL_PRESERVE_IVUV USE_64_BIT_ALL
&gt;                         USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
&gt;                         USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE
&gt;                         USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF
&gt;                         USE_REENTRANT_API
&gt;   Built under linux
&gt;   Compiled at Nov 23 2012 11:36:38
&gt;   @INC:
&gt;     /usr/local/lib/perl5/site_perl/5.16.2/x86_64-linux-thread-multi
&gt;     /usr/local/lib/perl5/site_perl/5.16.2
&gt;     /usr/local/lib/perl5/5.16.2/x86_64-linux-thread-multi
&gt;     /usr/local/lib/perl5/5.16.2
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;04&nbsp;10:38:27&nbsp;2012</span>
    <span class="description">BOLDRA [...] boldra.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mike,

Thanks for your fast answer - I&#39;ve been putting off replying because I&#39;m
so unfamiliar with gdb, but it was easier than I expected.

&#40;gdb&#41; backtrace
#0  0x00007f2e162e9294 in __lll_lock_wait &#40;&#41; from /lib64/libpthread.so.0
#1  0x00007f2e162e4619 in _L_lock_1008 &#40;&#41; from /lib64/libpthread.so.0
#2  0x00007f2e162e442e in pthread_mutex_lock &#40;&#41; from /lib64/libpthread.so.0
#3  0x00007f2e15b36505 in openssl_locking_function &#40;mode=&lt;optimized
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">out&gt;, type=&lt;optimized out&gt;, file=0x0, line=-1&#41; at SSLeay.xs:253
</div>#4  0x00007f2e1560806e in ?? &#40;&#41; from /usr/lib64/libcrypto.so.0.9.8
#5  0x00007f2e156084a7 in FIPS_mode_set &#40;&#41; from
/usr/lib64/libcrypto.so.0.9.8
#6  0x00007f2e155d5ea9 in OPENSSL_init &#40;&#41; from /usr/lib64/libcrypto.so.0.9.8
#7  0x00007f2e158e3d99 in SSL_library_init &#40;&#41; from
/usr/lib64/libssl.so.0.9.8
#8  0x00007f2e15b36475 in XS_Net__SSLeay_library_init
&#40;my_perl=&lt;optimized out&gt;, cv=&lt;optimized out&gt;&#41; at SSLeay.xs:1737
#9  0x00000000004a7315 in Perl_pp_entersub &#40;&#41;
#10 0x00000000004a5896 in Perl_runops_standard &#40;&#41;
#11 0x0000000000436dee in perl_run &#40;&#41;
#12 0x000000000041d78c in main &#40;&#41;

I hope there&#39;s something useful for you in there!

Thanks for your help.

On Sat Dec 01 18:02:05 2012, mikem@open.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; 
&gt; Hmmm, if Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41; does not return, I
&gt; suspect
&gt; it is hanging in SSL_library_init, which would indicate a problem with
&gt; the
&gt; underlying openssl library. I notice it is a FIPS enabled openssl you
&gt; are
&gt; using?
&gt; 
&gt; You can check by running the test under the gdb debugger, waiting for
&gt; it to
&gt; hang and then getting a stack backtrace. That will help me to
&gt; understand the
&gt; problem.
&gt; 
&gt; Cheers.
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;05&nbsp;16:25:10&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81575] 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 06 Dec 2012 07:24:51 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Paul,

thanks for the trace.
It seems to tell me that you do not have a recent openssl/fips, though I am not 
100% sure.

Can you tell me how you acquired the openssl+fips library and headers? 
Was it a distro package, or did you build it yourself?
What versions of openssl and fips did you use?
Precisely how did you build it &#40;detailed instructions please&#41;?

Cheers.



On Tuesday, December 04, 2012 10:38:29 AM Paul Boldra via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; 
&gt; Hi Mike,
&gt; 
&gt; Thanks for your fast answer - I&#39;ve been putting off replying because I&#39;m
&gt; so unfamiliar with gdb, but it was easier than I expected.
&gt; 
&gt; &#40;gdb&#41; backtrace
&gt; #0  0x00007f2e162e9294 in __lll_lock_wait &#40;&#41; from /lib64/libpthread.so.0
&gt; #1  0x00007f2e162e4619 in _L_lock_1008 &#40;&#41; from /lib64/libpthread.so.0
&gt; #2  0x00007f2e162e442e in pthread_mutex_lock &#40;&#41; from /lib64/libpthread.so.0
&gt; #3  0x00007f2e15b36505 in openssl_locking_function &#40;mode=&lt;optimized
<div class="message-stanza open">&gt; out&gt;, type=&lt;optimized out&gt;, file=0x0, line=-1&#41; at SSLeay.xs:253
</div>&gt; #4  0x00007f2e1560806e in ?? &#40;&#41; from /usr/lib64/libcrypto.so.0.9.8
&gt; #5  0x00007f2e156084a7 in FIPS_mode_set &#40;&#41; from
&gt; /usr/lib64/libcrypto.so.0.9.8
&gt; #6  0x00007f2e155d5ea9 in OPENSSL_init &#40;&#41; from /usr/lib64/libcrypto.so.0.9.8
&gt; #7  0x00007f2e158e3d99 in SSL_library_init &#40;&#41; from
&gt; /usr/lib64/libssl.so.0.9.8
&gt; #8  0x00007f2e15b36475 in XS_Net__SSLeay_library_init
&gt; &#40;my_perl=&lt;optimized out&gt;, cv=&lt;optimized out&gt;&#41; at SSLeay.xs:1737
&gt; #9  0x00000000004a7315 in Perl_pp_entersub &#40;&#41;
&gt; #10 0x00000000004a5896 in Perl_runops_standard &#40;&#41;
&gt; #11 0x0000000000436dee in perl_run &#40;&#41;
&gt; #12 0x000000000041d78c in main &#40;&#41;
&gt; 
&gt; I hope there&#39;s something useful for you in there!
&gt; 
&gt; Thanks for your help.
&gt; 
&gt; On Sat Dec 01 18:02:05 2012, mikem@open.com.au wrote:
<div class="message-stanza open">&gt; &gt; Hello,
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Hmmm, if Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41; does not return, I
&gt; &gt; suspect
&gt; &gt; it is hanging in SSL_library_init, which would indicate a problem with
&gt; &gt; the
&gt; &gt; underlying openssl library. I notice it is a FIPS enabled openssl you
&gt; &gt; are
&gt; &gt; using?
&gt; &gt; 
&gt; &gt; You can check by running the test under the gdb debugger, waiting for
&gt; &gt; it to
&gt; &gt; hang and then getting a stack backtrace. That will help me to
&gt; &gt; understand the
&gt; &gt; problem.
&gt; &gt; 
&gt; &gt; Cheers.
</div></div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;06:24:07&nbsp;2012</span>
    <span class="description">BOLDRA [...] boldra.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mike,

thanks again for your patience with this.  This is SLES 11 - I didn&#39;t
build any of the openssl packages myself.  Yast tells me the openssl is
current, and it includes a changelog up to July this year, but not
detailled compilation options.

Version: 0.9.8j-0.44.1
Build Time: Tue Jul 10 13:32:41 2012
Packager: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.opensuse.org">http://bugs.opensuse.org</a></span>
Architecture: x86_64
Build Host:
URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.openssl.org/">http://www.openssl.org/</a></span>
Source Package: openssl-0.9.8j-0.44.1

FIPS is a bit more of a mystery.  Yast tells me there&#39;s no &#34;FIPS&#34;
installed, but I found /usr/share/doc/packages/openssl/README-FIPS.txt
which says:

Dear user of the SUSE Linux Enterprise Server,

SLES11-SP1 comes with openssl of version 0.9.8j, a version upgrade from
0.9.8h that came with earlier revisions of SLES11.

The new version has support for FIPS-140-2 mode of operation.
FIPS is short for Federal Information Processing Standard.
For more information on FIPS-140-2, please see
<span class="clickylink"><a target="new" rel="nofollow" href="http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf">http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf</a></span>
and more publications on the NIST website.

The openssl shared libraries are used by numerous packages in the
SUSE Linux Enterprise Server. If the library runs in FIPS-140-2 mode,
then the binary that links against the library at runtime makes use
of FIPS-140-2 validated cryptography as defined in its cryptographic
module. By consequence, a large number of packages can make a claim
about using FIPS-140-2 validated cryptographical functions.

Both the 64bit and the 32bit shared libraries are supported in FIPS-140-2
mode of operation.
Both in 64bit and in 32bit mode, the AES-NI assembler optimizations are
supported and used, if the used CPU supports the AES-NI instructions. These
assembler optimizations can deliver a substantial performance benefit.
To check if your system&#39;s CPU&#40;s&#41; has &#40;have&#41; AES-NI support, have a look
into the Linux kernel&#39;s /proc file /proc/cpuinfo - search it for the &#34;aes&#34;
flag.
AES-NI support can be disabled by setting the environment variable
OPENSSL_DISABLE_AESNI before running binaries that link against openssl.
The &#34;openssl speed&#34; command can give you an idea for the performance
differences.


The cryptographic module as defined for FIPS-140-2 is contained in the files
   /usr/lib64/.libcrypto.so.0.9.8.hmac
   /usr/lib64/.libssl.so.0.9.8.hmac
   /usr/lib64/libcrypto.so.0.9.8
   /usr/lib64/libssl.so.0.9.8
for 64bit operation and
   /usr/lib/.libcrypto.so.0.9.8.hmac
   /usr/lib/.libssl.so.0.9.8.hmac
   /usr/lib/libcrypto.so.0.9.8
   /usr/lib/libssl.so.0.9.8

&#40;snip&#41;
--------------------------------------------------------------------

I thought I might find some more in /etc/ssl/openssl.cnf, but &#34;ack fips
/etc/ssl&#34; turns up nothing.  Hopefully this is enough to reproduce the
problem.

thanks very much for your efforts!

Paul Boldra
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;19:27:23&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81575] 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 Dec 2012 10:27:05 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi again,

thanks for this info,
We are investigating now.

Looks to me like your openssl is getting started in FIPS mode. According to  
the rest of README-FIPS.txt,this should only happen if the environemnt 
variable OPENSSL_FORCE_FIPS_MODE is set to 1. Can you confirm this is the case 
for you?

Otherwise I would expect openssl &#40;and therfore the make test&#41; to *not* run in 
FIPS mode.

Cheers.


On Thursday, December 06, 2012 06:24:09 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; 
&gt; Hi Mike,
&gt; 
&gt; thanks again for your patience with this.  This is SLES 11 - I didn&#39;t
&gt; build any of the openssl packages myself.  Yast tells me the openssl is
&gt; current, and it includes a changelog up to July this year, but not
&gt; detailled compilation options.
&gt; 
&gt; Version: 0.9.8j-0.44.1
&gt; Build Time: Tue Jul 10 13:32:41 2012
&gt; Packager: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.opensuse.org">http://bugs.opensuse.org</a></span>
&gt; Architecture: x86_64
&gt; Build Host:
&gt; URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.openssl.org/">http://www.openssl.org/</a></span>
&gt; Source Package: openssl-0.9.8j-0.44.1
&gt; 
&gt; FIPS is a bit more of a mystery.  Yast tells me there&#39;s no &#34;FIPS&#34;
&gt; installed, but I found /usr/share/doc/packages/openssl/README-FIPS.txt
&gt; which says:
&gt; 
&gt; Dear user of the SUSE Linux Enterprise Server,
&gt; 
&gt; SLES11-SP1 comes with openssl of version 0.9.8j, a version upgrade from
&gt; 0.9.8h that came with earlier revisions of SLES11.
&gt; 
&gt; The new version has support for FIPS-140-2 mode of operation.
&gt; FIPS is short for Federal Information Processing Standard.
&gt; For more information on FIPS-140-2, please see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf">http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf</a></span>
&gt; and more publications on the NIST website.
&gt; 
&gt; The openssl shared libraries are used by numerous packages in the
&gt; SUSE Linux Enterprise Server. If the library runs in FIPS-140-2 mode,
&gt; then the binary that links against the library at runtime makes use
&gt; of FIPS-140-2 validated cryptography as defined in its cryptographic
&gt; module. By consequence, a large number of packages can make a claim
&gt; about using FIPS-140-2 validated cryptographical functions.
&gt; 
&gt; Both the 64bit and the 32bit shared libraries are supported in FIPS-140-2
&gt; mode of operation.
&gt; Both in 64bit and in 32bit mode, the AES-NI assembler optimizations are
&gt; supported and used, if the used CPU supports the AES-NI instructions. These
&gt; assembler optimizations can deliver a substantial performance benefit.
&gt; To check if your system&#39;s CPU&#40;s&#41; has &#40;have&#41; AES-NI support, have a look
&gt; into the Linux kernel&#39;s /proc file /proc/cpuinfo - search it for the &#34;aes&#34;
&gt; flag.
&gt; AES-NI support can be disabled by setting the environment variable
&gt; OPENSSL_DISABLE_AESNI before running binaries that link against openssl.
&gt; The &#34;openssl speed&#34; command can give you an idea for the performance
&gt; differences.
&gt; 
&gt; 
&gt; The cryptographic module as defined for FIPS-140-2 is contained in the files
&gt; /usr/lib64/.libcrypto.so.0.9.8.hmac
&gt;    /usr/lib64/.libssl.so.0.9.8.hmac
&gt;    /usr/lib64/libcrypto.so.0.9.8
&gt;    /usr/lib64/libssl.so.0.9.8
&gt; for 64bit operation and
&gt;    /usr/lib/.libcrypto.so.0.9.8.hmac
&gt;    /usr/lib/.libssl.so.0.9.8.hmac
&gt;    /usr/lib/libcrypto.so.0.9.8
&gt;    /usr/lib/libssl.so.0.9.8
&gt; 
&gt; &#40;snip&#41;
&gt; --------------------------------------------------------------------
&gt; 
&gt; I thought I might find some more in /etc/ssl/openssl.cnf, but &#34;ack fips
&gt; /etc/ssl&#34; turns up nothing.  Hopefully this is enough to reproduce the
&gt; problem.
&gt; 
&gt; thanks very much for your efforts!
&gt; 
&gt; Paul Boldra
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;22:17:53&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81575] 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 Dec 2012 13:17:35 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi again,

we have been able to reproduce this problem by building openssl-fips-1.2 and 
openssl-0.9.8j by hand here, then running net-ssleay against it and adding 
FIPS_mode_set&#40;1&#41; to the test suites.

The problem is caused by a bug in openssl-0.9.8j that only appears when 
external locking functions are used &#40;net-ssleay implements external openssl 
locking functions in terms of mutexes&#41;

Details:

FIPS_mode_set&#40;&#41;
calls
fips_w_lock&#40;&#41;;
to set a write lock on lock number 39 &#40;CRYPTO_LOCK_FIPS&#41;
and it holds that write lock while it does its work.

then it calls 

if&#40;FIPS_mode&#40;&#41;&#41;
   .....

but FIPS_mode&#40;&#41;
calls fips_r_lock&#40;&#41;;
to set a read lock on the same lock number 39 &#40;CRYPTO_LOCK_FIPS&#41;
before it does its work.

but of course this read lock is never granted due to a deadlock with the 
previously granted write lock.

This problem does not normally appear in FIPS enabled openssl 0.9.8j, since 
the default built-in internal locking in openssl is a no-op


As for what to do now:

I think the only answer is to upgrade to a later openssl-fips.

Cheers.



On Thursday, December 06, 2012 07:27:25 PM mikem@open.com.au via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; 
&gt; Hi again,
&gt; 
&gt; thanks for this info,
&gt; We are investigating now.
&gt; 
&gt; Looks to me like your openssl is getting started in FIPS mode. According to
&gt; the rest of README-FIPS.txt,this should only happen if the environemnt
&gt; variable OPENSSL_FORCE_FIPS_MODE is set to 1. Can you confirm this is the
&gt; case for you?
&gt; 
&gt; Otherwise I would expect openssl &#40;and therfore the make test&#41; to *not* run
&gt; in FIPS mode.
&gt; 
&gt; Cheers.
&gt; 
&gt; On Thursday, December 06, 2012 06:24:09 AM you wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Net-SSLeay
&gt; &gt;  
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; &gt; 
&gt; &gt; Hi Mike,
&gt; &gt; 
&gt; &gt; thanks again for your patience with this.  This is SLES 11 - I didn&#39;t
&gt; &gt; build any of the openssl packages myself.  Yast tells me the openssl is
&gt; &gt; current, and it includes a changelog up to July this year, but not
&gt; &gt; detailled compilation options.
&gt; &gt; 
&gt; &gt; Version: 0.9.8j-0.44.1
&gt; &gt; Build Time: Tue Jul 10 13:32:41 2012
&gt; &gt; Packager: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.opensuse.org">http://bugs.opensuse.org</a></span>
&gt; &gt; Architecture: x86_64
&gt; &gt; Build Host:
&gt; &gt; URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.openssl.org/">http://www.openssl.org/</a></span>
&gt; &gt; Source Package: openssl-0.9.8j-0.44.1
&gt; &gt; 
&gt; &gt; FIPS is a bit more of a mystery.  Yast tells me there&#39;s no &#34;FIPS&#34;
&gt; &gt; installed, but I found /usr/share/doc/packages/openssl/README-FIPS.txt
&gt; &gt; which says:
&gt; &gt; 
&gt; &gt; Dear user of the SUSE Linux Enterprise Server,
&gt; &gt; 
&gt; &gt; SLES11-SP1 comes with openssl of version 0.9.8j, a version upgrade from
&gt; &gt; 0.9.8h that came with earlier revisions of SLES11.
&gt; &gt; 
&gt; &gt; The new version has support for FIPS-140-2 mode of operation.
&gt; &gt; FIPS is short for Federal Information Processing Standard.
&gt; &gt; For more information on FIPS-140-2, please see
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf">http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf</a></span>
&gt; &gt; and more publications on the NIST website.
&gt; &gt; 
&gt; &gt; The openssl shared libraries are used by numerous packages in the
&gt; &gt; SUSE Linux Enterprise Server. If the library runs in FIPS-140-2 mode,
&gt; &gt; then the binary that links against the library at runtime makes use
&gt; &gt; of FIPS-140-2 validated cryptography as defined in its cryptographic
&gt; &gt; module. By consequence, a large number of packages can make a claim
&gt; &gt; about using FIPS-140-2 validated cryptographical functions.
&gt; &gt; 
&gt; &gt; Both the 64bit and the 32bit shared libraries are supported in FIPS-140-2
&gt; &gt; mode of operation.
&gt; &gt; Both in 64bit and in 32bit mode, the AES-NI assembler optimizations are
&gt; &gt; supported and used, if the used CPU supports the AES-NI instructions.
&gt; &gt; These
&gt; &gt; assembler optimizations can deliver a substantial performance benefit.
&gt; &gt; To check if your system&#39;s CPU&#40;s&#41; has &#40;have&#41; AES-NI support, have a look
&gt; &gt; into the Linux kernel&#39;s /proc file /proc/cpuinfo - search it for the &#34;aes&#34;
&gt; &gt; flag.
&gt; &gt; AES-NI support can be disabled by setting the environment variable
&gt; &gt; OPENSSL_DISABLE_AESNI before running binaries that link against openssl.
&gt; &gt; The &#34;openssl speed&#34; command can give you an idea for the performance
&gt; &gt; differences.
&gt; &gt; 
&gt; &gt; 
&gt; &gt; The cryptographic module as defined for FIPS-140-2 is contained in the
&gt; &gt; files /usr/lib64/.libcrypto.so.0.9.8.hmac
&gt; &gt; 
&gt; &gt;    /usr/lib64/.libssl.so.0.9.8.hmac
&gt; &gt;    /usr/lib64/libcrypto.so.0.9.8
&gt; &gt;    /usr/lib64/libssl.so.0.9.8
&gt; &gt; 
&gt; &gt; for 64bit operation and
&gt; &gt; 
&gt; &gt;    /usr/lib/.libcrypto.so.0.9.8.hmac
&gt; &gt;    /usr/lib/.libssl.so.0.9.8.hmac
&gt; &gt;    /usr/lib/libcrypto.so.0.9.8
&gt; &gt;    /usr/lib/libssl.so.0.9.8
&gt; &gt; 
&gt; &gt; &#40;snip&#41;
&gt; &gt; --------------------------------------------------------------------
&gt; &gt; 
&gt; &gt; I thought I might find some more in /etc/ssl/openssl.cnf, but &#34;ack fips
&gt; &gt; /etc/ssl&#34; turns up nothing.  Hopefully this is enough to reproduce the
&gt; &gt; problem.
&gt; &gt; 
&gt; &gt; thanks very much for your efforts!
&gt; &gt; 
&gt; &gt; Paul Boldra
</div></div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;22:45:55&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81575] 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 Dec 2012 13:45:36 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi again,

On Friday, December 07, 2012 01:17:35 PM Mike McCauley wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi again,
&gt; 
&gt; we have been able to reproduce this problem by building openssl-fips-1.2 and
&gt; openssl-0.9.8j by hand here, then running net-ssleay against it and adding
&gt; FIPS_mode_set&#40;1&#41; to the test suites.
&gt; 
&gt; The problem is caused by a bug in openssl-0.9.8j that only appears when
&gt; external locking functions are used &#40;net-ssleay implements external openssl
&gt; locking functions in terms of mutexes&#41;
&gt; 
&gt; Details:
&gt; 
&gt; FIPS_mode_set&#40;&#41;
&gt; calls
&gt; fips_w_lock&#40;&#41;;
&gt; to set a write lock on lock number 39 &#40;CRYPTO_LOCK_FIPS&#41;
&gt; and it holds that write lock while it does its work.
&gt; 
&gt; then it calls
&gt; 
&gt; if&#40;FIPS_mode&#40;&#41;&#41;
&gt;    .....
&gt; 
&gt; but FIPS_mode&#40;&#41;
&gt; calls fips_r_lock&#40;&#41;;
&gt; to set a read lock on the same lock number 39 &#40;CRYPTO_LOCK_FIPS&#41;
&gt; before it does its work.
&gt; 
&gt; but of course this read lock is never granted due to a deadlock with the
&gt; previously granted write lock.
&gt; 
&gt; This problem does not normally appear in FIPS enabled openssl 0.9.8j, since
&gt; the default built-in internal locking in openssl is a no-op
&gt; 
&gt; 
&gt; As for what to do now:
&gt; 
&gt; I think the only answer is to upgrade to a later openssl-fips.
</div>
or disable FIPS mode when you run net-ssleay.

Cheers.



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Cheers.
&gt; 
&gt; On Thursday, December 06, 2012 07:27:25 PM mikem@open.com.au via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Net-SSLeay
&gt; &gt;  
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; &gt; 
&gt; &gt; Hi again,
&gt; &gt; 
&gt; &gt; thanks for this info,
&gt; &gt; We are investigating now.
&gt; &gt; 
&gt; &gt; Looks to me like your openssl is getting started in FIPS mode. According
&gt; &gt; to
&gt; &gt; the rest of README-FIPS.txt,this should only happen if the environemnt
&gt; &gt; variable OPENSSL_FORCE_FIPS_MODE is set to 1. Can you confirm this is the
&gt; &gt; case for you?
&gt; &gt; 
&gt; &gt; Otherwise I would expect openssl &#40;and therfore the make test&#41; to *not* run
&gt; &gt; in FIPS mode.
&gt; &gt; 
&gt; &gt; Cheers.
&gt; &gt; 
&gt; &gt; On Thursday, December 06, 2012 06:24:09 AM you wrote:
<div class="message-stanza open">&gt; &gt; &gt;        Queue: Net-SSLeay
&gt; &gt; &gt;  
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; Hi Mike,
&gt; &gt; &gt; 
&gt; &gt; &gt; thanks again for your patience with this.  This is SLES 11 - I didn&#39;t
&gt; &gt; &gt; build any of the openssl packages myself.  Yast tells me the openssl is
&gt; &gt; &gt; current, and it includes a changelog up to July this year, but not
&gt; &gt; &gt; detailled compilation options.
&gt; &gt; &gt; 
&gt; &gt; &gt; Version: 0.9.8j-0.44.1
&gt; &gt; &gt; Build Time: Tue Jul 10 13:32:41 2012
&gt; &gt; &gt; Packager: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.opensuse.org">http://bugs.opensuse.org</a></span>
&gt; &gt; &gt; Architecture: x86_64
&gt; &gt; &gt; Build Host:
&gt; &gt; &gt; URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.openssl.org/">http://www.openssl.org/</a></span>
&gt; &gt; &gt; Source Package: openssl-0.9.8j-0.44.1
&gt; &gt; &gt; 
&gt; &gt; &gt; FIPS is a bit more of a mystery.  Yast tells me there&#39;s no &#34;FIPS&#34;
&gt; &gt; &gt; installed, but I found /usr/share/doc/packages/openssl/README-FIPS.txt
&gt; &gt; &gt; which says:
&gt; &gt; &gt; 
&gt; &gt; &gt; Dear user of the SUSE Linux Enterprise Server,
&gt; &gt; &gt; 
&gt; &gt; &gt; SLES11-SP1 comes with openssl of version 0.9.8j, a version upgrade from
&gt; &gt; &gt; 0.9.8h that came with earlier revisions of SLES11.
&gt; &gt; &gt; 
&gt; &gt; &gt; The new version has support for FIPS-140-2 mode of operation.
&gt; &gt; &gt; FIPS is short for Federal Information Processing Standard.
&gt; &gt; &gt; For more information on FIPS-140-2, please see
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf">http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf</a></span>
&gt; &gt; &gt; and more publications on the NIST website.
&gt; &gt; &gt; 
&gt; &gt; &gt; The openssl shared libraries are used by numerous packages in the
&gt; &gt; &gt; SUSE Linux Enterprise Server. If the library runs in FIPS-140-2 mode,
&gt; &gt; &gt; then the binary that links against the library at runtime makes use
&gt; &gt; &gt; of FIPS-140-2 validated cryptography as defined in its cryptographic
&gt; &gt; &gt; module. By consequence, a large number of packages can make a claim
&gt; &gt; &gt; about using FIPS-140-2 validated cryptographical functions.
&gt; &gt; &gt; 
&gt; &gt; &gt; Both the 64bit and the 32bit shared libraries are supported in
&gt; &gt; &gt; FIPS-140-2
&gt; &gt; &gt; mode of operation.
&gt; &gt; &gt; Both in 64bit and in 32bit mode, the AES-NI assembler optimizations are
&gt; &gt; &gt; supported and used, if the used CPU supports the AES-NI instructions.
&gt; &gt; &gt; These
&gt; &gt; &gt; assembler optimizations can deliver a substantial performance benefit.
&gt; &gt; &gt; To check if your system&#39;s CPU&#40;s&#41; has &#40;have&#41; AES-NI support, have a look
&gt; &gt; &gt; into the Linux kernel&#39;s /proc file /proc/cpuinfo - search it for the
&gt; &gt; &gt; &#34;aes&#34;
&gt; &gt; &gt; flag.
&gt; &gt; &gt; AES-NI support can be disabled by setting the environment variable
&gt; &gt; &gt; OPENSSL_DISABLE_AESNI before running binaries that link against openssl.
&gt; &gt; &gt; The &#34;openssl speed&#34; command can give you an idea for the performance
&gt; &gt; &gt; differences.
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; The cryptographic module as defined for FIPS-140-2 is contained in the
&gt; &gt; &gt; files /usr/lib64/.libcrypto.so.0.9.8.hmac
&gt; &gt; &gt; 
&gt; &gt; &gt;    /usr/lib64/.libssl.so.0.9.8.hmac
&gt; &gt; &gt;    /usr/lib64/libcrypto.so.0.9.8
&gt; &gt; &gt;    /usr/lib64/libssl.so.0.9.8
&gt; &gt; &gt; 
&gt; &gt; &gt; for 64bit operation and
&gt; &gt; &gt; 
&gt; &gt; &gt;    /usr/lib/.libcrypto.so.0.9.8.hmac
&gt; &gt; &gt;    /usr/lib/.libssl.so.0.9.8.hmac
&gt; &gt; &gt;    /usr/lib/libcrypto.so.0.9.8
&gt; &gt; &gt;    /usr/lib/libssl.so.0.9.8
&gt; &gt; &gt; 
&gt; &gt; &gt; &#40;snip&#41;
&gt; &gt; &gt; --------------------------------------------------------------------
&gt; &gt; &gt; 
&gt; &gt; &gt; I thought I might find some more in /etc/ssl/openssl.cnf, but &#34;ack fips
&gt; &gt; &gt; /etc/ssl&#34; turns up nothing.  Hopefully this is enough to reproduce the
&gt; &gt; &gt; problem.
&gt; &gt; &gt; 
&gt; &gt; &gt; thanks very much for your efforts!
&gt; &gt; &gt; 
&gt; &gt; &gt; Paul Boldra
</div></div></div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;07&nbsp;03:40:42&nbsp;2012</span>
    <span class="description">BOLDRA [...] boldra.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mike,

ivml2171:~ # env|grep -i fips
ivml2171:~ #

Nothing in my environment about fips.  I&#39;ll try the upgrade.  I have no
need to keep this ticket open.  Thanks for your help!

Paul Boldra

On Thu Dec 06 19:27:23 2012, mikem@open.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi again,
&gt; 
&gt; thanks for this info,
&gt; We are investigating now.
&gt; 
&gt; Looks to me like your openssl is getting started in FIPS mode.
&gt; According to
&gt; the rest of README-FIPS.txt,this should only happen if the environemnt
&gt; variable OPENSSL_FORCE_FIPS_MODE is set to 1. Can you confirm this is
&gt; the case
&gt; for you?
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;10:33:49&nbsp;2012</span>
    <span class="description">OLIVER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> mikem [...] open.com.au</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 07 03:40:42 2012, BOLDRA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Nothing in my environment about fips.  I&#39;ll try the upgrade.  I have no
&gt; need to keep this ticket open.  Thanks for your help!
</div>
I enountered this same issue on SLES 11 SP2, which has openssl-0.9.8j installed.

An upgrade to openssl-0.9.8r did resolve the problem.

If this ticket had not existed I would have spent a lot of time on the issue, so many 
thanks.

The packages for 0.9.8r can be found in this repository:

   <span class="clickylink"><a target="new" rel="nofollow" href="http://download.opensuse.org/repositories/security:/fips/">http://download.opensuse.org/repositories/security:/fips/</a></span>


regards,
oliver.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;10:34:19&nbsp;2012</span>
    <span class="description">OLIVER [...] cpan.org -  Cc OLIVER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;15:54:27&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81575] 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 12 Dec 2012 06:54:09 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the info Oliver.
Hope that helps the OP.

Cheers.

On Tuesday, December 11, 2012 10:33:51 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; 
&gt; On Fri Dec 07 03:40:42 2012, BOLDRA wrote:
<div class="message-stanza open">&gt; &gt; Nothing in my environment about fips.  I&#39;ll try the upgrade.  I have no
&gt; &gt; need to keep this ticket open.  Thanks for your help!
</div>&gt; 
&gt; I enountered this same issue on SLES 11 SP2, which has openssl-0.9.8j
&gt; installed.
&gt; 
&gt; An upgrade to openssl-0.9.8r did resolve the problem.
&gt; 
&gt; If this ticket had not existed I would have spent a lot of time on the
&gt; issue, so many thanks.
&gt; 
&gt; The packages for 0.9.8r can be found in this repository:
&gt; 
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="http://download.opensuse.org/repositories/security:/fips/">http://download.opensuse.org/repositories/security:/fips/</a></span>
&gt; 
&gt; 
&gt; regards,
&gt; oliver.
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;07&nbsp;21:04:30&nbsp;2013</span>
    <span class="description">MIKEM [...] cpan.org -  TimeWorked changed from &#40;no value&#41; to &#39;30&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;07&nbsp;21:04:30&nbsp;2013</span>
    <span class="description">MIKEM [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;07&nbsp;21:04:31&nbsp;2013</span>
    <span class="description">MIKEM [...] cpan.org -  Given to MIKEM</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;06&nbsp;07:59:28&nbsp;2014</span>
    <span class="description">vcizek [...] suse.cz -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;06&nbsp;08:07:04&nbsp;2014</span>
    <span class="description">vcizek [...] suse.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vcizek [...] suse.cz</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Dec 11 10:33:49 2012, OLIVER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Dec 07 03:40:42 2012, BOLDRA wrote:
<div class="message-stanza open">&gt; &gt; Nothing in my environment about fips.  I&#39;ll try the upgrade.  I have
&gt; &gt; no
&gt; &gt; need to keep this ticket open.  Thanks for your help!
</div>&gt; 
&gt; I enountered this same issue on SLES 11 SP2, which has openssl-0.9.8j
&gt; installed.
&gt; 
&gt; An upgrade to openssl-0.9.8r did resolve the problem.
&gt; 
</div>
We got a similar report from our customers, who experienced the issue with perl-Net-SSLeay 1.51-2 and openssl-0.9.8j.

It&#39;s essentially the same bug as <span class="clickylink"><a target="new" rel="nofollow" href="http://wiki.strongswan.org/issues/198">http://wiki.strongswan.org/issues/198</a></span>

The attached patch resolves the issue.
Could this be added to Net-SSLeay?
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-Net-SSLeay_avoid_mutex_deadlock.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- a/SSLeay.xs
+++ b/SSLeay.xs
@@ -227,9 +227,13 @@ UV get_my_thread_id&#40;void&#41; /* returns thr
     PUTBACK;
     count = call_method&#40;&#34;tid&#34;, G_SCALAR|G_EVAL&#41;;
     SPAGAIN;
-    if &#40;SvTRUE&#40;ERRSV&#41; || count != 1&#41;
-       /* if threads not loaded or an error occurs return 0 */
-       tid = 0;
+    if &#40;SvTRUE&#40;ERRSV&#41; || count == 1&#41; {
+       /* if threads not loaded or an error occurs return 1
+	OpenSSL locks the mutex in FIPS_mode_set&#40;&#41; and then 
+	tries to lock it again in FIPS_mode&#40;&#41; - only because
+	of the unfortunate thread_id above*/
+       tid = 1;
+    }   
     else
        tid = &#40;UV&#41;POPi;
     PUTBACK;
@@ -1850,7 +1854,7 @@ SSL_library_init&#40;&#41;
 
 #if OPENSSL_VERSION_NUMBER &gt;= 0x0090700fL
 #define REM5 &#34;NOTE: requires 0.9.7+&#34;
-
+		  
 void
 ENGINE_load_builtin_engines&#40;&#41;
 

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;21:07:49&nbsp;2014</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81575] 04_basic.t hangs at SSLeay_add_ssl_algorithms &#40;suse 11 + perl 5.16.2&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Feb 2014 12:07:37 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

thanks for your note and patch.
But...
are you sure this is right?:

you changed
if &#40;SvTRUE&#40;ERRSV&#41; || count != 1&#41;
to
if &#40;SvTRUE&#40;ERRSV&#41; || count == 1&#41;

which seems to also change the sense of the test, rather than just the 
returned thread id.

in this case, count is the number of items returned by threads-&gt;id&#40;&#41;, which I 
would expect usually to be 1.

Cheers.


that seems to change the sense of the test
On Thursday, February 06, 2014 08:07:05 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81575">https://rt.cpan.org/Ticket/Display.html?id=81575</a></span> &gt;
&gt; 
&gt; On Tue Dec 11 10:33:49 2012, OLIVER wrote:
<div class="message-stanza open">&gt; &gt; On Fri Dec 07 03:40:42 2012, BOLDRA wrote:
<div class="message-stanza open">&gt; &gt; &gt; Nothing in my environment about fips.  I&#39;ll try the upgrade.  I have
&gt; &gt; &gt; no
&gt; &gt; &gt; need to keep this ticket open.  Thanks for your help!
</div>&gt; &gt; 
&gt; &gt; I enountered this same issue on SLES 11 SP2, which has openssl-0.9.8j
&gt; &gt; installed.
&gt; &gt; 
&gt; &gt; An upgrade to openssl-0.9.8r did resolve the problem.
</div>&gt; 
&gt; We got a similar report from our customers, who experienced the issue with
&gt; perl-Net-SSLeay 1.51-2 and openssl-0.9.8j.
&gt; 
&gt; It&#39;s essentially the same bug as <span class="clickylink"><a target="new" rel="nofollow" href="http://wiki.strongswan.org/issues/198">http://wiki.strongswan.org/issues/198</a></span>
&gt; 
&gt; The attached patch resolves the issue.
&gt; Could this be added to Net-SSLeay?
</div>-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;24&nbsp;03:30:42&nbsp;2014</span>
    <span class="description">MIKEM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Nothing further heard. Assume OK.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;24&nbsp;03:30:43&nbsp;2014</span>
    <span class="description">MIKEM [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
