<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #123918 for Syntax-Keyword-Try: &#40;Discussion&#41; Exception dispatch</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #123918 for Syntax-Keyword-Try: &#40;Discussion&#41; Exception dispatch</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Syntax-Keyword-Try/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Syntax-Keyword-Try/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Syntax-Keyword-Try/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Syntax-Keyword-Try/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Syntax-Keyword-Try">Syntax-Keyword-Try CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">123918</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Syntax-Keyword-Try/Active/">Syntax-Keyword-Try</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DBOOK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-265556-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-265557-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;19&nbsp;18:04:22&nbsp;2017</span>
    <span class="description">DBOOK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#40;Discussion&#41; Exception dispatch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">While this module clearly is designed to work like the try/catch/finally syntax in many other languages, exception dispatch in &#39;catch&#39; is a more complex topic in Perl and thus not implemented yet. I am collecting here the current discussion and my thoughts so far.

1. The usual expected syntax based on object- and type-heavy languages is:

catch &#40;ExceptionClass $e&#41; { ... }

TryCatch, Syntax::Feature::Try, Error, and Try::Tiny::ByClass support this sort of dispatch. This could also be done here, but they don&#39;t use any common dispatch mechanism other than -&gt;isa &#40;mostly since they are quite different in underlying implementation&#41;. Additionally, in Perl, unlike most languages that make this feature popular, exceptions are commonly also bare strings.

2. Bare strings could be dispatched by providing a regex:

catch &#40;qr/.../ $e&#41;

But that looks kind of weird compared to the typed dispatch.

3. It could instead take less magical class-name strings or regexes: 

catch &#40;&#39;ExceptionClass&#39;&#41; { ... }
catch &#40;qr/.../&#41; { ... }

This could use $@ directly like a normal catch block, or a lexical could be provided by a separate part of the syntax, like:

catch &#40;&#39;ExceptionClass&#39;&#41; as $e { ... }

4. Dispatch could also be done by smartmatching on provided type objects with smartmatch overload. This would be very similar to Function::Parameters types for example.

use Types::Standard &#39;Int&#39;, &#39;InstanceOf&#39;;
catch &#40;Int $e&#41; { ... }
catch &#40;InstanceOf[&#39;ExceptionClass&#39;] $e&#41; { ... }

However, exceptions are always strings or references, so a lot of the types are useless, and I don&#39;t see any value in making the common useful cases more complicated, just to be able to dispatch to hashref or arrayref or other weird exceptions. On the other hand, it would make this possible automatically:

catch &#40;InstanceOf[&#39;ExceptionClass&#39;, &#39;OtherClass&#39;]&#41; { ... }

5. TryCatch provides an additional mechanism where you can provide an arbitrary boolean expression, but this also seems unnecessary for the majority of cases and adds some syntax confusion.

catch &#40;ExceptionClass $e where { $_-&gt;is_wobbly }&#41;

6. Regardless of syntax, there is no way to allow an exception to propagate from the original exception context if conditional `catch` blocks are provided and it does not match any of them. This means it would have to require that a non-conditional `catch` block is also present, or otherwise differ from the usual semantics which goes against what this module is trying to do.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;18&nbsp;05:33:36&nbsp;2018</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I like this idea very much. Every time i work with Python i wish we would steal the way they handle exceptions.

    try {
      ...
    }
    catch &#40;SomeException, SomeOtherException&#41; {
      ...
    }
    catch {
      ...
    }

Especially considering that try {} blocks already don&#39;t prevent exceptions from being propagated to outer try {} blocks if they are not handled.

    try {
      try {
        ...
      }
      catch &#40;SomeException&#41; {
        ...
      }
    }
    catch &#40;SomeOtherException&#41; {
      ...
    }

That just feels right.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;18&nbsp;05:33:36&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;18&nbsp;09:18:21&nbsp;2018</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 18 05:33:36 2018, SRI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I like this idea very much. Every time i work with Python i wish we
&gt; would steal the way they handle exceptions.
</div>
That mostly works in Python because all core python-raise exceptions are classy too. Here in perl, core perl exceptions are simple strings without class.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Especially considering that try {} blocks already don&#39;t prevent
&gt; exceptions from being propagated to outer try {} blocks if they are
&gt; not handled.
</div>
Yes; I&#39;m aware of the semantics there, but right now I can&#39;t provide those in perl. The problem is that an eval{} block &#40;as implemented by the slightly unfortunately-named OP_ENTERTRY&#41; does not distinguish catching types. It indiscriminately catches everything that&#39;s thrown its way. I can&#39;t therefore provide the &#34;uncaught exceptions propagate upwards&#34; behaviour at the moment. A workaround of sorts is to simply rethrow them, but this has nonideal properties in it - most notably that caller&#40;&#41; inside a $SIG{__DIE__} can distinguish the difference. This leads to much confusion and misleading output in debugging and similar situations.

I do though have a longterm plan to sometime this year start looking at implementing this syntax right there in actual perl core, aiming that one day on a suitably-new version of perl that

  use Syntax::Keyword::Try;

becomes a oneline pureperl wrapper that just enables whatever feature bit is required to turn on the core syntax. Being implemented actually in core, would then allow a defaultless &#39;catch&#39; to decline certain exceptions and send them higher up the stack unmolested.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;19&nbsp;06:42:29&nbsp;2018</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That mostly works in Python because all core python-raise exceptions
&gt; are classy too. Here in perl, core perl exceptions are simple strings
&gt; without class.
</div>
Yes, and i doubt Perl core exceptions will ever get classes. Backwards compatibility would be a nightmare. But catch could still support them with a blessed/isa check, to encourage CPAN modules to use exception classes.

    try {
      ...
    }
    catch &#40;SomeException&#41; {
      ...handle exception of a specific class here...
    }
    catch {
      ...fallback for arbitrary exceptions, which may or may not be objects...
    }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;19&nbsp;06:48:10&nbsp;2018</span>
    <span class="description">sri [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes; I&#39;m aware of the semantics there, but right now I can&#39;t provide
&gt; those in perl. The problem is that an eval{} block &#40;as implemented by
&gt; the slightly unfortunately-named OP_ENTERTRY&#41; does not distinguish
&gt; catching types. It indiscriminately catches everything that&#39;s thrown
&gt; its way. I can&#39;t therefore provide the &#34;uncaught exceptions propagate
&gt; upwards&#34; behaviour at the moment. A workaround of sorts is to simply
&gt; rethrow them, but this has nonideal properties in it - most notably
&gt; that caller&#40;&#41; inside a $SIG{__DIE__} can distinguish the difference.
&gt; This leads to much confusion and misleading output in debugging and
&gt; similar situations.
</div>
That&#39;s a bummer. It would make exceptions so much more comfortable to work with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;10&nbsp;19:29:30&nbsp;2019</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve been giving this some thought, during design of first my `isa` operator now in core perl, and second on a possible replacement for smartmatch, and I&#39;ve now decided that actually exception dispatch is quite a different scenario from general value dispatch, that it might want different rules.

In summary; exception dispatch tends only to need `isa` class, or string regexp testing, but often needs them both in the same place. Whereas a more general type/value dispatch system could require all sorts of different kinds of tests, but usually only one kind in any given place. I think therefore they&#39;re different enough to justify trying to solve them independently.

As to an actual design:

Initially, it might feel reasonable to simply put type names or regexps in parens, but that causes trouble for deferred values stored in lexicals. It&#39;d be nice to know what kind of test to perform at compiletime, so we can reject bad ones, but this wouldn&#39;t work simply:

  my $x = &#34;Some::X::Class&#34;; # or qr/^A message string /;

  ...
  catch &#40;$x&#41; { ... }

It would be far better then to make the programmer supply the testing operator &#40;`isa` or `=~`&#41; as part of the syntax; they can test against $@

  catch &#40;$@ isa Some::X::Class&#41; { ... }
  catch &#40;$@ =~ m/^A message string /&#41; { ... }
  catch &#40;$@ isa $otherclass&#41; { ... }

By noting a kind of symmetry with the way that sub signatures introduce a new variable just by naming it, maybe this also lets us have a new lexical:

  catch &#40;$e isa Some::X::Class&#41; { ... }
  catch &#40;$e =~ m/^A message string /&#41; { ... }

And just to be clear - these would be specialcases of grammar. We wouldn&#39;t allow arbitrary expressions inside the parens; it must be one of

  catch &#40;VAR isa EXPR&#41; { STMTS... }
  catch &#40;VAR =~ REGEXP&#41; { STMTS... }

Where VAR is either a new lexical, or the special $@. Possibly we&#39;d also allow an un-guarded

  catch &#40;VAR&#41; { STMTS... }

to catch any kind of exception and allocate a new variable.

This feature would then be a replacement of the currently-experimental `catch my $e` of 0.11_022, which we&#39;d remove.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;10&nbsp;19:40:27&nbsp;2019</span>
    <span class="description">grinnz [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Dec 10 19:29:30 2019, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; catch &#40;VAR isa EXPR&#41; { STMTS... }
&gt; catch &#40;VAR =~ REGEXP&#41; { STMTS... }
&gt; 
&gt; Where VAR is either a new lexical, or the special $@. Possibly we&#39;d
&gt; also allow an un-guarded
&gt; 
&gt; catch &#40;VAR&#41; { STMTS... }
&gt; 
&gt; to catch any kind of exception and allocate a new variable.
</div>
I like these forms, I wonder if there should be a way to specify multiple conditions for one catch block. This complicates things since VAR should be the same for every condition. I think the most common case of this would be specifying multiple &#34;isa&#34; possibilities &#40;since you can do some composition already with regexes at least&#41;.

-Dan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;12&nbsp;08:58:27&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I had initially been in favor of the simplest form that could handle classes and regexes, but I eventually realized that having some form of type or callback based system could be quite useful.

Given that core perl is unlikely to use exception objects any time soon &#40;or ever&#41;, it would be useful to write a type library that has regexes for the core errors thrown by perl, or other stringy errors.  Consider something like the following:

    use Type::Utils -all;
    use Types::Standard qw&#40;Str&#41;;
    declare &#34;ModuleLoadFailure&#34;,
        as Str,
        where { /\ACan&#39;t locate / };

    use Syntax::Keyword::Try;

    try {
        require Oh::No;
    }
    # no good ideas on syntax
    catch &#40;ModuleLoadFailure $e&#41; {
        ...;
    }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;13&nbsp;06:36:39&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Further thoughts on this design, copied from my recent email to perl5-porters:

Now we have the `isa` operator, it can easily be spelled out like an if&#40;&#41; condition:

  try { ... }
  catch &#40;$@ isa X::Unhandled&#41;  { uses class derivation test }
  catch &#40;$@ =~ m/^Unhandled /&#41; { uses string regexp pattern match }

This syntax looks nice but doesn&#39;t gel nicely with my other syntax
idea, which assigns the exception into a new lexical thus avoiding the
fragile nature of global $@:

  try { ... }
  catch my $e { ... }

Simply combined, the programmer has to specify $e twice in a redundant
manner:

  catch my $e &#40;$e isa Oopsie&#41; { ... }

A final thought is if we consider the contents of the parens not as a
generic condition expression but instead as a very limited &#34;only this
syntax allowed&#34; then we could perhaps contemplate allowing

  catch &#40;my $e isa Oopsie&#41; { ... }

but that feels a bit awkward; introducing a new variable as part of a
binary comparison operator yet expecting it to have value; internally
its semantics operate like

  if&#40;&#40;my $e = $@&#41; isa Oopsie&#41; { ... }


To be clear here: the syntax is the only real sticking point here. If
we can nail that down, then the semantics of the operation ought to be
fairly obvious from there and I can get on and finish implementing the
thing.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;29&nbsp;13:10:29&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My latest thinking on this front may involve some syntax such as:

   try {
      ...
   }
   catch my $e
      &#40;isa Some::Exception::Class&#41; { ... },
      &#40;=~ m/^An error message /&#41;   { ... }

Or maybe the `catch` keyword would be repeated per line, though that then involves repeating the error variable name also:

   try {
      ...
   }
   catch my $e &#40;isa Some::Exception::Class&#41; { ... }
   catch my $e &#40;=~ m/^An error message /&#41;   { ... }

At first glance those hanging operators at the start of the open paren feel very strange. The `isa` one isn&#39;t too bad but the string regexp bind `=~` look odd. But them more I work with it the more I am getting used to it. I don&#39;t know if it&#39;s just Stockholm Syndrome, or whether it actually isn&#39;t all that bad.

To be clear here, I don&#39;t mean to implement arbitrary condition checking and subtly injecting the &#34;$e&#34; to form the lefthand side of any comparison operator. I mean to support only and exactly those two forms, at first; with semantics behaving *as if* the code was written like

  catch my $e {
    if   &#40;$e isa Some::Exception::Class&#41; { ... }
    elsif&#40;$e =~ m/^An error message /&#41;   { ... }
    else  { die $e }                     # to rethrow an unhandled exception
  }

By restricting it to those two forms initially it leaves plenty of space open for possible additions later on, though I think already these two basic types will be enough to cover most use-cases.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;29&nbsp;14:03:43&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ugh. Not five minutes after I post that, ilmari makes a good point:

18:20 * ilmari would prefer it to look like a single-scalar signature

Which lead me on to thinking

  catch &#40;$e isa ClassName&#41; { ... }
  catch&#40;$e =~ m/^Pattern /&#41; { ... }
  catch &#40;$e&#41; { anything else }

So maybe right now the syntax for `catch my VAR` should be

  catch &#40;$e&#41; { ... }

We can also steal the `where`-type subkeyword from sub signatures, and allow things like:

  catch &#40;$e where { ... }&#41; { ... }

  catch &#40;$e isa Future::Exception where {$e-&gt;category eq &#34;resolve&#34;}&#41; { ... }

This might be neat enough.

In any case, it convinces me that `catch my VAR` is probably not a good longterm solution. Since I&#39;ve written it anyway I&#39;m going to release it now with big experimental warnings on, but it may come out again in the next version.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;08&nbsp;07:08:54&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 29 14:03:43 2020, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So maybe right now the syntax for `catch my VAR` should be
&gt; 
&gt; catch &#40;$e&#41; { ... }
</div>
0.14 now makes this the suggested experimental syntax, and the previous short-lived `catch my VAR` is now deprecated.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;19:18:31&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 08 07:08:54 2020, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 0.14 now makes this the suggested experimental syntax, and the
&gt; previous short-lived `catch my VAR` is now deprecated.
</div>
Additionally, version 0.15 now implements some conditional catch syntax.

The unit tests are:

  <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/PEVANS/Syntax-Keyword-Try-0.15/t/04catch-types.t">https://metacpan.org/source/PEVANS/Syntax-Keyword-Try-0.15/t/04catch-types.t</a></span>

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;27&nbsp;15:23:15&nbsp;2020</span>
    <span class="description">BRICKER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 20 19:18:31 2020, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 0.14 now makes this the suggested experimental syntax, 
</div>&gt; Additionally, version 0.15 now implements some conditional catch
&gt; syntax.
</div>
Very Nice ! Wishing i could defer recommending a Try-Catch module to a client until you settle the experimental features. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;28&nbsp;08:08:31&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 27 15:23:15 2020, BRICKER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jul 20 19:18:31 2020, PEVANS wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; 0.14 now makes this the suggested experimental syntax,
</div>&gt; &gt; Additionally, version 0.15 now implements some conditional catch
&gt; &gt; syntax.
</div>&gt; 
&gt; Very Nice ! Wishing i could defer recommending a Try-Catch module to a
&gt; client until you settle the experimental features.
</div>
Or alternatively: If you want to take part and help experiment with it, then the more this gets tried out and feedback is returned, the more confident I&#39;ll be about de-experimenting it. :&#41;

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
