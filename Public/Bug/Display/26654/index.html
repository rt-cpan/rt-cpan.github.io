<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #26654 for Pod-POM-Web: [WISH] [PATCH] Pod abstract as tooltip</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #26654 for Pod-POM-Web: [WISH] [PATCH] Pod abstract as tooltip</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pod-POM-Web/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pod-POM-Web/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pod-POM-Web/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pod-POM-Web/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-POM-Web">Pod-POM-Web CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">26654</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pod-POM-Web/Active/">Pod-POM-Web</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
chris+rt [...] chrisdolan.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-42736-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.02    </td>
  </tr>
  <tr id="CF-42737-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




abstract.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/313820/142899/abstract.patch">
Thu Apr 26 02:38:03 2007 (4.9k) by chris+rt [...] chrisdolan.net
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/313818/142893/abstract.patch">
Thu Apr 26 02:35:19 2007 (4.6k) by chris+rt [...] chrisdolan.net
</a>
</font></li>
</ul>


patch4<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/313301/142684/patch4">
Tue Apr 24 22:25:07 2007 (5.6k) by chris+rt [...] chrisdolan.net
</a>
</font></li>
</ul>


tooltip.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/313301/142681/tooltip.png">
Tue Apr 24 22:25:07 2007 (115k) by chris+rt [...] chrisdolan.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;24&nbsp;22:25:07&nbsp;2007</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [WISH] [PATCH] Pod abstract as tooltip</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[Note: the above says my patch is against 1.02, but it&#39;s really against
1.03.  RT just hasn&#39;t picked up 1.03 from CPAN yet]

I would like to be able to see the one-line summary of a module in the
TOC listing, perhaps as a tooltip via the HTML title attribute. 
Attached is a not-so-good patch that implements this, along with some
caching of both the HTML and the POM representations of the POD.  Also
attached is a screenshot showing the tooltip.

I say the patch is not-so-good primarily because the TOC load time is
significantly slower for the first hit because I&#39;m pre-parsing all of
the files just to get that first =head1.  A better approach might be to
do a quick-and-dirty parse for the =head1 NAME to get the abstract if
the POM is not already cached.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tooltip.png</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/313301/142681/tooltip.png">Download tooltip.png</a><br />
<span class="downloadcontenttype">image/png 115k</span>
</div>
<div class="messagebody">
<img alt="tooltip.png" title="tooltip.png" src="/Ticket/Attachment/313301/142681/" /></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch4</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/313301/142684/patch4">Download patch4</a><br />
<span class="downloadcontenttype">application/octet-stream 5.6k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;24&nbsp;23:03:09&nbsp;2007</span>
    <span class="description">DAMI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> DAMI [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Mar. Avr. 24 22:25:07 2007, CDOLAN a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [Note: the above says my patch is against 1.02, but it&#39;s really 
</div>against
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1.03.  RT just hasn&#39;t picked up 1.03 from CPAN yet]
&gt; 
&gt; I would like to be able to see the one-line summary of a module in 
</div>the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; TOC listing, perhaps as a tooltip via the HTML title attribute. 
&gt; Attached is a not-so-good patch that implements this, along with some
&gt; caching of both the HTML and the POM representations of the POD.  
</div>Also
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; attached is a screenshot showing the tooltip.
&gt; 
&gt; I say the patch is not-so-good primarily because the TOC load time is
&gt; significantly slower for the first hit because I&#39;m pre-parsing all of
&gt; the files just to get that first =head1.  A better approach might be 
</div>to
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; do a quick-and-dirty parse for the =head1 NAME to get the abstract if
&gt; the POM is not already cached.
&gt; 
</div>

Thanks for the suggestion, I&#39;ll think of that.
 
For that application I&#39;m not so found of caching, because it&#39;s mostly 
a single-user app without much load, and no strong requirements on 
response time, and running on a workstation, not a server : so no good 
reason for eating up more memory. Moreover caching already happens 
within the browser. 

As for tooltips, that could be done for installations that use the 
indexer, because the indexing operation has to parse all modules 
anyway, so at the same time it could store the module descriptions 
somewhere. On the other hand, the module description is just one click 
away ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;24&nbsp;23:03:11&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;26&nbsp;02:35:19&nbsp;2007</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 24 23:03:09 2007, DAMI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for tooltips, that could be done for installations that use the 
&gt; indexer, because the indexing operation has to parse all modules 
&gt; anyway, so at the same time it could store the module descriptions 
&gt; somewhere. On the other hand, the module description is just one click 
&gt; away ...
</div>
That makes a lot of sense.  I implemented your idea in the attached
patch.  The altered code now stores the POD description in the docs
database as a third column.  When building the TOC, that DB record is
retrieved and the abstract &#40;if present&#41; is set as the title attribute. 
The slowdown is negligible, both for TOC generation and indexing.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web/Indexer.pm lib/Pod/POM/Web/Indexer.pm
--- /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web/Indexer.pm	2007-04-24 14:33:29.000000000 -0500
+++ lib/Pod/POM/Web/Indexer.pm	2007-04-26 01:33:17.000000000 -0500
@@ -146,11 +146,10 @@
   $self-&gt;_tie_docs&#40;DB_RDONLY&#41;;
 
   foreach my $id &#40;@doc_ids&#41; {
-    my &#40;$mtime, $path&#41; = split &#34;\t&#34;, $self-&gt;{_docs}{$id}, 2;
+    my &#40;$mtime, $path, $description&#41; = split &#34;\t&#34;, $self-&gt;{_docs}{$id};
     my $score     = $scores-&gt;{$id};
     my @filenames = $self-&gt;find_source&#40;$path&#41;;
     my $buf = join &#34;\n&#34;, map {$self-&gt;slurp_file&#40;$_&#41;} @filenames;
-    my &#40;$description&#41; = &#40;$buf =~ /^=head1\s*NAME\s*&#40;.*&#41;$/m&#41;;
 
     my $excerpts = $indexer-&gt;excerpts&#40;$buf, $regex&#41;;
     foreach &#40;@$excerpts&#41; {
@@ -210,13 +209,23 @@
 
   length&#40;$search_string&#41; &gt;= 2 or die &#34;module_list: arg too short&#34;;
   my $regex = qr/^\d+\t\Q$search_string\E/i;
-  my @names = grep {/$regex/} values %{$self-&gt;{_docs}};
-  s[^\d+\t][], s[/][::]g foreach @names;
+  my @names = map {[split &#34;\t&#34;, $_]-&gt;[1]} grep {/$regex/} values %{$self-&gt;{_docs}};
+  s[/][::]g foreach @names;
   my $json_names = &#34;[&#34; . join&#40;&#34;,&#34;, map {qq{&#34;$_&#34;}} sort @names&#41; . &#34;]&#34;;
   return $self-&gt;send_content&#40;{content   =&gt; $json_names,
                               mime_type =&gt; &#39;application/x-json&#39;}&#41;;
 }
 
+sub get_abstract {  # override from Web.pm
+  my &#40;$self, $path&#41; = @_;
+  if &#40;!$self-&gt;{_path_to_descr}&#41; {
+    $self-&gt;_tie_docs&#40;DB_RDONLY&#41;;
+    $self-&gt;{_path_to_descr} = { map {&#40;split /\t/, $_&#41;[1,2]} values %{$self-&gt;{_docs}} };
+  }
+  my $description = $self-&gt;{_path_to_descr}-&gt;{$path} || return;
+  &#40;my $abstract = $description&#41; =~ s/^.*?-\s*//;
+  return $abstract;
+}
 
 #----------------------------------------------------------------------
 # INDEXING
@@ -244,7 +253,7 @@
   $self-&gt;{_max_size_for_indexing} = $options{-max_size}
                                  || $defaut_max_size_for_indexing;
 
-  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname&#34;}
+  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname\t$description&#34;}
   $self-&gt;_tie_docs&#40;DB_CREATE&#41;;
 
   # build in-memory reverse index of info contained in %{$self-&gt;{_docs}}
@@ -252,8 +261,8 @@
   $self-&gt;{_previous_index} = {};
   while &#40;my &#40;$id, $doc_descr&#41; = each %{$self-&gt;{_docs}}&#41; {
     $self-&gt;{_max_doc_id} = max&#40;$id, $self-&gt;{_max_doc_id}&#41;;
-    my &#40;$mtime, $path&#41; = split /\t/, $doc_descr;
-    $self-&gt;{_previous_index}{$path} = {id =&gt; $id, mtime =&gt; $mtime};
+    my &#40;$mtime, $path, $description&#41; = split /\t/, $doc_descr;
+    $self-&gt;{_previous_index}{$path} = {id =&gt; $id, mtime =&gt; $mtime, description =&gt; $description};
   }
 
   # open the index
@@ -338,6 +347,9 @@
 
     my $t0 = time;
     my $buf = join &#34;\n&#34;, map {$self-&gt;slurp_file&#40;$_&#41;} @filenames;
+    my &#40;$description&#41; = &#40;$buf =~ /^=head1\s*NAME\s*&#40;.*&#41;$/m&#41;;
+    $description ||= &#39;&#39;;
+    $description =~ s/\t/ /g;
     $buf =~ s/^=head1\s+&#40;$ignore_headings&#41;.*$//m; # remove full line of those
     $buf =~ s/^=&#40;head\d|item&#41;//mg; # just remove command of =head* or =item
     $buf =~ s/^=\w.*//mg;          # remove full line of all other commands 
@@ -345,7 +357,7 @@
     my $interval = time - $t0;
     printf STDERR &#34;%0.3f s.&#34;, $interval;
 
-    $self-&gt;{_docs}{$doc_id} = &#34;$mtime\t$fullpath&#34;;
+    $self-&gt;{_docs}{$doc_id} = &#34;$mtime\t$fullpath\t$description&#34;;
   }
 
   print STDERR &#34;\n&#34;;
@@ -360,7 +372,7 @@
 sub _tie_docs {
   my &#40;$self, $mode&#41; = @_;
 
-  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname&#34;}
+  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname\t$description&#34;}
   tie %{$self-&gt;{_docs}}, &#39;BerkeleyDB::Hash&#39;, 
       -Filename =&gt; &#34;$index_dir/docs.bdb&#34;, 
       -Flags    =&gt; $mode
diff -ur /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web.pm lib/Pod/POM/Web.pm
--- /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web.pm	2007-04-24 15:16:17.000000000 -0500
+++ lib/Pod/POM/Web.pm	2007-04-26 01:29:29.000000000 -0500
@@ -430,11 +430,15 @@
       $args{attrs} = qq{TN:contentURL=&#39;toc/$entry-&gt;{node}&#39;};
     }
     $args{href} = $entry-&gt;{node} if $entry-&gt;{pod};
+    $args{abstract} = $self-&gt;get_abstract&#40;$entry-&gt;{node}&#41; if $entry-&gt;{pod};
     $html .= generic_node&#40;%args&#41;;
   }
   return $html;
 }
 
+sub get_abstract {
+  # override in indexer
+}
 
 sub wrap_main_toc {
   my &#40;$self, $perldocs, $pragmas, $modules&#41; = @_;
@@ -754,6 +758,9 @@
   my &#40;$default_label_tag, $label_attrs&#41; 
     = $args{href} ? &#40;&#34;a&#34;,    qq{ href=&#39;$args{href}&#39;}&#41;
                   : &#40;&#34;span&#34;, &#34;&#34;                     &#41;;
+  if &#40;$args{abstract}&#41; {
+    $label_attrs .= qq{ title=&#34;$args{abstract}&#34;};
+  }
   $args{label_tag}   ||= $default_label_tag;
   $args{label_class} ||= &#34;TN_label&#34;;
   return qq{&lt;div class=&#34;$args{class}&#34;$args{attrs}&gt;}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;26&nbsp;02:38:03&nbsp;2007</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oops, wrong patch uploaded.  This is the right one.
 -- Chris

On Thu Apr 26 02:35:19 2007, CDOLAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; That makes a lot of sense.  I implemented your idea in the attached
&gt; patch.  The altered code now stores the POD description in the docs
&gt; database as a third column.  When building the TOC, that DB record is
&gt; retrieved and the abstract &#40;if present&#41; is set as the title attribute. 
&gt; The slowdown is negligible, both for TOC generation and indexing.
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web/Indexer.pm lib/Pod/POM/Web/Indexer.pm
--- /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web/Indexer.pm	2007-04-24 14:33:29.000000000 -0500
+++ lib/Pod/POM/Web/Indexer.pm	2007-04-26 01:33:17.000000000 -0500
@@ -146,11 +146,10 @@
   $self-&gt;_tie_docs&#40;DB_RDONLY&#41;;
 
   foreach my $id &#40;@doc_ids&#41; {
-    my &#40;$mtime, $path&#41; = split &#34;\t&#34;, $self-&gt;{_docs}{$id}, 2;
+    my &#40;$mtime, $path, $description&#41; = split &#34;\t&#34;, $self-&gt;{_docs}{$id};
     my $score     = $scores-&gt;{$id};
     my @filenames = $self-&gt;find_source&#40;$path&#41;;
     my $buf = join &#34;\n&#34;, map {$self-&gt;slurp_file&#40;$_&#41;} @filenames;
-    my &#40;$description&#41; = &#40;$buf =~ /^=head1\s*NAME\s*&#40;.*&#41;$/m&#41;;
 
     my $excerpts = $indexer-&gt;excerpts&#40;$buf, $regex&#41;;
     foreach &#40;@$excerpts&#41; {
@@ -210,13 +209,23 @@
 
   length&#40;$search_string&#41; &gt;= 2 or die &#34;module_list: arg too short&#34;;
   my $regex = qr/^\d+\t\Q$search_string\E/i;
-  my @names = grep {/$regex/} values %{$self-&gt;{_docs}};
-  s[^\d+\t][], s[/][::]g foreach @names;
+  my @names = map {[split &#34;\t&#34;, $_]-&gt;[1]} grep {/$regex/} values %{$self-&gt;{_docs}};
+  s[/][::]g foreach @names;
   my $json_names = &#34;[&#34; . join&#40;&#34;,&#34;, map {qq{&#34;$_&#34;}} sort @names&#41; . &#34;]&#34;;
   return $self-&gt;send_content&#40;{content   =&gt; $json_names,
                               mime_type =&gt; &#39;application/x-json&#39;}&#41;;
 }
 
+sub get_abstract {  # override from Web.pm
+  my &#40;$self, $path&#41; = @_;
+  if &#40;!$self-&gt;{_path_to_descr}&#41; {
+    $self-&gt;_tie_docs&#40;DB_RDONLY&#41;;
+    $self-&gt;{_path_to_descr} = { map {&#40;split /\t/, $_&#41;[1,2]} values %{$self-&gt;{_docs}} };
+  }
+  my $description = $self-&gt;{_path_to_descr}-&gt;{$path} || return;
+  &#40;my $abstract = $description&#41; =~ s/^.*?-\s*//;
+  return $abstract;
+}
 
 #----------------------------------------------------------------------
 # INDEXING
@@ -244,7 +253,7 @@
   $self-&gt;{_max_size_for_indexing} = $options{-max_size}
                                  || $defaut_max_size_for_indexing;
 
-  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname&#34;}
+  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname\t$description&#34;}
   $self-&gt;_tie_docs&#40;DB_CREATE&#41;;
 
   # build in-memory reverse index of info contained in %{$self-&gt;{_docs}}
@@ -252,8 +261,8 @@
   $self-&gt;{_previous_index} = {};
   while &#40;my &#40;$id, $doc_descr&#41; = each %{$self-&gt;{_docs}}&#41; {
     $self-&gt;{_max_doc_id} = max&#40;$id, $self-&gt;{_max_doc_id}&#41;;
-    my &#40;$mtime, $path&#41; = split /\t/, $doc_descr;
-    $self-&gt;{_previous_index}{$path} = {id =&gt; $id, mtime =&gt; $mtime};
+    my &#40;$mtime, $path, $description&#41; = split /\t/, $doc_descr;
+    $self-&gt;{_previous_index}{$path} = {id =&gt; $id, mtime =&gt; $mtime, description =&gt; $description};
   }
 
   # open the index
@@ -338,6 +347,9 @@
 
     my $t0 = time;
     my $buf = join &#34;\n&#34;, map {$self-&gt;slurp_file&#40;$_&#41;} @filenames;
+    my &#40;$description&#41; = &#40;$buf =~ /^=head1\s*NAME\s*&#40;.*&#41;$/m&#41;;
+    $description ||= &#39;&#39;;
+    $description =~ s/\t/ /g;
     $buf =~ s/^=head1\s+&#40;$ignore_headings&#41;.*$//m; # remove full line of those
     $buf =~ s/^=&#40;head\d|item&#41;//mg; # just remove command of =head* or =item
     $buf =~ s/^=\w.*//mg;          # remove full line of all other commands 
@@ -345,7 +357,7 @@
     my $interval = time - $t0;
     printf STDERR &#34;%0.3f s.&#34;, $interval;
 
-    $self-&gt;{_docs}{$doc_id} = &#34;$mtime\t$fullpath&#34;;
+    $self-&gt;{_docs}{$doc_id} = &#34;$mtime\t$fullpath\t$description&#34;;
   }
 
   print STDERR &#34;\n&#34;;
@@ -360,7 +372,7 @@
 sub _tie_docs {
   my &#40;$self, $mode&#41; = @_;
 
-  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname&#34;}
+  # tie to docs.bdb, storing {$doc_id =&gt; &#34;$mtime\t$pathname\t$description&#34;}
   tie %{$self-&gt;{_docs}}, &#39;BerkeleyDB::Hash&#39;, 
       -Filename =&gt; &#34;$index_dir/docs.bdb&#34;, 
       -Flags    =&gt; $mode
diff -ur /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web.pm lib/Pod/POM/Web.pm
--- /Users/chris/perl/lib/perl5/site_perl/Pod/POM/Web.pm	2007-04-24 15:16:17.000000000 -0500
+++ lib/Pod/POM/Web.pm	2007-04-26 01:36:34.000000000 -0500
@@ -430,11 +430,15 @@
       $args{attrs} = qq{TN:contentURL=&#39;toc/$entry-&gt;{node}&#39;};
     }
     $args{href} = $entry-&gt;{node} if $entry-&gt;{pod};
+    $args{abstract} = $self-&gt;get_abstract&#40;$entry-&gt;{node}&#41; if $entry-&gt;{pod};
     $html .= generic_node&#40;%args&#41;;
   }
   return $html;
 }
 
+sub get_abstract {
+  # override in indexer
+}
 
 sub wrap_main_toc {
   my &#40;$self, $perldocs, $pragmas, $modules&#41; = @_;
@@ -745,6 +749,8 @@
 # generating GvaScript treeNavigator structure
 #----------------------------------------------------------------------
 
+my %esc = &#40;&#39;&#38;&#39; =&gt; &#39;&#38;amp;&#39;, &#39;&lt;&#39; =&gt; &#39;&#38;lt;&#39;, &#39;&gt;&#39; =&gt; &#39;&#38;gt;&#39;, &#39;&#34;&#39; =&gt; &#39;&#38;quot;&#39;&#41;;
+
 sub generic_node {
   my %args = @_;
   $args{class}       ||= &#34;TN_node&#34;;
@@ -754,6 +760,10 @@
   my &#40;$default_label_tag, $label_attrs&#41; 
     = $args{href} ? &#40;&#34;a&#34;,    qq{ href=&#39;$args{href}&#39;}&#41;
                   : &#40;&#34;span&#34;, &#34;&#34;                     &#41;;
+  if &#40;$args{abstract}&#41; {
+    $args{abstract} =~ s/&#40;[&#38;&lt;&gt;&#34;]&#41;/$esc{$1}/g;
+    $label_attrs .= qq{ title=&#34;$args{abstract}&#34;};
+  }
   $args{label_tag}   ||= $default_label_tag;
   $args{label_class} ||= &#34;TN_label&#34;;
   return qq{&lt;div class=&#34;$args{class}&#34;$args{attrs}&gt;}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;02:48:49&nbsp;2007</span>
    <span class="description">DAMI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">implemented in 1.04, just released &#40;together with a new feature : 
hyperlinks from source code to use&#39;d modules&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;02:48:51&nbsp;2007</span>
    <span class="description">DAMI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
