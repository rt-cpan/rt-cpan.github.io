<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #20830 for YAML-Syck: JSON::Syck cannot handle utf-8/unicode correctly.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #20830 for YAML-Syck: JSON::Syck cannot handle utf-8/unicode correctly.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=YAML-Syck">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=YAML-Syck">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=YAML-Syck">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=YAML-Syck">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/YAML-Syck">YAML-Syck CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">20830</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=YAML-Syck">YAML-Syck</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">cpan [...] audreyt.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MLEHMANN [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-37914-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37915-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=20830">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-229673" href="/Public/Bug/Display.html?id=20830#txn-229673">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;03&nbsp;06:34:59&nbsp;2006</span>
    <span class="description">MLEHMANN [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/229673/95777/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/95777">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">JSON is defined to be an octet stream &#40;by default encoded in UTF-8&#41;,
while strings within JSON are defined to be unicode.

There seems to be no way to handle this correctly with JSON::Syck, which
makes it impossible to properly exchange data using non-ascii characters.

The module offers $JSON::Syck::ImplicitUnicode, but neither 0 or 1
result in correct behaviour.

If it is 0, then JSON::Syck does not corretcly encode perl strings into
json objects. If it is 1, it sometimes returns json objects with &#34;bytes&#34;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;255.
</div>
The problem is likely the wrong mental model. E.g. the documentation
incorrectly says:


  Perl &#40;UTF-8 bytes&#41;     =&gt; JSON &#40;Unicode flagged&#41;

Perl has no such thing as a &#34;unicode flag&#34;. Perl has a utf-8 flag, but
that doesn&#39;t flag a scalar as unicode, its jsut a different encoding of
the scalar data. Perl only knows about binary strings &#40;octet strings&#41;
and text strings &#40;unicode character strings&#41;, both of which can have the
UTF-8 flag set or cleared.

The correct handling is to always encode the resulting json object
correctly &#40;preferably in UTF-8&#41;, and always create perl text strings &#40;in
either UTF-8 or latin1 encoding&#41;, as json strings are defined to be text.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-229702" href="/Public/Bug/Display.html?id=20830#txn-229702">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;03&nbsp;09:24:58&nbsp;2006</span>
    <span class="description">miyagawa [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Aug 2006 22:24:43 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JSON-Syck [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tatsuhiko Miyagawa&#34; &lt;miyagawa [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/229702/95791/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/95791">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">To make long reply short: Looks like you want to use
JSON::Syck::Dump&#40;&#41; to convert Perl &#40;Unicode string&#41; =&gt; JSON &#40;UTF-8
bytes&#41;, right? If so,

  use Encode;

  $JSON::Syck::ImlicitUnicode = 1;
  $json = Encode::encode_utf8&#40; JSON::Syck::Dump&#40; $unicode_string &#41; &#41;;

you&#39;ll get the utf-8 JSON object.

If you like \uXXXX style escaped JSON data, try Encode::JavaScript::UCS as well.

Longer reply starts here :&#41;

On 8/3/06, Marc_Lehmann via RT &lt;bug-JSON-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; There seems to be no way to handle this correctly with JSON::Syck, which
&gt; makes it impossible to properly exchange data using non-ascii characters.
</div>
We use JSON::Syck to transfer non-ascii &#40;Japanese&#41; characters without
any issues.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The module offers $JSON::Syck::ImplicitUnicode, but neither 0 or 1
&gt; result in correct behaviour.
&gt; If it is 0, then JSON::Syck does not corretcly encode perl strings into
&gt; json objects. If it is 1, it sometimes returns json objects with &#34;bytes&#34;
<div class="message-stanza open">&gt; &gt;255.
</div></div>
This looks confusing. If it is 1, Dump&#40;&#41;ed json objects are always
UTF-8 flagged, which could obviously be &gt; 255 &#40;since Unicode
characters could be&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem is likely the wrong mental model. E.g. the documentation
&gt; incorrectly says:
&gt;
&gt;
&gt;  Perl &#40;UTF-8 bytes&#41;     =&gt; JSON &#40;Unicode flagged&#41;
&gt;
&gt; Perl has no such thing as a &#34;unicode flag&#34;. Perl has a utf-8 flag, but
&gt; that doesn&#39;t flag a scalar as unicode,
</div>
by &#34;Unicode flagged&#34; I mean UTF8 flag in Perl 5. It&#39;s true that the
official term is UTF-8 flag but to me it&#39;s totally equivalent to say.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; its jsut a different encoding of
&gt; the scalar data. Perl only knows about binary strings &#40;octet strings&#41;
&gt; and text strings &#40;unicode character strings&#41;, both of which can have the
&gt; UTF-8 flag set or cleared.
</div>
You&#39;re right, but utf-8 flagged strings are treated as &#34;Unicode
string&#34; since it could be encode&#40;&#41;d to any encodings and ord&#40;$str&#41;
returns Unicode codepoint correctly, etc.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The correct handling is to always encode the resulting json object
&gt; correctly &#40;preferably in UTF-8&#41;, and always create perl text strings &#40;in
&gt; either UTF-8 or latin1 encoding&#41;, as json strings are defined to be text.
</div>
If you really think JSON::Syck is doing somthing wrong &#40;which we don&#39;t
hope&#41;, please file a failing test case.

-- 
Tatsuhiko Miyagawa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-229703" href="/Public/Bug/Display.html?id=20830#txn-229703">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;03&nbsp;09:24:59&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-229731" href="/Public/Bug/Display.html?id=20830#txn-229731">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;03&nbsp;10:37:26&nbsp;2006</span>
    <span class="description">schmorp [...] schmorp.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> MLEHMANN [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Aug 2006 16:36:57 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;miyagawa [...] gmail.com via RT&#34; &lt;bug-JSON-Syck [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Lehmann &lt;schmorp [...] schmorp.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/229731/95811/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/95811">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Aug 03, 2006 at 09:25:00AM -0400, &#34;miyagawa@gmail.com via RT&#34; &lt;bug-JSON-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; If it is 0, then JSON::Syck does not corretcly encode perl strings into
&gt; &gt; json objects. If it is 1, it sometimes returns json objects with &#34;bytes&#34;
<div class="message-stanza open">&gt; &gt; &gt;255.
</div></div>&gt; 
&gt; This looks confusing. If it is 1, Dump&#40;&#41;ed json objects are always
&gt; UTF-8 flagged, which could obviously be &gt; 255 &#40;since Unicode
&gt; characters could be&#41;.
</div>
No, they are not. As soon as you ste the utf-8 _flag_ on the scalar, it no
longer is utf-8, it is now text consisting of unicode characters.

Encode in your example above makes utf-8 out of it.

Thats the &#34;wrong mental model&#34; I wrote about in my original mail.

You wrognly assume that setting the _internal_ UTF-8 bit makes a scalar
utf-8. This is logically wrong. Clearing the bit on a scalar that is encoded
in utf-8 internally makes it valid UTF-8.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;  Perl &#40;UTF-8 bytes&#41;     =&gt; JSON &#40;Unicode flagged&#41;
&gt; &gt;
&gt; &gt; Perl has no such thing as a &#34;unicode flag&#34;. Perl has a utf-8 flag, but
&gt; &gt; that doesn&#39;t flag a scalar as unicode,
</div>&gt; 
&gt; by &#34;Unicode flagged&#34; I mean UTF8 flag in Perl 5. It&#39;s true that the
&gt; official term is UTF-8 flag but to me it&#39;s totally equivalent to say.
</div>
Which is the problem. Perl doesn&#39;t work that way.

Let me explain it differently:

   Perl can handle binary octet strings and unicode character strings.

   The difference is that an octet string contains no character values &gt;
   255, while unicode character strings can not.

   The difference is in the way you treat the scalar - perl does not make
   a difference.

   You can have an octet string encoded as utf-8 internally, or as
   latin1/bytes. Regardless of this _internal_ encoding, a byte string
   will always be a byte string.

   Likewise, you can have a unicode string encoded as utf-8 _internally_,
   but also as latin1, _iff_ the string contains only characters &lt; 256.

The model you assume is that the utf-8 flag that you can set/clear on scalars
somehow makes a string unicode or not. This is a broken assumption.

See for example the utf8 manpage and the utf8::encode and utf8::decode
function. You will see that utf8::encode _clears_ the utf-8 bit. Clearing the
utf-8 bit makes a scalar utf-8 &#40;when it actually contains utf-8&#41;.

utf8::encod takes a character string and converts it into utf-8.

Likewise, utf8::decode might or might not set the utf-8 _flag_ on the scalar.
It nevertheless comverts an utf-8 octet string into a unicode character
string. It will be unicode regardless of wether the resulting string has the
utf-8 bit set or not, the utf-8 bit has nothing to do with unicode-ness.

If you deviate from this model into the brokennotion that utf-8-bit ==
unicode flag then you are bound to run into problems.

For example, when I feed JSON::Syck a valid json object/string, encoded in
utf-8 octets, I get a datastructure with utf-8 in them, not perl strings.
JSON, however, describes unicode strings, which perl can handle.

Worse, the outcome depends on wether the octet string is internally encoded
in UTF-8 or not: JSON::Syck will give different results in this case,
although the input string is identical.

The only corretc solution is to treat the utf-8 bit in perl as just a way of
representing integer character indices in strings: If it is cleared, the
string only stores &lt;256 character indices, if it is set, it might store &gt;255
indices. It has *nothing* whatsoever to do with unicode.

JSON, on the other hand, clearly defines that a json object/string is
*encoded* in unicode, i.e. an octet string &#40;all unicode encodings deliver an
octet string&#41;, and that the structure it represents is unicode strings.

JSON::Syck breaks this by creating unencoded json objects &#40;which is not
defined by rfc4627 when serialising, or by not corretcly decoding strings
stored in a json object to perl strings.

As an explizit example of what goes wrong, look at this:

   my $hash = JSON::Syck::Load &#34;some-octet-string-containing-utf-8-encoded-json-object&#34;;

The $hash will now contain utf-8 encoded octet strings &#40;all indices &lt;
256&#41;, NOT the strings that are actually stored in the json object/string.


Likewise:

   print STREAM JSON::Syck::Dump $hash;

Will elicit a warning when STREAM is in binmode, because it might contain
indices &gt; 255 which are not valid. JSON objects/strings, on the other hand,
are always encoded in some unicode encoding, and thus never can have indices
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;255.
</div>
Obviously, the above examples depend on sepcific settings of
ImplicitUnicode.  However, no setting of ImplciitUnicode work
correctly. Either you get broken JSON objects &#40;indices &gt;255&#41;, or your
decoded strings are broken &#40;utf-8, not perl text strings&#41;.

This is not helped by the fact that the documentation does not specify at
all what JSON::Syck does, as it talsk about a unicode flag that perl does
not have. If the unicode flag is the utf-8 flag, it is simply broken.

I hope this was clearer then my initial mail. If something is unclear
still, do not hesitate to ask for clarification. Encoding issues are not
easy, and I _really_ want the JSON::Syck module to work correctly, as soon
as possible, before too amny people have to work around its encoding bugs
&#40;as I have to do&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You&#39;re right, but utf-8 flagged strings are treated as &#34;Unicode
&gt; string&#34;
</div>
Not by perl, which is the problem. JSON::Syck indeed treats it incorrectly as
&#34;unicode string&#34;, but as this clashes with the pelr programming language,
this results in bugs.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The correct handling is to always encode the resulting json object
&gt; &gt; correctly &#40;preferably in UTF-8&#41;, and always create perl text strings &#40;in
&gt; &gt; either UTF-8 or latin1 encoding&#41;, as json strings are defined to be text.
</div>&gt; 
&gt; If you really think JSON::Syck is doing somthing wrong &#40;which we don&#39;t
&gt; hope&#41;, please file a failing test case.
</div>
   echo &#39;{&#34;a&#34;:&#34;Ã¼&#34;}&#39; | perl -MJSON::Syck -e &#39;binmode STDIN; $hash = JSON::Syck::Load &lt;&gt;&#39;

&#40;All in UTF-8&#41;. This results not in a &#34;Ã¼&#34; character, but in two
characters, \xc3\xbc. RFC4627, however, states &#40;section 3&#41; that the
above json-object is encoded in utf-8 &#40;because there are no 0 bytes in
the initial 4 bytes&#41;. JSON::Syck, however, incorrectly interprets it as
latin1, which is not even mentioned as a valid encoding in rfc4627, and is
incapable of transfering characters &gt;255.

Similarly, when dumping the perl hash &#39;{ a=&gt; &#34;Ã¼&#34; }&#39;, we do not get a
correctly encoded json string, but instead a perl string with characters
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;255, i.e. unencoded, which again clashes with section 3 of rfc4627.
</div>
Changing ImplciitUnicode changes the test cases and the outcomes, but doesn&#39;t
fix the problem, as no steting of ImplicitUnicode correctly decoded json
objects encoded in utf-8 and correctly encoded json objects in utf-8. Nor any
other unicode encoding.

-- 
                The choice of a
      -----==-     _GNU_
      ----==-- _       generation     Marc Lehmann
      ---==---&#40;_&#41;__  __ ____  __      pcg@goof.com
      --==---/ / _ \/ // /\ \/ /      <span class="clickylink"><a target="new" rel="nofollow" href="http://schmorp.de/">http://schmorp.de/</a></span>
      -=====/_/_//_/\_,_/ /_/\_\      XX11-RIPE
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-229750" href="/Public/Bug/Display.html?id=20830#txn-229750">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;03&nbsp;11:05:11&nbsp;2006</span>
    <span class="description">miyagawa [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 4 Aug 2006 00:04:53 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JSON-Syck [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tatsuhiko Miyagawa&#34; &lt;miyagawa [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/229750/95820/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/95820">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 8/3/06, Marc Lehmann via RT &lt;bug-JSON-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;
&gt; &gt; This looks confusing. If it is 1, Dump&#40;&#41;ed json objects are always
&gt; &gt; UTF-8 flagged, which could obviously be &gt; 255 &#40;since Unicode
&gt; &gt; characters could be&#41;.
</div>&gt;
&gt; No, they are not. As soon as you ste the utf-8 _flag_ on the scalar, it no
&gt; longer is utf-8, it is now text consisting of unicode characters.
</div>
Yes, I know.

Thanks for your explanation. But please, please don&#39;t spend time
telling me how Perl Unicode/UTF-8 works. I&#39;m one of the AUTHORs of
Encode.pm and other CPAN Encode:: modules, and am pretty sure I
understand the difference of encode_utf8, decode_utf8, utf8::encode,
utf8::decode, _utf8_on, _utf8_off and whatever Perl encoding magics.
It&#39;d be needless to say about how Audrey is.

So let&#39;s break down to the actual example:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   echo &#39;{&#34;a&#34;:&#34;Ã¼&#34;}&#39; | perl -MJSON::Syck -e &#39;binmode STDIN; $hash = JSON::Syck::Load &lt;&gt;&#39;
&gt;
&gt; &#40;All in UTF-8&#41;. This results not in a &#34;Ã¼&#34; character, but in two
&gt; characters, \xc3\xbc.
</div>
Wrong. \xc3\xbc is an UTF-8 bytes representation for &#34;Ã¼&#34; &#40;U+00FC&#41;.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=00fc">http://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=00fc</a></span>

decode_utf8&#40;$hash-&gt;{a}&#41; and you&#39;ll get the Unicode string U+00FC.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; RFC4627, however, states &#40;section 3&#41; that the
&gt; above json-object is encoded in utf-8 &#40;because there are no 0 bytes in
&gt; the initial 4 bytes&#41;. JSON::Syck, however, incorrectly interprets it as
&gt; latin1, which is not even mentioned as a valid encoding in rfc4627, and is
&gt; incapable of transfering characters &gt;255.
</div>
By default &#40;$ImplicitUnicode = 0&#41;, JSON::Syck doesn&#39;t care if the
encoding is latin-1, utf-8, euc-jp or whatever. If JSON is UTF-8
bytes, result Perl is UTF-8 bytes as well &#40;see above again&#41;.

with ImplicitUnicode,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; echo &#39;{&#34;a&#34;:&#34;Ã¼&#34;}&#39; | perl -MJSON::Syck -e &#39;$JSON::Syck::ImplicitUnicode = 1; binmode STDIN; $hash = JSON::Syck::Load &lt;&gt;;&#39;
</div>
and you&#39;ll get $hash-&gt;{a} = &#34;\x{fc}&#34;, the utf8 flagged string of U+00FC.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Similarly, when dumping the perl hash &#39;{ a=&gt; &#34;Ã¼&#34; }&#39;, we do not get a
&gt; correctly encoded json string, but instead a perl string with characters
<div class="message-stanza open">&gt; &gt;255, i.e. unencoded, which again clashes with section 3 of rfc4627.
</div></div>
No.

  $hash = { a =&gt;  &#39;Ã¼&#39; };
  print JSON::Syck::Dump&#40;$hash&#41;;

prints {&#34;a&#34;:&#34;Ã¼&#34;} as utf-8 bytes.

With ImplicitUnicode set 1, you&#39;ll emit Unicode strings, so you have
to binmode before printing to filehandle, as in:

  binmode STDOUT, &#34;:utf8&#34;;
  print JSON::Syck::Dump&#40;$hash&#41;-&gt;{a};

I&#39;m thinking that there would be some terminlogy miscommunication
based on &#40;probably poor&#41; documentation of JSON::Syck. I&#39;ll work on an
improvement but doc patch is also welcome.

-- 
Tatsuhiko Miyagawa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-229782" href="/Public/Bug/Display.html?id=20830#txn-229782">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;03&nbsp;15:26:36&nbsp;2006</span>
    <span class="description">schmorp [...] schmorp.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> MLEHMANN [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Aug 2006 21:26:12 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;miyagawa [...] gmail.com via RT&#34; &lt;bug-JSON-Syck [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Lehmann &lt;schmorp [...] schmorp.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/229782/95840/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/95840">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Aug 03, 2006 at 11:05:12AM -0400, &#34;miyagawa@gmail.com via RT&#34; &lt;bug-JSON-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; No, they are not. As soon as you ste the utf-8 _flag_ on the scalar, it no
&gt; &gt; longer is utf-8, it is now text consisting of unicode characters.
</div>&gt; 
&gt; Yes, I know.
</div>
Good :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for your explanation. But please, please don&#39;t spend time
&gt; telling me how Perl Unicode/UTF-8 works. I&#39;m one of the AUTHORs of
</div>
OK, then all that needs to be done is to apply this to JSON::Syck so it
works, and the documentation to be fixed.

Regarding the &#34;mine is longer than yours&#34;, I also reported and fixed many
bugs in the perl core and modules regarding unicode handling. I don&#39;t give
anything on arguments such as this, I&#39;d much rather let facts speak.

And in this case, if you are so knowledgable, then I don&#39;t see the problem in
fixing JSON::Syck to a&#41; generate correct perl data structures when Load&#39;ing
and b&#41; generate correct JSON objects un Dump&#39;ing, without having to resort to
additional modules, hackery, and having to set magic global variables on
every dump/load.

It&#39;s realyl a disservice for the user to force them to apply extra work
when they just want a rfc-compliant serialiser/deserialiser.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So let&#39;s break down to the actual example:
&gt; 
<div class="message-stanza open">&gt; &gt;   echo &#39;{&#34;a&#34;:&#34;Ã¼&#34;}&#39; | perl -MJSON::Syck -e &#39;binmode STDIN; $hash = JSON::Syck::Load &lt;&gt;&#39;
&gt; &gt;
&gt; &gt; &#40;All in UTF-8&#41;. This results not in a &#34;Ã¼&#34; character, but in two
&gt; &gt; characters, \xc3\xbc.
</div>&gt; 
&gt; Wrong. \xc3\xbc is an UTF-8 bytes representation for &#34;Ã¼&#34; &#40;U+00FC&#41;.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=00fc">http://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=00fc</a></span>
</div>
That doesn&#39;t matter. the json object encodes U+00FC, which in perl is
represented as chr&#40;0xfc&#41;.

This is the whole point.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; decode_utf8&#40;$hash-&gt;{a}&#41; and you&#39;ll get the Unicode string U+00FC.
</div>
Uhm... whats the point of JSON::Syck if it doesn&#39;t decode json to perl
datastructures but stops halfway at decoding strings?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; latin1, which is not even mentioned as a valid encoding in rfc4627, and is
&gt; &gt; incapable of transfering characters &gt;255.
</div>&gt; 
&gt; By default &#40;$ImplicitUnicode = 0&#41;, JSON::Syck doesn&#39;t care if the
&gt; encoding is latin-1, utf-8, euc-jp or whatever. If JSON is UTF-8
&gt; bytes, result Perl is UTF-8 bytes as well &#40;see above again&#41;.
</div>
Indeed, and thats the bug, as perl doesn&#39;t represent unicode as utf-8 on
the perl level, but as unicode character indices.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; echo &#39;{&#34;a&#34;:&#34;Ã¼&#34;}&#39; | perl -MJSON::Syck -e &#39;$JSON::Syck::ImplicitUnicode = 1; binmode STDIN; $hash = JSON::Syck::Load &lt;&gt;;&#39;
</div>&gt; 
&gt; and you&#39;ll get $hash-&gt;{a} = &#34;\x{fc}&#34;, the utf8 flagged string of U+00FC.
</div>
Right, but with ImplciitUnicode set to one, JSON::Syck::Dump no longer
works, as it suddenly doesn&#39;t output a valid json string &#40;which needs to
be encoded&#41;.

Thats what I meant: neither setting results in correct behaviour.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Similarly, when dumping the perl hash &#39;{ a=&gt; &#34;Ã¼&#34; }&#39;, we do not get a
&gt; &gt; correctly encoded json string, but instead a perl string with characters
<div class="message-stanza open">&gt; &gt; &gt;255, i.e. unencoded, which again clashes with section 3 of rfc4627.
</div></div>&gt; 
&gt; No.
&gt; 
&gt;   $hash = { a =&gt;  &#39;Ã¼&#39; };
&gt;   print JSON::Syck::Dump&#40;$hash&#41;;
&gt; 
&gt; prints {&#34;a&#34;:&#34;Ã¼&#34;} as utf-8 bytes.
</div>
Not with ImplicitUnicode set to 1.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; With ImplicitUnicode set 1, you&#39;ll emit Unicode strings, so you have
&gt; to binmode before printing to filehandle, as in:
&gt; 
&gt;   binmode STDOUT, &#34;:utf8&#34;;
&gt;   print JSON::Syck::Dump&#40;$hash&#41;-&gt;{a};
</div>
If Dump would output a correctly encoded JSON string, then using utf8 as
encoding would be a bug.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m thinking that there would be some terminlogy miscommunication
&gt; based on &#40;probably poor&#41; documentation of JSON::Syck. I&#39;ll work on an
&gt; improvement but doc patch is also welcome.
</div>
The documentation is certainly confusing, as it doesn&#39;t explain what
ImplicitUnicode does.

However, do you really think that having to set implicitunicode to one value
for dumping and to another for loading to get correct behaviour is desirable?
Right now, they are not even symmetrical, so dumping some datastructure and
loading it again will corrupt the data in it. Do you really think having
asymetric operations is the way to proceed?

If yes, then your understanding of unicode issues in general and unicode
issues in perl isn&#39;t up to the task.

It would really be nice if perl had a good and working JSON module that
&#34;just works&#34;.

-- 
                The choice of a
      -----==-     _GNU_
      ----==-- _       generation     Marc Lehmann
      ---==---&#40;_&#41;__  __ ____  __      pcg@goof.com
      --==---/ / _ \/ // /\ \/ /      <span class="clickylink"><a target="new" rel="nofollow" href="http://schmorp.de/">http://schmorp.de/</a></span>
      -=====/_/_//_/\_,_/ /_/\_\      XX11-RIPE
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-229788" href="/Public/Bug/Display.html?id=20830#txn-229788">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;03&nbsp;16:17:05&nbsp;2006</span>
    <span class="description">miyagawa [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 4 Aug 2006 05:16:51 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JSON-Syck [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tatsuhiko Miyagawa&#34; &lt;miyagawa [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/229788/95845/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/95845">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 8/4/06, Marc Lehmann via RT &lt;bug-JSON-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; decode_utf8&#40;$hash-&gt;{a}&#41; and you&#39;ll get the Unicode string U+00FC.
</div>&gt;
&gt; Uhm... whats the point of JSON::Syck if it doesn&#39;t decode json to perl
&gt; datastructures but stops halfway at decoding strings?
</div>
I don&#39;t think it &#34;stops halfway.&#34; JSON::Syck just works so simply as
&#34;if ImplicitUnicode is 0, don&#39;t care about encodings. If set to 1,
treat the JSON encoding as utf-8 and do the right thing.&#34;

The reason why we made ImplicitUnicode = 0 as default was &#40;IIRC&#41;:
1. JSON.pm does it so
2. At the time we coded &#40;in January 2006 I guess&#41;, JSON spec didn&#39;t
clearly say that the encoding should be UTF-8. We did email
conversation with _why &#40;the author of libsyck&#41; and Crockford &#40;JSON
spec author&#41; about it and got a concensus on UTF-8, though.

So my answer is, ImplicitUnicode = 1 is what you want. If that breaks
Dump&#40;&#41; that&#39;s a separate problem to fix. &#40;More on that later&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; latin1, which is not even mentioned as a valid encoding in rfc4627, and is
&gt; &gt; &gt; incapable of transfering characters &gt;255.
</div>&gt; &gt;
&gt; &gt; By default &#40;$ImplicitUnicode = 0&#41;, JSON::Syck doesn&#39;t care if the
&gt; &gt; encoding is latin-1, utf-8, euc-jp or whatever. If JSON is UTF-8
&gt; &gt; bytes, result Perl is UTF-8 bytes as well &#40;see above again&#41;.
</div>&gt;
&gt; Indeed, and thats the bug, as perl doesn&#39;t represent unicode as utf-8 on
&gt; the perl level, but as unicode character indices.
</div>
It&#39;s not a bug. say, CGI.pm param&#40;&#41; method, or Apache::Request or
whatever, returns incoming parameter value as UTF-8 bytes &#40;if the
query parameter is encoded in UTF-8&#41;, not Unicode string.

&#40;with the default, ImplicitUnicode = 0&#41; JSON::Syck returns the data
structure in UTF-8 if input data is UTF-8, while it returns Uniode
string if the input data is decoded as Unicode string in your app.
That allows more flexibility to adopt JSON::Syck to your web app
framework.

Actually we use JSON::Syck on Catalyst &#40;see my Catalyst::View::JSON
and Catalyst::Plugin::JSONRPC&#41; to serve blog writes from US to Japan
to France to Taiwan on Vox.com. Audrey uses it to serve Taiwan bank
intranet system by using JSON::Syck on Jifty.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; echo &#39;{&#34;a&#34;:&#34;Ã¼&#34;}&#39; | perl -MJSON::Syck -e &#39;$JSON::Syck::ImplicitUnicode = 1; binmode STDIN; $hash = JSON::Syck::Load &lt;&gt;;&#39;
</div>&gt; &gt;
&gt; &gt; and you&#39;ll get $hash-&gt;{a} = &#34;\x{fc}&#34;, the utf8 flagged string of U+00FC.
</div>&gt;
&gt; Right, but with ImplciitUnicode set to one, JSON::Syck::Dump no longer
&gt; works, as it suddenly doesn&#39;t output a valid json string &#40;which needs to
&gt; be encoded&#41;.
</div>
So okay. For now, as &#40;i think clearly&#41; documented in POD, there&#39;s no way to do:

  Perl &#40;Unicode string&#41; -&gt; JSON &#40;utf-8 bytes&#41;

and it&#39;s up to users. If you call it &#34;a bug&#34;, I&#39;d say &#34;No it&#39;s not a
bug, but patches and suggestions are welcome :&#41;&#34;

Read the doc again. If &#34;Unicode flagged&#34; confuses you, replace that
with &#34;Unicode string.&#34;

         JSON &#40;UTF-8 bytes&#41;     =&gt; Perl &#40;Unicode flagged&#41;
         JSON &#40;Unicode flagged&#41; =&gt; Perl &#40;Unicode flagged&#41;
         Perl &#40;UTF-8 bytes&#41;     =&gt; JSON &#40;Unicode flagged&#41;
         Perl &#40;Unicode flagged&#41; =&gt; JSON &#40;Unicode flagged&#41;

actually, the nicest thing that we emit JSON result as Unicode string
&#40;rather than utf-8 encoded&#41; is that you can easily encode the result
into a separate encoding, like &#39;JavaScript-UCS&#39; &#40;as in
Encode::JavaScript::UCS&#41; to get &#34;a&#34;: &#34;\uXXXX&#34;.

Of course I know that you can use Encode::from_to&#40;$json, &#39;utf-8&#39; =&gt;
&#39;JavaScript-UCS&#39;&#41; to do the same thing &#40;if Dump&#40;&#41; encodes the result
in utf-8&#41;, though.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; With ImplicitUnicode set 1, you&#39;ll emit Unicode strings, so you have
&gt; &gt; to binmode before printing to filehandle, as in:
&gt; &gt;
&gt; &gt;   binmode STDOUT, &#34;:utf8&#34;;
&gt; &gt;   print JSON::Syck::Dump&#40;$hash&#41;-&gt;{a};
</div>&gt;
&gt; If Dump would output a correctly encoded JSON string, then using utf8 as
&gt; encoding would be a bug.
</div>
Sure. Since Dump outputs a JSON string as in Perl Unicode string,
binmode&#40;&#41;ing is what your app is supposed to do.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The documentation is certainly confusing, as it doesn&#39;t explain what
&gt; ImplicitUnicode does.
</div>
Suggestions and improvements are welcome.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, do you really think that having to set implicitunicode to one value
&gt; for dumping and to another for loading to get correct behaviour is desirable?
&gt; Right now, they are not even symmetrical, so dumping some datastructure and
&gt; loading it again will corrupt the data in it.
</div>
No it doesn&#39;t, as seen in that the following test passes.

  use JSON::Syck;
  use Test::More &#39;no_plan&#39;;

  for my $iu &#40;0, 1&#41; {
      $JSON::Syck::ImplicitUnicode = $iu;

      my $hash = { &#34;a&#34; =&gt; chr&#40;0xfc&#41; };
      my $json = JSON::Syck::Dump&#40;$hash&#41;;
      is_deeply JSON::Syck::Load&#40;$json&#41;, $hash;
  }

If you disagree, please give us a failing test suite.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Do you really think having
&gt; asymetric operations is the way to proceed?
</div>
No i don&#39;t think so and it&#39;s not the current behavior as seen above.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It would really be nice if perl had a good and working JSON module that
&gt; &#34;just works&#34;.
</div>
I believe JSON::Syck just works with enough flexibility.

So, I chatted briefly with Audrey and your request to do &#34;Perl
&#40;Unicode string&#41; &lt;=&gt; JSON &#40;UTF-8 encoded&#41;&#34; seems to be a fair request.
But for now, encoding to UTF-8 when emitting is supposed to be done on
your app land, and we&#39;ll improve the doc to make it more explicit.

I&#39;m now going to fly for 3 days vacation this weekend and will be late
replying from now on. I hope Audrey could be your assistant in behalf
during my absense.

Thank you!

-- 
Tatsuhiko Miyagawa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1027658" href="/Public/Bug/Display.html?id=20830#txn-1027658">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;25&nbsp;13:46:10&nbsp;2012</span>
    <span class="description">root [...] localhost -  Queue changed from JSON-Syck to YAML-Syck</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1036019" href="/Public/Bug/Display.html?id=20830#txn-1036019">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;11&nbsp;23:07:43&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> miyagawa [...] gmail.com, schmorp [...] schmorp.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1036019/540846/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/540846">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 207b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Marc, This ticket stalled in a JSON::Syck RT queue for 5 years when it should have been in 
YAML::Syck&#39;s queue. If you still feel this is an issue, please let me know by re-opening the ticket. 

Thanks,
Todd
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1036023" href="/Public/Bug/Display.html?id=20830#txn-1036023">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;11&nbsp;23:07:44&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1036123" href="/Public/Bug/Display.html?id=20830#txn-1036123">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;12&nbsp;03:31:36&nbsp;2012</span>
    <span class="description">schmorp [...] schmorp.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Feb 2012 09:31:24 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Todd Rinaldo via RT &lt;bug-YAML-Syck [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Lehmann &lt;schmorp [...] schmorp.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1036123/540911/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/540911">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 802b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Feb 11, 2012 at 11:07:44PM -0500, Todd Rinaldo via RT &lt;bug-YAML-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Marc, This ticket stalled in a JSON::Syck RT queue for 5 years when it should have been in 
&gt; YAML::Syck&#39;s queue. If you still feel this is an issue, please let me know by re-opening the ticket. 
</div>
Hmm, the problem is clearly in JSON::Syck, not YAML::Syck, and when you
want to close valid bug reports without investigating them, you are free
to do that, and I shouldn&#39;t reopen them.

-- 
                The choice of a       Deliantra, the free code+content MORPG
      -----==-     _GNU_              <span class="clickylink"><a target="new" rel="nofollow" href="http://www.deliantra.net">http://www.deliantra.net</a></span>
      ----==-- _       generation
      ---==---&#40;_&#41;__  __ ____  __      Marc Lehmann
      --==---/ / _ \/ // /\ \/ /      schmorp@schmorp.de
      -=====/_/_//_/\_,_/ /_/\_\
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1036126" href="/Public/Bug/Display.html?id=20830#txn-1036126">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;12&nbsp;03:31:38&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1036562" href="/Public/Bug/Display.html?id=20830#txn-1036562">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;13&nbsp;02:02:12&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> miyagawa [...] gmail.com, schmorp [...] schmorp.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1036562/541170/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/541170">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1006b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm, the problem is clearly in JSON::Syck, not YAML::Syck, and when
&gt; you want to close valid bug reports without investigating them, you
&gt; are free to do that, and I shouldn&#39;t reopen them.
</div>
JSON::Syck development was merged with YAML::Syck ~5 years ago from what I can tell. When 
that happened, The RT queue for JSON::Syck disappeared from visibility on 
search.cpan/metacpan. I discovered and rescued these tickets, asking them to be ported into 
the YAML::Syck queue, which is where JSON::Syck tickets are reported these days. So when I 
say that I&#39;m not trying to kill the ticket you can trust me.

The last email I see is from Miyagawa, clarifying that this module does not do what you want 
and that it needs to be better documented. Since August 2006, you have not replied. 

Considering the amount of back and forth I see happend on this ticket, could I get some 
clarification on what you&#39;d like to see next at this point? Do you have any patches as 
suggestions for this ticket?

Thanks,
Todd
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1036566" href="/Public/Bug/Display.html?id=20830#txn-1036566">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;13&nbsp;02:02:16&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1038540" href="/Public/Bug/Display.html?id=20830#txn-1038540">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;16&nbsp;02:50:39&nbsp;2012</span>
    <span class="description">schmorp [...] schmorp.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Feb 2012 08:50:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Todd Rinaldo via RT &lt;bug-YAML-Syck [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Lehmann &lt;schmorp [...] schmorp.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1038540/542257/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/542257">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Feb 13, 2012 at 02:02:15AM -0500, Todd Rinaldo via RT &lt;bug-YAML-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Considering the amount of back and forth I see happend on this ticket, could I get some 
&gt; clarification on what you&#39;d like to see next at this point? Do you have any patches as 
&gt; suggestions for this ticket?
</div>
I really don&#39;t care, both YAML::Syck and JSON::Syck are so broken w.r.t.
unicode and so hopelessly far from both YAML and JSON that, I guess,
everybody by now has been forced to alternatives that actually work.

The report I made was to help JSON::Syck and/or YAML::Syck to become
better, it&#39;s not a support request because I need a bugfix, so no change
in either module will be of advantage to me.

As I said, if there is no interest in fixing JSON::Syck to work properly,
that&#39;s fine with me. Likewise, there is little interest for me in spending
any more time on these obsolete modules.

If there is interest in fixing things, then there is ample documentation
already available.

-- 
                The choice of a       Deliantra, the free code+content MORPG
      -----==-     _GNU_              <span class="clickylink"><a target="new" rel="nofollow" href="http://www.deliantra.net">http://www.deliantra.net</a></span>
      ----==-- _       generation
      ---==---&#40;_&#41;__  __ ____  __      Marc Lehmann
      --==---/ / _ \/ // /\ \/ /      schmorp@schmorp.de
      -=====/_/_//_/\_,_/ /_/\_\
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1038543" href="/Public/Bug/Display.html?id=20830#txn-1038543">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;16&nbsp;02:50:40&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187266" href="/Public/Bug/Display.html?id=20830#txn-1187266">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;03:41:39&nbsp;2013</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1187266/626297/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/626297">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 237b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Much of the discussion in this ticket is admittedly over my head, but I think the module at this 
point is beyond the point of being able to be fixed like Marc Suggests if nothing else, for 
compatibility reasons. I&#39;m closing it for now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187269" href="/Public/Bug/Display.html?id=20830#txn-1187269">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;03:41:43&nbsp;2013</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187495" href="/Public/Bug/Display.html?id=20830#txn-1187495">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;18:27:15&nbsp;2013</span>
    <span class="description">schmorp [...] schmorp.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #20830] JSON::Syck cannot handle utf-8/unicode correctly.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 3 Mar 2013 00:27:02 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Todd Rinaldo via RT &lt;bug-YAML-Syck [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marc Lehmann &lt;schmorp [...] schmorp.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1187495/626407/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/626407">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Mar 02, 2013 at 03:41:41AM -0500, Todd Rinaldo via RT &lt;bug-YAML-Syck@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Much of the discussion in this ticket is admittedly over my head, but I think the module at this 
&gt; point is beyond the point of being able to be fixed like Marc Suggests if nothing else, for 
&gt; compatibility reasons. I&#39;m closing it for now.
</div>
I can&#39;t follow this reasoning - I can understand that the behaviour should
stay the same &#40;by default&#41;, but closing the ticket and doing nothing is not
really sensible or reasonable. There are lots of alternatives, in increasing
order of effort required toi implement them:

- being honest about the bug and at least leave it open, for other people to
  see &#40;so they can understand how to work around it!&#41;.
- fix the documentation, so people have a chance to work around it or deal
  with it without having to search for this bug report.
- conditionally fix the behaviour, so old code relying on the bug will still
  work.

Just closing the bug without at least fixing the documentation is, sorry
to say, just showing extremely bad maintainersihp &#40;I don&#39;t know who
maintains it these days&#41;. It means willfully tricking users into bugs
and wasting their time, without an actual need from the maintainer side
&#40;just keeping the bug open will help those users, not optimally, but sitll
help - closing will just hide the bug and force users to do the research
again&#41;.

So while closing the bug by using an illogical explanation and doing
nothing else&#40;there clearly is no need to break existing programs to fix
this bug&#41; is a valid option, it&#39;s also a lousy option.

Note I am just pointing this out - whoeever maintains this module has to
do the choice fo doing a good job, or a bad job.

-- 
                The choice of a       Deliantra, the free code+content MORPG
      -----==-     _GNU_              <span class="clickylink"><a target="new" rel="nofollow" href="http://www.deliantra.net">http://www.deliantra.net</a></span>
      ----==-- _       generation
      ---==---&#40;_&#41;__  __ ____  __      Marc Lehmann
      --==---/ / _ \/ // /\ \/ /      schmorp@schmorp.de
      -=====/_/_//_/\_,_/ /_/\_\
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187498" href="/Public/Bug/Display.html?id=20830#txn-1187498">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;18:27:17&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187577" href="/Public/Bug/Display.html?id=20830#txn-1187577">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;12:48:31&nbsp;2013</span>
    <span class="description">cpan [...] audreyt.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> schmorp [...] schmorp.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1187577/626437/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/626437">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 260b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I agree with Marc&#39;s reasoning. Since the current non-conformant behavior
is documented as such, and we explicitly recommend people switching to
JSON::XS in the documentation, I&#39;m marking this ticket as &#34;Stalled&#34; and
suggest that we let it remain in this state.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187581" href="/Public/Bug/Display.html?id=20830#txn-1187581">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;12:48:33&nbsp;2013</span>
    <span class="description">cpan [...] audreyt.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187582" href="/Public/Bug/Display.html?id=20830#txn-1187582">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;12:48:34&nbsp;2013</span>
    <span class="description">cpan [...] audreyt.org -  Given to AUDREYT</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187615" href="/Public/Bug/Display.html?id=20830#txn-1187615">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;17:15:14&nbsp;2013</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> miyagawa [...] gmail.com, schmorp [...] schmorp.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1187615/626452/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/626452">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Mar 03 12:48:31 2013, AUDREYT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I agree with Marc&#39;s reasoning. Since the current non-conformant behavior
&gt; is documented as such, and we explicitly recommend people switching to
&gt; JSON::XS in the documentation, I&#39;m marking this ticket as &#34;Stalled&#34; and
&gt; suggest that we let it remain in this state.
</div>
I Closed this ticket because:

1. Marc opened it
2. Had a discussion about the problem with Miyagawa about how it needed to be fixed.
3. The last comment was from Miyagawa was that he disagreed there was a bug, but that maybe 
some better documentation was in order. 
4. Then this ticket was lost in an inaccessible RT queue since YAML::Syck not JSON::Syck is the 
primary module in this package.
5. When I rescued it and asked Marc for help, he informed me that he wanted to complain about 
the problem but had no interest in helping to fix it. 

Audrey, if you&#39;re interested in re-opening this, can you please provide me a documentation 
patch so we can close this out? This is the only outstanding item that you and Miyagawa agreed 
needed doing. Everything else was stated as a won&#39;t fix.

The repo is here: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/toddr/YAML-Syck/blob/master/lib/JSON/Syck.pm">https://github.com/toddr/YAML-Syck/blob/master/lib/JSON/Syck.pm</a></span> 

If you prefer though, just paste me a patch in this ticket. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187619" href="/Public/Bug/Display.html?id=20830#txn-1187619">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;17:15:34&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1187620" href="/Public/Bug/Display.html?id=20830#txn-1187620">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;17:15:35&nbsp;2013</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1725529" href="/Public/Bug/Display.html?id=20830#txn-1725529">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;11&nbsp;04:56:13&nbsp;2017</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1725529/927690/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/927690">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 73b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ticket migrated to github as <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/toddr/YAML-Syck/issues/33">https://github.com/toddr/YAML-Syck/issues/33</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1725530" href="/Public/Bug/Display.html?id=20830#txn-1725530">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;11&nbsp;04:56:14&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1725533" href="/Public/Bug/Display.html?id=20830#txn-1725533">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;11&nbsp;04:56:24&nbsp;2017</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.930977</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
