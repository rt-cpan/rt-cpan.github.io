<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34545 for Net-LibNIDS: Updates for libnids-1.19</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34545 for Net-LibNIDS: Updates for libnids-1.19</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-LibNIDS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-LibNIDS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-LibNIDS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-LibNIDS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-LibNIDS">Net-LibNIDS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34545</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-LibNIDS">Net-LibNIDS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">david [...] edeca.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
david [...] edeca.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-22838-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.01    </td>
  </tr>
  <tr id="CF-22839-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.1    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




update-for-newer-libnids.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/442523/216977/update-for-newer-libnids.patch">
Tue Apr 01 17:36:46 2008 (9.6k) by david [...] edeca.net
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/441453/216349/update-for-newer-libnids.patch">
Sat Mar 29 19:01:05 2008 (3.8k) by david [...] edeca.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=34545">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-441453" href="/Public/Bug/Display.html?id=34545#txn-441453">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;29&nbsp;19:01:05&nbsp;2008</span>
    <span class="description">david [...] edeca.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Updates for libnids-1.19</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/441453/216346/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/216346">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 829b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a patch that updates Net::LibNIDS slightly.  Versions of
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;=libnids-1.19 include the patch that was provided with Net::LibNIDS
</div>0.01.  This enables export of the previous packet header, used for timing.

libnids does not #define the name that was used previously, so
NIDS_MINOR is tested instead as a version check.

Currently, all 4 tests run successfully.  However, I haven&#39;t got round
to trying the module yet as I needed to fix this up first.  More testing
is needed and possible some perl magic, make reports &#34;Please specify
prototyping behavior for LibNIDS.xs &#40;see perlxs manual&#41;&#34; which should
probably be sorted.

Version 1.19 of libnids was released in 2004, so there should be no
problems with availability!  I propose that the previously used patch is
removed from the distribution.

I have also fixed a few typos.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> update-for-newer-libnids.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/441453/216349/update-for-newer-libnids.patch">Download update-for-newer-libnids.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -u Net-LibNIDS-0.01/Changes Net-LibNIDS-0.02/Changes
--- Net-LibNIDS-0.01/Changes	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/Changes	2008-03-29 21:59:48.000000000 +0000
@@ -1,5 +1,8 @@
 Revision history for Perl extension Lib::nids.
 
+0.02  Sat Mar 29 12:00:00 2008
+	- updated now that libnids exports last_hdr by default
+
 0.01  Sat Jun 12 12:13:38 2004
 	- original version; created by h2xs 1.22 with options
 		-a -a --name=Lib::nids --use-new-tests --skip-exporter --skip-autoloader /Users/sky/Documents/Projects/perlnids/include/nids.h
diff -u Net-LibNIDS-0.01/LibNIDS.pm Net-LibNIDS-0.02/LibNIDS.pm
--- Net-LibNIDS-0.01/LibNIDS.pm	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/LibNIDS.pm	2008-03-29 22:45:54.000000000 +0000
@@ -7,7 +7,7 @@
 
 our @ISA = qw&#40;&#41;;
 
-our $VERSION = &#39;0.01&#39;;
+our $VERSION = &#39;0.02&#39;;
 
 sub AUTOLOAD {
     # This AUTOLOAD is used to &#39;autoload&#39; constants from the constant&#40;&#41;
@@ -85,7 +85,7 @@
 
 =head1 DESCRIPTION
 
-The workflow of using libnids is to set all paremeters, then call init, set up a callback then run.
+The workflow of using libnids is to set all parameters, then call init, set up a callback then run.
 
 =head1 Net::LibNIDS::init&#40; &#41;
 
@@ -149,15 +149,15 @@
 
 =head2 $tcp_stream-&gt;lastpacket_sec
 
-Returns the seconds from epoch that this packet was recorded. Only available if libnids was compiled with the patch that comes with this package.
+Returns the seconds from epoch that this packet was recorded. Only available with libnids version &gt;= 1.19.
 
 =head2 $tcp_stream-&gt;lastpacket_usec
 
-Returns the microsecond fraction that this packet was recorded. Used together with $tcp_stream-&gt;lastpacket to get the most correct timestamp possible. Only available if libnids was compiled with the patch that comes with this package.
+Returns the microsecond fraction that this packet was recorded. Used together with $tcp_stream-&gt;lastpacket to get the most correct timestamp possible. Only available with libnids version &gt;= 1.19.
 
 =head2 $tcp_stream-&gt;server $tcp_stream-&gt;client
 
-Returns a Net::LibNIDS::tcp_stream::half object, corresponding for the client hald and the server half.
+Returns a Net::LibNIDS::tcp_stream::half object, corresponding for the client half and the server half.
 
 =head1 Net::LibNIDS::tcp_stream::half
 
@@ -307,6 +307,10 @@
 
 Not currently supported by this extension
 
+=head2 Note
+
+Previous versions of Net::LibNIDS included a patch against libnids in order to obtain packet timings.  This is no longer necessary as long as libnids-1.19 or greater is used.
+
 =head1 SEE ALSO
 
 libnids man page
@@ -317,6 +321,7 @@
 =head1 AUTHOR
 
 Arthur Bergman, E&lt;lt&gt;sky@nanisky.comE&lt;gt&gt;
+Modified for libnids &gt;= 1.19 by David Cannings, E&lt;lt&gt;david@edeca.netE&lt;gt&gt;
 
 =head1 COPYRIGHT AND LICENSE
 
diff -u Net-LibNIDS-0.01/LibNIDS.xs Net-LibNIDS-0.02/LibNIDS.xs
--- Net-LibNIDS-0.01/LibNIDS.xs	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/LibNIDS.xs	2008-03-29 22:44:15.000000000 +0000
@@ -80,12 +80,13 @@
 
 MODULE = Net::LibNIDS		PACKAGE = Net::LibNIDS::tcp_stream
 
-#ifdef NIDS_SAVES_LAST_PCAP_HDR
+# Export of last_pcap_header was added in libnids-1.19
+#if NIDS_MINOR&gt;=19
 IV
 lastpacket_sec&#40;obj&#41;
 	  SV* obj
 	CODE:
-	  RETVAL = last_pcap_header-&gt;ts.tv_sec;
+	  RETVAL = nids_last_pcap_header-&gt;ts.tv_sec;
 	OUTPUT:
 	  RETVAL
 
@@ -93,7 +94,7 @@
 lastpacket_usec&#40;obj&#41;
 	  SV* obj
 	CODE:
-	  RETVAL = last_pcap_header-&gt;ts.tv_usec;
+	  RETVAL = nids_last_pcap_header-&gt;ts.tv_usec;
 	OUTPUT:
 	  RETVAL
 
diff -u Net-LibNIDS-0.01/META.yml Net-LibNIDS-0.02/META.yml
--- Net-LibNIDS-0.01/META.yml	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/META.yml	2008-03-29 21:59:48.000000000 +0000
@@ -1,6 +1,6 @@
 #XXXXXXX This is a prototype!!!  It will change in the future!!! XXXXX#
 name:         Net-LibNIDS
-version:      0.01
+version:      0.02
 version_from: LibNIDS.pm
 installdirs:  site
 requires:
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-442523" href="/Public/Bug/Display.html?id=34545#txn-442523">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;01&nbsp;17:36:46&nbsp;2008</span>
    <span class="description">david [...] edeca.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> david [...] edeca.net</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/442523/216974/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/216974">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 443b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 29 19:01:05 2008, edeca wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s a patch that updates Net::LibNIDS slightly.  Versions of
<div class="message-stanza open">&gt; &gt;=libnids-1.19 include the patch that was provided with Net::LibNIDS
</div>&gt; 0.01.  This enables export of the previous packet header, used for timing.
</div>
An update to the patch, now supports multiproc to make libnids use a
separate thread for processing.  An example called example-new.pl that
works is included.  Some more cleanups.

David
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/442523/216977/update-for-newer-libnids.patch">Download update-for-newer-libnids.patch</a><br />
<span class="downloadcontenttype">text/x-diff 9.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Nu Net-LibNIDS-0.01/Changes Net-LibNIDS-0.02/Changes
--- Net-LibNIDS-0.01/Changes	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/Changes	2008-04-01 22:02:56.000000000 +0100
@@ -1,5 +1,8 @@
 Revision history for Perl extension Lib::nids.
 
+0.02  Sat Mar 29 12:00:00 2008
+	- updated now that libnids exports last_hdr by default, added multiproc option, some tidy up
+
 0.01  Sat Jun 12 12:13:38 2004
 	- original version; created by h2xs 1.22 with options
 		-a -a --name=Lib::nids --use-new-tests --skip-exporter --skip-autoloader /Users/sky/Documents/Projects/perlnids/include/nids.h
diff -Nu Net-LibNIDS-0.01/LibNIDS.pm Net-LibNIDS-0.02/LibNIDS.pm
--- Net-LibNIDS-0.01/LibNIDS.pm	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/LibNIDS.pm	2008-04-01 22:03:38.000000000 +0100
@@ -7,7 +7,7 @@
 
 our @ISA = qw&#40;&#41;;
 
-our $VERSION = &#39;0.01&#39;;
+our $VERSION = &#39;0.02&#39;;
 
 sub AUTOLOAD {
     # This AUTOLOAD is used to &#39;autoload&#39; constants from the constant&#40;&#41;
@@ -85,7 +85,7 @@
 
 =head1 DESCRIPTION
 
-The workflow of using libnids is to set all paremeters, then call init, set up a callback then run.
+The workflow of using libnids is to set all parameters, then call init, set up a callback then run.
 
 =head1 Net::LibNIDS::init&#40; &#41;
 
@@ -149,15 +149,15 @@
 
 =head2 $tcp_stream-&gt;lastpacket_sec
 
-Returns the seconds from epoch that this packet was recorded. Only available if libnids was compiled with the patch that comes with this package.
+Returns the seconds from epoch that this packet was recorded. Only available with libnids version &gt;= 1.19.
 
 =head2 $tcp_stream-&gt;lastpacket_usec
 
-Returns the microsecond fraction that this packet was recorded. Used together with $tcp_stream-&gt;lastpacket to get the most correct timestamp possible. Only available if libnids was compiled with the patch that comes with this package.
+Returns the microsecond fraction that this packet was recorded. Used together with $tcp_stream-&gt;lastpacket to get the most correct timestamp possible. Only available with libnids version &gt;= 1.19.
 
 =head2 $tcp_stream-&gt;server $tcp_stream-&gt;client
 
-Returns a Net::LibNIDS::tcp_stream::half object, corresponding for the client hald and the server half.
+Returns a Net::LibNIDS::tcp_stream::half object, corresponding to the client half and the server half.
 
 =head1 Net::LibNIDS::tcp_stream::half
 
@@ -221,6 +221,8 @@
 
 The pcap filter to apply on the packets. Note however that if you have fragmented packets you cannot use the pcap filter on for example ports, since fragmented ip packets might not contain enough tcp information to determine port.
 
+See the note in the libnids manpage for a workaround.
+
 =head2 n_tcp_streams &#40;Net::LibNIDS::param::set_n_tcp_streams&#40;numbers&#41; Net::LibNIDS::param::get_n_tcp_streams&#41;
 
 From libnids documentation:
@@ -256,6 +258,10 @@
 type of the interface libnids will listen on.
 Default value: -1.&#34;
 
+=head2 multiproc &#40;Net::LibNIDS::param::set_multiproc&#40;number&#41; Net::LibNIDS::param::get_multiproc&#41;
+
+If this is set to a non-zero value, libnids will create a new thread for packet processing.
+
 =head2 syslog
 
 Not supported by this extension
@@ -307,6 +313,10 @@
 
 Not currently supported by this extension
 
+=head2 Note
+
+Previous versions of Net::LibNIDS included a patch against libnids in order to obtain packet timings.  This is no longer necessary as long as libnids-1.19 or greater is used.
+
 =head1 SEE ALSO
 
 libnids man page
@@ -317,6 +327,7 @@
 =head1 AUTHOR
 
 Arthur Bergman, E&lt;lt&gt;sky@nanisky.comE&lt;gt&gt;
+Modified for libnids &gt;= 1.19 by David Cannings, E&lt;lt&gt;david@edeca.netE&lt;gt&gt;
 
 =head1 COPYRIGHT AND LICENSE
 
diff -Nu Net-LibNIDS-0.01/LibNIDS.xs Net-LibNIDS-0.02/LibNIDS.xs
--- Net-LibNIDS-0.01/LibNIDS.xs	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/LibNIDS.xs	2008-04-01 21:49:39.000000000 +0100
@@ -69,6 +69,10 @@
     return &#34;NIDS_CLOSE&#34;;
   case NIDS_RESET:
     return &#34;NIDS_RESET&#34;;
+  case NIDS_TIMED_OUT:
+    return &#34;NIDS_TIMED_OUT&#34;;
+  case NIDS_EXITING:
+    return &#34;NIDS_EXITING&#34;;
   default:
     return &#34;UNKNOWN&#34;;
   }     
@@ -80,12 +84,13 @@
 
 MODULE = Net::LibNIDS		PACKAGE = Net::LibNIDS::tcp_stream
 
-#ifdef NIDS_SAVES_LAST_PCAP_HDR
+# Export of last_pcap_header was added in libnids-1.19
+#if NIDS_MINOR&gt;=19
 IV
 lastpacket_sec&#40;obj&#41;
 	  SV* obj
 	CODE:
-	  RETVAL = last_pcap_header-&gt;ts.tv_sec;
+	  RETVAL = nids_last_pcap_header-&gt;ts.tv_sec;
 	OUTPUT:
 	  RETVAL
 
@@ -93,7 +98,7 @@
 lastpacket_usec&#40;obj&#41;
 	  SV* obj
 	CODE:
-	  RETVAL = last_pcap_header-&gt;ts.tv_usec;
+	  RETVAL = nids_last_pcap_header-&gt;ts.tv_usec;
 	OUTPUT:
 	  RETVAL
 
@@ -103,13 +108,13 @@
 lastpacket_sec&#40;obj&#41;
 	  SV* obj
 	CODE:
-	  croak&#40;&#34;You need a patched libnids that saves the last pcap header&#34;&#41;;
+	  croak&#40;&#34;You need libnids &gt;1.19 in order to use this function&#34;&#41;;
 
 void
 lastpacket_usec&#40;obj&#41;
 	  SV* obj
 	CODE:
-	  croak&#40;&#34;You need a patched libnids that saves the last pcap header&#34;&#41;;
+	  croak&#40;&#34;You need libnids &gt;1.19 in order to use this function&#34;&#41;;
 
 #endif
 
@@ -468,12 +473,20 @@
 	  CODE:
 	    nids_params.one_loop_less = one_loop_less;
 
+ # TODO: TEST THESE 
+ # TODO: What version of libnids were these added in?  Use preprocessor
+ #      to leave out those that aren&#39;t supported
 
+IV
+get_multiproc&#40;&#41;
+     CODE:
+       RETVAL = nids_params.multiproc;
+     OUTPUT:
+       RETVAL
 
-
-
-
-
-
-     
+void
+set_multiproc&#40;multiproc&#41;
+	    IV multiproc
+	  CODE:
+	    nids_params.multiproc = multiproc;
 
diff -Nu Net-LibNIDS-0.01/META.yml Net-LibNIDS-0.02/META.yml
--- Net-LibNIDS-0.01/META.yml	2008-03-29 21:59:48.000000000 +0000
+++ Net-LibNIDS-0.02/META.yml	2008-03-29 21:59:48.000000000 +0000
@@ -1,6 +1,6 @@
 #XXXXXXX This is a prototype!!!  It will change in the future!!! XXXXX#
 name:         Net-LibNIDS
-version:      0.01
+version:      0.02
 version_from: LibNIDS.pm
 installdirs:  site
 requires:
diff -Nu Net-LibNIDS-0.01/example-new.pl Net-LibNIDS-0.02/example-new.pl
--- Net-LibNIDS-0.01/example-new.pl	1970-01-01 01:00:00.000000000 +0100
+++ Net-LibNIDS-0.02/example-new.pl	2008-04-01 21:59:19.000000000 +0100
@@ -0,0 +1,94 @@
+#!/usr/bin/perl
+
+use Net::LibNIDS;
+use strict;
+use warnings;
+use Socket qw&#40;inet_ntoa&#41;;
+
+my $total_connections = 0;
+my $current_connections = 0;
+
+# This is an example of how to use Net::LibNIDS and not of decent perl coding!
+# Please report any bugs or suggestions on the cpan bug tracker.
+
+# Either set a device name &#40;requires priviledges&#41; or choose a filename
+# This script prints data to the terminal, it might be a bad idea to capture straight
+# from a network device.  Either filter below or load the HTTP sample capture from the t/ 
+# directory.
+#Net::LibNIDS::param::set_device&#40;&#39;eth0&#39;&#41;;
+Net::LibNIDS::param::set_filename&#40;&#39;t/http-test.dump&#39;&#41;;
+
+# Set a pcap filter, see the manpage for tcpdump for more information.  The manpage for
+# libnids explains why the &#39;or &#40;..&#41;&#39; is required.
+Net::LibNIDS::param::set_pcap_filter&#40;&#39;port 80 or &#40;ip[6:2] &#38; 0x1fff != 0&#41;&#39;&#41;;
+
+if &#40;!Net::LibNIDS::init&#40;&#41;&#41; {
+  warn &#34;Uh oh, libnids failed to initialise!\n&#34;;
+  warn &#34;Check you have successfully built and installed the module first.\n&#34;;
+  exit;
+}
+
+# Set the callback function and run libnids
+Net::LibNIDS::tcp_callback&#40;\&#38;collector &#41;;
+Net::LibNIDS::run&#40;&#41;;
+
+print &#34;Finished!  There were $total_connections connections in total, $current_connections of these were still established at the end.\n&#34;;
+
+
+sub collector {
+  my $args = shift;
+  #print &#34;Collector subroutine was called with state: &#34; . $args-&gt;state_string . &#34;\n&#34;;
+
+  # A new connection was established
+  if&#40;$args-&gt;state == Net::LibNIDS::NIDS_JUST_EST&#40;&#41;&#41; {
+    $total_connections++;
+    $current_connections++;
+
+    # Here you can specify whether or not to collect the data from this connection.  You could
+    # also filter using set_pcap_filter&#40;&#41;.
+    #if&#40;$args-&gt;server_ip eq &#39;127.0.0.1&#39; || $args-&gt;server_port eq &#39;1234&#39;&#41; {
+    #}
+
+    # By default, this script captures all traffic.
+    $args-&gt;server-&gt;collect_on&#40;&#41;;
+    $args-&gt;client-&gt;collect_on&#40;&#41;;
+
+    print &#34;New connection: &#34; . $args-&gt;client_ip . &#34;:&#34; . $args-&gt;client_port . &#34; -&gt; &#34; . $args-&gt;server_ip . &#34;:&#34; . $args-&gt;server_port;
+    print &#34; &#40;currently handling $current_connections connections&#41;\n&#34;;
+    return;
+
+  } elsif &#40;$args-&gt;state == Net::LibNIDS::NIDS_CLOSE&#40;&#41;&#41; {
+    print &#34;Connection from &#34; . $args-&gt;client_ip . &#34; was closed\n&#34;;
+    $current_connections--;
+    return;
+
+  } elsif &#40;$args-&gt;state == Net::LibNIDS::NIDS_RESET&#40;&#41;&#41; {
+    print &#34;Connection from &#34; . $args-&gt;client_ip . &#34; was reset\n&#34;;
+    $current_connections--;
+    return;
+
+  } elsif &#40;$args-&gt;state == Net::LibNIDS::NIDS_TIMED_OUT&#40;&#41;&#41; {
+    print &#34;Connection from &#34; . $args-&gt;client_ip . &#34; timed out\n&#34;;
+    $current_connections--;
+    return;
+
+  } elsif &#40;$args-&gt;state == Net::LibNIDS::NIDS_DATA&#40;&#41;&#41; {
+    # Data toward the server
+    if &#40;$args-&gt;server-&gt;count_new&#41; {
+      print $args-&gt;lastpacket_sec . &#34; &#34; . $args-&gt;client_ip . &#34;:&#34; . $args-&gt;client_port . &#34; -&gt; &#34; . $args-&gt;server_ip . &#34;:&#34; . $args-&gt;server_port . &#34; &#40;&#34; . $args-&gt;server-&gt;count_new . &#34; new, &#34; . $args-&gt;server-&gt;count . &#34; total, offset &#34; . $args-&gt;server-&gt;offset . &#34;&#41;\n&#34;;
+      print &#34;***\n&#34;;
+      print substr&#40;$args-&gt;server-&gt;data, 0, $args-&gt;server-&gt;count_new&#41;;
+      print &#34;***\n&#34;;
+      return;
+    } 
+
+    # Data toward the client
+    if &#40;$args-&gt;client-&gt;count_new&#41; {
+      print $args-&gt;lastpacket_sec . &#34; &#34; . $args-&gt;client_ip . &#34;:&#34; . $args-&gt;client_port . &#34; &lt;- &#34; . $args-&gt;server_ip . &#34;:&#34; . $args-&gt;server_port . &#34; &#40;&#34; . $args-&gt;client-&gt;count_new . &#34; new, &#34; . $args-&gt;client-&gt;count . &#34; total, offset &#34; . $args-&gt;client-&gt;offset . &#34;&#41;\n&#34;;
+      print &#34;***\n&#34;;
+      print substr&#40;$args-&gt;client-&gt;data, 0, $args-&gt;client-&gt;count_new&#41;;
+      print &#34;***\n&#34;;
+      return;
+    }
+  }
+}
Common subdirectories: Net-LibNIDS-0.01/fallback and Net-LibNIDS-0.02/fallback
Common subdirectories: Net-LibNIDS-0.01/t and Net-LibNIDS-0.02/t
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-798276" href="/Public/Bug/Display.html?id=34545#txn-798276">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;05:37:46&nbsp;2010</span>
    <span class="description">david [...] edeca.net -  Fixed in 0.1 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-798277" href="/Public/Bug/Display.html?id=34545#txn-798277">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;05:37:52&nbsp;2010</span>
    <span class="description">david [...] edeca.net -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-798278" href="/Public/Bug/Display.html?id=34545#txn-798278">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;05:39:38&nbsp;2010</span>
    <span class="description">david [...] edeca.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/798278/413842/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/413842">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 538b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 29 19:01:05 2008, edeca wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s a patch that updates Net::LibNIDS slightly.  Versions of
<div class="message-stanza open">&gt; &gt;=libnids-1.19 include the patch that was provided with Net::LibNIDS
</div>&gt; 0.01.  This enables export of the previous packet header, used for timing.
</div>
These fixes &#40;and others&#41; committed for 0.1.  See the tagged release at
github for more information and complete changelog since 0.01.

<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/edeca/Net-LibNIDS/tree/0.1">http://github.com/edeca/Net-LibNIDS/tree/0.1</a></span>

Some of the fixes in this release require libnids v1.24.  Please ensure
you have the latest version.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-798280" href="/Public/Bug/Display.html?id=34545#txn-798280">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;05:39:39&nbsp;2010</span>
    <span class="description">david [...] edeca.net -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-798288" href="/Public/Bug/Display.html?id=34545#txn-798288">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;05:43:12&nbsp;2010</span>
    <span class="description">david [...] edeca.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.501115</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
