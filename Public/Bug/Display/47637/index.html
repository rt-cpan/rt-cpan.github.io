<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #47637 for PathTools: File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #47637 for PathTools: File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PathTools">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PathTools">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PathTools">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PathTools">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PathTools">PathTools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">47637</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PathTools">PathTools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jkeenan [...] cpan.org

<br />
mschwern [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-24906-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.30    </td>
  </tr>
  <tr id="CF-24907-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Fix-for-rel2abs-when-inside-a-symlink-like-on-OS.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/629241/320374/0001-Fix-for-rel2abs-when-inside-a-symlink-like-on-OS.patch">
Tue Jul 07 01:39:20 2009 (2.3k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=47637">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-629238" href="/Public/Bug/Display.html?id=47637#txn-629238">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;01:19:35&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/629238/320367/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/320367">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 736b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve been noticing things failing on OS X because paths are in
/private/var rather than /var.  My CPAN build directory is inside /var.
 /var is really a symlink to /private/var, this is a normal OS X thing.
 When in /var, File::Spec-&gt;rel2abs&#40;&#41; will use /private/var as its base,
cwd&#40;&#41; will use /var/local and getcwd&#40;&#41; will report /private/var.

$ perl -wle &#39;use Cwd;  print getcwd&#39;
/private/var/local
$ perl -wle &#39;use Cwd;  print cwd&#39;
/var/local
$ perl -wle &#39;use File::Spec;  print File::Spec-&gt;rel2abs&#40;&#34;.&#34;&#41;&#39;
/private/var/local

This is because getcwd&#40;&#41; walks up the directory tree while cwd&#40;&#41; will
look at $PWD.

The File::Spec-&gt;rel2abs docs state:

  If $base is not present or &#39;&#39;, then Cwd::cwd&#40;&#41; is used.

But the code uses getcwd&#40;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-629241" href="/Public/Bug/Display.html?id=47637#txn-629241">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;01:39:20&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> &#34;steven.pritchard&#34;, steve [...] silug.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/629241/320371/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/320371">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is a patch.  It adds a test and changes File::Spec-&gt;_cwd to use
cwd&#40;&#41; as documented.

I traced the change to getcwd&#40;&#41; back through the history...

 - File::Spec on Unix now uses Cwd::getcwd&#40;&#41; rather than Cwd::cwd&#40;&#41; to
   get the current directory because I guess someone on p5p thought it
   was more appropriate.

And the upstream blead change...

commit 7241d76ad1edf173ef75728426b7546b242afbdd
Author: Abhijit Menon-Sen &lt;ams@wiw.org&gt;
Date:   Wed Aug 8 16:28:40 2007 +0000

    From #43633: Cwd::cwd&#40;&#41; use in File::Spec::Unix use causes
unnecessary fork&#40;
&#41;
    
    p4raw-id: //depot/perl@31686

diff --git a/lib/File/Spec/Unix.pm b/lib/File/Spec/Unix.pm
index 5674731..98a24dd 100644
--- a/lib/File/Spec/Unix.pm
+++ b/lib/File/Spec/Unix.pm
@@ -475,7 +475,7 @@ L&lt;File::Spec&gt;
 # File::Spec subclasses use this.
 sub _cwd {
     require Cwd;
-    Cwd::cwd&#40;&#41;;
+    Cwd::getcwd&#40;&#41;;
 }
 
Which was an optimization but it broke stuff so I guess we have to
revert it.
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Public/Bug/Display.html?id=43633">http://rt.perl.org/rt3/Public/Bug/Display.html?id=43633</a></span>
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/629241/320374/0001-Fix-for-rel2abs-when-inside-a-symlink-like-on-OS.patch">Download 0001-Fix-for-rel2abs-when-inside-a-symlink-like-on-OS.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 04fcc2cb19da66b5bb4d0c66a0712eaa46fb6966 Mon Sep 17 00:00:00 2001
From: Michael G. Schwern &lt;schwern@pobox.com&gt;
Date: Mon, 6 Jul 2009 22:38:23 -0700
Subject: [PATCH] Fix for rel2abs&#40;&#41; when inside a symlink, like on OS X

---
 Changes                |    7 +++++++
 MANIFEST               |    1 +
 lib/File/Spec/Unix.pm  |    2 +-
 t/rel2abs_vs_symlink.t |   34 ++++++++++++++++++++++++++++++++++
 4 files changed, 43 insertions&#40;+&#41;, 1 deletions&#40;-&#41;
 create mode 100644 t/rel2abs_vs_symlink.t

diff --git a/Changes b/Changes
index 29d0113..52f0612 100644
--- a/Changes
+++ b/Changes
@@ -1,5 +1,12 @@
 Revision history for Perl distribution PathTools.
 
+Next
+  Bug Fix
+  * Revert optimization introduced by [rt.perl.org 43633] which broke
+    File::Spec-&gt;rel2abs&#40;&#41; when under a symlink [rt.cpan.org 47637].
+    Broke in 3.2501
+
+
 3.30 - Sun May 10 10:55:00 2009
 
 - Promote to stable release.
diff --git a/MANIFEST b/MANIFEST
index a1cf764..f43e1aa 100644
--- a/MANIFEST
+++ b/MANIFEST
@@ -25,6 +25,7 @@ t/lib/Test/More.pm
 t/lib/Test/Simple.pm
 t/lib/Test/Tutorial.pod
 t/rel2abs2rel.t
+t/rel2abs_vs_symlink.t
 t/Spec.t
 t/taint.t
 t/tmpdir.t
diff --git a/lib/File/Spec/Unix.pm b/lib/File/Spec/Unix.pm
index 8fd2320..f3042df 100644
--- a/lib/File/Spec/Unix.pm
+++ b/lib/File/Spec/Unix.pm
@@ -480,7 +480,7 @@ L&lt;File::Spec&gt;
 # File::Spec subclasses use this.
 sub _cwd {
     require Cwd;
-    Cwd::getcwd&#40;&#41;;
+    Cwd::cwd&#40;&#41;;
 }
 
 
diff --git a/t/rel2abs_vs_symlink.t b/t/rel2abs_vs_symlink.t
new file mode 100644
index 0000000..cfbde01
--- /dev/null
+++ b/t/rel2abs_vs_symlink.t
@@ -0,0 +1,34 @@
+#!/usr/bin/perl -w
+
+# Test that rel2abs&#40;&#41; works correctly when the process is under a symlink
+# See [rt.cpan.org 47637]
+
+use strict;
+
+use File::Path;
+use File::Spec;
+
+# Do this to simulate already being inside a symlinked directory
+# and having $ENV{PWD} set.
+use Cwd qw&#40;chdir&#41;;
+
+use Test::More;
+
+plan skip_all =&gt; &#34;needs symlink&#40;&#41;&#34; if !eval { symlink&#40;&#34;&#34;, &#34;&#34;&#41;; 1 };
+
+plan tests =&gt; 1;
+
+my $real_dir = &#34;for_rel2abs_test&#34;;
+my $symlink  = &#34;link_for_rel2abs_test&#34;;
+mkdir $real_dir or die &#34;Can&#39;t make $real_dir: $!&#34;;
+END { rmtree $real_dir }
+
+symlink $real_dir, $symlink or die &#34;Can&#39;t symlink $real_dir =&gt; $symlink: $!&#34;;
+END { unlink $symlink }
+
+chdir $symlink or die &#34;Can&#39;t chdir into $symlink: $!&#34;;
+
+like&#40; File::Spec-&gt;rel2abs&#40;&#34;.&#34;&#41;, qr/$symlink/ &#41;;
+
+# So the unlinking works
+chdir &#34;..&#34;;
-- 
1.6.2.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-629244" href="/Public/Bug/Display.html?id=47637#txn-629244">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;01:39:22&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-629725" href="/Public/Bug/Display.html?id=47637#txn-629725">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;18:39:16&nbsp;2009</span>
    <span class="description">steve [...] silug.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/629725/320636/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/320636">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 782b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 07 01:39:20 2009, MSCHWERN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     From #43633: Cwd::cwd&#40;&#41; use in File::Spec::Unix use causes
&gt; unnecessary fork&#40;
&gt; &#41;
&gt;     
&gt;     p4raw-id: //depot/perl@31686
&gt; 
&gt; diff --git a/lib/File/Spec/Unix.pm b/lib/File/Spec/Unix.pm
&gt; index 5674731..98a24dd 100644
&gt; --- a/lib/File/Spec/Unix.pm
&gt; +++ b/lib/File/Spec/Unix.pm
&gt; @@ -475,7 +475,7 @@ L&lt;File::Spec&gt;
&gt;  # File::Spec subclasses use this.
&gt;  sub _cwd {
&gt;      require Cwd;
&gt; -    Cwd::cwd&#40;&#41;;
&gt; +    Cwd::getcwd&#40;&#41;;
&gt;  }
&gt;  
&gt; Which was an optimization but it broke stuff so I guess we have to
&gt; revert it.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Public/Bug/Display.html?id=43633">http://rt.perl.org/rt3/Public/Bug/Display.html?id=43633</a></span>
</div>
There has to be a better fix.  This causes an unnecessary fork&#40;&#41; and
exec&#40;&#41; of /bin/pwd for every use of FileHandle.  The performance penalty
is insane.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-629744" href="/Public/Bug/Display.html?id=47637#txn-629744">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;19:56:58&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> mschwern [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Jul 2009 16:56:34 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/629744/320644/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/320644">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 706b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Steven Pritchard via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There has to be a better fix.  This causes an unnecessary fork&#40;&#41; and
&gt; exec&#40;&#41; of /bin/pwd for every use of FileHandle.  The performance penalty
&gt; is insane.
</div>
Can you provide a benchmark?  Maybe we can fix FileHandle or IO::File.

I see only calls to File::Spec-&gt;catfile and only in IO::Dir.  IO::File
unnecessarily uses File::Spec.  FileHandle-&gt;new makes no call to
File::Spec::Unix-&gt;_cwd.

I see 5.8.8&#39;s IO::File had a call to rel2abs, but 5.10.0 does not.  The log
says this was fixed in IO 1.13_01.


-- 
You know what the chain of command is? It&#39;s the chain I go get and beat you
with &#39;til you understand who&#39;s in ruttin&#39; command here.
        -- Jayne Cobb, &#34;Firefly&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-629749" href="/Public/Bug/Display.html?id=47637#txn-629749">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;07&nbsp;20:07:18&nbsp;2009</span>
    <span class="description">kenahoo [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a  symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Jul 2009 19:06:58 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Williams &lt;kenahoo [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/629749/320647/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/320647">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 528b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Jul 7, 2009 at 5:39 PM, Steven Pritchard via
RT&lt;bug-PathTools@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There has to be a better fix.  This causes an unnecessary fork&#40;&#41; and
&gt; exec&#40;&#41; of /bin/pwd for every use of FileHandle.  The performance penalty
&gt; is insane.
</div>
For that matter, the entire Cwd module is insane.  For instance, last
time I benchmarked the Module::Build test suite, the biggest consumer
was cwd&#40;&#41; and/or friends.  I think we need to have a serious look at
what OS-level utilities do &#40;e.g. the source of `pwd`&#41; and copy it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700055" href="/Public/Bug/Display.html?id=47637#txn-700055">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;30&nbsp;23:49:55&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/700055/360940/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/360940">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 225b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Seeing as how the original reason for the optimization
&#40;FileHandle/IO::File&#41; has gone away, could this patch be applied?  It
would make testing modules inside /var &#40;which is really a symlink to
/private/var&#41; on OS X not fail.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700339" href="/Public/Bug/Display.html?id=47637#txn-700339">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;01&nbsp;10:44:39&nbsp;2009</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/700339/361123/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361123">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 135b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Done, thanks for your persistence.  Checked in as revision 13621.

Any chance you &#40;under the aegis of P5P user&#41; want to make a release?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700342" href="/Public/Bug/Display.html?id=47637#txn-700342">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;01&nbsp;10:44:41&nbsp;2009</span>
    <span class="description">kwilliams [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700361" href="/Public/Bug/Display.html?id=47637#txn-700361">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;01&nbsp;11:07:09&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 01 Dec 2009 16:46:59 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/700361/361134/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361134">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 430b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ken Williams via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PathTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=47637">https://rt.cpan.org/Ticket/Display.html?id=47637</a></span> &gt;
&gt; 
&gt; Done, thanks for your persistence.  Checked in as revision 13621.
&gt; 
&gt; Any chance you &#40;under the aegis of P5P user&#41; want to make a release?
</div>
I could cut a release tonight.

Schwern, do you think this would be appropriate for 5.12, i.e. an 
important enough bug fix to bother Jesse about?

Cheers,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700362" href="/Public/Bug/Display.html?id=47637#txn-700362">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;01&nbsp;11:07:09&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700468" href="/Public/Bug/Display.html?id=47637#txn-700468">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;01&nbsp;15:48:31&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 01 Dec 2009 12:47:50 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/700468/361194/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361194">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 458b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Steffen Mueller via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Schwern, do you think this would be appropriate for 5.12, i.e. an 
&gt; important enough bug fix to bother Jesse about?
</div>
It would be nice, but we&#39;ve been living with this bug for a while so there&#39;s 
no urgency.


-- 
184. When operating a military vehicle I may *not* attempt something
      &#34;I saw in a cartoon&#34;.
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700675" href="/Public/Bug/Display.html?id=47637#txn-700675">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;02&nbsp;04:33:48&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 02 Dec 2009 10:33:26 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/700675/361321/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361321">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PathTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=47637">https://rt.cpan.org/Ticket/Display.html?id=47637</a></span> &gt;
&gt; 
&gt; Steffen Mueller via RT wrote:
<div class="message-stanza open">&gt;&gt; Schwern, do you think this would be appropriate for 5.12, i.e. an 
&gt;&gt; important enough bug fix to bother Jesse about?
</div>&gt; 
&gt; It would be nice, but we&#39;ve been living with this bug for a while so there&#39;s 
&gt; no urgency.
</div>
I&#39;m getting test failure on a rather boring linux box without symlinks 
involved in the build path:

ERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; 
&#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/abs_path.t ............ 1/16 stat&#40;dne&#41;: No such file or directory at 
t/abs_path.t line 65
stat&#40;dne/sub_dne&#41;: No such file or directory at t/abs_path.t line 70
t/abs_path.t ............ ok
t/crossplatform.t ....... ok
t/cwd.t ................. ok
t/Functions.t ........... ok
t/rel2abs2rel.t ......... ok
t/rel2abs_vs_symlink.t .. 1/1
#   Failed test at t/rel2abs_vs_symlink.t line 31.
#                   &#39;/home/tsee/perl/PathTools/trunk/for_rel2abs_test&#39;
#     doesn&#39;t match &#39;&#40;?-xism:link_for_rel2abs_test&#41;&#39;
# Looks like you failed 1 test of 1.
t/rel2abs_vs_symlink.t .. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/1 subtests
t/Spec.t ................ ok
t/taint.t ............... ok
t/tmpdir.t .............. ok
t/win32.t ............... skipped: this is not win32

Cheers,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700697" href="/Public/Bug/Display.html?id=47637#txn-700697">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;02&nbsp;06:20:44&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 02 Dec 2009 03:20:08 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/700697/361335/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361335">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1011b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Steffen Mueller via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m getting test failure on a rather boring linux box without symlinks 
&gt; involved in the build path:
</div>
Can you figure out what *Cwd::cwd is pointing at?  Simplest way is to check 
what \&#38;Cwd::cwd is in the debugger.

$ perl -dwle &#39;use Cwd; 1&#39;

Loading DB routines from perl5db.pl version 1.32
Editor support available.

Enter h or `h h&#39; for help, or `man perldebug&#39; for more help.

main::&#40;-e:1&#41;:   use Cwd; 1
   DB&lt;1&gt; x \&#38;Cwd::cwd
0  CODE&#40;0x8a7244&#41;
    -&gt; &#38;Cwd::_backtick_pwd in 
/usr/local/lib/perl5/5.10.1/darwin-thread-multi-64int-ld-2level/Cwd.pm:360-371

I can reproduce if I hard code that to the other option, Cwd::getcwd.  You 
have no /bin/pwd?

I&#39;ll look into what magic pwd does and see if we can make use of that.


-- 
151. The proper way to report to my Commander is &#34;Specialist Schwarz,
      reporting as ordered, Sir&#34; not &#34;You can&#39;t prove a thing!&#34;
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700731" href="/Public/Bug/Display.html?id=47637#txn-700731">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;02&nbsp;07:59:23&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 02 Dec 2009 13:58:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/700731/361356/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361356">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PathTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=47637">http://rt.cpan.org/Ticket/Display.html?id=47637</a></span> &gt;
&gt; Can you figure out what *Cwd::cwd is pointing at?  Simplest way is to check 
&gt; what \&#38;Cwd::cwd is in the debugger.
&gt; 
&gt; $ perl -dwle &#39;use Cwd; 1&#39;
&gt; 
&gt; Loading DB routines from perl5db.pl version 1.32
&gt; Editor support available.
&gt; 
&gt; Enter h or `h h&#39; for help, or `man perldebug&#39; for more help.
&gt; 
&gt; main::&#40;-e:1&#41;: use Cwd; 1
&gt;    DB&lt;1&gt; x \&#38;Cwd::cwd
&gt; 0  CODE&#40;0x8a7244&#41;
&gt;     -&gt; &#38;Cwd::_backtick_pwd in 
&gt; /usr/local/lib/perl5/5.10.1/darwin-thread-multi-64int-ld-2level/Cwd.pm:360-371
</div>
I felt at liberty to add a few -I&#39;s because I haven&#39;t installed the new 
version yet. By the way, this is an ubuntu 9.04 system perl 5.10.0.

perl -Iblib/arch -Iblib/lib -dwle &#39;use Cwd; 1&#39;

Loading DB routines from perl5db.pl version 1.3
Editor support available.

Enter h or `h h&#39; for help, or `man perldebug&#39; for more help.

main::&#40;-e:1&#41;:   use Cwd; 1
   DB&lt;1&gt;  x \&#38;Cwd::cwd
0  CODE&#40;0x1713b98&#41;
    -&gt; &#38;Cwd::_backtick_pwd in blib/lib/Cwd.pm:360-371


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can reproduce if I hard code that to the other option, Cwd::getcwd.  You 
&gt; have no /bin/pwd?
</div>
Umm. I have that.
tsee@l3tsee:~/perl/PathTools/trunk$ which pwd
/bin/pwd

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll look into what magic pwd does and see if we can make use of that.
</div>
I&#39;m a little starved for good debugging time and don&#39;t have a good grasp 
of the issues involved in pwd stuff, but if I can test anything else for 
you, just let me know.

Thanks for looking into this.

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-701045" href="/Public/Bug/Display.html?id=47637#txn-701045">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;02&nbsp;18:24:36&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 02 Dec 2009 15:24:18 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/701045/361537/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361537">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Steffen Mueller via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Loading DB routines from perl5db.pl version 1.3
&gt; Editor support available.
&gt; 
&gt; Enter h or `h h&#39; for help, or `man perldebug&#39; for more help.
&gt; 
&gt; main::&#40;-e:1&#41;:   use Cwd; 1
&gt;    DB&lt;1&gt;  x \&#38;Cwd::cwd
&gt; 0  CODE&#40;0x1713b98&#41;
&gt;     -&gt; &#38;Cwd::_backtick_pwd in blib/lib/Cwd.pm:360-371
</div>
Weird.  /bin/pwd should be referencing PWD.

Anyhow, its all screwed.  As far as I can tell, the only way you can figure 
out that you&#39;re inside a symlink is by checking PWD and Perl doesn&#39;t keep that 
consistent.  As soon as your program chdirs Cwd::_backtick_pwd&#40;&#41; won&#39;t know 
its inside the symlink.  So without a core change to chdir&#40;&#41; to always track 
the cwd [1] Cwd consistently knowing its inside a symlink is not possible.

Stepping back, the larger problem is not that Cwd isn&#39;t seeing the symlink, 
its that Cwd is inconsistent.  Not only across versions but also across 
operating systems and across all the maddeningly different flavors of cwd 
functions.  Code compares Cwd::cwd&#40;&#41; with File::Spec-&gt;rel2abs&#40;&#41; &#40;using getcwd&#41; 
and gets different results.

Unfortunately, the function folks will tend most to reach for, cwd&#40;&#41;, is also 
the potentially slowest and least consistent.  For example, Path-Class 
01-basic.t does this.  Its an easy trap to fall into.

So I&#39;m not sure what to do, except that this patch should be reverted as it 
just shuffles the inconsistency around.


[1] Which would make most of Cwd unnecessary, so perhaps it should be considered.

-- 
44. I am not the atheist chaplain.
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-701204" href="/Public/Bug/Display.html?id=47637#txn-701204">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;03&nbsp;05:00:17&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 03 Dec 2009 10:59:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/701204/361619/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361619">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 455b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I&#39;m not sure what to do, except that this patch should be reverted as it 
&gt; just shuffles the inconsistency around.
</div>
That&#39;s what you did, right? But then tests started failing, so we&#39;re in 
no-mans land. Or am I misunderstanding things?

By the way: Jesse has agreed to absorb a PathTools into blead if the 
ONLY change is reverting the original change. Anything else will need 
another nod from him.

Cheers,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-701622" href="/Public/Bug/Display.html?id=47637#txn-701622">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;04&nbsp;02:46:01&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 03 Dec 2009 23:45:41 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/701622/361816/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361816">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 666b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Steffen Mueller via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=47637">https://rt.cpan.org/Ticket/Display.html?id=47637</a></span> &gt;
&gt; 
&gt; Michael G Schwern via RT wrote:
<div class="message-stanza open">&gt;&gt; So I&#39;m not sure what to do, except that this patch should be reverted as it 
&gt;&gt; just shuffles the inconsistency around.
</div>&gt; 
&gt; That&#39;s what you did, right? But then tests started failing, so we&#39;re in 
&gt; no-mans land. Or am I misunderstanding things?
</div>
Sorry, I meant revert my patch.  Bring it back to what it was doing, using 
Cwd::getcwd.  getcwd&#40;&#41; is at least a bit more consistent than cwd&#40;&#41;.


-- 
But there&#39;s no sense crying over every mistake.
You just keep on trying till you run out of cake.
     -- Jonathan Coulton, &#34;Still Alive&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-701638" href="/Public/Bug/Display.html?id=47637#txn-701638">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;04&nbsp;03:42:39&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 04 Dec 2009 09:42:17 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/701638/361822/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361822">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PathTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=47637">http://rt.cpan.org/Ticket/Display.html?id=47637</a></span> &gt;
&gt; 
&gt; Steffen Mueller via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=47637">https://rt.cpan.org/Ticket/Display.html?id=47637</a></span> &gt;
&gt;&gt;
&gt;&gt; Michael G Schwern via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; So I&#39;m not sure what to do, except that this patch should be reverted as it 
&gt;&gt;&gt; just shuffles the inconsistency around.
</div>&gt;&gt; That&#39;s what you did, right? But then tests started failing, so we&#39;re in 
&gt;&gt; no-mans land. Or am I misunderstanding things?
</div>&gt; 
&gt; Sorry, I meant revert my patch.  Bring it back to what it was doing, using 
&gt; Cwd::getcwd.  getcwd&#40;&#41; is at least a bit more consistent than cwd&#40;&#41;.
</div>
Okay, I switched back to using getcwd&#40;&#41; and still get the symlinks test 
failures. But then again, that is probably expected as you added those 
tests specifically with the getcwd-&gt;cwd change. Right? Should I remove 
the tests?

Sorry for being a little confused about this. Cwd is one of those things 
I wouldn&#39;t want to be involved in any more than necessary :&#41;

Cheers,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-701704" href="/Public/Bug/Display.html?id=47637#txn-701704">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;04&nbsp;07:48:46&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #47637] File::Spec-&gt;rel2abs&#40;&#41; incorrect inside a symlinked dir.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 04 Dec 2009 04:16:47 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/701704/361855/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361855">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 527b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Steffen Mueller via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Okay, I switched back to using getcwd&#40;&#41; and still get the symlinks test 
&gt; failures. But then again, that is probably expected as you added those 
&gt; tests specifically with the getcwd-&gt;cwd change. Right? Should I remove 
&gt; the tests?
</div>
Yes, pull the whole patch, tests and all.


-- 
184. When operating a military vehicle I may *not* attempt something
      &#34;I saw in a cartoon&#34;.
     -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
            <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1292623" href="/Public/Bug/Display.html?id=47637#txn-1292623">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;20:53:12&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1292623/684876/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684876">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 563b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 04 07:48:46 2009, schwern@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Steffen Mueller via RT wrote:
<div class="message-stanza open">&gt; &gt; Okay, I switched back to using getcwd&#40;&#41; and still get the symlinks test 
&gt; &gt; failures. But then again, that is probably expected as you added those 
&gt; &gt; tests specifically with the getcwd-&gt;cwd change. Right? Should I remove 
&gt; &gt; the tests?
</div>&gt; 
&gt; Yes, pull the whole patch, tests and all.
&gt; 
&gt; 
</div>
Michael, Ken, Steffen:

Discussion in this ticket appears to have petered out four years ago.  Are there still issues which need to be addressed?

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1292662" href="/Public/Bug/Display.html?id=47637#txn-1292662">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;22:29:17&nbsp;2013</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1292662/684897/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684897">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 59b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have less than no clue.  I&#39;d support closing this ticket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1294247" href="/Public/Bug/Display.html?id=47637#txn-1294247">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;26&nbsp;18:44:16&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Requestor JKEENAN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.944335</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
