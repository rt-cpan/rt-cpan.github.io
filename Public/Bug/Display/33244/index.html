<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33244 for created-by-incident-perl: -x operator fails under 5.10</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33244 for created-by-incident-perl: -x operator fails under 5.10</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/created-by-incident-perl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/created-by-incident-perl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/created-by-incident-perl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/created-by-incident-perl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>






<div class="error">
  <div class="titlebox error " id="">
  <div class="titlebox-title">
    <span class="left">Queue is disabled</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--error----UXVldWUgaXMgZGlzYWJsZWQ_---0">


This queue is disabled and you may not create new tickets in it.  Disabled queues are usually because the distribution was merged with another or changed names.  Sometimes they are the end result of a bad autocreate from PAUSE data before anyone noticed.
    <hr class="clear" />
  </div>
</div>




</div>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33244</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/created-by-incident-perl/Active/">created-by-incident-perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
persicom [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-219744-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
5.10.0    </td>
  </tr>
  <tr id="CF-219745-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;13&nbsp;21:35:29&nbsp;2008</span>
    <span class="description">persicom [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> -x operator fails under 5.10</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think I&#39;ve found a problem with the filetest pragma. I found it via
this code in the Makefile.PL of DBD-Oracle-1.20:

sub find_bin{
    use filetest &#39;access&#39;;
    my $bin = shift;
    my $path_sep = $Config{path_sep};
    foreach &#40;split&#40;/\Q$path_sep/, $ENV{PATH}&#41;&#41;{
      return &#34;$_/$bin&#34; if -x &#34;$_/$bin&#34;; 
    }
    return undef;
}

The problem is that when this code does find an executable file, the
-x test still fails, or, rather, does not succeed.

I have isolated the problem with two demonstration programs:

This one behaves as expected:
## x_default.pl
## using the default file test operators
sub find_bin {
    ####use filetest &#39;access&#39;;
    my $tgt = $_[0];
    my $fresult = -f $tgt;
    my $xresult = -x $tgt;
    my $result = $fresult &#38;&#38; $xresult;
    if &#40;$result&#41; {
        return 1;
    } else {
        return 0;
    }
}
print &#34;using default file testing\n&#34;;
if &#40;find_bin&#40;&#39;/opt/oracle/product/bin/sqlplus&#39;&#41;&#41;{
    print &#34;file tests as executable\n&#34;;
}else {
    print &#34;file tests as NOT executable\n&#34;;
}
## end

Executing the program yields:
$ perl x_default.pl 
using default file testing
file tests as executable

This one does not behave properly:
## x_pragma.pl
## Using the pragma
sub find_bin {
    use filetest &#39;access&#39;;
    my $tgt = $_[0];
    my $fresult = -f $tgt;
    my $xresult = -x $tgt;
    my $result = $fresult &#38;&#38; $xresult;
    if &#40;$result&#41; {
        return 1;
    } else {
        return 0;
    }
}
print &#34;using pragma file testing\n&#34;;
if &#40;find_bin&#40;&#39;/opt/oracle/product/bin/sqlplus&#39;&#41;&#41;{
    print &#34;file tests as executable\n&#34;;
}else {
    print &#34;file tests as NOT executable\n&#34;;
}
## end

Executing yields:
$ perl x_pragma.pl  
using pragma file testing
file tests as NOT executable

It appears as if the 

        use filetest &#39;access&#39;

pragma is broken in perl 5.10.

perl -V below:

Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
  Platform:
    osname=solaris, osvers=2.8, archname=sun4-solaris-thread-multi
    uname=&#39;sunos nydux-25k105 5.8 generic_117350-45 sun4u sparc
sunw,sun-fire-15000 &#39;
    config_args=&#39;-de -Dusethreads -Dcc=cc
-Dprefix=/home/persicom/nylux-portiadev/cvs_sandbox/opt/perl.v5.10.0.build
-Dhtml1dir=/home/persicom/nylux-portiadev/cvs_sandbox/opt/perl.v5.10.0.build/html/html1
-Dhtml3dir=/home/persicom/nylux-portiadev/cvs_sandbox/opt/perl.v5.10.0.build/html/html3
-Dinstallusrbinperl=undef -Dcf_email=matthew.persico@lazard.com
-Dperladmin=matthew.persico@lazard.com&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=undef, use64bitall=undef, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-D_REENTRANT -I/usr/local/include
-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64&#39;,
    optimize=&#39;-O&#39;,
    cppflags=&#39;-D_REENTRANT -I/usr/local/include&#39;
    ccversion=&#39;Sun C 5.8 2005/10/13&#39;, gccversion=&#39;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=4321
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39; -L/usr/lib -L/usr/ccs/lib
-L/opt/SUNWspro_11/prod/lib/v8plus -L/opt/SUNWspro_11/prod/lib -L/lib
-L/usr/local/lib &#39;
    libpth=/usr/lib /usr/ccs/lib /opt/SUNWspro_11/prod/lib/v8plus
/opt/SUNWspro_11/prod/lib /lib /usr/local/lib
    libs=-lsocket -lnsl -ldl -lm -lpthread -lc
    perllibs=-lsocket -lnsl -ldl -lm -lpthread -lc
    libc=/lib/libc.so, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39;-KPIC&#39;, lddlflags=&#39;-G -L/usr/lib -L/usr/ccs/lib
-L/opt/SUNWspro_11/prod/lib/v8plus -L/opt/SUNWspro_11/prod/lib -L/lib
-L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP USE_ITHREADS
                        USE_LARGE_FILES USE_PERLIO USE_REENTRANT_API
  Built under solaris
  Compiled at Feb 13 2008 00:41:57
  @INC:
   
/home/persicom/nylux-portiadev/cvs_sandbox/opt/perl.v5.10.0.build/lib/5.10.0/sun4-solaris-thread-multi
   
/home/persicom/nylux-portiadev/cvs_sandbox/opt/perl.v5.10.0.build/lib/5.10.0
   
/home/persicom/nylux-portiadev/cvs_sandbox/opt/perl.v5.10.0.build/lib/site_perl/5.10.0/sun4-solaris-thread-multi
   
/home/persicom/nylux-portiadev/cvs_sandbox/opt/perl.v5.10.0.build/lib/site_perl/5.10.0
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;14:33:38&nbsp;2008</span>
    <span class="description">persicom [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> persicom [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After a bit of back-and-forth in perl5-porters, I came up with a better
example:

Create t.pl as:
## Using the pragma
sub find_bin {
use filetest &#39;access&#39;;
my $tgt = $_[0];
my $fresult = -f $tgt;
my $xresult = -x $tgt;
my $result = $fresult &#38;&#38; $xresult;
if &#40;$result&#41; {
return 1;
} else {
return 0;
}
}
print &#34;using pragma file testing\n&#34;;
if &#40;find_bin&#40;$ARGV[0]&#41;&#41; {
print &#34;file tests as executable\n&#34;;
}else {
print &#34;file tests as NOT executable\n&#34;;
}

Then run:

$ perl -e &#39;print $],&#34;\n&#34;&#39;
5.006001

$ ls -la foo
-rwxrwxr-x   1 persicom develop        0 Feb 14 14:07 foo

$ perl t.pl foo                            
using pragma file testing
file tests as executable

$ ls -la /opt/oracle/product/bin/sqlplus
-rwxr-x--x   1 oracle   dba       954104 Oct 19  2005
/opt/oracle/product/bin/sqlplus

$ perl t.pl /opt/oracle/product/bin/sqlplus    
using pragma file testing
file tests as executable

###
### So, under 5.6.1, works as expected
###

$ swap_perl 5.10.0
Swapping out Perl 5.6.1
Swapping in Perl 5.10.0

$ perl -e &#39;print $],&#34;\n&#34;&#39;                  
5.010000

$ ls -la foo                               
-rwxrwxr-x   1 persicom develop        0 Feb 14 14:07 foo

$ perl t.pl foo                            
using pragma file testing
file tests as executable

$ ls -la /opt/oracle/product/bin/sqlplus   
-rwxr-x--x   1 oracle   dba       954104 Oct 19  2005
/opt/oracle/product/bin/sqlplus

$ perl t.pl /opt/oracle/product/bin/sqlplus
using pragma file testing
file tests as NOT executable

## Different behaviour under 5.10 - so what&#39;s different about 
## the sqlplus file vs the foo file?

$ chmod o-r foo ## :-&#41;

$ dir foo
-rwxrwx--x   1 persicom develop        0 Feb 14 14:07 foo

$ perl t.pl /opt/oracle/product/bin/sqlplus
using pragma file testing
file tests as NOT executable

## Bingo. It appears that filetest tries to be smart and says,
## &#34;Even if the execute bit is set, if the file isn&#39;t readable,
## how in the world could it be executed?&#34;

## But, at least on a Solaris 8 system, it is the wrong conclusion
## because even though sqlplus is not readable by &#34;other&#34;, and I am
## not user oracle or group dba and cannot even newgrp to dba, I can
## run the program:

$  /opt/oracle/product/bin/sqlplus

SQL*Plus: Release 9.2.0.1.0 - Production on Thu Feb 14 14:16:23 2008

Copyright &#40;c&#41; 1982, 2002, Oracle Corporation.  All rights reserved.

Enter user-name:


Should this pragma be that smart?
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
