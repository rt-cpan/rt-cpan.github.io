<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #44994 for CGI-Session: CGI-Session generate new session-ID forcibly</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #44994 for CGI-Session: CGI-Session generate new session-ID forcibly</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=CGI-Session">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=CGI-Session">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=CGI-Session">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=CGI-Session">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Session">CGI-Session CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">44994</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=CGI-Session">CGI-Session</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
m-uchino [...] yetipapa.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-5872-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-5873-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=44994">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-590531" href="/Public/Bug/Display.html?id=44994#txn-590531">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;03:21:28&nbsp;2009</span>
    <span class="description">m-uchino [...] yetipapa.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CGI-Session generate new session-ID forcibly</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/590531/299003/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/299003">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 856b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I hope that CGI-Session generate new session-ID forcibly. And, I called
new&#40;$dsn, undef, \%dsn_args&#41;.
But, CGI-Session try to create new query-object and get cookie/query-string.

This behavior is different from the old version&#40;mybe 4.0?&#41;.

OLD VERSION:
new&#40;$dsn, $sid, \%dsn_args&#41;  ==&gt;  Session-ID is $sid.
new&#40;$dsn, $query, \%dsn_args&#41;  ==&gt;  CGI-Session try to get session-ID by
$query.
new&#40;$dsn, undef, \%dsn_args&#41;  ==&gt;  CGI-Session generate new session-ID.

CURRENT VERSION:
new&#40;$dsn, $sid, \%dsn_args&#41;  ==&gt;  Session-id is $sid.
new&#40;$dsn, $query, \%dsn_args&#41;  ==&gt;  CGI-Session try to get session-ID by
$query.
new&#40;$dsn, undef, \%dsn_args&#41;  ==&gt;  CGI-Session try to get session-ID by
NEW query-object.

I gave CGI-Session empty-string to solve this problem.
I think that this should be added to a document.
&#40;Or, is this already included in a document?&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-590676" href="/Public/Bug/Display.html?id=44994#txn-590676">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;14:56:59&nbsp;2009</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44994] CGI-Session generate new session-ID forcibly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Apr 2009 14:56:29 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/590676/299082/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/299082">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 13 Apr 2009 03:21:29 -0400
&#34;m-uchino@yetipapa.com via RT&#34; &lt;bug-CGI-Session@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Apr 13 03:21:28 2009: Request 44994 was acted upon.
&gt; Transaction: Ticket created by m-uchino@yetipapa.com
&gt;        Queue: CGI-Session
&gt;      Subject: CGI-Session generate new session-ID forcibly
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: m-uchino@yetipapa.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44994">https://rt.cpan.org/Ticket/Display.html?id=44994</a></span> &gt;
&gt; 
&gt; 
&gt; I hope that CGI-Session generate new session-ID forcibly. And, I called
&gt; new&#40;$dsn, undef, \%dsn_args&#41;.
&gt; But, CGI-Session try to create new query-object and get cookie/query-string.
&gt; 
&gt; This behavior is different from the old version&#40;mybe 4.0?&#41;.
&gt; 
&gt; OLD VERSION:
&gt; new&#40;$dsn, $sid, \%dsn_args&#41;  ==&gt;  Session-ID is $sid.
&gt; new&#40;$dsn, $query, \%dsn_args&#41;  ==&gt;  CGI-Session try to get session-ID by
&gt; $query.
&gt; new&#40;$dsn, undef, \%dsn_args&#41;  ==&gt;  CGI-Session generate new session-ID.
&gt; 
&gt; CURRENT VERSION:
&gt; new&#40;$dsn, $sid, \%dsn_args&#41;  ==&gt;  Session-id is $sid.
&gt; new&#40;$dsn, $query, \%dsn_args&#41;  ==&gt;  CGI-Session try to get session-ID by
&gt; $query.
&gt; new&#40;$dsn, undef, \%dsn_args&#41;  ==&gt;  CGI-Session try to get session-ID by
&gt; NEW query-object.
&gt; 
&gt; I gave CGI-Session empty-string to solve this problem.
&gt; I think that this should be added to a document.
&gt; &#40;Or, is this already included in a document?&#41;
</div>
Thanks for the report. Could you contribute a new automated test which
illustrates the problem?

As you say, the test should pass when run against some old version, but
fail with the current version, and giving CGI::Session an empty string
should fix it.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-590677" href="/Public/Bug/Display.html?id=44994#txn-590677">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;14:56:59&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-590918" href="/Public/Bug/Display.html?id=44994#txn-590918">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;14&nbsp;02:54:50&nbsp;2009</span>
    <span class="description">m-uchino [...] yetipapa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/590918/299215/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/299215">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your reply.
I&#39;m sorry, I do not have the experience that wrote automated test. 
However, I do not know why this was changed. I read a source code, and I
found that CGI::Session generates new ID if it was empty-string.
Therefore, I do not know this behavior is intentional or accidental. 
Because the CGI::Session does not check empty-string. 

1.
At line 691.
_set_query_or_sid is called by load&#40;&#41; that is called by new&#40;&#41;.

2.
At line 783.
The argument is not an object&#40;it is empty-string&#41;, then the argument is
put to _CLAIMED_ID.

3.
At line 704.
The empty-string is &#39;defined data&#39;, then the new query-object is not
generated.

4.
At line 715.
But empty-string is FALSE, then return to new&#40;&#41;.

4.
At line 71.
_SESSION_ID is FALSE because load&#40;&#41; did not set it.

5.
At line 80.
New ID is generated.

I think that this should be made clear. And problem may be caused in the
future if not exhibited in the source code and the document because
source code may be updated without being careful to empty-string.

&#40;Sorry, my English is poor.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-591018" href="/Public/Bug/Display.html?id=44994#txn-591018">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;14&nbsp;09:25:14&nbsp;2009</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44994] CGI-Session generate new session-ID forcibly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Apr 2009 09:25:00 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/591018/299280/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/299280">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 453b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think that this should be made clear. And problem may be caused in the
&gt; future if not exhibited in the source code and the document because
&gt; source code may be updated without being careful to empty-string.
&gt; 
&gt; &#40;Sorry, my English is poor.&#41;
</div>
Thank you for the detailed response. We will look into further and see
how we can improve the code and documentation. 

I appreciate your effort at English. It is much better than my Japanese.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-592645" href="/Public/Bug/Display.html?id=44994#txn-592645">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;21:51:46&nbsp;2009</span>
    <span class="description">RSAVAGE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/592645/300172/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/300172">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 965b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

I&#39;ve traced thru the list of line numbers supplied by OP &#40;Original
Poster&#41;, and I agree that at line 80 a new ID is generated.

However, I&#39;m confused by this earlier remark:

&#34;new&#40;$dsn, undef, \%dsn_args&#41;  ==&gt;  CGI-Session try to get session-ID by
NEW query-object.&#34;

I do not see how a new query-object is generated by the code starting a
line 80.

So, I&#39;d say the new version behaves in the same way as the old version.

There is a problem in the POD in the docs for new&#40;&#41;: Nothing is said as
to what happens when the expression $query||$sid evaluates to false.

Can OP please tell us why they think a new query object is created. Once
we settle that problem, then I will know how to update the POD.

Also note: Since I&#39;m not one of the original developers of this module,
I do not get all the postings via RT. Feel free to copy me explicitly on
each posting, otherwise I&#39;ll only see them when I happen to log on to
RT. My email address is ron@savage.net.au.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-592666" href="/Public/Bug/Display.html?id=44994#txn-592666">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;23:01:13&nbsp;2009</span>
    <span class="description">m-uchino [...] yetipapa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/592666/300181/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/300181">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 981b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your reply, and thank you for your checking my report.

When empty-string was specified, the CGI::Session behaves as above. 
When undef was specified, the CGI::Session behaves as follows.

1.
At line 691.
_set_query_or_sid is called by load&#40;&#41; that is called by new&#40;&#41;.

2.
At line 783.
The argument is not an object&#40;it is undef&#41;, then the argument is put to
_CLAIMED_ID.

3.
At line 704.
The undef is NOT &#39;defined data&#39;, then query&#40;&#41; called, and the new
query-object is generated in query&#40;&#41;.
* empty-string is &#39;defined data&#39;.

4.
At line 715.
If ID not found by this query-object, then return to new&#40;&#41;.


The old version doesn&#39;t support generation new CGI-object. Therefore old
version generates new ID even if whichever is specified&#40;empty-string or
undef&#41;. 
I think that, it is convenient that a new version generates new
CGI-object, but the programmer must know this information when he wants
safe new ID. 
The programmer may not notice that it is not safe new ID.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-592677" href="/Public/Bug/Display.html?id=44994#txn-592677">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;18&nbsp;23:46:27&nbsp;2009</span>
    <span class="description">RSAVAGE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/592677/300188/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/300188">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

On Sat Apr 18 23:01:13 2009, m-uchino@yetipapa.com wrote:
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3.
&gt; At line 704.
&gt; The undef is NOT &#39;defined data&#39;, then query&#40;&#41; called, and the new
&gt; query-object is generated in query&#40;&#41;.
&gt; * empty-string is &#39;defined data&#39;.
</div>
Yes, you are correct.

I did not appreciate that the call to query&#40;&#41; at line 705 would generate
a new CGI object.

Of course, if you are trying to use CGI::Simple or some other module,
instead of CGI, that creates another problem :-&#40;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The old version doesn&#39;t support generation new CGI-object. Therefore old
&gt; version generates new ID even if whichever is specified&#40;empty-string or
&gt; undef&#41;. 
&gt; I think that, it is convenient that a new version generates new
&gt; CGI-object, but the programmer must know this information when he wants
&gt; safe new ID.
</div>
OK. Here&#39;s what I suggest as a change to the POD:

--------------
A special situation arises when the expression $query||$sid evaluates to
false:

=over 4

=item A new CGI object is created

Of course, if you are trying to use CGI::Simple or another module,
instead of CGI, this might create a new problem,
since this new object is stored inside the current CGI::Session object.

Also, early versions of this module did not do this, so this change in
behaviour might be confusing.

=item This new object is asked to provide a SID

Of course, the SID returned by this new object will be empty.

=item The current CGI::Session object then generates a new SID

This is what you wanted.

However, if you already have, or later create, a CGI - or similar -
object, you need to be aware that the current CGI::Session
object is now using its own CGI object. This will almost certainly lead
to confusion.

=back

So, the recommended way to avoid this is to always call new&#40;&#41; with
either a query object or a sid, so that the expression
$query||$sid is never false.

---------
I&#39;ve changed my own SVN version of the code to contain this patch.

However, before checking it in I will wait for comment from other
developers.

As for the module creating a object of type CGI and not of some other
type, there&#39;s nothing we can do, because when the user does not provide
a query object, we have no way of knowing what type of object they prefer.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-592717" href="/Public/Bug/Display.html?id=44994#txn-592717">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;19&nbsp;03:11:36&nbsp;2009</span>
    <span class="description">m-uchino [...] yetipapa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> ron [...] savage.net.au</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/592717/300205/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/300205">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your response.

I worry about security.
I think that this method to let the CGI::Session generate new SID
forcibly by specifying an empty-string is written in POD is better.
Similarly I think that the comment is written in a source code is better
for that somebody does not change this behavior that CGI::Session
generate new SID if it is empty-string. 
Because, whether using CGI::Simple or CGI, we must sometimes let the
CGI::Session generate new SID. For example, member login page.
The attacker is going to steal the secret information of the user.
Therefore he is going to steal SID. 
You say &#34;Of course, the SID returned by this new object will be empty.&#34;,
but it return SID if it finds the SID. 
Therefore, the attacker can easily steal the information of the target. 

For example, follows. 

1.
The attacker accesses the member&#39;s page. He may need an account or may
not need it. Anyway, he lets CGI::Session make his session.

2.
The attacker can get SID of his own by reading HTTP header. 
Set-Cookie: CGISESSID=xxxSIDxxx; path=/
SID is &#34;xxxSIDxxx&#34;.

3.
The attacker guides the target to this URL by some ways.
<span class="clickylink"><a target="new" rel="nofollow" href="https://host/members/login.cgi?CGISESSID=xxxSIDxxx">https://host/members/login.cgi?CGISESSID=xxxSIDxxx</a></span>

4.
The taget uses the session of the attacker if the target does not have
COOKIE. 
He will log in then if a login page is displayed. And the session
becomes his session. However, the SID is the same. 

5.
The attacker can use the session that the USER-ID of the target was set.

Or the attacker may steal COOKIE of the target. If CGI::Session tries
that it gets SID from COOKIE, the target is dangerous in the same way.
If a system checks that a user has already logged in, the attacker will
guide a target after logging out. If a system deletes a session if a
user logs out, this attack will fail. 

Anyway, the method how we easily avoid this attack is to let the
CGI::Session create new SID forcibly when a user logged in.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.529792</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
