<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #62379 for CPU-Emulator-Memory: Win32: error reading and writing image files &#40;binmode&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #62379 for CPU-Emulator-Memory: Win32: error reading and writing image files &#40;binmode&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CPU-Emulator-Memory/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CPU-Emulator-Memory/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CPU-Emulator-Memory/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CPU-Emulator-Memory/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CPU-Emulator-Memory">CPU-Emulator-Memory CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">62379</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CPU-Emulator-Memory/Active/">CPU-Emulator-Memory</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
PSCUST [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-220710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.1001    </td>
  </tr>
  <tr id="CF-220711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;22&nbsp;13:32:46&nbsp;2010</span>
    <span class="description">PSCUST [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Win32: error reading and writing image files &#40;binmode&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In Win32, binmode&#40;&#41; is needed to read and write binary files.

The ROM image files read by this module are not correctly represented in 
the object if they contain LF bytes, because of the Win32 translation of 
end-of-line characters.

The same happens to the RAM image files stored on disk.



The attached patch and test file solve this issue:

* add binmode&#40;&#41; after each open&#40;&#41; call

* add either &#39;binmode $fh&#39; or &#39;$fh-&gt;binmode&#39; in _readROM&#40;&#41; to cope with 
either filehandles or IO::Handle objects

* the test file read_write_binary.pl implements binary read and write 
functions to be used in the tests; maybe File::Slurp should be used 
instead

* 02-file.t is modified to exercise the bug in Win32, by pokeing a CR 
and a LF bytes

* several test are added to 03-banked-memory-ROM.t to read a problem ROM 
file &#40;with CR and LF bytes&#41; by file name, by file handle and by 
IO::File; the dependency to IO::File was also added to Makefile.PL


I hope this patch is usefull and can get into the next version of the 
module.


Thank you.
Paulo Custodio
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> read_write_binary.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl

use strict;
use warnings;

use Test::More;

sub read_binary {
    my&#40;$file&#41; = @_;
    local $/ = undef;
    
    open&#40;my $fh, $file&#41; || die&#40;&#34;Couldn&#39;t read $file\n&#34;&#41;;
    binmode&#40;$fh&#41;;
    return scalar&#40;&lt;$fh&gt;&#41;;
}

sub write_binary {
    my&#40;$file, $bytes&#41; = @_;
    
    open&#40;my $fh, &#39;&gt;&#39;, $file&#41; || die&#40;&#34;Couldn&#39;t create $file\n&#34;&#41;;
    binmode&#40;$fh&#41;;
    print $fh $bytes;
}

# test these functions
unlink &#39;bytes.ram&#39;;
write_binary&#40;&#39;bytes.ram&#39;, &#34;\x01\x0D\x0A&#34;&#41;;
is&#40;-s &#39;bytes.ram&#39;, 3, &#34;binary file has correct size ...&#34;&#41;;
$_ = read_binary&#40;&#39;bytes.ram&#39;&#41;;
is&#40;$_, &#34;\x01\x0D\x0A&#34;, &#34;... and correct content&#34;&#41;;
ok&#40;unlink&#40;&#39;bytes.ram&#39;&#41;, &#34;bytes.ram deleted&#34;&#41;;

1;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CPU-Emulator-Memory-1.1001-patch02-RT.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -cr CPU-Emulator-Memory-1.1001/MANIFEST CPU-Emulator-Memory-1.1001_02/MANIFEST
*** CPU-Emulator-Memory-1.1001/MANIFEST	2008-02-28 22:20:36.000000000 +0000
--- CPU-Emulator-Memory-1.1001_02/MANIFEST	2010-10-22 17:59:35.551993000 +0100
***************
*** 15,18 ****
  t/coverage.sh
  t/pod-coverage.t
  t/pod.t
! META.yml                                 Module meta-data &#40;added by MakeMaker&#41;
--- 15,19 ----
  t/coverage.sh
  t/pod-coverage.t
  t/pod.t
! t/read_write_binary.pl
! META.yml			Module meta-data &#40;added by MakeMaker&#41;
diff -cr CPU-Emulator-Memory-1.1001/Makefile.PL CPU-Emulator-Memory-1.1001_02/Makefile.PL
*** CPU-Emulator-Memory-1.1001/Makefile.PL	2008-02-28 22:20:05.000000000 +0000
--- CPU-Emulator-Memory-1.1001_02/Makefile.PL	2010-10-22 18:00:58.419732800 +0100
***************
*** 5,10 ****
--- 5,11 ----
      VERSION      =&gt; 1.1001,
      PREREQ_PM    =&gt; {
          &#39;Scalar::Util&#39; =&gt; 0,
+         &#39;IO::File&#39;     =&gt; 0,
          &#39;IO::Scalar&#39;   =&gt; 0
      }
  &#41;;
diff -cr CPU-Emulator-Memory-1.1001/lib/CPU/Emulator/Memory/Banked.pm CPU-Emulator-Memory-1.1001_02/lib/CPU/Emulator/Memory/Banked.pm
*** CPU-Emulator-Memory-1.1001/lib/CPU/Emulator/Memory/Banked.pm	2008-02-28 22:15:52.000000000 +0000
--- CPU-Emulator-Memory-1.1001_02/lib/CPU/Emulator/Memory/Banked.pm	2010-10-22 18:03:27.158240100 +0100
***************
*** 251,256 ****
--- 251,262 ----
  
      if&#40;reftype&#40;$file&#41; eq &#39;GLOB&#39;&#41; {
          local $/ = undef;
+         if &#40;eval {$file-&gt;can&#40;&#39;binmode&#39;&#41;}&#41; {
+             $file-&gt;binmode;            # IO::HANDLE
+         }
+         else {
+             binmode $file;            # file handle
+         }
          my $contents = &lt;$file&gt;;
          die&#40;&#34;data in filehandle is wrong size &#40;got &#34;.length&#40;$contents&#41;.&#34;, expected $size&#41;\n&#34;&#41; unless&#40;length&#40;$contents&#41; == $size&#41;;
          return $contents;
diff -cr CPU-Emulator-Memory-1.1001/lib/CPU/Emulator/Memory.pm CPU-Emulator-Memory-1.1001_02/lib/CPU/Emulator/Memory.pm
*** CPU-Emulator-Memory-1.1001/lib/CPU/Emulator/Memory.pm	2008-02-28 19:41:29.000000000 +0000
--- CPU-Emulator-Memory-1.1001_02/lib/CPU/Emulator/Memory.pm	2010-10-22 18:04:12.964860100 +0100
***************
*** 172,177 ****
--- 172,178 ----
      my&#40;$self, $file, $size&#41; = @_;
      local $/ = undef;
      open&#40;my $fh, $file&#41; || die&#40;&#34;Couldn&#39;t read $file\n&#34;&#41;;
+     binmode&#40;$fh&#41;;
      my $contents = &lt;$fh&gt;;
      die&#40;&#34;$file is wrong size\n&#34;&#41; unless&#40;length&#40;$contents&#41; == $size&#41;;
      close&#40;$fh&#41;;
***************
*** 192,197 ****
--- 193,199 ----
  sub _writeRAM {
      my&#40;$self, $file, $contents&#41; = @_;
      open&#40;my $fh, &#39;&gt;&#39;, $file&#41; || die&#40;&#34;Can&#39;t write $file\n&#34;&#41;;
+     binmode&#40;$fh&#41;;
      print $fh $contents || die&#40;&#34;Can&#39;t write $file\n&#34;&#41;;
      close&#40;$fh&#41;;
  }
diff -cr CPU-Emulator-Memory-1.1001/t/02-file.t CPU-Emulator-Memory-1.1001_02/t/02-file.t
*** CPU-Emulator-Memory-1.1001/t/02-file.t	2008-02-14 13:29:03.000000000 +0000
--- CPU-Emulator-Memory-1.1001_02/t/02-file.t	2010-10-22 16:32:10.243978500 +0100
***************
*** 1,25 ****
  use strict;
  $^W = 1;
  
! use Test::More tests =&gt; 5;
  
  use CPU::Emulator::Memory;
  
  unlink &#39;newfile.ram&#39;;
  my $memory = CPU::Emulator::Memory-&gt;new&#40;file =&gt; &#39;newfile.ram&#39;&#41;;
  
  # NB using {0xHEXSTUFF} in regexes doesn&#39;t work.
  # and the repeated {30000}...{30000} is cos there&#39;s a 2^15 - 2 limit
  
! $/ = undef;
! open&#40;my $fh, &#39;newfile.ram&#39;&#41; || die&#40;&#34;Couldn&#39;t open newfile.ram\n&#34;&#41;;
! ok&#40;&lt;$fh&gt; =~ /^\000{30000}\000{30000}\000{5536}$/, &#34;New file created as all zeroes&#34;&#41;;
! close&#40;$fh&#41;;
  ok&#40;$memory-&gt;peek&#40;0&#41; == 0, &#34;Peek confirms a zero&#34;&#41;;
! ok&#40;$memory-&gt;poke&#40;0, 1&#41; &#38;&#38; $memory-&gt;peek&#40;0&#41; == 1, &#34;Poke works ...&#34;&#41;;
! open&#40;$fh, &#39;newfile.ram&#39;&#41;;
! ok&#40;&lt;$fh&gt; =~ /^\001\000{30000}\000{30000}\000{5535}$/, &#34;... and is reflected in the file&#34;&#41;;
! close&#40;$fh&#41;;
  
  undef $memory;
  
--- 1,28 ----
  use strict;
  $^W = 1;
  
! use Test::More tests =&gt; 11;
  
  use CPU::Emulator::Memory;
  
+ require &#39;t/read_write_binary.pl&#39;;
+ 
  unlink &#39;newfile.ram&#39;;
  my $memory = CPU::Emulator::Memory-&gt;new&#40;file =&gt; &#39;newfile.ram&#39;&#41;;
  
  # NB using {0xHEXSTUFF} in regexes doesn&#39;t work.
  # and the repeated {30000}...{30000} is cos there&#39;s a 2^15 - 2 limit
  
! $_ = read_binary&#40;&#39;newfile.ram&#39;&#41;;
! ok&#40;/^\000{30000}\000{30000}\000{5536}$/, &#34;New file created as all zeroes&#34;&#41;;
! 
  ok&#40;$memory-&gt;peek&#40;0&#41; == 0, &#34;Peek confirms a zero&#34;&#41;;
! ok&#40;$memory-&gt;poke&#40;0, 1&#41;  &#38;&#38; $memory-&gt;peek&#40;0&#41; == 1,  &#34;Poke works ...&#34;&#41;;
! ok&#40;$memory-&gt;poke&#40;1, 13&#41; &#38;&#38; $memory-&gt;peek&#40;1&#41; == 13, &#34;Poke works ...&#34;&#41;;
! ok&#40;$memory-&gt;poke&#40;2, 10&#41; &#38;&#38; $memory-&gt;peek&#40;2&#41; == 10, &#34;Poke works ...&#34;&#41;;
! is&#40;-s &#39;newfile.ram&#39;, 0x10000, &#34;file is correct size&#34;&#41;;
! $_ = read_binary&#40;&#39;newfile.ram&#39;&#41;;
! ok&#40;/^\001\015\012\000{30000}\000{30000}\000{5533}$/s, &#34;... and is reflected in the file&#34;&#41;;
  
  undef $memory;
  
diff -cr CPU-Emulator-Memory-1.1001/t/03-banked-memory-ROM.t CPU-Emulator-Memory-1.1001_02/t/03-banked-memory-ROM.t
*** CPU-Emulator-Memory-1.1001/t/03-banked-memory-ROM.t	2008-02-28 19:41:29.000000000 +0000
--- CPU-Emulator-Memory-1.1001_02/t/03-banked-memory-ROM.t	2010-10-22 17:21:28.852201300 +0100
***************
*** 1,12 ****
  use strict;
  $^W = 1;
  
! use Test::More tests =&gt; 19;
! 
! undef $/;
  
  use CPU::Emulator::Memory::Banked;
  use IO::Scalar;
  
  unlink &#39;ramfile.ram&#39;, &#39;romfile.rom&#39;;
  my $memory = CPU::Emulator::Memory::Banked-&gt;new&#40;file =&gt; &#39;ramfile.ram&#39;&#41;;
--- 1,13 ----
  use strict;
  $^W = 1;
  
! use Test::More tests =&gt; 33;
  
  use CPU::Emulator::Memory::Banked;
  use IO::Scalar;
+ use IO::File;
+ 
+ require &#39;t/read_write_binary.pl&#39;;
  
  unlink &#39;ramfile.ram&#39;, &#39;romfile.rom&#39;;
  my $memory = CPU::Emulator::Memory::Banked-&gt;new&#40;file =&gt; &#39;ramfile.ram&#39;&#41;;
***************
*** 14,22 ****
  # NB using {0xHEXSTUFF} in regexes doesn&#39;t work.
  # and the repeated {30000}...{30000} is cos there&#39;s a 2^15 - 2 limit
  
! open&#40;my $fh, &#39;&gt;&#39;, &#39;romfile.rom&#39;&#41; || die&#40;&#34;Can&#39;t create ROM file for testing\n&#34;&#41;;
! print $fh &#39;This is a ROM&#39;;
! close&#40;$fh&#41;;
  
  eval { $memory-&gt;bank&#40;
      address =&gt; 0,
--- 15,21 ----
  # NB using {0xHEXSTUFF} in regexes doesn&#39;t work.
  # and the repeated {30000}...{30000} is cos there&#39;s a 2^15 - 2 limit
  
! write_binary&#40;&#39;romfile.rom&#39;, &#39;This is a ROM&#39;&#41;;
  
  eval { $memory-&gt;bank&#40;
      address =&gt; 0,
***************
*** 54,64 ****
  ok&#40;$memory-&gt;peek&#40;1&#41; == 1, &#34;With writethrough, RAM gets updated&#34;&#41;;
  ok&#40;$memory-&gt;peek&#40;2&#41; == 1, &#34;poke8 worked too&#34;&#41;;
  
! open&#40;$fh, &#39;romfile.rom&#39;&#41; || die&#40;&#34;Can&#39;t read romfile.rom\n&#34;&#41;;
! ok&#40;&lt;$fh&gt; eq &#39;This is a ROM&#39;, &#34;ROM files don&#39;t get altered&#34;&#41;;
! close&#40;$fh&#41;;
! open&#40;$fh, &#39;ramfile.ram&#39;&#41; || die&#40;&#34;Can&#39;t read ramfile.ram\n&#34;&#41;;
! ok&#40;&lt;$fh&gt; =~ /^\000\001{2}\000{30000}\000{30000}\000{5532}\001$/, &#34;With writethrough, RAM file gets updated correctly&#34;&#41;;
  
  $memory-&gt;bank&#40;
      address =&gt; 0,
--- 53,63 ----
  ok&#40;$memory-&gt;peek&#40;1&#41; == 1, &#34;With writethrough, RAM gets updated&#34;&#41;;
  ok&#40;$memory-&gt;peek&#40;2&#41; == 1, &#34;poke8 worked too&#34;&#41;;
  
! $_ = read_binary&#40;&#39;romfile.rom&#39;&#41;;
! ok&#40;$_ eq &#39;This is a ROM&#39;, &#34;ROM files don&#39;t get altered&#34;&#41;;
! 
! $_ = read_binary&#40;&#39;ramfile.ram&#39;&#41;;
! ok&#40;/^\000\001{2}\000{30000}\000{30000}\000{5532}\001$/, &#34;With writethrough, RAM file gets updated correctly&#34;&#41;;
  
  $memory-&gt;bank&#40;
      address =&gt; 0,
***************
*** 104,108 ****
--- 103,148 ----
  &#41;;
  ok&#40;$memory-&gt;peek&#40;0&#41; == ord&#40;&#39;A&#39;&#41;, &#34;ROM &#39;file&#39; can also be a filehandle&#34;&#41;;
  
+ # test banked ROM with chr&#40;13&#41; and chr&#40;10&#41; inside 
+ # - needs binmode to read/write correctly in Win32
+ write_binary&#40;&#39;romfile.rom&#39;, &#34;\x01\x0D\x0A&#34;&#41;;
+ is&#40;-s &#39;romfile.rom&#39;, 3, &#34;binmode was used, size is OK&#34;&#41;;
+ $memory-&gt;bank&#40;
+     address =&gt; 0,
+     size    =&gt; 3, 
+     type    =&gt; &#39;ROM&#39;,
+     file    =&gt; &#39;romfile.rom&#39;
+ &#41;;
+ is&#40;$memory-&gt;peek&#40;0&#41;, 1,  &#34;peek 1&#34;&#41;;
+ is&#40;$memory-&gt;peek&#40;1&#41;, 13, &#34;peek 13&#34;&#41;;
+ is&#40;$memory-&gt;peek&#40;2&#41;, 10, &#34;peek 10&#34;&#41;;
+ 
+ # test with filehandle
+ open&#40;my $fh, &#39;romfile.rom&#39;&#41; || die&#40;&#34;Couldn&#39;t read romfile.rom\n&#34;&#41;;
+ $memory-&gt;bank&#40;
+     address =&gt; 0,
+     size =&gt; 3,
+     type =&gt; &#39;ROM&#39;,
+     file =&gt; $fh
+ &#41;;
+ is&#40;$memory-&gt;peek&#40;0&#41;, 1,  &#34;peek 1&#34;&#41;;
+ is&#40;$memory-&gt;peek&#40;1&#41;, 13, &#34;peek 13&#34;&#41;;
+ is&#40;$memory-&gt;peek&#40;2&#41;, 10, &#34;peek 10&#34;&#41;;
+ close $fh;
+ 
+ # test with IO::File
+ $memory-&gt;bank&#40;
+     address =&gt; 0,
+     size =&gt; 3,
+     type =&gt; &#39;ROM&#39;,
+     file =&gt; IO::File-&gt;new&#40;&#39;romfile.rom&#39;, &#39;r&#39;&#41;
+ &#41;;
+ is&#40;$memory-&gt;peek&#40;0&#41;, 1,  &#34;peek 1&#34;&#41;;
+ is&#40;$memory-&gt;peek&#40;1&#41;, 13, &#34;peek 13&#34;&#41;;
+ is&#40;$memory-&gt;peek&#40;2&#41;, 10, &#34;peek 10&#34;&#41;;
+ 
+ undef $memory; # to release IO::File handle
+ ok&#40;unlink&#40;&#39;romfile.rom&#39;&#41;, &#34;romfile.rom deleted&#34;&#41;;
+ 
  __DATA__
  A
Only in CPU-Emulator-Memory-1.1001_02/t: read_write_binary.pl
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;26&nbsp;07:50:04&nbsp;2010</span>
    <span class="description">dcantrell [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, will be fixed in next release
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;26&nbsp;07:50:06&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;26&nbsp;07:50:07&nbsp;2010</span>
    <span class="description">dcantrell [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
