<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #37965 for IPTables-IPv4: Module fails to compile on kernel 2.6.25.10-86.fc9 &#40;Fedora Core 9&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #37965 for IPTables-IPv4: Module fails to compile on kernel 2.6.25.10-86.fc9 &#40;Fedora Core 9&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IPTables-IPv4/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IPTables-IPv4/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IPTables-IPv4/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IPTables-IPv4/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IPTables-IPv4">IPTables-IPv4 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">37965</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IPTables-IPv4/Active/">IPTables-IPv4</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
minfrin [...] sharp.fm

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17424-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17425-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;27&nbsp;17:18:35&nbsp;2008</span>
    <span class="description">minfrin [...] sharp.fm -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Module fails to compile on kernel 2.6.25.10-86.fc9 &#40;Fedora Core 9&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 27 Jul 2008 23:18:01 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IPTables-IPv4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graham Leggett &lt;minfrin [...] sharp.fm&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi all,

IPTables-IPv4 as built from an rpm on Fedora Core 9 fails to compile as 
per the error below.

It seems that someone has broken the kernel headers for iptables, or 
IPTables-IPv4 is doing something wrong in some way.

In file included from /usr/include/linux/netfilter_ipv4.h:8,
                  from /usr/include/linux/netfilter_ipv4/ip_tables.h:18,
                  from include/libiptc/libiptc.h:6,
                  from local_types.h:41,
                  from module_iface.h:16,
                  from loader.h:1,
                  from loader.c:39:
/usr/include/linux/netfilter.h:40: error: expected 
specifier-qualifier-list before &#39;__u32&#39;
loader.c: In function &#39;find_module_int&#39;:
loader.c:108: warning: ignoring return value of &#39;asprintf&#39;, declared 
with attribute warn_unused_result
make: *** [loader.o] Error 1
make: *** Waiting for unfinished jobs....
In file included from /usr/include/linux/netfilter_ipv4.h:8,
                  from /usr/include/linux/netfilter_ipv4/ip_tables.h:18,
                  from include/libiptc/libiptc.h:6,
                  from local_types.h:41,
                  from packer.c:30:
/usr/include/linux/netfilter.h:40: error: expected 
specifier-qualifier-list before &#39;__u32&#39;
packer.c: In function &#39;ipt_do_pack&#39;:
packer.c:261: warning: passing argument 3 of &#39;Perl_sv_2pv_flags&#39; from 
incompatible pointer type
packer.c:319: warning: passing argument 3 of &#39;Perl_sv_2pv_flags&#39; from 
incompatible pointer type
packer.c:380: warning: passing argument 3 of &#39;Perl_sv_2pv_flags&#39; from 
incompatible pointer type
packer.c:512: warning: format &#39;%Lu&#39; expects type &#39;long long unsigned int 
*&#39;, but argument 3 has type &#39;u_int64_t *&#39;
packer.c:523: warning: format &#39;%Lu&#39; expects type &#39;long long unsigned int 
*&#39;, but argument 3 has type &#39;u_int64_t *&#39;
packer.c:249: warning: ignoring return value of &#39;asprintf&#39;, declared 
with attribute warn_unused_result
packer.c:310: warning: ignoring return value of &#39;asprintf&#39;, declared 
with attribute warn_unused_result
packer.c:372: warning: ignoring return value of &#39;asprintf&#39;, declared 
with attribute warn_unused_result
packer.c:542: warning: ignoring return value of &#39;asprintf&#39;, declared 
with attribute warn_unused_result
packer.c:558: warning: ignoring return value of &#39;asprintf&#39;, declared 
with attribute warn_unused_result
make: *** [packer.o] Error 1
error: Bad exit status from /var/tmp/rpm-tmp.32445 &#40;%build&#41;

Regards,
Graham
--
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;27&nbsp;18:24:12&nbsp;2008</span>
    <span class="description">minfrin [...] sharp.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #37965] AutoReply: Module fails to compile on kernel 2.6.25.10-86.fc9 &#40;Fedora Core 9&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Jul 2008 00:23:46 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IPTables-IPv4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graham Leggett &lt;minfrin [...] sharp.fm&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi all,

Some further digging - it seems this module has tried to copy a subset 
of what looks like kernel headers within include/linux/netfilter_ipv4 
and include/linux/netfilter_ipv6, which guarantees major confusion and 
breakage should these headers move out of sync.

Busy investigating the effect of removing these headers entirely.

Regards,
Graham
--
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;28&nbsp;19:14:48&nbsp;2008</span>
    <span class="description">minfrin [...] sharp.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #37965] AutoReply: Module fails to compile on kernel 2.6.25.10-86.fc9 &#40;Fedora Core 9&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Jul 2008 01:14:02 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IPTables-IPv4 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graham Leggett &lt;minfrin [...] sharp.fm&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi all,

The following patch works around the problem so far, fixing a number of 
problems:

- It adds -fPIC in a number of places where shared objects are used

- It adds an include of linux/types.h to work around the missing
__u32 definition.

- On FC9 the struct in6_addr isn&#39;t picked up from linux/in6.h, but 
rather from  netinet/in.h, which causes a compile failure. There is a 
hack included to work around this problem, ideally someone who knows 
this header code better should find the &#34;right&#34; way to identify the 
correct header.

The patch is attached.

Regards,
Graham
--
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -u -r -N IPTables-IPv4-0.98-orig/include/libiptc/ipt_kernel_headers.h IPTables-IPv4-0.98/include/libiptc/ipt_kernel_headers.h
--- IPTables-IPv4-0.98-orig/include/libiptc/ipt_kernel_headers.h	2001-10-06 04:16:12.000000000 +0200
+++ IPTables-IPv4-0.98/include/libiptc/ipt_kernel_headers.h	2008-07-28 12:49:01.000000000 +0200
@@ -13,6 +13,7 @@
 #include &lt;netinet/udp.h&gt;
 #include &lt;net/if.h&gt;
 #include &lt;sys/types.h&gt;
+#include &lt;linux/types.h&gt;
 #else /* libc5 */
 #include &lt;sys/socket.h&gt;
 #include &lt;linux/ip.h&gt;
diff -u -r -N IPTables-IPv4-0.98-orig/include/linux/config.h IPTables-IPv4-0.98/include/linux/config.h
--- IPTables-IPv4-0.98-orig/include/linux/config.h	1970-01-01 02:00:00.000000000 +0200
+++ IPTables-IPv4-0.98/include/linux/config.h	2008-07-28 14:45:12.000000000 +0200
@@ -0,0 +1,8 @@
+#ifndef _LINUX_CONFIG_H
+#define _LINUX_CONFIG_H
+
+#ifdef __KERNEL__
+#error Incorrectly using glibc headers for a kernel module
+#endif
+
+#endif
diff -u -r -N IPTables-IPv4-0.98-orig/include/linux/netfilter_ipv4/ip_conntrack.h IPTables-IPv4-0.98/include/linux/netfilter_ipv4/ip_conntrack.h
--- IPTables-IPv4-0.98-orig/include/linux/netfilter_ipv4/ip_conntrack.h	1970-01-01 02:00:00.000000000 +0200
+++ IPTables-IPv4-0.98/include/linux/netfilter_ipv4/ip_conntrack.h	2008-07-28 14:44:31.000000000 +0200
@@ -0,0 +1,45 @@
+#ifndef _IP_CONNTRACK_H
+#define _IP_CONNTRACK_H
+/* Connection state tracking for netfilter.  This is separated from,
+   but required by, the NAT layer; it can also be used by an iptables
+   extension. */
+
+#include &lt;linux/config.h&gt;
+#include &lt;linux/netfilter_ipv4/ip_conntrack_tuple.h&gt;
+
+enum ip_conntrack_info
+{
+	/* Part of an established connection &#40;either direction&#41;. */
+	IP_CT_ESTABLISHED,
+
+	/* Like NEW, but related to an existing connection, or ICMP error
+	   &#40;in either direction&#41;. */
+	IP_CT_RELATED,
+
+	/* Started a new connection to track &#40;only
+           IP_CT_DIR_ORIGINAL&#41;; may be a retransmission. */
+	IP_CT_NEW,
+
+	/* &gt;= this indicates reply direction */
+	IP_CT_IS_REPLY,
+
+	/* Number of distinct IP_CT types &#40;no NEW in reply dirn&#41;. */
+	IP_CT_NUMBER = IP_CT_IS_REPLY * 2 - 1
+};
+
+/* Bitset representing status of connection. */
+enum ip_conntrack_status {
+	/* It&#39;s an expected connection: bit 0 set.  This bit never changed */
+	IPS_EXPECTED_BIT = 0,
+	IPS_EXPECTED = &#40;1 &lt;&lt; IPS_EXPECTED_BIT&#41;,
+
+	/* We&#39;ve seen packets both ways: bit 1 set.  Can be set, not unset. */
+	IPS_SEEN_REPLY_BIT = 1,
+	IPS_SEEN_REPLY = &#40;1 &lt;&lt; IPS_SEEN_REPLY_BIT&#41;,
+
+	/* Conntrack should never be early-expired. */
+	IPS_ASSURED_BIT = 2,
+	IPS_ASSURED = &#40;1 &lt;&lt; IPS_ASSURED_BIT&#41;,
+};
+
+#endif /* _IP_CONNTRACK_H */
diff -u -r -N IPTables-IPv4-0.98-orig/include/linux/netfilter_ipv4/ip_conntrack_tuple.h IPTables-IPv4-0.98/include/linux/netfilter_ipv4/ip_conntrack_tuple.h
--- IPTables-IPv4-0.98-orig/include/linux/netfilter_ipv4/ip_conntrack_tuple.h	1970-01-01 02:00:00.000000000 +0200
+++ IPTables-IPv4-0.98/include/linux/netfilter_ipv4/ip_conntrack_tuple.h	2008-07-28 14:43:39.000000000 +0200
@@ -0,0 +1,105 @@
+#ifndef _IP_CONNTRACK_TUPLE_H
+#define _IP_CONNTRACK_TUPLE_H
+
+/* A `tuple&#39; is a structure containing the information to uniquely
+  identify a connection.  ie. if two packets have the same tuple, they
+  are in the same connection; if not, they are not.
+
+  We divide the structure along &#34;manipulatable&#34; and
+  &#34;non-manipulatable&#34; lines, for the benefit of the NAT code.
+*/
+
+/* The protocol-specific manipulable parts of the tuple: always in
+   network order! */
+union ip_conntrack_manip_proto
+{
+	/* Add other protocols here. */
+	u_int16_t all;
+
+	struct {
+		u_int16_t port;
+	} tcp;
+	struct {
+		u_int16_t port;
+	} udp;
+	struct {
+		u_int16_t id;
+	} icmp;
+};
+
+/* The manipulable part of the tuple. */
+struct ip_conntrack_manip
+{
+	u_int32_t ip;
+	union ip_conntrack_manip_proto u;
+};
+
+/* This contains the information to distinguish a connection. */
+struct ip_conntrack_tuple
+{
+	struct ip_conntrack_manip src;
+
+	/* These are the parts of the tuple which are fixed. */
+	struct {
+		u_int32_t ip;
+		union {
+			/* Add other protocols here. */
+			u_int16_t all;
+
+			struct {
+				u_int16_t port;
+			} tcp;
+			struct {
+				u_int16_t port;
+			} udp;
+			struct {
+				u_int8_t type, code;
+			} icmp;
+		} u;
+
+		/* The protocol. */
+		u_int16_t protonum;
+	} dst;
+};
+
+enum ip_conntrack_dir
+{
+	IP_CT_DIR_ORIGINAL,
+	IP_CT_DIR_REPLY,
+	IP_CT_DIR_MAX
+};
+
+static inline int ip_ct_tuple_src_equal&#40;const struct ip_conntrack_tuple *t1,
+				        const struct ip_conntrack_tuple *t2&#41;
+{
+	return t1-&gt;src.ip == t2-&gt;src.ip
+		&#38;&#38; t1-&gt;src.u.all == t2-&gt;src.u.all;
+}
+
+static inline int ip_ct_tuple_dst_equal&#40;const struct ip_conntrack_tuple *t1,
+				        const struct ip_conntrack_tuple *t2&#41;
+{
+	return t1-&gt;dst.ip == t2-&gt;dst.ip
+		&#38;&#38; t1-&gt;dst.u.all == t2-&gt;dst.u.all
+		&#38;&#38; t1-&gt;dst.protonum == t2-&gt;dst.protonum;
+}
+
+static inline int ip_ct_tuple_equal&#40;const struct ip_conntrack_tuple *t1,
+				    const struct ip_conntrack_tuple *t2&#41;
+{
+	return ip_ct_tuple_src_equal&#40;t1, t2&#41; &#38;&#38; ip_ct_tuple_dst_equal&#40;t1, t2&#41;;
+}
+
+static inline int ip_ct_tuple_mask_cmp&#40;const struct ip_conntrack_tuple *t,
+				       const struct ip_conntrack_tuple *tuple,
+				       const struct ip_conntrack_tuple *mask&#41;
+{
+	return !&#40;&#40;&#40;t-&gt;src.ip ^ tuple-&gt;src.ip&#41; &#38; mask-&gt;src.ip&#41;
+		 || &#40;&#40;t-&gt;dst.ip ^ tuple-&gt;dst.ip&#41; &#38; mask-&gt;dst.ip&#41;
+		 || &#40;&#40;t-&gt;src.u.all ^ tuple-&gt;src.u.all&#41; &#38; mask-&gt;src.u.all&#41;
+		 || &#40;&#40;t-&gt;dst.u.all ^ tuple-&gt;dst.u.all&#41; &#38; mask-&gt;dst.u.all&#41;
+		 || &#40;&#40;t-&gt;dst.protonum ^ tuple-&gt;dst.protonum&#41;
+		     &#38; mask-&gt;dst.protonum&#41;&#41;;
+}
+
+#endif /* _IP_CONNTRACK_TUPLE_H */
diff -u -r -N IPTables-IPv4-0.98-orig/include/linux/netfilter_ipv4/ip_nat.h IPTables-IPv4-0.98/include/linux/netfilter_ipv4/ip_nat.h
--- IPTables-IPv4-0.98-orig/include/linux/netfilter_ipv4/ip_nat.h	1970-01-01 02:00:00.000000000 +0200
+++ IPTables-IPv4-0.98/include/linux/netfilter_ipv4/ip_nat.h	2008-07-28 14:41:40.000000000 +0200
@@ -0,0 +1,81 @@
+#ifndef _IP_NAT_H
+#define _IP_NAT_H
+#include &lt;linux/netfilter_ipv4.h&gt;
+#include &lt;linux/netfilter_ipv4/ip_conntrack_tuple.h&gt;
+
+#define IP_NAT_MAPPING_TYPE_MAX_NAMELEN 16
+
+enum ip_nat_manip_type
+{
+	IP_NAT_MANIP_SRC,
+	IP_NAT_MANIP_DST
+};
+
+#ifndef CONFIG_IP_NF_NAT_LOCAL
+/* SRC manip occurs only on POST_ROUTING */
+#define HOOK2MANIP&#40;hooknum&#41; &#40;&#40;hooknum&#41; != NF_IP_POST_ROUTING&#41;
+#else
+/* SRC manip occurs POST_ROUTING or LOCAL_IN */
+#define HOOK2MANIP&#40;hooknum&#41; &#40;&#40;hooknum&#41; != NF_IP_POST_ROUTING &#38;&#38; &#40;hooknum&#41; != NF_IP_LOCAL_IN&#41;
+#endif
+
+/* 2.3.19 &#40;I hope&#41; will define this in linux/netfilter_ipv4.h. */
+#ifndef SO_ORIGINAL_DST
+#define SO_ORIGINAL_DST 80
+#endif
+
+#define IP_NAT_RANGE_MAP_IPS 1
+#define IP_NAT_RANGE_PROTO_SPECIFIED 2
+/* Used internally by get_unique_tuple&#40;&#41;. */
+#define IP_NAT_RANGE_FULL 4
+
+/* NAT sequence number modifications */
+struct ip_nat_seq {
+	/* position of the last TCP sequence number 
+	 * modification &#40;if any&#41; */
+	u_int32_t correction_pos;
+	/* sequence number offset before and after last modification */
+	int32_t offset_before, offset_after;
+};
+
+/* Single range specification. */
+struct ip_nat_range
+{
+	/* Set to OR of flags above. */
+	unsigned int flags;
+
+	/* Inclusive: network order. */
+	u_int32_t min_ip, max_ip;
+
+	/* Inclusive: network order */
+	union ip_conntrack_manip_proto min, max;
+};
+
+/* A range consists of an array of 1 or more ip_nat_range */
+struct ip_nat_multi_range
+{
+	unsigned int rangesize;
+
+	/* hangs off end. */
+	struct ip_nat_range range[1];
+};
+
+/* Worst case: local-out manip + 1 post-routing, and reverse dirn. */
+#define IP_NAT_MAX_MANIPS &#40;2*3&#41;
+
+struct ip_nat_info_manip
+{
+	/* The direction. */
+	u_int8_t direction;
+
+	/* Which hook the manipulation happens on. */
+	u_int8_t hooknum;
+
+	/* The manipulation type. */
+	u_int8_t maniptype;
+
+	/* Manipulations to occur at each conntrack in this dirn. */
+	struct ip_conntrack_manip manip;
+};
+
+#endif
diff -u -r -N IPTables-IPv4-0.98-orig/libiptc/libip6tc.c IPTables-IPv4-0.98/libiptc/libip6tc.c
--- IPTables-IPv4-0.98-orig/libiptc/libip6tc.c	2003-07-04 23:06:44.000000000 +0200
+++ IPTables-IPv4-0.98/libiptc/libip6tc.c	2008-07-28 12:55:39.000000000 +0200
@@ -111,7 +111,7 @@
 #include &#34;libiptc.c&#34;
 
 #define BIT6&#40;a, l&#41; \
- &#40;&#40;ntohl&#40;a-&gt;in6_u.u6_addr32[&#40;l&#41; / 32]&#41; &gt;&gt; &#40;31 - &#40;&#40;l&#41; &#38; 31&#41;&#41;&#41; &#38; 1&#41;
+ &#40;&#40;ntohl&#40;a-&gt;__in6_u.__u6_addr32[&#40;l&#41; / 32]&#41; &gt;&gt; &#40;31 - &#40;&#40;l&#41; &#38; 31&#41;&#41;&#41; &#38; 1&#41;
 
 int
 ipv6_prefix_length&#40;const struct in6_addr *a&#41;
diff -u -r -N IPTables-IPv4-0.98-orig/libiptc/Makefile IPTables-IPv4-0.98/libiptc/Makefile
--- IPTables-IPv4-0.98-orig/libiptc/Makefile	2003-07-05 04:36:11.000000000 +0200
+++ IPTables-IPv4-0.98/libiptc/Makefile	2008-07-28 13:08:55.000000000 +0200
@@ -1,4 +1,4 @@
-CFLAGS := -I../include -I/usr/src/linux/include -DIPTABLES_VERSION=\&#34;1.2.8\&#34; -O2 -Wall
+CFLAGS := -I../include -I/usr/src/linux/include -DIPTABLES_VERSION=\&#34;1.2.8\&#34; -O2 -Wall -fPIC
 CC := gcc
 AR := ar
 RM := rm
diff -u -r -N IPTables-IPv4-0.98-orig/Makefile.PL IPTables-IPv4-0.98/Makefile.PL
--- IPTables-IPv4-0.98-orig/Makefile.PL	2003-07-05 06:50:57.000000000 +0200
+++ IPTables-IPv4-0.98/Makefile.PL	2008-07-28 13:00:48.000000000 +0200
@@ -80,7 +80,7 @@
     &#39;VERSION_FROM&#39; =&gt; &#39;IPv4.pm&#39;, # finds $VERSION
     &#39;OBJECT&#39;	=&gt; &#39;IPv4.o loader.o packer.o unpacker.o maskgen.o libiptc/libiptc.a&#39;,
     &#39;INC&#39;	=&gt; &#39;-Iinclude -I/usr/src/linux/include&#39;,
-    &#39;CCFLAGS&#39;	=&gt; &#34;-Wall -DMODULE_PATH=\\\&#34;$moduledir\\\&#34;&#34; . &#40;defined $Config{&#39;use64bitint&#39;} ? &#34; -DPERL_USES_64BIT_INT&#34; : &#34;&#34;&#41;,
+    &#39;CCFLAGS&#39;	=&gt; &#34;-Wall -fPIC -DMODULE_PATH=\\\&#34;$moduledir\\\&#34;&#34; . &#40;defined $Config{&#39;use64bitint&#39;} ? &#34; -DPERL_USES_64BIT_INT&#34; : &#34;&#34;&#41;,
     &#39;TYPEMAPS&#39;	=&gt; [&#39;IPTables.typemap&#39;],
     &#39;XSPROTOARG&#39; =&gt; &#39;-noprototypes&#39;,
 &#41;;
diff -u -r -N IPTables-IPv4-0.98-orig/modules/Makefile IPTables-IPv4-0.98/modules/Makefile
--- IPTables-IPv4-0.98-orig/modules/Makefile	2003-07-06 19:29:47.000000000 +0200
+++ IPTables-IPv4-0.98/modules/Makefile	2008-07-28 14:32:44.000000000 +0200
@@ -16,7 +16,7 @@
 INSTALL_DIR := $&#40;INSTALL_BASE&#41;/lib/IPTables-IPv4
 endif
 
-CFLAGS := -I$&#40;KERNEL_INC&#41; -I$&#40;NF_INC&#41; -I$&#40;PERL_INC&#41; -I.. -Wall -O2 -Wundef
+CFLAGS := -I$&#40;KERNEL_INC&#41; -I$&#40;NF_INC&#41; -I$&#40;PERL_INC&#41; -I.. -Wall -O2 -Wundef -fPIC
 
 # Basic protocol modules for IPTables::IPv4
 MODULE_NAMES := icmp tcp udp ah esp
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
