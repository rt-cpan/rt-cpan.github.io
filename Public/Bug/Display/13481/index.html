<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13481 for Log-Dispatch: Log::Dispatch::File permissions</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13481 for Log-Dispatch: Log::Dispatch::File permissions</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Log-Dispatch">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Log-Dispatch">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Log-Dispatch">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Log-Dispatch">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/houseabsolute/Log-Dispatch/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Log-Dispatch">Log-Dispatch CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13481</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Log-Dispatch">Log-Dispatch</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jens-petter.salvesen [...] experian-scorex.no

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-19400-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.10    </td>
  </tr>
  <tr id="CF-19401-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




File.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/135402/36769/File.pm">
Thu Jun 30 07:03:09 2005 (7.9k) by 
</a>
</font></li>
</ul>


File_1.22.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/135405/39535/File_1.22.patch">
Wed Aug 31 09:41:42 2005 (321b) by 
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/135404/39530/File_1.22.patch">
Wed Aug 31 07:49:06 2005 (321b) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=13481">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135402" href="/Public/Bug/Display.html?id=13481#txn-135402">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;07:03:08&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Log::Dispatch::File permissions</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/135402/36768/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/36768">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 567b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Consider the folllowing scenario:

Several programs write to one file.
Each program is run by a different user.
We want to make the file writeable by all. However, the chmod operation fails even though the user has write permission to the file given that the file 
is owned by someone else.

So, I have created a patch that checks whether permissions of a file matches those supplied before trying to chmod. This works for my scenario, but I am a bit unsure of how to make this work for every scenario. Perhaps it should be possible to specify user/group of the file?
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135402/36769/File.pm">Download File.pm</a><br />
<span class="downloadcontenttype">text/x-perl 7.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Log::Dispatch::File;

use strict;

use Log::Dispatch::Output;

use base qw&#40; Log::Dispatch::Output &#41;;

use Params::Validate qw&#40;validate SCALAR BOOLEAN&#41;;
Params::Validate::validation_options&#40; allow_extra =&gt; 1 &#41;;

use vars qw[ $VERSION ];

$VERSION = sprintf &#34;%d.%02d&#34;, q$Revision: 1.22 $ =~ /: &#40;\d+&#41;\.&#40;\d+&#41;/;

# Prevents death later on if IO::File can&#39;t export this constant.
*O_APPEND = \&#38;APPEND unless defined &#38;O_APPEND;

sub APPEND { 0 }

1;

sub new
{
    my $proto = shift;
    my $class = ref $proto || $proto;

    my %p = @_;

    my $self = bless {}, $class;

    $self-&gt;_basic_init&#40;%p&#41;;
    $self-&gt;_make_handle&#40;%p&#41;;

    return $self;
}

sub _make_handle
{
    my $self = shift;

    my %p = validate&#40; @_, { filename  =&gt; { type =&gt; SCALAR },
			    mode      =&gt; { type =&gt; SCALAR,
					   default =&gt; &#39;&gt;&#39; },
			    autoflush =&gt; { type =&gt; BOOLEAN,
					   default =&gt; 1 },
          		    close_after_write =&gt; { type =&gt; BOOLEAN,
                                                   default =&gt; 0 },
                            permissions =&gt; { type =&gt; SCALAR,
                                             optional =&gt; 1 },
			  } &#41;;

    $self-&gt;{filename} = $p{filename};
    $self-&gt;{close} = $p{close_after_write};
    $self-&gt;{permissions} = $p{permissions};

    if &#40; $self-&gt;{close} &#41;
    {
        $self-&gt;{mode} = &#39;&gt;&gt;&#39;;
    }
    elsif &#40; exists $p{mode} &#38;&#38;
	 defined $p{mode} &#38;&#38;
	 &#40; $p{mode} =~ /^&#40;?:&gt;&gt;|append&#41;$/ ||
	   &#40; $p{mode} =~ /^\d+$/ &#38;&#38;
	     $p{mode} == O_APPEND&#40;&#41; &#41; &#41; &#41;
    {
	$self-&gt;{mode} = &#39;&gt;&gt;&#39;;
    }
    else
    {
	$self-&gt;{mode} = &#39;&gt;&#39;;
    }

    $self-&gt;{autoflush} = $p{autoflush};

    $self-&gt;_open_file&#40;&#41; unless $p{close_after_write};

}

sub _open_file
{
    my $self = shift;

    my $fh = do { local *FH; *FH; };

    open $fh, &#34;$self-&gt;{mode}$self-&gt;{filename}&#34;
        or die &#34;Cannot write to &#39;$self-&gt;{filename}&#39;: $!&#34;;

    if &#40; $self-&gt;{autoflush} &#41;
    {
        my $oldfh = select $fh; $| = 1; select $oldfh;
    }

    if &#40; $self-&gt;{permissions} &#38;&#38; ! $self-&gt;{chmodded} &#41;
    {

	my $current_mode = &#40;stat&#40;$self-&gt;{filename}&#41;&#41;[2];
        unless &#40;&#40;$current_mode &#38; 0777&#41; == $self-&gt;{permissions}&#41; { 

	  chmod $self-&gt;{permissions}, $self-&gt;{filename}
            or die &#34;Cannot chmod $self-&gt;{filename} to $self-&gt;{permissions}: $!&#34;;

	}

        $self-&gt;{chmodded} = 1;
    }

    $self-&gt;{fh} = $fh;
}

sub log_message
{
    my $self = shift;
    my %p = @_;

    my $fh;

    if &#40; $self-&gt;{close} &#41;
    {
      	$self-&gt;_open_file;
	$fh = $self-&gt;{fh};
      	print $fh $p{message}
            or die &#34;Cannot write to &#39;$self-&gt;{filename}&#39;: $!&#34;;

      	close $fh
            or die &#34;Cannot close &#39;$self-&gt;{filename}&#39;: $!&#34;;
    }
    else
    {
        $fh = $self-&gt;{fh};
        print $fh $p{message}
            or die &#34;Cannot write to &#39;$self-&gt;{filename}&#39;: $!&#34;;
    }
}


sub DESTROY
{
    my $self = shift;

    if &#40; $self-&gt;{fh} &#41;
    {
	my $fh = $self-&gt;{fh};
	close $fh;
    }
}

__END__

=head1 NAME

Log::Dispatch::File - Object for logging to files

=head1 SYNOPSIS

  use Log::Dispatch::File;

  my $file = Log::Dispatch::File-&gt;new&#40; name      =&gt; &#39;file1&#39;,
                                       min_level =&gt; &#39;info&#39;,
                                       filename  =&gt; &#39;Somefile.log&#39;,
                                       mode      =&gt; &#39;append&#39; &#41;;

  $file-&gt;log&#40; level =&gt; &#39;emerg&#39;, message =&gt; &#34;I&#39;ve fallen and I can&#39;t get up\n&#34; &#41;;

=head1 DESCRIPTION

This module provides a simple object for logging to files under the
Log::Dispatch::* system.

=head1 METHODS

=over 4

=item * new&#40;%p&#41;

This method takes a hash of parameters.  The following options are
valid:

=over 8

=item * name &#40;$&#41;

The name of the object &#40;not the filename!&#41;.  Required.

=item * min_level &#40;$&#41;

The minimum logging level this object will accept.  See the
Log::Dispatch documentation for more information.  Required.

=item * max_level &#40;$&#41;

The maximum logging level this obejct will accept.  See the
Log::Dispatch documentation for more information.  This is not
required.  By default the maximum is the highest possible level &#40;which
means functionally that the object has no maximum&#41;.

=item * filename &#40;$&#41;

The filename to be opened for writing.

=item * mode &#40;$&#41;

The mode the file should be opened with.  Valid options are &#39;write&#39;,
&#39;&gt;&#39;, &#39;append&#39;, &#39;&gt;&gt;&#39;, or the relevant constants from Fcntl.  The
default is &#39;write&#39;.

=item * close_after_write &#40;$&#41;

Whether or not the file should be closed after each write.  This
defaults to false.

If this is true, then the mode will aways be append, so that the file
is not re-written for each new message.

=item * autoflush &#40;$&#41;

Whether or not the file should be autoflushed.  This defaults to true.

=item * permissions &#40;$&#41;

If the file does not already exist, the permissions that it should
be created with.  Optional.  The argument passed must be a valid
octal value, such as 0600 or the constants available from Fcntl, like
S_IRUSR|S_IWUSR.

See L&lt;perlfunc/chmod&gt; for more on potential traps when passing octal
values around.  Most importantly, remember that if you pass a string
that looks like an octal value, like this:

 my $mode = &#39;0644&#39;;

Then the resulting file will end up with permissions like this:

 --w----r-T

which is probably not what you want.

=item * callbacks&#40; \&#38; or [ \&#38;, \&#38;, ... ] &#41;

This parameter may be a single subroutine reference or an array
reference of subroutine references.  These callbacks will be called in
the order they are given and passed a hash containing the following keys:

 &#40; message =&gt; $log_message, level =&gt; $log_level &#41;

The callbacks are expected to modify the message and then return a
single scalar containing that modified message.  These callbacks will
be called when either the C&lt;log&gt; or C&lt;log_to&gt; methods are called and
will only be applied to a given message once.

=back

=item * log_message&#40; message =&gt; $ &#41;

Sends a message to the appropriate output.  Generally this shouldn&#39;t
be called directly but should be called through the C&lt;log&#40;&#41;&gt; method
&#40;in Log::Dispatch::Output&#41;.

=back

=head1 AUTHOR

Dave Rolsky, &lt;autarch@urth.org&gt;

=cut

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135403" href="/Public/Bug/Display.html?id=13481#txn-135403">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;27&nbsp;10:41:20&nbsp;2005</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/135403/38080/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38080">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 561b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Thu Jun 30 07:03:08 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, I have created a patch that checks whether permissions of a file
&gt;    matches those supplied before trying to chmod. This works for my
&gt;    scenario, but I am a bit unsure of how to make this work for every
&gt;    scenario. Perhaps it should be possible to specify user/group of
&gt;    the file?
</div>
A couple things:

1. This isn&#39;t a patch, it&#39;s the whole thing.  Can you send an actual
patch against the latest version?

2. You may want to consider just writing your own Log::Dispatch output
class that does what you want.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135404" href="/Public/Bug/Display.html?id=13481#txn-135404">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;31&nbsp;07:49:05&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> morten.bjornsvik [...] experian-scorex.no</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/135404/39529/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/39529">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 632b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Dave

There is another problem with permissions, This may be out of the
current scope, but in a multiuser environment accessing the same
log4perl logging files. The chmodded variable is not migrated among
different running programs. Maybe this is a log4perl issue, but
permissions is inherited from the File.pm class.

Especially serious for SGID directories where only root or owner may
change permissions on a file although you are in the owning group with
RW access.

My simple naive fix is to just check if the file exists before writing
to it the very first time, if not then running user may chmod the file.

Thanks
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135404/39530/File_1.22.patch">Download File_1.22.patch</a><br />
<span class="downloadcontenttype">text/x-diff 321b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">83d82
&lt; 		my&#40;$newfile&#41; = 0;
87,90d85
&lt; 		if &#40; -f $self-&gt;{filename} &#41; {
&lt; 			$newfile=1;
&lt; 		}
&lt; 			
99c94
&lt;     if &#40; $self-&gt;{permissions} &#38;&#38; ! $self-&gt;{chmodded} &#38;&#38; $newfile&#41;
---
&gt;     if &#40; $self-&gt;{permissions} &#38;&#38; ! $self-&gt;{chmodded} &#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135405" href="/Public/Bug/Display.html?id=13481#txn-135405">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;31&nbsp;09:41:42&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> morten.bjornsvik [...] experian-scorex.no</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/135405/39534/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/39534">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 83b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Wed Aug 31 07:49:05 2005]:

Sorry there was a &#39;!&#39; missing on line 87 :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135405/39535/File_1.22.patch">Download File_1.22.patch</a><br />
<span class="downloadcontenttype">text/x-diff 321b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">83d82
&lt; 		my&#40;$newfile&#41; = 0;
87,90d85
&lt; 		if &#40; ! -f $self-&gt;{filename} &#41; {
&lt; 			$newfile=1;
&lt; 		}
&lt; 			
99c94
&lt;     if &#40; $self-&gt;{permissions} &#38;&#38; ! $self-&gt;{chmodded} &#38;&#38; $newfile&#41;
---
&gt;     if &#40; $self-&gt;{permissions} &#38;&#38; ! $self-&gt;{chmodded} &#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135406" href="/Public/Bug/Display.html?id=13481#txn-135406">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;01&nbsp;10:55:05&nbsp;2005</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 1 Sep 2005 09:54:35 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-Log-Dispatch [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #13481] Log::Dispatch::File permissions </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135406/39609/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/39609">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1014b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 31 Aug 2005, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is another problem with permissions, This may be out of the
&gt; current scope, but in a multiuser environment accessing the same
&gt; log4perl logging files. The chmodded variable is not migrated among
&gt; different running programs. Maybe this is a log4perl issue, but
&gt; permissions is inherited from the File.pm class.
&gt;
&gt; Especially serious for SGID directories where only root or owner may
&gt; change permissions on a file although you are in the owning group with
&gt; RW access.
&gt;
&gt; My simple naive fix is to just check if the file exists before writing
&gt; to it the very first time, if not then running user may chmod the file.
</div>
I&#39;m not quite following.  What do you mean by &#34;The chmodded variable is 
not migrated among different running programs&#34;?


-dave

/*===================================================
VegGuide.Org                        www.BookIRead.com
Your guide to all that&#39;s veg.       My book blog
===================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135407" href="/Public/Bug/Display.html?id=13481#txn-135407">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;27&nbsp;11:05:52&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> morten.bjornsvik [...] experian-scorec.no</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135407/40633/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/40633">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 911b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[autarch@urth.org - Thu Sep  1 10:55:05 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not quite following.  What do you mean by &#34;The chmodded variable
&gt;    is
&gt; not migrated among different running programs&#34;?
</div>
Hi sorry for being unclear

This is the chmod test File.pm:
94-99:
if &#40; $self-&gt;{permissions} &#38;&#38; ! $self-&gt;{chmodded} &#41;
{
  chmod $self-&gt;{permissions}, $self-&gt;{filename}
  or die &#34;Cannot chmod $self-&gt;{filename} to $self-&gt;{permissions}: $!&#34;;
  $self-&gt;{chmodded} = 1;   #&lt;---- no way to share this between progs
}

When you create a log object object this variable is set there,
but if another program/user tries to write to the same file, their
{chmodded} is 0 and it fails executing chmod&#40;&#41; and the entire
program stops.

A simple solution would be to create a tempfile/semaphore which holds
the variable so each running program can check for it, but multiuser
handling is probably outside the scope of Log/Dispatch/File.pm

Thanks
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200062" href="/Public/Bug/Display.html?id=13481#txn-200062">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;26&nbsp;20:57:21&nbsp;2006</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/200062/74446/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/74446">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 27 11:05:52 2005, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [autarch@urth.org - Thu Sep  1 10:55:05 2005]:
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;m not quite following.  What do you mean by &#34;The chmodded variable
&gt; &gt;    is
&gt; &gt; not migrated among different running programs&#34;?
</div>&gt; 
&gt; Hi sorry for being unclear
&gt; 
&gt; This is the chmod test File.pm:
&gt; 94-99:
&gt; if &#40; $self-&gt;{permissions} &#38;&#38; ! $self-&gt;{chmodded} &#41;
&gt; {
&gt;   chmod $self-&gt;{permissions}, $self-&gt;{filename}
&gt;   or die &#34;Cannot chmod $self-&gt;{filename} to $self-&gt;{permissions}: $!&#34;;
&gt;   $self-&gt;{chmodded} = 1;   #&lt;---- no way to share this between progs
&gt; }
&gt; 
&gt; When you create a log object object this variable is set there,
&gt; but if another program/user tries to write to the same file, their
&gt; {chmodded} is 0 and it fails executing chmod&#40;&#41; and the entire
&gt; program stops.
&gt; 
&gt; A simple solution would be to create a tempfile/semaphore which holds
&gt; the variable so each running program can check for it, but multiuser
&gt; handling is probably outside the scope of Log/Dispatch/File.pm
</div>
Sorry for the much delayed reply. Yes, this is out of scope for this module.

If I&#39;m reading the original report correctly, it seems like the best way
to handle this is to _not_ pass the permissions parameter to
Log::Dispatch::File. Instead, you can just chmod this in _one_ of your
programs as needed.

I&#39;m going to mark this as resolved, since I don&#39;t think it&#39;s realistic
to expect a module like this to handle IPC between programs. That sort
of thing needs to be handled at a higher &#40;or at least different&#41; level.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200063" href="/Public/Bug/Display.html?id=13481#txn-200063">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;26&nbsp;20:57:22&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200065" href="/Public/Bug/Display.html?id=13481#txn-200065">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;26&nbsp;20:57:22&nbsp;2006</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.480712</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
