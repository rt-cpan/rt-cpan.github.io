<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #97201 for Crypt-GCrypt: Crypt::GCrypt 1.26 incompatibility with libgcrypt 1.6.1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #97201 for Crypt-GCrypt: Crypt::GCrypt 1.26 incompatibility with libgcrypt 1.6.1</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Crypt-GCrypt/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Crypt-GCrypt/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Crypt-GCrypt/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Crypt-GCrypt/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-GCrypt">Crypt-GCrypt CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">97201</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Crypt-GCrypt/Active/">Crypt-GCrypt</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ryandesign [...] macports.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8428-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8429-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;14&nbsp;05:57:16&nbsp;2014</span>
    <span class="description">ryandesign [...] macports.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Crypt::GCrypt 1.26 incompatibility with libgcrypt 1.6.1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 14 Jul 2014 04:56:55 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Crypt-GCrypt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Schmidt &lt;ryandesign [...] macports.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello, I&#39;m a developer with the MacPorts package management system, trying to update our libgcrypt package from 1.5.3 to 1.6.1. After doing so, Crypt::GCrypt 1.26 fails to build, as shown at the end of this email.


The perl version is:

$ perl5.16 -v

This is perl 5, version 16, subversion 3 &#40;v5.16.3&#41; built for darwin-thread-multi-2level

Copyright 1987-2012, Larry Wall

Perl may be copied only under the terms of either the Artistic License or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using &#34;man perl&#34; or &#34;perldoc perl&#34;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.


The OS X version is:

$ sw_vers
ProductName:    Mac OS X
ProductVersion: 10.9.4
BuildVersion:   13E28


The errors in the log are:

/opt/local/bin/perl5.16 /opt/local/lib/perl5/5.16.3/ExtUtils/xsubpp  -typemap /opt/local/lib/perl5/5.16.3/ExtUtils/typemap -typemap typemap  GCrypt.xs &gt; GCrypt.xsc &#38;&#38; mv GCrypt.xsc GCrypt.c
/usr/bin/clang -c  -I/opt/local/include -funsigned-char -pipe -Os -isysroot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk   -fno-common -DPERL_DARWIN -I/opt/local/include -isysroot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -fno-strict-aliasing -fstack-protector -I/opt/local/include -arch x86_64 -arch i386 -O3   -DVERSION=\&#34;1.26\&#34; -DXS_VERSION=\&#34;1.26\&#34;  &#34;-I/opt/local/lib/perl5/5.16.3/darwin-thread-multi-2level/CORE&#34;   GCrypt.c
In file included from GCrypt.xs:17:
./ppport.h:227:11: warning: &#39;PERL_UNUSED_DECL&#39; macro redefined
#  define PERL_UNUSED_DECL
          ^
/opt/local/lib/perl5/5.16.3/darwin-thread-multi-2level/CORE/perl.h:328:13: note: previous definition is here
#    define PERL_UNUSED_DECL __attribute__unused__
            ^
GCrypt.xs:59:5: error: unknown type name &#39;gcry_ac_handle_t&#39;; did you mean &#39;gcry_mac_hd_t&#39;?
    gcry_ac_handle_t h_ac;
    ^~~~~~~~~~~~~~~~
    gcry_mac_hd_t
/opt/local/include/gcrypt.h:1304:33: note: &#39;gcry_mac_hd_t&#39; declared here
typedef struct gcry_mac_handle *gcry_mac_hd_t;
                                ^
GCrypt.xs:61:5: error: unknown type name &#39;gcry_ac_key_t&#39;; did you mean &#39;gcry_mac_hd_t&#39;?
    gcry_ac_key_t key_ac;
    ^~~~~~~~~~~~~
    gcry_mac_hd_t
/opt/local/include/gcrypt.h:1304:33: note: &#39;gcry_mac_hd_t&#39; declared here
typedef struct gcry_mac_handle *gcry_mac_hd_t;
                                ^
GCrypt.xs:121:5: warning: &#39;gcry_thread_cbs&#39; is deprecated [-Wdeprecated-declarations]
    GCRY_THREAD_OPTION_PTHREAD_IMPL;
    ^
/opt/local/include/gcrypt.h:227:17: note: expanded from macro &#39;GCRY_THREAD_OPTION_PTHREAD_IMPL&#39;
  static struct gcry_thread_cbs gcry_threads_pthread = {                \
                ^
/opt/local/include/gcrypt.h:213:8: note: &#39;gcry_thread_cbs&#39; declared here
struct gcry_thread_cbs
       ^
GCrypt.xs:206:9: error: unknown type name &#39;gcry_ac_id_t&#39;; did you mean &#39;gcry_mac_hd_t&#39;?
        gcry_ac_id_t ac_algo;
        ^~~~~~~~~~~~
        gcry_mac_hd_t
/opt/local/include/gcrypt.h:1304:33: note: &#39;gcry_mac_hd_t&#39; declared here
typedef struct gcry_mac_handle *gcry_mac_hd_t;
                                ^
GCrypt.xs:337:27: warning: implicit declaration of function &#39;gcry_ac_name_to_id&#39; is invalid in C99 [-Wimplicit-function-declaration]
            RETVAL-&gt;err = gcry_ac_name_to_id&#40;algo_s, &#38;ac_algo&#41;;
                          ^
GCrypt.xs:342:27: warning: implicit declaration of function &#39;gcry_ac_open&#39; is invalid in C99 [-Wimplicit-function-declaration]
            RETVAL-&gt;err = gcry_ac_open&#40;&#38;RETVAL-&gt;h_ac, ac_algo, ac_flags&#41;;
                          ^
GCrypt.xs:541:9: error: use of undeclared identifier &#39;gcry_ac_data_t&#39;
        gcry_ac_data_t outdata;
        ^
GCrypt.xs:597:9: error: use of undeclared identifier &#39;gcry_ac_key_type_t&#39;
        gcry_ac_key_type_t keytype;
        ^
GCrypt.xs:598:9: error: use of undeclared identifier &#39;gcry_ac_data_t&#39;
        gcry_ac_data_t keydata;
        ^
GCrypt.xs:623:13: error: use of undeclared identifier &#39;keytype&#39;
            keytype = -1;
            ^
GCrypt.xs:625:44: error: use of undeclared identifier &#39;keytype&#39;
            if &#40;strcmp&#40;s, &#34;private&#34;&#41; == 0&#41; keytype = GCRY_AC_KEY_SECRET;
                                           ^
GCrypt.xs:625:54: error: use of undeclared identifier &#39;GCRY_AC_KEY_SECRET&#39;
            if &#40;strcmp&#40;s, &#34;private&#34;&#41; == 0&#41; keytype = GCRY_AC_KEY_SECRET;
                                                     ^
GCrypt.xs:626:43: error: use of undeclared identifier &#39;keytype&#39;
            if &#40;strcmp&#40;s, &#34;public&#34;&#41; == 0&#41; keytype = GCRY_AC_KEY_PUBLIC;
                                          ^
GCrypt.xs:626:53: error: use of undeclared identifier &#39;GCRY_AC_KEY_PUBLIC&#39;
            if &#40;strcmp&#40;s, &#34;public&#34;&#41; == 0&#41; keytype = GCRY_AC_KEY_PUBLIC;
                                                    ^
GCrypt.xs:627:17: error: use of undeclared identifier &#39;keytype&#39;
            if &#40;keytype == -1&#41;
                ^
GCrypt.xs:633:24: warning: implicit declaration of function &#39;gcry_ac_data_new&#39; is invalid in C99 [-Wimplicit-function-declaration]
            gcr-&gt;err = gcry_ac_data_new&#40;&#38;keydata&#41;;
                       ^
GCrypt.xs:633:42: error: use of undeclared identifier &#39;keydata&#39;
            gcr-&gt;err = gcry_ac_data_new&#40;&#38;keydata&#41;;
                                         ^
GCrypt.xs:634:24: warning: implicit declaration of function &#39;gcry_ac_data_set&#39; is invalid in C99 [-Wimplicit-function-declaration]
            gcr-&gt;err = gcry_ac_data_set&#40;keydata, GCRY_AC_FLAG_COPY, &#34;s&#34;, mpi&#41;;
                       ^
GCrypt.xs:634:41: error: use of undeclared identifier &#39;keydata&#39;
            gcr-&gt;err = gcry_ac_data_set&#40;keydata, GCRY_AC_FLAG_COPY, &#34;s&#34;, mpi&#41;;
                                        ^
GCrypt.xs:635:24: warning: implicit declaration of function &#39;gcry_ac_key_init&#39; is invalid in C99 [-Wimplicit-function-declaration]
            gcr-&gt;err = gcry_ac_key_init&#40;&#38;gcr-&gt;key_ac, gcr-&gt;h_ac, keytype, keydata&#41;;
                       ^
GCrypt.xs:635:66: error: use of undeclared identifier &#39;keytype&#39;
            gcr-&gt;err = gcry_ac_key_init&#40;&#38;gcr-&gt;key_ac, gcr-&gt;h_ac, keytype, keydata&#41;;
                                                                 ^
GCrypt.xs:799:42: warning: implicit declaration of function &#39;gcry_ac_close&#39; is invalid in C99 [-Wimplicit-function-declaration]
        if &#40;gcr-&gt;type == CG_TYPE_ASYMM&#41;  gcry_ac_close&#40;gcr-&gt;h_ac&#41;;
                                         ^
8 warnings and 15 errors generated.
make: *** [GCrypt.o] Error 1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;27&nbsp;10:20:56&nbsp;2014</span>
    <span class="description">complx-on-cpan [...] opsec.eu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

I&#39;m one of the FreeBSD ports people, we have the
same problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; trying to update our libgcrypt package from 1.5.3 to 1.6.1. After
&gt; doing so, Crypt::GCrypt 1.26 fails to build, as shown at the end of
&gt; this email.
</div>
Apply this patch and it should build.

libgcrypt 1.6.x reworked the assymmetric crypto API,
but this wasn&#39;t implemented in the perl module, anyway.

So this just removes those stub parts in the module.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Crypt-GCrypt.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- GCrypt.xs.orig	2011-05-27 22:04:03.000000000 +0200
+++ GCrypt.xs	2014-07-27 16:14:05.000000000 +0200
@@ -56,9 +56,13 @@
     int type;
     int action;
     gcry_cipher_hd_t h;
+/*
     gcry_ac_handle_t h_ac;
+*/
     gcry_md_hd_t h_md;
+/*
     gcry_ac_key_t key_ac;
+*/
     gcry_error_t err;
     int mode;
     int padding;
@@ -203,7 +207,9 @@
         char *s, *algo_s, *mode_s, *key_s;
         int i, algo, mode;
         unsigned int c_flags, ac_flags, md_flags;
+/*
         gcry_ac_id_t ac_algo;
+*/
         bool have_mode;
     CODE:
         New&#40;0, RETVAL, 1, struct Crypt_GCrypt_s&#41;;
@@ -322,25 +328,19 @@
             if &#40;!&#40;algo = gcry_md_map_name&#40;algo_s&#41;&#41;&#41;
                 croak&#40;&#34;Unknown digest algorithm %s&#34;, algo_s&#41;;
 
-        RETVAL-&gt;err = gcry_md_open&#40;&#38;RETVAL-&gt;h_md, algo, md_flags&#41;;
+            RETVAL-&gt;err = gcry_md_open&#40;&#38;RETVAL-&gt;h_md, algo, md_flags&#41;;
             if &#40;RETVAL-&gt;h_md == NULL&#41; XSRETURN_UNDEF;
 
-        if &#40;md_flags &#38; GCRY_MD_FLAG_HMAC&#41; {
-            /* what if this overwrites the earlier error value? */
-            RETVAL-&gt;err = gcry_md_setkey&#40;RETVAL-&gt;h_md, key_s, RETVAL-&gt;keylen&#41;;
+            if &#40;md_flags &#38; GCRY_MD_FLAG_HMAC&#41; {
+                /* what if this overwrites the earlier error value? */
+                RETVAL-&gt;err = gcry_md_setkey&#40;RETVAL-&gt;h_md, key_s, RETVAL-&gt;keylen&#41;;
+            }
         }
-    }
         if &#40;RETVAL-&gt;type == CG_TYPE_ASYMM&#41; {
         
             croak&#40;&#34;Asymmetric cryptography is not yet supported by Crypt::GCrypt&#34;&#41;;
+	    XSRETURN_UNDEF;
             
-            RETVAL-&gt;err = gcry_ac_name_to_id&#40;algo_s, &#38;ac_algo&#41;;
-            if &#40;RETVAL-&gt;err&#41;
-                croak&#40;&#34;Unknown algorithm %s&#34;, algo_s&#41;;
-            
-            /* Init ac */
-            RETVAL-&gt;err = gcry_ac_open&#40;&#38;RETVAL-&gt;h_ac, ac_algo, ac_flags&#41;;
-            if &#40;RETVAL-&gt;h_ac == NULL&#41; XSRETURN_UNDEF;
         }
         
 
@@ -532,39 +532,6 @@
     OUTPUT:
         RETVAL
 
-SV *
-cg_sign&#40;gcr, in&#41;
-    Crypt_GCrypt gcr;
-    SV *in;
-    PREINIT:
-        gcry_mpi_t in_mpi, out_mpi;
-        gcry_ac_data_t outdata;
-        size_t len;
-        const void *inbuf;
-        const char *label;
-        char* outbuf;
-    CODE:
-        /*
-        in_mpi = gcry_mpi_new&#40;0&#41;;
-        out_mpi = gcry_mpi_new&#40;0&#41;;
-        inbuf = SvPV&#40;in, len&#41;;
-        printf&#40;&#34;inbuf: %s\n&#34;, inbuf&#41;;
-        gcry_mpi_scan&#40; &#38;in_mpi, GCRYMPI_FMT_STD, inbuf, strlen&#40;inbuf&#41;, NULL &#41;;
-        printf&#40;&#34;Key: %s\n&#34;, gcr-&gt;key_ac&#41;;
-        gcr-&gt;err = gcry_ac_data_sign&#40;gcr-&gt;h_ac, gcr-&gt;key_ac, in_mpi, &#38;outdata&#41;;
-        if &#40;gcr-&gt;err&#41; {
-            croak&#40; gcry_strerror&#40;gcr-&gt;err&#41; &#41;;
-        }
-        printf&#40;&#34;Here\n&#34;&#41;;
-        gcr-&gt;err = gcry_ac_data_get_index &#40;outdata, 0, 0, &#38;label, &#38;out_mpi&#41;;
-        printf&#40;&#34;Before &#40;%s&#41;\n&#34;, label&#41;;
-        gcry_mpi_print&#40;GCRYMPI_FMT_STD, outbuf, 1024, NULL, out_mpi&#41;;
-        printf&#40;&#34;After\n&#34;&#41;;
-        RETVAL = newSVpv&#40;outbuf, 0&#41;;
-        */
-    OUTPUT:
-        RETVAL
-
 void
 cg_start&#40;gcr, act&#41;
     Crypt_GCrypt gcr;
@@ -594,8 +561,10 @@
     PREINIT:
         char *k, *s;
         char *mykey, *buf;
+/*
         gcry_ac_key_type_t keytype;
         gcry_ac_data_t keydata;
+*/
         gcry_mpi_t mpi;
         size_t len;
     CODE:
@@ -617,22 +586,7 @@
         
         /* Set key for asymmetric criptography */
         if &#40;gcr-&gt;type == CG_TYPE_ASYMM&#41; {
-            k = SvPV&#40;ST&#40;2&#41;, len&#41;;
-            
-            /* Key type */
-            keytype = -1;
-            s = SvPV&#40;ST&#40;1&#41;, len&#41;;
-            if &#40;strcmp&#40;s, &#34;private&#34;&#41; == 0&#41; keytype = GCRY_AC_KEY_SECRET;
-            if &#40;strcmp&#40;s, &#34;public&#34;&#41; == 0&#41; keytype = GCRY_AC_KEY_PUBLIC;
-            if &#40;keytype == -1&#41;
-                croak&#40;&#34;Key must be private or public&#34;&#41;;
-            
-            gcry_control&#40;GCRYCTL_INIT_SECMEM, strlen&#40;k&#41;&#41;;
-            mpi = gcry_mpi_snew&#40;0&#41;;
-            /* gcry_mpi_scan&#40; &#38;mpi, GCRYMPI_FMT_STD, k, NULL, NULL &#41;; */
-            gcr-&gt;err = gcry_ac_data_new&#40;&#38;keydata&#41;;
-            gcr-&gt;err = gcry_ac_data_set&#40;keydata, GCRY_AC_FLAG_COPY, &#34;s&#34;, mpi&#41;;
-            gcr-&gt;err = gcry_ac_key_init&#40;&#38;gcr-&gt;key_ac, gcr-&gt;h_ac, keytype, keydata&#41;;
+            croak&#40;&#34;Asymmetric cryptography is not yet supported by Crypt::GCrypt&#34;&#41;;
         }
 
 void
@@ -796,7 +750,9 @@
     Crypt_GCrypt gcr;
     CODE:
         if &#40;gcr-&gt;type == CG_TYPE_CIPHER&#41; gcry_cipher_close&#40;gcr-&gt;h&#41;;
+/*
         if &#40;gcr-&gt;type == CG_TYPE_ASYMM&#41;  gcry_ac_close&#40;gcr-&gt;h_ac&#41;;
+*/
         if &#40;gcr-&gt;type == CG_TYPE_DIGEST&#41; gcry_md_close&#40;gcr-&gt;h_md&#41;;
         
         if &#40;gcr-&gt;need_to_call_finish == 1&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;27&nbsp;10:20:56&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
