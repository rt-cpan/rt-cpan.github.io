<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40751 for CGI-Session: Session gets dropped when using a HTTP redirect within CGI::Application</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40751 for CGI-Session: Session gets dropped when using a HTTP redirect within CGI::Application</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=CGI-Session">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=CGI-Session">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=CGI-Session">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=CGI-Session">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Session">CGI-Session CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40751</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=CGI-Session">CGI-Session</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
axo [...] axo.com.ar

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-5872-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-5873-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=40751">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530259" href="/Public/Bug/Display.html?id=40751#txn-530259">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;14:43:23&nbsp;2008</span>
    <span class="description">axo [...] axo.com.ar -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Session gets dropped when using a HTTP redirect within CGI::Application</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Nov 2008 17:42:55 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Axo &lt;axo [...] axo.com.ar&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/530259/265511/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265511">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Session gets dropped when using a HTTP redirect within CGI::Application

This is driving me crazy, am I doing something wrong here?

If I set a couple of session vars, call flush &#40;or not, its the same&#41; and
redirect to another url, in the second run mode a new empty session is
created although
the cookie doesn&#39;t change, so I cant access any of my previous session vars.
This only happens the first time for a given client.
Its easier to understand looking at the code and the logfile &#40;see below&#41;.

System details:
Perl, v5.8.7 built for i486-linux-gnu-thread-multi on Linux u15292264
2.6.23.16-20080211a #1 SMP
$CGI::Session::VERSION  = &#39;4.38&#39;;
$CGI::Application::VERSION = &#39;4.06&#39;;

Code to reproduce:

Application.pm file:

package TEST::Application;
use base &#39;CGI::Application&#39;;
use strict;
use CGI::Application::Plugin::Session;
use Data::Dumper;

open&#40;STDERR, q{&gt;&gt;},&#39;logfiletest&#39;&#41;;

sub cgiapp_init {
    my $self = shift;

    $self-&gt;session_config&#40;
        CGI_SESSION_OPTIONS =&gt; [ &#34;driver:File&#34;, $self-&gt;query,
{Directory=&gt;&#39;/var/tmp&#39;} ],
        SEND_COOKIE =&gt; 1,
        COOKIE_PARAMS =&gt; {
            -expires =&gt; &#34;+1h&#34;
        },
        DEFAULT_EXPIRY =&gt; &#34;1h&#34;
    &#41;;
}

sub cgiapp_prerun {
    my $self = shift;
    my $q = $self-&gt;query;

    warn &#34;Mode: &#34;.Dumper&#40;$q-&gt;path_info&#41;.&#34;\n&#34;;
}

sub setup {
    my $self = shift;

    $self-&gt;start_mode&#40;&#39;index&#39;&#41;;
    $self-&gt;mode_param&#40; path_info =&gt; -1 &#41;;

    $self-&gt;run_modes&#40;[qw/
        index
        ren
    /]&#41;;
}

#######################################################################################
####  Run Modes
#######################################################################################
sub index {
    my $self = shift;
    my $session = $self-&gt;session;

    $session-&gt;param&#40;&#39;md5&#39;,&#39;123456&#39;&#41;;
    $session-&gt;param&#40;&#39;logged_user&#39;, &#39;pepe&#39;&#41;;
    $session-&gt;flush&#40;&#41;;

    warn &#34;index mode session=&#34;.$session-&gt;id;

    my $logged_user = $self-&gt;check_session;

    warn &#34;doing redir...&#34;;
    $self-&gt;redir&#40;&#34;/indextest.pl/ren&#34;&#41;;

    return &#34;index mode session=&#34;.$session-&gt;id;
}

sub ren {
    my $self = shift;
    my $session = $self-&gt;session;

    my $logged_user = $self-&gt;check_session;

    warn &#34;ren logged user=&#34;.$logged_user;

    return &#34;ren mode session=&#34;.$session-&gt;id;
}

#######################################################################################
####  Utility functions
#######################################################################################
sub check_session {
    my $self = shift;
    return unless my $session = $self-&gt;session;
    warn &#34;session id=&#34;.$session-&gt;id;
    warn &#34;dataref=&#34;.Dumper&#40;$session-&gt;dataref&#40;&#41;&#41;;
    warn &#34;cookie =CGISESSID&#34;.$self-&gt;query-&gt;cookie&#40;&#39;CGISESSID&#39;&#41;;

    return unless $session-&gt;param&#40;&#39;md5&#39;&#41;;
    return $session-&gt;param&#40;&#39;logged_user&#39;&#41; if $session-&gt;param&#40;&#39;md5&#39;&#41;;
}

sub redir {
    my $self = shift;
    my $url = shift;
    $self-&gt;header_type&#40;&#39;redirect&#39;&#41;;
    $self-&gt;header_props&#40;-url=&gt;$url&#41;;
    return &#34;Redirecting to $url&#34;;
}

1;


indextest.pl File:

#!/usr/bin/perl -w

use strict;
use CGI::Carp qw&#40;fatalsToBrowser&#41;;
use TEST::Application;

open&#40;STDERR, &#39;&gt;&gt;logfiletest&#39;&#41;;

my $app = new TEST::Application;

$app-&gt;run&#40;&#41;;




Resulting logfiletest:

[Fri Nov  7 14:09:04 2008] indextest.pl: Mode: $VAR1 = &#39;&#39;;
[Fri Nov  7 14:09:04 2008] indextest.pl:
[Fri Nov  7 14:09:05 2008] indextest.pl: index mode
session=8931907b0822e3696087a3797ff79fe9 at TEST/Application.pm line 52.
[Fri Nov  7 14:09:05 2008] indextest.pl: session
id=8931907b0822e3696087a3797ff79fe9 at TEST/Application.pm line 79.
[Fri Nov  7 14:09:05 2008] indextest.pl: dataref=$VAR1 = {
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ETIME&#39; =&gt; 3600,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ID&#39; =&gt;
&#39;8931907b0822e3696087a3797ff79fe9&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ATIME&#39; =&gt;
1226084945,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;logged_user&#39; =&gt; &#39;pepe&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;md5&#39; =&gt; &#39;123456&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_REMOTE_ADDR&#39; =&gt;
&#39;190.18.144.128&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_CTIME&#39; =&gt;
1226084945
[Fri Nov  7 14:09:05 2008] indextest.pl:         };
[Fri Nov  7 14:09:05 2008] indextest.pl: cookie
=CGISESSIDf5f4635a8899929d4649d53074d890c2 at TEST/Application.pm line 81.
[Fri Nov  7 14:09:05 2008] indextest.pl: doing redir... at
TEST/Application.pm line 56.
[Fri Nov  7 14:09:05 2008] indextest.pl: Mode: $VAR1 = &#39;/ren&#39;;
[Fri Nov  7 14:09:05 2008] indextest.pl:
[Fri Nov  7 14:09:05 2008] indextest.pl: session
id=6f5b87b3c56709591d34e2e8920654fa at TEST/Application.pm line 79.
[Fri Nov  7 14:09:05 2008] indextest.pl: dataref=$VAR1 = {
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ETIME&#39; =&gt; 3600,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ID&#39; =&gt;
&#39;6f5b87b3c56709591d34e2e8920654fa&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ATIME&#39; =&gt;
1226084945,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_REMOTE_ADDR&#39; =&gt;
&#39;190.18.144.128&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_CTIME&#39; =&gt;
1226084945
[Fri Nov  7 14:09:05 2008] indextest.pl:         };
[Fri Nov  7 14:09:05 2008] indextest.pl: cookie
=CGISESSIDf5f4635a8899929d4649d53074d890c2 at TEST/Application.pm line 81.
[Fri Nov  7 14:09:05 2008] indextest.pl: Use of uninitialized value in
concatenation &#40;.&#41; or string at TEST/Application.pm line 68.
[Fri Nov  7 14:09:05 2008] indextest.pl: ren logged user= at
TEST/Application.pm line 68.


Steps to reproduce:
1- delete all sessions from /var/tmp
2- go to <span class="clickylink"><a target="new" rel="nofollow" href="http://webserver/indextest.pl">http://webserver/indextest.pl</a></span>

In the logfile you can see that the session id changes after the redirect
even if the cookie its the same. Upon inspection of the session dir, 2
different files &#40;sessions&#41; where created.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/530259/265512/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265512">with headers</a>
<br />
<span class="downloadcontenttype">text/html 8.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530263" href="/Public/Bug/Display.html?id=40751#txn-530263">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;14:43:50&nbsp;2008</span>
    <span class="description">cgi-session-user-owner [...] lists.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #40751] Session gets dropped when using a HTTP redirect within CGI::Application </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 Nov 2008 19:43:34 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-cgi-session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cgi-session-user-owner [...] lists.sourceforge.net</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/530263/265517/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265517">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 243b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">You are not allowed to post to this mailing list, and your message has
been automatically rejected.  If you think that your messages are
being rejected in error, contact the mailing list owner at
cgi-session-user-owner@lists.sourceforge.net.
</div></div>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #40751] Session gets dropped when using a HTTP redirect
	within CGI::Application </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 Nov 2008 14:43:27 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> cgi-session-user [...] lists.sourceforge.net</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Axo via RT&#34; &lt;bug-CGI-Session [...] rt.cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/530263/265520/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265520">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fri Nov 07 14:43:23 2008: Request 40751 was acted upon.
Transaction: Ticket created by axo@axo.com.ar
       Queue: CGI-Session
     Subject: Session gets dropped when using a HTTP redirect within CGI::Application
   Broken in: &#40;no value&#41;
    Severity: &#40;no value&#41;
       Owner: Nobody
  Requestors: axo@axo.com.ar
      Status: new
 Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40751">http://rt.cpan.org/Ticket/Display.html?id=40751</a></span> &gt;


Session gets dropped when using a HTTP redirect within CGI::Application

This is driving me crazy, am I doing something wrong here?

If I set a couple of session vars, call flush &#40;or not, its the same&#41; and
redirect to another url, in the second run mode a new empty session is
created although
the cookie doesn&#39;t change, so I cant access any of my previous session vars.
This only happens the first time for a given client.
Its easier to understand looking at the code and the logfile &#40;see below&#41;.

System details:
Perl, v5.8.7 built for i486-linux-gnu-thread-multi on Linux u15292264
2.6.23.16-20080211a #1 SMP
$CGI::Session::VERSION  = &#39;4.38&#39;;
$CGI::Application::VERSION = &#39;4.06&#39;;

Code to reproduce:

Application.pm file:

package TEST::Application;
use base &#39;CGI::Application&#39;;
use strict;
use CGI::Application::Plugin::Session;
use Data::Dumper;

open&#40;STDERR, q{&gt;&gt;},&#39;logfiletest&#39;&#41;;

sub cgiapp_init {
    my $self = shift;

    $self-&gt;session_config&#40;
        CGI_SESSION_OPTIONS =&gt; [ &#34;driver:File&#34;, $self-&gt;query,
{Directory=&gt;&#39;/var/tmp&#39;} ],
        SEND_COOKIE =&gt; 1,
        COOKIE_PARAMS =&gt; {
            -expires =&gt; &#34;+1h&#34;
        },
        DEFAULT_EXPIRY =&gt; &#34;1h&#34;
    &#41;;
}

sub cgiapp_prerun {
    my $self = shift;
    my $q = $self-&gt;query;

    warn &#34;Mode: &#34;.Dumper&#40;$q-&gt;path_info&#41;.&#34;\n&#34;;
}

sub setup {
    my $self = shift;

    $self-&gt;start_mode&#40;&#39;index&#39;&#41;;
    $self-&gt;mode_param&#40; path_info =&gt; -1 &#41;;

    $self-&gt;run_modes&#40;[qw/
        index
        ren
    /]&#41;;
}

#######################################################################################
####  Run Modes
#######################################################################################
sub index {
    my $self = shift;
    my $session = $self-&gt;session;

    $session-&gt;param&#40;&#39;md5&#39;,&#39;123456&#39;&#41;;
    $session-&gt;param&#40;&#39;logged_user&#39;, &#39;pepe&#39;&#41;;
    $session-&gt;flush&#40;&#41;;

    warn &#34;index mode session=&#34;.$session-&gt;id;

    my $logged_user = $self-&gt;check_session;

    warn &#34;doing redir...&#34;;
    $self-&gt;redir&#40;&#34;/indextest.pl/ren&#34;&#41;;

    return &#34;index mode session=&#34;.$session-&gt;id;
}

sub ren {
    my $self = shift;
    my $session = $self-&gt;session;

    my $logged_user = $self-&gt;check_session;

    warn &#34;ren logged user=&#34;.$logged_user;

    return &#34;ren mode session=&#34;.$session-&gt;id;
}

#######################################################################################
####  Utility functions
#######################################################################################
sub check_session {
    my $self = shift;
    return unless my $session = $self-&gt;session;
    warn &#34;session id=&#34;.$session-&gt;id;
    warn &#34;dataref=&#34;.Dumper&#40;$session-&gt;dataref&#40;&#41;&#41;;
    warn &#34;cookie =CGISESSID&#34;.$self-&gt;query-&gt;cookie&#40;&#39;CGISESSID&#39;&#41;;

    return unless $session-&gt;param&#40;&#39;md5&#39;&#41;;
    return $session-&gt;param&#40;&#39;logged_user&#39;&#41; if $session-&gt;param&#40;&#39;md5&#39;&#41;;
}

sub redir {
    my $self = shift;
    my $url = shift;
    $self-&gt;header_type&#40;&#39;redirect&#39;&#41;;
    $self-&gt;header_props&#40;-url=&gt;$url&#41;;
    return &#34;Redirecting to $url&#34;;
}

1;


indextest.pl File:

#!/usr/bin/perl -w

use strict;
use CGI::Carp qw&#40;fatalsToBrowser&#41;;
use TEST::Application;

open&#40;STDERR, &#39;&gt;&gt;logfiletest&#39;&#41;;

my $app = new TEST::Application;

$app-&gt;run&#40;&#41;;




Resulting logfiletest:

[Fri Nov  7 14:09:04 2008] indextest.pl: Mode: $VAR1 = &#39;&#39;;
[Fri Nov  7 14:09:04 2008] indextest.pl:
[Fri Nov  7 14:09:05 2008] indextest.pl: index mode
session=8931907b0822e3696087a3797ff79fe9 at TEST/Application.pm line 52.
[Fri Nov  7 14:09:05 2008] indextest.pl: session
id=8931907b0822e3696087a3797ff79fe9 at TEST/Application.pm line 79.
[Fri Nov  7 14:09:05 2008] indextest.pl: dataref=$VAR1 = {
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ETIME&#39; =&gt; 3600,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ID&#39; =&gt;
&#39;8931907b0822e3696087a3797ff79fe9&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ATIME&#39; =&gt;
1226084945,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;logged_user&#39; =&gt; &#39;pepe&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;md5&#39; =&gt; &#39;123456&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_REMOTE_ADDR&#39; =&gt;
&#39;190.18.144.128&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_CTIME&#39; =&gt;
1226084945
[Fri Nov  7 14:09:05 2008] indextest.pl:         };
[Fri Nov  7 14:09:05 2008] indextest.pl: cookie
=CGISESSIDf5f4635a8899929d4649d53074d890c2 at TEST/Application.pm line 81.
[Fri Nov  7 14:09:05 2008] indextest.pl: doing redir... at
TEST/Application.pm line 56.
[Fri Nov  7 14:09:05 2008] indextest.pl: Mode: $VAR1 = &#39;/ren&#39;;
[Fri Nov  7 14:09:05 2008] indextest.pl:
[Fri Nov  7 14:09:05 2008] indextest.pl: session
id=6f5b87b3c56709591d34e2e8920654fa at TEST/Application.pm line 79.
[Fri Nov  7 14:09:05 2008] indextest.pl: dataref=$VAR1 = {
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ETIME&#39; =&gt; 3600,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ID&#39; =&gt;
&#39;6f5b87b3c56709591d34e2e8920654fa&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_ATIME&#39; =&gt;
1226084945,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_REMOTE_ADDR&#39; =&gt;
&#39;190.18.144.128&#39;,
[Fri Nov  7 14:09:05 2008] indextest.pl:           &#39;_SESSION_CTIME&#39; =&gt;
1226084945
[Fri Nov  7 14:09:05 2008] indextest.pl:         };
[Fri Nov  7 14:09:05 2008] indextest.pl: cookie
=CGISESSIDf5f4635a8899929d4649d53074d890c2 at TEST/Application.pm line 81.
[Fri Nov  7 14:09:05 2008] indextest.pl: Use of uninitialized value in
concatenation &#40;.&#41; or string at TEST/Application.pm line 68.
[Fri Nov  7 14:09:05 2008] indextest.pl: ren logged user= at
TEST/Application.pm line 68.


Steps to reproduce:
1- delete all sessions from /var/tmp
2- go to <span class="clickylink"><a target="new" rel="nofollow" href="http://webserver/indextest.pl">http://webserver/indextest.pl</a></span>

In the logfile you can see that the session id changes after the redirect
even if the cookie its the same. Upon inspection of the session dir, 2
different files &#40;sessions&#41; where created.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/530263/265521/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265521">with headers</a>
<br />
<span class="downloadcontenttype">text/html 8.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza">Session gets dropped when using a HTTP redirect within CGI::Application<br>
<br>
This is driving me crazy, am I doing something wrong here?<br>
<br>
If I set a couple of session vars, call flush (or not, its the same) and redirect to another url, in the second run mode a new empty session is created although<br>

the cookie doesn&#39;t change, so I cant access any of my previous session vars. This only happens the first time for a given client.<br>
Its easier to understand looking at the code and the logfile (see below).<br>
<br>
System details:<br>

Perl, v5.8.7 built for i486-linux-gnu-thread-multi on Linux u15292264 2.6.23.16-20080211a #1 SMP<br>
$CGI::Session::VERSION&nbsp; = &#39;4.38&#39;;<br>
$CGI::Application::VERSION = &#39;4.06&#39;;<br>
<br>
Code to reproduce:<br>
<br>

Application.pm file:<br>
<br>
package TEST::Application;<br>
use base &#39;CGI::Application&#39;;<br>
use strict;<br>
use CGI::Application::Plugin::Session;<br>
use Data::Dumper;<br>
<br>
open(STDERR, q{&gt;&gt;},&#39;logfiletest&#39;);<br>

<br>
sub cgiapp_init {<br>
&nbsp;&nbsp;&nbsp; my $self = shift;<br>
<br>
&nbsp;&nbsp;&nbsp; $self-&gt;session_config(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CGI_SESSION_OPTIONS =&gt; [ &quot;driver:File&quot;, $self-&gt;query, {Directory=&gt;&#39;/var/tmp&#39;} ],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SEND_COOKIE =&gt; 1,<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COOKIE_PARAMS =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -expires =&gt; &quot;+1h&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEFAULT_EXPIRY =&gt; &quot;1h&quot;<br>
&nbsp;&nbsp;&nbsp; );&nbsp;&nbsp; <br>
}<br>
<br>
sub cgiapp_prerun {<br>
&nbsp;&nbsp;&nbsp; my $self = shift;<br>
&nbsp;&nbsp;&nbsp; my $q = $self-&gt;query;<br>

&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; warn &quot;Mode: &quot;.Dumper($q-&gt;path_info).&quot;\n&quot;;<br>
}<br>
<br>
sub setup {<br>
&nbsp;&nbsp;&nbsp; my $self = shift;<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; $self-&gt;start_mode(&#39;index&#39;);<br>
&nbsp;&nbsp;&nbsp; $self-&gt;mode_param( path_info =&gt; -1 );<br>

&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; $self-&gt;run_modes([qw/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ren<br>
&nbsp;&nbsp;&nbsp; /]);<br>
}<br>
<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">#######################################################################################<br>
</div>####&nbsp; Run Modes<br>
<div class="message-stanza open">#######################################################################################<br>
</div></div>sub index {<br>
&nbsp;&nbsp;&nbsp; my $self = shift;<br>
&nbsp;&nbsp;&nbsp; my $session = $self-&gt;session;<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; $session-&gt;param(&#39;md5&#39;,&#39;123456&#39;);<br>
&nbsp;&nbsp;&nbsp; $session-&gt;param(&#39;logged_user&#39;, &#39;pepe&#39;);&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; $session-&gt;flush();<br>

&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; warn &quot;index mode session=&quot;.$session-&gt;id;<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; my $logged_user = $self-&gt;check_session;<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; warn &quot;doing redir...&quot;;<br>
&nbsp;&nbsp;&nbsp; $self-&gt;redir(&quot;/indextest.pl/ren&quot;);<br>

&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; return &quot;index mode session=&quot;.$session-&gt;id;<br>
}<br>
<br>
sub ren {<br>
&nbsp;&nbsp;&nbsp; my $self = shift;<br>
&nbsp;&nbsp;&nbsp; my $session = $self-&gt;session;<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; my $logged_user = $self-&gt;check_session;<br>
&nbsp;&nbsp; <br>

&nbsp;&nbsp;&nbsp; warn &quot;ren logged user=&quot;.$logged_user;<br>
<br>
&nbsp;&nbsp;&nbsp; return &quot;ren mode session=&quot;.$session-&gt;id;<br>
}<br>
<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">#######################################################################################<br>
</div>####&nbsp; Utility functions<br>
<div class="message-stanza open">#######################################################################################<br>
</div></div>sub check_session {<br>
&nbsp;&nbsp;&nbsp; my $self = shift;<br>
&nbsp;&nbsp;&nbsp; return unless my $session = $self-&gt;session;<br>
&nbsp;&nbsp;&nbsp; warn &quot;session id=&quot;.$session-&gt;id;<br>

&nbsp;&nbsp;&nbsp; warn &quot;dataref=&quot;.Dumper($session-&gt;dataref());&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; warn &quot;cookie =CGISESSID&quot;.$self-&gt;query-&gt;cookie(&#39;CGISESSID&#39;);<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; return unless $session-&gt;param(&#39;md5&#39;);<br>

&nbsp;&nbsp;&nbsp; return $session-&gt;param(&#39;logged_user&#39;) if $session-&gt;param(&#39;md5&#39;);<br>
}<br>
<br>
sub redir {<br>
&nbsp;&nbsp;&nbsp; my $self = shift;<br>
&nbsp;&nbsp;&nbsp; my $url = shift;<br>
&nbsp;&nbsp;&nbsp; $self-&gt;header_type(&#39;redirect&#39;);<br>
&nbsp;&nbsp;&nbsp; $self-&gt;header_props(-url=&gt;$url);<br>

&nbsp;&nbsp;&nbsp; return &quot;Redirecting to $url&quot;;<br>
}<br>
<br>
1;<br>
<br>
<br>
indextest.pl File:<br>
<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">#!/usr/bin/perl -w<br>
</div><br>
use strict;<br>
use CGI::Carp qw(fatalsToBrowser);<br>
use TEST::Application;<br>
<br>
open(STDERR, &#39;&gt;&gt;logfiletest&#39;);<br>

<br>
my $app = new TEST::Application;<br>
<br>
$app-&gt;run();<br>
<br>
<br>
<br>
<br>
Resulting logfiletest:<br>
<br>
[Fri Nov&nbsp; 7 14:09:04 2008] indextest.pl: Mode: $VAR1 = &#39;&#39;;<br>
[Fri Nov&nbsp; 7 14:09:04 2008] indextest.pl:<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: index mode session=8931907b0822e3696087a3797ff79fe9 at TEST/Application.pm line 52.<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: session id=8931907b0822e3696087a3797ff79fe9 at TEST/Application.pm line 79.<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: dataref=$VAR1 = {<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_ETIME&#39; =&gt; 3600,<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_ID&#39; =&gt; &#39;8931907b0822e3696087a3797ff79fe9&#39;,<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_ATIME&#39; =&gt; 1226084945,<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;logged_user&#39; =&gt; &#39;pepe&#39;,<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;md5&#39; =&gt; &#39;123456&#39;,<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_REMOTE_ADDR&#39; =&gt; &#39;<a href="http://190.18.144.128">190.18.144.128</a>&#39;,<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_CTIME&#39; =&gt; 1226084945<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: cookie =CGISESSIDf5f4635a8899929d4649d53074d890c2 at TEST/Application.pm line 81.<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: doing redir... at TEST/Application.pm line 56.<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: Mode: $VAR1 = &#39;/ren&#39;;<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: session id=6f5b87b3c56709591d34e2e8920654fa at TEST/Application.pm line 79.<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: dataref=$VAR1 = {<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_ETIME&#39; =&gt; 3600,<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_ID&#39; =&gt; &#39;6f5b87b3c56709591d34e2e8920654fa&#39;,<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_ATIME&#39; =&gt; 1226084945,<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_REMOTE_ADDR&#39; =&gt; &#39;<a href="http://190.18.144.128">190.18.144.128</a>&#39;,<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;_SESSION_CTIME&#39; =&gt; 1226084945<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: cookie =CGISESSIDf5f4635a8899929d4649d53074d890c2 at TEST/Application.pm line 81.<br>

[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: Use of uninitialized value in concatenation (.) or string at TEST/Application.pm line 68.<br>
[Fri Nov&nbsp; 7 14:09:05 2008] indextest.pl: ren logged user= at TEST/Application.pm line 68.<br>

<br>
<br>
Steps to reproduce:<br>
1- delete all sessions from /var/tmp<br>
2- go to <a href="http://webserver/indextest.pl"><span class="clickylink"><a target="new" rel="nofollow" href="http://webserver/indextest.pl">http://webserver/indextest.pl</a></span></a><br>
<br>
In the logfile you can see that the session id changes after the redirect even if the cookie its the same. Upon inspection of the session dir, 2 different files (sessions) where created.<br>

<br>
<br>
<br>
<br>


</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530264" href="/Public/Bug/Display.html?id=40751#txn-530264">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;14:43:54&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530266" href="/Public/Bug/Display.html?id=40751#txn-530266">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;14:57:04&nbsp;2008</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40751] Session gets dropped when using a HTTP redirect within CGI::Application</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Nov 2008 14:56:50 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/530266/265523/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265523">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 476b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is driving me crazy, am I doing something wrong here?
</div>
Axo,

If you are not sure what&#39;s wrong, you should ask for help on a mailing list,
the ones for CGI::Application or CGI::Session.  It is not the responsibility
of the maintainers to respond to all support requests. 

That said, using a tool like the Web Developer toolbar for Firefox to confirm
which cookies are being sent back and forth at which points. 

Mixing cookies and redirects can be tricky.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530271" href="/Public/Bug/Display.html?id=40751#txn-530271">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;15:10:04&nbsp;2008</span>
    <span class="description">axo [...] axo.com.ar -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40751] Session gets dropped when using a HTTP redirect within CGI::Application</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Nov 2008 18:09:46 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Axo &lt;axo [...] axo.com.ar&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/530271/265527/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265527">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 971b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the quick response, if you check the logfiletest that I copied
before, there is only one cookie involved and its value doesn&#39;t change.
I know it´s not the responsibility of the maintainers to do anything, if I
were sure what&#39;s wrong, I wouldn&#39;t be submitting a bug report without a
patch ;&#41;

On Fri, Nov 7, 2008 at 5:57 PM, mark@summersault.com via RT &lt;
bug-CGI-Session@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40751">http://rt.cpan.org/Ticket/Display.html?id=40751</a></span> &gt;
&gt;
&gt;
<div class="message-stanza open">&gt; &gt; This is driving me crazy, am I doing something wrong here?
</div>&gt;
&gt; Axo,
&gt;
&gt; If you are not sure what&#39;s wrong, you should ask for help on a mailing
&gt; list,
&gt; the ones for CGI::Application or CGI::Session.  It is not the
&gt; responsibility
&gt; of the maintainers to respond to all support requests.
&gt;
&gt; That said, using a tool like the Web Developer toolbar for Firefox to
&gt; confirm
&gt; which cookies are being sent back and forth at which points.
&gt;
&gt; Mixing cookies and redirects can be tricky.
&gt;
&gt;    Mark
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/530271/265528/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265528">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573181" href="/Public/Bug/Display.html?id=40751#txn-573181">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;22:38:42&nbsp;2009</span>
    <span class="description">COSMICNET [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/573181/289285/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289285">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 322b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve hit the same problem. Although the more I poke about this is
looking like an issue with CGI.pm more than anything else. Maybe try
CGI::Simple?

Also send the session ID along the query string:-
$self-&gt;redir&#40;&#34;/indextest.pl/ren?CGISESSID=&#34; . $session-&gt;id&#40;&#41; &#41;;

That should ensure the right session is picked up.


Lyle
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573359" href="/Public/Bug/Display.html?id=40751#txn-573359">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;10:06:35&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/573359/289400/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289400">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 04 22:38:42 2009, COSMICNET wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve hit the same problem. Although the more I poke about this is
&gt; looking like an issue with CGI.pm more than anything else. Maybe try
&gt; CGI::Simple?
&gt; 
&gt; Also send the session ID along the query string:-
&gt; $self-&gt;redir&#40;&#34;/indextest.pl/ren?CGISESSID=&#34; . $session-&gt;id&#40;&#41; &#41;;
&gt; 
&gt; That should ensure the right session is picked up.
</div>
I&#39;ve run into cookie/redirect issues before, too. My best understanding
is that the core issues don&#39;t have to do with which tools you use, but a
core understanding of how cookies and http redirects interact,
particularly this cycle:

- set a cookie
- redirect
- check the cookie

&#40;especially when setting the cookie and redirecting are combined&#41;. I
recommend watching what&#39;s happening with one of the Firefox header
inspection extensions, like &#34;LiveHTTPHeaders&#34; or something in the Web
Developer toolbar. &#41;

I think that will help you pinpoint where something is going wrong, and
then you can consider how to use or modify your tools to better handle
the situation.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574628" href="/Public/Bug/Display.html?id=40751#txn-574628">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;08&nbsp;01:01:43&nbsp;2009</span>
    <span class="description">RSAVAGE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/574628/290193/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/290193">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 959b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Axo

Sorry it&#39;s taken so long to get back to you.

Another user of CGI::Session &#40;Lyle&#41; has just reported the same issue, on
the CGI::Application mailing list, on 2009-03-05.

The heading of his msg is &#39;[cgiapp] Intermittent problem with sessions
when redirecting&#39;.

I&#39;m afraid this is not something CGI::Session has any control over.

Here&#39;s what I replied to him:

Official Guide to Programming with CGI.pm
Lincoln Stein
Wiley
1998

P 225 says:
&#34;All names arguments recognized by header&#40;&#41; are also recognized by
redirect&#40;&#41;. However, most HTTP headers, including those generated by
-cookie and -target, are ignored by the browser.&#34;

Seems to me you&#39;ve been bitten by this one.

And while I think of it. I emailed Lincoln years ago about misprints in
this book, and he made it clear to me he would never deal with Wiley
again. He despises them for the low standard of their proof-reading.

Nothing personal Axo, but we&#39;ll classify this one as &#39;Not a bug&#39;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574631" href="/Public/Bug/Display.html?id=40751#txn-574631">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;08&nbsp;01:04:06&nbsp;2009</span>
    <span class="description">RSAVAGE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/574631/290196/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/290196">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 154b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Folks

Lincoln&#39;s comments in my previous post indicate we can&#39;t patch
CGI::Session to deal with this issue, so I&#39;m reclassifying this one as
Rejected.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574634" href="/Public/Bug/Display.html?id=40751#txn-574634">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;08&nbsp;01:04:07&nbsp;2009</span>
    <span class="description">RSAVAGE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-575189" href="/Public/Bug/Display.html?id=40751#txn-575189">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;11:07:07&nbsp;2009</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40751] Session gets dropped when using a HTTP redirect within CGI::Application</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Mar 2009 11:06:32 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/575189/290484/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/290484">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Official Guide to Programming with CGI.pm
&gt; Lincoln Stein
&gt; Wiley
&gt; 1998
&gt; 
&gt; P 225 says:
&gt; &#34;All names arguments recognized by header&#40;&#41; are also recognized by
&gt; redirect&#40;&#41;. However, most HTTP headers, including those generated by
&gt; -cookie and -target, are ignored by the browser.&#34;
&gt; 
&gt; Seems to me you&#39;ve been bitten by this one.
&gt; 
&gt; And while I think of it. I emailed Lincoln years ago about misprints in
&gt; this book, and he made it clear to me he would never deal with Wiley
&gt; again. He despises them for the low standard of their proof-reading.
&gt; 
&gt; Nothing personal Axo, but we&#39;ll classify this one as &#39;Not a bug&#39;.
</div>
Considering the number of people bitten by this over the years &#40;including myself&#41;,
I consider it a &#34;doc bug&#34; in CGI.pm:

<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~lds/CGI.pm-3.42/CGI.pm#GENERATING_A_REDIRECTION_HEADER">http://search.cpan.org/~lds/CGI.pm-3.42/CGI.pm#GENERATING_A_REDIRECTION_HEADER</a></span>

Lincoln has recently been receptive to doc patches I&#39;ve sent him recently,
especially when they directly to his e-mail address.

Any volunteers to prepare a doc patch for this and e-mail it Lincoln?  It
should just be a few minutes more of work, given that the location to patch and
the text to use are provided.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-575190" href="/Public/Bug/Display.html?id=40751#txn-575190">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;11:07:07&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-589407" href="/Public/Bug/Display.html?id=40751#txn-589407">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;20:54:02&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/589407/298372/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/298372">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 142b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m rejecting this bug here, but I just opened a related doc-bug ticket
for CGI.pm:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44911">https://rt.cpan.org/Ticket/Display.html?id=44911</a></span>

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-589410" href="/Public/Bug/Display.html?id=40751#txn-589410">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;20:54:04&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.6244</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
