<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #67538 for Test-Simple: [PATCH] Make use_ok work with lexical pragmata</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #67538 for Test-Simple: [PATCH] Make use_ok work with lexical pragmata</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Simple">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Simple">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Simple">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Simple">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/Test-More/test-more/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Simple">Test-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">67538</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Simple">Test-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sprout [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31590-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31591-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




better-70151-workaround.text<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1003023/522599/better-70151-workaround.text">
Wed Nov 23 01:18:29 2011 (1.2k) by $_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1003018/522595/better-70151-workaround.text">
Wed Nov 23 01:14:42 2011 (1.2k) by sprout [...] cpan.org
</a>
</font></li>
</ul>


use_ok patch no. 2.text<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/991194/516097/use_ok%20patch%20no.%202.text">
Sun Oct 23 19:43:09 2011 (3.2k) by sprout [...] cpan.org
</a>
</font></li>
</ul>


use_ok patch.text<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/924428/479658/use_ok%20patch.text">
Sun Apr 17 15:56:40 2011 (4.7k) by sprout [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=67538">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-924428" href="/Public/Bug/Display.html?id=67538#txn-924428">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;17&nbsp;15:56:40&nbsp;2011</span>
    <span class="description">sprout [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Make use_ok work with lexical pragmata</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 17 Apr 2011 12:56:17 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Father Chrysostomos &lt;sprout [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/924428/479657/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/479657">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 222b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Since you already know about it, I neednâ€™t say much. But for posterityâ€™s sake, I ought to mention that <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Ticket/Display.html?id=87064">http://rt.perl.org/rt3/Ticket/Display.html?id=87064</a></span> brought this up.

The attachment is a git-am-compatible patch.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/924428/479658/use_ok%20patch.text">Download use_ok patch.text</a><br />
<span class="downloadcontenttype">text/plain 4.7k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991165" href="/Public/Bug/Display.html?id=67538#txn-991165">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;19:08:13&nbsp;2011</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/991165/516082/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516082">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 405b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oh boy.  Given the scope of change, I&#39;m of half a mind to say the hell
with it.  use_ok&#40;&#41; is marginally useful at best.

How much saner would it be if it didn&#39;t try to support C&lt;&lt;
use_ok&#40;&#34;constant 1.03&#34;&#41; &gt;&gt;?  That&#39;s a clear violation of the
documentation and I have no sympathy.  I presume that big block of
module and version parsing would go away?  That&#39;s the bit and most
likely to break in the future.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991168" href="/Public/Bug/Display.html?id=67538#txn-991168">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;19:08:14&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991194" href="/Public/Bug/Display.html?id=67538#txn-991194">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;19:43:09&nbsp;2011</span>
    <span class="description">sprout [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67538] [PATCH] Make use_ok work with lexical pragmata </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Oct 2011 16:42:43 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Father Chrysostomos &lt;sprout [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/991194/516096/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516096">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 672b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Oct 23, 2011, at 4:08 PM, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=67538">https://rt.cpan.org/Ticket/Display.html?id=67538</a></span> &gt;
&gt; 
&gt; Oh boy.  Given the scope of change, I&#39;m of half a mind to say the hell
&gt; with it.  use_ok&#40;&#41; is marginally useful at best.
&gt; 
&gt; How much saner would it be if it didn&#39;t try to support C&lt;&lt;
&gt; use_ok&#40;&#34;constant 1.03&#34;&#41; &gt;&gt;?  That&#39;s a clear violation of the
&gt; documentation and I have no sympathy.  I presume that big block of
&gt; module and version parsing would go away?  
</div>
Yes, it could.  &#40;Also, it didnâ€™t support the esoteric â€˜use 5.57 Exporterâ€™ syntax.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That&#39;s the bit and most
&gt; likely to break in the future.
</div>
Attached is a revised patch.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/991194/516097/use_ok%20patch%20no.%202.text">Download use_ok patch no. 2.text</a><br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991218" href="/Public/Bug/Display.html?id=67538#txn-991218">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;20:49:34&nbsp;2011</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/991218/516109/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516109">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 576b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That&#39;s much better, thank you.  It&#39;s in.
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/schwern/test-more/commit/5ed8f11cb1ac4468c26c657d4399f0cff2375078">https://github.com/schwern/test-more/commit/5ed8f11cb1ac4468c26c657d4399f0cff2375078</a></span>

I cleaned it up some.  I don&#39;t expect you to do all of that, I&#39;d rather
have the patch and clean it up than no patch.
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/schwern/test-more/commit/40f26cf9076aec7c64609ca73faa2b6be719536c">https://github.com/schwern/test-more/commit/40f26cf9076aec7c64609ca73faa2b6be719536c</a></span>

One thing which puzzles me is why does setting $^H and %^H inside
use_ok&#40;&#41; effect the caller and not it&#39;s own scope?  Is that just how
they work?  Or is it that whatever $^H and %^H are set to at the end of
the BEGIN block applies to the caller?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991221" href="/Public/Bug/Display.html?id=67538#txn-991221">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;20:49:34&nbsp;2011</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991223" href="/Public/Bug/Display.html?id=67538#txn-991223">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;21:24:31&nbsp;2011</span>
    <span class="description">sprout [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67538] [PATCH] Make use_ok work with lexical pragmata </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Oct 2011 18:24:17 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Father Chrysostomos &lt;sprout [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/991223/516113/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516113">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 918b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Oct 23, 2011, at 5:49 PM, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=67538">https://rt.cpan.org/Ticket/Display.html?id=67538</a></span> &gt;
&gt; 
&gt; That&#39;s much better, thank you.  It&#39;s in.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/schwern/test-more/commit/5ed8f11cb1ac4468c26c657d4399f0cff2375078">https://github.com/schwern/test-more/commit/5ed8f11cb1ac4468c26c657d4399f0cff2375078</a></span>
&gt; 
&gt; I cleaned it up some.  I don&#39;t expect you to do all of that, I&#39;d rather
&gt; have the patch and clean it up than no patch.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/schwern/test-more/commit/40f26cf9076aec7c64609ca73faa2b6be719536c">https://github.com/schwern/test-more/commit/40f26cf9076aec7c64609ca73faa2b6be719536c</a></span>
&gt; 
&gt; One thing which puzzles me is why does setting $^H and %^H inside
&gt; use_ok&#40;&#41; effect the caller and not it&#39;s own scope?  Is that just how
&gt; they work?  Or is it that whatever $^H and %^H are set to at the end of
&gt; the BEGIN block applies to the caller?
</div>
Itâ€™s the latter.  $^H and %^H affect the code that is currently being compiled.

It also means that Moose, etc., can do:

sub import {
    ...
    strict-&gt;import; warnings-&gt;import
    ...
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991225" href="/Public/Bug/Display.html?id=67538#txn-991225">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;23&nbsp;21:24:32&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991242" href="/Public/Bug/Display.html?id=67538#txn-991242">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;24&nbsp;00:08:48&nbsp;2011</span>
    <span class="description">sprout [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67538] [PATCH] Make use_ok work with lexical pragmata </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Oct 2011 21:08:32 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Father Chrysostomos &lt;sprout [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/991242/516121/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516121">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Oct 23, 2011, at 5:49 PM, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=67538">https://rt.cpan.org/Ticket/Display.html?id=67538</a></span> &gt;
&gt; 
&gt; That&#39;s much better, thank you.  It&#39;s in.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/schwern/test-more/commit/5ed8f11cb1ac4468c26c657d4399f0cff2375078">https://github.com/schwern/test-more/commit/5ed8f11cb1ac4468c26c657d4399f0cff2375078</a></span>
&gt; 
&gt; I cleaned it up some.  I don&#39;t expect you to do all of that, I&#39;d rather
&gt; have the patch and clean it up than no patch.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/schwern/test-more/commit/40f26cf9076aec7c64609ca73faa2b6be719536c">https://github.com/schwern/test-more/commit/40f26cf9076aec7c64609ca73faa2b6be719536c</a></span>
</div>
Iâ€™ve just noticed a couple of things:

This really has nothing to do with 5.13.7. 5.13.7 disabled some weird source filter behaviour &#40;in that the filter enabled within a string eval would apply to whatever outer dynamic scope was being compiled&#41;. Either making use_ok work with pragmata *or* reenabling the source filter would fix the 20 or so modules affected. The latter is what happened, so 5.14.0 is no different from 5.12.0 in that regard.  So mentioning 5.13.7 at all in the changelog is misleading. use_ok has, as far as I know, never worked with pragmata.

+Lexical effects will occur as usual.  For example, this will turn on strictures.
+
+  use_ok &#34;strict&#34;;

This would be better written as BEGIN { use_ok &#34;strict&#34;; }, because a simple use_ok &#34;strict&#34; wonâ€™t enable it for the current scope.

You donâ€™t like my coding style, but have you seen the perl source. :-&#41;  Also, I actually find more compact code easier to read, because I donâ€™t have to look so far to understand it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; One thing which puzzles me is why does setting $^H and %^H inside
&gt; use_ok&#40;&#41; effect the caller and not it&#39;s own scope?  Is that just how
&gt; they work?  Or is it that whatever $^H and %^H are set to at the end of
&gt; the BEGIN block applies to the caller?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991498" href="/Public/Bug/Display.html?id=67538#txn-991498">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;24&nbsp;17:58:05&nbsp;2011</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67538] [PATCH] Make use_ok work with lexical pragmata</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Oct 2011 14:57:46 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/991498/516262/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516262">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2011.10.23 9:08 PM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This really has nothing to do with 5.13.7. 5.13.7 disabled some weird source
&gt; filter behaviour &#40;in that the filter enabled within a string eval would apply
&gt; to whatever outer dynamic scope was being compiled&#41;. Either making use_ok work
&gt; with pragmata *or* reenabling the source filter would fix the 20 or so modules
&gt; affected. The latter is what happened, so 5.14.0 is no different from 5.12.0
&gt; in that regard.  So mentioning 5.13.7 at all in the changelog is misleading.
</div>
Filters seem to work with an unpatched Test::More and 5.14.1.

    use warnings;
    use Test::More;

    BEGIN { use_ok &#34;Semi::Semicolons&#34;; }

    pass&#40;&#41;Peterbilt

    done_testing;

Did that filter behavior change make it out of 5.13?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use_ok has, as far as I know, never worked with pragmata.
</div>
D&#39;oh!  You&#39;re right!  I wonder if it&#39;s worth starting now.  Well, work&#39;s done.
 I&#39;ll fix the change log.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; +Lexical effects will occur as usual.  For example, this will turn on strictures.
&gt; +
&gt; +  use_ok &#34;strict&#34;;
&gt; 
&gt; This would be better written as BEGIN { use_ok &#34;strict&#34;; }, because a simple
&gt; use_ok &#34;strict&#34; wonâ€™t enable it for the current scope.
</div>
Got it.  Done.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You donâ€™t like my coding style, but have you seen the perl source. :-&#41;
</div>
Bonitas non est pessimis esse meliorem.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I actually find more compact code easier to read, because I donâ€™t have to
</div>look so
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; far to understand it.
</div>
Greatthenletsgetridoftheinterstitialspaceandparagraphs!

I presume you mean scrolling rather than physically turning your head and
eyeballs?

Less tongue in cheek... a large project cannot be fully understood at one
time.  It is more important to find the piece you care about, and its scope of
effect, than to study code in detail.  This is why code should be optimized
for skimming with the scope and structure laid bare.  This is also why any
given scope should remain short.  A narrow scope forgives many sins.  The
blocks I&#39;ve been using lately in my tests are a great example.

I have a talk on this, unfortunately there&#39;s no video, but here&#39;s the slides
with notes:
<span class="clickylink"><a target="new" rel="nofollow" href="http://schwern.net/talks/Skimmable%20Code%20-%20OSCON%202008%20w:notes.pdf">http://schwern.net/talks/Skimmable%20Code%20-%20OSCON%202008%20w:notes.pdf</a></span>

That said, vertical whitespace is valuable.  But rather than conserve it I
expand my store.  I&#39;ve got my editor spanning the full height of the screen
and using the smallest most compact font my poor eyes can easily deal with.
Helps to have a high resolution, widescreen laptop. :-&#41;

BTW  Inconsolata is a fantastic fixed width font.  Gave me a lot more space
and clarity.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.levien.com/type/myfonts/inconsolata.html">http://www.levien.com/type/myfonts/inconsolata.html</a></span>


-- 
s7ank: i want to be one of those guys that types &#34;s/j&#38;jd//.^$ueu*///djsls/sm.&#34;
       and it&#39;s a perl script that turns dog crap into gold.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991531" href="/Public/Bug/Display.html?id=67538#txn-991531">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;24&nbsp;18:41:28&nbsp;2011</span>
    <span class="description">sprout [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67538] [PATCH] Make use_ok work with lexical pragmata</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Oct 2011 15:41:12 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Father Chrysostomos &lt;sprout [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/991531/516286/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516286">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Oct 24, 2011, at 2:58 PM, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=67538">https://rt.cpan.org/Ticket/Display.html?id=67538</a></span> &gt;
&gt; 
&gt; On 2011.10.23 9:08 PM, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt;&gt; This really has nothing to do with 5.13.7. 5.13.7 disabled some weird source
&gt;&gt; filter behaviour &#40;in that the filter enabled within a string eval would apply
&gt;&gt; to whatever outer dynamic scope was being compiled&#41;. Either making use_ok work
&gt;&gt; with pragmata *or* reenabling the source filter would fix the 20 or so modules
&gt;&gt; affected. The latter is what happened, so 5.14.0 is no different from 5.12.0
&gt;&gt; in that regard.  So mentioning 5.13.7 at all in the changelog is misleading.
</div>&gt; 
&gt; Filters seem to work with an unpatched Test::More and 5.14.1.
&gt; 
&gt;    use warnings;
&gt;    use Test::More;
&gt; 
&gt;    BEGIN { use_ok &#34;Semi::Semicolons&#34;; }
&gt; 
&gt;    pass&#40;&#41;Peterbilt
&gt; 
&gt;    done_testing;
&gt; 
&gt; Did that filter behavior change make it out of 5.13?
</div>
No. It was reverted at the last minute, due to CPAN breakage.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
<div class="message-stanza open">&gt;&gt; use_ok has, as far as I know, never worked with pragmata.
</div>&gt; 
&gt; D&#39;oh!  You&#39;re right!  I wonder if it&#39;s worth starting now.  Well, work&#39;s done.
&gt; I&#39;ll fix the change log.
&gt; 
&gt; 
<div class="message-stanza open">&gt;&gt; +Lexical effects will occur as usual.  For example, this will turn on strictures.
&gt;&gt; +
&gt;&gt; +  use_ok &#34;strict&#34;;
&gt;&gt; 
&gt;&gt; This would be better written as BEGIN { use_ok &#34;strict&#34;; }, because a simple
&gt;&gt; use_ok &#34;strict&#34; wonâ€™t enable it for the current scope.
</div>&gt; 
&gt; Got it.  Done.
&gt; 
&gt; 
<div class="message-stanza open">&gt;&gt; You donâ€™t like my coding style, but have you seen the perl source. :-&#41;
</div>&gt; 
&gt; Bonitas non est pessimis esse meliorem.
&gt; 
&gt; 
<div class="message-stanza open">&gt;&gt; I actually find more compact code easier to read, because I donâ€™t have to
</div>&gt; look so
<div class="message-stanza open">&gt;&gt; far to understand it.
</div>&gt; 
&gt; Greatthenletsgetridoftheinterstitialspaceandparagraphs!
&gt; 
&gt; I presume you mean scrolling rather than physically turning your head and
&gt; eyeballs?
&gt; 
&gt; Less tongue in cheek... a large project cannot be fully understood at one
&gt; time.  It is more important to find the piece you care about, and its scope of
&gt; effect, than to study code in detail.  This is why code should be optimized
&gt; for skimming with the scope and structure laid bare.  This is also why any
&gt; given scope should remain short.  A narrow scope forgives many sins.  The
&gt; blocks I&#39;ve been using lately in my tests are a great example.
&gt; 
&gt; I have a talk on this, unfortunately there&#39;s no video, but here&#39;s the slides
&gt; with notes:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://schwern.net/talks/Skimmable%20Code%20-%20OSCON%202008%20w:notes.pdf">http://schwern.net/talks/Skimmable%20Code%20-%20OSCON%202008%20w:notes.pdf</a></span>
&gt; 
&gt; That said, vertical whitespace is valuable.  But rather than conserve it I
&gt; expand my store.  I&#39;ve got my editor spanning the full height of the screen
</div>
I canâ€™t stand that. I like to have at least ten windows open at once.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and using the smallest most compact font my poor eyes can easily deal with.
&gt; Helps to have a high resolution, widescreen laptop. :-&#41;
&gt; 
&gt; BTW  Inconsolata is a fantastic fixed width font.  Gave me a lot more space
&gt; and clarity.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.levien.com/type/myfonts/inconsolata.html">http://www.levien.com/type/myfonts/inconsolata.html</a></span>
&gt; 
&gt; 
&gt; -- 
&gt; s7ank: i want to be one of those guys that types &#34;s/j&#38;jd//.^$ueu*///djsls/sm.&#34;
&gt;       and it&#39;s a perl script that turns dog crap into gold.
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/991531/516287/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516287">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991613" href="/Public/Bug/Display.html?id=67538#txn-991613">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;24&nbsp;21:11:37&nbsp;2011</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67538] [PATCH] Make use_ok work with lexical pragmata</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Oct 2011 18:11:27 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/991613/516341/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516341">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 857b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2011.10.24 3:41 PM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I canâ€™t stand that. I like to have at least ten windows open at once.
</div>
Ahh.  Programmers seem to split across those lines: those who can juggle 12
things at a time and those who can&#39;t.  I can&#39;t.

Thing is, code written with the assumption you can juggle is nigh
unmaintainable by those who can&#39;t.  The reverse does not have so bad an effect.

That said, the jugglers can fix things I can&#39;t. :-&#41;  Thank you for the work,
Father.  &#40;Is that what you prefer?&#41;  If there&#39;s any other of your patches I&#39;ve
dropped on the floor please let me know.  I&#39;m going to close this up.


-- 
...they shared one last kiss that left a bitter yet sweet taste in her
mouth--kind of like throwing up after eating a junior mint.
    -- Dishonorable Mention, 2005 Bulwer-Lytton Fiction Contest
           by Tami Farmer
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991616" href="/Public/Bug/Display.html?id=67538#txn-991616">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;24&nbsp;21:12:04&nbsp;2011</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1002509" href="/Public/Bug/Display.html?id=67538#txn-1002509">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;04:46:55&nbsp;2011</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1002509/522300/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/522300">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 403b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Unfortunately there&#39;s a problem with the new use_ok&#40;&#41;.  It seems pragmas
are leaking out.

    no strict;              # This is deliberate
    use Test::More;

    BEGIN { use_ok &#34;Symbol&#34;; }

    $str = &#34;hello&#34;;         # deliberately don&#39;t declare the variable
    is $str, &#34;hello&#34;;

    done_testing;

That&#39;ll die with &#34;Global symbol &#34;$str&#34; requires explicit package name&#34;.

Any thoughts on this, FC?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1002512" href="/Public/Bug/Display.html?id=67538#txn-1002512">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;04:46:55&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1002968" href="/Public/Bug/Display.html?id=67538#txn-1002968">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;22:30:04&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1002968/522562/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/522562">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 267b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A test case I&#39;ve just written as I isolated this bug:


    use utf8;
    use Test::More &#39;no_plan&#39;;
    BEGIN { use_ok &#39;Carp&#39; }

    sub parser {
        use utf8;
        return &#39;fÃ¼nky&#39;;
    }

    is parser&#40;&#41;, &#39;fÃ¼nky&#39;;

Breaks `use utf8` I guess.

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1003018" href="/Public/Bug/Display.html?id=67538#txn-1003018">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;23&nbsp;01:14:42&nbsp;2011</span>
    <span class="description">sprout [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67538] [PATCH] Make use_ok work with lexical pragmata </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Nov 2011 22:14:31 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Father Chrysostomos &lt;sprout [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1003018/522594/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/522594">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 916b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Nov 22, 2011, at 1:46 AM, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=67538">https://rt.cpan.org/Ticket/Display.html?id=67538</a></span> &gt;
&gt; 
&gt; Unfortunately there&#39;s a problem with the new use_ok&#40;&#41;.  It seems pragmas
&gt; are leaking out.
&gt; 
&gt;    no strict;              # This is deliberate
&gt;    use Test::More;
&gt; 
&gt;    BEGIN { use_ok &#34;Symbol&#34;; }
&gt; 
&gt;    $str = &#34;hello&#34;;         # deliberately don&#39;t declare the variable
&gt;    is $str, &#34;hello&#34;;
&gt; 
&gt;    done_testing;
&gt; 
&gt; That&#39;ll die with &#34;Global symbol &#34;$str&#34; requires explicit package name&#34;.
&gt; 
&gt; Any thoughts on this, FC?
</div>
My workaround for perl bug #70151 was not good enough. It ended up resetting the callerâ€™s hints to what Test::More itself was using. Hereâ€™s a small patch to fix it &#40;with an s/// -&gt; y/// change as a bonus, as y is more than twice the speed&#41;. I havenâ€™t got to writing tests, but can I leave that to you? You could incorporate David Wheelerâ€™s test case.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1003018/522595/better-70151-workaround.text">Download better-70151-workaround.text</a><br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1003023" href="/Public/Bug/Display.html?id=67538#txn-1003023">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;23&nbsp;01:18:29&nbsp;2011</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1003023/522598/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/522598">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 23 01:14:42 2011, sprout@cpan.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On Nov 22, 2011, at 1:46 AM, Michael G Schwern via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=67538">https://rt.cpan.org/Ticket/Display.html?id=67538</a></span> &gt;
&gt; &gt;
&gt; &gt; Unfortunately there&#39;s a problem with the new use_ok&#40;&#41;.  It seems
</div>&gt;    pragmas
<div class="message-stanza open">&gt; &gt; are leaking out.
&gt; &gt;
&gt; &gt;    no strict;              # This is deliberate
&gt; &gt;    use Test::More;
&gt; &gt;
&gt; &gt;    BEGIN { use_ok &#34;Symbol&#34;; }
&gt; &gt;
&gt; &gt;    $str = &#34;hello&#34;;         # deliberately don&#39;t declare the variable
&gt; &gt;    is $str, &#34;hello&#34;;
&gt; &gt;
&gt; &gt;    done_testing;
&gt; &gt;
&gt; &gt; That&#39;ll die with &#34;Global symbol &#34;$str&#34; requires explicit package
</div>&gt;    name&#34;.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Any thoughts on this, FC?
</div>&gt; 
&gt; My workaround for perl bug #70151 was not good enough. It ended up
&gt;    resetting the callerâ€™s hints to what Test::More itself was using.
&gt;    Hereâ€™s a small patch to fix it &#40;with an s/// -&gt; y/// change as a
&gt;    bonus, as y is more than twice the speed&#41;. I havenâ€™t got to writing
&gt;    tests, but can I leave that to you? You could incorporate David
&gt;    Wheelerâ€™s test case.
</div>
Oops. I made a mistake. Try this attachment.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> better-70151-workaround.text</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1003023/522599/better-70151-workaround.text">Download better-70151-workaround.text</a><br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rup schwern-test-more-f5f962a-orig/lib/Test/More.pm schwern-test-more-f5f962a/lib/Test/More.pm
--- schwern-test-more-f5f962a-orig/lib/Test/More.pm	2011-11-22 00:47:36.000000000 -0800
+++ schwern-test-more-f5f962a/lib/Test/More.pm	2011-11-22 08:28:04.000000000 -0800
@@ -851,7 +851,7 @@ sub use_ok &#40;$;@&#41; {
     my&#40; $pack, $filename, $line &#41; = caller;
 
     my $f = $filename;
-    $f =~ s/[\n\r]/_/g; # so it doesn&#39;t run off the &#34;#line $line $f&#34; line
+    $f =~ y/\n\r/_/; # so it doesn&#39;t run off the &#34;#line $line $f&#34; line
 
     my $version;
     if&#40; @imports == 1 and $imports[0] =~ /^\d+&#40;?:\.\d+&#41;?$/ &#41; {
@@ -862,16 +862,20 @@ sub use_ok &#40;$;@&#41; {
     my $version_check = defined $version ? qq{$module-&gt;VERSION&#40;$version&#41;} : &#34;&#34;;
     my $code = &lt;&lt;&#34;USE&#34;;
 package $pack;
+# Work around [perl #70151]
+\$^H = \${\$args[1]};
+%^H = %{\$args[2]};
 #line $line $f
 require $module; $version_check; $module-&gt;import&#40;\@{\$args[0]}&#41;;
-# Work around [perl #70151]
 \${\$args[1]} = \$^H;
 %{\$args[2]} = %^H;
 1;
 USE
 
+    my $hints = $^H;
+    my %hints = %^H;
     my&#40; $eval_result, $eval_error &#41;
-         = _eval&#40; $code, \@imports, \my&#40;$hints, %hints&#41; &#41;;
+         = _eval&#40; $code, \&#40;@imports, $hints, %hints&#41; &#41;;
     my $ok = $tb-&gt;ok&#40; $eval_result, &#34;use $module;&#34; &#41;;
 
     if&#40; $ok &#41; {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1003897" href="/Public/Bug/Display.html?id=67538#txn-1003897">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;24&nbsp;15:54:28&nbsp;2011</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1003897/523092/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/523092">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 61b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, I&#39;ve patched that in and 0.98_02 went out last night.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1003900" href="/Public/Bug/Display.html?id=67538#txn-1003900">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;24&nbsp;15:54:29&nbsp;2011</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.980309</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
