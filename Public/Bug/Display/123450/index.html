<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #123450 for DB_File: [PATCH] Stop evalling version</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #123450 for DB_File: [PATCH] Stop evalling version</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DB_File/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DB_File/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DB_File/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DB_File/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DB_File">DB_File CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">123450</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DB_File/Active/">DB_File</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
&#39;spro^^*%*^6ut# [...] &#38;$%*c

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10842-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10843-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;30&nbsp;12:59:42&nbsp;2017</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Stop evalling version</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you use ‘eval’ to strip underscores from a version number, then the Makefile ends up with 1.840 for the VERSION and 1.84 for the XS_VERSION.

While perl’s usual version checks will consider those equivalent, make_ext.pl &#40;used to build extensions in the perl core&#41; keeps things as simple as possible and uses eq.

The result is that repeated runs of ‘make’ in the perl core will continue to rebuild DB_File over and over....

If you use y/_//d instead of eval on the return value of MM-&gt;parse_version, the problem is solved.  But if you are going to call parse_version yourself, you might as well avoid VERSION_FROM &#40;which asks EUMM to call parse_version&#41;, and just use the same result for both versions.

The attached patch makes this change to Makefile.PL.  It also changes the incantation in DB_File.pm accordingly, which is probably unnecessary, but, hey, y/// is much faster than eval!

I do realize that you cannot test this fully when you bump the version, since it will no longer end in 0.  But at least the problem will not then resurface when you get to 1.850. :-&#41;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> open_gCHlugLe.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rup DB_File-1.840-0/DB_File.pm DB_File-1.840-1/DB_File.pm
--- DB_File-1.840-0/DB_File.pm	2016-12-29 06:21:35.000000000 -0800
+++ DB_File-1.840-1/DB_File.pm	2017-10-30 09:49:52.000000000 -0700
@@ -164,7 +164,7 @@ use Carp;
 
 
 $VERSION = &#34;1.840&#34; ;
-$VERSION = eval $VERSION; # needed for dev releases
+$VERSION =~ y/_//d; # needed for dev releases
 
 {
     local $SIG{__WARN__} = sub {$splice_end_array_no_length = join&#40;&#34; &#34;,@_&#41;;};
diff -rup DB_File-1.840-0/Makefile.PL DB_File-1.840-1/Makefile.PL
--- DB_File-1.840-0/Makefile.PL	2016-12-29 03:40:29.000000000 -0800
+++ DB_File-1.840-1/Makefile.PL	2017-10-30 09:53:24.000000000 -0700
@@ -41,12 +41,15 @@ $OS2 = &#34;-DOS2&#34; if $Config{&#39;osname&#39;} eq &#39;
 my $WALL = &#39;&#39; ;
 #$WALL = &#39; -Wall &#39;;
 
+my $version = MM-&gt;parse_version&#40;&#39;DB_File.pm&#39;&#41;;
+$version =~ y/_//d;
+
 WriteMakefile&#40;
 	NAME 		=&gt; &#39;DB_File&#39;,
 	LIBS 		=&gt; [&#34;-L${LIB_DIR} $LIBS&#34;],
 	INC		=&gt; &#34;-I$INC_DIR&#34;,
-    VERSION_FROM	=&gt; &#39;DB_File.pm&#39;,
-	XS_VERSION      =&gt; eval MM-&gt;parse_version&#40;&#39;DB_File.pm&#39;&#41;,
+	VERSION		=&gt; $version,
+	XS_VERSION      =&gt; $version,
 	XSPROTOARG	=&gt; &#39;-noprototypes&#39;,
 	DEFINE		=&gt; &#34;-D_NOT_CORE $OS2 $VER_INFO $COMPAT185 $WALL&#34;,
 	OBJECT		=&gt; &#39;version$&#40;OBJ_EXT&#41; DB_File$&#40;OBJ_EXT&#41;&#39;,
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;30&nbsp;16:40:06&nbsp;2017</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 30 12:59:42 2017, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you use ‘eval’ to strip underscores from a version number, then the
&gt; Makefile ends up with 1.840 for the VERSION and 1.84 for the
&gt; XS_VERSION.
&gt; 
&gt; While perl’s usual version checks will consider those equivalent,
&gt; make_ext.pl &#40;used to build extensions in the perl core&#41; keeps things
&gt; as simple as possible and uses eq.
&gt; 
&gt; The result is that repeated runs of ‘make’ in the perl core will
&gt; continue to rebuild DB_File over and over....
&gt; 
&gt; If you use y/_//d instead of eval on the return value of MM-
<div class="message-stanza open">&gt; &gt;parse_version, the problem is solved.  But if you are going to call
</div>&gt; parse_version yourself, you might as well avoid VERSION_FROM &#40;which
&gt; asks EUMM to call parse_version&#41;, and just use the same result for
&gt; both versions.
&gt; 
&gt; The attached patch makes this change to Makefile.PL.  It also changes
&gt; the incantation in DB_File.pm accordingly, which is probably
&gt; unnecessary, but, hey, y/// is much faster than eval!
&gt; 
&gt; I do realize that you cannot test this fully when you bump the
&gt; version, since it will no longer end in 0.  But at least the problem
&gt; will not then resurface when you get to 1.850. :-&#41;
</div>
Never mind this.  My patch is flawed, in that it stops the module from even loading if it has a dev version number.  It was easier to fix make_ext.pl instead, to do a proper version comparison with version.pm’s routines.  I have done that in perl commit 301bcfd, so this ticket can be closed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;30&nbsp;16:40:07&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;30&nbsp;16:40:48&nbsp;2017</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 30 16:40:06 2017, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Oct 30 12:59:42 2017, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; If you use ‘eval’ to strip underscores from a version number, then
&gt; &gt; the
&gt; &gt; Makefile ends up with 1.840 for the VERSION and 1.84 for the
&gt; &gt; XS_VERSION.
&gt; &gt;
&gt; &gt; While perl’s usual version checks will consider those equivalent,
&gt; &gt; make_ext.pl &#40;used to build extensions in the perl core&#41; keeps things
&gt; &gt; as simple as possible and uses eq.
&gt; &gt;
&gt; &gt; The result is that repeated runs of ‘make’ in the perl core will
&gt; &gt; continue to rebuild DB_File over and over....
&gt; &gt;
&gt; &gt; If you use y/_//d instead of eval on the return value of MM-
<div class="message-stanza open">&gt; &gt; &gt; parse_version, the problem is solved.  But if you are going to call
</div>&gt; &gt; parse_version yourself, you might as well avoid VERSION_FROM &#40;which
&gt; &gt; asks EUMM to call parse_version&#41;, and just use the same result for
&gt; &gt; both versions.
&gt; &gt;
&gt; &gt; The attached patch makes this change to Makefile.PL.  It also changes
&gt; &gt; the incantation in DB_File.pm accordingly, which is probably
&gt; &gt; unnecessary, but, hey, y/// is much faster than eval!
&gt; &gt;
&gt; &gt; I do realize that you cannot test this fully when you bump the
&gt; &gt; version, since it will no longer end in 0.  But at least the problem
&gt; &gt; will not then resurface when you get to 1.850. :-&#41;
</div>&gt; 
&gt; Never mind this.  My patch is flawed, in that it stops the module from
&gt; even loading if it has a dev version number.  It was easier to fix
&gt; make_ext.pl instead, to do a proper version comparison with
&gt; version.pm’s routines.  I have done that in perl commit 301bcfd, so
&gt; this ticket can be closed.
</div>
&#40;Then again, you might want to use y/// just because it’s faster.  Just don’t change the Makefile.PL logic the way I did.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;13&nbsp;10:23:30&nbsp;2017</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing as requested.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;13&nbsp;10:23:31&nbsp;2017</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
