<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #90066 for IO-Async: IO Async Function Issue</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #90066 for IO-Async: IO Async Function Issue</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Async/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Async/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Async/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Async/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Async">IO-Async CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">90066</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Async/Active/">IO-Async</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Chris.Wright [...] OntarioSystems.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42614-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42615-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;05&nbsp;11:50:57&nbsp;2013</span>
    <span class="description">Chris.Wright [...] OntarioSystems.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IO Async Function Issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 5 Nov 2013 11:52:08 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-IO-Async [...] rt.cpan.org&#34; &lt;bug-IO-Async [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Wright &lt;Chris.Wright [...] OntarioSystems.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached script demonstrates what I am seeing with this library.  I have run this test on Centos Perl 5.18.1 with IO::Async 0.60 and Windows 7 x64 Strawberry x64 5.16.3 with IO::Async 0.61.

The program calls the Function once and the return from that function calls the function 4 more times in quick succession.  One of these calls doesn&#39;t happen if the function is declared with Max Workers at 1, 2, or 3.  If I set Max Workers to 4, all 4 function calls occur.

c:\Temp&gt;perl IOAsyncFunction.pl
Test started running on MSWin32
 CallWebService called with Web Service 1 and Version 10
  Function called for Web Service 1 with version 10
    Web Service 1 returned version 10 obtained
 CallWebService called with Web Service 2 and Version 20
  Function called for Web Service 2 with version 20
 CallWebService called with Web Service 3 and Version 30
 CallWebService called with Web Service 4 and Version 40
 CallWebService called with Web Service 5 and Version 50
    Web Service 2 returned version 20 obtained
  Function called for Web Service 4 with version 40
    Web Service 4 returned version 40 obtained
  Function called for Web Service 5 with version 50
    Web Service 5 returned version 50 obtained
Terminating on signal SIGINT&#40;2&#41;

c:\Temp&gt;


Attention: This message and all attachments are private and may contain
information that is confidential and privileged. If you received this
message in error, please notify the sender by reply email and delete
the message immediately.
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;21&nbsp;09:52:47&nbsp;2014</span>
    <span class="description">drrho [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> rho [...] devc.at</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 05 11:50:57 2013, Chris.Wright@OntarioSystems.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The program calls the Function once and the return from that function
&gt; calls the function 4 more times in quick succession.  One of these
&gt; calls doesn&#39;t happen if the function is declared with Max Workers at
&gt; 1, 2, or 3.  If I set Max Workers to 4, all 4 function calls occur.
</div>
My problem here might be related. If max_workers is NOT left undefined, but
is rather specified, the system hangs in certain constellations &#40;see attached&#41;.

Output should be

worker top-aaa_0 at /tmp/hang.pl line 8.
worker top-bbbb_0 at /tmp/hang.pl line 8.
worker top-ccccccc_0 at /tmp/hang.pl line 8.
worker top-ddddd_0 at /tmp/hang.pl line 8.
worker top-eeee_0 at /tmp/hang.pl line 8.
worker top-ffff_0 at /tmp/hang.pl line 8.
worker top-gggg_0 at /tmp/hang.pl line 8.
worker top-bbbb_1 at /tmp/hang.pl line 8.
worker top-ccccccc_1 at /tmp/hang.pl line 8.
worker top-ddddd_1 at /tmp/hang.pl line 8.
worker top-eeee_1 at /tmp/hang.pl line 8.
worker top-ffff_1 at /tmp/hang.pl line 8.
worker top-gggg_1 at /tmp/hang.pl line 8.
worker top-ccccccc_2 at /tmp/hang.pl line 8.
worker top-ddddd_2 at /tmp/hang.pl line 8.
worker top-eeee_2 at /tmp/hang.pl line 8.
worker top-ffff_2 at /tmp/hang.pl line 8.
worker top-gggg_2 at /tmp/hang.pl line 8.
worker top-ddddd_3 at /tmp/hang.pl line 8.
worker top-eeee_3 at /tmp/hang.pl line 8.
worker top-ffff_3 at /tmp/hang.pl line 8.
worker top-gggg_3 at /tmp/hang.pl line 8.
worker top-eeee_4 at /tmp/hang.pl line 8.
worker top-ffff_4 at /tmp/hang.pl line 8.
worker top-gggg_4 at /tmp/hang.pl line 8.
worker top-ffff_5 at /tmp/hang.pl line 8.
worker top-gggg_5 at /tmp/hang.pl line 8.
worker top-gggg_6 at /tmp/hang.pl line 8.

but with max_workers =&gt; 5 it is

worker top-aaa_0 at /tmp/hang.pl line 8.
worker top-bbbb_0 at /tmp/hang.pl line 8.
worker top-ccccccc_0 at /tmp/hang.pl line 8.
worker top-ddddd_0 at /tmp/hang.pl line 8.
worker top-eeee_0 at /tmp/hang.pl line 8.
worker top-ffff_0 at /tmp/hang.pl line 8.
worker top-gggg_0 at /tmp/hang.pl line 8.
worker top-bbbb_1 at /tmp/hang.pl line 8.
worker top-ccccccc_1 at /tmp/hang.pl line 8.
worker top-ddddd_1 at /tmp/hang.pl line 8.
worker top-eeee_1 at /tmp/hang.pl line 8.
worker top-ffff_1 at /tmp/hang.pl line 8.

cheers, \rho
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> hang.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use IO::Async::Loop;
my $loop = IO::Async::Loop-&gt;new;

use IO::Async::Function;
my $function = IO::Async::Function-&gt;new&#40;
    max_workers =&gt; 5, # one less than length of @SCHEDULE is ok, but NOT LESS
    code =&gt; sub { my $tid = &#34;top-&#34;.$_[0];
		  warn &#34;worker $tid&#34;;
		  return 5;
    },
    &#41;;

$loop-&gt;add&#40; $function &#41;;


my @SCHEDULE = &#40; &#39;aaa&#39;, &#39;bbbb&#39;, &#39;ccccccc&#39;, &#39;ddddd&#39;, &#39;eeee&#39;, &#39;ffff&#39;, &#39;gggg&#39; &#41;;

my $schedule = _mk_future_front &#40;&#41;;

sub _mk_future_front {
    my $round = shift || 0;

    my $front = Future-&gt;needs_all&#40; map { $function-&gt;call&#40;
					     args =&gt; [ $_.&#39;_&#39;.$round ],
					     &#41; } @SCHEDULE
	&#41;;
    $front-&gt;on_ready &#40; sub {
	shift @SCHEDULE;
#	$function-&gt;restart;
	$schedule = _mk_future_front &#40;$round+1&#41; if @SCHEDULE;
		     }&#41;;
    return $front;
}

$loop-&gt;run;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;21&nbsp;09:52:47&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
