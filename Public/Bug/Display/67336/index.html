<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #67336 for MongoDB: looks_like_number ... no?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #67336 for MongoDB: looks_like_number ... no?</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MongoDB/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MongoDB/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MongoDB/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MongoDB/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://jira.mongodb.org/browse/PERL">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/MongoDB">MongoDB CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>Please don't report bugs here.  Please use the <a href="https://jira.mongodb.org/browse/PERL">MongoDB Perl driver issue tracker</a> instead.</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">67336</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MongoDB/Active/">MongoDB</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jettero [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-227304-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.42    </td>
  </tr>
  <tr id="CF-227305-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.44    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;15:12:15&nbsp;2011</span>
    <span class="description">jettero [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> looks_like_number ... no?</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">MongoDB has some type checking that I&#39;m unaccustomed to in Perl settings
and I find counter-intuitive and arguably even wrong ... Although your
opinion may differ from mine ...

Consider this code:

if&#40; my $b = $cgi-&gt;param&#40;&#34;b&#34;&#41; &#41; {
    if&#40; my $es = eval{ UnixDate&#40;ParseDate&#40;$b&#41;, &#39;%s&#39;&#41; } &#41; {
        $search-&gt;{_id}{&#39;$gte&#39;} = $es;
    }
}

This was not working right at all until I had the idea that perhaps the
type checking was happening on in C where you can more easily check
things perl people sometimes cannot &#40;ie, NV vs PV&#41;.

Up at the high level, the best I can do is
Scalar::util::looks_like_number&#40;$epoch_seconds_string&#41;; and it surely does.

So I had the genius idea to do this:

$search-&gt;{_id}{&#39;$gte&#39;} = 0 + $es;

But I don&#39;t think I should have to, not in Perl anyway.  In Python,
sure, but not in Perl.

-Paul

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;18:40:24&nbsp;2011</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; things perl people sometimes cannot &#40;ie, NV vs PV&#41;.
</div>
IV, not NV. :&#41;

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;18:40:25&nbsp;2011</span>
    <span class="description">jettero [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;18:44:00&nbsp;2011</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">What version of Perl are you using?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;22:13:01&nbsp;2011</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 08 18:44:00 2011, KRISTINA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What version of Perl are you using?
</div>
This is perl, v5.10.1 &#40;*&#41; built for i686-linux-gnu-thread-multi

I believe the same result would happen in nearly all Perls though.

The problem &#40;if you agree there is one&#41; is in append_av in the .xs.
where it cases on SVt_IV: or SVt_PV: and where it should &#40;in my opinion&#41;
not rely an a number always being IV and a string always being PV.  In
fact they change around based on where they came from and what they were
used for last.  I assume all this is very obvious, and I&#39;m aware I&#39;m nit
picking.

-Paul

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;11&nbsp;11:50:11&nbsp;2011</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, I misunderstood your question.

The problem is that you might want to save a string that looks like a
number, so how could you do that if the driver converted everything that
looked like a number?

The way the driver works now is that, if Perl thinks something might be
a number or a string &#40;PVIVs&#41;, it&#39;ll try to figure out which is more
likely.  If Perl says &#34;this is a number&#34; &#40;IV&#41; or &#34;this is a string&#34;
&#40;PV&#41;, the driver can&#39;t do much to figure out which the user meant.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;11&nbsp;13:04:19&nbsp;2011</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can&#39;t argue that logic, but I still don&#39;t like it.  I&#39;ll just have to
get used to it.

I&#39;m too late to talk about the user interface.  You couldn&#39;t possibly
change it now.  But, I&#39;d rather see some way to explicitly talk about
the types rather than having to hint around them.  The hints should dwim
&#40;of course, what did I mean if there&#39;s no schema&#41; and then if you need
something else you should be able to say what you want.

I don&#39;t like that I have load and inflict Math::BigInt just to do a 64
bit number if my number happens to be 3_000_000; and I don&#39;t like that
&#34;3&#34; is stored as a string.

What I&#39;d rather I suppose is {&#39;$set&#39;=&gt;{val=&gt;{&#39;i64&#39;=&gt;&#34;3_000_000&#34;}}} â€¦

Well, anyway, I suppose this ticket should be marked closed/invalid.

Thanks!

-Paul

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;11&nbsp;13:09:27&nbsp;2011</span>
    <span class="description">rafl [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m completely with the requestor here.

The unreliable and very much non-obvious hacks one has to pull on the
perl side to get one&#39;s data stored in the right way are not cool and the
biggest annoyance I have with using MongoDB from perl.

Type annotations in the call site indeed seem to be the way to go. The
current DWIMmy behaviour doesn&#39;t need to be changed, only a more
explicit interface needs to be added.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;11&nbsp;11:33:53&nbsp;2011</span>
    <span class="description">sewi [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The problem is still open and it&#39;s critical &#40;took me half a working day 
to find it&#41;.

Perl people expect modules and drivers to identify numbers.

Use this code to replay the error:
-&gt;query&#40;{ date =&gt; { &#39;$gt&#39; =&gt; &#34;1310397110&#34; } }&#41;

Usually, numbers are not written in quotes, but if a variable is used 
instead of a fixed number, noone knows how it was created. My value 
came from the CGI module parsing incoming data of a HTTP request.

Perl people still see this as a number, whatever MongoDB::write_query 
is doing, it&#39;s wrong.

If you don&#39;t want to fix it, at least issue a warning if a number 
operation &#40;$gt, $lt, etc.&#41; is being used with a string argument.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;11&nbsp;15:22:41&nbsp;2011</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 11 11:33:53 2011, SEWI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Usually, numbers are not written in quotes, but if a variable is used 
&gt; instead of a fixed number, noone knows how it was created.
</div>
In fact, you can&#39;t actually tell from inside Perl without some unusual contortions.
The best you can do is <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/perldoc?Scalar::Util#looks_like_number">http://search.cpan.org/perldoc?Scalar::Util#looks_like_number</a></span>
Regular Perl people probably don&#39;t know the difference between an IV, a PV, and a PvIV 
and even if they do, they shouldn&#39;t have to.  That&#39;s not how Perl works.

If I wasn&#39;t so deep into this project and married to MongoDB, I&#39;d have ditched it completely 
after the 5 hours that went into this tragedy:

    if&#40; ref&#40;$value&#41;eq &#39;SCALAR&#39; &#41; {
        # NOTE: occasionally $value comes in as a PVIV instead of an SV = IV =&gt;
        # SV = PV; not totally sure what the difference is, but MongoDB does
        # the wrong thing by checking SVt_PV in perl_mongo.c
       
        $value = do { my $x = &#34;$$value&#34;; \$x };
        # use Devel::Peek;
        # Dump&#40;$value&#41;;
        # Dump&#40;\&#34;goal&#34;&#41;;
        # exit 0;
    }


In short, it&#39;s not just the numerical handling.  The MongoDB driver tries to make 
assumptions about what PV and IV mean and Perl&#39;s temporary internal format is the wrong 
way to check it.   Use the context for that information.  If the operation is numeric then &#34;&#34; is 
0 and if the operation is a string operation then 33 is a string.  That&#39;s how Perl works.


-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;11&nbsp;17:02:45&nbsp;2011</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Okay, I understand that everyone wants this to be easier and it is very
important.  

So, to not break backwards compat &#40;although it&#39;s pissing people off so
much I&#39;m not sure it isn&#39;t worth breaking bc...&#41; here&#39;s my plan:

* make the driver treat anything that looks_like_number as a number.
* add a flag to choose old-style &#40;attempt to auto-detect numbers&#41; vs.
new-style &#40;attempt to save anything that looks like a number as a number&#41;.

This is a pretty trivial change, the only issue is:

Some things look like numbers but shouldn&#39;t be saved as numbers &#40;e.g.,
zip codes&#41;.  To handle these, there some sort of Mongo::String type or
annotation for forcing the driver to save them as strings.  

I don&#39;t particularly like adding a string class, so: *do people have any
suggestions on a Perl-ish way of doing this?*
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;11&nbsp;21:57:03&nbsp;2011</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 11 17:02:45 2011, KRISTINA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, to not break backwards compat &#40;although it&#39;s pissing people off so
&gt; much I&#39;m not sure it isn&#39;t worth breaking bc...&#41; 
</div>
I can&#39;t speak for anyone else, but I was never pissed off.  Frustrated, sure, but never angry.  
The work you and the rest of the Mongodb people are doing is fun and exciting and all this 
stuff is new.  New stuff has little problems.   And frustrating though this stuff is, it&#39;s not that 
bad in the grand scheme of things.  It just hasn&#39;t been all worked out yet.

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;12&nbsp;03:01:48&nbsp;2011</span>
    <span class="description">sewi [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mo 11. Jul 2011, 17:02:45, KRISTINA schrieb:
[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Some things look like numbers but shouldn&#39;t be saved as numbers &#40;e.g.,
&gt; zip codes&#41;.  To handle these, there some sort of Mongo::String type or
&gt; annotation for forcing the driver to save them as strings.  
&gt; 
&gt; I don&#39;t particularly like adding a string class, so: *do people have 
</div>any
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; suggestions on a Perl-ish way of doing this?*
</div>
Thank you for facing this!

Some ideas:
 * DBIx::Class is using SCALAR-References for &#34;raw&#34; things, so $x = 
\&#39;010&#39; would be ref&#40;$x&#41; eq &#39;SCALAR&#39; and ${$x} giving the &#34;real value&#34;. 
Drawback: References are not allowed in Hash keys.
 * A &#34;custom&#34; MongoDB modifier $x = {&#39;$txt&#39; =&gt; &#39;010&#39;} could tell the 
driver that the value is forced to be text &#40;maybe use $bin instead&#41;, 
but may collide with further MongoDB operators.
 * A Datatype module like you did it for the OIDs $x = 
MongoDB::Datatype::Text-&gt;new&#40;value =&gt; &#39;010&#39;&#41; would make the job. Not as 
simple as the others, but would be ok for the few cases where it&#39;s 
required.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;17:15:19&nbsp;2011</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve added an option for aggressively parsing variables as numbers.  If
you&#39;d like to try it out, it&#39;s at
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mongodb/mongo-perl-driver">https://github.com/mongodb/mongo-perl-driver</a></span>.

How to use:

    $MongoDB::BSON::looks_like_number = 1; # defaults to 0
    $collection-&gt;insert&#40;{myNum =&gt; &#34;4&#34;}&#41;; # inserts the number 4


On Tue Jul 12 03:01:48 2011, SEWI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Am Mo 11. Jul 2011, 17:02:45, KRISTINA schrieb:
&gt; [...]
<div class="message-stanza open">&gt; &gt; Some things look like numbers but shouldn&#39;t be saved as numbers &#40;e.g.,
&gt; &gt; zip codes&#41;.  To handle these, there some sort of Mongo::String type or
&gt; &gt; annotation for forcing the driver to save them as strings.  
&gt; &gt; 
&gt; &gt; I don&#39;t particularly like adding a string class, so: *do people have 
</div>&gt; any
<div class="message-stanza open">&gt; &gt; suggestions on a Perl-ish way of doing this?*
</div>&gt; 
&gt; Thank you for facing this!
&gt; 
&gt; Some ideas:
&gt;  * DBIx::Class is using SCALAR-References for &#34;raw&#34; things, so $x = 
&gt; \&#39;010&#39; would be ref&#40;$x&#41; eq &#39;SCALAR&#39; and ${$x} giving the &#34;real value&#34;. 
&gt; Drawback: References are not allowed in Hash keys.
&gt;  * A &#34;custom&#34; MongoDB modifier $x = {&#39;$txt&#39; =&gt; &#39;010&#39;} could tell the 
&gt; driver that the value is forced to be text &#40;maybe use $bin instead&#41;, 
&gt; but may collide with further MongoDB operators.
&gt;  * A Datatype module like you did it for the OIDs $x = 
&gt; MongoDB::Datatype::Text-&gt;new&#40;value =&gt; &#39;010&#39;&#41; would make the job. Not as 
&gt; simple as the others, but would be ok for the few cases where it&#39;s 
&gt; required.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;18:13:49&nbsp;2011</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">...and added MongoDB::BSON::String type to force number-looking things
to be saved as strings. See the DataTypes pod for examples of usage.

Let me know any feedback, these will be in the 0.44 release.


On Thu Jul 21 17:15:19 2011, KRISTINA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve added an option for aggressively parsing variables as numbers.  If
&gt; you&#39;d like to try it out, it&#39;s at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mongodb/mongo-perl-driver">https://github.com/mongodb/mongo-perl-driver</a></span>.
&gt; 
&gt; How to use:
&gt; 
&gt;     $MongoDB::BSON::looks_like_number = 1; # defaults to 0
&gt;     $collection-&gt;insert&#40;{myNum =&gt; &#34;4&#34;}&#41;; # inserts the number 4
&gt; 
&gt; 
&gt; On Tue Jul 12 03:01:48 2011, SEWI wrote:
<div class="message-stanza open">&gt; &gt; Am Mo 11. Jul 2011, 17:02:45, KRISTINA schrieb:
&gt; &gt; [...]
<div class="message-stanza open">&gt; &gt; &gt; Some things look like numbers but shouldn&#39;t be saved as numbers &#40;e.g.,
&gt; &gt; &gt; zip codes&#41;.  To handle these, there some sort of Mongo::String type or
&gt; &gt; &gt; annotation for forcing the driver to save them as strings.  
&gt; &gt; &gt; 
&gt; &gt; &gt; I don&#39;t particularly like adding a string class, so: *do people have 
</div>&gt; &gt; any
<div class="message-stanza open">&gt; &gt; &gt; suggestions on a Perl-ish way of doing this?*
</div>&gt; &gt; 
&gt; &gt; Thank you for facing this!
&gt; &gt; 
&gt; &gt; Some ideas:
&gt; &gt;  * DBIx::Class is using SCALAR-References for &#34;raw&#34; things, so $x = 
&gt; &gt; \&#39;010&#39; would be ref&#40;$x&#41; eq &#39;SCALAR&#39; and ${$x} giving the &#34;real value&#34;. 
&gt; &gt; Drawback: References are not allowed in Hash keys.
&gt; &gt;  * A &#34;custom&#34; MongoDB modifier $x = {&#39;$txt&#39; =&gt; &#39;010&#39;} could tell the 
&gt; &gt; driver that the value is forced to be text &#40;maybe use $bin instead&#41;, 
&gt; &gt; but may collide with further MongoDB operators.
&gt; &gt;  * A Datatype module like you did it for the OIDs $x = 
&gt; &gt; MongoDB::Datatype::Text-&gt;new&#40;value =&gt; &#39;010&#39;&#41; would make the job. Not as 
&gt; &gt; simple as the others, but would be ok for the few cases where it&#39;s 
&gt; &gt; required.
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;18:14:18&nbsp;2011</span>
    <span class="description">KRISTINA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;18:29:55&nbsp;2011</span>
    <span class="description">ether [...] cpan.org -  Severity Unimportant changed to Normal</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;18:29:55&nbsp;2011</span>
    <span class="description">ether [...] cpan.org -  Fixed in 0.44 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
