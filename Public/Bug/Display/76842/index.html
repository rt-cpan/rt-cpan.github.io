<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #76842 for Data-FormValidator: Empty line is considered to be a correct value</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #76842 for Data-FormValidator: Empty line is considered to be a correct value</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Data-FormValidator/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Data-FormValidator/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Data-FormValidator/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Data-FormValidator/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Data-FormValidator">Data-FormValidator CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>This is the bug queue for Data::FormValidator. </p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">76842</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Data-FormValidator/Active/">Data-FormValidator</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
BESSARABV [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-9052-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
4.65</li>
<li>
4.70</li>
</ul>
    </td>
  </tr>
  <tr id="CF-9053-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;07:22:21&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Empty line is considered to be a correct value</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m expecting this test to pass:

#!/usr/bin/perl

use strict;
use warnings FATAL =&gt; &#39;all&#39;;
use Data::FormValidator;
use Test::More tests =&gt; 4;

my $validate_rules = {
    optional =&gt; [qw&#40;
        letter
        letter_or_null
    &#41;],

    constraint_methods =&gt; {
        letter =&gt; qr/^[A-F]$/,
        letter_or_null =&gt; qr/^&#40;?:[A-F]&#41;?$/,
    },
};

my $tests = [
    {
        block =&gt; {
            letter =&gt; &#39;A&#39;,
        },
        status =&gt; 1
    },
    {
        block =&gt; {
            letter_or_null =&gt; &#39;A&#39;,
        },
        status =&gt; 1
    },
    {
        block =&gt; {
            letter =&gt; &#39;&#39;,
        },
        status =&gt; 0
    },
    {
        block =&gt; {
            letter_or_null =&gt; &#39;&#39;,
        },
        status =&gt; 1
    },
];

foreach my $t &#40;@{$tests}&#41; {

    my $results = Data::FormValidator-&gt;check&#40;$t-&gt;{block}, $validate_rules&#41;;
    my $status;

    if &#40;
            $results-&gt;has_invalid
         or $results-&gt;has_missing
         or $results-&gt;has_unknown
        &#41; {
        $status = 0;
    } else {
        $status = 1;
    }

    my $msg = &#39;Block is &#39; . &#40;$t-&gt;{status} ? &#39;valid&#39; : &#39;invalid&#39;&#41;;
    is &#40;$status, $t-&gt;{status}, $msg&#41;;

}

__END__

The output of the test:

1..4
ok 1 - Block is valid
ok 2 - Block is valid
not ok 3 - Block is invalid
#   Failed test &#39;Block is invalid&#39;
#   at a.pl line 63.
#          got: &#39;1&#39;
#     expected: &#39;0&#39;
ok 4 - Block is valid
# Looks like you failed 1 test of 4.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;09:20:26&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">An empty value is considered &#34;missing&#34;. Constraints aren&#39;t applied to 
missing values, so the regex is never considered. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;09:20:28&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;09:20:28&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;10:03:37&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the quick response.

From my point of view it is incorrect to considered empty values as
&#34;missing&#34;. Just for example: the &#39;fax&#39; field in the users data. User can
enter some fax number, but later he can remove it. In this case the
empty value is the correct value.

Hope that some day this will appear in Data::FormValidator. Thank you
anyway.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;10:03:38&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;10:06:38&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 27 10:03:37 2012, BESSARABV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you for the quick response.
&gt; 
&gt; From my point of view it is incorrect to considered empty values as
&gt; &#34;missing&#34;. Just for example: the &#39;fax&#39; field in the users data. User 
</div>can
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; enter some fax number, but later he can remove it. In this case the
&gt; empty value is the correct value.
&gt; 
&gt; Hope that some day this will appear in Data::FormValidator. Thank you
&gt; anyway.
</div>
Have you found the configuration option called &#39;missing_optional_valid&#39; 
? 

That sounds like what you want:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/Data::FormValidator#missing_optional_valid">https://metacpan.org/module/Data::FormValidator#missing_optional_valid</a></span>

I have it set as the default in my own applications. I would have made 
it the default in Data::FormValidator as well, but long ago when I took 
over maintenance, I was concerned about breaking apps that depended on 
the old behavior. 
 
   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;10:06:39&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;11:08:33&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you. I&#39;ve seen that parameter, but I doesn&#39;t solved by problem.

Now I have looked to it more thoroughly. I&#39;ve added
missing_optional_valid =&gt; 1
to my profile structure. After that fields with empty values have
appeared in
$results-&gt;valid.

But values with missing options are not passed to constraint methods.
And this
is the problem. For some fields I want to allow empty lines, but for others
empty lines are incorrect. I would like to check it in constraint
methods, so
what do you think about adding parameter &#39;examine_empty_fields_in_methods&#39;?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;11:08:34&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;14:33:13&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I appreciate your feedback but I&#39;m sorry, something like that won&#39;t be 
added. &#40; Unless perhaps you find several other people who also strongly 
want the feature. &#41; 

If you&#39;d like, you could use a filter which converts particular empty 
strings to another value, which you could then test with a constraint. 

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;14:33:14&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;28&nbsp;13:05:34&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you. I understand your position that you are not planning to implement
that. But can you please describe why you don&#39;t?

Do you think that 1&#41; this is incorrect behaviour or 2&#41; you think that is is
not needed for the users of this module or 3&#41; you don&#39;t have time to add 
this feature or 4&#41; maybe somethins else?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;28&nbsp;13:05:35&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;28&nbsp;14:04:42&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 28 13:05:34 2012, BESSARABV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you. I understand your position that you are not planning to 
</div>implement
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; that. But can you please describe why you don&#39;t?
&gt; 
&gt; Do you think that 1&#41; this is incorrect behaviour or 2&#41; you think that 
</div>is is
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; not needed for the users of this module or 3&#41; you don&#39;t have time to 
</div>add 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; this feature or 4&#41; maybe somethins else?
</div>
I think the feature would be rarely used and has reasonable 
alternatives. Meanwhile, it would add it to the complexity of the code 
and documentation and increase the risk of other bugs. 

The module has been in use for several years and has hundreds if not 
thousands of users. Having a single person ask for a feature is not a 
good indication that it would be generally useful. You are welcome to 
promote the idea on the mailing list mentioned in the documentation or 
elsewhere, and see if you can find anyone else who is interested. 

If a number of people were interested, I would consider changing my 
mind, but I don&#39;t anticipate that happening. 

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;28&nbsp;14:04:43&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;28&nbsp;14:11:13&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the explanation.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;28&nbsp;14:11:13&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;28&nbsp;14:11:27&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;01&nbsp;15:19:50&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">To make this ticket 100% complete I&#39;m putting here the fixed script that 
do
what I exect. Many thanks to Mark who has suggested this solution.

#!/usr/bin/perl

use strict;
use warnings FATAL =&gt; &#39;all&#39;;
use Data::FormValidator;
use Test::More tests =&gt; 4;

my $null = &#39;null&#39;;

my $validate_rules = {
    optional =&gt; [qw&#40;
        letter
        letter_or_null
    &#41;],
    filters =&gt; [
        sub {
            my $val = $_[0];
            $val = $null if $val eq &#39;&#39;;
            return $val;
        }
    ],

    constraint_methods =&gt; {
        letter =&gt; qr/^[A-F]$/,
        letter_or_null =&gt; qr/^[A-F]|$null$/,
    },
};

my $tests = [
    {
        block =&gt; {
            letter =&gt; &#39;A&#39;,
        },
        status =&gt; 1
    },
    {
        block =&gt; {
            letter_or_null =&gt; &#39;A&#39;,
        },
        status =&gt; 1
    },
    {
        block =&gt; {
            letter =&gt; &#39;&#39;,
        },
        status =&gt; 0
    },
    {
        block =&gt; {
            letter_or_null =&gt; &#39;&#39;,
        },
        status =&gt; 1
    },
];

foreach my $t &#40;@{$tests}&#41; {

    my $results = Data::FormValidator-&gt;check&#40;$t-&gt;{block}, 
$validate_rules&#41;;
    my $status;

    if &#40;
            $results-&gt;has_invalid
         or $results-&gt;has_missing
         or $results-&gt;has_unknown
        &#41; {
        $status = 0;
    } else {
        $status = 1;
    }

    my $msg = &#39;Block is &#39; . &#40;$t-&gt;{status} ? &#39;valid&#39; : &#39;invalid&#39;&#41;;
    is &#40;$status, $t-&gt;{status}, $msg&#41;;

}

__END__

The output of the test:
1..4
ok 1 - Block is valid
ok 2 - Block is valid
ok 3 - Block is invalid
ok 4 - Block is valid
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;01&nbsp;15:19:51&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;01&nbsp;15:20:15&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;02&nbsp;03:36:53&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m sorry for writing here once again, but I have a bug in my previous
script.
I&#39;m changin empty string to some value in in filters but I&#39;m not chaiging it
back. Here is the fixed version.

#!/usr/bin/perl

use strict;
use warnings FATAL =&gt; &#39;all&#39;;
use Data::FormValidator;
use Test::More tests =&gt; 4;

my $null = &#39;null&#39;;

my $validate_rules = {
    optional =&gt; [qw&#40;
        letter
        letter_or_null
    &#41;],
    filters =&gt; [
        sub {
            my $val = $_[0];
            $val = $null if $val eq &#39;&#39;;
            return $val;
        }
    ],

    constraint_methods =&gt; {
        letter =&gt; qr/^[A-F]$/,
        letter_or_null =&gt; qr/^[A-F]|$null$/,
    },
};

my $tests = [
    {
        block =&gt; {
            letter =&gt; &#39;A&#39;,
        },
        status =&gt; 1
    },
    {
        block =&gt; {
            letter_or_null =&gt; &#39;A&#39;,
        },
        status =&gt; 1
    },
    {
        block =&gt; {
            letter =&gt; &#39;&#39;,
        },
        status =&gt; 0
    },
    {
        block =&gt; {
            letter_or_null =&gt; &#39;&#39;,
        },
        status =&gt; 1
    },
];

foreach my $t &#40;@{$tests}&#41; {

    my $results = Data::FormValidator-&gt;check&#40;$t-&gt;{block},
$validate_rules&#41;;
    my $status;

    if &#40;
            $results-&gt;has_invalid
         or $results-&gt;has_missing
         or $results-&gt;has_unknown
        &#41; {
        $status = 0;
    } else {
        $status = 1;
    }

    my $msg = &#39;Block is &#39; . &#40;$t-&gt;{status} ? &#39;valid&#39; : &#39;invalid&#39;&#41;;
    is &#40;$status, $t-&gt;{status}, $msg&#41;;

    my $valid_block = $results-&gt;valid;
    foreach my $k &#40; keys %{$valid_block}&#41; {
        if &#40;$valid_block-&gt;{$k} eq $null&#41; {
            $valid_block-&gt;{$k} = &#39;&#39;;
        };
    };

    # now in $valid_block we have the same values as in original block
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;02&nbsp;03:36:54&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;May&nbsp;02&nbsp;03:36:54&nbsp;2012</span>
    <span class="description">BESSARABV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
