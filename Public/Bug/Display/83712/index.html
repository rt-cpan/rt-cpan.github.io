<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #83712 for DBIx-Class: RFC: rename belongs_to to refers_to</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #83712 for DBIx-Class: RFC: rename belongs_to to refers_to</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">83712</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class/Active/">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MITHALDU [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;01&nbsp;11:03:18&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RFC: rename belongs_to to refers_to</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Resulting out of an IRC discussion i created the branch 
&#34;belongs_to_rename&#34;. It contains multiple commits that rename 
belongs_to to refers_to, adds an alias from belongs_to to refers_to; 
then renames all occurences of belongs_to in the code, documentation 
and tests. All these actions are split up into multiple commits to 
allow an easier review of the changes and to make it easier to compose 
the final commit after it&#39;s been decided how the change is desired to 
happen.

I&#39;ve not written any tests yet because the test suite is rather 
daunting and i&#39;d like some guidance as to what should be tested and 
how. One possible way would be to skip the renaming of belongs_to in 
tests, as those tests would then test both methods. That seems to be 
kind of ghetto on the other hand though, with a test that belongs_to 
executes refers_to seeming more sensible. I am however unclear as to 
how that&#39;d best be done. Suggestions welcome.

As for the alias of belongs_to to refers_to, my original notion was 
simply to do `*belongs_to = \&#38;refers_to;`, however that caused 
`55namespaces_cleaned.t` to complain about mismatching names of 
function and GV. Thus i solved it with `goto \&#38;refers_to`. If that is 
not desired, suggestions welcome.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;01&nbsp;11:18:57&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83712] RFC: rename belongs_to to refers_to</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 2 Mar 2013 03:18:42 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Walde via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Mar 01, 2013 at 11:03:19AM -0500, Christian Walde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Mar 01 11:03:18 2013: Request 83712 was acted upon.
&gt; Transaction: Ticket created by MITHALDU
&gt;        Queue: DBIx-Class
&gt;      Subject: RFC: rename belongs_to to refers_to
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: MITHALDU@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=83712">https://rt.cpan.org/Ticket/Display.html?id=83712</a></span> &gt;
&gt; 
&gt; 
&gt; Resulting out of an IRC discussion i created the branch 
&gt; &#34;belongs_to_rename&#34;. It contains multiple commits that rename 
&gt; belongs_to to refers_to,
</div>
I need to start with a disclaimer - I do not want to demotivate you, 
this is something that we need to do for a very long time &#40;the 
renaming&#41;. Yet your proposal suffers a semantical problem. Please read 
the rest as an attempt at objective criticism, not as an attempt to kill 
your effort outright.

This has come up many times in the past, and this patch *also* falls 
short of addressing the main problem. You are looking at belongs_to as 
an isolated method. Yet before we had:

belongs_to / might_have / has_one / has_many

now we have

refers_to / might_have / has_one / has_many

While before folks would get confused what might_have and has_one means, 
at least they would always get belongs_to correct &#40;due to the implied 
parent/child relation&#41;.

I believe the new naming scheme makes things even worse as the only 
thing not ambiguous now is &#34;has_many&#34;. Your proposal would be much more 
complete if it went

refers_to / maybe_refers_to / referred_to / maybe_referred_to / many_refer_to

But it results in weird english.

I proposed a scheme a long time ago, which is not glamorous but is 
*uanmbiguous*:

owned_by / maybe_owned_by / owns_one / maybe_owns_one / owns_many

This proposal was not supported sadly.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve not written any tests yet because the test suite is rather 
&gt; daunting and i&#39;d like some guidance as to what should be tested and 
&gt; how.
</div>
I would provide help &#40;or do the tricky parts myself, as backcompat is
ugly business to test&#41;. But we need to get saner names first &#40;or have
most of the cabal agree with your current proposal&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for the alias of belongs_to to refers_to, my original notion was 
&gt; simply to do `*belongs_to = \&#38;refers_to;`, however that caused 
&gt; `55namespaces_cleaned.t` to complain about mismatching names of 
&gt; function and GV. Thus i solved it with `goto \&#38;refers_to`. If that is 
&gt; not desired, suggestions welcome.
</div>
You may never do this in OO programming. Because if someone is 
overriding the refers_to method, and then another user calls the 
belongs_to proxy, perl will dispatch to the original refers_to, not the 
override. You always do:

sub old_name { shift-&gt;new_name&#40;@_&#41; }

Furthermore the exceptions need to be doubled up, to throw text 
containing &#39;belongs_to&#39; when the exception is a result of calling a 
&#39;belongs_to&#39;. A &#39;refers_to&#39; containing error message in an old codebase, 
where refers_to does not exist will be very confusing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;01&nbsp;11:19:00&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;04&nbsp;08:45:26&nbsp;2013</span>
    <span class="description">walde.christian [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83712] RFC: rename belongs_to to refers_to</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 04 Mar 2013 14:45:10 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Peter Rabbitson via RT&#34; &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Walde&#34; &lt;walde.christian [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 01 Mar 2013 17:19:00 +0100, Peter Rabbitson via RT  
&lt;bug-DBIx-Class@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Resulting out of an IRC discussion i created the branch
&gt;&gt; &#34;belongs_to_rename&#34;. It contains multiple commits that rename
&gt;&gt; belongs_to to refers_to,
</div>&gt;
&gt; I need to start with a disclaimer - I do not want to demotivate you,
&gt; this is something that we need to do for a very long time &#40;the
&gt; renaming&#41;. Yet your proposal suffers a semantical problem. Please read
&gt; the rest as an attempt at objective criticism, not as an attempt to kill
&gt; your effort outright.
</div>
No worries. I made those changes mostly to see what they&#39;d end up being,  
fully aware that they&#39;ll likely be partly or fully scrapped.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This has come up many times in the past, and this patch *also* falls
&gt; short of addressing the main problem. You are looking at belongs_to as
&gt; an isolated method.
</div>
I&#39;m doing so because that was how far i got in trying to use DBIC. To  
explain, i have a table representing PPI elements, which i deploy&#40;&#41; to an  
empty sqlite database, which looks like this:

id | type  | source | line | column | long_pattern | short_pat
.. | struc | ...[A] | ...  | ...    | ...[A]       | ...[A]
.. | block | ...[A] | ...  | ...    | ...[A]       | ...[A]
.. | struc | ...[B] | ...  | ...    | ...[B]       | ...[B]
.. | struc | ...[C] | ...  | ...    | ...[C]       | ...[B]
.. | block | ...[D] | ...  | ...    | ...[D]       | ...[C]
.. | block | ...[E] | ...  | ...    | ...[D]       | ...[C]

I&#39;d like to remove duplication, by normalizing into something like this:

id | type  | source | loc | long_pattern | short_pat
.. | struc | 1      | 1   | 1            | 1
.. | block | 1      | 1   | 1            | 1
.. | struc | 2      | 2   | 2            | 2
.. | struc | 3      | 3   | 3            | 2
.. | block | 4      | 4   | 4            | 3
.. | block | 5      | 5   | 4            | 3

Leaving out all but the source column, for now, my naive thought was: Each  
element has one source string. Different elements might share the same,  
but each has one. Turned out has_one was wrong for that though, it  
should&#39;ve been belongs_to &#40;as far as functionality goes&#41;

However, the source column is just metadata that i&#39;d normally even throw  
away and only keep around so i can print nicer reports about the harvested  
data down the line. They&#39;re only separate because of memory concerns. In  
fact, the elements belong so little to the source bits that the elements  
*need* to be kept around even if the source bit is removed from the  
database. The same would be true for location. In some analysis cases i  
would not care at all where the element was located.

What happens here is that each element simply has a reference to a bit of  
metadata.

In these two cases belongs_to does not accurately reflect the type of  
relationship.

That is why, for now, i was only looking at belongs_to.

In the meantime i&#39;ve had more time to think about it, which is partly why  
my table up there contains two more columns. Each of the elements will be  
compressible, via different algorithms, into code patterns. These are not  
simply metadata for my purposes, they actually stand for groups of things.  
And each element belongs to one group and each element is only useful if  
it belongs to these groups.

As such, for those relationships belongs_to is perfectly correct.

So, as far as i can tell &#40;and i might be entirely wrong due to my  
inexperience&#41; there are two semantically different cases that are  
implemented by belongs_to&#40;&#41; in the same manner.

So right now i&#39;m thinking that both need to be around.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; other relationships
</div>
I&#39;m sorry, i still have not gotten that far &#40;aside from being told to  
never use has_one&#41; and cannot useful opine on those. I will need to  
actually read the documentation before doing so, but did not wish to leave  
you waiting for a reply until i&#39;ve done so.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; owned_by / maybe_owned_by / owns_one / maybe_owns_one / owns_many
</div>
Looking at those i&#39;d choose maybe_owns_one for location and source, and  
owned_by for the pattern groups, expecting DBIC to generate the table  
layout above. Is that what you&#39;re thinking?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; As for the alias of belongs_to to refers_to, my original notion was
&gt;&gt; simply to do `*belongs_to = \&#38;refers_to;`, however that caused
&gt;&gt; `55namespaces_cleaned.t` to complain about mismatching names of
&gt;&gt; function and GV. Thus i solved it with `goto \&#38;refers_to`. If that is
&gt;&gt; not desired, suggestions welcome.
</div>&gt;
&gt; You may never do this in OO programming. Because if someone is
&gt; overriding the refers_to method, and then another user calls the
&gt; belongs_to proxy, perl will dispatch to the original refers_to, not the
&gt; override. You always do:
&gt;
&gt; sub old_name { shift-&gt;new_name&#40;@_&#41; }
</div>
Noted. I thought about this, but did not like it due to the performance  
impact. If we can agree on names, i will do that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Furthermore the exceptions need to be doubled up, to throw text
&gt; containing &#39;belongs_to&#39; when the exception is a result of calling a
&gt; &#39;belongs_to&#39;. A &#39;refers_to&#39; containing error message in an old codebase,
&gt; where refers_to does not exist will be very confusing.
</div>
Ah, i was looking at that, but wasn&#39;t sure if it was necessary or not.

-- 
With regards,
Christian Walde
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;04&nbsp;09:38:30&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83712] RFC: rename belongs_to to refers_to</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 5 Mar 2013 01:38:12 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Christian Walde via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Mar 04, 2013 at 08:45:28AM -0500, Christian Walde via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, as far as i can tell &#40;and i might be entirely wrong due to my  
&gt; inexperience&#41; there are two semantically different cases that are  
&gt; implemented by belongs_to&#40;&#41; in the same manner.
&gt; 
&gt; So right now i&#39;m thinking that both need to be around.
&gt; 
<div class="message-stanza open">&gt; &gt; other relationships
</div>&gt; 
&gt; I&#39;m sorry, i still have not gotten that far &#40;aside from being told to  
&gt; never use has_one&#41; and cannot useful opine on those. I will need to  
&gt; actually read the documentation before doing so, but did not wish to leave  
&gt; you waiting for a reply until i&#39;ve done so.
&gt; 
<div class="message-stanza open">&gt; &gt; owned_by / maybe_owned_by / owns_one / maybe_owns_one / owns_many
</div>&gt; 
&gt; Looking at those i&#39;d choose maybe_owns_one for location and source, and  
&gt; owned_by for the pattern groups, expecting DBIC to generate the table  
&gt; layout above. Is that what you&#39;re thinking?
</div>
Thank you for keeping on top of this. Your inexperience with the API is 
very very valuable to make progress where none has been made for years.

I need to step back in order to explain this properly. Under the hood 
there is only one way to actually add a relationship in DBIC: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/DBIx::Class::ResultSource#add_relationship">https://metacpan.org/module/DBIx::Class::ResultSource#add_relationship</a></span> 
The calls to belongs_to/has_many/has_one/might_have are simply 
convenience wrappers to assemble the condition and to set the correct 
relationship attributes &#40;they are not all documented where I linked you, 
we suck, look here instead: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/DBIx::Class::Relationship::Base#add_relationship&#41;">https://metacpan.org/module/DBIx::Class::Relationship::Base#add_relationship&#41;</a></span>. 
The way to differentiate them is to take the following attribute matrix:

- join_type: inner OR left &#40;right join makes little sense under the 
root-&gt;leaf design of DBIC&#41;

- is_multi: is it a 1:1 or a 1:M

- is_dependent: 1/0 - the easiest way to explain this is the answer to 
the question: If this relationship had a FK constraint declared in the 
RDBMS - which way would it &#34;point&#34;? &#40;the FK constraint obviously is not 
required, the relationship express an arbitrary JOIN clause, not RDBMS 
structure&#41;. Or in other words do we or does the far side hold values 
that can not exist without identical values on the other side of the 
relationship.

Given the above, all our relationship helpers can simply be described 
as:

belongs_to =&gt; { join_type =&gt; &#39;inner&#39;, is_multi =&gt; 0, is_dependent =&gt; 1 }
has_one =&gt; { join_type =&gt; &#39;inner&#39;, is_multi =&gt; 0, is_dependent =&gt; 0 }
might_have =&gt; { join_type =&gt; &#39;left&#39;, is_multi =&gt; 0, is_dependent =&gt; 0 }
has_many =&gt; { join_type =&gt; &#39;left&#39;, is_multi =&gt; 1, is_dependent =&gt; 0 }

As you can see above &#39;has_one&#39; is kinda useless as an idea, hence why 
someone told you never to use it. It has merit as a use-case, but would 
be extremely rare. We currently do not have a &#39;might_belong_to&#39; - this 
is probably what confused you. Also in some examples you see a 
belongs_to declaration with an overriden join_type - the &#34;official&#34; 
&lt;puke&gt; way of doing it currently. In this light the other naming 
proposal should be clearer.

It should also be clear why I am opposed to changing *only* the name of 
belongs_to - as it stands currently that&#39;s the only helper that actually 
does what it says on the tin. Everything else requires repeated &#34;aha&#34; 
moments to get right. I would argue that even &#34;has_many&#34; is a tad 
misleading, because it does not convey explicitly the presence of a 
&#34;left&#34; join.

Now given all of this extra info - what do you think? Also transcribing 
this into POD additions would be very very very much appreciated. Darned 
ETIME :&#40;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; sub old_name { shift-&gt;new_name&#40;@_&#41; }
</div>&gt; 
&gt; Noted. I thought about this, but did not like it due to the performance  
&gt; impact.
</div>
You are correct - there is a performance impact. There is no way of 
getting around this, short of designing proper API&#39;s that need no 
changes in the first place ;&#41;

Cheers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;04&nbsp;12:02:06&nbsp;2013</span>
    <span class="description">walde.christian [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83712] RFC: rename belongs_to to refers_to</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 04 Mar 2013 18:01:47 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Peter Rabbitson via RT&#34; &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Walde&#34; &lt;walde.christian [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 04 Mar 2013 15:38:39 +0100, Peter Rabbitson via RT  
&lt;bug-DBIx-Class@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now given all of this extra info - what do you think?
</div>
That you&#39;re going a bit further than i am and too much into the guts. I  
care about two things at the moment:

1. Does the class i set up generate the right table when i deploy it? &#40;Not  
even thinking about fk, just elemental question of: Is the column i want  
where i want it?&#41;

2. Does it have a useful accessor? &#40;I don&#39;t really care how it&#39;s  
implemented, as i haven&#39;t looked at how accessors for relations work at  
all.&#41;

Your email, while very interesting &#40;and successful in prompting me to read  
up on SQL again&#41;, did not really help me understand these issues about the  
helpers.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It should also be clear why I am opposed to changing *only* the name of 
&gt; belongs_to - as it stands currently that&#39;s the only helper that actually 
&gt; does what it says on the tin.
</div>
Hmmm, i thought i&#39;d demonstrated how for me its tin inscription did not  
match the result and how that only changed after considerable thinking and  
a change in view angle? :&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also transcribing
&gt; this into POD additions would be very very very much appreciated. Darned
&gt; ETIME :&#40;
</div>
Not right now, but when i&#39;ve a better grip on things i&#39;ll be sure to do  
doc patches.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt; sub old_name { shift-&gt;new_name&#40;@_&#41; }
</div>&gt;&gt;
&gt;&gt; Noted. I thought about this, but did not like it due to the performance
&gt;&gt; impact.
</div>&gt;
&gt; You are correct - there is a performance impact. There is no way of
&gt; getting around this, short of designing proper API&#39;s that need no
&gt; changes in the first place ;&#41;
</div>
This is off the wall, but how about more simple Moo-style relation  
declarators? e.g.:

package Source;

refby element = &#40; as =&gt; &#39;leaf&#39;, multi =&gt; 1 &#41;;

package Element;

refs source =&gt; &#40; as =&gt; &#39;root&#39; &#41;;
refs pattern_short =&gt; &#40; as =&gt; &#39;leaf&#39; &#41;;

package PatternShort;

refby element =&gt; &#40; as =&gt; &#39;root&#39;, multi =&gt; 1 &#41;;

-- 
With regards,
Christian Walde
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
