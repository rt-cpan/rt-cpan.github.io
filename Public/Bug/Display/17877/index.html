<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17877 for CPAN: CPAN should warn if CPAN::Config contains problematic entries</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17877 for CPAN: CPAN should warn if CPAN::Config contains problematic entries</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CPAN/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CPAN/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CPAN/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CPAN/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CPAN">CPAN CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17877</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CPAN/Active/">CPAN</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ANDK [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
corion [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-8164-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.87    </td>
  </tr>
  <tr id="CF-8165-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;10:52:44&nbsp;2006</span>
    <span class="description">corion [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CPAN should warn if CPAN::Config contains problematic entries</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have my make utility installed in a path with whitespace in it
&#40;actually, Microsoft chose so and I stayed with the default&#41;.
CPAN/FirstTime.pm adds $CPAN::Config-&gt;{make} as

  &#39;make&#39; =&gt; q[C:\Programme\Microsoft Visual C++ Toolkit 2003\bin\nmake.EXE],

which later on causes problems with the shell interpolation. Of course,
the Grand Big Scheme will be to exorcise all shell interpolation
and system&#40;STRING&#41; calls, but the easy fix was to add appropriate quotes
to my CPAN/Config.pm like this:

  &#39;make&#39; =&gt; q[&#34;C:\Programme\Microsoft Visual C++ Toolkit
2003\bin\nmake.EXE&#34;],

I&#39;ve patched CPAN::HandleConfig to add a C&lt;sanity_check&gt; method which
currently checks just that the C&lt;make&gt; entry is sane &#40;that is, exists,
and if it contains whitespace, that it also has quotes at the start and
end&#41;. See the attached diff against 1.87, and the attached test file to
test it.

Thanks for maintaining CPAN!
-max
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> sanity_check.t</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
use strict;
use Test::More tests =&gt; 5;
use Data::Dumper;

use_ok &#34;CPAN::HandleConfig&#34;;

{
    local $CPAN::Config = {};
    is_deeply&#40; { CPAN::HandleConfig-&gt;sanity_check&#40;&#41; }, {}, &#34;Sanity check for undefined &#39;make&#39; entry works&#34; &#41;
        or diag Dumper { CPAN::HandleConfig-&gt;sanity_check&#40;&#41; };
};

{
    local $CPAN::Config = {
        make =&gt; &#39;/some/path with whitespace/in it/where the file doesnt/exist&#39;,
    };
    is_deeply&#40; { CPAN::HandleConfig-&gt;sanity_check&#40;&#41; }-&gt;{make},
        [
                       &#39;A path seems to be given in &gt;/some/path with whitespace/in it/where the file doesnt/exist&lt; but the file was not found.&#39;,
                       &#39;&gt;/some/path with whitespace/in it/where the file doesnt/exist&lt;
seems to contain whitespace but is not quoted.
This might be OK if there are additional commands you
want to pass to your make utility. If you want to use
&#34;/some/path with whitespace/in it/where the file doesnt/exist&#34;
as your make program, please add appropriate quotes
to the line in Config.pm.
&#39;,
        ], &#34;Sanity check for unquoted &#39;make&#39; entry works&#34; &#41;
        or diag Dumper { CPAN::HandleConfig-&gt;sanity_check&#40;&#41; };
};

{
    local $CPAN::Config = {
        make =&gt; &#39;make&#39;,
    };
    is_deeply&#40; { CPAN::HandleConfig-&gt;sanity_check&#40;&#41; }, {}, &#34;Sanity check for bare &#39;make&#39; is silent&#34; &#41;
        or diag Dumper { CPAN::HandleConfig-&gt;sanity_check&#40;&#41; };
};

{
    local $CPAN::Config = {
        make =&gt; &#39;nmake.exe&#39;,
    };
    is_deeply&#40; { CPAN::HandleConfig-&gt;sanity_check&#40;&#41; }, {}, &#34;Sanity check for bare &#39;make&#39; is silent &#40;Win32 variant&#41;&#34; &#41;;
};

</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> HandleConfig.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- HandleConfig.pm	Wed Feb 22 23:02:27 2006
+++ HandleConfig.pm-Corion	Mon Feb 27 16:54:40 2006
@@ -287,7 +287,7 @@
 # maintainability.  RMB
 #
 sub _configpmtest {
-    my&#40;$configpmdir, $configpmtest&#41; = @_; 
+    my&#40;$configpmdir, $configpmtest&#41; = @_;
     if &#40;-w $configpmtest&#41; {
         return $configpmtest;
     } elsif &#40;-w $configpmdir&#41; {
@@ -341,6 +341,18 @@
     my&#40;@miss&#41;;
     use Carp;
     require_myconfig_or_config;
+    my %warnings = $self-&gt;sanity_check&#40;&#41;;
+    if &#40;! $args{be_silent} &#38;&#38; keys %warnings&#41; {
+        $CPAN::Frontend-&gt;myprint&#40; &#34;*** The following values are possibly problematic:\n&#34; &#41;;
+        for my $val &#40;keys %warnings&#41; {
+            for my $w &#40;@{$warnings{$val}}&#41; {
+                $w =~ s!^!\t\t!mg;
+                my $text = $val . substr&#40; $w, 1 &#41;;
+                $CPAN::Frontend-&gt;myprint&#40;&#34;$text\n&#34;&#41;;
+            };
+        };
+    };
+    
     return unless @miss = $self-&gt;missing_config_data;
 
     require CPAN::FirstTime;
@@ -473,6 +485,60 @@
     return grep /^\Q$word\E/, @o_conf;
 }
 
+=head2 C&lt;&lt; $self-&gt;sanity_check &gt;&gt;
+
+Returns a list of suspicious/potentially problematic
+values and the corresponding warning messages.
+
+Currently, the only check made is for:
+
+=head3 C&lt;&lt; make &gt;&gt;
+
+If the &#40;path to the&#41; file contains whitespace
+and is not quoted, a warning is emitted, as
+CPAN.pm and other tools will likely have problems
+with that.
+
+=cut
+
+sub sanity_check {
+    my &#40;$self&#41; = @_;
+    my %res;
+    if &#40;defined &#40;my $make = $CPAN::Config-&gt;{make}&#41;&#41; {
+        my $quotes = $^O eq &#39;MSWin32&#39; 
+                     ? &#39;&#34;&#39;
+                     : qq&lt;&#34;&#39;&gt;;
+        
+        my &#40;$real_make,$is_quoted&#41;;
+        if &#40;$make =~ /^&#40;[$quotes]&#41;&#40;.*&#41;\1$/&#41; {
+            &#40;$is_quoted,$real_make&#41; = &#40;$2,$1&#41;;
+        } else {
+            $real_make = $make;
+        };
+        
+        # This will maybe create bogus warnings on VMSish systems?
+        # Maybe this should use a real shell parser or something
+        # to determine which &#34;word&#34; is the &#40;path to&#41; the make program
+        if &#40;! -f $real_make &#38;&#38; $real_make =~ m![\\/:]!&#41; {
+            $res{ make } ||= [];
+            push @{$res{make}}, &#34;A path seems to be given in &gt;$make&lt; but the file was not found.&#34;;
+        };
+        if &#40;$make =~ /\s/ and not $is_quoted&#41; {
+            $res{ make } ||= [];
+            push @{$res{make}}, &lt;&lt;MAKE_HAS_WHITESPACE;
+&gt;$make&lt;
+seems to contain whitespace but is not quoted.
+This might be OK if there are additional commands you
+want to pass to your make utility. If you want to use
+&#34;$make&#34;
+as your make program, please add appropriate quotes
+to the line in Config.pm.
+MAKE_HAS_WHITESPACE
+        };
+    };
+    
+    %res;
+};
 
 package
     CPAN::Config; ####::###### #hide from indexer
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;02:30:04&nbsp;2006</span>
    <span class="description">ANDK [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;02:34:01&nbsp;2006</span>
    <span class="description">andreas.koenig.gmwojprw [...] franz.ak.mind.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17877] CPAN should warn if CPAN::Config contains problematic entries</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Feb 2006 08:33:42 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> andreas.koenig.gmwojprw [...] franz.ak.mind.de &#40;Andreas J. Koenig&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; On Mon, 27 Feb 2006 10:52:46 -0500 &#40;EST&#41;, &#34;Max Maischein via RT&#34; &lt;bug-CPAN@rt.cpan.org&gt; said:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; Mon Feb 27 10:52:44 2006: Request 17877 was acted upon.
  &gt; Transaction: Ticket created by CORION
  &gt;        Queue: CPAN
  &gt;      Subject: CPAN should warn if CPAN::Config contains problematic entries
  &gt;        Owner: Nobody
  &gt;   Requestors: CORION@cpan.org
  &gt;       Status: new
  &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17877">http://rt.cpan.org/Ticket/Display.html?id=17877</a></span> &gt;
</div>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; I have my make utility installed in a path with whitespace in it
  &gt; &#40;actually, Microsoft chose so and I stayed with the default&#41;.
  &gt; CPAN/FirstTime.pm adds $CPAN::Config-&gt;{make} as
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt;   &#39;make&#39; =&gt; q[C:\Programme\Microsoft Visual C++ Toolkit 2003\bin\nmake.EXE],
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; which later on causes problems with the shell interpolation.
</div>
Se also <span class="clickylink"><a target="new" rel="nofollow" href="http://perlmonks.org/?node_id=530600">http://perlmonks.org/?node_id=530600</a></span>. As I have no idea what
the various command shells on Windows do with and without quotes an
with different sorts of quotes, I was waiting or the man to fix this.
Thank you for dropping in:&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; Of course, the Grand Big Scheme will be to exorcise all shell
  &gt; interpolation and system&#40;STRING&#41; calls,
</div>
Which won&#39;t happen, because the user more or less already owns the
space before and after every command and may exploit any feature or
nonsense their shell exposes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; but the easy fix was to add appropriate quotes to my
  &gt; CPAN/Config.pm like this:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt;   &#39;make&#39; =&gt; q[&#34;C:\Programme\Microsoft Visual C++ Toolkit
  &gt; 2003\bin\nmake.EXE&#34;],
</div>
Good.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; I&#39;ve patched CPAN::HandleConfig to add a C&lt;sanity_check&gt; method which
  &gt; currently checks just that the C&lt;make&gt; entry is sane &#40;that is, exists,
  &gt; and if it contains whitespace, that it also has quotes at the start and
  &gt; end&#41;. See the attached diff against 1.87, and the attached test file to
  &gt; test it.
</div>
Thanks. Before I make any decisios I&#39;d like to find out if there is no
easier way out. My idea would be to add a _quotify_command method that
always does the right thing with all the commands in $CPAN::Config
before composing the shell command.

That would probably involve

  if it starts an ends with the same quote character: leave it as it is
  if it contains no whitespace: leave it as it is
  if it contains whitespace, then
    if it contains quotes: better leave it as it is
    else: quote it with the correct quote type for the box we&#39;re on

The whole thing would have to be guarded by a config variable
&#39;commands_quote&#39;: if set, we will use this quote character, if not set
or an empty string, we will guess the quoe character, an if set to an
ordinary space, we will not try to quote commands.

If this is feasible, hat would probably be the solution we should provide.

What do you think?

-- 
andreas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;02:34:13&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;02:40:18&nbsp;2006</span>
    <span class="description">andreas.koenig.gmwojprw [...] franz.ak.mind.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17877] CPAN should warn if CPAN::Config contains problematic entries</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Feb 2006 08:28:45 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> andreas.koenig.gmwojprw [...] franz.ak.mind.de &#40;Andreas J. Koenig&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; On Mon, 27 Feb 2006 10:52:46 -0500 &#40;EST&#41;, &#34;Max Maischein via RT&#34; &lt;bug-CPAN@rt.cpan.org&gt; said:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; Mon Feb 27 10:52:44 2006: Request 17877 was acted upon.
  &gt; Transaction: Ticket created by CORION
  &gt;        Queue: CPAN
  &gt;      Subject: CPAN should warn if CPAN::Config contains problematic entries
  &gt;        Owner: Nobody
  &gt;   Requestors: CORION@cpan.org
  &gt;       Status: new
  &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17877">http://rt.cpan.org/Ticket/Display.html?id=17877</a></span> &gt;
</div>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; I have my make utility installed in a path with whitespace in it
  &gt; &#40;actually, Microsoft chose so and I stayed with the default&#41;.
  &gt; CPAN/FirstTime.pm adds $CPAN::Config-&gt;{make} as
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt;   &#39;make&#39; =&gt; q[C:\Programme\Microsoft Visual C++ Toolkit 2003\bin\nmake.EXE],
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; which later on causes problems with the shell interpolation.
</div>
Se also <span class="clickylink"><a target="new" rel="nofollow" href="http://perlmonks.org/?node_id=530600">http://perlmonks.org/?node_id=530600</a></span>. As I have no idea what
the various command shells on Windows do with and without quotes an
with different sorts of quotes, I was waiting or the man to fix this.
Thank you for dropping in:&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; Of course, the Grand Big Scheme will be to exorcise all shell
  &gt; interpolation and system&#40;STRING&#41; calls,
</div>
Which won&#39;t happen, because the user more or less already owns the
space before and after every command and may exploit any feature or
nonsense their shell exposes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; but the easy fix was to add appropriate quotes to my
  &gt; CPAN/Config.pm like this:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt;   &#39;make&#39; =&gt; q[&#34;C:\Programme\Microsoft Visual C++ Toolkit
  &gt; 2003\bin\nmake.EXE&#34;],
</div>
Good.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; I&#39;ve patched CPAN::HandleConfig to add a C&lt;sanity_check&gt; method which
  &gt; currently checks just that the C&lt;make&gt; entry is sane &#40;that is, exists,
  &gt; and if it contains whitespace, that it also has quotes at the start and
  &gt; end&#41;. See the attached diff against 1.87, and the attached test file to
  &gt; test it.
</div>
Thanks. Before I make any decisios I&#39;d like to find out if there is no
easier way out. My idea would be to add a _quotify_command method that
always does the right thing with all the commands in $CPAN::Config
before composing the shell command.

That would probably involve

  if it starts an ends with the same quote character: leave it as it is
  if it contains no whitespace: leave it as it is
  if it contains whitespace, then
    if it contains quotes: better leave it as it is
    else: quote it with the correct quote type for the box we&#39;re on

The whole thing would have to be guarded by a config variable
&#39;commands_quote&#39;: if set, we will use this quote character, if not set
or an empty string, we will guess the quoe character, an if set to an
ordinary space, we will not try to quote commands.

If this is feasible, hat would probably be the solution we should provide.

What do you think?

-- 
andreas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;28&nbsp;22:51:33&nbsp;2006</span>
    <span class="description">ANDK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 1.87_51
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;28&nbsp;22:51:34&nbsp;2006</span>
    <span class="description">ANDK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
