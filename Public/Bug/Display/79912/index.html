<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79912 for Getopt-Long: auto_&#40;help|version&#41; exits when Getopt::Long::Parser is used</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79912 for Getopt-Long: auto_&#40;help|version&#41; exits when Getopt::Long::Parser is used</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Getopt-Long">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Getopt-Long">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Getopt-Long">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Getopt-Long">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Getopt-Long">Getopt-Long CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79912</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Getopt-Long">Getopt-Long</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jv [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
REHSACK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14678-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14679-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.39    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




debug-session1.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1124265/591437/debug-session1.txt">
Fri Sep 28 13:17:07 2012 (24.6k) by REHSACK [...] cpan.org
</a>
</font></li>
</ul>


getopt1.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1124265/591436/getopt1.pl">
Fri Sep 28 13:17:07 2012 (531b) by REHSACK [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=79912">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124090" href="/Public/Bug/Display.html?id=79912#txn-1124090">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;10:06:40&nbsp;2012</span>
    <span class="description">REHSACK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> auto_&#40;help|version&#41; exits when Getopt::Long::Parser is used</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124090/591400/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591400">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 617b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I debugged a strange behaviour while creating some scripts using
MooseX::App::Cmd and added a reaction to --help.

MooseX::App::Cmd::Command checks for --configfile parameter using a new
instance of Getopt::Long::Parser - and &#34;$opt_parser-&gt;getoptions&#40;
&#39;configfile=s&#39; =&gt; \$configfile &#41;;&#34; exits the current process because of
undefined default auto_help/auto_version and how GetOptionsFromArray&#40;&#41;
deals with those switches when they&#39;re not defined.

I suggest to switch to a lazy initialization of
$Getopt::Long::Parser::default_config to give developers a chance to
change their wanted defaults ...

Best regards,
Jens
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124100" href="/Public/Bug/Display.html?id=79912#txn-1124100">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;10:36:57&nbsp;2012</span>
    <span class="description">jv [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124100/591411/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591411">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 106b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry to hear this. Can you provide a small test program that shows this
behaviour, preferrably w/o Moose?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124102" href="/Public/Bug/Display.html?id=79912#txn-1124102">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;10:36:58&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124103" href="/Public/Bug/Display.html?id=79912#txn-1124103">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;10:37:43&nbsp;2012</span>
    <span class="description">jv [...] cpan.org -  Given to JV</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124265" href="/Public/Bug/Display.html?id=79912#txn-1124265">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;13:17:06&nbsp;2012</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Ricardo SIGNES &lt;rjbs [...] cpan.org&gt;, Mark Gardner &lt;mjgardner [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79912] auto_&#40;help|version&#41; exits when Getopt::Long::Parser is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 28 Sep 2012 19:16:47 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Getopt-Long [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jens Rehsack &lt;rehsack [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124265/591435/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591435">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 529b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 28.09.2012 16:36, Johan Vromans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79912">https://rt.cpan.org/Ticket/Display.html?id=79912</a></span> &gt;
&gt; 
&gt; Sorry to hear this. Can you provide a small test program that shows this
&gt; behaviour, preferrably w/o Moose?
</div>
For sure - see attachement.

I&#39;m sorry blaming Getopt::Long - but removing usage of GLD from test
program restores expected behaviour. OTOH I couldn&#39;t find something in
GLD which explains the premature exit &#40;via HelpMessage&#40;&#41;&#41;.

Maybe GLD has to used from MX::App::Cmd with some flags?

Best regards,
Jens
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124265/591436/getopt1.pl">Download getopt1.pl</a><br />
<span class="downloadcontenttype">text/x-perl 531b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124265/591437/debug-session1.txt">Download debug-session1.txt</a><br />
<span class="downloadcontenttype">text/plain 24.6k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124370" href="/Public/Bug/Display.html?id=79912#txn-1124370">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;16:07:08&nbsp;2012</span>
    <span class="description">jvromans [...] squirrel.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79912] auto_&#40;help|version&#41; exits when  Getopt::Long::Parser is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 28 Sep 2012 22:06:57 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Getopt-Long [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Johan Vromans &lt;jvromans [...] squirrel.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124370/591500/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591500">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[Quoting Jens Rehsack via RT, on September 28 2012, 13:17, in &#34;Re: [rt.cpan.org #79&#34;]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m sorry blaming Getopt::Long - but removing usage of GLD from test
&gt; program restores expected behaviour. OTOH I couldn&#39;t find something in
&gt; GLD which explains the premature exit &#40;via HelpMessage&#40;&#41;&#41;.
</div>
While, in fact, GLD is -- unknowingly -- the reason that it fails.

GLD does:

  use Getopt::Long 2.33 &#40;&#41;;

The above &#39;use&#39; registers that GL version 2.33 was required.
Subsequence use of GetOptions will use this knowledge to enable the
autohelp facility.

As a consequence, in the test program:

    local @ARGV = qw&#40;--help&#41;; # simulate behavior of MooseX::App::Cmd::Command
    my $parser2 = Getopt::Long::Parser-&gt;new&#40; config =&gt; [&#39;pass_through&#39;] &#41;;
    $parser2-&gt;getoptions&#40; &#39;configfile=s&#39; =&gt; \$configfile &#41;;

Since @ARGV is --help, GL calls its HelpMessage function. This calls
pod2usage which prints nothing &#40;there&#39;s no documentation&#41; and exits.

The best solution is to explicitly disable autohelp in the parser setup:

    my $parser2 = Getopt::Long::Parser-&gt;new&#40; config =&gt; [&#39;pass_through&#39;,&#39;no_auto_help&#39;] &#41;;

Does this help?

-- Johan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124497" href="/Public/Bug/Display.html?id=79912#txn-1124497">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;08:36:45&nbsp;2012</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Ricardo SIGNES &lt;rjbs [...] cpan.org&gt;, Mark Gardner &lt;mjgardner [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79912] auto_&#40;help|version&#41; exits when Getopt::Long::Parser is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 29 Sep 2012 13:36:35 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Getopt-Long [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jens Rehsack &lt;rehsack [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124497/591564/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591564">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">2012/9/28 jvromans@squirrel.nl via RT &lt;bug-Getopt-Long@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79912">https://rt.cpan.org/Ticket/Display.html?id=79912</a></span> &gt;
&gt;
&gt; [Quoting Jens Rehsack via RT, on September 28 2012, 13:17, in &#34;Re: [rt.cpan.org #79&#34;]
<div class="message-stanza open">&gt;&gt; I&#39;m sorry blaming Getopt::Long - but removing usage of GLD from test
&gt;&gt; program restores expected behaviour. OTOH I couldn&#39;t find something in
&gt;&gt; GLD which explains the premature exit &#40;via HelpMessage&#40;&#41;&#41;.
</div>&gt;
&gt; While, in fact, GLD is -- unknowingly -- the reason that it fails.
&gt;
&gt; GLD does:
&gt;
&gt;   use Getopt::Long 2.33 &#40;&#41;;
&gt;
&gt; The above &#39;use&#39; registers that GL version 2.33 was required.
&gt; Subsequence use of GetOptions will use this knowledge to enable the
&gt; autohelp facility.
</div>
Well, it shouldn&#39;t be possible for a module to override program settings
undesignedly. There is probably more than one way to reach that, but I
hope you find a way suitable for Getopt::Long. Probably once initialized
config doesn&#39;t become overwritten but extended/modified? Like attributes
in Moose which have 2 information: is_set/is_clear and their value - even
if the value is undefined ...

Is there anything which can be recommended to Ricardo to prevent that
behaviour in
Getopt::Long when GLD is initialized?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As a consequence, in the test program:
&gt;
&gt;     local @ARGV = qw&#40;--help&#41;; # simulate behavior of MooseX::App::Cmd::Command
&gt;     my $parser2 = Getopt::Long::Parser-&gt;new&#40; config =&gt; [&#39;pass_through&#39;] &#41;;
&gt;     $parser2-&gt;getoptions&#40; &#39;configfile=s&#39; =&gt; \$configfile &#41;;
&gt;
&gt; Since @ARGV is --help, GL calls its HelpMessage function. This calls
&gt; pod2usage which prints nothing &#40;there&#39;s no documentation&#41; and exits.
&gt;
&gt; The best solution is to explicitly disable autohelp in the parser setup:
&gt;
&gt;     my $parser2 = Getopt::Long::Parser-&gt;new&#40; config =&gt; [&#39;pass_through&#39;,&#39;no_auto_help&#39;] &#41;;
&gt;
&gt; Does this help?
</div>
You recommend the same this I extended in my bug-report to MooseX::App::Cmd &#40;see
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mjgardner/moosex-app-cmd/issues&#41;">https://github.com/mjgardner/moosex-app-cmd/issues&#41;</a></span>. Hope that Mark
reacts quickly.
For the moment, I&#39;ve added a patch to my local pkgsrc checkout, where
all my used
modules are installed from ...

... one &#34;tiny&#34; issue and finally work packages for 4 people - nice example how
good CPAN authors collaborate.

Thanks Johan.

Best regards,
Jens
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124499" href="/Public/Bug/Display.html?id=79912#txn-1124499">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;08:53:23&nbsp;2012</span>
    <span class="description">jvromans [...] squirrel.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79912] auto_&#40;help|version&#41; exits when  Getopt::Long::Parser is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 29 Sep 2012 14:53:12 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Getopt-Long [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Johan Vromans &lt;jvromans [...] squirrel.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124499/591566/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591566">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[Quoting Jens Rehsack via RT, on September 29 2012, 08:36, in &#34;Re: [rt.cpan.org #79&#34;]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, it shouldn&#39;t be possible for a module to override program
&gt; settings undesignedly.
</div>
Yes, this is an unfortunate sideeffect from using the required version
number as a signal to do something. It seemed a good idea &#40;actually,
the least bad&#41; idea at the time...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there anything which can be recommended to Ricardo to prevent that
&gt; behaviour in
&gt; Getopt::Long when GLD is initialized?
</div>
Your test program is a bit tricky.

  use Getopt::Long qw&#40;:config no_auto_help no_version &#41;;
  use Getopt::Long::Descriptive &#40;&#41;;

By using :config no_auto_help no_version you assume that the available
GL is of version 2.33 or higher.

GLD explicitly requires 2.33 or higher.

You can counter these with:

  use Getopt::Long 2.32 &#40;&#41;;

after use of GLD. But I&#39;m not sure that&#39;s always feasible.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ... one &#34;tiny&#34; issue and finally work packages for 4 people - nice
&gt; example how good CPAN authors collaborate.
</div>
I&#39;m sorry for the inconvenience. 

-- Johan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124508" href="/Public/Bug/Display.html?id=79912#txn-1124508">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;09:46:08&nbsp;2012</span>
    <span class="description">rehsack [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Ricardo SIGNES &lt;rjbs [...] cpan.org&gt;, Mark Gardner &lt;mjgardner [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79912] auto_&#40;help|version&#41; exits when Getopt::Long::Parser is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 29 Sep 2012 14:45:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Getopt-Long [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jens Rehsack &lt;rehsack [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124508/591569/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591569">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">2012/9/29 jvromans@squirrel.nl via RT &lt;bug-Getopt-Long@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79912">https://rt.cpan.org/Ticket/Display.html?id=79912</a></span> &gt;
&gt;
&gt; [Quoting Jens Rehsack via RT, on September 29 2012, 08:36, in &#34;Re: [rt.cpan.org #79&#34;]
<div class="message-stanza open">&gt;&gt; Well, it shouldn&#39;t be possible for a module to override program
&gt;&gt; settings undesignedly.
</div>&gt;
&gt; Yes, this is an unfortunate sideeffect from using the required version
&gt; number as a signal to do something. It seemed a good idea &#40;actually,
&gt; the least bad&#41; idea at the time...
&gt;
<div class="message-stanza open">&gt;&gt; Is there anything which can be recommended to Ricardo to prevent that
&gt;&gt; behaviour in
&gt;&gt; Getopt::Long when GLD is initialized?
</div>&gt;
&gt; Your test program is a bit tricky.
&gt;
&gt;   use Getopt::Long qw&#40;:config no_auto_help no_version &#41;;
&gt;   use Getopt::Long::Descriptive &#40;&#41;;
&gt;
&gt; By using :config no_auto_help no_version you assume that the available
&gt; GL is of version 2.33 or higher.
&gt;
&gt; GLD explicitly requires 2.33 or higher.
&gt;
&gt; You can counter these with:
&gt;
&gt;   use Getopt::Long 2.32 &#40;&#41;;
&gt;
&gt; after use of GLD. But I&#39;m not sure that&#39;s always feasible.
</div>
Unfortunately not. This happens between &#40;command-&#41;plugins loading and
Moose-Magic to initialize attributes from CLI and configfile.

MooseX::App::Cmd should explicitly tell GL::Parser not to auto_ anything ...
while digging for configfile option behind the scenes ...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; ... one &#34;tiny&#34; issue and finally work packages for 4 people - nice
&gt;&gt; example how good CPAN authors collaborate.
</div>&gt;
&gt; I&#39;m sorry for the inconvenience.
</div>
Well, I meant it really positive. Thanks to CPAN we have the opportunity to
talk about found issues and fix them and spread all necessary fixes over
all affected modules. Try it for any other environment ...

/Jens
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1202253" href="/Public/Bug/Display.html?id=79912#txn-1202253">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;15&nbsp;03:11:24&nbsp;2013</span>
    <span class="description">rjbs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1202253/634739/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/634739">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 665b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jens:

We spoke about this bug in Lancaster, and I tried to reproduce it using the getopt1.pl program you used.  It produces the same output on my machine whether or not I remove the Getopt::Long::Descriptive line.  That output is &#34;Hello world&#34;

I have installed Getopt::Long 2.39 and GLD 0.093.

I know about the behavior of -&gt;VERSION in Getopt::Long, and understand how a bug like the one you described *could* happen, but I can&#39;t reproduce this specific failure, so I have no specific failure to look at addressing for you.

If you can provide further instructions for testing or reproducing the bug you describe, I will happily dig into them.  Thanks!

-- 
rjbs
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1202261" href="/Public/Bug/Display.html?id=79912#txn-1202261">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;15&nbsp;03:35:48&nbsp;2013</span>
    <span class="description">jv [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1202261/634742/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/634742">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 53b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">One of the minor changes in 2.39 may have fixed this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1472534" href="/Public/Bug/Display.html?id=79912#txn-1472534">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;18:14:09&nbsp;2015</span>
    <span class="description">jv [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1472536" href="/Public/Bug/Display.html?id=79912#txn-1472536">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;18:14:10&nbsp;2015</span>
    <span class="description">jv [...] cpan.org -  Fixed in 2.39 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.469584</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
