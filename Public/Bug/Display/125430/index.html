<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #125430 for Math-BigInt: Math-BIgFloat fails with subclassing</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #125430 for Math-BigInt: Math-BIgFloat fails with subclassing</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-BigInt/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-BigInt/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-BigInt/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-BigInt/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-BigInt">Math-BigInt CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">125430</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-BigInt/Active/">Math-BigInt</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ylavoie [...] yveslavoie.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20500-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.999813    </td>
  </tr>
  <tr id="CF-20501-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;29&nbsp;22:51:07&nbsp;2018</span>
    <span class="description">ylavoie [...] yveslavoie.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math-BIgFloat fails with subclassing</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Subclassing Math::BigFloat prevents accuracy, precision, div_scale... if they haven&#39;t been overloaded.

The current implementation tries to access the internal values behind those getter by using the class of the calling object, assuming that it is either `Math::BigFloat` or that the parent have overloaded them and will manage to call `Math::BigFloat-&gt;accuracy&#40;&#41;` itself.

By default, non-overloaded function should default to the `Math::BigFloat` to ensure they will work and not return undefs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;30&nbsp;01:57:49&nbsp;2018</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is related to CPAN RT #78097: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78097">https://rt.cpan.org/Ticket/Display.html?id=78097</a></span>

I am aware of this problem. It is a result of the broken OO design in Math::BigInt, Math::BigFloat, Math::BigRat etc. It has been a problem since long before I took over as maintainer. I made a test implementation that fixes this problem, but it required a lot of changes across multiple modules. Fixing this would be nice, but that might break other modules that relies on the current behaviour, so I have been reluctant to fixing this.

I haven&#39;t decided whether the best thing is to fix Math::BigInt etc. or to create a new set of distributions, for instance Math::BigInt::OO, Math::BigFloat::OO etc.

Suggestions or recommendations are welcome!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;30&nbsp;01:57:50&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;30&nbsp;16:33:39&nbsp;2018</span>
    <span class="description">EHUELS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;m working with Yves on the LedgerSMB project which depends on Math::BigFloat being subclassable.

On Wed May 30 01:57:49 2018, pjacklam wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is related to CPAN RT #78097:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78097">https://rt.cpan.org/Ticket/Display.html?id=78097</a></span>
&gt; 
&gt; I am aware of this problem. It is a result of the broken OO design in
&gt; Math::BigInt, Math::BigFloat, Math::BigRat etc. It has been a problem
&gt; since long before I took over as maintainer.
</div>
[ snip ]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Suggestions or recommendations are welcome!
</div>
One suggestion I have is that you include the fact that Math::BigFloat can&#39;t be reliably subclassed as an explicit mention in <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Math::BigFloat#CAVEATS">https://metacpan.org/pod/Math::BigFloat#CAVEATS</a></span> ; if you mean to say that in the &#34;don&#39;t be clever&#34; section, then that&#39;s not what I&#39;m understanding from that paragraph. &#40;Actually, now that I&#39;m reading that paragraph again, I&#39;m not sure what it&#39;s telling me...&#41;


Regards,


Erik.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;30&nbsp;16:47:21&nbsp;2018</span>
    <span class="description">EHUELS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

[ snip ]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fixing this would be nice, but that
&gt; might break other modules that relies on the current behaviour, so I
&gt; have been reluctant to fixing this.
</div>
Can you clarify what you mean by &#34;relies on the current behaviour&#34;? I mean, the current behaviour is that subclasses don&#39;t work reliably, or at least that&#39;s how I read your response &#40;in combination with our analysis of the problem so far&#41;. Obviously, nobody can truely depend on the current behaviour as their subclasses won&#39;t work. What is the change in behaviour that you implemented that other modules may depend on?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I haven&#39;t decided whether the best thing is to fix Math::BigInt etc.
&gt; or to create a new set of distributions, for instance
&gt; Math::BigInt::OO, Math::BigFloat::OO etc.
&gt; 
&gt; Suggestions or recommendations are welcome!
</div>
In order to determine what &#34;other modules&#34; there are that might rely on the current behaviour, I&#39;ve queried the reverse-dependency-graph for Math::BigFloat on MetaCPAN &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/requires/module/Math::BigFloat?p=1&#38;size=100&#38;sort=%5B%5B2%2C1%5D%5D&#41;">https://metacpan.org/requires/module/Math::BigFloat?p=1&#38;size=100&#38;sort=%5B%5B2%2C1%5D%5D&#41;</a></span>.

It seems there are 48 public modules which depend on Math::BigFloat. This seems like a mnageable set of modules we can test against the change you have developed to see what happens when you change Math::BigFloat. I&#39;d be willing to help run the test frameworks of these modules and see what happens before and after the change you have for now, if you think that&#39;d be an acceptable estimate of the problems that are likely to ensue from your changes.

&#40;BTW, maybe I can help with more feedback if I can see the changes you&#39;re thinking of applying. Is there anywhere I can see the new version of the code?&#41;

Regards,


Erik.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;03&nbsp;07:25:20&nbsp;2018</span>
    <span class="description">EHUELS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Studying your test-suite, I&#39;m seeing that there&#39;s actually a test for subclassing Math::BigFloat. There&#39;s a crucial difference between that test and the documentation though: the subclass declared in the test suite declares some of the globals also declared in the original module &#40;but the requirement to do so, isn&#39;t documented&#41;:

from t/Math/BigFloat/Subclass.pm:

# Globals
$accuracy = $precision = undef;
$round_mode = &#39;even&#39;;
$div_scale = 40;


Although on one hand, there&#39;s an argument to be made for adding this to the documentation, every subclass should define them to work correctly.

If every subclass should start out with these values defined as the defaults, there&#39;s another way to address this issue &#40;which doesn&#39;t have the drawback of explicitly adding these variables to every subclass&#41;:

If the accessors &#34;round_mode&#34; and &#34;div_scale&#34; were changed to return &#39;even&#39; and 40 respectively, in case the value of the class-variables ${&#34;&lt;subclass&gt;::round_mode&#34;} and ${&#34;&lt;subclass&gt;::div_scale&#34;} respectively isn&#39;t defined --&gt; then a modified value can still be stored in the module, but no special declaration of these values will be required in the subclassing modules.


How&#39;s that for a solution?


Regards,

Erik.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
