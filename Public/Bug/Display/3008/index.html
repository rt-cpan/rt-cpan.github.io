<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #3008 for HTML-Scrubber: XSS in example configuration</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #3008 for HTML-Scrubber: XSS in example configuration</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTML-Scrubber/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTML-Scrubber/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTML-Scrubber/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTML-Scrubber/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTML-Scrubber">HTML-Scrubber CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">3008</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTML-Scrubber/Active/">HTML-Scrubber</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
nick [...] cleaton.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-15922-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.03    </td>
  </tr>
  <tr id="CF-15923-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;14:43:53&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XSS in example configuration</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">HTML::Scrubber 0.03, tested under perl 5.008 on FreeBSD

The sample configuration in the docs with HTML::Scrubber 0.03 is vulnerable to the following cross site scripting constructs:

           &lt;br style=&#34;width: expression&#38;#40;alert&#38;#40;&#41;&#41;&#34;&gt;

... and others, e.g. the xml* attributes that some versions of IE accept.

Suggested fix: give a whitelist based example with &#39;*&#39; =&gt; 0 for both tags and attributes and have a list of safe tags and a list of safe attributes.

           &lt;a href=&#34;javasc&#38;#9;ript:alert&#40;1&#41;&#34;&gt;asdf&lt;/a&gt;

... because both Netscape and IE will accept whitespace characters other than space in between the letters of the word &#39;javascript&#39;.  

           &lt;a href=&#34;vbscript:yada yada yada&#34;&gt;asdf&lt;/a&gt;

... there is &#39;about&#39; as well as &#39;vbscript&#39;, and probably others.  See <span class="clickylink"><a target="new" rel="nofollow" href="http://www.securityfocus.com/archive/1/249779">http://www.securityfocus.com/archive/1/249779</a></span> for some more examples.

Suggested fix: change the regular expression from:

   qr{^&#40;?!&#40;?:java&#41;?script&#41;}i

to:

   qr{^&#40;?:http|https|ftp&#41;://}i
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;15:47:13&nbsp;2003</span>
    <span class="description">PODMASTER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t think I should.
All the HTML::Scrubber documentation is supposed to do
is show you how to use HTML::Scrubber.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; HTML::Scrubber 0.03, tested under perl 5.008 on FreeBSD
&gt; 
&gt; The sample configuration in the docs with HTML::Scrubber 0.03 is
&gt; vulnerable to the following cross site scripting constructs:
&gt; 
&gt;            &lt;br style=&#34;width: expression&#38;#40;alert&#38;#40;&#41;&#41;&#34;&gt;
&gt; 
&gt; ... and others, e.g. the xml* attributes that some versions of IE
&gt; accept.
&gt; 
&gt; Suggested fix: give a whitelist based example with &#39;*&#39; =&gt; 0 for both
&gt; tags and attributes and have a list of safe tags and a list of safe
&gt; attributes.
&gt; 
&gt;            &lt;a href=&#34;javasc&#38;#9;ript:alert&#40;1&#41;&#34;&gt;asdf&lt;/a&gt;
&gt; 
&gt; ... because both Netscape and IE will accept whitespace characters
&gt; other than space in between the letters of the word &#39;javascript&#39;.
&gt; 
&gt;            &lt;a href=&#34;vbscript:yada yada yada&#34;&gt;asdf&lt;/a&gt;
&gt; 
&gt; ... there is &#39;about&#39; as well as &#39;vbscript&#39;, and probably others.  See
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.securityfocus.com/archive/1/249779">http://www.securityfocus.com/archive/1/249779</a></span> for some more examples.
&gt; 
&gt; Suggested fix: change the regular expression from:
&gt; 
&gt;    qr{^&#40;?!&#40;?:java&#41;?script&#41;}i
&gt; 
&gt; to:
&gt; 
&gt;    qr{^&#40;?:http|https|ftp&#41;://}i
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;15:47:14&nbsp;2003</span>
    <span class="description">PODMASTER [...] cpan.org -  Status changed from &#39;new&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;17:39:54&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 22 15:47:13 2003, PODMASTER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t think I should.
&gt; All the HTML::Scrubber documentation is supposed to do
&gt; is show you how to use HTML::Scrubber.
</div>
I agree with the suggestion. The current example looks like it would
prevent the use of JavaScript calls, but apparently it does not. The
suggested update to the RegEx illustrates the API just as well, we&#39;ll
demonstrating a better security practice. I see no drawbacks in making
the recommended change. 

   Mark


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; HTML::Scrubber 0.03, tested under perl 5.008 on FreeBSD
&gt; &gt; 
&gt; &gt; The sample configuration in the docs with HTML::Scrubber 0.03 is
&gt; &gt; vulnerable to the following cross site scripting constructs:
&gt; &gt; 
&gt; &gt;            &lt;br style=&#34;width: expression&#38;#40;alert&#38;#40;&#41;&#41;&#34;&gt;
&gt; &gt; 
&gt; &gt; ... and others, e.g. the xml* attributes that some versions of IE
&gt; &gt; accept.
&gt; &gt; 
&gt; &gt; Suggested fix: give a whitelist based example with &#39;*&#39; =&gt; 0 for both
&gt; &gt; tags and attributes and have a list of safe tags and a list of safe
&gt; &gt; attributes.
&gt; &gt; 
&gt; &gt;            &lt;a href=&#34;javasc&#38;#9;ript:alert&#40;1&#41;&#34;&gt;asdf&lt;/a&gt;
&gt; &gt; 
&gt; &gt; ... because both Netscape and IE will accept whitespace characters
&gt; &gt; other than space in between the letters of the word &#39;javascript&#39;.
&gt; &gt; 
&gt; &gt;            &lt;a href=&#34;vbscript:yada yada yada&#34;&gt;asdf&lt;/a&gt;
&gt; &gt; 
&gt; &gt; ... there is &#39;about&#39; as well as &#39;vbscript&#39;, and probably others.  See
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.securityfocus.com/archive/1/249779">http://www.securityfocus.com/archive/1/249779</a></span> for some more examples.
&gt; &gt; 
&gt; &gt; Suggested fix: change the regular expression from:
&gt; &gt; 
&gt; &gt;    qr{^&#40;?!&#40;?:java&#41;?script&#41;}i
&gt; &gt; 
&gt; &gt; to:
&gt; &gt; 
&gt; &gt;    qr{^&#40;?:http|https|ftp&#41;://}i
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;17:39:55&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;16:28:25&nbsp;2012</span>
    <span class="description">nigel.metheringham [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Updated documentation
  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/nigelm/html-">https://github.com/nigelm/html-</a></span>
scrubber/commit/e281c77e07a30ca61635b9b6672291ea25859e87
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;16:28:26&nbsp;2012</span>
    <span class="description">nigel.metheringham [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
