<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21213 for FSA-Rules: FSA::Rules PERL module *possible* bug</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21213 for FSA-Rules: FSA::Rules PERL module *possible* bug</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/FSA-Rules/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/FSA-Rules/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/FSA-Rules/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/FSA-Rules/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/theory/fsa-rules/issues/">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/FSA-Rules">FSA-Rules CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21213</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/FSA-Rules/Active/">FSA-Rules</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
khalilhaddad [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-13856-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.10    </td>
  </tr>
  <tr id="CF-13857-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.26    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;28&nbsp;19:36:09&nbsp;2006</span>
    <span class="description">khalilhaddad [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> FSA::Rules PERL module *possible* bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2006 01:35:56 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-fsa-rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Khalil Haddad&#34; &lt;khalilhaddad [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello

First off, thank you for your fantastic work on FSA::Rules, been using it
for a couple of days and I just love it, simple yet powerful !

Sorry if this is not in a proper bug report format, I very rarely submit
bugs, as I rarely find any !

Now to the little problem I have :
I tried to build states under the static pragma. I did make sure that only
one rule can match during a switch at any given time. But I always get the
exception telling me that multiple rules are found. I might be completely
off and misunderstood a basic concept, I apologize in advance if this is the
case!

Here are my states &#40;the interesting bit&#41; :

my $fsa = FSA::Rules-&gt;new&#40;
        { strict =&gt; 1, },

    ### init ###
        init =&gt; {
            label            =&gt; &#39;Init&#39;,
            do                =&gt; sub {
                                            my $state = shift;
                                            $state-&gt;machine-&gt;{loginretries}
= 0;
                                            print &#34;I am ready to work,
Master\n&#34;;
            },
            rules            =&gt; [ login =&gt; 1, ],
        },

    ### login ###
        login =&gt; {
            label            =&gt; &#39;Can I Login?&#39;,
            on_enter    =&gt; sub { print &#34;&lt;*&gt; Login step start\n&#34;; },
            do                =&gt; sub {
                                            my $state = shift;
                                            $state-&gt;result&#40;0&#41;;
                                            $state-&gt;machine-&gt;{loginretries}
++;
                                            do_login&#40;$site&#41;;
            },
            rules =&gt; [
                success        =&gt; {
                    rule        =&gt; sub {
                                            my $state = shift;
                                            $state-&gt;result == 1;
                    },
                    action    =&gt; sub { print &#34;&lt;**&gt; w00t login ok!\n&#34;; },
                    message    =&gt; &#39;login ok&#39;,
                },

                login =&gt; {
                    rule        =&gt; sub {
                                            my $state = shift;
                                            &#40;&#40;$state-&gt;result == 0&#41; &#38;&#38;
&#40;$state-&gt;machine-&gt;{loginretries} &lt;= $maxloginretries&#41;&#41;;
                    },
                    action    =&gt; sub { my $state = shift; my $nextstep =
shift; print &#34;&lt;**&gt; Trying to login again!
&#40;&#34;.$state-&gt;machine-&gt;{loginretries}.&#34;&#41;. So going to state:
&#34;.$nextstep-&gt;label.&#34;\n&#34;; },
                    message    =&gt; &#39;login repeat&#39;,
                },

                failure    =&gt; {
                    rule        =&gt; sub {
                                            my $state = shift;
                                            &#40;&#40;$state-&gt;result == 0&#41; &#38;&#38;
&#40;$state-&gt;machine-&gt;{loginretries} &gt; $maxloginretries&#41;&#41;;
                    },
                    action    =&gt; sub { my $state = shift; my $nextstep =
shift; print &#34;&lt;**&gt; Hmm damn, max tries reached, lets stop. So going to
state: &#34;.$nextstep-&gt;label.&#34;\n&#34;; },
                    message    =&gt; &#39;login nok&#39;,
                },

            ],
            on_exit        =&gt; sub { print &#34;&lt;*&gt; Login step done\n&#34;; },
        },
    ### end ###
        success =&gt; {
            label            =&gt; &#39;Success&#39;,
            do                =&gt; sub {
                                        my $state = shift;
                                        do_logout&#40;$site&#41;;
                                        $state-&gt;machine-&gt;done&#40;1&#41;;
            },
            on_exit        =&gt; sub { print &#34;Success! End.\n&#34;; },
        },
        failure =&gt; {
            label            =&gt; &#39;Failure&#39;,
            on_enter    =&gt; sub { print &#34;STATE FAILURE!!!!\n&#34;; },
            do                =&gt; sub {
                                        my $state = shift;
                                        #do_logout&#40;$site&#41;;
                                        $state-&gt;machine-&gt;done&#40;1&#41;;
            },
            rules            =&gt; [
                end        =&gt; 1,
            ],
            on_exit        =&gt; sub { print &#34;Failure! End.\n&#34;; },
        },
}

## TEST
sub do_login&#40;&#41; { print &#34;DOLOGIN\n&#34;; my $site = shift;
$FSAs-&gt;{$site}-&gt;curr_state-&gt;result&#40;0&#41;; }

This is a kind of ftp connection checking system. I run the FSA::Rules with
run and switch the state&#39;s result accordingly to the do_events I have
elswhere.

Without strict pragma, it obviously works as expected, the Failure is called
after 3 attempts and if the result slot is not set to 1. And as said before,
with strict, I get:
-&gt; Attempt to switch from state &#34;login&#34; improperly found multiple possible
destination states: &#34;login&#34;, &#34;failure&#34;

I tried to debut the switch and try_switch to understand how it checks the
rules under the strict pragma, but didn&#39;t quite understand the concept, I
kept seeing &#34;DUMMY&#34; subs.

If I understand correctly, a try_switch or switch will move to the next
state which has a matched rule, meaning that it will perform the current
action, on_exit, next on_start and do subs, and stop there is this correct ?

I am available on IRC if you prefer to discuss this furthermore.

Again thank you for your great work.

BR

Khalil Haddad
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;28&nbsp;19:49:42&nbsp;2006</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21213] FSA::Rules PERL module *possible* bug </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Aug 2006 16:49:24 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FSA-Rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Aug 28, 2006, at 16:36, Khalil Haddad via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Without strict pragma, it obviously works as expected, the Failure  
&gt; is called
&gt; after 3 attempts and if the result slot is not set to 1. And as  
&gt; said before,
&gt; with strict, I get:
&gt; -&gt; Attempt to switch from state &#34;login&#34; improperly found multiple  
&gt; possible
&gt; destination states: &#34;login&#34;, &#34;failure&#34;
</div>
Can you attach the script? The code got all mangled in Email, so it&#39;s  
hard to read.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tried to debut the switch and try_switch to understand how it  
&gt; checks the
&gt; rules under the strict pragma, but didn&#39;t quite understand the  
&gt; concept, I
&gt; kept seeing &#34;DUMMY&#34; subs.
</div>
Yes, Data::Dumper can&#39;t dump code references, so it just says &#34;DUMMY&#34;  
instead. Try using Data::Dump::Streamer, instead.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I understand correctly, a try_switch or switch will move to the  
&gt; next
&gt; state which has a matched rule, meaning that it will perform the  
&gt; current
&gt; action, on_exit, next on_start and do subs, and stop there is this  
&gt; correct ?
</div>
Yes, I believe that is corect.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am available on IRC if you prefer to discuss this furthermore.
</div>
Nick? Channel? Network? I&#39;m &#34;Theory&#34; on MagNet &#40;#perl&#41; and  
&#34;justatheory&#34; on freenode &#40;#postgresql&#41;.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;28&nbsp;19:49:43&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;04:17:41&nbsp;2006</span>
    <span class="description">khalilhaddad [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21213] FSA::Rules PERL module *possible* bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2006 10:17:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FSA-Rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Khalil Haddad&#34; &lt;khalilhaddad [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David,

Thank you for your quick reply, attached is the complete script.
I&#39;ll ping you tonight on IRC freenode.

Cheers!


On 8/29/06, David Wheeler via RT &lt;bug-FSA-Rules@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=21213">http://rt.cpan.org/Ticket/Display.html?id=21213</a></span> &gt;
&gt;
&gt; On Aug 28, 2006, at 16:36, Khalil Haddad via RT wrote:
&gt;
<div class="message-stanza open">&gt; &gt; Without strict pragma, it obviously works as expected, the Failure
&gt; &gt; is called
&gt; &gt; after 3 attempts and if the result slot is not set to 1. And as
&gt; &gt; said before,
&gt; &gt; with strict, I get:
&gt; &gt; -&gt; Attempt to switch from state &#34;login&#34; improperly found multiple
&gt; &gt; possible
&gt; &gt; destination states: &#34;login&#34;, &#34;failure&#34;
</div>&gt;
&gt; Can you attach the script? The code got all mangled in Email, so it&#39;s
&gt; hard to read.
&gt;
<div class="message-stanza open">&gt; &gt; I tried to debut the switch and try_switch to understand how it
&gt; &gt; checks the
&gt; &gt; rules under the strict pragma, but didn&#39;t quite understand the
&gt; &gt; concept, I
&gt; &gt; kept seeing &#34;DUMMY&#34; subs.
</div>&gt;
&gt; Yes, Data::Dumper can&#39;t dump code references, so it just says &#34;DUMMY&#34;
&gt; instead. Try using Data::Dump::Streamer, instead.
&gt;
<div class="message-stanza open">&gt; &gt; If I understand correctly, a try_switch or switch will move to the
&gt; &gt; next
&gt; &gt; state which has a matched rule, meaning that it will perform the
&gt; &gt; current
&gt; &gt; action, on_exit, next on_start and do subs, and stop there is this
&gt; &gt; correct ?
</div>&gt;
&gt; Yes, I believe that is corect.
&gt;
<div class="message-stanza open">&gt; &gt; I am available on IRC if you prefer to discuss this furthermore.
</div>&gt;
&gt; Nick? Channel? Network? I&#39;m &#34;Theory&#34; on MagNet &#40;#perl&#41; and
&gt; &#34;justatheory&#34; on freenode &#40;#postgresql&#41;.
&gt;
&gt; Best,
&gt;
&gt; David
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;12:25:03&nbsp;2006</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21213] FSA::Rules PERL module *possible* bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2006 09:24:46 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FSA-Rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Aug 29, 2006, at 01:17, Khalil Haddad via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you for your quick reply, attached is the complete script.
&gt; I&#39;ll ping you tonight on IRC freenode.
</div>
You found a bug! This script demonstrates it:

use strict;
use FSA::Rules;

my $i;
my $rules = FSA::Rules-&gt;new&#40;
     { strict =&gt; 1 },
     login =&gt; {
         do =&gt; sub {
             shift-&gt;notes&#40; num =&gt; ++$i &#41;;
         },
         rules =&gt; [
             login =&gt; sub {
                 shift-&gt;notes&#40;&#39;num&#39;&#41; &lt;= 2;
             },
             next  =&gt; sub {
                 shift-&gt;notes&#40;&#39;num&#39;&#41; &gt; 2;
             }
         ],
     },
     next =&gt; {}
&#41;;

$rules-&gt;run;

I never use strict myself, so I never would have run into it. The  
problem is that try_switch&#40;&#41; switches to the new state &#40;and therefore  
runs its do block&#41; before it checks the other states. I&#39;ll have to  
kick the guy who implemented that feature &#40;not me :-&#41;&#41;. I&#39;ll add the  
above as a test and then fix it and release a new version later today.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;12:49:26&nbsp;2006</span>
    <span class="description">khalilhaddad [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21213] FSA::Rules PERL module *possible* bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2006 18:49:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FSA-Rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Khalil Haddad&#34; &lt;khalilhaddad [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David,

Hmm great ! been trying to debug this for hours now unsuccessfully :&#41;

Now that you explain the problem, a simple counter in the state&#39;s do block
will break the try_switch design, given the order of the tests.

Keep us posted!


On 8/29/06, David Wheeler via RT &lt;bug-FSA-Rules@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=21213">http://rt.cpan.org/Ticket/Display.html?id=21213</a></span> &gt;
&gt;
&gt; On Aug 29, 2006, at 01:17, Khalil Haddad via RT wrote:
&gt;
<div class="message-stanza open">&gt; &gt; Thank you for your quick reply, attached is the complete script.
&gt; &gt; I&#39;ll ping you tonight on IRC freenode.
</div>&gt;
&gt; You found a bug! This script demonstrates it:
&gt;
&gt; use strict;
&gt; use FSA::Rules;
&gt;
&gt; my $i;
&gt; my $rules = FSA::Rules-&gt;new&#40;
&gt;      { strict =&gt; 1 },
&gt;      login =&gt; {
&gt;          do =&gt; sub {
&gt;              shift-&gt;notes&#40; num =&gt; ++$i &#41;;
&gt;          },
&gt;          rules =&gt; [
&gt;              login =&gt; sub {
&gt;                  shift-&gt;notes&#40;&#39;num&#39;&#41; &lt;= 2;
&gt;              },
&gt;              next  =&gt; sub {
&gt;                  shift-&gt;notes&#40;&#39;num&#39;&#41; &gt; 2;
&gt;              }
&gt;          ],
&gt;      },
&gt;      next =&gt; {}
&gt; &#41;;
&gt;
&gt; $rules-&gt;run;
&gt;
&gt; I never use strict myself, so I never would have run into it. The
&gt; problem is that try_switch&#40;&#41; switches to the new state &#40;and therefore
&gt; runs its do block&#41; before it checks the other states. I&#39;ll have to
&gt; kick the guy who implemented that feature &#40;not me :-&#41;&#41;. I&#39;ll add the
&gt; above as a test and then fix it and release a new version later today.
&gt;
&gt; Best,
&gt;
&gt; David
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;12:52:24&nbsp;2006</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21213] FSA::Rules PERL module *possible* bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2006 09:52:05 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FSA-Rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Aug 29, 2006, at 09:49, Khalil Haddad via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm great ! been trying to debug this for hours now unsuccessfully :&#41;
&gt;
&gt; Now that you explain the problem, a simple counter in the state&#39;s  
&gt; do block
&gt; will break the try_switch design, given the order of the tests.
</div>
Yep. I&#39;ve already fixed it in svn and will put it on CPAN in a few  
minutes.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;13:47:07&nbsp;2006</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21213] FSA::Rules PERL module *possible* bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2006 10:46:44 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FSA-Rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">FSA::Rules 0.26 is on its way to CPAN now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;17:49:58&nbsp;2006</span>
    <span class="description">khalilhaddad [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21213] FSA::Rules PERL module *possible* bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2006 23:49:44 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-FSA-Rules [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Khalil Haddad&#34; &lt;khalilhaddad [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Excellent, version 0.26 works as expected with strict mode.

Thank you for your quick fix!


On 8/29/06, David Wheeler via RT &lt;bug-FSA-Rules@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=21213">http://rt.cpan.org/Ticket/Display.html?id=21213</a></span> &gt;
&gt;
&gt; FSA::Rules 0.26 is on its way to CPAN now.
&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;22:18:09&nbsp;2006</span>
    <span class="description">dwheeler [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;22:18:47&nbsp;2006</span>
    <span class="description">dwheeler [...] cpan.org -  Severity Important added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;29&nbsp;22:18:47&nbsp;2006</span>
    <span class="description">dwheeler [...] cpan.org -  Broken in 0.10 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;31&nbsp;12:29:04&nbsp;2006</span>
    <span class="description">dwheeler [...] cpan.org -  Fixed in 0.26 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
