<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13877 for HTTP-Proxy: Allow buffers in filter_last</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13877 for HTTP-Proxy: Allow buffers in filter_last</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=HTTP-Proxy">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=HTTP-Proxy">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=HTTP-Proxy">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=HTTP-Proxy">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTTP-Proxy">HTTP-Proxy CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13877</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=HTTP-Proxy">HTTP-Proxy</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
chris+rt [...] chrisdolan.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-16366-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.15    </td>
  </tr>
  <tr id="CF-16367-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




HTTP-Proxy-0.16-patches.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/137936/40047/HTTP-Proxy-0.16-patches.zip">
Tue Sep 13 10:34:09 2005 (12k) by ccaroon [...] mcclatchyinteractive.com
</a>
</font></li>
</ul>


HTTP-Proxy-0.19-patches.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/190870/69088/HTTP-Proxy-0.19-patches.zip">
Fri Apr 28 16:01:09 2006 (8.6k) by Guest
</a>
</font></li>
</ul>


HTTP-Proxy.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/137934/38029/HTTP-Proxy.patch">
Tue Jul 26 16:01:30 2005 (1.1k) by ccaroon [...] mcclatchyinteractive.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=13877">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-137932" href="/Public/Bug/Display.html?id=13877#txn-137932">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;26&nbsp;15:07:00&nbsp;2005</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Allow buffers in filter_last</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/137932/38024/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38024">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m trying to implement HTTP::Proxy::BodyFilter::throttle and have hit a limitation of HTTP::Proxy.  My filter tries to emit a fixed maximum number of bytes per second.  It accomplishes this via the filter&#40;&#41; method by deferring some content to the buffer until enough time has passed &#40;using sleep&#40;&#41; perhaps&#41;.  However, when the proxy has received all of the upstream data, it no longer permits use of the buffer and requires the filter to finish immediately.

I request that a while&#40;&#41; loop be added around the filtering loop once the content is all received.  That while loop should continue until all of the buffers are flushed.

Something roughly like this would work &#40;untested&#41;:

sub filter_last {
    my $self = shift;
    return unless $self-&gt;{body};    # sanity check

    my $i = 0;
    my &#40; $data, $message, $protocol &#41; = @_;

    for &#40; @{ $self-&gt;{current} } &#41; {
        $$data = ${ $self-&gt;{buffers}[ $i ] } . $$data;
        ${ $self-&gt;{buffers}[ $i++ ] } = &#34;&#34;;
        $_-&gt;filter&#40; $data, $message, $protocol, undef &#41;;
    }

    # call the cleanup routine if needed
    for &#40; @{ $self-&gt;{current} } &#41; { $_-&gt;end if $_-&gt;can&#40;&#39;end&#39;&#41;; }

    # clean up the mess for next time
    $self-&gt;eod;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-137933" href="/Public/Bug/Display.html?id=13877#txn-137933">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;26&nbsp;15:11:13&nbsp;2005</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cdolan [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/137933/38025/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38025">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 706b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;oops hit return too soon in that last post&#41;

sub filter_last {
    my $self = shift;
    my $conn = shift;
    return unless $self-&gt;{body};    # sanity check

    my $i = 0;
    my &#40; $data, $message, $protocol &#41; = @_;
    while &#40;$$data ne &#34;&#34; &#38;&#38; grep&#40;{$_ ne &#34;&#34;} @{$self-&gt;{buffers}}&#41; &gt; 0&#41;
    {
        $self-&gt;filter&#40;$data, $message, $protocol&#41;;
        if &#40; length $data &#41; {
            if &#40;$chunked&#41; {
                printf $conn &#34;%x$CRLF%s$CRLF&#34;, length&#40;$data&#41;, $data;
            }
            else { print $conn $data; }
        }
    }

    # call the cleanup routine if needed
    for &#40; @{ $self-&gt;{current} } &#41; { $_-&gt;end if $_-&gt;can&#40;&#39;end&#39;&#41;; }

    # clean up the mess for next time
    $self-&gt;eod;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-137934" href="/Public/Bug/Display.html?id=13877#txn-137934">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;26&nbsp;16:01:30&nbsp;2005</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cdolan [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/137934/38028/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38028">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 122b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">And here&#39;s a working version &#40;attached&#41;.  It rather hackish, primarily
in its determination of $chunked, but functional.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/137934/38029/HTTP-Proxy.patch">Download HTTP-Proxy.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">sub filter_last
{
   my $self = shift;
   return unless $self-&gt;{body} &#38;&#38; $self-&gt;{current} &#38;&#38; @{$self-&gt;{current}} &gt; 0;
   
   my $conn = $self-&gt;{current}-&gt;[0]-&gt;proxy-&gt;client_socket;  # hack...
   my $chunked = $conn-&gt;proto_ge&#40;&#34;HTTP/1.1&#34;&#41;; # hack hack...
   my $CRLF = &#34;\015\012&#34;;                     # &#34;\r\n&#34; is not portable
   
   my &#40; $data, $message, $protocol &#41; = @_;
   while &#40;$$data ne &#34;&#34; &#38;&#38; grep&#40;{$_ ne &#34;&#34;} @{$self-&gt;{buffers}}&#41; &gt; 0&#41;
   {
      $self-&gt;filter&#40;$data, $message, $protocol&#41;;
      if &#40; length $data &#41; {
         if &#40;$chunked&#41; {
            printf $conn &#34;%x$CRLF%s$CRLF&#34;, length&#40;$data&#41;, $data;
         }
         else { print $conn $data; }
      }
   }
   
   # call the cleanup routine if needed
   for &#40; @{ $self-&gt;{current} } &#41; { $_-&gt;end if $_-&gt;can&#40;&#39;end&#39;&#41;; }
   
   # clean up the mess for next time
   $self-&gt;eod;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-137935" href="/Public/Bug/Display.html?id=13877#txn-137935">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;31&nbsp;17:42:13&nbsp;2005</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> book [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/137935/38225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38225">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 615b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[CDOLAN - Tue Jul 26 16:01:30 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And here&#39;s a working version &#40;attached&#41;.  It rather hackish, primarily
&gt; in its determination of $chunked, but functional.
&gt; 
</div>
Sorry for the delayed answer, and thanks for the request and the patch.
This is an interesting request, and I see how this feature could be
useful.

I&#39;m very short on time on the moment &#40;probably until september&#41;,
so don&#39;t expect this to appear soon in HTTP::Proxy. Version 0.16
should be out before YAPC::Europe &#40;end of august&#41;, but it includes
some other changes. I put your request on my TODO list, and will
try to find a way to implement this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-137936" href="/Public/Bug/Display.html?id=13877#txn-137936">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;13&nbsp;10:34:09&nbsp;2005</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cdolan [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/137936/40046/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/40046">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[BOOK - Sun Jul 31 17:42:13 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry for the delayed answer, and thanks for the request and the
&gt;    patch.
&gt; This is an interesting request, and I see how this feature could be
&gt; useful.
&gt; 
&gt; I&#39;m very short on time on the moment &#40;probably until september&#41;,
&gt; so don&#39;t expect this to appear soon in HTTP::Proxy. Version 0.16
&gt; should be out before YAPC::Europe &#40;end of august&#41;, but it includes
&gt; some other changes. I put your request on my TODO list, and will
&gt; try to find a way to implement this.
</div>

Philippe,

I&#39;ve built a more robust patch to implement this feature against
HTTP-Proxy v0.16.  The attached .zip file contains four files:

 * chunked.patch  - Encapsulated the &#34;print $conn&#34; statements:
                    all &#34;if &#40;$chunked&#41;&#34; tests are now in one place
 * booleans.patch - Changed $chunked, $sent and $last into properties
                    $self-&gt;chunked, $self-&gt;sent, $self-&gt;keepalive
 * filter_last.patch - Changed filter_last to emit incremental data
                       each iteration.  Changed the FilterStack 
                       constructor to take an HTTP::Proxy instance
 * overall.patch - All three of the above patches rolled into one


The filter_last.patch is what I was really trying to accomplish, but to
keep it from being too messy, I needed to encapsulate the output
routines.  That led to the chunked.patch and booleans.patch cleanup
effort.  The three patches must be applied in the order above, or
overall.patch can be used by itself.
  -- Chris
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/137936/40047/HTTP-Proxy-0.16-patches.zip">Download HTTP-Proxy-0.16-patches.zip</a><br />
<span class="downloadcontenttype">application/zip 12k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-137937" href="/Public/Bug/Display.html?id=13877#txn-137937">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;12&nbsp;13:03:53&nbsp;2005</span>
    <span class="description">cpan [...] clotho.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/137937/45666/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/45666">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Philippe,

Just a reminder that this patch is still available.  If you don&#39;t like
it, I&#39;d be happy to refactor.  As soon as this patch goes in, I&#39;m hoping
to release HTTP::Proxy::Throttle to make use of it.   Currently, that
unreleased module has a bunch of hacks into the HTTP::Proxy namespace...

Best wishes,
Chris

[CDOLAN - Tue Sep 13 10:34:09 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Philippe,
&gt; 
&gt; I&#39;ve built a more robust patch to implement this feature against
&gt; HTTP-Proxy v0.16.  The attached .zip file contains four files:
&gt; 
&gt;  * chunked.patch  - Encapsulated the &#34;print $conn&#34; statements:
&gt;                     all &#34;if &#40;$chunked&#41;&#34; tests are now in one place
&gt;  * booleans.patch - Changed $chunked, $sent and $last into properties
&gt;                     $self-&gt;chunked, $self-&gt;sent, $self-&gt;keepalive
&gt;  * filter_last.patch - Changed filter_last to emit incremental data
&gt;                        each iteration.  Changed the FilterStack 
&gt;                        constructor to take an HTTP::Proxy instance
&gt;  * overall.patch - All three of the above patches rolled into one
&gt; 
&gt; 
&gt; The filter_last.patch is what I was really trying to accomplish, but to
&gt; keep it from being too messy, I needed to encapsulate the output
&gt; routines.  That led to the chunked.patch and booleans.patch cleanup
&gt; effort.  The three patches must be applied in the order above, or
&gt; overall.patch can be used by itself.
&gt;   -- Chris
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190259" href="/Public/Bug/Display.html?id=13877#txn-190259">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;26&nbsp;10:10:10&nbsp;2006</span>
    <span class="description">cpan [...] clotho.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cdolan [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190259/68682/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/68682">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 173b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Philippe,

Should I update this patch for 0.18, or should we just close this bug as
&#34;REJECTED&#34;?

It&#39;s been about 8 months since I first started working on this...

Chris
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190260" href="/Public/Bug/Display.html?id=13877#txn-190260">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;26&nbsp;10:10:11&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190843" href="/Public/Bug/Display.html?id=13877#txn-190843">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;14:07:00&nbsp;2006</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/190843/69062/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69062">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 591b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 26 10:10:10 2006, CLOTHO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Philippe,
&gt; 
&gt; Should I update this patch for 0.18, or should we just close this bug as
&gt; &#34;REJECTED&#34;?
&gt; 
&gt; It&#39;s been about 8 months since I first started working on this...
&gt; 
&gt; Chris
</div>
I&#39;m sorry I haven&#39;t yet introduced your patch in HTTP::Proxy.

Release 0.18 was a quick release to close a few small bugs.
The upcoming release 0.19 &#40;on its way to CPAN as I write this&#41;
closes a few more small bugs.

Please send me an updated patch, and I promise I&#39;ll look at it
and introduce it the next release &#40;0.20&#41;.

Thanks for your patience,

Philippe
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190870" href="/Public/Bug/Display.html?id=13877#txn-190870">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;16:01:08&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cdolan [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/190870/69085/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69085">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 364b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached are my patches rebuilt against 0.19 instead of 0.16.  Luckily,
there was only one conflict, so it was easy.  Included are the three
individual patches and one overall patch that is the previous three
combined.

With this patch, one trivial test fails: a pod-coverage test for the
three boolean accessors I added.

Thanks for this very useful module.
Chris
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190870/69088/HTTP-Proxy-0.19-patches.zip">Download HTTP-Proxy-0.19-patches.zip</a><br />
<span class="downloadcontenttype">application/zip 8.6k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.609708</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
