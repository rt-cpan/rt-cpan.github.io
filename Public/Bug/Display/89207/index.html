<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #89207 for Net-SFTP-Foreign: rremove&#40;&#41; returns no error if directory doesn&#39;t exist</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #89207 for Net-SFTP-Foreign: rremove&#40;&#41; returns no error if directory doesn&#39;t exist</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-SFTP-Foreign">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-SFTP-Foreign">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-SFTP-Foreign">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-SFTP-Foreign">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SFTP-Foreign">Net-SFTP-Foreign CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">89207</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-SFTP-Foreign">Net-SFTP-Foreign</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">salva [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tmetro [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-23164-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23165-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=89207">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1270418" href="/Public/Bug/Display.html?id=89207#txn-1270418">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;02&nbsp;15:30:29&nbsp;2013</span>
    <span class="description">tmetro [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rremove&#40;&#41; returns no error if directory doesn&#39;t exist</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1270418/672713/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/672713">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I ran code like:

my $sftp = Net::SFTP::Foreign-&gt;new&#40;$host&#41;;
$sftp-&gt;error and die &#34;$host: failed to connect: &#34; . $sftp-&gt;error, &#34;\n&#34;;

my $dir = &#39;testx&#39;;
$sftp-&gt;rremove&#40;$dir&#41;;
$sftp-&gt;error and die &#34;$dir: rmdir failed: &#34; . $sftp-&gt;error, &#34;\n&#34;;

where directory &#39;testx&#39; doesn&#39;t exist, and no error was returned.

rremove&#40;&#41; documentation says, &#34;This method tries to recover and continue when some error happens.&#34; So the above behavior may be intentional. If the intent is to remove a directory, and it doesn&#39;t already exist, having that be a no error condition may be desirable, providing all other failures are reported. The documentation should be clarified. &#40;It would also be nice if you indicated whether this is a method you implemented using several SFTP primitives, or is it a supported SFTP command. I didn&#39;t check your source.&#41;

&#40;If this is the case, what can be done to intentionally trigger a removal error to test the error handling? A permissions change? I tried having it remove textx/foo after doing a &#39;chmod 000 testx&#39; and it still failed silently, so I think your error handling is buggy.&#41;

Documentation also says, &#34;Returns the number of elements successfully removed.&#34; So presumably I could check for a zero return value, but if I know the code is doing the right thing, I won&#39;t bother doing that. &#40;I was planning to use stat&#40;&#41; to test for the presence of the directory first, to handle that as a special case before calling rremove&#40;&#41;.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1270500" href="/Public/Bug/Display.html?id=89207#txn-1270500">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;02&nbsp;17:38:47&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1270500/672755/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/672755">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 02 15:30:29 2013, TMETRO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I ran code like:
&gt; 
&gt; my $sftp = Net::SFTP::Foreign-&gt;new&#40;$host&#41;;
&gt; $sftp-&gt;error and die &#34;$host: failed to connect: &#34; . $sftp-&gt;error,
&gt; &#34;\n&#34;;
&gt; 
&gt; my $dir = &#39;testx&#39;;
&gt; $sftp-&gt;rremove&#40;$dir&#41;;
&gt; $sftp-&gt;error and die &#34;$dir: rmdir failed: &#34; . $sftp-&gt;error, &#34;\n&#34;;
&gt; 
&gt; where directory &#39;testx&#39; doesn&#39;t exist, and no error was returned.
&gt; 
&gt; rremove&#40;&#41; documentation says, &#34;This method tries to recover and
&gt; continue when some error happens.&#34; So the above behavior may be
&gt; intentional. If the intent is to remove a directory, and it doesn&#39;t
&gt; already exist, having that be a no error condition may be desirable,
&gt; providing all other failures are reported. The documentation should be
&gt; clarified. &#40;It would also be nice if you indicated whether this is a
&gt; method you implemented using several SFTP primitives, or is it a
&gt; supported SFTP command. I didn&#39;t check your source.&#41;
&gt; 
&gt; &#40;If this is the case, what can be done to intentionally trigger a
&gt; removal error to test the error handling? A permissions change? I
&gt; tried having it remove textx/foo after doing a &#39;chmod 000 testx&#39; and
&gt; it still failed silently, so I think your error handling is buggy.&#41;
</div>
On recursive methods, the way to handle errors is using the on_error callback.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Documentation also says, &#34;Returns the number of elements successfully
&gt; removed.&#34; So presumably I could check for a zero return value, but if
&gt; I know the code is doing the right thing, I won&#39;t bother doing that.
&gt; &#40;I was planning to use stat&#40;&#41; to test for the presence of the
&gt; directory first, to handle that as a special case before calling
&gt; rremove&#40;&#41;.&#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1270501" href="/Public/Bug/Display.html?id=89207#txn-1270501">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;02&nbsp;17:38:47&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1270503" href="/Public/Bug/Display.html?id=89207#txn-1270503">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;02&nbsp;17:38:47&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1270791" href="/Public/Bug/Display.html?id=89207#txn-1270791">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;03&nbsp;12:40:26&nbsp;2013</span>
    <span class="description">tmetro [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tmetro [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1270791/672903/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/672903">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 02 17:38:47 2013, SALVA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On recursive methods, the way to handle errors is using the on_error
&gt; callback.
</div>
And elsewhere you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The methods accepting the on_error handler are those that may perform several 
&gt; operations that may fail individually without aborting the main method. 
&gt; Specifically, IIRC, that means recursive and glob&#39;ing methods.
</div>
This is not at all apparent from your documentation. So if not a code bug, its a documentation bug.

That aside, I&#39;m not following the logic here. You&#39;re saying for any method that aggregates together multiple SFTP primitives, you can only catch errors if you use the on_error handler?

Error handlers should be optional for users who want more fine-grained control of the error handling. It should give the user the option to intercept and choose to ignore specific errors.

If the error handler is not used &#40;or returns whatever the normal return code is for not ignoring an error&#41;, then the method by default should do the right thing and trap the error and return an error indication in a way consistent with the rest of the methods in the module.

Take rremove&#40;&#41; for example: there are really no errors it should be ignoring by default, other than the absence of the directory it was asked to remove, and even that is arguably an error condition. Everything else should cause an error exit from the method. &#40;What errors do you think are suitable to ignore?&#41;

The whole freedom you &#40;as a module author&#41; gain from offering an error handler option is that you can implement error handling that does the expected thing for most users, and be confident that for the few who want different behavior, they can use the handler to implement it. If most users need to use the handler to get typically needed behavior, then the implementation is not ideal.

It hardly seems likely that no error checking at all should be the default for any aggregate method.

&#40;And no, &#34;it is too late to change the module API&#34; is not a good answer. :-&#41; Appropriate sometimes, but if that always applied, modules would never be improved, other than to fix egregious bugs.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1271045" href="/Public/Bug/Display.html?id=89207#txn-1271045">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;04&nbsp;05:22:12&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1271045/673056/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/673056">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">El Jue Oct 03 12:40:26 2013, TMETRO escribió:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Oct 02 17:38:47 2013, SALVA wrote:
<div class="message-stanza open">&gt; &gt; On recursive methods, the way to handle errors is using the on_error
&gt; &gt; callback.
</div>&gt; 
&gt; And elsewhere you wrote:
<div class="message-stanza open">&gt; &gt; The methods accepting the on_error handler are those that may perform
&gt; &gt; several
&gt; &gt; operations that may fail individually without aborting the main
&gt; &gt; method.
&gt; &gt; Specifically, IIRC, that means recursive and glob&#39;ing methods.
</div>&gt; 
&gt; This is not at all apparent from your documentation. So if not a code
&gt; bug, its a documentation bug.
&gt; 
&gt; That aside, I&#39;m not following the logic here. You&#39;re saying for any
&gt; method that aggregates together multiple SFTP primitives, you can only
&gt; catch errors if you use the on_error handler?
&gt; 
&gt; Error handlers should be optional for users who want more fine-grained
&gt; control of the error handling. It should give the user the option to
&gt; intercept and choose to ignore specific errors.
&gt;
&gt; If the error handler is not used &#40;or returns whatever the normal
&gt; return code is for not ignoring an error&#41;, then the method by default
&gt; should do the right thing and trap the error and return an error
&gt; indication in a way consistent with the rest of the methods in the
&gt; module.
</div>
That makes sense, it may be useful.

On the other hand, I am not sure I like the idea of dual methods that behave differently when &#34;on_error&#34; is passed or not. It doesn&#39;t seem obvious.

I would have to think about it.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;And no, &#34;it is too late to change the module API&#34; is not a good
&gt; answer. :-&#41; Appropriate sometimes, but if that always applied, modules
&gt; would never be improved, other than to fix egregious bugs.&#41;
</div>
The API can be changed when there is a good reason, I just refuse to change it for trivial things.

I&#39;m leaving this ticket open for now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1271047" href="/Public/Bug/Display.html?id=89207#txn-1271047">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;04&nbsp;05:22:13&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1271048" href="/Public/Bug/Display.html?id=89207#txn-1271048">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;04&nbsp;05:22:13&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1271057" href="/Public/Bug/Display.html?id=89207#txn-1271057">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;04&nbsp;05:23:28&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1271058" href="/Public/Bug/Display.html?id=89207#txn-1271058">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;04&nbsp;05:23:28&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Broken in 1.75 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1271187" href="/Public/Bug/Display.html?id=89207#txn-1271187">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;04&nbsp;13:40:20&nbsp;2013</span>
    <span class="description">tmetro [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tmetro [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1271187/673137/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/673137">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 04 05:22:12 2013, SALVA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; El Jue Oct 03 12:40:26 2013, TMETRO escribió:
<div class="message-stanza open">&gt; &gt; If the error handler is not used &#40;or returns whatever the normal
&gt; &gt; return code is for not ignoring an error&#41;, then the method by default
&gt; &gt; should do the right thing and trap the error and return an error
&gt; &gt; indication in a way consistent with the rest of the methods in the
&gt; &gt; module.
</div>&gt; 
&gt; That makes sense, it may be useful.
&gt; I would have to think about it.
</div>
Thanks for considering it.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On the other hand, I am not sure I like the idea of dual methods that
&gt; behave differently when &#34;on_error&#34; is passed or not. It doesn&#39;t seem
&gt; obvious.
</div>
&#34;Behave differently&#34; is entirely up to the author of the on_error handler. More typically, an API using an error handler subroutine will look at the return code from the handler &#40;if it does return&#41; and use one value to signify proceeding normally with the default error handling behavior, and another value to signify short circuiting.

So if I write:

    $sftp-&gt;rremove&#40;&#39;testx/foo&#39;,
        on_error =&gt; sub {
            my $sftp = shift;
            my $obj = shift || {};
            my $file = $obj-&gt;{filename} || &#39;&lt;unknown&gt;&#39;;
            warn &#34;$file: &#34; . $sftp-&gt;error . &#34;\n&#34;;
            return 1;
        }
    &#41;;

my warning will get printed, and normal error handling happens. &#40;In this case, there is no behavior change in rremove&#40;&#41;.&#41;

While if I end that with &#39;return undef&#39; it will cause the default error code in rremove&#40;&#41; to be skipped and the method will return immediately with an error status &#40;whatever is consistent for your API&#41;.

This sort of an API is quite common.

While that&#39;s most flexible, it&#39;s also OK to support a simpler form, where the user has to throw an exception to bail out. So to get the &#34;normal&#34; behavior I wanted from rremove&#40;&#41;, I used:

    $sftp-&gt;rremove&#40;&#39;testx/foo&#39;,
        on_error =&gt; sub {
            my $sftp = shift;
            my $obj = shift || {};
            my $file = $obj-&gt;{filename} || &#39;&lt;unknown&gt;&#39;;
            die &#34;$file: &#34; . $sftp-&gt;error . &#34;\n&#34;;
        }
    &#41;;

and that indeed works:

testx/foo: Couldn&#39;t stat remote link: Permission denied


I would be less concerned with the potential for on_error to alter behavior and more concerned that rremove&#40;&#41; and other aggregate functions are inconsistent from the rest of your API in that they don&#39;t return error conditions by default.


Related to this, I noticed a few documentation bugs:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $sftp-&gt;rremove&#40;\@dirs, %opts&#41;
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    on_error =&gt; sub { ... }
&gt;        This callback is called when some error is occurs. The arguments 
&gt;        passed are the $sftp object and the current entry &#40;see ls docs for 
&gt;        more information&#41;.
</div>
It appears ls&#40;&#41; is not documented as accepting on_error. Did you mean find&#40;&#41;, which appears to give the most details on on_error? &#40;The docs for glob&#40;&#41; also reference ls instead of find&#40;&#41;.&#41;

You might want to flesh out the documentation for on_error in one spot, and consistently point to it from all the others &#40;if the API is identical&#41;. &#40;Some methods currently have a one or two sentence definition for on_error.&#41;

The definition should also cover what is passed as the 2nd parameter &#40;partially explained under find&#40;&#41;&#41;, which I had to figure out from a call to Data::Dumper. The structure appears to be similar, but not identical to the structure used by ls&#40;&#41;. &#40;I&#39;m not sure what value an attributes object &#40;&#39;a&#39; hash key&#41; offers in the context of a rremove&#40;&#41; or glob&#40;&#41; error, but I&#39;m assuming it is there just for consistency. I see it is set to undef. If most of your methods using on_error don&#39;t need it, might be better to switch to a simple scalar.&#41;
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.385137</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
