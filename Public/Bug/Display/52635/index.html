<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #52635 for Match-Smart: Update to true perl 6/5.10 smart matching</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #52635 for Match-Smart: Update to true perl 6/5.10 smart matching</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Match-Smart/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Match-Smart/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Match-Smart/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Match-Smart/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Match-Smart">Match-Smart CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">52635</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Match-Smart/Active/">Match-Smart</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jpierce [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20450-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20451-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.02    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;09&nbsp;23:07:21&nbsp;2009</span>
    <span class="description">jpierce [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Update to true perl 6/5.10 smart matching</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Is there any chance of seeing this updated to match the actual perl 6
spec, which has changed since Apocalypse 4?

Some of the differences seem to be:

module executes
Code[+] Code[+]   referential equality     $a == $b

modules is missing exists
Hash    Array     hash slice existence     grep {exists $a-&gt;{$_}} @$b

module recurses
Hash    Any       hash entry existence     exists $a-&gt;{$b}

module greps values??
Array   Array     arrays are identical[*]

module recurses?
Array   Regex     array grep               grep /$b/, @$a
Array   Num       array contains number    grep $_ == $b, @$a
Array   Any       array contains string    grep $_ eq $b, @$a


The current implementation yields the following results against a
modified version of 5.10.0&#39;s smartmatch.t:
1..144
ok 1 - smart_match&#40;\&#38;foo, \&#38;foo&#41;: 1
ok 2 - smart_match&#40;\&#38;foo, \&#38;foo&#41;: 1
ok 3 - smart_match&#40;\&#38;foo, sub {}&#41;:
ok 4 - smart_match&#40;sub {}, \&#38;foo&#41;:
ok 5 - smart_match&#40;\&#38;foo, \&#38;bar&#41;:
not ok 6 - smart_match&#40;\&#38;bar, \&#38;foo&#41;: 2
# Failed at smartmatch.t line 56
ok 7 - smart_match&#40;1, sub{shift}&#41;: 1
ok 8 - smart_match&#40;sub{shift}, 1&#41;: 1
ok 9 - smart_match&#40;0, sub{shift}&#41;:
ok 10 - smart_match&#40;sub{shift}, 0&#41;:
ok 11 - smart_match&#40;1, sub{scalar @_}&#41;: 1
ok 12 - smart_match&#40;sub{scalar @_}, 1&#41;: 1
ok 13 - smart_match&#40;[], \&#38;bar&#41;: 2
ok 14 - smart_match&#40;\&#38;bar, []&#41;: 2
ok 15 - smart_match&#40;{}, \&#38;bar&#41;: 2
ok 16 - smart_match&#40;\&#38;bar, {}&#41;: 2
ok 17 - smart_match&#40;qr//, \&#38;bar&#41;: 2
ok 18 - smart_match&#40;\&#38;bar, qr//&#41;: 2
ok 19 - smart_match&#40;a_const, &#34;a constant&#34;&#41;: 1
ok 20 - smart_match&#40;&#34;a constant&#34;, a_const&#41;: 1
ok 21 - smart_match&#40;a_const, a_const&#41;: 1
ok 22 - smart_match&#40;a_const, a_const&#41;: 1
ok 23 - smart_match&#40;a_const, b_const&#41;: 1
ok 24 - smart_match&#40;b_const, a_const&#41;: 1
not ok 25 - smart_match&#40;{}, {}&#41;:
# Failed at smartmatch.t line 56
not ok 26 - smart_match&#40;{}, {}&#41;:
# Failed at smartmatch.t line 56
ok 27 - smart_match&#40;{}, {1 =&gt; 2}&#41;:
ok 28 - smart_match&#40;{1 =&gt; 2}, {}&#41;:
ok 29 - smart_match&#40;{1 =&gt; 2}, {1 =&gt; 2}&#41;: 1
ok 30 - smart_match&#40;{1 =&gt; 2}, {1 =&gt; 2}&#41;: 1
ok 31 - smart_match&#40;{1 =&gt; 2}, {1 =&gt; 3}&#41;: 1
ok 32 - smart_match&#40;{1 =&gt; 3}, {1 =&gt; 2}&#41;: 1
ok 33 - smart_match&#40;{1 =&gt; 2}, {2 =&gt; 3}&#41;:
ok 34 - smart_match&#40;{2 =&gt; 3}, {1 =&gt; 2}&#41;:
ok 35 - smart_match&#40;\%main::, {map {$_ =&gt; &#39;x&#39;} keys %main::}&#41;: 1
ok 36 - smart_match&#40;{map {$_ =&gt; &#39;x&#39;} keys %main::}, \%main::&#41;: 1
ok 37 - smart_match&#40;\%hash, \%tied_hash&#41;: 1
ok 38 - smart_match&#40;\%tied_hash, \%hash&#41;: 1
ok 39 - smart_match&#40;\%tied_hash, \%tied_hash&#41;: 1
ok 40 - smart_match&#40;\%tied_hash, \%tied_hash&#41;: 1
ok 41 - smart_match&#40;\%::, [keys %main::]&#41;: 1
ok 42 - smart_match&#40;[keys %main::], \%::&#41;: 1
ok 43 - smart_match&#40;\%::, []&#41;:
ok 44 - smart_match&#40;[], \%::&#41;:
Use of uninitialized value in hash element at
/usr/lib/perl5/site_perl/5.8.8/Match/Smart.pm line 65, &lt;DATA&gt; line 113.
ok 45 - smart_match&#40;{&#34;&#34; =&gt; 1}, [undef]&#41;: 1
Use of uninitialized value in hash element at
/usr/lib/perl5/site_perl/5.8.8/Match/Smart.pm line 65, &lt;DATA&gt; line 113.
ok 46 - smart_match&#40;[undef], {&#34;&#34; =&gt; 1}&#41;: 1
ok 47 - smart_match&#40;{ foo =&gt; 1 }, [&#34;foo&#34;]&#41;: 1
ok 48 - smart_match&#40;[&#34;foo&#34;], { foo =&gt; 1 }&#41;: 1
ok 49 - smart_match&#40;{ foo =&gt; 1 }, [&#34;foo&#34;, &#34;bar&#34;]&#41;: 1
ok 50 - smart_match&#40;[&#34;foo&#34;, &#34;bar&#34;], { foo =&gt; 1 }&#41;: 1
ok 51 - smart_match&#40;\%hash, [&#34;foo&#34;, &#34;bar&#34;]&#41;: 1
ok 52 - smart_match&#40;[&#34;foo&#34;, &#34;bar&#34;], \%hash&#41;: 1
ok 53 - smart_match&#40;\%hash, [&#34;foo&#34;]&#41;: 1
ok 54 - smart_match&#40;[&#34;foo&#34;], \%hash&#41;: 1
ok 55 - smart_match&#40;\%hash, [&#34;quux&#34;]&#41;:
ok 56 - smart_match&#40;[&#34;quux&#34;], \%hash&#41;:
ok 57 - smart_match&#40;\%hash, [qw&#40;foo quux&#41;]&#41;: 1
ok 58 - smart_match&#40;[qw&#40;foo quux&#41;], \%hash&#41;: 1
ok 59 - smart_match&#40;{foo =&gt; 1}, qr/^&#40;fo[ox]&#41;$/&#41;: 1
ok 60 - smart_match&#40;qr/^&#40;fo[ox]&#41;$/, {foo =&gt; 1}&#41;: 1
ok 61 - smart_match&#40;+{0..100}, qr/[13579]$/&#41;:
ok 62 - smart_match&#40;qr/[13579]$/, +{0..100}&#41;:
ok 63 - smart_match&#40;+{foo =&gt; 1, bar =&gt; 2}, &#34;foo&#34;&#41;: 1
ok 64 - smart_match&#40;&#34;foo&#34;, +{foo =&gt; 1, bar =&gt; 2}&#41;: 1
ok 65 - smart_match&#40;+{foo =&gt; 1, bar =&gt; 2}, &#34;baz&#34;&#41;:
ok 66 - smart_match&#40;&#34;baz&#34;, +{foo =&gt; 1, bar =&gt; 2}&#41;:
not ok 67 - smart_match&#40;[], []&#41;:
# Failed at smartmatch.t line 56
not ok 68 - smart_match&#40;[], []&#41;:
# Failed at smartmatch.t line 56
ok 69 - smart_match&#40;[], [1]&#41;:
ok 70 - smart_match&#40;[1], []&#41;:
ok 71 - smart_match&#40;[[&#34;foo&#34;], [&#34;bar&#34;]], [qr/o/, qr/a/]&#41;: 1
ok 72 - smart_match&#40;[qr/o/, qr/a/], [[&#34;foo&#34;], [&#34;bar&#34;]]&#41;: 1
ok 73 - smart_match&#40;[&#34;foo&#34;, &#34;bar&#34;], [qr/o/, qr/a/]&#41;: 1
ok 74 - smart_match&#40;[qr/o/, qr/a/], [&#34;foo&#34;, &#34;bar&#34;]&#41;: 1
not ok 75 - smart_match&#40;[&#34;foo&#34;, &#34;bar&#34;], [qr/o/, &#34;foo&#34;]&#41;: 1
# Failed at smartmatch.t line 56
not ok 76 - smart_match&#40;[qr/o/, &#34;foo&#34;], [&#34;foo&#34;, &#34;bar&#34;]&#41;: 1
# Failed at smartmatch.t line 56
ok 77 - smart_match&#40;$deep1, $deep1&#41;: 1
ok 78 - smart_match&#40;$deep1, $deep1&#41;: 1
ok 79 - smart_match&#40;$deep1, $deep2&#41;:
ok 80 - smart_match&#40;$deep2, $deep1&#41;:
ok 81 - smart_match&#40;\@nums, \@tied_nums&#41;: 1
ok 82 - smart_match&#40;\@tied_nums, \@nums&#41;: 1
ok 83 - smart_match&#40;[qw&#40;foo bar baz quux&#41;], qr/x/&#41;: 1
ok 84 - smart_match&#40;qr/x/, [qw&#40;foo bar baz quux&#41;]&#41;: 1
ok 85 - smart_match&#40;[qw&#40;foo bar baz quux&#41;], qr/y/&#41;:
ok 86 - smart_match&#40;qr/y/, [qw&#40;foo bar baz quux&#41;]&#41;:
not ok 87 - smart_match&#40;[qw&#40;1foo 2bar&#41;], 2&#41;:
# Failed at smartmatch.t line 56
not ok 88 - smart_match&#40;2, [qw&#40;1foo 2bar&#41;]&#41;:
# Failed at smartmatch.t line 56
ok 89 - smart_match&#40;[qw&#40;1foo 2bar&#41;], &#34;2&#34;&#41;:
ok 90 - smart_match&#40;&#34;2&#34;, [qw&#40;1foo 2bar&#41;]&#41;:
ok 91 - smart_match&#40;2, 2&#41;: 1
ok 92 - smart_match&#40;2, 2&#41;: 1
ok 93 - smart_match&#40;2, 3&#41;:
ok 94 - smart_match&#40;3, 2&#41;:
ok 95 - smart_match&#40;2, &#34;2&#34;&#41;: 1
ok 96 - smart_match&#40;&#34;2&#34;, 2&#41;: 1
ok 97 - smart_match&#40;2, &#34;2.0&#34;&#41;: 1
ok 98 - smart_match&#40;&#34;2.0&#34;, 2&#41;: 1
not ok 99 - smart_match&#40;2, &#34;2bananas&#34;&#41;: 1
# Failed at smartmatch.t line 56
not ok 100 - smart_match&#40;&#34;2bananas&#34;, 2&#41;: 1
# Failed at smartmatch.t line 56
ok 101 - smart_match&#40;2_3, &#34;2_3&#34;&#41;:
ok 102 - smart_match&#40;&#34;2_3&#34;, 2_3&#41;:
ok 103 - smart_match&#40;qr/x/, &#34;x&#34;&#41;: 1
ok 104 - smart_match&#40;&#34;x&#34;, qr/x/&#41;: 1
ok 105 - smart_match&#40;qr/y/, &#34;x&#34;&#41;:
ok 106 - smart_match&#40;&#34;x&#34;, qr/y/&#41;:
ok 107 - smart_match&#40;12345, qr/3/&#41;: 1
ok 108 - smart_match&#40;qr/3/, 12345&#41;: 1
not ok 109 - smart_match&#40;@nums, 7&#41;:
# Failed at smartmatch.t line 56
not ok 110 - smart_match&#40;7, @nums&#41;:
# Failed at smartmatch.t line 56
not ok 111 - smart_match&#40;@nums, \@nums&#41;:
# Failed at smartmatch.t line 56
ok 112 - smart_match&#40;\@nums, @nums&#41;: 2
ok 113 - smart_match&#40;@nums, \\@nums&#41;:
not ok 114 - smart_match&#40;\\@nums, @nums&#41;: 2
# Failed at smartmatch.t line 56
not ok 115 - smart_match&#40;@nums, [1..10]&#41;:
# Failed at smartmatch.t line 56
ok 116 - smart_match&#40;[1..10], @nums&#41;: 2
ok 117 - smart_match&#40;@nums, [0..9]&#41;:
not ok 118 - smart_match&#40;[0..9], @nums&#41;: 1
# Failed at smartmatch.t line 56
not ok 119 - smart_match&#40;%hash, &#34;foo&#34;&#41;:
# Failed at smartmatch.t line 56
not ok 120 - smart_match&#40;&#34;foo&#34;, %hash&#41;:
# Failed at smartmatch.t line 56
not ok 121 - smart_match&#40;%hash, /bar/&#41;:
# Failed at smartmatch.t line 56
not ok 122 - smart_match&#40;/bar/, %hash&#41;:
# Failed at smartmatch.t line 56
not ok 123 - smart_match&#40;%hash, [qw&#40;bar&#41;]&#41;:
# Failed at smartmatch.t line 56
ok 124 - smart_match&#40;[qw&#40;bar&#41;], %hash&#41;: 1
ok 125 - smart_match&#40;%hash, [qw&#40;a b c&#41;]&#41;:
ok 126 - smart_match&#40;[qw&#40;a b c&#41;], %hash&#41;:
not ok 127 - smart_match&#40;%hash, %hash&#41;:
# Failed at smartmatch.t line 56
not ok 128 - smart_match&#40;%hash, %hash&#41;:
# Failed at smartmatch.t line 56
not ok 129 - smart_match&#40;%hash, {%hash}&#41;:
# Failed at smartmatch.t line 56
ok 130 - smart_match&#40;{%hash}, %hash&#41;: 23
not ok 131 - smart_match&#40;%hash, %tied_hash&#41;:
# Failed at smartmatch.t line 56
not ok 132 - smart_match&#40;%tied_hash, %hash&#41;:
# Failed at smartmatch.t line 56
not ok 133 - smart_match&#40;%tied_hash, %tied_hash&#41;:
# Failed at smartmatch.t line 56
not ok 134 - smart_match&#40;%tied_hash, %tied_hash&#41;:
# Failed at smartmatch.t line 56
not ok 135 - smart_match&#40;%hash, { foo =&gt; 5, bar =&gt; 10 }&#41;:
# Failed at smartmatch.t line 56
ok 136 - smart_match&#40;{ foo =&gt; 5, bar =&gt; 10 }, %hash&#41;: 10
ok 137 - smart_match&#40;%hash, { foo =&gt; 5, bar =&gt; 10, quux =&gt; 15 }&#41;:
not ok 138 - smart_match&#40;{ foo =&gt; 5, bar =&gt; 10, quux =&gt; 15 }, %hash&#41;: 10
# Failed at smartmatch.t line 56
not ok 139 - smart_match&#40;@nums, {  1, &#39;&#39;,  2, &#39;&#39; }&#41;:
# Failed at smartmatch.t line 56
not ok 140 - smart_match&#40;{  1, &#39;&#39;,  2, &#39;&#39; }, @nums&#41;:
# Failed at smartmatch.t line 56
not ok 141 - smart_match&#40;@nums, {  1, &#39;&#39;, 12, &#39;&#39; }&#41;:
# Failed at smartmatch.t line 56
not ok 142 - smart_match&#40;{  1, &#39;&#39;, 12, &#39;&#39; }, @nums&#41;:
# Failed at smartmatch.t line 56
ok 143 - smart_match&#40;@nums, { 11, &#39;&#39;, 12, &#39;&#39; }&#41;:
ok 144 - smart_match&#40;{ 11, &#39;&#39;, 12, &#39;&#39; }, @nums&#41;:
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> smartmatch.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /opt/src/perl-5.10.0/t/op/smartmatch.t      2007-12-18 05:47:08.000000000 -0500
+++ smartmatch.t        2009-12-09 22:54:31.000000000 -0500
@@ -1,8 +1,8 @@
 #!./perl

 BEGIN {
-    chdir &#39;t&#39;;
-    @INC = &#39;../lib&#39;;
+#    chdir &#39;t&#39;;
+#    @INC = &#39;../lib&#39;;
     require &#39;./test.pl&#39;;
 }
 use strict;
@@ -10,6 +10,8 @@
 use Tie::Array;
 use Tie::Hash;

+use Match::Smart &#39;smart_match&#39;;
+
 # The feature mechanism is tested in t/lib/feature/smartmatch:
 # This file tests the semantics of the operator, without worrying
 # about feature issues such as scoping etc.
@@ -45,10 +47,10 @@
     die &#34;Bad test spec: &#40;$yn, $left, $right&#41;&#34;
        unless $yn eq &#34;&#34; || $yn eq &#34;!&#34;;

-    my $tstr = &#34;$left ~~ $right&#34;;
+    my $tstr = $] &gt;= 5.009 ? &#34;$left ~~ $right&#34; : &#34;smart_match&#40;$left, $right&#41;&#34;;

     my $res;
-    $res = eval $tstr // &#34;&#34;;   #/ &lt;- fix syntax colouring
+    $res = eval $tstr || &#34;&#34;;   #/ &lt;- fix syntax colouring

     die $@ if $@ ne &#34;&#34;;
     ok&#40; &#40;$yn =~ /!/ xor $res&#41;, &#34;$tstr: $res&#34;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;04:53:08&nbsp;2009</span>
    <span class="description">jpierce [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch makes the module behavior closer to perl 5.10&#39;s ~~
and also implements given/when a.k.a a switch statement.

See also <span class="clickylink"><a target="new" rel="nofollow" href="http://perladvent.org/2009/19/">http://perladvent.org/2009/19/</a></span>

However, the 5.10.1 smartmatch.t is more thorough,
it would be worth adopting.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/lib/perl5/site_perl/5.8.8/Match/Smart.pm	2004-02-03 22:26:34.000000000 -0500
+++ lib/Match/Smart.pm	2009-12-20 04:18:07.000000000 -0500
@@ -11,11 +11,11 @@
 
 our @ISA = qw&#40;Exporter&#41;;
 
-our %EXPORT_TAGS = &#40; &#39;all&#39; =&gt; [ qw&#40; smart_match&#41; ] &#41;;
+our %EXPORT_TAGS = &#40; &#39;all&#39; =&gt; [ qw&#40;smart_match given when default&#41; ] &#41;;
 
 our @EXPORT_OK = &#40; @{ $EXPORT_TAGS{&#39;all&#39;} } &#41;;
 
-our $VERSION = &#39;0.02&#39;;
+our $VERSION = &#39;1.01&#39;;
 
 ## initialize match look-up constants
 
@@ -51,22 +51,29 @@
 
 my @match_subs;
 
-$match_subs[ARRAY ][ARRAY ] = sub {
+$match_subs[ARRAY ][ARRAY ] = sub { 
+  my $count = scalar @{$_[0]};
+  return 0 unless $count == scalar @{$_[1]};
+
+  for&#40;my $i=0; $i&lt;$count; $i++&#41;{
+    return 0 unless _smart_match&#40;$_[0][$i], $_[1][$i], $_[2]&#41;;
+  }
+  return 1;
+};
+#Based on perlsyn it&#39;s unclear whether this should be grep or short-circuiting
+$match_subs[ARRAY ][CODE  ] = sub { !grep { !$_[1]-&gt;&#40;$_&#41; } @$_[0] };
+$match_subs[ARRAY ][HASH  ] = sub {
    for my $v &#40;@{$_[0]}&#41; {
-      for my $t &#40;@{$_[1]}&#41; {
-         return 1 if _smart_match&#40;$v, $t, $_[2]&#41;;
-      }
+      return 1 if exists $_[1]-&gt;{$v}
    }
    return;
 };
-$match_subs[ARRAY ][CODE  ] = sub { $_[1]-&gt;&#40;@{$_[0]}&#41; };
-$match_subs[ARRAY ][HASH  ] = sub {
+$match_subs[ARRAY ][NUMBER] = sub {
    for my $v &#40;@{$_[0]}&#41; {
-      return 1 if $_[1]-&gt;{$v}
+      return 1 if _smart_match&#40;$v, $_[1], $_[2]&#41;;
    }
    return;
 };
-$match_subs[ARRAY ][NUMBER] = sub { $_[0]-&gt;[$_[1]] };
 $match_subs[ARRAY ][OBJECT] = sub {
    for my $v &#40;@{$_[0]}&#41; {
       return 1 if _smart_match&#40;$v, $_[1], $_[2]&#41;;
@@ -94,8 +101,10 @@
    return;
 };
 
-$match_subs[CODE  ][CODE  ] = sub { $_[0]-&gt;&#40;&#38;{$_[1]}&#41; };
-$match_subs[CODE  ][HASH  ] = sub { $_[0]-&gt;&#40;%{$_[1]}&#41; };
+#Swapped order of code-code to match 5.10 perlsyn &#38;&#38; dox
+$match_subs[CODE  ][CODE  ] = sub { $_[1]-&gt;&#40;&#38;{$_[0]}&#41; };
+#Based on perlsyn it&#39;s unclear whether this should be grep or short-circuiting
+$match_subs[CODE  ][HASH  ] = sub { !grep { !$_[0]-&gt;&#40;$_&#41; } keys %{$_[1]} };
 $match_subs[CODE  ][NUMBER] = sub { $_[0]-&gt;&#40;$_[1]&#41; };
 $match_subs[CODE  ][OBJECT] = sub { $_[0]-&gt;&#40;$_[1]&#41; };
 $match_subs[CODE  ][REF   ] = sub { _smart_match&#40;$_[0], ${$_[1]}, $_[2]&#41; };
@@ -105,10 +114,7 @@
 $match_subs[CODE  ][UNDEF ] = sub { $_[0]-&gt;&#40;$_[1]&#41; };
 
 $match_subs[HASH  ][HASH  ] = sub {
-   for my $v &#40;keys %{$_[1]}&#41; {
-      return 1 if exists $_[0]-&gt;{$v};
-   }
-   return;
+  &#34;@{[sort keys %{$_[0]}]}&#34; eq &#34;@{[sort keys %{$_[1]}]}&#34;;
 };
 $match_subs[HASH  ][NUMBER] = sub { $_[0]-&gt;{$_[1]} };
 $match_subs[HASH  ][OBJECT] = undef;
@@ -244,6 +250,20 @@
 
 }
 
+sub given&#40;$&#38;&#41; {
+  local $_ = $_[0];
+  eval{ $_[1]-&gt;&#40;&#41; };
+  return @{$@}
+}
+
+sub when&#40;$&#38;&#41; {
+  die&#40;[$_[1]-&gt;&#40;&#41;]&#41; if smart_match&#40;$_, $_[0]&#41;;
+}
+
+sub default&#40;&#38;&#41; {
+  die&#40;[$_[0]-&gt;&#40;&#41;]&#41;;
+}
+
 1;
 __END__
 =head1 NAME
@@ -262,19 +282,29 @@
       print &#34;$amount is less than 10\n&#34;;
    }
 
+
+   use Match::Smart qw/ :all /;
+
+   given $fruit =&gt; sub {
+      when [qw/Honeycrisp Jonagold Braeburn/] =&gt; sub{ print &#34;apple\n&#34; };
+      when [qw/Concord Red_Flame/] =&gt; sub{ print &#34;grape\n&#34; };
+      default { print &#34;Unknown fruit: $_\n&#34; };
+   }
+
 =head1 DESCRIPTION
 
-C&lt;Match::Smart&gt; provides a easy means of testing whether two scalars match.  A
-best guess on how they should be compared is made, based on the types of the
-two scalars.
+C&lt;Match::Smart&gt; provides a easy means of testing whether two variables match
+based upon a set of rules derived from the syntax of Perl 5.10 &#38; Apocalypse 4.
 
-The means of matching is based heavily on the Apocalypse 4, Perl 6 document by
-Larry Wall.
+It also provides an analog for Perl 5.10&#39;s version of a switch statement.
 
 =head1 EXPORT
 
-Nothing is exported by default. The C&lt;smart_match&#40;&#41;&gt; subroutine can be exported
-if desired.
+Nothing is exported by default.
+
+The C&lt;smart_match&#40;&#41;&gt; subroutine can be exported if desired.
+
+The I&lt;:all&gt; tag will provide the necessary routines for switching.
 
 =head1 FUNCTIONS
 
@@ -303,10 +333,11 @@
    $val1    $val2    true if ...
    =====    =====    ===========
 
-   ARRAY    ARRAY    any in @{$val1} smart_match any in @{$val2}
-   ARRAY    CODE     $val2-&gt;&#40;@{$val1}&#41;
-   ARRAY    HASH     grep { $val2-&gt;{$_} } @{$val1}
-   ARRAY    NUMBER   $val1-&gt;[$val2]
+   ARRAY    ARRAY    smart_match&#40;$val1-&gt;[$_], $val2-&gt;[$_]&#41; for 0 .. $#$val1
+                            &#38;&#38; $#$val1 == $#$val2
+   ARRAY    CODE     !grep { !$val2-&gt;&#40;$_&#41; } @{$val1}
+   ARRAY    HASH     grep { exists $val2-&gt;{$_} } @{$val1}
+   ARRAY    NUMBER   smart_match&#40;$_, $val2&#41; for @$val1
    ARRAY    OBJECT   grep { smart_match&#40;$_, $val2&#41;    } @{$val1}
    ARRAY    REF      grep { smart_match&#40;$_, ${$val2}&#41; } @{$val1}
    ARRAY    REGEXP   grep { smart_match&#40;$_, $val2&#41;    } @{$val1}
@@ -314,8 +345,8 @@
    ARRAY    STRING   grep { smart_match&#40;$_, $val2&#41;    } @{$val1}
    ARRAY    UNDEF    grep { smart_match&#40;$_, $val2&#41;    } @{$val1}
 
-   CODE     CODE     $val1-&gt;&#40;&#38;{$val2}&#41;
-   CODE     HASH     $val1-&gt;&#40;%{$val2}&#41;
+   CODE     CODE     $val2-&gt;&#40;&#38;{$val1}&#41;
+   CODE     HASH     !grep { !$val1-&gt;&#40;$_&#41; } keys %{$val2}
    CODE     NUMBER   $val1-&gt;&#40;$val2&#41;
    CODE     OBJECT   $val1-&gt;&#40;$val2&#41;
    CODE     REF      smart_match&#40;$val1, ${$val2}&#41;
@@ -324,7 +355,7 @@
    CODE     STRING   $val1-&gt;&#40;$val2&#41;
    CODE     UNDEF    $val1-&gt;&#40;$val2&#41;
 
-   HASH     HASH     grep { exists $val1-&gt;{$_} } keys %{$val2}
+   HASH     HASH     smart_match&#40;keys %{$val1}, keys %{$val2}&#41;
    HASH     NUMBER   $val1-&gt;{$val2}
    HASH     OBJECT   -
    HASH     REF      smart_match&#40;$val1, ${$val2}&#41;
@@ -374,6 +405,8 @@
 
 =over 4
 
+=item - test against perl 5.10.1 t/op/smartmatch.t
+
 =item - handle GLOB and LVALUE ref types
 
 =item - provide a means of registering comparisons for specific Object types
@@ -387,10 +420,14 @@
 
 Apocalypse 4: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.com/pub/a/2002/01/15/apo4.html?page=2">http://www.perl.com/pub/a/2002/01/15/apo4.html?page=2</a></span>
 
+Perl 5.10 syntax: <span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/perlsyn.html#Smart-matching-in-detail">http://perldoc.perl.org/perlsyn.html#Smart-matching-in-detail</a></span>
+
 =head1 AUTHOR
 
 Daniel B. Boorstein, E&lt;lt&gt;danboo@cpan.orgE&lt;gt&gt;
 
+With contributions from Jerrad Pierce.
+
 =head1 COPYRIGHT AND LICENSE
 
 Copyright 2004 by Daniel B. Boorstein
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;04:53:10&nbsp;2009</span>
    <span class="description">jpierce [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;08:59:38&nbsp;2009</span>
    <span class="description">danboo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Dec 20 04:53:08 2009, JPIERCE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached patch makes the module behavior closer to perl 5.10&#39;s ~~
&gt; and also implements given/when a.k.a a switch statement.
&gt; 
&gt; See also <span class="clickylink"><a target="new" rel="nofollow" href="http://perladvent.org/2009/19/">http://perladvent.org/2009/19/</a></span>
&gt; 
&gt; However, the 5.10.1 smartmatch.t is more thorough,
&gt; it would be worth adopting.
</div>
I haven&#39;t touched this in years. I&#39;ll probably move the repo over to 
github, and look into adding this patch.

If I&#39;d known you were planning to use it in the Advent Calendar I&#39;d have 
done it already. Though demonstrating the patching is probably quite 
instructive.

Thanks Jerrad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;11:38:46&nbsp;2009</span>
    <span class="description">belg4mit [...] pthbb.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52635] Update to true perl 6/5.10 smart matching </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 Dec 2009 11:38:27 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Match-Smart [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jerrad Pierce &lt;belg4mit [...] pthbb.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;If I&#39;d known you were planning to use it in the Advent Calendar I&#39;d have
&gt;done it already. Though demonstrating the patching is probably quite
&gt;instructive.
</div>I know, sorry about that. But we&#39;re hurting for entries, so waiting to post,
especially after a lack of repsonse to the initial ticket, wasn&#39;t a very
appealing option. As soon as I got it to work, it went up... 10 hours in.

It actually wasn&#39;t that hard, other than fighting with 5.10.x Re numish;
and &#40;lack of&#41; prototypes for argument flattening and switch implementation.

Cheers!
-- 
Free map of local environmental resources: <span class="clickylink"><a target="new" rel="nofollow" href="http://CambridgeMA.GreenMap.org">http://CambridgeMA.GreenMap.org</a></span>
--
MOTD on Prickle-Prickle, the 62nd of The Aftermath, in the YOLD 3175:
Alternative smock. --JP
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;12:16:52&nbsp;2009</span>
    <span class="description">jpierce [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">And finally, a head start on the 5.10.1 test, which highlights some
particular object behaviors that might not be replicatable, at least not
without something like:

  provide a means of registering comparisons for specific Object types
  &#40;call Class-&gt;smart_match&#40;&#41; method to get class to fill in require
ments&#41;

by defining a UNIVERSAL method? I dunno, short on sleep. In any event,
as fun as this is it&#39;s as far as I go for now, other duties are calling.


perl -Mlib=lib smartmatch.t | &#38; grep -E &#39;^not&#39;

not ok 5 - smart_match&#40;\%hash, undef&#41; does not match               
not ok 6 - smart_match&#40;{}, undef&#41; does not match                   
not ok 23 - smart_match&#40;\&#38;fatal, $ov_obj&#41; does not match           
not ok 24 - smart_match&#40;&#39;cigam&#39;, $ov_obj&#41; matches                  
not ok 28 - smart_match&#40;{ cigam =&gt; 1 }, $ov_obj&#41; does not match    
not ok 29 - smart_match&#40;{ stringified =&gt; 1 }, $ov_obj&#41; does not match
not ok 30 - smart_match&#40;$obj, $ov_obj&#41; does not match                
not ok 32 - smart_match&#40;$obj, $obj&#41; dies                             
not ok 36 - smart_match&#40;\&#38;FALSE, $obj&#41; dies                          
not ok 37 - smart_match&#40;\&#38;foo, $obj&#41; dies                            
not ok 38 - smart_match&#40;sub { 1 }, $obj&#41; dies                        
not ok 39 - smart_match&#40;sub { 0 }, $obj&#41; dies                        
not ok 40 - smart_match&#40;%keyandmore, $obj&#41; dies                      
not ok 42 - smart_match&#40;@fooormore, $obj&#41; dies                       
not ok 46 - smart_match&#40;&#34;key&#34;, $obj&#41; dies                            
not ok 48 - smart_match&#40;$obj, $str_obj&#41; dies                         
not ok 51 - smart_match&#40;\&#38;FALSE, $str_obj&#41; dies                      
not ok 52 - smart_match&#40;\&#38;foo, $str_obj&#41; dies                        
not ok 53 - smart_match&#40;sub { 1 }, $str_obj&#41; dies                    
not ok 54 - smart_match&#40;sub { 0 }, $str_obj&#41; dies                    
not ok 55 - smart_match&#40;%keyandmore, $str_obj&#41; dies                  
not ok 57 - smart_match&#40;@fooormore, $str_obj&#41; dies                   
not ok 61 - smart_match&#40;&#34;object&#34;, $str_obj&#41; dies                     
not ok 63 - smart_match&#40;$ov_obj, $str_obj&#41; does not match            
not ok 65 - smart_match&#40;$obj, qr/NoOverload/&#41; matches                
not ok 66 - smart_match&#40;$ov_obj, qr/^stringified$/&#41; matches          
not ok 73 - smart_match&#40;$str_obj, &#34;object&#34;&#41; matches                  
not ok 74 - smart_match&#40;$ov_obj, &#39;magic&#39;&#41; matches                    
not ok 76 - smart_match&#40;sub{0}, sub { ref $_[0] eq &#34;CODE&#34; }&#41; matches 
not ok 78 - smart_match&#40;%fooormore, sub { $_[0] =~ /^&#40;foo|or|less&#41;$/ }&#41;
does not match                                                         
                
not ok 83 - smart_match&#40;@fooormore, sub { $_[0] =~ /^&#40;foo|or|more&#41;$/ }&#41;
matches 
not ok 85 - smart_match&#40;\@fooormore, sub { $_[0] =~ /^&#40;foo|or|more&#41;$/ }&#41;
matches
not ok 86 - smart_match&#40;\@fooormore, sub { $_[0] =~ /^&#40;foo|or|less&#41;$/ }&#41;
does not match                                                         
               
not ok 87 - smart_match&#40;[@fooormore], sub { $_[0] =~ /^&#40;foo|or|more&#41;$/
}&#41; matches                                                             
                 
not ok 88 - smart_match&#40;[@fooormore], sub { $_[0] =~ /^&#40;foo|or|less&#41;$/
}&#41; does not match                                                      
                 
not ok 90 - smart_match&#40;@fooormore, sub{@_==1}&#41; matches                
        
not ok 93 - smart_match&#40;/fooormore/, sub{ref $_[0] eq &#39;Regexp&#39;}&#41; matches
       
not ok 102 - smart_match&#40;[1], \&#38;bar&#41; matches                           
        
not ok 105 - smart_match&#40;[1], \&#38;foo&#41; does not match                    
        
not ok 109 - smart_match&#40;[], \&#38;foo&#41; matches                            
        
not ok 111 - smart_match&#40;@empty, \&#38;foo&#41; matches                        
        
not ok 112 - smart_match&#40;%empty, \&#38;foo&#41; matches                        
        
not ok 122 - smart_match&#40;[], \&#38;fatal&#41; matches                          
        
not ok 124 - smart_match&#40;@empty, \&#38;fatal&#41; matches                      
        
not ok 125 - smart_match&#40;%empty, \&#38;fatal&#41; matches                      
        
not ok 126 - smart_match&#40;sub {0}, qr/^CODE/&#41; matches                   
        
not ok 127 - smart_match&#40;sub {0}, sub { ref shift eq &#34;CODE&#34; }&#41; matches 
        
not ok 142 - smart_match&#40;%hash, %tied_hash&#41; matches                    
        
not ok 143 - smart_match&#40;%hash, %tied_hash&#41; matches                    
        
not ok 144 - smart_match&#40;%tied_hash, %tied_hash&#41; matches               
        
not ok 151 - smart_match&#40;%refh, %refh&#41; matches                         
        
not ok 162 - smart_match&#40;@empty, {}&#41; does not match                    
        
not ok 163 - smart_match&#40;@empty, {}&#41; does not match                    
        
not ok 180 - smart_match&#40;@fooormore, { foo =&gt; 1, or =&gt; 2, more =&gt; 3 }&#41;
matches  
not ok 181 - smart_match&#40;@fooormore, { foo =&gt; 1, or =&gt; 2, more =&gt; 3 }&#41;
matches  
not ok 182 - smart_match&#40;@fooormore, %fooormore&#41; matches               
        
not ok 183 - smart_match&#40;@fooormore, %fooormore&#41; matches               
        
not ok 184 - smart_match&#40;@fooormore, \%fooormore&#41; matches              
        
not ok 185 - smart_match&#40;@fooormore, \%fooormore&#41; matches              
        
not ok 200 - smart_match&#40;/B/i, {b=&gt;2}&#41; matches                         
        
not ok 201 - smart_match&#40;/B/i, {b=&gt;2}&#41; matches                         
        
not ok 207 - smart_match&#40;&#34;foo&#34;, %fooormore&#41; matches                    
        
not ok 218 - smart_match&#40;undef, { hop =&gt; &#39;zouu&#39; }&#41; does not match      
        
not ok 220 - smart_match&#40;undef, +{&#34;&#34; =&gt; &#34;empty key&#34;}&#41; does not match   
        
not ok 221 - smart_match&#40;undef, {}&#41; does not match                     
        
not ok 228 - smart_match&#40;[qr/o/, qr/a/], [&#34;foo&#34;, &#34;bar&#34;]&#41; does not match
        
not ok 239 - smart_match&#40;@nums, \@tied_nums&#41; matches                   
        
not ok 240 - smart_match&#40;@nums, \@tied_nums&#41; matches                   
        
not ok 243 -# Failed at smartmatch.t line 108                          
        
not ok 244 - smart_match&#40;@nums, @tied_nums&#41; matches                    
        
not ok 251 - smart_match&#40;/x/, [qw&#40;foo bar baz quux&#41;]&#41; matches
not ok 252 - smart_match&#40;/x/, [qw&#40;foo bar baz quux&#41;]&#41; matches
not ok 255 - smart_match&#40;/FOO/i, @fooormore&#41; matches
not ok 256 - smart_match&#40;/FOO/i, @fooormore&#41; matches
#not ok 263 - smart_match&#40;&#34;2&#34;, [qw&#40;1foo 2bar&#41;]&#41; does not match #numish
not ok 266 - smart_match&#40;undef, [1, 2, [undef], 4]&#41; does not match
#not ok 286 - &#34;2&#34; ~~ 2 matches #numish
#not ok 288 - &#34;2.0&#34; ~~ 2 matches #numish
#not ok 289 - smart_match&#40;2, &#34;2bananas&#34;&#41; does not match #numish
#not ok 291 - &#34;2_3&#34; ~~ 2_3 does not match #numish
not ok 299 - smart_match&#40;@fooormore, &#34;&#34;.\@fooormore&#41; matches
not ok 302 - smart_match&#40;%keyandmore, &#34;&#34;.\%fooormore&#41; does not match
not ok 303 - smart_match&#40;7, @nums&#41; matches #?!
not ok 304 - smart_match&#40;@nums, \@nums&#41; matches #?!
not ok 306 - smart_match&#40;@nums, [1..10]&#41; matches #?!
not ok 308 - smart_match&#40;&#34;foo&#34;, %hash&#41; matches #?!
not ok 309 - smart_match&#40;/bar/, %hash&#41; matches #?!
not ok 312 - smart_match&#40;%hash, %hash&#41; matches #?!
not ok 313 - smart_match&#40;%hash, +{%hash}&#41; matches #op precedence, not
fixable
not ok 314 - smart_match&#40;%hash, \%hash&#41; matches #?!
not ok 315 - smart_match&#40;%hash, %tied_hash&#41; matches #?!
not ok 316 - smart_match&#40;%tied_hash, %tied_hash&#41; matches #?!
not ok 317 - smart_match&#40;%hash, { foo =&gt; 5, bar =&gt; 10 }&#41; matches #?!
not ok 319 - smart_match&#40;@nums, {  1, &#39;&#39;,  2, &#39;&#39; }&#41; matches #?!
not ok 320 - smart_match&#40;@nums, {  1, &#39;&#39;, 12, &#39;&#39; }&#41; matches #?!
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /opt/src/perl-5.10.1/t/op/smartmatch.t	2009-07-03 08:22:58.000000000 -0400
+++ smartmatch.t	2009-12-20 12:01:17.000000000 -0500
@@ -1,8 +1,8 @@
 #!./perl
 
 BEGIN {
-    chdir &#39;t&#39;;
-    @INC = &#39;../lib&#39;;
+#    chdir &#39;t&#39;;
+#    @INC = &#39;../lib&#39;;
     require &#39;./test.pl&#39;;
 }
 use strict;
@@ -13,6 +13,8 @@
 use Tie::Hash;
 use Tie::RefHash;
 
+eval &#34;use Match::Smart &#39;smart_match&#39;&#34; unless $] &gt;= 5.009;
+
 # Predeclare vars used in the tests:
 my @empty;
 my %empty;
@@ -42,7 +44,7 @@
 
 {
     package Test::Object::WithOverload;
-    sub new { bless { key =&gt; &#40;$_[1] // &#39;magic&#39;&#41; } }
+    sub new { bless { key =&gt; &#40;$_[1] || &#39;magic&#39;&#41; } }
     use overload &#39;~~&#39; =&gt; sub {
 	my %hash = %{ $_[0] };
 	if &#40;$_[2]&#41; { # arguments reversed ?
@@ -81,7 +83,7 @@
 
     die &#34;Bad test spec: &#40;$yn, $left, $right&#41;&#34; if $yn =~ /[^!@=]/;
 
-    my $tstr = &#34;$left ~~ $right&#34;;
+    my $tstr = $] &gt;= 5.009 ? &#34;$left ~~ $right&#34; : &#34;smart_match&#40;$left, $right&#41;&#34;;
 
     test_again:
     my $res;
@@ -108,8 +110,8 @@
     }
 
     if &#40; $yn =~ s/=// &#41; {
-	$tstr = &#34;$right ~~ $left&#34;;
-	goto test_again;
+      my $tstr = $] &gt;= 5.009 ? &#34;$right ~~ $left&#34; : &#34;smart_match&#40;$right, $left&#41;&#34;;
+      goto test_again;
     }
 }
 
@@ -159,7 +161,7 @@
 !	[]		undef
 !	%tied_hash	undef
 !	@tied_nums	undef
-!	$deep1		undef
+#!	$deep1		undef
 !	/foo/		undef
 !	qr/foo/		undef
 !	21..30		undef
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;15:15:02&nbsp;2009</span>
    <span class="description">jpierce [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">See also <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Public/Bug/Display.html?id=71452">http://rt.perl.org/rt3/Public/Bug/Display.html?id=71452</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;15:22:55&nbsp;2009</span>
    <span class="description">jpierce [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Dec 20 15:15:02 2009, JPIERCE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; See also <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Public/Bug/Display.html?id=71452">http://rt.perl.org/rt3/Public/Bug/Display.html?id=71452</a></span>
</div>
Mmm, apparently to match *current* 5.10 *behavior* &#40;but not documentation&#41;

These warnings need to be &#34;fatal&#34; instead of ignored :-/
$match_subs[NUMBER][STRING] = sub { no warnings &#39;numeric&#39;; $_[0] == $_[1] };
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;20&nbsp;17:17:05&nbsp;2009</span>
    <span class="description">jpierce [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">: : See also <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Public/Bug/Display.html?id=71452">http://rt.perl.org/rt3/Public/Bug/Display.html?id=71452</a></span>
:
: Mmm, apparently to match *current* 5.10 *behavior* &#40;but not documentation&#41;
: 
: These warnings need to be &#34;fatal&#34; instead of ignored :-/
: $match_subs[NUMBER][STRING] = sub { no warnings &#39;numeric&#39;; $_[0] ==
$_[1] };


Actually, it just needs to be a simple return, as with undefs.
this gets the 5.10.0 test suite failures down to just three:

  not ok 5 - smart_match&#40;\&#38;foo, \&#38;bar&#41;: 2
  not ok 87 - smart_match&#40;[qw&#40;1foo 2bar&#41;], 2&#41;:
  not ok 88 - smart_match&#40;2, [qw&#40;1foo 2bar&#41;]&#41;:

The code-code &#40;which is correct&#41;, and  2 ~~ [qw/1foo  2bar/] which
appears to be an incorrect test since 5.10.1 has different tests:

!       &#34;2&#34;             [qw&#40;1foo 2bar&#41;]
        &#34;2bar&#34;          [qw&#40;1foo 2bar&#41;]

And running 5.10.1 against the 5.10.0 test suite yields:

not ok 87 - [qw&#40;1foo 2bar&#41;] ~~ 2:                                  
# Failed at op/smartmatch.t line 54                                
not ok 88 - 2 ~~ [qw&#40;1foo 2bar&#41;]:                                  
# Failed at op/smartmatch.t line 54                                
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
