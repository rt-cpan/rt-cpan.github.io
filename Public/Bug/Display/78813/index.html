<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78813 for XML-Twig: map_xmlns bug </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78813 for XML-Twig: map_xmlns bug </h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-Twig">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-Twig">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-Twig">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-Twig">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Twig">XML-Twig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78813</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-Twig">XML-Twig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
roe.mcburnett [...] ericsson.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37682-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37683-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=78813">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106620" href="/Public/Bug/Display.html?id=78813#txn-1106620">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;11:58:48&nbsp;2012</span>
    <span class="description">roe.mcburnett [...] ericsson.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> map_xmlns bug </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Aug 2012 15:58:33 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-XML-Twig [...] rt.cpan.org&#39;&#34; &lt;bug-XML-Twig [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;McBurnett, Roe D&#34; &lt;roe.mcburnett [...] ericsson.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106620/581831/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581831">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When using namespaces, it is allowed to identify an element as a particular type in an already defined namespace. the map_xmlns does not convert the namespace prefix for the types correctly.

The code:
#! /usr/bin/perl
use XML::Twig;

$x = XML::Twig-&gt;new&#40;map_xmlns =&gt; {&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/CommandService">http://namespace/CommandService</a></span>&#34; =&gt; &#34;cmdsvc&#34;,
       &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/ShelfService">http://namespace/ShelfService</a></span>&#34; =&gt; &#34;shlsvc&#34; }, pretty_print =&gt; &#34;indented&#34;&#41;;
$x-&gt;parse&#40;&#39;&lt;ns1:list
   xmlns:ns1=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/CommandService">http://namespace/CommandService</a></span>&#34;
   xmlns:ns2=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/ShelfService">http://namespace/ShelfService</a></span>&#34;
   xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">   &gt;
</div>  &lt;commands&gt;
    &lt;commandId&gt;1&lt;/commandId&gt;
    &lt;command xsi:type=&#34;ns2:find&#34; &gt;
      &lt;equipmentFilter&gt;...&lt;/equipmentFilter&gt;
    &lt;/command&gt;
  &lt;/commands&gt;
  &lt;commands&gt;
    &lt;commandId&gt;2&lt;/commandId&gt;
    &lt;command xsi:type=&#34;ns2:getByName&#34; &gt;
      &lt;name&gt;...&lt;/name&gt;
    &lt;/command&gt;
  &lt;/commands&gt;
&lt;/ns1:list&gt;&#39;&#41;;
$x-&gt;print&#40;&#41;;

Generates the following:
&lt;cmdsvc:list xmlns:cmdsvc=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/CommandService">http://namespace/CommandService</a></span>&#34;
       xmlns:shlsvc=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/ShelfService">http://namespace/ShelfService</a></span>&#34;
       xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;&gt;
  &lt;commands&gt;
    &lt;commandId&gt;1&lt;/commandId&gt;
    &lt;command xsi:type=&#34;ns2:find&#34;&gt;
      &lt;equipmentFilter&gt;...&lt;/equipmentFilter&gt;
    &lt;/command&gt;
  &lt;/commands&gt;
  &lt;commands&gt;
    &lt;commandId&gt;2&lt;/commandId&gt;
    &lt;command xsi:type=&#34;ns2:getByName&#34;&gt;
      &lt;name&gt;...&lt;/name&gt;
    &lt;/command&gt;
  &lt;/commands&gt;
&lt;/cmdsvc:list&gt;

It should generate this:
&lt;cmdsvc:list
   xmlns:cmdsvc=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/CommandService">http://namespace/CommandService</a></span>&#34;
   xmlns:shlsvc=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/ShelfService">http://namespace/ShelfService</a></span>&#34;
   xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">   &gt;
</div>  &lt;commands&gt;
    &lt;commandId&gt;1&lt;/commandId&gt;
    &lt;command xsi:type=&#34;shlsvc:find&#34; &gt;
      &lt;equipmentFilter&gt;...&lt;/equipmentFilter&gt;
    &lt;/command&gt;
  &lt;/commands&gt;
  &lt;commands&gt;
    &lt;commandId&gt;2&lt;/commandId&gt;
    &lt;command xsi:type=&#34;shlsvc:getByName&#34; &gt;
      &lt;name&gt;...&lt;/name&gt;
    &lt;/command&gt;
  &lt;/commands&gt;
&lt;/cmdsvc:list&gt;
This example was created using perl:
$  perl -v

This is perl, v5.10.1 &#40;*&#41; built for i686-cygwin-thread-multi-64int
&#40;with 13 registered patches, see perl -V for more detail&#41;

Copyright 1987-2009, Larry Wall

Perl may be copied only under the terms of either the Artistic License or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using &#34;man perl&#34; or &#34;perldoc perl&#34;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.
and XML::Twig:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">cpan&gt; i XML::Twig
</div>CPAN: Storable loaded ok &#40;v2.30&#41;
Reading &#39;/home/cpan/Metadata&#39;
  Database was generated on Thu, 26 Jul 2012 15:58:03 GMT
CPAN: YAML loaded ok &#40;v0.71&#41;
Reading 54 yaml files from /home/cpan/build/
CPAN: Time::HiRes loaded ok &#40;v1.9719&#41;
..................................DONE
Restored the state of none &#40;in 0.8281 secs&#41;
Module id = XML::Twig
    DESCRIPTION  A module for easy processing of XML
    CPAN_USERID  MIROD &#40;Michel Rodriguez &lt;xmltwig@gmail.com&gt;&#41;
    CPAN_VERSION 3.40
    CPAN_FILE    M/MI/MIROD/XML-Twig-3.40.tar.gz
    UPLOAD_DATE  2012-05-10
    DSLIP_STATUS RmpOp &#40;released,mailing-list,perl,object-oriented,Standard-Perl&#41;
    MANPAGE      XML::Twig - A perl module for processing huge XML documents in tree mode.
    INST_FILE    /usr/lib/perl5/site_perl/5.10/XML/Twig.pm
    INST_VERSION 3.40


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">cpan&gt;
</div>-Roe McBurnett
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106620/581832/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581832">with headers</a>
<br />
<span class="downloadcontenttype">text/html 24.4k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106623" href="/Public/Bug/Display.html?id=78813#txn-1106623">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;12:27:21&nbsp;2012</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78813] map_xmlns bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 06 Aug 2012 18:26:44 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106623/581835/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581835">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 539b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 08/06/2012 05:58 PM, McBurnett, Roe D via RT wrote:


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When using namespaces, it is allowed to identify an element as a
&gt; particular type in an already defined namespace. the map_xmlns does
&gt; not convert the namespace prefix for the types correctly.
</div>

Originally that&#39;s supposed to be a feature. The original prefix is 
restored when outputting the document. Obviously it doesn&#39;t work though, 
since the ns* prefixes are not defined any more in the output. Drats!

I&#39;ll have a look at this tomorrow.

Thanks for the report.

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106626" href="/Public/Bug/Display.html?id=78813#txn-1106626">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;12:27:23&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106627" href="/Public/Bug/Display.html?id=78813#txn-1106627">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;12:50:36&nbsp;2012</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78813] map_xmlns bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 06 Aug 2012 18:49:54 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106627/581838/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581838">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 537b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 08/06/2012 05:58 PM, McBurnett, Roe D via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When using namespaces, it is allowed to identify an element as a
&gt; particular type in an already defined namespace. the map_xmlns does
&gt; not convert the namespace prefix for the types correctly.
</div>

Actually that&#39;s pretty strange, because the behaviour you want is what 
he module should do. There is even a test, test 640 in 
t/test_additional.t that checks just this. I am trying to see how this 
test is different from your example, but so far I can&#39;t really see it.

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106635" href="/Public/Bug/Display.html?id=78813#txn-1106635">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;13:08:09&nbsp;2012</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78813] map_xmlns bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 06 Aug 2012 19:07:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106635/581844/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581844">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 08/06/2012 06:50 PM, xmltwig@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: XML-Twig
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78813">https://rt.cpan.org/Ticket/Display.html?id=78813</a></span> &gt;
&gt;
&gt; On 08/06/2012 05:58 PM, McBurnett, Roe D via RT wrote:
&gt;
<div class="message-stanza open">&gt;&gt; When using namespaces, it is allowed to identify an element as a
&gt;&gt; particular type in an already defined namespace. the map_xmlns does
&gt;&gt; not convert the namespace prefix for the types correctly.
</div>&gt;
&gt;
&gt; Actually that&#39;s pretty strange, because the behaviour you want is what
&gt; he module should do. There is even a test, test 640 in
&gt; t/test_additional.t that checks just this. I am trying to see how this
&gt; test is different from your example, but so far I can&#39;t really see it.
</div>
Duh! The difference is that you want to replace xsi:type=&#34;ns2:find&#34; by 
xsi:type=&#34;shlsvc:find&#34;. That&#39;s the attribute _value_ that you want to 
replace. In XML there is nothing special about it, namespaces are not 
involved. So it won&#39;t be replaced.

Is this something that W3c schemas-aware processors are supposd to know 
about?

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106652" href="/Public/Bug/Display.html?id=78813#txn-1106652">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;13:32:37&nbsp;2012</span>
    <span class="description">roe.mcburnett [...] ericsson.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #78813] map_xmlns bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Aug 2012 17:32:26 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-XML-Twig [...] rt.cpan.org&#39;&#34; &lt;bug-XML-Twig [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;McBurnett, Roe D&#34; &lt;roe.mcburnett [...] ericsson.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106652/581853/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581853">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I did a lookup in the W3 XML Schema definitions and found 2 sections which seem to imply that YES W3c XML Schema-aware processors should know about the imbedded type information within such an attribute.

See <span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/xmlschema-1/">http://www.w3.org/TR/xmlschema-1/</a></span> section 2.6.1 and <span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/xmlschema-1/#src-qname">http://www.w3.org/TR/xmlschema-1/#src-qname</a></span> for details

Of course I am not any knid of XML Schema expert and I could have interpreted these entries incorrectly, but the XML I am using is being used by a Java program using Jaxb version 2 to interpret the XML and it definitely NEEDs the prefix in the attribute VALUE to match the prefix of the namespace that is defined earlier in the XML document. So if map_xmlns changes the prefix on the earlier definition, the value inside the xsi:type attribute needs to be modified as well.

Thanks for the quick response to my problem.... XML::Twig is awesome!!
-Roe

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: xmltwig@gmail.com via RT [mailto:bug-XML-Twig@rt.cpan.org] 
Sent: Monday, August 06, 2012 1:08 PM
To: McBurnett, Roe D
Subject: Re: [rt.cpan.org #78813] map_xmlns bug

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78813">https://rt.cpan.org/Ticket/Display.html?id=78813</a></span> &gt;

On 08/06/2012 06:50 PM, xmltwig@gmail.com via RT wrote:
<div class="message-stanza open">&gt;         Queue: XML-Twig
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78813">https://rt.cpan.org/Ticket/Display.html?id=78813</a></span> &gt;
&gt;
&gt; On 08/06/2012 05:58 PM, McBurnett, Roe D via RT wrote:
&gt;
<div class="message-stanza open">&gt;&gt; When using namespaces, it is allowed to identify an element as a 
&gt;&gt; particular type in an already defined namespace. the map_xmlns does 
&gt;&gt; not convert the namespace prefix for the types correctly.
</div>&gt;
&gt;
&gt; Actually that&#39;s pretty strange, because the behaviour you want is what 
&gt; he module should do. There is even a test, test 640 in 
&gt; t/test_additional.t that checks just this. I am trying to see how this 
&gt; test is different from your example, but so far I can&#39;t really see it.
</div>
Duh! The difference is that you want to replace xsi:type=&#34;ns2:find&#34; by xsi:type=&#34;shlsvc:find&#34;. That&#39;s the attribute _value_ that you want to replace. In XML there is nothing special about it, namespaces are not involved. So it won&#39;t be replaced.

Is this something that W3c schemas-aware processors are supposd to know about?

--
mirod


</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106700" href="/Public/Bug/Display.html?id=78813#txn-1106700">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;15:43:19&nbsp;2012</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78813] map_xmlns bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 06 Aug 2012 21:42:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106700/581880/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581880">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 08/06/2012 07:32 PM, McBurnett, Roe D via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I did a lookup in the W3 XML Schema definitions and found 2 sections
&gt; which seem to imply that YES W3c XML Schema-aware processors should
&gt; know about the imbedded type information within such an attribute.
&gt;
&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/xmlschema-1/">http://www.w3.org/TR/xmlschema-1/</a></span> section 2.6.1 and
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/xmlschema-1/#src-qname">http://www.w3.org/TR/xmlschema-1/#src-qname</a></span> for details
&gt;
&gt; Of course I am not any knid of XML Schema expert and I could have
&gt; interpreted these entries incorrectly, but the XML I am using is
&gt; being used by a Java program using Jaxb version 2 to interpret the
&gt; XML and it definitely NEEDs the prefix in the attribute VALUE to
&gt; match the prefix of the namespace that is defined earlier in the XML
&gt; document. So if map_xmlns changes the prefix on the earlier
&gt; definition, the value inside the xsi:type attribute needs to be
&gt; modified as well.
</div>
I think for now I won&#39;t integrate this into the module. I have to think 
about it some more.

In the mean time, below is a way to do this. Note that it relies on the 
internal structure of the XML::Twig object &#40;the 
$t-&gt;{twig_parser}-&gt;{Prefix_Table} thingie&#41;. I&#39;ll see how I can make this 
available in the API.

#! /usr/bin/perl

use strict;
use warnings;

use Test::More tests =&gt; 1;

use XML::Twig;



my $doc=&#39;&lt;ns1:list xmlns:ns1=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/CommandService">http://namespace/CommandService</a></span>&#34;
xmlns:ns2=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/ShelfService">http://namespace/ShelfService</a></span>&#34;
xmlns:xsi=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;&gt;
   &lt;commands&gt;
     &lt;commandId&gt;1&lt;/commandId&gt;
     &lt;command xsi:type=&#34;ns2:find&#34;&gt;
       &lt;equipmentFilter&gt;...&lt;/equipmentFilter&gt;
     &lt;/command&gt;
   &lt;/commands&gt;
   &lt;commands&gt;
     &lt;commandId&gt;2&lt;/commandId&gt;
     &lt;command xsi:type=&#34;ns2:getByName&#34;&gt;
       &lt;name&gt;...&lt;/name&gt;
     &lt;/command&gt;
   &lt;/commands&gt;
&lt;/ns1:list&gt;
&#39;;

my $expected= $doc;
$expected=~ s{ns1}{cmdsvc}g;
$expected=~ s{ns2}{shlsvc}g;

my %map= reverse &#40;cmdsvc =&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/CommandService">http://namespace/CommandService</a></span>&#34;,
                   shlsvc =&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://namespace/ShelfService">http://namespace/ShelfService</a></span>&#34;,
                   xsi    =&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a></span>&#34;,
                  &#41;;

my $x = XML::Twig-&gt;new&#40; map_xmlns =&gt; { %map },
                         twig_handlers =&gt; { &#39;*[@xsi:type]&#39; =&gt; sub {
upd_xsi_type&#40; @_, \%map&#41; } },
                         pretty_print =&gt; &#34;indented&#34;
                       &#41;;
$x-&gt;parse&#40;$doc&#41;;

is&#40; $x-&gt;sprint, $expected, &#39;xmlns&#39;&#41;;

sub upd_xsi_type
   { my&#40; $t, $elt, $map&#41;= @_;
     my $type= $elt-&gt;att&#40; &#39;xsi:type&#39;&#41;;
     my&#40; $old_prefix&#41;= $type=~ m{^&#40;[^:]*&#41;:};
     my $prefix_table= $t-&gt;{twig_parser}-&gt;{Prefix_Table};
     if&#40; my $new_prefix=  $map-&gt;{$prefix_table-&gt;{$old_prefix}-&gt;[0]}&#41;
       { $type=~ s{^$old_prefix}{$new_prefix};
         $elt-&gt;set_att&#40; &#39;xsi:type&#39; =&gt; $type&#41;;
       }
     return 1;
   }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1106717" href="/Public/Bug/Display.html?id=78813#txn-1106717">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;06&nbsp;16:02:49&nbsp;2012</span>
    <span class="description">roe.mcburnett [...] ericsson.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #78813] map_xmlns bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Aug 2012 20:02:39 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-XML-Twig [...] rt.cpan.org&#39;&#34; &lt;bug-XML-Twig [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;McBurnett, Roe D&#34; &lt;roe.mcburnett [...] ericsson.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1106717/581891/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581891">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 813b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I implemented your alternate method and it works a treat!!

I will continue to use the workaround until I hear different. Let me know if you&#39;re thinking goes in a different direction.

You are GREAT!  Thanks so much!,
-Roe

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: xmltwig@gmail.com via RT [mailto:bug-XML-Twig@rt.cpan.org] 
Sent: Monday, August 06, 2012 3:43 PM
To: McBurnett, Roe D
Subject: Re: [rt.cpan.org #78813] map_xmlns bug

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78813">https://rt.cpan.org/Ticket/Display.html?id=78813</a></span> &gt;

I think for now I won&#39;t integrate this into the module. I have to think about it some more.

In the mean time, below is a way to do this. Note that it relies on the internal structure of the XML::Twig object &#40;the $t-&gt;{twig_parser}-&gt;{Prefix_Table} thingie&#41;. I&#39;ll see how I can make this available in the API.


</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.477433</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
