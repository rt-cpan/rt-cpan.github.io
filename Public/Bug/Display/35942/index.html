<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35942 for DBIx-Class: Connections remain open even when out of scope</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35942 for DBIx-Class: Connections remain open even when out of scope</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35942</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
libithashanmugam [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.08010    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=35942">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-462347" href="/Public/Bug/Display.html?id=35942#txn-462347">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;08:57:53&nbsp;2008</span>
    <span class="description">libithashanmugam [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Connections remain open even when out of scope</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/462347/227557/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/227557">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
I have a function which makes a DBIx connect, does some search and
returns the results. I have a daemon which repeatedly calls this
function once in few seconds. What I observed is that even after
function call is done, the DB connections remain open. The connections
stays alive and keep increasing and as the max connections limit is
reached, the daemon dies because new connection fails. Once the process
exits, all the connections get closed and new connections can be made
after that. Earlier, I was using DBIx Class 0.07002 and I didn&#39;t have
this problem.

DBIx Class version: 0.08010
Perl version: 5.8.7
Operating system vendor and version: Linux &#40;Red Hat Enterprise Linux AS
release 3&#41;, 2.4.21-37.0.0.4.ELhugemem

Error message:
==========

DBI connect&#40;&#39;testcs&#39;,&#39;test&#39;,...&#41; failed: [unixODBC][TimesTen][TimesTen
7.0.1.0.0 ODBC Driver][TimesTen]TT0702: Connect failed because max
number of connections exceeded &#40;max 2048&#41; -- file &#34;db.c&#34;, lineno 9050,
procedure &#34;sbDbConnect&#34; &#40;SQL-HY000&#41;&#40;DBD: db_login/SQLConnect err=-1&#41; at
/usr/local/perl/5.8.7/lib/DBIx/Class/Storage/DBI.pm line 839
Can&#39;t call method &#34;resolve&#34; on an undefined value at
/usr/local/perl/5.8.7/lib/DBIx/Class/Row.pm line 720.

I tried the same with oracle database and found the same issue.

Sample code which can reproduce the issue:
==============================
sub connect_to_db {
my $schema = SchemaClass-&gt;connect&#40;&#41;;
}

for &#40;my $i = 0; $i &lt; 10; $i++&#41; {
connect_to_db&#40;&#41;;
}
print &#34;Press enter to quit\n&#34;;
my $key = &lt;STDIN&gt;;

You can check the number of active connections before providing input to
quit.

In my case there 6 active connections before running the script and 16
when the script prompted for input.

Could someone provide a solution to this issue?

Thanks
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-462431" href="/Public/Bug/Display.html?id=35942#txn-462431">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;11:38:24&nbsp;2008</span>
    <span class="description">wdhawes [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35942] Connections remain open even when out of scope</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 May 2008 16:36:12 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Will Hawes&#34; &lt;wdhawes [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/462431/227610/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/227610">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">2008/5/16 lisha via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Fri May 16 08:57:53 2008: Request 35942 was acted upon.
&gt; Transaction: Ticket created by lisha
&gt;       Queue: DBIx-Class
&gt;     Subject: Connections remain open even when out of scope
&gt;   Broken in: 0.08010
&gt;    Severity: Critical
&gt;       Owner: Nobody
&gt;  Requestors: libithashanmugam@yahoo.com
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35942">http://rt.cpan.org/Ticket/Display.html?id=35942</a></span> &gt;
&gt;
&gt;
&gt; Hi,
&gt; I have a function which makes a DBIx connect, does some search and
&gt; returns the results. I have a daemon which repeatedly calls this
&gt; function once in few seconds. What I observed is that even after
&gt; function call is done, the DB connections remain open. The connections
&gt; stays alive and keep increasing and as the max connections limit is
&gt; reached, the daemon dies because new connection fails. Once the process
&gt; exits, all the connections get closed and new connections can be made
&gt; after that. Earlier, I was using DBIx Class 0.07002 and I didn&#39;t have
&gt; this problem.
&gt;
&gt; DBIx Class version: 0.08010
&gt; Perl version: 5.8.7
&gt; Operating system vendor and version: Linux &#40;Red Hat Enterprise Linux AS
&gt; release 3&#41;, 2.4.21-37.0.0.4.ELhugemem
&gt;
&gt; Error message:
&gt; ==========
&gt;
&gt; DBI connect&#40;&#39;testcs&#39;,&#39;test&#39;,...&#41; failed: [unixODBC][TimesTen][TimesTen
&gt; 7.0.1.0.0 ODBC Driver][TimesTen]TT0702: Connect failed because max
&gt; number of connections exceeded &#40;max 2048&#41; -- file &#34;db.c&#34;, lineno 9050,
&gt; procedure &#34;sbDbConnect&#34; &#40;SQL-HY000&#41;&#40;DBD: db_login/SQLConnect err=-1&#41; at
&gt; /usr/local/perl/5.8.7/lib/DBIx/Class/Storage/DBI.pm line 839
&gt; Can&#39;t call method &#34;resolve&#34; on an undefined value at
&gt; /usr/local/perl/5.8.7/lib/DBIx/Class/Row.pm line 720.
&gt;
&gt; I tried the same with oracle database and found the same issue.
&gt;
&gt; Sample code which can reproduce the issue:
&gt; ==============================
&gt; sub connect_to_db {
&gt; my $schema = SchemaClass-&gt;connect&#40;&#41;;
&gt; }
&gt;
&gt; for &#40;my $i = 0; $i &lt; 10; $i++&#41; {
&gt; connect_to_db&#40;&#41;;
&gt; }
&gt; print &#34;Press enter to quit\n&#34;;
&gt; my $key = &lt;STDIN&gt;;
&gt;
&gt; You can check the number of active connections before providing input to
&gt; quit.
&gt;
&gt; In my case there 6 active connections before running the script and 16
&gt; when the script prompted for input.
&gt;
&gt; Could someone provide a solution to this issue?
&gt;
&gt; Thanks
&gt;
</div>
Maybe:

$schema-&gt;storage-&gt;disconnect&#40;&#41;;

???
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-462432" href="/Public/Bug/Display.html?id=35942#txn-462432">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;11:38:46&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-463285" href="/Public/Bug/Display.html?id=35942#txn-463285">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;19&nbsp;03:49:45&nbsp;2008</span>
    <span class="description">libithashanmugam [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> libithashanmugam [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/463285/228061/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/228061">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 16 11:38:24 2008, WDH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2008/5/16 lisha via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Fri May 16 08:57:53 2008: Request 35942 was acted upon.
&gt; &gt; Transaction: Ticket created by lisha
&gt; &gt;       Queue: DBIx-Class
&gt; &gt;     Subject: Connections remain open even when out of scope
&gt; &gt;   Broken in: 0.08010
&gt; &gt;    Severity: Critical
&gt; &gt;       Owner: Nobody
&gt; &gt;  Requestors: libithashanmugam@yahoo.com
&gt; &gt;      Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35942">http://rt.cpan.org/Ticket/Display.html?id=35942</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt; I have a function which makes a DBIx connect, does some search and
&gt; &gt; returns the results. I have a daemon which repeatedly calls this
&gt; &gt; function once in few seconds. What I observed is that even after
&gt; &gt; function call is done, the DB connections remain open. The connections
&gt; &gt; stays alive and keep increasing and as the max connections limit is
&gt; &gt; reached, the daemon dies because new connection fails. Once the process
&gt; &gt; exits, all the connections get closed and new connections can be made
&gt; &gt; after that. Earlier, I was using DBIx Class 0.07002 and I didn&#39;t have
&gt; &gt; this problem.
&gt; &gt;
&gt; &gt; DBIx Class version: 0.08010
&gt; &gt; Perl version: 5.8.7
&gt; &gt; Operating system vendor and version: Linux &#40;Red Hat Enterprise Linux AS
&gt; &gt; release 3&#41;, 2.4.21-37.0.0.4.ELhugemem
&gt; &gt;
&gt; &gt; Error message:
&gt; &gt; ==========
&gt; &gt;
&gt; &gt; DBI connect&#40;&#39;testcs&#39;,&#39;test&#39;,...&#41; failed: [unixODBC][TimesTen][TimesTen
&gt; &gt; 7.0.1.0.0 ODBC Driver][TimesTen]TT0702: Connect failed because max
&gt; &gt; number of connections exceeded &#40;max 2048&#41; -- file &#34;db.c&#34;, lineno 9050,
&gt; &gt; procedure &#34;sbDbConnect&#34; &#40;SQL-HY000&#41;&#40;DBD: db_login/SQLConnect err=-1&#41; at
&gt; &gt; /usr/local/perl/5.8.7/lib/DBIx/Class/Storage/DBI.pm line 839
&gt; &gt; Can&#39;t call method &#34;resolve&#34; on an undefined value at
&gt; &gt; /usr/local/perl/5.8.7/lib/DBIx/Class/Row.pm line 720.
&gt; &gt;
&gt; &gt; I tried the same with oracle database and found the same issue.
&gt; &gt;
&gt; &gt; Sample code which can reproduce the issue:
&gt; &gt; ==============================
&gt; &gt; sub connect_to_db {
&gt; &gt; my $schema = SchemaClass-&gt;connect&#40;&#41;;
&gt; &gt; }
&gt; &gt;
&gt; &gt; for &#40;my $i = 0; $i &lt; 10; $i++&#41; {
&gt; &gt; connect_to_db&#40;&#41;;
&gt; &gt; }
&gt; &gt; print &#34;Press enter to quit\n&#34;;
&gt; &gt; my $key = &lt;STDIN&gt;;
&gt; &gt;
&gt; &gt; You can check the number of active connections before providing input to
&gt; &gt; quit.
&gt; &gt;
&gt; &gt; In my case there 6 active connections before running the script and 16
&gt; &gt; when the script prompted for input.
&gt; &gt;
&gt; &gt; Could someone provide a solution to this issue?
&gt; &gt;
&gt; &gt; Thanks
&gt; &gt;
</div>&gt; 
&gt; Maybe:
&gt; 
&gt; $schema-&gt;storage-&gt;disconnect&#40;&#41;;
&gt; 
&gt; ???
</div>
Does this mean DBIx will not do disconnects automatically? Do we have to
do it explicitly in our code? Could you please clarify whether explicit
disconnect is a workaround or a solution?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-467107" href="/Public/Bug/Display.html?id=35942#txn-467107">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;16:25:36&nbsp;2008</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/467107/230264/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/230264">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 186b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please ask for support via the list; your script does not reproduce the
issue on any database I have access to so it&#39;s almost certainly a
problem with your setup. Ticket marked rejected.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-467110" href="/Public/Bug/Display.html?id=35942#txn-467110">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;16:25:41&nbsp;2008</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-482487" href="/Public/Bug/Display.html?id=35942#txn-482487">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;04&nbsp;06:08:43&nbsp;2008</span>
    <span class="description">libithashanmugam [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> libithashanmugam [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/482487/238446/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/238446">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 947b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 28 16:25:36 2008, MSTROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please ask for support via the list; your script does not reproduce the
&gt; issue on any database I have access to so it&#39;s almost certainly a
&gt; problem with your setup. Ticket marked rejected.
</div>
Hi,
When doing a trace of version 0.07002 of DBIx::class which doesn&#39;t have
the issue and the current version, I found a code change in
DBIx/Class/Storage/DBI.pm.

The latest version has one additional statement in sub &#39;_verify_pid&#39; of
DBIx/Class/Storage/DBI.pm.

$self-&gt;_dbh-&gt;{InactiveDestroy} = 1;

From DBI docs, I understand that if this flag is not set, the dbi handle
will be destroyed when last reference is removed. If it set, then it
means &#39;treat the handle as not-Active in the DESTROY method&#39;.

Commenting the statement solves the issue I face. But, I am not sure
about the consequences of it. Could someone tell me what is the
significance of having this statement in this file?

Thanks,
Libitha
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-482488" href="/Public/Bug/Display.html?id=35942#txn-482488">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;04&nbsp;06:08:53&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-487997" href="/Public/Bug/Display.html?id=35942#txn-487997">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;19&nbsp;19:00:41&nbsp;2008</span>
    <span class="description">mst [...] shadowcat.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35942] Connections remain open even when out of scope</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 Jul 2008 00:00:25 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> lisha via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt S Trout &lt;mst [...] shadowcat.co.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/487997/241324/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/241324">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jul 04, 2008 at 06:08:53AM -0400, lisha via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: DBIx-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35942">http://rt.cpan.org/Ticket/Display.html?id=35942</a></span> &gt;
&gt; 
&gt; On Wed May 28 16:25:36 2008, MSTROUT wrote:
<div class="message-stanza open">&gt; &gt; Please ask for support via the list; your script does not reproduce the
&gt; &gt; issue on any database I have access to so it&#39;s almost certainly a
&gt; &gt; problem with your setup. Ticket marked rejected.
</div>&gt; 
&gt; Hi,
&gt; When doing a trace of version 0.07002 of DBIx::class which doesn&#39;t have
&gt; the issue and the current version, I found a code change in
&gt; DBIx/Class/Storage/DBI.pm.
&gt; 
&gt; The latest version has one additional statement in sub &#39;_verify_pid&#39; of
&gt; DBIx/Class/Storage/DBI.pm.
&gt; 
&gt; $self-&gt;_dbh-&gt;{InactiveDestroy} = 1;
&gt; 
&gt; From DBI docs, I understand that if this flag is not set, the dbi handle
&gt; will be destroyed when last reference is removed. If it set, then it
&gt; means &#39;treat the handle as not-Active in the DESTROY method&#39;.
&gt; 
&gt; Commenting the statement solves the issue I face. But, I am not sure
&gt; about the consequences of it. Could someone tell me what is the
&gt; significance of having this statement in this file?
</div>
That&#39;s to make sure when you fork&#40;&#41; that the child process doesn&#39;t close
the parent&#39;s opened database handle.

So what I think must be happening is that you&#39;re forking having already
connected the $schema and then not freeing the copy in the parent.

As I said previously, -please- subscribe to the mailing list at

<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.scsys.co.uk/cgi-bin/mailman/listinfo/dbix-class">http://lists.scsys.co.uk/cgi-bin/mailman/listinfo/dbix-class</a></span>

and post your application code there if you want help debugging it.

This is -not- a DBIx::Class bug.

-- 
      Matt S Trout       Need help with your Catalyst or DBIx::Class project?
   Technical Director                    <span class="clickylink"><a target="new" rel="nofollow" href="http://www.shadowcat.co.uk/catalyst/">http://www.shadowcat.co.uk/catalyst/</a></span>
 Shadowcat Systems Ltd.  Want a managed development or deployment platform?
<span class="clickylink"><a target="new" rel="nofollow" href="http://chainsawblues.vox.com/">http://chainsawblues.vox.com/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.shadowcat.co.uk/servers/">http://www.shadowcat.co.uk/servers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-496799" href="/Public/Bug/Display.html?id=35942#txn-496799">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;13&nbsp;04:26:31&nbsp;2008</span>
    <span class="description">libithashanmugam [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> libithashanmugam [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/496799/245929/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/245929">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 488b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Matt,
This seems to be an issue with DBIx::Class::Storage::DBI::ODBC. Another
bug has been opened for this issue
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=38186">http://rt.cpan.org/Public/Bug/Display.html?id=38186</a></span>

Diff of working version &#40;0.07002&#41; and latest version of ODBC.pm shows
that $self-&gt;_dbh has been replaced with $self-&gt;dbh in _rebless&#40;&#41;
in the latest version of ODBC.pm. I made the change and it resolves the
issue.

Marc has checked in the fix. Will wait for the release of next version
of DBIx::Class.

Thanks,
Libitha
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-527801" href="/Public/Bug/Display.html?id=35942#txn-527801">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;02&nbsp;07:43:38&nbsp;2008</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/527801/264127/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/264127">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 335b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing tickets
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=38186">http://rt.cpan.org/Ticket/Display.html?id=38186</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35942">http://rt.cpan.org/Ticket/Display.html?id=35942</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=32654">http://rt.cpan.org/Ticket/Display.html?id=32654</a></span>

as they all seem to be resolved by
<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.catalyst.perl.org/svnweb/bast/revision/?rev=4750">http://dev.catalyst.perl.org/svnweb/bast/revision/?rev=4750</a></span>. Please test
against latest dev release to confirm the problem is take care of.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-527804" href="/Public/Bug/Display.html?id=35942#txn-527804">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;02&nbsp;07:43:43&nbsp;2008</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.582308</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
