<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #3333 for Apache-DBI: [fwd] [rt-devel] Apache::DBI 0.92 make test failure - how critical? &#40;from: mrz@intelenet.net&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #3333 for Apache-DBI: [fwd] [rt-devel] Apache::DBI 0.92 make test failure - how critical? &#40;from: mrz@intelenet.net&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Apache-DBI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Apache-DBI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Apache-DBI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Apache-DBI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Apache-DBI">Apache-DBI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">3333</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Apache-DBI/Active/">Apache-DBI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jesse [...] bestpractical.com

<br />
mrz [...] intelenet.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-1546-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.92    </td>
  </tr>
  <tr id="CF-1547-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.93    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;25&nbsp;23:44:10&nbsp;2003</span>
    <span class="description">jesse [...] bestpractical.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Aug 2003 23:40:00 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jesse Vincent &lt;jesse [...] bestpractical.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-apache-dbi [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [fwd] [rt-devel] Apache::DBI 0.92 make test failure - how critical? &#40;from: mrz@intelenet.net&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">----- Forwarded message from matthew zeier &lt;mrz@intelenet.net&gt; -----

From: matthew zeier &lt;mrz@intelenet.net&gt;
To: rt-devel@lists.fsck.com
X-Mailer: Apple Mail &#40;2.552&#41;
Subject: [rt-devel] Apache::DBI 0.92 make test failure - how critical?
List-Help: &lt;mailto:rt-devel-request@lists.fsck.com?subject=help&gt;
List-Post: &lt;mailto:rt-devel@lists.fsck.com&gt;
List-Subscribe: &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.fsck.com/mailman/listinfo/rt-devel">http://lists.fsck.com/mailman/listinfo/rt-devel</a></span>&gt;,
        &lt;mailto:rt-devel-request@lists.fsck.com?subject=subscribe&gt;
List-Id: RT Development &lt;rt-devel.lists.fsck.com&gt;
List-Unsubscribe: &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.fsck.com/mailman/listinfo/rt-devel">http://lists.fsck.com/mailman/listinfo/rt-devel</a></span>&gt;,
        &lt;mailto:rt-devel-request@lists.fsck.com?subject=unsubscribe&gt;
List-Archive: &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.fsck.com/pipermail/rt-devel/">http://lists.fsck.com/pipermail/rt-devel/</a></span>&gt;
X-Spam-Status: No, hits=-3.2 required=7.0
        tests=AWL,BAYES_01,KNOWN_MAILING_LIST,PRECEDENCE_BULK,
              USER_AGENT_APPLEMAIL
        version=2.55
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.55 &#40;1.174.2.19-2003-05-19-exp&#41;

Redhat 8.0, perl 5.8 &#40;vendor supplied&#41;.

Running &#39;make test&#39; on Apache::DBI 0.92 gives the following error:

t/10mysql....NOK 5#          got: &#39;531&#39;
#     expected: &#39;532&#39;

The code is:
    is&#40;$thread_1, $thread_2, &#34;got the same connection both times&#34;&#41;;


How critical is it that the two threads are the same?  I noticed that 
the current version I have &#40;0.91&#41; has the same error.  Is this a mysql 
issue or an Apache::DBI issue and how will that  impact RT?

--
matthew zeier - &#34;Nothing in life is to be feared.  It is only to be
understood.&#34; - Marie Curie

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_______________________________________________
rt-devel mailing list
rt-devel@lists.fsck.com
<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.fsck.com/mailman/listinfo/rt-devel">http://lists.fsck.com/mailman/listinfo/rt-devel</a></span>


<div class="message-stanza open">----- End forwarded message -----

-- 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bestpractical.com/rt">http://www.bestpractical.com/rt</a></span>  -- Trouble Ticketing. Free.
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;26&nbsp;05:02:03&nbsp;2003</span>
    <span class="description">ABH [...] cpan.org -  Requestor mrz@intelenet.net added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;26&nbsp;05:02:14&nbsp;2003</span>
    <span class="description">ABH [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[jesse@bestpractical.com - Mon Aug 25 23:44:10 2003]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Redhat 8.0, perl 5.8 &#40;vendor supplied&#41;.
&gt; 
&gt; Running &#39;make test&#39; on Apache::DBI 0.92 gives the following error:
&gt; 
&gt; t/10mysql....NOK 5#          got: &#39;531&#39;
&gt; #     expected: &#39;532&#39;
</div>
Which version of DBI.pm do you use?


 - ask
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;08&nbsp;17:13:16&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Trevor Schellhorn &lt;trevor.schellhorn-perl [...] marketingtips.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[ABH - Tue Aug 26 05:02:14 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [jesse@bestpractical.com - Mon Aug 25 23:44:10 2003]:
<div class="message-stanza open">&gt; &gt; Redhat 8.0, perl 5.8 &#40;vendor supplied&#41;.
&gt; &gt;
&gt; &gt; Running &#39;make test&#39; on Apache::DBI 0.92 gives the following error:
&gt; &gt;
&gt; &gt; t/10mysql....NOK 5#          got: &#39;531&#39;
&gt; &gt; #     expected: &#39;532&#39;
</div>&gt; 
&gt; Which version of DBI.pm do you use?
&gt; 
&gt; 
&gt;  - ask
</div>

I had the same problem.  The way I got this to work was to fix some of
the code in the unit test.  I moved the &#39;use DBI;&#39; below the BEGIN block
 and I also fixed the BEGIN block so that it did not do the test on the
&#39;$DBI::VERSION&#39;.  Here is the fixed code for the unit test:

&lt;---- code snip ----&gt;
use strict;
use Test::More tests =&gt; 7;

BEGIN {
  # trick DBI.pm into thinking we are running under mod_perl
  $ENV{MOD_PERL} = &#39;CGI-Perl&#39;;  
  $ENV{GATEWAY_INTERFACE} = &#39;CGI-Perl&#39;;  
  use_ok&#40;&#39;Apache::DBI&#39;, &#39;load Apache::DBI&#39;&#41;;
};
use DBI;

my $dbd_mysql = eval { require DBD::mysql };
&lt;---- code snip ----&gt;

That will allow the test case to pass.  The problem is that the order in
which the DBI and Apache::DBI modules are loaded.  The if/else block
required that the DBI module be loaded so that it could check the
version of DBI and set the proper environment variable.  Since DBI is
being loaded before Apache::DBI, it has no way to see that Apache::DBI
is loaded.  Removing the if/else statements and just setting both
environment variables fixes the problem.  Also moving the &#39;use DBI;&#39;
statement after the BEGIN block allows the BEGIN block to load
Apache::DBI first.  When DBI loads, it sets the proper $DBI::connect_via
 and the test cases work properly.

Trevor
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- t/10mysql.t-orig	2003-05-05 08:14:22.000000000 -0700
+++ t/10mysql.t	2003-12-08 14:12:18.000000000 -0800
@@ -1,18 +1,13 @@
 use strict;
 use Test::More tests =&gt; 7;
-use DBI;
 
 BEGIN { 
   # trick DBI.pm into thinking we are running under mod_perl
-
-  if &#40;$DBI::VERSION &gt; 1.33&#41; {
-    $ENV{MOD_PERL} = &#39;CGI-Perl&#39;;  
-  } 
-  else {  
-    $ENV{GATEWAY_INTERFACE} = &#39;CGI-Perl&#39;;  
-  }
-  use_ok&#40;&#39;Apache::DBI&#39;, &#39;load Apache::DBI&#39;&#41; 
+  $ENV{MOD_PERL} = &#39;CGI-Perl&#39;;  
+  $ENV{GATEWAY_INTERFACE} = &#39;CGI-Perl&#39;;  
+  use_ok&#40;&#39;Apache::DBI&#39;, &#39;load Apache::DBI&#39;&#41;;
 };
+use DBI;
 
 my $dbd_mysql = eval { require DBD::mysql };
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;09&nbsp;21:00:22&nbsp;2004</span>
    <span class="description">ask [...] perl.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 9 Jan 2004 18:00:12 -0800 &#40;PST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ask Bjoern Hansen &lt;ask [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-Apache-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #3333] [fwd] [rt-devel] Apache::DBI 0.92 make test failure - how critical? &#40;from: mrz@intelenet.net&#41; </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 8 Dec 2003, Guest via RT wrote:

0.93 should fix this,
        <span class="clickylink"><a target="new" rel="nofollow" href="http://develooper.com/code/Apache::DBI/Apache-DBI-0.93.tar.gz">http://develooper.com/code/Apache::DBI/Apache-DBI-0.93.tar.gz</a></span>


 - ask

-- 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.askbjoernhansen.com/">http://www.askbjoernhansen.com/</a></span> - <span class="clickylink"><a target="new" rel="nofollow" href="http://develooper.com/">http://develooper.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;17&nbsp;09:31:06&nbsp;2004</span>
    <span class="description">ABH [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;17&nbsp;09:31:06&nbsp;2004</span>
    <span class="description">ABH [...] cpan.org -  Fixed in 0.93 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;17&nbsp;09:31:06&nbsp;2004</span>
    <span class="description">ABH [...] cpan.org -  Broken in 0.92 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
