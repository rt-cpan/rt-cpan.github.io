<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42032 for Net-SCP: PATCH: keyfile option</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42032 for Net-SCP: PATCH: keyfile option</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SCP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SCP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SCP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SCP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SCP">Net-SCP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42032</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SCP/Active/">Net-SCP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
woodi [...] woodi.hu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-23124-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23125-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;29&nbsp;20:59:08&nbsp;2008</span>
    <span class="description">woodi [...] woodi.hu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::SCP</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Dec 2008 02:49:09 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> ivan-netscp_pod [...] 420.am</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Erdei Zsolt &lt;woodi [...] woodi.hu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ivan,

I do not know if you maintain the Net::SCP Module on CPAN, anyway... i
have attached a patch for Net::SCP. The user can define a ssh key for
scp during init.

kind regards,
Zsolt
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/local/share/perl/5.8.8/Net/SCP.pm	2007-10-27 01:23:02.000000000 +0200
+++ /home/woodi/watch/SCP/SCP.pm	2008-12-30 02:36:15.000000000 +0100
@@ -31,9 +31,9 @@ Net::SCP - Perl extension for secure cop
                                #allows user to type a password on tty
 
   #OO interface
-  $scp = Net::SCP-&gt;new&#40; &#34;hostname&#34;, &#34;username&#34; &#41;;
+  $scp = Net::SCP-&gt;new&#40; &#34;hostname&#34;, &#34;username&#34;, &#34;ssh key file&#34; &#41;;
   #with named params
-  $scp = Net::SCP-&gt;new&#40; { &#34;host&#34;=&gt;$hostname, &#34;user&#34;=&gt;$username } &#41;;
+  $scp = Net::SCP-&gt;new&#40; { &#34;host&#34;=&gt;$hostname, &#34;user&#34;=&gt;$username, &#34;keyfile&#34;=&gt;$keyfile } &#41;;
   $scp-&gt;get&#40;&#34;filename&#34;&#41; or die $scp-&gt;{errstr};
   $scp-&gt;put&#40;&#34;filename&#34;&#41; or die $scp-&gt;{errstr};
   #tmtowtdi
@@ -76,14 +76,20 @@ sub scp {
   my @cmd;
   if &#40; &#40; defined&#40;$interact&#41; &#38;&#38; $interact &#41;
        || &#40; defined&#40;$self-&gt;{interactive}&#41; &#38;&#38; $self-&gt;{interactive} &#41; &#41; {
+    if &#40; defined $self-&gt;{&#34;keyfile&#34;} &#41; {
+       $flags .= &#39;i&#39;.$self-&gt;{&#34;keyfile&#34;};
+    }
     @cmd = &#40; $scp, $flags, $src, $dest &#41;;
-    print join&#40;&#39; &#39;, @cmd&#41;, &#34;\n&#34;;
+    warn join&#40;&#39; &#39;, @cmd&#41;, &#34;\n&#34;;
     unless &#40; &#38;_yesno &#41; {
       $self-&gt;{errstr} = &#34;User declined&#34;;
       return 0;
     }
   } else {
     $flags .= &#39;qB&#39;;
+    if &#40; defined $self-&gt;{&#34;keyfile&#34;} &#41; {
+       $flags .= &#39;i&#39;.$self-&gt;{&#34;keyfile&#34;};
+    }
     @cmd = &#40; $scp, $flags, $src, $dest &#41;;
   }
   my&#40;$reader, $writer, $error &#41; =
@@ -148,6 +154,7 @@ hashref of named params, with the follow
 
     host - hostname
     user - username
+    keyfile - ssh private keyfile
     interactive - bool
     cwd - current working directory on remote server
 
@@ -163,6 +170,7 @@ sub new {
     $self = {
               &#39;host&#39;        =&gt; shift,
               &#39;user&#39;        =&gt; &#40; scalar&#40;@_&#41; ? shift : &#39;&#39; &#41;,
+              &#39;keyfile&#39;     =&gt; shift,
               &#39;interactive&#39; =&gt; 0,
               &#39;cwd&#39;         =&gt; &#39;&#39;,
             };
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Net::SCP;

use strict;
use vars qw&#40;$VERSION @ISA @EXPORT_OK $scp $DEBUG&#41;;
use Exporter;
use Carp;
use File::Basename;
use String::ShellQuote;
use IO::Handle;
use Net::SSH qw&#40;sshopen3&#41;;
use IPC::Open3;

@ISA = qw&#40;Exporter&#41;;
@EXPORT_OK = qw&#40; scp iscp &#41;;
$VERSION = &#39;0.08&#39;;

$scp = &#34;scp&#34;;

$DEBUG = 0;

=head1 NAME

Net::SCP - Perl extension for secure copy protocol

=head1 SYNOPSIS

  #procedural interface
  use Net::SCP qw&#40;scp iscp&#41;;
  scp&#40;$source, $destination&#41;;
  iscp&#40;$source, $destination&#41;; #shows command, asks for confirmation, and
                               #allows user to type a password on tty

  #OO interface
  $scp = Net::SCP-&gt;new&#40; &#34;hostname&#34;, &#34;username&#34;, &#34;ssh key file&#34; &#41;;
  #with named params
  $scp = Net::SCP-&gt;new&#40; { &#34;host&#34;=&gt;$hostname, &#34;user&#34;=&gt;$username, &#34;keyfile&#34;=&gt;$keyfile } &#41;;
  $scp-&gt;get&#40;&#34;filename&#34;&#41; or die $scp-&gt;{errstr};
  $scp-&gt;put&#40;&#34;filename&#34;&#41; or die $scp-&gt;{errstr};
  #tmtowtdi
  $scp = new Net::SCP;
  $scp-&gt;scp&#40;$source, $destination&#41;;

  #Net::FTP-style
  $scp = Net::SCP-&gt;new&#40;&#34;hostname&#34;&#41;;
  $scp-&gt;login&#40;&#34;user&#34;&#41;;
  $scp-&gt;cwd&#40;&#34;/dir&#34;&#41;;
  $scp-&gt;size&#40;&#34;file&#34;&#41;;
  $scp-&gt;get&#40;&#34;file&#34;&#41;;

=head1 DESCRIPTION

Simple wrappers around ssh and scp commands.

=head1 SUBROUTINES

=over 4

=item scp SOURCE, DESTINATION

Can be called either as a subroutine or a method; however, the subroutine
interface is depriciated.

Calls scp in batch mode, with the B&lt;-B&gt; B&lt;-p&gt; B&lt;-q&gt; and B&lt;-r&gt; options.
Returns false upon error, with a text error message accessable in
$scp-&gt;{errstr}.

Returns false and sets the B&lt;errstr&gt; attribute if there is an error.

=cut

sub scp {
  my $self = ref&#40;$_[0]&#41; ? shift : {};
  my&#40;$src, $dest, $interact&#41; = @_;
  my $flags = &#39;-p&#39;;
  $flags .= &#39;r&#39; unless &#38;_islocal&#40;$src&#41; &#38;&#38; ! -d $src;
  my @cmd;
  if &#40; &#40; defined&#40;$interact&#41; &#38;&#38; $interact &#41;
       || &#40; defined&#40;$self-&gt;{interactive}&#41; &#38;&#38; $self-&gt;{interactive} &#41; &#41; {
    if &#40; defined $self-&gt;{&#34;keyfile&#34;} &#41; {
       $flags .= &#39;i&#39;.$self-&gt;{&#34;keyfile&#34;};
    }
    @cmd = &#40; $scp, $flags, $src, $dest &#41;;
    warn join&#40;&#39; &#39;, @cmd&#41;, &#34;\n&#34;;
    unless &#40; &#38;_yesno &#41; {
      $self-&gt;{errstr} = &#34;User declined&#34;;
      return 0;
    }
  } else {
    $flags .= &#39;qB&#39;;
    if &#40; defined $self-&gt;{&#34;keyfile&#34;} &#41; {
       $flags .= &#39;i&#39;.$self-&gt;{&#34;keyfile&#34;};
    }
    @cmd = &#40; $scp, $flags, $src, $dest &#41;;
  }
  my&#40;$reader, $writer, $error &#41; =
    &#40; new IO::Handle, new IO::Handle, new IO::Handle &#41;;
  $writer-&gt;autoflush&#40;1&#41;;#  $error-&gt;autoflush&#40;1&#41;;
  local $SIG{CHLD} = &#39;DEFAULT&#39;;
  my $pid = open3&#40;$writer, $reader, $error, @cmd &#41;;
  waitpid $pid, 0;
  if &#40; $? &gt;&gt; 8 &#41; {
    my $errstr = join&#40;&#39;&#39;, &lt;$error&gt;&#41;;
    #chomp&#40;my $errstr = &lt;$error&gt;&#41;;
    $self-&gt;{errstr} = $errstr;
    0;
  } else {
    1;
  }
}

=item iscp SOURCE, DESTINATION

Can be called either as a subroutine or a method; however, the subroutine
interface is depriciated.

Prints the scp command to be execute, waits for the user to confirm, and
&#40;optionally&#41; executes scp, with the B&lt;-p&gt; and B&lt;-r&gt; flags.

Returns false and sets the B&lt;errstr&gt; attribute if there is an error.

=cut

sub iscp {
  if &#40; ref&#40;$_[0]&#41; &#41; {
    my $self = shift;
    $self-&gt;{&#39;interactive&#39;} = 1;
    $self-&gt;scp&#40;@_&#41;;
  } else {
    scp&#40;@_, 1&#41;;
  }
}

sub _yesno {
  print &#34;Proceed [y/N]:&#34;;
  my $x = scalar&#40;&lt;STDIN&gt;&#41;;
  $x =~ /^y/i;
}

sub _islocal {
  shift !~ /^[^:]+:/
}

=back

=head1 METHODS

=over 4

=item new HOSTNAME [ USER ] | HASHREF

This is the constructor for a new Net::SCP object.  You must specify a
hostname, and may optionally provide a user.  Alternatively, you may pass a
hashref of named params, with the following keys:

    host - hostname
    user - username
    keyfile - ssh private keyfile
    interactive - bool
    cwd - current working directory on remote server

=cut

sub new {
  my $proto = shift;
  my $class = ref&#40;$proto&#41; || $proto;
  my $self;
  if &#40; ref&#40;$_[0]&#41; &#41; {
    $self = shift;
  } else {
    $self = {
              &#39;host&#39;        =&gt; shift,
              &#39;user&#39;        =&gt; &#40; scalar&#40;@_&#41; ? shift : &#39;&#39; &#41;,
              &#39;keyfile&#39;     =&gt; shift,
              &#39;interactive&#39; =&gt; 0,
              &#39;cwd&#39;         =&gt; &#39;&#39;,
            };
  }
  bless&#40;$self, $class&#41;;
}

=item login [USER]

Compatibility method.  Optionally sets the user.

=cut

sub login {
  my&#40;$self, $user&#41; = @_;
  $self-&gt;{&#39;user&#39;} = $user if $user;
}

=item cwd CWD

Sets the cwd &#40;used for a subsequent get or put request without a full pathname&#41;.

=cut

sub cwd {
  my&#40;$self, $cwd&#41; = @_;
  $self-&gt;{&#39;cwd&#39;} = $cwd || &#39;/&#39;;
}

=item get REMOTE_FILE [, LOCAL_FILE]

Uses scp to transfer REMOTE_FILE from the remote host.  If a local filename is
omitted, uses the basename of the remote file.

=cut

sub get {
  my&#40;$self, $remote, $local&#41; = @_;
  $remote = $self-&gt;{&#39;cwd&#39;}. &#34;/$remote&#34; if $self-&gt;{&#39;cwd&#39;} &#38;&#38; $remote !~ /^\//;
  $local ||= basename&#40;$remote&#41;;
  my $source = $self-&gt;{&#39;host&#39;}. &#34;:$remote&#34;;
  $source = $self-&gt;{&#39;user&#39;}. &#39;@&#39;. $source if $self-&gt;{&#39;user&#39;};
  $self-&gt;scp&#40;$source,$local&#41;;
}

=item mkdir DIRECTORY

Makes a directory on the remote server.  Returns false and sets the B&lt;errstr&gt;
attribute on errors.

&#40;Implementation note: An ssh connection is established to the remote machine
and &#39;/bin/mkdir B&lt;-p&gt;&#39; is used to create the directory.&#41;

=cut

sub mkdir {
  my&#40;$self, $directory&#41; = @_;
  $directory = $self-&gt;{&#39;cwd&#39;}. &#34;/$directory&#34;
    if $self-&gt;{&#39;cwd&#39;} &#38;&#38; $directory !~ /^\//;
  my $host = $self-&gt;{&#39;host&#39;};
  $host = $self-&gt;{&#39;user&#39;}. &#39;@&#39;. $host if $self-&gt;{&#39;user&#39;};
  my&#40;$reader, $writer, $error &#41; =
    &#40; new IO::Handle, new IO::Handle, new IO::Handle &#41;;
  $writer-&gt;autoflush&#40;1&#41;;
  my $pid = sshopen3&#40; $host, $writer, $reader, $error,
                      &#39;/bin/mkdir&#39;, &#39;-p &#39;, shell_quote&#40;$directory&#41; &#41;;
  waitpid $pid, 0;
  if &#40; $? &gt;&gt; 8 &#41; {
    chomp&#40;my $errstr = &lt;$error&gt; || &#39;&#39;&#41;;
    $self-&gt;{errstr} = $errstr || &#34;mkdir exited with status &#34;. &#40;$?&gt;&gt;8&#41;;
    return 0;
  }
  1;
}

=item size FILE

Returns the size in bytes for the given file as stored on the remote server.
Returns 0 on error, and sets the B&lt;errstr&gt; attribute.  In the case of an actual
zero-length file on the remote server, the special value &#39;0e0&#39; is returned,
which evaluates to zero when used as a number, but is true.

&#40;Implementation note: An ssh connection is established to the remote machine
and wc is used to determine the file size.&#41;

=cut

sub size {
  my&#40;$self, $file&#41; = @_;
  $file = $self-&gt;{&#39;cwd&#39;}. &#34;/$file&#34; if $self-&gt;{&#39;cwd&#39;} &#38;&#38; $file !~ /^\//;
  my $host = $self-&gt;{&#39;host&#39;};
  $host = $self-&gt;{&#39;user&#39;}. &#39;@&#39;. $host if $self-&gt;{&#39;user&#39;};
  my&#40;$reader, $writer, $error &#41; =
    &#40; new IO::Handle, new IO::Handle, new IO::Handle &#41;;
  $writer-&gt;autoflush&#40;1&#41;;
  #sshopen2&#40;$host, $reader, $writer, &#39;wc&#39;, &#39;-c &#39;, shell_quote&#40;$file&#41; &#41;;
  my $pid =
    sshopen3&#40;$host, $writer, $reader, $error, &#39;wc&#39;, &#39;-c &#39;, shell_quote&#40;$file&#41; &#41;;
  waitpid $pid, 0;
  if &#40; $? &gt;&gt; 8 &#41; {
    chomp&#40;my $errstr = &lt;$error&gt;&#41;;
    $self-&gt;{errstr} = $errstr || &#34;wc exited with status &#34;. $?&gt;&gt;8;
    0;
  } else {
    chomp&#40; my $size = &lt;$reader&gt; || 0 &#41;;
    if &#40; $size =~ /^\s*&#40;\d+&#41;/ &#41; {
      $1 ? $1 : &#39;0e0&#39;;
    } else {
      $self-&gt;{errstr} = &#34;unparsable output from remote wc: $size&#34;;
      0;
    }
  }
}

=item put LOCAL_FILE [, REMOTE_FILE]

Uses scp to trasnfer LOCAL_FILE to the remote host.  If a remote filename is
omitted, uses the basename of the local file.

=cut

sub put {
  my&#40;$self, $local, $remote&#41; = @_;
  $remote ||= basename&#40;$local&#41;;
  $remote = $self-&gt;{&#39;cwd&#39;}. &#34;/$remote&#34; if $self-&gt;{&#39;cwd&#39;} &#38;&#38; $remote !~ /^\//;
  my $dest = $self-&gt;{&#39;host&#39;}. &#34;:$remote&#34;;
  $dest = $self-&gt;{&#39;user&#39;}. &#39;@&#39;. $dest if $self-&gt;{&#39;user&#39;};
  warn &#34;scp $local $dest\n&#34; if $DEBUG;
  $self-&gt;scp&#40;$local, $dest&#41;;
}

=item binary

Compatibility method: does nothing; returns true.

=cut

sub binary { 1; }

=item quit

Compatibility method: does nothing; returns true.

=cut

sub quit { 1; }

=back

=head1 FREQUENTLY ASKED QUESTIONS

Q: How do you supply a password to connect with ssh within a perl script
using the Net::SSH module?

A: You don&#39;t &#40;at least not with this module&#41;.  Use RSA or DSA keys.  See the
   quick help in the next section and the ssh-keygen&#40;1&#41; manpage.

A #2: See L&lt;Net::SCP::Expect&gt; instead.

Q: My script is &#34;leaking&#34; scp processes.

A: See L&lt;perlfaq8/&#34;How do I avoid zombies on a Unix system&#34;&gt;, L&lt;IPC::Open2&gt;,
L&lt;IPC::Open3&gt; and L&lt;perlfunc/waitpid&gt;.

=head1 GENERATING AND USING SSH KEYS

=over 4

=item 1 Generate keys

Type:

   ssh-keygen -t rsa

And do not enter a passphrase unless you wanted to be prompted for
one during file copying.

Here is what you will see:

   $ ssh-keygen -t rsa
   Generating public/private rsa key pair.
   Enter file in which to save the key &#40;/home/User/.ssh/id_rsa&#41;:
   Enter passphrase &#40;empty for no passphrase&#41;:

   Enter same passphrase again:

   Your identification has been saved in /home/User/.ssh/id_rsa.
   Your public key has been saved in /home/User/.ssh/id_rsa.pub.
   The key fingerprint is:
   5a:cd:2b:0a:cd:d9:15:85:26:79:40:0c:55:2a:f4:23 User@JEFF-CPU


=item 2 Copy public to machines you want to upload to

C&lt;id_rsa.pub&gt; is your public key. Copy it to C&lt;~/.ssh&gt; on target machine.

Put a copy of the public key file on each machine you want to log into.
Name the copy C&lt;authorized_keys&gt; &#40;some implementations name this file
C&lt;authorized_keys2&gt;&#41;

Then type:

     chmod 600 authorized_keys

Then make sure your home dir on the remote machine is not group or
world writeable.

=back

=head1 AUTHORS

Could really use a maintainer with enough time to at least review and apply
patches more patches.  Or the module should just be deprecated in favor of
Net::SFTP::Expect or Net::SFTP::Foreign and made into a simple compatiblity
wrapper.

Ivan Kohler &lt;ivan-netscp_pod@420.am&gt;

Major updates Anthony Deaver &lt;bishop@projectmagnus.org&gt;

Thanks to Jon Gunnip &lt;jon@soundbite.com&gt; for fixing a bug with size&#40;&#41;.

Patch for the mkdir method by Anthony Awtrey &lt;tony@awtrey.com&gt;.

Thanks to terrence brannon &lt;tbone@directsynergy.com&gt; for the documentation in
the GENERATING AND USING SSH KEYS section.

=head1 COPYRIGHT

Copyright &#40;c&#41; 2000 Ivan Kohler
Copyright &#40;c&#41; 2007 Freeside Internet Services, Inc.
All rights reserved.
This program is free software; you can redistribute it and/or modify it under
the same terms as Perl itself.

=head1 BUGS

Still has no-OO cruft.

In order to work around some problems with commercial SSH2, if the source file
is on the local system, and is not a directory, the B&lt;-r&gt; flag is omitted.
It&#39;s probably better just to use OpenSSH &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.openssh.com/">http://www.openssh.com/</a></span>&gt; which is
the de-facto standard these days anyway.

The Net::FTP-style OO stuff is kinda lame.  And incomplete.

iscp doesnt expect you to be logging into the box that you are copying to
for the first time. so it&#39;s completely clueless about how to handle  the
whole &#39;add this file to known hosts&#39; message so it just hangs after the
user hits y.  &#40;Thanks to John L. Utz III&#41;.  To avoid this, SSH to the box
once first.

=head1 SEE ALSO

For a perl implementation that does not require the system B&lt;scp&gt; command, see
L&lt;Net::SFTP&gt; instead.

For a wrapper version that allows you to use passwords, see L&lt;Net::SCP::Expect&gt;
instead.

For a wrapper version of the newer SFTP protocol, see L&lt;Net::SFTP::Foreign&gt;
instead.

L&lt;Net::SSH&gt;, L&lt;Net::SSH::Perl&gt;, L&lt;Net::SSH::Expect&gt;, L&lt;Net::SSH2&gt;,
L&lt;IPC::PerlSSH&gt;

scp&#40;1&#41;, ssh&#40;1&#41;, L&lt;IO::File&gt;, L&lt;IPC::Open2&gt;, L&lt;IPC::Open3&gt;

=cut

1;


</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;29&nbsp;21:02:48&nbsp;2008</span>
    <span class="description">ivan-pause [...] 420.am -  Subject changed from &#39;Net::SCP&#39; to &#39;PATCH: keyfile option&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;29&nbsp;21:02:49&nbsp;2008</span>
    <span class="description">ivan-pause [...] 420.am -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;29&nbsp;21:02:53&nbsp;2008</span>
    <span class="description">ivan-pause [...] 420.am -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
