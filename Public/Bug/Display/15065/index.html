<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #15065 for CGI: CGI should support &#39;Set-Cookie&#39; header</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #15065 for CGI: CGI should support &#39;Set-Cookie&#39; header</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/leejo/CGI.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI">CGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">15065</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI/Active/">CGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
williams [...] tni.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-230860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;14&nbsp;17:47:38&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CGI should support &#39;Set-Cookie&#39; header</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When using mod_perl with CGI::Cookie, the recommended way to set cookies is:

$r-&gt;headers_out-&gt;set&#40;&#39;Set-Cookie&#39; =&gt; $c&#41;;

but when running as a cgi script the recommended way to set cookies is:

print header&#40;-cookie=&gt;$c&#41;;

So here&#39;s the problem: when running as a cgi script using a mod_perl emulator &#40;such as HTML::Mason::FakeApache or Apache::Emulator&#41; we would like to use the mod_perl recommended method, so we can switch transparently between mod_perl and cgi.  However, using the &#39;Set-Cookie&#39; header does not work with *multiple* cookies, because CGI.pm only looks for multiple cookies under the &#39;Cookie&#39; or &#39;Cookies&#39; headers.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;14&nbsp;17:54:35&nbsp;2005</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attach a test case.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use lib &#39;.&#39;;
use Test::More qw&#40;no_plan&#41;;
use CGI;

$cgi= CGI-&gt;new;

like&#40;
$cgi-&gt;header&#40;&#39;-content-type&#39;,&#39;foo/fum&#39;,&#39;-set-cookie&#39;,[&#39;a=b&#39;,&#39;b=c&#39;]&#41;,
qr/Set-cookie: a=b\s+Set-cookie: b=c/si,
&#39;Set-Cookie&#39;
&#41;;

## If you have HTML::Mason installed, this will illustrate the
## problem when using the FakeApache module.
#
#use HTML::Mason::FakeApache;
#
#my $r = HTML::Mason::FakeApache-&gt;new&#40;&#41;;
#$r-&gt;err_headers_out-&gt;add&#40;&#39;Set-Cookie&#39;=&gt;&#39;a=b&#39;&#41;;
#$r-&gt;err_headers_out-&gt;add&#40;&#39;Set-Cookie&#39;=&gt;&#39;b=c&#39;&#41;;
#print $r-&gt;http_header;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;14&nbsp;17:57:28&nbsp;2005</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attach patch to fix the bug.

please apply :&#41;
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- CGI.pm	2005/10/14 21:55:50	1.1
+++ CGI.pm	2005/10/14 21:55:59
@@ -1400,7 +1400,7 @@
 
     my&#40;$type,$status,$cookie,$target,$expires,$nph,$charset,$attachment,$p3p,@other&#41; = 
 	rearrange&#40;[[&#39;TYPE&#39;,&#39;CONTENT_TYPE&#39;,&#39;CONTENT-TYPE&#39;],
-			    &#39;STATUS&#39;,[&#39;COOKIE&#39;,&#39;COOKIES&#39;],&#39;TARGET&#39;,
+			    &#39;STATUS&#39;,[&#39;COOKIE&#39;,&#39;COOKIES&#39;,&#39;SET-COOKIE&#39;],&#39;TARGET&#39;,
                             &#39;EXPIRES&#39;,&#39;NPH&#39;,&#39;CHARSET&#39;,
                             &#39;ATTACHMENT&#39;,&#39;P3P&#39;],@p&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;18:53:50&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the bug report and patch. 

I&#39;m marking this bug as &#34;rejected&#34; now only because it has been inactive
since 2005.  If you are still interested in a change in CGI.pm, you can
reply to re-open the ticket. 

   Mark


On Fri Oct 14 17:47:38 2005, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When using mod_perl with CGI::Cookie, the recommended way to set
&gt;    cookies is:
&gt; 
&gt; $r-&gt;headers_out-&gt;set&#40;&#39;Set-Cookie&#39; =&gt; $c&#41;;
&gt; 
&gt; but when running as a cgi script the recommended way to set cookies
&gt;    is:
&gt; 
&gt; print header&#40;-cookie=&gt;$c&#41;;
&gt; 
&gt; So here&#39;s the problem: when running as a cgi script using a mod_perl
&gt;    emulator &#40;such as HTML::Mason::FakeApache or Apache::Emulator&#41; we
&gt;    would like to use the mod_perl recommended method, so we can switch
&gt;    transparently between mod_perl and cgi.  However, using the &#39;Set-
&gt;    Cookie&#39; header does not work with *multiple* cookies, because
&gt;    CGI.pm only looks for multiple cookies under the &#39;Cookie&#39; or
&gt;    &#39;Cookies&#39; headers.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;18:53:50&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;18:53:51&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;19:55:25&nbsp;2009</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, it&#39;s nice to hear from someone after all this time.

Re-opening as requested. 

Is there anything else I can do?



On Mon Jul 20 18:53:50 2009, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the bug report and patch. 
&gt; 
&gt; I&#39;m marking this bug as &#34;rejected&#34; now only because it has been inactive
&gt; since 2005.  If you are still interested in a change in CGI.pm, you can
&gt; reply to re-open the ticket. 
&gt; 
&gt;    Mark
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;20&nbsp;19:55:26&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;21:08:22&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;21:11:18&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 14 17:47:38 2005, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When using mod_perl with CGI::Cookie, the recommended way to set
&gt;    cookies is:
&gt; 
&gt; $r-&gt;headers_out-&gt;set&#40;&#39;Set-Cookie&#39; =&gt; $c&#41;;
&gt; 
&gt; but when running as a cgi script the recommended way to set cookies
&gt;    is:
&gt; 
&gt; print header&#40;-cookie=&gt;$c&#41;;
&gt; 
&gt; So here&#39;s the problem: when running as a cgi script using a mod_perl
&gt;    emulator &#40;such as HTML::Mason::FakeApache or Apache::Emulator&#41; we
&gt;    would like to use the mod_perl recommended method, so we can switch
&gt;    transparently between mod_perl and cgi.  However, using the &#39;Set-
&gt;    Cookie&#39; header does not work with *multiple* cookies, because
&gt;    CGI.pm only looks for multiple cookies under the &#39;Cookie&#39; or
&gt;    &#39;Cookies&#39; headers.
</div>
I&#39;d like to understand the request better. CGI.pm does support the
&#34;Set-Cookie&#34; header... that&#39;s exactly what the cookie&#40;&#41; method is using.
Also, CGI.pm works tranparently when switching to and from mod_perl. So,
it&#39;s not clear what is requesting to be changed. 
    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;21:11:26&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;14:59:51&nbsp;2009</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CGI should support &#39;Set-Cookie&#39; header &#40;for multiple cookies&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 21 21:11:18 2009, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d like to understand the request better. CGI.pm does support the
&gt; &#34;Set-Cookie&#34; header... that&#39;s exactly what the cookie&#40;&#41; method is using.
&gt; Also, CGI.pm works tranparently when switching to and from mod_perl. So,
&gt; it&#39;s not clear what is requesting to be changed. 
&gt;     Mark
</div>
Note that the problem is with setting *MULTIPLE* cookies, as I do in the
 cgi.t test file.  CGI supports passing an arrayref if you use &#34;Cookie&#34;
or &#34;Cookies&#34; as the header, but not if you use &#34;Set-Cookie&#34;.  Set-Cookie
will pass through a scalar correctly, but an arrayref will come out with
&#34;ARRAY&#40;9393030&#41;&#34; for the cookie value.  This patch makes &#34;Set-Cookie&#34;
work the same as &#34;Cookie&#34; and &#34;Cookies&#34;.

Bottom line is that CGI and mod_perl are not compatible when trying to
set multiple cookies.  The fix for CGI is extremely simple, since it
already does the right thing, but with the wrong header label.

To illustrate:

$cgi-&gt;header&#40;&#39;-cookie&#39;=&gt;&#39;x=y&#39;&#41;      
# Set-cookie: x=y

$cgi-&gt;header&#40;&#39;-set-cookie&#39;=&gt;&#39;x=y&#39;&#41;  
# Set-cookie: x=y

$cgi-&gt;header&#40;&#39;-cookie&#39;=&gt;[&#39;x=y&#39;,&#39;a=b&#39;]&#41;      
# Set-Cookie: x=y
# Set-Cookie: a=b

$cgi-&gt;header&#40;&#39;-set-cookie&#39;=&gt;[&#39;x=y&#39;,&#39;a=b&#39;]&#41;  
# Set-cookie: ARRAY&#40;0x816607c&#41;

The patch fixes the last case.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;22&nbsp;14:59:52&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;25&nbsp;15:21:58&nbsp;2010</span>
    <span class="description">JWILLIAMS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Still broken in CGI-3.49

Jon Craig posted on the Mason-users mailing list that the redirect
function has the same bug as the header function.

Here is a new patch to fix both.
It also includes tests in t/html.t
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> cgi.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/CGI.pm	2010-01-29 07:41:54.000000000 -0700
+++ lib/CGI.pm	2010-02-25 13:10:51.000000000 -0700
@@ -1538,7 +1538,7 @@
 
     my&#40;$type,$status,$cookie,$target,$expires,$nph,$charset,$attachment,$p3p,@other&#41; = 
 	rearrange&#40;[[&#39;TYPE&#39;,&#39;CONTENT_TYPE&#39;,&#39;CONTENT-TYPE&#39;],
-			    &#39;STATUS&#39;,[&#39;COOKIE&#39;,&#39;COOKIES&#39;],&#39;TARGET&#39;,
+			    &#39;STATUS&#39;,[&#39;COOKIE&#39;,&#39;COOKIES&#39;,&#39;SET-COOKIE&#39;],&#39;TARGET&#39;,
                             &#39;EXPIRES&#39;,&#39;NPH&#39;,&#39;CHARSET&#39;,
                             &#39;ATTACHMENT&#39;,&#39;P3P&#39;],@p&#41;;
 
@@ -1640,7 +1640,7 @@
 sub redirect {
     my&#40;$self,@p&#41; = self_or_default&#40;@_&#41;;
     my&#40;$url,$target,$status,$cookie,$nph,@other&#41; = 
-         rearrange&#40;[[LOCATION,URI,URL],TARGET,STATUS,[&#39;COOKIE&#39;,&#39;COOKIES&#39;],NPH],@p&#41;;
+         rearrange&#40;[[LOCATION,URI,URL],TARGET,STATUS,[&#39;COOKIE&#39;,&#39;COOKIES&#39;,&#39;SET-COOKIE&#39;],NPH],@p&#41;;
     $status = &#39;302 Found&#39; unless defined $status;
     $url ||= $self-&gt;self_url;
     my&#40;@o&#41;;
--- t/html.t	2009-09-09 09:28:57.000000000 -0600
+++ t/html.t	2010-02-25 13:09:44.000000000 -0700
@@ -1,6 +1,6 @@
 #!/usr/local/bin/perl -w
 
-use Test::More tests =&gt; 33;
+use Test::More tests =&gt; 40;
 
 END { ok $loaded; }
 use CGI &#40; &#39;:standard&#39;, &#39;-no_debug&#39;, &#39;*h3&#39;, &#39;start_table&#39; &#41;;
@@ -125,15 +125,47 @@
 
 my $cookie =
   cookie&#40; -name =&gt; &#39;fred&#39;, -value =&gt; [ &#39;chocolate&#39;, &#39;chip&#39; ], -path =&gt; &#39;/&#39; &#41;;
-
 is $cookie, &#39;fred=chocolate&#38;chip; path=/&#39;, &#34;cookie&#40;&#41;&#34;;
 
 my $h = header&#40; -Cookie =&gt; $cookie &#41;;
-
 like $h,
   qr!^Set-Cookie: fred=chocolate&#38;chip\; path=/${CRLF}Date:.*${CRLF}Content-Type: text/html; charset=ISO-8859-1${CRLF}${CRLF}!s,
   &#34;header&#40;-cookie&#41;&#34;;
 
+$h = header&#40; &#39;-set-cookie&#39; =&gt; $cookie &#41;;
+like $h,
+  qr!^Set-[Cc]ookie: fred=chocolate&#38;chip\; path=/${CRLF}&#40;Date:.*${CRLF}&#41;?Content-Type: text/html; charset=ISO-8859-1${CRLF}${CRLF}!s,
+  &#34;header&#40;-set-cookie&#41;&#34;;
+
+my $cookie2 = 
+  cookie&#40; -name =&gt; &#39;ginger&#39;, -value =&gt; &#39;snap&#39; , -path =&gt; &#39;/&#39; &#41;;
+is $cookie2, &#39;ginger=snap; path=/&#39;, &#34;cookie2&#40;&#41;&#34;;
+
+$h = header&#40; -cookie =&gt; [ $cookie, $cookie2 ] &#41;;
+like $h,
+  qr!^Set-Cookie: fred=chocolate&#38;chip\; path=/${CRLF}Set-Cookie: ginger=snap\; path=/${CRLF}&#40;Date:.*${CRLF}&#41;?Content-Type: text/html; charset=ISO-8859-1${CRLF}${CRLF}!s,
+  &#34;header&#40;-cookie=&gt;[cookies]&#41;&#34;;
+
+$h = header&#40; &#39;-set-cookie&#39; =&gt; [ $cookie, $cookie2 ] &#41;;
+like $h,
+  qr!^Set-Cookie: fred=chocolate&#38;chip\; path=/${CRLF}Set-Cookie: ginger=snap\; path=/${CRLF}&#40;Date:.*${CRLF}&#41;?Content-Type: text/html; charset=ISO-8859-1${CRLF}${CRLF}!s,
+  &#34;header&#40;-set-cookie=&gt;[cookies]&#41;&#34;;
+
+$h = redirect&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://elsewhere.org/&#39;&#41;">http://elsewhere.org/&#39;&#41;</a></span>;
+like $h,
+  qr!Status: 302 Found${CRLF}Location: <span class="clickylink"><a target="new" rel="nofollow" href="http://elsewhere.org/!s">http://elsewhere.org/!s</a></span>,
+  &#34;redirect&#34;;
+
+$h = redirect&#40;-url=&gt;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://elsewhere.org/&#39;">http://elsewhere.org/&#39;</a></span>, -cookie=&gt;[$cookie,$cookie2]&#41;;
+like $h,
+  qr!Status: 302 Found${CRLF}Set-[Cc]ookie: \Q$cookie\E${CRLF}Set-[Cc]ookie: \Q$cookie2\E${CRLF}&#40;Date:.*${CRLF}&#41;?Location: <span class="clickylink"><a target="new" rel="nofollow" href="http://elsewhere.org/!s">http://elsewhere.org/!s</a></span>,
+  &#34;redirect with cookies&#34;;
+
+$h = redirect&#40;-url=&gt;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://elsewhere.org/&#39;">http://elsewhere.org/&#39;</a></span>, &#39;-set-cookie&#39;=&gt;[$cookie,$cookie2]&#41;;
+like $h,
+  qr!Status: 302 Found${CRLF}Set-[Cc]ookie: \Q$cookie\E${CRLF}Set-[Cc]ookie: \Q$cookie2\E${CRLF}&#40;Date:.*${CRLF}&#41;?Location: <span class="clickylink"><a target="new" rel="nofollow" href="http://elsewhere.org/!s">http://elsewhere.org/!s</a></span>,
+  &#34;redirect with set-cookies&#34;;
+
 is start_h3, &#39;&lt;h3&gt;&#39;;
 
 is end_h3, &#39;&lt;/h3&gt;&#39;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;07:58:02&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This issue has been copied to: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/leejo/CGI.pm/issues/47">https://github.com/leejo/CGI.pm/issues/47</a></span> please take all future correspondence there.
This ticket will remain open but please do not reply here.
This ticket will be closed when the github issue is dealt with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;14:27:19&nbsp;2014</span>
    <span class="description">The RT System itself -  Queue changed from CGI.pm to CGI</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;30&nbsp;15:01:45&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patches applied, thanks. Will go out with the next version.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;30&nbsp;15:01:46&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
