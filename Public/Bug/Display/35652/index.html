<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35652 for Tk: Photo&#40;-data =&gt; $string&#41; not working properly</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35652 for Tk: Photo&#40;-data =&gt; $string&#41; not working properly</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Tk">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Tk">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Tk">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Tk">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35652</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Tk">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
info [...] gknw.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




tkimgx.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/457800/225104/tkimgx.pl">
Mon May 05 22:34:36 2008 (1.2k) by info [...] gknw.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=35652">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-457800" href="/Public/Bug/Display.html?id=35652#txn-457800">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;05&nbsp;22:34:36&nbsp;2008</span>
    <span class="description">info [...] gknw.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Photo&#40;-data =&gt; $string&#41; not working properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 May 2008 04:34:42 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guenter Knauf &lt;info [...] gknw.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/457800/225103/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225103">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
while testing with Tk in order to display images I found that:
- on Linux Photo&#40;-data =&gt; $string&#41; works only with gif images
- on Win32 Photo&#40;-data =&gt; $string&#41; doesnt work at all

This is the error when using non-gif images:
couldn&#39;t recognize image data at /usr/lib/perl5/vendor_perl/5.8.8/i586-linux-thread-multi/Tk/Image.pm line 21.

I&#39;ve written a test sample to demonstrate the issue; it can take optional arguments;
without arguments -format =&gt; gif and -data =&gt; $string is used;
tkimgx.pl
works on Linux, but on Win32 it only displays a black image.
tkimgx.pl -p
tries to use -format =&gt; png, -data = $string, but produces the error message above.
tkimgx.pl -j
tries to use -format =&gt; jpeg, -data = $string, but produces the error message above.
tkimgx.pl -p -f
tkimgx.pl -j -f
use -file = &#39;image.type&#39; and work on both platforms, and:
tkimgx.pl -f
works also on Win32 with -format =&gt; gif.

Test script below and attached:

#!/usr/bin/perl -w
# CMD sample to fetch a remote web page image with LWP
# and then displays it with the Perl Tk framework.

use strict;
use LWP::UserAgent;
use Tk;
use Tk::widgets qw/PNG JPEG/;
use Tk::Dialog;
use Getopt::Std;
use vars qw/$opt_f $opt_j $opt_k $opt_p/;

getopts&#40;&#39;fjkp&#39;&#41;;

my $version = &#39;0.0.1&#39;;
my  $url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/simages/lcamel.gif&#39;">http://www.perl.org/simages/lcamel.gif&#39;</a></span>;
$url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/misc/jpg/cpan.jpg&#39;">http://www.cpan.org/misc/jpg/cpan.jpg&#39;</a></span> if &#40;$opt_j&#41;;
$url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/s/img/cpan_banner.png&#39;">http://search.cpan.org/s/img/cpan_banner.png&#39;</a></span> if &#40;$opt_p&#41;;

my $itype = substr&#40;$url, rindex&#40;$url, &#39;.&#39;&#41; + 1&#41;;
my $fname = &#39;tmp.&#39; . $itype;
$itype = &#39;jpeg&#39; if &#40;$itype eq &#39;jpg&#39;&#41;;

my $ua  = new LWP::UserAgent&#40;agent =&gt; &#34;$0/$version&#34;&#41;;
my $req = new HTTP::Request&#40;&#39;GET&#39;, $url&#41;;
my $res = $ua-&gt;request&#40;$req&#41;;
die $res-&gt;status_line . &#34;\n&#34; if &#40;!$res-&gt;is_success&#41;;
if &#40;$opt_f&#41; {
  open&#40;O,&#34;&gt;$fname&#34;&#41; or die &#34;Couldn&#39;t open $fname: $!&#34;;
  binmode O;
  print O $res-&gt;content;
  close&#40;O&#41; or die &#34;Couldn&#39;t close $fname: $!&#34;;
}

my $mw = new MainWindow;
$mw-&gt;title&#40;&#39;Tk-Image&#39;&#41;;
$mw-&gt;Label&#40;&#39;-text&#39; =&gt; $url&#41;-&gt;pack;

my $im;
if &#40;$opt_f&#41; {
  $mw-&gt;Label&#40;&#39;-text&#39; =&gt; $fname&#41;-&gt;pack;
  $im = $mw-&gt;Photo&#40;-format =&gt; $itype, -file =&gt; $fname&#41;;
} else {
  $im = $mw-&gt;Photo&#40;-format =&gt; $itype, -data =&gt; $res-&gt;content&#41;;
}
$mw-&gt;Label&#40;&#39;-image&#39; =&gt; $im&#41;-&gt;pack;

MainLoop;

if &#40;&#40;$opt_f&#41; &#38;&#38; &#40;!$opt_k&#41;&#41; {
  unlink $fname;
}

Would be great if the -data option also works with png and jpeg, and consitently on all platforms.
BTW. just a guess: perhaps there&#39;s a binmode&#40;&#41; call missing which makes the gif appear as black image on Win32?

Guenter.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/457800/225104/tkimgx.pl">Download tkimgx.pl</a><br />
<span class="downloadcontenttype">text/x-perl 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
# CMD sample to fetch a remote web page image with LWP
# and then displays it with the Perl Tk framework.

use strict;
use LWP::UserAgent;
use Tk;
use Tk::widgets qw/PNG JPEG/;
use Tk::Dialog;
use Getopt::Std;
use vars qw/$opt_f $opt_j $opt_k $opt_p/;

getopts&#40;&#39;fjkp&#39;&#41;;

my $version = &#39;0.0.1&#39;;
my  $url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/simages/lcamel.gif&#39;">http://www.perl.org/simages/lcamel.gif&#39;</a></span>;
$url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/misc/jpg/cpan.jpg&#39;">http://www.cpan.org/misc/jpg/cpan.jpg&#39;</a></span> if &#40;$opt_j&#41;;
$url = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/s/img/cpan_banner.png&#39;">http://search.cpan.org/s/img/cpan_banner.png&#39;</a></span> if &#40;$opt_p&#41;;

my $itype = substr&#40;$url, rindex&#40;$url, &#39;.&#39;&#41; + 1&#41;;
my $fname = &#39;tmp.&#39; . $itype;
$itype = &#39;jpeg&#39; if &#40;$itype eq &#39;jpg&#39;&#41;;

my $ua  = new LWP::UserAgent&#40;agent =&gt; &#34;$0/$version&#34;&#41;;
my $req = new HTTP::Request&#40;&#39;GET&#39;, $url&#41;;
my $res = $ua-&gt;request&#40;$req&#41;;
die $res-&gt;status_line . &#34;\n&#34; if &#40;!$res-&gt;is_success&#41;;
if &#40;$opt_f&#41; {
  open&#40;O,&#34;&gt;$fname&#34;&#41; or die &#34;Couldn&#39;t open $fname: $!&#34;;
  binmode O;
  print O $res-&gt;content;
  close&#40;O&#41; or die &#34;Couldn&#39;t close $fname: $!&#34;;
}

my $mw = new MainWindow;
$mw-&gt;title&#40;&#39;Tk-Image&#39;&#41;;
$mw-&gt;Label&#40;&#39;-text&#39; =&gt; $url&#41;-&gt;pack;

my $im;
if &#40;$opt_f&#41; {
  $mw-&gt;Label&#40;&#39;-text&#39; =&gt; $fname&#41;-&gt;pack;
  $im = $mw-&gt;Photo&#40;-format =&gt; $itype, -file =&gt; $fname&#41;;
} else {
  $im = $mw-&gt;Photo&#40;-format =&gt; $itype, -data =&gt; $res-&gt;content&#41;;
}
$mw-&gt;Label&#40;&#39;-image&#39; =&gt; $im&#41;-&gt;pack;

MainLoop;

if &#40;&#40;$opt_f&#41; &#38;&#38; &#40;!$opt_k&#41;&#41; {
  unlink $fname;
}

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458025" href="/Public/Bug/Display.html?id=35652#txn-458025">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;15:24:23&nbsp;2008</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35652] Photo&#40;-data =&gt; $string&#41; not working properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 06 May 2008 21:22:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/458025/225200/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225200">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Guenter Knauf via RT&#34; &lt;bug-Tk@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon May 05 22:34:36 2008: Request 35652 was acted upon.
&gt; Transaction: Ticket created by info@gknw.de
&gt;        Queue: Tk
&gt;      Subject: Photo&#40;-data =&gt; $string&#41; not working properly
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: info@gknw.de
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35652">http://rt.cpan.org/Ticket/Display.html?id=35652</a></span> &gt;
&gt; 
&gt; 
&gt; Hi,
&gt; while testing with Tk in order to display images I found that:
&gt; - on Linux Photo&#40;-data =&gt; $string&#41; works only with gif images
&gt; - on Win32 Photo&#40;-data =&gt; $string&#41; doesnt work at all
&gt; 
&gt; This is the error when using non-gif images:
&gt; couldn&#39;t recognize image data at /usr/lib/perl5/vendor_perl/5.8.8/i586-linux-thread-multi/Tk/Image.pm line 21.
&gt; 
&gt; I&#39;ve written a test sample to demonstrate the issue; it can take optional arguments;
&gt; without arguments -format =&gt; gif and -data =&gt; $string is used;
&gt; tkimgx.pl
&gt; works on Linux, but on Win32 it only displays a black image.
&gt; tkimgx.pl -p
&gt; tries to use -format =&gt; png, -data = $string, but produces the error message above.
&gt; tkimgx.pl -j
&gt; tries to use -format =&gt; jpeg, -data = $string, but produces the error message above.
&gt; tkimgx.pl -p -f
&gt; tkimgx.pl -j -f
&gt; use -file = &#39;image.type&#39; and work on both platforms, and:
&gt; tkimgx.pl -f
&gt; works also on Win32 with -format =&gt; gif.
&gt; 
&gt; Test script below and attached:
&gt; 
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Would be great if the -data option also works with png and jpeg, and consitently on all platforms.
&gt; BTW. just a guess: perhaps there&#39;s a binmode&#40;&#41; call missing which makes the gif appear as black image on Win32?
&gt; 
</div>
Tk::Photo traditionally only accepted base64 encoded data for the
-data option &#40;this is an unlucky heritage of the Tcl roots of Tk&#41;.
Since Tk804.028 there&#39;s at least support for binary GIF data. I
suspect that your Windows box only runs Tk804.027 which does not have
this feature yet. Support for binary JPEG and PNG data may appear in
next versions. I admit that the documentation is not clear in this
topic, but at least base64 is mentioned there.

To fix your script, just add

use MIME::Base64 qw/encode_base64/;

to the top and use

  $im = $mw-&gt;Photo&#40;-format =&gt; $itype, -data =&gt; encode_base64 $res-&gt;content&#41;;

to create the Photo object.

Regards,
    Slaven

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de

    tkruler - Perl/Tk program for measuring screen distances
    <span class="clickylink"><a target="new" rel="nofollow" href="http://ptktools.sourceforge.net/#tkruler">http://ptktools.sourceforge.net/#tkruler</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458026" href="/Public/Bug/Display.html?id=35652#txn-458026">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;15:24:27&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458104" href="/Public/Bug/Display.html?id=35652#txn-458104">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;20:04:38&nbsp;2008</span>
    <span class="description">info [...] gknw.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35652] Photo&#40;-data =&gt; $string&#41; not working properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 May 2008 02:04:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guenter Knauf &lt;info [...] gknw.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/458104/225262/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225262">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Slaven,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tk::Photo traditionally only accepted base64 encoded data for the
&gt; -data option &#40;this is an unlucky heritage of the Tcl roots of Tk&#41;.
&gt; Since Tk804.028 there&#39;s at least support for binary GIF data. I
&gt; suspect that your Windows box only runs Tk804.027 which does not have
&gt; this feature yet. Support for binary JPEG and PNG data may appear in
&gt; next versions. I admit that the documentation is not clear in this
&gt; topic, but at least base64 is mentioned there.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To fix your script, just add
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use MIME::Base64 qw/encode_base64/;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; to the top and use
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   $im = $mw-&gt;Photo&#40;-format =&gt; $itype, -data =&gt; encode_base64
&gt;   $res-&gt;content&#41;;
</div>
thank you very much! That works now great on both Linux and Win32.
Although I found in one bug report &#40;the one with the memory leak&#41; that the o.p. used base64, I didnt realize that it might be mandatory, especially since it worked for gif without.

Ok, so you might close this bug now, and probably also add a sentence to the docu that base64 is mandatory unless you make binary format available too for png and jpeg...
BTW, what about tiff? Any plans to bundle this also?

Thanks, Guenter.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458106" href="/Public/Bug/Display.html?id=35652#txn-458106">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;20:07:42&nbsp;2008</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35652] Photo&#40;-data =&gt; $string&#41; not working properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 May 2008 17:07:17 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guenter Knauf via RT &lt;bug-Tk [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/458106/225264/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225264">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 394b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, May 06, 2008 at 08:04:41PM -0400, Guenter Knauf via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ok, so you might close this bug now, and probably also add a sentence to the docu that base64 is mandatory unless you make binary format available too for png and jpeg...
&gt; BTW, what about tiff? Any plans to bundle this also?
</div>
IMO, GD format is more important.  Then one would just add TIFF input
to GD.  ;-&#41;

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458109" href="/Public/Bug/Display.html?id=35652#txn-458109">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;21:17:00&nbsp;2008</span>
    <span class="description">info [...] gknw.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35652] Photo&#40;-data =&gt; $string&#41; not working properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 May 2008 03:17:17 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guenter Knauf &lt;info [...] gknw.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/458109/225267/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225267">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 399b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ilya,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; IMO, GD format is more important.  Then one would just add TIFF input
&gt; to GD.  ;-&#41;
</div>well, in fact we have already TIFF support in the next upcoming libgd - we would need to get Lincoln Stein then to add it to GD...
and BTW. we have also recently got BMP support in libgd....
just not sure if these are only with libgd 2.1, or also for current 2.0 line.... 

nice eh?!

greetz, Guenter.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-458665" href="/Public/Bug/Display.html?id=35652#txn-458665">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;07&nbsp;16:50:21&nbsp;2008</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35652] Photo&#40;-data =&gt; $string&#41; not working properly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 07 May 2008 22:47:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/458665/225584/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/225584">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Guenter Knauf via RT&#34; &lt;bug-Tk@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Tk
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35652">http://rt.cpan.org/Ticket/Display.html?id=35652</a></span> &gt;
&gt; 
&gt; Hi Slaven,
<div class="message-stanza open">&gt; &gt; Tk::Photo traditionally only accepted base64 encoded data for the
&gt; &gt; -data option &#40;this is an unlucky heritage of the Tcl roots of Tk&#41;.
&gt; &gt; Since Tk804.028 there&#39;s at least support for binary GIF data. I
&gt; &gt; suspect that your Windows box only runs Tk804.027 which does not have
&gt; &gt; this feature yet. Support for binary JPEG and PNG data may appear in
&gt; &gt; next versions. I admit that the documentation is not clear in this
&gt; &gt; topic, but at least base64 is mentioned there.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; To fix your script, just add
</div>&gt; 
<div class="message-stanza open">&gt; &gt; use MIME::Base64 qw/encode_base64/;
</div>&gt; 
<div class="message-stanza open">&gt; &gt; to the top and use
</div>&gt; 
<div class="message-stanza open">&gt; &gt;   $im = $mw-&gt;Photo&#40;-format =&gt; $itype, -data =&gt; encode_base64
&gt; &gt;   $res-&gt;content&#41;;
</div>&gt; 
&gt; thank you very much! That works now great on both Linux and Win32.
&gt; Although I found in one bug report &#40;the one with the memory leak&#41; that the o.p. used base64, I didnt realize that it might be mandatory, especially since it worked for gif without.
&gt; 
&gt; Ok, so you might close this bug now, and probably also add a sentence to the docu that base64 is mandatory unless you make binary format available too for png and jpeg...
&gt; BTW, what about tiff? Any plans to bundle this also?
&gt; 
</div>
No, I don&#39;t think so. The Perl/Tk was distribution always had zero
dependencies &#40;well almost, you need the X11 libraries and include
files&#41;. For Tk::PNG and Tk::JPEG the complete libpng, zlib and libjpeg
are bundled together with Perl/Tk. I am reluctant to do the same with
Tk::TIFF, because it&#39;s a rather uncommon image format.

There&#39;s Tk::TIFF at CPAN, and this should be sufficient, I think.

Regards,
    Slaven
   

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de

    tktimex - time recording tool
    <span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/projects/ptktools/">http://sourceforge.net/projects/ptktools/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-507859" href="/Public/Bug/Display.html?id=35652#txn-507859">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;12&nbsp;18:00:17&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.452227</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
