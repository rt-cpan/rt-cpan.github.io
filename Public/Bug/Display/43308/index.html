<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43308 for Net-Pcap: pcap_loop crashes when interrupted by a signal</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43308 for Net-Pcap: pcap_loop crashes when interrupted by a signal</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Pcap/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Pcap/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Pcap/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Pcap/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Pcap">Net-Pcap CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43308</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Pcap/Active/">Net-Pcap</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
franck.mail [...] dthconnex.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-22994-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.16    </td>
  </tr>
  <tr id="CF-22995-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.17    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;15&nbsp;06:36:50&nbsp;2009</span>
    <span class="description">franck.mail [...] dthconnex.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pcap_loop crashes when interrupted by a signal</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello SÃ©bastien,

This makes fwknop raise a segmentation fault on i386 architectures as 
mentionned in:
<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432</a></span>

Martin Ferrari has submitted the following patch and a test script 
that allows a way to easily reproduce the problem through the test.pl 
script.

Is there any reason to allow the call of the pcap_loop to be 
interrupted?

If the behavior has to be changed as done by the patch, I will either 
patch the Debian package currently in Debian Sid or import the new 
release if you intend to do so.

Regards,

---
Franck Joncourt
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
 
use Net::Pcap;
 
my $err = &#39;&#39;;
 
my $pcap = Net::Pcap::open_live&#40;&#39;lo&#39;, 1024, 1, 0, \$err&#41;;
 
Net::Pcap::loop&#40;$pcap, 10, \&#38;process_packet, &#34;just for the demo&#34;&#41;;
 
Net::Pcap::close&#40;$pcap&#41;;
 
sub process_packet {
        my&#40;$user_data, $header, $packet&#41; = @_;
        local $SIG{CHLD} = \&#38;sigchld;
        system&#40;&#34;echo foo&#34;&#41;;
}
 
sub sigchld {
        print &#34;SIGCHLD\n&#34;;
}
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> signal_handler.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From: Franck Joncourt &lt;franck.mail@dthconnex.com&gt;
Subject: [PATCH] fixes/signal_handler

We do not allow pcap_loop function to be interrupted by a signal.

This makes fwknop raise a segmentation fault on i386 as mentionned in:
<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432</a></span>

Martin Ferrari has submitted the following patch and a test script that allows
a way to easily reproduce the problem.

Signed-off-by: Franck Joncourt &lt;franck.mail@dthconnex.com&gt;

---
 Pcap.xs |    3 ---
 1 files changed, 0 insertions&#40;+&#41;, 3 deletions&#40;-&#41;

diff --git a/Pcap.xs b/Pcap.xs
index a49138c..ca3ad16 100644
--- a/Pcap.xs
+++ b/Pcap.xs
@@ -410,10 +410,7 @@ pcap_loop&#40;p, cnt, callback, user&#41;
 		callback_fn = newSVsv&#40;callback&#41;;
 		user = newSVsv&#40;user&#41;;
 
-		SAVE_signals = PL_signals;  /* Allow the call to be interrupted by signals */
-		PL_signals |= PERL_SIGNALS_UNSAFE_FLAG;
 		RETVAL = pcap_loop&#40;p, cnt, callback_wrapper, &#40;u_char *&#41;user&#41;;
-		PL_signals = SAVE_signals;
 
 		SvREFCNT_dec&#40;user&#41;;
 		SvREFCNT_dec&#40;callback_fn&#41;;
-- 
tg: &#40;22e6285..&#41; fixes/signal_handler &#40;depends on: master&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;15&nbsp;19:48:53&nbsp;2009</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43308] pcap_loop crashes when interrupted by a signal </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Feb 2009 01:48:30 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Pcap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Franck Joncourt wrote via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello SÃ©bastien,
</div>
Hello Franck,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This makes fwknop raise a segmentation fault on i386 architectures as
&gt; mentionned in:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432</a></span>
&gt;
&gt; Martin Ferrari has submitted the following patch and a test script
&gt; that allows a way to easily reproduce the problem through the test.pl
&gt; script.
&gt;
&gt; Is there any reason to allow the call of the pcap_loop to be
&gt; interrupted?
</div>
So that one can use alarm&#40;&#41; and interrupt pcap_loop&#40;&#41; with it. See  
CPAN-RT#6320:
   Â» <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=6320">http://rt.cpan.org/Public/Bug/Display.html?id=6320</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If the behavior has to be changed as done by the patch, I will either
&gt; patch the Debian package currently in Debian Sid or import the new
&gt; release if you intend to do so.
&gt;
&gt; Regards,
&gt;
&gt; ---
&gt; Franck Joncourt&lt;test.pl&gt;From: Franck Joncourt  
&gt; &lt;franck.mail@dthconnex.com&gt;
&gt; Subject: [PATCH] fixes/signal_handler
&gt;
&gt; We do not allow pcap_loop function to be interrupted by a signal.
&gt;
&gt; This makes fwknop raise a segmentation fault on i386 as mentionned in:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508432</a></span>
&gt;
&gt; Martin Ferrari has submitted the following patch and a test script  
&gt; that allows
&gt; a way to easily reproduce the problem.
</div>
As I already wrote in the Debian ticket, I can&#39;t reproduce the  
problem on Debian etch x86 using the test case Martin submitted.

As I just wrote, allowing pcap_loop&#40;&#41; to be interrupted by any signal  
was added on purpose. Now, something I didn&#39;t do back then was to  
provide a way to control whether signals are allowed to interrupt  
pcap_loop&#40;&#41; and similar functions.

Would that be enough for you?


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;15&nbsp;19:48:54&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;16&nbsp;09:07:48&nbsp;2009</span>
    <span class="description">martin.ferrari [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> martin.ferrari [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 15 19:48:53 2009, SAPER wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Is there any reason to allow the call of the pcap_loop to be
&gt; &gt; interrupted?
</div>&gt; 
&gt; So that one can use alarm&#40;&#41; and interrupt pcap_loop&#40;&#41; with it. See  
&gt; CPAN-RT#6320:
&gt;    Â» <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Public/Bug/Display.html?id=6320">http://rt.cpan.org/Public/Bug/Display.html?id=6320</a></span>
</div>
The problem is that by setting signals to be unsafe, well.. you get
crashes in perl :&#41; Maybe an alternative would be to modify the XS code
to call pcap_breakloop when a deferred signal is received, but I don&#39;t
know how to do that.

If you want to maintain this behaviour, I think you should put a big fat
note about it in the documentation so other programmers don&#39;t assume
they can do fancy things in signal handlers as they do usually with safe
signals. And we then can ask the fwknop people to use my workaround.

In this particular case, nothing too fancy is being done in the signal
handler, but it&#39;s too complex to understand really what&#39;s going on &#40;the
actual crash seems to be a double free while exiting the scope of the
signal handler&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Martin Ferrari has submitted the following patch and a test script  
&gt; &gt; that allows
&gt; &gt; a way to easily reproduce the problem.
</div>&gt; 
&gt; As I already wrote in the Debian ticket, I can&#39;t reproduce the  
&gt; problem on Debian etch x86 using the test case Martin submitted.
</div>
Please see my other mail.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As I just wrote, allowing pcap_loop&#40;&#41; to be interrupted by any signal  
&gt; was added on purpose. Now, something I didn&#39;t do back then was to  
&gt; provide a way to control whether signals are allowed to interrupt  
&gt; pcap_loop&#40;&#41; and similar functions.
&gt; 
&gt; Would that be enough for you?
</div>
Aside from my previous suggestion, which is for signal handlers that are
invoked at any time, you could disable unsafe signals during the
execution of the callback code, there&#39;s no need to have them while
executing perl code.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;16&nbsp;15:51:20&nbsp;2009</span>
    <span class="description">franck.mail [...] dthconnex.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi SÃ©bastien,

On Sun Feb 15 19:48:53 2009, SAPER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Franck Joncourt wrote via RT:
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As I already wrote in the Debian ticket, I can&#39;t reproduce the  
&gt; problem on Debian etch x86 using the test case Martin submitted.
</div>
If you need an access to a Debian Sid i386, I can help you :&#41;
&#40;From Etch to Sid on amd64/i386&#41; If you want me to do some tests and 
give you a feedback, let me know.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As I just wrote, allowing pcap_loop&#40;&#41; to be interrupted by any 
</div>signal  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; was added on purpose. Now, something I didn&#39;t do back then was to  
&gt; provide a way to control whether signals are allowed to interrupt  
&gt; pcap_loop&#40;&#41; and similar functions.
&gt; 
&gt; Would that be enough for you?
</div>
I have sent an email to fwknop upstream to know what he thinks about 
all that.

  - update Fwknop according to the current behavior
  - allow a way to enable/disable interruption
  ...

On that subject I cannot judge what is better for all of us. So at the 
moment, I will wait for a reply of M Rash.

Regards,

---
Franck Joncourt,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;19:28:17&nbsp;2009</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43308] pcap_loop crashes when interrupted by a signal </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Mar 2009 01:27:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Pcap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,


MartÃ­n Ferrari wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem is that by setting signals to be unsafe, well.. you get
&gt; crashes in perl :&#41; Maybe an alternative would be to modify the XS code
&gt; to call pcap_breakloop when a deferred signal is received, but I don&#39;t
&gt; know how to do that.
&gt;
&gt; If you want to maintain this behaviour, I think you should put a  
&gt; big fat
&gt; note about it in the documentation so other programmers don&#39;t assume
&gt; they can do fancy things in signal handlers as they do usually with  
&gt; safe
&gt; signals. And we then can ask the fwknop people to use my workaround.
</div>
I&#39;d say many Perl users don&#39;t know how signals are actually handled.  
In fact, more than a few are surprised that signals are not  
immediately delivered. IIRC, I added this code to Net::Pcap because I  
had a couple of requests &#40;by private mail, not on CPAN-RT&#41; to modify  
Net::Pcap so it behaves this way.

I also remember explaining this to a couple of colleagues, and how to  
enable &#34;unsafe&#34; signals.

Also, remember that Perl5 porters have very high standards in terms  
of portability, safeness, correctness, etc. Right, immediate signals  
delivery is labelled &#34;unsafe&#34;, but that doesn&#39;t mean that it makes  
Perl *that* less stable. See threads, which are still not considered  
production-ready by some porters, even though many people are happily  
using it.

Finally, note that after I discussed with RafaÃ«l Garcia-Suarez  
&#40;current bleadperl pumpking&#41; about safe/unsafe signals, he wrote  
Perl::Unsafe::Signals to allow an author to locally disable safe  
signals delivery.
   Â» <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Perl-Unsafe-Signals/">http://search.cpan.org/dist/Perl-Unsafe-Signals/</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; As I already wrote in the Debian ticket, I can&#39;t reproduce the
&gt;&gt; problem on Debian etch x86 using the test case Martin submitted.
</div>&gt;
&gt;
&gt; Please see my other mail.
</div>

I saw. I tried on the Debian sid I installed on my PS3 &#40;that&#39;s a  
PowerPC&#41; but still can&#39;t reproduce the problem. I also tried on my  
machine at work, an x86-64, with no more luck. Seems to be really  
tied to the x86-32 architecture, or to a recent version of libpcap.


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;28&nbsp;15:47:27&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;28&nbsp;15:47:27&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Fixed in 0.17 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
