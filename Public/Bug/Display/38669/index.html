<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38669 for POE: Data::Transform support</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38669 for POE: Data::Transform support</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/POE/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/POE/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/POE/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/POE/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/POE">POE CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38669</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/POE/Active/">POE</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">RCAPUTO [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
martijn [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-26342-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26343-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;16:03:20&nbsp;2008</span>
    <span class="description">martijn [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Data::Transform support</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So, I uploaded a first version of Data::Transform to CPAN today, and I
thought I&#39;d add a ticket with the patches to POE I would like to see for
it. &#40;NOTE: these aren&#39;t final, ready-to-apply patches, but more a
starting point for discussion&#41;

There isn&#39;t very much to them. One is a patch for POE::Wheel::ReadWrite
to send special packets right back into the driver without a round-trip
to the user &#40;mostly needed for the ssl protocol in the upcoming
Data::Transform::SSL&#41;. Patches like this one are possibly needed for
some other Wheels, but I haven&#39;t yet looked into that.

The other two are patches to PoCo::*::TCP to send an EOF packet through
the filter chain &#40;which may or may not end up generating a network
packet&#41;, so you can cleanly end the connection for protocols that send a
&#39;goodbye&#39; message.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> data-transform.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur ../poe/lib/POE/Component/Client/TCP.pm lib/POE/Component/Client/TCP.pm
--- ../poe/lib/POE/Component/Client/TCP.pm	2008-07-15 23:47:51.000000000 +0200
+++ lib/POE/Component/Client/TCP.pm	2008-08-07 20:22:50.000000000 +0200
@@ -274,6 +274,7 @@
           if &#40;$heap-&gt;{connected}&#41; {
             $heap-&gt;{connected} = 0;
             if &#40;defined $heap-&gt;{server}&#41; {
+              $heap-&gt;{server}-&gt;put&#40;Data::Transform::Meta::EOF-&gt;new&#40;&#41;&#41;;
               if &#40;
                 $heap-&gt;{got_an_error} or
                 not $heap-&gt;{server}-&gt;get_driver_out_octets&#40;&#41;
diff -ur ../poe/lib/POE/Component/Server/TCP.pm lib/POE/Component/Server/TCP.pm
--- ../poe/lib/POE/Component/Server/TCP.pm	2008-07-15 23:47:51.000000000 +0200
+++ lib/POE/Component/Server/TCP.pm	2008-08-07 20:22:35.000000000 +0200
@@ -261,6 +261,7 @@
               my $heap = $_[HEAP];
               $heap-&gt;{shutdown} = 1;
               if &#40;defined $heap-&gt;{client}&#41; {
+                $heap-&gt;{client}-&gt;put&#40;Data::Transform::Meta::EOF-&gt;new&#40;&#41;&#41;;
                 if &#40;
                   $heap-&gt;{got_an_error} or
                   not $heap-&gt;{client}-&gt;get_driver_out_octets&#40;&#41;
Only in ../poe/lib/POE/: Component.pm
Only in ../poe/lib/POE/: Driver
Only in ../poe/lib/POE/: Driver.pm
Only in ../poe/lib/POE/Filter: Block.pm
Only in ../poe/lib/POE/Filter: Grep.pm
Only in ../poe/lib/POE/Filter: HTTPD.pm
Only in ../poe/lib/POE/Filter: Line.pm
Only in ../poe/lib/POE/Filter: Map.pm
Only in ../poe/lib/POE/Filter: RecordBlock.pm
Only in ../poe/lib/POE/Filter: Reference.pm
Only in ../poe/lib/POE/Filter: Stackable.pm
Only in ../poe/lib/POE/Filter: Stream.pm
Only in ../poe/lib/POE/: Filter.pm
Only in ../poe/lib/POE/: Kernel.pm
Only in ../poe/lib/POE/: Loader.pm
Only in ../poe/lib/POE/: Loop
Only in ../poe/lib/POE/: Loop.pm
Only in ../poe/lib/POE/: NFA.pm
Only in ../poe/lib/POE/: Pipe
Only in ../poe/lib/POE/: Pipe.pm
Only in ../poe/lib/POE/: Queue
Only in ../poe/lib/POE/: Queue.pm
Only in ../poe/lib/POE/: Resource
Only in ../poe/lib/POE/: Resource.pm
Only in ../poe/lib/POE/: Resources.pm
Only in ../poe/lib/POE/: Session.pm
Only in ../poe/lib/POE/Wheel: Curses.pm
Only in ../poe/lib/POE/Wheel: FollowTail.pm
Only in ../poe/lib/POE/Wheel: ListenAccept.pm
Only in ../poe/lib/POE/Wheel: ReadLine.pm
diff -ur ../poe/lib/POE/Wheel/ReadWrite.pm lib/POE/Wheel/ReadWrite.pm
--- ../poe/lib/POE/Wheel/ReadWrite.pm	2008-06-27 11:40:25.000000000 +0200
+++ lib/POE/Wheel/ReadWrite.pm	2008-08-22 21:36:37.000000000 +0200
@@ -8,6 +8,7 @@
 $VERSION = do {my&#40;$r&#41;=&#40;q$Revision$=~/&#40;\d+&#41;/&#41;;sprintf&#34;1.%04d&#34;,$r};
 
 use Carp qw&#40; croak carp &#41;;
+use Scalar::Util qw&#40;blessed&#41;;
 use POE qw&#40;Wheel Driver::SysRW Filter::Line&#41;;
 
 # Offsets into $self.
@@ -256,6 +257,7 @@
     my $driver       = $self-&gt;[DRIVER_BOTH];
     my $input_filter = \$self-&gt;[FILTER_INPUT];
     my $event_input  = \$self-&gt;[EVENT_INPUT];
+    my $handle_output  = $self-&gt;[HANDLE_OUTPUT];
     my $event_error  = \$self-&gt;[EVENT_ERROR];
     my $unique_id    = $self-&gt;[UNIQUE_ID];
 
@@ -281,6 +283,13 @@
               my $next_rec = $$input_filter-&gt;get_one&#40;&#41;;
               last unless @$next_rec;
               foreach my $cooked_input &#40;@$next_rec&#41; {
+                if &#40;blessed &#40;$cooked_input&#41;&#41; {
+                  if &#40;$cooked_input-&gt;isa&#40;&#39;Data::Transform::Meta::SENDBACK&#39;&#41;&#41; {
+                    $driver-&gt;put&#40;[$cooked_input-&gt;data]&#41;;
+                    $k-&gt;select_resume_write&#40;$handle_output&#41;;
+                    next;
+                  }
+                }
                 $k-&gt;call&#40;$me, $$event_input, $cooked_input, $unique_id&#41;;
               }
             }
@@ -473,6 +482,12 @@
         my $next_rec = $self-&gt;[FILTER_INPUT]-&gt;get_one&#40;&#41;;
         last unless @$next_rec;
         foreach my $cooked_input &#40;@$next_rec&#41; {
+              if &#40;blessed &#40;$cooked_input&#41; and
+                           $cooked_input-&gt;isa&#40;&#39;Data::Transform::Meta::SENDBACK&#39;&#41;&#41; {
+                $self-&gt;[DRIVER_BOTH]-&gt;put&#40;[$cooked_input-&gt;{data}]&#41;;
+                $poe_kernel-&gt;select_resume_write&#40;$self-&gt;[HANDLE_OUTPUT]&#41;;
+                next;
+              }
           $poe_kernel-&gt;call&#40;
             $poe_kernel-&gt;get_active_session&#40;&#41;,
             $self-&gt;[EVENT_INPUT],
Only in ../poe/lib/POE/Wheel: Run.pm
Only in ../poe/lib/POE/Wheel: SocketFactory.pm
Only in ../poe/lib/POE/: Wheel.pm
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;26&nbsp;16:31:24&nbsp;2008</span>
    <span class="description">martijn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Update the patch to Wheel::ReadWrite to filter out Data::Transform::Meta
packets on put, either before putting filter output in the driver &#40;for
Data::Transform filters&#41; or before putting data into the filter &#40;for
POE::Filter filters&#41;

now passes wheel_readwrite.t, comp_tcp.t and comp_tcp_concurrent.t.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur poe/lib/POE/Component/Client/TCP.pm Data-Transform/lib/POE/Component/Client/TCP.pm
--- poe/lib/POE/Component/Client/TCP.pm	2008-07-15 23:47:51.000000000 +0200
+++ Data-Transform/lib/POE/Component/Client/TCP.pm	2008-08-26 22:21:09.000000000 +0200
@@ -10,6 +10,8 @@
 use Carp qw&#40;carp croak&#41;;
 use Errno qw&#40;ETIMEDOUT ECONNRESET&#41;;
 
+use Data::Transform::Meta;
+
 # Explicit use to import the parameter constants;
 use POE::Session;
 use POE::Driver::SysRW;
@@ -274,6 +276,7 @@
           if &#40;$heap-&gt;{connected}&#41; {
             $heap-&gt;{connected} = 0;
             if &#40;defined $heap-&gt;{server}&#41; {
+              $heap-&gt;{server}-&gt;put&#40;Data::Transform::Meta::EOF-&gt;new&#40;&#41;&#41;;
               if &#40;
                 $heap-&gt;{got_an_error} or
                 not $heap-&gt;{server}-&gt;get_driver_out_octets&#40;&#41;
diff -ur poe/lib/POE/Component/Server/TCP.pm Data-Transform/lib/POE/Component/Server/TCP.pm
--- poe/lib/POE/Component/Server/TCP.pm	2008-07-15 23:47:51.000000000 +0200
+++ Data-Transform/lib/POE/Component/Server/TCP.pm	2008-08-26 22:21:37.000000000 +0200
@@ -11,6 +11,8 @@
 use Socket qw&#40;INADDR_ANY inet_ntoa inet_aton AF_INET AF_UNIX PF_UNIX&#41;;
 use Errno qw&#40;ECONNABORTED ECONNRESET&#41;;
 
+use Data::Transform::Meta;
+
 # Explicit use to import the parameter constants.
 use POE::Session;
 use POE::Driver::SysRW;
@@ -261,6 +263,7 @@
               my $heap = $_[HEAP];
               $heap-&gt;{shutdown} = 1;
               if &#40;defined $heap-&gt;{client}&#41; {
+                $heap-&gt;{client}-&gt;put&#40;Data::Transform::Meta::EOF-&gt;new&#40;&#41;&#41;;
                 if &#40;
                   $heap-&gt;{got_an_error} or
                   not $heap-&gt;{client}-&gt;get_driver_out_octets&#40;&#41;
diff -ur poe/lib/POE/Wheel/ReadWrite.pm Data-Transform/lib/POE/Wheel/ReadWrite.pm
--- poe/lib/POE/Wheel/ReadWrite.pm	2008-06-27 11:40:25.000000000 +0200
+++ Data-Transform/lib/POE/Wheel/ReadWrite.pm	2008-08-26 22:20:19.000000000 +0200
@@ -8,6 +8,7 @@
 $VERSION = do {my&#40;$r&#41;=&#40;q$Revision$=~/&#40;\d+&#41;/&#41;;sprintf&#34;1.%04d&#34;,$r};
 
 use Carp qw&#40; croak carp &#41;;
+use Scalar::Util qw&#40;blessed&#41;;
 use POE qw&#40;Wheel Driver::SysRW Filter::Line&#41;;
 
 # Offsets into $self.
@@ -256,6 +257,7 @@
     my $driver       = $self-&gt;[DRIVER_BOTH];
     my $input_filter = \$self-&gt;[FILTER_INPUT];
     my $event_input  = \$self-&gt;[EVENT_INPUT];
+    my $handle_output  = $self-&gt;[HANDLE_OUTPUT];
     my $event_error  = \$self-&gt;[EVENT_ERROR];
     my $unique_id    = $self-&gt;[UNIQUE_ID];
 
@@ -281,6 +283,13 @@
               my $next_rec = $$input_filter-&gt;get_one&#40;&#41;;
               last unless @$next_rec;
               foreach my $cooked_input &#40;@$next_rec&#41; {
+                if &#40;blessed &#40;$cooked_input&#41;&#41; {
+                  if &#40;$cooked_input-&gt;isa&#40;&#39;Data::Transform::Meta::SENDBACK&#39;&#41;&#41; {
+                    $driver-&gt;put&#40;[$cooked_input-&gt;data]&#41;;
+                    $k-&gt;select_resume_write&#40;$handle_output&#41;;
+                    next;
+                  }
+                }
                 $k-&gt;call&#40;$me, $$event_input, $cooked_input, $unique_id&#41;;
               }
             }
@@ -419,11 +428,27 @@
 
 sub put {
   my &#40;$self, @chunks&#41; = @_;
-
   my $old_buffered_out_octets = $self-&gt;[DRIVER_BUFFERED_OUT_OCTETS];
-  my $new_buffered_out_octets =
-    $self-&gt;[DRIVER_BUFFERED_OUT_OCTETS] =
-    $self-&gt;[DRIVER_BOTH]-&gt;put&#40;$self-&gt;[FILTER_OUTPUT]-&gt;put&#40;\@chunks&#41;&#41;;
+  my $new_buffered_out_octets;
+
+  if &#40;$self-&gt;[FILTER_OUTPUT]-&gt;can&#40;&#39;meta&#39;&#41;&#41; {
+    my @filtered_chunks = grep {
+        not blessed $_ or not $_-&gt;isa&#40;&#39;Data::Transform::Meta&#39;&#41;;
+      } @{$self-&gt;[FILTER_OUTPUT]-&gt;put&#40;\@chunks&#41;};
+    $new_buffered_out_octets = 
+      $self-&gt;[DRIVER_BUFFERED_OUT_OCTETS] =
+      $self-&gt;[DRIVER_BOTH]-&gt;put&#40;\@filtered_chunks&#41;;
+  } else {
+    $new_buffered_out_octets = 
+      $self-&gt;[DRIVER_BUFFERED_OUT_OCTETS] =
+      $self-&gt;[DRIVER_BOTH]-&gt;put&#40;
+        $self-&gt;[FILTER_OUTPUT]-&gt;put&#40;[
+          grep {
+              not &#40;blessed $_ and $_-&gt;isa&#40;&#39;Data::Transform::Meta::EOF&#39;&#41;&#41;;
+            } @chunks
+        ]&#41;
+      &#41;;
+  }
 
   if &#40;
     $self-&gt;[AUTOFLUSH] &#38;&#38;
@@ -473,6 +498,12 @@
         my $next_rec = $self-&gt;[FILTER_INPUT]-&gt;get_one&#40;&#41;;
         last unless @$next_rec;
         foreach my $cooked_input &#40;@$next_rec&#41; {
+              if &#40;blessed &#40;$cooked_input&#41; and
+                           $cooked_input-&gt;isa&#40;&#39;Data::Transform::Meta::SENDBACK&#39;&#41;&#41; {
+                $self-&gt;[DRIVER_BOTH]-&gt;put&#40;[$cooked_input-&gt;{data}]&#41;;
+                $poe_kernel-&gt;select_resume_write&#40;$self-&gt;[HANDLE_OUTPUT]&#41;;
+                next;
+              }
           $poe_kernel-&gt;call&#40;
             $poe_kernel-&gt;get_active_session&#40;&#41;,
             $self-&gt;[EVENT_INPUT],
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;26&nbsp;16:31:35&nbsp;2008</span>
    <span class="description">martijn [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;15&nbsp;15:24:43&nbsp;2011</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Are there any figures for the performance penalty to Data::Transform non-users?  All the 
can&#40;&#41;ning seems like a lot of work, but maybe it&#39;s not?  Maybe it can be put behind a compile-
time switch if it is.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;19&nbsp;11:20:47&nbsp;2011</span>
    <span class="description">martijn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 15 15:24:43 2011, RCAPUTO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are there any figures for the performance penalty to Data::Transform
&gt; non-users?  All the
&gt; can&#40;&#41;ning seems like a lot of work, but maybe it&#39;s not?  Maybe it can
&gt; be put behind a compile-
&gt; time switch if it is.
</div>

martijn@zzz:~$ time for &#40;&#40; i=10; i--; 1 &#41;&#41;; do perl test.pl; done

with POE::Filter::Line and no Data::Transform loaded:
real    0m40.132s
user    0m39.814s
sys     0m0.284s

with POE::Filter::Line and Data::Transform loaded:
real    0m41.681s
user    0m41.307s
sys     0m0.348s

with Data::Transform::Line:
real    0m43.990s
user    0m43.723s
sys     0m0.248s
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;

use POE;
use POE::Wheel::ReadWrite;
#use Data::Transform::POE;
#use Data::Transform::Line;


POE::Session-&gt;create&#40;
	inline_states =&gt; {
		_start =&gt; sub {
			open&#40; my $dict, &#39;british.med+.mwl&#39; &#41;; # from /usr/share/ispell
			$_[HEAP]-&gt;{wheel} = POE::Wheel::ReadWrite-&gt;new&#40;
				Handle =&gt; $dict,
				#Filter =&gt; Data::Transform::Line-&gt;new,
				InputEvent =&gt; &#39;line&#39;,
				ErrorEvent =&gt; &#39;end&#39;,
			&#41;;
			
		},
		line =&gt; sub {
			$_[HEAP]-&gt;{count}++;
		},
		end =&gt; sub {
			#warn delete $_[HEAP]-&gt;{count};
			delete $_[HEAP]-&gt;{wheel};
		}
	},
&#41;;

$poe_kernel-&gt;run;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;19&nbsp;13:19:28&nbsp;2011</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve attached a version of your benchmark that loops internally and
reports basic processing rates excluding Perl and POE setup and teardown
time.  It doesn&#39;t report CPU times, which might be a problem.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> lotr-bench-wheel-readwrite.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use POE;
use POE::Wheel::ReadWrite;
use Time::HiRes qw&#40;time&#41;;

use constant ITERATIONS_PER_RUN =&gt; 10;

POE::Session-&gt;create&#40;
  inline_states =&gt; {
    _start =&gt; sub {
      $_[HEAP]-&gt;{tests_to_go} = ITERATIONS_PER_RUN;
      restart_test&#40;$_[HEAP]&#41;;
    },
    line =&gt; sub {
      $_[HEAP]-&gt;{count}++;
    },
    end =&gt; sub {
      my $elapsed = time&#40;&#41; - $_[HEAP]{start};
      my $count   = $_[HEAP]{count};

      printf &#34;%d / %.3f = %.3f lines/sec\n&#34;, $count, $elapsed, $count / $elapsed;

      delete $_[HEAP]-&gt;{wheel};
      restart_test&#40;$_[HEAP]&#41; if --$_[HEAP]{tests_to_go} &gt; 0;
    },
  },
&#41;;

POE::Kernel-&gt;run&#40;&#41;;
exit;

sub restart_test {
  my $heap = shift&#40;&#41;;

  open&#40;my $dict, &#39;&lt;&#39;, &#39;/usr/share/dict/words&#39;&#41; or die $!;

  $heap-&gt;{count} = 0;
  $heap-&gt;{start} = time&#40;&#41;;

  $heap-&gt;{wheel} = POE::Wheel::ReadWrite-&gt;new&#40;
    Handle     =&gt; $dict,
    InputEvent =&gt; &#39;line&#39;,
    ErrorEvent =&gt; &#39;end&#39;,
  &#41;;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;03&nbsp;14:11:14&nbsp;2012</span>
    <span class="description">martijn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> benchmark results</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">martijn@meh:~/devel/Perl/Data-Transform$ perl bench.pl 
99156 / 8.988 = 11031.461 lines/sec
99156 / 9.110 = 10884.420 lines/sec
99156 / 9.042 = 10966.727 lines/sec
99156 / 9.029 = 10982.229 lines/sec
99156 / 8.950 = 11078.893 lines/sec
99156 / 8.953 = 11075.001 lines/sec
99156 / 8.968 = 11056.675 lines/sec
99156 / 8.930 = 11103.259 lines/sec
99156 / 8.903 = 11137.796 lines/sec
99156 / 8.924 = 11110.619 lines/sec
martijn@meh:~/devel/Perl/Data-Transform$ perl bench.pl # with
Data::Transform loaded
99156 / 9.287 = 10677.037 lines/sec
99156 / 9.155 = 10830.577 lines/sec
99156 / 9.259 = 10709.368 lines/sec
99156 / 9.165 = 10819.160 lines/sec
99156 / 9.156 = 10829.699 lines/sec
99156 / 9.136 = 10853.406 lines/sec
99156 / 9.150 = 10837.063 lines/sec
99156 / 9.135 = 10854.154 lines/sec
99156 / 9.142 = 10846.662 lines/sec
99156 / 9.227 = 10746.417 lines/sec
martijn@meh:~/devel/Perl/Data-Transform$ perl -I lib bench.pl # with
Data::Transform::Line used 
99156 / 9.541 = 10393.082 lines/sec
99156 / 9.398 = 10550.579 lines/sec
99156 / 9.392 = 10557.869 lines/sec
99156 / 9.453 = 10488.941 lines/sec
99156 / 9.410 = 10536.966 lines/sec
99156 / 9.530 = 10404.112 lines/sec
99156 / 9.626 = 10300.745 lines/sec
99156 / 9.442 = 10501.358 lines/sec
99156 / 9.447 = 10495.481 lines/sec
99156 / 9.435 = 10509.591 lines/sec
martijn@meh:~/devel/Perl/Data-Transform$ 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;03&nbsp;14:38:29&nbsp;2012</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 03 14:11:14 2012, MARTIJN wrote:
[benchmarks]

The benchmarks average 2.2% slower with Data::Transform loaded &#40;but not
used&#41;.

The average slowdown using Data::Transform is 5.2%.

Please commit your changes to POE::Wheel::ReadWrite.  I may end up
placing them behind a USE_DATA_TRANSFORM constant if someone can&#39;t
tolerate the overhead.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;10&nbsp;17:21:42&nbsp;2012</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Requested changes to be committed two months ago.  Marking as stalled.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;10&nbsp;17:21:43&nbsp;2012</span>
    <span class="description">RCAPUTO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;19&nbsp;01:15:43&nbsp;2013</span>
    <span class="description">RCAPUTO [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;19&nbsp;01:16:00&nbsp;2013</span>
    <span class="description">RCAPUTO [...] cpan.org -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;19&nbsp;01:18:26&nbsp;2013</span>
    <span class="description">RCAPUTO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Requested the submitter apply their patch 20 months ago.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;19&nbsp;01:18:27&nbsp;2013</span>
    <span class="description">RCAPUTO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
