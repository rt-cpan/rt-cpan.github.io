<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #120470 for Net-DNS: Fragmented TCP length not correctly reassembled</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #120470 for Net-DNS: Fragmented TCP length not correctly reassembled</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">120470</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS/Active/">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
adam.bogacz [...] getresponse.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;10:49:48&nbsp;2017</span>
    <span class="description">adam.bogacz [...] getresponse.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug report</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Mar 2017 12:15:25 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-DNS [...] rt.cpan.org&#34; &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Adam Bogacz &lt;adam.bogacz [...] getresponse.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, 

I would like to report a bug in Net::DNS::Resolver::Base

“Use of uninitialized value $unread in integer gt &#40;&gt;&#41; at /&lt;retracted&gt;/Net/DNS/Resolver/Base.pm line 817.”

Unfortunately, I’m not able to reproduce this bug on my dev environment, but we see few of them per day from our production environment. It looks like it was introduced in version 1.07_03 where function “_read_tcp” was changed:

-while &#40;$unread&#41; {
+while &#40; $unread &gt; 0 &#41; {

Thanks in advance for fixing this bug.

— 
Best regards
Adam Bogacz
Software Developer
GetResponse


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;11:29:20&nbsp;2017</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 01 10:49:48 2017, adam.bogacz@getresponse.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; I would like to report a bug in Net::DNS::Resolver::Base
&gt; 
&gt; “Use of uninitialized value $unread in integer gt &#40;&gt;&#41; at
&gt; /&lt;retracted&gt;/Net/DNS/Resolver/Base.pm line 817.”
&gt; 
</div>
Does your application use Net::DNS directly, or does it depend on some other package that does so?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;11:29:21&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;09:09:09&nbsp;2017</span>
    <span class="description">adam.bogacz [...] getresponse.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120470] Bug report</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Mar 2017 06:35:02 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-DNS [...] rt.cpan.org&#34; &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Adam Bogacz &lt;adam.bogacz [...] getresponse.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Our application uses Net::DNS directly.

— 
Best regards
Adam Bogacz
Software Developer
GetResponse


On 01/03/2017, 17:29, &#34;Dick Franks via RT&#34; &lt;bug-Net-DNS@rt.cpan.org&gt; wrote:

    &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=120470">https://rt.cpan.org/Ticket/Display.html?id=120470</a></span> &gt;
    
    On Wed Mar 01 10:49:48 2017, adam.bogacz@getresponse.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">    &gt; Hi,
    &gt; 
    &gt; I would like to report a bug in Net::DNS::Resolver::Base
    &gt; 
    &gt; “Use of uninitialized value $unread in integer gt &#40;&gt;&#41; at
    &gt; /&lt;retracted&gt;/Net/DNS/Resolver/Base.pm line 817.”
    &gt; 
</div>    
    Does your application use Net::DNS directly, or does it depend on some other package that does so?
    
    
    

</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;14:35:49&nbsp;2017</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 02 09:09:09 2017, adam.bogacz@getresponse.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; Our application uses Net::DNS directly.
&gt; 
</div>It would be helpful to have some information about the system where the problem occurs.

1&#41; Output from perl -V

2&#41; The table of version numbers near the beginning of the &#34;make test&#34; output.  If the original installation log is no longer to hand, a test build of 1.08 will gather the information I need. 

3&#41; An outline description of the Net::DNS::Resolver related parts of your application.

4&#41; Confessions for sinful usage not covered by the documentation.

5&#41; What software is the local recursive name server running, what version and on what platform.

6&#41; Any observed pattern, if any, in the failing cases.  Are some zones more likely to fail than others?

If you would rather not publish all of this in RT, feel free to mail me directly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;23&nbsp;17:12:00&nbsp;2017</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Answer came there none.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;04:22:10&nbsp;2017</span>
    <span class="description">bbkr [...] post.pl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bbkr [...] post.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

I&#39;ll try to answer your questions as best as I can:

--------
1&#41; Output from perl -V

$ perl -V
Summary of my perl5 &#40;revision 5 version 24 subversion 1&#41; configuration:

  Platform:
    osname=linux, osvers=3.2.50-vs2.3.2.16-beng, archname=x86_64-linux
    uname=&#39;linux b-gr-dev.v.l 3.2.50-vs2.3.2.16-beng #1 smp fri aug 30 16:43:33 bst 2013 x86_64 gnulinux &#39;
    config_args=&#39;-de -Dprefix=/home/ppabian/.perl5/perls/perl-5.24.1 -Duserelocatableinc -Duse64bitall -Doptimize=-O2 -march=native -pipe -Aeval:scriptdir=/home/ppabian/.perl5/perls/perl-5.24.1/bin&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=undef, usemultiplicity=undef
    use64bitint=define, use64bitall=define, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-fwrapv -fno-strict-aliasing -pipe -fstack-protector-strong -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -D_FORTIFY_SOURCE=2&#39;,
    optimize=&#39;-O2 -march=native -pipe&#39;,
    cppflags=&#39;-fwrapv -fno-strict-aliasing -pipe -fstack-protector-strong -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.9.2&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678, doublekind=3
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16, longdblkind=3
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39; -fstack-protector-strong -L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib/gcc/x86_64-linux-gnu/4.9/include-fixed /usr/include/x86_64-linux-gnu /usr/lib /lib/x86_64-linux-gnu /lib/../lib /usr/lib/x86_64-linux-gnu /usr/lib/../lib /lib
    libs=-lpthread -lnsl -ldl -lm -lcrypt -lutil -lc
    perllibs=-lpthread -lnsl -ldl -lm -lcrypt -lutil -lc
    libc=libc-2.19.so, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;2.19&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E&#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -march=native -pipe -L/usr/local/lib -fstack-protector-strong&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options: HAS_TIMES PERLIO_LAYERS PERL_COPY_ON_WRITE
                        PERL_DONT_CREATE_GVSV
                        PERL_HASH_FUNC_ONE_AT_A_TIME_HARD PERL_MALLOC_WRAP
                        PERL_PRESERVE_IVUV USE_64_BIT_ALL USE_64_BIT_INT
                        USE_LARGE_FILES USE_LOCALE USE_LOCALE_COLLATE
                        USE_LOCALE_CTYPE USE_LOCALE_NUMERIC USE_LOCALE_TIME
                        USE_PERLIO USE_PERL_ATOF
  Locally applied patches:
        Devel::PatchPerl 1.38
  Built under linux
  Compiled at Feb 24 2017 14:42:48
  %ENV:
    PERLBREW_BASHRC_VERSION=&#34;0.75&#34;
    PERLBREW_HOME=&#34;/home/ppabian/.perlbrew&#34;
    PERLBREW_MANPATH=&#34;/home/ppabian/.perl5/perls/perl-5.24.1/man&#34;
    PERLBREW_PATH=&#34;/home/ppabian/.perl5/bin:/home/ppabian/.perl5/perls/perl-5.24.1/bin&#34;
    PERLBREW_PERL=&#34;perl-5.24.1&#34;
    PERLBREW_ROOT=&#34;/home/ppabian/.perl5&#34;
    PERLBREW_VERSION=&#34;0.75&#34;
  @INC:
    /home/ppabian/.perl5/perls/perl-5.24.1/lib/site_perl/5.24.1/x86_64-linux
    /home/ppabian/.perl5/perls/perl-5.24.1/lib/site_perl/5.24.1
    /home/ppabian/.perl5/perls/perl-5.24.1/lib/5.24.1/x86_64-linux
    /home/ppabian/.perl5/perls/perl-5.24.1/lib/5.24.1
    .

--------
2&#41; The table of version numbers near the beginning of the &#34;make test&#34; output.  If the original installation log is no longer to hand, a test build of 1.08 will gather the information I need. 


$ NET_DNS_DEBUG=1 cpanm --test-only --verbose Net::DNS
...
--&gt; Working on Net::DNS
Fetching <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/authors/id/N/NL/NLNETLABS/Net-DNS-1.09.tar.gz">http://www.cpan.org/authors/id/N/NL/NLNETLABS/Net-DNS-1.09.tar.gz</a></span> ... OK
...
# These tests were run using:
#       Net::DNS                   1.09
#       Data::Dumper               2.160
#       Digest::HMAC               1.03
#       Digest::MD5                2.54
#       Digest::SHA                5.95_01
#       File::Spec                 3.6301
#       IO::File                   1.16
#       IO::Select                 1.22
#       IO::Socket                 1.38
#       IO::Socket::INET           1.35
#       IO::Socket::IP             0.37
#       MIME::Base64               3.15
#       PerlIO                     1.09
#       Scalar::Util               1.47
#       Socket                     2.020_03
#       Time::Local                1.2300


--------

3&#41; An outline description of the Net::DNS::Resolver related parts of your application.

my $resolver = Net::DNS::Resolver-&gt;new&#40;
        &#39;tcp_timeout&#39;    =&gt; 4,
        &#39;udp_timeout&#39;    =&gt; 4,
        &#39;persistent_tcp&#39; =&gt; 1,
        &#39;persistent_udp&#39; =&gt; 1,
    &#41;;
my $type = &#34;A&#34;;
my $name = &#34;mx2.hotmail.com&#34;;

if &#40; my $reply = $resolver-&gt;search&#40; $name, $type &#41; &#41; {
    if &#40; my @records = grep { $_-&gt;type eq $type } $reply-&gt;answer &#41; {
        if &#40; $type eq &#39;A&#39; &#41; {
                my $a = shift @records;
                return { &#39;resolved&#39; =&gt; $a-&gt;address, &#39;until&#39; =&gt; time + $a-&gt;ttl };
            }
    }
}


--------
4&#41; Confessions for sinful usage not covered by the documentation.

None.


--------
5&#41; What software is the local recursive name server running, what version and on what platform.

I don&#39;t know ATM, I&#39;ll try to obtain it.

--------
6&#41; Any observed pattern, if any, in the failing cases.  Are some zones more likely to fail than others?

Here is full stack trace:

Use of uninitialized value $unread in integer gt &#40;&gt;&#41; at Net/DNS/Resolver/Base.pm line 817.
        Net::DNS::Resolver::Base::_read_tcp&#40;IO::Socket::IP=GLOB&#40;0x7661d70&#41;&#41; called at Net/DNS/Resolver/Base.pm line 438
        Net::DNS::Resolver::Base::_send_tcp&#40;Net::DNS::Resolver=HASH&#40;0x426dd28&#41;, Net::DNS::Packet=HASH&#40;0x7661c50&#41;, &#34;\x{e3}\x{95}\x{1}\x{0}\x{0}\x{1}\x{0}\x{0}\x{0}\x{0}\x{0}\x{0}\x{3}mx2\x{7}hotmail\x{3}com\x{0}\x{0}\x{1}\x{0}\x{1}&#34;&#41; called at Net/DNS/Resolver/Base.pm line 413
        Net::DNS::Resolver::Base::send&#40;Net::DNS::Resolver=HASH&#40;0x426dd28&#41;, &#34;mx2.hotmail.com&#34;, &#34;A&#34;&#41; called at Net/DNS/Resolver/Base.pm line 390
        Net::DNS::Resolver::Base::search&#40;Net::DNS::Resolver=HASH&#40;0x426dd28&#41;, &#34;mx2.hotmail.com&#34;, &#34;A&#34;&#41;


I see all kind of zones, domains and record types failing from time to time. However I cannot reproduce this bug in constant fashion using oneliner.
Therefore I suspect that this occurs only on some network issues, maybe _read_tcp hits timeout and returns nothing for callee?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;04:52:19&nbsp;2017</span>
    <span class="description">bbkr [...] post.pl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bbkr [...] post.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a suspicion that something is broken with &#34;truncated&#34; reply that causes UDP-&gt;TCP fallback for long answers. All errors I&#39;ve captured are in _read_tcp&#40;&#41; and happens on large output such as DKIM TXT records, big ISPs or some cloud addresses.

Maybe timeout started in UDP communication is not properly terminated and started again in TCP communication, and TCP communication  suddenly gets interrupted by &#34;foreign&#34; timer?

I&#39;m not an expert in DNS stuff, so this is only theory without proper Net::DNS code analysis.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;07:57:51&nbsp;2017</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 03 04:22:10 2017, bbkr@post.pl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi
&gt; 
&gt; I&#39;ll try to answer your questions as best as I can:
&gt; 
</div>Thanks

I note that you have already built Net::DNS 1.09.  That release contains a speculative modification based on the hypothesis that the present problem might be caused by the two byte DNS packet length becoming split across two socket-&gt;recv&#40;&#41;s.

Without making any other changes, please try installing 1.09 to see if this makes the problem disappear.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;08:31:11&nbsp;2017</span>
    <span class="description">bbkr [...] post.pl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bbkr [...] post.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

Thanks for prompt reply!

Sorry about the confusion with 1.08 vs 1.09 version while listing dependencies. i&#39;m using 1.08 and haven&#39;t realized cpanm fetched newer one. Still, the list of dependencies remains valid.

I&#39;ve scheduled update to 1.09 on Wednesday, I&#39;ll report on Friday if issue is resolved &#40;I hit this error up to 10 times per day, so 2 days observation should give reasonable conclusions&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;10&nbsp;03:43:40&nbsp;2017</span>
    <span class="description">bbkr [...] post.pl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bbkr [...] post.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After update to 1.09 on Wednesday i no longer get “Use of uninitialized value $unread in integer gt &#40;&gt;&#41; at /&lt;retracted&gt;/Net/DNS/Resolver/Base.pm line 817.”

So I think task can be marked as resolved.


However after this update I&#39;m getting SpamAssassin errors:

Use of uninitialized value $4 in concatenation &#40;.&#41; or string at /home/getresponse/perl-5.24.1/lib/site_perl/5.24.1/Mail/SpamAssassin/Plugin/URIDNSBL.pm line 1042.
Use of uninitialized value $3 in concatenation &#40;.&#41; or string at /home/getresponse/perl-5.24.1/lib/site_perl/5.24.1/Mail/SpamAssassin/Plugin/URIDNSBL.pm line 1042.
Use of uninitialized value $2 in concatenation &#40;.&#41; or string at /home/getresponse/perl-5.24.1/lib/site_perl/5.24.1/Mail/SpamAssassin/Plugin/URIDNSBL.pm line 1042.
dns: new_dns_packet &#40;domain=...&#40;.sbl.spamhaus.org. type=A class=IN&#41; failed: a domain name contains a null label
dns: new_dns_packet &#40;domain=...&#40;.zen.spamhaus.org. type=A class=IN&#41; failed: a domain name contains a null label

I&#39;ll report it upstream to SA team.


Thanks for your help. I appreciate it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;10&nbsp;08:29:55&nbsp;2017</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 10 03:43:40 2017, bbkr@post.pl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; After update to 1.09 on Wednesday i no longer get “Use of
&gt; uninitialized value $unread in integer gt &#40;&gt;&#41; at
&gt; /&lt;retracted&gt;/Net/DNS/Resolver/Base.pm line 817.”
&gt; 
&gt; So I think task can be marked as resolved.
&gt; 
</div>Thanks


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However after this update I&#39;m getting SpamAssassin errors:
&gt; 
&gt; Use of uninitialized value $4 in concatenation &#40;.&#41; or string at
&gt; /home/getresponse/perl-
&gt; 5.24.1/lib/site_perl/5.24.1/Mail/SpamAssassin/Plugin/URIDNSBL.pm line
&gt; 1042.
&gt; Use of uninitialized value $3 in concatenation &#40;.&#41; or string at
&gt; /home/getresponse/perl-
&gt; 5.24.1/lib/site_perl/5.24.1/Mail/SpamAssassin/Plugin/URIDNSBL.pm line
&gt; 1042.
&gt; Use of uninitialized value $2 in concatenation &#40;.&#41; or string at
&gt; /home/getresponse/perl-
&gt; 5.24.1/lib/site_perl/5.24.1/Mail/SpamAssassin/Plugin/URIDNSBL.pm line
&gt; 1042.
&gt; dns: new_dns_packet &#40;domain=...&#40;.sbl.spamhaus.org. type=A class=IN&#41;
&gt; failed: a domain name contains a null label
&gt; dns: new_dns_packet &#40;domain=...&#40;.zen.spamhaus.org. type=A class=IN&#41;
&gt; failed: a domain name contains a null label
&gt; 
</div>
Replace DomainName.pm with the 1.08 version to see if the problem disappears. If it does, please raise another bug report here.

The reason these differ is to get round a compiler optimisation problem that derails Devel::Cover.

If not, do the same with Domain.pm.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;19&nbsp;09:14:20&nbsp;2017</span>
    <span class="description">NLNETLABS [...] cpan.org -  Subject changed from &#39;Bug report&#39; to &#39;Fragmented TCP length not correctly reassembled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;19&nbsp;09:14:21&nbsp;2017</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
