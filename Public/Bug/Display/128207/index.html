<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #128207 for Net-SSLeay: Fails t/local/06_tcpecho.t and t/local/07_sslecho.t under network sandbox</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #128207 for Net-SSLeay: Fails t/local/06_tcpecho.t and t/local/07_sslecho.t under network sandbox</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-SSLeay">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-SSLeay">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-SSLeay">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-SSLeay">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">128207</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-SSLeay">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">chrisn [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.86_10    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




emerge.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1846912/992496/emerge.txt">
Sat May 04 12:13:27 2019 (37.1k) by chrisn [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=128207">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1828400" href="/Public/Bug/Display.html?id=128207#txn-1828400">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;09&nbsp;22:07:24&nbsp;2019</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fails t/local/06_tcpecho.t and t/local/07_sslecho.t under network
 sandbox</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1828400/983454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/983454">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza">Gentoo executes package tests under a network sandbox that&#39;s supposed to prevent external network IO, while still having local network IO within the sandbox.<br>

<br>

However, under these conditions, most tests run properly, including the network consuming ones ( in that they just auto-skip instead of failing )<br>

<br>

But 2 tests in the &quot;local&quot; test suite currently fail for whatever reason:<br>

<br>

<br>

<br>

t/local/06_tcpecho.t actually runs indefinitely with a hung child blocked in accept()<br>

<br>

t/local/06_tcpecho.t ...................<br>

1..4<br>

Use of uninitialized value $got in string eq at t/local/06_tcpecho.t line 66.<br>

<br>

&nbsp;&nbsp;&nbsp; 63&nbsp;&nbsp; &nbsp;my @results;<br>

&nbsp;&nbsp;&nbsp; 64&nbsp;&nbsp; &nbsp;{<br>

&nbsp;&nbsp;&nbsp; 65&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; my ($got) = Net::SSLeay::tcpcat(&#39;localhost&#39;, $port, $msg);<br>

&nbsp;&nbsp;&nbsp; 66&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; push @results, [ $got eq uc($msg), &#39;sent and received correctly&#39; ];<br>

&nbsp;&nbsp;&nbsp; 67&nbsp;&nbsp; &nbsp;}<br>

<br>

<br>

<br>

t/local/07_sslecho.t&nbsp; actually finishes, but indicates some problem interfacing with Socket.pm:<br>

<br>

t/local/07_sslecho.t ...................<br>

1..78<br>

Bad arg length for Socket::pack_sockaddr_in, length is 0, should be 4 at /usr/lib64/perl5/5.26.2/x86_64-linux/Socket.pm line 834.<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"># Looks like your test exited with 11 just after 51.<br>
</div>Dubious, test returned 11 (wstat 2816, 0xb00)<br>

Failed 78/78 subtests<br>

<br>

<br>

Its not clear to me why these tests only *now* fail for me, despite being fine months ago, but I have openssl 1.1.0j installed now, and that *could* be a significant factor<br>

<br>

--&nbsp;<br>

- CPAN kentnl@cpan.org<br>

- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1846413" href="/Public/Bug/Display.html?id=128207#txn-1846413">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;11:22:44&nbsp;2019</span>
    <span class="description">chrisn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1846413/992231/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/992231">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the report, Kent --- apologies for taking so long to get back to you.

On Thu Jan 10 03:07:24 2019, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Gentoo executes package tests under a network sandbox that&#39;s supposed
&gt; to
&gt; prevent external network IO, while still having local network IO
&gt; within the
&gt; sandbox.
&gt; 
&gt; However, under these conditions, most tests run properly, including
&gt; the network
&gt; consuming ones &#40; in that they just auto-skip instead of failing &#41;
&gt; 
&gt; But 2 tests in the &#34;local&#34; test suite currently fail for whatever
&gt; reason:
</div>
t/local/06_tcpecho.t and t/local/07_sslecho.t are notable for being the only two tests in the test suite to use localhost instead of 127.0.0.1, so I bet it&#39;s because of that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/local/06_tcpecho.t actually runs indefinitely with a hung child
&gt; blocked in
&gt; accept&#40;&#41;
&gt; 
&gt; t/local/06_tcpecho.t ...................
&gt; 1..4
&gt; Use of uninitialized value $got in string eq at t/local/06_tcpecho.t
&gt; line 66.
&gt; 
&gt; 63 my @results;
&gt; 64 {
&gt; 65 my &#40;$got&#41; = Net::SSLeay::tcpcat&#40;&#39;localhost&#39;, $port, $msg&#41;;
&gt; 66 push @results, [ $got eq uc&#40;$msg&#41;, &#39;sent and received correctly&#39; ];
&gt; 67 }
</div>
The call to Net::SSLeay::tcpcat&#40;&#41; involves an implicit call to gethostbyname&#40;&#41; to resolve localhost, which presumably never returns because Perl can&#39;t use the resolver &#40;this apparently also happens on Gentoo when one emerges a package in which autotools checks for gethostbyname&#40;&#41; [1]&#41;, which would explain the long delay --- gethostbyname&#40;&#41; should eventually time out and return, but the call to tcpcat&#40;&#41; would then fail anyway, so there&#39;d be no hope of the test passing.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/local/07_sslecho.t actually finishes, but indicates some problem
&gt; interfacing
&gt; with Socket.pm:
&gt; 
&gt; t/local/07_sslecho.t ...................
&gt; 1..78
&gt; Bad arg length for Socket::pack_sockaddr_in, length is 0, should be 4
&gt; at
&gt; /usr/lib64/perl5/5.26.2/x86_64-linux/Socket.pm line 834.
&gt; # Looks like your test exited with 11 just after 51.
&gt; Dubious, test returned 11 &#40;wstat 2816, 0xb00&#41;
&gt; Failed 78/78 subtests
</div>
t/local/07_sslecho.t explicitly tries to resolve localhost using gethostbyname&#40;&#41; instead. When that also fails, gethostbyname&#40;&#41; returns undef, which sockaddr_in&#40;&#41; then can&#39;t pack as an IPv4 address &#40;&#34;length is 0 [bytes], should be 4&#34;&#41;, leading to the error. There&#39;s another use of localhost in this test too, in a call to Net::SSLeay::sslcat&#40;&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Its not clear to me why these tests only *now* fail for me, despite
&gt; being fine
&gt; months ago, but I have openssl 1.1.0j installed now, and that *could*
&gt; be a
&gt; significant factor
</div>
Strange indeed. In any event, the solution ought to be simple: replace localhost with 127.0.0.1. I don&#39;t have easy access to a Gentoo installation, so would you mind running the tests from this branch in your sandboxed environment to see if that solves the problem?

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/chrisnovakovic/p5-net-ssleay/tree/RT-128207-tests-remove-localhost">https://github.com/chrisnovakovic/p5-net-ssleay/tree/RT-128207-tests-remove-localhost</a></span>

If it does, I&#39;ll merge that branch into the main repository.

[1] <span class="clickylink"><a target="new" rel="nofollow" href="https://forums.gentoo.org/viewtopic-t-749921-start-0.html">https://forums.gentoo.org/viewtopic-t-749921-start-0.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1846414" href="/Public/Bug/Display.html?id=128207#txn-1846414">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;11:22:45&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1846417" href="/Public/Bug/Display.html?id=128207#txn-1846417">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;02&nbsp;11:22:45&nbsp;2019</span>
    <span class="description">chrisn [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1846912" href="/Public/Bug/Display.html?id=128207#txn-1846912">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;04&nbsp;12:13:27&nbsp;2019</span>
    <span class="description">chrisn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> KENTNL [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1846912/992495/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/992495">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 02 16:22:44 2019, CHRISN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Strange indeed. In any event, the solution ought to be simple: replace
&gt; localhost with 127.0.0.1. I don&#39;t have easy access to a Gentoo
&gt; installation, so would you mind running the tests from this branch in
&gt; your sandboxed environment to see if that solves the problem?
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/chrisnovakovic/p5-net-ssleay/tree/RT-128207-tests-">https://github.com/chrisnovakovic/p5-net-ssleay/tree/RT-128207-tests-</a></span>
&gt; remove-localhost
&gt; 
&gt; If it does, I&#39;ll merge that branch into the main repository.
</div>
I&#39;ve had some time to look into testing this myself, and it seems to work fine &#40;assuming what I&#39;m doing is sensible: I&#39;ve never used Gentoo before, so that&#39;s not a guarantee&#41;.

I built a fake Net-SSLeay-1.86_10.tar.gz &#34;release&#34; based on the Git branch above, and wrote a Net-SSLeay-1.860.0.ebuild based on Net-SSLeay-1.850.0.ebuild [1]. This involved minor changes to the &#34;fix-dir&#34; and &#34;fix-network-tests&#34; patches in files/, because we&#39;ve dropped Module::Install in favour of ExtUtils::MakeMaker since 1.85. In a VM booted into the LiveDVD environment, I then set up a local Portage repository in /usr/local/portage/ containing only dev-perl/Net-SSLeay and added &#34;test network-sandbox&#34; to FEATURES in /etc/portage/make.conf. &#34;emerge -atv dev-perl/Net-SSLeay&#34; shows that the tests that failed previously now pass; the output from emerge is attached.

I&#39;ve now merged the branch above into master [2]. This will be part of developer version 1.86_10 &#40;which I&#39;ll release today&#41;, and stable version 1.86 &#40;which we&#39;ll release soon&#41;.

[1] <span class="clickylink"><a target="new" rel="nofollow" href="https://gitweb.gentoo.org/repo/gentoo.git/tree/dev-perl/Net-SSLeay/Net-SSLeay-1.850.0.ebuild">https://gitweb.gentoo.org/repo/gentoo.git/tree/dev-perl/Net-SSLeay/Net-SSLeay-1.850.0.ebuild</a></span>
[2] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/radiator-software/p5-net-ssleay/pull/133">https://github.com/radiator-software/p5-net-ssleay/pull/133</a></span>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> emerge.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1846912/992496/emerge.txt">Download emerge.txt</a><br />
<span class="downloadcontenttype">text/plain 37.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1846916" href="/Public/Bug/Display.html?id=128207#txn-1846916">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;04&nbsp;12:13:28&nbsp;2019</span>
    <span class="description">chrisn [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1846980" href="/Public/Bug/Display.html?id=128207#txn-1846980">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;05&nbsp;02:12:40&nbsp;2019</span>
    <span class="description">chrisn [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1846982" href="/Public/Bug/Display.html?id=128207#txn-1846982">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;05&nbsp;02:12:40&nbsp;2019</span>
    <span class="description">chrisn [...] cpan.org -  Fixed in 1.86_10 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1855401" href="/Public/Bug/Display.html?id=128207#txn-1855401">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;03:22:01&nbsp;2019</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1855401/996682/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/996682">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza"><p>
	On 2019-05-05 04:13:27, CHRISN wrote:<br>

	<br>

	Sorry for the slow reply.<br>

	<br>

	It turns out I had some local settings that conspired to make this work, namely in /etc/hosts and /etc/nsswitch.conf stuff in conjunction with some terrible horrors from accidentally having systemd somewhere.<br>

	<br>

	For whatever reason, on some systems the recommendation is *not* to have a localhost entry in /etc/hosts, and instead use an entry in nsswitch.conf for hosts of &quot;files myhostname dns&quot;, and it seems that unless its an exclusive-or combination, you&#39;ll have problems.<br>

	<br>

	So if you accidentally transition from one to the other, it breaks silently, but oddly, only in sandboxes.<br>

	<br>

	In short, I managed to locally reduce my incidences of this problem by fixing /etc/hosts , but I&#39;d still think being able to not barf when /etc/hosts is misconfigured might be a &quot;feature&quot;, after all, the point of tests is to make sure the code works, not tell you your system is broken. If various system configurations can affect code execution, testing for that scenario and skipping the test might be preferred.<br>

	<br>

	So, back on the subject:<br>

	<br>

	I don&#39;t think a simple transition from localhost to an explicit IP is the right move, mostly because I suspect are hosts out there where IPv4 on loopback might be disabled. And even without that, I&#39;m not sure what the guarantees are about usable IP addresses on local loopback are. I know in general you can assume most people will have a sensible setup, I&#39;m just worried about the more esoteric builds ( which may be more common and less esoteric than we realize )<br>

	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1855404" href="/Public/Bug/Display.html?id=128207#txn-1855404">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;03:33:31&nbsp;2019</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1855404/996685/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/996685">with headers</a>
<br />
<span class="downloadcontenttype">text/html 332b</span>
</div>
<div class="messagebody">
<div class="message-stanza">After testing the new version, the good news:<br>

<br>

I can&#39;t make it fail on these tests<br>

<br>

The bad news:<br>

<br>

I can no longer make the old version fail its tests either.<br>

<br>

<br>

--&nbsp;<br>

- CPAN kentnl@cpan.org<br>

- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1855407" href="/Public/Bug/Display.html?id=128207#txn-1855407">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;03:42:09&nbsp;2019</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1855407/996688/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/996688">with headers</a>
<br />
<span class="downloadcontenttype">text/html 616b</span>
</div>
<div class="messagebody">
<div class="message-stanza">A figured out what I was doing wrong to make the tests pass... Ok, so to reproduce the problem on &lt;=1.85 on Gentoo, I need to:<br>

<br>

* ensure no mapping for &quot;127.0.0.1&quot; from &quot;localhost&quot; in /etc/hosts<br>

* make sure you comment out the lines in the 1.850.0 ebuild that kill the t/local tests<br>

* emerge with FEATURES=&quot;network-sandbox&quot;<br>

<br>

And I have now confirmed (apparently) that under those same conditions, 1.88 does _not_ fail :)<br>

<br>

--&nbsp;<br>

- CPAN kentnl@cpan.org<br>

- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1856035" href="/Public/Bug/Display.html?id=128207#txn-1856035">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;13&nbsp;06:36:03&nbsp;2019</span>
    <span class="description">chrisn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1856035/997039/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/997039">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 702b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Glad to hear it works for you now, Kent.

On Wed Jul 10 08:22:01 2019, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t think a simple transition from localhost to an explicit IP is
&gt; the right
&gt; move, mostly because I suspect are hosts out there where IPv4 on
&gt; loopback might
&gt; be disabled. And even without that, I&#39;m not sure what the guarantees
&gt; are about
&gt; usable IP addresses on local loopback are. I know in general you can
&gt; assume
&gt; most people will have a sensible setup, I&#39;m just worried about the
&gt; more
&gt; esoteric builds &#40; which may be more common and less esoteric than we
&gt; realize &#41;
</div>
I&#39;m not sure if there&#39;s an alternative to this that&#39;ll work everywhere. Probably best to cross that bridge if we get to it. :&#41;
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.550949</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
