<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #130596 for IO-Pager: t/11-redirect-oo.t fails if /dev/tty cannot be opened</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #130596 for IO-Pager: t/11-redirect-oo.t fails if /dev/tty cannot be opened</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Pager/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Pager/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Pager/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Pager/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Pager">IO-Pager CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">130596</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Pager/Active/">IO-Pager</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17184-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.43    </td>
  </tr>
  <tr id="CF-17185-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.44    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;30&nbsp;07:40:49&nbsp;2019</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/11-redirect-oo.t fails if /dev/tty cannot be opened</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When running tests inside a Fedora mock tool &#40;a build system that isolates the build environment and opening /dev/tty fails because there is no TTY&#41;, t/11-redirect-oo.t test fails:

t/10-close_interactive.t ........... ok
Warning: something&#39;s wrong at /builddir/build/BUILD/IO-Pager-0.43/blib/lib/IO/Pager.pm line 80.
/usr/bin/more at /builddir/build/BUILD/IO-Pager-0.43/blib/lib/IO/Pager.pm line 83.
Use of uninitialized value in subtraction &#40;-&#41; at /builddir/build/BUILD/IO-Pager-0.43/blib/lib/IO/Pager/tp line 315.
No such device or address at /builddir/build/BUILD/IO-Pager-0.43/blib/lib/IO/Pager/tp line 15.
#   Failed test &#39;Redirection with OO&#39;
#   at t/11-redirect-oo.t line 27.
# 
#          got: &#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla tincidunt fringilla lectus, et vestibulum sapien consectetur nec. Mauris at auctor ipsum. Phasellus a massa non lorem vulputate lobortis. Sed rutrum, eros vitae dignissim tempor, dui odio vulputate quam, eu suscipit turpis lorem commodo risus. Nulla augue metus, dictum in hendrerit et, ullamcorper vel tortor. Praesent at risus felis. Donec iaculis felis sit amet turpis laoreet volutpat. Nam eros tortor, fermentum id tristique in, hendrerit a nulla. Aliquam tincidunt ante ac elit ultrices et hendrerit ligula rhoncus. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Aenean vehicula sollicitudin nisi, sed commodo ipsum bibendum et. Proin vehicula aliquam placerat. Nulla congue sem nec urna venenatis semper sed sed tortor. Donec ut lectus nec risus mattis egestas eget sit amet lorem. In eros lectus, porta sed placerat at, aliquam a nunc.
# 
# Nam commodo blandit aliquet. Suspendisse a orci arcu, sed euismod nibh. Curabitur at placerat est. Maecenas rutrum lacinia leo, sit amet cursus ante porttitor eu. Morbi a nisi in justo fringilla accumsan vehicula vel ante. Aliquam porta tempus ullamcorper. Etiam ac velit justo, vitae venenatis sem. Curabitur sit amet nibh magna. Proin adipiscing, dui et varius ultricies, purus sem luctus libero, id elementum neque augue et eros. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Curabitur rutrum congue arcu vel ultricies. Mauris consectetur sodales lorem et volutpat.
# 
# Maecenas dictum condimentum erat vel consequat. Quisque eu risus libero, non ornare quam. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut viverra nisl arcu, nec mollis quam. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Quisque malesuada vestibulum est, vel lacinia lorem euismod nec. Nulla massa odio, consectetur ac scelerisque at, fermentum in metus. Duis vitae ipsum lacus, id rutrum felis. Nulla dapibus est eget mauris viverra malesuada sit amet sit amet elit. Sed sodales, turpis vitae eleifend dapibus, odio magna iaculis ante, quis sagittis tellus dolor nec risus. Fusce posuere enim vel dolor lobortis rutrum. Duis in erat nunc, et egestas libero. Morbi pellentesque semper eros ac vulputate. Donec ultricies tincidunt augue.
# &#39;
#     expected: &#39;&#39;
# 
# Looks like you failed 1 test of 1.
# 
t/11-redirect-oo.t ................. 
Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/1 subtests 

A patch that skips the test when /dev/tty cannot be opened is attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IO-Pager-0.43-Skip-t-11-redirect-oo.t-of-dev-tty-cannot-be-opened.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 5a1325e1bce6ef74bffbae017ce336c1ce9d33c1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Mon, 30 Sep 2019 13:31:45 +0200
Subject: [PATCH] Skip t/11-redirect-oo.t of /dev/tty cannot be opened
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

If /dev/tty cannot be opened, lib/IO/Pager/tp dies:

    Use of uninitialized value in subtraction &#40;-&#41; at /builddir/build/BUILD/IO-Pager-0.43/blib/lib/IO/Pager/tp line 315.
    No such device or address at /builddir/build/BUILD/IO-Pager-0.43/blib/lib/IO/Pager/tp line 15.
    #   Failed test &#39;Redirection with OO&#39;
    #   at t/11-redirect-oo.t line 27.
    #
    #          got: &#39;Lorem ipsum dolor sit amet, consectetur [...]

This happens when running it in a Fedora mock tool. This patch simply skip the
test in that case.

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 t/11-redirect-oo.t | 10 +++++++---
 t/TestUtils.pm     |  6 ++++++
 2 files changed, 13 insertions&#40;+&#41;, 3 deletions&#40;-&#41;

diff --git a/t/11-redirect-oo.t b/t/11-redirect-oo.t
index c25315b..00e2c9b 100644
--- a/t/11-redirect-oo.t
+++ b/t/11-redirect-oo.t
@@ -23,9 +23,13 @@ TODO:{
     $slurp =~ s/\n\n\z/\n/m;
   }
 
-  our $txt; require &#39;./t/08-redirect.pl&#39;;
-  cmp_ok&#40;$txt, &#39;eq&#39;, $slurp, &#39;Redirection with OO&#39;&#41; || $^O =~ /MSWin32/ &#38;&#38;
-    diag&#40;&#34;If this test fails on Windows and all others pass, things are probably good. CMD appends an extra newline to redirected output.&#34;&#41;;
+    SKIP: {
+      skip_no_tty&#40;&#41;;
+
+      our $txt; require &#39;./t/08-redirect.pl&#39;;
+      cmp_ok&#40;$txt, &#39;eq&#39;, $slurp, &#39;Redirection with OO&#39;&#41; || $^O =~ /MSWin32/ &#38;&#38;
+        diag&#40;&#34;If this test fails on Windows and all others pass, things are probably good. CMD appends an extra newline to redirected output.&#34;&#41;;
+    }
 }
 
 
diff --git a/t/TestUtils.pm b/t/TestUtils.pm
index 90b9fd9..e60579d 100644
--- a/t/TestUtils.pm
+++ b/t/TestUtils.pm
@@ -13,6 +13,7 @@ BEGIN {
       skip_interactive
       skip_old_perl
       skip_no_file_which
+      skip_no_tty
       skip_not_in_path
       is_no
       is_yes
@@ -34,6 +35,11 @@ sub skip_no_file_which {
   skip &#34;This test requires File::Which.&#34;, 1 if not eval { require File::Which };
 }
 
+sub skip_no_tty {
+  skip &#34;/dev/tty cannot be opened.&#34;, 1 if not open&#40;my $fh, &#39;&lt;&#39;, &#39;/dev/tty&#39;&#41;;
+  close $fh;
+}
+
 sub skip_not_in_path {
   # Test that the specified executable can be found in the PATH environment
   # variable using File::Which.
-- 
2.21.0

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;30&nbsp;12:53:40&nbsp;2019</span>
    <span class="description">jpierce [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;30&nbsp;12:53:40&nbsp;2019</span>
    <span class="description">jpierce [...] cpan.org -  Fixed in 0.44 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
