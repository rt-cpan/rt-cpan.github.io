<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40169 for Finance-Quote: European mutual funds identified by ISIN are not retrieved correctly</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40169 for Finance-Quote: European mutual funds identified by ISIN are not retrieved correctly</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Finance-Quote/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Finance-Quote">Finance-Quote CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40169</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Finance-Quote/Active/">Finance-Quote</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">eco [...] ecocode.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dbreiser [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-13576-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.13</li>
<li>
1.14</li>
</ul>
    </td>
  </tr>
  <tr id="CF-13577-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;12:39:08&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> European mutual funds identified by ISIN are not retrieved correctly</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Many European mutual funds have started using ISINs instead of
traditional ticker symbols. Using an ISIN in finance-quote 1.14 succeeds
in retrieving a price, but at least in the gnucash implementation the
date and currency are broken. Using the ticker symbols in yahoo_europe.t
works:

$gnc-fq-dump yahoo_europe BAY.L
Finance::Quote fields Gnucash uses:
    symbol: BAY.L                &lt;=== required
      date: 10/17/2008           &lt;=== required
  currency: GBP                  &lt;=== required
      last: 1.271                &lt;=\       
       nav:                      &lt;=== one of these
     price: 1.271                &lt;=/        
  timezone:                      &lt;=== optional

but a request by ISIN only partially succeeds:

$gnc-fq-dump yahoo_europe GB0001036531GBP
Finance::Quote fields Gnucash uses:
    symbol: GB0001036531GBP      &lt;=== required
      date: 00/00/2000           &lt;=== required
  currency: ** missing **        &lt;=== required
      last: 107.30               &lt;=\       
       nav:                      &lt;=== one of these
     price: 107.30               &lt;=/        
  timezone:                      &lt;=== optional

** This stock quote cannot be used by gnucash!!

The price quote agrees with the one retrieved via the web interface on
the Yahoo Europe site. The date failure looks like the same one in 1.13
once yahoo_europe change their d1 t1 behavior. The currency failure is
probably related, since it is last in the list and gets bamboozled by
the d1t1 problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;15:50:19&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 19 12:39:08 2008, dbreiser wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Many European mutual funds have started using ISINs instead of
&gt; traditional ticker symbols. Using an ISIN in finance-quote 1.14 succeeds
&gt; in retrieving a price, but at least in the gnucash implementation the
&gt; date and currency are broken. Using the ticker symbols in yahoo_europe.t
&gt; works:
</div>
This is expected behaviour since ISIN is not &#40;yet&#41; supported by yahoo_europe

   perldoc Finance::Quote::Yahoo::Europe

will tell you that the module expects SYMBOL.EXCHANGE as format.

This &#34;bug report&#34; will therefor be classified as a &#34;feature request&#34;
-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;15:50:22&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;15:52:27&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Severity Normal changed to Wishlist</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;20:12:45&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 19 15:50:19 2008, ecocode wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is expected behaviour since ISIN is not &#40;yet&#41; supported by
</div>yahoo_europe
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;    perldoc Finance::Quote::Yahoo::Europe
&gt; 
&gt; will tell you that the module expects SYMBOL.EXCHANGE as format.
&gt; 
&gt; This &#34;bug report&#34; will therefor be classified as a &#34;feature request&#34;
</div>
OK. I thought some of the comments on the sourceforge tracker had
patches that accomplished this. My bad. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;20:26:17&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m not sure if this is generic enough not to interfere with the usual
ticker definitions, but a gnucash user found something that worked for
his fund retrieval needs.

<span class="clickylink"><a target="new" rel="nofollow" href="https://lists.gnucash.org/pipermail/gnucash-user/2008-March/024211.html">https://lists.gnucash.org/pipermail/gnucash-user/2008-March/024211.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;21:30:24&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">gah.

<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/d/quotes.csv?s=GB0001036531GBP&#38;f=sl1d1t1c1ohgv&#38;e=.csv">http://uk.finance.yahoo.com/d/quotes.csv?s=GB0001036531GBP&#38;f=sl1d1t1c1ohgv&#38;e=.csv</a></span>
returns
GB0001036531GBP,107.30,N/A, 1:00PM,10/17/2008,-0.90,N/A,N/A,N/A,N/A 

<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/d/quotes.csv?s=GB0001036531GBP&#38;f=sl1t1c1ohgv&#38;e=.csv">http://uk.finance.yahoo.com/d/quotes.csv?s=GB0001036531GBP&#38;f=sl1t1c1ohgv&#38;e=.csv</a></span>
returns
GB0001036531GBP,107.30, 1:00PM,10/17/2008,-0.90,N/A,N/A,N/A,N/A

<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/d/quotes.csv?s=BAY.L&#38;f=sl1d1t1c1ohgv&#38;e=.csv">http://uk.finance.yahoo.com/d/quotes.csv?s=BAY.L&#38;f=sl1d1t1c1ohgv&#38;e=.csv</a></span>
returns
BAY.L,127.10, 4:35PM,10/17/2008,+9.40,125.00,128.00,120.30,28757194

<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/d/quotes.csv?s=BAY.L&#38;f=sl1t1c1ohgv&#38;e=.csv">http://uk.finance.yahoo.com/d/quotes.csv?s=BAY.L&#38;f=sl1t1c1ohgv&#38;e=.csv</a></span>
returns
BAY.L,127.10, 4:35PM,10/17/2008,+9.40,125.00,128.00,120.30,28757194

So -- d1 is a no-op for ticker symbols, but returns &#34;N/A&#34; for ISINs.

t1 returns 2 fields for either.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;21&nbsp;01:11:49&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch: European mutual funds identified by ISIN are not retrieved
 correctly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch works for me -- at least for yahoo usa and yahoo
europe with standard ticker.exchange, ISIN, or &#40;in USA&#41; plain ticker
symbols.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -u old/Base.pm new/Base.pm
--- old/Base.pm	2008-10-20 21:46:17.000000000 -0400
+++ new/Base.pm	2008-10-20 21:53:37.000000000 -0400
@@ -56,11 +56,11 @@
 # in the URL.  These are recorded below, along with their corresponding
 # field names.
 
-@FIELDS = qw/symbol name last date time net p_change volume bid ask
-             close open day_range year_range eps pe div_date div div_yield
-	     cap ex_div avg_vol currency/;
+@FIELDS = qw/symbol name last net p_change volume bid ask
+             close open day_range year_range eps pe div div_yield
+	     cap avg_vol currency time date div_date ex_div/;
 
-@FIELD_ENCODING = qw/s n l1 d1 t1 c1 p2 v b a p o m w e r r1 d y j1 q a2 c4/;
+@FIELD_ENCODING = qw/s n l1 c1 p2 v b a p o m w e r d y j1 a2 c4 t1 d1 r1 q/;
 
 # This returns a list of labels that are provided, so that code
 # that make use of this module can know what it&#39;s dealing with.
diff -u old/Europe.pm new/Europe.pm
--- old/Europe.pm	2008-10-20 21:46:07.000000000 -0400
+++ new/Europe.pm	2008-10-20 21:43:47.000000000 -0400
@@ -50,9 +50,9 @@
 # Another solution might be to change Base.pm FIELDS labels to this
 # string + div_date and ex_div. Code would be nicier, but this will
 # need more testing for other yahoo modules and can be done later.
-our @YH_EUROPE_FIELDS = qw/symbol name last time date net p_change volume bid ask
+our @YH_EUROPE_FIELDS = qw/symbol name last net p_change volume bid ask
                            close open day_range year_range eps pe div div_yield
-                           cap avg_vol currency/;
+                           cap avg_vol currency time date/;
 
 sub methods {return &#40;europe =&gt; \&#38;yahoo_europe,yahoo_europe =&gt; \&#38;yahoo_europe&#41;};
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;21&nbsp;02:43:23&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40169] Patch: European mutual funds identified by ISIN are not retrieved correctly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Oct 2008 08:43:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Erik Colson &lt;eco [...] ecocode.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Reiser via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Finance-Quote
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40169">http://rt.cpan.org/Ticket/Display.html?id=40169</a></span> &gt;
&gt;
&gt; The attached patch works for me -- at least for yahoo usa and yahoo
&gt; europe with standard ticker.exchange, ISIN, or &#40;in USA&#41; plain ticker
&gt; symbols.
&gt;
&gt;
&gt;   
</div>Hello David,

Thank you for your research and patch.

Yahoo Europe is returning weird answers on standard requests since a few 
months.
This is not the case for other yahoo sites however. That&#39;s why my patch 
for correcting date/time issues were local to Yahoo/Europe.pm.
I&#39;m afraid that modifying the request string might break quote retrieval 
on other exchanges ? Even if tests pass, there might be some people 
getting errors for specific quotes.

I think it is probably possible to leave the request string unmodified 
while handling ISIN codes separately.
For this I&#39;d need some tests to be added to yahoo_europe.t to check for 
ISIN codes.

It would be great if you could send me some ?

Thanks

-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;21&nbsp;10:50:07&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 21 02:43:23 2008, ecocode wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello David,
&gt; 
&gt; Thank you for your research and patch.
&gt; 
&gt; Yahoo Europe is returning weird answers on standard requests since a few 
&gt; months.
&gt; This is not the case for other yahoo sites however. That&#39;s why my patch 
&gt; for correcting date/time issues were local to Yahoo/Europe.pm.
&gt; I&#39;m afraid that modifying the request string might break quote retrieval 
&gt; on other exchanges ? Even if tests pass, there might be some people 
&gt; getting errors for specific quotes.
</div>
If Yahoo decides to break another region, we probably would be in
trouble again.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I think it is probably possible to leave the request string unmodified 
&gt; while handling ISIN codes separately.
&gt; For this I&#39;d need some tests to be added to yahoo_europe.t to check for 
&gt; ISIN codes.
&gt; 
&gt; It would be great if you could send me some ?
</div>
If you mean some ISIN codes, here&#39;s a few in different currencies:

DK0016260003DKK
LU0278527428EUR
IT0003110860ITA
GB0003243465GBP

Dave
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;21&nbsp;11:02:49&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looking at uk.finance, it looks like the more precise description of
these things would be ISIN-based fund symbols. The ISIN is the
combination of letters and numbers up to the final currency symbol.
Appending the 3 character currency type to the ISIN creates the symbol
yahoo europe uses to retrieve the quote. I have no clue why the ITA fund
returns euros and/or isn&#39;t designated with EUR.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;21&nbsp;12:57:24&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40169] European mutual funds identified by ISIN are not retrieved correctly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Oct 2008 18:57:12 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Erik Colson &lt;eco [...] ecocode.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Reiser via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Finance-Quote
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40169">http://rt.cpan.org/Ticket/Display.html?id=40169</a></span> &gt;
&gt;
&gt; Looking at uk.finance, it looks like the more precise description of
&gt; these things would be ISIN-based fund symbols. The ISIN is the
&gt; combination of letters and numbers up to the final currency symbol.
&gt; Appending the 3 character currency type to the ISIN creates the symbol
&gt; yahoo europe uses to retrieve the quote. I have no clue why the ITA fund
&gt; returns euros and/or isn&#39;t designated with EUR.
&gt;   
</div>hello David,

hmmm... these 2 symbols do exist and they return 2 different quotes : 
IT0003110860ITA and IT0003110860EUR
both do have the EUR currency though...
however, IT0003110860 doesn&#39;t return any data.

but :
yahoo seems to be able to see that DK0016260003DKK and DK0016260003 
&#40;ISIN code&#41; are equal and both return the same data.

I didn&#39;t check the other symbols you sent, but I guess ISIN code would 
be enough if there is no ambiguity...

regards

-- 
Erik Colson

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.ecocode.net">http://www.ecocode.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;23&nbsp;22:32:11&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A further complication, it looks like the British funds are coming back
in pence &#40;GBp&#41; rather than pounds &#40;GBP&#41;. I thought finance-quote already
handled that, but at least in my patch it isn&#39;t.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;25&nbsp;10:50:23&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40169] European mutual funds identified by ISIN are not retrieved correctly </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 25 Oct 2008 16:50:02 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Erik Colson &lt;eco [...] ecocode.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 21 Oct 2008, at 16:50, David Reiser via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Finance-Quote
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40169">http://rt.cpan.org/Ticket/Display.html?id=40169</a></span> &gt;
&gt;
&gt; On Tue Oct 21 02:43:23 2008, ecocode wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Hello David,
&gt;&gt;
&gt;&gt; Thank you for your research and patch.
&gt;&gt;
&gt;&gt; Yahoo Europe is returning weird answers on standard requests since  
&gt;&gt; a few
&gt;&gt; months.
&gt;&gt; This is not the case for other yahoo sites however. That&#39;s why my  
&gt;&gt; patch
&gt;&gt; for correcting date/time issues were local to Yahoo/Europe.pm.
&gt;&gt; I&#39;m afraid that modifying the request string might break quote  
&gt;&gt; retrieval
&gt;&gt; on other exchanges ? Even if tests pass, there might be some people
&gt;&gt; getting errors for specific quotes.
</div>&gt;
&gt; If Yahoo decides to break another region, we probably would be in
&gt; trouble again.
</div>
yep, the point is to be able to limit the impact of a &#39;local&#39; site  
change of yahoo on other site modules.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt;&gt;
&gt;&gt; I think it is probably possible to leave the request string  
&gt;&gt; unmodified
&gt;&gt; while handling ISIN codes separately.
&gt;&gt; For this I&#39;d need some tests to be added to yahoo_europe.t to check  
&gt;&gt; for
&gt;&gt; ISIN codes.
&gt;&gt;
&gt;&gt; It would be great if you could send me some ?
</div>&gt;
&gt; If you mean some ISIN codes, here&#39;s a few in different currencies:
&gt;
&gt; DK0016260003DKK
&gt; LU0278527428EUR
&gt; IT0003110860ITA
&gt; GB0003243465GBP
</div>
David,

I&#39;ve been checking these ISIN&#39;s and they seem to be funds, not stocks.
When checking DE0005140008.DE &#40;ISIN code of DBK.DE with .DE added,  
which is a stock&#41; yahoo returns the exact same line as for DBK.DE. So  
finance::quote doesn&#39;t find a line with &#34;DE0005140008.DE&#34; in the  
returned .csv and will then report this request as &#39;bogus&#39;.

My conclusion is :
- for checking ISIN codes of stocks : check the returned .csv and use  
the listed symbol for querying yahoo. or use the online yahoo lookup  
form to find the corresponding symbol of the stock.
- for funds: yahoo europe returns another format in .csv for fund  
requests than stock requests. It even returns more fields. We should  
therefor create a new module &#40;maybe based on yahoo_europe and using  
your query string&#41; called something like &#39;yahoo_europe_funds.pm&#39; which  
would handle the .csv returned by yahoo correctly.

Please tell me if this analysis corresponds to your needs. Writing a  
new module isn&#39;t dramatic if the query-string and .csv handling is  
known.

--
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;25&nbsp;10:57:21&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40169] European mutual funds identified by ISIN are not retrieved correctly </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 25 Oct 2008 16:57:08 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Erik Colson &lt;eco [...] ecocode.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 24 Oct 2008, at 04:32, David Reiser via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Finance-Quote
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40169">http://rt.cpan.org/Ticket/Display.html?id=40169</a></span> &gt;
&gt;
&gt; A further complication, it looks like the British funds are coming  
&gt; back
&gt; in pence &#40;GBp&#41; rather than pounds &#40;GBP&#41;. I thought finance-quote  
&gt; already
&gt; handled that, but at least in my patch it isn&#39;t.
</div>

Hi David,

hmmm... is this related to querying fund quotes with your patched  
version ? if not, please send me a quote symbol which returns &#39;GBp&#39; as  
currency

For info: on my system BAY.L returns GBP as currency &#40;it is in the  
yahoo_europe.t test also&#41;

regards

--
erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;25&nbsp;10:58:28&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;27&nbsp;22:52:00&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Oct 25 10:57:21 2008, ecocode wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On 24 Oct 2008, at 04:32, David Reiser via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt;       Queue: Finance-Quote
&gt; &gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40169">http://rt.cpan.org/Ticket/Display.html?id=40169</a></span> &gt;
&gt; &gt;
&gt; &gt; A further complication, it looks like the British funds are coming  
&gt; &gt; back
&gt; &gt; in pence &#40;GBp&#41; rather than pounds &#40;GBP&#41;. I thought finance-quote  
&gt; &gt; already
&gt; &gt; handled that, but at least in my patch it isn&#39;t.
</div>&gt; 
&gt; 
&gt; Hi David,
&gt; 
&gt; hmmm... is this related to querying fund quotes with your patched  
&gt; version ? if not, please send me a quote symbol which returns &#39;GBp&#39; as  
&gt; currency
&gt; 
&gt; For info: on my system BAY.L returns GBP as currency &#40;it is in the  
&gt; yahoo_europe.t test also&#41;
&gt; 
&gt; regards
&gt; 
&gt; --
&gt; erik
</div>
If I go to the uk.yahoo web site and ask for a quote for
GB0003243465GBP, the quote that comes back is labelled &#34;p&#34;. I don&#39;t know
exactly what it&#39;s passing to f-q. But the one gnucash user that&#39;s been
testing my attempted patch says that all his fund quotes are coming back
&#40;ending up in gnucash&#41; 100x the real value.

Also as far as I know, the only people concerned are those looking for
fund quotes. Anyone looking for stock quotes uses a standard
ticker.exchange symbol. It appears that only the funds have quit using
the formerly common ticker symbols and switched to ISIN-based id&#39;s. &#40;at
least in yahoo europe.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;02:43:13&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40169] European mutual funds identified by ISIN are not retrieved correctly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Oct 2008 07:42:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Erik Colson &lt;eco [...] ecocode.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Reiser via RT wrote:Hi David!

Thanks for your research !

I can think of tree options for solving this funds problem :
- Somehow we tell yahoo_europe.pm we are checking an ISIN fund &#40;by 
adding a suffix like &#34;.ISINFUND&#34; for example&#41;. That way we the query 
string and @FIELDS array can be modified in the yahoo_europe module. 
This would need a major code adaptation for solving issues like : What 
if the user checks stocks and funds in one pass ? We would need 
yahoo_europe to separate the &#34;non ISIN quotes&#34; from the &#34;ISIN quotes&#34; 
and treat those in 2 separate subs.
- We separate ISIN funds into a new module called 
yahoo_europe_isinfunds.pm. No suffix needed since the user tells how the 
quote should be retrieved...
- We find a query string which would return the same data format for the 
funds as for other quotes. &#40;The query string you mentioned earlier 
didn&#39;t on my system&#41;

I guess the third option is the utopic one and I won&#39;t try to search 
after this ;&#41;
Then the first option would be the &#39;nice&#39; one, but nice options allways 
take more coding and code rewriting ;&#41;
Please tell me which option would be ok for gnucash or maybe you have 
another idea ?

I&#39;ll work on this later this week, as I&#39;m working on a Finance::QuoteDB 
pre-alpha release for the moment...

regards

-- 
Erik Colson
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;11:20:01&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 28 02:43:13 2008, ecocode wrote:
Hi David!
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Thanks for your research !
&gt; 
&gt; I can think of tree options for solving this funds problem :
&gt; - Somehow we tell yahoo_europe.pm we are checking an ISIN fund &#40;by 
&gt; adding a suffix like &#34;.ISINFUND&#34; for example&#41;. That way we the query 
&gt; string and @FIELDS array can be modified in the yahoo_europe module. 
&gt; This would need a major code adaptation for solving issues like : What 
&gt; if the user checks stocks and funds in one pass ? We would need 
&gt; yahoo_europe to separate the &#34;non ISIN quotes&#34; from the &#34;ISIN quotes&#34; 
&gt; and treat those in 2 separate subs.
&gt; - We separate ISIN funds into a new module called 
&gt; yahoo_europe_isinfunds.pm. No suffix needed since the user tells how the 
&gt; quote should be retrieved...
&gt; - We find a query string which would return the same data format for the 
&gt; funds as for other quotes. &#40;The query string you mentioned earlier 
&gt; didn&#39;t on my system&#41;
&gt; 
&gt; I guess the third option is the utopic one and I won&#39;t try to search 
&gt; after this ;&#41;
&gt; Then the first option would be the &#39;nice&#39; one, but nice options allways 
&gt; take more coding and code rewriting ;&#41;
&gt; Please tell me which option would be ok for gnucash or maybe you have 
&gt; another idea ?
&gt; 
</div>
I think the third option might be pretty brittle in the face of yahoo&#39;s
inconsistencies. The first option seems like more work than is warranted. 

I think the yahoo_europe_isinfunds.pm idea works, both from the
standpoint of limited coding required and explaining to gnucash users
what they need to change to finally get fund quotes working again. From
what I&#39;ve seen, as long as the finance-quote hash comes back
intelligibly, gnucash can use the data correctly. The two not-so-visible
issues are that the time has to parse on the gnucash end &#40;they can even
simplify their stuff by using isodate and time instead of using
DateManip&#41;, and someone has to be sure that the decimal place is in the
right position. &#40;I think there are 2 or three data sources that at least
sometimes report hundredths of main currency units, like pence instead
of pounds in the yahoo_europe British fund listings.&#41; 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;29&nbsp;21:36:46&nbsp;2008</span>
    <span class="description">hampton [...] employees.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> hampton [...] employees.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40169] European mutual funds identified by ISIN are not retrieved correctly</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Oct 2008 21:36:26 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Hampton &lt;hampton [...] employees.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 2008-10-27 at 22:52 -0400, David Reiser via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I go to the uk.yahoo web site and ask for a quote for
&gt; GB0003243465GBP, the quote that comes back is labelled &#34;p&#34;. I don&#39;t know
&gt; exactly what it&#39;s passing to f-q. But the one gnucash user that&#39;s been
&gt; testing my attempted patch says that all his fund quotes are coming back
&gt; &#40;ending up in gnucash&#41; 100x the real value.
</div>
The file Finance/Quote/Yahoo/Base.pm has logic in it to convert GBp to
GBP.  Sounds like this code isn&#39;t getting triggered for these quotes.

David
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;01&nbsp;20:13:41&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 29 21:36:46 2008, HAMPTON wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The file Finance/Quote/Yahoo/Base.pm has logic in it to convert GBp to
&gt; GBP.  Sounds like this code isn&#39;t getting triggered for these quotes.
&gt; 
</div>
Yes. That&#39;d be because you don&#39;t/can&#39;t set the exchange for the fund
quotes, so it&#39;s never the case that $exchange = L &#40;the first half of the
scaling test&#41;.

Dave
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;08&nbsp;15:16:35&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 28 02:43:13 2008, ecocode wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; David Reiser via RT wrote:Hi David!
</div>snip
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - We separate ISIN funds into a new module called 
&gt; yahoo_europe_isinfunds.pm. No suffix needed since the user tells how the 
&gt; quote should be retrieved...
</div>
 
Here is a monkey-see monkey-do approach to a separate module for the
ISIN-based symbol quote retrieval.

I added the pence to pounds conversion here since the fund quotes won&#39;t
trigger the correction test in Base.pm. I am mystified, however, by the
fact that this module sees the currency as &#34;GBP&#34; already. I know Yahoo
Europe is sending &#34;GBp&#34; in the raw data. If I add an additional test in
Base.pm to do the scaling for fund quotes there, it has to look for
&#34;GBp&#34;, but the test in EuropeFund.pm must look for &#34;GBP&#34; or it fails.

One advantage of this module over my attempts to reorder FIELDS or
FIELD_ENCODING in yahoo_europe is that quotes retrieved from this module
have no errormsg entry.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
#
#    Copyright &#40;C&#41; 1998, Dj Padzensky &lt;djpadz@padz.net&gt;
#    Copyright &#40;C&#41; 1998, 1999 Linas Vepstas &lt;linas@linas.org&gt;
#    Copyright &#40;C&#41; 2000, Yannick LE NY &lt;y-le-ny@ifrance.com&gt;
#    Copyright &#40;C&#41; 2000, Paul Fenwick &lt;pjf@cpan.org&gt;
#    Copyright &#40;C&#41; 2000, Brent Neal &lt;brentn@users.sourceforge.net&gt;
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    &#40;at your option&#41; any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
#    02111-1307, USA
#
# This code derived from Padzensky&#39;s work on package Finance::YahooQuote,
# but extends its capabilites to encompas a greater number of data sources.
#
# This code was developed as part of GnuCash &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnucash.org/">http://www.gnucash.org/</a></span>&gt;

package Finance::Quote::Yahoo::EuropeFund;
require 5.005;

use strict;
use HTTP::Request::Common;
use LWP::UserAgent;
use Finance::Quote::Yahoo::Base qw/yahoo_request base_yahoo_labels/;

use vars qw&#40;$VERSION $YAHOO_EUROPE_URL&#41;;

$VERSION = &#39;1.15&#39;;

# URLs of where to obtain information.

$YAHOO_EUROPE_URL = &#40;&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/d/quotes.csv">http://uk.finance.yahoo.com/d/quotes.csv</a></span>&#34;&#41;;

# Based on Yahoo_europe module, changes to enable retrieval for funds
# identified by ISIN-based symbols &#40;ISIN + currency code&#41;.
# Yahoo Europe broke date and time. sending d1 is a no-op, sending t1
# returns Time followed by Date &#40;2 fields returned for 1 sent&#41;. 
#
# Time code placed last so the 2 fields returned don&#39;t screw up field counting.

our @YH_EUROPE_FUNDS_FIELDS = qw/symbol name last net p_change volume bid ask
                           close open day_range year_range eps pe div div_yield
                           cap avg_vol currency time date/;
                           
our @YH_EUROPE_FUNDS_FIELD_ENCODING = qw/s n l1 c1 p2 v b a p o m w e r d y j1 a2 c4 t1 d1/;

sub methods {return &#40;europe_funds =&gt; \&#38;yahoo_europe_funds,yahoo_europe_funds =&gt; \&#38;yahoo_europe_funds&#41;};

{
	my @labels = &#40;base_yahoo_labels&#40;&#41;,&#34;currency&#34;,&#34;method&#34;&#41;;

	sub labels { return &#40;europe_funds =&gt; \@labels, yahoo_europe_funds =&gt; \@labels&#41;; }
}

# =======================================================================
# yahoo_europe_funds gets quotes for European mutual funds from Yahoo.
sub yahoo_europe_funds
{
	my $quoter = shift;
	my @symbols = @_;
	return unless @symbols;	# Nothing if no symbols.

        # localise the Base.FIELDS and Base.FIELS_ENCODING arrays. Perl restores the arrays at
        # the end of this sub.
        local @Finance::Quote::Yahoo::Base::FIELDS = @YH_EUROPE_FUNDS_FIELDS ;
        local @Finance::Quote::Yahoo::Base::FIELD_ENCODING = @YH_EUROPE_FUNDS_FIELD_ENCODING ;

	# This does all the hard work.
	my %info = yahoo_request&#40;$quoter,$YAHOO_EUROPE_URL,\@symbols&#41;;

	foreach my $symbol &#40;@symbols&#41; {
		next unless $info{$symbol,&#34;success&#34;};
		$info{$symbol,&#34;method&#34;} = &#34;yahoo_europe_funds&#34;;
		# Yahoo doesn&#39;t return an exchange for fund quotes
		# so logic in Base.pm that catches and changes pence quotes to pounds
		# will not work. Change pence to pounds here instead.
		if &#40;$info{$symbol,&#34;currency&#34;} eq &#34;GBP&#34;&#41; {
		  foreach my $field &#40;$quoter-&gt;default_currency_fields&#41; {
			  next unless &#40;$info{$symbol,$field}&#41;;
			  $info{$symbol,$field} =
			  $quoter-&gt;scale_field&#40;$info{$symbol,$field},0.01&#41;;
			  }
			}
	}

	return %info if wantarray;
	return \%info;
}

1;

=head1 NAME

Finance::Quote::Yahoo::EuropeFund - Fetch mutual fund quotes from Yahoo Europe

=head1 SYNOPSIS

    use Finance::Quote;
    $q = Finance::Quote-&gt;new;

    %info = $q-&gt;fetch&#40;&#34;europe_funds&#34;,&#34;GB0001036531GBP&#34;&#41;; # Failover to other methods ok.
    %info = $q-&gt;fetch&#40;&#34;yahoo_europe_funds&#34;,&#34;GB0001036531GBP&#34;&#41;; # Use this module only.

=head1 DESCRIPTION

This module fetches information from Yahoo Europe.  Symbols should be
provided in the format ISIN+currency code &#40;e.g. GB0001036531GBP&#41;

This module provides both the &#34;europe_funds&#34; and &#34;yahoo_europe_funds&#34; methods.

This module is loaded by default by Finance::Quote, but can be loaded
explicitly by specifying the parameter &#34;Yahoo::EuropeFund&#34; to
Finance::Quote-&gt;new&#40;&#41;.

Information obtained by this module may be covered by Yahoo&#39;s terms
and conditions.  See <span class="clickylink"><a target="new" rel="nofollow" href="http://finance.uk.yahoo.com/">http://finance.uk.yahoo.com/</a></span> for more details.

=head1 LABELS RETURNED

This module returns all the standard labels &#40;where available&#41; provided
by Yahoo.  See Finance::Quote::Yahoo::Base for a list of these.  The
currency label is also returned.

Note however that div_date and ex_div have been removed by yahoo
europe site

=head1 SEE ALSO

Yahoo Europe, <span class="clickylink"><a target="new" rel="nofollow" href="http://finance.uk.yahoo.com/">http://finance.uk.yahoo.com/</a></span>

Finance::Quote::Yahoo::Base

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;09&nbsp;15:41:53&nbsp;2008</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40169] European mutual funds identified by ISIN are not retrieved correctly </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Nov 2008 21:41:37 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Erik Colson &lt;eco [...] ecocode.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

When reading your file I saw you mentioned it as part of the Gnucash  
project. That is ok for me, but It cannot be incorporated in 2  
projects...

regards

On 08 Nov 2008, at 21:16, David Reiser via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # This code was developed as part of GnuCash &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnucash.org/">http://www.gnucash.org/</a></span>&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;09&nbsp;15:50:40&nbsp;2008</span>
    <span class="description">dbreiser [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbreiser [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Nov 09 15:41:53 2008, ecocode wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi David,
&gt; 
&gt; When reading your file I saw you mentioned it as part of the Gnucash  
&gt; project. That is ok for me, but It cannot be incorporated in 2  
&gt; projects...
&gt; 
&gt; regards
&gt; 
&gt; On 08 Nov 2008, at 21:16, David Reiser via RT wrote:
<div class="message-stanza open">&gt; &gt; # This code was developed as part of GnuCash &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnucash.org/">http://www.gnucash.org/</a></span>&gt;
</div>&gt; 
</div>
That&#39;s ancient history &#40;I think&#41;. That part was just copied over from
the yahoo europe pm. As far as I know, all finance-quote modules live
strictly in finance-quote. There is one interface perl script in gnucash
that chats with finance-quote to request and parse data, but all the
rest is handled by finance-quote.

As far as I&#39;m concerned, the mention of gnucash could be removed in this
case as long as former contributors wouldn&#39;t be unhappy. Since I only
added/changed about 10 lines of code, I didn&#39;t think I could remove
other documentation.

Dave
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;15&nbsp;17:18:32&nbsp;2010</span>
    <span class="description">gowdy [...] cern.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gowdy [...] cern.ch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 08 15:16:35 2008, dbreiser wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here is a monkey-see monkey-do approach to a separate module for the
&gt; ISIN-based symbol quote retrieval.
</div>
Hi David,

I just tried your module with fq 1.17 but to no avail. DO you think it
should work still? Or has some other solution transpired since 2008?

[root@antonia Finance]# gnc-fq-dump -v yahoo_europe_funds GB0003243465GBP
No results found for stock GB0003243465GBP.
[root@antonia Finance]# gnc-fq-dump -v yahoo_europe_funds GB0003243465GBP.L
No results found for stock GB0003243465GBP.L.
[root@antonia Finance]# gnc-fq-dump -v yahoo_europe_funds GB0003243465.L
No results found for stock GB0003243465.L.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
