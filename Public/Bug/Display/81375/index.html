<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #81375 for Inline: chdir without cc</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #81375 for Inline: chdir without cc</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Inline">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Inline">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Inline">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Inline">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/ingydotnet/inline-pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Inline">Inline CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">81375</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Inline">Inline</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bernhard+cpan [...] lsmod.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16878-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.50    </td>
  </tr>
  <tr id="CF-16879-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=81375">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1146109" href="/Public/Bug/Display.html?id=81375#txn-1146109">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;23&nbsp;07:52:45&nbsp;2012</span>
    <span class="description">bitcardbmw [...] lsmod.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> chdir without cc</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1146109/602733/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/602733">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 345b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I used Inline C in eval 
to make optional acceleration 
and fallback to generic perl if unavailable,
but this failed when no gcc was installed,
because Inline would chdir to the _Inline/build/xxx_xxxx dir
and remain there when the program started

This caused errors with modules in &#34;.&#34; not being found
and output files going to the wrong place.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1146366" href="/Public/Bug/Display.html?id=81375#txn-1146366">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;23&nbsp;20:17:08&nbsp;2012</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1146366/602861/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/602861">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 23 07:52:45 2012, bmwiedemann wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I used Inline C in eval 
&gt; to make optional acceleration 
&gt; and fallback to generic perl if unavailable,
&gt; but this failed when no gcc was installed,
&gt; because Inline would chdir to the _Inline/build/xxx_xxxx dir
&gt; and remain there when the program started
&gt; 
&gt; This caused errors with modules in &#34;.&#34; not being found
&gt; and output files going to the wrong place.
</div>
Could you post a simple demo script ? I can&#39;t reproduce the problem.

I tried the following test script:

########################
use strict;
use warnings;

eval {
 require Inline; Inline-&gt;import &#40;C =&gt; Config =&gt;
    BUILD_NOISY =&gt; 1&#41;;

 require Inline; Inline-&gt;import &#40;C =&gt;&lt;&lt;&#39; EOC&#39;&#41;;

 int foo&#40;&#41; {
   warn&#40;&#34;Using Inline\n&#34;&#41;;
   return 42;
 }

 EOC
};

# If Inline is unavailable, foo&#40;&#41; simply calls
# the sub bar&#40;&#41; pure perl implementation.
if&#40;$@&#41; {
  *foo =\&#38;bar; 
}

sub bar {
  warn&#40;&#34;Using Pure Perl Implementation\n&#34;&#41;;
  return 42;
}

my $x = foo&#40;&#41;;
print &#34;$x\n&#34;;
########################

If I hide cc &#40;gcc.exe in my case&#41;, the build fails for that reason, and
the script falls back to the pure perl implementation &#40;sub bar&#41;.
This is as it&#39;s meant to be, and as it should be.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1146369" href="/Public/Bug/Display.html?id=81375#txn-1146369">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;23&nbsp;20:17:09&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1146575" href="/Public/Bug/Display.html?id=81375#txn-1146575">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;24&nbsp;07:56:37&nbsp;2012</span>
    <span class="description">bitcardbmw [...] lsmod.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bitcardbmw [...] lsmod.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1146575/602986/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/602986">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Fr 23. Nov 2012, 20:17:08, SISYPHUS schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I hide cc &#40;gcc.exe in my case&#41;, the build fails for that reason, and
&gt; the script falls back to the pure perl implementation &#40;sub bar&#41;.
&gt; This is as it&#39;s meant to be, and as it should be.
</div>
I appended to your script:
system&#40;&#34;pwd&#34;&#41;;

then did
mv /usr/bin/cc{,.bak}
rm -rf _Inline
perl testc.pl
[...]
  Starting &#34;make&#34; Stage
/usr/bin/perl /usr/lib/perl5/5.16.0/ExtUtils/xsubpp  -typemap
&#34;/usr/lib/perl5/5.16.0/ExtUtils/typemap&#34;   testc_pl_b91d.xs &gt;
testc_pl_b91d.xsc &#38;&#38; mv testc_pl_b91d.xsc testc_pl_b91d.c
cc -c  -I&#34;/home/bernhard/temp&#34; -D_REENTRANT -D_GNU_SOURCE
-DPERL_USE_SAFE_PUTENV -fno-strict-aliasing -pipe -fstack-protector
-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -fmessage-length=0 -O2 -Wall
-D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables
-fasynchronous-unwind-tables -g -Wall -pipe   -DVERSION=\&#34;0.00\&#34;
-DXS_VERSION=\&#34;0.00\&#34; -fPIC
&#34;-I/usr/lib/perl5/5.16.0/x86_64-linux-thread-multi/CORE&#34;   testc_pl_b91d.c
/bin/sh: cc: command not found
make: *** [testc_pl_b91d.o] Error 127
Using Pure Perl Implementation
42
/home/bernhard/temp/_Inline/build/testc_pl_b91d

and it showed that it changed the current dir for the perl process
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1146886" href="/Public/Bug/Display.html?id=81375#txn-1146886">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;24&nbsp;19:52:30&nbsp;2012</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1146886/603129/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603129">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 24 07:56:37 2012, bmwiedemann wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I appended to your script:
&gt; system&#40;&#34;pwd&#34;&#41;;
</div>
[snip]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Using Pure Perl Implementation
&gt; 42
&gt; /home/bernhard/temp/_Inline/build/testc_pl_b91d
&gt; 
&gt; and it showed that it changed the current dir for the perl process
</div>
Yes, this could be fixed from within the script I provided as follows:

#################################
use strict;
use warnings;
use Cwd;


my $cwd = getcwd&#40;&#41;;

eval {
 require Inline; Inline-&gt;import &#40;C =&gt; Config =&gt;
    #CC =&gt; &#39;bogus&#39;, # Easy way to make the build fail
    BUILD_NOISY =&gt; 1&#41;;

 require Inline; Inline-&gt;import &#40;C =&gt;&lt;&lt;&#39; EOC&#39;&#41;;

 int foo&#40;&#41; {
   warn&#40;&#34;Using Inline\n&#34;&#41;;
   return 42;
 }

 EOC
};

# If Inline is unavailable, foo&#40;&#41; simply calls
# the sub bar&#40;&#41; pure perl implementation.
if&#40;$@&#41; {
  chdir $cwd or warn &#34;Couldn&#39;t chdir to $cwd&#34;;
  *foo =\&#38;bar; 
}

sub bar {
  warn&#40;&#34;Using Pure Perl Implementation\n&#34;&#41;;
  return 42;
}

my $x = foo&#40;&#41;;
print &#34;$x\n&#34;;
print $cwd, &#34;\n&#34;;
#################################

&#40;I&#39;ve used Cwd::getcwd instead of the pwd system call because pwd is not
available on all systems.&#41;

However, I think &#40;not yet fully tested&#41; this can also be fixed quite
simply from within C.pm by rewriting sub compile as:

#################################
sub compile {
    my $o = shift;

    my $build_dir = $o-&gt;{API}{build_dir};
    my $cwd = &#38;cwd;
    &#40;$cwd&#41; = $cwd =~ /&#40;.*&#41;/ if $o-&gt;UNTAINT;

    chdir $build_dir;
    eval {
    $o-&gt;call&#40;&#39;makefile_pl&#39;, &#39;&#34;perl Makefile.PL&#34;&#39;, 2&#41;;
    $o-&gt;call&#40;&#39;make&#39;, &#39;&#34;make&#34;&#39;, 2&#41;;
    $o-&gt;call&#40;&#39;make_install&#39;, &#39;&#34;make install&#34;&#39;, 2&#41;;
    };
    chdir $cwd;
    die if $@;
    $o-&gt;call&#40;&#39;cleanup&#39;, &#39;Cleaning Up&#39;, 2&#41;;
}
#################################

So I&#39;ll go with that changed version of C.pm&#39;s sub compile unless, in
the course of more thorough testing, I discover a problem with it.
If it tests ok for me, I&#39;ll release an Inline-0.51_03 that contains the
fix in a day or two.

Thanks for the report !

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1147576" href="/Public/Bug/Display.html?id=81375#txn-1147576">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;18:53:28&nbsp;2012</span>
    <span class="description">dcmertens.perl [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81375] chdir without cc</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Nov 2012 17:53:18 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Mertens &lt;dcmertens.perl [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1147576/603483/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603483">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">For the curious, a CPAN solution that handles this *very* nicely is
p3rl.org/File::chdir

David
On Nov 24, 2012 6:52 PM, &#34;Sisyphus via RT&#34; &lt;bug-Inline@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sat Nov 24 19:52:30 2012: Request 81375 was acted upon.
&gt; Transaction: Correspondence added by SISYPHUS
&gt;        Queue: Inline
&gt;      Subject: chdir without cc
&gt;    Broken in: 0.50
&gt;     Severity: Normal
&gt;        Owner: Nobody
&gt;   Requestors: bernhard+cpan@lsmod.de
&gt;       Status: open
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81375">https://rt.cpan.org/Ticket/Display.html?id=81375</a></span> &gt;
&gt;
&gt;
&gt; On Sat Nov 24 07:56:37 2012, bmwiedemann wrote:
&gt;
<div class="message-stanza open">&gt; &gt; I appended to your script:
&gt; &gt; system&#40;&#34;pwd&#34;&#41;;
</div>&gt;
&gt; [snip]
&gt;
<div class="message-stanza open">&gt; &gt; Using Pure Perl Implementation
&gt; &gt; 42
&gt; &gt; /home/bernhard/temp/_Inline/build/testc_pl_b91d
&gt; &gt;
&gt; &gt; and it showed that it changed the current dir for the perl process
</div>&gt;
&gt; Yes, this could be fixed from within the script I provided as follows:
&gt;
&gt; #################################
&gt; use strict;
&gt; use warnings;
&gt; use Cwd;
&gt;
&gt;
&gt; my $cwd = getcwd&#40;&#41;;
&gt;
&gt; eval {
&gt;  require Inline; Inline-&gt;import &#40;C =&gt; Config =&gt;
&gt;     #CC =&gt; &#39;bogus&#39;, # Easy way to make the build fail
&gt;     BUILD_NOISY =&gt; 1&#41;;
&gt;
&gt;  require Inline; Inline-&gt;import &#40;C =&gt;&lt;&lt;&#39; EOC&#39;&#41;;
&gt;
&gt;  int foo&#40;&#41; {
&gt;    warn&#40;&#34;Using Inline\n&#34;&#41;;
&gt;    return 42;
&gt;  }
&gt;
&gt;  EOC
&gt; };
&gt;
&gt; # If Inline is unavailable, foo&#40;&#41; simply calls
&gt; # the sub bar&#40;&#41; pure perl implementation.
&gt; if&#40;$@&#41; {
&gt;   chdir $cwd or warn &#34;Couldn&#39;t chdir to $cwd&#34;;
&gt;   *foo =\&#38;bar;
&gt; }
&gt;
&gt; sub bar {
&gt;   warn&#40;&#34;Using Pure Perl Implementation\n&#34;&#41;;
&gt;   return 42;
&gt; }
&gt;
&gt; my $x = foo&#40;&#41;;
&gt; print &#34;$x\n&#34;;
&gt; print $cwd, &#34;\n&#34;;
&gt; #################################
&gt;
&gt; &#40;I&#39;ve used Cwd::getcwd instead of the pwd system call because pwd is not
&gt; available on all systems.&#41;
&gt;
&gt; However, I think &#40;not yet fully tested&#41; this can also be fixed quite
&gt; simply from within C.pm by rewriting sub compile as:
&gt;
&gt; #################################
&gt; sub compile {
&gt;     my $o = shift;
&gt;
&gt;     my $build_dir = $o-&gt;{API}{build_dir};
&gt;     my $cwd = &#38;cwd;
&gt;     &#40;$cwd&#41; = $cwd =~ /&#40;.*&#41;/ if $o-&gt;UNTAINT;
&gt;
&gt;     chdir $build_dir;
&gt;     eval {
&gt;     $o-&gt;call&#40;&#39;makefile_pl&#39;, &#39;&#34;perl Makefile.PL&#34;&#39;, 2&#41;;
&gt;     $o-&gt;call&#40;&#39;make&#39;, &#39;&#34;make&#34;&#39;, 2&#41;;
&gt;     $o-&gt;call&#40;&#39;make_install&#39;, &#39;&#34;make install&#34;&#39;, 2&#41;;
&gt;     };
&gt;     chdir $cwd;
&gt;     die if $@;
&gt;     $o-&gt;call&#40;&#39;cleanup&#39;, &#39;Cleaning Up&#39;, 2&#41;;
&gt; }
&gt; #################################
&gt;
&gt; So I&#39;ll go with that changed version of C.pm&#39;s sub compile unless, in
&gt; the course of more thorough testing, I discover a problem with it.
&gt; If it tests ok for me, I&#39;ll release an Inline-0.51_03 that contains the
&gt; fix in a day or two.
&gt;
&gt; Thanks for the report !
&gt;
&gt; Cheers,
&gt; Rob
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1147576/603484/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603484">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1147590" href="/Public/Bug/Display.html?id=81375#txn-1147590">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;21:03:00&nbsp;2012</span>
    <span class="description">xyf.xiao [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> inline [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81375] chdir without cc</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Nov 2012 10:02:28 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Xiao Yafeng &lt;xyf.xiao [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1147590/603492/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603492">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I vote for David,  It&#39;s a bug from chdir other than Inline.

On Tue, Nov 27, 2012 at 7:53 AM, dcmertens.perl@gmail.com via RT &lt;
bug-Inline@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Nov 26 18:53:28 2012: Request 81375 was acted upon.
&gt; Transaction: Correspondence added by dcmertens.perl@gmail.com
&gt;        Queue: Inline
&gt;      Subject: Re: [rt.cpan.org #81375] chdir without cc
&gt;    Broken in: 0.50
&gt;     Severity: Normal
&gt;        Owner: Nobody
&gt;   Requestors: bernhard+cpan@lsmod.de
&gt;       Status: open
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81375">https://rt.cpan.org/Ticket/Display.html?id=81375</a></span> &gt;
&gt;
&gt;
&gt; For the curious, a CPAN solution that handles this *very* nicely is
&gt; p3rl.org/File::chdir
&gt;
&gt; David
&gt; On Nov 24, 2012 6:52 PM, &#34;Sisyphus via RT&#34; &lt;bug-Inline@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt; Sat Nov 24 19:52:30 2012: Request 81375 was acted upon.
&gt; &gt; Transaction: Correspondence added by SISYPHUS
&gt; &gt;        Queue: Inline
&gt; &gt;      Subject: chdir without cc
&gt; &gt;    Broken in: 0.50
&gt; &gt;     Severity: Normal
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: bernhard+cpan@lsmod.de
&gt; &gt;       Status: open
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81375">https://rt.cpan.org/Ticket/Display.html?id=81375</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Sat Nov 24 07:56:37 2012, bmwiedemann wrote:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; I appended to your script:
&gt; &gt; &gt; system&#40;&#34;pwd&#34;&#41;;
</div>&gt; &gt;
&gt; &gt; [snip]
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; Using Pure Perl Implementation
&gt; &gt; &gt; 42
&gt; &gt; &gt; /home/bernhard/temp/_Inline/build/testc_pl_b91d
&gt; &gt; &gt;
&gt; &gt; &gt; and it showed that it changed the current dir for the perl process
</div>&gt; &gt;
&gt; &gt; Yes, this could be fixed from within the script I provided as follows:
&gt; &gt;
&gt; &gt; #################################
&gt; &gt; use strict;
&gt; &gt; use warnings;
&gt; &gt; use Cwd;
&gt; &gt;
&gt; &gt;
&gt; &gt; my $cwd = getcwd&#40;&#41;;
&gt; &gt;
&gt; &gt; eval {
&gt; &gt;  require Inline; Inline-&gt;import &#40;C =&gt; Config =&gt;
&gt; &gt;     #CC =&gt; &#39;bogus&#39;, # Easy way to make the build fail
&gt; &gt;     BUILD_NOISY =&gt; 1&#41;;
&gt; &gt;
&gt; &gt;  require Inline; Inline-&gt;import &#40;C =&gt;&lt;&lt;&#39; EOC&#39;&#41;;
&gt; &gt;
&gt; &gt;  int foo&#40;&#41; {
&gt; &gt;    warn&#40;&#34;Using Inline\n&#34;&#41;;
&gt; &gt;    return 42;
&gt; &gt;  }
&gt; &gt;
&gt; &gt;  EOC
&gt; &gt; };
&gt; &gt;
&gt; &gt; # If Inline is unavailable, foo&#40;&#41; simply calls
&gt; &gt; # the sub bar&#40;&#41; pure perl implementation.
&gt; &gt; if&#40;$@&#41; {
&gt; &gt;   chdir $cwd or warn &#34;Couldn&#39;t chdir to $cwd&#34;;
&gt; &gt;   *foo =\&#38;bar;
&gt; &gt; }
&gt; &gt;
&gt; &gt; sub bar {
&gt; &gt;   warn&#40;&#34;Using Pure Perl Implementation\n&#34;&#41;;
&gt; &gt;   return 42;
&gt; &gt; }
&gt; &gt;
&gt; &gt; my $x = foo&#40;&#41;;
&gt; &gt; print &#34;$x\n&#34;;
&gt; &gt; print $cwd, &#34;\n&#34;;
&gt; &gt; #################################
&gt; &gt;
&gt; &gt; &#40;I&#39;ve used Cwd::getcwd instead of the pwd system call because pwd is not
&gt; &gt; available on all systems.&#41;
&gt; &gt;
&gt; &gt; However, I think &#40;not yet fully tested&#41; this can also be fixed quite
&gt; &gt; simply from within C.pm by rewriting sub compile as:
&gt; &gt;
&gt; &gt; #################################
&gt; &gt; sub compile {
&gt; &gt;     my $o = shift;
&gt; &gt;
&gt; &gt;     my $build_dir = $o-&gt;{API}{build_dir};
&gt; &gt;     my $cwd = &#38;cwd;
&gt; &gt;     &#40;$cwd&#41; = $cwd =~ /&#40;.*&#41;/ if $o-&gt;UNTAINT;
&gt; &gt;
&gt; &gt;     chdir $build_dir;
&gt; &gt;     eval {
&gt; &gt;     $o-&gt;call&#40;&#39;makefile_pl&#39;, &#39;&#34;perl Makefile.PL&#34;&#39;, 2&#41;;
&gt; &gt;     $o-&gt;call&#40;&#39;make&#39;, &#39;&#34;make&#34;&#39;, 2&#41;;
&gt; &gt;     $o-&gt;call&#40;&#39;make_install&#39;, &#39;&#34;make install&#34;&#39;, 2&#41;;
&gt; &gt;     };
&gt; &gt;     chdir $cwd;
&gt; &gt;     die if $@;
&gt; &gt;     $o-&gt;call&#40;&#39;cleanup&#39;, &#39;Cleaning Up&#39;, 2&#41;;
&gt; &gt; }
&gt; &gt; #################################
&gt; &gt;
&gt; &gt; So I&#39;ll go with that changed version of C.pm&#39;s sub compile unless, in
&gt; &gt; the course of more thorough testing, I discover a problem with it.
&gt; &gt; If it tests ok for me, I&#39;ll release an Inline-0.51_03 that contains the
&gt; &gt; fix in a day or two.
&gt; &gt;
&gt; &gt; Thanks for the report !
&gt; &gt;
&gt; &gt; Cheers,
&gt; &gt; Rob
&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1147590/603493/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603493">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1147622" href="/Public/Bug/Display.html?id=81375#txn-1147622">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;23:13:37&nbsp;2012</span>
    <span class="description">dcmertens.perl [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Perl Inline Mail List &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81375] chdir without cc</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Nov 2012 22:13:25 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Mertens &lt;dcmertens.perl [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1147622/603515/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603515">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Er, sorry, I wasn&#39;t trying to argue that this is an error in Perl or a CPAN
dependency. Rather, my comment was meant for the edification of anybody
following this list of communication. As it is, if Inline doesn&#39;t mind
adding a dependency, then perhaps adding the dependency on File::chdir
would make this a little easier. But I don&#39;t think that such a dependency
is necessary by any means.

David


On Mon, Nov 26, 2012 at 8:03 PM, Xiao Yafeng via RT
&lt;bug-Inline@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Nov 26 21:03:00 2012: Request 81375 was acted upon.
&gt; Transaction: Correspondence added by xyf.xiao@gmail.com
&gt;        Queue: Inline
&gt;      Subject: Re: [rt.cpan.org #81375] chdir without cc
&gt;    Broken in: 0.50
&gt;     Severity: Normal
&gt;        Owner: Nobody
&gt;   Requestors: bernhard+cpan@lsmod.de
&gt;       Status: open
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81375">https://rt.cpan.org/Ticket/Display.html?id=81375</a></span> &gt;
&gt;
&gt;
&gt; I vote for David,  It&#39;s a bug from chdir other than Inline.
&gt;
&gt; On Tue, Nov 27, 2012 at 7:53 AM, dcmertens.perl@gmail.com via RT &lt;
&gt; bug-Inline@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt; Mon Nov 26 18:53:28 2012: Request 81375 was acted upon.
&gt; &gt; Transaction: Correspondence added by dcmertens.perl@gmail.com
&gt; &gt;        Queue: Inline
&gt; &gt;      Subject: Re: [rt.cpan.org #81375] chdir without cc
&gt; &gt;    Broken in: 0.50
&gt; &gt;     Severity: Normal
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: bernhard+cpan@lsmod.de
&gt; &gt;       Status: open
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81375">https://rt.cpan.org/Ticket/Display.html?id=81375</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; For the curious, a CPAN solution that handles this *very* nicely is
&gt; &gt; p3rl.org/File::chdir
&gt; &gt;
&gt; &gt; David
&gt; &gt; On Nov 24, 2012 6:52 PM, &#34;Sisyphus via RT&#34; &lt;bug-Inline@rt.cpan.org&gt;
</div>&gt; wrote:
<div class="message-stanza open">&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; Sat Nov 24 19:52:30 2012: Request 81375 was acted upon.
&gt; &gt; &gt; Transaction: Correspondence added by SISYPHUS
&gt; &gt; &gt;        Queue: Inline
&gt; &gt; &gt;      Subject: chdir without cc
&gt; &gt; &gt;    Broken in: 0.50
&gt; &gt; &gt;     Severity: Normal
&gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt;   Requestors: bernhard+cpan@lsmod.de
&gt; &gt; &gt;       Status: open
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81375">https://rt.cpan.org/Ticket/Display.html?id=81375</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Sat Nov 24 07:56:37 2012, bmwiedemann wrote:
&gt; &gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &gt; I appended to your script:
&gt; &gt; &gt; &gt; system&#40;&#34;pwd&#34;&#41;;
</div>&gt; &gt; &gt;
&gt; &gt; &gt; [snip]
&gt; &gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &gt; Using Pure Perl Implementation
&gt; &gt; &gt; &gt; 42
&gt; &gt; &gt; &gt; /home/bernhard/temp/_Inline/build/testc_pl_b91d
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; and it showed that it changed the current dir for the perl process
</div>&gt; &gt; &gt;
&gt; &gt; &gt; Yes, this could be fixed from within the script I provided as follows:
&gt; &gt; &gt;
&gt; &gt; &gt; #################################
&gt; &gt; &gt; use strict;
&gt; &gt; &gt; use warnings;
&gt; &gt; &gt; use Cwd;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; my $cwd = getcwd&#40;&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; eval {
&gt; &gt; &gt;  require Inline; Inline-&gt;import &#40;C =&gt; Config =&gt;
&gt; &gt; &gt;     #CC =&gt; &#39;bogus&#39;, # Easy way to make the build fail
&gt; &gt; &gt;     BUILD_NOISY =&gt; 1&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt;  require Inline; Inline-&gt;import &#40;C =&gt;&lt;&lt;&#39; EOC&#39;&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt;  int foo&#40;&#41; {
&gt; &gt; &gt;    warn&#40;&#34;Using Inline\n&#34;&#41;;
&gt; &gt; &gt;    return 42;
&gt; &gt; &gt;  }
&gt; &gt; &gt;
&gt; &gt; &gt;  EOC
&gt; &gt; &gt; };
&gt; &gt; &gt;
&gt; &gt; &gt; # If Inline is unavailable, foo&#40;&#41; simply calls
&gt; &gt; &gt; # the sub bar&#40;&#41; pure perl implementation.
&gt; &gt; &gt; if&#40;$@&#41; {
&gt; &gt; &gt;   chdir $cwd or warn &#34;Couldn&#39;t chdir to $cwd&#34;;
&gt; &gt; &gt;   *foo =\&#38;bar;
&gt; &gt; &gt; }
&gt; &gt; &gt;
&gt; &gt; &gt; sub bar {
&gt; &gt; &gt;   warn&#40;&#34;Using Pure Perl Implementation\n&#34;&#41;;
&gt; &gt; &gt;   return 42;
&gt; &gt; &gt; }
&gt; &gt; &gt;
&gt; &gt; &gt; my $x = foo&#40;&#41;;
&gt; &gt; &gt; print &#34;$x\n&#34;;
&gt; &gt; &gt; print $cwd, &#34;\n&#34;;
&gt; &gt; &gt; #################################
&gt; &gt; &gt;
&gt; &gt; &gt; &#40;I&#39;ve used Cwd::getcwd instead of the pwd system call because pwd is
</div></div>&gt; not
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; available on all systems.&#41;
&gt; &gt; &gt;
&gt; &gt; &gt; However, I think &#40;not yet fully tested&#41; this can also be fixed quite
&gt; &gt; &gt; simply from within C.pm by rewriting sub compile as:
&gt; &gt; &gt;
&gt; &gt; &gt; #################################
&gt; &gt; &gt; sub compile {
&gt; &gt; &gt;     my $o = shift;
&gt; &gt; &gt;
&gt; &gt; &gt;     my $build_dir = $o-&gt;{API}{build_dir};
&gt; &gt; &gt;     my $cwd = &#38;cwd;
&gt; &gt; &gt;     &#40;$cwd&#41; = $cwd =~ /&#40;.*&#41;/ if $o-&gt;UNTAINT;
&gt; &gt; &gt;
&gt; &gt; &gt;     chdir $build_dir;
&gt; &gt; &gt;     eval {
&gt; &gt; &gt;     $o-&gt;call&#40;&#39;makefile_pl&#39;, &#39;&#34;perl Makefile.PL&#34;&#39;, 2&#41;;
&gt; &gt; &gt;     $o-&gt;call&#40;&#39;make&#39;, &#39;&#34;make&#34;&#39;, 2&#41;;
&gt; &gt; &gt;     $o-&gt;call&#40;&#39;make_install&#39;, &#39;&#34;make install&#34;&#39;, 2&#41;;
&gt; &gt; &gt;     };
&gt; &gt; &gt;     chdir $cwd;
&gt; &gt; &gt;     die if $@;
&gt; &gt; &gt;     $o-&gt;call&#40;&#39;cleanup&#39;, &#39;Cleaning Up&#39;, 2&#41;;
&gt; &gt; &gt; }
&gt; &gt; &gt; #################################
&gt; &gt; &gt;
&gt; &gt; &gt; So I&#39;ll go with that changed version of C.pm&#39;s sub compile unless, in
&gt; &gt; &gt; the course of more thorough testing, I discover a problem with it.
&gt; &gt; &gt; If it tests ok for me, I&#39;ll release an Inline-0.51_03 that contains the
&gt; &gt; &gt; fix in a day or two.
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks for the report !
&gt; &gt; &gt;
&gt; &gt; &gt; Cheers,
&gt; &gt; &gt; Rob
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
</div>

-- 
 &#34;Debugging is twice as hard as writing the code in the first place.
  Therefore, if you write the code as cleverly as possible, you are,
  by definition, not smart enough to debug it.&#34; -- Brian Kernighan
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1147622/603516/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603516">with headers</a>
<br />
<span class="downloadcontenttype">text/html 7.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1147712" href="/Public/Bug/Display.html?id=81375#txn-1147712">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;06:37:04&nbsp;2012</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1147712/603566/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603566">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1000b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 26 21:03:00 2012, xyf.xiao@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I vote for David,  It&#39;s a bug from chdir other than Inline.
</div>
File::chdir certainly provides an elegant solution to the problem, but
I&#39;ll stick with using the eval{} safety net, for the moment at least.
I&#39;m not really all that keen to introduce a new dependency just to save
a couple of lines of code.

I do think it&#39;s an Inline::C bug.
Admittedly, it&#39;s a bit unusual to want to safeguard Inline::C code
against the absence of a C compiler &#40;or of a missing make utility or of
uncompilable code, etc.&#41;, but I think one is entitled to do that. And if
one wants to do that by using eval{} &#40;as the OP does&#41;, then one has
every right to expect that the script will return to the *original* cwd
if $@ gets set.
I think chdir&#40;&#41; is behaving as it should. If we want to claim that it&#39;s
not an Inline::C bug, then we would have to argue that the OP is doing
something that&#39;s not allowed. &#40;But of course, IMO, he isn&#39;t doing
anything wrong.&#41;

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1148120" href="/Public/Bug/Display.html?id=81375#txn-1148120">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;28&nbsp;06:15:10&nbsp;2012</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1148120/603768/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/603768">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 860b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 24 19:52:30 2012, SISYPHUS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; #################################
&gt; sub compile {
&gt;     my $o = shift;
&gt; 
&gt;     my $build_dir = $o-&gt;{API}{build_dir};
&gt;     my $cwd = &#38;cwd;
&gt;     &#40;$cwd&#41; = $cwd =~ /&#40;.*&#41;/ if $o-&gt;UNTAINT;
&gt; 
&gt;     chdir $build_dir;
&gt;     eval {
&gt;     $o-&gt;call&#40;&#39;makefile_pl&#39;, &#39;&#34;perl Makefile.PL&#34;&#39;, 2&#41;;
&gt;     $o-&gt;call&#40;&#39;make&#39;, &#39;&#34;make&#34;&#39;, 2&#41;;
&gt;     $o-&gt;call&#40;&#39;make_install&#39;, &#39;&#34;make install&#34;&#39;, 2&#41;;
&gt;     };
&gt;     chdir $cwd;
&gt;     die if $@;
&gt;     $o-&gt;call&#40;&#39;cleanup&#39;, &#39;Cleaning Up&#39;, 2&#41;;
&gt; }
&gt; #################################
</div>
I&#39;ve just uploaded Inline-0.51_03 to CPAN.
It contains the &#40;above&#41; modified sub compile, along with an additional
test script &#40;C/t/20eval.t&#41; that&#39;s designed to check that it works as
expected.

Feel free to give this change a good prod and a poke ... and let me know
if it&#39;s inadequate in any way.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1188570" href="/Public/Bug/Display.html?id=81375#txn-1188570">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;06&nbsp;21:13:29&nbsp;2013</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1188570/626982/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/626982">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 40b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.52.
Thank you for the report.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1188574" href="/Public/Bug/Display.html?id=81375#txn-1188574">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;06&nbsp;21:13:30&nbsp;2013</span>
    <span class="description">sisyphus [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.61515</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
