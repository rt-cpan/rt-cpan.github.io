<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #51209 for IMDB-Film: Add support for fetching details about videos</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #51209 for IMDB-Film: Add support for fetching details about videos</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=IMDB-Film">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=IMDB-Film">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=IMDB-Film">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=IMDB-Film">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IMDB-Film">IMDB-Film CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">51209</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=IMDB-Film">IMDB-Film</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">STEPANOV [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gerph [...] gerph.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-16826-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.42    </td>
  </tr>
  <tr id="CF-16827-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




diff-Film042-videos.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/686965/353567/diff-Film042-videos.diff">
Sun Nov 08 15:31:08 2009 (5.9k) by gerph [...] gerph.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=51209">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-686965" href="/Public/Bug/Display.html?id=51209#txn-686965">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;08&nbsp;15:31:08&nbsp;2009</span>
    <span class="description">gerph [...] gerph.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add support for fetching details about videos</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/686965/353564/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/353564">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hiya,

I&#39;ve added a couple of new functions to support retrieving URLs for 
videos related to the movies. Unlike the other APIs, this isn&#39;t a 
single shot request, because the fetches require that new pages be 
fetched in order to locate the correct URL. The &#39;videogallery&#39; page 
must be fetched to get the main information, which we can do relatively 
easily, but there may be multiple pages of information, so we may 
require multiple fetches for that. Once we&#39;ve got the details from 
there - in particular the &#39;vi&#39; identifier - we can then fetch the 
actual URL from the player page. The player page embeds a small section 
of Javascript which constructs the parameters for the flash player. We 
only want the URL, so we pick this out of the Javascript directly.

Thus the videos&#40;&#41; API allows us to obtain:
   The title of the clip
   The type of clip that it is &#40;eg Featurette, Interview, Clip, 
Trailer, etc&#41;
   A possible description
   A time and/or date that it was posted.
   A video_id identifier we can use to fetch the clip &#40;and which is 
also unique, but clients shouldn&#39;t rely on any particular content&#41;.

From this we can use the video_url&#40;&#41; API to convert the video_id to a 
URL, which incurs another fetch.

I&#39;m not sure if you think this is worth going in to the IMDB::Film 
module, but it seems to work well for me and has been relatively 
reliable so far.

Clips appear to be flash video, and I couldn&#39;t find a way of getting at 
the rating information on the films - there&#39;s some sort of &#39;mature 
content&#39; warning that sometimes appears but I couldn&#39;t see how to find 
out if it applied, etc.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> diff-Film042-videos.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/686965/353567/diff-Film042-videos.diff">Download diff-Film042-videos.diff</a><br />
<span class="downloadcontenttype">text/x-diff 5.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** v042/Film.pm	2009-11-08 19:43:13.000000000 +0000
--- Film.pm	2009-11-08 19:51:47.000000000 +0000
***************
*** 85,90 ****
--- 85,91 ----
  				_full_companies
  				_recommendation_movies
  				_plot_keywords
+                 _videos
  				full_plot_url
  		&#41;;
  	
***************
*** 549,554 ****
--- 550,708 ----
      return $self-&gt;{_full_companies};
  }
  
+ 
+ =item videos&#40;&#41;
+ 
+ Retrieve references to the videos related to this movie. News items are implicitly filtered. Returns an array reference where each item has following stucture:
+ 
+     { 
+         type            =&gt; &#39;trailer&#39; | &#39;featurette&#39; | ...,
+         video_id        =&gt; &lt;unique imdb identifier for the video, for passing to video_url&gt;,
+         title           =&gt; &lt;short title&gt;,
+         description     =&gt; &lt;description of the item&gt;,
+         previewimg_url  =&gt; &lt;url of a preview image&gt;,
+         date            =&gt; &#39;YYYY-MM-DD&#39;,
+         time            =&gt; &#39;hh:mm&#39; | undef
+     }
+ 
+   my @videos = @{ $film-&gt;videos&#40;&#41; };
+ 
+ =cut
+ 
+ sub videos {
+     my CLASS_NAME $self = shift;
+ 
+     unless&#40;$self-&gt;{_videos}&#41; {
+         my @result;
+         my $page;
+         my $pagenum = 1;
+         while &#40;1&#41;
+         {
+             $page = $self-&gt;_cacheObj-&gt;get&#40;$self-&gt;code . &#39;_videos&#39; . $pagenum&#41; if $self-&gt;_cache;
+ 
+             unless&#40;$page&#41; {
+                 my $url = &#34;http://&#34;. $self-&gt;{host} . &#34;/&#34; . $self-&gt;{query} .  $self-&gt;code . &#34;/videogallery?page=$pagenum&#34;;
+                 $self-&gt;_show_message&#40;&#34;URL for video gallery for page $pagenum is $url ...&#34;, &#39;DEBUG&#39;&#41;;
+ 
+                 $page = $self-&gt;_get_page_from_internet&#40;$url&#41;;
+                 $self-&gt;_cacheObj-&gt;set&#40;$self-&gt;code.&#39;_videos&#39;, $page, $self-&gt;_cache_exp&#41; if $self-&gt;_cache;
+             }
+ 
+             my $parser = $self-&gt;_parser&#40;FORCED, \$page&#41;;
+             my $tag;
+ 
+             if &#40;$parser-&gt;get_tag&#40;&#39;h1&#39;&#41;&#41;
+             {
+                 while &#40;my $tag = $parser-&gt;get_tag&#40;&#39;img&#39;&#41;&#41; {
+                     my $attribs = $tag-&gt;[1];
+                     if &#40;defined $attribs-&gt;{class} &#38;&#38;
+                         $attribs-&gt;{class} eq &#39;video&#39; &#38;&#38;
+                         defined $attribs-&gt;{viconst}&#41;
+                     {
+                         my %video = &#40; &#39;video_id&#39;       =&gt; $attribs-&gt;{viconst},
+                                       &#39;description&#39;    =&gt; $attribs-&gt;{title},
+                                       &#39;previewimg_url&#39; =&gt; $attribs-&gt;{src},
+                                     &#41;;
+                         # The type of clip is only shown in the text in the preview image.
+                         # Fortunately IMDB construct this image on the fly from the URL
+                         # parameters, so we can just extract it from there.
+                         if &#40;defined $attribs-&gt;{src} &#38;&#38;
+                             $attribs-&gt;{src} =~ /_ZA&#40;[^,]+&#41;/&#41;
+                         {
+                             $video{type} = lc&#40;$1&#41;;
+                         }
+                         else
+                         {
+                             $video{type} = &#39;unknown&#39;;
+                         }
+                         
+                         # I have never seen a &#39;News&#39; item which was actually relevant.
+                         next if &#40;$video{type} eq &#39;news&#39;&#41;;
+                         
+                         if &#40;$parser-&gt;get_tag&#40;&#39;h2&#39;&#41; &#38;&#38;
+                             $parser-&gt;get_tag&#40;&#39;a&#39;&#41;&#41;
+                         {
+                             $video{title} = $parser-&gt;get_trimmed_text;
+                         }
+                         if &#40;$parser-&gt;get_tag&#40;&#39;br&#39;&#41;&#41;
+                         {
+                             my $release = $parser-&gt;get_trimmed_text;
+                             $video{date} = $1 if &#40;$release =~ /&#40;\d\d\d\d-\d\d-\d\d&#41;/&#41;;
+                             $video{time} = $1 if &#40;$release =~ /&#40;\d\d:\d\d&#41;/&#41;;
+                         }
+ 
+                         push @result, \%video;
+                     }
+                 }
+             }
+             
+             if &#40;$page =~ /\d+ &#38;ndash; &#40;\d+&#41; of &#40;\d+&#41; Videos/&#41;
+             {
+                 if &#40;$1 == $2&#41;
+                 {
+                     # All pages fetched
+                     $self-&gt;_show_message&#40;&#34;All video gallery video processed &#40;$2 videos&#41;&#34;, &#39;DEBUG&#39;&#41;;
+                     last;
+                 }
+                 else
+                 {
+                     $self-&gt;_show_message&#40;&#34;Processed video gallery page $pagenum, &#40;up to video $1/$2&#41;; continuing...&#34;, &#39;DEBUG&#39;&#41;;
+                 }
+             }
+             else
+             {
+                 $self-&gt;_show_message&#40;&#34;No other video gallery pages exist&#34;, &#39;DEBUG&#39;&#41;;
+                 last;
+             }
+             $pagenum++;
+         }
+ 
+         $self-&gt;{_videos} = \@result;
+     }
+ 
+     return $self-&gt;{_videos};
+ }
+ 
+ 
+ =item video_url&#40;$video_id&#41;
+ 
+ Retrieve the URL for a video, given its video_id, or undef it one could not be found
+ 
+ Example to obtain the URL of first trailer of a film:
+ 
+   my @videos = @{ $film-&gt;videos&#40;&#41; };
+   @videos = grep { $_-&gt;{type} eq &#39;trailer&#39; } @videos;
+   my $url = &#40;@videos &gt; 0&#41; ? $film-&gt;video_url&#40;$videos[0]-&gt;{video_id}&#41; : undef;
+ 
+ =cut
+ 
+ sub video_url {
+     my CLASS_NAME $self = shift;
+     my &#40;$vi&#41; = &#40;@_&#41;;
+     
+     return undef if &#40;!defined $vi ||
+                      $vi !~ /^vi\d+$/&#41;;
+ 
+     my $page;
+     $page = $self-&gt;_cacheObj-&gt;get&#40;$self-&gt;code . &#39;_&#39; . $vi&#41; if $self-&gt;_cache;
+ 
+     unless&#40;$page&#41; {
+         my $url = &#34;http://&#34;. $self-&gt;{host} . &#34;/video/imdb/&#34; . $vi . &#34;/player&#34;;
+         $self-&gt;_show_message&#40;&#34;URL for video &#39;$vi&#39; is $url ...&#34;, &#39;DEBUG&#39;&#41;;
+ 
+         $page = $self-&gt;_get_page_from_internet&#40;$url&#41;;
+         $self-&gt;_cacheObj-&gt;set&#40;$self-&gt;code.&#39;_&#39;.$vi, $page, $self-&gt;_cache_exp&#41; if $self-&gt;_cache;
+     }
+     
+     if &#40;$page =~ /IMDbPlayer\.playerKey = &#34;&#40;http:.*?&#41;&#34;/&#41;
+     {
+         # The Javascript contained the URL to use.
+         return $1;
+     }
+ 
+     return undef;
+ }
+ 
  =item company&#40;&#41;
  
  Returns an company given for a specified movie:
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-706298" href="/Public/Bug/Display.html?id=51209#txn-706298">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;14&nbsp;05:02:12&nbsp;2009</span>
    <span class="description">stepanov.michael [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #51209] Add support for fetching details about  videos</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 14 Dec 2009 12:01:54 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IMDB-Film [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael Stepanov &lt;stepanov.michael [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/706298/364291/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/364291">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Justin,

Thanks for your patch. I&#39;ll review it and add to the next release.

On Sun, Nov 8, 2009 at 10:31 PM, Justin Fletcher via RT &lt;
bug-IMDB-Film@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sun Nov 08 15:31:08 2009: Request 51209 was acted upon.
&gt; Transaction: Ticket created by gerph
&gt;       Queue: IMDB-Film
&gt;     Subject: Add support for fetching details about videos
&gt;   Broken in: 0.42
&gt;    Severity: Wishlist
&gt;       Owner: Nobody
&gt;  Requestors: gerph@gerph.org
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=51209">https://rt.cpan.org/Ticket/Display.html?id=51209</a></span> &gt;
&gt;
&gt;
&gt; Hiya,
&gt;
&gt; I&#39;ve added a couple of new functions to support retrieving URLs for
&gt; videos related to the movies. Unlike the other APIs, this isn&#39;t a
&gt; single shot request, because the fetches require that new pages be
&gt; fetched in order to locate the correct URL. The &#39;videogallery&#39; page
&gt; must be fetched to get the main information, which we can do relatively
&gt; easily, but there may be multiple pages of information, so we may
&gt; require multiple fetches for that. Once we&#39;ve got the details from
&gt; there - in particular the &#39;vi&#39; identifier - we can then fetch the
&gt; actual URL from the player page. The player page embeds a small section
&gt; of Javascript which constructs the parameters for the flash player. We
&gt; only want the URL, so we pick this out of the Javascript directly.
&gt;
&gt; Thus the videos&#40;&#41; API allows us to obtain:
&gt;   The title of the clip
&gt;   The type of clip that it is &#40;eg Featurette, Interview, Clip,
&gt; Trailer, etc&#41;
&gt;   A possible description
&gt;   A time and/or date that it was posted.
&gt;   A video_id identifier we can use to fetch the clip &#40;and which is
&gt; also unique, but clients shouldn&#39;t rely on any particular content&#41;.
&gt;
&gt; From this we can use the video_url&#40;&#41; API to convert the video_id to a
&gt; URL, which incurs another fetch.
&gt;
&gt; I&#39;m not sure if you think this is worth going in to the IMDB::Film
&gt; module, but it seems to work well for me and has been relatively
&gt; reliable so far.
&gt;
&gt; Clips appear to be flash video, and I couldn&#39;t find a way of getting at
&gt; the rating information on the films - there&#39;s some sort of &#39;mature
&gt; content&#39; warning that sometimes appears but I couldn&#39;t see how to find
&gt; out if it applied, etc.
&gt;
&gt;
</div>
-- 
Best regards,
Michael Stepanov,
<span class="clickylink"><a target="new" rel="nofollow" href="http://linuxmce.ru">http://linuxmce.ru</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/706298/364292/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/364292">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-706299" href="/Public/Bug/Display.html?id=51209#txn-706299">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;14&nbsp;05:02:14&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-710933" href="/Public/Bug/Display.html?id=51209#txn-710933">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;24&nbsp;18:17:42&nbsp;2009</span>
    <span class="description">gerph [...] gerph.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/710933/366929/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/366929">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 981b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just found a problem with this; the handler on IMDB&#39;s side isn&#39;t as 
nice for the videogallery as for the other pages:

<span class="clickylink"><a target="new" rel="nofollow" href="http://us.imdb.com/title/tt239303/videogallery?page=1">http://us.imdb.com/title/tt239303/videogallery?page=1</a></span>

is VASTLY different to:

<span class="clickylink"><a target="new" rel="nofollow" href="http://us.imdb.com/title/tt0239303/videogallery?page=1">http://us.imdb.com/title/tt0239303/videogallery?page=1</a></span>

the former returns an insane number of results which are not related to 
the programme in question.

In the sub videos code, I&#39;ve replaced $self-&gt;code in the url with:

&#40;sprintf &#34;%07d&#34;, $self-&gt;code&#41;

which appears to do the job.

Sorry about that - I hadn&#39;t seen it until now whilst debugging things. 
during debug for that result I was seeing:

[DEBUG] Processed video gallery page 1, &#40;up to video 30/76451&#41;; 
continuing... at ./filmdetails.pl line 371

... which is a little more than I expected really. It&#39;s possible that 
the while &#40;1&#41; should also be changed to something like &#39;while &#40;$pagenum 
&lt; 10&#41;&#39; so that if problems occur in other places we don&#39;t keep fetching 
many, many pages.

Sorry once again for that problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-712220" href="/Public/Bug/Display.html?id=51209#txn-712220">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;28&nbsp;08:40:23&nbsp;2009</span>
    <span class="description">stepanov.michael [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #51209] Add support for fetching details about  videos</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Dec 2009 15:40:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IMDB-Film [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael Stepanov &lt;stepanov.michael [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/712220/367632/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367632">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Nice to see that you soled that problem :&#41;

On Fri, Dec 25, 2009 at 1:17 AM, Justin Fletcher via RT &lt;
bug-IMDB-Film@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: IMDB-Film
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=51209">https://rt.cpan.org/Ticket/Display.html?id=51209</a></span> &gt;
&gt;
&gt; Just found a problem with this; the handler on IMDB&#39;s side isn&#39;t as
&gt; nice for the videogallery as for the other pages:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://us.imdb.com/title/tt239303/videogallery?page=1">http://us.imdb.com/title/tt239303/videogallery?page=1</a></span>
&gt;
&gt; is VASTLY different to:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://us.imdb.com/title/tt0239303/videogallery?page=1">http://us.imdb.com/title/tt0239303/videogallery?page=1</a></span>
&gt;
&gt; the former returns an insane number of results which are not related to
&gt; the programme in question.
&gt;
&gt; In the sub videos code, I&#39;ve replaced $self-&gt;code in the url with:
&gt;
&gt; &#40;sprintf &#34;%07d&#34;, $self-&gt;code&#41;
&gt;
&gt; which appears to do the job.
&gt;
&gt; Sorry about that - I hadn&#39;t seen it until now whilst debugging things.
&gt; during debug for that result I was seeing:
&gt;
&gt; [DEBUG] Processed video gallery page 1, &#40;up to video 30/76451&#41;;
&gt; continuing... at ./filmdetails.pl line 371
&gt;
&gt; ... which is a little more than I expected really. It&#39;s possible that
&gt; the while &#40;1&#41; should also be changed to something like &#39;while &#40;$pagenum
&gt; &lt; 10&#41;&#39; so that if problems occur in other places we don&#39;t keep fetching
&gt; many, many pages.
&gt;
&gt; Sorry once again for that problem.
&gt;
</div>

-- 
Best regards,
Michael Stepanov,
<span class="clickylink"><a target="new" rel="nofollow" href="http://linuxmce.ru">http://linuxmce.ru</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/712220/367633/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/367633">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-828500" href="/Public/Bug/Display.html?id=51209#txn-828500">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;08:25:34&nbsp;2010</span>
    <span class="description">STEPANOV [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.510868</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
