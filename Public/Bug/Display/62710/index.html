<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #62710 for LaTeX-Encode: Assumes latin1 encoding - produces invalid results when using UTF input</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #62710 for LaTeX-Encode: Assumes latin1 encoding - produces invalid results when using UTF input</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=LaTeX-Encode">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=LaTeX-Encode">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=LaTeX-Encode">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=LaTeX-Encode">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/LaTeX-Encode">LaTeX-Encode CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">62710</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=LaTeX-Encode">LaTeX-Encode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ANDREWF [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
CARNIL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45604-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45605-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Encode.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/941005/489213/Encode.pm">
Tue May 31 15:03:10 2011 (7.8k) by LIMAONE [...] cpan.org
</a>
</font></li>
</ul>


EncodingTable.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/941005/489214/EncodingTable.pm">
Tue May 31 15:03:10 2011 (115k) by LIMAONE [...] cpan.org
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/851271/440716/signature.asc">
Thu Nov 04 18:27:40 2010 (835b) by CARNIL [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=62710">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-851271" href="/Public/Bug/Display.html?id=62710#txn-851271">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;04&nbsp;18:27:40&nbsp;2010</span>
    <span class="description">CARNIL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Assumes latin1 encoding - produces invalid results when using UTF input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Nov 2010 23:27:26 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-LaTeX-Encode [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvatore Bonaccorso &lt;carnil [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/851271/440715/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/440715">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

I&#39;m forwarding this bugreport. It was reported to the Debian
Bugtracker at <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/602398">http://bugs.debian.org/602398</a></span>

Bests and thanks a lot for developing LaTeX-Encode
Salvatore

----- Forwarded message from Gunnar Wolf &lt;gwolf@gwolf.org&gt; -----

From: Gunnar Wolf &lt;gwolf@gwolf.org&gt;
Resent-From: Gunnar Wolf &lt;gwolf@gwolf.org&gt;
Reply-To: Gunnar Wolf &lt;gwolf@gwolf.org&gt;, 602398@bugs.debian.org
X-Mailer: reportbug 4.12.6
Date: Thu, 04 Nov 2010 08:08:08 -0600
To: Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;
Subject: Bug#602398: liblatex-encode-perl: Assumes latin1 encoding - produces
        invalid results when using UTF input

Package: liblatex-encode-perl
Version: 0.03-1
Severity: normal

Having a completely UTF8 environment, and even explicitly setting
Perl&#39;s environment to be fully UTF-aware, results in:

0 gwolf@mosca『29』~$ echo $LANG
en_US.UTF-8
0 gwolf@mosca『30』~$ export PERL_UTF8_LOCALE=1 PERL_UNICODE=AS
0 gwolf@mosca『31』~$ perl -mLaTeX::Encode -e &#39;print LaTeX::Encode::latex_encode&#40;&#34;Tħış ïš ﬀùĺł ȯﬀ ŪŦḞ\n\n&#34;&#41;&#39;
T\&#34;A\textsection\&#34;A\textpm\AA \~A\textasciimacron\AA\textexclamdown{} \&#34;i\textlnot\~A\textonesuperior\&#34;A\textordmasculine\AA \`E\textasciimacron\&#34;i\textlnot \AA\textordfeminine\AA\textbrokenbar\&#39;a\c{}


Sadly, this renders this module unusable for documents written in
basically any language other than English.

-- System Information:
Debian Release: squeeze/sid
  APT prefers unstable
  APT policy: &#40;500, &#39;unstable&#39;&#41;
Architecture: amd64 &#40;x86_64&#41;

Kernel: Linux 2.6.32-5-openvz-amd64 &#40;SMP w/2 CPU cores&#41;
Locale: LANG=en_US.UTF-8, LC_CTYPE=en_US.UTF-8 &#40;charmap=UTF-8&#41;
Shell: /bin/sh linked to /bin/dash

Versions of packages liblatex-encode-perl depends on:
ii  perl                          5.10.1-15  Larry Wall&#39;s Practical Extraction 

liblatex-encode-perl recommends no packages.

liblatex-encode-perl suggests no packages.

-- debconf-show failed



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_______________________________________________
pkg-perl-maintainers mailing list
pkg-perl-maintainers@lists.alioth.debian.org
<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.alioth.debian.org/mailman/listinfo/pkg-perl-maintainers">http://lists.alioth.debian.org/mailman/listinfo/pkg-perl-maintainers</a></span>

<div class="message-stanza open">----- End forwarded message -----
</div></div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/851271/440716/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 835b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-941005" href="/Public/Bug/Display.html?id=62710#txn-941005">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;31&nbsp;15:03:10&nbsp;2011</span>
    <span class="description">LIMAONE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> carnil [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/941005/489212/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489212">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve attached a quick and dirty fix for that, based on the mapping provided by the TeXML 
guys. Needs some polishing, but should work in principle.


On Thu Nov 04 18:27:40 2010, CARNIL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi!
&gt; 
&gt; I&#39;m forwarding this bugreport. It was reported to the Debian
&gt; Bugtracker at <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/602398">http://bugs.debian.org/602398</a></span>
&gt; 
&gt; Bests and thanks a lot for developing LaTeX-Encode
&gt; Salvatore
&gt; 
&gt; ----- Forwarded message from Gunnar Wolf &lt;gwolf@gwolf.org&gt; -----
&gt; 
&gt; From: Gunnar Wolf &lt;gwolf@gwolf.org&gt;
&gt; Resent-From: Gunnar Wolf &lt;gwolf@gwolf.org&gt;
&gt; Reply-To: Gunnar Wolf &lt;gwolf@gwolf.org&gt;, 602398@bugs.debian.org
&gt; X-Mailer: reportbug 4.12.6
&gt; Date: Thu, 04 Nov 2010 08:08:08 -0600
&gt; To: Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;
&gt; Subject: Bug#602398: liblatex-encode-perl: Assumes latin1 encoding -
&gt; produces
&gt;       invalid results when using UTF input
&gt; 
&gt; Package: liblatex-encode-perl
&gt; Version: 0.03-1
&gt; Severity: normal
&gt; 
&gt; Having a completely UTF8 environment, and even explicitly setting
&gt; Perl&#39;s environment to be fully UTF-aware, results in:
&gt; 
&gt; 0 gwolf@mosca『29』~$ echo $LANG
&gt; en_US.UTF-8
&gt; 0 gwolf@mosca『30』~$ export PERL_UTF8_LOCALE=1 PERL_UNICODE=AS
&gt; 0 gwolf@mosca『31』~$ perl -mLaTeX::Encode -e &#39;print
&gt; LaTeX::Encode::latex_encode&#40;&#34;Tħış ïš ﬀùĺł ȯﬀ ŪŦḞ\n\n&#34;&#41;&#39;
&gt; T\&#34;A\textsection\&#34;A\textpm\AA \~A\textasciimacron\AA\textexclamdown{}
&gt; \&#34;i\textlnot\~A\textonesuperior\&#34;A\textordmasculine\AA
&gt; \`E\textasciimacron\&#34;i\textlnot
&gt; \AA\textordfeminine\AA\textbrokenbar\&#39;a\c{}
&gt; 
&gt; 
&gt; Sadly, this renders this module unusable for documents written in
&gt; basically any language other than English.
&gt; 
&gt; -- System Information:
&gt; Debian Release: squeeze/sid
&gt;   APT prefers unstable
&gt;   APT policy: &#40;500, &#39;unstable&#39;&#41;
&gt; Architecture: amd64 &#40;x86_64&#41;
&gt; 
&gt; Kernel: Linux 2.6.32-5-openvz-amd64 &#40;SMP w/2 CPU cores&#41;
&gt; Locale: LANG=en_US.UTF-8, LC_CTYPE=en_US.UTF-8 &#40;charmap=UTF-8&#41;
&gt; Shell: /bin/sh linked to /bin/dash
&gt; 
&gt; Versions of packages liblatex-encode-perl depends on:
&gt; ii  perl                          5.10.1-15  Larry Wall&#39;s Practical
&gt; Extraction
&gt; 
&gt; liblatex-encode-perl recommends no packages.
&gt; 
&gt; liblatex-encode-perl suggests no packages.
&gt; 
&gt; -- debconf-show failed
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; pkg-perl-maintainers mailing list
&gt; pkg-perl-maintainers@lists.alioth.debian.org
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://lists.alioth.debian.org/mailman/listinfo/pkg-perl-maintainers">http://lists.alioth.debian.org/mailman/listinfo/pkg-perl-maintainers</a></span>
&gt; ----- End forwarded message -----
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Encode.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/941005/489213/Encode.pm">Download Encode.pm</a><br />
<span class="downloadcontenttype">text/x-perl 7.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#========================================================================
#
# LaTeX::Encode
#
# DESCRIPTION
#   Provides a function to encode text that contains characters
#   special to LaTeX.
#
# AUTHOR
#   Andrew Ford &lt;a.ford@ford-mason.co.uk&gt;
#
# COPYRIGHT
#   Copyright &#40;C&#41; 2007 Andrew Ford.   All Rights Reserved.
#
#   This module is free software; you can redistribute it and/or
#   modify it under the same terms as Perl itself.
#
#   $Id: Encode.pm 10 2007-10-03 11:00:21Z andrew $
#========================================================================

package LaTeX::Encode;

use strict;
use warnings;

use Exporter;
use base qw&#40;Exporter&#41;;
use LaTeX::Encode::EncodingTable;

our $VERSION = 0.04;
our @EXPORT  = qw&#40;latex_encode&#41;;


# Encode text with characters special to LaTeX

sub latex_encode {
    my $text = shift;
    my $options = ref $_[0] ? shift : { @_ };
    my $exceptions   = $options-&gt;{except};
    my $iquotes      = $options-&gt;{iquotes};
    my $use_textcomp = &#40;!exists&#40;$options-&gt;{use_textcomp}&#41; || $options-&gt;{use_textcomp}&#41;;
    my $math         = &#40; exists&#40;$options-&gt;{math}&#41; &#38;&#38; $options-&gt;{math} &#41;;

    # If a list of exception characters was specified then we replace
    # those characters in the text string with something that is not
    # going to match the encoding regular expression.  The encoding we
    # use is a hex 01 byte followed by four hexadecimal digits

    if &#40;$exceptions&#41; {
        $exceptions =~ s{ \\ }{\\\\}gx;
        $text =~ s{ &#40;[\x{01}$exceptions]&#41; }
                  { sprintf&#40;&#34;\x{01}%04x&#34;, ord&#40;$1&#41;&#41;; }gxe;
    }

    # Deal with &#34;intelligent quotes&#34;.  This can be done separately
    # from the rest of the encoding as the characters ` and &#39; are not
    # encoded.

    if &#40;$iquotes&#41; {

        # A single or double quote before a word character, preceded
        # by start of line, whitespace or punctuation gets converted
        # to &#34;`&#34; or &#34;``&#34; respectively.

        $text =~ s{ &#40; ^ | [\s\p{IsPunct}] &#41;&#40; [&#39;&#34;] &#41; &#40;?= \w &#41; }
                  { $2 eq &#39;&#34;&#39; ? &#34;$1``&#34; : &#34;$1`&#34; }mgxe;

        # A double quote preceded by a word or punctuation character
        # and followed by whitespace or end of line gets converted to
        # &#34;&#39;&#39;&#34;.  &#40;Final single quotes are represented by themselves so
        # we don&#39;t need to worry about those.&#41;

        $text =~ s{ &#40;?&lt;= [\w\p{IsPunct}] &#41; &#34; &#40;?= \s | $ &#41; }
                  { &#34;&#39;&#39;&#34; }mgxe
    }
    
    my $re = $math ? $encoded_char_re_math : $encoded_char_re;
    my %le = $math ? %latex_encoding_math  : %latex_encoding;

    # Replace any characters that need encoding
      $text =~ s{ &#40;$re&#41;&#40;[\sa-zA-Z]?&#41;}
                 { my $encoded  = $le{$1};
                   my $nextchar = $2;
                   my $sepchars = &#34;&#34;;
                   if &#40;$nextchar and substr&#40;$encoded, -1&#41; =~ /[a-zA-Z]/&#41; {
                       $sepchars = &#40;$nextchar =~ /\s/&#41; ? &#39;{}&#39; : &#39; &#39;;
                   }
                   &#34;$encoded$sepchars$nextchar&#34; }gxe;
               #            $text = join&#40;&#34;\n&#34;, map{ defined $latex_encoding{$_} ? $latex_encoding{$_} :
               # $_ } split //,$text&#41;;
    # If the caller specified exceptions then we need to decode them

    if &#40;$exceptions&#41; {
        $text =~ s{ \x{01} &#40;[0-9a-f]{4}&#41; }{ chr&#40;hex&#40;$1&#41;&#41; }gxe;
    }

    return $text;
}

1;

__END__

=head1 NAME

LaTeX::Encode - encode characters for LaTeX formatting

=head1 SYNOPSIS

  use LaTeX::Encode;

  $latex = latex_encode&#40;$text, %options&#41;;

=head1 VERSION

This manual page describes version 0.04 of the C&lt;LaTeX::Encode&gt; module.


=head1 DESCRIPTION

This module provides a function to encode text that is to be formatted
with LaTeX.  It encodes characters that are special to LaTeX or that
are represented in LaTeX by LaTeX commands.

The special characters are: C&lt;\&gt; &#40;command character&#41;, C&lt;{&gt; &#40;open
group&#41;, C&lt;}&gt; &#40;end group&#41;, C&lt;&#38;&gt; &#40;table column separator&#41;, C&lt;#&gt;
&#40;parameter specifier&#41;, C&lt;%&gt; &#40;comment character&#41;, C&lt;_&gt; &#40;subscript&#41;,
C&lt;^&gt; &#40;superscript&#41;, C&lt;~&gt; &#40;non-breakable space&#41;, C&lt;$&gt; &#40;mathematics mode&#41;.

Note that some of the LaTeX commands for characters are defined in the
LaTeX C&lt;textcomp&gt; package.  If your text includes such characters, you
will need to include the following lines in the preamble to your LaTeX
document.

    \usepackage[T1]{fontenc}
    \usepackage{textcomp}

The function is useful for encoding data that is interpolated into
LaTeX document templates, say with C&lt;Template::Plugin::Latex&gt;
&#40;shameless plug!&#41;.


=head1 SUBROUTINES/METHODS

=over 4

=item C&lt;latex_encode&#40;$text, %options&#41;&gt;

Encodes the specified text such that it is suitable for processing
with LaTeX.  The behaviour of the filter is modified by the options:

=over 4

=item C&lt;except&gt;

Lists the characters that should be excluded from encoding.  By
default no special characters are excluded, but it may be useful to
specify C&lt;except = &#34;\\{}&#34;&gt; to allow the input string to contain LaTeX
commands such as C&lt;&#34;this is \\textbf{bold} text&#34;&gt; &#40;the doubled
backslashes in the strings represent Perl escapes, and will be
evaluated to single backslashes&#41;.

=item C&lt;math&gt;

If true, then a math environment is assumed.

=item C&lt;iquotes&gt;

If true then single or double quotes around words will be changed to
LaTeX single or double quotes; double quotes around a phrase will be
converted to &#34;``&#34; and &#34;&#39;&#39;&#34; and single quotes to &#34;`&#34; and &#34;&#39;&#34;.  This is
sometimes called &#34;intelligent quotes&#34;

=item C&lt;use_textcomp&gt;

By default the C&lt;latex_encode&gt; filter will encode characters with the
encodings provided by the C&lt;textcomp&gt; LaTeX package &#40;for example the
Pounds Sterling symbol is encoded as C&lt;\\textsterling{}&gt;&#41;.  Setting
C&lt;use_textcomp = 0&gt; turns off these encodings.  NOT YET IMPLEMENTED

=back

=back


=head1 EXAMPLES

The following snippet shows how data from a database can be encoded
and inserted into a LaTeX table, the source of which is generated with
C&lt;LaTeX::Table&gt;.

    my $sth = $dbh-&gt;prepare&#40;&#39;select col1, col2, col3 from table where $expr&#39;&#41;;
    $sth-&gt;execute;
    while &#40;my $href = $sth-&gt;fetchrow_hashref&#41; {
        my @row;
        foreach my $col &#40;qw&#40;col1 col2 col3&#41;&#41; {
            push&#40;@row, latex_encode&#40;$href-&gt;{$col}&#41;&#41;;
        }
        push @data, \@row;
    }

    my $headings = [ [ &#39;Col1&#39;, &#39;Col2&#39;, &#39;Col3&#39; ] ];

    my $table = LaTeX::Table-&gt;new&#40; { caption =&gt; &#39;My caption&#39;,
                                     label   =&gt; &#39;table:caption&#39;,
                                     type    =&gt; &#39;xtab&#39;,
                                     header  =&gt; $header,
                                     data    =&gt; \@data } &#41;;

    my $table_text = $table-&gt;generate_string;    

Now C&lt;$table_text&gt; can be interpolated into a LaTeX document template.


=head1 DIAGNOSTICS

None.  You could probably break the C&lt;latex_encode&gt; function by
passing it an array reference as the options, but there are no checks
for that.

=head1 CONFIGURATION AND ENVIRONMENT

Not applicable.


=head1 DEPENDENCIES

The C&lt;HTML::Entities&gt; and C&lt;Pod::LaTeX&gt; modules were used for building
the encoding table in C&lt;LaTeX::Encode::EncodingTable&gt;, but this is not
rebuilt at installation time.  The C&lt;LaTeX::Driver&gt; module is used for
formatting the character encodings reference document.

=head1 INCOMPATIBILITIES

None known.

=head1 BUGS AND LIMITATIONS

Not all LaTeX special characters are included in the encoding tables
&#40;more may be added when I track down the definitions&#41;.

The C&lt;use_textcomp&gt; option is not implemented.

=head1 AUTHOR

Andrew Ford E&lt;lt&gt;a.ford@ford-mason.co.ukE&lt;gt&gt;

=head1 LICENSE AND COPYRIGHT

Copyright &#40;C&#41; 2007 Andrew Ford.  All Rights Reserved.

This module is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.

This software is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

=head1 SEE ALSO

L&lt;Template::Plugin::Latex&gt;

=cut

# Local Variables:
# mode: perl
# perl-indent-level: 4
# indent-tabs-mode: nil
# End:
#
# vim: expandtab shiftwidth=4:
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> EncodingTable.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/941005/489214/EncodingTable.pm">Download EncodingTable.pm</a><br />
<span class="downloadcontenttype">text/x-perl 115k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-941009" href="/Public/Bug/Display.html?id=62710#txn-941009">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;31&nbsp;15:03:11&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1113501" href="/Public/Bug/Display.html?id=62710#txn-1113501">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;27&nbsp;11:09:41&nbsp;2012</span>
    <span class="description">ANDREWF [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1113502" href="/Public/Bug/Display.html?id=62710#txn-1113502">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;27&nbsp;11:12:35&nbsp;2012</span>
    <span class="description">ANDREWF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1113502/585713/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/585713">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 70b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe this is fixed in 0.04, which has just been uploaded to CPAN.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1113504" href="/Public/Bug/Display.html?id=62710#txn-1113504">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;27&nbsp;11:12:36&nbsp;2012</span>
    <span class="description">ANDREWF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.440724</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
